# Issue 17742: Reimplementation of IntegerListsLex

archive/issues_017742.json:
```json
{
    "body": "CC:  @nthiery @tscrim @nathanncohen @videlec @bgillesp\n\nAs documented in #17548, #17956, #17920, there are several bugs in IntegerListsLex which also have implications for !Partitions and !Compositions. This branch reimplements IntegerListsLex.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17979\n\n",
    "created_at": "2015-03-17T18:47:05Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.6",
    "title": "Reimplementation of IntegerListsLex",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17742",
    "user": "https://github.com/anneschilling"
}
```
CC:  @nthiery @tscrim @nathanncohen @videlec @bgillesp

As documented in #17548, #17956, #17920, there are several bugs in IntegerListsLex which also have implications for !Partitions and !Compositions. This branch reimplements IntegerListsLex.

Issue created by migration from https://trac.sagemath.org/ticket/17979





---

archive/issue_comments_236916.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2015-03-17T20:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236916",
    "user": "https://github.com/jdemeyer"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_236917.json:
```json
{
    "body": "Is anybody planning to work on this ticket, or it is just a \"somebody should do this\" ticket?\n\nYou might want to recycle some code of #17920, for example the computation of `floor` and `ceiling` using the various inputs. Also see that ticket for lots of doctests.",
    "created_at": "2015-03-17T20:22:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236917",
    "user": "https://github.com/jdemeyer"
}
```

Is anybody planning to work on this ticket, or it is just a "somebody should do this" ticket?

You might want to recycle some code of #17920, for example the computation of `floor` and `ceiling` using the various inputs. Also see that ticket for lots of doctests.



---

archive/issue_comments_236918.json:
```json
{
    "body": "Some people at Sage Days 64 are planning to work on this. Give us some time!",
    "created_at": "2015-03-17T21:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236918",
    "user": "https://github.com/anneschilling"
}
```

Some people at Sage Days 64 are planning to work on this. Give us some time!



---

archive/issue_comments_236919.json:
```json
{
    "body": "Changing keywords from \"\" to \"days64\".",
    "created_at": "2015-03-17T21:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236919",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "" to "days64".



---

archive/issue_comments_236920.json:
```json
{
    "body": "Replying to [comment:3 aschilling]:\n> Give us some time! \nIt was a question, not an attack...",
    "created_at": "2015-03-18T07:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236920",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 aschilling]:
> Give us some time! 
It was a question, not an attack...



---

archive/issue_comments_236921.json:
```json
{
    "body": "Another note: it would be very good if you didn't have any strange conditions on which input is allowed. Mathematically, all combinations of input constraints make sense, so they should all be allowed.",
    "created_at": "2015-03-18T07:40:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236921",
    "user": "https://github.com/jdemeyer"
}
```

Another note: it would be very good if you didn't have any strange conditions on which input is allowed. Mathematically, all combinations of input constraints make sense, so they should all be allowed.



---

archive/issue_comments_236922.json:
```json
{
    "body": "Hi Jeroen,\n\nReplying to [comment:6 jdemeyer]:\n> Replying to [comment:3 aschilling]:\n> > Give us some time! \n> It was a question, not an attack...\n\nOops, sorry, I guess there just has been a bit too much turmoil on the\ntopic lately :-) We just got uncomfortable with the \"blocker\", for at\nthis stage it's hard to predict how much time this will take (Sage\ndays are great for sprints, but you get easily side-tracked). Any idea\nwhen the next release of Sage is likely to come out?\n\nIn any cases, here is the current plan. We are having a sprint here to\nwork on reimplementing IntegerListLex from scratch. We believe it's\npossible to have a correct iteration algorithm, with complexity\nroughly linear in the output in the common use cases, that will detect\nand report any invalid input. There will be situations where computing\nthe next element may run forever. In those cases, we will report\nbeforehand a warning, which the user will be able to silence by\nsigning a waiver after having read the fine prints in the\ndocumentation.\n\nIf we can use the occasion to get generalizations for free, we will do\nso; but otherwise we will focus on getting the existing features\nright. Similarly, we will try to design the algorithm to potentially\nsupport cythonization / parallelism / implementation as a standalone\nC++ library, but postpone those for later.\n\nAnd we will reuse everything we can from your work!\n\nCheers,\n                                   Nicolas",
    "created_at": "2015-03-18T15:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236922",
    "user": "https://github.com/nthiery"
}
```

Hi Jeroen,

Replying to [comment:6 jdemeyer]:
> Replying to [comment:3 aschilling]:
> > Give us some time! 
> It was a question, not an attack...

Oops, sorry, I guess there just has been a bit too much turmoil on the
topic lately :-) We just got uncomfortable with the "blocker", for at
this stage it's hard to predict how much time this will take (Sage
days are great for sprints, but you get easily side-tracked). Any idea
when the next release of Sage is likely to come out?

In any cases, here is the current plan. We are having a sprint here to
work on reimplementing IntegerListLex from scratch. We believe it's
possible to have a correct iteration algorithm, with complexity
roughly linear in the output in the common use cases, that will detect
and report any invalid input. There will be situations where computing
the next element may run forever. In those cases, we will report
beforehand a warning, which the user will be able to silence by
signing a waiver after having read the fine prints in the
documentation.

If we can use the occasion to get generalizations for free, we will do
so; but otherwise we will focus on getting the existing features
right. Similarly, we will try to design the algorithm to potentially
support cythonization / parallelism / implementation as a standalone
C++ library, but postpone those for later.

And we will reuse everything we can from your work!

Cheers,
                                   Nicolas



---

archive/issue_comments_236923.json:
```json
{
    "body": "Replying to [comment:6 jdemeyer]:\n> Replying to [comment:3 aschilling]:\n> > Give us some time! \n> It was a question, not an attack...\n\nYes, no problem :-) We are discussing the algorithms, so once we are convinced it will all work, there is a group of people here that will try to implement it.",
    "created_at": "2015-03-18T17:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236923",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:6 jdemeyer]:
> Replying to [comment:3 aschilling]:
> > Give us some time! 
> It was a question, not an attack...

Yes, no problem :-) We are discussing the algorithms, so once we are convinced it will all work, there is a group of people here that will try to implement it.



---

archive/issue_comments_236924.json:
```json
{
    "body": "Replying to [comment:8 nthiery]:\n> We just got uncomfortable with the \"blocker\", for at\n> this stage it's hard to predict how much time this will take\nI made it a blocker not because of this specific ticket, but because *something* needs to be done: either a proper stopgap needs to be put back (which is essentially reverting #17898), or we switch to my correct-but-slow polyhedron implementation, or this ticket needs to be finished.",
    "created_at": "2015-03-18T17:42:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236924",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 nthiery]:
> We just got uncomfortable with the "blocker", for at
> this stage it's hard to predict how much time this will take
I made it a blocker not because of this specific ticket, but because *something* needs to be done: either a proper stopgap needs to be put back (which is essentially reverting #17898), or we switch to my correct-but-slow polyhedron implementation, or this ticket needs to be finished.



---

archive/issue_comments_236925.json:
```json
{
    "body": "Ok, sounds good!",
    "created_at": "2015-03-18T18:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236925",
    "user": "https://github.com/nthiery"
}
```

Ok, sounds good!



---

archive/issue_comments_236926.json:
```json
{
    "body": "Brief update from Sage Days 64: Bryan Gillespie implemented the algorithm we discussed! The code runs and all doc tests pass, including all the previous failures that Jeroen pointed out! The code is still about 10 times slower than the current implementation of IntegerListsLex, but at least appears to have no bugs and no restrictions any longer on the parameters. We will try to work on making it more efficient.",
    "created_at": "2015-03-21T06:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236926",
    "user": "https://github.com/anneschilling"
}
```

Brief update from Sage Days 64: Bryan Gillespie implemented the algorithm we discussed! The code runs and all doc tests pass, including all the previous failures that Jeroen pointed out! The code is still about 10 times slower than the current implementation of IntegerListsLex, but at least appears to have no bugs and no restrictions any longer on the parameters. We will try to work on making it more efficient.



---

archive/issue_comments_236927.json:
```json
{
    "body": "Only twice slower now that it uses +inf instead of infinity. infinity really needs to be optimized!",
    "created_at": "2015-03-21T06:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236927",
    "user": "https://github.com/nthiery"
}
```

Only twice slower now that it uses +inf instead of infinity. infinity really needs to be optimized!



---

archive/issue_comments_236928.json:
```json
{
    "body": "I would be -1 to using `float('inf')` just because it's faster. The Right Thing to do is to use Sage's `Infinity` and optimize that.",
    "created_at": "2015-03-21T07:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236928",
    "user": "https://github.com/jdemeyer"
}
```

I would be -1 to using `float('inf')` just because it's faster. The Right Thing to do is to use Sage's `Infinity` and optimize that.



---

archive/issue_comments_236929.json:
```json
{
    "body": "Where is the code...?\n\nGiven that rc0 has been released, we need to decide on a strategy to fix `IntegerListsLex` (either this ticket or a \"plan B\" if this ticket doesn't get finished).",
    "created_at": "2015-03-23T13:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236929",
    "user": "https://github.com/jdemeyer"
}
```

Where is the code...?

Given that rc0 has been released, we need to decide on a strategy to fix `IntegerListsLex` (either this ticket or a "plan B" if this ticket doesn't get finished).



---

archive/issue_comments_236930.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> Where is the code...?\n> \n> Given that rc0 has been released, we need to decide on a strategy to fix `IntegerListsLex` (either this ticket or a \"plan B\" if this ticket doesn't get finished).\n\nI can push the code, but currently the interface with partitions and compositions is still broken and a lot of functions (like next, first etc ) that are also used in integer_vector need to be deprecated. That has not been done yet.\n\nBest,\n\nAnne",
    "created_at": "2015-03-23T15:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236930",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:16 jdemeyer]:
> Where is the code...?
> 
> Given that rc0 has been released, we need to decide on a strategy to fix `IntegerListsLex` (either this ticket or a "plan B" if this ticket doesn't get finished).

I can push the code, but currently the interface with partitions and compositions is still broken and a lot of functions (like next, first etc ) that are also used in integer_vector need to be deprecated. That has not been done yet.

Best,

Anne



---

archive/issue_comments_236931.json:
```json
{
    "body": "Replying to [comment:17 aschilling]:\n> I can push the code, but currently the interface with partitions and compositions is still broken\nHow come? I didn't have this issue with #17920.",
    "created_at": "2015-03-23T15:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236931",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:17 aschilling]:
> I can push the code, but currently the interface with partitions and compositions is still broken
How come? I didn't have this issue with #17920.



---

archive/issue_comments_236932.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-03-24T02:22:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236932",
    "user": "https://github.com/anneschilling"
}
```

Last 10 new commits:



---

archive/issue_comments_236933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-24T02:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236934.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-24T02:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236934",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-24T02:41:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236935",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236936.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-24T03:08:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236936",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236937.json:
```json
{
    "body": "Here are the failures I got upon make ptestlong:\n\n```\nsage -t --long src/sage/doctest/test.py  # 1 doctest failed\nsage -t --long src/sage/tests/interrupt.pyx  # 1 doctest failed\nsage -t --long src/sage/parallel/decorate.py  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py  # Timed out\nsage -t --long src/sage/modular/arithgroup/arithgroup_perm.py  # Timed out\nsage -t --long src/sage/sets/set_from_iterator.py  # 3 doctests failed\nsage -t --long src/sage/combinat/words/words.py  # 5 doctests failed\nsage -t --long src/sage/algebras/weyl_algebra.py  # 3 doctests failed\n```\n\nThe last three are diagnosed (the new IntegerListLex was missing the feature of accepting an iterable for n) and is being fixed. The rest look more like unrelated failures.",
    "created_at": "2015-03-24T05:46:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236937",
    "user": "https://github.com/nthiery"
}
```

Here are the failures I got upon make ptestlong:

```
sage -t --long src/sage/doctest/test.py  # 1 doctest failed
sage -t --long src/sage/tests/interrupt.pyx  # 1 doctest failed
sage -t --long src/sage/parallel/decorate.py  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/lseries_ell.py  # Timed out
sage -t --long src/sage/modular/arithgroup/arithgroup_perm.py  # Timed out
sage -t --long src/sage/sets/set_from_iterator.py  # 3 doctests failed
sage -t --long src/sage/combinat/words/words.py  # 5 doctests failed
sage -t --long src/sage/algebras/weyl_algebra.py  # 3 doctests failed
```

The last three are diagnosed (the new IntegerListLex was missing the feature of accepting an iterable for n) and is being fixed. The rest look more like unrelated failures.



---

archive/issue_comments_236938.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-03-24T05:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236938",
    "user": "https://github.com/nthiery"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_236939.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-24T05:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236939",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_236940.json:
```json
{
    "body": "Helloooooooooooo,\n\nHere are some comments (mostly doc) about the current branch\n\n- About\n\n  {{{\n  An integer list is a list l of nonnegative integers, its parts. The length\n  of l is the number of its parts\n\n  Note Two valid integer lists are considered equivalent if they only differ by\n  trailing zeroes.\n  }}}\n\n  Unless the length of a list is the number of its nonzero entries, it does not\n  seem to be properly defined.\n\n- `The constraints on the lists are as follows:` -- in what follows you use\n  a variable `l` often (probably one of the lists): could you say so explicitly?\n\n- It seems that currently the method accepts input that does not satisfy the\n  constraints that you list, i.e.:\n\n  {{{\n  sage: IntegerListsLex(min_n=4)\n  Integer lists of sum between 4 and 0 satisfying certain constraints\n  sage: list(IntegerListsLex(min_n=4))\n  []\n  }}}\n\n  Should they really be considered as 'constraints', if the code accepts them\n  and returns sensible output (i.e. empty sets)? When I read those lines, I\n  expected the code to raise a `ValueError` exception on them.\n\n- `Lower and upper bounds`: the text about constant values for floor/ceiling\n  belongs to the INPUT block.\n\n- `waiver` -- the description of `waiver` in the INPUT block is very\n  mysterious. If it is only meant for internal purposes, could you say so in its\n  description?\n\n- `Next we obtain all lists of sum 4 and length 4 such that l[i] <= i:` --\n  missing backticks at the end.\n\n- Comparative timings: should they really appear in the function's\n  documentation? To me the trac ticket is the right place for that.\n\n- There are two 'TESTS' sections\n\n- `self.warning = False # warning for dangerous (but possibly valid) usage`\n  -- could say what this flag does?\n\n- the INPUT blocks says that `n` can be a list. Could you add there an\n  explanation of what it means?\n\n- About the message\n\n  {{{\n  warn(\"\"\"When the user specifies a method, then (s)he is responsible that the algorithm\n             will not hang. Also note that the specified function should start at 0 rather than 1.\n             Before trac#17979 the indexing was ambiguous and sometimes started at 1.\"\"\")\n  }}}\n\n  From time to time we receive bug reports on sage-devel or sage-support in\n  which the users beg us to forgive them in case what they think might be a bug\n  could actually be their mistake. Could this message be changed to something\n  more `technical`? Something like `you defined ceiling=[...] to be a function,\n  and we cannot swear that this call will not hang`?\n\n- About the copyright header: I never saw any patch remove the name of other\n  persons in a copyright header. Don't know what the policy is.\n\n  {{{\n  #!diff\n  -#       Copyright (C) 2007 Mike Hansen <mhansen`@`gmail.com>,\n  -#       Copyright (C) 2012 Travis Scrimshaw <tscrim`@`ucdavis.edu>\n  +#       Copyright (C) 2015 Bryan Gillespie <Brg008`@`gmail.com>,\n  }}}\n\nThanks,\n\nNathann",
    "created_at": "2015-03-24T07:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236940",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooooooo,

Here are some comments (mostly doc) about the current branch

- About

  {{{
  An integer list is a list l of nonnegative integers, its parts. The length
  of l is the number of its parts

  Note Two valid integer lists are considered equivalent if they only differ by
  trailing zeroes.
  }}}

  Unless the length of a list is the number of its nonzero entries, it does not
  seem to be properly defined.

- `The constraints on the lists are as follows:` -- in what follows you use
  a variable `l` often (probably one of the lists): could you say so explicitly?

- It seems that currently the method accepts input that does not satisfy the
  constraints that you list, i.e.:

  {{{
  sage: IntegerListsLex(min_n=4)
  Integer lists of sum between 4 and 0 satisfying certain constraints
  sage: list(IntegerListsLex(min_n=4))
  []
  }}}

  Should they really be considered as 'constraints', if the code accepts them
  and returns sensible output (i.e. empty sets)? When I read those lines, I
  expected the code to raise a `ValueError` exception on them.

- `Lower and upper bounds`: the text about constant values for floor/ceiling
  belongs to the INPUT block.

- `waiver` -- the description of `waiver` in the INPUT block is very
  mysterious. If it is only meant for internal purposes, could you say so in its
  description?

- `Next we obtain all lists of sum 4 and length 4 such that l[i] <= i:` --
  missing backticks at the end.

- Comparative timings: should they really appear in the function's
  documentation? To me the trac ticket is the right place for that.

- There are two 'TESTS' sections

- `self.warning = False # warning for dangerous (but possibly valid) usage`
  -- could say what this flag does?

- the INPUT blocks says that `n` can be a list. Could you add there an
  explanation of what it means?

- About the message

  {{{
  warn("""When the user specifies a method, then (s)he is responsible that the algorithm
             will not hang. Also note that the specified function should start at 0 rather than 1.
             Before trac#17979 the indexing was ambiguous and sometimes started at 1.""")
  }}}

  From time to time we receive bug reports on sage-devel or sage-support in
  which the users beg us to forgive them in case what they think might be a bug
  could actually be their mistake. Could this message be changed to something
  more `technical`? Something like `you defined ceiling=[...] to be a function,
  and we cannot swear that this call will not hang`?

- About the copyright header: I never saw any patch remove the name of other
  persons in a copyright header. Don't know what the policy is.

  {{{
  #!diff
  -#       Copyright (C) 2007 Mike Hansen <mhansen`@`gmail.com>,
  -#       Copyright (C) 2012 Travis Scrimshaw <tscrim`@`ucdavis.edu>
  +#       Copyright (C) 2015 Bryan Gillespie <Brg008`@`gmail.com>,
  }}}

Thanks,

Nathann



---

archive/issue_comments_236941.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> - About the copyright header: I never saw any patch remove the name of other\n>   persons in a copyright header.\nThat's not really true, there are many tickets which just remove whole modules, including the copyright header. If the whole module is completely rewritten (but only then), it's valid to remove the copyright header.",
    "created_at": "2015-03-24T07:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236941",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 ncohen]:
> - About the copyright header: I never saw any patch remove the name of other
>   persons in a copyright header.
That's not really true, there are many tickets which just remove whole modules, including the copyright header. If the whole module is completely rewritten (but only then), it's valid to remove the copyright header.



---

archive/issue_comments_236942.json:
```json
{
    "body": "> That's not really true, there are many tickets which just remove whole modules, including the copyright header. If the whole module is completely rewritten (but only then), it's valid to remove the copyright header.\nOkay, no prob then.",
    "created_at": "2015-03-24T07:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236942",
    "user": "https://github.com/nathanncohen"
}
```

> That's not really true, there are many tickets which just remove whole modules, including the copyright header. If the whole module is completely rewritten (but only then), it's valid to remove the copyright header.
Okay, no prob then.



---

archive/issue_comments_236943.json:
```json
{
    "body": "I would prefer `min_sum` and `max_sum` instead of `min_n` and `max_n` (`n` is just a letter and doesn't mean anything). I also think the defaults should be `0` and `Infinity` instead of `0` and `0`.\n\nIn this case, you probably do not need support for iteratable `n` since (AFAIK) all cases of iterables are really intervals and can be specified with `min_sum` and `max_sum` instead.",
    "created_at": "2015-03-24T07:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236943",
    "user": "https://github.com/jdemeyer"
}
```

I would prefer `min_sum` and `max_sum` instead of `min_n` and `max_n` (`n` is just a letter and doesn't mean anything). I also think the defaults should be `0` and `Infinity` instead of `0` and `0`.

In this case, you probably do not need support for iteratable `n` since (AFAIK) all cases of iterables are really intervals and can be specified with `min_sum` and `max_sum` instead.



---

archive/issue_comments_236944.json:
```json
{
    "body": "Replace\n\n```\nlist(IntegerListsLex(4, length = 4, ceiling = lambda i: i, waiver=True))\n```\n\nby\n\n```\nlist(IntegerListsLex(4, length=4, ceiling=lambda i: i, waiver=True))\n```\n\nand the same for similar places.",
    "created_at": "2015-03-24T07:58:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236944",
    "user": "https://github.com/jdemeyer"
}
```

Replace

```
list(IntegerListsLex(4, length = 4, ceiling = lambda i: i, waiver=True))
```

by

```
list(IntegerListsLex(4, length=4, ceiling=lambda i: i, waiver=True))
```

and the same for similar places.



---

archive/issue_comments_236945.json:
```json
{
    "body": "There should be empty lines between the bullet points in the `INPUT` block.",
    "created_at": "2015-03-24T07:58:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236945",
    "user": "https://github.com/jdemeyer"
}
```

There should be empty lines between the bullet points in the `INPUT` block.



---

archive/issue_comments_236946.json:
```json
{
    "body": "The heading should be formatted like [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) (in particular, it's bad to mention the GPL without version number).",
    "created_at": "2015-03-24T09:27:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236946",
    "user": "https://github.com/jdemeyer"
}
```

The heading should be formatted like [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) (in particular, it's bad to mention the GPL without version number).



---

archive/issue_comments_236947.json:
```json
{
    "body": "Why do you want to supporting `floor` and `ceiling` being a number? We already have `min_part` and `max_part` for that.",
    "created_at": "2015-03-24T09:29:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236947",
    "user": "https://github.com/jdemeyer"
}
```

Why do you want to supporting `floor` and `ceiling` being a number? We already have `min_part` and `max_part` for that.



---

archive/issue_comments_236948.json:
```json
{
    "body": "Is this still true?\n\n```\n    This is a generic low level tool. The interface has been designed\n    with efficiency in mind. It is subject to incompatible changes in\n    the future. More user friendly interfaces are provided by high\n    level tools like :class:`Partitions` or :class:`Compositions`.\n```\n",
    "created_at": "2015-03-24T09:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236948",
    "user": "https://github.com/jdemeyer"
}
```

Is this still true?

```
    This is a generic low level tool. The interface has been designed
    with efficiency in mind. It is subject to incompatible changes in
    the future. More user friendly interfaces are provided by high
    level tools like :class:`Partitions` or :class:`Compositions`.
```




---

archive/issue_comments_236949.json:
```json
{
    "body": "Is this really true?\n\n```\nBefore trac#17979 the indexing was ambiguous and sometimes started at 1.\n```\n",
    "created_at": "2015-03-24T09:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236949",
    "user": "https://github.com/jdemeyer"
}
```

Is this really true?

```
Before trac#17979 the indexing was ambiguous and sometimes started at 1.
```




---

archive/issue_comments_236950.json:
```json
{
    "body": "Use new-style doctest formatting: indent with `....:` instead of `...`",
    "created_at": "2015-03-24T09:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236950",
    "user": "https://github.com/jdemeyer"
}
```

Use new-style doctest formatting: indent with `....:` instead of `...`



---

archive/issue_comments_236951.json:
```json
{
    "body": "I agree with Nathann that the stuff about timings should be removed.",
    "created_at": "2015-03-24T09:35:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236951",
    "user": "https://github.com/jdemeyer"
}
```

I agree with Nathann that the stuff about timings should be removed.



---

archive/issue_comments_236952.json:
```json
{
    "body": "There is still this bug:\n\n```\nsage: it = iter(IntegerListsLex(4))\nsage: for _ in range(20): print next(it)\n[4]\n[3, 1]\n[3, 0, 1]\n[3, 0, 0, 1]\n[3, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n```\n\nIt seems that `[1,3]` will never appear in the output!",
    "created_at": "2015-03-24T09:45:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236952",
    "user": "https://github.com/jdemeyer"
}
```

There is still this bug:

```
sage: it = iter(IntegerListsLex(4))
sage: for _ in range(20): print next(it)
[4]
[3, 1]
[3, 0, 1]
[3, 0, 0, 1]
[3, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
[3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
```

It seems that `[1,3]` will never appear in the output!



---

archive/issue_comments_236953.json:
```json
{
    "body": "This takes forever, even though the list trivially contains just one element:\n\n```\nsage: IntegerListsLex(10^100, max_length=1).list()\n```\n",
    "created_at": "2015-03-24T09:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236953",
    "user": "https://github.com/jdemeyer"
}
```

This takes forever, even though the list trivially contains just one element:

```
sage: IntegerListsLex(10^100, max_length=1).list()
```




---

archive/issue_comments_236954.json:
```json
{
    "body": "Some implementations might not use keyword arguments for `length`, so the `min_n` and `max_n` arguments (preferably renamed to `min_sum` and `max_sum`) should be moved towards the end of the argument list.",
    "created_at": "2015-03-24T09:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236954",
    "user": "https://github.com/jdemeyer"
}
```

Some implementations might not use keyword arguments for `length`, so the `min_n` and `max_n` arguments (preferably renamed to `min_sum` and `max_sum`) should be moved towards the end of the argument list.



---

archive/issue_comments_236955.json:
```json
{
    "body": "I would prefer negative values of `min_part`, `max_part` to raise a `NotImplementedError` since the question makes sense mathematically, it's just not implemented.",
    "created_at": "2015-03-24T09:56:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236955",
    "user": "https://github.com/jdemeyer"
}
```

I would prefer negative values of `min_part`, `max_part` to raise a `NotImplementedError` since the question makes sense mathematically, it's just not implemented.



---

archive/issue_comments_236956.json:
```json
{
    "body": "Note that this example is *instant* with #17920:\n\n```\nsage: IntegerLists(10^100, max_length=1).list()\n```\n",
    "created_at": "2015-03-24T10:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236956",
    "user": "https://github.com/jdemeyer"
}
```

Note that this example is *instant* with #17920:

```
sage: IntegerLists(10^100, max_length=1).list()
```




---

archive/issue_comments_236957.json:
```json
{
    "body": "Replying to [comment:8 nthiery]:\n> And we will reuse everything we can from your work!\n\nThe following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:\n\n```\nsage: IntegerListsLex(499499, length=1000, min_slope=1).list()\n```\n",
    "created_at": "2015-03-24T10:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236957",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:8 nthiery]:
> And we will reuse everything we can from your work!

The following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:

```
sage: IntegerListsLex(499499, length=1000, min_slope=1).list()
```




---

archive/issue_comments_236958.json:
```json
{
    "body": "Remove\n\n```\nfrom sage.structure.list_clone import ClonableArray\nfrom sage.rings.integer import Integer\n```\n",
    "created_at": "2015-03-24T10:12:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236958",
    "user": "https://github.com/jdemeyer"
}
```

Remove

```
from sage.structure.list_clone import ClonableArray
from sage.rings.integer import Integer
```




---

archive/issue_comments_236959.json:
```json
{
    "body": "This comment is silly:\n\n```\n    In the following example, the floor conditions do not satisfy the\n    slope conditions since the floor for the third part is also 3. The algorithm\n    will nonetheless give the correct result::\n```\n",
    "created_at": "2015-03-24T10:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236959",
    "user": "https://github.com/jdemeyer"
}
```

This comment is silly:

```
    In the following example, the floor conditions do not satisfy the
    slope conditions since the floor for the third part is also 3. The algorithm
    will nonetheless give the correct result::
```




---

archive/issue_comments_236960.json:
```json
{
    "body": "I dislike the fact that the warning shows even in cases where the output is obviously finite:\n\n```\nsage: IntegerListsLex(5, ceiling=lambda i:i, length=5)\n/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:606: UserWarning: When the user specifies a method, then (s)he is responsible that the algorithm\n            will not hang. Also note that the specified function should start at 0 rather than 1.\n            Before trac#17979 the indexing was ambiguous and sometimes started at 1.\n  Before trac#17979 the indexing was ambiguous and sometimes started at 1.\"\"\")\nInteger lists of sum 5 satisfying certain constraints\n```\n\n\nAlso note that the formatting of the warning is not quite right.",
    "created_at": "2015-03-24T10:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236960",
    "user": "https://github.com/jdemeyer"
}
```

I dislike the fact that the warning shows even in cases where the output is obviously finite:

```
sage: IntegerListsLex(5, ceiling=lambda i:i, length=5)
/usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:606: UserWarning: When the user specifies a method, then (s)he is responsible that the algorithm
            will not hang. Also note that the specified function should start at 0 rather than 1.
            Before trac#17979 the indexing was ambiguous and sometimes started at 1.
  Before trac#17979 the indexing was ambiguous and sometimes started at 1.""")
Integer lists of sum 5 satisfying certain constraints
```


Also note that the formatting of the warning is not quite right.



---

archive/issue_comments_236961.json:
```json
{
    "body": "Replace\n\n```\nraise(Exception(\"message\"))\n```\n\nby\n\n```\nraise Exception(\"message\")\n```\n",
    "created_at": "2015-03-24T10:20:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236961",
    "user": "https://github.com/jdemeyer"
}
```

Replace

```
raise(Exception("message"))
```

by

```
raise Exception("message")
```




---

archive/issue_comments_236962.json:
```json
{
    "body": "It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more \"uniform\" way, never so slow that it was unusable.",
    "created_at": "2015-03-24T10:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236962",
    "user": "https://github.com/jdemeyer"
}
```

It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more "uniform" way, never so slow that it was unusable.



---

archive/issue_comments_236963.json:
```json
{
    "body": "What is `IntegerVectors` and why is it not an alias of `IntegerListsLex`?",
    "created_at": "2015-03-24T10:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236963",
    "user": "https://github.com/jdemeyer"
}
```

What is `IntegerVectors` and why is it not an alias of `IntegerListsLex`?



---

archive/issue_comments_236964.json:
```json
{
    "body": "> It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more \"uniform\" way, never so slow that it was unusable.\n\nThis is probably because it is hard to check whether the list that you are trying to build can be \"extended\" into a list that satisfies all conditions.\n\nI have not gone through the code yet, but it seems that the strategy is to try all possible choices for the first integer, then try all possible choices for the second (etc.) each time checking the constraints on what has already been decided (but not guessing anything about the future)\n\nThus, and still assuming that I did not misunderstand anything, the following set (which contains only one element) will only be returned after around `2^n` operations:\n\n\n```\nsage: n=20; IntegerLists(n, length=n,max_part=1).list()\n```\n\n\nCertainly some \"cuts\" can be added to detect when a partial sequence cannot be extended.\n\nNathann",
    "created_at": "2015-03-24T10:33:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236964",
    "user": "https://github.com/nathanncohen"
}
```

> It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more "uniform" way, never so slow that it was unusable.

This is probably because it is hard to check whether the list that you are trying to build can be "extended" into a list that satisfies all conditions.

I have not gone through the code yet, but it seems that the strategy is to try all possible choices for the first integer, then try all possible choices for the second (etc.) each time checking the constraints on what has already been decided (but not guessing anything about the future)

Thus, and still assuming that I did not misunderstand anything, the following set (which contains only one element) will only be returned after around `2^n` operations:


```
sage: n=20; IntegerLists(n, length=n,max_part=1).list()
```


Certainly some "cuts" can be added to detect when a partial sequence cannot be extended.

Nathann



---

archive/issue_comments_236965.json:
```json
{
    "body": "Please use `Infinity` instead of `infinity` such that, if we ever use `Infinity` from `sage.rings.infinity`, we don't need to change `infinity` to `Infinity` everywhere.",
    "created_at": "2015-03-24T11:21:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236965",
    "user": "https://github.com/jdemeyer"
}
```

Please use `Infinity` instead of `infinity` such that, if we ever use `Infinity` from `sage.rings.infinity`, we don't need to change `infinity` to `Infinity` everywhere.



---

archive/issue_comments_236966.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> - It seems that currently the method accepts input that does not satisfy the\n>   constraints that you list, i.e.:\n> \n>   {{{\n>   sage: IntegerListsLex(min_n=4)\n>   Integer lists of sum between 4 and 0 satisfying certain constraints\n>   sage: list(IntegerListsLex(min_n=4))\n>   []\n>   }}}\n> \n>   Should they really be considered as 'constraints', if the code accepts them\n>   and returns sensible output (i.e. empty sets)?\nI think that returning the empty set is the right answer here. As long as the question makes sense *mathematically*, there should be an answer, not an exception.\n\nThe only thing which can be a `ValueError` exception would be a negative length, since that doesn't even have a mathematical meaning. But I know from #17920 that some `Partitions` code gives a negative minimum length, so a negative value for `min_length` should just be treated as 0.",
    "created_at": "2015-03-24T11:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236966",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 ncohen]:
> - It seems that currently the method accepts input that does not satisfy the
>   constraints that you list, i.e.:
> 
>   {{{
>   sage: IntegerListsLex(min_n=4)
>   Integer lists of sum between 4 and 0 satisfying certain constraints
>   sage: list(IntegerListsLex(min_n=4))
>   []
>   }}}
> 
>   Should they really be considered as 'constraints', if the code accepts them
>   and returns sensible output (i.e. empty sets)?
I think that returning the empty set is the right answer here. As long as the question makes sense *mathematically*, there should be an answer, not an exception.

The only thing which can be a `ValueError` exception would be a negative length, since that doesn't even have a mathematical meaning. But I know from #17920 that some `Partitions` code gives a negative minimum length, so a negative value for `min_length` should just be treated as 0.



---

archive/issue_comments_236967.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> - the INPUT blocks says that `n` can be a list. Could you add there an\n>   explanation of what it means?\n\nAlternatively, remove support for `n` being a list. It's nowhere used in Sage. The old code \"supported\" it but it was never documented.",
    "created_at": "2015-03-24T11:35:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236967",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:27 ncohen]:
> - the INPUT blocks says that `n` can be a list. Could you add there an
>   explanation of what it means?

Alternatively, remove support for `n` being a list. It's nowhere used in Sage. The old code "supported" it but it was never documented.



---

archive/issue_comments_236968.json:
```json
{
    "body": "This limitation should be mentioned somewhere in the docs:\n\n```\nsage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()\nTraceback (most recent call last):\n...\nValueError: infinite upper bound for values of m\n```\n\n(this is another example which \"just works\" with #17920).",
    "created_at": "2015-03-24T14:54:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236968",
    "user": "https://github.com/jdemeyer"
}
```

This limitation should be mentioned somewhere in the docs:

```
sage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()
Traceback (most recent call last):
...
ValueError: infinite upper bound for values of m
```

(this is another example which "just works" with #17920).



---

archive/issue_comments_236969.json:
```json
{
    "body": "There are a lot of `TODO` items in the code and #commented out code which should be cleaned up.",
    "created_at": "2015-03-24T14:56:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236969",
    "user": "https://github.com/jdemeyer"
}
```

There are a lot of `TODO` items in the code and #commented out code which should be cleaned up.



---

archive/issue_comments_236970.json:
```json
{
    "body": "Errors like these should be `TypeError` instead of `ValueError`:\n\n```\nraise(ValueError(\"unable to parse value of min_part\"))\n```\n",
    "created_at": "2015-03-24T15:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236970",
    "user": "https://github.com/jdemeyer"
}
```

Errors like these should be `TypeError` instead of `ValueError`:

```
raise(ValueError("unable to parse value of min_part"))
```




---

archive/issue_comments_236971.json:
```json
{
    "body": "What's the point of setting `self.floor_type` if you don't use it?",
    "created_at": "2015-03-24T15:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236971",
    "user": "https://github.com/jdemeyer"
}
```

What's the point of setting `self.floor_type` if you don't use it?



---

archive/issue_comments_236972.json:
```json
{
    "body": "This is not a tricky question but still takes forever:\n\n```\nsage: IntegerLists(1, min_part=0, max_part=0).list()\n```\n",
    "created_at": "2015-03-24T15:10:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236972",
    "user": "https://github.com/jdemeyer"
}
```

This is not a tricky question but still takes forever:

```
sage: IntegerLists(1, min_part=0, max_part=0).list()
```




---

archive/issue_comments_236973.json:
```json
{
    "body": "Use `Infinity` here:\n\n```\n            self.floor_limit_start = float('+inf')\n```\n",
    "created_at": "2015-03-24T16:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236973",
    "user": "https://github.com/jdemeyer"
}
```

Use `Infinity` here:

```
            self.floor_limit_start = float('+inf')
```




---

archive/issue_comments_236974.json:
```json
{
    "body": "Thanks for the thorough comments--Nicolas, Anne and I have been working on this ticket persistently for just the last week at Sage Days 64, and we didn't have the time to polish every facet yet.  I'll do my best to answer your questions about the algorithm and some of the design choices.",
    "created_at": "2015-03-24T20:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236974",
    "user": "https://github.com/bgillesp"
}
```

Thanks for the thorough comments--Nicolas, Anne and I have been working on this ticket persistently for just the last week at Sage Days 64, and we didn't have the time to polish every facet yet.  I'll do my best to answer your questions about the algorithm and some of the design choices.



---

archive/issue_comments_236975.json:
```json
{
    "body": "Replying to [comment:52 ncohen]:\n> > It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more \"uniform\" way, never so slow that it was unusable.\n> \n> This is probably because it is hard to check whether the list that you are trying to build can be \"extended\" into a list that satisfies all conditions.\n> \n> I have not gone through the code yet, but it seems that the strategy is to try all possible choices for the first integer, then try all possible choices for the second (etc.) each time checking the constraints on what has already been decided (but not guessing anything about the future)\n\nIn fact, the point of the algorithm is that there *is* guessing on the\nfuture; in most not-too-degenerate cases, one can detect that a branch\nwill lead to nowhere and cut it.\n\n> Thus, and still assuming that I did not misunderstand anything, the following set (which contains only one element) will only be returned after around `2^n` operations:\n> \n> {{{\n> sage: n=20; IntegerLists(n, length=n,max_part=1).list()\n> }}}\n> \n> Certainly some \"cuts\" can be added to detect when a partial sequence cannot be extended.\n\nAt this point, the complexity of the following is not linear as it\nought to be (one should be able to do the detection work faster by\ncaching critical data), but it definitely is polynomial with a small\ndegree (most likely quadratic), and very far from 2^n:\n\n\n```\n    sage: n=20; IntegerLists(n, length=n,max_part=1).list()\n    sage: n=1000\n    sage: %time IntegerListsLex(n, length=n,max_part=1).list()\n    CPU times: user 852 ms, sys: 25.5 ms, total: 877 ms\n    Wall time: 831 ms\n    sage: n=2000\n    sage: %time x = IntegerListsLex(n, length=n,max_part=1).list()\n    CPU times: user 3.15 s, sys: 24.2 ms, total: 3.17 s\n    Wall time: 3.15 s\n```\n\n\nCheers,\n                          Nicolas",
    "created_at": "2015-03-24T20:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236975",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:52 ncohen]:
> > It's a pity that this code is sometimes very fast and sometimes very slow depending on the input. My approach #17920 was slower, but in a more "uniform" way, never so slow that it was unusable.
> 
> This is probably because it is hard to check whether the list that you are trying to build can be "extended" into a list that satisfies all conditions.
> 
> I have not gone through the code yet, but it seems that the strategy is to try all possible choices for the first integer, then try all possible choices for the second (etc.) each time checking the constraints on what has already been decided (but not guessing anything about the future)

In fact, the point of the algorithm is that there *is* guessing on the
future; in most not-too-degenerate cases, one can detect that a branch
will lead to nowhere and cut it.

> Thus, and still assuming that I did not misunderstand anything, the following set (which contains only one element) will only be returned after around `2^n` operations:
> 
> {{{
> sage: n=20; IntegerLists(n, length=n,max_part=1).list()
> }}}
> 
> Certainly some "cuts" can be added to detect when a partial sequence cannot be extended.

At this point, the complexity of the following is not linear as it
ought to be (one should be able to do the detection work faster by
caching critical data), but it definitely is polynomial with a small
degree (most likely quadratic), and very far from 2^n:


```
    sage: n=20; IntegerLists(n, length=n,max_part=1).list()
    sage: n=1000
    sage: %time IntegerListsLex(n, length=n,max_part=1).list()
    CPU times: user 852 ms, sys: 25.5 ms, total: 877 ms
    Wall time: 831 ms
    sage: n=2000
    sage: %time x = IntegerListsLex(n, length=n,max_part=1).list()
    CPU times: user 3.15 s, sys: 24.2 ms, total: 3.17 s
    Wall time: 3.15 s
```


Cheers,
                          Nicolas



---

archive/issue_comments_236976.json:
```json
{
    "body": "Replying to [comment:62 bgillespie]:\n> Thanks for the thorough comments\n\nIndeed! Thanks Nathann and Jeroen; I know how much time this takes.\n\nNow, guys, if I may, Brian would deserve some words of appreciation from you for all the hard work he put into this.\n\n                              Nicolas",
    "created_at": "2015-03-24T21:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236976",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:62 bgillespie]:
> Thanks for the thorough comments

Indeed! Thanks Nathann and Jeroen; I know how much time this takes.

Now, guys, if I may, Brian would deserve some words of appreciation from you for all the hard work he put into this.

                              Nicolas



---

archive/issue_comments_236977.json:
```json
{
    "body": "Replying to [comment:27 ncohen]:\n> Helloooooooooooo,\n> \n> Here are some comments (mostly doc) about the current branch\n> \n> - About\n> \n>   {{{\n>   An integer list is a list l of nonnegative integers, its parts. The length\n>   of l is the number of its parts\n> \n>   Note Two valid integer lists are considered equivalent if they only differ by\n>   trailing zeroes.\n>   }}}\n> \n>   Unless the length of a list is the number of its nonzero entries, it does not\n>   seem to be properly defined.\n\nThe length of a list is the number of its entries, including entries of size zero.  i.e. [2, 0, 1, 0] is a list of length 4.  It is equivalent to the list [2, 0, 1], but has a different length.\n\n\n\n> - `The constraints on the lists are as follows:` -- in what follows you use\n>   a variable `l` often (probably one of the lists): could you say so explicitly?\n\nI've added a note to that effect.\n\n\n\n\n> - It seems that currently the method accepts input that does not satisfy the\n>   constraints that you list, i.e.:\n> \n>   {{{\n>   sage: IntegerListsLex(min_n=4)\n>   Integer lists of sum between 4 and 0 satisfying certain constraints\n>   sage: list(IntegerListsLex(min_n=4))\n>   []\n>   }}}\n> \n>   Should they really be considered as 'constraints', if the code accepts them\n>   and returns sensible output (i.e. empty sets)? When I read those lines, I\n>   expected the code to raise a `ValueError` exception on them.\n\nThe results from the algorithm should be mathematically correct if an error isn't raised--in this case, the set of such lists is empty, as advertised.  While I was working through the initialization code yesterday, I did notice that it would be reasonable to include as few constraints on the initialization as possible and just give an empty output when conditions are contradictory, but I didn't have time to ensure that the algorithm was sound under arbitrary permutations of bad constraints.  At the moment, everything that is returned should be correct.\n\n\n\n> \n> - `Lower and upper bounds`: the text about constant values for floor/ceiling\n>   belongs to the INPUT block.\n\nUpdated.\n\n\n\n> - `waiver` -- the description of `waiver` in the INPUT block is very\n>   mysterious. If it is only meant for internal purposes, could you say so in its\n>   description?\n\nAlso updated.  The waiver parameter is meant to be user-facing; it's purpose is to suppress a warning raised when the input parameters can't be checked computationally for cases that don't hang.  This situation can occur when the user specifies an arbitrary function for the floor and ceiling parameters, so the purpose here is to verify that the user has thought carefully about what they are asking the algorithm to compute.\n\n\n\n> - `Next we obtain all lists of sum 4 and length 4 such that l[i] <= i:` --\n>   missing backticks at the end.\n\nFixed.\n\n\n\n> - Comparative timings: should they really appear in the function's\n>   documentation? To me the trac ticket is the right place for that.\n\nProbably not, that was mainly for comparison during development.  It's also old at this point, so I'll add current comparative timings to another comment.\n\n\n> - There are two 'TESTS' sections\n\nThat is true.  Fixed.\n\n\n> - `self.warning = False # warning for dangerous (but possibly valid) usage`\n>   -- could say what this flag does?\n\nThis is mostly an internal marker, and just keeps track of whether we are in a potentially\nhanging use case (custom user function) that requires a warning to the user.  I've\nchanged it to `self._warning` to indicate that it's an internal marker, and made\nthe comment more verbose for the curious.\n\n\n> - the INPUT blocks says that `n` can be a list. Could you add there an\n>   explanation of what it means?\n\nAdded an explanation.  (This just allows you to specify multiple allowable values for the list sum.)\n\n\n> - About the message\n> \n>   {{{\n>   warn(\"\"\"When the user specifies a method, then (s)he is responsible that the algorithm\n>              will not hang. Also note that the specified function should start at 0 rather than 1.\n>              Before trac#17979 the indexing was ambiguous and sometimes started at 1.\"\"\")\n>   }}}\n> \n>   From time to time we receive bug reports on sage-devel or sage-support in\n>   which the users beg us to forgive them in case what they think might be a bug\n>   could actually be their mistake. Could this message be changed to something\n>   more `technical`? Something like `you defined ceiling=[...] to be a function,\n>   and we cannot swear that this call will not hang`?\n\nUpdated the message to be more specific about the issue.\n\n\n\n> - About the copyright header: I never saw any patch remove the name of other\n>   persons in a copyright header. Don't know what the policy is.\n> \n>   {{{\n>   #!diff\n>   -#       Copyright (C) 2007 Mike Hansen <mhansen`@`gmail.com>,\n>   -#       Copyright (C) 2012 Travis Scrimshaw <tscrim`@`ucdavis.edu>\n>   +#       Copyright (C) 2015 Bryan Gillespie <Brg008`@`gmail.com>,\n>   }}}\n\nThe update is a complete rewrite, so probably a new author list makes sense.\n\n-- Bryan",
    "created_at": "2015-03-24T22:11:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236977",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:27 ncohen]:
> Helloooooooooooo,
> 
> Here are some comments (mostly doc) about the current branch
> 
> - About
> 
>   {{{
>   An integer list is a list l of nonnegative integers, its parts. The length
>   of l is the number of its parts
> 
>   Note Two valid integer lists are considered equivalent if they only differ by
>   trailing zeroes.
>   }}}
> 
>   Unless the length of a list is the number of its nonzero entries, it does not
>   seem to be properly defined.

The length of a list is the number of its entries, including entries of size zero.  i.e. [2, 0, 1, 0] is a list of length 4.  It is equivalent to the list [2, 0, 1], but has a different length.



> - `The constraints on the lists are as follows:` -- in what follows you use
>   a variable `l` often (probably one of the lists): could you say so explicitly?

I've added a note to that effect.




> - It seems that currently the method accepts input that does not satisfy the
>   constraints that you list, i.e.:
> 
>   {{{
>   sage: IntegerListsLex(min_n=4)
>   Integer lists of sum between 4 and 0 satisfying certain constraints
>   sage: list(IntegerListsLex(min_n=4))
>   []
>   }}}
> 
>   Should they really be considered as 'constraints', if the code accepts them
>   and returns sensible output (i.e. empty sets)? When I read those lines, I
>   expected the code to raise a `ValueError` exception on them.

The results from the algorithm should be mathematically correct if an error isn't raised--in this case, the set of such lists is empty, as advertised.  While I was working through the initialization code yesterday, I did notice that it would be reasonable to include as few constraints on the initialization as possible and just give an empty output when conditions are contradictory, but I didn't have time to ensure that the algorithm was sound under arbitrary permutations of bad constraints.  At the moment, everything that is returned should be correct.



> 
> - `Lower and upper bounds`: the text about constant values for floor/ceiling
>   belongs to the INPUT block.

Updated.



> - `waiver` -- the description of `waiver` in the INPUT block is very
>   mysterious. If it is only meant for internal purposes, could you say so in its
>   description?

Also updated.  The waiver parameter is meant to be user-facing; it's purpose is to suppress a warning raised when the input parameters can't be checked computationally for cases that don't hang.  This situation can occur when the user specifies an arbitrary function for the floor and ceiling parameters, so the purpose here is to verify that the user has thought carefully about what they are asking the algorithm to compute.



> - `Next we obtain all lists of sum 4 and length 4 such that l[i] <= i:` --
>   missing backticks at the end.

Fixed.



> - Comparative timings: should they really appear in the function's
>   documentation? To me the trac ticket is the right place for that.

Probably not, that was mainly for comparison during development.  It's also old at this point, so I'll add current comparative timings to another comment.


> - There are two 'TESTS' sections

That is true.  Fixed.


> - `self.warning = False # warning for dangerous (but possibly valid) usage`
>   -- could say what this flag does?

This is mostly an internal marker, and just keeps track of whether we are in a potentially
hanging use case (custom user function) that requires a warning to the user.  I've
changed it to `self._warning` to indicate that it's an internal marker, and made
the comment more verbose for the curious.


> - the INPUT blocks says that `n` can be a list. Could you add there an
>   explanation of what it means?

Added an explanation.  (This just allows you to specify multiple allowable values for the list sum.)


> - About the message
> 
>   {{{
>   warn("""When the user specifies a method, then (s)he is responsible that the algorithm
>              will not hang. Also note that the specified function should start at 0 rather than 1.
>              Before trac#17979 the indexing was ambiguous and sometimes started at 1.""")
>   }}}
> 
>   From time to time we receive bug reports on sage-devel or sage-support in
>   which the users beg us to forgive them in case what they think might be a bug
>   could actually be their mistake. Could this message be changed to something
>   more `technical`? Something like `you defined ceiling=[...] to be a function,
>   and we cannot swear that this call will not hang`?

Updated the message to be more specific about the issue.



> - About the copyright header: I never saw any patch remove the name of other
>   persons in a copyright header. Don't know what the policy is.
> 
>   {{{
>   #!diff
>   -#       Copyright (C) 2007 Mike Hansen <mhansen`@`gmail.com>,
>   -#       Copyright (C) 2012 Travis Scrimshaw <tscrim`@`ucdavis.edu>
>   +#       Copyright (C) 2015 Bryan Gillespie <Brg008`@`gmail.com>,
>   }}}

The update is a complete rewrite, so probably a new author list makes sense.

-- Bryan



---

archive/issue_comments_236978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-24T22:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236978",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236979.json:
```json
{
    "body": "Here are some comparative timings Re: the ones stripped from the docs.\n\n\n\n```\nsage: from sage.combinat.integer_list_old import IntegerListsLex as IntegerListsLexOld\n\nsage: P = IntegerListsLex(n=20, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 159 ms, sys: 25.8 ms, total: 185 ms\nWall time: 164 ms\nsage: P = IntegerListsLexOld(n=20, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 170 ms, sys: 12.9 ms, total: 183 ms\nWall time: 162 ms\n\nsage: len(x)\n627\n\nsage: P = IntegerListsLex(n=30, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 1.74 s, sys: 21.9 ms, total: 1.76 s\nWall time: 1.66 s\nsage: P = IntegerListsLexOld(n=30, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 1.44 s, sys: 18.1 ms, total: 1.46 s\nWall time: 1.42 s\n\nsage: len(x)\n5604\n\nsage: P = IntegerListsLex(n=40, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 12.8 s, sys: 0 ns, total: 12.8 s\nWall time: 12.7 s\nsage: P = IntegerListsLexOld(n=40, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 10.3 s, sys: 1.98 ms, total: 10.3 s\nWall time: 10.3 s\n\nsage: len(x)\n37338\n\nsage: P = IntegerListsLex(n=50, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 1min 20s, sys: 216 ms, total: 1min 20s\nWall time: 1min 20s\nsage: P = IntegerListsLexOld(n=50, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 1min 1s, sys: 153 ms, total: 1min 2s\nWall time: 1min 2s\n\nsage: len(x)\n204226\n\nsage: P = IntegerListsLex(n=60, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 7min 5s, sys: 823 ms, total: 7min 6s\nWall time: 7min 5s\nsage: P = IntegerListsLexOld(n=60, max_slope=0, min_part=1)\nsage: %time x = list(P)\nCPU times: user 5min 12s, sys: 495 ms, total: 5min 12s\nWall time: 5min 12s\n\nsage: len(x)\n966467\n```\n",
    "created_at": "2015-03-24T22:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236979",
    "user": "https://github.com/bgillesp"
}
```

Here are some comparative timings Re: the ones stripped from the docs.



```
sage: from sage.combinat.integer_list_old import IntegerListsLex as IntegerListsLexOld

sage: P = IntegerListsLex(n=20, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 159 ms, sys: 25.8 ms, total: 185 ms
Wall time: 164 ms
sage: P = IntegerListsLexOld(n=20, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 170 ms, sys: 12.9 ms, total: 183 ms
Wall time: 162 ms

sage: len(x)
627

sage: P = IntegerListsLex(n=30, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 1.74 s, sys: 21.9 ms, total: 1.76 s
Wall time: 1.66 s
sage: P = IntegerListsLexOld(n=30, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 1.44 s, sys: 18.1 ms, total: 1.46 s
Wall time: 1.42 s

sage: len(x)
5604

sage: P = IntegerListsLex(n=40, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 12.8 s, sys: 0 ns, total: 12.8 s
Wall time: 12.7 s
sage: P = IntegerListsLexOld(n=40, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 10.3 s, sys: 1.98 ms, total: 10.3 s
Wall time: 10.3 s

sage: len(x)
37338

sage: P = IntegerListsLex(n=50, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 1min 20s, sys: 216 ms, total: 1min 20s
Wall time: 1min 20s
sage: P = IntegerListsLexOld(n=50, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 1min 1s, sys: 153 ms, total: 1min 2s
Wall time: 1min 2s

sage: len(x)
204226

sage: P = IntegerListsLex(n=60, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 7min 5s, sys: 823 ms, total: 7min 6s
Wall time: 7min 5s
sage: P = IntegerListsLexOld(n=60, max_slope=0, min_part=1)
sage: %time x = list(P)
CPU times: user 5min 12s, sys: 495 ms, total: 5min 12s
Wall time: 5min 12s

sage: len(x)
966467
```




---

archive/issue_comments_236980.json:
```json
{
    "body": "Replying to [comment:34 jdemeyer]:\n> Why do you want to supporting `floor` and `ceiling` being a number? We already have `min_part` and `max_part` for that.\n\nThe main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.  In the current implementation, all of the cases that can be handled with `min_part` and `max_part` plus `floor` and `ceiling` can also be handled using `floor` and `ceiling` alone.",
    "created_at": "2015-03-24T22:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236980",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:34 jdemeyer]:
> Why do you want to supporting `floor` and `ceiling` being a number? We already have `min_part` and `max_part` for that.

The main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.  In the current implementation, all of the cases that can be handled with `min_part` and `max_part` plus `floor` and `ceiling` can also be handled using `floor` and `ceiling` alone.



---

archive/issue_comments_236981.json:
```json
{
    "body": "Replying to [comment:36 jdemeyer]:\n> Is this really true?\n> {{{\n> Before trac#17979 the indexing was ambiguous and sometimes started at 1.\n> }}}\nThere were places in the code of the old integer_list.py that used either convention, and integer_vector.py consistently started indexing at 1.",
    "created_at": "2015-03-24T22:35:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236981",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:36 jdemeyer]:
> Is this really true?
> {{{
> Before trac#17979 the indexing was ambiguous and sometimes started at 1.
> }}}
There were places in the code of the old integer_list.py that used either convention, and integer_vector.py consistently started indexing at 1.



---

archive/issue_comments_236982.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> There is still this bug:\n> {{{\n> sage: it = iter(IntegerListsLex(4))\n> sage: for _ in range(20): print next(it)\n> [4]\n> [3, 1]\n> [3, 0, 1]\n> [3, 0, 0, 1]\n> [3, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> }}}\n> It seems that `[1,3]` will never appear in the output!\n\nNot a bug, but an issue that's worth discussing.  The premise of IntegerListsLex, as I understand it, is that it should return integer lists satisfying certain constraints, in lexicographic ordering, starting with the largest.  The lists returned in your example are exactly what they should be for this specification--none of them is smaller than `[1,3]` in lex ordering, since the `4` or `3` in the first position is larger than the corresponding `1`.\n\nThe issue is in specifying a priori a total ordering on the set that may not be isomorphic with that on NN (in fact, may not even be well-ordered).  Does it even make sense to call an object which iterates through a proper countable subset of a set an iterator?  On the other hand, the iteration itself might still be useful in this case.\n\nAt the very least, this behavior is shared with that of the old implementation.",
    "created_at": "2015-03-24T22:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236982",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:39 jdemeyer]:
> There is still this bug:
> {{{
> sage: it = iter(IntegerListsLex(4))
> sage: for _ in range(20): print next(it)
> [4]
> [3, 1]
> [3, 0, 1]
> [3, 0, 0, 1]
> [3, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> }}}
> It seems that `[1,3]` will never appear in the output!

Not a bug, but an issue that's worth discussing.  The premise of IntegerListsLex, as I understand it, is that it should return integer lists satisfying certain constraints, in lexicographic ordering, starting with the largest.  The lists returned in your example are exactly what they should be for this specification--none of them is smaller than `[1,3]` in lex ordering, since the `4` or `3` in the first position is larger than the corresponding `1`.

The issue is in specifying a priori a total ordering on the set that may not be isomorphic with that on NN (in fact, may not even be well-ordered).  Does it even make sense to call an object which iterates through a proper countable subset of a set an iterator?  On the other hand, the iteration itself might still be useful in this case.

At the very least, this behavior is shared with that of the old implementation.



---

archive/issue_comments_236983.json:
```json
{
    "body": "Replying to [comment:48 jdemeyer]:\n> I dislike the fact that the warning shows even in cases where the output is obviously finite:\n> {{{\n> sage: IntegerListsLex(5, ceiling=lambda i:i, length=5)\n> /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:606: UserWarning: When the user specifies a method, then (s)he is responsible that the algorithm\n>             will not hang. Also note that the specified function should start at 0 rather than 1.\n>             Before trac#17979 the indexing was ambiguous and sometimes started at 1.\n>   Before trac#17979 the indexing was ambiguous and sometimes started at 1.\"\"\")\n> Integer lists of sum 5 satisfying certain constraints\n> }}}\n> \n> Also note that the formatting of the warning is not quite right.\n\nI updated the formatting of the warning (also the message to be more explicit/verbose), so check if it looks reasonable to you.\n\nHere's what our thought process was concerning when to raise a warning message.  We could easily do some additional computations to find certain cases where the specified parameters make giving a custom function safe.  However, one of the complaints with the old version was that it was difficult to understand how the parameters affected the output.  If we make it \"sometimes\" verifiably safe to use a custom function, depending on the circumstances, then that's another point of complexity for the user to follow--but if we just raise a warning whenever a user uses a custom floor or ceiling function (but only if they haven't \"signed a waiver\" by specifying `waiver=True`), that simplifies the interface for the user.\n\nAlso note that the example you gave could be handled by the following specification without raising a warning:\n\n```\nsage: IntegerListsLex(5, ceiling=[0,1,2,3,4], length=5)\n```\n",
    "created_at": "2015-03-24T23:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236983",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:48 jdemeyer]:
> I dislike the fact that the warning shows even in cases where the output is obviously finite:
> {{{
> sage: IntegerListsLex(5, ceiling=lambda i:i, length=5)
> /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:606: UserWarning: When the user specifies a method, then (s)he is responsible that the algorithm
>             will not hang. Also note that the specified function should start at 0 rather than 1.
>             Before trac#17979 the indexing was ambiguous and sometimes started at 1.
>   Before trac#17979 the indexing was ambiguous and sometimes started at 1.""")
> Integer lists of sum 5 satisfying certain constraints
> }}}
> 
> Also note that the formatting of the warning is not quite right.

I updated the formatting of the warning (also the message to be more explicit/verbose), so check if it looks reasonable to you.

Here's what our thought process was concerning when to raise a warning message.  We could easily do some additional computations to find certain cases where the specified parameters make giving a custom function safe.  However, one of the complaints with the old version was that it was difficult to understand how the parameters affected the output.  If we make it "sometimes" verifiably safe to use a custom function, depending on the circumstances, then that's another point of complexity for the user to follow--but if we just raise a warning whenever a user uses a custom floor or ceiling function (but only if they haven't "signed a waiver" by specifying `waiver=True`), that simplifies the interface for the user.

Also note that the example you gave could be handled by the following specification without raising a warning:

```
sage: IntegerListsLex(5, ceiling=[0,1,2,3,4], length=5)
```




---

archive/issue_comments_236984.json:
```json
{
    "body": "Replying to [comment:68 bgillespie]:\n> The main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.\nI disagree. The advantage of `min_part` and `max_part` is they are *known* to be constant, which can lead to optimizations which cannot be done with `floor` and `ceiling` functions. Even if you don't do these optimizations at the moment, I would leave open the possibility of doing that in the future (I do so in #17920).",
    "created_at": "2015-03-24T23:35:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236984",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:68 bgillespie]:
> The main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.
I disagree. The advantage of `min_part` and `max_part` is they are *known* to be constant, which can lead to optimizations which cannot be done with `floor` and `ceiling` functions. Even if you don't do these optimizations at the moment, I would leave open the possibility of doing that in the future (I do so in #17920).



---

archive/issue_comments_236985.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> This limitation should be mentioned somewhere in the docs:\n> {{{\n> sage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()\n> Traceback (most recent call last):\n> ...\n> ValueError: infinite upper bound for values of m\n> }}}\n> (this is another example which \"just works\" with #17920).\n\nI have plans to implement some parameter adjustments and cardinality checking for the cases when a user doesn't specify a custom floor or ceiling function which would catch this issue.  Currently the code doesn't do any extra handling on cases where the floor and ceiling functions intersect, so currently it tries to find the largest possible value for the first position in the list, and determines that there is no largest one.  The new checks would also make use of the slope conditions to catch something like:\n\n```\nsage: IntegerListsLex(length=3, max_n=Infinity, max_slope=1, ceiling=[Infinity, 1, 3], floor=[0, 1, 3])\n```\n\n\nFor the moment, it does raise an error in this kind of situation, but it also doesn't hang or return an incorrect result.  It also might be useful to give a more descriptive error message for when the possible values in a position are unbounded.",
    "created_at": "2015-03-24T23:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236985",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:56 jdemeyer]:
> This limitation should be mentioned somewhere in the docs:
> {{{
> sage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()
> Traceback (most recent call last):
> ...
> ValueError: infinite upper bound for values of m
> }}}
> (this is another example which "just works" with #17920).

I have plans to implement some parameter adjustments and cardinality checking for the cases when a user doesn't specify a custom floor or ceiling function which would catch this issue.  Currently the code doesn't do any extra handling on cases where the floor and ceiling functions intersect, so currently it tries to find the largest possible value for the first position in the list, and determines that there is no largest one.  The new checks would also make use of the slope conditions to catch something like:

```
sage: IntegerListsLex(length=3, max_n=Infinity, max_slope=1, ceiling=[Infinity, 1, 3], floor=[0, 1, 3])
```


For the moment, it does raise an error in this kind of situation, but it also doesn't hang or return an incorrect result.  It also might be useful to give a more descriptive error message for when the possible values in a position are unbounded.



---

archive/issue_comments_236986.json:
```json
{
    "body": "Replying to [comment:70 bgillespie]:\n> Replying to [comment:39 jdemeyer]:\n> > It seems that `[1,3]` will never appear in the output!\n> \n> Not a bug, but an issue that's worth discussing.\nIt **is** a bug, see also the discussion starting at [comment:29:ticket:17548].",
    "created_at": "2015-03-24T23:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236986",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:70 bgillespie]:
> Replying to [comment:39 jdemeyer]:
> > It seems that `[1,3]` will never appear in the output!
> 
> Not a bug, but an issue that's worth discussing.
It **is** a bug, see also the discussion starting at [comment:29:ticket:17548].



---

archive/issue_comments_236987.json:
```json
{
    "body": "Replying to [comment:72 jdemeyer]:\n> Replying to [comment:68 bgillespie]:\n> > The main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.\n> I disagree. The advantage of `min_part` and `max_part` is they are *known* to be constant, which can lead to optimizations which cannot be done with `floor` and `ceiling` functions. Even if you don't do these optimizations at the moment, I would leave open the possibility of doing that in the future (I do so in #17920).\n\nNote that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.",
    "created_at": "2015-03-24T23:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236987",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:72 jdemeyer]:
> Replying to [comment:68 bgillespie]:
> > The main reason is that `min_part` and `max_part` are redundant in purpose with `floor` and `ceiling`, so the hope would be to deprecate that usage at some point.
> I disagree. The advantage of `min_part` and `max_part` is they are *known* to be constant, which can lead to optimizations which cannot be done with `floor` and `ceiling` functions. Even if you don't do these optimizations at the moment, I would leave open the possibility of doing that in the future (I do so in #17920).

Note that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.



---

archive/issue_comments_236988.json:
```json
{
    "body": "Replying to [comment:74 jdemeyer]:\n> Replying to [comment:70 bgillespie]:\n> > Replying to [comment:39 jdemeyer]:\n> > > It seems that `[1,3]` will never appear in the output!\n> > \n> > Not a bug, but an issue that's worth discussing.\n> It **is** a bug, see also the discussion starting at [comment:29:ticket:17548].\n\nYes, I have glanced through that discussion.\n\nThe point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?",
    "created_at": "2015-03-24T23:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236988",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:74 jdemeyer]:
> Replying to [comment:70 bgillespie]:
> > Replying to [comment:39 jdemeyer]:
> > > It seems that `[1,3]` will never appear in the output!
> > 
> > Not a bug, but an issue that's worth discussing.
> It **is** a bug, see also the discussion starting at [comment:29:ticket:17548].

Yes, I have glanced through that discussion.

The point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?



---

archive/issue_comments_236989.json:
```json
{
    "body": "Replying to [comment:59 jdemeyer]:\n> What's the point of setting `self.floor_type` if you don't use it?\nI have plans to use it in an upcoming update which determines, in cases where a user doesn't specify custom functions, whether the set is finite/infinite, and if it can be enumerated in Lex ordering.  (In particular this will be useful for properly setting the Category of the object, which currently defaults to `FiniteEnumeratedSets`.",
    "created_at": "2015-03-24T23:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236989",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:59 jdemeyer]:
> What's the point of setting `self.floor_type` if you don't use it?
I have plans to use it in an upcoming update which determines, in cases where a user doesn't specify custom functions, whether the set is finite/infinite, and if it can be enumerated in Lex ordering.  (In particular this will be useful for properly setting the Category of the object, which currently defaults to `FiniteEnumeratedSets`.



---

archive/issue_comments_236990.json:
```json
{
    "body": "Hi Brian,\n\nI should have some time tonight to work on this ticket. Let me know what your plans are to synchronize; in particular what areas I can hack in freely.\n\nThanks!",
    "created_at": "2015-03-25T01:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236990",
    "user": "https://github.com/nthiery"
}
```

Hi Brian,

I should have some time tonight to work on this ticket. Let me know what your plans are to synchronize; in particular what areas I can hack in freely.

Thanks!



---

archive/issue_comments_236991.json:
```json
{
    "body": "Hi Nicolas,\n\nAll my current changes are pushed to the ticket--I made changes Re: comment 27, but haven't gotten to the other misc. changes suggested in various comments.  I'll need to prepare a talk for a conference this weekend, so I'll only be able to put in part-time for the next few days--so feel free to hack wherever tonight.  I'll check back in tomorrow during the day to look over some of the other recommendations from comments.  Let me know if there's anything else you want me to look over then.",
    "created_at": "2015-03-25T03:03:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236991",
    "user": "https://github.com/bgillesp"
}
```

Hi Nicolas,

All my current changes are pushed to the ticket--I made changes Re: comment 27, but haven't gotten to the other misc. changes suggested in various comments.  I'll need to prepare a talk for a conference this weekend, so I'll only be able to put in part-time for the next few days--so feel free to hack wherever tonight.  I'll check back in tomorrow during the day to look over some of the other recommendations from comments.  Let me know if there's anything else you want me to look over then.



---

archive/issue_comments_236992.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T03:57:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236992",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236993.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T05:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236993",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_236994.json:
```json
{
    "body": "Hellooooo,\n\n> The length of a list is the number of its entries, including entries of size zero.  i.e. [2, 0, 1, 0] is a list of length 4.  It is equivalent to the list [2, 0, 1], but has a different length.\n> \n\n\nMay I ask where in the function it is used that two lists are equivalent when they only differ by the number of trailing zeroes ?\n\nIf it is only when `min_length<max_length`, could you add this mention as a note in the documentation of those parameters (input block)?\n\n> >   {{{\n> >   sage: IntegerListsLex(min_n=4)\n> >   Integer lists of sum between 4 and 0 satisfying certain constraints\n> >   sage: list(IntegerListsLex(min_n=4))\n> >   []\n> >   }}}\n> > \n> >   Should they really be considered as 'constraints', if the code accepts them\n> >   and returns sensible output (i.e. empty sets)? When I read those lines, I\n> >   expected the code to raise a `ValueError` exception on them.\n> \n> The results from the algorithm should be mathematically correct if an error isn't raised--in this case, the set of such lists is empty, as advertised.  While I was working through the initialization code yesterday, I did notice that it would be reasonable to include as few constraints on the initialization as possible and just give an empty output when conditions are contradictory, but I didn't have time to ensure that the algorithm was sound under arbitrary permutations of bad constraints.\n\nOh, the current behaviour is fine for me! If unsatisfiable parameters lead to an empty set there is no reason to complain: I was merely saying that the documentation made it sound like it was 'bad' to create such objects. Thus, I expected an exception. But if they are handled correctly, why is it even mentionned in the doc? Empty sets will be returned and so everything is fine, isn't it?\n\n> Also updated.  The waiver parameter is meant to be user-facing; it's purpose is to suppress a warning raised when the input parameters can't be checked computationally for cases that don't hang.  This situation can occur when the user specifies an arbitrary function for the floor and ceiling parameters, so the purpose here is to verify that the user has thought carefully about what they are asking the algorithm to compute.\n\nI wonder about that... Instead of letting the code hang, wouldn't it be better to first \"explore a bit the floor/ceiling parameters\" ? If you see that up to 10<sup>10</sup> all the values of ceiling do not sum to n, then say that something is wrong straight away?\n\n\n> This is mostly an internal marker, and just keeps track of whether we are in a potentially\n> hanging use case (custom user function) that requires a warning to the user.  I've\n> changed it to `self._warning` to indicate that it's an internal marker, and made\n> the comment more verbose for the curious.\n\nThanks,\n\nNathann",
    "created_at": "2015-03-25T06:51:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236994",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooo,

> The length of a list is the number of its entries, including entries of size zero.  i.e. [2, 0, 1, 0] is a list of length 4.  It is equivalent to the list [2, 0, 1], but has a different length.
> 


May I ask where in the function it is used that two lists are equivalent when they only differ by the number of trailing zeroes ?

If it is only when `min_length<max_length`, could you add this mention as a note in the documentation of those parameters (input block)?

> >   {{{
> >   sage: IntegerListsLex(min_n=4)
> >   Integer lists of sum between 4 and 0 satisfying certain constraints
> >   sage: list(IntegerListsLex(min_n=4))
> >   []
> >   }}}
> > 
> >   Should they really be considered as 'constraints', if the code accepts them
> >   and returns sensible output (i.e. empty sets)? When I read those lines, I
> >   expected the code to raise a `ValueError` exception on them.
> 
> The results from the algorithm should be mathematically correct if an error isn't raised--in this case, the set of such lists is empty, as advertised.  While I was working through the initialization code yesterday, I did notice that it would be reasonable to include as few constraints on the initialization as possible and just give an empty output when conditions are contradictory, but I didn't have time to ensure that the algorithm was sound under arbitrary permutations of bad constraints.

Oh, the current behaviour is fine for me! If unsatisfiable parameters lead to an empty set there is no reason to complain: I was merely saying that the documentation made it sound like it was 'bad' to create such objects. Thus, I expected an exception. But if they are handled correctly, why is it even mentionned in the doc? Empty sets will be returned and so everything is fine, isn't it?

> Also updated.  The waiver parameter is meant to be user-facing; it's purpose is to suppress a warning raised when the input parameters can't be checked computationally for cases that don't hang.  This situation can occur when the user specifies an arbitrary function for the floor and ceiling parameters, so the purpose here is to verify that the user has thought carefully about what they are asking the algorithm to compute.

I wonder about that... Instead of letting the code hang, wouldn't it be better to first "explore a bit the floor/ceiling parameters" ? If you see that up to 10<sup>10</sup> all the values of ceiling do not sum to n, then say that something is wrong straight away?


> This is mostly an internal marker, and just keeps track of whether we are in a potentially
> hanging use case (custom user function) that requires a warning to the user.  I've
> changed it to `self._warning` to indicate that it's an internal marker, and made
> the comment more verbose for the curious.

Thanks,

Nathann



---

archive/issue_comments_236995.json:
```json
{
    "body": "Replying to [comment:76 bgillespie]:\n> The point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?\n\nThe are two possible solutions:\n1. raise an exception if the iterator doesn't iterate over all elements.\n2. drop the \"lexicographic order\" requirement.",
    "created_at": "2015-03-25T07:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236995",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:76 bgillespie]:
> The point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?

The are two possible solutions:
1. raise an exception if the iterator doesn't iterate over all elements.
2. drop the "lexicographic order" requirement.



---

archive/issue_comments_236996.json:
```json
{
    "body": "Replying to [comment:77 bgillespie]:\n> Replying to [comment:59 jdemeyer]:\n> > What's the point of setting `self.floor_type` if you don't use it?\n> I have plans to use it in an upcoming update\nIn that case, I would prefer to introduce these attributes in that upcoming update.",
    "created_at": "2015-03-25T07:23:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236996",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:77 bgillespie]:
> Replying to [comment:59 jdemeyer]:
> > What's the point of setting `self.floor_type` if you don't use it?
> I have plans to use it in an upcoming update
In that case, I would prefer to introduce these attributes in that upcoming update.



---

archive/issue_comments_236997.json:
```json
{
    "body": "Replying to [comment:75 bgillespie]:\n> Note that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.\n\nHowever, without `min_part`, there is absolutely no way to specify \"`floor` is a function which is always at least 1\". I should be able to specify such an input with `floor=myfunc, min_part=1` and the code can optimize this case better than when just specifying the function. [comment:60] is an excellent example of this.",
    "created_at": "2015-03-25T07:26:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236997",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:75 bgillespie]:
> Note that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.

However, without `min_part`, there is absolutely no way to specify "`floor` is a function which is always at least 1". I should be able to specify such an input with `floor=myfunc, min_part=1` and the code can optimize this case better than when just specifying the function. [comment:60] is an excellent example of this.



---

archive/issue_comments_236998.json:
```json
{
    "body": "By the say, sorry for my earlier comment about the `2^n` runtime of the function. I am pretty sure I ran that test several times (reloading the branch in between) and that it was hanging with `n=20` (running fine with `n=10`, and slow with `n=15`), but I cannot reproduce it now and the answer is immediate. Soooo well, my mistake `O_o`\n\nNathann\n\nP.S.: currently, this branch keeps a copy of `integer_list.py` as `integer_list_old.py`.",
    "created_at": "2015-03-25T11:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236998",
    "user": "https://github.com/nathanncohen"
}
```

By the say, sorry for my earlier comment about the `2^n` runtime of the function. I am pretty sure I ran that test several times (reloading the branch in between) and that it was hanging with `n=20` (running fine with `n=10`, and slow with `n=15`), but I cannot reproduce it now and the answer is immediate. Soooo well, my mistake `O_o`

Nathann

P.S.: currently, this branch keeps a copy of `integer_list.py` as `integer_list_old.py`.



---

archive/issue_comments_236999.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T16:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-236999",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237000.json:
```json
{
    "body": "Replying to [comment:40 jdemeyer]:\n> This takes forever, even though the list trivially contains just one element:\n> {{{\n> sage: IntegerListsLex(10^100, max_length=1).list()\n> }}}\n\nThanks! This should be fixed now. I put in a test as well.",
    "created_at": "2015-03-25T16:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237000",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:40 jdemeyer]:
> This takes forever, even though the list trivially contains just one element:
> {{{
> sage: IntegerListsLex(10^100, max_length=1).list()
> }}}

Thanks! This should be fixed now. I put in a test as well.



---

archive/issue_comments_237001.json:
```json
{
    "body": "Replying to [comment:46 jdemeyer]:\n> Remove\n> {{{\n> from sage.structure.list_clone import ClonableArray\n> from sage.rings.integer import Integer\n> }}}\n\nWhy? ClonableArray is used!",
    "created_at": "2015-03-25T16:51:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237001",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:46 jdemeyer]:
> Remove
> {{{
> from sage.structure.list_clone import ClonableArray
> from sage.rings.integer import Integer
> }}}

Why? ClonableArray is used!



---

archive/issue_comments_237002.json:
```json
{
    "body": "Replying to [comment:86 ncohen]:\n> P.S.: currently, this branch keeps a copy of `integer_list.py` as `integer_list_old.py`.\n\nThis is because some other classes refer to next, first etc in combinat.integer_list which we do not have any longer in the new implementation. It is also useful right now to compare against the timing of the old implementation!",
    "created_at": "2015-03-25T17:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237002",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:86 ncohen]:
> P.S.: currently, this branch keeps a copy of `integer_list.py` as `integer_list_old.py`.

This is because some other classes refer to next, first etc in combinat.integer_list which we do not have any longer in the new implementation. It is also useful right now to compare against the timing of the old implementation!



---

archive/issue_comments_237003.json:
```json
{
    "body": "Replying to [comment:89 aschilling]:\n> Why? ClonableArray is used!\nIt was imported twice, but that's already fixed.",
    "created_at": "2015-03-25T17:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237003",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:89 aschilling]:
> Why? ClonableArray is used!
It was imported twice, but that's already fixed.



---

archive/issue_comments_237004.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T17:50:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237004",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237005.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T17:52:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237005",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237006.json:
```json
{
    "body": "Replying to [comment:69 bgillespie]:\n> Replying to [comment:36 jdemeyer]:\n> > Is this really true?\n> > {{{\n> > Before trac#17979 the indexing was ambiguous and sometimes started at 1.\n> > }}}\n> There were places in the code of the old integer_list.py that used either convention, and integer_vector.py consistently started indexing at 1.\n\nSorry, my bad: actually the 1-based indexing was only used internally in the old ``IntegerListLex``. I removed that comment.",
    "created_at": "2015-03-25T17:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237006",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:69 bgillespie]:
> Replying to [comment:36 jdemeyer]:
> > Is this really true?
> > {{{
> > Before trac#17979 the indexing was ambiguous and sometimes started at 1.
> > }}}
> There were places in the code of the old integer_list.py that used either convention, and integer_vector.py consistently started indexing at 1.

Sorry, my bad: actually the 1-based indexing was only used internally in the old ``IntegerListLex``. I removed that comment.



---

archive/issue_comments_237007.json:
```json
{
    "body": "Replying to [comment:51 jdemeyer]:\n> What is `IntegerVectors` and why is it not an alias of `IntegerListsLex`?\n\nEssentially it's a short hand for `IntegerListsLex` when the length is fixed. Kind of like Partitions is a short hand for `IntegerListsLex` when `min_part=1` and `max_slope=0`. It also adds some more methods, and specialized counting. In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`.",
    "created_at": "2015-03-25T17:59:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237007",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:51 jdemeyer]:
> What is `IntegerVectors` and why is it not an alias of `IntegerListsLex`?

Essentially it's a short hand for `IntegerListsLex` when the length is fixed. Kind of like Partitions is a short hand for `IntegerListsLex` when `min_part=1` and `max_slope=0`. It also adds some more methods, and specialized counting. In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`.



---

archive/issue_comments_237008.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T18:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237009.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:8 nthiery]:\n> > And we will reuse everything we can from your work!\n> \n> The following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:\n> {{{\n> sage: IntegerListsLex(499499, length=1000, min_slope=1).list()\n> }}}\n\nAgreed. I am pretty sure that the lookahead could be improved to handle this properly (Bryan: probably by doing some dichotomy in m_interval). I am going to throw this in the examples as a reminder for further work on this in later tickets.",
    "created_at": "2015-03-25T18:05:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237009",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:8 nthiery]:
> > And we will reuse everything we can from your work!
> 
> The following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:
> {{{
> sage: IntegerListsLex(499499, length=1000, min_slope=1).list()
> }}}

Agreed. I am pretty sure that the lookahead could be improved to handle this properly (Bryan: probably by doing some dichotomy in m_interval). I am going to throw this in the examples as a reminder for further work on this in later tickets.



---

archive/issue_comments_237010.json:
```json
{
    "body": "> This is because some other classes refer to next, first etc in combinat.integer_list which we do not have any longer in the new implementation. It is also useful right now to compare against the timing of the old implementation!\n\nIt is also code which returns wrong results. If you insist on keeping it around, could you add a stopgap in there?\n\nNathann",
    "created_at": "2015-03-25T18:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237010",
    "user": "https://github.com/nathanncohen"
}
```

> This is because some other classes refer to next, first etc in combinat.integer_list which we do not have any longer in the new implementation. It is also useful right now to compare against the timing of the old implementation!

It is also code which returns wrong results. If you insist on keeping it around, could you add a stopgap in there?

Nathann



---

archive/issue_comments_237011.json:
```json
{
    "body": "> It is also code which returns wrong results. If you insist on keeping it around, could you add a stopgap in there?\n\nMy mistake, it is there.\n\nNathann",
    "created_at": "2015-03-25T18:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237011",
    "user": "https://github.com/nathanncohen"
}
```

> It is also code which returns wrong results. If you insist on keeping it around, could you add a stopgap in there?

My mistake, it is there.

Nathann



---

archive/issue_comments_237012.json:
```json
{
    "body": "Replying to [comment:53 jdemeyer]:\n> Please use `Infinity` instead of `infinity` such that, if we ever use `Infinity` from `sage.rings.infinity`, we don't need to change `infinity` to `Infinity` everywhere.\n\nI just changed `infinity` to `_infinity` to mark that we are currently doing something special; it's a one line change at the begining of the file to switch to `_infinity=Infinity` when the later will be optimized (looking forward to it). That being said, I don't mind changing `_infinity` to `Infinity` in the code if you think this won't bring confusion.",
    "created_at": "2015-03-25T18:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237012",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:53 jdemeyer]:
> Please use `Infinity` instead of `infinity` such that, if we ever use `Infinity` from `sage.rings.infinity`, we don't need to change `infinity` to `Infinity` everywhere.

I just changed `infinity` to `_infinity` to mark that we are currently doing something special; it's a one line change at the begining of the file to switch to `_infinity=Infinity` when the later will be optimized (looking forward to it). That being said, I don't mind changing `_infinity` to `Infinity` in the code if you think this won't bring confusion.



---

archive/issue_comments_237013.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> I would be -1 to using `float('inf')` just because it's faster. The Right Thing to do is to use Sage's `Infinity` and optimize that.\n\nAgreed, that's the right thing to do in the mid term. But for now `float('inf')` does the job, and it will be  one line change anyway once `Infinity` will be optimized. So let's not add a dependency on it.",
    "created_at": "2015-03-25T18:42:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237013",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:15 jdemeyer]:
> I would be -1 to using `float('inf')` just because it's faster. The Right Thing to do is to use Sage's `Infinity` and optimize that.

Agreed, that's the right thing to do in the mid term. But for now `float('inf')` does the job, and it will be  one line change anyway once `Infinity` will be optimized. So let's not add a dependency on it.



---

archive/issue_comments_237014.json:
```json
{
    "body": "Replying to [comment:83 jdemeyer]:\n> Replying to [comment:76 bgillespie]:\n> > The point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?\n> \n> The are two possible solutions:\n> 1. raise an exception if the iterator doesn't iterate over all elements.\n> 2. drop the \"lexicographic order\" requirement.\n\nHaving alternative implementations that take the second route to\nhandle those cases is indeed a worthwhile goal. But that's not\n`IntegerListsLex`'s job :-)\n\nHere, we shall aim for 1., whenever possible: that is systematically\nwhen floor/ceiling are not functions, and when it's obvious and cheap\notherwise.\n\nCheers,\n                                 Nicolas",
    "created_at": "2015-03-25T18:48:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237014",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:83 jdemeyer]:
> Replying to [comment:76 bgillespie]:
> > The point is that if it is a bug, then it's a bug in the specification, not the code, since we are requiring the output to be in lexicographic order.  However, if we don't want to call it an iterator because it doesn't satisfy the contract of eventually reaching every element in the set, then the class won't interact well with the many places that use iterators in Python and Sage.  Can you propose a solution to this?
> 
> The are two possible solutions:
> 1. raise an exception if the iterator doesn't iterate over all elements.
> 2. drop the "lexicographic order" requirement.

Having alternative implementations that take the second route to
handle those cases is indeed a worthwhile goal. But that's not
`IntegerListsLex`'s job :-)

Here, we shall aim for 1., whenever possible: that is systematically
when floor/ceiling are not functions, and when it's obvious and cheap
otherwise.

Cheers,
                                 Nicolas



---

archive/issue_comments_237015.json:
```json
{
    "body": "Bryan: it would be useful if all the attributes `self.floor`, ... were specified, typically in comments above or in the `__init__` method.\n\nBtw: shall we rename those attributes as `self._floor` to mark them as private?",
    "created_at": "2015-03-25T18:51:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237015",
    "user": "https://github.com/nthiery"
}
```

Bryan: it would be useful if all the attributes `self.floor`, ... were specified, typically in comments above or in the `__init__` method.

Btw: shall we rename those attributes as `self._floor` to mark them as private?



---

archive/issue_comments_237016.json:
```json
{
    "body": "Replying to [comment:85 jdemeyer]:\n> Replying to [comment:75 bgillespie]:\n> > Note that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.\n> \n> However, without `min_part`, there is absolutely no way to specify \"`floor` is a function which is always at least 1\". I should be able to specify such an input with `floor=myfunc, min_part=1` and the code can optimize this case better than when just specifying the function. [comment:60] is an excellent example of this.\n\nWe were experimenting a bit with the API to try to minimize redundancy.\nAt this point, I have settled for:\n\n- `min_part` to specify a lower bound for all parts\n- `floor` to specify lower bounds on the individual parts\n\nWhat do you think?\n\nQuestion: if the users passes `floor=f, min_part=i` should `IntegerListsLex` assume that `f(k)` is always at most `i`, or should it wrap `f` to add this guarantee? At this point it does the latter, which of course adds a bit of overhead (which could be tamed with appropriate caching which we will anyway want to do during the Cythonization).",
    "created_at": "2015-03-25T18:58:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237016",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:85 jdemeyer]:
> Replying to [comment:75 bgillespie]:
> > Note that `floor` and `ceiling` take multiple different types of parameters, not just functions.  This code checks for the type of the input parameter and optimizes when using a constant or a list of integers.
> 
> However, without `min_part`, there is absolutely no way to specify "`floor` is a function which is always at least 1". I should be able to specify such an input with `floor=myfunc, min_part=1` and the code can optimize this case better than when just specifying the function. [comment:60] is an excellent example of this.

We were experimenting a bit with the API to try to minimize redundancy.
At this point, I have settled for:

- `min_part` to specify a lower bound for all parts
- `floor` to specify lower bounds on the individual parts

What do you think?

Question: if the users passes `floor=f, min_part=i` should `IntegerListsLex` assume that `f(k)` is always at most `i`, or should it wrap `f` to add this guarantee? At this point it does the latter, which of course adds a bit of overhead (which could be tamed with appropriate caching which we will anyway want to do during the Cythonization).



---

archive/issue_comments_237017.json:
```json
{
    "body": "Replying to [comment:56 jdemeyer]:\n> This limitation should be mentioned somewhere in the docs:\n> {{{\n> sage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()\n> Traceback (most recent call last):\n> ...\n> ValueError: infinite upper bound for values of m\n> }}}\n> (this is another example which \"just works\" with #17920).\n\nI added this to the documentation, specifying that this example could be  enumerated in lexicographically increasing order but not in lexicographically decreasing order as does `IntegerListsLex`.\n\nTwo questions:\n\n- Does anyone have a good suggestion for a better error message?\n\n- Should the error message be created upon creating the parent, or\n  when starting the iteration? The advantage of doing it only upon\n  iteration is that we can still use the parent for checking\n  containment, constructing the polytope, ...",
    "created_at": "2015-03-25T19:14:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237017",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:56 jdemeyer]:
> This limitation should be mentioned somewhere in the docs:
> {{{
> sage: IntegerListsLex(length=2, max_n=Infinity, ceiling=[Infinity, 0], floor=[0,1]).list()
> Traceback (most recent call last):
> ...
> ValueError: infinite upper bound for values of m
> }}}
> (this is another example which "just works" with #17920).

I added this to the documentation, specifying that this example could be  enumerated in lexicographically increasing order but not in lexicographically decreasing order as does `IntegerListsLex`.

Two questions:

- Does anyone have a good suggestion for a better error message?

- Should the error message be created upon creating the parent, or
  when starting the iteration? The advantage of doing it only upon
  iteration is that we can still use the parent for checking
  containment, constructing the polytope, ...



---

archive/issue_comments_237018.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T19:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237019.json:
```json
{
    "body": "I believe I have taken care of Jeroen's stylistic comments about raising execptions, type or not implemented errors instead of value errors, comment:47,",
    "created_at": "2015-03-25T19:18:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237019",
    "user": "https://github.com/nthiery"
}
```

I believe I have taken care of Jeroen's stylistic comments about raising execptions, type or not implemented errors instead of value errors, comment:47,



---

archive/issue_comments_237020.json:
```json
{
    "body": "\n```\nOSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:370: WARNING: Literal block expected; none found.\n```\n",
    "created_at": "2015-03-25T19:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237020",
    "user": "https://github.com/jdemeyer"
}
```


```
OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:370: WARNING: Literal block expected; none found.
```




---

archive/issue_comments_237021.json:
```json
{
    "body": "Replying to [comment:95 nthiery]:\n> In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`. \n\nLooking at the diff, I see *lots* of changes to `integer_vector.py`.",
    "created_at": "2015-03-25T19:33:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237021",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:95 nthiery]:
> In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`. 

Looking at the diff, I see *lots* of changes to `integer_vector.py`.



---

archive/issue_comments_237022.json:
```json
{
    "body": "Replying to [comment:101 nthiery]:\n> That being said, I don't mind changing `_infinity` to `Infinity` in the code if you think this won't bring confusion.\n\nI would prefer `Infinity`.",
    "created_at": "2015-03-25T19:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237022",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:101 nthiery]:
> That being said, I don't mind changing `_infinity` to `Infinity` in the code if you think this won't bring confusion.

I would prefer `Infinity`.



---

archive/issue_comments_237023.json:
```json
{
    "body": "Replying to [comment:105 nthiery]:\n> At this point, I have settled for:\n> \n> - `min_part` to specify a lower bound for all parts\n> - `floor` to specify lower bounds on the individual parts\n> \n> What do you think?\n> \n> Question: if the users passes `floor=f, min_part=i` should `IntegerListsLex` assume that `f(k)` is always at most `i`, or should it wrap `f` to add this guarantee? At this point it does the latter.\nThe latter is the approach I took at #17920, so I agree completely :-)\n\nIt fits well with the philosophy that *all* constraints have to be taken into account.",
    "created_at": "2015-03-25T19:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237023",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:105 nthiery]:
> At this point, I have settled for:
> 
> - `min_part` to specify a lower bound for all parts
> - `floor` to specify lower bounds on the individual parts
> 
> What do you think?
> 
> Question: if the users passes `floor=f, min_part=i` should `IntegerListsLex` assume that `f(k)` is always at most `i`, or should it wrap `f` to add this guarantee? At this point it does the latter.
The latter is the approach I took at #17920, so I agree completely :-)

It fits well with the philosophy that *all* constraints have to be taken into account.



---

archive/issue_comments_237024.json:
```json
{
    "body": "Replying to [comment:88 aschilling]:\n> Replying to [comment:40 jdemeyer]:\n> > This takes forever, even though the list trivially contains just one element:\n> > {{{\n> > sage: IntegerListsLex(10^100, max_length=1).list()\n> > }}}\n> \n> Thanks! This should be fixed now. I put in a test as well.\nI see you \"fixed\" this by adding one small heuristic, but similar examples still don't work:\n\n```\nsage: IntegerListsLex(10^100, length=2, min_slope=-2, max_slope=2).list()\n...\n```\n",
    "created_at": "2015-03-25T19:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237024",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:88 aschilling]:
> Replying to [comment:40 jdemeyer]:
> > This takes forever, even though the list trivially contains just one element:
> > {{{
> > sage: IntegerListsLex(10^100, max_length=1).list()
> > }}}
> 
> Thanks! This should be fixed now. I put in a test as well.
I see you "fixed" this by adding one small heuristic, but similar examples still don't work:

```
sage: IntegerListsLex(10^100, length=2, min_slope=-2, max_slope=2).list()
...
```




---

archive/issue_comments_237025.json:
```json
{
    "body": "Replying to [comment:106 nthiery]:\n> - Should the error message be created upon creating the parent, or\n>   when starting the iteration? The advantage of doing it only upon\n>   iteration is that we can still use the parent for checking\n>   containment, constructing the polytope, ...\nDuring iteration, mainly because I think that expensive checks should not be done during `__init__`.",
    "created_at": "2015-03-25T20:08:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237025",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:106 nthiery]:
> - Should the error message be created upon creating the parent, or
>   when starting the iteration? The advantage of doing it only upon
>   iteration is that we can still use the parent for checking
>   containment, constructing the polytope, ...
During iteration, mainly because I think that expensive checks should not be done during `__init__`.



---

archive/issue_comments_237026.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-25T20:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237027.json:
```json
{
    "body": "The tree traversal code in the iterator class needed some clean-up to make it more clear what was supposed to be happening where, so I did that in the above commit.  I checked the running time to make sure it wasn't affected, and it seems to run as quickly as it did before the modifications.",
    "created_at": "2015-03-25T20:30:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237027",
    "user": "https://github.com/bgillesp"
}
```

The tree traversal code in the iterator class needed some clean-up to make it more clear what was supposed to be happening where, so I did that in the above commit.  I checked the running time to make sure it wasn't affected, and it seems to run as quickly as it did before the modifications.



---

archive/issue_comments_237028.json:
```json
{
    "body": "Hello !\n\nI just finished reading the iterator part of that patch, and it looks solid.\n\nJust a couple of details:\n\n- Shouldn't `i in ZZ` appear before the others in the following line ?\n\n  `return lambda i: l[i] if (i >= 0 and i < len(l) and i in ZZ) else default`\n\n- The documentation reads that `n` can be an iterable, but the code of\n  `__contains__` does not agree.\n\nWhat features would be needed in this new version of `integer_list` to get rid of the `_old` one? We would be better without it.\n\nNathann",
    "created_at": "2015-03-25T20:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237028",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

I just finished reading the iterator part of that patch, and it looks solid.

Just a couple of details:

- Shouldn't `i in ZZ` appear before the others in the following line ?

  `return lambda i: l[i] if (i >= 0 and i < len(l) and i in ZZ) else default`

- The documentation reads that `n` can be an iterable, but the code of
  `__contains__` does not agree.

What features would be needed in this new version of `integer_list` to get rid of the `_old` one? We would be better without it.

Nathann



---

archive/issue_comments_237029.json:
```json
{
    "body": "Replying to [comment:117 ncohen]:\n> What features would be needed in this new version of `integer_list` to get rid of the `_old` one? We would be better without it.\n\nLet's first fix `IntegerLists`(`Lex`), we can remove `integer_list_old.py` later.",
    "created_at": "2015-03-25T22:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237029",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:117 ncohen]:
> What features would be needed in this new version of `integer_list` to get rid of the `_old` one? We would be better without it.

Let's first fix `IntegerLists`(`Lex`), we can remove `integer_list_old.py` later.



---

archive/issue_comments_237030.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T06:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237031.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T06:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237031",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237032.json:
```json
{
    "body": "> Let's first fix `IntegerLists`(`Lex`), we can remove `integer_list_old.py` later.\n\nYes probably. There is a stogap in there, and nobody knows that this file exists, so it is not too dangerous. I was just wondering what the new code couldn't do that the old one handled.\n\nNathann",
    "created_at": "2015-03-26T06:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237032",
    "user": "https://github.com/nathanncohen"
}
```

> Let's first fix `IntegerLists`(`Lex`), we can remove `integer_list_old.py` later.

Yes probably. There is a stogap in there, and nobody knows that this file exists, so it is not too dangerous. I was just wondering what the new code couldn't do that the old one handled.

Nathann



---

archive/issue_comments_237033.json:
```json
{
    "body": "Replying to [comment:110 jdemeyer]:\n> Replying to [comment:95 nthiery]:\n> > In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`. \n> \n> Looking at the diff, I see *lots* of changes to `integer_vector.py`.\n\nOh, right, I forgot that I had used the occasion to get rid of quite some code in `IntegerVectors` by using inheritance. Nevertheless, the main point remains: the API of `IntegerVectors` hasn't changed; only its relation to `IntegerListsLex`.",
    "created_at": "2015-03-26T06:44:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237033",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:110 jdemeyer]:
> Replying to [comment:95 nthiery]:
> > In any case, this ticket is not really touching this class except for its interface to `IntegerListsLex`. 
> 
> Looking at the diff, I see *lots* of changes to `integer_vector.py`.

Oh, right, I forgot that I had used the occasion to get rid of quite some code in `IntegerVectors` by using inheritance. Nevertheless, the main point remains: the API of `IntegerVectors` hasn't changed; only its relation to `IntegerListsLex`.



---

archive/issue_comments_237034.json:
```json
{
    "body": "Replying to [comment:114 jdemeyer]:\n> Replying to [comment:106 nthiery]:\n> > - Should the error message be created upon creating the parent, or\n> >   when starting the iteration? The advantage of doing it only upon\n> >   iteration is that we can still use the parent for checking\n> >   containment, constructing the polytope, ...\n> During iteration, mainly because I think that expensive checks should not be done during `__init__`.\n\nSounds good.",
    "created_at": "2015-03-26T06:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237034",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:114 jdemeyer]:
> Replying to [comment:106 nthiery]:
> > - Should the error message be created upon creating the parent, or
> >   when starting the iteration? The advantage of doing it only upon
> >   iteration is that we can still use the parent for checking
> >   containment, constructing the polytope, ...
> During iteration, mainly because I think that expensive checks should not be done during `__init__`.

Sounds good.



---

archive/issue_comments_237035.json:
```json
{
    "body": "Replying to [comment:122 nthiery]:\n> Oh, right, I forgot that I had used the occasion to get rid of quite some code in `IntegerVectors` by using inheritance. Nevertheless, the main point remains: the API of `IntegerVectors` hasn't changed; only its relation to `IntegerListsLex`.\nPerhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.",
    "created_at": "2015-03-26T06:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237035",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:122 nthiery]:
> Oh, right, I forgot that I had used the occasion to get rid of quite some code in `IntegerVectors` by using inheritance. Nevertheless, the main point remains: the API of `IntegerVectors` hasn't changed; only its relation to `IntegerListsLex`.
Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.



---

archive/issue_comments_237036.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T06:49:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237037.json:
```json
{
    "body": "> I was just wondering what the new code couldn't do that the old one handled.\n\nBasicaclly just the `next` and `prev` features. There is a single spot using `next` in the Sage library (in `Compositions` IIRC), and I doubt they are much used elsewhere.\n\n`next` should be rather straightforward to implement if someone needs it. I created #18058 for this.",
    "created_at": "2015-03-26T06:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237037",
    "user": "https://github.com/nthiery"
}
```

> I was just wondering what the new code couldn't do that the old one handled.

Basicaclly just the `next` and `prev` features. There is a single spot using `next` in the Sage library (in `Compositions` IIRC), and I doubt they are much used elsewhere.

`next` should be rather straightforward to implement if someone needs it. I created #18058 for this.



---

archive/issue_comments_237038.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T06:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237038",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237039.json:
```json
{
    "body": "Replying to [comment:117 ncohen]:\n> I just finished reading the iterator part of that patch, and it looks solid.\n\nCool :-) Thanks for checking!\n\n> Just a couple of details:\n> \n> - Shouldn't `i in ZZ` appear before the others in the following line ?\n> \n>   `return lambda i: l[i] if (i >= 0 and i < len(l) and i in ZZ) else default`\n\nGiven that this is a critical section and an internal function, I just changed this to assume that i is a non negative integer, and only check on i < len(l). Does this sound ok?\n\n> - The documentation reads that `n` can be an iterable, but the code of\n>   `__contains__` does not agree.\n\nThis is because `IntegerListsLex(n, ...)` returns a `DisjointEnumeratedSets` of `IntegerListsLex`'s if `n` is an iterable. This way all the rest of the code can just ignore the existence of this feature.\n\nThe downside is that `__contains__` is slower (it will run through the different `IntegerListsLex`, and check `__contains__` there). Especially if the iterable is infinite. But that's not an important feature, so that's ok I believe.",
    "created_at": "2015-03-26T07:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237039",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:117 ncohen]:
> I just finished reading the iterator part of that patch, and it looks solid.

Cool :-) Thanks for checking!

> Just a couple of details:
> 
> - Shouldn't `i in ZZ` appear before the others in the following line ?
> 
>   `return lambda i: l[i] if (i >= 0 and i < len(l) and i in ZZ) else default`

Given that this is a critical section and an internal function, I just changed this to assume that i is a non negative integer, and only check on i < len(l). Does this sound ok?

> - The documentation reads that `n` can be an iterable, but the code of
>   `__contains__` does not agree.

This is because `IntegerListsLex(n, ...)` returns a `DisjointEnumeratedSets` of `IntegerListsLex`'s if `n` is an iterable. This way all the rest of the code can just ignore the existence of this feature.

The downside is that `__contains__` is slower (it will run through the different `IntegerListsLex`, and check `__contains__` there). Especially if the iterable is infinite. But that's not an important feature, so that's ok I believe.



---

archive/issue_comments_237040.json:
```json
{
    "body": "Replying to [comment:124 jdemeyer]:\n> Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.\n\nYeah, I see your point. If really needed, we could do that. But this means some non trivial work. It was quicker to first cleanup the interface between `IntegerVectors` and `IntegerListsLex` before adapting it to the new `IntegerListsLex`.\n\nAh, I should mention that there probably will be a minor conflict with #17927. I can handle the merge in #17927 once this one is finalized.",
    "created_at": "2015-03-26T07:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237040",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:124 jdemeyer]:
> Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.

Yeah, I see your point. If really needed, we could do that. But this means some non trivial work. It was quicker to first cleanup the interface between `IntegerVectors` and `IntegerListsLex` before adapting it to the new `IntegerListsLex`.

Ah, I should mention that there probably will be a minor conflict with #17927. I can handle the merge in #17927 once this one is finalized.



---

archive/issue_comments_237041.json:
```json
{
    "body": "Replying to [comment:109 jdemeyer]:\n> {{{\n> OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:370: WARNING: Literal block expected; none found.\n> }}}\n\nFixed.",
    "created_at": "2015-03-26T07:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237041",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:109 jdemeyer]:
> {{{
> OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:370: WARNING: Literal block expected; none found.
> }}}

Fixed.



---

archive/issue_comments_237042.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T07:37:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237042",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237043.json:
```json
{
    "body": "Replying to [comment:39 jdemeyer]:\n> There is still this bug:\n> {{{\n> sage: it = iter(IntegerListsLex(4))\n> sage: for _ in range(20): print next(it)\n> [4]\n> [3, 1]\n> [3, 0, 1]\n> [3, 0, 0, 1]\n> [3, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]\n> }}}\n> It seems that `[1,3]` will never appear in the output!\n\nWith the last commit this should be fixed!",
    "created_at": "2015-03-26T07:38:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237043",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:39 jdemeyer]:
> There is still this bug:
> {{{
> sage: it = iter(IntegerListsLex(4))
> sage: for _ in range(20): print next(it)
> [4]
> [3, 1]
> [3, 0, 1]
> [3, 0, 0, 1]
> [3, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> [3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1]
> }}}
> It seems that `[1,3]` will never appear in the output!

With the last commit this should be fixed!



---

archive/issue_comments_237044.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T07:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237044",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237045.json:
```json
{
    "body": "Hello !\n\nI still get an error upon \"make doc-clean && make doc-html\"\n\n\n```\nOSError: [combinat ] /home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:338: \nWARNING: undefined label: _section-generic-integerlistlex (if the link has no caption the label must precede a section header)\n```\n\n\nNathann",
    "created_at": "2015-03-26T08:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237045",
    "user": "https://github.com/nathanncohen"
}
```

Hello !

I still get an error upon "make doc-clean && make doc-html"


```
OSError: [combinat ] /home/ncohen/.Sage/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:338: 
WARNING: undefined label: _section-generic-integerlistlex (if the link has no caption the label must precede a section header)
```


Nathann



---

archive/issue_comments_237046.json:
```json
{
    "body": "Replace\n\n```\nraise ValueError(\"The specified parameters do not allow for a lexicographic iterator!\")\n```\n\nby\n\n```\nraise RuntimeError(\"the specified parameters do not allow for a lexicographic iterator\")\n```\n",
    "created_at": "2015-03-26T09:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237046",
    "user": "https://github.com/jdemeyer"
}
```

Replace

```
raise ValueError("The specified parameters do not allow for a lexicographic iterator!")
```

by

```
raise RuntimeError("the specified parameters do not allow for a lexicographic iterator")
```




---

archive/issue_comments_237047.json:
```json
{
    "body": "Replying to [comment:129 nthiery]:\n> Replying to [comment:124 jdemeyer]:\n> > Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.\n> \n> Yeah, I see your point. If really needed, we could do that. But this means some non trivial work.\n\nIt think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`. You will also avoid the conflict with #17927 this way.",
    "created_at": "2015-03-26T09:30:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237047",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:129 nthiery]:
> Replying to [comment:124 jdemeyer]:
> > Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.
> 
> Yeah, I see your point. If really needed, we could do that. But this means some non trivial work.

It think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`. You will also avoid the conflict with #17927 this way.



---

archive/issue_comments_237048.json:
```json
{
    "body": "This hangs (please add this as doctest when you fix it):\n\n```\nsage: L = IntegerListsLex(ceiling=[0], min_slope=1, max_slope=1)\nsage: it = iter(L)\nsage: for _ in range(10):\n....:     print next(it)\n```\n",
    "created_at": "2015-03-26T10:03:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237048",
    "user": "https://github.com/jdemeyer"
}
```

This hangs (please add this as doctest when you fix it):

```
sage: L = IntegerListsLex(ceiling=[0], min_slope=1, max_slope=1)
sage: it = iter(L)
sage: for _ in range(10):
....:     print next(it)
```




---

archive/issue_comments_237049.json:
```json
{
    "body": "This should be added as a different example which cannot be iterated in lexicographic order:\n\n```\nsage: L = IntegerListsLex(ceiling=[0], min_slope=1, max_slope=2)\n```\n",
    "created_at": "2015-03-26T10:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237049",
    "user": "https://github.com/jdemeyer"
}
```

This should be added as a different example which cannot be iterated in lexicographic order:

```
sage: L = IntegerListsLex(ceiling=[0], min_slope=1, max_slope=2)
```




---

archive/issue_comments_237050.json:
```json
{
    "body": "Please add also this example:\n\n```\nsage: sage: L = IntegerListsLex(ceiling=[1], min_slope=1, max_slope=1)\nsage: it = iter(L)                                             \nsage: for _ in range(10):                                             \n....:     print next(it)\n```\n",
    "created_at": "2015-03-26T10:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237050",
    "user": "https://github.com/jdemeyer"
}
```

Please add also this example:

```
sage: sage: L = IntegerListsLex(ceiling=[1], min_slope=1, max_slope=1)
sage: it = iter(L)                                             
sage: for _ in range(10):                                             
....:     print next(it)
```




---

archive/issue_comments_237051.json:
```json
{
    "body": "Concerning terminology: is \"lexicographic order\" really the standard way of refering to this ordering? I would call it \"reverse lexicographic\" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).\n\nHowever, I do think this \"lexicographic order\" needs to be documented somewhere, especially with the behaviour of implicit trailing zeros. Add this example, because it might look counter-intuitive that the `[1]` appears in the middle here:\n\n```\nsage: list(IntegerListsLex(max_length=4, max_part=1))\n[[1, 1, 1, 1],\n [1, 1, 1],\n [1, 1, 0, 1],\n [1, 1],\n [1, 0, 1, 1],\n [1, 0, 1],\n [1, 0, 0, 1],\n [1],\n [0, 1, 1, 1],\n [0, 1, 1],\n [0, 1, 0, 1],\n [0, 1],\n [0, 0, 1, 1],\n [0, 0, 1],\n [0, 0, 0, 1],\n []]\n```\n",
    "created_at": "2015-03-26T10:30:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237051",
    "user": "https://github.com/jdemeyer"
}
```

Concerning terminology: is "lexicographic order" really the standard way of refering to this ordering? I would call it "reverse lexicographic" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).

However, I do think this "lexicographic order" needs to be documented somewhere, especially with the behaviour of implicit trailing zeros. Add this example, because it might look counter-intuitive that the `[1]` appears in the middle here:

```
sage: list(IntegerListsLex(max_length=4, max_part=1))
[[1, 1, 1, 1],
 [1, 1, 1],
 [1, 1, 0, 1],
 [1, 1],
 [1, 0, 1, 1],
 [1, 0, 1],
 [1, 0, 0, 1],
 [1],
 [0, 1, 1, 1],
 [0, 1, 1],
 [0, 1, 0, 1],
 [0, 1],
 [0, 0, 1, 1],
 [0, 0, 1],
 [0, 0, 0, 1],
 []]
```




---

archive/issue_comments_237052.json:
```json
{
    "body": "Replying to [comment:137 jdemeyer]:\n> Replying to [comment:129 nthiery]:\n> > Replying to [comment:124 jdemeyer]:\n> > > Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.\n> > \n> > Yeah, I see your point. If really needed, we could do that. But this means some non trivial work.\n> \n> It think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`. You will also avoid the conflict with #17927 this way.\nNote that `IntegerVectors` is used in other classes, such as `Partitions`, so if we wanted to leave it referencing `integer_list_old.py`, then we would probably also want to port the uses of `IntegerVectors` to `IntegerListsLex` wherever that occurs in the library.  `IntegerVectors` also uses some auxiliary input formats such as `inner=[...]` and `outer=[...]`, so we would need to support those in `IntegerListsLex` if we wanted to use this approach.  Feels a little like a separate ticket to me, but it certainly could be done.",
    "created_at": "2015-03-26T14:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237052",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:137 jdemeyer]:
> Replying to [comment:129 nthiery]:
> > Replying to [comment:124 jdemeyer]:
> > > Perhaps such changes would better be done in a different ticket, it can only increase the changes of *this* ticket getting merged.
> > 
> > Yeah, I see your point. If really needed, we could do that. But this means some non trivial work.
> 
> It think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`. You will also avoid the conflict with #17927 this way.
Note that `IntegerVectors` is used in other classes, such as `Partitions`, so if we wanted to leave it referencing `integer_list_old.py`, then we would probably also want to port the uses of `IntegerVectors` to `IntegerListsLex` wherever that occurs in the library.  `IntegerVectors` also uses some auxiliary input formats such as `inner=[...]` and `outer=[...]`, so we would need to support those in `IntegerListsLex` if we wanted to use this approach.  Feels a little like a separate ticket to me, but it certainly could be done.



---

archive/issue_comments_237053.json:
```json
{
    "body": "Replying to [comment:142 bgillespie]:\n> Note that `IntegerVectors` is used in other classes, such as `Partitions`, so if we wanted to leave it referencing `integer_list_old.py`, then we would probably also want to port the uses of `IntegerVectors` to `IntegerListsLex` wherever that occurs in the library.  `IntegerVectors` also uses some auxiliary input formats such as `inner=[...]` and `outer=[...]`, so we would need to support those in `IntegerListsLex` if we wanted to use this approach.  Feels a little like a separate ticket to me, but it certainly could be done.\n\nI don't quite understand your comment, but my proposal is: on this ticket, fix *only* `IntegerListsLex` and leave the rest for follow-up tickets.",
    "created_at": "2015-03-26T16:19:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237053",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:142 bgillespie]:
> Note that `IntegerVectors` is used in other classes, such as `Partitions`, so if we wanted to leave it referencing `integer_list_old.py`, then we would probably also want to port the uses of `IntegerVectors` to `IntegerListsLex` wherever that occurs in the library.  `IntegerVectors` also uses some auxiliary input formats such as `inner=[...]` and `outer=[...]`, so we would need to support those in `IntegerListsLex` if we wanted to use this approach.  Feels a little like a separate ticket to me, but it certainly could be done.

I don't quite understand your comment, but my proposal is: on this ticket, fix *only* `IntegerListsLex` and leave the rest for follow-up tickets.



---

archive/issue_comments_237054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T17:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237055.json:
```json
{
    "body": "Replying to [comment:136 jdemeyer]:\n> Replace\n> {{{\n> raise ValueError(\"The specified parameters do not allow for a lexicographic iterator!\")\n> }}}\n> by\n> {{{\n> raise RuntimeError(\"the specified parameters do not allow for a lexicographic iterator\")\n> }}}\n\nFixed. Also changed lex order to reverse lex order!",
    "created_at": "2015-03-26T17:18:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237055",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:136 jdemeyer]:
> Replace
> {{{
> raise ValueError("The specified parameters do not allow for a lexicographic iterator!")
> }}}
> by
> {{{
> raise RuntimeError("the specified parameters do not allow for a lexicographic iterator")
> }}}

Fixed. Also changed lex order to reverse lex order!



---

archive/issue_comments_237056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T17:30:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237056",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T17:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237057",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237058.json:
```json
{
    "body": "Replying to [comment:140 jdemeyer]:\n> Please add also this example:\n> {{{\n> sage: sage: L = IntegerListsLex(ceiling=[1], min_slope=1, max_slope=1)\n> sage: it = iter(L)                                             \n> sage: for _ in range(10):                                             \n> ....:     print next(it)\n> }}}\n\nFixed. The _check_lexicographic_iterable now also catches that this is not enumeratable under reverse lex order. I added the two tests that you mentioned.",
    "created_at": "2015-03-26T17:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237058",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:140 jdemeyer]:
> Please add also this example:
> {{{
> sage: sage: L = IntegerListsLex(ceiling=[1], min_slope=1, max_slope=1)
> sage: it = iter(L)                                             
> sage: for _ in range(10):                                             
> ....:     print next(it)
> }}}

Fixed. The _check_lexicographic_iterable now also catches that this is not enumeratable under reverse lex order. I added the two tests that you mentioned.



---

archive/issue_comments_237059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T17:48:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237060.json:
```json
{
    "body": "What do you think of that ?\n\n```\nsage: [2,2,0] in IntegerListsLex(4,min_length=3,max_length=4) # appears in .list()\nTrue\nsage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()\nTrue\nsage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()\nFalse\n```\n\n\nNathann",
    "created_at": "2015-03-26T18:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237060",
    "user": "https://github.com/nathanncohen"
}
```

What do you think of that ?

```
sage: [2,2,0] in IntegerListsLex(4,min_length=3,max_length=4) # appears in .list()
True
sage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()
True
sage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()
False
```


Nathann



---

archive/issue_comments_237061.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-26T18:01:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237061",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237062.json:
```json
{
    "body": "Replying to [comment:141 jdemeyer]:\n> Concerning terminology: is \"lexicographic order\" really the standard way of refering to this ordering? I would call it \"reverse lexicographic\" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).\n> \n> However, I do think this \"lexicographic order\" needs to be documented somewhere, especially with the behaviour of implicit trailing zeros. Add this example, because it might look counter-intuitive that the `[1]` appears in the middle here:\n> {{{\n> sage: list(IntegerListsLex(max_length=4, max_part=1))\n> [[1, 1, 1, 1],\n>  [1, 1, 1],\n>  [1, 1, 0, 1],\n>  [1, 1],\n>  [1, 0, 1, 1],\n>  [1, 0, 1],\n>  [1, 0, 0, 1],\n>  [1],\n>  [0, 1, 1, 1],\n>  [0, 1, 1],\n>  [0, 1, 0, 1],\n>  [0, 1],\n>  [0, 0, 1, 1],\n>  [0, 0, 1],\n>  [0, 0, 0, 1],\n>  []]\n> }}}\n\nAdded. The doc compilation issues should also be fixed now!",
    "created_at": "2015-03-26T18:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237062",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:141 jdemeyer]:
> Concerning terminology: is "lexicographic order" really the standard way of refering to this ordering? I would call it "reverse lexicographic" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).
> 
> However, I do think this "lexicographic order" needs to be documented somewhere, especially with the behaviour of implicit trailing zeros. Add this example, because it might look counter-intuitive that the `[1]` appears in the middle here:
> {{{
> sage: list(IntegerListsLex(max_length=4, max_part=1))
> [[1, 1, 1, 1],
>  [1, 1, 1],
>  [1, 1, 0, 1],
>  [1, 1],
>  [1, 0, 1, 1],
>  [1, 0, 1],
>  [1, 0, 0, 1],
>  [1],
>  [0, 1, 1, 1],
>  [0, 1, 1],
>  [0, 1, 0, 1],
>  [0, 1],
>  [0, 0, 1, 1],
>  [0, 0, 1],
>  [0, 0, 0, 1],
>  []]
> }}}

Added. The doc compilation issues should also be fixed now!



---

archive/issue_comments_237063.json:
```json
{
    "body": "Replying to [comment:150 ncohen]:\n> What do you think of that ?\n> {{{\n> sage: [2,2,0] in IntegerListsLex(4,min_length=3,max_length=4) # appears in .list()\n> True\n> sage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()\n> True\n> sage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()\n> False\n> }}}\n\nThe reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).",
    "created_at": "2015-03-26T18:16:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237063",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:150 ncohen]:
> What do you think of that ?
> {{{
> sage: [2,2,0] in IntegerListsLex(4,min_length=3,max_length=4) # appears in .list()
> True
> sage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()
> True
> sage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4) # does not appear in .list()
> False
> }}}

The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).



---

archive/issue_comments_237064.json:
```json
{
    "body": "Replying to [comment:45 jdemeyer]:\n> Replying to [comment:8 nthiery]:\n> > And we will reuse everything we can from your work!\n> \n> The following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:\n> {{{\n> sage: IntegerListsLex(499499, length=1000, min_slope=1).list()\n> }}}\n\nThis example and \n\n```\n    sage: IntegerListsLex(10^100, max_length=1).list()\n```\n\nwill be optimized in #18055.",
    "created_at": "2015-03-26T18:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237064",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:45 jdemeyer]:
> Replying to [comment:8 nthiery]:
> > And we will reuse everything we can from your work!
> 
> The following takes forever, which is a problem that I *solved* in #17920, so I'm slightly disappointed this doesn't really work:
> {{{
> sage: IntegerListsLex(499499, length=1000, min_slope=1).list()
> }}}

This example and 

```
    sage: IntegerListsLex(10^100, max_length=1).list()
```

will be optimized in #18055.



---

archive/issue_comments_237065.json:
```json
{
    "body": "> The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).\n\nSoooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents \"all lists beginning by `2,2,0` whose length is included between 3 and 4\"? This information is not included in the object itself, it is to be understood by how it was first produced.\n\nThis identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.\n\nNathann",
    "created_at": "2015-03-26T18:26:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237065",
    "user": "https://github.com/nathanncohen"
}
```

> The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).

Soooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents "all lists beginning by `2,2,0` whose length is included between 3 and 4"? This information is not included in the object itself, it is to be understood by how it was first produced.

This identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.

Nathann



---

archive/issue_comments_237066.json:
```json
{
    "body": "Replying to [comment:153 aschilling]:\n> The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length.\nThe \"up to `max_length`\" part is a bit arbitrary. I would prefer that these should give the same answer (either both `True` or both `False`):\n\n```\nsage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4)\nsage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4)\n```\n",
    "created_at": "2015-03-26T18:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237066",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:153 aschilling]:
> The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length.
The "up to `max_length`" part is a bit arbitrary. I would prefer that these should give the same answer (either both `True` or both `False`):

```
sage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4)
sage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4)
```




---

archive/issue_comments_237067.json:
```json
{
    "body": "Replying to [comment:155 ncohen]:\n> This identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.\n\nIt's pretty natural to follow this equivalence (think for instance monomials `x*y^2` and `x*y<sup>2*z</sup>0`), but I definitely see your point.  Would it be useful to specify a more feature-ful class `IntegerList` (returned by this class) which takes into account these equivalences and provides comparison operations for lexicographic ordering?  This would help to make more clear the assumptions being made on the lists during iteration, and would result in both `IntegerList([2,2,0,0])` and `IntegerList([2,2,0,0,0])` being contained in `IntegerListsLex(4,min_length=3,max_length=4)` in the example above, since they are the same object, and at least one representative satisfies the desired criterion.",
    "created_at": "2015-03-26T18:58:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237067",
    "user": "https://github.com/bgillesp"
}
```

Replying to [comment:155 ncohen]:
> This identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.

It's pretty natural to follow this equivalence (think for instance monomials `x*y^2` and `x*y<sup>2*z</sup>0`), but I definitely see your point.  Would it be useful to specify a more feature-ful class `IntegerList` (returned by this class) which takes into account these equivalences and provides comparison operations for lexicographic ordering?  This would help to make more clear the assumptions being made on the lists during iteration, and would result in both `IntegerList([2,2,0,0])` and `IntegerList([2,2,0,0,0])` being contained in `IntegerListsLex(4,min_length=3,max_length=4)` in the example above, since they are the same object, and at least one representative satisfies the desired criterion.



---

archive/issue_comments_237068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T06:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237068",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237069.json:
```json
{
    "body": "Replying to [comment:155 ncohen]:\n> > The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).\n> \n> Soooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents \"all lists beginning by `2,2,0` whose length is included between 3 and 4\"? This information is not included in the object itself, it is to be understood by how it was first produced.\n\nThe parent knows about the min_length and max_length, so it makes sense to identify objects with trailing zeroes in the correct parameter range. In any case, this is the same behavior as in the old version of the code and I do not think we should change this here.\n\n> This identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.\n\nNathann, this is a different issue! The above issue is just about identifying objects, not about not listing all of them. The issue about not listing all of them is due to the fact that inverse lexicographic order intrinsically (by definition) does not list them all.\n\nAnne\n----\nNew commits:",
    "created_at": "2015-03-27T06:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237069",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:155 ncohen]:
> > The reason for this behavior is the following: we identify elements which differ by trailing zeroes up to max_length. That is why the first and second example gives True and the last one gives False (since in this case we are beyond the max_length).
> 
> Soooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents "all lists beginning by `2,2,0` whose length is included between 3 and 4"? This information is not included in the object itself, it is to be understood by how it was first produced.

The parent knows about the min_length and max_length, so it makes sense to identify objects with trailing zeroes in the correct parameter range. In any case, this is the same behavior as in the old version of the code and I do not think we should change this here.

> This identification of list worries me a bit. The exception in `__iter__` was added because we consider it a bug that some element of the set may never be listed in `__iter__`, and this is exactly the problem we have again here. For a different reason, i.e. because some lists are identified.

Nathann, this is a different issue! The above issue is just about identifying objects, not about not listing all of them. The issue about not listing all of them is due to the fact that inverse lexicographic order intrinsically (by definition) does not list them all.

Anne
----
New commits:



---

archive/issue_comments_237070.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T06:19:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237071.json:
```json
{
    "body": "Replying to [comment:136 jdemeyer]:\n> Replace\n> {{{\n> raise ValueError(\"The specified parameters do not allow for a lexicographic iterator!\")\n> }}}\n> by\n> {{{\n> raise RuntimeError(\"the specified parameters do not allow for a lexicographic iterator\")\n> }}}\n\nReally? `RuntimeError` is \"for an error that doesn\u2019t fall in any of the\nother categories\", where as we do fit within the `ValueError` category:\n\"when a built-in operation or function receives an argument that has\nthe right type but an inappropriate value\". Here `IntegerListsLex` did\nreceive inappropriate value which makes the lexicographic enumeration\nimproper.\n\nNicolas",
    "created_at": "2015-03-27T06:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237071",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:136 jdemeyer]:
> Replace
> {{{
> raise ValueError("The specified parameters do not allow for a lexicographic iterator!")
> }}}
> by
> {{{
> raise RuntimeError("the specified parameters do not allow for a lexicographic iterator")
> }}}

Really? `RuntimeError` is "for an error that doesn’t fall in any of the
other categories", where as we do fit within the `ValueError` category:
"when a built-in operation or function receives an argument that has
the right type but an inappropriate value". Here `IntegerListsLex` did
receive inappropriate value which makes the lexicographic enumeration
improper.

Nicolas



---

archive/issue_comments_237072.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T06:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237072",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237073.json:
```json
{
    "body": "Replying to [comment:33 jdemeyer]:\n> The heading should be formatted like [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) (in particular, it's bad to mention the GPL without version number).\n\nYup: I made GPL into GPLv2+ and added a short history. However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file. As far as I can remember, this was already discussed on sage-devel and considered ok.\n\nIn fact, I would vote for updating accordingly the dev manual, but that's another discussion.\n----\nNew commits:",
    "created_at": "2015-03-27T06:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237073",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:33 jdemeyer]:
> The heading should be formatted like [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files) (in particular, it's bad to mention the GPL without version number).

Yup: I made GPL into GPLv2+ and added a short history. However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file. As far as I can remember, this was already discussed on sage-devel and considered ok.

In fact, I would vote for updating accordingly the dev manual, but that's another discussion.
----
New commits:



---

archive/issue_comments_237074.json:
```json
{
    "body": "Replying to [comment:137 jdemeyer]:\n> It think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`.\n\nThanks for the suggestion, but no :-) I haven't spent so much time on\nthis to still have some non trivial usage of `integer_list_old.py`\nlying around. If I don't find someone to review this very soon, I'll\nreconsider.",
    "created_at": "2015-03-27T06:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237074",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:137 jdemeyer]:
> It think it is quite trivial to split it up, just make `IntegerVectors` use `integer_list_old.py`.

Thanks for the suggestion, but no :-) I haven't spent so much time on
this to still have some non trivial usage of `integer_list_old.py`
lying around. If I don't find someone to review this very soon, I'll
reconsider.



---

archive/issue_comments_237075.json:
```json
{
    "body": "Replying to [comment:155 ncohen]:\n> Soooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents \"all lists beginning by `2,2,0` whose length is included between 3 and 4\"? This information is not included in the object itself, it is to be understood by how it was first produced.\n> \n> This identification of list worries me a bit.\n\nI agree: 15 years ago, from the use cases I had under hand, I though\nthat this was a neat feature to identify lists up to trailing\nzeroes. However this is non trivial to specify properly, and I am now\nconvinced that this is just a can of worms. We should seriously\nconsider dropping this feature.\n\nHowever I believe that this is out of the scope of this ticket,\nespecially since this would require a change in the specifications,\nand cause backward incompatibilities. Up to the fuzziness in this\npiece of the specification, it sounds like the code should by now be\ncorrect w.r.t. the current specifications; let's get it done.\n\nCheers,\n                            Nicolas",
    "created_at": "2015-03-27T07:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237075",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:155 ncohen]:
> Soooooooooo when you get the list `[2,2,0]` in the output of `.list()`, it represents "all lists beginning by `2,2,0` whose length is included between 3 and 4"? This information is not included in the object itself, it is to be understood by how it was first produced.
> 
> This identification of list worries me a bit.

I agree: 15 years ago, from the use cases I had under hand, I though
that this was a neat feature to identify lists up to trailing
zeroes. However this is non trivial to specify properly, and I am now
convinced that this is just a can of worms. We should seriously
consider dropping this feature.

However I believe that this is out of the scope of this ticket,
especially since this would require a change in the specifications,
and cause backward incompatibilities. Up to the fuzziness in this
piece of the specification, it sounds like the code should by now be
correct w.r.t. the current specifications; let's get it done.

Cheers,
                            Nicolas



---

archive/issue_comments_237076.json:
```json
{
    "body": "Replying to [comment:165 nthiery]:\n> However I believe that this is out of the scope of this ticket,\n> especially since this would require a change in the specifications\nWhere was it specified that lists with trailing zeros are identified **up to max_length**? It makes absolutely no sense at all that these two questions give a different answer:\n\n```\nsage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4)\nsage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4)\n```\n",
    "created_at": "2015-03-27T07:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237076",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:165 nthiery]:
> However I believe that this is out of the scope of this ticket,
> especially since this would require a change in the specifications
Where was it specified that lists with trailing zeros are identified **up to max_length**? It makes absolutely no sense at all that these two questions give a different answer:

```
sage: [2,2,0,0] in IntegerListsLex(4,min_length=3,max_length=4)
sage: [2,2,0,0,0] in IntegerListsLex(4,min_length=3,max_length=4)
```




---

archive/issue_comments_237077.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T07:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237077",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237078.json:
```json
{
    "body": "For the record: I added a warning and Nathann's example in the doc about this.\n----\nNew commits:",
    "created_at": "2015-03-27T07:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237078",
    "user": "https://github.com/nthiery"
}
```

For the record: I added a warning and Nathann's example in the doc about this.
----
New commits:



---

archive/issue_comments_237079.json:
```json
{
    "body": "Replying to [comment:161 nthiery]:\n> Replying to [comment:136 jdemeyer]:\n> > Replace\n> > {{{\n> > raise ValueError(\"The specified parameters do not allow for a lexicographic iterator!\")\n> > }}}\n> > by\n> > {{{\n> > raise RuntimeError(\"the specified parameters do not allow for a lexicographic iterator\")\n> > }}}\n> \n> Really? `RuntimeError` is \"for an error that doesn\u2019t fall in any of the\n> other categories\", where as we do fit within the `ValueError` category:\n> \"when a built-in operation or function receives an argument that has\n> the right type but an inappropriate value\". Here `IntegerListsLex` did\n> receive inappropriate value which makes the lexicographic enumeration\n> improper.\n\nFine, I don't care so much (but there is also the formatting issue of not using a capital letter and exclamation mark). I felt that `RuntimeError` was more appropriate because it is not really a specific value which is bad, but some computation based on the input values from which it can be concluded that the input is bad.",
    "created_at": "2015-03-27T07:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237079",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:161 nthiery]:
> Replying to [comment:136 jdemeyer]:
> > Replace
> > {{{
> > raise ValueError("The specified parameters do not allow for a lexicographic iterator!")
> > }}}
> > by
> > {{{
> > raise RuntimeError("the specified parameters do not allow for a lexicographic iterator")
> > }}}
> 
> Really? `RuntimeError` is "for an error that doesn’t fall in any of the
> other categories", where as we do fit within the `ValueError` category:
> "when a built-in operation or function receives an argument that has
> the right type but an inappropriate value". Here `IntegerListsLex` did
> receive inappropriate value which makes the lexicographic enumeration
> improper.

Fine, I don't care so much (but there is also the formatting issue of not using a capital letter and exclamation mark). I felt that `RuntimeError` was more appropriate because it is not really a specific value which is bad, but some computation based on the input values from which it can be concluded that the input is bad.



---

archive/issue_comments_237080.json:
```json
{
    "body": "Replying to [comment:163 nthiery]:\n> However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file.\n\nIf you feel like this, then first change [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files). Don't just change conventions on your own because you find it more convenient.\n\n> As far as I can remember, this was already discussed on sage-devel and considered ok.\nI'd like to see a link to that discussion.",
    "created_at": "2015-03-27T07:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237080",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:163 nthiery]:
> However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file.

If you feel like this, then first change [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files). Don't just change conventions on your own because you find it more convenient.

> As far as I can remember, this was already discussed on sage-devel and considered ok.
I'd like to see a link to that discussion.



---

archive/issue_comments_237081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T07:34:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237081",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237082.json:
```json
{
    "body": "Replying to [comment:169 jdemeyer]:\n> Fine, I don't care so much (but there is also the formatting issue of not using a capital letter and exclamation mark).\n\nformatting fixed.\n\n> I felt that `RuntimeError` was more appropriate because it is not really a specific value which is bad, but some computation based on the input values from which it can be concluded that the input is bad.\n\nI agree that it's borderline.\n----\nNew commits:",
    "created_at": "2015-03-27T07:35:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237082",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:169 jdemeyer]:
> Fine, I don't care so much (but there is also the formatting issue of not using a capital letter and exclamation mark).

formatting fixed.

> I felt that `RuntimeError` was more appropriate because it is not really a specific value which is bad, but some computation based on the input values from which it can be concluded that the input is bad.

I agree that it's borderline.
----
New commits:



---

archive/issue_comments_237083.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T07:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237083",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237084.json:
```json
{
    "body": "Replying to [comment:170 jdemeyer]:\n> Replying to [comment:163 nthiery]:\n> > However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file.\n> \n> If you feel like this, then first change [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files). Don't just change conventions on your own because you find it more convenient.\n\nWill do.\n\nFor now I don't want to waste time on this stupid issue, so voil\u00e0,\nformal header there is.\n\n----\nNew commits:",
    "created_at": "2015-03-27T07:39:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237084",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:170 jdemeyer]:
> Replying to [comment:163 nthiery]:
> > However I kept the short version of the header without the four lines of verbiage. It's really inconvenient to have a bunch of useless information at the top of a file when this is the very first thing that pops up when opening a file.
> 
> If you feel like this, then first change [http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files](http://www.sagemath.org/doc/developer/coding_basics.html#headings-of-sage-library-code-files). Don't just change conventions on your own because you find it more convenient.

Will do.

For now I don't want to waste time on this stupid issue, so voilà,
formal header there is.

----
New commits:



---

archive/issue_comments_237085.json:
```json
{
    "body": "Replying to [comment:141 jdemeyer]:\n> Concerning terminology: is \"lexicographic order\" really the standard way of refering to this ordering? I would call it \"reverse lexicographic\" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).\n\nYup, we indeed wanted to be more specific about this. This is done\nnow. Note that we have used \"inverse lexicographic\" since \"reverse\nlexicographic\" usually means reading the words in reverse order.\n\nhttp://en.wikipedia.org/wiki/Lexicographical_order#Reverse_lexicographic_order",
    "created_at": "2015-03-27T07:42:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237085",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:141 jdemeyer]:
> Concerning terminology: is "lexicographic order" really the standard way of refering to this ordering? I would call it "reverse lexicographic" because it starts with the *largest* element first (but I'm not in combinatorics, so if this is standard, then it's fine).

Yup, we indeed wanted to be more specific about this. This is done
now. Note that we have used "inverse lexicographic" since "reverse
lexicographic" usually means reading the words in reverse order.

http://en.wikipedia.org/wiki/Lexicographical_order#Reverse_lexicographic_order



---

archive/issue_comments_237086.json:
```json
{
    "body": "Replying to [comment:41 jdemeyer]:\n> Some implementations might not use keyword arguments for `length`, so the `min_n` and `max_n` arguments (preferably renamed to `min_sum` and `max_sum`) should be moved towards the end of the argument list.\n\nI'd be rather surprised if this was used anywhere (it was not in the Sage sources), especially since the documentation never mentionned this possibility. And it's neat to have all arguments be grouped by theme. But ok, better be safe than sorry. Done.",
    "created_at": "2015-03-27T07:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237086",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:41 jdemeyer]:
> Some implementations might not use keyword arguments for `length`, so the `min_n` and `max_n` arguments (preferably renamed to `min_sum` and `max_sum`) should be moved towards the end of the argument list.

I'd be rather surprised if this was used anywhere (it was not in the Sage sources), especially since the documentation never mentionned this possibility. And it's neat to have all arguments be grouped by theme. But ok, better be safe than sorry. Done.



---

archive/issue_comments_237087.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-27T07:48:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237087",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237088.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-27T07:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237088",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237089.json:
```json
{
    "body": "Ok, I believe all the points that have been raised have been catered\nfor (but some may have slipped through in this long thread). So this\nis up for formal review.\n\nThanks for all the comments and suggestions!\n\nNote: please see the description where I left two points where\nfeedback is specifically welcome.\n----\nNew commits:",
    "created_at": "2015-03-27T07:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237089",
    "user": "https://github.com/nthiery"
}
```

Ok, I believe all the points that have been raised have been catered
for (but some may have slipped through in this long thread). So this
is up for formal review.

Thanks for all the comments and suggestions!

Note: please see the description where I left two points where
feedback is specifically welcome.
----
New commits:



---

archive/issue_comments_237090.json:
```json
{
    "body": "I agree with this comment:\n\n```\n.. TODO:: Maybe this should be ``check=False`` instead?\n```\n\n\nThe standard terminology for such an option is indeed `check=False` and `waiver` appears only in `integer_list.py`.",
    "created_at": "2015-03-27T09:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237090",
    "user": "https://github.com/jdemeyer"
}
```

I agree with this comment:

```
.. TODO:: Maybe this should be ``check=False`` instead?
```


The standard terminology for such an option is indeed `check=False` and `waiver` appears only in `integer_list.py`.



---

archive/issue_comments_237091.json:
```json
{
    "body": "Replying to [comment:178 nthiery]:\n> Ok, I believe all the points that have been raised have been catered\n> for (but some may have slipped through in this long thread). So this\n> is up for formal review.\n\nLet me remind everybody here that #17920 is *also* up for formal review.\n\nComparing both approaches (I am of course not completely unbiased, but I'll really try to be objective):\n\n* **Bugs**: neither #17979 nor #17920 have obvious bugs (although I find [comment:166] dubious at least), both fix #17548. I assume both pass doctests.\n\n* **Features**: #17979 tries to replicate the old behaviour as closely as possible, #17920 generalizes certain conditions (e.g. allowing negative numbers; allowing iteration in non-invlex order) but also adds a few restrictions (e.g. not allowing an iterable for `n`).\n\n* **Interface with rest of Sage**: #17920 only uses the new `IntegerLists` code for `IntegerListsLex`, `Partitions` and `Compositions` (in the other places in Sage where `IntegerListsLex` was used, I didn't find any bugs so I left those). This ticket #17979 replaces the old code in almost all cases (except partially in `IntegerVectors`).\n\n* **Speed**: for simple examples, #17979 is faster. Both implementations have cases where they behave pathologically: for #17979 this is for example `IntegerListsLex(10^10, length=2, min_slope=0, max_slope=0)`, while #17920 behaves badly if the length gets large.\n\n* **Extensibility**: because #17920 is based on polyhedra, it will be much easier to generalize the code (it already does some things more general than #17979). Also, if Sage ever gets better `Polyhedron` code, it will make #17920 faster for free.",
    "created_at": "2015-03-27T10:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237091",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:178 nthiery]:
> Ok, I believe all the points that have been raised have been catered
> for (but some may have slipped through in this long thread). So this
> is up for formal review.

Let me remind everybody here that #17920 is *also* up for formal review.

Comparing both approaches (I am of course not completely unbiased, but I'll really try to be objective):

* **Bugs**: neither #17979 nor #17920 have obvious bugs (although I find [comment:166] dubious at least), both fix #17548. I assume both pass doctests.

* **Features**: #17979 tries to replicate the old behaviour as closely as possible, #17920 generalizes certain conditions (e.g. allowing negative numbers; allowing iteration in non-invlex order) but also adds a few restrictions (e.g. not allowing an iterable for `n`).

* **Interface with rest of Sage**: #17920 only uses the new `IntegerLists` code for `IntegerListsLex`, `Partitions` and `Compositions` (in the other places in Sage where `IntegerListsLex` was used, I didn't find any bugs so I left those). This ticket #17979 replaces the old code in almost all cases (except partially in `IntegerVectors`).

* **Speed**: for simple examples, #17979 is faster. Both implementations have cases where they behave pathologically: for #17979 this is for example `IntegerListsLex(10^10, length=2, min_slope=0, max_slope=0)`, while #17920 behaves badly if the length gets large.

* **Extensibility**: because #17920 is based on polyhedra, it will be much easier to generalize the code (it already does some things more general than #17979). Also, if Sage ever gets better `Polyhedron` code, it will make #17920 faster for free.



---

archive/issue_comments_237092.json:
```json
{
    "body": "Replying to [comment:164 nthiery]:\n> Thanks for the suggestion, but no :-) I haven't spent so much time on\n> this to still have some non trivial usage of `integer_list_old.py`\n> lying around. If I don't find someone to review this very soon, I'll\n> reconsider.\n\nFor the record: I will *not review* the changes to `integer_vector.py` on this ticket. If somebody else wants to do that, that's fine for me.",
    "created_at": "2015-03-27T10:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237092",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:164 nthiery]:
> Thanks for the suggestion, but no :-) I haven't spent so much time on
> this to still have some non trivial usage of `integer_list_old.py`
> lying around. If I don't find someone to review this very soon, I'll
> reconsider.

For the record: I will *not review* the changes to `integer_vector.py` on this ticket. If somebody else wants to do that, that's fine for me.



---

archive/issue_comments_237093.json:
```json
{
    "body": "This is certainly false:\n\n```\n    The complexity of the algorithm has not been formally proven, but\n    the average runtime for producing each list `l` is suspected to be\n    bounded by a low-degree polynomial in ``lmax``, where ``lmax`` is\n    the length of the longest list. Similarly, the space complexity of\n    the algorithm is bounded by a low-degree polynomial in ``lmax``.\n```\n\n(in fact, this statement is probably more true of #17920 than it is for #17979)",
    "created_at": "2015-03-27T10:11:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237093",
    "user": "https://github.com/jdemeyer"
}
```

This is certainly false:

```
    The complexity of the algorithm has not been formally proven, but
    the average runtime for producing each list `l` is suspected to be
    bounded by a low-degree polynomial in ``lmax``, where ``lmax`` is
    the length of the longest list. Similarly, the space complexity of
    the algorithm is bounded by a low-degree polynomial in ``lmax``.
```

(in fact, this statement is probably more true of #17920 than it is for #17979)



---

archive/issue_comments_237094.json:
```json
{
    "body": "The code in `_IntegerListsLexIter` needs to be documented much more, it is hard to understand the code without documentation. Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).\n\nAlso: please use terminology consistently. I think the same thing is called \"part\", \"entry\" and \n\"value\" in different places.",
    "created_at": "2015-03-27T10:21:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237094",
    "user": "https://github.com/jdemeyer"
}
```

The code in `_IntegerListsLexIter` needs to be documented much more, it is hard to understand the code without documentation. Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).

Also: please use terminology consistently. I think the same thing is called "part", "entry" and 
"value" in different places.



---

archive/issue_comments_237095.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-27T10:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237095",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237096.json:
```json
{
    "body": "This should return the list containg 1 element `[]`:\n\n```\nsage: list(IntegerListsLex(ceiling=[0], max_slope=0))\n```\n",
    "created_at": "2015-03-27T10:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237096",
    "user": "https://github.com/jdemeyer"
}
```

This should return the list containg 1 element `[]`:

```
sage: list(IntegerListsLex(ceiling=[0], max_slope=0))
```




---

archive/issue_comments_237097.json:
```json
{
    "body": "> Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).\n\n+1 to that. This terminology made it much harder for me to understand what the code was doing. Instead of writing this in the code:\n\n\n```\nself.rho = []   # list of current search ranges\nself.mu = []    # list of integers\nself.j = -1     # index of last element of mu\nself.nu = 0     # sum of values in mu       \n```\n\n\nIt would probably be clearer to rename those variables (respectively) as\n\n```\nself._search_range\nself._current_list\nself._j\nself._current_sum\n```\n\n\nNathann\n\nP.S.: And indeed, as Jeroen says, it would be cool to be a bit more verbose about what these things do. Once you know how the code works I agree that 'current search range' is a rather good explanation, but until you do it is rather crytic. I have first-hand knowledge of that `^^;`",
    "created_at": "2015-03-27T10:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237097",
    "user": "https://github.com/nathanncohen"
}
```

> Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).

+1 to that. This terminology made it much harder for me to understand what the code was doing. Instead of writing this in the code:


```
self.rho = []   # list of current search ranges
self.mu = []    # list of integers
self.j = -1     # index of last element of mu
self.nu = 0     # sum of values in mu       
```


It would probably be clearer to rename those variables (respectively) as

```
self._search_range
self._current_list
self._j
self._current_sum
```


Nathann

P.S.: And indeed, as Jeroen says, it would be cool to be a bit more verbose about what these things do. Once you know how the code works I agree that 'current search range' is a rather good explanation, but until you do it is rather crytic. I have first-hand knowledge of that `^^;`



---

archive/issue_comments_237098.json:
```json
{
    "body": "I don't like this:\n\n```\n        .. WARNING::\n\n            The specifications of this feature are fuzzy, leading to\n            potentially surprising consequences (see the examples\n            below).  It is recommended not to rely on it, as it may\n            eventually be discontinued.\n```\n\n\nThe specifications are not fuzzy. They might be strange, unlogical, arbitrary, badly chosen but not fuzzy. To make it less fuzzy, you should document explicitly the fact that the equivalence only works up to `max_length` in the `NOTE` about this `WARNING`.\n\n(to compare: in #17920 I took the convention that `x in L` is equivalent to `x in L.list()`, so I don't really identify lists with trailing zeros, I just output the list with the least number of trailing zeros)",
    "created_at": "2015-03-27T10:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237098",
    "user": "https://github.com/jdemeyer"
}
```

I don't like this:

```
        .. WARNING::

            The specifications of this feature are fuzzy, leading to
            potentially surprising consequences (see the examples
            below).  It is recommended not to rely on it, as it may
            eventually be discontinued.
```


The specifications are not fuzzy. They might be strange, unlogical, arbitrary, badly chosen but not fuzzy. To make it less fuzzy, you should document explicitly the fact that the equivalence only works up to `max_length` in the `NOTE` about this `WARNING`.

(to compare: in #17920 I took the convention that `x in L` is equivalent to `x in L.list()`, so I don't really identify lists with trailing zeros, I just output the list with the least number of trailing zeros)



---

archive/issue_comments_237099.json:
```json
{
    "body": "I would also prefer to remove the text concerning algorithmic complexity in `src/sage/combinat/tutorial.py`. What I dislike most is that it seems to hide behind the \"degenerate cases\" exception without really specifying what that means.",
    "created_at": "2015-03-27T11:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237099",
    "user": "https://github.com/jdemeyer"
}
```

I would also prefer to remove the text concerning algorithmic complexity in `src/sage/combinat/tutorial.py`. What I dislike most is that it seems to hide behind the "degenerate cases" exception without really specifying what that means.



---

archive/issue_comments_237100.json:
```json
{
    "body": "This hangs:\n\n```\nsage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))\n```\n\n(it works fine without the `min_length` though)",
    "created_at": "2015-03-27T11:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237100",
    "user": "https://github.com/jdemeyer"
}
```

This hangs:

```
sage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))
```

(it works fine without the `min_length` though)



---

archive/issue_comments_237101.json:
```json
{
    "body": "> I don't like this:\n> {{{\n>         .. WARNING::\n> \n>             The specifications of this feature are fuzzy, leading to\n>             potentially surprising consequences (see the examples\n>             below).  It is recommended not to rely on it, as it may\n>             eventually be discontinued.\n> }}}\n\n+1 to that. I also fear that this warning may be used later as an authorization to not document behaviors and to overlook inconsistencies because it is, after all, 'documented'.\n\nNathann",
    "created_at": "2015-03-27T11:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237101",
    "user": "https://github.com/nathanncohen"
}
```

> I don't like this:
> {{{
>         .. WARNING::
> 
>             The specifications of this feature are fuzzy, leading to
>             potentially surprising consequences (see the examples
>             below).  It is recommended not to rely on it, as it may
>             eventually be discontinued.
> }}}

+1 to that. I also fear that this warning may be used later as an authorization to not document behaviors and to overlook inconsistencies because it is, after all, 'documented'.

Nathann



---

archive/issue_comments_237102.json:
```json
{
    "body": "Replying to [comment:182 jdemeyer]:\n> For the record: I will *not review* the changes to `integer_vector.py` on this ticket.\n\nSure thing! That's what I had in mind.",
    "created_at": "2015-03-27T16:18:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237102",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:182 jdemeyer]:
> For the record: I will *not review* the changes to `integer_vector.py` on this ticket.

Sure thing! That's what I had in mind.



---

archive/issue_comments_237103.json:
```json
{
    "body": "Replying to [comment:189 jdemeyer]:\n> I don't like this:\n> {{{\n>         .. WARNING::\n> \n>             The specifications of this feature are fuzzy, leading to\n>             potentially surprising consequences (see the examples\n>             below).  It is recommended not to rely on it, as it may\n>             eventually be discontinued.\n> }}}\n> \n> The specifications are not fuzzy. They might be strange, unlogical, arbitrary, badly chosen but not fuzzy. To make it less fuzzy, you should document explicitly the fact that the equivalence only works up to `max_length` in the `NOTE` about this `WARNING`.\n\nWell, my point was: the specifications *as they are currently written*\nare fuzzy. I meant to propose an alternative specification, but\nsomehow my comment did not make its way into trac. Here it is:\n\n\n```\nWhen several lists satisfying the constraint differ only by trailing\nzeroes, only the shortest one is enumerated (and therefore counted).\n```\n\n\nI believe this is not fuzzy anymore, and matches the current behavior\nof the code; and therefore does not require breaking backward\ncompatibility at this stage.\n\nWhat do you think?\n\nAs a separate question: do you believe like me that we should, in a\nlater ticket, get rid of this \"feature\"?\n\nCheers,\n                             Nicolas",
    "created_at": "2015-03-27T16:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237103",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:189 jdemeyer]:
> I don't like this:
> {{{
>         .. WARNING::
> 
>             The specifications of this feature are fuzzy, leading to
>             potentially surprising consequences (see the examples
>             below).  It is recommended not to rely on it, as it may
>             eventually be discontinued.
> }}}
> 
> The specifications are not fuzzy. They might be strange, unlogical, arbitrary, badly chosen but not fuzzy. To make it less fuzzy, you should document explicitly the fact that the equivalence only works up to `max_length` in the `NOTE` about this `WARNING`.

Well, my point was: the specifications *as they are currently written*
are fuzzy. I meant to propose an alternative specification, but
somehow my comment did not make its way into trac. Here it is:


```
When several lists satisfying the constraint differ only by trailing
zeroes, only the shortest one is enumerated (and therefore counted).
```


I believe this is not fuzzy anymore, and matches the current behavior
of the code; and therefore does not require breaking backward
compatibility at this stage.

What do you think?

As a separate question: do you believe like me that we should, in a
later ticket, get rid of this "feature"?

Cheers,
                             Nicolas



---

archive/issue_comments_237104.json:
```json
{
    "body": "Replying to [comment:194 nthiery]:\n> {{{\n> When several lists satisfying the constraint differ only by trailing\n> zeroes, only the shortest one is enumerated (and therefore counted).\n> }}}\n\n`constraint` -> `constraints`",
    "created_at": "2015-03-27T17:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237104",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:194 nthiery]:
> {{{
> When several lists satisfying the constraint differ only by trailing
> zeroes, only the shortest one is enumerated (and therefore counted).
> }}}

`constraint` -> `constraints`



---

archive/issue_comments_237105.json:
```json
{
    "body": "Please add this somewhere in `__init__`:\n\n```\nif min_length < 0:\n    min_length = 0\n```\n",
    "created_at": "2015-03-27T20:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237105",
    "user": "https://github.com/jdemeyer"
}
```

Please add this somewhere in `__init__`:

```
if min_length < 0:
    min_length = 0
```




---

archive/issue_comments_237106.json:
```json
{
    "body": "Replying to [comment:194 nthiery]:\n> As a separate question: do you believe like me that we should, in a\n> later ticket, get rid of this \"feature\"?\n\nI do think that, by default, we shouldn't output lists with trailing zeros, since this will lead in many cases to infinitely many lists satisfying the constraints. However, I think it's best if the behaviour of `__contains__` really matches the iterator.\n\nIf you ever allow negative parts, then the convention of having no trailing zeros becomes very strange, since \"non-zero\" is no longer a convex condition.\n\nIn #17920 I solved this by setting a minimum/maximum value for the last part of a list, if the list is longer than `min_length`. By default, this minimum is 1 with no maximum which gives the same lists as the \"identify trailing zeros\" convention.",
    "created_at": "2015-03-27T20:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237106",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:194 nthiery]:
> As a separate question: do you believe like me that we should, in a
> later ticket, get rid of this "feature"?

I do think that, by default, we shouldn't output lists with trailing zeros, since this will lead in many cases to infinitely many lists satisfying the constraints. However, I think it's best if the behaviour of `__contains__` really matches the iterator.

If you ever allow negative parts, then the convention of having no trailing zeros becomes very strange, since "non-zero" is no longer a convex condition.

In #17920 I solved this by setting a minimum/maximum value for the last part of a list, if the list is longer than `min_length`. By default, this minimum is 1 with no maximum which gives the same lists as the "identify trailing zeros" convention.



---

archive/issue_comments_237107.json:
```json
{
    "body": "Replying to [comment:176 nthiery]:\n> I'd be rather surprised if this was used anywhere (it was not in the Sage sources), especially since the documentation never mentionned this possibility.\n\nSomebody had to change `src/sage/combinat/integer_matrices.py` for this reason :-)",
    "created_at": "2015-03-27T20:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237107",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:176 nthiery]:
> I'd be rather surprised if this was used anywhere (it was not in the Sage sources), especially since the documentation never mentionned this possibility.

Somebody had to change `src/sage/combinat/integer_matrices.py` for this reason :-)



---

archive/issue_comments_237108.json:
```json
{
    "body": "Replying to [comment:187 jdemeyer]:\n> This should return the list containg 1 element `[]`:\n> {{{\n> sage: list(IntegerListsLex(ceiling=[0], max_slope=0))\n> }}}\n\nThis is fixed now!",
    "created_at": "2015-03-28T05:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237108",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:187 jdemeyer]:
> This should return the list containg 1 element `[]`:
> {{{
> sage: list(IntegerListsLex(ceiling=[0], max_slope=0))
> }}}

This is fixed now!



---

archive/issue_comments_237109.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T05:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237109",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237110.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T05:33:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237110",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237111.json:
```json
{
    "body": "Replying to [comment:198 jdemeyer]:\n> Somebody had to change `src/sage/combinat/integer_matrices.py` for this reason :-)\n\nGood point :-) Well, it was good to make this change anyway for clarity :-)",
    "created_at": "2015-03-28T05:37:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237111",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:198 jdemeyer]:
> Somebody had to change `src/sage/combinat/integer_matrices.py` for this reason :-)

Good point :-) Well, it was good to make this change anyway for clarity :-)



---

archive/issue_comments_237112.json:
```json
{
    "body": "Replying to [comment:196 jdemeyer]:\n> Please add this somewhere in `__init__`:\n> {{{\n> if min_length < 0:\n>     min_length = 0\n> }}}\n\nI am not sure whether I prefer this, or barking, but that's fine. Done, together with further typechecks.",
    "created_at": "2015-03-28T05:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237112",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:196 jdemeyer]:
> Please add this somewhere in `__init__`:
> {{{
> if min_length < 0:
>     min_length = 0
> }}}

I am not sure whether I prefer this, or barking, but that's fine. Done, together with further typechecks.



---

archive/issue_comments_237113.json:
```json
{
    "body": "Replying to [comment:195 jdemeyer]:\n> Replying to [comment:194 nthiery]:\n> > {{{\n> > When several lists satisfying the constraint differ only by trailing\n> > zeroes, only the shortest one is enumerated (and therefore counted).\n> > }}}\n> \n> `constraint` -> `constraints`\n\nI assume this means that the rest is ok. I updated the documentation accordingly.",
    "created_at": "2015-03-28T05:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237113",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:195 jdemeyer]:
> Replying to [comment:194 nthiery]:
> > {{{
> > When several lists satisfying the constraint differ only by trailing
> > zeroes, only the shortest one is enumerated (and therefore counted).
> > }}}
> 
> `constraint` -> `constraints`

I assume this means that the rest is ok. I updated the documentation accordingly.



---

archive/issue_comments_237114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T05:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237114",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237115.json:
```json
{
    "body": "Replying to [comment:188 ncohen]:\n> > Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).\n> \n> +1 to that. This terminology made it much harder for me to understand what the code was doing. Instead of writing this in the code:\n> \n> {{{\n> self.rho = []   # list of current search ranges\n> self.mu = []    # list of integers\n> self.j = -1     # index of last element of mu\n> self.nu = 0     # sum of values in mu       \n> }}}\n> \n> It would probably be clearer to rename those variables (respectively) as\n> {{{\n> self._search_range\n> self._current_list\n> self._j\n> self._current_sum\n> }}}\n\nFixed.\n----\nNew commits:",
    "created_at": "2015-03-28T05:45:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237115",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:188 ncohen]:
> > Since most of the internal state is contained in attributes like `self.rho`, you should document what these mean (and `# list of current search ranges` is not sufficient documentation).
> 
> +1 to that. This terminology made it much harder for me to understand what the code was doing. Instead of writing this in the code:
> 
> {{{
> self.rho = []   # list of current search ranges
> self.mu = []    # list of integers
> self.j = -1     # index of last element of mu
> self.nu = 0     # sum of values in mu       
> }}}
> 
> It would probably be clearer to rename those variables (respectively) as
> {{{
> self._search_range
> self._current_list
> self._j
> self._current_sum
> }}}

Fixed.
----
New commits:



---

archive/issue_comments_237116.json:
```json
{
    "body": "Replying to [comment:197 jdemeyer]:\n> However, I think it's best if the behaviour of `__contains__` really\n> matches the iterator.\n\nIf you take upon you the responsibility of this backward incompatible\nchange of `__contains__`, I'll go for it. Otherwise, I'd rather not\nchange this now.\n\n> I do think that, by default, we shouldn't output lists with trailing\n> zeros, since this will lead in many cases to infinitely many lists\n> satisfying the constraints.\n\nYeah, that was my original motivation too.\n\n> If you ever allow negative parts, then the convention of having no\n> trailing zeros becomes very strange, since \"non-zero\" is no longer a\n> convex condition.\n\nYup, one more can of worms.\n\n> In #17920 I solved this by setting a minimum/maximum value for the last part of a list, if the list is longer than `min_length`. By default, this minimum is 1 with no maximum which gives the same lists as the \"identify trailing zeros\" convention.\n\nI definitely prefer this approach. This is also why I hesitated having\n`min_part` take precedence over `floor=[...]`, for otherwise you could\njust do `floor=[1,1,0,3], min_part=1`.  Well, it's still possible to\nachieve this through a floor function but if the limit of the function\nis not specified, the code can't decide certain things.\n\nAnyway, let's keep the \"feature\" for now, and take care of it in a\nlater ticket in a consistent way with #17920.\n\nCheers,\n                                     Nicolas\n----\nNew commits:",
    "created_at": "2015-03-28T05:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237116",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:197 jdemeyer]:
> However, I think it's best if the behaviour of `__contains__` really
> matches the iterator.

If you take upon you the responsibility of this backward incompatible
change of `__contains__`, I'll go for it. Otherwise, I'd rather not
change this now.

> I do think that, by default, we shouldn't output lists with trailing
> zeros, since this will lead in many cases to infinitely many lists
> satisfying the constraints.

Yeah, that was my original motivation too.

> If you ever allow negative parts, then the convention of having no
> trailing zeros becomes very strange, since "non-zero" is no longer a
> convex condition.

Yup, one more can of worms.

> In #17920 I solved this by setting a minimum/maximum value for the last part of a list, if the list is longer than `min_length`. By default, this minimum is 1 with no maximum which gives the same lists as the "identify trailing zeros" convention.

I definitely prefer this approach. This is also why I hesitated having
`min_part` take precedence over `floor=[...]`, for otherwise you could
just do `floor=[1,1,0,3], min_part=1`.  Well, it's still possible to
achieve this through a floor function but if the limit of the function
is not specified, the code can't decide certain things.

Anyway, let's keep the "feature" for now, and take care of it in a
later ticket in a consistent way with #17920.

Cheers,
                                     Nicolas
----
New commits:



---

archive/issue_comments_237117.json:
```json
{
    "body": "Replying to [comment:180 jdemeyer]:\n> I agree with this comment:\n> {{{\n> .. TODO:: Maybe this should be ``check=False`` instead?\n> }}}\n> \n> The standard terminology for such an option is indeed `check=False` and `waiver` appears only in `integer_list.py`.\n\nThe thing is that there really are two different use cases here:\n\n(1) I know what I am doing, you do not need to check my input.\n\n(2) I know what I am doing, don't show me again this warning when\n    accessing the more tricky features.\n\nThe first use case definitely fits within the usual `check=False`\nterminology. I am not so sure about the second one. In fact, I could\nimagine situations where I would want (2) without (1): \"I'll be using\nthe tricky features, still double check everything you can\".\n\nBut maybe it's not worth the additional API complexity, and everything\nshould just fall into `check=False`. Or rename \"waiver=...\" to\n`warnings=False`. I don't have a strong opinion.\n\nCheers,\n                              Nicolas",
    "created_at": "2015-03-28T06:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237117",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:180 jdemeyer]:
> I agree with this comment:
> {{{
> .. TODO:: Maybe this should be ``check=False`` instead?
> }}}
> 
> The standard terminology for such an option is indeed `check=False` and `waiver` appears only in `integer_list.py`.

The thing is that there really are two different use cases here:

(1) I know what I am doing, you do not need to check my input.

(2) I know what I am doing, don't show me again this warning when
    accessing the more tricky features.

The first use case definitely fits within the usual `check=False`
terminology. I am not so sure about the second one. In fact, I could
imagine situations where I would want (2) without (1): "I'll be using
the tricky features, still double check everything you can".

But maybe it's not worth the additional API complexity, and everything
should just fall into `check=False`. Or rename "waiver=..." to
`warnings=False`. I don't have a strong opinion.

Cheers,
                              Nicolas



---

archive/issue_comments_237118.json:
```json
{
    "body": "Replying to [comment:190 jdemeyer]:\n> I would also prefer to remove the text concerning algorithmic complexity in `src/sage/combinat/tutorial.py`. What I dislike most is that it seems to hide behind the \"degenerate cases\" exception without really specifying what that means.\n\nWell, defining precisely the \"degenerate cases\" is a little research\nproject by itself :-) But the point is that, in most practical use\ncases, the complexity is low (or will be low once an improved\nlookahead will be implemented #18055). I am happy to reformulate it\nthis way if you prefer. But I'd rather keep some short sentence about\nthis topic here, as it explains the rationale of the approach to the\nreader.",
    "created_at": "2015-03-28T06:21:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237118",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:190 jdemeyer]:
> I would also prefer to remove the text concerning algorithmic complexity in `src/sage/combinat/tutorial.py`. What I dislike most is that it seems to hide behind the "degenerate cases" exception without really specifying what that means.

Well, defining precisely the "degenerate cases" is a little research
project by itself :-) But the point is that, in most practical use
cases, the complexity is low (or will be low once an improved
lookahead will be implemented #18055). I am happy to reformulate it
this way if you prefer. But I'd rather keep some short sentence about
this topic here, as it explains the rationale of the approach to the
reader.



---

archive/issue_comments_237119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T06:49:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237120.json:
```json
{
    "body": "Replying to [comment:203 nthiery]:\n> Replying to [comment:196 jdemeyer]:\n> > Please add this somewhere in `__init__`:\n> > {{{\n> > if min_length < 0:\n> >     min_length = 0\n> > }}}\n> \n> I am not sure whether I prefer this, or barking, but that's fine. Done, together with further typechecks.\nWell, I also prefer `raise ValueError(...)` in this case, but some partitions code really sends a negative value for `min_length` to `IntegerListsLex`.",
    "created_at": "2015-03-28T07:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237120",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:203 nthiery]:
> Replying to [comment:196 jdemeyer]:
> > Please add this somewhere in `__init__`:
> > {{{
> > if min_length < 0:
> >     min_length = 0
> > }}}
> 
> I am not sure whether I prefer this, or barking, but that's fine. Done, together with further typechecks.
Well, I also prefer `raise ValueError(...)` in this case, but some partitions code really sends a negative value for `min_length` to `IntegerListsLex`.



---

archive/issue_comments_237121.json:
```json
{
    "body": "Concerning type checks: instead of `x in ZZ`, it's better to simply convert to a known type: use `x = ZZ(x)` instead (or see my function `integer_or_infinity()` in #17920).",
    "created_at": "2015-03-28T07:30:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237121",
    "user": "https://github.com/jdemeyer"
}
```

Concerning type checks: instead of `x in ZZ`, it's better to simply convert to a known type: use `x = ZZ(x)` instead (or see my function `integer_or_infinity()` in #17920).



---

archive/issue_comments_237122.json:
```json
{
    "body": "Replying to [comment:209 nthiery]:\n> But I'd rather keep some short sentence about\n> this topic here, as it explains the rationale of the approach to the\n> reader.\nFine, I understand your point. However, I think it should perhaps be phrased in a more informal way. Since you talk about polynomial-time, it *sounds* like the statement of some mathematical theorem, but it isn't.\n\nYou can just say something like \"it's fast in practice for simple examples\".",
    "created_at": "2015-03-28T07:37:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237122",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:209 nthiery]:
> But I'd rather keep some short sentence about
> this topic here, as it explains the rationale of the approach to the
> reader.
Fine, I understand your point. However, I think it should perhaps be phrased in a more informal way. Since you talk about polynomial-time, it *sounds* like the statement of some mathematical theorem, but it isn't.

You can just say something like "it's fast in practice for simple examples".



---

archive/issue_comments_237123.json:
```json
{
    "body": "Replying to [comment:208 nthiery]:\n> (1) I know what I am doing, you do not need to check my input.\n> \n> (2) I know what I am doing, don't show me again this warning when\n>     accessing the more tricky features.\nTo be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?\n\nI prefer the name `check=False` mainly because it's very standard in Sage.",
    "created_at": "2015-03-28T07:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237123",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:208 nthiery]:
> (1) I know what I am doing, you do not need to check my input.
> 
> (2) I know what I am doing, don't show me again this warning when
>     accessing the more tricky features.
To be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?

I prefer the name `check=False` mainly because it's very standard in Sage.



---

archive/issue_comments_237124.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T16:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237125.json:
```json
{
    "body": "Replying to [comment:191 jdemeyer]:\n> This hangs:\n> {{{\n> sage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))\n> }}}\n> (it works fine without the `min_length` though)\n\nThank you for catching this! It should be fixed now! There was a wrong variable in _possible_m.",
    "created_at": "2015-03-28T16:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237125",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:191 jdemeyer]:
> This hangs:
> {{{
> sage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))
> }}}
> (it works fine without the `min_length` though)

Thank you for catching this! It should be fixed now! There was a wrong variable in _possible_m.



---

archive/issue_comments_237126.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-28T16:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237126",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237127.json:
```json
{
    "body": "Replying to [comment:191 jdemeyer]:\n> This hangs:\n> {{{\n> sage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))\n> }}}\n> (it works fine without the `min_length` though)\n\nYou really are shaking this guy out! That's good :-)\n\nWe looked this up with Anne and the hang was in `._possible_m`; the issue was similar to one we had elsewhere: if the ceiling is 0 at some point and max_slope=0, then we know this should be treated as if there was a ceiling limit of 0. In fact, this was already tested, but not on a moving position; so this was a 1 character fix at the end.\n\nI'll document this method in detail later today.",
    "created_at": "2015-03-28T16:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237127",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:191 jdemeyer]:
> This hangs:
> {{{
> sage: list(IntegerListsLex(1, min_length=2, min_slope=0, max_slope=0))
> }}}
> (it works fine without the `min_length` though)

You really are shaking this guy out! That's good :-)

We looked this up with Anne and the hang was in `._possible_m`; the issue was similar to one we had elsewhere: if the ceiling is 0 at some point and max_slope=0, then we know this should be treated as if there was a ceiling limit of 0. In fact, this was already tested, but not on a moving position; so this was a 1 character fix at the end.

I'll document this method in detail later today.



---

archive/issue_comments_237128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T00:18:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237129.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T01:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T02:02:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237130",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237131.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T02:06:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237132.json:
```json
{
    "body": "Replying to [comment:212 jdemeyer]:\n> Concerning type checks: instead of `x in ZZ`, it's better to simply convert to a known type: use `x = ZZ(x)` instead (or see my function `integer_or_infinity()` in #17920).\n\nFixed!",
    "created_at": "2015-03-29T02:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237132",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:212 jdemeyer]:
> Concerning type checks: instead of `x in ZZ`, it's better to simply convert to a known type: use `x = ZZ(x)` instead (or see my function `integer_or_infinity()` in #17920).

Fixed!



---

archive/issue_comments_237133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T02:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237134.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T02:18:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237134",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237135.json:
```json
{
    "body": "Replying to [comment:214 jdemeyer]:\n> Replying to [comment:208 nthiery]:\n> > (1) I know what I am doing, you do not need to check my input.\n> > \n> > (2) I know what I am doing, don't show me again this warning when\n> >     accessing the more tricky features.\n> To be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?\n> \n> I prefer the name `check=False` mainly because it's very standard in Sage.\n\nFixed!",
    "created_at": "2015-03-29T02:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237135",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:214 jdemeyer]:
> Replying to [comment:208 nthiery]:
> > (1) I know what I am doing, you do not need to check my input.
> > 
> > (2) I know what I am doing, don't show me again this warning when
> >     accessing the more tricky features.
> To be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?
> 
> I prefer the name `check=False` mainly because it's very standard in Sage.

Fixed!



---

archive/issue_comments_237136.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T02:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237136",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T03:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237138.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T03:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237139.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T05:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237140.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T05:38:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237141.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T05:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237142.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T05:55:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237142",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237143.json:
```json
{
    "body": "Replying to [comment:214 jdemeyer]:\n> To be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?\n\nWell, I would know, but you are probably right: let's keep it simple\nfor the user.",
    "created_at": "2015-03-29T05:56:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237143",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:214 jdemeyer]:
> To be honest, I don't think there is much difference between these two. Suppose hypothetically that we would add two different flags for (1) and (2), which checks would be controlled by (1) and which by (2)?

Well, I would know, but you are probably right: let's keep it simple
for the user.



---

archive/issue_comments_237144.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-29T05:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237144",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237145.json:
```json
{
    "body": "Replying to [comment:213 jdemeyer]:\n> Fine, I understand your point. However, I think it should perhaps be phrased in a more informal way. Since you talk about polynomial-time, it *sounds* like the statement of some mathematical theorem, but it isn't.\n> \n> You can just say something like \"it's fast in practice for simple examples\".\n\nOk. Fast being very vague I tried to reformulate this, as well as the\ncomment on the complexity in `IntegerListsLex`, to be less formal\nwhile still giving some useful indication to the reader.\n\nI very much hope that at some point we will be able to replace this by\nprecise complexity information, at least within well defined cases.",
    "created_at": "2015-03-29T06:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237145",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:213 jdemeyer]:
> Fine, I understand your point. However, I think it should perhaps be phrased in a more informal way. Since you talk about polynomial-time, it *sounds* like the statement of some mathematical theorem, but it isn't.
> 
> You can just say something like "it's fast in practice for simple examples".

Ok. Fast being very vague I tried to reformulate this, as well as the
comment on the complexity in `IntegerListsLex`, to be less formal
while still giving some useful indication to the reader.

I very much hope that at some point we will be able to replace this by
precise complexity information, at least within well defined cases.



---

archive/issue_comments_237146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T06:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237147.json:
```json
{
    "body": "Ok, we believe we took care of all the comments here, hence back to\nneeds review. Anne had a first look at the changes in\n`integer_vectors`, and Travis will double check probably on Monday.\n\nI have been trough the internal documentation, and spent quite some\ntime improving it. It could be further improved. Yet, it's probably\nbest not to spend too much time on it either, since it's likely to get\nupdated once better look ahead are implemented.\n----\nNew commits:",
    "created_at": "2015-03-29T06:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237147",
    "user": "https://github.com/nthiery"
}
```

Ok, we believe we took care of all the comments here, hence back to
needs review. Anne had a first look at the changes in
`integer_vectors`, and Travis will double check probably on Monday.

I have been trough the internal documentation, and spent quite some
time improving it. It could be further improved. Yet, it's probably
best not to spend too much time on it either, since it's likely to get
updated once better look ahead are implemented.
----
New commits:



---

archive/issue_comments_237148.json:
```json
{
    "body": "\n```\nsage: L = IntegerListsLex(length=2, max_part=0)\nsage: [0,0] in L\nTrue\nsage: L.list()\n[]\n```\n",
    "created_at": "2015-03-29T12:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237148",
    "user": "https://github.com/jdemeyer"
}
```


```
sage: L = IntegerListsLex(length=2, max_part=0)
sage: [0,0] in L
True
sage: L.list()
[]
```




---

archive/issue_comments_237149.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-03-29T12:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237149",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237150.json:
```json
{
    "body": "I think this input should be allowed:\n\n```\nsage: IntegerListsLex(7, min_slope=Infinity).list()\n```\n",
    "created_at": "2015-03-29T14:21:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237150",
    "user": "https://github.com/jdemeyer"
}
```

I think this input should be allowed:

```
sage: IntegerListsLex(7, min_slope=Infinity).list()
```




---

archive/issue_comments_237151.json:
```json
{
    "body": "This list is obviously finite:\n\n```\nsage: L = IntegerListsLex(max_part=1, min_slope=10)\nsage: L.list()\n...\nValueError: The specified parameters do not allow for an inverse lexicographic iterator\n```\n",
    "created_at": "2015-03-29T14:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237151",
    "user": "https://github.com/jdemeyer"
}
```

This list is obviously finite:

```
sage: L = IntegerListsLex(max_part=1, min_slope=10)
sage: L.list()
...
ValueError: The specified parameters do not allow for an inverse lexicographic iterator
```




---

archive/issue_comments_237152.json:
```json
{
    "body": "The following are also very clearly finite (but still `ValueError`):\n\n```\nsage: L = IntegerListsLex(length=0)\nsage: L = IntegerListsLex(max_length=0, min_length=1)\n```\n",
    "created_at": "2015-03-29T14:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237152",
    "user": "https://github.com/jdemeyer"
}
```

The following are also very clearly finite (but still `ValueError`):

```
sage: L = IntegerListsLex(length=0)
sage: L = IntegerListsLex(max_length=0, min_length=1)
```




---

archive/issue_comments_237153.json:
```json
{
    "body": "Also this one:\n\n```\nsage: L = IntegerListsLex(min_sum=10, max_sum=5)\n```\n",
    "created_at": "2015-03-29T14:34:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237153",
    "user": "https://github.com/jdemeyer"
}
```

Also this one:

```
sage: L = IntegerListsLex(min_sum=10, max_sum=5)
```




---

archive/issue_comments_237154.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T16:39:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237155.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T16:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237156.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T17:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237156",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237157.json:
```json
{
    "body": "Here are my comments on the current state of things:\n\n- In `integer_list.py`:\n  - I don't understand this sentence in the header: \"It was then completely rewritten in 2015 by Gillespie, Schilling, and Thiery, with the help of many, to catter for limitations and lack of robustness w.r.t. input.\" I think by \"catter\" you mean \"cater\", but that isn't correct usage of the word.\n  - \"dyck words\" capitalization.\n  - I don't like the fact that when the answer is known to be infinite, that the category is `FiniteEnumeratedSets`.\n  - You should test also when the input `n` is a tuple.\n  - In `_check_lexicographic_iterable`, \"Checks\" should be \"Check\"\n\n- In `tutorial.py`, `predict when a sequence `\\ell_0,\\dot,\\ell_k` is a prefix of some`, it should be \"\\dots\".\n\n- In `integer_vector.py`\n  - Use absolute paths instead of relative paths: `from combinat import CombinatorialClass`\n  - In `list2func`, could we code-afy the doc?\n  - In the `__init__`, this is missing the double-colon: \"All the attributes below are private; don't use them!\"\n  - Could we split the long line in the `_repr_`?\n  - Should we formally deprecate the `next` method?\n  - In the error message \"If k is a list, no optional argument is supported\", let's make it lowercase.\n\nOtherwise I'm okay with how the code looks (but I did not run tests like Jeroen).",
    "created_at": "2015-03-29T17:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237157",
    "user": "https://github.com/tscrim"
}
```

Here are my comments on the current state of things:

- In `integer_list.py`:
  - I don't understand this sentence in the header: "It was then completely rewritten in 2015 by Gillespie, Schilling, and Thiery, with the help of many, to catter for limitations and lack of robustness w.r.t. input." I think by "catter" you mean "cater", but that isn't correct usage of the word.
  - "dyck words" capitalization.
  - I don't like the fact that when the answer is known to be infinite, that the category is `FiniteEnumeratedSets`.
  - You should test also when the input `n` is a tuple.
  - In `_check_lexicographic_iterable`, "Checks" should be "Check"

- In `tutorial.py`, `predict when a sequence `\ell_0,\dot,\ell_k` is a prefix of some`, it should be "\dots".

- In `integer_vector.py`
  - Use absolute paths instead of relative paths: `from combinat import CombinatorialClass`
  - In `list2func`, could we code-afy the doc?
  - In the `__init__`, this is missing the double-colon: "All the attributes below are private; don't use them!"
  - Could we split the long line in the `_repr_`?
  - Should we formally deprecate the `next` method?
  - In the error message "If k is a list, no optional argument is supported", let's make it lowercase.

Otherwise I'm okay with how the code looks (but I did not run tests like Jeroen).



---

archive/issue_comments_237158.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T18:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237159.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T19:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237159",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237160.json:
```json
{
    "body": "Replying to [comment:240 jdemeyer]:\n> {{{\n> sage: L = IntegerListsLex(length=2, max_part=0)\n> sage: [0,0] in L\n> True\n> sage: L.list()\n> []\n> }}}\n\nFixed, thanks! We cleaned up _possible_m for this.\n----\nNew commits:",
    "created_at": "2015-03-29T19:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237160",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:240 jdemeyer]:
> {{{
> sage: L = IntegerListsLex(length=2, max_part=0)
> sage: [0,0] in L
> True
> sage: L.list()
> []
> }}}

Fixed, thanks! We cleaned up _possible_m for this.
----
New commits:



---

archive/issue_comments_237161.json:
```json
{
    "body": "Replying to [comment:241 jdemeyer]:\n> I think this input should be allowed:\n> {{{\n> sage: IntegerListsLex(7, min_slope=Infinity).list()\n> }}}\n\nHmm, this would be generating lists of length at most 1.\n\nDo you see any real use case?\n\nIt seems to me that the specification that `min_slope` is either `-oo`\nor an integer (and symmetrically for `max_slope`) is quite natural,\nand allowing for `+oo` would only mean adding more special cases and\ncomplications to handle for no added value.\n\nCheers,\n                                     Nicolas\n\nBtw: thanks for all the interesting corner cases you posted!",
    "created_at": "2015-03-29T19:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237161",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:241 jdemeyer]:
> I think this input should be allowed:
> {{{
> sage: IntegerListsLex(7, min_slope=Infinity).list()
> }}}

Hmm, this would be generating lists of length at most 1.

Do you see any real use case?

It seems to me that the specification that `min_slope` is either `-oo`
or an integer (and symmetrically for `max_slope`) is quite natural,
and allowing for `+oo` would only mean adding more special cases and
complications to handle for no added value.

Cheers,
                                     Nicolas

Btw: thanks for all the interesting corner cases you posted!



---

archive/issue_comments_237162.json:
```json
{
    "body": "Replying to [comment:252 nthiery]:\n> Do you see any real use case?\nI certainly have no use case. It just seems a bit strange to allow every possible value for `min_slope` except `+Infinity`.\n\nAt least make it a `ValueError` if `min_slope=Infinity` or `max_slope=-Infinity` is given.",
    "created_at": "2015-03-29T19:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237162",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:252 nthiery]:
> Do you see any real use case?
I certainly have no use case. It just seems a bit strange to allow every possible value for `min_slope` except `+Infinity`.

At least make it a `ValueError` if `min_slope=Infinity` or `max_slope=-Infinity` is given.



---

archive/issue_comments_237163.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T20:00:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237164.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T20:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237164",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237165.json:
```json
{
    "body": "Replying to [comment:248 tscrim]:\n> Here are my comments on the current state of things:\n\nTravis' comments are fixed now. Here are some further responses:\n\n>   - I don't like the fact that when the answer is known to be infinite, that the category is `FiniteEnumeratedSets`.\n\nWhen IntegerListsLex is enumerable (i.e. the vectors can be iterated over in inverse lex order), then the list is finite. We will explain this in the code.\n\n>   - Should we formally deprecate the `next` method?\n\nNo, since the plan is to implement this later, so there is no need to deprecate it now.\n\n----\nNew commits:",
    "created_at": "2015-03-29T20:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237165",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:248 tscrim]:
> Here are my comments on the current state of things:

Travis' comments are fixed now. Here are some further responses:

>   - I don't like the fact that when the answer is known to be infinite, that the category is `FiniteEnumeratedSets`.

When IntegerListsLex is enumerable (i.e. the vectors can be iterated over in inverse lex order), then the list is finite. We will explain this in the code.

>   - Should we formally deprecate the `next` method?

No, since the plan is to implement this later, so there is no need to deprecate it now.

----
New commits:



---

archive/issue_comments_237166.json:
```json
{
    "body": "Replying to [comment:256 aschilling]:\n> When IntegerListsLex is enumerable (i.e. the vectors can be iterated over in inverse lex order), then the list is finite. We will explain this in the code.\n\nOh, actually not quite. Sorry, my bad. I applied Koenig's lemma to\nquick. The equivalence finite <=> inverse lexicographically enumerable\nis almost true, except for extreme cases like:\n\n```\n    sage: IntegerListsLex(n=1)\n    -> [1], [0,1], [0,0,1] ...\n```\n\n\nWe will think about this a bit more and update the code accordingly.",
    "created_at": "2015-03-29T20:21:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237166",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:256 aschilling]:
> When IntegerListsLex is enumerable (i.e. the vectors can be iterated over in inverse lex order), then the list is finite. We will explain this in the code.

Oh, actually not quite. Sorry, my bad. I applied Koenig's lemma to
quick. The equivalence finite <=> inverse lexicographically enumerable
is almost true, except for extreme cases like:

```
    sage: IntegerListsLex(n=1)
    -> [1], [0,1], [0,0,1] ...
```


We will think about this a bit more and update the code accordingly.



---

archive/issue_comments_237167.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T21:04:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237167",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237168.json:
```json
{
    "body": "Replying to [comment:253 jdemeyer]:\n> Replying to [comment:252 nthiery]:\n> > Do you see any real use case?\n> I certainly have no use case. It just seems a bit strange to allow every possible value for `min_slope` except `+Infinity`.\n> \n> At least make it a `ValueError` if `min_slope=Infinity` or `max_slope=-Infinity` is given.\n\nOh, I see your point now. I somehow thought this was already checked for. Done now: if `min_slope` is not `-oo`, then it's converted to an integer. Thanks.",
    "created_at": "2015-03-29T21:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237168",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:253 jdemeyer]:
> Replying to [comment:252 nthiery]:
> > Do you see any real use case?
> I certainly have no use case. It just seems a bit strange to allow every possible value for `min_slope` except `+Infinity`.
> 
> At least make it a `ValueError` if `min_slope=Infinity` or `max_slope=-Infinity` is given.

Oh, I see your point now. I somehow thought this was already checked for. Done now: if `min_slope` is not `-oo`, then it's converted to an integer. Thanks.



---

archive/issue_comments_237169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-29T21:27:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237170.json:
```json
{
    "body": "I know this hasn't been set back to needs_review, but just as a reminder:\n\n```\nOSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:9: WARNING: Inline literal start-string without end-string.\n```\n",
    "created_at": "2015-03-30T06:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237170",
    "user": "https://github.com/jdemeyer"
}
```

I know this hasn't been set back to needs_review, but just as a reminder:

```
OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:9: WARNING: Inline literal start-string without end-string.
```




---

archive/issue_comments_237171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-30T06:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237171",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237172.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-30T07:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237172",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237173.json:
```json
{
    "body": "Replying to [comment:261 jdemeyer]:\n> I know this hasn't been set back to needs_review, but just as a reminder:\n> {{{\n> OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:9: WARNING: Inline literal start-string without end-string.\n> }}}\n\nFixed, thanks!\n----\nNew commits:\n----\nNew commits:",
    "created_at": "2015-03-30T07:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237173",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:261 jdemeyer]:
> I know this hasn't been set back to needs_review, but just as a reminder:
> {{{
> OSError: [combinat ] /usr/local/src/sage-config/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:9: WARNING: Inline literal start-string without end-string.
> }}}

Fixed, thanks!
----
New commits:
----
New commits:



---

archive/issue_comments_237174.json:
```json
{
    "body": "Suggestion: use the function `is_trivially_zero` from #17920 and don't raise `ValueError` (for infinite ceiling or non-inverse-lexicographically-enumerable) if this returns `True`.",
    "created_at": "2015-03-30T10:00:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237174",
    "user": "https://github.com/jdemeyer"
}
```

Suggestion: use the function `is_trivially_zero` from #17920 and don't raise `ValueError` (for infinite ceiling or non-inverse-lexicographically-enumerable) if this returns `True`.



---

archive/issue_comments_237175.json:
```json
{
    "body": "After some more testing, I wasn't able to find any more cases of wrong output or hangs.\n\nHowever, the are many cases where a `ValueError` is raised despite the fact that only finitely many lists satisfy the constraints.\n\nPerhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.",
    "created_at": "2015-03-30T12:34:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237175",
    "user": "https://github.com/jdemeyer"
}
```

After some more testing, I wasn't able to find any more cases of wrong output or hangs.

However, the are many cases where a `ValueError` is raised despite the fact that only finitely many lists satisfy the constraints.

Perhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.



---

archive/issue_comments_237176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-30T18:51:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237177.json:
```json
{
    "body": "Replying to [comment:267 jdemeyer]:\n> After some more testing, I wasn't able to find any more cases of wrong output or hangs.\n> \n> However, the are many cases where a `ValueError` is raised despite the fact that only finitely many lists satisfy the constraints.\n> \n> Perhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.\n\nYes, I agree with this and changed the message. Jeroen, you are doing a very detailed review of the code and its functioning. It is very helpful! Thank you!",
    "created_at": "2015-03-30T18:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237177",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:267 jdemeyer]:
> After some more testing, I wasn't able to find any more cases of wrong output or hangs.
> 
> However, the are many cases where a `ValueError` is raised despite the fact that only finitely many lists satisfy the constraints.
> 
> Perhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.

Yes, I agree with this and changed the message. Jeroen, you are doing a very detailed review of the code and its functioning. It is very helpful! Thank you!



---

archive/issue_comments_237178.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-30T19:30:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237178",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237179.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-30T19:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237179",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237180.json:
```json
{
    "body": "Could you please document the new algorithm somewhere ? I downloaded the branch again today and had no idea what the values \"decreasing, push, pop, me\" actually meant `O_o`\n\nNathann",
    "created_at": "2015-03-30T20:25:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237180",
    "user": "https://github.com/nathanncohen"
}
```

Could you please document the new algorithm somewhere ? I downloaded the branch again today and had no idea what the values "decreasing, push, pop, me" actually meant `O_o`

Nathann



---

archive/issue_comments_237181.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T03:50:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237181",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237182.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T03:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237182",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T05:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237184.json:
```json
{
    "body": "Replying to [comment:273 ncohen]:\n> Could you please document the new algorithm somewhere ? I downloaded the branch again today and had no idea what the values \"decreasing, push, pop, me\" actually meant `O_o`\n\nDone!\n\nIt's in fact the same algorithm as before; just trying to better\nhighlight the structure, and reorganizing it to fix the logic for the\ncorner case of length 0 (fixes comment:243).\n\nCheers,",
    "created_at": "2015-03-31T05:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237184",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:273 ncohen]:
> Could you please document the new algorithm somewhere ? I downloaded the branch again today and had no idea what the values "decreasing, push, pop, me" actually meant `O_o`

Done!

It's in fact the same algorithm as before; just trying to better
highlight the structure, and reorganizing it to fix the logic for the
corner case of length 0 (fixes comment:243).

Cheers,



---

archive/issue_comments_237185.json:
```json
{
    "body": "Replying to [comment:266 jdemeyer]:\n> Suggestion: use the function `is_trivially_zero` from #17920 and don't raise `ValueError` (for infinite ceiling or non-inverse-lexicographically-enumerable) if this returns `True`.\n\nI must admit that I have been focusing on getting this ticket done, at\nthe price of looking at the details of your ticket right now ... So\nthanks much for your pointers; that's helpful!\n\nIn this specific case, it turns out that it's really the logic that\nhad to be fixed, and I won't need `is_trivially_zero`.\n\nCheers,\n                               Nicolas",
    "created_at": "2015-03-31T05:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237185",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:266 jdemeyer]:
> Suggestion: use the function `is_trivially_zero` from #17920 and don't raise `ValueError` (for infinite ceiling or non-inverse-lexicographically-enumerable) if this returns `True`.

I must admit that I have been focusing on getting this ticket done, at
the price of looking at the details of your ticket right now ... So
thanks much for your pointers; that's helpful!

In this specific case, it turns out that it's really the logic that
had to be fixed, and I won't need `is_trivially_zero`.

Cheers,
                               Nicolas



---

archive/issue_comments_237186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T05:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237186",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237187.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T06:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237187",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237188.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T06:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237188",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237189.json:
```json
{
    "body": "Replying to [comment:267 jdemeyer]:\n> However, the are many cases where a `ValueError` is raised despite\n> the fact that only finitely many lists satisfy the constraints.\n\nWith the forward smoothing and partial backward smoothing of the\nenvelope w.r.t. `min_slope` and `max_slope` the situation should be\nbetter now. At least all the examples your provided work smoothly,\nand I am not sure I have an example under hand that would be finite\nand not detected as such.\n\n\n> Perhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.\n\nYes, until we have something guaranteed, that's the right thing to do.\n\nCheers,\n                              Nicolas",
    "created_at": "2015-03-31T06:08:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237189",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:267 jdemeyer]:
> However, the are many cases where a `ValueError` is raised despite
> the fact that only finitely many lists satisfy the constraints.

With the forward smoothing and partial backward smoothing of the
envelope w.r.t. `min_slope` and `max_slope` the situation should be
better now. At least all the examples your provided work smoothly,
and I am not sure I have an example under hand that would be finite
and not detected as such.


> Perhaps the exception `The specified parameters do not allow for an inverse lexicographic iterator` should be weakened to `it looks like the specified parameters do not allow for an inverse lexicographic iterator` or something.

Yes, until we have something guaranteed, that's the right thing to do.

Cheers,
                              Nicolas



---

archive/issue_comments_237190.json:
```json
{
    "body": "Replying to [comment:211 jdemeyer]:\n> Well, I also prefer `raise ValueError(...)` in this case, but some partitions code really sends a negative value for `min_length` to `IntegerListsLex`.\n\nGasp. Ok, fair enough :-)",
    "created_at": "2015-03-31T06:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237190",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:211 jdemeyer]:
> Well, I also prefer `raise ValueError(...)` in this case, but some partitions code really sends a negative value for `min_length` to `IntegerListsLex`.

Gasp. Ok, fair enough :-)



---

archive/issue_comments_237191.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-03-31T06:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237191",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237192.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-03-31T06:19:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237192",
    "user": "https://github.com/anneschilling"
}
```

New commits:



---

archive/issue_comments_237193.json:
```json
{
    "body": "For the record:\n\n```\nsage: P = IntegerListsLex(n=40, max_slope=0, min_part=1)\nsage: sage: %time x = list(P)\nCPU times: user 14.9 s, sys: 23.7 ms, total: 15 s\nWall time: 15 s\n```\n\n\nThis used to be 12s before I introduced the `Envelope` class. This is\ndue to the fact that we are not using anymore a ConstantFunction for\nthe floor in this case. We could special case that, but this slow down\nshould disappear as soon as `Envelope` will be Cythonized, so I'd say\nthat's good enough for now.\n\nCheers,\n                            Nicolas",
    "created_at": "2015-03-31T06:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237193",
    "user": "https://github.com/nthiery"
}
```

For the record:

```
sage: P = IntegerListsLex(n=40, max_slope=0, min_part=1)
sage: sage: %time x = list(P)
CPU times: user 14.9 s, sys: 23.7 ms, total: 15 s
Wall time: 15 s
```


This used to be 12s before I introduced the `Envelope` class. This is
due to the fact that we are not using anymore a ConstantFunction for
the floor in this case. We could special case that, but this slow down
should disappear as soon as `Envelope` will be Cythonized, so I'd say
that's good enough for now.

Cheers,
                            Nicolas



---

archive/issue_comments_237194.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-31T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237194",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237195.json:
```json
{
    "body": "For the record: with the last commit all long tests pass on sage.math.u-psud.fr (Debian 64 bits)",
    "created_at": "2015-03-31T07:19:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237195",
    "user": "https://github.com/nthiery"
}
```

For the record: with the last commit all long tests pass on sage.math.u-psud.fr (Debian 64 bits)



---

archive/issue_comments_237196.json:
```json
{
    "body": "Replying to [comment:283 nthiery]:\n> I am not sure I have an example under hand that would be finite\n> and not detected as such.\nHere are some:\n\n```\nIntegerListsLex(min_sum=1, floor=[1,2], max_part=1).list()\nIntegerListsLex(min_length=2, max_length=1).list()\n```\n\n\n(after more testing, it looks like these are essentially the *only* examples)",
    "created_at": "2015-03-31T09:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237196",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:283 nthiery]:
> I am not sure I have an example under hand that would be finite
> and not detected as such.
Here are some:

```
IntegerListsLex(min_sum=1, floor=[1,2], max_part=1).list()
IntegerListsLex(min_length=2, max_length=1).list()
```


(after more testing, it looks like these are essentially the *only* examples)



---

archive/issue_comments_237197.json:
```json
{
    "body": "Hello,\n\nThere are several things that I do not quite understand. Could you explain or modify it:\n\n1. The iterator `IntegerListLex` aims to be fast and low-level. What is the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are better than Python lists?\n\n2. Having a nested class seems overkill. The class `_Iter` is created only once in `__iter__`. Moreover, all methods in it starts with `p = self.parent`. Why do you need to create this extra `_Iter` class? Why does it need to be a nested class?\n\n3. Do you have a use case for\n   {{{\n   sage: IntegerListsLex(NN, max_length=3)\n   Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer semiring}\n   }}}\n   The feature only appears once in the doc in a place which does not appear in the reference manual.\n\n4. Why `_check_lexicographic_iterable` is a cached method? And I do not get why is it called from `_Iter` and not at the initialization of `IntegerListsLex`.\n\nVincent",
    "created_at": "2015-03-31T12:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237197",
    "user": "https://github.com/videlec"
}
```

Hello,

There are several things that I do not quite understand. Could you explain or modify it:

1. The iterator `IntegerListLex` aims to be fast and low-level. What is the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are better than Python lists?

2. Having a nested class seems overkill. The class `_Iter` is created only once in `__iter__`. Moreover, all methods in it starts with `p = self.parent`. Why do you need to create this extra `_Iter` class? Why does it need to be a nested class?

3. Do you have a use case for
   {{{
   sage: IntegerListsLex(NN, max_length=3)
   Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer semiring}
   }}}
   The feature only appears once in the doc in a place which does not appear in the reference manual.

4. Why `_check_lexicographic_iterable` is a cached method? And I do not get why is it called from `_Iter` and not at the initialization of `IntegerListsLex`.

Vincent



---

archive/issue_comments_237198.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T05:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237198",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237199.json:
```json
{
    "body": "Salut Vincent!\n\nThanks for the feedback.\n\nOn Tue, Mar 31, 2015 at 12:46:35PM -0000, sage-trac wrote:\n>  There are several things that I do not quite understand. Could you explain\n>  or modify it:\n> \n>  1. The iterator `IntegerListLex` aims to be fast and low-level. What is\n>  the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are\n>  better than Python lists?\n\nWe haven't changed this aspect (in this ticket we focused on\nrefactoring without changing the API): internally, Python lists are\nused; by default, they are converted to ClonableArray upon being\nyielded. The element constructor can be customized to return plain\nlists if so desired.\n\nIn the current state of affairs, this does not really make a\ndifference:\n\n\n```\n# ClonableArray\nsage: L = IntegerListsLex(50, min_part=1, max_slope=0)\nsage: it = iter(L)\nsage: %timeit x = it.next()\n10000 loops, best of 3: 148 \u00b5s per loop\n\n# plain lists\nsage: L = IntegerListsLex(50, min_part=1, max_slope=0, element_constructor=list)\nsage: it = iter(L)\nsage: %timeit x = it.next()\n10000 loops, best of 3: 134 \u00b5s per loop\n```\n\n\nThe overhead comes from the containment test that we do in the ``check``\nmethod:\n\n```\n# ClonableArray, with check made trivial\nsage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)\nsage: sage: it = iter(L)\nsage: sage: %timeit x = it.next()\n10000 loops, best of 3: 135 \u00b5s per loop\n```\n\n\nI am not sure this containment check is useful. We could just disable\nit. What do you think?\n\nFor the record: using the parent/element protocol does not necessarily\ncause a large overhead; ClonableArray is almost as fast as list\n(timings to be of course taken with a grain of salt given how small\nvalues we are speaking about here):\n\n\n```\nsage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)\nsage: l = range(1000)\nsage: %timeit x =list(l)\n100000 loops, best of 3: 2.4 \u00b5s per loop\nsage: c = L.element_class\nsage: %timeit x = c(L, l)\n100000 loops, best of 3: 2.85 \u00b5s per loop\n\nsage: %timeit [x[i] for i in range(100)]\n100000 loops, best of 3: 6.84 \u00b5s per loop\nsage: %timeit [l[i] for i in range(100)]\n100000 loops, best of 3: 5.61 \u00b5s per loop\n```\n\n\n\nIn the long run, when `IntegerListsLex` will be cythonized, the\nrelative situation may change, since we can hope for speedups of\n10-100. Note in particular that we most likely will want to use arrays\nof ints internally; `ClonableIntArray` might be a good candidate for\nthis. Or just STL vectors.\n\n\n>  2. Having a nested class seems overkill. The class `_Iter` is created only\n>  once in `__iter__`. Moreover, all methods in it starts with `p =\n>  self.parent`. Why do you need to create this extra `_Iter` class? Why does\n>  it need to be a nested class?\n\nThe class is needed because the iterator has an internal state. So we\nneed to create a separate object for each concurrently running\niterator.\n\nI find that using a nested class `IntegerListsLex._Iter`, rather than\n`IntegerListsLexIter` makes the relation between the two classes\nexplicit (`_Iter` is for internal use for IntegerListsLex`). It's also\nconsistent with what we do elsewhere (`Element`, ...). And there is no\noverhead in doing so.\n\n\n>  3. Do you have a use case for\n>    {{{\n>    sage: IntegerListsLex(NN, max_length=3)\n>    Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer\n>  semiring}\n>    }}}\n>    The feature only appears once in the doc in a place which does not\n>  appear in the reference manual.\n\nIt does appear in the reference manual: see section `Input list or\niterable for the sum` of the main `IntegerListLex` class.\n\nThe feature of iterating by increasing sum is certainly useful.\nWhether we want the above syntactic sugar -- instead of just using\nDisjointUnionEnumeratedSets -- is indeed questionable. The feature was\nalready there, so we kept it to not change the API in this ticket.\n\n>  4. Why `_check_lexicographic_iterable` is a cached method? And I do not\n>  get why is it called from `_Iter` and not at the initialization of\n>  `IntegerListsLex`.\n\nWe discussed this with Jeroen in some earlier comment. Putting it in\nthe iterator let the user create the `IntegerListsLex` object, even if\nit's not finite/iterable. This could be useful for other things than\niteration, like membership testing or building the corresponding\npolytopes (once #17920 will be available).\n\nWith that, it's natural to cache error-free runs (error runs won't be\ncached) to not redo the work in later iterator constructions.\n\nCheers,\n                           Nicolas",
    "created_at": "2015-04-01T05:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237199",
    "user": "https://github.com/nthiery"
}
```

Salut Vincent!

Thanks for the feedback.

On Tue, Mar 31, 2015 at 12:46:35PM -0000, sage-trac wrote:
>  There are several things that I do not quite understand. Could you explain
>  or modify it:
> 
>  1. The iterator `IntegerListLex` aims to be fast and low-level. What is
>  the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are
>  better than Python lists?

We haven't changed this aspect (in this ticket we focused on
refactoring without changing the API): internally, Python lists are
used; by default, they are converted to ClonableArray upon being
yielded. The element constructor can be customized to return plain
lists if so desired.

In the current state of affairs, this does not really make a
difference:


```
# ClonableArray
sage: L = IntegerListsLex(50, min_part=1, max_slope=0)
sage: it = iter(L)
sage: %timeit x = it.next()
10000 loops, best of 3: 148 µs per loop

# plain lists
sage: L = IntegerListsLex(50, min_part=1, max_slope=0, element_constructor=list)
sage: it = iter(L)
sage: %timeit x = it.next()
10000 loops, best of 3: 134 µs per loop
```


The overhead comes from the containment test that we do in the ``check``
method:

```
# ClonableArray, with check made trivial
sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)
sage: sage: it = iter(L)
sage: sage: %timeit x = it.next()
10000 loops, best of 3: 135 µs per loop
```


I am not sure this containment check is useful. We could just disable
it. What do you think?

For the record: using the parent/element protocol does not necessarily
cause a large overhead; ClonableArray is almost as fast as list
(timings to be of course taken with a grain of salt given how small
values we are speaking about here):


```
sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)
sage: l = range(1000)
sage: %timeit x =list(l)
100000 loops, best of 3: 2.4 µs per loop
sage: c = L.element_class
sage: %timeit x = c(L, l)
100000 loops, best of 3: 2.85 µs per loop

sage: %timeit [x[i] for i in range(100)]
100000 loops, best of 3: 6.84 µs per loop
sage: %timeit [l[i] for i in range(100)]
100000 loops, best of 3: 5.61 µs per loop
```



In the long run, when `IntegerListsLex` will be cythonized, the
relative situation may change, since we can hope for speedups of
10-100. Note in particular that we most likely will want to use arrays
of ints internally; `ClonableIntArray` might be a good candidate for
this. Or just STL vectors.


>  2. Having a nested class seems overkill. The class `_Iter` is created only
>  once in `__iter__`. Moreover, all methods in it starts with `p =
>  self.parent`. Why do you need to create this extra `_Iter` class? Why does
>  it need to be a nested class?

The class is needed because the iterator has an internal state. So we
need to create a separate object for each concurrently running
iterator.

I find that using a nested class `IntegerListsLex._Iter`, rather than
`IntegerListsLexIter` makes the relation between the two classes
explicit (`_Iter` is for internal use for IntegerListsLex`). It's also
consistent with what we do elsewhere (`Element`, ...). And there is no
overhead in doing so.


>  3. Do you have a use case for
>    {{{
>    sage: IntegerListsLex(NN, max_length=3)
>    Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer
>  semiring}
>    }}}
>    The feature only appears once in the doc in a place which does not
>  appear in the reference manual.

It does appear in the reference manual: see section `Input list or
iterable for the sum` of the main `IntegerListLex` class.

The feature of iterating by increasing sum is certainly useful.
Whether we want the above syntactic sugar -- instead of just using
DisjointUnionEnumeratedSets -- is indeed questionable. The feature was
already there, so we kept it to not change the API in this ticket.

>  4. Why `_check_lexicographic_iterable` is a cached method? And I do not
>  get why is it called from `_Iter` and not at the initialization of
>  `IntegerListsLex`.

We discussed this with Jeroen in some earlier comment. Putting it in
the iterator let the user create the `IntegerListsLex` object, even if
it's not finite/iterable. This could be useful for other things than
iteration, like membership testing or building the corresponding
polytopes (once #17920 will be available).

With that, it's natural to cache error-free runs (error runs won't be
cached) to not redo the work in later iterator constructions.

Cheers,
                           Nicolas



---

archive/issue_comments_237200.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T06:09:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237201.json:
```json
{
    "body": "Replying to [comment:290 jdemeyer]:\n> Replying to [comment:283 nthiery]:\n> > I am not sure I have an example under hand that would be finite\n> > and not detected as such.\n> Here are some:\n> {{{\n> IntegerListsLex(min_sum=1, floor=[1,2], max_part=1).list()\n> IntegerListsLex(min_length=2, max_length=1).list()\n> }}}\n> \n> (after more testing, it looks like these are essentially the *only* examples)\n\nCool, in the mean time we fixed both of them. We also looked at your `is_trivialy_zero` function, and we indeed believe that all listed cases there are treated one way or the other.",
    "created_at": "2015-04-01T06:12:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237201",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:290 jdemeyer]:
> Replying to [comment:283 nthiery]:
> > I am not sure I have an example under hand that would be finite
> > and not detected as such.
> Here are some:
> {{{
> IntegerListsLex(min_sum=1, floor=[1,2], max_part=1).list()
> IntegerListsLex(min_length=2, max_length=1).list()
> }}}
> 
> (after more testing, it looks like these are essentially the *only* examples)

Cool, in the mean time we fixed both of them. We also looked at your `is_trivialy_zero` function, and we indeed believe that all listed cases there are treated one way or the other.



---

archive/issue_comments_237202.json:
```json
{
    "body": "Replying to [comment:293 nthiery]:\n>         Salut Vincent!\n> \n> Thanks for the feedback.\n> \n> On Tue, Mar 31, 2015 at 12:46:35PM -0000, sage-trac wrote:\n> >  There are several things that I do not quite understand. Could you explain\n> >  or modify it:\n> > \n> >  1. The iterator `IntegerListLex` aims to be fast and low-level. What is\n> >  the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are\n> >  better than Python lists?\n> \n> We haven't changed this aspect (in this ticket we focused on\n> refactoring without changing the API): internally, Python lists are\n> used; by default, they are converted to ClonableArray upon being\n> yielded. The element constructor can be customized to return plain\n> lists if so desired.\n> \n> In the current state of affairs, this does not really make a\n> difference:\n>\n> ...\n>\n> For the record: using the parent/element protocol does not necessarily\n> cause a large overhead; ClonableArray is almost as fast as list\n> (timings to be of course taken with a grain of salt given how small\n> values we are speaking about here): \n\nI know that it has not changed. If you modify the constructor to return list, the list is copied twice instead of once. I would not call that a solution.\n\nMost importantly, that was not my point. It makes no sense that a plain Python iterator inherit from Parent. It is a question of design, not of timings. The thing is that tuples and lists are the standard Python objects. This is the way the Python module `itertools` behaves. Ideally, the `IntegerListLex` should be plainly Python compatible.\n\n> The overhead comes from the containment test that we do in the ``check``\n> method:\n> {{{\n> # ClonableArray, with check made trivial\n> sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)\n> sage: sage: it = iter(L)\n> sage: sage: %timeit x = it.next()\n> 10000 loops, best of 3: 135 \u00b5s per loop\n> }}}\n> \n> I am not sure this containment check is useful. We could just disable\n> it. What do you think?\n\nDefinitely!\n\n> In the long run, when `IntegerListsLex` will be cythonized, the\n> relative situation may change, since we can hope for speedups of\n> 10-100. Note in particular that we most likely will want to use arrays\n> of ints internally; `ClonableIntArray` might be a good candidate for\n> this. Or just STL vectors.\n\nNote that in Python 3 there are arrays of int (as in numpy in Python 2):\n\n   https://docs.python.org/3/library/array.html\n\nBut I do not think that `itertools` will use that.\n \n> >  2. Having a nested class seems overkill. The class `_Iter` is created only\n> >  once in `__iter__`. Moreover, all methods in it starts with `p =\n> >  self.parent`. Why do you need to create this extra `_Iter` class? Why does\n> >  it need to be a nested class?\n> \n> The class is needed because the iterator has an internal state. So we\n> need to create a separate object for each concurrently running\n> iterator.\n\nRight. But why is it nested? It will be a mess with Cythonization.\n \n> I find that using a nested class `IntegerListsLex._Iter`, rather than\n> `IntegerListsLexIter` makes the relation between the two classes\n> explicit (`_Iter` is for internal use for IntegerListsLex`). It's also\n> consistent with what we do elsewhere (`Element`, ...). And there is no\n> overhead in doing so.\n\nHaving two classes in a file called `IntegerListLex` and `IntegerListLexIterator` is rather explicit. I am not sure that following the Parent/Element direction is the best here. As I said before, it would be cool if this file would be Python compatible.\n\n> >  3. Do you have a use case for\n> >    {{{\n> >    sage: IntegerListsLex(NN, max_length=3)\n> >    Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer\n> >  semiring}\n> >    }}}\n> >    The feature only appears once in the doc in a place which does not\n> >  appear in the reference manual.\n> \n> It does appear in the reference manual: see section `Input list or\n> iterable for the sum` of the main `IntegerListLex` class.\n> \n> The feature of iterating by increasing sum is certainly useful.\n> Whether we want the above syntactic sugar -- instead of just using\n> DisjointUnionEnumeratedSets -- is indeed questionable. The feature was\n> already there, so we kept it to not change the API in this ticket.\n\nIt is reasonable to keep it in the ticket. But what if I do remove it in another ticket?\n \n> >  4. Why `_check_lexicographic_iterable` is a cached method? And I do not\n> >  get why is it called from `_Iter` and not at the initialization of\n> >  `IntegerListsLex`.\n> \n> We discussed this with Jeroen in some earlier comment. Putting it in\n> the iterator let the user create the `IntegerListsLex` object, even if\n> it's not finite/iterable. This could be useful for other things than\n> iteration, like membership testing or building the corresponding\n> polytopes (once #17920 will be available).\n\nRight. (And counting).\n\nVincent",
    "created_at": "2015-04-01T08:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237202",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:293 nthiery]:
>         Salut Vincent!
> 
> Thanks for the feedback.
> 
> On Tue, Mar 31, 2015 at 12:46:35PM -0000, sage-trac wrote:
> >  There are several things that I do not quite understand. Could you explain
> >  or modify it:
> > 
> >  1. The iterator `IntegerListLex` aims to be fast and low-level. What is
> >  the point of using the `Parent`/`Element` stuff? Why `ClonableArray` are
> >  better than Python lists?
> 
> We haven't changed this aspect (in this ticket we focused on
> refactoring without changing the API): internally, Python lists are
> used; by default, they are converted to ClonableArray upon being
> yielded. The element constructor can be customized to return plain
> lists if so desired.
> 
> In the current state of affairs, this does not really make a
> difference:
>
> ...
>
> For the record: using the parent/element protocol does not necessarily
> cause a large overhead; ClonableArray is almost as fast as list
> (timings to be of course taken with a grain of salt given how small
> values we are speaking about here): 

I know that it has not changed. If you modify the constructor to return list, the list is copied twice instead of once. I would not call that a solution.

Most importantly, that was not my point. It makes no sense that a plain Python iterator inherit from Parent. It is a question of design, not of timings. The thing is that tuples and lists are the standard Python objects. This is the way the Python module `itertools` behaves. Ideally, the `IntegerListLex` should be plainly Python compatible.

> The overhead comes from the containment test that we do in the ``check``
> method:
> {{{
> # ClonableArray, with check made trivial
> sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)
> sage: sage: it = iter(L)
> sage: sage: %timeit x = it.next()
> 10000 loops, best of 3: 135 µs per loop
> }}}
> 
> I am not sure this containment check is useful. We could just disable
> it. What do you think?

Definitely!

> In the long run, when `IntegerListsLex` will be cythonized, the
> relative situation may change, since we can hope for speedups of
> 10-100. Note in particular that we most likely will want to use arrays
> of ints internally; `ClonableIntArray` might be a good candidate for
> this. Or just STL vectors.

Note that in Python 3 there are arrays of int (as in numpy in Python 2):

   https://docs.python.org/3/library/array.html

But I do not think that `itertools` will use that.
 
> >  2. Having a nested class seems overkill. The class `_Iter` is created only
> >  once in `__iter__`. Moreover, all methods in it starts with `p =
> >  self.parent`. Why do you need to create this extra `_Iter` class? Why does
> >  it need to be a nested class?
> 
> The class is needed because the iterator has an internal state. So we
> need to create a separate object for each concurrently running
> iterator.

Right. But why is it nested? It will be a mess with Cythonization.
 
> I find that using a nested class `IntegerListsLex._Iter`, rather than
> `IntegerListsLexIter` makes the relation between the two classes
> explicit (`_Iter` is for internal use for IntegerListsLex`). It's also
> consistent with what we do elsewhere (`Element`, ...). And there is no
> overhead in doing so.

Having two classes in a file called `IntegerListLex` and `IntegerListLexIterator` is rather explicit. I am not sure that following the Parent/Element direction is the best here. As I said before, it would be cool if this file would be Python compatible.

> >  3. Do you have a use case for
> >    {{{
> >    sage: IntegerListsLex(NN, max_length=3)
> >    Disjoint union of Lazy family (<lambda>(i))_{i in Non negative integer
> >  semiring}
> >    }}}
> >    The feature only appears once in the doc in a place which does not
> >  appear in the reference manual.
> 
> It does appear in the reference manual: see section `Input list or
> iterable for the sum` of the main `IntegerListLex` class.
> 
> The feature of iterating by increasing sum is certainly useful.
> Whether we want the above syntactic sugar -- instead of just using
> DisjointUnionEnumeratedSets -- is indeed questionable. The feature was
> already there, so we kept it to not change the API in this ticket.

It is reasonable to keep it in the ticket. But what if I do remove it in another ticket?
 
> >  4. Why `_check_lexicographic_iterable` is a cached method? And I do not
> >  get why is it called from `_Iter` and not at the initialization of
> >  `IntegerListsLex`.
> 
> We discussed this with Jeroen in some earlier comment. Putting it in
> the iterator let the user create the `IntegerListsLex` object, even if
> it's not finite/iterable. This could be useful for other things than
> iteration, like membership testing or building the corresponding
> polytopes (once #17920 will be available).

Right. (And counting).

Vincent



---

archive/issue_comments_237203.json:
```json
{
    "body": "Adding extra conditions breaks things:\n\n```\nsage: IntegerListsLex(ceiling=[2], floor=[4]).list()  # good!\n[[]]\nsage: IntegerListsLex(7, ceiling=[2], floor=[4]).list()\n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n",
    "created_at": "2015-04-01T15:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237203",
    "user": "https://github.com/jdemeyer"
}
```

Adding extra conditions breaks things:

```
sage: IntegerListsLex(ceiling=[2], floor=[4]).list()  # good!
[[]]
sage: IntegerListsLex(7, ceiling=[2], floor=[4]).list()
...
ValueError: Could not check that the specified constraints yield a finite set
```




---

archive/issue_comments_237204.json:
```json
{
    "body": "Similarly:\n\n```\nsage: IntegerListsLex(max_part=0).list()\n[[]]\nsage: IntegerListsLex(7, max_part=0).list()\n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n",
    "created_at": "2015-04-01T15:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237204",
    "user": "https://github.com/jdemeyer"
}
```

Similarly:

```
sage: IntegerListsLex(max_part=0).list()
[[]]
sage: IntegerListsLex(7, max_part=0).list()
...
ValueError: Could not check that the specified constraints yield a finite set
```




---

archive/issue_comments_237205.json:
```json
{
    "body": "This is one more example which currently does not work:\n\n```\nsage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()\n```\n",
    "created_at": "2015-04-01T15:35:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237205",
    "user": "https://github.com/jdemeyer"
}
```

This is one more example which currently does not work:

```
sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()
```




---

archive/issue_comments_237206.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-01T15:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237206",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237207.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T16:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237207",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237208.json:
```json
{
    "body": "Replying to [comment:297 jdemeyer]:\n> Adding extra conditions breaks things:\n> {{{\n> sage: IntegerListsLex(ceiling=[2], floor=[4]).list()  # good!\n> [[]]\n> sage: IntegerListsLex(7, ceiling=[2], floor=[4]).list()\n> ...\n> ValueError: Could not check that the specified constraints yield a finite set\n> }}}\n\nOops, sorry, my mistake. I had put the test in the wrong spot. This part should be fixed now.",
    "created_at": "2015-04-01T16:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237208",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:297 jdemeyer]:
> Adding extra conditions breaks things:
> {{{
> sage: IntegerListsLex(ceiling=[2], floor=[4]).list()  # good!
> [[]]
> sage: IntegerListsLex(7, ceiling=[2], floor=[4]).list()
> ...
> ValueError: Could not check that the specified constraints yield a finite set
> }}}

Oops, sorry, my mistake. I had put the test in the wrong spot. This part should be fixed now.



---

archive/issue_comments_237209.json:
```json
{
    "body": "Please use `....:` for doctest continuation (see patchbot report)",
    "created_at": "2015-04-01T17:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237209",
    "user": "https://github.com/fchapoton"
}
```

Please use `....:` for doctest continuation (see patchbot report)



---

archive/issue_comments_237210.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T18:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237211.json:
```json
{
    "body": "On Wed, Apr 01, 2015 at 08:15:51AM -0000, sage-trac wrote:\n>  I know that it has not changed.\n\nThen please discuss this in another ticket to not delay this one.\n\n> If you modify the constructor to return list, the list is copied\n>  twice instead of once. I would not call that a solution.\n\nIt's trivial to introduce a special case to avoid the copy if the\nelement constructor is known to be safe. In fact it's done now.\n\n>  Most importantly, that was not my point. It makes no sense that a plain\n>  Python iterator inherit from Parent. It is a question of design, not of\n>  timings. The thing is that tuples and lists are the standard Python\n>  objects. This is the way the Python module `itertools` behaves. Ideally,\n>  the `IntegerListLex` should be plainly Python compatible.\n\n(for the record, the iterator itself does not inherit from Parent).\n\nI would go even further than you: IntegerListsLex uses nothing\nspecific of Python either. It would be best implemented as a\nstandalone C++ library. It could then be reused by software outside of\nthe Python world, be templated by whatever structure we want to use\nfor the lists, possibly benefit from further low level optimizations\n(silk, special processor instructions), etc.\n\nBut this discussion belongs to later tickets. Here the goal is to get\na correct algorithm. The next step is to get an algorithm with\nreasonably optimal complexity (while further clarifying its\nstructure). And then should come the rewriting in a low level\nlanguage.\n\n>  > The overhead comes from the containment test that we do in the ``check``\n>  > method:\n>  > {{{\n>  > # ClonableArray, with check made trivial\n>  > sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)\n>  > sage: sage: it = iter(L)\n>  > sage: sage: %timeit x = it.next()\n>  > 10000 loops, best of 3: 135 \u00b5s per loop\n>  > }}}\n>  >\n>  > I am not sure this containment check is useful. We could just disable\n>  > it. What do you think?\n> \n>  Definitely!\n\nDone. Easy to revert if anyone is uncomfortable with this.\n\n>  Right. But why is it nested? It will be a mess with Cythonization.\n\nAt the end, it's all about stylistic preference. It's instantaneous to\nchange if/when desired. Whoever will work next on this can change to\nhis own preferred style. I am not discussing this further.\n\n>  Having two classes in a file called `IntegerListLex` and\n>  `IntegerListLexIterator` is rather explicit. I am not sure that following\n>  the Parent/Element direction is the best here. As I said before, it would\n>  be cool if this file would be Python compatible.\n\nNested classes are a feature of plain Python, and of many other\nprogramming languages. It turns out that Cython does not support them\nnow, but I don't see any theoretical obstruction (and it can be easily\nemulated).\n\nAltogether I see no compelling reason not to use this feature when it\nhelps better structure the code.\n\n>  It is reasonable to keep it in the ticket. But what if I do remove\n>  it in another ticket?\n\nI don't have an objection if someone takes the responsibility for this\nbackward incompatible change in a later ticket :-)\n\nOr maybe, if the use case emerges, one should actually go the other\nway round: make it syntactically trivial to have variants of\nIntegerListsLex, graded by any or both of the length and size\nparameters: it's not as generic as DisjointUnionEnumeratedSets, but\nthis could save on time by sharing quite some stuff between the graded\ncomponents (e.g. the parsing of the arguments, the upper and lower\nenvelopes, ...).\n\nCheers,\n\t\t\t\tNicolas",
    "created_at": "2015-04-01T18:25:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237211",
    "user": "https://github.com/nthiery"
}
```

On Wed, Apr 01, 2015 at 08:15:51AM -0000, sage-trac wrote:
>  I know that it has not changed.

Then please discuss this in another ticket to not delay this one.

> If you modify the constructor to return list, the list is copied
>  twice instead of once. I would not call that a solution.

It's trivial to introduce a special case to avoid the copy if the
element constructor is known to be safe. In fact it's done now.

>  Most importantly, that was not my point. It makes no sense that a plain
>  Python iterator inherit from Parent. It is a question of design, not of
>  timings. The thing is that tuples and lists are the standard Python
>  objects. This is the way the Python module `itertools` behaves. Ideally,
>  the `IntegerListLex` should be plainly Python compatible.

(for the record, the iterator itself does not inherit from Parent).

I would go even further than you: IntegerListsLex uses nothing
specific of Python either. It would be best implemented as a
standalone C++ library. It could then be reused by software outside of
the Python world, be templated by whatever structure we want to use
for the lists, possibly benefit from further low level optimizations
(silk, special processor instructions), etc.

But this discussion belongs to later tickets. Here the goal is to get
a correct algorithm. The next step is to get an algorithm with
reasonably optimal complexity (while further clarifying its
structure). And then should come the rewriting in a low level
language.

>  > The overhead comes from the containment test that we do in the ``check``
>  > method:
>  > {{{
>  > # ClonableArray, with check made trivial
>  > sage: sage: L = IntegerListsLex(50, min_part=1, max_slope=0)
>  > sage: sage: it = iter(L)
>  > sage: sage: %timeit x = it.next()
>  > 10000 loops, best of 3: 135 µs per loop
>  > }}}
>  >
>  > I am not sure this containment check is useful. We could just disable
>  > it. What do you think?
> 
>  Definitely!

Done. Easy to revert if anyone is uncomfortable with this.

>  Right. But why is it nested? It will be a mess with Cythonization.

At the end, it's all about stylistic preference. It's instantaneous to
change if/when desired. Whoever will work next on this can change to
his own preferred style. I am not discussing this further.

>  Having two classes in a file called `IntegerListLex` and
>  `IntegerListLexIterator` is rather explicit. I am not sure that following
>  the Parent/Element direction is the best here. As I said before, it would
>  be cool if this file would be Python compatible.

Nested classes are a feature of plain Python, and of many other
programming languages. It turns out that Cython does not support them
now, but I don't see any theoretical obstruction (and it can be easily
emulated).

Altogether I see no compelling reason not to use this feature when it
helps better structure the code.

>  It is reasonable to keep it in the ticket. But what if I do remove
>  it in another ticket?

I don't have an objection if someone takes the responsibility for this
backward incompatible change in a later ticket :-)

Or maybe, if the use case emerges, one should actually go the other
way round: make it syntactically trivial to have variants of
IntegerListsLex, graded by any or both of the length and size
parameters: it's not as generic as DisjointUnionEnumeratedSets, but
this could save on time by sharing quite some stuff between the graded
components (e.g. the parsing of the arguments, the upper and lower
envelopes, ...).

Cheers,
				Nicolas



---

archive/issue_comments_237212.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T19:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237212",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237213.json:
```json
{
    "body": "Replying to [comment:303 chapoton]:\n> Please use `....:` for doctest continuation (see patchbot report)\n\nFixed, I believe.",
    "created_at": "2015-04-01T19:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237213",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:303 chapoton]:
> Please use `....:` for doctest continuation (see patchbot report)

Fixed, I believe.



---

archive/issue_comments_237214.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-01T19:26:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237214",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237215.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-01T20:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237215",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237216.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-01T21:47:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237216",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237217.json:
```json
{
    "body": "Replying to [comment:298 jdemeyer]:\n> Similarly:\n> {{{\n> sage: IntegerListsLex(max_part=0).list()\n> [[]]\n> sage: IntegerListsLex(7, max_part=0).list()\n> ...\n> ValueError: Could not check that the specified constraints yield a finite set\n> }}}\n\nFixed.",
    "created_at": "2015-04-01T21:48:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237217",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:298 jdemeyer]:
> Similarly:
> {{{
> sage: IntegerListsLex(max_part=0).list()
> [[]]
> sage: IntegerListsLex(7, max_part=0).list()
> ...
> ValueError: Could not check that the specified constraints yield a finite set
> }}}

Fixed.



---

archive/issue_comments_237218.json:
```json
{
    "body": "Replying to [comment:299 jdemeyer]:\n> This is one more example which currently does not work:\n> {{{\n> sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()\n> }}}\n\nThe current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.",
    "created_at": "2015-04-01T21:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237218",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:299 jdemeyer]:
> This is one more example which currently does not work:
> {{{
> sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()
> }}}

The current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.



---

archive/issue_comments_237219.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-01T21:54:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237219",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237220.json:
```json
{
    "body": "Replying to [comment:312 aschilling]:\n> Replying to [comment:299 jdemeyer]:\n> > This is one more example which currently does not work:\n> > {{{\n> > sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()\n> > }}}\n> \n> The current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.\n\nSorry, I obviously meant\n\n```\nsage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()\n```\n\nwhich should have an empty output.",
    "created_at": "2015-04-02T08:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237220",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:312 aschilling]:
> Replying to [comment:299 jdemeyer]:
> > This is one more example which currently does not work:
> > {{{
> > sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()
> > }}}
> 
> The current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.

Sorry, I obviously meant

```
sage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()
```

which should have an empty output.



---

archive/issue_comments_237221.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-02T11:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237221",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237222.json:
```json
{
    "body": "Another case of \"adding a constraint break things\":\n\n```\nsage: IntegerListsLex(max_sum=1, min_sum=4).list()\n[]\nsage: IntegerListsLex(max_sum=1, min_sum=4, min_slope=0).list()\n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n",
    "created_at": "2015-04-02T11:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237222",
    "user": "https://github.com/jdemeyer"
}
```

Another case of "adding a constraint break things":

```
sage: IntegerListsLex(max_sum=1, min_sum=4).list()
[]
sage: IntegerListsLex(max_sum=1, min_sum=4, min_slope=0).list()
...
ValueError: Could not check that the specified constraints yield a finite set
```




---

archive/issue_comments_237223.json:
```json
{
    "body": "Design comment: the code for `Envelope` has a lot of duplication because it needs to deal with upper and lower bounds. Instead, I would propose to have `Envelope` deal *only* with upper bounds. The `Envelope` for the lower bound could then be implemented by adding minus signs in the input and output of `Envelope`.",
    "created_at": "2015-04-02T13:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237223",
    "user": "https://github.com/jdemeyer"
}
```

Design comment: the code for `Envelope` has a lot of duplication because it needs to deal with upper and lower bounds. Instead, I would propose to have `Envelope` deal *only* with upper bounds. The `Envelope` for the lower bound could then be implemented by adding minus signs in the input and output of `Envelope`.



---

archive/issue_comments_237224.json:
```json
{
    "body": "The code in `IntegerListsLex.__init__` could be simplified.\n\nCompare this from #17920:\n\n```\n        if n is not None:\n            n = integer_or_infinity(n)\n            min_sum = n\n            max_sum = n\n            # Set self.n, which is not used by IntegerLists_polyhedron,\n            # but by some derived classes\n            self.n = n\n\n        if length is not None:\n            min_length = length\n            max_length = length\n\n        if min_length < 0:\n            min_length = 0\n\n        self.min_sum = integer_or_infinity(min_sum)\n        self.max_sum = integer_or_infinity(max_sum)\n        self.min_length = integer_or_infinity(min_length)\n        self.max_length = integer_or_infinity(max_length)\n        self.min_part = integer_or_infinity(min_part)\n        self.max_part = integer_or_infinity(max_part)\n        self.min_slope = integer_or_infinity(min_slope)\n        self.max_slope = integer_or_infinity(max_slope)\n```\n\nto this from #17979:\n\n```\n        if n is not None:\n            n = ZZ(n)\n            self._min_sum = n\n            self._max_sum = n\n        else:\n            self._min_sum = min_sum\n            self._max_sum = max_sum\n\n        if length is not None:\n            length = ZZ(length)\n            min_length = length\n            max_length = length\n        else:\n            min_length = ZZ(min_length)\n            if min_length < 0:\n                min_length = 0\n            if max_length != Infinity:\n                max_length = ZZ(max_length)\n        self._max_length = max_length\n        self._min_length = min_length\n\n        if min_slope != -Infinity:\n            min_slope = ZZ(min_slope)\n        self._min_slope = min_slope\n        if max_slope != Infinity:\n            max_slope = ZZ(max_slope)\n        self._max_slope = max_slope\n\n        min_part = ZZ(min_part)\n        if min_part < 0:\n            raise NotImplementedError(\"strictly negative min_part\")\n\n        if max_part != Infinity:\n            max_part = ZZ(max_part)\n```\n",
    "created_at": "2015-04-02T13:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237224",
    "user": "https://github.com/jdemeyer"
}
```

The code in `IntegerListsLex.__init__` could be simplified.

Compare this from #17920:

```
        if n is not None:
            n = integer_or_infinity(n)
            min_sum = n
            max_sum = n
            # Set self.n, which is not used by IntegerLists_polyhedron,
            # but by some derived classes
            self.n = n

        if length is not None:
            min_length = length
            max_length = length

        if min_length < 0:
            min_length = 0

        self.min_sum = integer_or_infinity(min_sum)
        self.max_sum = integer_or_infinity(max_sum)
        self.min_length = integer_or_infinity(min_length)
        self.max_length = integer_or_infinity(max_length)
        self.min_part = integer_or_infinity(min_part)
        self.max_part = integer_or_infinity(max_part)
        self.min_slope = integer_or_infinity(min_slope)
        self.max_slope = integer_or_infinity(max_slope)
```

to this from #17979:

```
        if n is not None:
            n = ZZ(n)
            self._min_sum = n
            self._max_sum = n
        else:
            self._min_sum = min_sum
            self._max_sum = max_sum

        if length is not None:
            length = ZZ(length)
            min_length = length
            max_length = length
        else:
            min_length = ZZ(min_length)
            if min_length < 0:
                min_length = 0
            if max_length != Infinity:
                max_length = ZZ(max_length)
        self._max_length = max_length
        self._min_length = min_length

        if min_slope != -Infinity:
            min_slope = ZZ(min_slope)
        self._min_slope = min_slope
        if max_slope != Infinity:
            max_slope = ZZ(max_slope)
        self._max_slope = max_slope

        min_part = ZZ(min_part)
        if min_part < 0:
            raise NotImplementedError("strictly negative min_part")

        if max_part != Infinity:
            max_part = ZZ(max_part)
```




---

archive/issue_comments_237225.json:
```json
{
    "body": "The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`",
    "created_at": "2015-04-02T13:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237225",
    "user": "https://github.com/jdemeyer"
}
```

The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`



---

archive/issue_comments_237226.json:
```json
{
    "body": "The `global_options` is undocumented and is used only there:\n\n\n```\nif global_options is not None:\n    self.global_options = global_options\n```\n\n\nAlso (see Jeroen's message) the following line\n\n```\nif min_length < 0:\n    min_length = 0\n```\n\n\nCan be rewritten as `min_length=max(min_length,0)`.\n\nNathann",
    "created_at": "2015-04-02T13:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237226",
    "user": "https://github.com/nathanncohen"
}
```

The `global_options` is undocumented and is used only there:


```
if global_options is not None:
    self.global_options = global_options
```


Also (see Jeroen's message) the following line

```
if min_length < 0:
    min_length = 0
```


Can be rewritten as `min_length=max(min_length,0)`.

Nathann



---

archive/issue_comments_237227.json:
```json
{
    "body": "This should either return `[]` or raise a `ValueError` saying that `min_sum=Infinity` is not allowed:\n\n```\nsage: IntegerListsLex(min_sum=Infinity).list()           \n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n",
    "created_at": "2015-04-02T13:53:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237227",
    "user": "https://github.com/jdemeyer"
}
```

This should either return `[]` or raise a `ValueError` saying that `min_sum=Infinity` is not allowed:

```
sage: IntegerListsLex(min_sum=Infinity).list()           
...
ValueError: Could not check that the specified constraints yield a finite set
```




---

archive/issue_comments_237228.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T13:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237228",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237229.json:
```json
{
    "body": "Replying to [comment:319 ncohen]:\n> The `global_options` is undocumented and is used only there:\n> \n> {{{\n> if global_options is not None:\n>     self.global_options = global_options\n> }}}\nIt is actually used by `Partitions`. Given that this is not a regression, I don't consider this a problem.",
    "created_at": "2015-04-02T13:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237229",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:319 ncohen]:
> The `global_options` is undocumented and is used only there:
> 
> {{{
> if global_options is not None:
>     self.global_options = global_options
> }}}
It is actually used by `Partitions`. Given that this is not a regression, I don't consider this a problem.



---

archive/issue_comments_237230.json:
```json
{
    "body": "\n```\ndef _check_lexicographic_iterable(self):\n        \"\"\"\n        Check whether the constraints give a finite set.\n```\n\n\nIf this function checks that the constraints give a finite set, could you pick a name for it which reflects it ?\n\nNathann",
    "created_at": "2015-04-02T14:20:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237230",
    "user": "https://github.com/nathanncohen"
}
```


```
def _check_lexicographic_iterable(self):
        """
        Check whether the constraints give a finite set.
```


If this function checks that the constraints give a finite set, could you pick a name for it which reflects it ?

Nathann



---

archive/issue_comments_237231.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T14:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237232.json:
```json
{
    "body": "The first lines of `_check_lexicographic_iterable` are `if self._warning or not self._check: return`.\n\nIt sounds a bit wrong that the check function would do nothing when explicitly asked to. Instead of stopping early in this situation, could you remove those two lines and only call the function when you mean to?\n\nThis would give the function its original meaning: check the data.\n\nNote that the function is only called once.\n\nNathann",
    "created_at": "2015-04-02T14:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237232",
    "user": "https://github.com/nathanncohen"
}
```

The first lines of `_check_lexicographic_iterable` are `if self._warning or not self._check: return`.

It sounds a bit wrong that the check function would do nothing when explicitly asked to. Instead of stopping early in this situation, could you remove those two lines and only call the function when you mean to?

This would give the function its original meaning: check the data.

Note that the function is only called once.

Nathann



---

archive/issue_comments_237233.json:
```json
{
    "body": "The function `_possible_m(self, m, j, min_sum, max_sum)` takes four parameters, all of which are attributes of `self`.\n\n\n```\nif self._next_state == LOOKAHEAD:\n    m = self._current_list[-1]\n    if self._possible_m(m, self._j,\n       min_sum - (self._current_sum-m),\n       max_sum - (self._current_sum-m)):\n```\n\n\nIt would make more sense to me if this function had no arguments at all.",
    "created_at": "2015-04-02T14:45:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237233",
    "user": "https://github.com/nathanncohen"
}
```

The function `_possible_m(self, m, j, min_sum, max_sum)` takes four parameters, all of which are attributes of `self`.


```
if self._next_state == LOOKAHEAD:
    m = self._current_list[-1]
    if self._possible_m(m, self._j,
       min_sum - (self._current_sum-m),
       max_sum - (self._current_sum-m)):
```


It would make more sense to me if this function had no arguments at all.



---

archive/issue_comments_237234.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T14:55:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237235.json:
```json
{
    "body": "Replying to [comment:325 ncohen]:\n> The first lines of `_check_lexicographic_iterable` are `if self._warning or not self._check: return`.\n> \n> It sounds a bit wrong that the check function would do nothing when explicitly asked to. Instead of stopping early in this situation, could you remove those two lines and only call the function when you mean to?\n> \n> This would give the function its original meaning: check the data.\n+1",
    "created_at": "2015-04-02T15:00:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237235",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:325 ncohen]:
> The first lines of `_check_lexicographic_iterable` are `if self._warning or not self._check: return`.
> 
> It sounds a bit wrong that the check function would do nothing when explicitly asked to. Instead of stopping early in this situation, could you remove those two lines and only call the function when you mean to?
> 
> This would give the function its original meaning: check the data.
+1



---

archive/issue_comments_237236.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T15:05:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237236",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237237.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-04-02T15:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237237",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_237238.json:
```json
{
    "body": "(my last commit was breaking stuff. I removed it)",
    "created_at": "2015-04-02T15:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237238",
    "user": "https://github.com/nathanncohen"
}
```

(my last commit was breaking stuff. I removed it)



---

archive/issue_comments_237239.json:
```json
{
    "body": "Replying to [comment:318 jdemeyer]:\n> The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`\n\nWhy? That breaks a lot of tests.",
    "created_at": "2015-04-02T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237239",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:318 jdemeyer]:
> The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`

Why? That breaks a lot of tests.



---

archive/issue_comments_237240.json:
```json
{
    "body": "Replying to [comment:314 jdemeyer]:\n> Replying to [comment:312 aschilling]:\n> > Replying to [comment:299 jdemeyer]:\n> > > This is one more example which currently does not work:\n> > > {{{\n> > > sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()\n> > > }}}\n> > \n> > The current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.\n> \n> Sorry, I obviously meant\n> {{{\n> sage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()\n> }}}\n> which should have an empty output.\n\nEven in this case, I think Sage is currently correct, unless you can define what Infinity-Infinity is (which would be used in the slope conditions).",
    "created_at": "2015-04-02T18:42:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237240",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:314 jdemeyer]:
> Replying to [comment:312 aschilling]:
> > Replying to [comment:299 jdemeyer]:
> > > This is one more example which currently does not work:
> > > {{{
> > > sage: IntegerListsLex(length=1, max_slope=0, min_slope=1).list()
> > > }}}
> > 
> > The current output is correct, isn't it? [Infinity] would be the output in inverse lexicographic order, which results in the error message that m is unbounded.
> 
> Sorry, I obviously meant
> {{{
> sage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()
> }}}
> which should have an empty output.

Even in this case, I think Sage is currently correct, unless you can define what Infinity-Infinity is (which would be used in the slope conditions).



---

archive/issue_comments_237241.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T18:46:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237242.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-02T18:56:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237242",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237243.json:
```json
{
    "body": "Replying to [comment:315 jdemeyer]:\n> Another case of \"adding a constraint break things\":\n> {{{\n> sage: IntegerListsLex(max_sum=1, min_sum=4).list()\n> []\n> sage: IntegerListsLex(max_sum=1, min_sum=4, min_slope=0).list()\n> ...\n> ValueError: Could not check that the specified constraints yield a finite set\n> }}}\n\nFixed.",
    "created_at": "2015-04-02T18:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237243",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:315 jdemeyer]:
> Another case of "adding a constraint break things":
> {{{
> sage: IntegerListsLex(max_sum=1, min_sum=4).list()
> []
> sage: IntegerListsLex(max_sum=1, min_sum=4, min_slope=0).list()
> ...
> ValueError: Could not check that the specified constraints yield a finite set
> }}}

Fixed.



---

archive/issue_comments_237244.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-02T19:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237244",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237245.json:
```json
{
    "body": "Replying to [comment:332 aschilling]:\n> Replying to [comment:318 jdemeyer]:\n> > The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`\n> \n> Why?\nBecause it is really more logical that such a check would happen in the parent before creating the iterator. The iterator should just iterate. The check belongs to the code *creating* the iterator. Also, the `check_finiteness` refers a lot to attributes of the parent, which means that it really belongs there.",
    "created_at": "2015-04-02T21:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237245",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:332 aschilling]:
> Replying to [comment:318 jdemeyer]:
> > The call to `_check_lexicographic_iterable` should be moved to `IntegerListsLex.__iter__`
> 
> Why?
Because it is really more logical that such a check would happen in the parent before creating the iterator. The iterator should just iterate. The check belongs to the code *creating* the iterator. Also, the `check_finiteness` refers a lot to attributes of the parent, which means that it really belongs there.



---

archive/issue_comments_237246.json:
```json
{
    "body": "Replying to [comment:333 aschilling]:\n> > Sorry, I obviously meant\n> > {{{\n> > sage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()\n> > }}}\n> > which should have an empty output.\n> \n> Even in this case, I think Sage is currently correct\nSage is indeed correct that there is an infinite upper bound for `part[0]`. However, my point is that the resulting list is still finite, so this example could work.\n\n> unless you can define what Infinity-Infinity is (which would be used in the slope conditions).\nI don't see why I would need to define Infinity - Infinity for this. My point is that the set of lists satisfying those constraints is clearly empty.",
    "created_at": "2015-04-02T21:14:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237246",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:333 aschilling]:
> > Sorry, I obviously meant
> > {{{
> > sage: IntegerListsLex(length=2, max_slope=0, min_slope=1).list()
> > }}}
> > which should have an empty output.
> 
> Even in this case, I think Sage is currently correct
Sage is indeed correct that there is an infinite upper bound for `part[0]`. However, my point is that the resulting list is still finite, so this example could work.

> unless you can define what Infinity-Infinity is (which would be used in the slope conditions).
I don't see why I would need to define Infinity - Infinity for this. My point is that the set of lists satisfying those constraints is clearly empty.



---

archive/issue_comments_237247.json:
```json
{
    "body": "Replying to [comment:334 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[58dced5](http://git.sagemath.org/sage.git/commit/?id=58dced5c7b2eab36e50ba5df66d5cc562b14b2a8)||`17979 address some review comments`||\n\nYou *literally* added just a check for `min_sum == Infinity`? That's just completely inconsistent with the rest of the code. Please look at `IntegerListsLex.__init__`. Really, do it. You will agree that it's an ugly mess, see also [comment:317] (which just got worse).",
    "created_at": "2015-04-02T21:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237247",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:334 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[58dced5](http://git.sagemath.org/sage.git/commit/?id=58dced5c7b2eab36e50ba5df66d5cc562b14b2a8)||`17979 address some review comments`||

You *literally* added just a check for `min_sum == Infinity`? That's just completely inconsistent with the rest of the code. Please look at `IntegerListsLex.__init__`. Really, do it. You will agree that it's an ugly mess, see also [comment:317] (which just got worse).



---

archive/issue_comments_237248.json:
```json
{
    "body": "> see also [comment:317] (which just got worse).\n\nAnd [comment:319] and [comment:326] as well.\n\nNathann",
    "created_at": "2015-04-02T21:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237248",
    "user": "https://github.com/nathanncohen"
}
```

> see also [comment:317] (which just got worse).

And [comment:319] and [comment:326] as well.

Nathann



---

archive/issue_comments_237249.json:
```json
{
    "body": "Replying to [comment:321 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[c9a047c](http://git.sagemath.org/sage.git/commit/?id=c9a047c28105498403b2ca2983a695ca9928beb8)||`trac #17979: Move imports to the (only) place in which they are used`||\n\nFor the import of plain Python modules, I don't really see the\npoint. It's very unlikely that we will save on Sage startup time. On\nthe other hand, for e.g. `import collections`, we will pay a (small)\npenalty each time an `IntegerListsLex` object is created.\n\n> ||[c5f8c92](http://git.sagemath.org/sage.git/commit/?id=c5f8c92e14e3a507f262799872902bf3d0b720df)||`trac #17979: Replace |l| with sum(l) as it is only used twice`||\n\nAgreed for using `sum(l)` instead of `|l|` as notation.\n\nOn the other hand, I found useful to mention all the relevant\nparameters on which we will put constraints in the introductory\nparagraph, even if they are indeed trivial. Please revert if you agree\nwith that.\n\nCheers,\n                           Nicolas",
    "created_at": "2015-04-03T03:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237249",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:321 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[c9a047c](http://git.sagemath.org/sage.git/commit/?id=c9a047c28105498403b2ca2983a695ca9928beb8)||`trac #17979: Move imports to the (only) place in which they are used`||

For the import of plain Python modules, I don't really see the
point. It's very unlikely that we will save on Sage startup time. On
the other hand, for e.g. `import collections`, we will pay a (small)
penalty each time an `IntegerListsLex` object is created.

> ||[c5f8c92](http://git.sagemath.org/sage.git/commit/?id=c5f8c92e14e3a507f262799872902bf3d0b720df)||`trac #17979: Replace |l| with sum(l) as it is only used twice`||

Agreed for using `sum(l)` instead of `|l|` as notation.

On the other hand, I found useful to mention all the relevant
parameters on which we will put constraints in the introductory
paragraph, even if they are indeed trivial. Please revert if you agree
with that.

Cheers,
                           Nicolas



---

archive/issue_comments_237250.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T03:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237250",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237251.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T04:01:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237251",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237252.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T04:06:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237252",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237253.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T04:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237253",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237254.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T04:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237254",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237255.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T04:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237255",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237256.json:
```json
{
    "body": "Replying to [comment:326 ncohen]:\n> The function `_possible_m(self, m, j, min_sum, max_sum)` takes four parameters, all of which are attributes of `self`.\n> \n> {{{\n> if self._next_state == LOOKAHEAD:\n>     m = self._current_list[-1]\n>     if self._possible_m(m, self._j,\n>        min_sum - (self._current_sum-m),\n>        max_sum - (self._current_sum-m)):\n> }}}\n> \n> It would make more sense to me if this function had no arguments at all.\n\nI agree that this should eventually become an argument-less\n`look_ahead` method that tests if the current list could possibly be a\nprefix of some valid list.\n\nI would like to postpone this change to #18055 however: anyway this\nmethod will need to be rewritten there (in particular to handle an\nempty `current_list`), and changing the interface now would require\nrewriting most of the current tests of `_possible_m` to construct a\nbunch of different IntegerListsLex objects instead of just passing\nvarious arguments. Note also that, as specified in the doc, `min_sum`\nand `max_sum` do not exactly match the corresponding attributes: they\nare bounds on the tail of the list only (agreed, the difference above\ncould be done in _possible_m).\n\nCheers,\n                                      Nicolas",
    "created_at": "2015-04-03T04:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237256",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:326 ncohen]:
> The function `_possible_m(self, m, j, min_sum, max_sum)` takes four parameters, all of which are attributes of `self`.
> 
> {{{
> if self._next_state == LOOKAHEAD:
>     m = self._current_list[-1]
>     if self._possible_m(m, self._j,
>        min_sum - (self._current_sum-m),
>        max_sum - (self._current_sum-m)):
> }}}
> 
> It would make more sense to me if this function had no arguments at all.

I agree that this should eventually become an argument-less
`look_ahead` method that tests if the current list could possibly be a
prefix of some valid list.

I would like to postpone this change to #18055 however: anyway this
method will need to be rewritten there (in particular to handle an
empty `current_list`), and changing the interface now would require
rewriting most of the current tests of `_possible_m` to construct a
bunch of different IntegerListsLex objects instead of just passing
various arguments. Note also that, as specified in the doc, `min_sum`
and `max_sum` do not exactly match the corresponding attributes: they
are bounds on the tail of the list only (agreed, the difference above
could be done in _possible_m).

Cheers,
                                      Nicolas



---

archive/issue_comments_237257.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T05:24:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237257",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237258.json:
```json
{
    "body": "Replying to [comment:317 jdemeyer]:\n> The code in `IntegerListsLex.__init__` could be simplified.\n\nDone. Thanks for the for #17920' model.\n\nI ended up not using `integer_or_infinity`: here I prefer to not\naccept both `-oo` and `+oo` when only one makes sense, and having two\nfunctions (or one with parameters) seemed like overkill. This is\nexplicit and simple enough:\n\n\n```\n    self._max_length = ZZ(max_length) if max_length != Infinity else max_length\n```\n\n\nCheers,\n                          Nicolas",
    "created_at": "2015-04-03T05:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237258",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:317 jdemeyer]:
> The code in `IntegerListsLex.__init__` could be simplified.

Done. Thanks for the for #17920' model.

I ended up not using `integer_or_infinity`: here I prefer to not
accept both `-oo` and `+oo` when only one makes sense, and having two
functions (or one with parameters) seemed like overkill. This is
explicit and simple enough:


```
    self._max_length = ZZ(max_length) if max_length != Infinity else max_length
```


Cheers,
                          Nicolas



---

archive/issue_comments_237259.json:
```json
{
    "body": "Replying to [comment:341 ncohen]:\n> And [comment:319] ...\n\nIn [comment:322] Jeroen agreed above that 319 was in fact ok.",
    "created_at": "2015-04-03T05:33:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237259",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:341 ncohen]:
> And [comment:319] ...

In [comment:322] Jeroen agreed above that 319 was in fact ok.



---

archive/issue_comments_237260.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T07:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237260",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237261.json:
```json
{
    "body": "Replying to [comment:316 jdemeyer]:\n> Design comment: the code for `Envelope` has a lot of duplication because it needs to deal with upper and lower bounds. Instead, I would propose to have `Envelope` deal *only* with upper bounds. The `Envelope` for the lower bound could then be implemented by adding minus signs in the input and output of `Envelope`.\n\nI am also not so happy about this. I had considered doing something\nalong the lines you propose, and ended up dropping it for now. This is\nmainly because, in the next step, the main functionality to add will\nbe the computation of the area below the envelope for which we won't\nhave this symmetry anymore. Also, at this point, we are speaking about\n5-6 lines of code that are duplicated very locally. Doing the magic\nwould not take much less than this, and the code would be less\nstraightforward. Sooo, well.",
    "created_at": "2015-04-03T08:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237261",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:316 jdemeyer]:
> Design comment: the code for `Envelope` has a lot of duplication because it needs to deal with upper and lower bounds. Instead, I would propose to have `Envelope` deal *only* with upper bounds. The `Envelope` for the lower bound could then be implemented by adding minus signs in the input and output of `Envelope`.

I am also not so happy about this. I had considered doing something
along the lines you propose, and ended up dropping it for now. This is
mainly because, in the next step, the main functionality to add will
be the computation of the area below the envelope for which we won't
have this symmetry anymore. Also, at this point, we are speaking about
5-6 lines of code that are duplicated very locally. Doing the magic
would not take much less than this, and the code would be less
straightforward. Sooo, well.



---

archive/issue_comments_237262.json:
```json
{
    "body": "I believe all the comments have been taken care of. Back to needs review!\n\nNathann: in case you are around, I am roughly in my office until 2pm.",
    "created_at": "2015-04-03T08:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237262",
    "user": "https://github.com/nthiery"
}
```

I believe all the comments have been taken care of. Back to needs review!

Nathann: in case you are around, I am roughly in my office until 2pm.



---

archive/issue_comments_237263.json:
```json
{
    "body": "Hello,\n\n> In [comment:322] Jeroen agreed above that 319 was in fact ok.\n\nMany times in the past I had to fix code which accepts a `**kwds`\nand did not check that what it contains is actually read. This\nlead to silent errors or wrong output, and so I see\nthings like `global_options` as the highway to bugs.\n\nJeroen noted that this variable is actually used somewhere else,\nso I guess it probably should not be removed in this ticket. My\ncomment at [comment:319] still need to be adressed, however, as\nthere is no documentation for this parameter. Please make it\nexplain the uses of this flag, possibly by pointing to some other\npart of the doc if it is already explained somewhere else.\n\n> > The function `_possible_m(self, m, j, min_sum, max_sum)`\n> > takes four parameters, all of which are attributes of `self`.\n>\n> I  agree that  this should  eventually become  an argument-less\n> `look_ahead`  method  that  tests  if the  current  list  could\n> possibly  be a  prefix of  some valid  list.  I  would like  to\n> postpone this change to #18055 however\n\nAs the method appears in this branch, I see no reason to let it\nbe corrected in a future ticket.\n\nNathann",
    "created_at": "2015-04-03T08:15:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237263",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> In [comment:322] Jeroen agreed above that 319 was in fact ok.

Many times in the past I had to fix code which accepts a `**kwds`
and did not check that what it contains is actually read. This
lead to silent errors or wrong output, and so I see
things like `global_options` as the highway to bugs.

Jeroen noted that this variable is actually used somewhere else,
so I guess it probably should not be removed in this ticket. My
comment at [comment:319] still need to be adressed, however, as
there is no documentation for this parameter. Please make it
explain the uses of this flag, possibly by pointing to some other
part of the doc if it is already explained somewhere else.

> > The function `_possible_m(self, m, j, min_sum, max_sum)`
> > takes four parameters, all of which are attributes of `self`.
>
> I  agree that  this should  eventually become  an argument-less
> `look_ahead`  method  that  tests  if the  current  list  could
> possibly  be a  prefix of  some valid  list.  I  would like  to
> postpone this change to #18055 however

As the method appears in this branch, I see no reason to let it
be corrected in a future ticket.

Nathann



---

archive/issue_comments_237264.json:
```json
{
    "body": "Why is there duplication of `Envelope` and `_upper_envelope`?",
    "created_at": "2015-04-03T09:12:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237264",
    "user": "https://github.com/jdemeyer"
}
```

Why is there duplication of `Envelope` and `_upper_envelope`?



---

archive/issue_comments_237265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T10:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237266.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T10:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237266",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237267.json:
```json
{
    "body": "Replying to [comment:354 nthiery]:\n> Also, at this point, we are speaking about\n> 5-6 lines of code that are duplicated very locally.\nIt's more than that and it can only get worse if more features are added to `Envelope`.\n\n> and the code would be less straightforward.\nI disagree with this. I think code duplication is always a high risk for bugs.\n\nAnyway, I implemented this in this last commit.",
    "created_at": "2015-04-03T10:24:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237267",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:354 nthiery]:
> Also, at this point, we are speaking about
> 5-6 lines of code that are duplicated very locally.
It's more than that and it can only get worse if more features are added to `Envelope`.

> and the code would be less straightforward.
I disagree with this. I think code duplication is always a high risk for bugs.

Anyway, I implemented this in this last commit.



---

archive/issue_comments_237268.json:
```json
{
    "body": "Replying to [comment:356 ncohen]:\n> Many times in the past I had to fix code which accepts a `**kwds`\n> and did not check that what it contains is actually read. This\n> lead to silent errors or wrong output, and so I see\n> things like `global_options` as the highway to bugs.\n\n`**kwds` arguments can be painful, I certainly agree.\n\nBut fear not, `__init__` takes no kwds. It only accepts a preexisting\nglobal_options object, and assigns it to the attribute\n`_global_options`, that's it.\n\n> Jeroen noted that this variable is actually used somewhere else,\n> so I guess it probably should not be removed in this ticket. My\n> comment at [comment:319] still need to be adressed, however, as\n> there is no documentation for this parameter. Please make it\n> explain the uses of this flag, possibly by pointing to some other\n> part of the doc if it is already explained somewhere else.\n\nI had not documented it to not advertise it, since we may well get rid\nof it. Now there is a documentation that spells exactly what it does.\n----\nNew commits:",
    "created_at": "2015-04-03T10:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237268",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:356 ncohen]:
> Many times in the past I had to fix code which accepts a `**kwds`
> and did not check that what it contains is actually read. This
> lead to silent errors or wrong output, and so I see
> things like `global_options` as the highway to bugs.

`**kwds` arguments can be painful, I certainly agree.

But fear not, `__init__` takes no kwds. It only accepts a preexisting
global_options object, and assigns it to the attribute
`_global_options`, that's it.

> Jeroen noted that this variable is actually used somewhere else,
> so I guess it probably should not be removed in this ticket. My
> comment at [comment:319] still need to be adressed, however, as
> there is no documentation for this parameter. Please make it
> explain the uses of this flag, possibly by pointing to some other
> part of the doc if it is already explained somewhere else.

I had not documented it to not advertise it, since we may well get rid
of it. Now there is a documentation that spells exactly what it does.
----
New commits:



---

archive/issue_comments_237269.json:
```json
{
    "body": "Hello,\n\n> `**kwds` arguments can be painful, I certainly agree.\n> \n> But fear not, `__init__` takes no kwds. It only accepts a preexisting\n> global_options object, and assigns it to the attribute\n> `_global_options`, that's it.\n\nI think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.\n\nI set the ticket back to `needs_work` because of the previous comments on `_possible_m(self, m, j, min_sum, max_sum)`.\n\nNathann",
    "created_at": "2015-04-03T10:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237269",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> `**kwds` arguments can be painful, I certainly agree.
> 
> But fear not, `__init__` takes no kwds. It only accepts a preexisting
> global_options object, and assigns it to the attribute
> `_global_options`, that's it.

I think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.

I set the ticket back to `needs_work` because of the previous comments on `_possible_m(self, m, j, min_sum, max_sum)`.

Nathann



---

archive/issue_comments_237270.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-03T10:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237270",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237271.json:
```json
{
    "body": "Hi Jeroen,\n\nI appreciate that you substantiate your point of view with action. I\nam not going to waste time debating this for I want this ticket to\nmove forward. But I still think that the original Envelope was better,\nfor the reasons I mentionned above. Besides, I had voluntarily used\n`==Infinity` in my tests to not set in stone which infinity was\nreturned.\n\n                          Nicolas",
    "created_at": "2015-04-03T11:36:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237271",
    "user": "https://github.com/nthiery"
}
```

Hi Jeroen,

I appreciate that you substantiate your point of view with action. I
am not going to waste time debating this for I want this ticket to
move forward. But I still think that the original Envelope was better,
for the reasons I mentionned above. Besides, I had voluntarily used
`==Infinity` in my tests to not set in stone which infinity was
returned.

                          Nicolas



---

archive/issue_comments_237272.json:
```json
{
    "body": "Replying to [comment:363 nthiery]:\n> Besides, I had voluntarily used\n> `==Infinity` in my tests to not set in stone which infinity was\n> returned.\nI understood that, but it's cleaner this way. And if `Infinity` ever changes, it's a trivial change anyway.",
    "created_at": "2015-04-03T11:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237272",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:363 nthiery]:
> Besides, I had voluntarily used
> `==Infinity` in my tests to not set in stone which infinity was
> returned.
I understood that, but it's cleaner this way. And if `Infinity` ever changes, it's a trivial change anyway.



---

archive/issue_comments_237273.json:
```json
{
    "body": "Replying to [comment:362 ncohen]:\n> I think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.\n\nWhatever garbage is stored in `global_options` has zero influence on\n`IntegerListsLex`. If you are not happy with other classes using this\nfeature, then change it out there. This has nothing to do with this\nticket.",
    "created_at": "2015-04-03T11:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237273",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:362 ncohen]:
> I think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.

Whatever garbage is stored in `global_options` has zero influence on
`IntegerListsLex`. If you are not happy with other classes using this
feature, then change it out there. This has nothing to do with this
ticket.



---

archive/issue_comments_237274.json:
```json
{
    "body": "Replying to [comment:362 ncohen]:\n> I think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.\n\nI think this is outside the scope of this ticket.",
    "created_at": "2015-04-03T11:42:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237274",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:362 ncohen]:
> I think that my explanation above applies anyway. Unless there are checks that everything which is stored in `global_options` makes sense (and that there are exceptions when I do `MyObject(global_options={'whatever':'whatever'}` then `**kwds` and `global_options` are as dangerous as each other.

I think this is outside the scope of this ticket.



---

archive/issue_comments_237275.json:
```json
{
    "body": "> Whatever garbage is stored in `global_options` has zero influence on\n> `IntegerListsLex`. If you are not happy with other classes using this\n> feature, then change it out there. This has nothing to do with this\n> ticket.\n\nIt is true. I do not think that I asked for this to be changed. I merely pointed the lack of documentation (now fixed) and explained the reason why I believe that it is a very bad practice.\n\nNathann",
    "created_at": "2015-04-03T11:43:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237275",
    "user": "https://github.com/nathanncohen"
}
```

> Whatever garbage is stored in `global_options` has zero influence on
> `IntegerListsLex`. If you are not happy with other classes using this
> feature, then change it out there. This has nothing to do with this
> ticket.

It is true. I do not think that I asked for this to be changed. I merely pointed the lack of documentation (now fixed) and explained the reason why I believe that it is a very bad practice.

Nathann



---

archive/issue_comments_237276.json:
```json
{
    "body": "Replying to [comment:364 jdemeyer]:\n> Replying to [comment:363 nthiery]:\n> > Besides, I had voluntarily used\n> > `==Infinity` in my tests to not set in stone which infinity was\n> > returned.\n> I understood that, but it's cleaner this way. And if `Infinity` ever changes, it's a trivial change anyway.\n\nI don't see why it's cleaner; it's just a different specification. But let's move on.",
    "created_at": "2015-04-03T11:44:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237276",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:364 jdemeyer]:
> Replying to [comment:363 nthiery]:
> > Besides, I had voluntarily used
> > `==Infinity` in my tests to not set in stone which infinity was
> > returned.
> I understood that, but it's cleaner this way. And if `Infinity` ever changes, it's a trivial change anyway.

I don't see why it's cleaner; it's just a different specification. But let's move on.



---

archive/issue_comments_237277.json:
```json
{
    "body": "Replying to [comment:354 nthiery]:\n> the computation of the area below the envelope for which we won't\n> have this symmetry anymore.\nWhy not? It's just the sum of the first `n` values, right?",
    "created_at": "2015-04-03T11:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237277",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:354 nthiery]:
> the computation of the area below the envelope for which we won't
> have this symmetry anymore.
Why not? It's just the sum of the first `n` values, right?



---

archive/issue_comments_237278.json:
```json
{
    "body": "Replying to [comment:369 jdemeyer]:\n> Replying to [comment:354 nthiery]:\n> > the computation of the area below the envelope for which we won't\n> > have this symmetry anymore.\n> Why not? It's just the sum of the first `n` values, right?\n\nThe point is that this function would take backward smoothing (using the slope conditions) into account.",
    "created_at": "2015-04-03T15:24:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237278",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:369 jdemeyer]:
> Replying to [comment:354 nthiery]:
> > the computation of the area below the envelope for which we won't
> > have this symmetry anymore.
> Why not? It's just the sum of the first `n` values, right?

The point is that this function would take backward smoothing (using the slope conditions) into account.



---

archive/issue_comments_237279.json:
```json
{
    "body": "Replying to [comment:370 aschilling]:\n> The point is that this function would take backward smoothing (using the slope conditions) into account.\n\nEven then, I don't see why this is incompatible with the \"sign\" option.",
    "created_at": "2015-04-03T15:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237279",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:370 aschilling]:
> The point is that this function would take backward smoothing (using the slope conditions) into account.

Even then, I don't see why this is incompatible with the "sign" option.



---

archive/issue_comments_237280.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T16:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237280",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237281.json:
```json
{
    "body": "Replying to [comment:371 jdemeyer]:\n> Replying to [comment:370 aschilling]:\n> > The point is that this function would take backward smoothing (using the slope conditions) into account.\n> \n> Even then, I don't see why this is incompatible with the \"sign\" option.\n\nYou are probably right with the correct definition of the slopes.\n\nI believe all comments have been taken into account now?",
    "created_at": "2015-04-03T16:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237281",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:371 jdemeyer]:
> Replying to [comment:370 aschilling]:
> > The point is that this function would take backward smoothing (using the slope conditions) into account.
> 
> Even then, I don't see why this is incompatible with the "sign" option.

You are probably right with the correct definition of the slopes.

I believe all comments have been taken into account now?



---

archive/issue_comments_237282.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-03T16:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237282",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237283.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T18:06:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237283",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237284.json:
```json
{
    "body": "Replying to [comment:362 ncohen]:\n> I set the ticket back to `needs_work` because of the previous comments on `_possible_m(self, m, j, min_sum, max_sum)`.\n\nDone.",
    "created_at": "2015-04-03T18:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237284",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:362 ncohen]:
> I set the ticket back to `needs_work` because of the previous comments on `_possible_m(self, m, j, min_sum, max_sum)`.

Done.



---

archive/issue_comments_237285.json:
```json
{
    "body": "Replying to [comment:369 jdemeyer]:\n> Replying to [comment:354 nthiery]:\n> > the computation of the area below the envelope for which we won't\n> > have this symmetry anymore.\n> Why not? It's just the sum of the first `n` values, right?\n\nMathematically, and up to smoothing,  yes. The algorithmic will be somewhat more involved than this for achieving good complexity, but fair enough, I guess it can be made to work.",
    "created_at": "2015-04-03T18:13:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237285",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:369 jdemeyer]:
> Replying to [comment:354 nthiery]:
> > the computation of the area below the envelope for which we won't
> > have this symmetry anymore.
> Why not? It's just the sum of the first `n` values, right?

Mathematically, and up to smoothing,  yes. The algorithmic will be somewhat more involved than this for achieving good complexity, but fair enough, I guess it can be made to work.



---

archive/issue_comments_237286.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-03T18:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237286",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237287.json:
```json
{
    "body": "Replying to [comment:357 jdemeyer]:\n> Why is there duplication of `Envelope` and `_upper_envelope`?\n\nThe role of `_upper_envelope` is to slightly tweak the global ceiling\n(an existing already smoothed `Envelope` object) to take into account\nthe additional local constraint that the current value at position `j`\nis `m`.  Similarly for `_lower_envelope`.\n\nSo the two features are similar in the nature of their goal, but\ndiffer in what they actually need to do to achieve it. So merging them\nis unlikely to save any duplication while likely to add complexity.\n\nOn the other hand, I agree it would be nice to better clarify this\ndistinction between the two features in the method names. Suggestions\nwelcome.\n----\nNew commits:",
    "created_at": "2015-04-03T18:29:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237287",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:357 jdemeyer]:
> Why is there duplication of `Envelope` and `_upper_envelope`?

The role of `_upper_envelope` is to slightly tweak the global ceiling
(an existing already smoothed `Envelope` object) to take into account
the additional local constraint that the current value at position `j`
is `m`.  Similarly for `_lower_envelope`.

So the two features are similar in the nature of their goal, but
differ in what they actually need to do to achieve it. So merging them
is unlikely to save any duplication while likely to add complexity.

On the other hand, I agree it would be nice to better clarify this
distinction between the two features in the method names. Suggestions
welcome.
----
New commits:



---

archive/issue_comments_237288.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2015-04-03T21:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237288",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_237289.json:
```json
{
    "body": "Since `_upper_envelope` deals with ceiling bounds and refers only to information which is already contained in `_ceiling`, it looks like `_upper_envelope` should really be a method of `Envelope` (then better without the leading underscore). So please justify why you think this should *not* be the case.",
    "created_at": "2015-04-03T21:30:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237289",
    "user": "https://github.com/jdemeyer"
}
```

Since `_upper_envelope` deals with ceiling bounds and refers only to information which is already contained in `_ceiling`, it looks like `_upper_envelope` should really be a method of `Envelope` (then better without the leading underscore). So please justify why you think this should *not* be the case.



---

archive/issue_comments_237290.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-04T09:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237290",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237291.json:
```json
{
    "body": "Replying to [comment:380 jdemeyer]:\n> Since `_upper_envelope` deals with ceiling bounds and refers only to information which is already contained in `_ceiling`, it looks like `_upper_envelope` should really be a method of `Envelope` (then better without the leading underscore). So please justify why you think this should *not* be the case.\n\nI agree that it's better; thanks for the suggestion! Done.\n\nCheers,\n                                   Nicolas",
    "created_at": "2015-04-04T09:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237291",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:380 jdemeyer]:
> Since `_upper_envelope` deals with ceiling bounds and refers only to information which is already contained in `_ceiling`, it looks like `_upper_envelope` should really be a method of `Envelope` (then better without the leading underscore). So please justify why you think this should *not* be the case.

I agree that it's better; thanks for the suggestion! Done.

Cheers,
                                   Nicolas



---

archive/issue_comments_237292.json:
```json
{
    "body": "We have been working hard to make the deadline for\nthe release. Like in any piece of code, there certainly are other\ninternal micro-refactoring that could possibly be done. If you note\none, please be specific on whether you believe it really needs to be\ndone now, or could be postponed to one of the follow up tickets;\nespecially since some of those tickets may well induce complete\nrewrite of the ditto micro-refactored code anyway.",
    "created_at": "2015-04-04T09:26:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237292",
    "user": "https://github.com/nthiery"
}
```

We have been working hard to make the deadline for
the release. Like in any piece of code, there certainly are other
internal micro-refactoring that could possibly be done. If you note
one, please be specific on whether you believe it really needs to be
done now, or could be postponed to one of the follow up tickets;
especially since some of those tickets may well induce complete
rewrite of the ditto micro-refactored code anyway.



---

archive/issue_comments_237293.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2015-04-04T09:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237293",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_237294.json:
```json
{
    "body": "> We have been working hard to make the deadline for\n> the release. Like in any piece of code, there certainly are other\n> internal micro-refactoring that could possibly be done. If you note\n> one, please be specific on whether you believe it really needs to be\n> done now, or could be postponed to one of the follow up tickets;\n> especially since some of those tickets may well induce complete\n> rewrite of the ditto micro-refactored code anyway.\n\nHave you had the impression that some of our previous requests were abusive? We try to understand your code, make sure that it is correct maintenable and thus that it will be easy to understand and work on it in the future.\n\nMany of the things that seem obvious to the author are not easily deduced when you only look at the code, and unexpected design choices often raise more questions.\n\nI personally gave up raising some arguments (that still seem legitimate to me) only to lessen the load on this ticket. I still plan to read the code you implement totally (I haven't done that yet), and I will probably have more time to do so next week.\n\nNathann",
    "created_at": "2015-04-05T11:47:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237294",
    "user": "https://github.com/nathanncohen"
}
```

> We have been working hard to make the deadline for
> the release. Like in any piece of code, there certainly are other
> internal micro-refactoring that could possibly be done. If you note
> one, please be specific on whether you believe it really needs to be
> done now, or could be postponed to one of the follow up tickets;
> especially since some of those tickets may well induce complete
> rewrite of the ditto micro-refactored code anyway.

Have you had the impression that some of our previous requests were abusive? We try to understand your code, make sure that it is correct maintenable and thus that it will be easy to understand and work on it in the future.

Many of the things that seem obvious to the author are not easily deduced when you only look at the code, and unexpected design choices often raise more questions.

I personally gave up raising some arguments (that still seem legitimate to me) only to lessen the load on this ticket. I still plan to read the code you implement totally (I haven't done that yet), and I will probably have more time to do so next week.

Nathann



---

archive/issue_comments_237295.json:
```json
{
    "body": "One more \"adding constraints break\" issue:\n\n```\nsage: IntegerListsLex(5, max_part=0).list()\n[]\nsage: IntegerListsLex(5, max_part=0, min_slope=0).list()\n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n",
    "created_at": "2015-04-05T18:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237295",
    "user": "https://github.com/jdemeyer"
}
```

One more "adding constraints break" issue:

```
sage: IntegerListsLex(5, max_part=0).list()
[]
sage: IntegerListsLex(5, max_part=0, min_slope=0).list()
...
ValueError: Could not check that the specified constraints yield a finite set
```




---

archive/issue_comments_237296.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-05T18:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237296",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237297.json:
```json
{
    "body": "This is a more difficult example where the list is finite (because the sum of the lower envelope eventually becomes larger than the sum):\n\n```\nsage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()\n...\nValueError: Could not check that the specified constraints yield a finite set\n```\n\nThis should either be fixed or be documented as an example where the check isn't good enough.",
    "created_at": "2015-04-05T20:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237297",
    "user": "https://github.com/jdemeyer"
}
```

This is a more difficult example where the list is finite (because the sum of the lower envelope eventually becomes larger than the sum):

```
sage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()
...
ValueError: Could not check that the specified constraints yield a finite set
```

This should either be fixed or be documented as an example where the check isn't good enough.



---

archive/issue_comments_237298.json:
```json
{
    "body": "I do find it surprisingly inconsistent that\n\n```\nsage: IntegerListsLex(7, floor=[4,3,2,1], max_part=4, min_slope=-1).list()\n```\n\nworks but\n\n```\nsage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()\n```\n\ndoes not.",
    "created_at": "2015-04-05T20:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237298",
    "user": "https://github.com/jdemeyer"
}
```

I do find it surprisingly inconsistent that

```
sage: IntegerListsLex(7, floor=[4,3,2,1], max_part=4, min_slope=-1).list()
```

works but

```
sage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()
```

does not.



---

archive/issue_comments_237299.json:
```json
{
    "body": "This hangs:\n\n```\nsage: IntegerListsLex(7, max_part=0, ceiling=lambda i:i).list()\n```\n",
    "created_at": "2015-04-05T20:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237299",
    "user": "https://github.com/jdemeyer"
}
```

This hangs:

```
sage: IntegerListsLex(7, max_part=0, ceiling=lambda i:i).list()
```




---

archive/issue_comments_237300.json:
```json
{
    "body": "In `_check_finiteness()`, I think you should move from a blacklist model to a whitelist model: don't raise an exception if certain conditions are satisfied, but raise an error *unless* the input can be seen to be finite. This logic could not have the problem that adding conditions breaks things.",
    "created_at": "2015-04-05T20:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237300",
    "user": "https://github.com/jdemeyer"
}
```

In `_check_finiteness()`, I think you should move from a blacklist model to a whitelist model: don't raise an exception if certain conditions are satisfied, but raise an error *unless* the input can be seen to be finite. This logic could not have the problem that adding conditions breaks things.



---

archive/issue_comments_237301.json:
```json
{
    "body": "Replying to [comment:385 ncohen]:\n> Have you had the impression that some of our previous requests were\n> abusive? We try to understand your code, make sure that it is\n> correct maintenable and thus that it will be easy to understand and\n> work on it in the future.\n\n> Many of the things that seem obvious to the author are not easily\n> deduced when you only look at the code, and unexpected design choices\n> often raise more questions.\n\nAbusive, no: they all had to be handled at some point or the\nother. Urgent: I did wonder for some of them; I agree that we\nabsolutely want the code to be correct (at least to the best of our\nknowledge) for this rc. And this of course requires a complete\nunderstanding of it by the reviewers, and clarification of the design\nchoices. But maybe for some of the issues it's sufficient, once things\nare clarified, to leave a note in upcoming tickets for the next step\nthat need to be done.\n\nThe big thing is that I have the impression to be holding off the\nupcoming rc, and that's rather uncomfortable. Also having a stable\nbase here would allow me to move on to the following tasks, in\nparticular working of the merge and review of #17920, as well as your\nticket about IntegerVectors. And also would allow me or others to work\non to the follow up tickets.\n\n> I personally gave up raising some arguments (that still seem\n> legitimate to me) only to lessen the load on this ticket.\n\nI appreciate this! Please add these comments to the followup tickets\n(or some new one if appropriate), for I want to hear about them.\n\n> I still plan to read the code you implement totally (I haven't done that yet), and I will probably have more time to do so next week.\n\nGreat, thanks!\n\nFrom the many discussions with you, Jeroen, Bryan, and Anne and\nmyself, it seems that the code has been scrutinized quite some.  As\nJeroen pointed out, there are still cases that could be handled in\ntheory, and that the code rejects at this point. But outside of those\nsituations, I pretty much trust that the code gives correct result.\nWhich achieves the original goal of this ticket.\n\nCheers,\n                             Nicolas",
    "created_at": "2015-04-05T23:22:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237301",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:385 ncohen]:
> Have you had the impression that some of our previous requests were
> abusive? We try to understand your code, make sure that it is
> correct maintenable and thus that it will be easy to understand and
> work on it in the future.

> Many of the things that seem obvious to the author are not easily
> deduced when you only look at the code, and unexpected design choices
> often raise more questions.

Abusive, no: they all had to be handled at some point or the
other. Urgent: I did wonder for some of them; I agree that we
absolutely want the code to be correct (at least to the best of our
knowledge) for this rc. And this of course requires a complete
understanding of it by the reviewers, and clarification of the design
choices. But maybe for some of the issues it's sufficient, once things
are clarified, to leave a note in upcoming tickets for the next step
that need to be done.

The big thing is that I have the impression to be holding off the
upcoming rc, and that's rather uncomfortable. Also having a stable
base here would allow me to move on to the following tasks, in
particular working of the merge and review of #17920, as well as your
ticket about IntegerVectors. And also would allow me or others to work
on to the follow up tickets.

> I personally gave up raising some arguments (that still seem
> legitimate to me) only to lessen the load on this ticket.

I appreciate this! Please add these comments to the followup tickets
(or some new one if appropriate), for I want to hear about them.

> I still plan to read the code you implement totally (I haven't done that yet), and I will probably have more time to do so next week.

Great, thanks!

From the many discussions with you, Jeroen, Bryan, and Anne and
myself, it seems that the code has been scrutinized quite some.  As
Jeroen pointed out, there are still cases that could be handled in
theory, and that the code rejects at this point. But outside of those
situations, I pretty much trust that the code gives correct result.
Which achieves the original goal of this ticket.

Cheers,
                             Nicolas



---

archive/issue_comments_237302.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-05T23:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237302",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237303.json:
```json
{
    "body": "Replying to [comment:390 jdemeyer]:\n> In `_check_finiteness()`, I think you should move from a blacklist model to a whitelist model: don't raise an exception if certain conditions are satisfied, but raise an error *unless* the input can be seen to be finite. This logic could not have the problem that adding conditions breaks things.\n\nAgreed. It's also easier to check step by step the correctness of each good case. Done.\n\nI am pretty sure I got the list of good cases right. But it's 1 am, so please double check that I did not inadvertently remove a good case. At least all tests in this file pass, and [comment:386] is now fixed.\n----\nNew commits:",
    "created_at": "2015-04-05T23:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237303",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:390 jdemeyer]:
> In `_check_finiteness()`, I think you should move from a blacklist model to a whitelist model: don't raise an exception if certain conditions are satisfied, but raise an error *unless* the input can be seen to be finite. This logic could not have the problem that adding conditions breaks things.

Agreed. It's also easier to check step by step the correctness of each good case. Done.

I am pretty sure I got the list of good cases right. But it's 1 am, so please double check that I did not inadvertently remove a good case. At least all tests in this file pass, and [comment:386] is now fixed.
----
New commits:



---

archive/issue_comments_237304.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-05T23:40:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237304",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237305.json:
```json
{
    "body": "Replying to [comment:388 jdemeyer]:\n> I do find it surprisingly inconsistent that\n> {{{\n> sage: IntegerListsLex(7, floor=[4,3,2,1], max_part=4, min_slope=-1).list()\n> }}}\n> works but\n> {{{\n> sage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()\n> }}}\n> does not.\n\nAnnoying indeed. The fine point is in the heuristic to decide how deep\nwe want to lookahead to find a lower bound on the total floor area. In\na case like this we could potentially compute how deep to go until the\nfloor would reach its limit of zero.\n\nI would tend to postpone that: there is no risk of wrong answer, the\nexistence of false negatives is now documented in\n`_check_finiteness` (using the above examples), and the user can set\n`check=False` to workaround the limitation.\n\nWhat do you think?",
    "created_at": "2015-04-05T23:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237305",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:388 jdemeyer]:
> I do find it surprisingly inconsistent that
> {{{
> sage: IntegerListsLex(7, floor=[4,3,2,1], max_part=4, min_slope=-1).list()
> }}}
> works but
> {{{
> sage: IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1).list()
> }}}
> does not.

Annoying indeed. The fine point is in the heuristic to decide how deep
we want to lookahead to find a lower bound on the total floor area. In
a case like this we could potentially compute how deep to go until the
floor would reach its limit of zero.

I would tend to postpone that: there is no risk of wrong answer, the
existence of false negatives is now documented in
`_check_finiteness` (using the above examples), and the user can set
`check=False` to workaround the limitation.

What do you think?



---

archive/issue_comments_237306.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-06T00:02:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237306",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237307.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-06T00:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237307",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237308.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-06T00:12:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237308",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237309.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-06T00:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237309",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237310.json:
```json
{
    "body": "Time to call it a day.\n\nBack to needs review (assuming for now that comment:395 is ok).",
    "created_at": "2015-04-06T00:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237310",
    "user": "https://github.com/nthiery"
}
```

Time to call it a day.

Back to needs review (assuming for now that comment:395 is ok).



---

archive/issue_comments_237311.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-06T00:15:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237311",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237312.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-06T04:14:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237312",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237313.json:
```json
{
    "body": "Regarding Jeroen's comment:395, I think this could possibly be fixed by adjusting ._floor.limit_start() after the smoothing procedure. Note that\n\n```\nsage: C=IntegerListsLex(7, floor=[4,0], max_part=4, min_slope=-1)\nsage: C.list()\n[[4, 3]]\n```\n\nalso works fine. The reason is that\n\n```\nsage: C._floor.limit_start()\n2\n```\n\nso that \n\n```\nfloor_sum_lower_bound = sum(self._floor(i) for i in range(self._floor.limit_start()))\n```\n\nin line 1076 computes a high enough bound that is caught in line 1082. However, in\n\n```\nsage: C=IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1)\nsage: C._floor.limit_start()\n1\n```\n\neven though\n\n```\nsage: for i in range(5):\n....:     print C._floor(i)\n....:     \n4\n3\n2\n1\n0\n```\n",
    "created_at": "2015-04-06T04:27:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237313",
    "user": "https://github.com/anneschilling"
}
```

Regarding Jeroen's comment:395, I think this could possibly be fixed by adjusting ._floor.limit_start() after the smoothing procedure. Note that

```
sage: C=IntegerListsLex(7, floor=[4,0], max_part=4, min_slope=-1)
sage: C.list()
[[4, 3]]
```

also works fine. The reason is that

```
sage: C._floor.limit_start()
2
```

so that 

```
floor_sum_lower_bound = sum(self._floor(i) for i in range(self._floor.limit_start()))
```

in line 1076 computes a high enough bound that is caught in line 1082. However, in

```
sage: C=IntegerListsLex(7, floor=[4], max_part=4, min_slope=-1)
sage: C._floor.limit_start()
1
```

even though

```
sage: for i in range(5):
....:     print C._floor(i)
....:     
4
3
2
1
0
```




---

archive/issue_comments_237314.json:
```json
{
    "body": "Replying to [comment:391 nthiery]:\n> I pretty much trust that the code gives correct result.\nTo be clear: during all my testing I didn't find a single example where the code actually returned a wrong result. On the other hand, there were many hangs or cases where a superfluous `ValueError` was raised.",
    "created_at": "2015-04-06T08:27:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237314",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:391 nthiery]:
> I pretty much trust that the code gives correct result.
To be clear: during all my testing I didn't find a single example where the code actually returned a wrong result. On the other hand, there were many hangs or cases where a superfluous `ValueError` was raised.



---

archive/issue_comments_237315.json:
```json
{
    "body": "Replying to [comment:403 jdemeyer]:\n> Replying to [comment:391 nthiery]:\n> > I pretty much trust that the code gives correct result.\n> To be clear: during all my testing I didn't find a single example where the code actually returned a wrong result. On the other hand, there were many hangs or cases where a superfluous `ValueError` was raised.\n\nThis indeed was my overall impression of your comments. Thanks for confirming!",
    "created_at": "2015-04-06T20:41:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237315",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:403 jdemeyer]:
> Replying to [comment:391 nthiery]:
> > I pretty much trust that the code gives correct result.
> To be clear: during all my testing I didn't find a single example where the code actually returned a wrong result. On the other hand, there were many hangs or cases where a superfluous `ValueError` was raised.

This indeed was my overall impression of your comments. Thanks for confirming!



---

archive/issue_comments_237316.json:
```json
{
    "body": "Replying to [comment:402 aschilling]:\n> Regarding Jeroen's comment:395, I think this could possibly be fixed by adjusting ._floor.limit_start() after the smoothing procedure.\n\nAgreed: we could imagine, in the constructor of Envelope and when a\nlist is given as input, to set `limit_start` not to the end of the\nlist, but to the point where the limit is actually reached after\nsmoothing. It should be just a couple lines.\n\nPotential downside: if the parts in the list are very high, this may\ninduce a similarly high limit start, which will trigger more\ncalculations elsewhere. Probably not a common use case, so we might\nnot care.\n\nThe other thing is that I could well imagine that, once the new\nlookahead is implemented in #18055, the finiteness checking -- or at\nleast the partial lookahead we are doing in `_check_finiteness` --\nwould become a side product; so might not be worth having something\ntemporary.\n\nSo, reviewers: let us know if this should be done right now.\n\nCheers,\n                              Nicolas",
    "created_at": "2015-04-06T20:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237316",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:402 aschilling]:
> Regarding Jeroen's comment:395, I think this could possibly be fixed by adjusting ._floor.limit_start() after the smoothing procedure.

Agreed: we could imagine, in the constructor of Envelope and when a
list is given as input, to set `limit_start` not to the end of the
list, but to the point where the limit is actually reached after
smoothing. It should be just a couple lines.

Potential downside: if the parts in the list are very high, this may
induce a similarly high limit start, which will trigger more
calculations elsewhere. Probably not a common use case, so we might
not care.

The other thing is that I could well imagine that, once the new
lookahead is implemented in #18055, the finiteness checking -- or at
least the partial lookahead we are doing in `_check_finiteness` --
would become a side product; so might not be worth having something
temporary.

So, reviewers: let us know if this should be done right now.

Cheers,
                              Nicolas



---

archive/issue_comments_237317.json:
```json
{
    "body": "In the interest of ever releasing sage-6.6 I would prefer to finish a version that provides correct answers now and optimize it later...",
    "created_at": "2015-04-07T06:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237317",
    "user": "https://github.com/vbraun"
}
```

In the interest of ever releasing sage-6.6 I would prefer to finish a version that provides correct answers now and optimize it later...



---

archive/issue_comments_237318.json:
```json
{
    "body": "I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it. I have read most of the structural code, but not the actual algorithm. I would agree with a positive_review for this ticket *except* for the changes to `integer_vector.py`.",
    "created_at": "2015-04-07T08:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237318",
    "user": "https://github.com/jdemeyer"
}
```

I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it. I have read most of the structural code, but not the actual algorithm. I would agree with a positive_review for this ticket *except* for the changes to `integer_vector.py`.



---

archive/issue_comments_237319.json:
```json
{
    "body": "Replying to [comment:407 jdemeyer]:\n> I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it. I have read most of the structural code, but not the actual algorithm.\n\nI will do a full review today or tomorrow. Most probably all changes have already been made.\n\nNathann",
    "created_at": "2015-04-07T08:23:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237319",
    "user": "https://github.com/nathanncohen"
}
```

Replying to [comment:407 jdemeyer]:
> I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it. I have read most of the structural code, but not the actual algorithm.

I will do a full review today or tomorrow. Most probably all changes have already been made.

Nathann



---

archive/issue_comments_237320.json:
```json
{
    "body": "Replying to [comment:407 jdemeyer]:\n> I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it.\n\nTo say the least!\n\n> I have read most of the structural code, but not the actual algorithm. I would agree with a positive_review for this ticket\n\nThanks for the hard work :-)\n\n> *except* for the changes to `integer_vector.py`.\n\nYup. Note for the release manager: those were checked and validated by Travis and Anne.",
    "created_at": "2015-04-07T12:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237320",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:407 jdemeyer]:
> I personally have no further comments regarding this ticket. I have tested it  *a lot* in practice, trying hard to break it.

To say the least!

> I have read most of the structural code, but not the actual algorithm. I would agree with a positive_review for this ticket

Thanks for the hard work :-)

> *except* for the changes to `integer_vector.py`.

Yup. Note for the release manager: those were checked and validated by Travis and Anne.



---

archive/issue_comments_237321.json:
```json
{
    "body": "Replying to [comment:409 nthiery]:\n> Yup. Note for the release manager: those were checked and validated by Travis and Anne.\nI prefer to hear this from them instead of you speaking for them.",
    "created_at": "2015-04-07T12:30:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237321",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:409 nthiery]:
> Yup. Note for the release manager: those were checked and validated by Travis and Anne.
I prefer to hear this from them instead of you speaking for them.



---

archive/issue_comments_237322.json:
```json
{
    "body": "Replying to [comment:410 jdemeyer]:\n> Replying to [comment:409 nthiery]:\n> > Yup. Note for the release manager: those were checked and validated by Travis and Anne.\n> I prefer to hear this from them instead of you speaking for them.\n\nSure thing. Anne? Travis?\n\n(see also [comment:248], [comment:254])",
    "created_at": "2015-04-07T13:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237322",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:410 jdemeyer]:
> Replying to [comment:409 nthiery]:
> > Yup. Note for the release manager: those were checked and validated by Travis and Anne.
> I prefer to hear this from them instead of you speaking for them.

Sure thing. Anne? Travis?

(see also [comment:248], [comment:254])



---

archive/issue_comments_237323.json:
```json
{
    "body": "Hello,\n\nThis is what I did during the last 3~4 hours. I stopped before the end and did\nnot review `m_interval`, `_lookahead` nor the code of `Envelope`, as I really\nshould be working on mathematics instead of Sage `T_T`\n\nSome are easy, some are harder. Also, let me write somewhere that I am against\nkeeping `integer_list_old` in Sage, as I am afraid that it will still be here\nseveral years from now. Here are my comments:\n\n- Module documentation -- in the 'itemize' section listing `IntegerListsLex` and\n  `Envelope`, could you add a short description of what they are meant for?\n\n- Why a 'history' section?\n\n- Documentation of `IntegerListsLex`: instead of stating the *purpose* of the\n  class (which is more something one would explain on a trac ticket), what about\n  a SEEALSO section? I have the following paragraph in mind:\n  {{{\n  The main purpose is to provide a generic iteration engine for all\n  the enumerated sets like :class:`Partitions`,\n  class:`Compositions`, :class:`IntegerVectors`. It can also be\n  used to generate many other combinatorial objects like Dyck paths,\n  Motzkin paths, etc.\n  }}}\n  I thought that it would make more sense as a SEEALSO section pointing toward\n  the mentionned objects.\n\n- About this paragraph:\n  {{{\n  The set of allowable constraints has been specifically designed to enable\n  iteration with a good time and memory complexity in most practical use cases,\n  and in inverse lexicographic order (see below)\n  }}}\n\n  I do not believe that it is true, i.e. that the set of allowable contraints\n  has been specifically designed to enable iteration with a good time and memory\n  complexity.\n\n  In particular, it is possible to get great speed improvements by writing a\n  Constant Amortized Algorithm to list only partitions satisfying a smaller set\n  of constraints like (sum,length,min/max part).\n\n  This statement sounds wrong to me, and so I believe that it should be removed.\n\n- Documentation of the parameter `n` -- you say that a list of integers can be\n  provided but do not explain what the output will be.\n\n- Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it\n  seems to be, though I am not sure that it is the best design choice in this\n  case.\n\n- I was surprised by the following output:\n  {{{\n  sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()\n  [[3], [2, 1], [1, 2], [1, 1, 1]]\n  }}}\n  I woud have expected the length of the lists to be at least 3, as I requested\n  the first three parts to be `>=1`. The documentation is consistent, but I\n  still find it surprising.\n\n- ``check`` seems misnamed. It is not about checking the input or output, only\n  about displaying warnings. What about `disable_warnings` instead?\n\n- In the following text which says that one can force the enumeration when it is\n  formally impossible, can you explicitly say what will happen? \"All possible\n  lists are enumerated, but the ordering is incorrect\" or something?\n  `If one wants to proceed anyway, one can sign a waiver by setting check=False:`\n\n- About the finiteness check: what about a specific `allow_infinite_iterator`\n  independent from the current 'check'.\n\n- Building the doc of `integer_list.py` with `--warn-links` fails.\n\n- `sage: list(IntegerListsLex(3, max_length=2, ))`\n\n- Lexicographic ordering is broken when `n` is a list.\n  {{{\n  sage: print IntegerListsLex([1,2],length=3).list()\n  [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0, 2, 0], [0, 1, 1], [0, 0, 2]]\n  }}}\n\n  In particular, the output differs depending on how `n` is sorted.\n\n- Cardinality is broken when `n` is a list\n  {{{\n  sage: IntegerListsLex(3,length=3).cardinality()\n  10\n  sage: IntegerListsLex([3,3],length=3).cardinality()\n  20\n  }}}\n\n- `return typecall(cls, n=n, **kwargs)` -- for clarity I find the normal\n  syntax better. This place is not a critical part for speed, especially when\n  you create `DisjointUnionEnumeratedSets` with lambda functions just above.\n\n- I had not noticed that `IntegerListsLex` objects could have a 'name'\n  argument.. As all arguments, it must be documented in the INPUT section.\n\n- Same for `element_constructor` and `element_class`.\n\n- `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`\n  Just my two cents: I would return 'Infinity' instead of max_length. You\n  defined your `Infinity` in order to be fast, and you don't know what\n  `max_length` may be. This occurs several times.\n\n- You can save space and turn the two following tests into one (using the same\n  'all'). Occurs twice.\n  {{{\n  if not all(i in ZZ for i in floor):\n      raise TypeError(\"the parts of floor={} should be nonnegative integers\".format(floor))\n  if not all(i >= 0 for i in floor):\n      raise NotImplementedError(\"negative parts in floor={}\".format(floor))\n  }}}\n  This would also solve the following, which tests `ceiling` but mentions\n  `floor`\n  {{{\n  if not all(i >= 0 for i in ceiling):\n      raise NotImplementedError(\"negative parts in floor={}\".format(ceiling))\n  }}}\n\n- `# constructor is known to be safe and don't claim ownership on` -- \"does\n  not\".\n\n- Typing `IntegerListsLex.<tab>` in the console is very entertaining. I would be\n  very glad if we some day decide to consider this as a bug.\n\n- about `check_finiteness` -> what about `guess_finiteness` instead, to\n  emphasize that the function makes mistakes?\n\n- The error message when the set is infinite is misleading:\n  {{{\n  sage: L = IntegerListsLex(4)\n  sage: L._check_finiteness()\n  ...\n  ValueError: Could not check that the specified constraints yield a finite set\n  }}}\n  The code was able to perform the check, though it was not \"able to decide that\n  the set is finite\".\n\n- I do not understand this comment:\n  `If a part has no bound on its value, it will be detected at some point`\n  Do you mean that \"at some point in __iter__\" it will be detected? Probably\n  not, as this function is called only once.\n\n- The function `_check_finiteness` assumes that the alphabet size is bounded. It\n  is always true when this function is called, but the following raises no\n  warning:\n  {{{\n  sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):\n  ....:     pass\n  }}}\n  For the reason given earlier, the output is not sorted lexicographically. It\n  is not detected as infinite either.\n\n- The many `if A: return` from `_check_finiteness` can be replaced by a `if A or\n  B or C or ...: return`.\n\n- in `_check_finiteness`: the documentation of `limit()` says that it is only an\n  upper bound. Thus you cannot write the following:\n  {{{\n  if self._ceiling.limit() < self._floor.limit():\n      return\n  }}}\n\n- Same comment here\n  {{{\n  if self._floor.limit() > 0 or self._min_slope > 0:\n     floor_sum_lower_bound = Infinity\n  }}}\n\n- Also, it seems that `limit_start()` can be `Infinity`, in which case one\n  cannot deduce anything from the value of `limit`. Please add checks.\n\n- I stop reviewing `_check_finiteness`, as it is complicated while the situation\n  of `limit()` is not cleared.\n\n- `Which specific bound is returned is not set in stone`. Be more accurate.\n\nNathann",
    "created_at": "2015-04-07T15:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237323",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

This is what I did during the last 3~4 hours. I stopped before the end and did
not review `m_interval`, `_lookahead` nor the code of `Envelope`, as I really
should be working on mathematics instead of Sage `T_T`

Some are easy, some are harder. Also, let me write somewhere that I am against
keeping `integer_list_old` in Sage, as I am afraid that it will still be here
several years from now. Here are my comments:

- Module documentation -- in the 'itemize' section listing `IntegerListsLex` and
  `Envelope`, could you add a short description of what they are meant for?

- Why a 'history' section?

- Documentation of `IntegerListsLex`: instead of stating the *purpose* of the
  class (which is more something one would explain on a trac ticket), what about
  a SEEALSO section? I have the following paragraph in mind:
  {{{
  The main purpose is to provide a generic iteration engine for all
  the enumerated sets like :class:`Partitions`,
  class:`Compositions`, :class:`IntegerVectors`. It can also be
  used to generate many other combinatorial objects like Dyck paths,
  Motzkin paths, etc.
  }}}
  I thought that it would make more sense as a SEEALSO section pointing toward
  the mentionned objects.

- About this paragraph:
  {{{
  The set of allowable constraints has been specifically designed to enable
  iteration with a good time and memory complexity in most practical use cases,
  and in inverse lexicographic order (see below)
  }}}

  I do not believe that it is true, i.e. that the set of allowable contraints
  has been specifically designed to enable iteration with a good time and memory
  complexity.

  In particular, it is possible to get great speed improvements by writing a
  Constant Amortized Algorithm to list only partitions satisfying a smaller set
  of constraints like (sum,length,min/max part).

  This statement sounds wrong to me, and so I believe that it should be removed.

- Documentation of the parameter `n` -- you say that a list of integers can be
  provided but do not explain what the output will be.

- Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it
  seems to be, though I am not sure that it is the best design choice in this
  case.

- I was surprised by the following output:
  {{{
  sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()
  [[3], [2, 1], [1, 2], [1, 1, 1]]
  }}}
  I woud have expected the length of the lists to be at least 3, as I requested
  the first three parts to be `>=1`. The documentation is consistent, but I
  still find it surprising.

- ``check`` seems misnamed. It is not about checking the input or output, only
  about displaying warnings. What about `disable_warnings` instead?

- In the following text which says that one can force the enumeration when it is
  formally impossible, can you explicitly say what will happen? "All possible
  lists are enumerated, but the ordering is incorrect" or something?
  `If one wants to proceed anyway, one can sign a waiver by setting check=False:`

- About the finiteness check: what about a specific `allow_infinite_iterator`
  independent from the current 'check'.

- Building the doc of `integer_list.py` with `--warn-links` fails.

- `sage: list(IntegerListsLex(3, max_length=2, ))`

- Lexicographic ordering is broken when `n` is a list.
  {{{
  sage: print IntegerListsLex([1,2],length=3).list()
  [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0, 2, 0], [0, 1, 1], [0, 0, 2]]
  }}}

  In particular, the output differs depending on how `n` is sorted.

- Cardinality is broken when `n` is a list
  {{{
  sage: IntegerListsLex(3,length=3).cardinality()
  10
  sage: IntegerListsLex([3,3],length=3).cardinality()
  20
  }}}

- `return typecall(cls, n=n, **kwargs)` -- for clarity I find the normal
  syntax better. This place is not a critical part for speed, especially when
  you create `DisjointUnionEnumeratedSets` with lambda functions just above.

- I had not noticed that `IntegerListsLex` objects could have a 'name'
  argument.. As all arguments, it must be documented in the INPUT section.

- Same for `element_constructor` and `element_class`.

- `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`
  Just my two cents: I would return 'Infinity' instead of max_length. You
  defined your `Infinity` in order to be fast, and you don't know what
  `max_length` may be. This occurs several times.

- You can save space and turn the two following tests into one (using the same
  'all'). Occurs twice.
  {{{
  if not all(i in ZZ for i in floor):
      raise TypeError("the parts of floor={} should be nonnegative integers".format(floor))
  if not all(i >= 0 for i in floor):
      raise NotImplementedError("negative parts in floor={}".format(floor))
  }}}
  This would also solve the following, which tests `ceiling` but mentions
  `floor`
  {{{
  if not all(i >= 0 for i in ceiling):
      raise NotImplementedError("negative parts in floor={}".format(ceiling))
  }}}

- `# constructor is known to be safe and don't claim ownership on` -- "does
  not".

- Typing `IntegerListsLex.<tab>` in the console is very entertaining. I would be
  very glad if we some day decide to consider this as a bug.

- about `check_finiteness` -> what about `guess_finiteness` instead, to
  emphasize that the function makes mistakes?

- The error message when the set is infinite is misleading:
  {{{
  sage: L = IntegerListsLex(4)
  sage: L._check_finiteness()
  ...
  ValueError: Could not check that the specified constraints yield a finite set
  }}}
  The code was able to perform the check, though it was not "able to decide that
  the set is finite".

- I do not understand this comment:
  `If a part has no bound on its value, it will be detected at some point`
  Do you mean that "at some point in __iter__" it will be detected? Probably
  not, as this function is called only once.

- The function `_check_finiteness` assumes that the alphabet size is bounded. It
  is always true when this function is called, but the following raises no
  warning:
  {{{
  sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):
  ....:     pass
  }}}
  For the reason given earlier, the output is not sorted lexicographically. It
  is not detected as infinite either.

- The many `if A: return` from `_check_finiteness` can be replaced by a `if A or
  B or C or ...: return`.

- in `_check_finiteness`: the documentation of `limit()` says that it is only an
  upper bound. Thus you cannot write the following:
  {{{
  if self._ceiling.limit() < self._floor.limit():
      return
  }}}

- Same comment here
  {{{
  if self._floor.limit() > 0 or self._min_slope > 0:
     floor_sum_lower_bound = Infinity
  }}}

- Also, it seems that `limit_start()` can be `Infinity`, in which case one
  cannot deduce anything from the value of `limit`. Please add checks.

- I stop reviewing `_check_finiteness`, as it is complicated while the situation
  of `limit()` is not cleared.

- `Which specific bound is returned is not set in stone`. Be more accurate.

Nathann



---

archive/issue_comments_237324.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-04-07T15:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237324",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_237325.json:
```json
{
    "body": "Replying to [comment:412 ncohen]:\n> - About this paragraph:\n>   {{{\n>   The set of allowable constraints has been specifically designed to enable\n>   iteration with a good time and memory complexity in most practical use cases,\n>   and in inverse lexicographic order (see below)\n>   }}}\n> ...\n>   This statement sounds wrong to me, and so I believe that it should be removed.\nAgreed.\n\n> - I was surprised by the following output:\n>   {{{\n>   sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()\n>   [[3], [2, 1], [1, 2], [1, 1, 1]]\n>   }}}\n>   I woud have expected the length of the lists to be at least 3, as I requested\n>   the first three parts to be `>=1`. The documentation is consistent, but I\n>   still find it surprising.\nWhat should be done to make it less surprising? It is completely consistent with `min_part=1`.\n\n> - ``check`` seems misnamed. It is not about checking the input or output, only\n>   about displaying warnings. What about `disable_warnings` instead?\nI asked for this argument to be called `check`. Usually, it's exceptions which are controlled by a `check` argument, but I don't see why this cannot be warnings instead.\n\n> - `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`\n>   Just my two cents: I would return 'Infinity' instead of max_length. You\n>   defined your `Infinity` in order to be fast, and you don't know what\n>   `max_length` may be. This occurs several times.\nAgreed, see also `integer_or_infinity` from #17920.\n\n> - I do not understand this comment:\n>   `If a part has no bound on its value, it will be detected at some point`\n>   Do you mean that \"at some point in __iter__\" it will be detected? Probably\n>   not, as this function is called only once.\nAgreed that this is confusing. This comment should really be moved to and explained the docstring.\n\n> - The many `if A: return` from `_check_finiteness` can be replaced by a `if A or\n>   B or C or ...: return`.\nThat's just a matter of style. The many `if A: return` might be more clear to read...",
    "created_at": "2015-04-07T15:44:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237325",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:412 ncohen]:
> - About this paragraph:
>   {{{
>   The set of allowable constraints has been specifically designed to enable
>   iteration with a good time and memory complexity in most practical use cases,
>   and in inverse lexicographic order (see below)
>   }}}
> ...
>   This statement sounds wrong to me, and so I believe that it should be removed.
Agreed.

> - I was surprised by the following output:
>   {{{
>   sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()
>   [[3], [2, 1], [1, 2], [1, 1, 1]]
>   }}}
>   I woud have expected the length of the lists to be at least 3, as I requested
>   the first three parts to be `>=1`. The documentation is consistent, but I
>   still find it surprising.
What should be done to make it less surprising? It is completely consistent with `min_part=1`.

> - ``check`` seems misnamed. It is not about checking the input or output, only
>   about displaying warnings. What about `disable_warnings` instead?
I asked for this argument to be called `check`. Usually, it's exceptions which are controlled by a `check` argument, but I don't see why this cannot be warnings instead.

> - `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`
>   Just my two cents: I would return 'Infinity' instead of max_length. You
>   defined your `Infinity` in order to be fast, and you don't know what
>   `max_length` may be. This occurs several times.
Agreed, see also `integer_or_infinity` from #17920.

> - I do not understand this comment:
>   `If a part has no bound on its value, it will be detected at some point`
>   Do you mean that "at some point in __iter__" it will be detected? Probably
>   not, as this function is called only once.
Agreed that this is confusing. This comment should really be moved to and explained the docstring.

> - The many `if A: return` from `_check_finiteness` can be replaced by a `if A or
>   B or C or ...: return`.
That's just a matter of style. The many `if A: return` might be more clear to read...



---

archive/issue_comments_237326.json:
```json
{
    "body": "I'm okay with the state of `integer_vector.py`.",
    "created_at": "2015-04-07T16:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237326",
    "user": "https://github.com/tscrim"
}
```

I'm okay with the state of `integer_vector.py`.



---

archive/issue_comments_237327.json:
```json
{
    "body": "Thanks Nathann for the comments. I'll work on them tomorrow in the plane, taking off at 1pm here. In case you'd have a chance to throw some more before then, I could investigate them at the same occasion.\n\nCheers,\n                                 Nicolas",
    "created_at": "2015-04-07T18:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237327",
    "user": "https://github.com/nthiery"
}
```

Thanks Nathann for the comments. I'll work on them tomorrow in the plane, taking off at 1pm here. In case you'd have a chance to throw some more before then, I could investigate them at the same occasion.

Cheers,
                                 Nicolas



---

archive/issue_comments_237328.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T09:15:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T09:23:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237330.json:
```json
{
    "body": "Hi,\n\nI'll answer in several chunks, since I am not sure if I can take care\nof all before taking off.\n\nReplying to [comment:412 ncohen]:\n> - Module documentation -- in the 'itemize' section listing `IntegerListsLex` and\n>   `Envelope`, could you add a short description of what they are meant for?\n\nDone. This is quite redundant, so I was not sure what to put. Feel\nfree to edit to your taste.\n\n> - Why a 'history' section?\n\nQuite often the history is unnecessary because all the information is\nin the git history. But here the history spans other software and is\nharder to follow since the previous file was moved. This also gives\ncredit/blame record, and some sort of bibliography since there is no\npublished description of the algorithm (at least not yet).\n\n> - `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`\n>   Just my two cents: I would return 'Infinity' instead of max_length. You\n>   defined your `Infinity` in order to be fast, and you don't know what\n>   `max_length` may be. This occurs several times.\n\nGood point; I had hesitated but this is better. Fixed.\n\n> - You can save space and turn the two following tests into one (using the same\n>   'all'). Occurs twice.\n>   {{{\n>   if not all(i in ZZ for i in floor):\n>       raise TypeError(\"the parts of floor={} should be nonnegative integers\".format(floor))\n>   if not all(i >= 0 for i in floor):\n>       raise NotImplementedError(\"negative parts in floor={}\".format(floor))\n>   }}}\n>   This would also solve the following, which tests `ceiling` but mentions\n>   `floor`\n>   {{{\n>   if not all(i >= 0 for i in ceiling):\n>       raise NotImplementedError(\"negative parts in floor={}\".format(ceiling))\n>   }}}\n\nJeroen asked for a different error message (`TypeError`\nw.r.t. `NotImplementedError`), and I agree with him; so I did not\nchange this. But I fixed the floor to ceiling in the error\nmessage. Note btw that the `TypeError` is now done through a\nconversion to a tuple of ZZ.\n----\nNew commits:",
    "created_at": "2015-04-08T09:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237330",
    "user": "https://github.com/nthiery"
}
```

Hi,

I'll answer in several chunks, since I am not sure if I can take care
of all before taking off.

Replying to [comment:412 ncohen]:
> - Module documentation -- in the 'itemize' section listing `IntegerListsLex` and
>   `Envelope`, could you add a short description of what they are meant for?

Done. This is quite redundant, so I was not sure what to put. Feel
free to edit to your taste.

> - Why a 'history' section?

Quite often the history is unnecessary because all the information is
in the git history. But here the history spans other software and is
harder to follow since the previous file was moved. This also gives
credit/blame record, and some sort of bibliography since there is no
published description of the algorithm (at least not yet).

> - `self._max_length = ZZ(max_length) if max_length != Infinity else max_length`
>   Just my two cents: I would return 'Infinity' instead of max_length. You
>   defined your `Infinity` in order to be fast, and you don't know what
>   `max_length` may be. This occurs several times.

Good point; I had hesitated but this is better. Fixed.

> - You can save space and turn the two following tests into one (using the same
>   'all'). Occurs twice.
>   {{{
>   if not all(i in ZZ for i in floor):
>       raise TypeError("the parts of floor={} should be nonnegative integers".format(floor))
>   if not all(i >= 0 for i in floor):
>       raise NotImplementedError("negative parts in floor={}".format(floor))
>   }}}
>   This would also solve the following, which tests `ceiling` but mentions
>   `floor`
>   {{{
>   if not all(i >= 0 for i in ceiling):
>       raise NotImplementedError("negative parts in floor={}".format(ceiling))
>   }}}

Jeroen asked for a different error message (`TypeError`
w.r.t. `NotImplementedError`), and I agree with him; so I did not
change this. But I fixed the floor to ceiling in the error
message. Note btw that the `TypeError` is now done through a
conversion to a tuple of ZZ.
----
New commits:



---

archive/issue_comments_237331.json:
```json
{
    "body": "Replying to [comment:412 ncohen]:\nAlso, let me write somewhere that I\n>  am against keeping `integer_list_old` in Sage, as I am afraid that\n>  it will still be here several years from now.\n\nWe definitely should keep it around for benchmarking purposes at least\nuntil #18055 is finished. I am fine adding the removal of\n`integer_list_old` to the todo list for this ticket.\n\n>  - Documentation of `IntegerListsLex`: instead of stating the\n>  *purpose* of the class (which is more something one would explain\n>  on a trac ticket),\n>  what about\n>    a SEEALSO section? I have the following paragraph in mind:\n>    {{{\n>    The main purpose is to provide a generic iteration engine for all\n>    the enumerated sets like :class:`Partitions`,\n>    class:`Compositions`, :class:`IntegerVectors`. It can also be\n>    used to generate many other combinatorial objects like Dyck paths,\n>    Motzkin paths, etc.\n>    }}}\n>    I thought that it would make more sense as a SEEALSO section pointing\n>  toward\n>    the mentionned objects.\n\nA user reading this documentation is likely to know about integer\npartitions, compositions or such. Mentioning them early on gives\nimmediately an idea of the range of applications, and thus a better\nunderstanding of the upcoming description of the specific input.  So I\nwould want this text to come before the long description of the input.\nI am fine making it into a SEEALSO if that's ok to put one before\nINPUT.\n\nAlso it's also a useful piece of information for users, even more for\ndevelopers, to better understand the architecture, and know when to\nuse this class or another one.  Such information really belongs to the\ndocumentation, not trac.",
    "created_at": "2015-04-08T09:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237331",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:412 ncohen]:
Also, let me write somewhere that I
>  am against keeping `integer_list_old` in Sage, as I am afraid that
>  it will still be here several years from now.

We definitely should keep it around for benchmarking purposes at least
until #18055 is finished. I am fine adding the removal of
`integer_list_old` to the todo list for this ticket.

>  - Documentation of `IntegerListsLex`: instead of stating the
>  *purpose* of the class (which is more something one would explain
>  on a trac ticket),
>  what about
>    a SEEALSO section? I have the following paragraph in mind:
>    {{{
>    The main purpose is to provide a generic iteration engine for all
>    the enumerated sets like :class:`Partitions`,
>    class:`Compositions`, :class:`IntegerVectors`. It can also be
>    used to generate many other combinatorial objects like Dyck paths,
>    Motzkin paths, etc.
>    }}}
>    I thought that it would make more sense as a SEEALSO section pointing
>  toward
>    the mentionned objects.

A user reading this documentation is likely to know about integer
partitions, compositions or such. Mentioning them early on gives
immediately an idea of the range of applications, and thus a better
understanding of the upcoming description of the specific input.  So I
would want this text to come before the long description of the input.
I am fine making it into a SEEALSO if that's ok to put one before
INPUT.

Also it's also a useful piece of information for users, even more for
developers, to better understand the architecture, and know when to
use this class or another one.  Such information really belongs to the
documentation, not trac.



---

archive/issue_comments_237332.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T09:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237333.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T09:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237334.json:
```json
{
    "body": "> We definitely should keep it around for benchmarking purposes at least\n> until #18055 is finished. I am fine adding the removal of\n> `integer_list_old` to the todo list for this ticket.\n\nI do not see the point. You can checkout Sage 6.5 whenever you like if you ever need to benchmark this old (and broken) code.\n\n> A user reading this documentation is likely to know about integer\n> partitions, compositions or such.\n\nYou cannot make assumptions like that. A user might find this class because he was redirected there after reading the doc of `IntegerVectors` (for instance).\n\n> I am fine making it into a SEEALSO if that's ok to put one before\n> INPUT.\n\nWorks for me.\n\nNathann",
    "created_at": "2015-04-08T09:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237334",
    "user": "https://github.com/nathanncohen"
}
```

> We definitely should keep it around for benchmarking purposes at least
> until #18055 is finished. I am fine adding the removal of
> `integer_list_old` to the todo list for this ticket.

I do not see the point. You can checkout Sage 6.5 whenever you like if you ever need to benchmark this old (and broken) code.

> A user reading this documentation is likely to know about integer
> partitions, compositions or such.

You cannot make assumptions like that. A user might find this class because he was redirected there after reading the doc of `IntegerVectors` (for instance).

> I am fine making it into a SEEALSO if that's ok to put one before
> INPUT.

Works for me.

Nathann



---

archive/issue_comments_237335.json:
```json
{
    "body": "Replying to [comment:412 ncohen]:\n>  - Documentation of the parameter `n` -- you say that a list of\n>    integers can be provided but do not explain what the output will\n>    be.\n>  - Building the doc of `integer_list.py` with `--warn-links` fails.\n\nFixed.",
    "created_at": "2015-04-08T09:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237335",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:412 ncohen]:
>  - Documentation of the parameter `n` -- you say that a list of
>    integers can be provided but do not explain what the output will
>    be.
>  - Building the doc of `integer_list.py` with `--warn-links` fails.

Fixed.



---

archive/issue_comments_237336.json:
```json
{
    "body": "I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.",
    "created_at": "2015-04-08T09:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237336",
    "user": "https://github.com/jdemeyer"
}
```

I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.



---

archive/issue_comments_237337.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T15:23:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237337",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237338.json:
```json
{
    "body": "Replying to [comment:424 jdemeyer]:\n> I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.\n\nI agree with this. Fixed!",
    "created_at": "2015-04-08T15:24:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237338",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:424 jdemeyer]:
> I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.

I agree with this. Fixed!



---

archive/issue_comments_237339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T16:17:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237340.json:
```json
{
    "body": "> - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it\n>   seems to be, though I am not sure that it is the best design choice in this\n>   case.\n\nYes. As far as I know this is how it was before.\n\n> - I was surprised by the following output:\n>   {{{\n>   sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()\n>   [[3], [2, 1], [1, 2], [1, 1, 1]]\n>   }}}\n>   I woud have expected the length of the lists to be at least 3, as I requested\n>   the first three parts to be `>=1`. The documentation is consistent, but I\n>   still find it surprising.\n\nAs Jeroen mentioned, floor just requires that if there is a part, then it satisfies the\nconstraint. If no part is present, that is ok. If you want at least three parts, you need\nto specify min_length.\n\n> - ``check`` seems misnamed. It is not about checking the input or output, only\n>   about displaying warnings. What about `disable_warnings` instead?\n\nJeroen had asked us to change this. So please first agree among yourself before asking\nto change this again.\n \n> - In the following text which says that one can force the enumeration when it is\n>   formally impossible, can you explicitly say what will happen? \"All possible\n>   lists are enumerated, but the ordering is incorrect\" or something?\n>   `If one wants to proceed anyway, one can sign a waiver by setting check=False:`\n\nWhen a function for the floor or ceiling is given, it is impossible to check that\nthe conditions give a finite set since the list of values is in principle infinite.\nIn this case the algorithm can either hang (as it computes more and more parts of the\ninteger list) or it can happen that a tail of 000100000.... will appear in which case\nnor all elements in the list will be iterated over.\n\n> - `sage: list(IntegerListsLex(3, max_length=2, ))`\n\nFixed.\n \n> - Lexicographic ordering is broken when `n` is a list.\n>   {{{\n>   sage: print IntegerListsLex([1,2],length=3).list()\n>   [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0, 2, 0], [0, 1, 1], [0, 0, 2]]\n>   }}}\n> \n>   In particular, the output differs depending on how `n` is sorted.\n> \n> - Cardinality is broken when `n` is a list\n>   {{{\n>   sage: IntegerListsLex(3,length=3).cardinality()\n>   10\n>   sage: IntegerListsLex([3,3],length=3).cardinality()\n>   20\n>   }}}\n\nSee the documentation!",
    "created_at": "2015-04-08T16:29:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237340",
    "user": "https://github.com/anneschilling"
}
```

> - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it
>   seems to be, though I am not sure that it is the best design choice in this
>   case.

Yes. As far as I know this is how it was before.

> - I was surprised by the following output:
>   {{{
>   sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()
>   [[3], [2, 1], [1, 2], [1, 1, 1]]
>   }}}
>   I woud have expected the length of the lists to be at least 3, as I requested
>   the first three parts to be `>=1`. The documentation is consistent, but I
>   still find it surprising.

As Jeroen mentioned, floor just requires that if there is a part, then it satisfies the
constraint. If no part is present, that is ok. If you want at least three parts, you need
to specify min_length.

> - ``check`` seems misnamed. It is not about checking the input or output, only
>   about displaying warnings. What about `disable_warnings` instead?

Jeroen had asked us to change this. So please first agree among yourself before asking
to change this again.
 
> - In the following text which says that one can force the enumeration when it is
>   formally impossible, can you explicitly say what will happen? "All possible
>   lists are enumerated, but the ordering is incorrect" or something?
>   `If one wants to proceed anyway, one can sign a waiver by setting check=False:`

When a function for the floor or ceiling is given, it is impossible to check that
the conditions give a finite set since the list of values is in principle infinite.
In this case the algorithm can either hang (as it computes more and more parts of the
integer list) or it can happen that a tail of 000100000.... will appear in which case
nor all elements in the list will be iterated over.

> - `sage: list(IntegerListsLex(3, max_length=2, ))`

Fixed.
 
> - Lexicographic ordering is broken when `n` is a list.
>   {{{
>   sage: print IntegerListsLex([1,2],length=3).list()
>   [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0, 2, 0], [0, 1, 1], [0, 0, 2]]
>   }}}
> 
>   In particular, the output differs depending on how `n` is sorted.
> 
> - Cardinality is broken when `n` is a list
>   {{{
>   sage: IntegerListsLex(3,length=3).cardinality()
>   10
>   sage: IntegerListsLex([3,3],length=3).cardinality()
>   20
>   }}}

See the documentation!



---

archive/issue_comments_237341.json:
```json
{
    "body": "> > - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it\n> >   seems to be, though I am not sure that it is the best design choice in this\n> >   case.\n> \n> Yes. As far as I know this is how it was before.\n\nWhat do you think of it?\n\n> > - In the following text which says that one can force the enumeration when it is\n> >   formally impossible, can you explicitly say what will happen? \"All possible\n> >   lists are enumerated, but the ordering is incorrect\" or something?\n> >   `If one wants to proceed anyway, one can sign a waiver by setting check=False:`\n> \n> When a function for the floor or ceiling is given, it is impossible to check that\n> the conditions give a finite set since the list of values is in principle infinite.\n> In this case the algorithm can either hang (as it computes more and more parts of the\n> integer list) or it can happen that a tail of 000100000.... will appear in which case\n> nor all elements in the list will be iterated over.\n\nCan you make this explicit in the doc?\n\n> See the documentation!\n\nIt does not address the problem that output is not sorted as it should.\n\nNathann",
    "created_at": "2015-04-08T16:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237341",
    "user": "https://github.com/nathanncohen"
}
```

> > - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it
> >   seems to be, though I am not sure that it is the best design choice in this
> >   case.
> 
> Yes. As far as I know this is how it was before.

What do you think of it?

> > - In the following text which says that one can force the enumeration when it is
> >   formally impossible, can you explicitly say what will happen? "All possible
> >   lists are enumerated, but the ordering is incorrect" or something?
> >   `If one wants to proceed anyway, one can sign a waiver by setting check=False:`
> 
> When a function for the floor or ceiling is given, it is impossible to check that
> the conditions give a finite set since the list of values is in principle infinite.
> In this case the algorithm can either hang (as it computes more and more parts of the
> integer list) or it can happen that a tail of 000100000.... will appear in which case
> nor all elements in the list will be iterated over.

Can you make this explicit in the doc?

> See the documentation!

It does not address the problem that output is not sorted as it should.

Nathann



---

archive/issue_comments_237342.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T20:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237342",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237343.json:
```json
{
    "body": "Replying to [comment:429 ncohen]:\n\n> > > - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it\n> > > seems to be, though I am not sure that it is the best design choice in this\n> > > case.\n> > > \n> > \n> > Yes. As far as I know this is how it was before.\n> > \n> \n> What do you think of it?\n\nAs stated in the documentation, this feature is kept for backward compatibility, see\n\n\n```\nsage: from sage.combinat.integer_list_old import IntegerListsLex as IntegerListsLexOld\nsage: IntegerListsLexOld([2,2],length=2).list()\n/Applications/sage/src/bin/sage-ipython:1:\n********************************************************************************\nThe old implementation of IntegerListsLex does not allow for arbitrary input; non-allowed input can return wrong results, please see the documentation for IntegerListsLex for details.\nThis issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/17548.\n********************************************************************************\n[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]\n```\n\n\n\n> > > - In the following text which says that one can force the enumeration when it is\n> > > formally impossible, can you explicitly say what will happen? \"All possible\n> > > lists are enumerated, but the ordering is incorrect\" or something?\n> > > `If one wants to proceed anyway, one can sign a waiver by setting check=False:`\n> > > \n> > \n> > When a function for the floor or ceiling is given, it is impossible to check that\n> > the conditions give a finite set since the list of values is in principle infinite.\n> > In this case the algorithm can either hang (as it computes more and more parts of the\n> > integer list) or it can happen that a tail of 000100000.... will appear in which case\n> > nor all elements in the list will be iterated over.\n> > \n> \n> Can you make this explicit in the doc?\n\nIt is. See line 403 onward.\n\n> > See the documentation!\n> > \n> \n> It does not address the problem that output is not sorted as it should.\n\nIt is documented what it does and that it does not sort it the way you suggest. \nSee line 496 onward.",
    "created_at": "2015-04-08T21:45:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237343",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:429 ncohen]:

> > > - Are `min_sum` and `max_sum` also ignored when `n` is a list? From the doc it
> > > seems to be, though I am not sure that it is the best design choice in this
> > > case.
> > > 
> > 
> > Yes. As far as I know this is how it was before.
> > 
> 
> What do you think of it?

As stated in the documentation, this feature is kept for backward compatibility, see


```
sage: from sage.combinat.integer_list_old import IntegerListsLex as IntegerListsLexOld
sage: IntegerListsLexOld([2,2],length=2).list()
/Applications/sage/src/bin/sage-ipython:1:
********************************************************************************
The old implementation of IntegerListsLex does not allow for arbitrary input; non-allowed input can return wrong results, please see the documentation for IntegerListsLex for details.
This issue is being tracked at http://trac.sagemath.org/sage_trac/ticket/17548.
********************************************************************************
[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]
```



> > > - In the following text which says that one can force the enumeration when it is
> > > formally impossible, can you explicitly say what will happen? "All possible
> > > lists are enumerated, but the ordering is incorrect" or something?
> > > `If one wants to proceed anyway, one can sign a waiver by setting check=False:`
> > > 
> > 
> > When a function for the floor or ceiling is given, it is impossible to check that
> > the conditions give a finite set since the list of values is in principle infinite.
> > In this case the algorithm can either hang (as it computes more and more parts of the
> > integer list) or it can happen that a tail of 000100000.... will appear in which case
> > nor all elements in the list will be iterated over.
> > 
> 
> Can you make this explicit in the doc?

It is. See line 403 onward.

> > See the documentation!
> > 
> 
> It does not address the problem that output is not sorted as it should.

It is documented what it does and that it does not sort it the way you suggest. 
See line 496 onward.



---

archive/issue_comments_237344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-08T21:47:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237345.json:
```json
{
    "body": "The following is weird behavior that needs to be fixed!!\n\n\n```\nsage: IntegerListsLex([2,2],length=2).list()\n[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]\nsage: IntegerListsLex([2,2],length=3).list()\n[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]\n```\n\n\nThe answer should really be\n\n\n```\nsage: IntegerListsLex([2,2],length=3).list()\n[[2, 0, 0],\n [1, 1, 0],\n [1, 0, 1],\n [0, 2, 0],\n [0, 1, 1],\n [0, 0, 2],\n [2, 0, 0],\n [1, 1, 0],\n [1, 0, 1],\n [0, 2, 0],\n [0, 1, 1],\n [0, 0, 2]]\n```\n\n----\nNew commits:",
    "created_at": "2015-04-08T21:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237345",
    "user": "https://github.com/anneschilling"
}
```

The following is weird behavior that needs to be fixed!!


```
sage: IntegerListsLex([2,2],length=2).list()
[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]
sage: IntegerListsLex([2,2],length=3).list()
[[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]
```


The answer should really be


```
sage: IntegerListsLex([2,2],length=3).list()
[[2, 0, 0],
 [1, 1, 0],
 [1, 0, 1],
 [0, 2, 0],
 [0, 1, 1],
 [0, 0, 2],
 [2, 0, 0],
 [1, 1, 0],
 [1, 0, 1],
 [0, 2, 0],
 [0, 1, 1],
 [0, 0, 2]]
```

----
New commits:



---

archive/issue_comments_237346.json:
```json
{
    "body": "Replying to [comment:412 ncohen]:\n> - I do not understand this comment:\n>   `If a part has no bound on its value, it will be detected at some point`\n>   Do you mean that \"at some point in __iter__\" it will be detected? Probably\n>   not, as this function is called only once.\n\nIt will be detected during the algorithm that builds up the integer vector successively.\nThe algorithm tries to add each part and if at some point the bound on a part is \ninfinite, then it will raise an error.\n\n> - The function `_check_finiteness` assumes that the alphabet size is bounded. It\n>   is always true when this function is called, but the following raises no\n>   warning:\n>   {{{\n>   sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):\n>   ....:     pass\n>   }}}\n>   For the reason given earlier, the output is not sorted lexicographically. It\n>   is not detected as infinite either.\n\n`_check_finiteness` only tests this for each piece in the DisjointEnumeratedSet \n(when a list is given for `n`) and checks that each piece is a finite set.",
    "created_at": "2015-04-08T22:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237346",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:412 ncohen]:
> - I do not understand this comment:
>   `If a part has no bound on its value, it will be detected at some point`
>   Do you mean that "at some point in __iter__" it will be detected? Probably
>   not, as this function is called only once.

It will be detected during the algorithm that builds up the integer vector successively.
The algorithm tries to add each part and if at some point the bound on a part is 
infinite, then it will raise an error.

> - The function `_check_finiteness` assumes that the alphabet size is bounded. It
>   is always true when this function is called, but the following raises no
>   warning:
>   {{{
>   sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):
>   ....:     pass
>   }}}
>   For the reason given earlier, the output is not sorted lexicographically. It
>   is not detected as infinite either.

`_check_finiteness` only tests this for each piece in the DisjointEnumeratedSet 
(when a list is given for `n`) and checks that each piece is a finite set.



---

archive/issue_comments_237347.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T02:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237347",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237348.json:
```json
{
    "body": "Replying to [comment:433 aschilling]:\n> The following is weird behavior that needs to be fixed!!\n> \n> {{{\n> sage: IntegerListsLex([2,2],length=2).list()\n> [[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]\n> sage: IntegerListsLex([2,2],length=3).list()\n> [[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]\n> }}}\n> \n> The answer should really be\n> \n> {{{\n> sage: IntegerListsLex([2,2],length=3).list()\n> [[2, 0, 0],\n>  [1, 1, 0],\n>  [1, 0, 1],\n>  [0, 2, 0],\n>  [0, 1, 1],\n>  [0, 0, 2],\n>  [2, 0, 0],\n>  [1, 1, 0],\n>  [1, 0, 1],\n>  [0, 2, 0],\n>  [0, 1, 1],\n>  [0, 0, 2]]\n> }}}\n\nFixed!",
    "created_at": "2015-04-09T02:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237348",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:433 aschilling]:
> The following is weird behavior that needs to be fixed!!
> 
> {{{
> sage: IntegerListsLex([2,2],length=2).list()
> [[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]
> sage: IntegerListsLex([2,2],length=3).list()
> [[2, 0], [1, 1], [0, 2], [2, 0], [1, 1], [0, 2]]
> }}}
> 
> The answer should really be
> 
> {{{
> sage: IntegerListsLex([2,2],length=3).list()
> [[2, 0, 0],
>  [1, 1, 0],
>  [1, 0, 1],
>  [0, 2, 0],
>  [0, 1, 1],
>  [0, 0, 2],
>  [2, 0, 0],
>  [1, 1, 0],
>  [1, 0, 1],
>  [0, 2, 0],
>  [0, 1, 1],
>  [0, 0, 2]]
> }}}

Fixed!



---

archive/issue_comments_237349.json:
```json
{
    "body": "On Tue, Apr 07, 2015 at 03:06:42PM -0000, sage-trac wrote:\n>  - Lexicographic ordering is broken when `n` is a list.\n>    {{{\n>    sage: print IntegerListsLex([1,2],length=3).list()\n>    [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0,\n>  2, 0], [0, 1, 1], [0, 0, 2]]\n>    }}}\n> \n>    In particular, the output differs depending on how `n` is sorted.\n\nIndeed, and this is in fact a feature. I reworked the documentation to\nbetter highlight this.\n\n>  - Cardinality is broken when `n` is a list\n>    {{{\n>    sage: IntegerListsLex(3,length=3).cardinality()\n>    10\n>    sage: IntegerListsLex([3,3],length=3).cardinality()\n>    20\n>    }}}\n\nI documented this behavior some more. That's part of the\nspecifications that this returns a disjoint union. A different\nspecification might look desirable, but there would be no efficient\nway to handle it.\n\n>  - `return typecall(cls, n=n, **kwargs)` -- for clarity I find\n>    the normal syntax better. This place is not a critical part for\n>    speed, especially when you create `DisjointUnionEnumeratedSets`\n>    with lambda functions just above.\n\nI am not sure what you mean by \"normal syntax\". That you prefer using\nDisjointUnionEnumeratedSets directly rather than this syntactic sugar?\n\n>  - Are `min_sum` and `max_sum` also ignored when `n` is a list? From\n>    the doc it seems to be, though I am not sure that it is the best\n>    design choice in this case.\n\nIndeed they are ignored. I don't see a simple way to implement it\notherwise.\n\n\nSpeaking of which: should there be a warning when a user-specified\nvalue for `min_sum` or `max_sum` is overridden by `n`? Same for\n`length` versus `min_length` and `max_length`.\n\n\n>  - I was surprised by the following output:\n>    {{{\n>    sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()\n>    [[3], [2, 1], [1, 2], [1, 1, 1]]\n>    }}}\n\n>    I would have expected the length of the lists to be at least 3,\n>    as I requested the first three parts to be `>=1`. The\n>    documentation is consistent, but I still find it surprising.\n\nI agree it can be surprising at first sight, but the other way round\nwould have prevented interesting use cases. Not that some of the\nspecialized classes, like partitions or integer vectors, take a\nseparate argument inner and outer which does impose length\nrestrictions, according to the usual math vocable in those contexts.\n\n>  - ``check`` seems misnamed\n>  - About the finiteness check: what about a specific\n>  `allow_infinite_iterator`\n>    independent from the current 'check'.\n\nI also wondered, but see the discussion with Jeroen: let's keep things\nsimple until we actually meet a serious use case.\n\n\n>  - {{{# constructor is known to be safe and don't claim ownership\n     on}}} -- \"does not\".\n\nDone.\n\n\n>  - Typing `IntegerListsLex.<tab>` in the console is very\n>    entertaining. I would be very glad if we some day decide to\n>    consider this as a bug.\n\nAgreed: about one half of the items should not be there. But that's a\ndifferent discussion.\n\n\n>  - I had not noticed that `IntegerListsLex` objects could have a 'name'\n>    argument.. As all arguments, it must be documented in the INPUT section.\n>  - Same for `element_constructor` and `element_class`.\n\nDone.\n\n\n>  - The error message when the set is infinite is misleading:\n>    {{{\n>    sage: L = IntegerListsLex(4)\n>    sage: L._check_finiteness()\n>    ...\n>    ValueError: Could not check that the specified constraints yield a\n>  finite set\n>    }}}\n>    The code was able to perform the check, though it was not \"able to\n>  decide that\n>    the set is finite\".\n\nGood point. At the end of the day, I made it into \"could not prove\nthat the set is finite\" which better highlights the lack of symmetry.\n\n>  - I do not understand this comment:\n>    {{{If a part has no bound on its value, it will be detected at some\n>  point}}}\n>    Do you mean that \"at some point in __iter__\" it will be detected?\n>  Probably\n>    not, as this function is called only once.\n\nI rewrote the documentation of `_check_finiteness` to be more specific\nand discuss this point.\n\n>  - about `check_finiteness` -> what about `guess_finiteness` instead, to\n>    emphasize that the function makes mistakes?\n\nI see your point; however `guess` improperly suggests that it's going\nto return a boolean, whereas `check` conveys that it's about trying to\ncatch and report bad situations.\n\nAnother issue with this name, which is even more apparent with the\nrewrite of the documentation, is that this method is really about\ntrying to prove the existence of a bound on the length.\n\nOh well, I believe it's good enough for now; it's a private method\nwith an extensive documentation giving a precise specification; if\nsomeone comes up with a perfect name, it's a trivial change.  Besides\n`check` conveys that the verification needs not be comprehensive.\n\n\n>  - The function `_check_finiteness` assumes that the alphabet size is\n>  bounded. It\n>    is always true when this function is called, but the following raises no\n>    warning:\n>    {{{\n>    sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):\n>    ....:     pass\n>    }}}\n>    For the reason given earlier, the output is not sorted\n>  lexicographically. It\n>    is not detected as infinite either.\n\nCorrect, which is fine: the above example is properly iterable, and\nit's nowhere claimed to be finite:\n\n\n```\nsage: C = IntegerListsLex(NonNegativeIntegers(),max_length=3)\nsage: C in EnumeratedSets().Finite()\nFalse\n```\n\n\nIn general, it's documented that `n=iterable` is nothing but a\nconvenience, and that it does not return an `IntegerListsLex` object\nbut a disjoint union thereof. I would not want to pollute the\ndocumentation everywhere with straightforward consequences.\n\n>  - The many `if A: return` from `_check_finiteness` can be replaced by a\n>  `if A or\n>    B or C or ...: return`.\n\nAs Jeroen says, that's a matter of style. Here I like that it\nhighlights the fact that each test is independent.  So the reader can\nthink about just one at a time.\n\n\n>  - in `_check_finiteness`: the documentation of `limit()` says that it is\n>  only an\n>    upper bound. Thus you cannot write the following:\n>    {{{\n>    if self._ceiling.limit() < self._floor.limit():\n>        return\n>    }}}\n>  - Same comment here\n>    {{{\n>    if self._floor.limit() > 0 or self._min_slope > 0:\n>       floor_sum_lower_bound = Infinity\n>    }}}\n> \n\nJeroen's fault! (Just kidding :-) )\n\nThat's actually correct: for the floor, `limit` in fact returns a\nlower bound. I reinstated the documentation and tests for this as they\nhad gotten scrambled in the sign-refactoring of Envelope.\n\n>  - Also, it seems that `limit_start()` can be `Infinity`, in which case one\n>    cannot deduce anything from the value of `limit`. Please add checks.\n\nAh yes, the specifications of `limit` / `limit_start` were not\nexplicit in this case. Fixed. With those specs, the deduction is\nactually correct.\n\n>  - I stop reviewing `_check_finiteness`, as it is complicated while the\n>  situation\n>    of `limit()` is not cleared.\n\nHopefully it's cleared now!\n\n>  - `Which specific bound is returned is not set in stone`. Be more\n>  accurate.\n\nI tried to make the sentence clearer.\n\nMore tomorrow. Off to bed now!\n\nCheers from Montreal,\n                                    Nicolas",
    "created_at": "2015-04-09T02:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237349",
    "user": "https://github.com/nthiery"
}
```

On Tue, Apr 07, 2015 at 03:06:42PM -0000, sage-trac wrote:
>  - Lexicographic ordering is broken when `n` is a list.
>    {{{
>    sage: print IntegerListsLex([1,2],length=3).list()
>    [[1, 0, 0], [0, 1, 0], [0, 0, 1], [2, 0, 0], [1, 1, 0], [1, 0, 1], [0,
>  2, 0], [0, 1, 1], [0, 0, 2]]
>    }}}
> 
>    In particular, the output differs depending on how `n` is sorted.

Indeed, and this is in fact a feature. I reworked the documentation to
better highlight this.

>  - Cardinality is broken when `n` is a list
>    {{{
>    sage: IntegerListsLex(3,length=3).cardinality()
>    10
>    sage: IntegerListsLex([3,3],length=3).cardinality()
>    20
>    }}}

I documented this behavior some more. That's part of the
specifications that this returns a disjoint union. A different
specification might look desirable, but there would be no efficient
way to handle it.

>  - `return typecall(cls, n=n, **kwargs)` -- for clarity I find
>    the normal syntax better. This place is not a critical part for
>    speed, especially when you create `DisjointUnionEnumeratedSets`
>    with lambda functions just above.

I am not sure what you mean by "normal syntax". That you prefer using
DisjointUnionEnumeratedSets directly rather than this syntactic sugar?

>  - Are `min_sum` and `max_sum` also ignored when `n` is a list? From
>    the doc it seems to be, though I am not sure that it is the best
>    design choice in this case.

Indeed they are ignored. I don't see a simple way to implement it
otherwise.


Speaking of which: should there be a warning when a user-specified
value for `min_sum` or `max_sum` is overridden by `n`? Same for
`length` versus `min_length` and `max_length`.


>  - I was surprised by the following output:
>    {{{
>    sage: IntegerListsLex(3,max_length=3,floor=[1,1,1]).list()
>    [[3], [2, 1], [1, 2], [1, 1, 1]]
>    }}}

>    I would have expected the length of the lists to be at least 3,
>    as I requested the first three parts to be `>=1`. The
>    documentation is consistent, but I still find it surprising.

I agree it can be surprising at first sight, but the other way round
would have prevented interesting use cases. Not that some of the
specialized classes, like partitions or integer vectors, take a
separate argument inner and outer which does impose length
restrictions, according to the usual math vocable in those contexts.

>  - ``check`` seems misnamed
>  - About the finiteness check: what about a specific
>  `allow_infinite_iterator`
>    independent from the current 'check'.

I also wondered, but see the discussion with Jeroen: let's keep things
simple until we actually meet a serious use case.


>  - {{{# constructor is known to be safe and don't claim ownership
     on}}} -- "does not".

Done.


>  - Typing `IntegerListsLex.<tab>` in the console is very
>    entertaining. I would be very glad if we some day decide to
>    consider this as a bug.

Agreed: about one half of the items should not be there. But that's a
different discussion.


>  - I had not noticed that `IntegerListsLex` objects could have a 'name'
>    argument.. As all arguments, it must be documented in the INPUT section.
>  - Same for `element_constructor` and `element_class`.

Done.


>  - The error message when the set is infinite is misleading:
>    {{{
>    sage: L = IntegerListsLex(4)
>    sage: L._check_finiteness()
>    ...
>    ValueError: Could not check that the specified constraints yield a
>  finite set
>    }}}
>    The code was able to perform the check, though it was not "able to
>  decide that
>    the set is finite".

Good point. At the end of the day, I made it into "could not prove
that the set is finite" which better highlights the lack of symmetry.

>  - I do not understand this comment:
>    {{{If a part has no bound on its value, it will be detected at some
>  point}}}
>    Do you mean that "at some point in __iter__" it will be detected?
>  Probably
>    not, as this function is called only once.

I rewrote the documentation of `_check_finiteness` to be more specific
and discuss this point.

>  - about `check_finiteness` -> what about `guess_finiteness` instead, to
>    emphasize that the function makes mistakes?

I see your point; however `guess` improperly suggests that it's going
to return a boolean, whereas `check` conveys that it's about trying to
catch and report bad situations.

Another issue with this name, which is even more apparent with the
rewrite of the documentation, is that this method is really about
trying to prove the existence of a bound on the length.

Oh well, I believe it's good enough for now; it's a private method
with an extensive documentation giving a precise specification; if
someone comes up with a perfect name, it's a trivial change.  Besides
`check` conveys that the verification needs not be comprehensive.


>  - The function `_check_finiteness` assumes that the alphabet size is
>  bounded. It
>    is always true when this function is called, but the following raises no
>    warning:
>    {{{
>    sage: for x in IntegerListsLex(NonNegativeIntegers(),max_length=3):
>    ....:     pass
>    }}}
>    For the reason given earlier, the output is not sorted
>  lexicographically. It
>    is not detected as infinite either.

Correct, which is fine: the above example is properly iterable, and
it's nowhere claimed to be finite:


```
sage: C = IntegerListsLex(NonNegativeIntegers(),max_length=3)
sage: C in EnumeratedSets().Finite()
False
```


In general, it's documented that `n=iterable` is nothing but a
convenience, and that it does not return an `IntegerListsLex` object
but a disjoint union thereof. I would not want to pollute the
documentation everywhere with straightforward consequences.

>  - The many `if A: return` from `_check_finiteness` can be replaced by a
>  `if A or
>    B or C or ...: return`.

As Jeroen says, that's a matter of style. Here I like that it
highlights the fact that each test is independent.  So the reader can
think about just one at a time.


>  - in `_check_finiteness`: the documentation of `limit()` says that it is
>  only an
>    upper bound. Thus you cannot write the following:
>    {{{
>    if self._ceiling.limit() < self._floor.limit():
>        return
>    }}}
>  - Same comment here
>    {{{
>    if self._floor.limit() > 0 or self._min_slope > 0:
>       floor_sum_lower_bound = Infinity
>    }}}
> 

Jeroen's fault! (Just kidding :-) )

That's actually correct: for the floor, `limit` in fact returns a
lower bound. I reinstated the documentation and tests for this as they
had gotten scrambled in the sign-refactoring of Envelope.

>  - Also, it seems that `limit_start()` can be `Infinity`, in which case one
>    cannot deduce anything from the value of `limit`. Please add checks.

Ah yes, the specifications of `limit` / `limit_start` were not
explicit in this case. Fixed. With those specs, the deduction is
actually correct.

>  - I stop reviewing `_check_finiteness`, as it is complicated while the
>  situation
>    of `limit()` is not cleared.

Hopefully it's cleared now!

>  - `Which specific bound is returned is not set in stone`. Be more
>  accurate.

I tried to make the sentence clearer.

More tomorrow. Off to bed now!

Cheers from Montreal,
                                    Nicolas



---

archive/issue_comments_237350.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T02:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237350",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237351.json:
```json
{
    "body": "Hello Nicolas,\n\nI reported the following problems:\n\n- From the doumentation: infinite set, no warning:\n  {{{\n  sage: for x in IntegerListsLex(NonNegativeIntegers(),length=1):\n  ....:     pass\n  }}}\n\n- Non ordered output:\n  {{{\n  sage: IntegerListsLex([1,2],length=3).list()\n  [[1, 0, 0],\n   [0, 1, 0],\n   [0, 0, 1],\n   [2, 0, 0],\n   [1, 1, 0],\n   [1, 0, 1],\n   [0, 2, 0],\n   [0, 1, 1],\n   [0, 0, 2]]\n  }}}\n\n> Indeed, and this is in fact a feature. I reworked the documentation to better\n> highlight this.\n\nI consider this example to break what the class promises (by being called\n`IntegerListsLex`): its output is not sorted lexicograpically.\n\nNow, I agree that this is hard to fix inside of the class. Thus instead of\nclaiming that it is not a bug by adding a line of documentation (which is why\nyou are rewriting the class today) please consider deprecating it. Updating the\ncode that calls it should not be a problem, as it can call\n`DisjointUnionEnumeratedSets` directly.\n\nNathann",
    "created_at": "2015-04-09T06:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237351",
    "user": "https://github.com/nathanncohen"
}
```

Hello Nicolas,

I reported the following problems:

- From the doumentation: infinite set, no warning:
  {{{
  sage: for x in IntegerListsLex(NonNegativeIntegers(),length=1):
  ....:     pass
  }}}

- Non ordered output:
  {{{
  sage: IntegerListsLex([1,2],length=3).list()
  [[1, 0, 0],
   [0, 1, 0],
   [0, 0, 1],
   [2, 0, 0],
   [1, 1, 0],
   [1, 0, 1],
   [0, 2, 0],
   [0, 1, 1],
   [0, 0, 2]]
  }}}

> Indeed, and this is in fact a feature. I reworked the documentation to better
> highlight this.

I consider this example to break what the class promises (by being called
`IntegerListsLex`): its output is not sorted lexicograpically.

Now, I agree that this is hard to fix inside of the class. Thus instead of
claiming that it is not a bug by adding a line of documentation (which is why
you are rewriting the class today) please consider deprecating it. Updating the
code that calls it should not be a problem, as it can call
`DisjointUnionEnumeratedSets` directly.

Nathann



---

archive/issue_comments_237352.json:
```json
{
    "body": "Replying to [comment:439 ncohen]:\n> Now, I agree that this is hard to fix inside of the class. Thus instead of\n> claiming that it is not a bug by adding a line of documentation (which is why\n> you are rewriting the class today) please consider deprecating it.\n\nI completely agree with you in principle. However, I would be against adding even more changes to other parts of Sage.\n\nAs far as I can tell, within the Sage library, `IntegerListsLex` is only called in the following ways:\n1. with `n` a single number -> this is good\n2. with `range(a,b)` -> this can easily be changed to use `min_sum` and `max_sum`\n3. with `NN` -> keep this for now\n\nFor now, I agree with deprecating lists or iterables. I would keep support for `NN` and deal with that on a follow-up ticket.",
    "created_at": "2015-04-09T07:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237352",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:439 ncohen]:
> Now, I agree that this is hard to fix inside of the class. Thus instead of
> claiming that it is not a bug by adding a line of documentation (which is why
> you are rewriting the class today) please consider deprecating it.

I completely agree with you in principle. However, I would be against adding even more changes to other parts of Sage.

As far as I can tell, within the Sage library, `IntegerListsLex` is only called in the following ways:
1. with `n` a single number -> this is good
2. with `range(a,b)` -> this can easily be changed to use `min_sum` and `max_sum`
3. with `NN` -> keep this for now

For now, I agree with deprecating lists or iterables. I would keep support for `NN` and deal with that on a follow-up ticket.



---

archive/issue_comments_237353.json:
```json
{
    "body": "> I completely agree with you in principle. However, I would be against adding even more changes to other parts of Sage.\n\nThen a stopgap can be added (in this ticket) when `IntegerListsLex` is created from something which is not an integer. It does not change any of the doctests.\n\nNathann",
    "created_at": "2015-04-09T07:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237353",
    "user": "https://github.com/nathanncohen"
}
```

> I completely agree with you in principle. However, I would be against adding even more changes to other parts of Sage.

Then a stopgap can be added (in this ticket) when `IntegerListsLex` is created from something which is not an integer. It does not change any of the doctests.

Nathann



---

archive/issue_comments_237354.json:
```json
{
    "body": "Nathann, I'll have a look. Perhaps the changes are not so dramatic as I thought.",
    "created_at": "2015-04-09T07:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237354",
    "user": "https://github.com/jdemeyer"
}
```

Nathann, I'll have a look. Perhaps the changes are not so dramatic as I thought.



---

archive/issue_comments_237355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T08:10:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237356.json:
```json
{
    "body": "Nathann, is this OK for you?",
    "created_at": "2015-04-09T08:11:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237356",
    "user": "https://github.com/jdemeyer"
}
```

Nathann, is this OK for you?



---

archive/issue_comments_237357.json:
```json
{
    "body": "> Nathann, is this OK for you?\n\nI would have changed the calls to make them use `DisjointUnionEnumeratedSet` directly, but if you think that this deserves a function then no proble.\n\nI noticed something wrong in the words file, and created ticket #18148 to address it.\n\nNathann",
    "created_at": "2015-04-09T08:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237357",
    "user": "https://github.com/nathanncohen"
}
```

> Nathann, is this OK for you?

I would have changed the calls to make them use `DisjointUnionEnumeratedSet` directly, but if you think that this deserves a function then no proble.

I noticed something wrong in the words file, and created ticket #18148 to address it.

Nathann



---

archive/issue_comments_237358.json:
```json
{
    "body": "Replying to [comment:422 ncohen]:\n> > We definitely should keep it around for benchmarking purposes at least\n> > until #18055 is finished. I am fine adding the removal of\n> > `integer_list_old` to the todo list for this ticket.\n> \n> I do not see the point. You can checkout Sage 6.5 whenever you like if you ever need to benchmark this old (and broken) code.\n\nYes, and wait for the recompilation. Or keep yet another copy of Sage\naround just for this. It also makes it more complicated to compare\noutputs. Really, there is no risks associated to keeping it around for\na bit more time, and *not* keeping it is just another useless hurdle\nin the way of those who will be working on #18055.\n\n> > A user reading this documentation is likely to know about integer\n> > partitions, compositions or such.\n> \n> You cannot make assumptions like that. A user might find this class because he was redirected there after reading the doc of `IntegerVectors` (for instance).\n\nI am making no assumption. The user does not *need* to know about\ninteger partitions. But if he does, he gets an additional hint.\n\n> > I am fine making it into a SEEALSO if that's ok to put one before\n> > INPUT.\n> \n> Works for me.\n\nOk, will do.",
    "created_at": "2015-04-09T11:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237358",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:422 ncohen]:
> > We definitely should keep it around for benchmarking purposes at least
> > until #18055 is finished. I am fine adding the removal of
> > `integer_list_old` to the todo list for this ticket.
> 
> I do not see the point. You can checkout Sage 6.5 whenever you like if you ever need to benchmark this old (and broken) code.

Yes, and wait for the recompilation. Or keep yet another copy of Sage
around just for this. It also makes it more complicated to compare
outputs. Really, there is no risks associated to keeping it around for
a bit more time, and *not* keeping it is just another useless hurdle
in the way of those who will be working on #18055.

> > A user reading this documentation is likely to know about integer
> > partitions, compositions or such.
> 
> You cannot make assumptions like that. A user might find this class because he was redirected there after reading the doc of `IntegerVectors` (for instance).

I am making no assumption. The user does not *need* to know about
integer partitions. But if he does, he gets an additional hint.

> > I am fine making it into a SEEALSO if that's ok to put one before
> > INPUT.
> 
> Works for me.

Ok, will do.



---

archive/issue_comments_237359.json:
```json
{
    "body": "Replying to [comment:426 aschilling]:\n> Replying to [comment:424 jdemeyer]:\n> > I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.\n> \n> I agree with this. Fixed!\n\nThen we need to remove the dandling crosslink from `integer_list` as well (fixing this crosslink was the reason why I had inserted `integer_list_old` in the ref man). Done.",
    "created_at": "2015-04-09T11:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237359",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:426 aschilling]:
> Replying to [comment:424 jdemeyer]:
> > I would prefer *not* to have `integer_list_old` in the reference manual. It's deprecated, you're not supposed to use it. So let's at least pretend that it doesn't exist.
> 
> I agree with this. Fixed!

Then we need to remove the dandling crosslink from `integer_list` as well (fixing this crosslink was the reason why I had inserted `integer_list_old` in the ref man). Done.



---

archive/issue_comments_237360.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T11:49:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237360",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237361.json:
```json
{
    "body": "Replying to [comment:445 ncohen]:\n> > Nathann, is this OK for you?\n\nI believe deciding on API changes like this is going beyond the scope\nof this ticket; we are taking decisions in a rush on things that are\ndebatable (see the discussion with Vincent). But oh well, let's move\non. Thanks Jeroen for taking action toward some state that is\nacceptable to everyone.\n\n> I would have changed the calls to make them use `DisjointUnionEnumeratedSet` directly, but if you think that this deserves a function then no proble.\n\nI really would much prefer a direct use of DisjointUnionEnumeratedSet,\nin particular to set an example for others that would need a similar\nfeature.\n\nAlso, I spent a good deal of time working on documentation and tests\nthat were just wiped out by this commit. The right thing to do is to\nrecycle them whenever this can be useful, and at the very least adapt\nthe tests. I'll work on this now.\n\nCheers,\n                                  Nicolas\n\nPS: It's Pycon today; I'll see what I can do to handle the remaining\ncomments by Nathann. In the mean time, it would be helpful if we could\nget comments on the rest (lookahead, Envelope, ...).",
    "created_at": "2015-04-09T12:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237361",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:445 ncohen]:
> > Nathann, is this OK for you?

I believe deciding on API changes like this is going beyond the scope
of this ticket; we are taking decisions in a rush on things that are
debatable (see the discussion with Vincent). But oh well, let's move
on. Thanks Jeroen for taking action toward some state that is
acceptable to everyone.

> I would have changed the calls to make them use `DisjointUnionEnumeratedSet` directly, but if you think that this deserves a function then no proble.

I really would much prefer a direct use of DisjointUnionEnumeratedSet,
in particular to set an example for others that would need a similar
feature.

Also, I spent a good deal of time working on documentation and tests
that were just wiped out by this commit. The right thing to do is to
recycle them whenever this can be useful, and at the very least adapt
the tests. I'll work on this now.

Cheers,
                                  Nicolas

PS: It's Pycon today; I'll see what I can do to handle the remaining
comments by Nathann. In the mean time, it would be helpful if we could
get comments on the rest (lookahead, Envelope, ...).



---

archive/issue_comments_237362.json:
```json
{
    "body": "Replying to [comment:449 nthiery]:\n> I believe deciding on API changes like this is going beyond the scope\n> of this ticket; we are taking decisions in a rush on things that are\n> debatable\n> \n> Also, I spent a good deal of time working on documentation and tests\n> that were just wiped out by this commit. The right thing to do is to\n> recycle them whenever this can be useful\nEverything is still in the `git` history, you can always roll back my commit... (perhaps indeed after agreeing on a good API)",
    "created_at": "2015-04-09T12:16:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237362",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:449 nthiery]:
> I believe deciding on API changes like this is going beyond the scope
> of this ticket; we are taking decisions in a rush on things that are
> debatable
> 
> Also, I spent a good deal of time working on documentation and tests
> that were just wiped out by this commit. The right thing to do is to
> recycle them whenever this can be useful
Everything is still in the `git` history, you can always roll back my commit... (perhaps indeed after agreeing on a good API)



---

archive/issue_comments_237363.json:
```json
{
    "body": "Replying to [comment:449 nthiery]:\n> Also, I spent a good deal of time working on documentation and tests\n> that were just wiped out by this commit. The right thing to do is to\n> recycle them whenever this can be useful, and at the very least adapt\n> the tests.\nLet me remark that the tests involving `Partitions()` didn't actually test what you claimed they tested (`Partitions` itself handles `NN`).",
    "created_at": "2015-04-09T12:19:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237363",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:449 nthiery]:
> Also, I spent a good deal of time working on documentation and tests
> that were just wiped out by this commit. The right thing to do is to
> recycle them whenever this can be useful, and at the very least adapt
> the tests.
Let me remark that the tests involving `Partitions()` didn't actually test what you claimed they tested (`Partitions` itself handles `NN`).



---

archive/issue_comments_237364.json:
```json
{
    "body": "Replying to [comment:449 nthiery]:\n> at the very least adapt the tests.\nI actually believe that I did that.",
    "created_at": "2015-04-09T12:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237364",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:449 nthiery]:
> at the very least adapt the tests.
I actually believe that I did that.



---

archive/issue_comments_237365.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-09T12:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237365",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237366.json:
```json
{
    "body": "Replying to [comment:452 jdemeyer]:\n> Replying to [comment:449 nthiery]:\n> > at the very least adapt the tests.\n> I actually believe that I did that.\n\nTwo got removed (in the equality test). No worry, it was easy to recycle from the git history :-)\n\nThanks for detecting that Partitions was handling this on its own!",
    "created_at": "2015-04-09T12:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237366",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:452 jdemeyer]:
> Replying to [comment:449 nthiery]:
> > at the very least adapt the tests.
> I actually believe that I did that.

Two got removed (in the equality test). No worry, it was easy to recycle from the git history :-)

Thanks for detecting that Partitions was handling this on its own!



---

archive/issue_comments_237367.json:
```json
{
    "body": "Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?\n\nFor the API change: let's just move on; that will do.",
    "created_at": "2015-04-09T12:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237367",
    "user": "https://github.com/nthiery"
}
```

Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?

For the API change: let's just move on; that will do.



---

archive/issue_comments_237368.json:
```json
{
    "body": "Replying to [comment:455 nthiery]:\n> Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?\nI would do it *only* for `NN`, not for the range.",
    "created_at": "2015-04-09T13:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237368",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:455 nthiery]:
> Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?
I would do it *only* for `NN`, not for the range.



---

archive/issue_comments_237369.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-10T03:46:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237369",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237370.json:
```json
{
    "body": "Replying to [comment:455 nthiery]:\n> Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?\n\nI started doing this, and then realized that the two locations where\nwe are using `IntegerListsNN` would be best written using\n`IntegerVectors(length=..., ...)`. However this feature is broken (see\n#17927). So I switch gear: let's keep things are they are for now,\nswitch to `IntegerVectors` in the upcoming #17927, and probably get rid of the\ntemporary `IntegerListsNN` then.\n\nI left TODO notes in the code.",
    "created_at": "2015-04-10T03:53:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237370",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:455 nthiery]:
> Jeroen: is it ok if I switch to using `DisjointUnionEnumeratedSets` in Words / ... ?

I started doing this, and then realized that the two locations where
we are using `IntegerListsNN` would be best written using
`IntegerVectors(length=..., ...)`. However this feature is broken (see
#17927). So I switch gear: let's keep things are they are for now,
switch to `IntegerVectors` in the upcoming #17927, and probably get rid of the
temporary `IntegerListsNN` then.

I left TODO notes in the code.



---

archive/issue_comments_237371.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-10T04:00:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237371",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237372.json:
```json
{
    "body": ">  - In the following text which says that one can force the\n>    enumeration when it is formally impossible, can you explicitly\n>    say what will happen? \"All possible lists are enumerated, but the\n>    ordering is incorrect\" or something?\n>    `If one wants to proceed anyway, one can sign a waiver by setting check=False:`\n\nIt's mentioned just above:\n\n`the list ``[1, 1, 1]`` will never appear in the enumeration`\n\nIsn't this enough?\n\nBtw: I just made minor improvements to the doc around there.",
    "created_at": "2015-04-10T04:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237372",
    "user": "https://github.com/nthiery"
}
```

>  - In the following text which says that one can force the
>    enumeration when it is formally impossible, can you explicitly
>    say what will happen? "All possible lists are enumerated, but the
>    ordering is incorrect" or something?
>    `If one wants to proceed anyway, one can sign a waiver by setting check=False:`

It's mentioned just above:

`the list ``[1, 1, 1]`` will never appear in the enumeration`

Isn't this enough?

Btw: I just made minor improvements to the doc around there.



---

archive/issue_comments_237373.json:
```json
{
    "body": ">  - About this paragraph:\n>    {{{\n>    The set of allowable constraints has been specifically designed to enable\n>    iteration with a good time and memory complexity in most practical use cases,\n>    and in inverse lexicographic order (see below)\n>    }}}\n\n>  I do not believe that it is true, i.e. that the set of allowable\n>  contraints has been specifically designed to enable iteration with\n>  a good time and memory complexity.\n\nWell, this certainly was our design goal when we came up with it with\nFlorent! I am not saying iteration with a good time and complexity is\ncurrently implemented, but I do believe this is possible in most\npractical use cases.\n\nAnyway, just rephrase this to whatever you wish. I don't really care. Or\nmore precisely I care more about this ticket being done.\n\n>  In particular, it is possible to get great speed improvements by\n>  writing a Constant Amortized Time (CAT) Algorithm to list only\n>  partitions satisfying a smaller set of constraints like\n>  (sum,length,min/max part).\n\nIf you take the current algorithm, specialize the lookahead to be\ntrivial (because, for plain partitions, the prediction is indeed\ntrivial: any prefix can be extended to at least one integer\npartition), and avoid a copy of the result, you recover exactly the\nstandard CAT algorithm for enumerating integer partitions in inverse\nlexicographic order.\n\nIn fact that's exactly how we came up with this design: by getting\ntired of reimplementing exactly the same CAT algorithm for integer\npartitions, compositions, and looking for some unifying context.\n\nMore precisely we are shooting for LAT (Linear Amortized Time): the\niterator protocol is indeed not really favorable to pure CAT: if one\nyields a reference to the current list at each step, things are likely\nto break, unless the user makes an immediate read only use of it. So\nfor now we assume that we make a copy of each list.\n\nI am not claiming we can always achieve LAT. But I believe that we can\nget pretty close to it in the common use cases, which will qualify for\n\"good time and memory complexity\".",
    "created_at": "2015-04-10T05:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237373",
    "user": "https://github.com/nthiery"
}
```

>  - About this paragraph:
>    {{{
>    The set of allowable constraints has been specifically designed to enable
>    iteration with a good time and memory complexity in most practical use cases,
>    and in inverse lexicographic order (see below)
>    }}}

>  I do not believe that it is true, i.e. that the set of allowable
>  contraints has been specifically designed to enable iteration with
>  a good time and memory complexity.

Well, this certainly was our design goal when we came up with it with
Florent! I am not saying iteration with a good time and complexity is
currently implemented, but I do believe this is possible in most
practical use cases.

Anyway, just rephrase this to whatever you wish. I don't really care. Or
more precisely I care more about this ticket being done.

>  In particular, it is possible to get great speed improvements by
>  writing a Constant Amortized Time (CAT) Algorithm to list only
>  partitions satisfying a smaller set of constraints like
>  (sum,length,min/max part).

If you take the current algorithm, specialize the lookahead to be
trivial (because, for plain partitions, the prediction is indeed
trivial: any prefix can be extended to at least one integer
partition), and avoid a copy of the result, you recover exactly the
standard CAT algorithm for enumerating integer partitions in inverse
lexicographic order.

In fact that's exactly how we came up with this design: by getting
tired of reimplementing exactly the same CAT algorithm for integer
partitions, compositions, and looking for some unifying context.

More precisely we are shooting for LAT (Linear Amortized Time): the
iterator protocol is indeed not really favorable to pure CAT: if one
yields a reference to the current list at each step, things are likely
to break, unless the user makes an immediate read only use of it. So
for now we assume that we make a copy of each list.

I am not claiming we can always achieve LAT. But I believe that we can
get pretty close to it in the common use cases, which will qualify for
"good time and memory complexity".



---

archive/issue_comments_237374.json:
```json
{
    "body": "Up to the aforementioned sentence that I let Nathann edit to his taste, I believe all the comments have been adressed one way or the other. Hence back to needs review.",
    "created_at": "2015-04-10T05:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237374",
    "user": "https://github.com/nthiery"
}
```

Up to the aforementioned sentence that I let Nathann edit to his taste, I believe all the comments have been adressed one way or the other. Hence back to needs review.



---

archive/issue_comments_237375.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-04-10T05:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237375",
    "user": "https://github.com/nthiery"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_237376.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-10T07:04:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237377.json:
```json
{
    "body": "Hello,\n\n> Up to the aforementioned sentence that I let Nathann edit to his taste\n\nI just did that. I added ten words to the sentence which mentions the argument 'check', and removed the part of the doc about the design of that class.\n\nMy idea of what an efficient implementation of this feature should be is closer to chapter 16 of the fxtbook [1].\n\nIn a previous message you mentionned #17927. Would anybody be willing to review it? It has been lying there for 4 weeks, and is now in conflict with the commits that have been added here since.\n\nNathann\n\n[1] http://www.jjj.de/fxt/fxtbook.pdf",
    "created_at": "2015-04-10T07:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237377",
    "user": "https://github.com/nathanncohen"
}
```

Hello,

> Up to the aforementioned sentence that I let Nathann edit to his taste

I just did that. I added ten words to the sentence which mentions the argument 'check', and removed the part of the doc about the design of that class.

My idea of what an efficient implementation of this feature should be is closer to chapter 16 of the fxtbook [1].

In a previous message you mentionned #17927. Would anybody be willing to review it? It has been lying there for 4 weeks, and is now in conflict with the commits that have been added here since.

Nathann

[1] http://www.jjj.de/fxt/fxtbook.pdf



---

archive/issue_comments_237378.json:
```json
{
    "body": "Replying to [comment:464 ncohen]:\n> I just did that. I added ten words to the sentence which mentions the argument 'check', and removed the part of the doc about the design of that class.\n\nI just check the changes and am ok with me (I am keeping a mental note\nto reinsert the statement about the design when we will have provable\narguments)\n\nWhere do we stand now? Are there things left that remain to review?\n\n> My idea of what an efficient implementation of this feature should be is closer to chapter 16 of the fxtbook [1].\n\nJuste a note: the code for next in 16.2 is precisely how next worked\nin the previous implementation of IntegerListsLex (except that we had\nmore checks to handle the extra arguments).\n\nAltogether, I don't think we are far from ftxbook. The only thing is\nthat there remains to make sure that our code does specialize well in\nthe trivial cases like plain partitions. And of course to make it into\ncompiled code. Once we will be there, we should certainly compare to\nthe ftxbook benchmarks.\n\n> In a previous message you mentionned #17927. Would anybody be willing to review it? It has been lying there for 4 weeks, and is now in conflict with the commits that have been added here since.\n\nAs I mentioned earlier, I volunteered to handle the merge and review\nof #17927, when this one will be done.",
    "created_at": "2015-04-10T12:11:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237378",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:464 ncohen]:
> I just did that. I added ten words to the sentence which mentions the argument 'check', and removed the part of the doc about the design of that class.

I just check the changes and am ok with me (I am keeping a mental note
to reinsert the statement about the design when we will have provable
arguments)

Where do we stand now? Are there things left that remain to review?

> My idea of what an efficient implementation of this feature should be is closer to chapter 16 of the fxtbook [1].

Juste a note: the code for next in 16.2 is precisely how next worked
in the previous implementation of IntegerListsLex (except that we had
more checks to handle the extra arguments).

Altogether, I don't think we are far from ftxbook. The only thing is
that there remains to make sure that our code does specialize well in
the trivial cases like plain partitions. And of course to make it into
compiled code. Once we will be there, we should certainly compare to
the ftxbook benchmarks.

> In a previous message you mentionned #17927. Would anybody be willing to review it? It has been lying there for 4 weeks, and is now in conflict with the commits that have been added here since.

As I mentioned earlier, I volunteered to handle the merge and review
of #17927, when this one will be done.



---

archive/issue_comments_237379.json:
```json
{
    "body": "> Juste a note: the code for next in 16.2 is precisely how next worked\n> in the previous implementation of IntegerListsLex (except that we had\n> more checks to handle the extra arguments).\n> \n> Altogether, I don't think we are far from ftxbook.\n\nThe asymptotic complexity is not the only thing I had in mind when I pointed toward that book. For things as easy to enumerate as integer partitions (wiht min/max n, min/max part, min/max length) I believe that we should have Cython implementation (no Python needed). When called at C level, it would be infinitely faster to enumerate and filter permutations satisfying a given predicate. It also couldn't hurt if `IntegerListsLex` relied on it in thos simple cases.\n\nNathann",
    "created_at": "2015-04-10T12:43:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237379",
    "user": "https://github.com/nathanncohen"
}
```

> Juste a note: the code for next in 16.2 is precisely how next worked
> in the previous implementation of IntegerListsLex (except that we had
> more checks to handle the extra arguments).
> 
> Altogether, I don't think we are far from ftxbook.

The asymptotic complexity is not the only thing I had in mind when I pointed toward that book. For things as easy to enumerate as integer partitions (wiht min/max n, min/max part, min/max length) I believe that we should have Cython implementation (no Python needed). When called at C level, it would be infinitely faster to enumerate and filter permutations satisfying a given predicate. It also couldn't hurt if `IntegerListsLex` relied on it in thos simple cases.

Nathann



---

archive/issue_comments_237380.json:
```json
{
    "body": "As always: First it has to be correct, then you can make it fast.",
    "created_at": "2015-04-10T13:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237380",
    "user": "https://github.com/vbraun"
}
```

As always: First it has to be correct, then you can make it fast.



---

archive/issue_comments_237381.json:
```json
{
    "body": "> As always: First it has to be correct, then you can make it fast.\n\nOf course. I was not trying to defend the idea of reimplementing this code in Cython right now. I was only discussing with Nicolas a paragraph of its documentation.\n\nNathann",
    "created_at": "2015-04-10T13:09:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237381",
    "user": "https://github.com/nathanncohen"
}
```

> As always: First it has to be correct, then you can make it fast.

Of course. I was not trying to defend the idea of reimplementing this code in Cython right now. I was only discussing with Nicolas a paragraph of its documentation.

Nathann



---

archive/issue_comments_237382.json:
```json
{
    "body": "Replying to [comment:466 ncohen]:\n> The asymptotic complexity is not the only thing I had in mind when I pointed toward that book.\n\nYes, I know! Same for me.\n\n> For things as easy to enumerate as integer partitions (wiht min/max\n> n, min/max part, min/max length) I believe that we should have\n> Cython implementation (no Python needed).  When called at C level,\n> it would be infinitely faster to enumerate and filter permutations\n> satisfying a given predicate. It also couldn't hurt if\n> `IntegerListsLex` relied on it in thos simple cases.\n\nIn summary, the plan is:\n\n- Correct implementation of IntegerListsLex (this ticket)\n- Asymptotically good implementation (#18055)\n- Cython/C/C++ implementation (#18056)\n- Serious benchmarking to see whether it's worth having specialized\n  implementations for the \"trivial\" cases, and use \"filtering from\n  trivial\" for the small cases.\n\nCheers,\n                        Nicolas",
    "created_at": "2015-04-10T14:28:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237382",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:466 ncohen]:
> The asymptotic complexity is not the only thing I had in mind when I pointed toward that book.

Yes, I know! Same for me.

> For things as easy to enumerate as integer partitions (wiht min/max
> n, min/max part, min/max length) I believe that we should have
> Cython implementation (no Python needed).  When called at C level,
> it would be infinitely faster to enumerate and filter permutations
> satisfying a given predicate. It also couldn't hurt if
> `IntegerListsLex` relied on it in thos simple cases.

In summary, the plan is:

- Correct implementation of IntegerListsLex (this ticket)
- Asymptotically good implementation (#18055)
- Cython/C/C++ implementation (#18056)
- Serious benchmarking to see whether it's worth having specialized
  implementations for the "trivial" cases, and use "filtering from
  trivial" for the small cases.

Cheers,
                        Nicolas



---

archive/issue_comments_237383.json:
```json
{
    "body": "Replying to [comment:469 nthiery]:\n> Replying to [comment:466 ncohen]:\n> > The asymptotic complexity is not the only thing I had in mind when I pointed toward that book.\n> \n> Yes, I know! Same for me.\n> \n> > For things as easy to enumerate as integer partitions (wiht min/max\n> > n, min/max part, min/max length) I believe that we should have\n> > Cython implementation (no Python needed).  When called at C level,\n> > it would be infinitely faster to enumerate and filter permutations\n> > satisfying a given predicate. It also couldn't hurt if\n> > `IntegerListsLex` relied on it in thos simple cases.\n> \n> In summary, the plan is:\n> \n> - Correct implementation of IntegerListsLex (this ticket)\n> - Asymptotically good implementation (#18055)\n\nFYI, Bryan and I talked about the algorithm for #18055 yesterday at Berkeley!",
    "created_at": "2015-04-11T04:10:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237383",
    "user": "https://github.com/anneschilling"
}
```

Replying to [comment:469 nthiery]:
> Replying to [comment:466 ncohen]:
> > The asymptotic complexity is not the only thing I had in mind when I pointed toward that book.
> 
> Yes, I know! Same for me.
> 
> > For things as easy to enumerate as integer partitions (wiht min/max
> > n, min/max part, min/max length) I believe that we should have
> > Cython implementation (no Python needed).  When called at C level,
> > it would be infinitely faster to enumerate and filter permutations
> > satisfying a given predicate. It also couldn't hurt if
> > `IntegerListsLex` relied on it in thos simple cases.
> 
> In summary, the plan is:
> 
> - Correct implementation of IntegerListsLex (this ticket)
> - Asymptotically good implementation (#18055)

FYI, Bryan and I talked about the algorithm for #18055 yesterday at Berkeley!



---

archive/issue_comments_237384.json:
```json
{
    "body": "Hi!\n\nIs there anything we can do to help the final steps of the review?",
    "created_at": "2015-04-11T11:22:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237384",
    "user": "https://github.com/nthiery"
}
```

Hi!

Is there anything we can do to help the final steps of the review?



---

archive/issue_comments_237385.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-11T19:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237385",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_237386.json:
```json
{
    "body": "I'm going to set this to positive review since it seems like there are currently no objections to the current state of the code, it is a definite improvement over the previous code, and we can always do more work later on on followup tickets (thus we can get the next version of Sage released).",
    "created_at": "2015-04-11T19:41:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237386",
    "user": "https://github.com/tscrim"
}
```

I'm going to set this to positive review since it seems like there are currently no objections to the current state of the code, it is a definite improvement over the previous code, and we can always do more work later on on followup tickets (thus we can get the next version of Sage released).



---

archive/issue_comments_237387.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-11T20:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237387",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_017074.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-04-11T20:10:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17742#event-17074"
}
```



---

archive/issue_comments_237388.json:
```json
{
    "body": "Oops, I hope Nathann was ok with merging this ticket as is. It's probably alright since it was looked over quite extensively, and it was costly to hold up 6.6 even more. Worst case we can change things in later tickets.\n\nIn any cases: thanks everybody for all the hard work implementing and reviewing this ticket! One less big issue in Sage. Yeah!\n\nCheers,\n                                  Nicolas",
    "created_at": "2015-04-11T21:29:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237388",
    "user": "https://github.com/nthiery"
}
```

Oops, I hope Nathann was ok with merging this ticket as is. It's probably alright since it was looked over quite extensively, and it was costly to hold up 6.6 even more. Worst case we can change things in later tickets.

In any cases: thanks everybody for all the hard work implementing and reviewing this ticket! One less big issue in Sage. Yeah!

Cheers,
                                  Nicolas



---

archive/issue_comments_237389.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2015-04-11T22:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237389",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_017075.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-04-11T22:07:29Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17742#event-17075"
}
```



---

archive/issue_comments_237390.json:
```json
{
    "body": "Documentation doesn't build\n\n```\n[combinat ] /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/quickref.py:docstring of sage.combinat.quickref:72: WARNING: undefined label: sage.graphs (if the link has no caption the label must precede a section header)\nError building the documentation.\nTraceback (most recent call last):\n  File \"/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py\", line 1626, in <module>\n    getattr(get_builder(name), type)()\n  File \"/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py\", line 292, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py\", line 503, in _wrapper\n    x.get(99999)\n  File \"/mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python/multiprocessing/pool.py\", line 558, in get\n    raise self._value\nOSError: [combinat ] /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:151: ERROR: Unexpected indentation.\n```\n",
    "created_at": "2015-04-11T22:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237390",
    "user": "https://github.com/vbraun"
}
```

Documentation doesn't build

```
[combinat ] /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/quickref.py:docstring of sage.combinat.quickref:72: WARNING: undefined label: sage.graphs (if the link has no caption the label must precede a section header)
Error building the documentation.
Traceback (most recent call last):
  File "/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/mnt/SSD1/mod_buildslave/sage_git/build/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [combinat ] /mnt/SSD1/mod_buildslave/sage_git/build/local/lib/python2.7/site-packages/sage/combinat/integer_list.py:docstring of sage.combinat.integer_list.IntegerListsLex:151: ERROR: Unexpected indentation.
```




---

archive/issue_comments_237391.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2015-04-11T22:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237391",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_237392.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-04-11T22:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237392",
    "user": "https://github.com/tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_237393.json:
```json
{
    "body": "I think I caught the error. Rebuilding doc now... (someone with a potentially faster computer, also do so).\n----\nLast 10 new commits:",
    "created_at": "2015-04-11T22:34:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237393",
    "user": "https://github.com/tscrim"
}
```

I think I caught the error. Rebuilding doc now... (someone with a potentially faster computer, also do so).
----
Last 10 new commits:



---

archive/issue_comments_237394.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-11T22:49:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237394",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237395.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-04-11T22:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237395",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_237396.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-04-11T22:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237396",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_237397.json:
```json
{
    "body": "Okay, Nicolas and I found the issue (simultaneously but independently with Anne). Nicolas did a full doc rebuild, which returned clean. So back to positive review.",
    "created_at": "2015-04-11T22:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237397",
    "user": "https://github.com/tscrim"
}
```

Okay, Nicolas and I found the issue (simultaneously but independently with Anne). Nicolas did a full doc rebuild, which returned clean. So back to positive review.



---

archive/issue_comments_237398.json:
```json
{
    "body": "Good that this is now merged. I think the next steps should be doing some of the cleanup mentioned here. In particular:\n- Stop using `global_options`\n- Remove `integer_list_old.py`\n- Get rid of `element_constructor`",
    "created_at": "2015-04-13T08:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237398",
    "user": "https://github.com/jdemeyer"
}
```

Good that this is now merged. I think the next steps should be doing some of the cleanup mentioned here. In particular:
- Stop using `global_options`
- Remove `integer_list_old.py`
- Get rid of `element_constructor`



---

archive/issue_comments_237399.json:
```json
{
    "body": "Replying to [comment:480 jdemeyer]:\n> Good that this is now merged. I think the next steps should be doing some of the cleanup mentioned here. In particular:\n> - Stop using `global_options`\n\nIntegerListsLex is not really using it. Just passing it on for other\nclasses that need it. But if there is a way to refactor those classes\nto not impose this burden on IntegerListsLex, that would be better\nindeed.\n\n> - Remove `integer_list_old.py`\n\nYes, at the end of #18055.\n\n> - Get rid of `element_constructor`\n\nWe probably want to change the default value. But we certainly want to\nkeep the feature.\n\nCheers,\n                             Nicolas",
    "created_at": "2015-04-13T11:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237399",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:480 jdemeyer]:
> Good that this is now merged. I think the next steps should be doing some of the cleanup mentioned here. In particular:
> - Stop using `global_options`

IntegerListsLex is not really using it. Just passing it on for other
classes that need it. But if there is a way to refactor those classes
to not impose this burden on IntegerListsLex, that would be better
indeed.

> - Remove `integer_list_old.py`

Yes, at the end of #18055.

> - Get rid of `element_constructor`

We probably want to change the default value. But we certainly want to
keep the feature.

Cheers,
                             Nicolas



---

archive/issue_comments_237400.json:
```json
{
    "body": "Replying to [comment:360 jdemeyer]:\n> I disagree with this. I think code duplication is always a high risk for bugs.\n\nThis gave me a good laugh: usually people complain at me for tending to overdesign to remove the very last duplicated bit :-)",
    "created_at": "2015-04-13T11:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237400",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:360 jdemeyer]:
> I disagree with this. I think code duplication is always a high risk for bugs.

This gave me a good laugh: usually people complain at me for tending to overdesign to remove the very last duplicated bit :-)



---

archive/issue_comments_237401.json:
```json
{
    "body": "Replying to [comment:481 nthiery]:\n> > - Remove `integer_list_old.py`\n> \n> Yes, at the end of #18055.\nHow is #18055 related to removing `integer_list_old.py`???",
    "created_at": "2015-04-13T12:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237401",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:481 nthiery]:
> > - Remove `integer_list_old.py`
> 
> Yes, at the end of #18055.
How is #18055 related to removing `integer_list_old.py`???



---

archive/issue_comments_237402.json:
```json
{
    "body": "See [comment:446]",
    "created_at": "2015-04-13T13:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237402",
    "user": "https://github.com/nthiery"
}
```

See [comment:446]



---

archive/issue_comments_237403.json:
```json
{
    "body": "I see your point. What I *really* meant is: stop using `integer_list_old.py` in the Sage library (it's still used by `integer_vector.py`).",
    "created_at": "2015-04-13T13:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237403",
    "user": "https://github.com/jdemeyer"
}
```

I see your point. What I *really* meant is: stop using `integer_list_old.py` in the Sage library (it's still used by `integer_vector.py`).



---

archive/issue_events_017076.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2015-04-14T10:09:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/17742#event-17076"
}
```



---

archive/issue_comments_237404.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-04-14T10:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237404",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_237405.json:
```json
{
    "body": "Replying to [comment:485 jdemeyer]:\n> I see your point. What I *really* meant is: stop using `integer_list_old.py` in the Sage library (it's still used by `integer_vector.py`).\n\nOh, I see. This requires a small additional feature (initializing the\niterator from a specified prefix instead of []) which should be easy\nto add, typically as part of #18055 unless someone wants to jump in\nbefore.",
    "created_at": "2015-04-14T11:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17742",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17742#issuecomment-237405",
    "user": "https://github.com/nthiery"
}
```

Replying to [comment:485 jdemeyer]:
> I see your point. What I *really* meant is: stop using `integer_list_old.py` in the Sage library (it's still used by `integer_vector.py`).

Oh, I see. This requires a small additional feature (initializing the
iterator from a specified prefix instead of []) which should be easy
to add, typically as part of #18055 unless someone wants to jump in
before.
