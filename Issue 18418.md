# Issue 18418: MV Polytopes and PBW crystals

Issue created by migration from https://trac.sagemath.org/ticket/18655

Original creator: dmuthiah

Original creation time: 2015-06-09 16:31:33

CC:  ptingley bsalisbury1 tscrim aschilling bump




---

Comment by dmuthiah created at 2015-06-09 17:12:57

Changing keywords from "" to "days65".


---

Comment by dmuthiah created at 2015-06-09 17:12:57

Changing type from PLEASE CHANGE to enhancement.


---

Comment by bsalisbury1 created at 2015-06-11 17:07:07

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by bsalisbury1 created at 2015-06-11 17:07:07

Changing keywords from "days65" to "days65, sage-combinat,crystals".


---

Comment by tscrim created at 2015-11-13 04:13:05

New commits:


---

Comment by git created at 2016-02-23 21:02:10

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2016-02-25 06:07:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-26 05:22:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-03-05 15:39:12

Hey Peter and Dinakar,

It would be great if one or both of you would add some general documentation (in particular, a description of the model/crystal structure) and check that my changes are good with you. Also, if you could implement type G<sub>2</sub>, that would be appreciated; otherwise, we can set that to raise a `NotImplementedError` for the time being. That way we can get this merged into Sage.

Thanks,
Travis


---

Comment by bsalisbury1 created at 2016-04-15 15:35:39

Hi all,

I have some questions about this code.  

- I think that `.star()` is misbehaving.  Here is some evidence.  Consider 

```
sage: MV = crystals.infinity.MVPolytopes("A2")
sage: p0 = MV.module_generators[0]
sage: p = p0.f_string([1,2,1,2,2]); p
MV polytope with Lusztig datum (0, 2, 1)
sage: p.star()
MV polytope with Lusztig datum (1, 2, 0)
```

   However, when I compute by hand (using the PBW rule from Kamnitzer's paper (based on the work of Lusztig and Berenstein-Zelevinsky)), I believe the resulting data should actually be `(2,0,3)`.  Using the PBW crystal code:

```
sage: B = crystals.infinity.PBW("A2")
sage: b0 = B.module_generators[0]
sage: b = b0.f_string([1,2,1,2,2]); b
PBW monomial with Lusztig datum (0, 2, 1)
sage: b.lusztig_datum(word=[2,1,2])
(3, 0, 2)
```

   The reversal of the last output should correspond to `p.star()`.  Moreover, when I check against some previously implemented *-crystal code, it also agrees with my calculation by hand:

```
sage: MVs = crystals.infinity.Star(MV)
sage: ps = MVs.module_generators[0].f_string([1,2,1,2,2])
sage: ps
MV polytope with Lusztig datum (2, 0, 3)

sage: Bs = crystals.infinity.Star(B)
sage: bs = Bs.module_generators[0].f_string([1,2,1,2,2])
sage: bs
PBW monomial with Lusztig datum (2, 0, 3)
```

  Maybe I am misunderstanding how the *-operator is supposed to act?

- Perhaps `braid_move_calculator.py` should go with the Coxeter group code.  I believe it is more robust than simply crystals code, and Coxeter group users may also find it beneficial.  

- Is it possible initialize an MV polytope without applying a string of crystal operators from the highest weight?  If so, tests should be added that show this behavior.  If not, then it may be desirable to users if one could initialize an MV polytope using polytope vertices or from a Lusztig datum.

- Less important, but maybe it may be a good idea to group `pbw_crystal.py` and `pbw_datum.py` into a single file.  They are closely related, so having less files in the crystals folder may be a good idea.  I do not feel very strongly about this, but it is something that came up.  

Thanks for working on this!!  This patch will be a spectacular addition to Sage when it is completed!


---

Comment by git created at 2016-04-17 14:42:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-12 21:16:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-04 00:52:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-04 09:50:39


```
File "src/sage/combinat/root_system/root_lattice_realizations.py", line 3063, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.?
Failed example:
    L.plot_fundamental_weights() + L.plot_mv_polytope(p)
Expected:
    Graphics object consisting of 14 graphics primitives
Got:
    Graphics object consisting of 11 graphics primitives
**********************************************************************
File "src/sage/combinat/root_system/root_lattice_realizations.py", line 3072, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.?
Failed example:
    L.plot_mv_polytope(p)
Expected nothing
Got:
    Graphics3d Object
```



---

Comment by dmuthiah created at 2016-10-04 21:08:31

Travis wrote the code for this function in root_lattice_realizations.py,
so I want to double-check with him before changing the tests. Let me comment on the two failed tests. 

>File "src/sage/combinat/root_system/root_lattice_realizations.py", line 3063, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.?
>Failed example:
>    L.plot_fundamental_weights() + L.plot_mv_polytope(p)
>Expected:
>    Graphics object consisting of 14 graphics primitives
>Got:
>    Graphics object consisting of 11 graphics primitives

This error is because the tropical Plucker relations for B2 and C2 were incorrectly switched before. I've fixed this, and the test should be changed.

>File "src/sage/combinat/root_system/root_lattice_realizations.py", line 3072, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.?
>Failed example:
>    L.plot_mv_polytope(p)
>Expected nothing
>Got:
>    Graphics3d Object

I don't know what should be the correct behavior here. When I try to run each of these tests in the repl by hand it complains that I don't have jmol installed. What is the doctest doing differently?


---

Comment by tscrim created at 2016-10-04 21:39:01

Replying to [comment:15 dmuthiah]:
> >File "src/sage/combinat/root_system/root_lattice_realizations.py", line 3072, in sage.combinat.root_system.root_lattice_realizations.RootLatticeRealizations.ParentMethods.?
> >Failed example:
> >    L.plot_mv_polytope(p)
> >Expected nothing
> >Got:
> >    Graphics3d Object
> 
> I don't know what should be the correct behavior here. When I try to run each of these tests in the repl by hand it complains that I don't have jmol installed. What is the doctest doing differently?

This doctest would normally try to open JMol, but in order to avoid this, in doctest mode (i.e., running `sage -t filename.py`) we just print out `Graphics3d Object`. It is a straightforward change.


---

Comment by tscrim created at 2016-10-04 21:40:44

Thank you Dinakar for adding the G<sub>2</sub> case. I plan to look at it in detail and take care of Ben's comments. Modulo Ben's comments, this should be ready for review, correct?


---

Comment by tscrim created at 2016-10-09 17:17:16

You've (re)introduced a mixup between type B<sub>n</sub> and C<sub>n</sub> with [a81b213](https://git.sagemath.org/sage.git/commit/?id=a81b2134f04acc6abcccf49284be7c5c1f6d3be3):

```
sage: G = crystals.infinity.PBW(['B',3]).subcrystal(max_depth=7).digraph()
sage: Gp = crystals.infinity.Tableaux(['C',3]).subcrystal(max_depth=7).digraph()
sage: Gp.is_isomorphic(G, edge_labels=True)
True
```

There also seems to be too many vertices for type G<sub>2</sub>:

```
sage: G = crystals.infinity.PBW(['G',2]).subcrystal(max_depth=7).digraph()
sage: G
Digraph on 137 vertices
sage: Gp = crystals.infinity.Tableaux(['G',2]).subcrystal(max_depth=7).digraph()
sage: Gp
Digraph on 116 vertices
```



---

Comment by chapoton created at 2016-10-11 08:32:20

doc does not build, see bot's report

```
sage/combinat/crystals/pbw_datum.py:
docstring of sage.combinat.crystals.pbw_datum.tropical_plucker_relation:24:
ERROR: Unexpected indentation.
```



---

Comment by dmuthiah created at 2016-10-11 15:50:32

Replying to [comment:18 tscrim]:
> You've (re)introduced a mixup between type B<sub>n</sub> and C<sub>n</sub> with [a81b213](https://git.sagemath.org/sage.git/commit/?id=a81b2134f04acc6abcccf49284be7c5c1f6d3be3):
Okay, I will try to sort this out.

> {{{
> sage: G = crystals.infinity.PBW(['B',3]).subcrystal(max_depth=7).digraph()
> sage: Gp = crystals.infinity.Tableaux(['C',3]).subcrystal(max_depth=7).digraph()
> sage: Gp.is_isomorphic(G, edge_labels=True)
> True
> }}}
> There also seems to be too many vertices for type G<sub>2</sub>:
> {{{
> sage: G = crystals.infinity.PBW(['G',2]).subcrystal(max_depth=7).digraph()
> sage: G
> Digraph on 137 vertices
> sage: Gp = crystals.infinity.Tableaux(['G',2]).subcrystal(max_depth=7).digraph()
> sage: Gp
> Digraph on 116 vertices
> }}}
I will look into this. Mainly I will check if I've made a transcription error from Berenstein-Zelevinsky. Unfortunately, if there is a typo in the Berenstein-Zelevinsky reference, finding the correct formulas will be a difficult task.


---

Comment by tscrim created at 2016-10-11 16:20:59

I see at least one transcription error: in `pi1`, it should be `t1+t2+2*t3+t4`.


---

Comment by tscrim created at 2016-10-11 16:23:02

Also, don't you have to translate, e.g., `3 t` into `t + 3`?


---

Comment by tscrim created at 2016-10-11 16:28:46

Another error: `3*pi2-pi2-pi4` should be `3*pi2-pi3-pi4`. Otherwise I think everything else matches.


---

Comment by git created at 2016-10-11 17:34:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dmuthiah created at 2016-10-11 17:36:48

Replying to [comment:22 tscrim]:
> Also, don't you have to translate, e.g., `3 t` into `t + 3`?

I think you interpret 3t as t+t+t, which you tropicalize to min(t,t,t)=t.

About the G2 errors: I also saw these two. I also fixed the B2<->C2 error.

The G2 case now matches the infinity tableau crystal with 116 nodes.


---

Comment by dmuthiah created at 2016-10-11 17:37:22

Replying to [comment:25 dmuthiah]:
> Replying to [comment:22 tscrim]:
> > Also, don't you have to translate, e.g., `3 t` into `t + 3`?
> 
> I think you interpret 3t as t+t+t, which you tropicalize to min(t,t,t)=t.
> 
> About the G2 errors: I also saw these two. I also fixed the B2<->C2 error.
> 
> The G2 case now matches the infinity tableau crystal with 116 nodes.
> 
> 

I still didn't fix the documentation issue. I think it is an issue with the indentation for the REFERENCES.


---

Comment by chapoton created at 2016-10-11 19:04:41

The error probably comes from a missing whiteline after

```
REFERENCES:
```



---

Comment by tscrim created at 2016-10-11 19:36:01

Replying to [comment:25 dmuthiah]:
> Replying to [comment:22 tscrim]:
> > Also, don't you have to translate, e.g., `3 t` into `t + 3`?
> 
> I think you interpret 3t as t+t+t, which you tropicalize to min(t,t,t)=t.

Ah, right.

> About the G2 errors: I also saw these two. I also fixed the B2<->C2 error.
> 
> The G2 case now matches the infinity tableau crystal with 116 nodes.

Great! Thank you for adding this. I can work on Ben's and Frédéric's comments.


---

Comment by git created at 2016-10-11 21:00:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-10-11 21:02:18

I also fixed the one in comment:21, but now it works up to depth 15. So I am satisfied.


---

Comment by tscrim created at 2016-10-11 21:04:08

However, if you (or Peter) could take care of the star involution issue; see comment:9. I can take care of the rest.


---

Comment by git created at 2016-11-08 18:47:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-09 16:20:40

see patchbot report:

* many failing doctests

* do not use xrange

* do not use cmp()

* doc still does not build


---

Comment by git created at 2016-11-11 21:36:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-14 00:27:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-14 01:41:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-14 01:44:49

I moved the `braid_move_calculator` to the `root_system` folder as that is the closest place for Coxeter groups currently. I also fixed the failing doctests and removed the `cmp`. I moved the reference to the big master file. Lastly, I cythonized `pbw_datum.py`, which led to a 4x speedup when computing the entire subcrystal.


---

Comment by git created at 2016-11-14 03:01:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-14 03:09:49

I believe the only issue left is to deal with the star.


---

Comment by chapoton created at 2016-11-14 19:40:04

doc does not build, because of a bad reference to the old location of braid_move_calculator


---

Comment by git created at 2016-11-14 21:43:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-11-15 16:11:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-15 16:11:54

Okay, I've fixed the star involution issue: it just needed a twisting by the diagram automorphism induced from the w<sub>0</sub> action.


---

Comment by tscrim created at 2016-11-15 16:18:30

So I believe this is at the needs review stage.


---

Comment by tscrim created at 2016-11-15 16:18:30

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-11-16 07:46:11

one doctest trivially failing


---

Comment by git created at 2016-11-16 15:51:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2016-11-21 01:35:55

Hi all,

I'm in the process of reviewing this and I have some comments/concerns, mostly about the documentation.

- Dinakar's name should be added to the top of the `mv_polytopes.py` file as the initial author.
- Dinakar's (preferred) email should be added to the copyright of each file.
- Background information on the crystal of MV polytopes needs to be added to the documentation.  Also, even though the attributes seem to inherit from the PBW crystal, it still may be beneficial to the user to include element attributes for an MV polytope in its documentation.  In particular, `.star()` and `.lusztig_datum()` should be added.
- Background information on the PBW crystal needs to be added to the documentation.
- Documentation for `braid_move_calculator.py` needs to be linked from the `Root_System` page.
- Should the `pbw_datum.pyx` documentation be linked somewhere?  

Also, one question I brought up earlier in comment:9: is it possible/advantageous to define an MV polytope using a Lusztig datum, or using vertices, or something else than generating one from the highest weight polytope?  For example, being able to do this would be great:


```
sage: PBW = crystals.infinity.PBW("C2")
sage: PBW.set_default_long_word([1,2,1,2])
sage: b = PBW((1,2,1,2),(3,5,2,1))
sage: MV = crystals.infinity.MVPolytopes("C2")
sage: p = MV(b)
```


Other than these comments, I think the patch is ready to go.  I'm happy to read over the changes/additions once their finished!  It'll be great to get this merged!

Thanks Dinakar (and Travis) for getting this finished!

p.s. Typo in PBW crystal documentation: "Plucker" --> "Pl\"{u}cker"


---

Comment by git created at 2017-04-16 22:02:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-04-16 22:07:33

This should take care of all of [comment:47 Ben's comments]. I don't think we should add in `star` and `lusztig_datum` because they can be easily found in the superclass's documentation and are already there from the interactive command line. We have `pbw_datum.pyx` in the combinat module list, but I don't think we need to link it from elsewhere since it is an implementation detail. Hopefully we can (finally) get this merged.


---

Comment by git created at 2017-04-30 22:31:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsalisbury1 created at 2017-04-30 22:32:12

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-30 22:51:31

Thank you! :D


---

Comment by vbraun created at 2017-05-03 06:39:20

PDF docs don't bulid


---

Comment by vbraun created at 2017-05-03 06:39:20

Changing status from positive_review to needs_work.


---

Comment by git created at 2017-05-03 16:09:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2017-05-03 16:09:42

Changing status from needs_work to positive_review.


---

Comment by tscrim created at 2017-05-03 16:09:42

Fixed; pdf doc now builds for me.


---

Comment by vbraun created at 2017-05-08 21:19:03

Resolution: fixed
