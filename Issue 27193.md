# Issue 27193: more choices of algorithms for Coxeter Smith form of posets

Issue created by migration from https://trac.sagemath.org/ticket/27430

Original creator: chapoton

Original creation time: 2019-03-06 08:38:27

This allows to compare the speed of all those.


---

Comment by chapoton created at 2019-03-06 08:39:05

New commits:


---

Comment by chapoton created at 2019-03-06 08:39:05

Changing status from new to needs_review.


---

Comment by tscrim created at 2019-03-06 11:29:16

I think it would be better to have the comments about the (anecdotal) relative speed of the algorithms in the docstring rather than the code. That way it is easier for the (common) user to see it. Otherwise LGTM.


---

Comment by git created at 2019-03-06 13:52:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-03-06 13:52:49

thx, done


---

Comment by mantepse created at 2019-03-06 19:06:39

I cannot try the ticket right now, but I'm afraid that the FriCAS code will leak variables.  Could you try

```
sage: _ = P.coxeter_smith_form(algorithm='fricas')
sage: fricas.eval("Z")
sage: fricas.eval("x")
```


If it does, I can prepare a non-leaking statement.  Roughly, it will be

```
(fricas([x]*n).diagonalMatrix() - fricas(c0)).smith().diagonal().sage()
```



---

Comment by mantepse created at 2019-03-06 19:33:34

A more fundamental question: why not provide the `algorithm` keyword for matrices in general?

I admit, that I do not know how the matrix design currently works, but possibly `sage.matrix.matrix2.smith_form` is the right place?


---

Comment by chapoton created at 2019-03-06 19:37:24

Well. Indeed. That would go into "matrices with entries in QQ[x]' namely "matrix_polynomial_dense.pyx". Maybe for another ticket, unless you volunteer to do it ?

Now compiling Fricas to check the leak.


---

Comment by chapoton created at 2019-03-06 19:47:57

Answer:

```
sage: p=posets.PentagonPoset()
sage: sage: _ = p.coxeter_smith_form(algorithm='fricas')
....: sage: fricas.eval("Z")
....: sage: fricas.eval("x")
....: 
'\n   Integer\n'
'\n   x\n'
```

Does this mean that there is a leak?


---

Comment by mantepse created at 2019-03-06 20:35:15

Replying to [comment:8 chapoton]:
> Answer:
> {{{
> sage: p=posets.PentagonPoset()
> sage: sage: _ = p.coxeter_smith_form(algorithm='fricas')
> ....: sage: fricas.eval("Z")
> ....: sage: fricas.eval("x")
> ....: 
> '\n   Integer\n'
> '\n   x\n'
> }}}
> Does this mean that there is a leak?
Yes, after `p.coxeter_smith_form(algorithm='fricas')`, the name `Z` has value `Integer` in FriCAS.  By contrast, `x` still returns `x`, which is good.

So, for example, executing after that

```
sage: var("Z")
sage: fricas(Z^2+1)
```

will raise a strange error.


---

Comment by chapoton created at 2019-03-06 20:41:16

Ok. Then please try to provide a working better alternative. There is no urgency.


---

Comment by chapoton created at 2019-03-08 13:05:33

I tried the obvious modification for Fricas, as you suggested, and it failed.


---

Comment by mantepse created at 2019-03-08 13:09:25

Could you post the code?  I can look at it tonight (probably after 19:00)


---

Comment by chapoton created at 2019-03-08 14:48:36

I have made a branch `public/ticket/27430` with the tentative. I would say that the matrix type is not recognized correctly, so that the method `smith` does not apply.


---

Comment by chapoton created at 2019-03-11 19:05:30

Is this a working branch or what ?

Nota bene: If you do not make a comment, I do not see the change of branch.
----
New commits:


---

Comment by mantepse created at 2019-03-11 19:19:31

Dear Frederic !

sorry, I didn't know that you wouldn't see it.  Yes, this should work with FriCAS.


---

Comment by chapoton created at 2019-03-11 19:36:34

ok, the fricas code works and looks good to me. Travis, do you agree that this is ready to go?


---

Comment by tscrim created at 2019-03-11 21:53:46

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-03-11 21:53:46

Yep, LGTM. Thanks.


---

Comment by vbraun created at 2019-03-13 18:29:11

Resolution: fixed
