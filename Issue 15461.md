# Issue 15461: univariate polynomial ring fraction expansion to power series

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-01-20 11:00:32

Assignee: rws

Keywords: series expansion fraction ogf

The following behaviour is not implemented, example:

```
  sage: R.<t> = QQ[]; A=1/(1-t)
  sage: A.expand(5)
  1+t+t^2+t^3+t^4+t^5+O(t^6)
  sage: A+O(t^6)
  1+t+t^2+t^3+t^4+t^5+O(t^6)
```

Result type being a power series. The pari function Ser() implements the same behaviour. Note: I would like to implement this.


---

Comment by pbruin created at 2014-01-22 17:10:05

The "canonical" syntax for this kind of conversion would be

```
sage: S = QQ[This is the Trac macro *'t'* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#'t'-macro)  # construct power series ring
sage: S(A)           # convert A into it, using default precision
sage: S(A, prec=6)   # or using specified precision
```

However, the last two lines currently fail with

```
TypeError: denominator must be a unit
```

The following does work:

```
sage: L=S.laurent_series_ring()
sage: L(A)
1 + t + t^2 + t^3 + t^4 + t^5 + t^6 + t^7 + t^8 + t^9 + t^10 + t^11 + t^12 + t^13 + t^14 + t^15 + t^16 + t^17 + t^18 + t^19 + O(t^20)
```

Unfortunately, this does not currently accept a precision argument.

I think the easiest solution for `S(A)` is to fix `PowerSeriesRing._element_constructor_()` to accept rational functions.


---

Comment by git created at 2014-01-23 08:20:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-01-23 08:27:58

Why is the first commit (creation of branch plus first patch) not viewable?

Anyway, pbruin's example works now. `A.expand()` is then no longer necessary. The only thing that still does not work is addition of power series to fraction, where coercion is needed. I'll leave that for now and ask for your review.


---

Comment by rws created at 2014-01-23 08:28:19

Changing status from new to needs_review.


---

Comment by git created at 2014-01-23 08:39:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-01-24 07:30:04

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-01-24 07:41:16

Changing status from needs_work to positive_review.


---

Comment by rws created at 2014-01-24 07:41:30

Changing status from positive_review to needs_review.


---

Comment by mmezzarobba created at 2014-01-28 19:55:21

Shouldn't the following example throw an error?

```
sage: R.<x> = QQ[]
sage: S = R.completion(x)
sage: S(1/x)
x^-1
```



---

Comment by mmezzarobba created at 2014-01-28 19:55:21

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-01-29 07:30:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-01-29 07:33:07

Changing keywords from "series expansion fraction ogf" to "power series, expansion, fraction".


---

Comment by rws created at 2014-01-29 07:33:07

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2014-01-30 15:12:35

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2014-01-30 15:12:35

Ok, LGTM. I took the liberty of squashing your three patches and rebasing the whole on top of `develop`; please protest if you disagree.

I had a doubt about the fact of computing the quotient (possibly as a Laurent series) in all cases and then checking that it was in fact a power series, but at least it helps keeping the logic that decides whether the quotient fo two power series is a power series in a single place. 
----
New commits:


---

Comment by vbraun created at 2014-02-08 14:18:08

Please fill in real names under authors.


---

Comment by mmezzarobba created at 2014-02-08 14:35:36

Replying to [comment:18 vbraun]:
> Please fill in real names under authors.

Done. I also removed myself since I only reorganized the patches without changing the code at all.


---

Comment by vbraun created at 2014-02-08 17:03:23

doctests fail with 

```
sage -t --long src/sage/rings/power_series_poly.pyx
**********************************************************************
File "src/sage/rings/power_series_poly.pyx", line 987, in sage.rings.power_series_poly.PowerSeries_poly.__richcmp__.reversion
Failed example:
    g(f)
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.rings.power_series_poly.PowerSeries_poly.__richcmp__.reversion[32]>", line 1, in <module>
        g(f)
      File "power_series_poly.pyx", line 373, in sage.rings.power_series_poly.PowerSeries_poly.__call__ (sage/rings/power_series_poly.c:4951)
      File "polynomial_element.pyx", line 655, in sage.rings.polynomial.polynomial_element.Polynomial.__call__ (sage/rings/polynomial/polynomial_element.c:8408)
      File "element.pyx", line 1539, in sage.structure.element.RingElement.__add__ (sage/structure/element.c:13873)
      File "coerce.pyx", line 782, in sage.structure.coerce.CoercionModel_cache_maps.bin_op (sage/structure/coerce.c:7311)
      File "coerce.pyx", line 900, in sage.structure.coerce.CoercionModel_cache_maps.canonical_coercion (sage/structure/coerce.c:8549)
...
      File "/home/release/Sage/local/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element_generic.py", line 734, in __init__
        Polynomial_generic_dense.__init__(self, parent, x, check, is_gen)
      File "polynomial_element.pyx", line 6914, in sage.rings.polynomial.polynomial_element.Polynomial_generic_dense.__init__ (sage/rings/polynomial/polynomial_element.c:48031)
      File "polynomial_element.pyx", line 209, in sage.rings.polynomial.polynomial_element.Polynomial.__init__ (sage/rings/polynomial/polynomial_element.c:4700)
    RuntimeError: maximum recursion depth exceeded while calling a Python object
```



---

Comment by mmezzarobba created at 2014-02-08 18:02:39

Changing status from positive_review to needs_work.


---

Comment by git created at 2014-02-08 18:54:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-02-10 19:11:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2014-02-10 19:11:35

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-02-17 16:57:38

Patchbot says:

```
File "src/sage/rings/power_series_ring.py", line 671, in sage.rings.power_series_ring.PowerSeriesRing_generic._element_constructor_
Failed example:
    PowerSeriesRing(PowerSeriesRing(QQ,'x'),'y')(1/(1+x), 5)
Expected:
    1 - x + x^2 - x^3 + x^4 + O(x^5)
Got:
    1 - x + x^2 - x^3 + x^4 - x^5 + x^6 - x^7 + x^8 - x^9 + x^10 - x^11 + x^12 - x^13 + x^14 - x^15 + x^16 - x^17 + x^18 - x^19 + O(x^20) + O(y^5)
```



---

Comment by rws created at 2014-02-17 16:58:33

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-03-04 13:53:03

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mmezzarobba created at 2014-03-04 13:53:55

Replying to [comment:25 rws]:
> Patchbot says:
> {{{
> File "src/sage/rings/power_series_ring.py", line 671, in sage.rings.power_series_ring.PowerSeriesRing_generic._element_constructor_
> Failed example:
>     PowerSeriesRing(PowerSeriesRing(QQ,'x'),'y')(1/(1+x), 5)
> Expected:
>     1 - x + x^2 - x^3 + x^4 + O(x^5)
> Got:
>     1 - x + x^2 - x^3 + x^4 - x^5 + x^6 - x^7 + x^8 - x^9 + x^10 - x^11 + x^12 - x^13 + x^14 - x^15 + x^16 - x^17 + x^18 - x^19 + O(x^20) + O(y^5)
> }}}

Thanks. That was a stupid copy-paste mistake, I believe.
----
New commits:


---

Comment by mmezzarobba created at 2014-03-04 13:53:55

Changing status from needs_work to needs_review.


---

Comment by rws created at 2014-03-05 08:50:48

Thanks, it tested --long okay in rings/ so let's roll.


---

Comment by rws created at 2014-03-05 08:50:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-03-05 14:18:39

Resolution: fixed
