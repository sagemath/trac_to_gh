# Issue 21936: Shioda invariants for hyperelliptic curves with genus 3

Issue created by migration from Trac.

Original creator: annasomoza

Original creation time: 2017-01-11 18:41:27

CC:  christelle elorenzogarcia ionisorus mstreng kohel florian sijsling jnoordsij

Keywords: days82, hyperelliptic curves, shioda invariants

Sorina Ionica, Elisa Lorenzo Garcia and I implemented the computation of Shioda invariants for a given hyperelliptic curve of genus 3.

Following the implementation of the constructors of genus 2 curves over various fields we have added the corresponding classes for genus 3 hyperelliptic curves.


---

Comment by git created at 2017-01-11 19:20:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-11 19:23:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-11 19:28:45

missing "of" in

```
Compute invariants genus 2 and 3 hyperelliptic curves via 'Ueberschiebung'
```



---

Comment by ionisorus created at 2017-01-12 17:56:28

Changing status from new to needs_review.


---

Comment by git created at 2017-01-13 07:47:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-13 10:17:34

doc still does not build:

```
+[dochtml] [curves   ] /home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/hyperelliptic_curves/invariants.py:docstring of sage.schemes.hyperelliptic_curves.invariants.shioda_invariants:7: WARNING:
 Duplicate explicit target name: "sh".
+[dochtml] [curves   ] /home/u1/chapoton/sage/local/lib/python2.7/site-packages/sage/schemes/hyperelliptic_curves/invariants.py:docstring of sage.schemes.hyperelliptic_curves.invariants.shioda_invariants:7: WARNING:
 duplicate citation Sh, other instance in /home/u1/chapoton/sage/src/doc/en/reference/curves/sage/schemes/hyperelliptic_curves/invariants.rst
```



---

Comment by git created at 2017-01-13 14:50:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-01-16 12:35:41

some remarks:

* remove the commented code if it is useless

* reference [Sh] should go the master reference file (see http://doc.sagemath.org/html/en/developer/coding_basics.html#sage-s-master-bibliography-file)

* compile the html doc and look at it to check that it looks correct

* you could use "lazy import" for your new modules.


---

Comment by jpflori created at 2017-01-31 10:39:29

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-08-01 14:19:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annasomoza created at 2017-08-01 14:20:13

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-08-01 15:31:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2017-08-01 16:48:46

Now that you have moved the reference [Sh1967] to the master reference file, you should update the remaining link `[Sh]_ ` and replace

```
.. [Sh] etc
```

by

```
- [Sh1967]_
```

in the REFERENCE block.


---

Comment by git created at 2017-08-01 18:11:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-08-01 19:34:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2017-08-03 08:21:50

You are creating 4 new files and 4 new classes in order to support a single function which is 10 lines long! This is not worth the trouble. Curves of genus 0, 1, 2 are special enough to have dedicated classes. Do you think that genus 3 have that many special methods that it would make sense to have dedicated classes?

I would rather propose to have a method `shioda_invariants` in the class `HyperellipticCurve_generic` that does raise an error when the curve is not of genus 3.


---

Comment by chapoton created at 2018-01-03 19:02:28

does not apply


---

Comment by chapoton created at 2018-01-03 19:02:28

Changing status from needs_review to needs_work.


---

Comment by sijsling created at 2018-01-10 10:09:00

I recall this ticket applying correctly before. It must have something to do with its age. I also recall that it returned the correct Shioda invariants. It is therefore a pity that it has not been incorporated in any form, since it is a worthwhile contribution.

The code is now there and certainly it can still be incorporated in some way. The question is how exactly, a question that is related to the general design of hyperelliptic curve classes. What complicates things is that before the authors' contributions can be incorporated, this needs to be decided on. Here are some thoughts; note I do not know if they are useful since I am not the biggest expert on Sage.

As for the new class creation, it strikes me as odd that what was all right in genus 2 should be problematic in genus 3. The authors had truly taken care to follow previous practice in the former genus to the letter. That is not a bad thing, rather the opposite in fact.

As for genus 3 curves being special or not, consider what there is in genus 2: a zoo of different invariants and the Kummer. That was enough for a new class. I agree with that, but then what is the content of "special enough"? In my opinion, genus 3 hyperelliptic curves are interesting enough to merit their own class if genus 2 curves are. Think of their Prym varieties and isogenies of small degree with plane quartics, for example.

The suggestion to have `shioda_invariants` be a generic method of hyperelliptic curves means that `igusa_clebsch_invariants` should be one too. It is not, so again the authors have followed established practice. A decision of this kind would also cause the number of invariants of a generic hyperelliptic curve to grow as new invariants in higher genus are discovered. Creating new classes in these genera as they start to receive more mathematical attention makes more sense to me.

Another alternative is to have `shioda_invariants` be a global function, just like `igusa_clebsch_invariants`. But is it justifiable to do this for every new set of invariants? In my opinion, it is better to expand the number of classes in small genus than to burden either the general hyperelliptic curve class or the global namespace with lots of functions.

Making methods and functions for a specific genus into general ones has been done before, not only for `igusa_clebsch_invariants` but also for `HyperellipticCurve_from_invariants`. This is another globally exported function, which assumes the invariants in question to be the Igusa-Clebsch invariants. But not all hyperelliptic curves have genus 2, and even then the Igusa-Clebsch invariants are not everyone's first choice. The same applies to the function `Mestre_conic`, which also exists for more general hyperelliptic curves. I find this confusing. Perhaps these functions can later be generalized with some kind of keyword argument that gives the genus or the set of invariants in question, with appropriate defaults so as not to break reverse compatibility.

I am not sufficiently experienced to immediately find a good and consistent infrastructure here, but certainly the current situation makes it difficult to guess what to do with this code.


---

Comment by vdelecroix created at 2018-01-10 10:41:19

Thanks for making this ticket revives!

Replying to [comment:23 sijsling]:
> As for the new class creation, it strikes me as odd that what was all right in genus 2 should be problematic in genus 3. The authors had truly taken care to follow previous practice in the former genus to the letter. That is not a bad thing, rather the opposite in fact.

classe*s*: there are 4 of them! The useful one `HyperellipticCurve_g3_generic` and the trivial ones `HyperellipticCurve_g3_finite_field`, `HyperellipticCurve_g3_padic_field`, `HyperellipticCurve_g3_rational_field`.

There should not be a class+file for each pair `(genus, ring)`. If I am interested in hyperelliptic curves over `QQbar[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)` I have to write classes for genus 2 and 3. And them, somebody likes genus 4 and starts writing 5 classes for `generic`, `finite_field`, `padic_field`, `rational_field` and `qqbar_x`, etc. And each time, one class, one file. For me this is a terrible design. And you are somehow suggesting that it is better to follow a bad design decision rather than questionning the initial one!

> As for genus 3 curves being special or not, consider what there is in genus 2: a zoo of different invariants and the Kummer. That was enough for a new class. I agree with that, but then what is the content of "special enough"? In my opinion, genus 3 hyperelliptic curves are interesting enough to merit their own class if genus 2 curves are. Think of their Prym varieties and isogenies of small degree with plane quartics, for example.
> 
> The suggestion to have `shioda_invariants` be a generic method of hyperelliptic curves means that `igusa_clebsch_invariants` should be one too. It is not, so again the authors have followed established practice. A decision of this kind would also cause the number of invariants of a generic hyperelliptic curve to grow as new invariants in higher genus are discovered. Creating new classes in these genera as they start to receive more mathematical attention makes more sense to me.
> 
> Another alternative is to have `shioda_invariants` be a global function, just like `igusa_clebsch_invariants`. But is it justifiable to do this for every new set of invariants? In my opinion, it is better to expand the number of classes in small genus than to burden either the general hyperelliptic curve class or the global namespace with lots of functions.

In the current branch `shioda_invariants` *is* first of all a function in `sage/schemes/hyperelliptic_curves/invariants.py`. Of course this function should not be part of the global namespace.

> Making methods and functions for a specific genus into general ones has been done before, not only for `igusa_clebsch_invariants` but also for `HyperellipticCurve_from_invariants`. This is another globally exported function, which assumes the invariants in question to be the Igusa-Clebsch invariants. But not all hyperelliptic curves have genus 2, and even then the Igusa-Clebsch invariants are not everyone's first choice. The same applies to the function `Mestre_conic`, which also exists for more general hyperelliptic curves. I find this confusing. Perhaps these functions can later be generalized with some kind of keyword argument that gives the genus or the set of invariants in question, with appropriate defaults so as not to break reverse compatibility.
> 
> I am not sufficiently experienced to immediately find a good and consistent infrastructure here, but certainly the current situation makes it difficult to guess what to do with this code.

Indeed!


---

Comment by sijsling created at 2018-01-10 17:10:21

That is a quick reply, great!

Replying to [comment:24 vdelecroix]:
> There should not be a class+file for each pair `(genus, ring)`. If I am interested in hyperelliptic curves over `QQbar[This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)` I have to write classes for genus 2 and 3. And them, somebody likes genus 4 and starts writing 5 classes for `generic`, `finite_field`, `padic_field`, `rational_field` and `qqbar_x`, etc. And each time, one class, one file. For me this is a terrible design. And you are somehow suggesting that it is better to follow a bad design decision rather than questionning the initial one!

Ah I see then. I did not in fact know that you were questioning the initial design in genus 2 since that was not completely clear to me from your previous comment. But stated like this your point is quite cogent. So do you mean that ideally also the genus 2 functionality should move to the generic class?

> In the current branch `shioda_invariants` *is* first of all a function in `sage/schemes/hyperelliptic_curves/invariants.py`. Of course this function should not be part of the global namespace.

This also makes sense. 

> > I am not sufficiently experienced to immediately find a good and consistent infrastructure here, but certainly the current situation makes it difficult to guess what to do with this code.
> 
> Indeed!

So leaving aside what happens with `igusa_clebsch_invariants` and `HyperellipticCurve_from_invariants` and its generalization, this seems to be the suggestion for the new code for Shioda invariants:

* At the least we create a function `shioda_invariants` in invariants.py that can later be found and used via a suitable import statement.
* Optionally, we create a separate genus 3 class and make `shioda_invariants` into a method for that class. But part of your point is that this is not the way to go since then the number of classes used will tend to infinity with time.

Personally I agree in that if we can do with a generic class only then that is what should happen. There is probably no possibility to store the genus on construction and tab-complete only those methods that apply for that genus? That would be optimal, but perhaps it is perverse and/or impossible to have the instance define the available methods.


---

Comment by sijsling created at 2018-01-12 09:04:25

Attempt to merge develop failed because trac cannot automerge the result. Should I rebase?


---

Comment by sijsling created at 2018-01-12 11:04:09

I figured out how to rebase this into a ticket for Sage 8.1. I can force push this so that the ticket applies. The result is that exactly the same changes are made, but that one needs to install the new version of Sage to use them (after installing trac as well and doing git trac checkout 22173 of course).

Shall I push this? I will not do so right away unless I hear an active yes from the authors and reader of this thread.


---

Comment by sijsling created at 2018-01-12 16:26:23

Here are some impressions of the global structure. This goes beyond the present ticket but I mention it anyway. Let X be a curve with Jacobian J. First some things that     seem strange:

* The Kummer surface, which is in the global namespace, does not actually return anything and at present calls like `KummerSurface(J)` and `J.kummer_surface()`, and `X.kummer_morphism` fail.

* All invariant functions are usual imports, but `shioda_invariants` is a lazy one. Why?

Here are some suggestions for change in various directions:

* I quite like the global export of `monsky_washnitzer`, which is not a function but a module, so essentially a bunch of functions bundled up. Would it be an idea to    have similar modules called `curve_invariants` and `curve_reconstruction`? This prevents the global namespace from being filled with the names of various            alternative invariants, while still keeping these functions available.

* The question is of course how bad it is to export to the global namespace... this module is not the only one that does this. I would personally say that functions that    are naturally methods should only be methods, and that functions that do not fit this mold, like `HyperellipticCurve_from_invariants`, should become global functions,   whether in a container like `curve-reconstruction` or not.

* As suggested by Vincent, we could remove the methods specific to a genus and have them be general ones. In the end I am also convinced that this does lead to better       maintenance. The only problem is that there are lots of invariants. Here is a suggestion to avoid making these all into individual methods for general hyperelliptic curves. We could make a method `invariants` that depending on the curve chooses a particular set of invariants (perhaps Igusa-Clebsch in genus 2 and Shioda in genus 3, to be    shown in the docstring). Giving a string to invariants allows the selection of other invariants, with an error message if no invariants corresponding to the string exist or if the genus does not match up. We could mention the various invariants in the docstring of the method `invariants`, while writing more documentation in the module      `invariants` (which could become the global `curve_invariants`).

* The previous suggestion leads to the loss of tab completion. An alternative is to have an attribute `invariants` that is itself a class and that can be tab-completed  further to give the various individual invariant functions. Personally I think few people will care about tab-completing invariants though, and if we at least mention the   available invariants in the documentation of `invariants` this should probably be OK.

The suggested changes do cause backward compatibility problems, mainly because of the functions that are currently available locally. If this cannot be changed, then at     least one can generalize `HyperellipticCurve_from_invariants` and `Mestre_conic` later by having the current version as a default.

I will leave it at this for a while and wait for feedback  :-)


---

Comment by sijsling created at 2018-01-15 17:41:28

I do not think that rebasing to 8.1 helps either to get an automerge. Not only does this force everyone to upgrade to 8.1, but it would not even help. The automerge does not work because of a modification to `src/doc/en/reference/references/index.rst` in commit `d893f9` on the `develop` branch... which is *after* the update to 8.1.

The additions of the authors are not really in conflict, but Git cannot automerge because it does not find a common ancestor. I have tried to split the comments in such a way that for one of them merging `develop` is literally replacing an empty line with the new reference introduced in `d893f9`, but that also fails.


---

Comment by sijsling created at 2018-08-28 13:04:43

I have not received any feedback to these suggestions, and by now the ticket is very old. In a nutshell, based on the preceding, I still suggest that two new tickets be created.

The first of these would make a method `invariants` for general curves. For hyperelliptic curves of a genus 2 or 3, it would spit out a distinguished set of invariants. Other invariants, like the G2 invariants could be chosen by specifying a string. Later other invariants, like the Dixmier--Ohno invariants, could be added.

The second would be the extension of `HyperellipticCurve_from_invariants` and `Mestre_conic` to higher genus, perhaps as methods in a more general module called `reconstruction`, because these functions arguably clutter the global namespace. Alternatively, we could modify `HyperellipticCurve` to accept a keyword argument specifying the invariants.

I will not create these tickets myself because I am not the main author of this code and do not want to tell its authors what to do, all the more since the preceding comments have merely been a long monologue on my part. But a third ticket, having to do with the behavior of the Kummer functionality, will now be filed by me as a bug report.


---

Comment by vdelecroix created at 2018-09-01 14:54:36

Replying to [comment:25 sijsling]:
> Replying to [comment:24 vdelecroix]:
>
> <SNIP>
>
> Personally I agree in that if we can do with a generic class only then that is what should happen. There is probably no possibility to store the genus on construction and tab-complete only those methods that apply for that genus? That would be optimal, but perhaps it is perverse and/or impossible to have the instance define the available methods.

In Python, you can create classes dynamically. That might be a solution.

Replying to [comment:32 sijsling]:
> The second would be the extension of `HyperellipticCurve_from_invariants` and `Mestre_conic` to higher genus, perhaps as methods in a more general module called `reconstruction`, because these functions arguably clutter the global namespace. Alternatively, we could modify `HyperellipticCurve` to accept a keyword argument specifying the invariants.

Another way that is sometimes used in Python/Sage is to have explicit class functions for creating objects from a given datatype

```
sage: MyObject.from_equation(x^2 + 1)
sage: MyObject.from_igusa_invariant("aa9b302")
```

That has the advantage of not complicating too much the `__init__` constructor.


---

Comment by mstreng created at 2018-09-24 13:30:36

Replying to [comment:32 sijsling]:
> I still suggest that two new tickets be created.
> 
> The first of these would make a method `invariants` for general curves. For hyperelliptic curves of a genus 2 or 3, it would spit out a distinguished set of invariants. Other invariants, like the G2 invariants could be chosen by specifying a string. Later other invariants, like the Dixmier--Ohno invariants, could be added.

+1

> The second would be the extension of `HyperellipticCurve_from_invariants` and `Mestre_conic` to higher genus, perhaps as methods in a more general module called `reconstruction`, because these functions arguably clutter the global namespace. Alternatively, we could modify `HyperellipticCurve` to accept a keyword argument specifying the invariants.

I agree. In detail:

* I'm sorry for putting `Mestre_conic` in the global namespace, it fits much better in a module.

* Letting `HyperellipticCurve` accept a keyword is better than having a separate function. I created the separate function `HyperellipticCurve_from_invariants` in order to make it consistent with `EllipticCurve_from_j`, but since we may be getting more-and-more of these, I agree with letting go of the consistency.

* The name "`reconstruction`" might be a bit generic. However, there already is a module called `invariant_theory` where this may fit.

Related to this discussion:

What really happens when constructing a hyperelliptic curve of genus `g` (in characteristic different from 2) from the invariants is that a binary form of degree `2g+2` is reconstructed from its invariants. Reconstructing binary forms from invariants is useful also outside of hyperelliptic curves and also for odd degree. Degree 6 is currently in the `HyperellipticCurve_from_invariants` function. Degree 5 is #25508. Degree 8 is #22173.

I think it would be good to have all the (binary and ternary) form reconstructions in the same place, and as this reconstruction for odd degree is unrelated to hyperelliptic curves, it should not be implemented inside the hyperelliptic curve functions. It fits much better in/around `sage/rings/invariant_theory.py`. So I think the first step is to move the degree 6 code to the better location, and then implement the code for degree 5 and 8 there too. The code can then of course be wrapped by letting `HyperellipticCurve` accept a keyword.

I'm cc-ing the author of #25508 who may have already started working on such a move.


---

Comment by mstreng created at 2018-10-11 08:21:50

Replying to [comment:34 mstreng]:

See #26462 and #26370


---

Comment by git created at 2019-04-11 15:14:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annasomoza created at 2019-04-11 15:16:36

Thank you all for your feedback. I finally found the time to deal with this! In #27633 there is a proposal for the issue with the design of classes, and I have updated the branch of this one to follow that method.

I agree that a general `invariants` method would be good, but that should be a topic for another ticket.


---

Comment by annasomoza created at 2019-04-11 15:16:36

Changing keywords from "days82, hyperelliptic curves, shioda invariants" to "days82, hyperelliptic curves, shioda invariants, days98".


---

Comment by git created at 2019-04-18 12:32:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annasomoza created at 2019-04-18 12:36:20

Changing status from needs_work to needs_review.


---

Comment by annasomoza created at 2019-04-18 12:36:20

#27633 has now positive review, what I think solves all main issues raised here.


---

Comment by vdelecroix created at 2019-04-18 19:55:18

Changing status from needs_review to positive_review.


---

Comment by git created at 2019-05-17 13:54:13

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2019-05-17 13:54:13

Changing status from positive_review to needs_review.


---

Comment by chapoton created at 2019-05-23 11:34:38

and the branch is now red, meaning some conflicts with the latest develop version of sage

By the way, never ever make any change to some ticket when it is in positive_review..


---

Comment by chapoton created at 2019-05-23 11:34:38

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-05-31 15:53:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by annasomoza created at 2019-05-31 15:59:40

Changing status from needs_work to needs_review.


---

Comment by annasomoza created at 2019-05-31 15:59:40

Now it merges correctly. And sorry about changing it after the positive review, I thought that I had to correct the pyflake error.


---

Comment by annasomoza created at 2019-06-17 16:36:50

Can someone review? Only change made after last positive_review is removing an unused variable.


---

Comment by jpflori created at 2019-06-18 08:34:29

Changing status from needs_review to positive_review.


---

Comment by jpflori created at 2019-06-18 08:34:29

Looks ok.


---

Comment by slelievre created at 2020-08-02 15:24:09

Does this still apply, need rebasing, need work?


---

Comment by slelievre created at 2020-09-13 03:15:50

Please rebase.


---

Comment by slelievre created at 2020-09-13 03:15:50

Changing status from positive_review to needs_work.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by lorenz created at 2021-10-07 05:21:40

Changing status from needs_work to needs_review.


---

Comment by lorenz created at 2021-10-07 05:21:40

I took the liberty to rebase this; no complications. Needs another review, and presumably also an OK from the authors.

Regarding #26462: This looks like a reminder to refactor things at some point rather than an actual dependency?
----
Last 10 new commits:


---

Comment by chapoton created at 2021-10-07 09:11:09

please remove `from __future__ import absolute_import`


---

Comment by git created at 2021-10-07 09:18:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
