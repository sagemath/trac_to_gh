# Issue 16814: Strange bug in poset show()

archive/issues_016814.json:
```json
{
    "body": "CC:  ncohen\n\nThis seems to trigger some kind of error:\n\n\n```\nP1=Posets.ChainPoset(3)\nP2=Posets.PentagonPoset().relabel(lambda x: x+10)\nP=Poset( (P1.list()+P2.list(), P1.cover_relations()+P2.cover_relations()) )\nP.show()\n```\n\n\nError message is `ValueError: element (=2) not in poset`. If I change 2. line to\n\n\n```\nP2=Posets.ChainPoset(5).relabel(lambda x: x+10)\n```\n\n\nerror disappears.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17051\n\n",
    "created_at": "2014-09-26T21:30:55Z",
    "labels": [
        "combinatorics",
        "major",
        "bug"
    ],
    "title": "Strange bug in poset show()",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16814",
    "user": "jmantysalo"
}
```
CC:  ncohen

This seems to trigger some kind of error:


```
P1=Posets.ChainPoset(3)
P2=Posets.PentagonPoset().relabel(lambda x: x+10)
P=Poset( (P1.list()+P2.list(), P1.cover_relations()+P2.cover_relations()) )
P.show()
```


Error message is `ValueError: element (=2) not in poset`. If I change 2. line to


```
P2=Posets.ChainPoset(5).relabel(lambda x: x+10)
```


error disappears.

Issue created by migration from https://trac.sagemath.org/ticket/17051





---

archive/issue_comments_222601.json:
```json
{
    "body": "Is this related to #14019? You don't get same error message if you say `P.cover_relations()` and then manually make same poset. So there is something with `relabel()` happening.",
    "created_at": "2014-09-27T06:17:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222601",
    "user": "jmantysalo"
}
```

Is this related to #14019? You don't get same error message if you say `P.cover_relations()` and then manually make same poset. So there is something with `relabel()` happening.



---

archive/issue_comments_222602.json:
```json
{
    "body": "Okay, I'll add a message in #14019, they have been wasting my time for long enough.",
    "created_at": "2014-09-27T10:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222602",
    "user": "ncohen"
}
```

Okay, I'll add a message in #14019, they have been wasting my time for long enough.



---

archive/issue_comments_222603.json:
```json
{
    "body": "On discussion at #14019 tscrim wasn't sure if this relates to same relabeling thing or not. I move this to wontfix-milestone, but will not marked as positive review yet.",
    "created_at": "2014-09-27T15:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222603",
    "user": "jmantysalo"
}
```

On discussion at #14019 tscrim wasn't sure if this relates to same relabeling thing or not. I move this to wontfix-milestone, but will not marked as positive review yet.



---

archive/issue_comments_222604.json:
```json
{
    "body": "More about this. Problem is that `type(Posets.PentagonPoset().list()[0])` is `sage.combinat.posets.elements.FiniteLatticePoset_with_category.element_class`, whereas for example `type(Posets.RandomPoset(1,0).list()[0])` is `sage.rings.integer.Integer`. Problem can be seen for example by\n\n\n```\nP1=Posets.PentagonPoset()\nP2=Poset({'a':['b','c']})\nP=Poset( (P1.list()+P2.list(), []) )\nP.show()\n```\n",
    "created_at": "2014-09-27T15:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222604",
    "user": "jmantysalo"
}
```

More about this. Problem is that `type(Posets.PentagonPoset().list()[0])` is `sage.combinat.posets.elements.FiniteLatticePoset_with_category.element_class`, whereas for example `type(Posets.RandomPoset(1,0).list()[0])` is `sage.rings.integer.Integer`. Problem can be seen for example by


```
P1=Posets.PentagonPoset()
P2=Poset({'a':['b','c']})
P=Poset( (P1.list()+P2.list(), []) )
P.show()
```




---

archive/issue_comments_222605.json:
```json
{
    "body": "More fun:\n\n\n```\nx=Poset(Posets.PentagonPoset().hasse_diagram()).list()[1]\nprint x\nprint x+1\n```\n\n\noutputs\n\n\n```\n2\n4\n```\n",
    "created_at": "2014-09-27T15:40:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222605",
    "user": "jmantysalo"
}
```

More fun:


```
x=Poset(Posets.PentagonPoset().hasse_diagram()).list()[1]
print x
print x+1
```


outputs


```
2
4
```




---

archive/issue_comments_222606.json:
```json
{
    "body": "I HATE THIS CODE. You cannot for one second even trust that it does what you think it should do.\n\nOkay, that's because there is in Poset(....) a keyword named \"facade\" (not how clearly it indicates what it does) that changes the type of the things inside of the poset.\n\n\n```\nsage: d = DiGraph({0:[1]})\nsage: map(type,Poset(d))\n[sage.rings.integer.Integer, sage.rings.integer.Integer]\nsage: map(type,Poset(d,facade=False))\n[sage.combinat.posets.elements.FinitePoset_with_category.element_class,\n sage.combinat.posets.elements.FinitePoset_with_category.element_class]\n```\n\n\nI had to fight a looooong time ago to obtain that facade becomes True by defaut in Posets. And now it is, but for some stupid reason the constructor of PentagonalPoset enforces facade=False. So the code should only be changed to follow the same default as the Poset constructor. Or even to remove this keyword in PentagonalPoset, or replace it with `**kwds`... Anything `-_-`\n\nBy the way: the real explanation is that the + has been changed to mean \"join\" or \"meet\". It is not had to find out: take your 'x' as you defined it and type 'x.__add__'.\n\nNathann",
    "created_at": "2014-09-28T08:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222606",
    "user": "ncohen"
}
```

I HATE THIS CODE. You cannot for one second even trust that it does what you think it should do.

Okay, that's because there is in Poset(....) a keyword named "facade" (not how clearly it indicates what it does) that changes the type of the things inside of the poset.


```
sage: d = DiGraph({0:[1]})
sage: map(type,Poset(d))
[sage.rings.integer.Integer, sage.rings.integer.Integer]
sage: map(type,Poset(d,facade=False))
[sage.combinat.posets.elements.FinitePoset_with_category.element_class,
 sage.combinat.posets.elements.FinitePoset_with_category.element_class]
```


I had to fight a looooong time ago to obtain that facade becomes True by defaut in Posets. And now it is, but for some stupid reason the constructor of PentagonalPoset enforces facade=False. So the code should only be changed to follow the same default as the Poset constructor. Or even to remove this keyword in PentagonalPoset, or replace it with `**kwds`... Anything `-_-`

By the way: the real explanation is that the + has been changed to mean "join" or "meet". It is not had to find out: take your 'x' as you defined it and type 'x.__add__'.

Nathann



---

archive/issue_comments_222607.json:
```json
{
    "body": "I also removed part of documentation; it seems to better suited for `is_distributive()`.\n----\nNew commits:",
    "created_at": "2014-09-28T19:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222607",
    "user": "jmantysalo"
}
```

I also removed part of documentation; it seems to better suited for `is_distributive()`.
----
New commits:



---

archive/issue_comments_222608.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-28T19:32:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222608",
    "user": "jmantysalo"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_222609.json:
```json
{
    "body": "The same thing happens with `DiamontPoset` just afterwards.\n\nNathann",
    "created_at": "2014-09-28T21:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222609",
    "user": "ncohen"
}
```

The same thing happens with `DiamontPoset` just afterwards.

Nathann



---

archive/issue_comments_222610.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T04:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222610",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222611.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-29T08:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222611",
    "user": "ncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_222612.json:
```json
{
    "body": "Helloooooooooooooo !\n\nSeems good, but why did you remove that doc ? \n\nAlso, could you mention this `n>=3` in the doc of DiamondPoset ?\n\nThanks,\n\nNathann",
    "created_at": "2014-09-29T08:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222612",
    "user": "ncohen"
}
```

Helloooooooooooooo !

Seems good, but why did you remove that doc ? 

Also, could you mention this `n>=3` in the doc of DiamondPoset ?

Thanks,

Nathann



---

archive/issue_comments_222613.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T11:02:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222613",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222614.json:
```json
{
    "body": "Replying to [comment:14 ncohen]:\n\n> Seems good, but why did you remove that doc ? \n\nI think that it was irrelevant in this context. Also note about `DiamondPoset` seems to be at wrong place inside docstring of `PentagonPoset`.\n\n> Also, could you mention this `n>=3` in the doc of DiamondPoset ?\n\nDone. Should have noticed this myself.",
    "created_at": "2014-09-29T11:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222614",
    "user": "jmantysalo"
}
```

Replying to [comment:14 ncohen]:

> Seems good, but why did you remove that doc ? 

I think that it was irrelevant in this context. Also note about `DiamondPoset` seems to be at wrong place inside docstring of `PentagonPoset`.

> Also, could you mention this `n>=3` in the doc of DiamondPoset ?

Done. Should have noticed this myself.



---

archive/issue_comments_222615.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-29T11:05:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222615",
    "user": "jmantysalo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_222616.json:
```json
{
    "body": "Hello !\n\n> I think that it was irrelevant in this context. Also note about `DiamondPoset` seems to be at wrong place inside docstring of `PentagonPoset`.\n\nWhy do you think that it is irrelevant here ? It is a docstring about an object, so why don't we show its nice properties ? This sage software is all about checking on computers what we can prove on paper anyway `:-)`\n\nNathann",
    "created_at": "2014-09-29T11:37:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222616",
    "user": "ncohen"
}
```

Hello !

> I think that it was irrelevant in this context. Also note about `DiamondPoset` seems to be at wrong place inside docstring of `PentagonPoset`.

Why do you think that it is irrelevant here ? It is a docstring about an object, so why don't we show its nice properties ? This sage software is all about checking on computers what we can prove on paper anyway `:-)`

Nathann



---

archive/issue_comments_222617.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-29T18:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222617",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_222618.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-29T18:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222618",
    "user": "jmantysalo"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_222619.json:
```json
{
    "body": "OK, I added an example. Not the same, thought.",
    "created_at": "2014-09-29T18:47:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222619",
    "user": "jmantysalo"
}
```

OK, I added an example. Not the same, thought.



---

archive/issue_comments_222620.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-09-29T18:48:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222620",
    "user": "jmantysalo"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_222621.json:
```json
{
    "body": "Hello !\n\nI added a small commit on top of yours. What it does :\n\n1) Remove the `\"` in the first line of doc of the `PentagonPoset` constructor.\n\n2) Improve the doc of the `facade` keyword\n\n3) Bring the former doctest back. The point is that doctests are not only useful to the users, but also to test our own code. I can't tell you how many bugs are avoided just because there is always a doctest somewhere that tests the corner case you did not think about. If we ever change the data structure of Posets, do anything in the graphs backends, those doctests are the only way we have to make sure everything is holding together.\n\n4) Changing the default value of facade was breaking doctests in another file, so I updated them. In order to check the doctests use `sage -b && sage -tp <num_of_cpu> -l file_or_directory`\n\nI will also create a ticket to ask Nicolas to write some documentation about `Facade`, because right now there is none to find.\n\nSet this ticket to `positive_review` if you agree with the changes.\n\nNathann",
    "created_at": "2014-09-30T08:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222621",
    "user": "ncohen"
}
```

Hello !

I added a small commit on top of yours. What it does :

1) Remove the `"` in the first line of doc of the `PentagonPoset` constructor.

2) Improve the doc of the `facade` keyword

3) Bring the former doctest back. The point is that doctests are not only useful to the users, but also to test our own code. I can't tell you how many bugs are avoided just because there is always a doctest somewhere that tests the corner case you did not think about. If we ever change the data structure of Posets, do anything in the graphs backends, those doctests are the only way we have to make sure everything is holding together.

4) Changing the default value of facade was breaking doctests in another file, so I updated them. In order to check the doctests use `sage -b && sage -tp <num_of_cpu> -l file_or_directory`

I will also create a ticket to ask Nicolas to write some documentation about `Facade`, because right now there is none to find.

Set this ticket to `positive_review` if you agree with the changes.

Nathann



---

archive/issue_comments_222622.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-30T08:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222622",
    "user": "ncohen"
}
```

New commits:



---

archive/issue_comments_222623.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-09-30T08:41:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222623",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_222624.json:
```json
{
    "body": "I had forgotten a detail: it is better to make the default value of `facade` be equal to `None`, as it means \"use the same default as in `Poset()`. We should not have to repeat the default value everywhere. That's why we had the problem in the first place.\n\nNathann",
    "created_at": "2014-09-30T08:42:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222624",
    "user": "ncohen"
}
```

I had forgotten a detail: it is better to make the default value of `facade` be equal to `None`, as it means "use the same default as in `Poset()`. We should not have to repeat the default value everywhere. That's why we had the problem in the first place.

Nathann



---

archive/issue_comments_222625.json:
```json
{
    "body": "(just created #17073 about the documentation of Facade)",
    "created_at": "2014-09-30T08:44:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222625",
    "user": "ncohen"
}
```

(just created #17073 about the documentation of Facade)



---

archive/issue_comments_222626.json:
```json
{
    "body": "Seems reasonable --> positive_review.",
    "created_at": "2014-09-30T10:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222626",
    "user": "jmantysalo"
}
```

Seems reasonable --> positive_review.



---

archive/issue_comments_222627.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-30T10:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222627",
    "user": "jmantysalo"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_222628.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-02T16:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16814",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16814#issuecomment-222628",
    "user": "vbraun"
}
```

Resolution: fixed
