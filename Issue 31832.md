# Issue 31832: Upgrade jupyterlab to 3.0.x

archive/issues_031832.json:
```json
{
    "body": "CC:  slelievre @jcamp0x2a dimpase egourgoulhon\n\n#30246 added jupyterlab 2.2.x as an optional package as part of Meta-ticket #30399.\n\nThe 3.0 series has been out since December 2020. https://pypi.org/project/jupyterlab/#history \nCurrent as of June 2021 is 3.0.16.\n\nIssue created by migration from https://trac.sagemath.org/ticket/32069\n\n",
    "created_at": "2021-06-27T21:25:40Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "title": "Upgrade jupyterlab to 3.0.x",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31832",
    "user": "mkoeppe"
}
```
CC:  slelievre @jcamp0x2a dimpase egourgoulhon

#30246 added jupyterlab 2.2.x as an optional package as part of Meta-ticket #30399.

The 3.0 series has been out since December 2020. https://pypi.org/project/jupyterlab/#history 
Current as of June 2021 is 3.0.16.

Issue created by migration from https://trac.sagemath.org/ticket/32069





---

archive/issue_comments_454933.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2021-06-27T23:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454933",
    "user": "mkoeppe"
}
```

Last 10 new commits:



---

archive/issue_comments_454934.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-27T23:23:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454934",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454935.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-06T19:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454935",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454936.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454936",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_454937.json:
```json
{
    "body": "JupyterLab 3.1.0 was released.\n\n- https://github.com/jupyterlab/jupyterlab/releases/tag/v3.1.0",
    "created_at": "2021-07-27T20:58:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454937",
    "user": "slelievre"
}
```

JupyterLab 3.1.0 was released.

- https://github.com/jupyterlab/jupyterlab/releases/tag/v3.1.0



---

archive/issue_comments_454938.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-08-12T05:03:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454938",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-14T01:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454940.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-09-14T01:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454940",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_454941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2021-09-14T01:39:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454941",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_454942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-14T02:05:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454942",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454943.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-14T02:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454943",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454944.json:
```json
{
    "body": "On `debian-bullseye` (https://github.com/mkoeppe/sage/runs/3594020610?check_suite_focus=true)\n\n```\nError:  ==== ERROR IN LOG FILE artifacts/logs-commit-be4c7c8fe60812ff2bb6a0725d9041b2c7687980-tox-docker-debian-bullseye-maximal/logs/pkgs/jupyterlab_widgets-2.0.log ====\n-\ufffd\\\ufffd|\ufffd/\ufffd-\ufffd\\\ufffd|\ufffd/\ufffd-\ufffdAn error occurred.\nValueError: \n\"@jupyter-widgets/jupyterlab-manager@2.0.0\" is not compatible with the current JupyterLab\nConflicting Dependencies:\nJupyterLab                        Extension       Package\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/application\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/logconsole\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/mainmenu\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/notebook\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/rendermime\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/rendermime-interfaces\n>=6.1.11 <6.2.0                   >=5.0.0 <6.0.0  @jupyterlab/services\n>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/settingregistry\nSee the log file for details:  /tmp/jupyterlab-debug-lp7xrnhx.log\nError installing jupyter-widgets extension into jupyterlab ... exiting\n```\n",
    "created_at": "2021-09-17T18:23:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454944",
    "user": "mkoeppe"
}
```

On `debian-bullseye` (https://github.com/mkoeppe/sage/runs/3594020610?check_suite_focus=true)

```
Error:  ==== ERROR IN LOG FILE artifacts/logs-commit-be4c7c8fe60812ff2bb6a0725d9041b2c7687980-tox-docker-debian-bullseye-maximal/logs/pkgs/jupyterlab_widgets-2.0.log ====
-�\�|�/�-�\�|�/�-�An error occurred.
ValueError: 
"@jupyter-widgets/jupyterlab-manager@2.0.0" is not compatible with the current JupyterLab
Conflicting Dependencies:
JupyterLab                        Extension       Package
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/application
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/logconsole
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/mainmenu
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/notebook
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/rendermime
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/rendermime-interfaces
>=6.1.11 <6.2.0                   >=5.0.0 <6.0.0  @jupyterlab/services
>=3.1.11 <3.2.0                   >=2.0.0 <3.0.0  @jupyterlab/settingregistry
See the log file for details:  /tmp/jupyterlab-debug-lp7xrnhx.log
Error installing jupyter-widgets extension into jupyterlab ... exiting
```




---

archive/issue_comments_454945.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-17T18:24:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454945",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454946.json:
```json
{
    "body": "apparently we should aim for version 3.2.4, as my experiment shows.",
    "created_at": "2021-12-04T20:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454946",
    "user": "dimpase"
}
```

apparently we should aim for version 3.2.4, as my experiment shows.



---

archive/issue_comments_454947.json:
```json
{
    "body": "I've just made a few experiments with jupyterlab 3.3.10; it seems to work well with Sage 9.5.\nBasically, here is what I did in a Sage 9.5 root directory on Ubuntu 20.04:\n\n```\n./sage -i install jupyterlab_widgets         # => installed jupyterlab 2.2.10\n./sage -sh\n(sage-sh) pip install --upgrade jupyterlab   # => installed jupyterlab 3.3.10\n(sage-sh) pip install --upgrade jupyterlab_widgets\n(sage-sh) pip install ipympl                 # required for %matplotlib widget\n(sage-sh) exit\n./sage -n jupyterlab\n```\n\nThen jupyterlab 3.3.10 opens in the browser and everything seems to work well. In particular, ``@`interact` works, as well as threejs animations, both tested via https://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_interact.ipynb. The interactive Matplotlib display has been tested with the notebook https://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb, where `%matplotlib notebook` had to be replaced with `%matplotlib widget`, outside the scope of `%display latex`. \n\nIs the issue with Debian bullseye mentioned in comment:18 still there with jupyterlab 3.3 ? Otherwise, what prevents jupyterlab 3.3 to go into Sage 9.6?",
    "created_at": "2022-03-04T23:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454947",
    "user": "egourgoulhon"
}
```

I've just made a few experiments with jupyterlab 3.3.10; it seems to work well with Sage 9.5.
Basically, here is what I did in a Sage 9.5 root directory on Ubuntu 20.04:

```
./sage -i install jupyterlab_widgets         # => installed jupyterlab 2.2.10
./sage -sh
(sage-sh) pip install --upgrade jupyterlab   # => installed jupyterlab 3.3.10
(sage-sh) pip install --upgrade jupyterlab_widgets
(sage-sh) pip install ipympl                 # required for %matplotlib widget
(sage-sh) exit
./sage -n jupyterlab
```

Then jupyterlab 3.3.10 opens in the browser and everything seems to work well. In particular, ``@`interact` works, as well as threejs animations, both tested via https://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_interact.ipynb. The interactive Matplotlib display has been tested with the notebook https://github.com/egourgoulhon/SageMathTest/blob/master/Notebooks/test_display_latex.ipynb, where `%matplotlib notebook` had to be replaced with `%matplotlib widget`, outside the scope of `%display latex`. 

Is the issue with Debian bullseye mentioned in comment:18 still there with jupyterlab 3.3 ? Otherwise, what prevents jupyterlab 3.3 to go into Sage 9.6?



---

archive/issue_comments_454948.json:
```json
{
    "body": "Replying to [comment:26 egourgoulhon]:\n> Is the issue with Debian bullseye mentioned in comment:18 still there with jupyterlab 3.3?\n\nLikely outdated, we'll have to test this.\n\n> Otherwise, what prevents jupyterlab 3.3 to go into Sage 9.6?\n\nNothing really; if this does not require updates of packages that regular ipython/jupyter uses, then this is fine.",
    "created_at": "2022-03-05T00:29:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454948",
    "user": "mkoeppe"
}
```

Replying to [comment:26 egourgoulhon]:
> Is the issue with Debian bullseye mentioned in comment:18 still there with jupyterlab 3.3?

Likely outdated, we'll have to test this.

> Otherwise, what prevents jupyterlab 3.3 to go into Sage 9.6?

Nothing really; if this does not require updates of packages that regular ipython/jupyter uses, then this is fine.



---

archive/issue_comments_454949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-05T00:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454949",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454950.json:
```json
{
    "body": "Here's an attempt to update it (untested)",
    "created_at": "2022-03-05T00:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454950",
    "user": "mkoeppe"
}
```

Here's an attempt to update it (untested)



---

archive/issue_comments_454951.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-05T00:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454951",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454952.json:
```json
{
    "body": "Tested very briefly on macOS, seems to work",
    "created_at": "2022-03-05T00:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454952",
    "user": "mkoeppe"
}
```

Tested very briefly on macOS, seems to work



---

archive/issue_comments_454953.json:
```json
{
    "body": "After pulling the ticket branch in Sage 9.6.beta3 and running make, the command\n\n```\n./sage -i jupyterlab_widgets\n```\n\nfailed, telling that jupyter-packaging-0.11.1.tar.gz is not found on the mirrors:\n\n```\n[jupyter_packaging-0.11.1] Fastest mirror: http://www-ftp.lip6.fr/pub/math/sagemath/\n[jupyter_packaging-0.11.1] http://www-ftp.lip6.fr/pub/math/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz\n[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//www-ftp.lip6.fr/pub/math/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'\n[jupyter_packaging-0.11.1] https://mirror.lyrahosting.com/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz\n[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//mirror.lyrahosting.com/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'\n[jupyter_packaging-0.11.1] http://ftp.rediris.es/mirror/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz\n...\n[jupyter_packaging-0.11.1] sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network\n[jupyter_packaging-0.11.1] ************************************************************************\n[jupyter_packaging-0.11.1] ************************************************************************\n[jupyter_packaging-0.11.1] Error downloading jupyter-packaging-0.11.1.tar.gz\n[jupyter_packaging-0.11.1] ************************************************************************\n[jupyter_packaging-0.11.1] Please email sage-devel (http://groups.google.com/group/sage-devel)\n[jupyter_packaging-0.11.1] explaining the problem and including the log files\n[jupyter_packaging-0.11.1]   /home/eric/sage/9.6.develop/logs/pkgs/jupyter_packaging-0.11.1.log\n[jupyter_packaging-0.11.1] and\n[jupyter_packaging-0.11.1]   /home/eric/sage/9.6.develop/config.log\n[jupyter_packaging-0.11.1] Describe your computer, operating system, etc.\n[jupyter_packaging-0.11.1] ************************************************************************\nmake[2]: *** [Makefile:2765 : jupyter_packaging-SAGE_VENV-no-deps] Erreur 1\nmake[1]: *** [Makefile:2765 : /home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/var/lib/sage/installed/jupyter_packaging-0.11.1] Erreur 2\nmake[1]\u00a0: on quitte le r\u00e9pertoire \u00ab\u00a0/home/eric/sage/9.6.develop/build/make\u00a0\u00bb\n\nreal\t0m40.555s\nuser\t0m0.367s\nsys\t0m0.104s\n***************************************************************\nError building Sage.\n```\n",
    "created_at": "2022-03-05T13:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454953",
    "user": "egourgoulhon"
}
```

After pulling the ticket branch in Sage 9.6.beta3 and running make, the command

```
./sage -i jupyterlab_widgets
```

failed, telling that jupyter-packaging-0.11.1.tar.gz is not found on the mirrors:

```
[jupyter_packaging-0.11.1] Fastest mirror: http://www-ftp.lip6.fr/pub/math/sagemath/
[jupyter_packaging-0.11.1] http://www-ftp.lip6.fr/pub/math/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz
[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//www-ftp.lip6.fr/pub/math/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'
[jupyter_packaging-0.11.1] https://mirror.lyrahosting.com/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz
[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno 404] Not Found: '//mirror.lyrahosting.com/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'
[jupyter_packaging-0.11.1] http://ftp.rediris.es/mirror/sagemath/spkg/upstream/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz
...
[jupyter_packaging-0.11.1] sage_bootstrap.tarball.FileNotMirroredError: tarball does not exist on mirror network
[jupyter_packaging-0.11.1] ************************************************************************
[jupyter_packaging-0.11.1] ************************************************************************
[jupyter_packaging-0.11.1] Error downloading jupyter-packaging-0.11.1.tar.gz
[jupyter_packaging-0.11.1] ************************************************************************
[jupyter_packaging-0.11.1] Please email sage-devel (http://groups.google.com/group/sage-devel)
[jupyter_packaging-0.11.1] explaining the problem and including the log files
[jupyter_packaging-0.11.1]   /home/eric/sage/9.6.develop/logs/pkgs/jupyter_packaging-0.11.1.log
[jupyter_packaging-0.11.1] and
[jupyter_packaging-0.11.1]   /home/eric/sage/9.6.develop/config.log
[jupyter_packaging-0.11.1] Describe your computer, operating system, etc.
[jupyter_packaging-0.11.1] ************************************************************************
make[2]: *** [Makefile:2765 : jupyter_packaging-SAGE_VENV-no-deps] Erreur 1
make[1]: *** [Makefile:2765 : /home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/var/lib/sage/installed/jupyter_packaging-0.11.1] Erreur 2
make[1] : on quitte le répertoire « /home/eric/sage/9.6.develop/build/make »

real	0m40.555s
user	0m0.367s
sys	0m0.104s
***************************************************************
Error building Sage.
```




---

archive/issue_comments_454954.json:
```json
{
    "body": "run\n\n```\n./configure --enable-download-from-upstream-url\n```\n\n\nthen it will be picked up by make etc.\n\nThis is the standard way to review package updates - unless you want to download package tarballs manually.",
    "created_at": "2022-03-05T14:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454954",
    "user": "dimpase"
}
```

run

```
./configure --enable-download-from-upstream-url
```


then it will be picked up by make etc.

This is the standard way to review package updates - unless you want to download package tarballs manually.



---

archive/issue_comments_454955.json:
```json
{
    "body": "Replying to [comment:36 dimpase]:\n> run\n> {{{\n> ./configure --enable-download-from-upstream-url\n> }}}\n> \n> then it will be picked up by make etc.\n> \n\nThanks! I did it, then run make and again `./sage -i jupyterlab_widgets`, but still get the same error...",
    "created_at": "2022-03-05T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454955",
    "user": "egourgoulhon"
}
```

Replying to [comment:36 dimpase]:
> run
> {{{
> ./configure --enable-download-from-upstream-url
> }}}
> 
> then it will be picked up by make etc.
> 

Thanks! I did it, then run make and again `./sage -i jupyterlab_widgets`, but still get the same error...



---

archive/issue_comments_454956.json:
```json
{
    "body": "More precisely, the option `--enable-download-from-upstream-url` is taken into account but the download from upstream fails:\n\n```\n[jupyter_packaging-0.11.1] Attempting to download from https://pypi.io/packages/source/j/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz\n[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno socket error] [Errno socket error] [Errno 404] Not Found: '//files.pythonhosted.org/packages/source/j/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'\n```\n",
    "created_at": "2022-03-05T15:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454956",
    "user": "egourgoulhon"
}
```

More precisely, the option `--enable-download-from-upstream-url` is taken into account but the download from upstream fails:

```
[jupyter_packaging-0.11.1] Attempting to download from https://pypi.io/packages/source/j/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz
[jupyter_packaging-0.11.1] [xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[jupyter_packaging-0.11.1] ERROR [transfer|run:135]: [Errno socket error] [Errno socket error] [Errno socket error] [Errno 404] Not Found: '//files.pythonhosted.org/packages/source/j/jupyter_packaging/jupyter-packaging-0.11.1.tar.gz'
```




---

archive/issue_comments_454957.json:
```json
{
    "body": "Thanks for testing! Looks like the tarball filename pattern has changed, I'll fix it",
    "created_at": "2022-03-05T18:01:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454957",
    "user": "mkoeppe"
}
```

Thanks for testing! Looks like the tarball filename pattern has changed, I'll fix it



---

archive/issue_comments_454958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-05T18:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454958",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454959.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-05T18:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454959",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-05T19:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454961.json:
```json
{
    "body": "Added some more variants.",
    "created_at": "2022-03-05T19:07:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454961",
    "user": "mkoeppe"
}
```

Added some more variants.



---

archive/issue_comments_454962.json:
```json
{
    "body": "Thanks for the update. There is no longer any issue with `jupyter_packaging`, but `./sage -i jupyterlab_widgets` fails now in the build of `ipyml`:\n\n```\n[ipympl-0.8.8] Attempting to download from https://pypi.io/packages/source/i/ipympl/ipympl-0.8.8.tar.gz\n[ipympl-0.8.8] [......................................................................]\n[ipympl-0.8.8] ipympl-0.8.8\n[ipympl-0.8.8] ====================================================\n[ipympl-0.8.8] Setting up build directory for ipympl-0.8.8\n[ipympl-0.8.8] Finished extraction\n[ipympl-0.8.8] No patch files found in ../patches\n[ipympl-0.8.8] ****************************************************\n[ipympl-0.8.8] Host system:\n[ipympl-0.8.8] Linux cartan 5.13.0-30-generic #33~20.04.1-Ubuntu SMP Mon Feb 7 14:25:10 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\n[ipympl-0.8.8] ****************************************************\n[ipympl-0.8.8] C compiler: gcc\n[ipympl-0.8.8] C compiler version:\n[ipympl-0.8.8] Using built-in specs.\n[ipympl-0.8.8] COLLECT_GCC=gcc\n[ipympl-0.8.8] COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper\n[ipympl-0.8.8] OFFLOAD_TARGET_NAMES=nvptx-none:hsa\n[ipympl-0.8.8] OFFLOAD_TARGET_DEFAULT=1\n[ipympl-0.8.8] Target: x86_64-linux-gnu\n[ipympl-0.8.8] Configured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-17ubuntu1~20.04' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-9-HskZEa/gcc-9-9.3.0/debian/tmp-nvptx/usr,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu\n[ipympl-0.8.8] Thread model: posix\n[ipympl-0.8.8] gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) \n[ipympl-0.8.8] ****************************************************\n[ipympl-0.8.8] Package 'ipympl' is currently not installed\n[ipympl-0.8.8] No legacy uninstaller found for 'ipympl'; nothing to do\n[ipympl-0.8.8] Installing ipympl-0.8.8\n[ipympl-0.8.8] Processing /home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/ipympl-0.8.8/src\n[ipympl-0.8.8]   Preparing metadata (pyproject.toml): started\n[ipympl-0.8.8]   Running command Preparing metadata (pyproject.toml)\n[ipympl-0.8.8]   Traceback (most recent call last):\n[ipympl-0.8.8]     File \"/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 363, in <module>\n[ipympl-0.8.8]       main()\n[ipympl-0.8.8]     File \"/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 345, in main\n[ipympl-0.8.8]       json_out['return_val'] = hook(**hook_input['kwargs'])\n[ipympl-0.8.8]     File \"/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py\", line 164, in prepare_metadata_for_build_wheel\n[ipympl-0.8.8]       return hook(metadata_directory, config_settings)\n[ipympl-0.8.8]     File \"/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/build_meta.py\", line 174, in prepare_metadata_for_build_wheel\n[ipympl-0.8.8]       self.run_setup()\n[ipympl-0.8.8]     File \"/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/build_meta.py\", line 158, in run_setup\n[ipympl-0.8.8]       exec(compile(code, __file__, 'exec'), locals())\n[ipympl-0.8.8]     File \"setup.py\", line 41, in <module>\n[ipympl-0.8.8]       cmdclass = create_cmdclass('jsdeps', data_files_spec=data_files_spec)\n[ipympl-0.8.8]   TypeError: 'NoneType' object is not callable\n[ipympl-0.8.8]   error: subprocess-exited-with-error\n```\n",
    "created_at": "2022-03-05T20:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454962",
    "user": "egourgoulhon"
}
```

Thanks for the update. There is no longer any issue with `jupyter_packaging`, but `./sage -i jupyterlab_widgets` fails now in the build of `ipyml`:

```
[ipympl-0.8.8] Attempting to download from https://pypi.io/packages/source/i/ipympl/ipympl-0.8.8.tar.gz
[ipympl-0.8.8] [......................................................................]
[ipympl-0.8.8] ipympl-0.8.8
[ipympl-0.8.8] ====================================================
[ipympl-0.8.8] Setting up build directory for ipympl-0.8.8
[ipympl-0.8.8] Finished extraction
[ipympl-0.8.8] No patch files found in ../patches
[ipympl-0.8.8] ****************************************************
[ipympl-0.8.8] Host system:
[ipympl-0.8.8] Linux cartan 5.13.0-30-generic #33~20.04.1-Ubuntu SMP Mon Feb 7 14:25:10 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux
[ipympl-0.8.8] ****************************************************
[ipympl-0.8.8] C compiler: gcc
[ipympl-0.8.8] C compiler version:
[ipympl-0.8.8] Using built-in specs.
[ipympl-0.8.8] COLLECT_GCC=gcc
[ipympl-0.8.8] COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/9/lto-wrapper
[ipympl-0.8.8] OFFLOAD_TARGET_NAMES=nvptx-none:hsa
[ipympl-0.8.8] OFFLOAD_TARGET_DEFAULT=1
[ipympl-0.8.8] Target: x86_64-linux-gnu
[ipympl-0.8.8] Configured with: ../src/configure -v --with-pkgversion='Ubuntu 9.3.0-17ubuntu1~20.04' --with-bugurl=file:///usr/share/doc/gcc-9/README.Bugs --enable-languages=c,ada,c++,go,brig,d,fortran,objc,obj-c++,gm2 --prefix=/usr --with-gcc-major-version-only --program-suffix=-9 --program-prefix=x86_64-linux-gnu- --enable-shared --enable-linker-build-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --libdir=/usr/lib --enable-nls --enable-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --with-default-libstdcxx-abi=new --enable-gnu-unique-object --disable-vtable-verify --enable-plugin --enable-default-pie --with-system-zlib --with-target-system-zlib=auto --enable-objc-gc=auto --enable-multiarch --disable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enable-multilib --with-tune=generic --enable-offload-targets=nvptx-none=/build/gcc-9-HskZEa/gcc-9-9.3.0/debian/tmp-nvptx/usr,hsa --without-cuda-driver --enable-checking=release --build=x86_64-linux-gnu --host=x86_64-linux-gnu --target=x86_64-linux-gnu
[ipympl-0.8.8] Thread model: posix
[ipympl-0.8.8] gcc version 9.3.0 (Ubuntu 9.3.0-17ubuntu1~20.04) 
[ipympl-0.8.8] ****************************************************
[ipympl-0.8.8] Package 'ipympl' is currently not installed
[ipympl-0.8.8] No legacy uninstaller found for 'ipympl'; nothing to do
[ipympl-0.8.8] Installing ipympl-0.8.8
[ipympl-0.8.8] Processing /home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/ipympl-0.8.8/src
[ipympl-0.8.8]   Preparing metadata (pyproject.toml): started
[ipympl-0.8.8]   Running command Preparing metadata (pyproject.toml)
[ipympl-0.8.8]   Traceback (most recent call last):
[ipympl-0.8.8]     File "/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 363, in <module>
[ipympl-0.8.8]       main()
[ipympl-0.8.8]     File "/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 345, in main
[ipympl-0.8.8]       json_out['return_val'] = hook(**hook_input['kwargs'])
[ipympl-0.8.8]     File "/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip/_vendor/pep517/in_process/_in_process.py", line 164, in prepare_metadata_for_build_wheel
[ipympl-0.8.8]       return hook(metadata_directory, config_settings)
[ipympl-0.8.8]     File "/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/build_meta.py", line 174, in prepare_metadata_for_build_wheel
[ipympl-0.8.8]       self.run_setup()
[ipympl-0.8.8]     File "/home/eric/sage/9.6.develop/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/setuptools/build_meta.py", line 158, in run_setup
[ipympl-0.8.8]       exec(compile(code, __file__, 'exec'), locals())
[ipympl-0.8.8]     File "setup.py", line 41, in <module>
[ipympl-0.8.8]       cmdclass = create_cmdclass('jsdeps', data_files_spec=data_files_spec)
[ipympl-0.8.8]   TypeError: 'NoneType' object is not callable
[ipympl-0.8.8]   error: subprocess-exited-with-error
```




---

archive/issue_comments_454963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-05T21:57:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454964.json:
```json
{
    "body": "Thanks for testing! Here's a new version",
    "created_at": "2022-03-05T21:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454964",
    "user": "mkoeppe"
}
```

Thanks for testing! Here's a new version



---

archive/issue_comments_454965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-03-05T22:01:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454965",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454966.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-05T22:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454966",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454967.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-03-05T22:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454967",
    "user": "mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-05T22:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454968",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-03-05T22:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454969",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_454970.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-03-05T22:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454970",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454971.json:
```json
{
    "body": "Works like a charm now. Thank you!\nI've also tested the new notebook interfaces `nbclassic` and `retrolab`. Thanks for having added them!",
    "created_at": "2022-03-06T10:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454971",
    "user": "egourgoulhon"
}
```

Works like a charm now. Thank you!
I've also tested the new notebook interfaces `nbclassic` and `retrolab`. Thanks for having added them!



---

archive/issue_comments_454972.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-06T10:05:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454972",
    "user": "egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_454973.json:
```json
{
    "body": "The issue of `%matplotlib widget` being inoperative within the scope of `%display latex` is tracked in #33469. This is not specific to jupyterlab: it also happens with jupyter.",
    "created_at": "2022-03-06T10:36:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454973",
    "user": "egourgoulhon"
}
```

The issue of `%matplotlib widget` being inoperative within the scope of `%display latex` is tracked in #33469. This is not specific to jupyterlab: it also happens with jupyter.



---

archive/issue_comments_454974.json:
```json
{
    "body": "Changing keywords from \"\" to \"jupyterlab\".",
    "created_at": "2022-03-06T10:50:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454974",
    "user": "egourgoulhon"
}
```

Changing keywords from "" to "jupyterlab".



---

archive/issue_comments_454975.json:
```json
{
    "body": "Thanks for testing!",
    "created_at": "2022-03-06T16:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454975",
    "user": "mkoeppe"
}
```

Thanks for testing!



---

archive/issue_comments_454976.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-09T23:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31832",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31832#issuecomment-454976",
    "user": "vbraun"
}
```

Resolution: fixed
