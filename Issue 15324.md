# Issue 15324: freetype 2.3.5 is too old for some fonts

archive/issues_015324.json:
```json
{
    "body": "Keywords: r-project graphics interfaces\n\nThe now-current freetype library has problems with newer fonts. This forbids its uses in some applications on machines having system fonts not supported by this version.\n\nThis was diagnosed on sage's R (see [this thread](https://groups.google.com/forum/#!topic/sage-support/FnTEcpfg6wE)) by Volker Braun.\n\nA stopgap measure would be to upgrade freetype to a more forgiving version of freetype, hence this ticket.\n\nIssue created by migration from https://trac.sagemath.org/ticket/15561\n\n",
    "created_at": "2013-12-21T07:49:59Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.1",
    "title": "freetype 2.3.5 is too old for some fonts",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15324",
    "user": "@EmmanuelCharpentier"
}
```
Keywords: r-project graphics interfaces

The now-current freetype library has problems with newer fonts. This forbids its uses in some applications on machines having system fonts not supported by this version.

This was diagnosed on sage's R (see [this thread](https://groups.google.com/forum/#!topic/sage-support/FnTEcpfg6wE)) by Volker Braun.

A stopgap measure would be to upgrade freetype to a more forgiving version of freetype, hence this ticket.

Issue created by migration from https://trac.sagemath.org/ticket/15561





---

archive/issue_comments_197230.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-12-21T15:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197230",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_197231.json:
```json
{
    "body": "freetype 2.5.2 installs flawlessly IFF libpng12 is patched to avoid a test for setting up error catching via setjmp in libpng12 (which freetype 2.5.2 does anyway).\n\nThe resulting sage passes make ptestlong and is able to draw a curve (from sage -R in console). So I think that this ticket is ready for review.\n\nSince it installs a newer version of a standard package and paches another onte, I think that it should be reviewed on various system (at least Mac OS X and/or Cygwin, which seem to be the most difficult cases) before clearing it.",
    "created_at": "2013-12-21T15:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197231",
    "user": "@EmmanuelCharpentier"
}
```

freetype 2.5.2 installs flawlessly IFF libpng12 is patched to avoid a test for setting up error catching via setjmp in libpng12 (which freetype 2.5.2 does anyway).

The resulting sage passes make ptestlong and is able to draw a curve (from sage -R in console). So I think that this ticket is ready for review.

Since it installs a newer version of a standard package and paches another onte, I think that it should be reviewed on various system (at least Mac OS X and/or Cygwin, which seem to be the most difficult cases) before clearing it.



---

archive/issue_comments_197232.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2013-12-22T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197232",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_197233.json:
```json
{
    "body": "I have two problems with this branch :\n\n1) I seem to be unable to get this code back on an sage tree on another machine :\n\n\n```\nsage -dev checkout --ticket 15561\nsage -dev diff\n```\n\ngives me an empty diff...\n\n2) I added a new freetype tarball in upstream and deleted the previous one. None of this appears in the branch, at least as displayed on the trac page.\n\nI'll have to beg some help on sage-support...",
    "created_at": "2013-12-22T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197233",
    "user": "@EmmanuelCharpentier"
}
```

I have two problems with this branch :

1) I seem to be unable to get this code back on an sage tree on another machine :


```
sage -dev checkout --ticket 15561
sage -dev diff
```

gives me an empty diff...

2) I added a new freetype tarball in upstream and deleted the previous one. None of this appears in the branch, at least as displayed on the trac page.

I'll have to beg some help on sage-support...



---

archive/issue_comments_197234.json:
```json
{
    "body": "Attachment [freetype-2.5.2.tar.bz2](tarball://root/attachments/some-uuid/ticket15561/freetype-2.5.2.tar.bz2) by @EmmanuelCharpentier created at 2013-12-22 13:15:09\n\nsource tarball of the new versioj of freetype",
    "created_at": "2013-12-22T13:15:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197234",
    "user": "@EmmanuelCharpentier"
}
```

Attachment [freetype-2.5.2.tar.bz2](tarball://root/attachments/some-uuid/ticket15561/freetype-2.5.2.tar.bz2) by @EmmanuelCharpentier created at 2013-12-22 13:15:09

source tarball of the new versioj of freetype



---

archive/issue_comments_197235.json:
```json
{
    "body": "This branch requires the [tarball](http://download.savannah.gnu.org/releases/freetype/freetype-2.5.2.tar.bz2)\u00a0of the new version of freetype, which is also attached to this ticket.",
    "created_at": "2013-12-22T13:18:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197235",
    "user": "@EmmanuelCharpentier"
}
```

This branch requires the [tarball](http://download.savannah.gnu.org/releases/freetype/freetype-2.5.2.tar.bz2) of the new version of freetype, which is also attached to this ticket.



---

archive/issue_comments_197236.json:
```json
{
    "body": "Okay, I am satisfied that my push ***was*** successful, and that the ansence of the new upstream tarball was intended. So I'm putting it up for review again.",
    "created_at": "2013-12-22T15:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197236",
    "user": "@EmmanuelCharpentier"
}
```

Okay, I am satisfied that my push ***was*** successful, and that the ansence of the new upstream tarball was intended. So I'm putting it up for review again.



---

archive/issue_comments_197237.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-22T15:33:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197237",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197238.json:
```json
{
    "body": "Okay, I am satisfied that my push ***was*** successful, and that the ansence of the new upstream tarball was intended. So I'm putting it up for review again.",
    "created_at": "2013-12-22T15:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197238",
    "user": "@EmmanuelCharpentier"
}
```

Okay, I am satisfied that my push ***was*** successful, and that the ansence of the new upstream tarball was intended. So I'm putting it up for review again.



---

archive/issue_comments_197239.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-12-23T12:16:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197239",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_197240.json:
```json
{
    "body": "Breaks PIL, so I'm setting #15539 as dep",
    "created_at": "2013-12-23T15:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197240",
    "user": "@vbraun"
}
```

Breaks PIL, so I'm setting #15539 as dep



---

archive/issue_comments_197241.json:
```json
{
    "body": "Build errors:\n* http://build.sagemath.org/sage/builders/%20%20fast%20UW%20redhawk%20%28Ubuntu%2010.04%20x86_64%29%20incremental/builds/27/steps/compile/logs/freetype\n* http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26/steps/compile/logs/freetype",
    "created_at": "2013-12-23T15:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197241",
    "user": "@vbraun"
}
```

Build errors:
* http://build.sagemath.org/sage/builders/%20%20fast%20UW%20redhawk%20%28Ubuntu%2010.04%20x86_64%29%20incremental/builds/27/steps/compile/logs/freetype
* http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26/steps/compile/logs/freetype



---

archive/issue_comments_197242.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2013-12-23T15:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197242",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_197243.json:
```json
{
    "body": "Replying to [comment:10 vbraun]:\n\n> Build errors: * http://build.sagemath.org/sage/builders/%20%20fast%20UW%20redhawk%20%28Ubuntu%2010.04%20x86_64%29%20incremental/builds/27/steps/compile/logs/freetype * http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26/steps/compile/logs/freetype\n\nAhiii ! That's the snag in libpng that triggered me to patch pngconf.h. How can i check that this patch has been applied ? This error (horror ?) originates in a code section that I #defined around...\n\nEdit, Dec 25 : I see *another* build problem with PIL and freetype. but I could diagnose it only by creating a new sage tree and git'ing !#15661 directly : adding #15561 to an already compiled tree does not force recompilation of PIL.\n\nThe problem :\u00a0\n\n\n```\n[ ... ]\n\ngcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/charpent/sagebis/sage/local/include/freetype2 -IlibImaging -I/home/charpent/sagebis/sage/local/include -I/usr/include -I/home/charpent/sagebis/sage/local/include/python2.7 -c _imagingft.c -o build/temp.linux-x86_64-2.7/_imagingft.o\n_imagingft.c:68:31: fatal error: freetype/fterrors.h: Aucun fichier ou dossier de ce type\n\u00a0#include <freetype/fterrors.h>\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0 ^\ncompilation terminated.\nerror: command 'gcc' failed with exit status 1\n\n[ ... ]\n```\n\nThis happens twice (PIL attemps compilation with and without Tkinter support). This is caused by the fact that the directory containing freetype headers is no longer local/include/freetype but local/include/freetype2.\n\nSince Pillow is now accepted in the next sage, my plan is :\n\n* start a new tree\n* fetch the Pillow branch (for rebase ?)\n* fetch !#15561 and adjust it.\n\nYour thoughts ?",
    "created_at": "2013-12-23T18:29:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197243",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:10 vbraun]:

> Build errors: * http://build.sagemath.org/sage/builders/%20%20fast%20UW%20redhawk%20%28Ubuntu%2010.04%20x86_64%29%20incremental/builds/27/steps/compile/logs/freetype * http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26/steps/compile/logs/freetype

Ahiii ! That's the snag in libpng that triggered me to patch pngconf.h. How can i check that this patch has been applied ? This error (horror ?) originates in a code section that I #defined around...

Edit, Dec 25 : I see *another* build problem with PIL and freetype. but I could diagnose it only by creating a new sage tree and git'ing !#15661 directly : adding #15561 to an already compiled tree does not force recompilation of PIL.

The problem : 


```
[ ... ]

gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -fPIC -I/home/charpent/sagebis/sage/local/include/freetype2 -IlibImaging -I/home/charpent/sagebis/sage/local/include -I/usr/include -I/home/charpent/sagebis/sage/local/include/python2.7 -c _imagingft.c -o build/temp.linux-x86_64-2.7/_imagingft.o
_imagingft.c:68:31: fatal error: freetype/fterrors.h: Aucun fichier ou dossier de ce type
 #include <freetype/fterrors.h>
                               ^
compilation terminated.
error: command 'gcc' failed with exit status 1

[ ... ]
```

This happens twice (PIL attemps compilation with and without Tkinter support). This is caused by the fact that the directory containing freetype headers is no longer local/include/freetype but local/include/freetype2.

Since Pillow is now accepted in the next sage, my plan is :

* start a new tree
* fetch the Pillow branch (for rebase ?)
* fetch !#15561 and adjust it.

Your thoughts ?



---

archive/issue_comments_197244.json:
```json
{
    "body": "Another question : should I merge #15539 and #15561 (and test with Pillow instead of PIL) ?",
    "created_at": "2013-12-23T18:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197244",
    "user": "@EmmanuelCharpentier"
}
```

Another question : should I merge #15539 and #15561 (and test with Pillow instead of PIL) ?



---

archive/issue_comments_197245.json:
```json
{
    "body": "You should merge in the Pillow ticket, but its not ready yet (i.e. doesn't build).",
    "created_at": "2013-12-23T20:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197245",
    "user": "@vbraun"
}
```

You should merge in the Pillow ticket, but its not ready yet (i.e. doesn't build).



---

archive/issue_comments_197246.json:
```json
{
    "body": "You need to bump the libpng patchlevel to force a rebuild (libpng/package-version.txt). Otherwise it won't be built.",
    "created_at": "2013-12-23T22:54:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197246",
    "user": "@vbraun"
}
```

You need to bump the libpng patchlevel to force a rebuild (libpng/package-version.txt). Otherwise it won't be built.



---

archive/issue_comments_197247.json:
```json
{
    "body": "Replying to [comment:14 vbraun]:\n\n> You need to bump the libpng patchlevel to force a rebuild (libpng/package-version.txt). Otherwise it won't be built.\n\nThis I do not understand : #15561 ***does*** bump libpng (from 1.2.35.p5 to 1.2.25p6) and freetype (from 2.3.5.p4 to 2.5.2.p0) ; #15539 does ***not*** touch libpng nor freetype (it *uses* them ***as is***). Is there another proposed branch that bumps libpng ? If so, how can I find it ?",
    "created_at": "2013-12-25T09:15:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197247",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:14 vbraun]:

> You need to bump the libpng patchlevel to force a rebuild (libpng/package-version.txt). Otherwise it won't be built.

This I do not understand : #15561 ***does*** bump libpng (from 1.2.35.p5 to 1.2.25p6) and freetype (from 2.3.5.p4 to 2.5.2.p0) ; #15539 does ***not*** touch libpng nor freetype (it *uses* them ***as is***). Is there another proposed branch that bumps libpng ? If so, how can I find it ?



---

archive/issue_comments_197248.json:
```json
{
    "body": "Replying to [comment:13 vbraun]:\n\n> You should merge in the Pillow ticket, but its not ready yet (i.e. doesn't build).\n\nWould that be a merge (i. e. creating a branch incorporating changes both from #15539 an #15561) or a rebase (i. e. creating a patch that *assumes* that #15539 has been incorporated) ?\n\nNow that 15539 is closed as \"fixed\", rebasing sounds logical. What do you advise ?",
    "created_at": "2013-12-25T09:19:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197248",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:13 vbraun]:

> You should merge in the Pillow ticket, but its not ready yet (i.e. doesn't build).

Would that be a merge (i. e. creating a branch incorporating changes both from #15539 an #15561) or a rebase (i. e. creating a patch that *assumes* that #15539 has been incorporated) ?

Now that 15539 is closed as "fixed", rebasing sounds logical. What do you advise ?



---

archive/issue_comments_197249.json:
```json
{
    "body": "You should always merge (and never rebase) branches that are already published on trac, since somebody else might have used that already as a base for their own branch.\n\nHere is the full buildbot log: http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26\n\nIt did compile libpng-1.2.35.p6, so thats your ticket.",
    "created_at": "2013-12-25T13:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197249",
    "user": "@vbraun"
}
```

You should always merge (and never rebase) branches that are already published on trac, since somebody else might have used that already as a base for their own branch.

Here is the full buildbot log: http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26

It did compile libpng-1.2.35.p6, so thats your ticket.



---

archive/issue_comments_197250.json:
```json
{
    "body": "Replying to [comment:17 vbraun]:\n\n> You should always merge (and never rebase) branches that are already published on trac, since somebody else might have used that already as a base for their own branch. \n\nOkay. Can't say I fully understand it yet, but I did that.\n\n> Here is the full buildbot log: http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26 It did compile libpng-1.2.35.p6, so thats your ticket.\n\nIndeed ! Don't understand it either. I just restarted a clean tree, used git (not sage's scripts) to fetch Pillow and #15561 in separate local branches, merged Pillow in 15561 and compiled (successfully).\n\nIn the full buildbot log, the error points at pngconf.h line 328. That's the place where the error takes places while using the *unpatched* pngconf.h ; with the patched pngconf.h, the error should take place on line 334.\n\nIs it possible that buildbot's freetype compilation might pickup an unpatched (possibly system's) pngconf.h ? If so, how to prevent this from happening ?",
    "created_at": "2013-12-25T19:54:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197250",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:17 vbraun]:

> You should always merge (and never rebase) branches that are already published on trac, since somebody else might have used that already as a base for their own branch. 

Okay. Can't say I fully understand it yet, but I did that.

> Here is the full buildbot log: http://build.sagemath.org/sage/builders/%20%20fast%20UW%20mod%20%28Ubuntu%208.04%20x86_64%29%20incremental/builds/26 It did compile libpng-1.2.35.p6, so thats your ticket.

Indeed ! Don't understand it either. I just restarted a clean tree, used git (not sage's scripts) to fetch Pillow and #15561 in separate local branches, merged Pillow in 15561 and compiled (successfully).

In the full buildbot log, the error points at pngconf.h line 328. That's the place where the error takes places while using the *unpatched* pngconf.h ; with the patched pngconf.h, the error should take place on line 334.

Is it possible that buildbot's freetype compilation might pickup an unpatched (possibly system's) pngconf.h ? If so, how to prevent this from happening ?



---

archive/issue_comments_197251.json:
```json
{
    "body": "Looking at build/deps, the freetype package does not depend on libpng so will potentially build at the same time. Might be a race condition.",
    "created_at": "2013-12-25T19:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197251",
    "user": "@vbraun"
}
```

Looking at build/deps, the freetype package does not depend on libpng so will potentially build at the same time. Might be a race condition.



---

archive/issue_comments_197252.json:
```json
{
    "body": "Replying to [comment:19 vbraun]:\n\n> Looking at build/deps, the freetype package does not depend on libpng so will potentially build at the same time. Might be a race condition.\n\nOuch ! Freetype depends on libpng, but libpng needs to be patched *first*, which means it can't be patched by freetype's branch, if I understand that correctly. The only way out I see is :\n\n1. create a new branch patching libpng in a ticket #xx\n2. wait for #xx to get reviewed and getting to state \"fixed\", and\n3. modify #15561 to depend on #xx.\n\nI don't see how this can be made in one ticket. Do you have different thoughts ?",
    "created_at": "2013-12-25T20:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197252",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:19 vbraun]:

> Looking at build/deps, the freetype package does not depend on libpng so will potentially build at the same time. Might be a race condition.

Ouch ! Freetype depends on libpng, but libpng needs to be patched *first*, which means it can't be patched by freetype's branch, if I understand that correctly. The only way out I see is :

1. create a new branch patching libpng in a ticket #xx
2. wait for #xx to get reviewed and getting to state "fixed", and
3. modify #15561 to depend on #xx.

I don't see how this can be made in one ticket. Do you have different thoughts ?



---

archive/issue_comments_197253.json:
```json
{
    "body": "No, you can do everything in your current branch.",
    "created_at": "2013-12-25T20:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197253",
    "user": "@vbraun"
}
```

No, you can do everything in your current branch.



---

archive/issue_comments_197254.json:
```json
{
    "body": "Replying to [comment:21 vbraun]:\n\n> No, you can do everything in your current branch.\n\nI don't see how to. Care to enlighten the dummy of the day ?",
    "created_at": "2013-12-25T20:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197254",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:21 vbraun]:

> No, you can do everything in your current branch.

I don't see how to. Care to enlighten the dummy of the day ?



---

archive/issue_comments_197255.json:
```json
{
    "body": "If that race is actually the problem then you only have to add the dependency to `build/deps`. Then libpng will be built first (and patched as part of its build process), and then freetype will be built afterward. I think I'm missing the problem here, but in any case that should work (TM).",
    "created_at": "2013-12-25T20:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197255",
    "user": "@vbraun"
}
```

If that race is actually the problem then you only have to add the dependency to `build/deps`. Then libpng will be built first (and patched as part of its build process), and then freetype will be built afterward. I think I'm missing the problem here, but in any case that should work (TM).



---

archive/issue_comments_197256.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2013-12-25T21:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197256",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_197257.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2013-12-25T21:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197257",
    "user": "@EmmanuelCharpentier"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_197258.json:
```json
{
    "body": "Replying to [comment:23 vbraun]:\n\n> If that race is actually the problem then you only have to add the dependency to `build/deps` . Then libpng will be built first (and patched as part of its build process), and then freetype will be built afterward. I think I'm missing the problem here, but in any case that should work (TM).\n\nOkay. I did that, pushed the commit and updated status to \"needs review\". I'm curious about the buildbot's behaviour...\n\nEdit, a bit later : the resulting tree passes the '(make distclean ; make )' test in an enviroment where MAKE is \"make -j8\". So it *can* be built in a parallel setting.",
    "created_at": "2013-12-25T21:34:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197258",
    "user": "@EmmanuelCharpentier"
}
```

Replying to [comment:23 vbraun]:

> If that race is actually the problem then you only have to add the dependency to `build/deps` . Then libpng will be built first (and patched as part of its build process), and then freetype will be built afterward. I think I'm missing the problem here, but in any case that should work (TM).

Okay. I did that, pushed the commit and updated status to "needs review". I'm curious about the buildbot's behaviour...

Edit, a bit later : the resulting tree passes the '(make distclean ; make )' test in an enviroment where MAKE is "make -j8". So it *can* be built in a parallel setting.



---

archive/issue_comments_197259.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-27T14:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15324",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15324#issuecomment-197259",
    "user": "@vbraun"
}
```

Resolution: fixed
