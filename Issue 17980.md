# Issue 17980: Various Cython code fixes

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-04-16 08:20:24

CC:  jpflori

Some improvements to Cython code in Sage. This ticket together with #17890 should fix all Cythonize warnings except `referenced before assignment`.


---

Comment by jdemeyer created at 2015-04-16 09:52:55

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-04-16 09:52:55

New commits:


---

Comment by tscrim created at 2015-04-19 17:25:00

I don't quite understand this change:

```diff
`@``@` -43,7 +40,6 `@``@` cdef int c_sage_inputhook() nogil except *:
         with gil:
             sage_inputhook()
             sig_check()
-    return 0
 
 def install():
     """
```

Doesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?


---

Comment by jdemeyer created at 2015-04-20 16:59:23

Replying to [comment:6 tscrim]:
> I don't quite understand this change:
> {{{#!diff
> -    return 0
> }}}
> Doesn't the `c_sage_inputhook` function need to return an integer (and be `0` indicating no error)?

When a Python function always returns `None`, you usually don't put an explicit `return None` at the end either. This function _always_ returns 0, so why write it explicitly? The only reason why the return value is `int` is for exception handling. Mentally, this function should really be `void c_sage_inputhook()`.

Side comment: I once asked Cython upstream to include a new type for situations like these (`vint` would be a good name, for `void + int`, analogous to `bint` for `bool + int`), but they didn't like that.


---

Comment by chapoton created at 2015-04-21 19:43:29

Ok ; I do not feel very competent here. Nevertheless, I have looked at the changes,
and they look reasonable and innocent enough.

Given that the patchbot has given a green light, I would be ready to propose a positive
review. But maybe you would like a more serious review ?


---

Comment by jdemeyer created at 2015-04-21 19:47:57

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-04-21 19:47:57

Replying to [comment:8 chapoton]:
> But maybe you would like a more serious review ?
To be honest, I also think the code looks good (I am the author after all). So I'm interpreting your comment as "positive_review".


---

Comment by vbraun created at 2015-04-22 03:22:14

Resolution: fixed
