# Issue 33504: why sage returns different output from giac?

Issue created by migration from https://trac.sagemath.org/ticket/33741

Original creator: @nasser1

Original creation time: 2022-04-21 17:08:11

Keywords: giac intergate

reference

https://ask.sagemath.org/question/62079/why-sage-returns-different-output-from-giac/

I've build from source sagemath 9.6 rc1, also newest maxima 5.46 and giac 1.9.0  https://www-fourier.ujf-grenoble.fr/~parisse/giac.html

Then made symlink from sagemath to use the updated giac 1.9 instead of the older 1.7 it ships with.  Same with maxima.

I've run some tests, and everything is working fine. But for some problems, sagemath returns different output and takes much much longer than expected.

Why is that?

I am using sagemath [SageMath](SageMath) version 9.6.rc1, with latest giac 1.9.0.

Here is an example



```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.6.rc1, Release Date: 2022-04-19                 │
│ Using Python 3.10.4. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: var('x')
x
sage: integrate((x^2-1)/(1+x)^(1/2)/(x^2+1)/(1+(1+x)^(1/2))^(1/2)/(1+(1+(1+x)^(1/2))^(1/2))^(1/2),x, algorithm="giac")
integrate((x^2 - 1)/((x^2 + 1)*sqrt(x + 1)*sqrt(sqrt(x + 1) + 1)*sqrt(sqrt(sqrt(x + 1) + 1) + 1)), x)

sage:  print(giac.version())
"giac 1.9.0, (c) B. Parisse and R. De Graeve, Institut Fourier, Universite de Grenoble I"

```


Notice that the result returned above is the input. But when I call giac directly using same integrand, it gives



```
>giac
// Maximum number of parallel threads 24
Added 0 synonyms
Welcome to giac readline interface, version 1.9.0
(c) 2001,2021 B. Parisse & others
Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
Released under the GPL license 3.0 or above
See http://www.gnu.org for license details
May contain BSD licensed software parts (lapack, atlas, tinymt)
-------------------------------------------------
Press CTRL and D simultaneously to finish session
Type ?commandname for help
0>>  integrate((x^2-1)/(1+x)^(1/2)/(x^2+1)/(1+(1+x)^(1/2))^(1/2)/(1+(1+(1+x)^(1/2))^(1/2))^(1/2),x)
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(4*x+1)]
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(4*t_nostep^4-8*t_nostep^2+1)]
Discontinuities at zeroes of 4*t_nostep^4-8*t_nostep^2+1 were not checked
-8*sqrt(sqrt(sqrt(x+1)+1)+1)+integrate(-2/(sqrt(x+1)*sqrt(sqrt(x+1)+1)*sqrt(sqrt(sqrt(x+1)+1)+1)*((sqrt(sqrt(x+1)+1)+1)^8-8*(sqrt(sqrt(x+1)+1)+1)^7+24*(sqrt(sqrt(x+1)+1)+1)^6-32*(sqrt(sqrt(x+1)+1)+1)^5+14*(sqrt(sqrt(x+1)+1)+1)^4+8*(sqrt(sqrt(x+1)+1)+1)^3-8*(sqrt(sqrt(x+1)+1)+1)^2+2)),x)
// Time 0.25
1>>

```


Not only that, calling giac directly returns the result instantly. But using sagemath, I had to wait for more than 10 minutes for the result.

I build giac from source as well as sagemath. All on Linux Ubuntu.

Is this a bug? Or is it possible that sagemath now checks if the result returned back has "integrate" still in it, and in this case it echo back the original input instead of what was actually returned by the external CAS?

To be able to reproduce this, giac 1.9 has to be used.



```
>which giac
/usr/local/bin/giac
>giac --version
// Maximum number of parallel threads 24
// (c) 2001, 2021 B. Parisse & others
1.9.0
>
>cd $SAGE_ROOT
>cd local/bin
>ls -lrt giac
lrwxrwxrwx 1 me me 19 Apr 20 04:55 giac -> /usr/local/bin/giac
>

```







---

Comment by jhpalmieri created at 2022-04-21 17:56:34

This might be fixed by #31563.


---

Comment by mkoeppe created at 2022-07-09 21:20:03

Replying to [ticket:33741 gh-nasser1]:
> Not only that, calling giac directly returns the result instantly. But using sagemath, I had to wait for more than 10 minutes for the result.

Using `algorithm='libgiac'`, Sage also returns the result immediately

```
sage: integrate((x^2-1)/(1+x)^(1/2)/(x^2+1)/(1+(1+x)^(1/2))^(1/2)/(1+(1+(1+x)^(1/2))^(1/2))^(1/2),x, algorithm="libgiac")
Added 0 synonyms
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(4*sageVARx+1)]
Warning, integration of abs or sign assumes constant sign by intervals (correct if the argument is real):
Check [abs(4*t_nostep^4-8*t_nostep^2+1)]
Discontinuities at zeroes of 4*t_nostep^4-8*t_nostep^2+1 were not checked
integrate((x^2 - 1)/((x^2 + 1)*sqrt(x + 1)*sqrt(sqrt(x + 1) + 1)*sqrt(sqrt(sqrt(x + 1) + 1) + 1)), x)
```



---

Comment by @DaveWitteMorris created at 2022-07-10 05:52:16

Duplicate of #31563.


---

Comment by @DaveWitteMorris created at 2022-07-10 05:52:16

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2022-07-11 03:48:59

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-08-02 06:31:03

Resolution: invalid
