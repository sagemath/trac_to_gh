# Issue 10205: Various issues in find_hamiltonian

archive/issues_010205.json:
```json
{
    "body": "Assignee: jason, ncohen, rlm\n\nCC:  fidelbarrera rlm boothby ncohen mvngu pelegm jmantysalo\n\n1.\n\n```\nsage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh\nsage: G = graphs.CompleteGraph(1); fh(G)\nTraceback (most recent call last):\n...\nValueError: empty range for randrange() (0,0, 0)\n```\n\n\n2.\n\n```\nsage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh\nsage: G = graphs.CompleteGraph(2); fh(G)\n[ Sage just hangs... ]\n```\n\n\n3. Why is there a `G.hamiltonian_cycle()` member function but not `G.hamiltonian_path()`?\n\nIssue created by migration from https://trac.sagemath.org/ticket/10206\n\n",
    "created_at": "2010-11-02T20:42:54Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "Various issues in find_hamiltonian",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10205",
    "user": "jdemeyer"
}
```
Assignee: jason, ncohen, rlm

CC:  fidelbarrera rlm boothby ncohen mvngu pelegm jmantysalo

1.

```
sage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh
sage: G = graphs.CompleteGraph(1); fh(G)
Traceback (most recent call last):
...
ValueError: empty range for randrange() (0,0, 0)
```


2.

```
sage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh
sage: G = graphs.CompleteGraph(2); fh(G)
[ Sage just hangs... ]
```


3. Why is there a `G.hamiltonian_cycle()` member function but not `G.hamiltonian_path()`?

Issue created by migration from https://trac.sagemath.org/ticket/10206





---

archive/issue_comments_103871.json:
```json
{
    "body": "3. is because this method is not an exact algorithm but an heuristic. It would have been misleading to have a non-exact hamiltonian path method while all the others are. But I already wrote a LP version of this one, making the heuristic available, in #9910\n\n(it also somehow fixed the slowness in the doctest, but I may not have noticed the difference between G and g `:-D`)\n\nNathann",
    "created_at": "2010-11-02T20:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103871",
    "user": "ncohen"
}
```

3. is because this method is not an exact algorithm but an heuristic. It would have been misleading to have a non-exact hamiltonian path method while all the others are. But I already wrote a LP version of this one, making the heuristic available, in #9910

(it also somehow fixed the slowness in the doctest, but I may not have noticed the difference between G and g `:-D`)

Nathann



---

archive/issue_comments_103872.json:
```json
{
    "body": "(oops, it was hidden in #9923)",
    "created_at": "2010-11-02T20:52:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103872",
    "user": "ncohen"
}
```

(oops, it was hidden in #9923)



---

archive/issue_comments_103873.json:
```json
{
    "body": "To solve (1), we should probably modify the following two lines:\n\n```python\n    #  First we pick a random vertex u\n    cdef int x = randint( 0, n-1 )\n    cdef int u = vertices[x]\n```\n\nto a random choice of a starting //non-isolated// vertex.  I am not a cython specialist, but perhaps we can alter this loop:\n\n```python\n    for row in G.adjacency_matrix():\n        j = 0\n        for k in row:\n            if k:\n                g.add_arc(i, j)\n            j += 1\n        i += 1\n```\n\nso that a list of non-isolated vertices will be saved. Then we can finish with something like that:\n\n```python\n    #  First we pick a random vertex u\n    cdef int x = randint(0, len(non_isolated_vertices) - 1)\n    cdef int u = non_isolated_vertices[x]\n```\n\n\nIf the graph is empty, I suggest we raise an informative exception (see also #21741).\n\nIf there is not empty but has no edges, we may either raise an exception or return something like `(False, [0])` (in the case where we're looking for a cycle, or if we're looking for a path and there are at least two vertices in the graph), or `(True, [0])` (in the case where we're looking for a path and the graph contains a single vertex).",
    "created_at": "2016-11-28T21:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103873",
    "user": "pelegm"
}
```

To solve (1), we should probably modify the following two lines:

```python
    #  First we pick a random vertex u
    cdef int x = randint( 0, n-1 )
    cdef int u = vertices[x]
```

to a random choice of a starting //non-isolated// vertex.  I am not a cython specialist, but perhaps we can alter this loop:

```python
    for row in G.adjacency_matrix():
        j = 0
        for k in row:
            if k:
                g.add_arc(i, j)
            j += 1
        i += 1
```

so that a list of non-isolated vertices will be saved. Then we can finish with something like that:

```python
    #  First we pick a random vertex u
    cdef int x = randint(0, len(non_isolated_vertices) - 1)
    cdef int u = non_isolated_vertices[x]
```


If the graph is empty, I suggest we raise an informative exception (see also #21741).

If there is not empty but has no edges, we may either raise an exception or return something like `(False, [0])` (in the case where we're looking for a cycle, or if we're looking for a path and there are at least two vertices in the graph), or `(True, [0])` (in the case where we're looking for a path and the graph contains a single vertex).



---

archive/issue_comments_103874.json:
```json
{
    "body": "The easiest is to treat small cases, with 0, 1 or 2 nodes.\n\nApparently `sage: G = graphs.CompleteGraph(2); fh(G)` will not end, while `sage: G = graphs.CompleteGraph(3); fh(G)` returns an immediate answer.",
    "created_at": "2016-12-02T18:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103874",
    "user": "dcoudert"
}
```

The easiest is to treat small cases, with 0, 1 or 2 nodes.

Apparently `sage: G = graphs.CompleteGraph(2); fh(G)` will not end, while `sage: G = graphs.CompleteGraph(3); fh(G)` returns an immediate answer.



---

archive/issue_comments_103875.json:
```json
{
    "body": "I pushed a patch fixing some of the issues of the `find_hamiltonian` method.\n\nTo do so, I have split the method in two parts: a front end testing small cases and partitioning the graph into connected components, and a method working on a connected graph with at least 3 vertices.\n\nThe problem with vertices of degree 1 remains, but I have no solution yet.\n----\nNew commits:",
    "created_at": "2016-12-03T13:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103875",
    "user": "dcoudert"
}
```

I pushed a patch fixing some of the issues of the `find_hamiltonian` method.

To do so, I have split the method in two parts: a front end testing small cases and partitioning the graph into connected components, and a method working on a connected graph with at least 3 vertices.

The problem with vertices of degree 1 remains, but I have no solution yet.
----
New commits:



---

archive/issue_comments_103876.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-12-03T13:34:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103876",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_103877.json:
```json
{
    "body": "I had to modify the doctests because the modifications have some impact on the order of the random choices.",
    "created_at": "2016-12-03T14:45:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103877",
    "user": "dcoudert"
}
```

I had to modify the doctests because the modifications have some impact on the order of the random choices.



---

archive/issue_comments_103878.json:
```json
{
    "body": "CC'ng myself for #21741.",
    "created_at": "2016-12-04T20:59:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103878",
    "user": "jmantysalo"
}
```

CC'ng myself for #21741.



---

archive/issue_comments_103879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-07T10:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_103880.json:
```json
{
    "body": "I did the following in last commit:\n* merge the 2 methods for `find_hamiltonian`. I think it was an error to split in 2 parts. There is no need for it and it's now easier to see the changes\n* add method `hamiltonian_path`, so answering point 3.\n\nSo the 3 issues are fixed with this patch. One issue remains with method `find_hamiltonian` that may run forever if the graph has some vertices of degree one (it was already clearly indicated in a warning). I propose to let this problem for another ticket. Already enough to review.",
    "created_at": "2016-12-07T10:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103880",
    "user": "dcoudert"
}
```

I did the following in last commit:
* merge the 2 methods for `find_hamiltonian`. I think it was an error to split in 2 parts. There is no need for it and it's now easier to see the changes
* add method `hamiltonian_path`, so answering point 3.

So the 3 issues are fixed with this patch. One issue remains with method `find_hamiltonian` that may run forever if the graph has some vertices of degree one (it was already clearly indicated in a warning). I propose to let this problem for another ticket. Already enough to review.



---

archive/issue_comments_103881.json:
```json
{
    "body": "Some comments (not a through review):\n\n- Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).\n- Same thing when there is no Hamiltonian path.\n- Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).\n- Use `r\"\"\"` so you can do `\\times` instead of `\\\\times`.\n- The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.\n- You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.",
    "created_at": "2016-12-07T15:01:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103881",
    "user": "tscrim"
}
```

Some comments (not a through review):

- Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).
- Same thing when there is no Hamiltonian path.
- Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).
- Use `r"""` so you can do `\times` instead of `\\times`.
- The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.
- You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.



---

archive/issue_comments_103882.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-07T16:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103882",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_103883.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> Some comments (not a through review):\n> \n> - Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).\n\nRight. I'm now using `EmptySetError` like `hamiltonian_cycle`.\n\n> - Same thing when there is no Hamiltonian path.\ndone\n> - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).\n\nIf we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.\n\n> - Use `r\"\"\"` so you can do `\\times` instead of `\\\\times`.\nThank you. I didn't know the meaning of `r\"\"\"`. \n\n> - The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.\nok\n> - You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.\nok\n\nThanks.",
    "created_at": "2016-12-07T16:28:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103883",
    "user": "dcoudert"
}
```

Replying to [comment:17 tscrim]:
> Some comments (not a through review):
> 
> - Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).

Right. I'm now using `EmptySetError` like `hamiltonian_cycle`.

> - Same thing when there is no Hamiltonian path.
done
> - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).

If we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.

> - Use `r"""` so you can do `\times` instead of `\\times`.
Thank you. I didn't know the meaning of `r"""`. 

> - The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.
ok
> - You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.
ok

Thanks.



---

archive/issue_comments_103884.json:
```json
{
    "body": "Replying to [comment:19 dcoudert]:\n> Replying to [comment:17 tscrim]:\n> > - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).\n> \n> If we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.\n\nYou are adding the method `hamiltonian_path`, so we are not changing its previously decided output. I agree that making the output of `hamiltonian_cycle` (internally) consistent is another ticket. Yet, I believe we should set the (IMO) correct behavior here and not kick the can down the road where it then becomes a backwards-incompatible change.",
    "created_at": "2016-12-07T16:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103884",
    "user": "tscrim"
}
```

Replying to [comment:19 dcoudert]:
> Replying to [comment:17 tscrim]:
> > - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).
> 
> If we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.

You are adding the method `hamiltonian_path`, so we are not changing its previously decided output. I agree that making the output of `hamiltonian_cycle` (internally) consistent is another ticket. Yet, I believe we should set the (IMO) correct behavior here and not kick the can down the road where it then becomes a backwards-incompatible change.



---

archive/issue_comments_103885.json:
```json
{
    "body": "So the method should return `None` or an empty  (di)graph ? and if `use_edge_labels==True`, should we return weight 0?",
    "created_at": "2016-12-07T19:52:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103885",
    "user": "dcoudert"
}
```

So the method should return `None` or an empty  (di)graph ? and if `use_edge_labels==True`, should we return weight 0?



---

archive/issue_comments_103886.json:
```json
{
    "body": "I would say `None`, which is distinct from the empty (di)graph as that could (in principle) be the Hamiltonian path/cycle of the empty (di)graph.",
    "created_at": "2016-12-07T21:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103886",
    "user": "tscrim"
}
```

I would say `None`, which is distinct from the empty (di)graph as that could (in principle) be the Hamiltonian path/cycle of the empty (di)graph.



---

archive/issue_comments_103887.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-12-08T16:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103887",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_103888.json:
```json
{
    "body": "I'm now returning `None` except for empty and one-element graphs for which the problem is not well defined.",
    "created_at": "2016-12-08T16:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103888",
    "user": "dcoudert"
}
```

I'm now returning `None` except for empty and one-element graphs for which the problem is not well defined.



---

archive/issue_comments_103889.json:
```json
{
    "body": "Any help reviewing this patch is more than welcome.",
    "created_at": "2016-12-17T07:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103889",
    "user": "dcoudert"
}
```

Any help reviewing this patch is more than welcome.



---

archive/issue_comments_103890.json:
```json
{
    "body": "I made some documentation fixes and added/moved a few more `cdef` declarations to improve the speed (in principle). If my changes look good, then you can set a positive review.\n----\nNew commits:",
    "created_at": "2016-12-17T22:42:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103890",
    "user": "tscrim"
}
```

I made some documentation fixes and added/moved a few more `cdef` declarations to improve the speed (in principle). If my changes look good, then you can set a positive review.
----
New commits:



---

archive/issue_comments_103891.json:
```json
{
    "body": "That's perfect. Thank you.",
    "created_at": "2016-12-18T08:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103891",
    "user": "dcoudert"
}
```

That's perfect. Thank you.



---

archive/issue_comments_103892.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-12-18T08:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103892",
    "user": "dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_103893.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-18T20:40:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10205",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10205#issuecomment-103893",
    "user": "vbraun"
}
```

Resolution: fixed
