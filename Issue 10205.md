# Issue 10205: Various issues in find_hamiltonian

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2010-11-02 20:42:54

Assignee: jason, ncohen, rlm

CC:  fidelbarrera rlm boothby ncohen mvngu pelegm jmantysalo

1.

```
sage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh
sage: G = graphs.CompleteGraph(1); fh(G)
Traceback (most recent call last):
...
ValueError: empty range for randrange() (0,0, 0)
```


2.

```
sage: from sage.graphs.generic_graph_pyx import find_hamiltonian as fh
sage: G = graphs.CompleteGraph(2); fh(G)
[ Sage just hangs... ]
```


3. Why is there a `G.hamiltonian_cycle()` member function but not `G.hamiltonian_path()`?


---

Comment by ncohen created at 2010-11-02 20:49:11

3. is because this method is not an exact algorithm but an heuristic. It would have been misleading to have a non-exact hamiltonian path method while all the others are. But I already wrote a LP version of this one, making the heuristic available, in #9910

(it also somehow fixed the slowness in the doctest, but I may not have noticed the difference between G and g `:-D`)

Nathann


---

Comment by ncohen created at 2010-11-02 20:52:48

(oops, it was hidden in #9923)


---

Comment by pelegm created at 2016-11-28 21:00:10

To solve (1), we should probably modify the following two lines:

```python
    #  First we pick a random vertex u
    cdef int x = randint( 0, n-1 )
    cdef int u = vertices[x]
```

to a random choice of a starting //non-isolated// vertex.  I am not a cython specialist, but perhaps we can alter this loop:

```python
    for row in G.adjacency_matrix():
        j = 0
        for k in row:
            if k:
                g.add_arc(i, j)
            j += 1
        i += 1
```

so that a list of non-isolated vertices will be saved. Then we can finish with something like that:

```python
    #  First we pick a random vertex u
    cdef int x = randint(0, len(non_isolated_vertices) - 1)
    cdef int u = non_isolated_vertices[x]
```


If the graph is empty, I suggest we raise an informative exception (see also #21741).

If there is not empty but has no edges, we may either raise an exception or return something like `(False, [0])` (in the case where we're looking for a cycle, or if we're looking for a path and there are at least two vertices in the graph), or `(True, [0])` (in the case where we're looking for a path and the graph contains a single vertex).


---

Comment by dcoudert created at 2016-12-02 18:17:25

The easiest is to treat small cases, with 0, 1 or 2 nodes.

Apparently `sage: G = graphs.CompleteGraph(2); fh(G)` will not end, while `sage: G = graphs.CompleteGraph(3); fh(G)` returns an immediate answer.


---

Comment by dcoudert created at 2016-12-03 13:34:40

I pushed a patch fixing some of the issues of the `find_hamiltonian` method.

To do so, I have split the method in two parts: a front end testing small cases and partitioning the graph into connected components, and a method working on a connected graph with at least 3 vertices.

The problem with vertices of degree 1 remains, but I have no solution yet.
----
New commits:


---

Comment by dcoudert created at 2016-12-03 13:34:40

Changing status from new to needs_review.


---

Comment by dcoudert created at 2016-12-03 14:45:04

I had to modify the doctests because the modifications have some impact on the order of the random choices.


---

Comment by jmantysalo created at 2016-12-04 20:59:41

CC'ng myself for #21741.


---

Comment by git created at 2016-12-07 10:51:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-12-07 10:59:28

I did the following in last commit:
* merge the 2 methods for `find_hamiltonian`. I think it was an error to split in 2 parts. There is no need for it and it's now easier to see the changes
* add method `hamiltonian_path`, so answering point 3.

So the 3 issues are fixed with this patch. One issue remains with method `find_hamiltonian` that may run forever if the graph has some vertices of degree one (it was already clearly indicated in a warning). I propose to let this problem for another ticket. Already enough to review.


---

Comment by tscrim created at 2016-12-07 15:01:32

Some comments (not a through review):

- Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).
- Same thing when there is no Hamiltonian path.
- Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).
- Use `r"""` so you can do `\times` instead of `\\times`.
- The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.
- You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.


---

Comment by git created at 2016-12-07 16:23:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-12-07 16:28:21

Replying to [comment:17 tscrim]:
> Some comments (not a through review):
> 
> - Do not use `assert` to check for input. For bad input, raise the appropriate error (likely a `ValueError`).

Right. I'm now using `EmptySetError` like `hamiltonian_cycle`.

> - Same thing when there is no Hamiltonian path.
done
> - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).

If we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.

> - Use `r"""` so you can do `\times` instead of `\\times`.
Thank you. I didn't know the meaning of `r"""`. 

> - The `algorithm` bullet points should be aligned with the rest of the text in that input point; in other words, remove 4 spaces from those lines.
ok
> - You should tell Cython that `i` and `j` are `int`s and add back in `cdef int i,j`.
ok

Thanks.


---

Comment by tscrim created at 2016-12-07 16:35:54

Replying to [comment:19 dcoudert]:
> Replying to [comment:17 tscrim]:
> > - Fundamentally, I believe this should return `None` if there is no such path and not raise an error. I was going to say this is consistent with `hamiltonian_cycle`, but that behavior depends on which algorithm you use! At least the `backtrack` for `hamiltonian_cycle` returns `False`, but with something more for debugging than anything (i.e., it is not a certificate).
> 
> If we want to change the outpus, we have to do it for both methods and it's better to do it in another ticket.

You are adding the method `hamiltonian_path`, so we are not changing its previously decided output. I agree that making the output of `hamiltonian_cycle` (internally) consistent is another ticket. Yet, I believe we should set the (IMO) correct behavior here and not kick the can down the road where it then becomes a backwards-incompatible change.


---

Comment by dcoudert created at 2016-12-07 19:52:05

So the method should return `None` or an empty  (di)graph ? and if `use_edge_labels==True`, should we return weight 0?


---

Comment by tscrim created at 2016-12-07 21:40:09

I would say `None`, which is distinct from the empty (di)graph as that could (in principle) be the Hamiltonian path/cycle of the empty (di)graph.


---

Comment by git created at 2016-12-08 16:56:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2016-12-08 16:59:01

I'm now returning `None` except for empty and one-element graphs for which the problem is not well defined.


---

Comment by dcoudert created at 2016-12-17 07:39:14

Any help reviewing this patch is more than welcome.


---

Comment by tscrim created at 2016-12-17 22:42:14

I made some documentation fixes and added/moved a few more `cdef` declarations to improve the speed (in principle). If my changes look good, then you can set a positive review.
----
New commits:


---

Comment by dcoudert created at 2016-12-18 08:21:08

That's perfect. Thank you.


---

Comment by dcoudert created at 2016-12-18 08:21:08

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-01-18 20:40:09

Resolution: fixed
