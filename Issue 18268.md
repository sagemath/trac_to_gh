# Issue 18268: Enhance matrix similarity check

archive/issues_018268.json:
```json
{
    "body": "CC:  @ThomasGagne @tscrim @videlec @rbeezer\n\nKeywords: matrix is_similar similarity\n\nThe addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.\n\nIssue created by migration from https://trac.sagemath.org/ticket/18505\n\n",
    "created_at": "2015-05-25T22:33:24Z",
    "labels": [
        "linear algebra",
        "minor",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.6",
    "title": "Enhance matrix similarity check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18268",
    "user": "@rbeezer"
}
```
CC:  @ThomasGagne @tscrim @videlec @rbeezer

Keywords: matrix is_similar similarity

The addition of rational form makes it possible to always compute a canonical equivalence class representative for matrix similarity, using only field operations.  Computing the similarity transformation is still limited by the necessity of using Jordan form and the resulting problem of eigenvalues lying outside of the field used for the matrix entries.  Various improvements to the code and error-checking have been made.

Issue created by migration from https://trac.sagemath.org/ticket/18505





---

archive/issue_comments_246792.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-25T22:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246792",
    "user": "@rbeezer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_246793.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-25T22:39:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246793",
    "user": "@rbeezer"
}
```

New commits:



---

archive/issue_comments_246794.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-06T15:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246794",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_246795.json:
```json
{
    "body": "Hello,\n\nThis looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.\n\n1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`\n\n2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields\n\n```\nsage: QQ.algebraic_closure()\nAlgebraic Field\nsage: GF(3).algebraic_closure()\nAlgebraic closure of Finite Field of size 3\n```\n\n   Though, I do not know whether your code would work in this case.\n\n3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.\n\n```\nsage: m = matrix(ZZ,2,[0,1,1,1])\nsage: a = matrix(ZZ,2,[1,1,0,1])\nsage: b = matrix(ZZ,2,[1,0,1,1])\nsage: c = a*b*b*a*~b\nsage: m2 = c * m * ~c\nsage: m.is_similar(m2)\nTrue\nsage: m.is_similar(m2, True)\n(\n      [   1.000000000000000?               0.?e-18]\nTrue, [  0.7894736842105263? -0.05263157894736842?]\n)\n```\n\n  (sided note: the above command used to return `(False, matrix)`... see item 0)\n\n4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\n5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.\n\n6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?\n\nMore to come...\n\nVincent",
    "created_at": "2015-08-06T15:15:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246795",
    "user": "@videlec"
}
```

Hello,

This looks like a very nice improvement! I am slowly digging into the algorithmic part of it. But let me first start with simple remarks.

1. First of all, the standard for doctest continuation is now `....:` instead of `...`. Moreover, when `transformation=True` and when the matrices are similar the method `is_similar` used to return `(False, matrix)` instead of `(True, matrix)`. You are carefully ignoring the first argument in all the tests! So either it is useless and I suggest to just return `None` or `matrix` if `transformation=True` or test the first argument appropriately. Finally, some tiny improvements can be obtained using `m.get_unsafe(i,j)` instead of `m[i,j]`. I provided 3 commits for these that can be found at `public/18505`

2. Instead as invoking QQbar if the ground field is QQ you can use the method `.algebraic_closure()` that also works for prime fields

```
sage: QQ.algebraic_closure()
Algebraic Field
sage: GF(3).algebraic_closure()
Algebraic closure of Finite Field of size 3
```

   Though, I do not know whether your code would work in this case.

3. I do not like the fact that for input in ZZ, the transformation matrix has coefficient in QQbar. I do not see why the base field should be extended. Conjugacy makes sense within `M_n(ZZ)`.

```
sage: m = matrix(ZZ,2,[0,1,1,1])
sage: a = matrix(ZZ,2,[1,1,0,1])
sage: b = matrix(ZZ,2,[1,0,1,1])
sage: c = a*b*b*a*~b
sage: m2 = c * m * ~c
sage: m.is_similar(m2)
True
sage: m.is_similar(m2, True)
(
      [   1.000000000000000?               0.?e-18]
True, [  0.7894736842105263? -0.05263157894736842?]
)
```

  (sided note: the above command used to return `(False, matrix)`... see item 0)

4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

5. I learned that a lot of time is actually taken by the import statements. You can try to minimize the number of them.

6. The usage of `quo_rem` looks weird. I thought that `q,r = a.quo_rem(b)` would be equivalent to `q = a//b; r = a%b` but it is not! For example `(1/3) % 5` returns `2` as it is the inverse of `3` mod `5`. What do you think about the semantics of `//` and `%` against the method `quo_rem`?

More to come...

Vincent



---

archive/issue_comments_246796.json:
```json
{
    "body": "I have some of the suggested changes.\n----\nNew commits:",
    "created_at": "2016-10-15T13:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246796",
    "user": "@fchapoton"
}
```

I have some of the suggested changes.
----
New commits:



---

archive/issue_comments_246797.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-15T13:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246797",
    "user": "@fchapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_246798.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n\nStrong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.",
    "created_at": "2016-10-15T13:25:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246798",
    "user": "@tscrim"
}
```

Replying to [comment:3 vdelecroix]:
> 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.

Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.



---

archive/issue_comments_246799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-15T17:56:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246799",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246800.json:
```json
{
    "body": "As a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.",
    "created_at": "2016-10-15T17:57:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246800",
    "user": "@fchapoton"
}
```

As a compromise, I propose to raise ValueError for non-square matrices and return False for mismatched square matrices.



---

archive/issue_comments_246801.json:
```json
{
    "body": "I don't particularly like it, but I can live with that (which means it must be a good compromise :P).",
    "created_at": "2016-10-15T18:52:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246801",
    "user": "@tscrim"
}
```

I don't particularly like it, but I can live with that (which means it must be a good compromise :P).



---

archive/issue_comments_246802.json:
```json
{
    "body": "Changing priority from minor to major.",
    "created_at": "2016-10-15T20:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246802",
    "user": "@fchapoton"
}
```

Changing priority from minor to major.



---

archive/issue_comments_246803.json:
```json
{
    "body": "setting to **major**, because I am going to need this.",
    "created_at": "2016-10-15T20:01:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246803",
    "user": "@fchapoton"
}
```

setting to **major**, because I am going to need this.



---

archive/issue_comments_246804.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-15T20:25:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246804",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246805.json:
```json
{
    "body": "While I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?",
    "created_at": "2016-10-15T22:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246805",
    "user": "@tscrim"
}
```

While I would like a better solution to Vincent's point 3, but I suspect solving that would require some effort. So it's not something that would block me from setting this to a positive review. Vincent, Rob, any other comments or issues?



---

archive/issue_comments_246806.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> Replying to [comment:3 vdelecroix]:\n> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> \n> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n\nIt is not only a burden. It is a problem of well defined specifications.\n\nWith your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nWith your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n\n```\nsage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\nsage: from collections import defaultdict\nsage: d = defaultdict(list)\nsage: for e in elts: d[e.parent()].append(e)\nsage: d[RR]\n[3.40000000000000, 0.000000000000000]\nsage: d[ZZ]\n[1, 5]\nsage: d[QQ]\n[2/3, 5/2]\n```\n",
    "created_at": "2016-10-16T17:03:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246806",
    "user": "@videlec"
}
```

Replying to [comment:5 tscrim]:
> Replying to [comment:3 vdelecroix]:
> > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> 
> Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.

It is not only a burden. It is a problem of well defined specifications.

With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.

```
sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
sage: from collections import defaultdict
sage: d = defaultdict(list)
sage: for e in elts: d[e.parent()].append(e)
sage: d[RR]
[3.40000000000000, 0.000000000000000]
sage: d[ZZ]
[1, 5]
sage: d[QQ]
[2/3, 5/2]
```




---

archive/issue_comments_246807.json:
```json
{
    "body": "I am ready to go back to raising error for square matrices of different sizes.\n\nBut first, do yo have any other comment ?\n\nThe thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.",
    "created_at": "2016-10-16T19:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246807",
    "user": "@fchapoton"
}
```

I am ready to go back to raising error for square matrices of different sizes.

But first, do yo have any other comment ?

The thing we really need (in another ticket) is a canonical form algo that gives the change-of-basis matrix. It seems that m*gma has something like that, with a reference.



---

archive/issue_comments_246808.json:
```json
{
    "body": "Replying to [comment:12 vdelecroix]:\n> Replying to [comment:5 tscrim]:\n> > Replying to [comment:3 vdelecroix]:\n> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> > \n> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n> \n> It is not only a burden. It is a problem of well defined specifications.\n> \n> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n\nThe specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nI am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n\nYou're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n> \n> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.\n> {{{\n> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]\n> sage: from collections import defaultdict\n> sage: d = defaultdict(list)\n> sage: for e in elts: d[e.parent()].append(e)\n> sage: d[RR]\n> [3.40000000000000, 0.000000000000000]\n> sage: d[ZZ]\n> [1, 5]\n> sage: d[QQ]\n> [2/3, 5/2]\n> }}}\n\nYou've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.\n\nActually, does anyone know what the other Ma's do?",
    "created_at": "2016-10-17T02:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246808",
    "user": "@tscrim"
}
```

Replying to [comment:12 vdelecroix]:
> Replying to [comment:5 tscrim]:
> > Replying to [comment:3 vdelecroix]:
> > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> > 
> > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.
> 
> It is not only a burden. It is a problem of well defined specifications.
> 
> With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).

The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.

You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.
> 
> With your pseudo use-case, it is very easy to sort first by parents and then check for similarity.
> {{{
> sage: elts = [1, 2/3, 5, 5/2, 3.4, 0.0]
> sage: from collections import defaultdict
> sage: d = defaultdict(list)
> sage: for e in elts: d[e.parent()].append(e)
> sage: d[RR]
> [3.40000000000000, 0.000000000000000]
> sage: d[ZZ]
> [1, 5]
> sage: d[QQ]
> [2/3, 5/2]
> }}}

You've done an import statement and some more advanced Python-foo. There is no way I could teach that to my linear algebra students or to an average Sage user.

Actually, does anyone know what the other Ma's do?



---

archive/issue_comments_246809.json:
```json
{
    "body": "Replying to [comment:14 tscrim]:\n> Replying to [comment:12 vdelecroix]:\n> > Replying to [comment:5 tscrim]:\n> > > Replying to [comment:3 vdelecroix]:\n> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.\n> > > \n> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.\n> > \n> > It is not only a burden. It is a problem of well defined specifications.\n> > \n> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).\n> \n> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n\nFor me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3 comment:3]). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nAs you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n\nWhat you are suggesting is a `is_similar` with the following behavior\n\n```\ndef is_similar(self, other):\n    try:\n        return self.is_conjugate(other)\n    except Exception:\n        return False\n```\n\nwhere the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\n> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> \n> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n\nYou are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n\n```\nsage: identity_matrix(10) == 1\nTrue\n```\n\n\n> Actually, does anyone know what the other Ma's do?\n\nAt least I found\n\n* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.",
    "created_at": "2016-10-17T06:45:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246809",
    "user": "@videlec"
}
```

Replying to [comment:14 tscrim]:
> Replying to [comment:12 vdelecroix]:
> > Replying to [comment:5 tscrim]:
> > > Replying to [comment:3 vdelecroix]:
> > > > 4. In the case matrices are not square or have different dimension I would rather raise an error instead of returning False. Conjugacy does not make any sense for them. Moreover, everything can be tested at once using `if parent(self) is not parent(other):`.
> > > 
> > > Strong -1 from me on this; it puts an extra burden on the user. Suppose you are checking a set of matrices where your construction creates matrices of multiple sizes and seeing which of them are similar. Then you either have to manually add checks (duplication) or wrap things with a try-except block (obfuscation). It still makes sense with the definition of similar that `is_similar` would return false when the (square) matrices are different sizes. The argument weakens for non-square matrices, but I still think it puts a completely unnecessary burden on the user.
> > 
> > It is not only a burden. It is a problem of well defined specifications.
> > 
> > With your proposition, a `False` answer would have two meanings. If a question does not make sense it should really be an error. It is like asking `1 / 0 == 3` (that indeed raise an error in Python). As a consequence of such behavior things such as `m.is_similar(1)` would be ambiguous (is there an implicit coercion in this command? In other words, if the answer is `False` does it mean that my matrix is not similar to the identity?).
> 
> The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?

For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3 comment:3]). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.

What you are suggesting is a `is_similar` with the following behavior

```
def is_similar(self, other):
    try:
        return self.is_conjugate(other)
    except Exception:
        return False
```

where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

> I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> 
> You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.

You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage

```
sage: identity_matrix(10) == 1
True
```


> Actually, does anyone know what the other Ma's do?

At least I found

* [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.



---

archive/issue_comments_246810.json:
```json
{
    "body": "Replying to [comment:15 vdelecroix]:\n> Replying to [comment:14 tscrim]:\n> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?\n> \n> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3 comment:3]). If there is no \"natural\" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question \"is similar\" (or \"is conjugate\") in their common parent (involving coercion if needed).\n\nThe natural algebra in this case would be the product algebra over a common (larger) base ring.\n\n> As you suggested \"similar\" is mostly applied for linear algebra and the appropriate adjective in general is \"conjugate\". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.\n> \n> What you are suggesting is a `is_similar` with the following behavior\n> {{{\n> def is_similar(self, other):\n>     try:\n>         return self.is_conjugate(other)\n>     except Exception:\n>         return False\n> }}}\n> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?\n\nI think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.\n\n> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.\n> > \n> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.\n> \n> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage\n> {{{\n> sage: identity_matrix(10) == 1\n> True\n> }}}\n\nI guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?\n\nMore I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.\n\n> > Actually, does anyone know what the other Ma's do?\n> \n> At least I found\n> \n> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.\n\nMaple returns `false`. I couldn't find anything on Mathematica either.",
    "created_at": "2016-10-17T14:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246810",
    "user": "@tscrim"
}
```

Replying to [comment:15 vdelecroix]:
> Replying to [comment:14 tscrim]:
> > The specifications are well-defined. As I have learned it: A is similar to B if there exist an invertible matrix P such that A = PBP<sup>-1</sup>. This can be interpreted as A and B are similar iff they are the same linear transformation. So are you saying it should raise an error when checking if two maps are equal if have different (co)domains?
> 
> For me it is rather an algebraic statements. And the question `Is A similar to B in X` makes sense in any given algebra `X` and two of its elements `A` and `B`. And the algebra `X` is definitely part of the question (see point 3 in [comment:3 comment:3]). If there is no "natural" algebra containing `A` and `B` the question is not well defined. In Sage, elements have parents and it should be expected that we are answering the question "is similar" (or "is conjugate") in their common parent (involving coercion if needed).

The natural algebra in this case would be the product algebra over a common (larger) base ring.

> As you suggested "similar" is mostly applied for linear algebra and the appropriate adjective in general is "conjugate". But for me, `is_similar` should just be an alias of `is_conjugate` in the case of matrices.
> 
> What you are suggesting is a `is_similar` with the following behavior
> {{{
> def is_similar(self, other):
>     try:
>         return self.is_conjugate(other)
>     except Exception:
>         return False
> }}}
> where the `is_conjugate` would be defined as I said. Do you think we should have both `is_conjugate` and `is_similar`?

I think they should be aliases because `x.is_conjugate(y)` should be the same as `y in x.conjugacy_class()`, and the latter of which would not result in an error. However, I am probably able live with a stricter `is_conjugate`, although this has a slight name conflict with complex conjugate, which we shorten to `conjugate`.

> > I am still leaning towards non-square matrices returning `False` and considering the error being raised a regression.
> > 
> > You're arguments are unconvincing to me because checking similarity of different sized matrices is not an invalid mathematical comparison (much less an operation). For `m.is_similar(1)`, this is comparing a matrix to something which is not a matrix, and an error would be appropriate in this case.
> 
> You are just missing the point. The identity matrix and the integer 1 are considered equal in Sage
> {{{
> sage: identity_matrix(10) == 1
> True
> }}}

I guess since we are allowing coercion of the arguments, then `m.is_similar(1)` should coerce to a common parent, which is `m.parent()` and then check. However, it should not result in an error if no common parent is found, it should simply be false. What if `m` and `n` are the same size, but had no common base ring, should that raise an error?

More I think about it, the more I am convinced that essentially any of the `is_*` methods should not error out when trivially incorrect. They are checking properties, not performing operations.

> > Actually, does anyone know what the other Ma's do?
> 
> At least I found
> 
> * [maple](https://www.maplesoft.com/support/help/Maple/view.aspx?path=Student/LinearAlgebra/IsSimilar)... but they do not specify what happens for different matrix sizes.

Maple returns `false`. I couldn't find anything on Mathematica either.



---

archive/issue_comments_246811.json:
```json
{
    "body": "I would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?\n\nThere will be a conflict with an existing ticket tackling \"... --> .....:\" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(",
    "created_at": "2016-10-19T19:45:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246811",
    "user": "@fchapoton"
}
```

I would really like to get this ticket in, guys. Please help. Would you mind giving a positive review ?

There will be a conflict with an existing ticket tackling "... --> .....:" in the matrix folder.. And there may also be a conflict with some xrange-cleaning ticket. :(



---

archive/issue_comments_246812.json:
```json
{
    "body": "The reference for the algorithms used by m*gma is\n\n```\nAllan Steel.\nA New Algorithm for the Computation of Canonical Forms of Matrices over Fields.\nJ. Symbolic Comp., 24(3):409--432, 1997. \n```\n",
    "created_at": "2016-10-19T19:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246812",
    "user": "@fchapoton"
}
```

The reference for the algorithms used by m*gma is

```
Allan Steel.
A New Algorithm for the Computation of Canonical Forms of Matrices over Fields.
J. Symbolic Comp., 24(3):409--432, 1997. 
```




---

archive/issue_comments_246813.json:
```json
{
    "body": "I strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.",
    "created_at": "2016-10-19T21:57:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246813",
    "user": "@tscrim"
}
```

I strongly believe we should have `is_similar` not raise an error when comparing mismatched sizes or non-square matrices.



---

archive/issue_comments_246814.json:
```json
{
    "body": "I must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)\n\nBut I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!",
    "created_at": "2016-10-24T19:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246814",
    "user": "@fchapoton"
}
```

I must say that I am rather on Vincent's side here (raising appropriate errors for nonsensical input)

But I really think that whatever is done, it will be much better than keeping the current state of affairs. Please guys, let us move forward!



---

archive/issue_comments_246815.json:
```json
{
    "body": "I think we should bring it to a discussion/vote on sage-devel.",
    "created_at": "2016-10-24T19:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246815",
    "user": "@tscrim"
}
```

I think we should bring it to a discussion/vote on sage-devel.



---

archive/issue_comments_246816.json:
```json
{
    "body": "I have started a vote on sage-devel.",
    "created_at": "2016-10-27T08:57:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246816",
    "user": "@fchapoton"
}
```

I have started a vote on sage-devel.



---

archive/issue_comments_246817.json:
```json
{
    "body": "If I count correctly, the result of the vote is\n\n```\nAA = 6\nBB = 3\n?A = 1\n```\n\nso I am going to go back to raising errors in both cases.\n\nI somebody wants to remove the \"is_similar\" method for non-square matrices, it should be in another ticket.",
    "created_at": "2016-11-01T08:46:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246817",
    "user": "@fchapoton"
}
```

If I count correctly, the result of the vote is

```
AA = 6
BB = 3
?A = 1
```

so I am going to go back to raising errors in both cases.

I somebody wants to remove the "is_similar" method for non-square matrices, it should be in another ticket.



---

archive/issue_comments_246818.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-11-01T09:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246818",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_246819.json:
```json
{
    "body": "bot is green, please review",
    "created_at": "2016-11-02T18:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246819",
    "user": "@fchapoton"
}
```

bot is green, please review



---

archive/issue_comments_246820.json:
```json
{
    "body": "I've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.",
    "created_at": "2016-11-02T19:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246820",
    "user": "@rbeezer"
}
```

I've looked over all the accumulated changes, and really like what I see.  Thanks for all the clean-up and improvements.  I'm sorry my Sage developent skills are so rusty that I can't be more help.



---

archive/issue_comments_246821.json:
```json
{
    "body": "I was going to put this on the sage-devel vote, but it looks like the topic got locked.\n\n#####\n\nThanks to Vincent, Travis and Fr\u00e9d\u00e9ric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.\n\nI have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.",
    "created_at": "2016-11-02T19:58:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246821",
    "user": "@rbeezer"
}
```

I was going to put this on the sage-devel vote, but it looks like the topic got locked.

#####

Thanks to Vincent, Travis and Frédéric for their careful work on this (and I'm glad to see Travis defending use by students who don't know much math or much Python).  I'm sorry to be so late in picking up on this one and missing the vote.

I have fond memories of writing .zigzag_form() as a precursor of rational canonical form (is that the best method name ever?).  So I'm really glad to see the similarity check becoming fully capable, all the discussion about user interaction, and a few speed-ups for zig-zag form.



---

archive/issue_comments_246822.json:
```json
{
    "body": "Vincent, would you give a positive review ?",
    "created_at": "2016-11-09T20:14:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246822",
    "user": "@fchapoton"
}
```

Vincent, would you give a positive review ?



---

archive/issue_comments_246823.json:
```json
{
    "body": "please, somebody ? this is ready and useful !",
    "created_at": "2016-11-11T20:42:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246823",
    "user": "@fchapoton"
}
```

please, somebody ? this is ready and useful !



---

archive/issue_comments_246824.json:
```json
{
    "body": "Why did this change\n\n```diff\n+        A matrix over the integers will be promoted to a\n+        matrix over the rationals, but may need to be manually\n+        promoted to the algebraic numbers.  ::\n+\n             sage: A = matrix(ZZ, 2, 2, range(4))\n             sage: B = matrix(QQbar, 2, 2, range(4))\n             sage: A.is_similar(B)\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: matrices need to have entries with identical fraction fields,\n+            not Rational Field and Algebraic Field\n+            sage: A.change_ring(QQbar).is_similar(B)\n             True\n```\n\nThere is a natural coercion here.",
    "created_at": "2016-11-12T20:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246824",
    "user": "@videlec"
}
```

Why did this change

```diff
+        A matrix over the integers will be promoted to a
+        matrix over the rationals, but may need to be manually
+        promoted to the algebraic numbers.  ::
+
             sage: A = matrix(ZZ, 2, 2, range(4))
             sage: B = matrix(QQbar, 2, 2, range(4))
             sage: A.is_similar(B)
+            Traceback (most recent call last):
+            ...
+            TypeError: matrices need to have entries with identical fraction fields,
+            not Rational Field and Algebraic Field
+            sage: A.change_ring(QQbar).is_similar(B)
             True
```

There is a natural coercion here.



---

archive/issue_comments_246825.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-11-12T20:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246825",
    "user": "@videlec"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_246826.json:
```json
{
    "body": "\n```\nsage: cm = get_coercion_model()\nsage: m1 = matrix(ZZ, 2, range(4))\nsage: m2 = matrix(QQbar, 2, range(4))\nsage: mm1, mm2 = cm.canonical_coercion(m1, m2)\nsage: mm1.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\nsage: mm2.parent()\nFull MatrixSpace of 2 by 2 dense matrices over Algebraic Field\n```\n",
    "created_at": "2016-11-12T21:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246826",
    "user": "@videlec"
}
```


```
sage: cm = get_coercion_model()
sage: m1 = matrix(ZZ, 2, range(4))
sage: m2 = matrix(QQbar, 2, range(4))
sage: mm1, mm2 = cm.canonical_coercion(m1, m2)
sage: mm1.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
sage: mm2.parent()
Full MatrixSpace of 2 by 2 dense matrices over Algebraic Field
```




---

archive/issue_comments_246827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T14:25:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246827",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246828.json:
```json
{
    "body": "Here is a commit trying to involve coercion if possible. Not tested yet.",
    "created_at": "2016-11-18T14:25:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246828",
    "user": "@fchapoton"
}
```

Here is a commit trying to involve coercion if possible. Not tested yet.



---

archive/issue_comments_246829.json:
```json
{
    "body": "Looks good. But you can avoid complications with\n\n```\nif parent(A) != parent(B):\n    coercion\n```\n\nat the very begining. But we would loose specific error message for different sizes.",
    "created_at": "2016-11-18T14:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246829",
    "user": "@videlec"
}
```

Looks good. But you can avoid complications with

```
if parent(A) != parent(B):
    coercion
```

at the very begining. But we would loose specific error message for different sizes.



---

archive/issue_comments_246830.json:
```json
{
    "body": "Since `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.",
    "created_at": "2016-11-18T14:59:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246830",
    "user": "@tscrim"
}
```

Since `MatrixSpace` is a subclass of `UniqueRepresentation`, you can do `parent(A) is parent(B)`. Although, because this is Cython, I think you can use `have_same_parent` from `element.pxd`.



---

archive/issue_comments_246831.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T16:42:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246831",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246832.json:
```json
{
    "body": "I am not fond of the idea of starting by comparing parents. Better keep the useful error messages.\n\nHere is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results",
    "created_at": "2016-11-18T16:44:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246832",
    "user": "@fchapoton"
}
```

I am not fond of the idea of starting by comparing parents. Better keep the useful error messages.

Here is a new version using have_same_parent, but still not tested, and 2 doctests are not filled with the results



---

archive/issue_comments_246833.json:
```json
{
    "body": "There is also the ``@`coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...",
    "created_at": "2016-11-18T17:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246833",
    "user": "@tscrim"
}
```

There is also the ``@`coerce_binop` decorator that hides that logic. Although because this is Cython, I'm not sure this would necessarily work as I forget how it can handle decorators...



---

archive/issue_comments_246834.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T17:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246834",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246835.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-11-18T17:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246835",
    "user": "@fchapoton"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_246836.json:
```json
{
    "body": "ok, please review",
    "created_at": "2016-11-18T17:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246836",
    "user": "@fchapoton"
}
```

ok, please review



---

archive/issue_comments_246837.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-18T19:57:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246837",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_246838.json:
```json
{
    "body": "ping ?",
    "created_at": "2016-11-25T10:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246838",
    "user": "@fchapoton"
}
```

ping ?



---

archive/issue_comments_246839.json:
```json
{
    "body": "*ping* !",
    "created_at": "2016-12-08T09:02:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246839",
    "user": "@fchapoton"
}
```

*ping* !



---

archive/issue_comments_246840.json:
```json
{
    "body": "**P I N  G** ?",
    "created_at": "2016-12-30T18:20:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246840",
    "user": "@fchapoton"
}
```

**P I N  G** ?



---

archive/issue_comments_246841.json:
```json
{
    "body": "Everything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.",
    "created_at": "2017-01-01T00:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246841",
    "user": "@tscrim"
}
```

Everything is good, but I will not set it to a positive review because I disagree with making this raise an error. So if someone else just wants to put this to a positive review, then they can.



---

archive/issue_comments_246842.json:
```json
{
    "body": "As a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of \"is_similar\" which gives the change-of-basis matrix over any field, **once this ticket is closed**.",
    "created_at": "2017-01-03T20:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246842",
    "user": "@fchapoton"
}
```

As a motivation for *somebody* to give a positive review, I have at my disposal and plan to provide an implementation of "is_similar" which gives the change-of-basis matrix over any field, **once this ticket is closed**.



---

archive/issue_comments_246843.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-01-07T20:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246843",
    "user": "@videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_246844.json:
```json
{
    "body": "Let it go and happy new year!",
    "created_at": "2017-01-07T20:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246844",
    "user": "@videlec"
}
```

Let it go and happy new year!



---

archive/issue_comments_246845.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-01-18T20:40:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18268",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18268#issuecomment-246845",
    "user": "@vbraun"
}
```

Resolution: fixed
