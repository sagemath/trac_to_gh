# Issue 33686: Derivative of a symbolic sum gives nonsensical results.

archive/issues_033686.json:
```json
{
    "body": "Inspired by this `ask.sagemath.org` [question](https://ask.sagemath.org/question/62451/how-to-symbolic-differentiate-a-sum-of-n-unknown-variables/) :\n\n\n```\nage: var(\"j, p, beta\")\n(j, p, beta)\nsage: X, theta=function(\"X, theta\")\nsage: E(beta)=sum(beta*X(j)*sin(theta(j))/(1 + beta^2*X(j)), j, 1, p)\nsage: ED = E(beta).diff(beta) ; ED\n-2*beta^2*X(j)^2*sin(theta(j))*D[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)/(beta^2*X(j) + 1)^2 + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)\n```\n\n\nWhat is the meaning of this ? Especially :\n\n\n```\nsage: ED.operands()[0].operands()[4]\nD[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)\nsage: ED.operands()[0].operands()[4].operator()\nD[0](sum)\n```\n\n\nCompare with :\n\n\n```\nsage: E(beta).maxima_methods().diff(beta)\n-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)\n```\n\n\nwhich seems correct,\n\n\n```\nsage: maxima_calculus.diff(E(beta), beta).sage()\n-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)\n```\n\n\n(another way to do the same), also correct,\n\n\n```\nsage: mathematica.D(E(beta), beta).sage()\nbeta*sum(-2*beta*X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)\n\n```\n\n\nalso correct (but simplifiable), and\n\n\n```\nsage: import sympy\nsage: sympy.diff(*map(lambda u:u._sympy_(), (E(beta), beta)))\nbeta*Sum(-2*beta*X(j)**2*sin(theta(j))/(beta**2*X(j) + 1)**2, (j, 1, p)) + Sum(X(j)*sin(theta(j))/(beta**2*X(j) + 1), (j, 1, p))\n```\n\n\nwhich seems correct, but can't (yet) be translated back to Sage, `Sum` remaining untranslated...\n\nIssue created by migration from https://trac.sagemath.org/ticket/33923\n\n",
    "created_at": "2022-05-28T09:06:04Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Derivative of a symbolic sum gives nonsensical results.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33686",
    "user": "https://github.com/EmmanuelCharpentier"
}
```
Inspired by this `ask.sagemath.org` [question](https://ask.sagemath.org/question/62451/how-to-symbolic-differentiate-a-sum-of-n-unknown-variables/) :


```
age: var("j, p, beta")
(j, p, beta)
sage: X, theta=function("X, theta")
sage: E(beta)=sum(beta*X(j)*sin(theta(j))/(1 + beta^2*X(j)), j, 1, p)
sage: ED = E(beta).diff(beta) ; ED
-2*beta^2*X(j)^2*sin(theta(j))*D[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)/(beta^2*X(j) + 1)^2 + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


What is the meaning of this ? Especially :


```
sage: ED.operands()[0].operands()[4]
D[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
sage: ED.operands()[0].operands()[4].operator()
D[0](sum)
```


Compare with :


```
sage: E(beta).maxima_methods().diff(beta)
-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


which seems correct,


```
sage: maxima_calculus.diff(E(beta), beta).sage()
-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


(another way to do the same), also correct,


```
sage: mathematica.D(E(beta), beta).sage()
beta*sum(-2*beta*X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)

```


also correct (but simplifiable), and


```
sage: import sympy
sage: sympy.diff(*map(lambda u:u._sympy_(), (E(beta), beta)))
beta*Sum(-2*beta*X(j)**2*sin(theta(j))/(beta**2*X(j) + 1)**2, (j, 1, p)) + Sum(X(j)*sin(theta(j))/(beta**2*X(j) + 1), (j, 1, p))
```


which seems correct, but can't (yet) be translated back to Sage, `Sum` remaining untranslated...

Issue created by migration from https://trac.sagemath.org/ticket/33923





---

archive/issue_comments_478749.json:
```json
{
    "body": "Damn. Duplicate of #32161, which I missed perusing Trac before reporting.\n\nSorry for the noise...",
    "created_at": "2022-05-28T17:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33686#issuecomment-478749",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Damn. Duplicate of #32161, which I missed perusing Trac before reporting.

Sorry for the noise...



---

archive/issue_comments_478750.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-28T17:07:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33686#issuecomment-478750",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_478751.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-08-10T09:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33686#issuecomment-478751",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_478752.json:
```json
{
    "body": "Okay.",
    "created_at": "2022-08-10T09:59:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33686#issuecomment-478752",
    "user": "https://github.com/kwankyu"
}
```

Okay.



---

archive/issue_events_030376.json:
```json
{
    "actor": "@fchapoton",
    "created_at": "2022-08-10T10:06:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33686#event-30376"
}
```



---

archive/issue_comments_478753.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2022-08-10T10:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33686",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33686#issuecomment-478753",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate
