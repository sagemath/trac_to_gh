# Issue 33686: Derivative of a symbolic sum gives nonsensical results.

Issue created by migration from https://trac.sagemath.org/ticket/33923

Original creator: charpent

Original creation time: 2022-05-28 09:06:04

Inspired by this `ask.sagemath.org` [question](https://ask.sagemath.org/question/62451/how-to-symbolic-differentiate-a-sum-of-n-unknown-variables/) :


```
age: var("j, p, beta")
(j, p, beta)
sage: X, theta=function("X, theta")
sage: E(beta)=sum(beta*X(j)*sin(theta(j))/(1 + beta^2*X(j)), j, 1, p)
sage: ED = E(beta).diff(beta) ; ED
-2*beta^2*X(j)^2*sin(theta(j))*D[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)/(beta^2*X(j) + 1)^2 + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


What is the meaning of this ? Especially :


```
sage: ED.operands()[0].operands()[4]
D[0](sum)(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
sage: ED.operands()[0].operands()[4].operator()
D[0](sum)
```


Compare with :


```
sage: E(beta).maxima_methods().diff(beta)
-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


which seems correct,


```
sage: maxima_calculus.diff(E(beta), beta).sage()
-2*beta^2*sum(X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)
```


(another way to do the same), also correct,


```
sage: mathematica.D(E(beta), beta).sage()
beta*sum(-2*beta*X(j)^2*sin(theta(j))/(beta^2*X(j) + 1)^2, j, 1, p) + sum(X(j)*sin(theta(j))/(beta^2*X(j) + 1), j, 1, p)

```


also correct (but simplifiable), and


```
sage: import sympy
sage: sympy.diff(*map(lambda u:u._sympy_(), (E(beta), beta)))
beta*Sum(-2*beta*X(j)**2*sin(theta(j))/(beta**2*X(j) + 1)**2, (j, 1, p)) + Sum(X(j)*sin(theta(j))/(beta**2*X(j) + 1), (j, 1, p))
```


which seems correct, but can't (yet) be translated back to Sage, `Sum` remaining untranslated...


---

Comment by charpent created at 2022-05-28 17:07:41

Damn. Duplicate of #32161, which I missed perusing Trac before reporting.

Sorry for the noise...


---

Comment by charpent created at 2022-05-28 17:07:41

Changing status from new to needs_review.


---

Comment by klee created at 2022-08-10 09:59:18

Changing status from needs_review to positive_review.


---

Comment by klee created at 2022-08-10 09:59:18

Okay.


---

Comment by chapoton created at 2022-08-10 10:06:30

Resolution: duplicate
