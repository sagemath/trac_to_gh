# Issue 34100: Deprecate sage.misc.mrange.*mrange* and cartesian_product_iterator

archive/issues_034100.json:
```json
{
    "body": "CC:  @tscrim\n\nSome of these functions are also imported into the global namespace.\n\nIssue created by migration from https://trac.sagemath.org/ticket/34337\n\n",
    "created_at": "2022-08-10T21:41:49Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Deprecate sage.misc.mrange.*mrange* and cartesian_product_iterator",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34100",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @tscrim

Some of these functions are also imported into the global namespace.

Issue created by migration from https://trac.sagemath.org/ticket/34337





---

archive/issue_comments_483111.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-10T23:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483111",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483112.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-10T23:09:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483112",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483113.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-10T23:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483113",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483114.json:
```json
{
    "body": "This isn't quite a drop-and-replace because it loses the `cardinality()` method and it doesn't allow for repeat iterations.\n\n```\nsage: I = cartesian_product_iterator([[-1, 0, 1] for i in range(1)])\nsage: Ip = itertools.product([-1, 0, 1], repeat=1)\nsage: list(I)\n[(-1,), (0,), (1,)]\nsage: list(I)\n[(-1,), (0,), (1,)]\nsage: list(Ip)\n[(-1,), (0,), (1,)]\nsage: list(Ip)\n[]\n```\n\nThis could potentially cause subtle changes in behavior. Granted, an object that wants it to behave like a parent should be a `cartesian_product`. All of your changes here look good (I know it is not yet ready for review), but I am just giving a slight bit of caution with the deprecation.\n\n----\n\nDigressing, it can be interesting when we dig into code like this that we find things like\n\n```diff\n-g = [[] for _ in itertools.repeat(None, len(m))]\n+g = [[] for _ in range(len(m))]\n```\n\n\n```diff\n-alpha = sum([True for x in itertools.product(range(4), repeat=j_form.dim()) if j_form(x) == 0])\n+alpha = sum(1 for x in itertools.product(range(4), repeat=j_form.dim()) if j_form(x) == 0)\n```\n\nthat could be improved.",
    "created_at": "2022-08-11T00:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483114",
    "user": "https://github.com/tscrim"
}
```

This isn't quite a drop-and-replace because it loses the `cardinality()` method and it doesn't allow for repeat iterations.

```
sage: I = cartesian_product_iterator([[-1, 0, 1] for i in range(1)])
sage: Ip = itertools.product([-1, 0, 1], repeat=1)
sage: list(I)
[(-1,), (0,), (1,)]
sage: list(I)
[(-1,), (0,), (1,)]
sage: list(Ip)
[(-1,), (0,), (1,)]
sage: list(Ip)
[]
```

This could potentially cause subtle changes in behavior. Granted, an object that wants it to behave like a parent should be a `cartesian_product`. All of your changes here look good (I know it is not yet ready for review), but I am just giving a slight bit of caution with the deprecation.

----

Digressing, it can be interesting when we dig into code like this that we find things like

```diff
-g = [[] for _ in itertools.repeat(None, len(m))]
+g = [[] for _ in range(len(m))]
```


```diff
-alpha = sum([True for x in itertools.product(range(4), repeat=j_form.dim()) if j_form(x) == 0])
+alpha = sum(1 for x in itertools.product(range(4), repeat=j_form.dim()) if j_form(x) == 0)
```

that could be improved.



---

archive/issue_comments_483115.json:
```json
{
    "body": "Thanks. Yes, there are lots of details to be checked. I'm running the doctests and have found a few things already that need to be revised.",
    "created_at": "2022-08-11T00:10:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483115",
    "user": "https://github.com/mkoeppe"
}
```

Thanks. Yes, there are lots of details to be checked. I'm running the doctests and have found a few things already that need to be revised.



---

archive/issue_comments_483116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T00:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483116",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483117.json:
```json
{
    "body": "One interesting use is in `number_field_ideal_rel`: It tries to use `iter_list` from the absolute field",
    "created_at": "2022-08-11T00:36:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483117",
    "user": "https://github.com/mkoeppe"
}
```

One interesting use is in `number_field_ideal_rel`: It tries to use `iter_list` from the absolute field



---

archive/issue_comments_483118.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T01:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483118",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483119.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T02:46:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483119",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T02:48:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483121.json:
```json
{
    "body": "The second interesting use is in `skew_polynomial_finite_field`\n\n```\n            rng = xmrange_iter([kfixed]*degN, center)\n            for i in range(m):\n                for pol in xmrange_iter([rng]*i):\n                    f = skew_ring.one()\n```\n\nThis won't work when `rng` is changed to a generator",
    "created_at": "2022-08-11T03:06:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483121",
    "user": "https://github.com/mkoeppe"
}
```

The second interesting use is in `skew_polynomial_finite_field`

```
            rng = xmrange_iter([kfixed]*degN, center)
            for i in range(m):
                for pol in xmrange_iter([rng]*i):
                    f = skew_ring.one()
```

This won't work when `rng` is changed to a generator



---

archive/issue_comments_483122.json:
```json
{
    "body": "This likely comes from not being able to \"restart\" the generator. Although you might not need it defined outside of the inner `for` loop.",
    "created_at": "2022-08-11T03:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483122",
    "user": "https://github.com/tscrim"
}
```

This likely comes from not being able to "restart" the generator. Although you might not need it defined outside of the inner `for` loop.



---

archive/issue_comments_483123.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-11T03:17:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483123",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_483124.json:
```json
{
    "body": "Except for comment:10, comment:14, and the use in `CartesianProduct_iters` (which needs `len`), all other uses were trivial to replace.",
    "created_at": "2022-08-11T03:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483124",
    "user": "https://github.com/mkoeppe"
}
```

Except for comment:10, comment:14, and the use in `CartesianProduct_iters` (which needs `len`), all other uses were trivial to replace.



---

archive/issue_comments_483125.json:
```json
{
    "body": "Best to make this dependent on #19195, which will deprecate `CartesianProduct_iters`",
    "created_at": "2022-08-11T03:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483125",
    "user": "https://github.com/mkoeppe"
}
```

Best to make this dependent on #19195, which will deprecate `CartesianProduct_iters`



---

archive/issue_comments_483126.json:
```json
{
    "body": "Help with the remaining ones is welcome",
    "created_at": "2022-08-11T03:30:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34100",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34100#issuecomment-483126",
    "user": "https://github.com/mkoeppe"
}
```

Help with the remaining ones is welcome
