# Issue 20286: Upgrade R to 3.3.0

Issue created by migration from https://trac.sagemath.org/ticket/20523

Original creator: charpent

Original creation time: 2016-04-30 09:48:26

CC:  tscrim embray gouezel jpflori

Keywords: r-project

Usual reason...

This one is a bit more complicated than usual : the Windows toolchain has changed ; however, I do not have a Windows system to test this.

Plan :
* Update to 3.3.0RC, test it on Linux.
* Mark it as "needs review", and specifically ask for review on a Windows (cygwin ?) system.
* Accounting for feedback about the Windows build, update to 3.3.0 (announced for May 3, 2016).
* Put that (definitive) version up for review.

The RC version is [here](https://cran.r-project.org/src/base-prerelease/R-rc_2016-04-28_r70564.tar.gz).


---

Comment by tscrim created at 2016-04-30 15:39:59

cc-ing the !Windows/Cygwin people.


---

Comment by embray created at 2016-05-02 09:15:02

What is the best process for testing a new dependency update?


---

Comment by charpent created at 2016-05-05 17:33:02

I have to forfeit on this one, or at least delay for one eek minimum (RealLife overflow + ill health).

BTW, it seems that //some // of our current patches were created only for cygwin environment : I am unable to retrieve their necessity. Could their authors mtell me if they encountered their use in a Unix (Linux) environment ?

Sorry...


---

Comment by jpflori created at 2016-05-09 10:01:04

It seems that only the `large_address_aware` patch is cygwin-only, upstream report:
* https://bugs.r-project.org/bugzilla/show_bug.cgi?id=15643
The other patches look general purpose.


---

Comment by charpent created at 2016-08-20 07:28:51

I've got some nonmaskable RealLife interruptions, seriously interfering with my plans. Sorry for the delay.

I updated the description to reflect the current plans.


---

Comment by charpent created at 2016-08-20 11:07:44

Changing status from new to needs_review.


---

Comment by charpent created at 2016-08-20 11:07:44

The proposed patch seems valid on Linux : it passes ptestlong with errors in two doctests :

```
----------------------------------------------------------------------
sage -t --long --warn-long 109.1 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 109.1 src/sage/misc/trace.py  # 1 doctest failed
----------------------------------------------------------------------
```

which both pass when run standalone :

```
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.1 src/sage/misc/trace.py
Running doctests with ID 2016-08-20-12-45-47-583c0f71.
Git branch: t/20523/upgrade_r_to_3_3_1
Using --optional=database_gap,mpir,python2,sage,sage_mode
Doctesting 1 file.
sage -t --long --warn-long 109.1 src/sage/misc/trace.py
    [9 tests, 1.79 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1.8 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 1.8 seconds
charpent@asus16-ec:/usr/local/sage-7$ sage -t --long --warn-long 109.1 src/sage/homology/simplicial_complex.py
Running doctests with ID 2016-08-20-12-46-08-790dac8d.
Git branch: t/20523/upgrade_r_to_3_3_1
Using --optional=database_gap,mpir,python2,sage,sage_mode
Doctesting 1 file.
sage -t --long --warn-long 109.1 src/sage/homology/simplicial_complex.py
    [588 tests, 6.39 s]
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 6.5 seconds
    cpu time: 3.0 seconds
    cumulative wall time: 6.4 seconds
```


I have had this kind of hiccups since about 7.2 ; reports (on sage-release, mainly) did not alarm the release maintainers ; one of them has generated a tick.

Note that the `large_address_aware` has been lost : R 3.3.1 no longer has cygwin-specific sections in configure.ac or Makefile.in (and therefore nothing to patch) ; maybe the cygwin-relevant problems have been fixed upstream ?

I don't have a Windows machine to port Sage to ; I leave this problem to people better(?) equipped than me.
----
New commits:


---

Comment by charpent created at 2016-08-20 13:56:18

On the other hand, I found this in the current [R Installation and Administration Manual](https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Cygwin) :

> C.8 Cygwin
> 
> The 32-bit version has never worked well enough to pass R’s make check, and residual support from
> earlier experiments was removed in R 3.3.0.
> 
> The 64-bit version is completely unsupported.

Maybe we should consider to have rather an interface to system's R and make it an optional package ?

I'll broach this subject open on sage-devel (not r-devel, as I wrote incorrectly the first time...).


---

Comment by tscrim created at 2016-08-21 15:49:39

I get a failure trying to install this on Cygwin32 with

```
checking for lzma_version_number in -llzma... no
configure: error: "liblzma library and headers are required"
Error configuring R.
```

which is the same failure I had on #20190.


---

Comment by charpent created at 2016-08-22 10:23:09

Replying to [comment:9 tscrim]:
> I get a failure trying to install this on Cygwin32 with
> {{{
> checking for lzma_version_number in -llzma... no
> configure: error: "liblzma library and headers are required"
> Error configuring R.
> }}}
> which is the same failure I had on #20190.

From [the R 3.3.0 release notes](https://cran.r-project.org/doc/manuals/r-release/NEWS.html) :

>  The previously included versions of zlib, bzip2, xz and PCRE have been removed, so suitable external (usually system) versions are required (see the ‘R Installation and Administration’ manual).

So it's either :
* add xz-tools (né lzma-utils) to the list of prerequisites for Sage (i. e. relying on system's liblzma) ;
* adding xz-tools (at least the lzma library) to sage (cluttering it with yet one more library to maintain) ;
* or relying on system's R through an interface that remains to be written...

Pick your poison...

NB : I also post this on sage-devel in the recent R thread...


---

Comment by embray created at 2016-08-22 10:53:21

On Cygwin I needed to `apt-cyg install liblzma-devel` (if you have `apt-cyg`, otherwise use setup as normal).  Without the `-devel` package it doesn't install the import library, so `-llzma` doesn't work (`-llzma.dll` should though).


---

Comment by charpent created at 2016-08-23 08:58:36

Replying to [comment:11 embray]:
> On Cygwin I needed to `apt-cyg install liblzma-devel` (if you have `apt-cyg`, otherwise use setup as normal).  Without the `-devel` package it doesn't install the import library, so `-llzma` doesn't work (`-llzma.dll` should though).

Okay. I just checked on my (Linux) system : xz is not installed in the $(SAGE_ROOT) tree, probably because I have it installed at system level and the build script detects that somehow. (BTW : it is an *optional* package.

Therefore, what is needed is :
a. ensure that xz //and its development files// are installed, either in the system or in the Sage package) ;
b. that this is done //before// the R installation begins ; and
c. that R installation //depends// on xz being somehow available.

This can be simplified, at the expense of making xz a //standard// package, just by ensuring that xz is installed //before// R compilation.

I have little idea on how to proceed, since the Sage build system is still a (large) bit obscure to me. What I need is a way to check in the Makefile that xz and its development files are available, install xz if not (can an optional package be installed before the compilation of standard packages is finished ?), and make the R compilation dependent on this target.

Any ideas ?

(BTW : Cc on the sage-devel thread for advice...)


---

Comment by leif created at 2016-08-23 23:41:24

You IMHO shouldn't change patches which haven't changed at all, that's just confusing.  I wouldn't even touch patches where just the offset changed, not the context.


---

Comment by jpflori created at 2016-08-24 07:53:53

I'm working on this, especially on Cygwin as I resetuped a Cygwin install for other tickets at SD75.


---

Comment by charpent created at 2016-08-30 09:41:18

Please see [this post](https://groups.google.com/d/msg/sage-devel/KYq9AV5ZTUk/1gdvX33_BgAJ) on `sage-devel`'s discussion of this topic. I need comments from people not as concerned as we are by Sage's R's future...

Jean-Pierre : did you consider repackaging (bnew style) the old pcre package ?


---

Comment by jpflori created at 2016-08-30 15:40:31

Nope I did not yet.
I mostly made a clean set of patches.


---

Comment by jpflori created at 2016-08-31 08:03:19

I updated the set of patches.
I also slightly modiifed the options passed to `configure` in `spkg-install`.

We still need to deal with the new dependencies.
It seemed to me that on top of `libpcre`, `R` also depends on `libcurl`...
----
New commits:


---

Comment by jpflori created at 2016-08-31 08:04:54

`libcurl` is needed according to:
* https://cran.r-project.org/doc/manuals/r-release/R-admin.html#Essential-and-useful-other-programs-under-a-Unix_002dalike


---

Comment by leif created at 2016-08-31 12:32:07

The Cygwin patches to `main/Makefile.in` as well as  `nmath/standalone/Makefile.in`, and `etc/Makeconf.in` have effects on non-Cygwin as well.

In the first two, the folder is changed unconditionally, the third may lead to overlinking on non-Cygwin.

I also don't like removing the documentation from `SPKG.txt`; at the very least, the patch descriptions should get copied into the patches.  Renaming them IMHO isn't necessary either.

The patches have funny permissions; while you chmoded _some_ a-x, the new ones again have u=rwx and go=rx.

In `spkg-install`, the lines with options to configure aren't consistently indented (in the diff at least => tabs vs. spaces used).


---

Comment by leif created at 2016-08-31 12:39:25

Replying to [comment:19 leif]:
> In `spkg-install`, the lines with options to configure aren't consistently indented.

... and `--enable-R-shlib` is redundant, as it has already been added to `R_CONFIGURE` a couple of lines above.


---

Comment by jpflori created at 2016-08-31 16:07:11

I'll take your comments into account or gve some justification here.


---

Comment by jpflori created at 2016-09-01 07:58:19

Replying to [comment:19 leif]:
> The Cygwin patches to `main/Makefile.in` as well as  `nmath/standalone/Makefile.in`, and `etc/Makeconf.in` have effects on non-Cygwin as well.
>
 
> In the first two, the folder is changed unconditionally, the third may lead to overlinking on non-Cygwin.
Well spotted, I did not pay attention on that part.

From what I saw there was underlinking in all cases, I don't see how Cygwin or non-Cygwin can change anything but I'll double check.

Anyway I'll only apply this two only coniditonally.
> 
> I also don't like removing the documentation from `SPKG.txt`; at the very least, the patch descriptions should get copied into the patches.  Renaming them IMHO isn't necessary either.
From what I remember there seemed to be a consensus on putting doc in patches themselves to modify a minimum set of files when adding/removing patches.
Although each patch now has some info, I'll add more from what was removed from SPKG.txt.

> 
> The patches have funny permissions; while you chmoded _some_ a-x, the new ones again have u=rwx and go=rx.
Windows funky choice, I'll fix it.
> 
> In `spkg-install`, the lines with options to configure aren't consistently indented (in the diff at least => tabs vs. spaces used).
I removed all tabs.


---

Comment by git created at 2016-09-01 08:38:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2016-10-02 15:52:26

On top of 6.4beta6+#21622 (now necessary to build Sage on Debian), this patch passes `ptestlong` with two failures :


```
----------------------------------------------------------------------
sage -t --long --warn-long 111.2 src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long --warn-long 111.2 src/sage/libs/gap/assigned_names.py  # 1 doctest failed
----------------------------------------------------------------------
```


Both of them pass standalone. This kind of failure is a known, iterative (and annoying) problem, probably pertaining to the test infrastructure rather than to your patch.

I am sorely tempted to set this to `positive_review`, but I think that thios must be tested by someone testing it on Cygwin, given the changes in the R toolset on Windows.

Let me know if you think this is sufficient.


---

Comment by jpflori created at 2016-10-03 12:09:26

Replying to [comment:24 charpent]:
> On top of 6.4beta6+#21622 (now necessary to build Sage on Debian), this patch passes `ptestlong` with two failures :
> 
> {{{
> ----------------------------------------------------------------------
> sage -t --long --warn-long 111.2 src/sage/homology/simplicial_complex.py  # 1 doctest failed
> sage -t --long --warn-long 111.2 src/sage/libs/gap/assigned_names.py  # 1 doctest failed
> ----------------------------------------------------------------------
> }}}
> 
> Both of them pass standalone. This kind of failure is a known, iterative (and annoying) problem, probably pertaining to the test infrastructure rather than to your patch.
> 
> I am sorely tempted to set this to `positive_review`, but I think that thios must be tested by someone testing it on Cygwin, given the changes in the R toolset on Windows.
I tested that R with the patches shipped here buids on Cygwin, though not from a Sage env.
> 
> Let me know if you think this is sufficient.
IMHO this is largely sufficient as far as Cygwin is concerned.
If by any chance there are some residual side effects on Cygwin they be fixed on follow up tickets.

More of a concern is the dependency on new packages...
Can we list them here and I can try to package them:
* libpcre
* libcurl
* anything else?


---

Comment by charpent created at 2016-10-03 19:25:18

Changing status from needs_review to positive_review.


---

Comment by charpent created at 2016-10-03 19:25:18

Replying to [comment:25 jpflori]:

[ ... ]
> IMHO this is largely sufficient as far as Cygwin is concerned.
> If by any chance there are some residual side effects on Cygwin they be fixed on follow up tickets.

Okay : `positive review`. BTW, I think that you are the main (first) author...

> More of a concern is the dependency on new packages...
> Can we list them here and I can try to package them:
> * libpcre
> * libcurl
> * anything else?

* xz-tools.

Possible strategy :
 1) For now, list them as supplementary dependencies in the main README.TXT.

 2) Create a set of tickets to include them in Sage. These packages shuld test for existim system functionality and, if found, do nothong (how to achieve this in a Makefile ?)

 3) When those tickets are tested and positively reviewed, make them standard packages, and prerequisites for R. This pulls them off the list of prerequisites.

This way, we can buy time...

BTW : Curl and xz-tools are tools of sufficient "general" interest that we should package the whole things (i. e. binaries and docs (but maybe not test utilities ?)), not just the libraries. And add the binaries to the list of candidates for `small_scripts` making them accessible systemwide.


---

Comment by vbraun created at 2016-10-22 19:52:29

Hard dependency on lzma

```
checking for lzma_version_number in -llzma... no
configure: error: "liblzma library and headers are required"
Error configuring R.
```



---

Comment by vbraun created at 2016-10-22 19:52:29

Changing status from positive_review to needs_work.


---

Comment by charpent created at 2016-10-23 06:49:07

`lzma` is already available through the optional `xz` package. I opened #21744 to this order.

Trivial patch to follow...


---

Comment by git created at 2016-10-24 06:05:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2016-10-24 07:43:22

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2016-10-24 07:43:22

#20523 (present patch) + #21744 pass ptestlong successfully over both 7.4 and 7.5beta0.

==>`needs_review`

Note : I suspect that we may have to do likewise for `pcre ` and `curl`. I shall package them, and open tickets to get them included as standard packages as the need arises.


---

Comment by jpflori created at 2016-10-27 10:40:11

We need to clarify the curl and openssl issues.


---

Comment by jpflori created at 2016-10-27 10:40:11

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2016-10-27 13:07:02

The good news is that R compiles against an ssl-free libcurl when configure is hacked.
And it seems that nothing that fails in the test suite is related to this lacking feature.

Not sure how it affects usability though.


---

Comment by charpent created at 2016-10-27 15:54:40

Replying to [comment:32 jpflori]:

> Not sure how it affects usability though.

Hah ! Most R repositories are switching to https:... addresses (this shown where trying to install a package without having defined a repository first : the graphical interface propose firs a list of repositories with https: addresses ; the only way to reach an http: repository is to click on the last item in that menu, which gives another list of http: repositories.

The move to such repositories parallels a similar move from various distros (starting with Debian...). I doubt that this will get reversed, and I think that, one way or another, Sage's R must keep the ability to use https:

This is true (with aggravation) of other uses of networking in applied statistics : access to remote databases is more and more frequent, and I do not see these uses accept insecure channels for a long time...


---

Comment by charpent created at 2016-11-29 18:41:50

Changing target to 3.3.2. Meanwhile, experimenting.

Still waiting for advice (see sage-devel's sagas)...


---

Comment by git created at 2016-12-01 20:40:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2016-12-01 21:00:56

Minimal adjustments (package version + checksum) + fixed a couple of failing doctests due to R's change of representation of function source code.

These doctests might be usefully augmented by a doctest of a real R function. This doesn't seem to have ever been doctested. Advice ?

The resulting Sage (after merging with 7.5beta4) passes ptestlong with two transient failures (which pass with no errors when ran standalone).

The question of the new dependencies is still open (no answer to sage-devel's questions).


---

Comment by git created at 2017-02-18 17:20:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-02-18 17:35:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-02-18 18:16:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-02-18 22:08:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-02-19 04:48:01

Sage-7.6.beta4 + #20523 (this patch) + #21767 + #21770 passes ptestlong witht two transient errors :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_set_morphism.py  # Bad exit: 2
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```

Both tests pass when run standalone.

This should close the R saga (for now) by allowing the current interfaces to work with R >= 3.3.x.

==>`needs_review`


---

Comment by charpent created at 2017-02-19 04:48:01

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2017-02-19 23:42:43

the branch is red - you need a rebase or so...


---

Comment by git created at 2017-02-20 09:30:37

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by charpent created at 2017-02-20 09:33:06

Rebased on develop at 7.6.beta4


---

Comment by dimpase created at 2017-02-20 09:42:52

A branch dependent on unmerged/under review tickets ought to include all of them, otherwise you leave it to the reviewer to do merges that might potentially be nontrivial.


---

Comment by charpent created at 2017-02-20 09:48:31

Replying to [comment:45 dimpase]:
> A branch dependent on unmerged/under review tickets ought to include all of them, otherwise you leave it to the reviewer to do merges that might potentially be nontrivial.

If I understand you correctly,we should either :

a. merge #21767 and #21770 into develop, **then** merge #20523 ; **OR**
b. add the contents of #21767 an #21770 into #20523

1. Is this correct ?
2. What do you recommend ?


---

Comment by dimpase created at 2017-02-20 09:59:16

I don't see a difference. Essentially it is as follows.

```
git checkout -b newrrr develop
git pull trac public/curl7510
git pull trac u/charpent/package_libpcre_as_a_standard_package
git pull trac public/r311
git push trac --set-upstream HEAD:public/r311
```

(not sure  if the last `push` needs `-f` or not).

It's also a question whether these 3 branches commute, so that these 3 `pull` all go through without manual intervention.


---

Comment by git created at 2017-02-20 12:17:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by charpent created at 2017-02-20 12:28:34

Done. Added tarballs for curl and pcre, dropped the corresponding ticket dependencies.

`ptestlong` running.
----
Last 10 new commits:


---

Comment by charpent created at 2017-02-20 14:39:50

Passes `ptestlong` with the usual :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
----------------------------------------------------------------------
```


which passes standalone.

==> Still `needs_review`


---

Comment by dimpase created at 2017-02-20 18:45:41

Why have you removed #21767 and #21770 from dependencies?
You have merged parts of them here, thus, certainly, they are dependencies, and should be reviewed before this one!


---

Comment by charpent created at 2017-02-20 19:07:50

Replying to [comment:51 dimpase]:
> Why have you removed #21767 and #21770 from dependencies?

Because any modification they bringed is made here.

> You have merged parts

Parts ? I do not understand. Unless I'l seriously mistaken abut what git does, any modification resulting from these branches will be effected here.

> of them here, thus, certainly, they are dependencies, and should be reviewed before this one!

Again, I do  not understand : if any part of them is defective, it should be fixed, and this fix re-merged here. What is the point ?

These questions are **not** rhetorical : I really do not understand your point.


---

Comment by charpent created at 2017-02-20 19:53:57

I have asked for invalidation of #21767 and #21770 n their respective tickets (can't do that myself...).


---

Comment by tscrim created at 2017-02-20 19:56:43

They can (and should) be considered separate/independent issues deserving their own tickets. So I would reinstate them as dependencies here because they need to be handled first.

(PS: While I agree with Dima that it is a very good practice to merge in your dependencies, it is not strictly necessary.)


---

Comment by charpent created at 2017-02-20 20:06:00

Replying to [comment:54 tscrim]:
> They can (and should) be considered separate/independent issues deserving their own tickets. So I would reinstate them as dependencies here because they need to be handled first.


<Sigh> Why didn't you say so first ... </Sigh>

> (PS: While I agree with Dima that it is a very good practice to merge in your dependencies, it is not strictly necessary.)

I tried to follow the guidelines of the Developer's guide that aim to break a large issue in smaller, independent ones. Merging one ticket into another implies review of the same patches *twice*.

I didn't see Dima's point but understood the aim of consistency. Now, I am lost. Do you really want two reviews of the same code ?

I'll wait for your answer before cancelling my invalidation requests and re-adding the dependencies. After all, these tickets were ready for reviews only four and three months ago...


---

Comment by tscrim created at 2017-02-20 20:18:52

Replying to [comment:55 charpent]:
> Replying to [comment:54 tscrim]:
> > They can (and should) be considered separate/independent issues deserving their own tickets. So I would reinstate them as dependencies here because they need to be handled first.
> 
> 
> <Sigh> Why didn't you say so first ... </Sigh>

Sorry I didn't chime in sooner.

> > (PS: While I agree with Dima that it is a very good practice to merge in your dependencies, it is not strictly necessary.)
> 
> I tried to follow the guidelines of the Developer's guide that aim to break a large issue in smaller, independent ones. Merging one ticket into another implies review of the same patches *twice*.
> 
> I didn't see Dima's point but understood the aim of consistency. Now, I am lost. Do you really want two reviews of the same code ?

It won't be two reviews of the same code. Only the difference from this code and the dependencies will need to be reviewed.


---

Comment by charpent created at 2017-02-20 20:31:22

Replying to [comment:56 tscrim]:

[ Snip... ]

> > I didn't see Dima's point but understood the aim of consistency. Now, I am lost. Do you really want two reviews of the same code ?
> 
> It won't be two reviews of the same code. Only the difference from this code and the dependencies will need to be reviewed.

I'm not sure to understand this either....

Okay. I'll reinstate dependencies, unmark my invalidation requests.

And fix a possible issue I just spotted (patches on Cygwin).

Marking this as `needs_work` for now.


---

Comment by charpent created at 2017-02-20 20:31:22

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-02-20 20:41:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-02-20 20:44:09

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2017-02-20 20:44:09

`needs_review` again.
----
New commits:


---

Comment by charpent created at 2017-03-14 10:51:04

R 3.3.3 is out (and has been for one week...). I intend to update this ticket.

This shouldn't refrain potential reviewers to review #21767 an #21770, which do not seem to need an update.


---

Comment by charpent created at 2017-03-14 10:51:04

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-03-14 16:34:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-03-14 16:39:29

Compiles cleanly. Updated ticket title and tarball pointer.

Formal tests to come (on a decent machine). Tonight ?


---

Comment by charpent created at 2017-03-14 22:52:44

Changing status from needs_work to needs_review.


---

Comment by charpent created at 2017-03-14 22:52:44

This version :
* Compiles cleanly.
* passes ptestlong with :

```
----------------------------------------------------------------------
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
sage -t --long src/sage/combinat/rigged_configurations/tensor_product_kr_tableaux_element.py  # Bad exit: 2
sage -t --long src/sage/modular/arithgroup/arithgroup_generic.py  # Bad exit: 2
----------------------------------------------------------------------
```


The first one is a well-known difference of expression of the ideal of a multivariable polynopial, already subject of a ticket.

The last two are transient errors : these tests pass when ran standalone. Race conditions ?

* Passes its own test suite.

==>`needs_review`.


---

Comment by dimpase created at 2017-03-15 12:59:49

how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)


---

Comment by dimpase created at 2017-03-15 13:02:29

something funny is going on on OSX here, it builds with `clang` (OSX's "native" compiler) rather than with `gcc`. Is this a bug in our package, or this is on purpose?


---

Comment by charpent created at 2017-03-15 13:59:40

Replying to [comment:64 dimpase]:
> how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)

as far as I understand, it's managed in R's main .configure script.


---

Comment by charpent created at 2017-03-15 14:05:42

Replying to [comment:65 dimpase]:
> something funny is going on on OSX here, it builds with `clang` (OSX's "native" compiler) rather than with `gcc`. Is this a bug in our package, or this is on purpose?

I dunno. Being Macless, I can't test it. That may be under governance of R's configure.

As far as I understand, one might force CC to be Sage's gcc rather than the default clang (I do not know Macs enough to know if this is mandatory or even useful to run with Sage). If so, a Mac-specific patch to spkg-install should be (relatively) trivial.

ISTR that R has some Fortran libraries. What happens on Macs when clang is used ?

HTH,


---

Comment by dimpase created at 2017-03-15 14:48:16

Replying to [comment:66 charpent]:
> Replying to [comment:64 dimpase]:
> > how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)
> 
> as far as I understand, it's managed in R's main .configure script.

my question is rather how do I test that they work?


---

Comment by dimpase created at 2017-03-15 14:57:55

Replying to [comment:67 charpent]:
> Replying to [comment:65 dimpase]:
> > something funny is going on on OSX here, it builds with `clang` (OSX's "native" compiler) rather than with `gcc`. Is this a bug in our package, or this is on purpose?
> 
> I dunno. Being Macless, I can't test it. That may be under governance of R's configure.
> 
> As far as I understand, one might force CC to be Sage's gcc rather than the default clang (I do not know Macs enough to know if this is mandatory or even useful to run with Sage). If so, a Mac-specific patch to spkg-install should be (relatively) trivial.

I think this should be fixed.

it might be problematic to use C++ libraries compiled with `gcc` with anything compiled with `clang`. While R itself does not need C++ for building, one can have an R extension that does, and this might lead to troubles...

> 
> ISTR that R has some Fortran libraries. What happens on Macs when clang is used ?
It uses `gfortran` for Fortran, still.


---

Comment by jhpalmieri created at 2017-03-15 15:10:57

Replying to [comment:65 dimpase]:
> something funny is going on on OSX here, it builds with `clang` (OSX's "native" compiler) rather than with `gcc`. Is this a bug in our package, or this is on purpose?

From the `spkg-install` file:

```
    if [ $MACOSX_VERSION -ge 16 ]; then
        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
        CC=clang
    fi
```

This is from #21567.


---

Comment by dimpase created at 2017-03-15 15:20:22

Replying to [comment:70 jhpalmieri]:
> Replying to [comment:65 dimpase]:
> > something funny is going on on OSX here, it builds with `clang` (OSX's "native" compiler) rather than with `gcc`. Is this a bug in our package, or this is on purpose?
> 

> This is from #21567.

OK, I see. I didn't follow this closely enough. No issue then here.


---

Comment by charpent created at 2017-03-15 15:43:43

Replying to [comment:68 dimpase]:
> Replying to [comment:66 charpent]:
> > Replying to [comment:64 dimpase]:
> > > how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)
> > 
> > as far as I understand, it's managed in R's main .configure script.
> 
> my question is rather how do I test that they work?

From R, trivially :
* file.download("http://Url-of-soime-file-you-are-sure-in-exists", method="curl") ## libcurl
* grep("Some.*funny.*pattern", SomeCharVector, perl=TRUE) ## libpcre

This might be docscripted. Problems :
* Find a file whose existence is certain
* Mark the curl doctest as "internet", on order not to execute it in automated tests (that might run on an unconnected achine).
* Find some nice pattern where the Perl-compatible matching *differs* from the standard one...

HTH,


---

Comment by dimpase created at 2017-03-15 15:57:22

Replying to [comment:72 charpent]:
> Replying to [comment:68 dimpase]:
> > Replying to [comment:66 charpent]:
> > > Replying to [comment:64 dimpase]:
> > > > how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)
> > > 
> > > as far as I understand, it's managed in R's main .configure script.
> > 
> > my question is rather how do I test that they work?
> 
> From R, trivially :
> * `file.download("http://Url-of-soime-file-you-are-sure-in-exists", method="curl") ## libcurl`

OK, I'll check this.

> * `grep("Some.*funny.*pattern", SomeCharVector, perl=TRUE) ## libpcre`

I don't know R, so this one look too cryptic. Could you provide a concrete example?

> 
> This might be docscripted. Problems :
> * Find a file whose existence is certain

how about 
`http://www.sagemath.org/index.html` ?

> * Mark the curl doctest as "internet", on order not to execute it in automated tests (that might run on an unconnected achine).
> * Find some nice pattern where the Perl-compatible matching *differs* from the standard one...

really no idea what you mean here exactly...


---

Comment by charpent created at 2017-03-15 16:31:50

I forgot the obvious :

```
> extSoftVersion()["PCRE"]
             PCRE 
"8.39 2016-06-14" 
> capabilities()["libcurl"]
libcurl 
   TRUE 
```


Not knowing Perl-compatible regular expressin, I'll have to think a bit about a good example...


---

Comment by dimpase created at 2017-03-15 16:46:09

Replying to [comment:74 charpent]:
> I forgot the obvious :
> {{{
> > extSoftVersion()["PCRE"]
>              PCRE 
> "8.39 2016-06-14" 
> > capabilities()["libcurl"]
> libcurl 
>    TRUE 
> }}}
> 
aren't these just perfect to make doctests?


---

Comment by charpent created at 2017-03-15 16:49:04

Replying to [comment:74 charpent]:
> I forgot the obvious :
> {{{
> > extSoftVersion()["PCRE"]
>              PCRE 
> "8.39 2016-06-14" 
> > capabilities()["libcurl"]
> libcurl 
>    TRUE 
> }}}
> 

> Not knowing Perl-compatible regular expressin, I'll have to think a bit about a good example...

Try that :

```
> gsub("abc([[:alpha:]]*)def","\\U\\1","abcxyzdef")
[1] "Uxyz"
> gsub("abc([[:alpha:]]*)def","\\U\\1","abcxyzdef",perl=TRUE)
[1] "XYZ"
```



---

Comment by charpent created at 2017-03-15 16:55:28

Replying to [comment:75 dimpase]:
> Replying to [comment:74 charpent]:
> > I forgot the obvious :
> > {{{
> > > extSoftVersion()["PCRE"]
> >              PCRE 
> > "8.39 2016-06-14" 
> > > capabilities()["libcurl"]
> > libcurl 
> >    TRUE 
> > }}}
> > 
> aren't these just perfect to make doctests?

Not really : these just test for the //presence// of the software. Downloading a //real// file, or the example I just cooked for PCRE, ensure that the software works //as expected//. Of course, I checked that these packages pass their own testsuite.

Note : I'll have to learn how to make a doctest, somewhere in the Sages's "r" documentation. Later ? Now, I'm just a bit overwhelmed (RealLife(TM) is sometimes a bitch...).


---

Comment by charpent created at 2017-03-15 17:05:58

* Passes its own testsuite.
* (#21567 + #21770 + #20523 remerged with the two previous ones) passes ptestlong with two failures :

```
----------------------------------------------------------------------
sage -t --long src/sage/homology/simplicial_complex.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 1 doctest failed
----------------------------------------------------------------------
```


The first one is transient (passes when ran standalone) ; the second one is a well-documented, ticketed (#21884) and not yet fixed difference on the expression of the expected result.

Should I upload my local branch for #20523 (this patch) ? I think so, and will do so unless someone stops me in the next half hour...


---

Comment by git created at 2017-03-15 17:45:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by charpent created at 2017-03-15 17:55:38

Replying to [comment:79 git]:

[ ... ]

* Uploaded the merged result.
* Updated tarballs

==> `needs_review` for good.


---

Comment by jdemeyer created at 2017-03-15 19:19:38

I'm currently testing this on OS X.


---

Comment by jdemeyer created at 2017-03-15 19:31:39


```
configure: error: libcurl >= 7.28.0 library and headers are required with support for https
Error configuring R.
```



---

Comment by jdemeyer created at 2017-03-15 19:31:39

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2017-03-15 19:52:25

openssl/OS X drama...


---

Attachment

Remove check for https support in curl.


---

Comment by jpflori created at 2017-03-15 19:54:38

Feel free to use the patch.


---

Comment by dimpase created at 2017-03-15 19:55:30

It did build for me on OSX  (not the current branch, I didn't try it yet, the one around comment 70).


---

Comment by dimpase created at 2017-03-15 19:56:51

if we build this with `clang` on OSX anyway, can we build with OpenSSL support, no?


---

Comment by jpflori created at 2017-03-15 20:04:37

R does not need OpenSSL directly.
It just wants curl to have been built with https support.


---

Comment by dimpase created at 2017-03-15 20:11:43

Replying to [comment:87 jpflori]:
> R does not need OpenSSL directly.
> It just wants curl to have been built with https support.
and is this possible to achieve without dirty hacks (i.e. not using ssl headers hidden deeply in Xcode in some location that is not stable) ?


---

Comment by jpflori created at 2017-03-16 08:22:50

Not sure... and I'm not very inclined on working on this right now.

But if we were to include the patch removing the check we'll get a compiling though with less feature solution.
If you think that's a good idea, I can inlcude it in the branch.


---

Comment by dimpase created at 2017-03-16 09:18:00

Replying to [comment:89 jpflori]:
> Not sure... and I'm not very inclined on working on this right now.
> 
> But if we were to include the patch removing the check we'll get a compiling though with less feature solution.
> If you think that's a good idea, I can inlcude it in the branch.

Using `clang`, `curl` can be built with `--with-darwinssl` on OSX. This does use Apple's replacement for `openssl`. (doesn't work with gcc as it needs support for Apple's blocks extension for C). Should we do this?


---

Comment by jpflori created at 2017-03-16 09:38:11

Good idea as well.

But I still think we should include the patch to be able to build Sage without ssl.


---

Comment by jpflori created at 2017-03-16 09:38:44

`@`dima: can you open another ticket for building curl with clang and the right option on OS X?


---

Comment by charpent created at 2017-03-16 09:40:13

Replying to [comment:90 dimpase]:
> Replying to [comment:89 jpflori]:
> > Not sure... and I'm not very inclined on working on this right now.
> > 
> > But if we were to include the patch removing the check we'll get a compiling though with less feature solution.
> > If you think that's a good idea, I can inlcude it in the branch.
> 
> Using `clang`, `curl` can be built with `--with-darwinssl` on OSX. This does use Apple's replacement for `openssl`. (doesn't work with gcc as it needs support for Apple's blocks extension for C). Should we do this? 

By all means, yes. Updating R is a matter of some urgency...

Possible plan :
* Dima : patch libcurl (#21767) to add this switch to its `spkg-install`. Check it. Push it to trac as `needs_review`.
* Me : review it on Linux (with probably no effect at all) ==> re-mark #21767 as `positive review`
* Me also : re-merge #21767 into #20523, re-test it, push it to trac as `needs_review`
* Dima : re-test #20523 on a Mac, and possibly mark it as `poitive_review `.

What do you think ?


---

Comment by jpflori created at 2017-03-16 09:42:11

Just open another ticket for the curl script modifs please.
No need to reopen #21767.


---

Comment by charpent created at 2017-03-16 09:45:46

Replying to [comment:89 jpflori]:
> Not sure... and I'm not very inclined on working on this right now.
> 
> But if we were to include the patch removing the check we'll get a compiling though with less feature solution.
> If you think that's a good idea, I can inlcude it in the branch.

I think that this should be a **separate** ticket. I have reservations about trestricting the abilities of the software it includes ; in R case, the loss of secure communications would be a big loss :
* R repositories (> 10000 packages now) migrate towards https access. I doubt that they remain http-accessible for long.
* Access to Web databases (important for many applied statisticians) often requires secure communications.

So, at the minimum, let it be a choice of the user, and not something imposed. (For similar reasons, I oppose Jeroen Demerey's position, which entails a non-functional pip : too big a loss of functionality to be imposed).

And treat it as an ussue separate fron this gofddam R upgrade, which is 11 months late...


---

Comment by charpent created at 2017-03-16 09:47:21

Replying to [comment:94 jpflori]:
> Just open another ticket for the curl script modifs please.
> No need to reopen #21767.

OK, Ill do that, but will have to add it to #20523 dependencies. And merge it afterwards...


---

Comment by charpent created at 2017-03-16 09:58:51

Replying to [comment:96 charpent]:
> Replying to [comment:94 jpflori]:
> > Just open another ticket for the curl script modifs please.
> > No need to reopen #21767.
> 
> OK, Ill do that, but will have to add it to #20523 dependencies. And merge it afterwards...

That's now #22618 (added to dependencies).


---

Comment by jdemeyer created at 2017-03-16 10:02:53

Replying to [comment:90 dimpase]:
> Using `clang`, `curl` can be built with `--with-darwinssl` on OSX. This does use Apple's replacement for `openssl`. (doesn't work with gcc as it needs support for Apple's blocks extension for C). Should we do this?

Perhaps, but that's orthogonal to this ticket. The OpenSSL dependency is not limited to OS X, so the solution to [comment:82] cannot be specific to OS X.


---

Comment by jdemeyer created at 2017-03-16 10:04:40

I agree with jpflori. Let's include the R patch _and_ also possibly fix building curl on OS X with OpenSSL.


---

Comment by dimpase created at 2017-03-16 10:06:06

Replying to [comment:96 charpent]:
> Replying to [comment:94 jpflori]:
> > Just open another ticket for the curl script modifs please.
> > No need to reopen #21767.

why not, I can do this right now on #21767, it will be ready by lunchtime...


---

Comment by charpent created at 2017-03-16 10:08:46

Replying to [comment:99 jdemeyer]:
> I agree with jpflori. Let's include the R patch _and_ also possibly fix building curl on OS X with OpenSSL.

With that patch, will R use SSL when compiled on a system where OpenSSL or Gutls exist(s) ?


---

Comment by jpflori created at 2017-03-16 10:17:19

Yes it will.

But it will also allow to build Sage on systems without openssl.


---

Comment by dimpase created at 2017-03-16 10:17:48

Replying to [comment:101 charpent]:
> Replying to [comment:99 jdemeyer]:
> > I agree with jpflori. Let's include the R patch _and_ also possibly fix building curl on OS X with OpenSSL.
> 
> With that patch, will R use SSL when compiled on a system where OpenSSL or Gutls exist(s) ?

it will use Darwin's own ssl on new OSX systems, otherwise it will do the same as before; i.e. it's an OSX-only patch 
for new OSX systems (only if `$MACOS_VERSION -ge 16` holds)


---

Comment by dimpase created at 2017-03-16 11:34:07

Replying to [comment:72 charpent]:
> Replying to [comment:68 dimpase]:
> > Replying to [comment:66 charpent]:
> > > Replying to [comment:64 dimpase]:
> > > > how does one check that it can use pcre and curl ? is it in the tests? (I'd like to see this on OSX)
> > > 
> > > as far as I understand, it's managed in R's main .configure script.
> > 
> > my question is rather how do I test that they work?
> 
> From R, trivially :
> * file.download("http://Url-of-soime-file-you-are-sure-in-exists", method="curl") ## libcurl
it is `download.file` :-)

The following works in R (run from `sage -sh` prompt) with clang-compiled curl on OSX:

```
> capabilities()["libcurl"]
libcurl 
   TRUE 
> download.file("http://www.sagemath.org/index.html", method="curl",destfile="/tmp/bla.html")
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 17758    0 17758    0     0  92938      0 --:--:-- --:--:-- --:--:--  110k
> download.file("https://www.sagemath.org/index.html", method="curl",destfile="/tmp/sbla.html")
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100 17758    0 17758    0     0  67312      0 --:--:-- --:--:-- --:--:-- 68563
> 
```

(so both http and https work)


---

Comment by dimpase created at 2017-03-16 11:38:59

Replying to [comment:76 charpent]:
> Replying to [comment:74 charpent]:
> > I forgot the obvious :
> > {{{
> > > extSoftVersion()["PCRE"]
> >              PCRE 
> > "8.39 2016-06-14" 
> > > capabilities()["libcurl"]
> > libcurl 
> >    TRUE 
> > }}}
> > 
> 
> > Not knowing Perl-compatible regular expressin, I'll have to think a bit about a good example...
> 
> Try that :
> {{{
> > gsub("abc([This is the Trac macro *:alpha:* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#:alpha:-macro)*)def","\\U\\1","abcxyzdef")
> [1] "Uxyz"
> > gsub("abc([This is the Trac macro *:alpha:* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#:alpha:-macro)*)def","\\U\\1","abcxyzdef",perl=TRUE)
> [1] "XYZ"
> }}}
OK, these work on OSX, too.


---

Comment by charpent created at 2017-03-16 11:41:24

Replying to [comment:104 dimpase]:

[ Snip... ]

> (so both http and https work)

To be fully paranoid, we should check that both downloads give the same file ;-). (I did that, but in a non-portable way).

Probably not really useful.

Let's start another ticket fo doctest it (and the PCRE test) in a future enhancement ?


---

Comment by dimpase created at 2017-03-16 11:52:23

as far as OSX is concerned, this looks done to me. Anything else that stops this ticket?


---

Comment by jpflori created at 2017-03-16 12:00:58

LGTM.

We should still open a followup ticket to include the openssl-less patch.


---

Comment by jpflori created at 2017-03-16 12:00:58

Changing status from needs_work to positive_review.


---

Comment by jpflori created at 2017-03-16 12:06:13

Please review #22619.


---

Comment by charpent created at 2017-03-16 12:10:02

Replying to [comment:108 jpflori]:
> LGTM.

A big "Thank you" to all people having helped to close this 11 months gap !

> We should still open a followup ticket to include the openssl-less patch.

Agreed. I think that running an open system which needs communication (I just don't see applied statistics without communication as very practical) without means to have *secure* communication is dangerously silly, but I also agree that there might be an use for "isolated" systems, for which communication is baggage.

But this must be an *option*, not something forced on the user by a deficient implementation.


---

Comment by jpflori created at 2017-03-16 12:11:17

It is an option: if you have openssl installed, you'll get https without any further action.


---

Comment by jdemeyer created at 2017-03-16 12:20:28

[comment:82]


---

Comment by jdemeyer created at 2017-03-16 12:20:28

Changing status from positive_review to needs_work.


---

Comment by charpent created at 2017-03-16 12:25:57

Replying to [comment:112 jdemeyer]:
> [comment:82]

Compiles for me with #22619 merged in. `make ptestlong` running (needs about 1 hour). Would depending on #22619 be enough for you ?


---

Comment by git created at 2017-03-16 12:26:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-03-16 12:27:18

I think it's better to add the patch from #22619 to this ticket, which I just did.


---

Comment by jdemeyer created at 2017-03-16 12:27:18

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2017-03-16 12:31:19

Jeroen, I presume #comment:82 has been fixed in #21767. Please check if it works for you.


---

Comment by dimpase created at 2017-03-16 12:37:01

also, given how little in Sage actually depends on R, IMHO this can be added in 7.6, no need to wait for 8.0...


---

Comment by jdemeyer created at 2017-03-16 13:41:47

Replying to [comment:116 dimpase]:
> Jeroen, I presume #comment:82 has been fixed in #21767.

Depends what you mean. Yes, it's fixed on OS X. But there remains the issue that Sage (and therefore R) should not require OpenSSL.


---

Comment by charpent created at 2017-03-16 13:56:03

Replying to [comment:118 jdemeyer]:
> Replying to [comment:116 dimpase]:
> > Jeroen, I presume #comment:82 has been fixed in #21767.
> 
> Depends what you mean. Yes, it's fixed on OS X. But there remains the issue that Sage (and therefore R) should not require OpenSSL.

Jeroen,

Since 7.6.beta2 (IIRC), Sagemath [depends](https://trac.sagemath.org/ticket/22189) on some SSL implementation, and we recommend OpenSSL.

BTW #20523 + #22619 passes ptestlong with the usual quirks (one transient error, one well-known, ticketed difference of expression) ; since I have OpenSSL installed systemwide, I can reach an https-accessible R repository.. Is that enough for you ? Or can you check that [your patch](https://git.sagemath.org/sage.git/commit/?id=f029f66bbf131eb7cdd4f8bfbe42d5c560baea1c) does what you so dearly desire ?

BTW : setting the milestone at 7.6 : this upgrade is late enough.


---

Comment by jdemeyer created at 2017-03-16 14:00:30

Replying to [comment:119 charpent]:
> Since 7.6.beta2 (IIRC), Sagemath [depends](https://trac.sagemath.org/ticket/22189) on some SSL implementation, and we recommend OpenSSL.

That's a documentation bug, see #22620.


---

Comment by jpflori created at 2017-03-16 16:40:40

Changing keywords from "r-project" to "r-project, days85".


---

Comment by jpflori created at 2017-03-16 16:40:40

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2017-03-27 11:33:55

the following is, most probably, an R bug:

```
[r-3.3.3.p0] making tre-match-backtrack.d from tre-match-backtrack.c
[r-3.3.3.p0] regerror.c:25:10: fatal error: 'libintl.h' file not found
[r-3.3.3.p0] #include <libintl.h>
[r-3.3.3.p0]          ^
```

which pops up if `libintl.h` is installed in `/usr/local/include/`.
Making a symbolic link to it in `SAGE_LOCAL/include` allows this to proceed.

It appears that the corresponding place in the R installation ignores CFLAGS, as
passing CFLAGS='-I/usr/local/include' on the command line has no effect.


---

Comment by dimpase created at 2017-03-27 13:13:58

There appears to be a platform-dependent bug in how curl dependency is handled. With libcurl not installed in /usr/lib (resp. no libcurl headers in /usr/include) it does not build on a FreeBSD 11.0 system. I had to apply

```
--- a/build/pkgs/r/spkg-install
+++ b/build/pkgs/r/spkg-install
@@ -115,6 +115,11 @@ if [ "$UNAME" = "CYGWIN" ]; then
     mv patches/cygwin/*.patch patches/
 fi
 
+CURL_CPPFLAGS="-I/$SAGE_LOCAL/include"
+CURL_LIBS="-L/$SAGE_LOCAL/lib -lcurl"
+export CURL_CPPFLAGS
+export CURL_LIBS
+
 config()
 {
     ./configure \
```



---

Comment by vbraun created at 2017-03-27 20:43:05

Resolution: fixed


---

Comment by dimpase created at 2018-09-14 11:32:30

Replying to [comment:122 dimpase]:
> the following is, most probably, an R bug:
> {{{
> [r-3.3.3.p0] making tre-match-backtrack.d from tre-match-backtrack.c
> [r-3.3.3.p0] regerror.c:25:10: fatal error: 'libintl.h' file not found
> [r-3.3.3.p0] #include <libintl.h>
> [r-3.3.3.p0]          ^
> }}}
> which pops up if `libintl.h` is installed in `/usr/local/include/`.
> Making a symbolic link to it in `SAGE_LOCAL/include` allows this to proceed.
> 
> It appears that the corresponding place in the R installation ignores CFLAGS, as
> passing CFLAGS='-I/usr/local/include' on the command line has no effect.
> 
> 
> 
As a matter of fact, one needs these `-I/...` added to `CPPFLAGS` as there is some pre-processing happening in the build here.
