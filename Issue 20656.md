# Issue 20656: improving live documentation in the Jupyter notebook

archive/issues_020656.json:
```json
{
    "body": "CC:  @vbraun @rbeezer @nthiery fhivert @slel fcayre @jdemeyer @dimpase @kwankyu\n\nSince #20690 we have access to documentation (with live execution) within the Jupyter notebook. It was decided to keep the code simple. There are two ongoing projects within Jupyter for having this working. It might be wiser to wait for them...\n\nSome of the improvements mentioned in #20690 were:\n\n- [  ] Configure Sphinx to add a small header to our html page with Thebe configuration: use the Jupyter instance serving the page. We currently use `window.location.origin`; is this the right thing?\n\n- [ ] Currently it takes 10s for 100 prompts while some sage files\n      contain up to 1000 prompts. Profile Thebe and optimize it or use\n      a separate thread to properly support large files.\n\n- [ ] Expand the activate button with a menu or other widgets for user\n      customization of the Jupyter server. This typically would\n      let the user choose between:\n      - tmpnb (will only be useful for Sage when tmpnb will include a\n        Sage kernel)\n      - A local Jupyter server\n      - Whichever Jupyter server the browser is currently connected to?\n      - a user specified server\n\n- [ ] Check whether Jupyter could be configured to dynamically\n      negotiate incoming connections that don't fall within the\n      `-NotebookApp.allow_origin pattern`, by opening a user dialog such\n      as \"Page xxx requests starting a new kernel on this server; do\n      you accept? yes/no/always for this site\"\n\n- [ ] Add support in Thebe for customizable (continuation) prompts, with\n      striping and splitting as above, and automatic setting of the kernel.\n      The customization option could look like:\n\n      {{{\n         prompts = {\n            \"sage: \": {continuations=[\"....:\", \"...  \"], kernel=\"sagemath\"},\n            \">>>> \": {continuation=\"...  \", kernel=\"python\"}\n         }\n      }}}\n\n- [ ] Contribute support for Thebe upstream in Sphinx, with:\n\n      - [ ] Explicit markup to specify which code blocks are editable\n            and with which kernel, or setup kernel auto-detection from\n            the prompt.\n\n      - [ ] The possibility for setting a default value for the above\n\n- [ ] Refactor the Sage sphinx configuration to use the above\n\n- [ ] Add support in Thebe for basic export to Jupyter notebooks. A\n      quality loss (in particular in terms of the hierarchical\n      structure) is acceptable.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20893\n\n",
    "created_at": "2016-06-27T16:15:17Z",
    "labels": [
        "documentation",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "improving live documentation in the Jupyter notebook",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20656",
    "user": "@videlec"
}
```
CC:  @vbraun @rbeezer @nthiery fhivert @slel fcayre @jdemeyer @dimpase @kwankyu

Since #20690 we have access to documentation (with live execution) within the Jupyter notebook. It was decided to keep the code simple. There are two ongoing projects within Jupyter for having this working. It might be wiser to wait for them...

Some of the improvements mentioned in #20690 were:

- [  ] Configure Sphinx to add a small header to our html page with Thebe configuration: use the Jupyter instance serving the page. We currently use `window.location.origin`; is this the right thing?

- [ ] Currently it takes 10s for 100 prompts while some sage files
      contain up to 1000 prompts. Profile Thebe and optimize it or use
      a separate thread to properly support large files.

- [ ] Expand the activate button with a menu or other widgets for user
      customization of the Jupyter server. This typically would
      let the user choose between:
      - tmpnb (will only be useful for Sage when tmpnb will include a
        Sage kernel)
      - A local Jupyter server
      - Whichever Jupyter server the browser is currently connected to?
      - a user specified server

- [ ] Check whether Jupyter could be configured to dynamically
      negotiate incoming connections that don't fall within the
      `-NotebookApp.allow_origin pattern`, by opening a user dialog such
      as "Page xxx requests starting a new kernel on this server; do
      you accept? yes/no/always for this site"

- [ ] Add support in Thebe for customizable (continuation) prompts, with
      striping and splitting as above, and automatic setting of the kernel.
      The customization option could look like:

      {{{
         prompts = {
            "sage: ": {continuations=["....:", "...  "], kernel="sagemath"},
            ">>>> ": {continuation="...  ", kernel="python"}
         }
      }}}

- [ ] Contribute support for Thebe upstream in Sphinx, with:

      - [ ] Explicit markup to specify which code blocks are editable
            and with which kernel, or setup kernel auto-detection from
            the prompt.

      - [ ] The possibility for setting a default value for the above

- [ ] Refactor the Sage sphinx configuration to use the above

- [ ] Add support in Thebe for basic export to Jupyter notebooks. A
      quality loss (in particular in terms of the hierarchical
      structure) is acceptable.

Issue created by migration from https://trac.sagemath.org/ticket/20893





---

archive/issue_comments_285230.json:
```json
{
    "body": "Fix formatting in ticket description.\n\nRegarding \"There are two ongoing projects within Jupyter for having this working\",\nwould someone add links?",
    "created_at": "2016-08-30T09:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285230",
    "user": "@slel"
}
```

Fix formatting in ticket description.

Regarding "There are two ongoing projects within Jupyter for having this working",
would someone add links?



---

archive/issue_comments_285231.json:
```json
{
    "body": "Editing ticket description to add link to\n[tmpnb issue 203: \"Octave kernel and SageMath kernel\"](https://github.com/jupyter/tmpnb/issues/203).",
    "created_at": "2016-08-30T09:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285231",
    "user": "@slel"
}
```

Editing ticket description to add link to
[tmpnb issue 203: "Octave kernel and SageMath kernel"](https://github.com/jupyter/tmpnb/issues/203).



---

archive/issue_comments_285232.json:
```json
{
    "body": "Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.",
    "created_at": "2017-05-04T14:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285232",
    "user": "@nthiery"
}
```

Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.



---

archive/issue_comments_285233.json:
```json
{
    "body": "A source of inspiration: [sympylive](http://live.sympy.org/).",
    "created_at": "2017-05-04T14:37:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285233",
    "user": "@nthiery"
}
```

A source of inspiration: [sympylive](http://live.sympy.org/).



---

archive/issue_comments_285234.json:
```json
{
    "body": "Replying to [comment:11 nthiery]:\n> Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.\n\nIs an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?",
    "created_at": "2017-05-04T15:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285234",
    "user": "tmonteil"
}
```

Replying to [comment:11 nthiery]:
> Update: Min RK reported to me that he had started reimplementing Thebe on top of JupyterLab. At this stage, this seemed to confirm our hope that Thebe will become just a thin layer on top of plain JupyterLab, making it sustainable.

Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?



---

archive/issue_comments_285235.json:
```json
{
    "body": "Replying to [comment:15 tmonteil]:\n> Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?\n\nAh, shoot, I forgot to discuss this specific point.\n\nThat being said, Thebe is meant to be embedded in any web page. So, at the level of Thebe itself, and without a minimum of structure specified, I believe it would be hard to define a meaningful export to .ipynb.\n\nPlausibly we would instead be shooting for a link \"download document as ipynb\" pointing to the notebook generated from the original sources, either statically or on the fly. The inconvenient being of course that users won't keep their history in this scenario if they play with Thebe before switching to the notebook.",
    "created_at": "2017-05-08T20:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285235",
    "user": "@nthiery"
}
```

Replying to [comment:15 tmonteil]:
> Is an export to a standalone .ipynb file part of the plan (so that people can save their work on some live doc) ?

Ah, shoot, I forgot to discuss this specific point.

That being said, Thebe is meant to be embedded in any web page. So, at the level of Thebe itself, and without a minimum of structure specified, I believe it would be hard to define a meaningful export to .ipynb.

Plausibly we would instead be shooting for a link "download document as ipynb" pointing to the notebook generated from the original sources, either statically or on the fly. The inconvenient being of course that users won't keep their history in this scenario if they play with Thebe before switching to the notebook.



---

archive/issue_comments_285236.json:
```json
{
    "body": "Changing keywords from \"\" to \"thebe, thebelab\".",
    "created_at": "2018-03-07T13:53:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285236",
    "user": "@nthiery"
}
```

Changing keywords from "" to "thebe, thebelab".



---

archive/issue_comments_285237.json:
```json
{
    "body": "This ticket needs clarification / update. Is it a meta ticket?",
    "created_at": "2020-08-19T20:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285237",
    "user": "@mkoeppe"
}
```

This ticket needs clarification / update. Is it a meta ticket?



---

archive/issue_comments_285238.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20656",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20656#issuecomment-285238",
    "user": "@mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.
