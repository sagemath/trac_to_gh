# Issue 12414: [ARM] Maxima has a strange numerical precision issue

Issue created by migration from https://trac.sagemath.org/ticket/12586

Original creator: Snark

Original creation time: 2012-02-26 08:33:50

Assignee: drkirkby

The following doctest fails:

```
File "/home/jpuydt/sage-5.0.beta5/devel/sage/sage/interfaces/maxima_abstract.py", line 1595:
sage: float(maxima("1.7e+17"))
Expected: 1.7e+17
Got:
    1.6999999999999997e+17
```


I checked the problem is present in "./sage -maxima", and reported [upstream](https://sourceforge.net/tracker/?func=detail&aid=3494716&group_id=4933&atid=104933).


---

Comment by Snark created at 2012-05-27 20:48:12

Changing status from new to needs_info.


---

Comment by Snark created at 2012-05-27 20:48:12

The problem was in ECL and is fixed upstream (thanks Juan Jose Garcia-Ripoll).

A package containing the patch is available here :
http://sage.math.washington.edu/home/jpuydt/ecl-11.1.2.cvs20111120.p2.spkg

This package is mostly known to fix the problem on ARM ; I'm running 'make ptestlong' on ARM, and will report the results.

I'll also check X86_64 as soon as I'll have re-compiled 5.0 on sage.math, but if someone can beat me to it, the better!


---

Comment by Snark created at 2012-05-28 09:15:33

On sage.math, this new package makes a single test fail:

```
sage -t --long -force_lib "devel/sage/sage/gsl/integration.pyx"
**********************************************************************
File "/home/jpuydt/sage-5.0/devel/sage/sage/gsl/integration.pyx", line 172:
    sage: exp(-1/x).nintegral(x, 1, 2)  # via maxima
Expected:
    (0.504792217873184, 5.604319429344075e-15, 21, 0)
Got:
    (0.504792217873184, 5.6043194293440744e-15, 21, 0)
**********************************************************************
```

So I guess it's a good package :-)


---

Comment by Snark created at 2012-05-28 09:20:43

Here is http://sage.math.washington.edu/home/jpuydt/ticket_12586_fix_doctest.patch a patch to fix the doctest. Notice that both the package and the patch have only been tested on sage.math only for now -- the poor ARM box is still busy.


---

Comment by Snark created at 2012-05-29 07:01:46

The package passes the integration.pyx tests on ARM... but without the patch!

So here is http://sage.math.washington.edu/home/jpuydt/ticket_12586_fix_doctest-v2.patch ; with this patch and my ecl package, everything is ok on X86_64 (all tests pass) and on ARM (all tests pass except the ones about the gamma function, which aren't supposed to pass anyway).

Marking as needs_review, as perhaps it would be nice to check on other architectures.


---

Comment by Snark created at 2012-05-29 07:01:46

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2012-07-27 20:41:01

Please fill in your real name as Author.


---

Comment by Snark created at 2012-07-28 09:09:20

Uh... the patch is under my real name! Or do you mean for the trac report itself? I'm only modifying that one and wait for your reply before I touch the other places where you ask the same.


---

Comment by dimpase created at 2012-10-25 06:03:25

tested on ARM and on OSX 10.6.8. Looks good.


---

Comment by dimpase created at 2012-10-25 06:03:25

Changing status from needs_review to positive_review.


---

Attachment


---

Comment by jdemeyer created at 2012-11-01 12:01:17

Resolution: fixed
