# Issue 10383: #10303 gives problems with sage -ba-force

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2010-12-06 14:32:11

Assignee: GeorgSWeber

CC:  leif

Keywords: SAGE64

On a clean installation of Sage including #10303, I get

```
$ ./sage -ba-force
*** TOUCHING ALL CYTHON (.pyx) FILES ***
KeyError: 'SAGE64':
  File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/devel/sage-main/c_lib/SConstruct", line 108:
    if os.environ['SAGE64']=="yes":
  File "/mnt/usb1/scratch/jdemeyer/merger/sage-4.6.1.rc0/local/lib/python/UserDict.py", line 22:
    raise KeyError(key)

----------------------------------------------------------
sage: Building and installing modified Sage library files.
```



---

Comment by jhpalmieri created at 2010-12-06 17:20:27

I think running sage-check-64 earlier in sage-build would fix it (if we keep #10303).  Something like this patch:

```diff
diff -r 3d7bb3a7774e sage-build
--- a/sage-build
+++ b/sage-build
`@``@` -82,6 +82,13 `@``@` if [ ! -d "$SAGE_ROOT/devel/sage" ]; the
     exit 1
 fi
 
+# Check whether this seems to a 64-bit build:
+source "$SAGE_LOCAL"/bin/sage-check-64
+
+if [ $? -ne 0 ]; then
+    exit 1
+fi
+
 if [ $DO_BUILD_ALL = 1 ]; then
    CUR=`pwd`
    cd "$SAGE_ROOT/devel/sage/sage"
`@``@` -98,11 +105,4 `@``@` if [ $DO_BUILD_ALL = 1 ]; then
    cd "$CUR"
 fi
 
-# Check whether this seems to a 64-bit build:
-source "$SAGE_LOCAL"/bin/sage-check-64
-
-if [ $? -ne 0 ]; then
-    exit 1
-fi
-
 build "sage"
```

But it's the end of the quarter here, I have final exams to prepare, etc., so I don't have any more time to work on this now.


---

Comment by drkirkby created at 2010-12-06 18:31:16

I do *not* see this problem on a build where SAGE64 was not set. 


```
drkirkby`@`hawk:~/sage-4.6.1.alpha3$ ./sage -ba-force
*** TOUCHING ALL CYTHON (.pyx) FILES ***
scons: `install' is up to date.

----------------------------------------------------------
sage: Building and installing modified Sage library files.


Installing c_lib
```


This was a 32-bit build on OpenSolaris 06/2009. 

What system was the problem noticed? Was SAGE64 set?


---

Comment by jdemeyer created at 2010-12-07 08:07:17

Replying to [comment:3 drkirkby]:
> What system was the problem noticed? Was SAGE64 set? 

This was on `sage.math.washington.edu`, a Ubuntu Linux x86_64 system.  I did not set `SAGE64`.


---

Comment by jdemeyer created at 2011-02-18 11:50:59

Changing priority from blocker to major.


---

Comment by jdemeyer created at 2013-12-29 23:16:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-12-29 23:16:33

Ticket is irrelevant since #10303 was never merged.


---

Comment by jdemeyer created at 2013-12-29 23:16:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-01-04 02:40:04

Resolution: wontfix
