# Issue 17150: Random timeout in  riemann.pyx

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2014-11-24 09:32:17

Keywords: random_fail


```
sage: m.plot_colored(plot_points=1000)  # long time (29s on sage.math, 2012) ## line 1051 ##
[...]
sage -t --long src/sage/calculus/riemann.pyx  # Timed out
```

Do we really test an independent code path by computing extra many points?


---

Comment by jdemeyer created at 2014-11-24 10:41:00

Is it a regression? If plotting did become slower, then it's something to be investigated.

The comment mentions that it takes 29s on `sage.math` which is not a very fast machine. Other doctests are documented to take far more time. This 29s shouldn't cause timeouts (unless the machine is very slow, but then you should just increase the timeout).


---

Comment by vbraun created at 2014-11-24 11:38:40

I don't think its a regression, I think I've seen it before. Its just unnecessarily slow.


---

Comment by vbraun created at 2014-11-24 11:39:28

PS: Machine is my desktop, Haswell-E 6-core with 32 GB ram (but doing stuff in the background).


---

Comment by kcrisman created at 2014-12-04 03:15:49

This is probably due to some great final stuff Ethan put in that I finally reviewed not that long ago (in Sage time).  Comments:
* `sage: m.plot_colored(plot_points=100)` probably will need something about a graphics primitive or it will fail tests.
* Same one should be upped to `plot_points=200` but otherwise it's (barely) acceptable actual output.
* The test

```
p = m.plot_spiderweb(withcolor=True, plot_points=100, thickness = 2.0, min_mag=0.1) # long time
```

  is just not acceptable, it's completely unintelligible.    `plot_points=350` is the first time it seems reasonable.
* For the "high-resolution" plot, why not keep the test but just do "not tested" along with the "tested" smaller one?
The point is that it's not just manpage style documentation, but something people will want to test without having to guess what to do.  Hopefully these suggestions will still be within your timing frame for the file.
----
New commits:


---

Comment by jdemeyer created at 2014-12-04 07:31:43

The main goal of this ticket should be to fix the actual regression in the plotting. Once that's done, we can have a look at what should be done about the doctests.


---

Comment by kcrisman created at 2014-12-04 14:35:52

Okay, #11273 was merged in Sage 5.13.beta0 (thanks, "Merged in" box!) - probably commit f597e49695b.  The longer plot test time overall is probably mostly due to additional tests being added for quite a bit of new functionality (multiply connected domains, etc.).  The specific example in question is most likely due to moving the generation of plot points (the thing that actually is slow), not the image creation itself) to `compute_on_grid`, though I didn't see any obviously wrong or new code at the time, nor do I see anything obvious where Cython was replaced with Python there.

By the way, on my OS X 10.7 2.3 GHz laptop with only 8GB, I still get about 35 seconds like in your earlier version.


---

Comment by jdemeyer created at 2015-09-19 10:56:20

Changing keywords from "random_fail" to "".
