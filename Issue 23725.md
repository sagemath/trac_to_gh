# Issue 23725: Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py

archive/issues_023725.json:
```json
{
    "body": "CC:  cremona\n\nOn [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short), it is probably one of the dependencies of #23881 where it is introduced see  [the discussion starting at comment 52](https://trac.sagemath.org/ticket/23881#comment:52).\n\n```\nsage -t --long src/sage/schemes/elliptic_curves/sha_tate.py\n**********************************************************************\nFile \"src/sage/schemes/elliptic_curves/sha_tate.py\", line 915, in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound\nFailed example:\n    sh.two_selmer_bound()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 515, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 885, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound[1]>\", line 1, in <module>\n        sh.two_selmer_bound()\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py\", line 934, in two_selmer_bound\n        r = E.rank()\n      File \"/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py\", line 2121, in rank\n        raise RuntimeError('Rank not provably correct.')\n    RuntimeError: Rank not provably correct.\n**********************************************************************\n1 item had failures:\n   1 of  10 in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound\n    [155 tests, 1 failure, 55.87 s]\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23962\n\n",
    "created_at": "2017-10-03T22:18:39Z",
    "labels": [
        "elliptic curves",
        "blocker",
        "bug"
    ],
    "title": "Doctest failure in src/sage/schemes/elliptic_curves/sha_tate.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23725",
    "user": "mderickx"
}
```
CC:  cremona

On [arando](https://patchbot.sagemath.org/log/0/Ubuntu/14.04/i686/3.13.0-95-generic/arando/2017-10-03%2022:01:02?short), it is probably one of the dependencies of #23881 where it is introduced see  [the discussion starting at comment 52](https://trac.sagemath.org/ticket/23881#comment:52).

```
sage -t --long src/sage/schemes/elliptic_curves/sha_tate.py
**********************************************************************
File "src/sage/schemes/elliptic_curves/sha_tate.py", line 915, in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound
Failed example:
    sh.two_selmer_bound()
Exception raised:
    Traceback (most recent call last):
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 515, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 885, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound[1]>", line 1, in <module>
        sh.two_selmer_bound()
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/sha_tate.py", line 934, in two_selmer_bound
        r = E.rank()
      File "/home/patchbot/sage-patchbot/local/lib/python2.7/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py", line 2121, in rank
        raise RuntimeError('Rank not provably correct.')
    RuntimeError: Rank not provably correct.
**********************************************************************
1 item had failures:
   1 of  10 in sage.schemes.elliptic_curves.sha_tate.Sha.two_selmer_bound
    [155 tests, 1 failure, 55.87 s]
```


Issue created by migration from https://trac.sagemath.org/ticket/23962





---

archive/issue_comments_332354.json:
```json
{
    "body": "This might come from #23544.",
    "created_at": "2017-10-04T01:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332354",
    "user": "tscrim"
}
```

This might come from #23544.



---

archive/issue_comments_332355.json:
```json
{
    "body": "Replying to [comment:1 tscrim]:\n> This might come from #23544.\n\nI don't think so. I was reported om sage-release to fail on Sage 8.1.beta7.\n\nThe code seems to involve the Cremona database and the `eclib` library, not PARI/GP.\n\nI don't understand the failure though: the curve is contained in the small Cremona database which is installed by default. So the rank should just be read from the database.",
    "created_at": "2017-10-04T09:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332355",
    "user": "jdemeyer"
}
```

Replying to [comment:1 tscrim]:
> This might come from #23544.

I don't think so. I was reported om sage-release to fail on Sage 8.1.beta7.

The code seems to involve the Cremona database and the `eclib` library, not PARI/GP.

I don't understand the failure though: the curve is contained in the small Cremona database which is installed by default. So the rank should just be read from the database.



---

archive/issue_comments_332356.json:
```json
{
    "body": "The rank should, but maybe the two_selmer_bound which might be different from the rank is not read from the database.",
    "created_at": "2017-10-04T10:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332356",
    "user": "mderickx"
}
```

The rank should, but maybe the two_selmer_bound which might be different from the rank is not read from the database.



---

archive/issue_comments_332357.json:
```json
{
    "body": "Sorry ignore my last comment, I should have read the full traceback",
    "created_at": "2017-10-04T10:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332357",
    "user": "mderickx"
}
```

Sorry ignore my last comment, I should have read the full traceback



---

archive/issue_comments_332358.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-10-04T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332358",
    "user": "jdemeyer"
}
```

New commits:



---

archive/issue_comments_332359.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-10-04T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332359",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_332360.json:
```json
{
    "body": "As far as I can tell :\n\n* `EllipticCurve` is standard\n* therefore, //<some elliptic_curve>//`.rank()` is also standard\n* `database_cremona_ellcurve` is optional\n\nIf you wish to //always// consult Cremona database in any case, `database_cremona_ellcurve` should become standard.\n\nUnless I am gravely mistaken, of course...",
    "created_at": "2017-10-04T13:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332360",
    "user": "charpent"
}
```

As far as I can tell :

* `EllipticCurve` is standard
* therefore, //<some elliptic_curve>//`.rank()` is also standard
* `database_cremona_ellcurve` is optional

If you wish to //always// consult Cremona database in any case, `database_cremona_ellcurve` should become standard.

Unless I am gravely mistaken, of course...



---

archive/issue_comments_332361.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2017-10-04T13:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332361",
    "user": "charpent"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_332362.json:
```json
{
    "body": "Replying to [comment:12 charpent]:\n> If you wish to //always// consult Cremona database in any case\n\nThere is a small database which is standard. So consulting \"the\" Cremona database really means: the large one if that's installed, otherwise the small one.\n\nAlso, I'm not saying that consulting always must succeed. The code to get the rank from the database is wrapped in a `try:`/`except LookupError:` block and I'm not changing that.",
    "created_at": "2017-10-04T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332362",
    "user": "jdemeyer"
}
```

Replying to [comment:12 charpent]:
> If you wish to //always// consult Cremona database in any case

There is a small database which is standard. So consulting "the" Cremona database really means: the large one if that's installed, otherwise the small one.

Also, I'm not saying that consulting always must succeed. The code to get the rank from the database is wrapped in a `try:`/`except LookupError:` block and I'm not changing that.



---

archive/issue_comments_332363.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2017-10-04T14:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332363",
    "user": "jdemeyer"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_332364.json:
```json
{
    "body": "A couple of comments.\n\n1. When the new output incudes something like \"(guess = 0)\" it is not a guess, it is a proved lower bound.  (Not saying a lot if it is zero, but it can be positive).   Please change \"guess\" to \"lower bound\".\n\n2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.  I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.  How does this behave now?",
    "created_at": "2017-10-04T14:28:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332364",
    "user": "cremona"
}
```

A couple of comments.

1. When the new output incudes something like "(guess = 0)" it is not a guess, it is a proved lower bound.  (Not saying a lot if it is zero, but it can be positive).   Please change "guess" to "lower bound".

2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.  I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.  How does this behave now?



---

archive/issue_comments_332365.json:
```json
{
    "body": "Replying to [comment:14 cremona]:\n>    2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.\n\nThis is just a simplification. I found the code dealing with the dict rather complicated. A simple tuple `(rank, proven)` does the job too.",
    "created_at": "2017-10-04T14:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332365",
    "user": "jdemeyer"
}
```

Replying to [comment:14 cremona]:
>    2. I see that the cached rank is no longer a dict with True/False keys but a single pair (r,T/F).  I don't know the reason for this change.

This is just a simplification. I found the code dealing with the dict rather complicated. A simple tuple `(rank, proven)` does the job too.



---

archive/issue_comments_332366.json:
```json
{
    "body": "Replying to [comment:14 cremona]:\n> I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.\n\nNeither the old nor the new code deals with that. But you are right that it should.",
    "created_at": "2017-10-04T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332366",
    "user": "jdemeyer"
}
```

Replying to [comment:14 cremona]:
> I may try to compute the rank with Proof=True (default), got a warning an retired with Proof=False.

Neither the old nor the new code deals with that. But you are right that it should.



---

archive/issue_comments_332367.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-04T14:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332367",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332368.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-10-04T15:15:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332368",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_332369.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-04T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332369",
    "user": "jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_332370.json:
```json
{
    "body": "Fixed the caching of non-proven output from `eclib` and the exception message.",
    "created_at": "2017-10-04T15:17:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332370",
    "user": "jdemeyer"
}
```

Fixed the caching of non-proven output from `eclib` and the exception message.



---

archive/issue_comments_332371.json:
```json
{
    "body": "Hi Jeroen, \n\nVery nice that you found out the cause. I'm trying to see the link to your example and the doctest failure. Because your example fails 100% of the time while the doctest only fails sporadically. Is the explanation that the curve E1 is actually already created on\nline 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?\n\nIn the mean time I was able to replicate the doctest failure on arando. I needed to test it with `sage -t --global-iterations 1000` before an error showed up. It started failing on the 775th iteration and then it kept failing until the 798th doctest. This might indicate that the randomness might depend on the system load (objects being garbage collected sooner maybe).\n\nP.s. I think it would be good to add the doctest:\n\n\n```\n    sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n    sage: E2 = EllipticCurve('571a1')\n    sage: E2.rank()\n    0\n```\n\nat the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.\n----\nNew commits:",
    "created_at": "2017-10-04T15:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332371",
    "user": "mderickx"
}
```

Hi Jeroen, 

Very nice that you found out the cause. I'm trying to see the link to your example and the doctest failure. Because your example fails 100% of the time while the doctest only fails sporadically. Is the explanation that the curve E1 is actually already created on
line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?

In the mean time I was able to replicate the doctest failure on arando. I needed to test it with `sage -t --global-iterations 1000` before an error showed up. It started failing on the 775th iteration and then it kept failing until the 798th doctest. This might indicate that the randomness might depend on the system load (objects being garbage collected sooner maybe).

P.s. I think it would be good to add the doctest:


```
    sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
    sage: E2 = EllipticCurve('571a1')
    sage: E2.rank()
    0
```

at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.
----
New commits:



---

archive/issue_comments_332372.json:
```json
{
    "body": "THanks!   Positive review once tests pass and Maarten is happy.",
    "created_at": "2017-10-04T15:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332372",
    "user": "cremona"
}
```

THanks!   Positive review once tests pass and Maarten is happy.



---

archive/issue_comments_332373.json:
```json
{
    "body": "Replying to [comment:19 mderickx]:\n> Is the explanation that the curve E1 is actually already created on\n> line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?\n\nExactly.",
    "created_at": "2017-10-04T15:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332373",
    "user": "jdemeyer"
}
```

Replying to [comment:19 mderickx]:
> Is the explanation that the curve E1 is actually already created on
> line 362  with `sage: E = EllipticCurve([0, -1, 1, -929, -10595])       # 571A` and that it is quite random wether this curve still exists or is already garbage collected around the line 915 where the doctest failure occurs?

Exactly.



---

archive/issue_comments_332374.json:
```json
{
    "body": "FYI, a `make ptestlong` started //before// Cremona's [comment](https://trac.sagemath.org/ticket/23962#comment:14) passed with no errors whatsoever.\n\nIt seems to me that [comment 20](https://trac.sagemath.org/ticket/23962#comment:20) implies yet another patch-push-test cycle. I'll refrain from `ptest`ing it until that.",
    "created_at": "2017-10-04T15:34:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332374",
    "user": "charpent"
}
```

FYI, a `make ptestlong` started //before// Cremona's [comment](https://trac.sagemath.org/ticket/23962#comment:14) passed with no errors whatsoever.

It seems to me that [comment 20](https://trac.sagemath.org/ticket/23962#comment:20) implies yet another patch-push-test cycle. I'll refrain from `ptest`ing it until that.



---

archive/issue_comments_332375.json:
```json
{
    "body": "Replying to [comment:19 mderickx]:\n> I think it would be good to add the doctest:\n> \n> {{{\n>     sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])\n>     sage: E2 = EllipticCurve('571a1')\n>     sage: E2.rank()\n>     0\n> }}}\n> at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.\n\nThat's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.\n\n(*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!",
    "created_at": "2017-10-04T15:40:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332375",
    "user": "jdemeyer"
}
```

Replying to [comment:19 mderickx]:
> I think it would be good to add the doctest:
> 
> {{{
>     sage: E1 = EllipticCurve([0, -1, 1, -929, -10595])
>     sage: E2 = EllipticCurve('571a1')
>     sage: E2.rank()
>     0
> }}}
> at the top of the file to make sure that we now have a doctest that fails 100% of the time prior to your fix, but works after it.

That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.

(*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!



---

archive/issue_comments_332376.json:
```json
{
    "body": "Replying to [comment:23 jdemeyer]:\n> \n> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!\n\nWe are working on an api for the LMFDB which would make it easy to get all this data (and more) using only an internet connection, making the optional database almost redundant.",
    "created_at": "2017-10-04T15:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332376",
    "user": "cremona"
}
```

Replying to [comment:23 jdemeyer]:
> 
> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!

We are working on an api for the LMFDB which would make it easy to get all this data (and more) using only an internet connection, making the optional database almost redundant.



---

archive/issue_comments_332377.json:
```json
{
    "body": "> That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.\n> \n> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!\n\nThanks for this explanation, the test itself suffices, and I am happy with the rest of the code (although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency).\n\nI would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).",
    "created_at": "2017-10-04T16:12:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332377",
    "user": "mderickx"
}
```

> That's what the 1888b1 (*) test does. It's testing the essence of this patch, namely that `rank()` should work for curves which are in the database but which are not constructed using the Cremona label. Personally, I don't think that adding `E2 = EllipticCurve('1888b1')` would add anything interesting to that test.
> 
> (*) I looked for a curve which is not used anywhere else in doctests but for which `eclib` also fails to compute the rank due to a non-trivial Sha[2]. Thanks to the LMFDB for the handy query page!

Thanks for this explanation, the test itself suffices, and I am happy with the rest of the code (although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency).

I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).



---

archive/issue_comments_332378.json:
```json
{
    "body": "Replying to [comment:25 mderickx]:\n> although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency.\n\nThat's true but I wanted to leave that for a separate ticket.\n\n> I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).\n\nOK. Does this ticket have positive review from you apart from that documentation issue?",
    "created_at": "2017-10-05T08:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332378",
    "user": "jdemeyer"
}
```

Replying to [comment:25 mderickx]:
> although there might be some nitpicking that your tuple instead of dict change made the caching of `.__gens` and the `.__rank` less consistent and I like coding style consistency.

That's true but I wanted to leave that for a separate ticket.

> I would like to add a little bit more explanation to this test later this evening (I have to leave now). Since now the text around this test does not seem to make clear the subtle issue that different ways of initialising the same globally unique elliptic curve should give actually an object that behaves the same (ok it has the link to this trac ticket).

OK. Does this ticket have positive review from you apart from that documentation issue?



---

archive/issue_comments_332379.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-05T08:35:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332379",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_332380.json:
```json
{
    "body": "I added a small extra test. Is this what you had in mind?",
    "created_at": "2017-10-05T08:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332380",
    "user": "jdemeyer"
}
```

I added a small extra test. Is this what you had in mind?



---

archive/issue_comments_332381.json:
```json
{
    "body": "The change I had in mind was slightly different. I agree with the code you have written till now, so that part gets positive review from me. Do you agree with my added extra explanation in the test?\n----\nNew commits:",
    "created_at": "2017-10-05T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332381",
    "user": "mderickx"
}
```

The change I had in mind was slightly different. I agree with the code you have written till now, so that part gets positive review from me. Do you agree with my added extra explanation in the test?
----
New commits:



---

archive/issue_comments_332382.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-10-05T12:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332382",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_332383.json:
```json
{
    "body": "The fact that \"Elliptic curves are globally unique even if they are initialized differently\" is already tested in `src/sage/schemes/elliptic_curves/constructor.py`\n\nSo there is no need for the extra test\n\n```\n        Elliptic curves are globally unique even if they are initialized differently::\n\n            sage: E1 = EllipticCurve([-517, -4528])\n            sage: E2 = EllipticCurve('1888b1')\n            sage: E1 is E2\n            True\n```\n",
    "created_at": "2017-10-05T12:44:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332383",
    "user": "jdemeyer"
}
```

The fact that "Elliptic curves are globally unique even if they are initialized differently" is already tested in `src/sage/schemes/elliptic_curves/constructor.py`

So there is no need for the extra test

```
        Elliptic curves are globally unique even if they are initialized differently::

            sage: E1 = EllipticCurve([-517, -4528])
            sage: E2 = EllipticCurve('1888b1')
            sage: E1 is E2
            True
```




---

archive/issue_comments_332384.json:
```json
{
    "body": "Yes, I know, but I like my doctest to tell a story, this is mainly an example leading up to the explanatory text coming after it.",
    "created_at": "2017-10-05T13:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332384",
    "user": "mderickx"
}
```

Yes, I know, but I like my doctest to tell a story, this is mainly an example leading up to the explanatory text coming after it.



---

archive/issue_comments_332385.json:
```json
{
    "body": "OK, fine. Could you just remove the duplicate blank line and limit your lines to 72 characters in length?",
    "created_at": "2017-10-05T14:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332385",
    "user": "jdemeyer"
}
```

OK, fine. Could you just remove the duplicate blank line and limit your lines to 72 characters in length?



---

archive/issue_comments_332386.json:
```json
{
    "body": "In order to move forward with this blocker ticket, I suggest to merge the code here and move the discussion about the docs to a new ticket: #23974\n----\nNew commits:",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332386",
    "user": "jdemeyer"
}
```

In order to move forward with this blocker ticket, I suggest to merge the code here and move the discussion about the docs to a new ticket: #23974
----
New commits:



---

archive/issue_comments_332387.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-06T08:08:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332387",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_332388.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2017-10-06T10:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332388",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_332389.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:",
    "created_at": "2017-10-06T10:00:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332389",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. New commits:



---

archive/issue_comments_332390.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-06T10:04:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332390",
    "user": "jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_332391.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-15T09:22:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23725#issuecomment-332391",
    "user": "vbraun"
}
```

Resolution: fixed
