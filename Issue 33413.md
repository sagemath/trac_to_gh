# Issue 33413: Set JUPYTER_CONFIG_DIR during docbuild

archive/issues_033413.json:
```json
{
    "body": "CC:  klee dimpase @collares\n\nAfter #33507, jupyter gets invoked during the docbuild.\nThis can lead to a new class of errors as seen in #33507#comment:75 and #33507#comment:86\n\nWe fix it by setting `JUPYTER_CONFIG_DIR` and `JUPYTER_CONFIG_PATH` during the docbuild so that a random broken user configuration of Jupyter in `~/.jupyter` does not break the docbuild.\n\nIssue created by migration from https://trac.sagemath.org/ticket/33650\n\n",
    "created_at": "2022-04-06T04:36:28Z",
    "labels": [
        "documentation",
        "blocker",
        "bug"
    ],
    "title": "Set JUPYTER_CONFIG_DIR during docbuild",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33413",
    "user": "mkoeppe"
}
```
CC:  klee dimpase @collares

After #33507, jupyter gets invoked during the docbuild.
This can lead to a new class of errors as seen in #33507#comment:75 and #33507#comment:86

We fix it by setting `JUPYTER_CONFIG_DIR` and `JUPYTER_CONFIG_PATH` during the docbuild so that a random broken user configuration of Jupyter in `~/.jupyter` does not break the docbuild.

Issue created by migration from https://trac.sagemath.org/ticket/33650





---

archive/issue_comments_475656.json:
```json
{
    "body": "This could be done, for example, in `build/pkgs/sagemath_doc_html/spkg-install`",
    "created_at": "2022-04-06T04:56:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475656",
    "user": "mkoeppe"
}
```

This could be done, for example, in `build/pkgs/sagemath_doc_html/spkg-install`



---

archive/issue_comments_475657.json:
```json
{
    "body": "> We fix it by setting `JUPYTER_CONFIG_DIR` and `JUPYTER_CONFIG_PATH` during the docbuild so that a random broken user configuration of Jupyter in `~/.jupyter` does not break the docbuild.\n\nDima had the same issue with `./sage -n`. So we should not focus on the docbuild.",
    "created_at": "2022-04-06T04:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475657",
    "user": "klee"
}
```

> We fix it by setting `JUPYTER_CONFIG_DIR` and `JUPYTER_CONFIG_PATH` during the docbuild so that a random broken user configuration of Jupyter in `~/.jupyter` does not break the docbuild.

Dima had the same issue with `./sage -n`. So we should not focus on the docbuild.



---

archive/issue_comments_475658.json:
```json
{
    "body": "Well, `sage -n` is for running Jupyter, so I'd think it's correct to use the user's configuration - so it's the user's problem if their personal configuration in `~/.jupyter` is overriding our kernel.\n\nBut for the build process we should do better.",
    "created_at": "2022-04-06T05:00:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475658",
    "user": "mkoeppe"
}
```

Well, `sage -n` is for running Jupyter, so I'd think it's correct to use the user's configuration - so it's the user's problem if their personal configuration in `~/.jupyter` is overriding our kernel.

But for the build process we should do better.



---

archive/issue_comments_475659.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-06T05:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475659",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_475660.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-06T05:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475660",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_475661.json:
```json
{
    "body": "In addition, I suppose in `sage -n` we could warn the user if `jupyter kernelspec list` reveals that our kernels are shadowed by user configuration.",
    "created_at": "2022-04-06T05:14:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475661",
    "user": "mkoeppe"
}
```

In addition, I suppose in `sage -n` we could warn the user if `jupyter kernelspec list` reveals that our kernels are shadowed by user configuration.



---

archive/issue_comments_475662.json:
```json
{
    "body": "I've opened #33651 for this.",
    "created_at": "2022-04-06T05:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475662",
    "user": "mkoeppe"
}
```

I've opened #33651 for this.



---

archive/issue_comments_475663.json:
```json
{
    "body": "Why not `unset VAR` instead of pointing jupyter to non-existing directory or path?",
    "created_at": "2022-04-06T05:56:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475663",
    "user": "klee"
}
```

Why not `unset VAR` instead of pointing jupyter to non-existing directory or path?



---

archive/issue_comments_475664.json:
```json
{
    "body": "When unset, it uses the default directories, which can contain the bad user configuration.",
    "created_at": "2022-04-06T07:09:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475664",
    "user": "mkoeppe"
}
```

When unset, it uses the default directories, which can contain the bad user configuration.



---

archive/issue_comments_475665.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> When unset, it uses the default directories, which can contain the bad user configuration.\n\nI see.\n\nThen it looks good to me. Now I am simulating the failing situation to see that the branch works as expected. \n\nMeanwhile let me note that #33320 (which supersedes #33507) circumvents this bug since it does not run jupyter to build the live doc.",
    "created_at": "2022-04-06T08:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475665",
    "user": "klee"
}
```

Replying to [comment:11 mkoeppe]:
> When unset, it uses the default directories, which can contain the bad user configuration.

I see.

Then it looks good to me. Now I am simulating the failing situation to see that the branch works as expected. 

Meanwhile let me note that #33320 (which supersedes #33507) circumvents this bug since it does not run jupyter to build the live doc.



---

archive/issue_comments_475666.json:
```json
{
    "body": "In `/Users/kwankyu/GitHub/sage-dev`:\n\nAfter \n\n```\n(sage-sh) kwankyu@Hera:sage-dev$ ipython kernel install --name \"sagemath\" --user\nInstalled kernelspec sagemath in /Users/kwankyu/Library/Jupyter/kernels/sagemath\n(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec list\nAvailable kernels:\n  sagemath        /Users/kwankyu/Library/Jupyter/kernels/sagemath\n  python3         /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/python3\n```\n\n\n`make` fails even with the branch.\n\nAfter\n\n```\n(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec remove sagemath\nKernel specs to remove:\n  sagemath            \t/Users/kwankyu/Library/Jupyter/kernels/sagemath\nRemove 1 kernel specs [y/N]: y\n[RemoveKernelSpec] Removed /Users/kwankyu/Library/Jupyter/kernels/sagemath\n(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec list\nAvailable kernels:\n  python3         /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/python3\n  sagemath        /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/sagemath\n```\n\n`make` does not fail.",
    "created_at": "2022-04-06T09:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475666",
    "user": "klee"
}
```

In `/Users/kwankyu/GitHub/sage-dev`:

After 

```
(sage-sh) kwankyu@Hera:sage-dev$ ipython kernel install --name "sagemath" --user
Installed kernelspec sagemath in /Users/kwankyu/Library/Jupyter/kernels/sagemath
(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec list
Available kernels:
  sagemath        /Users/kwankyu/Library/Jupyter/kernels/sagemath
  python3         /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/python3
```


`make` fails even with the branch.

After

```
(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec remove sagemath
Kernel specs to remove:
  sagemath            	/Users/kwankyu/Library/Jupyter/kernels/sagemath
Remove 1 kernel specs [y/N]: y
[RemoveKernelSpec] Removed /Users/kwankyu/Library/Jupyter/kernels/sagemath
(sage-sh) kwankyu@Hera:sage-dev$ jupyter kernelspec list
Available kernels:
  python3         /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/python3
  sagemath        /Users/kwankyu/GitHub/sage-dev/local/var/lib/sage/venv-python3.10.3/share/jupyter/kernels/sagemath
```

`make` does not fail.



---

archive/issue_comments_475667.json:
```json
{
    "body": "This\n\n```\nexport JUPYTER_DATA_DIR=/doesnotexist  \n```\n\nworked. But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel. Fortunately that directory does not exist either, in my case. \n\nA safe solution would be to add the real path to our kernel at the front...",
    "created_at": "2022-04-06T09:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475667",
    "user": "klee"
}
```

This

```
export JUPYTER_DATA_DIR=/doesnotexist  
```

worked. But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel. Fortunately that directory does not exist either, in my case. 

A safe solution would be to add the real path to our kernel at the front...



---

archive/issue_comments_475668.json:
```json
{
    "body": "Replying to [comment:14 klee]:\n> A safe solution would be to add the real path to our kernel at the front...\n\nThus \n\n```\nexport JUPYTER_DATA_DIR=???os.path.join(SAGE_VENV, \"share\", \"jupyter\")???\n```\n\n\nThis is rather cumbersome though...",
    "created_at": "2022-04-06T09:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475668",
    "user": "klee"
}
```

Replying to [comment:14 klee]:
> A safe solution would be to add the real path to our kernel at the front...

Thus 

```
export JUPYTER_DATA_DIR=???os.path.join(SAGE_VENV, "share", "jupyter")???
```


This is rather cumbersome though...



---

archive/issue_comments_475669.json:
```json
{
    "body": "Perhaps we should do versioning of Jupyter kernels, so that we can specify the right one to use by name only.",
    "created_at": "2022-04-06T09:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475669",
    "user": "dimpase"
}
```

Perhaps we should do versioning of Jupyter kernels, so that we can specify the right one to use by name only.



---

archive/issue_comments_475670.json:
```json
{
    "body": "Replying to [comment:16 dimpase]:\n> Perhaps we should do versioning of Jupyter kernels, so that we can specify the right one to use by name only.\n\n+1",
    "created_at": "2022-04-06T11:11:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475670",
    "user": "klee"
}
```

Replying to [comment:16 dimpase]:
> Perhaps we should do versioning of Jupyter kernels, so that we can specify the right one to use by name only.

+1



---

archive/issue_comments_475671.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-06T13:04:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475671",
    "user": "klee"
}
```

New commits:



---

archive/issue_comments_475672.json:
```json
{
    "body": "Versioned kernel works well.",
    "created_at": "2022-04-06T13:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475672",
    "user": "klee"
}
```

Versioned kernel works well.



---

archive/issue_comments_475673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-04-06T13:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475673",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_475674.json:
```json
{
    "body": "This is not getting better with versioning because it does not distinguish kernels from different installations of Sage.",
    "created_at": "2022-04-06T17:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475674",
    "user": "mkoeppe"
}
```

This is not getting better with versioning because it does not distinguish kernels from different installations of Sage.



---

archive/issue_comments_475675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-04-06T17:25:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475675",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_475676.json:
```json
{
    "body": "Replying to [comment:15 klee]:\n> Replying to [comment:14 klee]:\n> {{{\n> export JUPYTER_DATA_DIR=???os.path.join(SAGE_VENV, \"share\", \"jupyter\")???\n> }}}\n\nI don't think it's necessary to set it to the location of our jupyter installation because that is always active.",
    "created_at": "2022-04-06T17:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475676",
    "user": "mkoeppe"
}
```

Replying to [comment:15 klee]:
> Replying to [comment:14 klee]:
> {{{
> export JUPYTER_DATA_DIR=???os.path.join(SAGE_VENV, "share", "jupyter")???
> }}}

I don't think it's necessary to set it to the location of our jupyter installation because that is always active.



---

archive/issue_comments_475677.json:
```json
{
    "body": "Replying to [comment:14 klee]:\n> This\n> {{{\n> export JUPYTER_DATA_DIR=/doesnotexist  \n> }}}\n> worked. But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel.\n\nWhere would that directory be coming from?",
    "created_at": "2022-04-06T17:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475677",
    "user": "mkoeppe"
}
```

Replying to [comment:14 klee]:
> This
> {{{
> export JUPYTER_DATA_DIR=/doesnotexist  
> }}}
> worked. But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel.

Where would that directory be coming from?



---

archive/issue_comments_475678.json:
```json
{
    "body": "Replying to [comment:24 mkoeppe]:\n> But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel.\n> \n> Where would that directory be coming from?\n\nI don't know... I don't have it anymore since I deleted the `.sage` directory for experiments. It didn't have kernel definitions in it, and didn't cause a problem.",
    "created_at": "2022-04-06T21:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475678",
    "user": "klee"
}
```

Replying to [comment:24 mkoeppe]:
> But as I see it, this is still not a safe solution. It does prevent from using default directories, but still `.sage/local/etc/jupyter` shadows our kernel.
> 
> Where would that directory be coming from?

I don't know... I don't have it anymore since I deleted the `.sage` directory for experiments. It didn't have kernel definitions in it, and didn't cause a problem.



---

archive/issue_comments_475679.json:
```json
{
    "body": "I confirm that the current branch works well. I am positive.",
    "created_at": "2022-04-06T22:21:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475679",
    "user": "klee"
}
```

I confirm that the current branch works well. I am positive.



---

archive/issue_comments_475680.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-07T13:58:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475680",
    "user": "klee"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_475681.json:
```json
{
    "body": "Thank you!",
    "created_at": "2022-04-07T17:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475681",
    "user": "mkoeppe"
}
```

Thank you!



---

archive/issue_comments_475682.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-04-10T13:13:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475682",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_475683.json:
```json
{
    "body": "On NixOS we build documentation as part of the build, and `JUPYTER_PATH` must be set appropriately so `jupyter-sphinx` can find the [SageMath](SageMath) kernel during docbuilding. Is this supported? The fact that `--docbuild` is handled by `sage-site` makes me think I am doing the wrong thing by using it outside Sage-the-distribution, but `make doc-html` also uses `--docbuild` internally. I am temporarily hacking around this by calling `sage-python -m sage_docbuild` directly.",
    "created_at": "2022-05-04T08:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475683",
    "user": "@collares"
}
```

On NixOS we build documentation as part of the build, and `JUPYTER_PATH` must be set appropriately so `jupyter-sphinx` can find the [SageMath](SageMath) kernel during docbuilding. Is this supported? The fact that `--docbuild` is handled by `sage-site` makes me think I am doing the wrong thing by using it outside Sage-the-distribution, but `make doc-html` also uses `--docbuild` internally. I am temporarily hacking around this by calling `sage-python -m sage_docbuild` directly.



---

archive/issue_comments_475684.json:
```json
{
    "body": "Replying to [comment:32 gh-collares]:\n> On NixOS we build documentation as part of the build, and `JUPYTER_PATH` must be set appropriately so `jupyter-sphinx` can find the [SageMath](SageMath) kernel during docbuilding. Is this supported? The fact that `--docbuild` is handled by `sage-site` makes me think I am doing the wrong thing by using it outside Sage-the-distribution, but `make doc-html` also uses `--docbuild` internally. I am temporarily hacking around this by calling `sage-python -m sage_docbuild` directly.\n\nFor the record in sage-on-gentoo where I split sage_setup, sage, sage_docbuild and sage-doc in 9.5 and beyond I patch the makefile for build the documentation. But it also relies on sage to be already installed and in place on the system.\nhttps://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/files/sage-doc-9.6-makefile_and_parallel.patch\n\nI think we are at a point where ditching `./sage --docbuild` in favor of what I am currently doing in vanilla sage is not only possible but probably inevitable in the short term.",
    "created_at": "2022-05-04T09:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475684",
    "user": "fbissey"
}
```

Replying to [comment:32 gh-collares]:
> On NixOS we build documentation as part of the build, and `JUPYTER_PATH` must be set appropriately so `jupyter-sphinx` can find the [SageMath](SageMath) kernel during docbuilding. Is this supported? The fact that `--docbuild` is handled by `sage-site` makes me think I am doing the wrong thing by using it outside Sage-the-distribution, but `make doc-html` also uses `--docbuild` internally. I am temporarily hacking around this by calling `sage-python -m sage_docbuild` directly.

For the record in sage-on-gentoo where I split sage_setup, sage, sage_docbuild and sage-doc in 9.5 and beyond I patch the makefile for build the documentation. But it also relies on sage to be already installed and in place on the system.
https://github.com/cschwan/sage-on-gentoo/blob/master/sci-mathematics/sage-doc/files/sage-doc-9.6-makefile_and_parallel.patch

I think we are at a point where ditching `./sage --docbuild` in favor of what I am currently doing in vanilla sage is not only possible but probably inevitable in the short term.



---

archive/issue_comments_475685.json:
```json
{
    "body": "Replying to [comment:32 gh-collares]:\n> The fact that `--docbuild` is handled by `sage-site`\n\nI propose to move it back to `src/bin/sage` in #33795",
    "created_at": "2022-05-04T16:52:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475685",
    "user": "mkoeppe"
}
```

Replying to [comment:32 gh-collares]:
> The fact that `--docbuild` is handled by `sage-site`

I propose to move it back to `src/bin/sage` in #33795



---

archive/issue_comments_475686.json:
```json
{
    "body": "Replying to [comment:33 fbissey]:\n> For the record in sage-on-gentoo where I split sage_setup, sage, sage_docbuild and sage-doc in 9.5 and beyond I patch the makefile for build the documentation. But it also relies on sage to be already installed and in place on the system.\n\n+1, that's the way.",
    "created_at": "2022-05-04T16:56:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33413",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33413#issuecomment-475686",
    "user": "mkoeppe"
}
```

Replying to [comment:33 fbissey]:
> For the record in sage-on-gentoo where I split sage_setup, sage, sage_docbuild and sage-doc in 9.5 and beyond I patch the makefile for build the documentation. But it also relies on sage to be already installed and in place on the system.

+1, that's the way.
