# Issue 25313: is_comparability() fails for immutable graph

Issue created by migration from Trac.

Original creator: jmantysalo

Original creation time: 2018-06-10 12:08:55


```
g = DiGraph({0: [1]}, immutable=True)
sage.graphs.comparability.is_comparability(g)
```


outputs `IndexError: list index out of range`. Works with `immutable=False`.


---

Comment by dcoudert created at 2018-06-10 18:33:58

Changing status from new to needs_review.


---

Comment by dcoudert created at 2018-06-10 18:33:58

Right, method `iterator_nbrs` in `static_sparse_backend.pyx` only considered out neighbors. This should fix it.
----
New commits:


---

Comment by git created at 2018-07-29 17:34:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2018-07-30 07:22:51

LGTM modulo two trivial things:

- Could you add a test showing the need for the `seen` set (to help prevent regressions)?
- Why the `print` in this test: `print(g.neighbors_in(1))`?


---

Comment by git created at 2018-07-30 08:37:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-07-30 08:39:30

I have changed the seen data structure. I'm not sure it's best way to do it. May be a set is easier and sufficiently fast here. 

One issue I don't know how to solve is: were to free the bitset ? I don't find appropriate dealloc method. Should I add it ?


---

Comment by tscrim created at 2018-07-30 09:12:21

I don't like how you are using `_seen` as it gets doubly used: create one iterator, advance it 1 step, then create another iterator and `_seen` becomes empty. I think you are better defining it local to each function where you free it upon exit.

I also would like to see a test for `0 <-> 1` (an arrow point each way) so that `1` does not appear twice as a neighbor of `0`.


---

Comment by git created at 2018-07-30 09:52:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-07-30 09:53:19

You are perfectly right. Should be better now. I'm using set again since it might be sufficiently fast here.


---

Comment by tscrim created at 2018-07-30 11:37:38

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-07-30 11:37:38

Thanks. LGTM.


---

Comment by dcoudert created at 2018-07-30 11:40:16

Thank you.


---

Comment by vbraun created at 2018-08-05 08:18:10

Resolution: fixed
