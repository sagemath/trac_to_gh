# Issue 25313: is_comparability() fails for immutable graph

archive/issues_025313.json:
```json
{
    "body": "\n```\ng = DiGraph({0: [1]}, immutable=True)\nsage.graphs.comparability.is_comparability(g)\n```\n\n\noutputs `IndexError: list index out of range`. Works with `immutable=False`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25550\n\n",
    "created_at": "2018-06-10T12:08:55Z",
    "labels": [
        "graph theory",
        "major",
        "bug"
    ],
    "title": "is_comparability() fails for immutable graph",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25313",
    "user": "jmantysalo"
}
```

```
g = DiGraph({0: [1]}, immutable=True)
sage.graphs.comparability.is_comparability(g)
```


outputs `IndexError: list index out of range`. Works with `immutable=False`.

Issue created by migration from https://trac.sagemath.org/ticket/25550





---

archive/issue_comments_356872.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-10T18:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356872",
    "user": "dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356873.json:
```json
{
    "body": "Right, method `iterator_nbrs` in `static_sparse_backend.pyx` only considered out neighbors. This should fix it.\n----\nNew commits:",
    "created_at": "2018-06-10T18:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356873",
    "user": "dcoudert"
}
```

Right, method `iterator_nbrs` in `static_sparse_backend.pyx` only considered out neighbors. This should fix it.
----
New commits:



---

archive/issue_comments_356874.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-29T17:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356874",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356875.json:
```json
{
    "body": "LGTM modulo two trivial things:\n\n- Could you add a test showing the need for the `seen` set (to help prevent regressions)?\n- Why the `print` in this test: `print(g.neighbors_in(1))`?",
    "created_at": "2018-07-30T07:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356875",
    "user": "tscrim"
}
```

LGTM modulo two trivial things:

- Could you add a test showing the need for the `seen` set (to help prevent regressions)?
- Why the `print` in this test: `print(g.neighbors_in(1))`?



---

archive/issue_comments_356876.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-30T08:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356876",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356877.json:
```json
{
    "body": "I have changed the seen data structure. I'm not sure it's best way to do it. May be a set is easier and sufficiently fast here. \n\nOne issue I don't know how to solve is: were to free the bitset ? I don't find appropriate dealloc method. Should I add it ?",
    "created_at": "2018-07-30T08:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356877",
    "user": "dcoudert"
}
```

I have changed the seen data structure. I'm not sure it's best way to do it. May be a set is easier and sufficiently fast here. 

One issue I don't know how to solve is: were to free the bitset ? I don't find appropriate dealloc method. Should I add it ?



---

archive/issue_comments_356878.json:
```json
{
    "body": "I don't like how you are using `_seen` as it gets doubly used: create one iterator, advance it 1 step, then create another iterator and `_seen` becomes empty. I think you are better defining it local to each function where you free it upon exit.\n\nI also would like to see a test for `0 <-> 1` (an arrow point each way) so that `1` does not appear twice as a neighbor of `0`.",
    "created_at": "2018-07-30T09:12:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356878",
    "user": "tscrim"
}
```

I don't like how you are using `_seen` as it gets doubly used: create one iterator, advance it 1 step, then create another iterator and `_seen` becomes empty. I think you are better defining it local to each function where you free it upon exit.

I also would like to see a test for `0 <-> 1` (an arrow point each way) so that `1` does not appear twice as a neighbor of `0`.



---

archive/issue_comments_356879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-30T09:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356880.json:
```json
{
    "body": "You are perfectly right. Should be better now. I'm using set again since it might be sufficiently fast here.",
    "created_at": "2018-07-30T09:53:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356880",
    "user": "dcoudert"
}
```

You are perfectly right. Should be better now. I'm using set again since it might be sufficiently fast here.



---

archive/issue_comments_356881.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-07-30T11:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356881",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_356882.json:
```json
{
    "body": "Thanks. LGTM.",
    "created_at": "2018-07-30T11:37:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356882",
    "user": "tscrim"
}
```

Thanks. LGTM.



---

archive/issue_comments_356883.json:
```json
{
    "body": "Thank you.",
    "created_at": "2018-07-30T11:40:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356883",
    "user": "dcoudert"
}
```

Thank you.



---

archive/issue_comments_356884.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-08-05T08:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25313",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25313#issuecomment-356884",
    "user": "vbraun"
}
```

Resolution: fixed
