# Issue 4986: import audit

Issue created by migration from https://trac.sagemath.org/ticket/4986

Original creator: robertwb

Original creation time: 2009-01-16 04:04:46

Assignee: mabshoff

CC:  craigcitro leif kcrisman

It is currently way to easy to introduce circular imports in Sage, and a mess to try and hunt time down. An order in which things are imported is found in sage.all, but due to the cascade of imports in sage.misc (and elsewhere) this is not an accurate representation of what actually happens. This could stand to be cleaned up a lot. Ideally, little/none of sage.foo.* should be used before sage.foo.all is imported. 

This patch prints out imports as they happen, and where they're initiated. 


---

Comment by mhansen created at 2009-01-16 04:14:08

I guess the patch isn't posted yet, but this seems like "sage -startuptime" which prints out imports as they occur.


---

Attachment


---

Comment by robertwb created at 2009-01-16 04:17:54

Yes, it is a lot like sage -startuptime. One difference is that it prints out where each import is coming from, and also filters based on whether or not the corresponding *.all module has been loaded.


---

Comment by robertwb created at 2009-01-16 07:31:40

To clarify, this patch should not be applied (unless we want the info to come up with every startup, or only enable it with a flag). Also, the work has not been done, What is attached is just a diagnostic tool.


---

Comment by AlexGhitza created at 2009-01-23 07:08:32

Changing type from defect to enhancement.


---

Comment by leif created at 2011-08-21 01:37:19

In case anything should happen here...


---

Comment by kcrisman created at 2011-08-21 04:15:35

Ditto.


---

Comment by leif created at 2011-08-21 06:11:13

Replying to [comment:7 kcrisman]:
> Ditto.

Re: sage-devel thread: I was wondering what you were waiting for.

(Haven't tested the patch here; I think you won't be able to print PARI's variables with this method anyway, at least not easily.)

Note that you can inject code into the C files generated by Cython, e.g. with your favourite friend `sed`, especially into the functions called upon module initialization:

```sh
$ cd devel/sage/sage/rings
$ sed -i -e '/^PyMODINIT_FUNC PyInit_.*(void)$/,+3s/^{$/{\n  printf("Hello!\\n");\n/' real_mpfr.c
$ ../../../../sage -br
----------------------------------------------------------
sage: Building and installing modified Sage library files.
...
building 'sage.rings.real_mpfr' extension
Execute 1 commands (using 1 threads)
...
----------------------------------------------------------------------
----------------------------------------------------------------------
**********************************************************************
*                                                                    *
* Warning: this is a prerelease version, and it may be unstable.     *
*                                                                    *
**********************************************************************
Hello!
sage: 
```

(This example is of course quite specific to the current layout of the C code generated by Cython. Also, for simplicity I've used the less portable `-i` option.)
| Sage Version 4.7.2.alpha1, Release Date: 2011-08-17                |
| Type notebook() for the GUI, and license() for information.        |
Just a "proof of concept"; I can write an appropriate shell script for your debugging purpose once I've found the relevant ticket... ;-)
