# Issue 25431: Binary releases: give better error message if anaconda is present

archive/issues_025431.json:
```json
{
    "body": "CC:  @fchapoton @embray @jhpalmieri @saraedum @slel @vbraun\n\nApparently if Anaconda is installed, you get this message when you run a newly installed Sage binary:\n\n```\n$ ./sage\nRecursionError: maximum recursion depth exceeded during compilation\n************************************************************************\nIt seems that you are attempting to run Sage from an unpacked source\ntarball, but you have not compiled it yet (or maybe the build has not\nfinished). You should run `make` in the Sage root directory first.\nIf you did not intend to build Sage from source, you should download\na binary tarball instead. Read README.txt for more information.\n************************************************************************\n```\n\nCan we give a better error message?\n\nSee\n\n- https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/\n- https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/\n- https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/\n\nIssue created by migration from https://trac.sagemath.org/ticket/25668\n\n",
    "created_at": "2018-06-26T21:10:37Z",
    "labels": [
        "component: distribution",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "Binary releases: give better error message if anaconda is present",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25431",
    "user": "https://github.com/jhpalmieri"
}
```
CC:  @fchapoton @embray @jhpalmieri @saraedum @slel @vbraun

Apparently if Anaconda is installed, you get this message when you run a newly installed Sage binary:

```
$ ./sage
RecursionError: maximum recursion depth exceeded during compilation
************************************************************************
It seems that you are attempting to run Sage from an unpacked source
tarball, but you have not compiled it yet (or maybe the build has not
finished). You should run `make` in the Sage root directory first.
If you did not intend to build Sage from source, you should download
a binary tarball instead. Read README.txt for more information.
************************************************************************
```

Can we give a better error message?

See

- https://ask.sagemath.org/question/42736/linux-binary-seems-to-be-source/
- https://ask.sagemath.org/question/42562/recursionerror-when-installing-sagemath-82/
- https://ask.sagemath.org/question/35132/how-do-i-solve-this-installation-problem/

Issue created by migration from https://trac.sagemath.org/ticket/25668





---

archive/issue_comments_358194.json:
```json
{
    "body": "According to \"j.c.\" on ask.sagemath.org, the solution to installing a binary with Ananconda installed is:\n\n```\nOn the off-chance you're using Anaconda, try commenting out the export \nPATH=\"/anaconda/bin:$PATH\" line in the .bash_profile file (and restarting \nyour terminal) before you run Sage for the first time.\n\nYou can uncomment it again after sage successfully runs (until you have \nto rebuild or upgrade Sage).\n```\n",
    "created_at": "2018-06-26T21:12:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358194",
    "user": "https://github.com/jhpalmieri"
}
```

According to "j.c." on ask.sagemath.org, the solution to installing a binary with Ananconda installed is:

```
On the off-chance you're using Anaconda, try commenting out the export 
PATH="/anaconda/bin:$PATH" line in the .bash_profile file (and restarting 
your terminal) before you run Sage for the first time.

You can uncomment it again after sage successfully runs (until you have 
to rebuild or upgrade Sage).
```




---

archive/issue_comments_358195.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2018-07-11T11:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358195",
    "user": "https://github.com/fchapoton"
}
```

Changing priority from major to critical.



---

archive/issue_comments_358196.json:
```json
{
    "body": "this probably deserves the \"critical\" status, given the number of people trapped by the error message..",
    "created_at": "2018-07-11T11:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358196",
    "user": "https://github.com/fchapoton"
}
```

this probably deserves the "critical" status, given the number of people trapped by the error message..



---

archive/issue_comments_358197.json:
```json
{
    "body": "Changing keywords from \"\" to \"Anaconda, RecursionError\".",
    "created_at": "2018-07-11T11:49:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358197",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "Anaconda, RecursionError".



---

archive/issue_comments_358198.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358198",
    "user": "https://github.com/slel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_358199.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-11T11:50:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358199",
    "user": "https://github.com/slel"
}
```

New commits:



---

archive/issue_comments_358200.json:
```json
{
    "body": "This is catching all errors, not just a `RecursionError`, I think. Is it worth trying to catch just that one?",
    "created_at": "2018-07-11T21:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358200",
    "user": "https://github.com/jhpalmieri"
}
```

This is catching all errors, not just a `RecursionError`, I think. Is it worth trying to catch just that one?



---

archive/issue_comments_358201.json:
```json
{
    "body": "And why does the if block `if [ ! -x \"$SAGE_LOCAL/bin/sage\" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?",
    "created_at": "2018-07-11T21:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358201",
    "user": "https://github.com/jhpalmieri"
}
```

And why does the if block `if [ ! -x "$SAGE_LOCAL/bin/sage" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?



---

archive/issue_comments_358202.json:
```json
{
    "body": "Replying to [comment:7 jhpalmieri]:\n> And why does the if block `if [ ! -x \"$SAGE_LOCAL/bin/sage\" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?\n\nExactly my thought too! The only reasonable explanation is that anaconda itself sets some `$SAGE_XXX` variables.",
    "created_at": "2018-07-11T21:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358202",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:7 jhpalmieri]:
> And why does the if block `if [ ! -x "$SAGE_LOCAL/bin/sage" ]; then ...` run at all? This is bash, not Python, so how is anaconda interfering? What is causing the recursion error?

Exactly my thought too! The only reasonable explanation is that anaconda itself sets some `$SAGE_XXX` variables.



---

archive/issue_comments_358203.json:
```json
{
    "body": "First, I think we should catch an error if `relocate-once.py` does not run successfully, and in particular that's when the message about Anaconda should be printed. \n\nSecond, there are several problems in `relocate-once.py`:\n- Related to anaconda and/or Python 3: the `RecursionError` comes from the line starting\n\n```\np('local/lib/libflint-13.5.2.dylib').patch(1552, 1684)...\n```\n\n That line is 61957 characters long (!), and I wonder if its length is causing problems. Certainly if I delete just that line, I no longer get the `RecursionError`.\n- related to Python 3, if I delete the aforementioned line, I get\n\n```\nRewriting paths for your new installation directory\n===================================================\n\nThis might take a few minutes but only has to be done once.\n\nTraceback (most recent call last):\n  File \"/Users/jpalmier/Downloads/SageMath/relocate-once.py\", line 145, in <module>\n    p('build/make/Makefile-auto').substitute().save()\n  File \"/Users/jpalmier/Downloads/SageMath/relocate-once.py\", line 133, in __call__\n    filename = os.path.join(self.root_path, filename)\n  File \"/anaconda3/lib/python3.6/posixpath.py\", line 94, in join\n    genericpath._check_arg_types('join', a, *p)\n  File \"/anaconda3/lib/python3.6/genericpath.py\", line 151, in _check_arg_types\n    raise TypeError(\"Can't mix strings and bytes in path components\") from None\nTypeError: Can't mix strings and bytes in path components\n```\n",
    "created_at": "2018-07-11T21:50:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358203",
    "user": "https://github.com/jhpalmieri"
}
```

First, I think we should catch an error if `relocate-once.py` does not run successfully, and in particular that's when the message about Anaconda should be printed. 

Second, there are several problems in `relocate-once.py`:
- Related to anaconda and/or Python 3: the `RecursionError` comes from the line starting

```
p('local/lib/libflint-13.5.2.dylib').patch(1552, 1684)...
```

 That line is 61957 characters long (!), and I wonder if its length is causing problems. Certainly if I delete just that line, I no longer get the `RecursionError`.
- related to Python 3, if I delete the aforementioned line, I get

```
Rewriting paths for your new installation directory
===================================================

This might take a few minutes but only has to be done once.

Traceback (most recent call last):
  File "/Users/jpalmier/Downloads/SageMath/relocate-once.py", line 145, in <module>
    p('build/make/Makefile-auto').substitute().save()
  File "/Users/jpalmier/Downloads/SageMath/relocate-once.py", line 133, in __call__
    filename = os.path.join(self.root_path, filename)
  File "/anaconda3/lib/python3.6/posixpath.py", line 94, in join
    genericpath._check_arg_types('join', a, *p)
  File "/anaconda3/lib/python3.6/genericpath.py", line 151, in _check_arg_types
    raise TypeError("Can't mix strings and bytes in path components") from None
TypeError: Can't mix strings and bytes in path components
```




---

archive/issue_comments_358204.json:
```json
{
    "body": "We really need a test machine where this error occurs to see what the value of `$SAGE_LOCAL` is at that point.",
    "created_at": "2018-07-11T21:50:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358204",
    "user": "https://github.com/jdemeyer"
}
```

We really need a test machine where this error occurs to see what the value of `$SAGE_LOCAL` is at that point.



---

archive/issue_comments_358205.json:
```json
{
    "body": "OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...",
    "created_at": "2018-07-11T21:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358205",
    "user": "https://github.com/jdemeyer"
}
```

OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...



---

archive/issue_comments_358206.json:
```json
{
    "body": "Replying to [comment:11 jdemeyer]:\n> OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...\n\nYou mean, there should be an error handler there?",
    "created_at": "2018-07-11T22:04:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358206",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:11 jdemeyer]:
> OK, so the problem is with `relocate-once.py`. That wasn't obvious at all so I guess the error handler there should be improved...

You mean, there should be an error handler there?



---

archive/issue_comments_358207.json:
```json
{
    "body": "By the way, I have now installed Anaconda on OS X, and it's easy enough to add or remove the bad parts in my PATH to test things. Others should feel free to do the same.",
    "created_at": "2018-07-11T22:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358207",
    "user": "https://github.com/jhpalmieri"
}
```

By the way, I have now installed Anaconda on OS X, and it's easy enough to add or remove the bad parts in my PATH to test things. Others should feel free to do the same.



---

archive/issue_comments_358208.json:
```json
{
    "body": "Is the problem just that the script is run with Python 3 instead of Python 2?",
    "created_at": "2018-07-11T22:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358208",
    "user": "https://github.com/jdemeyer"
}
```

Is the problem just that the script is run with Python 3 instead of Python 2?



---

archive/issue_comments_358209.json:
```json
{
    "body": "Replying to [comment:12 jhpalmieri]:\n> You mean, there should be an error handler there?\n\nI'm just wondering who is displaying the message `RecursionError: maximum recursion depth exceeded during compilation`? That's not how Python displays errors by default.",
    "created_at": "2018-07-11T22:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358209",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 jhpalmieri]:
> You mean, there should be an error handler there?

I'm just wondering who is displaying the message `RecursionError: maximum recursion depth exceeded during compilation`? That's not how Python displays errors by default.



---

archive/issue_comments_358210.json:
```json
{
    "body": "If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?",
    "created_at": "2018-07-11T22:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358210",
    "user": "https://github.com/jhpalmieri"
}
```

If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?



---

archive/issue_comments_358211.json:
```json
{
    "body": "Further debugging: if I put some echo statements in the `sage` script before and after running `relocate-once.py`, they both execute. If I put a print statement in `relocate-once.py`, it doesn't print. I am really wondering if the long line makes anaconda's Python 3 barf before it even loads the file.",
    "created_at": "2018-07-11T22:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358211",
    "user": "https://github.com/jhpalmieri"
}
```

Further debugging: if I put some echo statements in the `sage` script before and after running `relocate-once.py`, they both execute. If I put a print statement in `relocate-once.py`, it doesn't print. I am really wondering if the long line makes anaconda's Python 3 barf before it even loads the file.



---

archive/issue_comments_358212.json:
```json
{
    "body": "It looks something like the issue discussed in https://bugs.python.org/issue32758.",
    "created_at": "2018-07-11T22:23:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358212",
    "user": "https://github.com/jhpalmieri"
}
```

It looks something like the issue discussed in https://bugs.python.org/issue32758.



---

archive/issue_comments_358213.json:
```json
{
    "body": "Replying to [comment:15 jdemeyer]:\n> \n> I'm just wondering who is displaying the message\n> > `RecursionError: maximum recursion depth exceeded during compilation`\n> That's not how Python displays errors by default.\n\nSearching the web for [ \"maximum recursion depth exceeded during compilation\" ]\nyields many results, including the following one not related to Sage:\n\n- https://www.reddit.com/r/learnpython/comments/3zusdy/eval_python_beginner/\n\nIt might indicate that the error has something to do with a call to `eval`(?).\n\nThis other result shows that the error can occur even just running `sage --version`:\n\n- https://github.com/Homebrew/homebrew-cask/issues/18279",
    "created_at": "2018-07-11T22:26:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358213",
    "user": "https://github.com/slel"
}
```

Replying to [comment:15 jdemeyer]:
> 
> I'm just wondering who is displaying the message
> > `RecursionError: maximum recursion depth exceeded during compilation`
> That's not how Python displays errors by default.

Searching the web for [ "maximum recursion depth exceeded during compilation" ]
yields many results, including the following one not related to Sage:

- https://www.reddit.com/r/learnpython/comments/3zusdy/eval_python_beginner/

It might indicate that the error has something to do with a call to `eval`(?).

This other result shows that the error can occur even just running `sage --version`:

- https://github.com/Homebrew/homebrew-cask/issues/18279



---

archive/issue_comments_358214.json:
```json
{
    "body": "Replying to [comment:19 slelievre]:\n> It might indicate that the error has something to do with a call to `eval`(?).\n\nOr more generally, just the Python parser. All the evidence points to Python crashing while parsing the `.py` file, before it even executes anything. So it crashes with just the error message without a traceback.",
    "created_at": "2018-07-11T22:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358214",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:19 slelievre]:
> It might indicate that the error has something to do with a call to `eval`(?).

Or more generally, just the Python parser. All the evidence points to Python crashing while parsing the `.py` file, before it even executes anything. So it crashes with just the error message without a traceback.



---

archive/issue_comments_358215.json:
```json
{
    "body": "One obvious fix in Sage is to add error checking in the top-level `sage` script:\n\n```sh\n# If this is a freshly-unpacked binary tarball then run the installer\n# Note: relocate-once.py deletes itself upon successful completion\nif [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n    \"$SAGE_ROOT/relocate-once.py\"\nfi\n```\n",
    "created_at": "2018-07-11T22:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358215",
    "user": "https://github.com/jdemeyer"
}
```

One obvious fix in Sage is to add error checking in the top-level `sage` script:

```sh
# If this is a freshly-unpacked binary tarball then run the installer
# Note: relocate-once.py deletes itself upon successful completion
if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
    "$SAGE_ROOT/relocate-once.py"
fi
```




---

archive/issue_comments_358216.json:
```json
{
    "body": "It's not the length of the line, it's the number of methods on the line. If I change `patch(1552, 1684)` (etc.) to `patch(1,1)` throughout, the line gets much shorter, but it still crashes. 1500 methods seems to be the limit.",
    "created_at": "2018-07-11T22:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358216",
    "user": "https://github.com/jhpalmieri"
}
```

It's not the length of the line, it's the number of methods on the line. If I change `patch(1552, 1684)` (etc.) to `patch(1,1)` throughout, the line gets much shorter, but it still crashes. 1500 methods seems to be the limit.



---

archive/issue_comments_358217.json:
```json
{
    "body": "Replying to [comment:21 jdemeyer]:\n> One obvious fix in Sage is to add error checking in the top-level `sage` script:\n> {{{\n> #!sh\n> # If this is a freshly-unpacked binary tarball then run the installer\n> # Note: relocate-once.py deletes itself upon successful completion\n> if [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n>     \"$SAGE_ROOT/relocate-once.py\"\n> fi\n> }}}\n\nYes, exactly.",
    "created_at": "2018-07-11T22:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358217",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:21 jdemeyer]:
> One obvious fix in Sage is to add error checking in the top-level `sage` script:
> {{{
> #!sh
> # If this is a freshly-unpacked binary tarball then run the installer
> # Note: relocate-once.py deletes itself upon successful completion
> if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
>     "$SAGE_ROOT/relocate-once.py"
> fi
> }}}

Yes, exactly.



---

archive/issue_comments_358218.json:
```json
{
    "body": "Replying to [comment:16 jhpalmieri]:\n> If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?\n\nMaybe I was wrong about this: Sage's Python 3 is now giving this error on a similar file: `[1,2,3]` with `.sort()` appended 1500 times \u2013\u00a0not good Python, but enough methods to give Python 3 problems. Not Python 2, though.",
    "created_at": "2018-07-11T22:52:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358218",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:16 jhpalmieri]:
> If I run `relocate-once.py` using Sage's Python 3.6.6, I do not get the recursion error. (I get the string/bytes error, of course.) So maybe Anaconda's Python 3.6.5 is badly configured?

Maybe I was wrong about this: Sage's Python 3 is now giving this error on a similar file: `[1,2,3]` with `.sort()` appended 1500 times – not good Python, but enough methods to give Python 3 problems. Not Python 2, though.



---

archive/issue_comments_358219.json:
```json
{
    "body": "In any case, down the line, we should also fix the Python 3 incompatibilities in `relocate-once.py`.",
    "created_at": "2018-07-11T22:56:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358219",
    "user": "https://github.com/jhpalmieri"
}
```

In any case, down the line, we should also fix the Python 3 incompatibilities in `relocate-once.py`.



---

archive/issue_comments_358220.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-14T07:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358220",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_358221.json:
```json
{
    "body": "Should we check whether we're running Python 3, whether executing `relocate-once.py` exits successfully, or both?",
    "created_at": "2018-07-14T14:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358221",
    "user": "https://github.com/jhpalmieri"
}
```

Should we check whether we're running Python 3, whether executing `relocate-once.py` exits successfully, or both?



---

archive/issue_comments_358222.json:
```json
{
    "body": "Don't check whether you are doing the wrong thing, just do the right thing: `python2 relocate-once.py`.\n\nAnd yes, the exit status must be checked.",
    "created_at": "2018-07-14T19:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358222",
    "user": "https://github.com/jdemeyer"
}
```

Don't check whether you are doing the wrong thing, just do the right thing: `python2 relocate-once.py`.

And yes, the exit status must be checked.



---

archive/issue_comments_358223.json:
```json
{
    "body": "On my OS X machine:\n\n```\n$ which python2\n$ ls /usr/bin/pyth*\n/usr/bin/python           /usr/bin/python2.7        /usr/bin/pythonw\n/usr/bin/python-config    /usr/bin/python2.7-config /usr/bin/pythonw2.7\n```\n\nSo do we hard-code `python2.7`? Seems too fragile. Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky. `command -v python2 && python2 relocate-once.py`, etc.? What do you suggest?\n\nIt seems like right now, the best we can do is check the exit status and print a message. Maybe try to detect if Python 3 is the problem. I've also opened an issue for Python 3 compatibility at the `sagemath/binary-pkg` github page.",
    "created_at": "2018-07-14T20:16:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358223",
    "user": "https://github.com/jhpalmieri"
}
```

On my OS X machine:

```
$ which python2
$ ls /usr/bin/pyth*
/usr/bin/python           /usr/bin/python2.7        /usr/bin/pythonw
/usr/bin/python-config    /usr/bin/python2.7-config /usr/bin/pythonw2.7
```

So do we hard-code `python2.7`? Seems too fragile. Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky. `command -v python2 && python2 relocate-once.py`, etc.? What do you suggest?

It seems like right now, the best we can do is check the exit status and print a message. Maybe try to detect if Python 3 is the problem. I've also opened an issue for Python 3 compatibility at the `sagemath/binary-pkg` github page.



---

archive/issue_comments_358224.json:
```json
{
    "body": "Here is one suggestion:\n\n```diff\ndiff --git a/sage b/sage\nindex 64629eee30..81ab7e908e 100755\n--- a/sage\n+++ b/sage\n@@ -125,6 +125,28 @@ export SAGE_ROOT\n # Note: relocate-once.py deletes itself upon successful completion\n if [ -x \"$SAGE_ROOT/relocate-once.py\" ]; then\n     \"$SAGE_ROOT/relocate-once.py\"\n+    if [ $? -ne 0 ]; then\n+        PYVER=`python -c 'import sys; print(sys.version_info[0])'`\n+        if [ $PYVER = '3' ]; then\n+           echo >&2\n+           echo >&2 \"Error: Sage must run the script 'relocate-once.py' to complete\"\n+           echo >&2 \"this installation. The script is not compatible with Python 3,\"\n+           echo >&2 \"which is your system's version of Python. Please ensure that\"\n+           echo >&2 \"the command 'python' runs Python 2. This only needs to be done\"\n+           echo >&2 \"the first you run Sage.\"\n+           echo >&2\n+           echo >&2 \"If you have Anaconda installed, for example, it may have modified\"\n+           echo >&2 \"your PATH. Check your PATH by running the terminal command\"\n+           echo >&2 \"    echo \\$PATH\"\n+           echo >&2 \"If it starts with something containing '/anaconda3/bin', you need\"\n+           echo >&2 \"to remove this from your PATH the first time you run Sage. After\"\n+           echo >&2 \"Sage has run once, you may restore the original value of PATH.\"\n+           exit 1\n+        else\n+           echo >&2 \"Error running the script 'relocate-once.py'.\"\n+           exit 1\n+        fi\n+    fi\n fi\n \n # Run the actual Sage script\n```\n",
    "created_at": "2018-07-14T20:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358224",
    "user": "https://github.com/jhpalmieri"
}
```

Here is one suggestion:

```diff
diff --git a/sage b/sage
index 64629eee30..81ab7e908e 100755
--- a/sage
+++ b/sage
@@ -125,6 +125,28 @@ export SAGE_ROOT
 # Note: relocate-once.py deletes itself upon successful completion
 if [ -x "$SAGE_ROOT/relocate-once.py" ]; then
     "$SAGE_ROOT/relocate-once.py"
+    if [ $? -ne 0 ]; then
+        PYVER=`python -c 'import sys; print(sys.version_info[0])'`
+        if [ $PYVER = '3' ]; then
+           echo >&2
+           echo >&2 "Error: Sage must run the script 'relocate-once.py' to complete"
+           echo >&2 "this installation. The script is not compatible with Python 3,"
+           echo >&2 "which is your system's version of Python. Please ensure that"
+           echo >&2 "the command 'python' runs Python 2. This only needs to be done"
+           echo >&2 "the first you run Sage."
+           echo >&2
+           echo >&2 "If you have Anaconda installed, for example, it may have modified"
+           echo >&2 "your PATH. Check your PATH by running the terminal command"
+           echo >&2 "    echo \$PATH"
+           echo >&2 "If it starts with something containing '/anaconda3/bin', you need"
+           echo >&2 "to remove this from your PATH the first time you run Sage. After"
+           echo >&2 "Sage has run once, you may restore the original value of PATH."
+           exit 1
+        else
+           echo >&2 "Error running the script 'relocate-once.py'."
+           exit 1
+        fi
+    fi
 fi
 
 # Run the actual Sage script
```




---

archive/issue_comments_358225.json:
```json
{
    "body": "Replying to [comment:29 jhpalmieri]:\n> Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.\n\nClunky but I think it's the best solution. I would probably skip the `python2.6` check though.\n\nDo we already know why things go wrong with Anaconda?",
    "created_at": "2018-07-15T08:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358225",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:29 jhpalmieri]:
> Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.

Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.

Do we already know why things go wrong with Anaconda?



---

archive/issue_comments_358226.json:
```json
{
    "body": "Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?",
    "created_at": "2018-07-15T09:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358226",
    "user": "https://github.com/slel"
}
```

Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?



---

archive/issue_comments_358227.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358227",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_358228.json:
```json
{
    "body": "Replying to [comment:31 jdemeyer]:\n> Replying to [comment:29 jhpalmieri]:\n> > Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.\n> \n> Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.\n> \n> Do we already know why things go wrong with Anaconda?\n\nIt seems to me that either Python 3 in general, or Anaconda's Python 3, doesn't like lines with too many attributes/methods. Even without that line, the script is not compatible with Python 3.\n\nReplying to [comment:32 slelievre]:\n> Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?\n\nThat's a good idea, let's do that. This branch works for me.\n----\nNew commits:",
    "created_at": "2018-07-15T18:40:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358228",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:31 jdemeyer]:
> Replying to [comment:29 jhpalmieri]:
> > Do we do `python2 relocate-once.py || python2.6 relocate-once.py || python2.7 relocate-once.py || ...`? Clunky.
> 
> Clunky but I think it's the best solution. I would probably skip the `python2.6` check though.
> 
> Do we already know why things go wrong with Anaconda?

It seems to me that either Python 3 in general, or Anaconda's Python 3, doesn't like lines with too many attributes/methods. Even without that line, the script is not compatible with Python 3.

Replying to [comment:32 slelievre]:
> Couldn't `relocate-once.py` be run using the Python2 shipped by Sage?

That's a good idea, let's do that. This branch works for me.
----
New commits:



---

archive/issue_comments_358229.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-07-15T18:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_358230.json:
```json
{
    "body": "Making ticket summary and description reflect the diagnosis and the proposed fix.",
    "created_at": "2018-07-15T19:17:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358230",
    "user": "https://github.com/slel"
}
```

Making ticket summary and description reflect the diagnosis and the proposed fix.



---

archive/issue_comments_358231.json:
```json
{
    "body": "Replying to [comment:34 jhpalmieri]:\n> This branch works for me.\n\nHow did you test it?",
    "created_at": "2018-07-16T06:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358231",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:34 jhpalmieri]:
> This branch works for me.

How did you test it?



---

archive/issue_comments_358232.json:
```json
{
    "body": "If this really works, then positive review. But you have to convince me that you tested it properly.",
    "created_at": "2018-07-16T06:17:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358232",
    "user": "https://github.com/jdemeyer"
}
```

If this really works, then positive review. But you have to convince me that you tested it properly.



---

archive/issue_comments_358233.json:
```json
{
    "body": "First, I'm relying on this assumption: `relocate-once.py` will only be present in binary releases (and therefore `$SAGE_ROOT/local/bin/python2` exists). I tested by downloading a binary release. I also downloaded Anaconda and let it modify my path (when you install, at least on OS X, it writes to `$HOME/.profile`). So I had this:\n\n```\n$ echo $PATH\n/Users/palmieri/anaconda3/bin:....\n$ which python\n/Users/palmieri/anaconda3/bin/python\n$ python --version\nPython 3.6.5 :: Anaconda, Inc.\n```\n\nThen running `./sage` from the binary distribution works:\n\n```\n$ ./sage\n\nRewriting paths for your new installation directory\n===================================================\n\nThis might take a few minutes but only has to be done once.\n\npatching ...\n...\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 8.2, Release Date: 2018-05-05                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nsage: 3+5\n8\nsage: Sq(2)**2\nSq(1,1)\n```\n\n\nI also took a binary distribution and broke `relocate-once.py`. The result of running `./sage`:\n\n```\n$ ./sage\n  File \"/Users/palmieri/Desktop/Sage_stuff/sage_builds/BDIST/SageMath/relocate-once.py\", line 9\n    print('hello\")\n                 ^\nSyntaxError: EOL while scanning string literal\nError running the script 'relocate-once.py'.\n```\n\nNote that I didn't actually build a binary distribution, I just patched the file `SAGE_ROOT/sage` by hand.\n\nThe error message if I run `./sage` from a freshly unpacked source tarball of course remains the same (since `relocate-once.py` does not exist, the if block is not executed).\n\nWhat else would you like me to check?",
    "created_at": "2018-07-16T16:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358233",
    "user": "https://github.com/jhpalmieri"
}
```

First, I'm relying on this assumption: `relocate-once.py` will only be present in binary releases (and therefore `$SAGE_ROOT/local/bin/python2` exists). I tested by downloading a binary release. I also downloaded Anaconda and let it modify my path (when you install, at least on OS X, it writes to `$HOME/.profile`). So I had this:

```
$ echo $PATH
/Users/palmieri/anaconda3/bin:....
$ which python
/Users/palmieri/anaconda3/bin/python
$ python --version
Python 3.6.5 :: Anaconda, Inc.
```

Then running `./sage` from the binary distribution works:

```
$ ./sage

Rewriting paths for your new installation directory
===================================================

This might take a few minutes but only has to be done once.

patching ...
...
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.2, Release Date: 2018-05-05                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: 3+5
8
sage: Sq(2)**2
Sq(1,1)
```


I also took a binary distribution and broke `relocate-once.py`. The result of running `./sage`:

```
$ ./sage
  File "/Users/palmieri/Desktop/Sage_stuff/sage_builds/BDIST/SageMath/relocate-once.py", line 9
    print('hello")
                 ^
SyntaxError: EOL while scanning string literal
Error running the script 'relocate-once.py'.
```

Note that I didn't actually build a binary distribution, I just patched the file `SAGE_ROOT/sage` by hand.

The error message if I run `./sage` from a freshly unpacked source tarball of course remains the same (since `relocate-once.py` does not exist, the if block is not executed).

What else would you like me to check?



---

archive/issue_comments_358234.json:
```json
{
    "body": "On which system did you check?",
    "created_at": "2018-07-17T06:38:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358234",
    "user": "https://github.com/jdemeyer"
}
```

On which system did you check?



---

archive/issue_comments_358235.json:
```json
{
    "body": "OS X \u2013\u00a0it is the only system I have easy access to.",
    "created_at": "2018-07-17T16:06:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358235",
    "user": "https://github.com/jhpalmieri"
}
```

OS X – it is the only system I have easy access to.



---

archive/issue_comments_358236.json:
```json
{
    "body": "shall we put this into \"positive review\" now ?",
    "created_at": "2018-07-20T15:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358236",
    "user": "https://github.com/fchapoton"
}
```

shall we put this into "positive review" now ?



---

archive/issue_comments_358237.json:
```json
{
    "body": "update milestone 8.3 -> 8.4",
    "created_at": "2018-08-03T19:20:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358237",
    "user": "https://github.com/videlec"
}
```

update milestone 8.3 -> 8.4



---

archive/issue_events_064263.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2018-08-03T19:20:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25431#event-64263"
}
```



---

archive/issue_comments_358238.json:
```json
{
    "body": "Any progress on this? I would very much like it to get merged in 8.4, since it has been a common issue, at least on ask.sagemath.org.",
    "created_at": "2018-08-27T16:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358238",
    "user": "https://github.com/jhpalmieri"
}
```

Any progress on this? I would very much like it to get merged in 8.4, since it has been a common issue, at least on ask.sagemath.org.



---

archive/issue_comments_358239.json:
```json
{
    "body": "Ping?",
    "created_at": "2018-12-06T22:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358239",
    "user": "https://github.com/jhpalmieri"
}
```

Ping?



---

archive/issue_comments_358240.json:
```json
{
    "body": "Volker, would you review this?",
    "created_at": "2018-12-10T11:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358240",
    "user": "https://github.com/slel"
}
```

Volker, would you review this?



---

archive/issue_events_064264.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-10T11:30:02Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "milestone": "sage-8.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25431#event-64264"
}
```



---

archive/issue_events_064265.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2018-12-10T11:30:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "milestone": "sage-8.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25431#event-64265"
}
```



---

archive/issue_comments_358241.json:
```json
{
    "body": "Maybe it works, but it seems a bit sketchy to use the Python in Sage to run relocate-once.py.  I admit, I don't quite understand exactly what it is `relocate-once.py` does, but if the Python in Sage and the libraries it depends on haven't been \"relocated\" yet, how can you guarantee they'll work properly?\n\nI think it would make more sense to modify `relocate-once.py` to just work better on more Pythons.  In particular, I don't think it's *necessary* for it be implemented in such a way that it does not contain extremely long expressions that tax the parser/peephole optimizers in Python.",
    "created_at": "2018-12-10T11:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358241",
    "user": "https://github.com/embray"
}
```

Maybe it works, but it seems a bit sketchy to use the Python in Sage to run relocate-once.py.  I admit, I don't quite understand exactly what it is `relocate-once.py` does, but if the Python in Sage and the libraries it depends on haven't been "relocated" yet, how can you guarantee they'll work properly?

I think it would make more sense to modify `relocate-once.py` to just work better on more Pythons.  In particular, I don't think it's *necessary* for it be implemented in such a way that it does not contain extremely long expressions that tax the parser/peephole optimizers in Python.



---

archive/issue_comments_358242.json:
```json
{
    "body": "This is a rather fragile workaround, run Sage's python2 while the rpaths in the binary point to the wrong place and pray that none of those shared libraries end up being used by relocate-once.\n\nThe thing that needs to be done eventually is making relocate-once python3 compatible, including not emitting very long chains of method calls.",
    "created_at": "2018-12-10T12:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358242",
    "user": "https://github.com/vbraun"
}
```

This is a rather fragile workaround, run Sage's python2 while the rpaths in the binary point to the wrong place and pray that none of those shared libraries end up being used by relocate-once.

The thing that needs to be done eventually is making relocate-once python3 compatible, including not emitting very long chains of method calls.



---

archive/issue_comments_358243.json:
```json
{
    "body": "A compromise would be to use the system Python 2 if we can find it (via something like `python2 relocate-once.py || python2.7 relocate-once.py || ...`) and otherwise call Sage's Python 2 and hope that it works. Is it better to have something that you know will break if the system `python` runs Python 3, or to have something that might work in that situation, even if it's fragile?\n\nOtherwise, this puts the ball in the court of the people who maintain the Sage binary distributions. I seem to have opened up https://github.com/sagemath/binary-pkg/issues/16 6 months ago, but no progress yet. I don't have the time to figure out how `relocate-once.py` is generated and then to redo it to avoid the long chains of methods.",
    "created_at": "2018-12-10T19:20:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358243",
    "user": "https://github.com/jhpalmieri"
}
```

A compromise would be to use the system Python 2 if we can find it (via something like `python2 relocate-once.py || python2.7 relocate-once.py || ...`) and otherwise call Sage's Python 2 and hope that it works. Is it better to have something that you know will break if the system `python` runs Python 3, or to have something that might work in that situation, even if it's fragile?

Otherwise, this puts the ball in the court of the people who maintain the Sage binary distributions. I seem to have opened up https://github.com/sagemath/binary-pkg/issues/16 6 months ago, but no progress yet. I don't have the time to figure out how `relocate-once.py` is generated and then to redo it to avoid the long chains of methods.



---

archive/issue_comments_358244.json:
```json
{
    "body": "I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16",
    "created_at": "2018-12-11T02:47:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358244",
    "user": "https://github.com/vbraun"
}
```

I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16



---

archive/issue_comments_358245.json:
```json
{
    "body": "I don't know if this has ever happened specifically with the relocate-once.py script, but I've also had problems in the past with Python 2.7 bytecode compiler crashing on extremely long expressions, particularly arithmetic expressions like `a = 1; a + a + a + a + ...` repeating a few thousand times (incidentally only if `a` is a variable; if it's a `1` literal I think those constant expressions get optimized before reaching the compiler).\n\nIn fact it was only a couple years ago I think that they fixed this to at least raise a `RuntimeError` instead of segfaulting.",
    "created_at": "2018-12-11T07:56:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358245",
    "user": "https://github.com/embray"
}
```

I don't know if this has ever happened specifically with the relocate-once.py script, but I've also had problems in the past with Python 2.7 bytecode compiler crashing on extremely long expressions, particularly arithmetic expressions like `a = 1; a + a + a + a + ...` repeating a few thousand times (incidentally only if `a` is a variable; if it's a `1` literal I think those constant expressions get optimized before reaching the compiler).

In fact it was only a couple years ago I think that they fixed this to at least raise a `RuntimeError` instead of segfaulting.



---

archive/issue_comments_358246.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-12-11T16:59:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_358247.json:
```json
{
    "body": "Replying to [comment:52 vbraun]:\n> I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16 \n\nThanks!\n\nFor this ticket, the only thing left to do is error-checking. Ready for review.\n----\nNew commits:",
    "created_at": "2018-12-11T17:00:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358247",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:52 vbraun]:
> I'm fixing this at https://github.com/sagemath/binary-pkg/issues/16 

Thanks!

For this ticket, the only thing left to do is error-checking. Ready for review.
----
New commits:



---

archive/issue_comments_358248.json:
```json
{
    "body": "Changing priority from critical to minor.",
    "created_at": "2018-12-12T03:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358248",
    "user": "https://github.com/jhpalmieri"
}
```

Changing priority from critical to minor.



---

archive/issue_comments_358249.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-12T14:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358249",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_358250.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-15T19:24:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358250",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_064266.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-12-15T19:24:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/25431#event-64266"
}
```



---

archive/issue_comments_358251.json:
```json
{
    "body": "(Editing ticket description to reflect that the fix is not the one\nsuggested by the ticket summary.)",
    "created_at": "2018-12-29T18:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25431#issuecomment-358251",
    "user": "https://github.com/slel"
}
```

(Editing ticket description to reflect that the fix is not the one
suggested by the ticket summary.)
