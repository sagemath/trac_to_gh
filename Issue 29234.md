# Issue 29234: Failing doctest in R interface due to missing lattice library

archive/issues_029234.json:
```json
{
    "body": "CC:  tmonteil @kiwifb @isuruf @EmmanuelCharpentier @embray @dimpase\n\nKeywords: R, spkg-configure, lattice library\n\n```\nsage -t src/sage/interfaces/r.py\n**********************************************************************\nFile \"src/sage/interfaces/r.py\", line 1318, in sage.interfaces.r.R.plot\nFailed example:\n    r.library(\"lattice\")\nException raised:\n    Traceback (most recent call last):\n      File \"/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.interfaces.r.R.plot[5]>\", line 1, in <module>\n        r.library(\"lattice\")\n      File \"/sage/local/lib/python2.7/site-packages/sage/interfaces/r.py\", line 863, in library\n        raise ImportError(\"R library {} not installed\".format(library_name))\n    ImportError: R library lattice not installed\n```\n\nsee e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).\n\nEither we should require the lattice library to be installed for using the system R or we should mark this doctest as `# not tested`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29471\n\n",
    "created_at": "2020-04-06T09:05:24Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Failing doctest in R interface due to missing lattice library",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29234",
    "user": "https://github.com/kliem"
}
```
CC:  tmonteil @kiwifb @isuruf @EmmanuelCharpentier @embray @dimpase

Keywords: R, spkg-configure, lattice library

```
sage -t src/sage/interfaces/r.py
**********************************************************************
File "src/sage/interfaces/r.py", line 1318, in sage.interfaces.r.R.plot
Failed example:
    r.library("lattice")
Exception raised:
    Traceback (most recent call last):
      File "/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.interfaces.r.R.plot[5]>", line 1, in <module>
        r.library("lattice")
      File "/sage/local/lib/python2.7/site-packages/sage/interfaces/r.py", line 863, in library
        raise ImportError("R library {} not installed".format(library_name))
    ImportError: R library lattice not installed
```

see e.g. [https://github.com/mkoeppe/sage/runs/542655815](https://github.com/mkoeppe/sage/runs/542655815).

Either we should require the lattice library to be installed for using the system R or we should mark this doctest as `# not tested`.

Issue created by migration from https://trac.sagemath.org/ticket/29471





---

archive/issue_comments_413822.json:
```json
{
    "body": "That is very interesting, and could only have happened as we allows system R now in some circumstances.  I would be willing to bet there are other standard libraries that not every system R has that we configured to build in \"our\" R - maybe this ticket should be to ensure that system R has *all* of them.  (They are really very standard so it's not a big burden, and if someone really wants to use a system R without them, then they just get failing doctests.)\n\nIn any case, don't do this as `not tested`, though - we would still want to test that Sage-the-library built from scratch passes its own doctests.",
    "created_at": "2020-04-06T13:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413822",
    "user": "https://github.com/kcrisman"
}
```

That is very interesting, and could only have happened as we allows system R now in some circumstances.  I would be willing to bet there are other standard libraries that not every system R has that we configured to build in "our" R - maybe this ticket should be to ensure that system R has *all* of them.  (They are really very standard so it's not a big burden, and if someone really wants to use a system R without them, then they just get failing doctests.)

In any case, don't do this as `not tested`, though - we would still want to test that Sage-the-library built from scratch passes its own doctests.



---

archive/issue_comments_413823.json:
```json
{
    "body": "On Debian and Ubuntu r-cran-lattice is a recommended package for r-base-core https://packages.debian.org/buster/r-recommended (part of r-recommended).\n\nIf we require those packages in order to use the system R, we should do so at configure.\n\nIf we want this to be optional and still want to keep the doctest, I think we would need some flag like `# optional -- r-recommended`. I don't know if this is even possible.",
    "created_at": "2020-04-06T14:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413823",
    "user": "https://github.com/kliem"
}
```

On Debian and Ubuntu r-cran-lattice is a recommended package for r-base-core https://packages.debian.org/buster/r-recommended (part of r-recommended).

If we require those packages in order to use the system R, we should do so at configure.

If we want this to be optional and still want to keep the doctest, I think we would need some flag like `# optional -- r-recommended`. I don't know if this is even possible.



---

archive/issue_comments_413824.json:
```json
{
    "body": "For context, in the automatic tests defined by `tox.ini` and `build/bin/write-dockerfile.sh` (which is what is run on [GitHub](GitHub) Actions), packages are installed on Debian distributions using `apt-get install --no-install-recommends`. \n\nIf the `lattice` package is important (I don't know as I don't use R), we can certainly add `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.",
    "created_at": "2020-04-06T16:14:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413824",
    "user": "https://github.com/mkoeppe"
}
```

For context, in the automatic tests defined by `tox.ini` and `build/bin/write-dockerfile.sh` (which is what is run on [GitHub](GitHub) Actions), packages are installed on Debian distributions using `apt-get install --no-install-recommends`. 

If the `lattice` package is important (I don't know as I don't use R), we can certainly add `r-cran-lattice` to `build/pkgs/r/distros/debian.txt`.



---

archive/issue_comments_413825.json:
```json
{
    "body": "Thanks for clarifying. Then this is almost expected behavior. If you use a system `R` which doesn't have all recommended packages than you will have limited functionality. I would add that line just to make the [GitHub](GitHub) actions pass. This is a small package (only around 1 MB if you already install r-base-core, which we do).",
    "created_at": "2020-04-06T17:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413825",
    "user": "https://github.com/kliem"
}
```

Thanks for clarifying. Then this is almost expected behavior. If you use a system `R` which doesn't have all recommended packages than you will have limited functionality. I would add that line just to make the [GitHub](GitHub) actions pass. This is a small package (only around 1 MB if you already install r-base-core, which we do).



---

archive/issue_comments_413826.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-06T17:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413826",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_413827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-06T17:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_413828.json:
```json
{
    "body": "This seems to work:\n\nhttps://github.com/kliem/sage-test-27122/actions/runs/72102779",
    "created_at": "2020-04-07T09:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413828",
    "user": "https://github.com/kliem"
}
```

This seems to work:

https://github.com/kliem/sage-test-27122/actions/runs/72102779



---

archive/issue_comments_413829.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-08T01:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413829",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_413830.json:
```json
{
    "body": "LGTM",
    "created_at": "2020-04-08T01:13:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413830",
    "user": "https://github.com/mkoeppe"
}
```

LGTM



---

archive/issue_events_075123.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-04-12T15:34:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/29234#event-75123"
}
```



---

archive/issue_comments_413831.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-12T15:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29234",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29234#issuecomment-413831",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
