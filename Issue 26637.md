# Issue 26637: Use current_randstate() for seeding PRNGs used by Interfaces

Issue created by migration from Trac.

Original creator: embray

Original creation time: 2018-12-11 09:29:09

CC:  dimpase jdemeyer

There is a method `Interface.rand_seed()` which returns a randomized seed that can be used to initialize different `Interface`s RNGs, where applicable (it use called by individual interface implementations' `set_seed()` methods when the provided seed is `None`).

For some reason (itself not entirely clear to me) this does not use the `current_randstate()`, but rather initializes a new `randstate()` and uses that to obtain an arbitrary random seed.  Maybe there's no good reason for that in the first place, in fact?

In any case, for the doctests we want consistent results, so with this patch I have this method use `current_randstate().seed()` so that results are consistent across test runs.

This came up in comment:341:ticket:22626 where it turned out some tests that use the GAP pexpect interface which depend on GAP's PRNG were different between test runs.

There are many other tests like this sprinkled about which manage this by manually calling `current_randstate().set_seed_gap()` before the test, but putting something like this in the documentation would seem rather distracting.


---

Comment by embray created at 2018-12-11 09:29:16

Changing status from new to needs_review.


---

Comment by dimpase created at 2018-12-11 09:35:16

OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.


---

Comment by embray created at 2018-12-11 09:46:43

Replying to [comment:2 dimpase]:
> OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.

Already did last night.  Remarkably, nothing broke.  There probably isn't actually all that much that depends on this, and most tests that could have been affected by it were already manually calling `current_randstate().set_seed_<foo>()` ahead of time...


---

Comment by dimpase created at 2018-12-11 09:48:59

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2018-12-11 09:48:59

over to bots...


---

Comment by embray created at 2018-12-20 12:46:01

Changing priority from major to critical.


---

Comment by embray created at 2018-12-20 12:46:01

Marking this as critical since it's a dependency of #22626


---

Comment by vbraun created at 2018-12-23 23:41:17

Resolution: fixed


---

Comment by embray created at 2018-12-28 11:13:08

Closed 4 days ago so I'm assuming this didn't go in 8.5.  Please don't close a ticket as fixed without updating the milestone to its target release.
