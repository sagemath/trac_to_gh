# Issue 26637: Use current_randstate() for seeding PRNGs used by Interfaces

archive/issues_026637.json:
```json
{
    "body": "CC:  dimpase jdemeyer\n\nThere is a method `Interface.rand_seed()` which returns a randomized seed that can be used to initialize different `Interface`s RNGs, where applicable (it use called by individual interface implementations' `set_seed()` methods when the provided seed is `None`).\n\nFor some reason (itself not entirely clear to me) this does not use the `current_randstate()`, but rather initializes a new `randstate()` and uses that to obtain an arbitrary random seed.  Maybe there's no good reason for that in the first place, in fact?\n\nIn any case, for the doctests we want consistent results, so with this patch I have this method use `current_randstate().seed()` so that results are consistent across test runs.\n\nThis came up in comment:341:ticket:22626 where it turned out some tests that use the GAP pexpect interface which depend on GAP's PRNG were different between test runs.\n\nThere are many other tests like this sprinkled about which manage this by manually calling `current_randstate().set_seed_gap()` before the test, but putting something like this in the documentation would seem rather distracting.\n\nIssue created by migration from https://trac.sagemath.org/ticket/26874\n\n",
    "created_at": "2018-12-11T09:29:09Z",
    "labels": [
        "doctest framework",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.6",
    "title": "Use current_randstate() for seeding PRNGs used by Interfaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26637",
    "user": "embray"
}
```
CC:  dimpase jdemeyer

There is a method `Interface.rand_seed()` which returns a randomized seed that can be used to initialize different `Interface`s RNGs, where applicable (it use called by individual interface implementations' `set_seed()` methods when the provided seed is `None`).

For some reason (itself not entirely clear to me) this does not use the `current_randstate()`, but rather initializes a new `randstate()` and uses that to obtain an arbitrary random seed.  Maybe there's no good reason for that in the first place, in fact?

In any case, for the doctests we want consistent results, so with this patch I have this method use `current_randstate().seed()` so that results are consistent across test runs.

This came up in comment:341:ticket:22626 where it turned out some tests that use the GAP pexpect interface which depend on GAP's PRNG were different between test runs.

There are many other tests like this sprinkled about which manage this by manually calling `current_randstate().set_seed_gap()` before the test, but putting something like this in the documentation would seem rather distracting.

Issue created by migration from https://trac.sagemath.org/ticket/26874





---

archive/issue_comments_374326.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-12-11T09:29:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374326",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_374327.json:
```json
{
    "body": "OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.",
    "created_at": "2018-12-11T09:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374327",
    "user": "dimpase"
}
```

OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.



---

archive/issue_comments_374328.json:
```json
{
    "body": "Replying to [comment:2 dimpase]:\n> OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.\n\nAlready did last night.  Remarkably, nothing broke.  There probably isn't actually all that much that depends on this, and most tests that could have been affected by it were already manually calling `current_randstate().set_seed_<foo>()` ahead of time...",
    "created_at": "2018-12-11T09:46:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374328",
    "user": "embray"
}
```

Replying to [comment:2 dimpase]:
> OK, reviewing this probably needs a test run of ptestlong and ptest just to make sure nothing breaks. Looking into this now.

Already did last night.  Remarkably, nothing broke.  There probably isn't actually all that much that depends on this, and most tests that could have been affected by it were already manually calling `current_randstate().set_seed_<foo>()` ahead of time...



---

archive/issue_comments_374329.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-12-11T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374329",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_374330.json:
```json
{
    "body": "over to bots...",
    "created_at": "2018-12-11T09:48:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374330",
    "user": "dimpase"
}
```

over to bots...



---

archive/issue_comments_374331.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2018-12-20T12:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374331",
    "user": "embray"
}
```

Changing priority from major to critical.



---

archive/issue_comments_374332.json:
```json
{
    "body": "Marking this as critical since it's a dependency of #22626",
    "created_at": "2018-12-20T12:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374332",
    "user": "embray"
}
```

Marking this as critical since it's a dependency of #22626



---

archive/issue_comments_374333.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-12-23T23:41:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374333",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_374334.json:
```json
{
    "body": "Closed 4 days ago so I'm assuming this didn't go in 8.5.  Please don't close a ticket as fixed without updating the milestone to its target release.",
    "created_at": "2018-12-28T11:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26637",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26637#issuecomment-374334",
    "user": "embray"
}
```

Closed 4 days ago so I'm assuming this didn't go in 8.5.  Please don't close a ticket as fixed without updating the milestone to its target release.
