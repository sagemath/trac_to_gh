# Issue 15645: Implement a catalog for crystals

Issue created by migration from https://trac.sagemath.org/ticket/15882

Original creator: tscrim

Original creation time: 2014-03-01 18:09:27

Assignee: sage-combinat

CC:  sage-combinat nthiery aschilling bsalisbury1

Keywords: crystals catalog

Make a catalog for crystals similar to graphs/codes/etc. and remove things like `CrystalOf*` and `InfinityCrystalOf*` from the global namespace in an effort to clean it up.


---

Comment by tscrim created at 2014-03-01 18:51:29

Starting to get there.
----
New commits:


---

Comment by nthiery created at 2014-03-03 09:38:46

Thanks Travis! I haven't checked the code yet, but this will be a nice improvement.

One thing I have been pondering for some time: at the end of the day, we can expect that there will eventually be exactly two entry points for crystals in the global name space, namely `crystals` and `Crystals` (indeed, once #10963 will be in, we will be able to deprecate `FiniteCrystals()` and friends in favor of `Crystals().Finite()`).

Would it make sense to push the logic even further and actually have a single entry point, which probably should be `Crystals`? In other words, could the category also play the role of catalog of implementations? Maybe something like `Crystals.catalog.CrystalOfLetters(...)` though this is a bit heavyweight.

Of course this question is not just about crystals, but could apply to groups, posets, ...

Anyway, just food for thought for after this ticket.


---

Comment by tscrim created at 2014-03-03 16:08:18

How about we link them all to the category? For example, currently I do

```
sage: crystals.Tableaux(['A',2], shape=[2,1])
```

Instead we make this use the category:

```
sage: Crystals.Tableaux(['A',2], shape=[2,1])
```

We should be able to do

```
from sage.combinat.crystals.catalog import *
```

in the crystals category to do this. Although doing things this way, we could easily have things lost among the category methods. So I'm not convinced this is the best direction to go.

Also I'm somewhat of the opinion that categories should be grouped together as well via `categories.Crystals` and such and not be in the global namespace. Therefore leaving `crystals.*` as the only entry point. IDK, I'm okay with 2 entry points too...


---

Comment by nthiery created at 2014-03-03 17:04:38

Replying to [comment:3 tscrim]:
> How about we link them all to the category? For example, currently I do
> {{{
> sage: crystals.Tableaux(['A',2], shape=[2,1])
> }}}
> Instead we make this use the category:
> {{{
> sage: Crystals.Tableaux(['A',2], shape=[2,1])
> }}}
> We should be able to do
> {{{
> from sage.combinat.crystals.catalog import *
> }}}
> in the crystals category to do this. Although doing things this way,
> we could easily have things lost among the category methods. So I'm
> not convinced this is the best direction to go.

Agreed! This is why, in my attempted notation, I had put this in an
attribute `Crystals.catalog`. But it's not super convincing
either.

> Also I'm somewhat of the opinion that categories should be grouped
> together as well via `categories.Crystals` and such and not be in
> the global namespace. Therefore leaving `crystals.*` as the only
> entry point.

I agree that there definitely should be far less categories in the
global name space, and #10963 will help much in this
direction. However, for the well known ones like Sets, Fields, Groups,
Posets, Crystals, ... I find that the category is a natural entry
point to explore the functionalities implemented in Sage about a given
topic, because it has more semantic attached to it than with a mere
module like `groups`.

On a related matter, it would be a cool feature, when given a
category, to recover all parents in this category. E.g.:


```
    sage: affine_crystals = Crystals().Affine().implementations()
    sage: affine_crystals.K<tab>
    KirillovReshetikhinCrystal
    ...
```


Florent had implemented a proof-of-concept, recovering automatically
the information from a database build from the Sage TestSuite's. But
this would take some more work.

> IDK, I'm okay with 2 entry points too...

That will certainly do for now :-)

Cheers,
                                 Nicolas


---

Comment by git created at 2014-03-17 15:06:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-17 15:08:00

Using #14275 makes deprecating things from the global namespace so much easier.


---

Comment by git created at 2014-03-19 15:58:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-19 15:59:00

Changing status from new to needs_review.


---

Comment by git created at 2014-03-19 17:01:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-19 17:02:53

Okay, now it should be ready.


---

Comment by ncohen created at 2014-03-20 13:51:28

(being curious. I love catalogs)


---

Comment by ncohen created at 2014-03-20 14:52:42

Hey man.

I felt a bit trap when I noticed, after having spent quite some time reading the diff, that the ticket did not only change what it claims....

Anyway.

I agree with everything I can understand (and "git diff --word-diff" really is useful for tickets like that), but there are five things that I cannot review:

- The "model" changes to `/src/sage/combinat/crystals/highest_weight_crystals.py`

- This change

```
-        if self.cartan_type().is_affine():
+        if not self.cartan_type().is_finite():
```


- This one

```
-        return other.__lt__(self)
+        return self._list.__gt__(other._list)
```


- The definition of `KirillovReshetikhin` in catalog.py (and I don't think that it is the right place to define it)

- Same for `RiggedConfigurations` in `catalog_kirillov_reshetikhin.py` though the code is trivial>

I do not understand what it does, and though I thought I could review a ticket that implements a crystal catalogs, I can't review these parts.

Soooo well. You can either remove them and I can set this ticket to positive review, or someone else will do it.

There are broken doc links reported by `sage -docbuild reference/combinat --warn-links html`. And I also add a commit to your branch to fix a typo and a "double deprecation".

Nathann


---

Comment by ncohen created at 2014-03-20 14:52:42

Changing status from needs_review to needs_info.


---

Comment by git created at 2014-03-20 14:53:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-03-20 14:57:44

Oh and I forgot something important : the new index of crystals must appear in the reference manual !

Nathann


---

Comment by tscrim created at 2014-03-21 02:28:23

Hey Nathann,

Replying to [comment:12 ncohen]:
> I felt a bit trap when I noticed, after having spent quite some time reading the diff, that the ticket did not only change what it claims....

Well, there were things that I wanted to touch up while I was making sweeping changes.

> I agree with everything I can understand (and "git diff --word-diff" really is useful for tickets like that), but there are five things that I cannot review:
> 
> - The "model" changes to `/src/sage/combinat/crystals/highest_weight_crystals.py`
> 
> - This change
> {{{#!diff
> -        if self.cartan_type().is_affine():
> +        if not self.cartan_type().is_finite():
> }}}

For reference: this is for better (future?) support for LS paths over other indefinite types (ex. hyperbolic).

> - This one
> {{{#!diff
> -        return other.__lt__(self)
> +        return self._list.__gt__(other._list)
> }}}

After some though, I felt it was better to revert this.

> - The definition of `KirillovReshetikhin` in catalog.py (and I don't think that it is the right place to define it)

This is the right place because it's just a function which redirects to the correct class (in different files). IMO it's stupid (and potentially confusing) to put it in `kirillov_reshetikhin.py` just to import it into the catalog.

> - Same for `RiggedConfigurations` in `catalog_kirillov_reshetikhin.py` though the code is trivial>

Here this should be here even more so because I want to reinforce that we only want to construct the rigged configurations of a single KR crystal (not as a tensor product thereof).

> I do not understand what it does, and though I thought I could review a ticket that implements a crystal catalogs, I can't review these parts.

Thank you for your review thus far.

> There are broken doc links reported by `sage -docbuild reference/combinat --warn-links html`. And I also add a commit to your branch to fix a typo and a "double deprecation".

I've done what I can about them.

Best,

Travis


---

Comment by git created at 2014-03-21 02:28:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-21 02:28:57

Changing status from needs_info to needs_review.


---

Comment by aschilling created at 2014-03-21 05:49:47

A lot of the changes look like simple line breaks. I strongly recommend to take these out of this ticket since this pollutes the real changes that were made and it does not enhance the code in any way. This will make it much easier to review as well!

Thanks,

Anne


---

Comment by ncohen created at 2014-03-21 06:29:07

Helloooooo Anne !

> A lot of the changes look like simple line breaks. I strongly recommend to take these out of this ticket since this pollutes the real changes that were made and it does not enhance the code in any way. This will make it much easier to review as well!

Well, actually "git diff --word-diff --color" helped me a lot there: it understands that the difference is mostly line breaks, and so if a LAAAARGE paragraph was split into many lines and a small modification is made somewhere at the same time (here, a modification to a latex formula) then the diff only displays the change to the latex formula, and you basically don't see the line breaks. That's cool.

With GIT, it would have been better for the review to store all those modifications in a specific commit, but this branch already has a lot of commits and it makes it hard to review commit by commit.

But I reviewed all this already. If you can check what I was not qualified to check above, as well as check that the classification of the constructors in the crystals.<tab> object makes sense, then this ticket can go.

Nathann


---

Comment by ncohen created at 2014-03-21 06:34:53

Yoooo Travis !

> Well, there were things that I wanted to touch up while I was making sweeping changes.

Do you know the option "git add -p" ? This thing is fantastic ! In cases like that, you can make all the changes you need to a file, and then split it into different thematic commits.

Then they can become different tickets or just stay different commits... But it lets you pick which changes (from the same file) you want to include in the next commit, and that's cool. You can do all those changes and decide later how you sort them.

> > - The definition of `KirillovReshetikhin` in catalog.py (and I don't think that it is the right place to define it)
> 
> This is the right place because it's just a function which redirects to the correct class (in different files). IMO it's stupid (and potentially confusing) to put it in `kirillov_reshetikhin.py` just to import it into the catalog.

Won't you ever need some Sage code to call this function ? In this case it would mean a "from sage.....crystals.catalog import KirillovReshetikhin", which is a bit weird. It happens very often in the graph constructor that we need to call other constructors. But well, if there is no "smart" code in there after all, do as you wish.

> Here this should be here even more so because I want to reinforce that we only want to construct the rigged configurations of a single KR crystal (not as a tensor product thereof).

I first thought that "being a crystal" would reflect on the code, and that it would inherit from some crystal class or parent or whatever. But I really do not understand anything about crystals :-P

Have fun !

Nathann


---

Comment by tscrim created at 2014-03-21 14:48:16

Replying to [comment:20 ncohen]:
> Do you know the option "git add -p" ? This thing is fantastic ! In cases like that, you can make all the changes you need to a file, and then split it into different thematic commits.

No I didn't. I'll have to keep that in mind.

> Won't you ever need some Sage code to call this function ? In this case it would mean a "from sage.....crystals.catalog import KirillovReshetikhin", which is a bit weird. It happens very often in the graph constructor that we need to call other constructors. But well, if there is no "smart" code in there after all, do as you wish.

I doubt it since most of the time people would (should) just directly import the model they want directly.

Anne,

Those line break changes made it easier for me to read (especially in my approximately 90 character wide window). Also the 80 character max width is a pseudo-standard.

Best,

Travis


---

Comment by aschilling created at 2014-03-21 18:37:12

> > Won't you ever need some Sage code to call this function ? In this case it would mean a "from sage.....crystals.catalog import KirillovReshetikhin", which is a bit weird. It happens very often in the graph constructor that we need to call other constructors. But well, if there is no "smart" code in there after all, do as you wish.

I am confused. KirillovReshetikhinCrystal is currently a model and should definitely be easily accessible. 

> I doubt it since most of the time people would (should) just directly import the model they want directly.

What are the KR models?

> Anne,
> 
> Those line break changes made it easier for me to read (especially in my approximately 90 character wide window). Also the 80 character max width is a pseudo-standard.

Well, I think, it is a really bad idea to incorporate line break in this patch!

Also, I get many doc failures

```
sage -t affine.py
**********************************************************************
File "affine.py", line 317, in sage.combinat.crystals.affine.AffineCrystalFromClassicalElement.pp
Failed example:
    K = KirillovReshetikhinCrystal(['D',3,2],1,1)
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.kirillov_resetikhin.KashiwaraNakashimaTabelaux instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "affine.py", line 398, in sage.combinat.crystals.affine.AffineCrystalFromClassicalElement.epsilon0
Failed example:
    [x.epsilon0 for x in A.list()]
Expected:
    [1, 0, 0]
Got:
    [<bound method AffineCrystalFromClassicalAndPromotion_with_category.element_class.epsilon0 of [[1]]>, <bound method AffineCrystalFromClassicalAndPromotion_with_category.element_class.epsilon0 of [[2]]>, <bound method AffineCrystalFromClassicalAndPromotion_with_category.element_class.epsilon0 of [[3]]>]
**********************************************************************
2 items had failures:
   1 of   7 in sage.combinat.crystals.affine.AffineCrystalFromClassicalElement.epsilon0
   1 of   4 in sage.combinat.crystals.affine.AffineCrystalFromClassicalElement.pp
    [221 tests, 2 failures, 1.90 s]
sage -t affine_factorization.py
**********************************************************************
File "affine_factorization.py", line 73, in sage.combinat.crystals.affine_factorization.AffineFactorizationCrystal
Failed example:
    C = CrystalOfTableaux(['A',2],shape=[3,1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
1 item had failures:
   1 of  16 in sage.combinat.crystals.affine_factorization.AffineFactorizationCrystal
    [46 tests, 1 failure, 17.81 s]
sage -t alcove_path.py
    [220 tests, 9.78 s]
sage -t all.py
    [0 tests, 0.00 s]
sage -t catalog.py
**********************************************************************
File "catalog.py", line 88, in sage.combinat.crystals.catalog.KirillovReshetikhin
Failed example:
    KN3 = crystals.KirillovReshetikhin(['D',4,1], 2, 1, model='KashiwaraNakashima')
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.catalog.KirillovReshetikhin[10]>", line 1, in <module>
        KN3 = crystals.KirillovReshetikhin(['D',Integer(4),Integer(1)], Integer(2), Integer(1), model='KashiwaraNakashima')
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/combinat/crystals/catalog.py", line 104, in KirillovReshetikhin
        raise ValueError("invalid model")
    ValueError: invalid model
**********************************************************************
File "catalog.py", line 89, in sage.combinat.crystals.catalog.KirillovReshetikhin
Failed example:
    KN is KN2 and KN is KN3
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.catalog.KirillovReshetikhin[11]>", line 1, in <module>
        KN is KN2 and KN is KN3
    NameError: name 'KN3' is not defined
**********************************************************************
1 item had failures:
   2 of  13 in sage.combinat.crystals.catalog.KirillovReshetikhin
    [12 tests, 2 failures, 1.44 s]
sage -t catalog_elementary_crystals.py
    [0 tests, 0.00 s]
sage -t catalog_infinity_crystals.py
    [0 tests, 0.00 s]
sage -t catalog_kirillov_reshetikhin.py
    [3 tests, 1.19 s]
sage -t crystals.py
**********************************************************************
File "crystals.py", line 183, in sage.combinat.crystals.crystals.CrystalBacktracker.__init__
Failed example:
    C = CrystalOfTableaux(['B',3],shape=[3,2,1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "crystals.py", line 206, in sage.combinat.crystals.crystals.CrystalBacktracker._rec
Failed example:
    C = CrystalOfLetters(['A', 5])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
2 items had failures:
   1 of   7 in sage.combinat.crystals.crystals.CrystalBacktracker.__init__
   1 of   5 in sage.combinat.crystals.crystals.CrystalBacktracker._rec
    [24 tests, 2 failures, 2.40 s]
sage -t direct_sum.py
    [41 tests, 0.53 s]
sage -t elementary_crystals.py
    [211 tests, 1.42 s]
sage -t fast_crystals.py
**********************************************************************
File "fast_crystals.py", line 52, in sage.combinat.crystals.fast_crystals.FastCrystal
Failed example:
    C = crystals.Tableaux(['B',2], shape=[l1,l2])
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.fast_crystals.FastCrystal[0]>", line 1, in <module>
        C = crystals.Tableaux(['B',Integer(2)], shape=[l1,l2])
    NameError: name 'l1' is not defined
**********************************************************************
File "fast_crystals.py", line 54, in sage.combinat.crystals.fast_crystals.FastCrystal
Failed example:
    T = crystals.TensorProduct(C, D, C.list()[0], D.list()[0])
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.fast_crystals.FastCrystal[2]>", line 1, in <module>
        T = crystals.TensorProduct(C, D, C.list()[Integer(0)], D.list()[Integer(0)])
    NameError: name 'C' is not defined
**********************************************************************
1 item had failures:
   2 of  19 in sage.combinat.crystals.fast_crystals.FastCrystal
    [79 tests, 2 failures, 2.74 s]
sage -t generalized_young_walls.py
**********************************************************************
File "generalized_young_walls.py", line 62, in sage.combinat.crystals.generalized_young_walls.GeneralizedYoungWall
Failed example:
    Y = InfinityCrystalOfGeneralizedYoungWalls(4)
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
1 item had failures:
   1 of   4 in sage.combinat.crystals.generalized_young_walls.GeneralizedYoungWall
    [159 tests, 1 failure, 3.37 s]
sage -t highest_weight_crystals.py
    [103 tests, 0.29 s]
sage -t infinity_crystals.py
    [118 tests, 4.64 s]
sage -t kirillov_reshetikhin.py
    [658 tests, 11.87 s]
sage -t kyoto_path_model.py
    [70 tests, 1.05 s]
sage -t littelmann_path.py
    [224 tests, 19.29 s]
sage -t monomial_crystals.py
    [174 tests, 3.44 s]
sage -t spins.py
    [68 tests, 1.16 s]
sage -t tensor_product.py
    [404 tests, 10.30 s]
----------------------------------------------------------------------
sage -t affine.py  # 2 doctests failed
sage -t affine_factorization.py  # 1 doctest failed
sage -t catalog.py  # 2 doctests failed
sage -t crystals.py  # 2 doctests failed
sage -t fast_crystals.py  # 2 doctests failed
sage -t generalized_young_walls.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 96.8 seconds
    cpu time: 79.1 seconds
    cumulative wall time: 94.6 seconds
```



---

Comment by aschilling created at 2014-03-21 18:37:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-03-22 17:20:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-22 17:25:57

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2014-03-22 17:25:57

I'm using `crystals.KirillovReshetikhin` as an entry point for the user on the front-end. All of the models from `crystals.kirillov_reshetikhin.<tab>` take a Cartan type, an `r`, and an `s` as input.

The KR models are:

- Kashiwara Nakashima tableaux - the class `KirillovReshetikhinCrystal` and is the default model for `crystal.KirillovReshetikhin`
- Kirillov Reshetikhin tableaux - the class `KirillovReshetikhinTableaux`
- Rigged configurartions - using `RiggedConfigurations` of a single factor
- LS paths - using `KirillovReshetikhinCrystalFromLSPaths`

I've fixed the doctest failures in the latest push.

Best,

Travis


---

Comment by aschilling created at 2014-03-23 04:27:57

I still get doctest failures

```
sage -t crystals.py
**********************************************************************
File "crystals.py", line 206, in sage.combinat.crystals.crystals.CrystalBacktracker._rec
Failed example:
    C = crystal.Letters(['A', 5])
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.crystals.CrystalBacktracker._rec[1]>", line 1, in <module>
        C = crystal.Letters(['A', Integer(5)])
    NameError: name 'crystal' is not defined
**********************************************************************
File "crystals.py", line 207, in sage.combinat.crystals.crystals.CrystalBacktracker._rec
Failed example:
    CB = CrystalBacktracker(C)
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.crystals.CrystalBacktracker._rec[2]>", line 1, in <module>
        CB = CrystalBacktracker(C)
    NameError: name 'C' is not defined
**********************************************************************
File "crystals.py", line 208, in sage.combinat.crystals.crystals.CrystalBacktracker._rec
Failed example:
    list(CB._rec(C(1), 'n/a'))
Exception raised:
    Traceback (most recent call last):
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.combinat.crystals.crystals.CrystalBacktracker._rec[3]>", line 1, in <module>
        list(CB._rec(C(Integer(1)), 'n/a'))
    NameError: name 'CB' is not defined
**********************************************************************
```

Aren't you running the tests before you post your new commits?


---

Comment by aschilling created at 2014-03-23 04:38:56

And more

```
sage -t classical_crystals.py
**********************************************************************
File "classical_crystals.py", line 104, in sage.categories.classical_crystals.ClassicalCrystals.ParentMethods.opposition_automorphism
Failed example:
    T = CrystalOfTableaux(['A',5],shape=[1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "classical_crystals.py", line 268, in sage.categories.classical_crystals.ClassicalCrystals.ParentMethods.__iter__
Failed example:
    C = CrystalOfLetters(['A',5])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "classical_crystals.py", line 455, in sage.categories.classical_crystals.ClassicalCrystals.ElementMethods.lusztig_involution
Failed example:
    T = HighestWeightCrystal(La[1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.HighestWeight instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
3 items had failures:
   1 of  15 in sage.categories.classical_crystals.ClassicalCrystals.ElementMethods.lusztig_involution
   1 of  19 in sage.categories.classical_crystals.ClassicalCrystals.ParentMethods.__iter__
   1 of   9 in sage.categories.classical_crystals.ClassicalCrystals.ParentMethods.opposition_automorphism
    [80 tests, 3 failures, 5.74 s]
sage -t crystals.py
**********************************************************************
File "crystals.py", line 135, in sage.categories.crystals.Crystals.ParentMethods.an_element
Failed example:
    C = CrystalOfLetters(['A', 5])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "crystals.py", line 156, in sage.categories.crystals.Crystals.ParentMethods.weight_lattice_realization
Failed example:
    K = KirillovReshetikhinCrystal(['A',2,1], 1, 1)
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovResetikhin instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "crystals.py", line 217, in sage.categories.crystals.Crystals.ParentMethods.__iter__
Failed example:
    C = CrystalOfLSPaths(['A',2,1],[-1,0,1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "crystals.py", line 514, in sage.categories.crystals.Crystals.ParentMethods.digraph
Failed example:
    T = HighestWeightCrystal(La[0])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.HighestWeight instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
4 items had failures:
   1 of  19 in sage.categories.crystals.Crystals.ParentMethods.__iter__
   1 of   3 in sage.categories.crystals.Crystals.ParentMethods.an_element
   1 of  27 in sage.categories.crystals.Crystals.ParentMethods.digraph
   1 of   5 in sage.categories.crystals.Crystals.ParentMethods.weight_lattice_realization
    [193 tests, 4 failures, 2.22 s]
sage -t finite_crystals.py
    [9 tests, 0.05 s]
sage -t highest_weight_crystals.py
**********************************************************************
File "highest_weight_crystals.py", line 100, in sage.categories.highest_weight_crystals.HighestWeightCrystals.ParentMethods.highest_weight_vectors
Failed example:
    C = CrystalOfLetters(['A',5])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "highest_weight_crystals.py", line 107, in sage.categories.highest_weight_crystals.HighestWeightCrystals.ParentMethods.highest_weight_vectors
Failed example:
    T = TensorProductOfCrystals(C,C,C,generators=[[C(2),C(1),C(1)],[C(1),C(2),C(1)]])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
1 item had failures:
   2 of   6 in sage.categories.highest_weight_crystals.HighestWeightCrystals.ParentMethods.highest_weight_vectors
    [24 tests, 2 failures, 0.08 s]
sage -t highest_weight_crystals.py~
    AttributeError in doctesting framework
**********************************************************************
Traceback (most recent call last):
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2091, in __call__
    doctests, extras = self.source.create_doctests(sage_namespace)
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 639, in create_doctests
    return self._create_doctests(namespace)
  File "/Applications/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 236, in _create_doctests
    self._init()
AttributeError: 'FileDocTestSource' object has no attribute '_init'

sage -t regular_crystals.py
**********************************************************************
File "regular_crystals.py", line 132, in sage.categories.regular_crystals.RegularCrystals.ParentMethods.demazure_operator
Failed example:
    T = CrystalOfTableaux(['A',2], shape=[2,1])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.<tab> instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "regular_crystals.py", line 217, in sage.categories.regular_crystals.RegularCrystals.ElementMethods.epsilon
Failed example:
    C = CrystalOfLetters(['A',5])
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.Letters instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
File "regular_crystals.py", line 306, in sage.categories.regular_crystals.RegularCrystals.ElementMethods.demazure_operator_simple
Failed example:
    K = KirillovReshetikhinCrystal(['A',2,1],2,1)
Expected nothing
Got:
    doctest:839: DeprecationWarning: this is being removed from the global namespace. Use crystals.KirillovResetikhin instead
    See http://trac.sagemath.org/15882 for details.
**********************************************************************
3 items had failures:
   1 of  13 in sage.categories.regular_crystals.RegularCrystals.ElementMethods.demazure_operator_simple
   1 of   4 in sage.categories.regular_crystals.RegularCrystals.ElementMethods.epsilon
   1 of  12 in sage.categories.regular_crystals.RegularCrystals.ParentMethods.demazure_operator
    [83 tests, 3 failures, 0.75 s]
----------------------------------------------------------------------
sage -t classical_crystals.py  # 3 doctests failed
sage -t crystals.py  # 4 doctests failed
sage -t highest_weight_crystals.py  # 2 doctests failed
sage -t highest_weight_crystals.py~  # AttributeError in doctesting framework
sage -t regular_crystals.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 9.4 seconds
    cpu time: 8.2 seconds
    cumulative wall time: 8.8 seconds
```



---

Comment by git created at 2014-03-23 16:51:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-03-23 16:54:22

Ack, I had forgotten about the categories. Also I added `regular_crystals.py` to the doc because we had forgotten about doing that when creating the category which fixes broken links in `classical_crystals.py` (in which I fixed some docstring formatting).


---

Comment by git created at 2014-03-23 19:11:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-03-24 14:54:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-01 19:20:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2014-04-02 21:42:33

Hi Travis,

Here are some further comments:

* The following

```
+The Littelmann path model also lends itself as a model for to level zero
+crystals which are bi-infinite. To cut out a slice of these crystals, one
+can use the direction option in subcrystal::
```

is not a sentence. Perhaps drop the "to"?

* When I type

```
sage: crystals.Tableaux??
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-82a3f8368ea9> in <module>()
----> 1 get_ipython().magic(u'pinfo2 crystals.Tableaux')

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in magic(self, arg_s)
   2163         magic_name, _, magic_arg_s = arg_s.partition(' ')
   2164         magic_name = magic_name.lstrip(prefilter.ESC_MAGIC)
-> 2165         return self.run_line_magic(magic_name, magic_arg_s)
   2166 
   2167     #-------------------------------------------------------------------------

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in run_line_magic(self, magic_name, line)
   2084                 kwargs['local_ns'] = sys._getframe(stack_depth).f_locals
   2085             with self.builtin_trap:
-> 2086                 result = fn(*args,**kwargs)
   2087             return result
   2088 

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/magics/namespace.pyc in pinfo2(self, parameter_s, namespaces)

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/magic.pyc in <lambda>(f, *a, **k)
    189     # but it's overkill for just that one bit of state.
    190     def magic_deco(arg):
--> 191         call = lambda f, *a, **k: f(*a, **k)
    192 
    193         if callable(arg):

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/magics/namespace.pyc in pinfo2(self, parameter_s, namespaces)
     65         '%pinfo2 object' is just a synonym for object?? or ??object."""
     66         self.shell._inspect('pinfo', parameter_s, detail_level=1,
---> 67                             namespaces=namespaces)
     68 
     69     @skip_doctest

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/interactiveshell.pyc in _inspect(self, meth, oname, namespaces, **kw)
   1455                 pmethod(info.obj, oname, formatter)
   1456             elif meth == 'pinfo':
-> 1457                 pmethod(info.obj, oname, formatter, info, **kw)
   1458             else:
   1459                 pmethod(info.obj, oname)

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/oinspect.pyc in pinfo(self, obj, oname, formatter, info, detail_level)
    558         """
    559         info = self.info(obj, oname=oname, formatter=formatter,
--> 560                             info=info, detail_level=detail_level)
    561         displayfields = []
    562         def add_fields(fields):

/Applications/sage/local/lib/python2.7/site-packages/IPython/core/oinspect.pyc in info(self, obj, oname, formatter, info, detail_level)
    646                     ds += "\nDocstring:\n" + obj.__doc__
    647         else:
--> 648             ds = getdoc(obj)
    649             if ds is None:
    650                 ds = '<no docstring>'

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/sageinspect.pyc in sage_getdoc(obj, obj_name, embedded_override)
   1505         return ''
   1506 
-> 1507     s = sage.misc.sagedoc.format(str(r), embedded=(embedded_override or EMBEDDED_MODE))
   1508 
   1509     # If there is a Cython embedded position, it needs to be stripped

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in format(s, embedded)
    565             s = process_mathtt(s)
    566         s = process_extlinks(s, embedded=embedded)
--> 567         s = detex(s, embedded=embedded)
    568     return embedding_info+s
    569 

/Applications/sage/local/lib/python2.7/site-packages/sage/misc/sagedoc.pyc in detex(s, embedded)
    199         s = _rmcmd(s, 'mathrm')
    200         from sagenb.misc.sphinxify import sphinxify
--> 201         s = sphinxify(s, format='text')
    202         for a,b in math_substitutes:  # do math substitutions
    203             s = s.replace(a,b)

/Applications/sage/local/lib/python2.7/site-packages/sagenb-0.10.8.2-py2.7.egg/sagenb/misc/sphinxify.pyc in sphinxify(docstring, format)
    119     old_sys_path = list(sys.path)  # Sphinx modifies sys.path
    120     sphinx_app = Sphinx(srcdir, confdir, srcdir, doctreedir, format,
--> 121                         confoverrides, None, None, True)
    122     sphinx_app.build(None, [rst_name])
    123     sys.path = old_sys_path

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/application.pyc in __init__(self, srcdir, confdir, outdir, doctreedir, buildername, confoverrides, status, warning, freshenv, warningiserror, tags)
    112         # load all user-given extension modules
    113         for extension in self.config.extensions:
--> 114             self.setup_extension(extension)
    115         # the config file itself can be an extension
    116         if self.config.setup:

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/application.pyc in setup_extension(self, extension)
    254         else:
    255             try:
--> 256                 mod.setup(self)
    257             except VersionRequirementError, err:
    258                 # add the extension name to the version required

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/ext/mathjax.pyc in setup(app)
     60 
     61 def setup(app):
---> 62     mathbase_setup(app, (html_visit_math, None), (html_visit_displaymath, None))
     63     app.add_config_value('mathjax_path',
     64                          'http://cdn.mathjax.org/mathjax/latest/MathJax.js?'

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/ext/mathbase.pyc in setup_math(app, htmlinlinevisitors, htmldisplayvisitors)
    178         man=(man_visit_math, None),
    179         texinfo=(texinfo_visit_math, None),
--> 180         html=htmlinlinevisitors)
    181     app.add_node(displaymath,
    182         latex=(latex_visit_displaymath, None),

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/application.pyc in add_node(self, node, **kwds)
    360                 from sphinx.writers.html import HTMLTranslator as translator
    361             elif key == 'latex':
--> 362                 from sphinx.writers.latex import LaTeXTranslator as translator
    363             elif key == 'text':
    364                 from sphinx.writers.text import TextTranslator as translator

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/writers/latex.py in <module>()
     21 
     22 from sphinx import addnodes
---> 23 from sphinx import highlighting
     24 from sphinx.errors import SphinxError
     25 from sphinx.locale import admonitionlabels, versionlabels, _

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/highlighting.py in <module>()
     22 
     23 from sphinx.util.texescape import tex_hl_escape_map_new
---> 24 from sphinx.ext import doctest
     25 
     26 try:

/Applications/sage/local/lib/python2.7/site-packages/Sphinx-1.1.2-py2.7.egg/sphinx/ext/doctest.py in <module>()
    109 
    110 
--> 111 parser = doctest.DocTestParser()
    112 
    113 # helper classes

AttributeError: 'module' object has no attribute 'DocTestParser'
```


* What is the difference between `crystals.KirillovReshetikhin` and `crystals.kirillov_reshetikhin`? Since tab completion does not work, it is hard to see from the command line. I suppose `crystals.kirillov_reshetikhin` is another subcatalog? It is seems a little weird that KirillovReshetikhin does not appear in the list, but that
` sage.combinat.crystals.catalog.KirillovReshetikhin(cartan_type, r, s, model='KN')` appears as documentation on the catalogue site (under subcatalogs). It would be better if it appeared when clicking on KR crystals.

So much for now since all this first needs to be fixed.

Anne


---

Comment by tscrim created at 2014-04-02 22:50:23

I've fixed the first one. However tab completion, `?`, and `??` all work fine for me. From the error message, it looks like something is messed up with your ipython (or, less likely, sphinx).

`crystals.KirillovReshetikhin` is a general entry point to create KR crystals, whereas `crystals.kirillov_reshetikhin` is a (sub)catalog of the models for KR crystals. I've changed the function `KirillovReshetikhinCrystal` to be the entry point function in the catalog. I've also moved the `kir_resh.RiggedConfigurations` into `rigged_configurations.py` and fixed the doc error.


---

Comment by git created at 2014-04-02 22:50:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2014-04-03 06:46:09

After running `make` the problem with the documentation disappeared. I will look further at the changes!


---

Comment by git created at 2014-04-09 02:02:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2014-04-10 01:17:10

Hi Travis,

Here are a couple more comments on this ticket:

* There seem to be some crystals missing in the list `src/doc/output/html/en/reference/combinat/sage/combinat/crystals/catalog.html`. For example Littelmann paths and the affine factorization crystal are not there. Also, would it be possible to order the entries alphabetically?

* The list in `src/doc/output/html/en/reference/combinat/crystals.html` is almost the same, but more crystals are actually displayed. It would be best if the two lists could easily be kept in sync.

Best,

Anne


---

Comment by git created at 2014-04-10 18:14:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-04-10 18:17:53

Hey Anne,

Replying to [comment:40 aschilling]:
> * There seem to be some crystals missing in the list `src/doc/output/html/en/reference/combinat/sage/combinat/crystals/catalog.html`. For example Littelmann paths and the affine factorization crystal are not there. Also, would it be possible to order the entries alphabetically?

Done and done (before I had it organized more by type).

> * The list in `src/doc/output/html/en/reference/combinat/crystals.html` is almost the same, but more crystals are actually displayed. It would be best if the two lists could easily be kept in sync.

They are always going to be somewhat out of sync because in the catalog is a list of what classes (and factory functions) of crystals that are currently in Sage, whereas the `crystals.html` is a list of modules (files) which contain the crystal implementations. (Also I don't think we have any mechanisms for automatically having things lists synced in the doc.)

Best,

Travis


---

Comment by git created at 2014-04-11 21:47:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-04-12 14:45:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-04-12 14:50:32

Well, that was the only bad link I could find with an extensive grep campaign.


---

Comment by git created at 2014-04-13 03:33:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by aschilling created at 2014-04-13 03:34:12

Hi Travis,

I just pushed some small changes to the introduction. If you agree with them, please set a positive review on my behalf!

Anne


---

Comment by tscrim created at 2014-04-13 03:41:01

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-04-13 03:41:01

Looks good to me. Thanks Anne and Nathann for doing the review!


---

Comment by vbraun created at 2014-04-13 21:03:15


```
sage -t --long src/sage/combinat/root_system/plot.py  # 1 doctest failed
sage -t --long src/sage/combinat/tableau.py  # 1 doctest failed
sage -t --long src/sage/combinat/root_system/cartan_type.py  # 2 doctests failed
```



---

Comment by git created at 2014-04-14 14:58:59

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-04-14 14:58:59

Changing status from positive_review to needs_review.


---

Comment by tscrim created at 2014-04-14 14:59:32

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-04-14 14:59:32

Sorry about that.


---

Comment by vbraun created at 2014-04-14 19:57:22

Resolution: fixed


---

Comment by nthiery created at 2014-05-09 09:23:50

Hi!

Sorry, I haven't been been following up on this ticket, so that's probably too late. Anyway, just as a food for thought, I wanted to mention that I was surprised at first to have

```
    crystals.Letters
```

rather than

```
    crystals.CrystalOfLetters
```


The latter is nicer if you want to do `from crystals import *`. But maybe the point is that you don't want to do that and just always `crystals....`, and then it's less redundant.

Let's see how this is done in the other catalogs. Hmm, we have `graphs.ChvatalGraph`, but `groups.permutation.Dihedral`. Not super consistent ...

Cheers,
                                       Nicolas


---

Comment by aschilling created at 2014-05-09 14:08:29

Hi Nicolas,

We thought that 

```
crystals.CrystalOfLetters
```

was redundant. Since it is pretty short, I think I/we will just use
`crystals. ...` in the future.

Anne


---

Comment by ncohen created at 2014-05-12 08:42:48

> Let's see how this is done in the other catalogs. Hmm, we have `graphs.ChvatalGraph`, but `groups.permutation.Dihedral`. Not super consistent ...

As always, it is better to make sense than to be consistent. The Graph thing is an error. We should .... deprecated those 100+ functions and remove the final "Graph" ?... Scary `T_T`

Nathann
