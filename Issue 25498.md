# Issue 25498: Crypto Linear Layer Module

archive/issues_025498.json:
```json
{
    "body": "Keywords: linearlayer, days94\n\nMost modern symmetric crypto systems consists of S-boxes and LinearLayers.\nWhile the first is already representable in sage via the sbox module, the latter is not.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25735\n\n",
    "created_at": "2018-07-02T07:34:24Z",
    "labels": [
        "cryptography",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Crypto Linear Layer Module",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25498",
    "user": "asante"
}
```
Keywords: linearlayer, days94

Most modern symmetric crypto systems consists of S-boxes and LinearLayers.
While the first is already representable in sage via the sbox module, the latter is not.

Issue created by migration from https://trac.sagemath.org/ticket/25735





---

archive/issue_comments_359663.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-07-02T11:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359663",
    "user": "asante"
}
```

New commits:



---

archive/issue_comments_359664.json:
```json
{
    "body": "Set assignee to asante.",
    "created_at": "2018-07-02T11:09:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359664",
    "user": "asante"
}
```

Set assignee to asante.



---

archive/issue_comments_359665.json:
```json
{
    "body": "I've only implemented the basic class with some implementations, because its maybe better for reviewing to not have a full implementation and just add ne methods later?",
    "created_at": "2018-07-02T11:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359665",
    "user": "asante"
}
```

I've only implemented the basic class with some implementations, because its maybe better for reviewing to not have a full implementation and just add ne methods later?



---

archive/issue_comments_359666.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-02T12:57:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359666",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359667.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-07-02T12:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359667",
    "user": "asante"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_359668.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2018-07-05T16:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359668",
    "user": "malb"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_359669.json:
```json
{
    "body": "- I find having both `linearlayer` and `linearlayers` confusing and would merge the two.\n- you are silently assuming only GF(2) and extensions of GF(2), right? I think there should be at least a warning otherwise.\n- Can't you just inherit from the appropriate matrix class to add those methods that you want instead of wrapping the matrix class in another layer of indirection?",
    "created_at": "2018-07-05T16:46:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359669",
    "user": "malb"
}
```

- I find having both `linearlayer` and `linearlayers` confusing and would merge the two.
- you are silently assuming only GF(2) and extensions of GF(2), right? I think there should be at least a warning otherwise.
- Can't you just inherit from the appropriate matrix class to add those methods that you want instead of wrapping the matrix class in another layer of indirection?



---

archive/issue_comments_359670.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-06T10:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359670",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359671.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-06T10:30:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359671",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359672.json:
```json
{
    "body": "I agree on all three points.\n\nRegarding the last one, I've tried to implement this, but it seems to forget about the specialised `Matrix_mod2_dense` and `Matrix_gf2e_dense` methods then? I've posted on the sage-devel about this, might be the more appropriate place for it: https://groups.google.com/forum/#!topic/sage-devel/4uxI1XVtoDs",
    "created_at": "2018-07-06T10:59:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359672",
    "user": "asante"
}
```

I agree on all three points.

Regarding the last one, I've tried to implement this, but it seems to forget about the specialised `Matrix_mod2_dense` and `Matrix_gf2e_dense` methods then? I've posted on the sage-devel about this, might be the more appropriate place for it: https://groups.google.com/forum/#!topic/sage-devel/4uxI1XVtoDs



---

archive/issue_comments_359673.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-07T13:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359673",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359674.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-07T13:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359674",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359675.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2018-07-07T13:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359675",
    "user": "asante"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_359676.json:
```json
{
    "body": "I added a constructor function for both, LinearLayer and AESLikeLinearLayer classes, following the example of BooleanPolynomialRing_constructor. This constructs the according LinearLayer object with the correct parent and inherited classes. Is there a better way to do this?",
    "created_at": "2018-07-07T13:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359676",
    "user": "asante"
}
```

I added a constructor function for both, LinearLayer and AESLikeLinearLayer classes, following the example of BooleanPolynomialRing_constructor. This constructs the according LinearLayer object with the correct parent and inherited classes. Is there a better way to do this?



---

archive/issue_comments_359677.json:
```json
{
    "body": "I'd just add an ``@`staticmethod` `constructor()` (or `new()`, which seems to be used elsewhere) method to `LinearLayer` etc.",
    "created_at": "2018-07-09T10:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359677",
    "user": "malb"
}
```

I'd just add an ``@`staticmethod` `constructor()` (or `new()`, which seems to be used elsewhere) method to `LinearLayer` etc.



---

archive/issue_comments_359678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-09T11:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359678",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359679.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-09T16:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359679",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-14T11:42:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359680",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359681.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-07-17T11:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359681",
    "user": "asante"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359682.json:
```json
{
    "body": "patchbot failures (tests missing,...)",
    "created_at": "2018-07-17T11:15:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359682",
    "user": "asante"
}
```

patchbot failures (tests missing,...)



---

archive/issue_comments_359683.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-17T11:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359683",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359684.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-29T07:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359684",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359685.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-29T09:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359685",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359686.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-29T09:45:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359686",
    "user": "asante"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_359687.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-29T09:51:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359687",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359688.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-29T10:31:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359688",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359689.json:
```json
{
    "body": "i didn't had a close look at this yet but here are some minor things:\n\n* there are some lines that are to long\n* avoid `I` as variable name\n* use `==` instead of `is` to compare strings\n* top-level functions and classes should be surrounded by two blank lines \n* in the HTML documentation `class sage.crypto.linearlayer.LinearLayer` there is something wrong with the rendering of `\\GF(x)^n`, the `(` are in subscript\n* `naive_xor_count(self, algorithm=\"naive\")` seems redundant to me\n* docstrings should prescribe the functions effect as a command (e.g. say //Count// instead of //Counts//)\n\nLike i said this are some minor and superficial things but depending on how strictly PEP8 and PEP257 must be followed you should have a look at these again.\n\nI am looking forward to have a deeper look at the code and report again.",
    "created_at": "2019-03-22T18:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359689",
    "user": "@yhxnf"
}
```

i didn't had a close look at this yet but here are some minor things:

* there are some lines that are to long
* avoid `I` as variable name
* use `==` instead of `is` to compare strings
* top-level functions and classes should be surrounded by two blank lines 
* in the HTML documentation `class sage.crypto.linearlayer.LinearLayer` there is something wrong with the rendering of `\GF(x)^n`, the `(` are in subscript
* `naive_xor_count(self, algorithm="naive")` seems redundant to me
* docstrings should prescribe the functions effect as a command (e.g. say //Count// instead of //Counts//)

Like i said this are some minor and superficial things but depending on how strictly PEP8 and PEP257 must be followed you should have a look at these again.

I am looking forward to have a deeper look at the code and report again.



---

archive/issue_comments_359690.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359690",
    "user": "embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_359691.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-03-29T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359691",
    "user": "@yhxnf"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_359692.json:
```json
{
    "body": "i had a look at the code again and its looks good to me. But i think more non trivial examples/tests would be appropriate",
    "created_at": "2019-03-29T19:05:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359692",
    "user": "@yhxnf"
}
```

i had a look at the code again and its looks good to me. But i think more non trivial examples/tests would be appropriate



---

archive/issue_comments_359693.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-02T10:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359693",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359694.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-04-24T17:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359694",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-02T17:32:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359695",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_359696.json:
```json
{
    "body": "I added some hopefully more descriptive examples to the documentation.\n\nAdditionally I implemented a way for `AESLikeLinearLayer` objects to handle matrix inputs.\nThis revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` I have not yet looked into/tracked down (apparently they shift in the wrong direction).\n\nAnd finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.",
    "created_at": "2019-05-02T17:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359696",
    "user": "asante"
}
```

I added some hopefully more descriptive examples to the documentation.

Additionally I implemented a way for `AESLikeLinearLayer` objects to handle matrix inputs.
This revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` I have not yet looked into/tracked down (apparently they shift in the wrong direction).

And finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.



---

archive/issue_comments_359697.json:
```json
{
    "body": "Replying to [comment:32 asante]:\n> This revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` \nLooks like `Right_ShiftRows` and `Left_ShiftRows` must be swapped. \n\n\n> And finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.\n\nSomething like this should work:\n  {{{#!python\ny = super(AESLikeLinearLayer, self).__call__(self.state_to_vector(x))\n  }}}\n\nI also had a look at `_column_linear_layer(Ls)` and i do not quite understand how it is supposed to work. Sadly the example in its docstring is useless because it is independent of the return value. I think it works if you use `state_to_vector(column_wise=True)` but default is `column_wise=False`?",
    "created_at": "2019-05-21T16:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359697",
    "user": "@yhxnf"
}
```

Replying to [comment:32 asante]:
> This revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` 
Looks like `Right_ShiftRows` and `Left_ShiftRows` must be swapped. 


> And finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.

Something like this should work:
  {{{#!python
y = super(AESLikeLinearLayer, self).__call__(self.state_to_vector(x))
  }}}

I also had a look at `_column_linear_layer(Ls)` and i do not quite understand how it is supposed to work. Sadly the example in its docstring is useless because it is independent of the return value. I think it works if you use `state_to_vector(column_wise=True)` but default is `column_wise=False`?



---

archive/issue_comments_359698.json:
```json
{
    "body": "Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).",
    "created_at": "2019-06-14T14:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359698",
    "user": "embray"
}
```

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).



---

archive/issue_comments_359699.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359699",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_359700.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359700",
    "user": "mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_359701.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359701",
    "user": "mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_359702.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25498",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25498#issuecomment-359702",
    "user": "mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.
