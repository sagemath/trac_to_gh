# Issue 25498: Crypto Linear Layer Module

Issue created by migration from Trac.

Original creator: asante

Original creation time: 2018-07-02 07:34:24

Keywords: linearlayer, days94

Most modern symmetric crypto systems consists of S-boxes and LinearLayers.
While the first is already representable in sage via the sbox module, the latter is not.


---

Comment by asante created at 2018-07-02 11:09:07

New commits:


---

Comment by asante created at 2018-07-02 11:09:07

Set assignee to asante.


---

Comment by asante created at 2018-07-02 11:10:00

I've only implemented the basic class with some implementations, because its maybe better for reviewing to not have a full implementation and just add ne methods later?


---

Comment by git created at 2018-07-02 12:57:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-07-02 12:57:59

Changing status from new to needs_review.


---

Comment by malb created at 2018-07-05 16:46:18

Changing status from needs_review to needs_info.


---

Comment by malb created at 2018-07-05 16:46:18

- I find having both `linearlayer` and `linearlayers` confusing and would merge the two.
- you are silently assuming only GF(2) and extensions of GF(2), right? I think there should be at least a warning otherwise.
- Can't you just inherit from the appropriate matrix class to add those methods that you want instead of wrapping the matrix class in another layer of indirection?


---

Comment by git created at 2018-07-06 10:17:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-06 10:30:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-07-06 10:59:58

I agree on all three points.

Regarding the last one, I've tried to implement this, but it seems to forget about the specialised `Matrix_mod2_dense` and `Matrix_gf2e_dense` methods then? I've posted on the sage-devel about this, might be the more appropriate place for it: https://groups.google.com/forum/#!topic/sage-devel/4uxI1XVtoDs


---

Comment by git created at 2018-07-07 13:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-07 13:29:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-07-07 13:31:15

Changing status from needs_info to needs_review.


---

Comment by asante created at 2018-07-07 13:31:15

I added a constructor function for both, LinearLayer and AESLikeLinearLayer classes, following the example of BooleanPolynomialRing_constructor. This constructs the according LinearLayer object with the correct parent and inherited classes. Is there a better way to do this?


---

Comment by malb created at 2018-07-09 10:20:36

I'd just add an ``@`staticmethod` `constructor()` (or `new()`, which seems to be used elsewhere) method to `LinearLayer` etc.


---

Comment by git created at 2018-07-09 11:07:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-09 16:02:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-07-14 11:42:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-07-17 11:15:18

Changing status from needs_review to needs_work.


---

Comment by asante created at 2018-07-17 11:15:18

patchbot failures (tests missing,...)


---

Comment by git created at 2018-07-17 11:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-29 07:28:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-08-29 09:15:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2018-08-29 09:45:54

Changing status from needs_work to needs_review.


---

Comment by git created at 2018-10-29 09:51:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-01-29 10:31:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @yhxnf created at 2019-03-22 18:38:04

i didn't had a close look at this yet but here are some minor things:

* there are some lines that are to long
* avoid `I` as variable name
* use `==` instead of `is` to compare strings
* top-level functions and classes should be surrounded by two blank lines 
* in the HTML documentation `class sage.crypto.linearlayer.LinearLayer` there is something wrong with the rendering of `\GF(x)^n`, the `(` are in subscript
* `naive_xor_count(self, algorithm="naive")` seems redundant to me
* docstrings should prescribe the functions effect as a command (e.g. say //Count// instead of //Counts//)

Like i said this are some minor and superficial things but depending on how strictly PEP8 and PEP257 must be followed you should have a look at these again.

I am looking forward to have a deeper look at the code and report again.


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by @yhxnf created at 2019-03-29 19:05:14

Changing status from needs_review to needs_work.


---

Comment by @yhxnf created at 2019-03-29 19:05:14

i had a look at the code again and its looks good to me. But i think more non trivial examples/tests would be appropriate


---

Comment by git created at 2019-04-02 10:14:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-24 17:43:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-02 17:32:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by asante created at 2019-05-02 17:45:35

I added some hopefully more descriptive examples to the documentation.

Additionally I implemented a way for `AESLikeLinearLayer` objects to handle matrix inputs.
This revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` I have not yet looked into/tracked down (apparently they shift in the wrong direction).

And finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.


---

Comment by @yhxnf created at 2019-05-21 16:08:54

Replying to [comment:32 asante]:
> This revealed a bug with the `Left_ShiftRows`/`Right_ShiftRows` 
Looks like `Right_ShiftRows` and `Left_ShiftRows` must be swapped. 


> And finally I have not yet figured out how to call the super `__call__` method from within the AESLikeLinearLayer object. Any tips for this would be nice.

Something like this should work:
  {{{#!python
y = super(AESLikeLinearLayer, self).__call__(self.state_to_vector(x))
  }}}

I also had a look at `_column_linear_layer(Ls)` and i do not quite understand how it is supposed to work. Sadly the example in its docstring is useless because it is independent of the return value. I think it works if you use `state_to_vector(column_wise=True)` but default is `column_wise=False`?


---

Comment by embray created at 2019-06-14 14:50:27

Tickets still needing working or clarification should be moved to the next release milestone at the soonest (please feel free to revert if you think the ticket is close to being resolved).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
