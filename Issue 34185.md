# Issue 34185: implement functorial composition of lazy symmetric functiosn

archive/issues_034185.json:
```json
{
    "body": "CC:  tscrim\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/34422\n\n",
    "created_at": "2022-08-24T13:28:31Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "implement functorial composition of lazy symmetric functiosn",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/34185",
    "user": "mantepse"
}
```
CC:  tscrim



Issue created by migration from https://trac.sagemath.org/ticket/34422





---

archive/issue_comments_485048.json:
```json
{
    "body": "Changing keywords from \"\" to \"LazyPowerSeries\".",
    "created_at": "2022-08-24T13:33:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485048",
    "user": "mantepse"
}
```

Changing keywords from "" to "LazyPowerSeries".



---

archive/issue_comments_485049.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2022-08-24T13:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485049",
    "user": "mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_485050.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2022-08-24T13:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485050",
    "user": "mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_485051.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2022-08-24T13:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485051",
    "user": "mantepse"
}
```

Last 10 new commits:



---

archive/issue_comments_485052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-24T21:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485052",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485053.json:
```json
{
    "body": "I have no idea whether this operation has a good interpretation on the representation theoretic level.",
    "created_at": "2022-08-24T21:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485053",
    "user": "mantepse"
}
```

I have no idea whether this operation has a good interpretation on the representation theoretic level.



---

archive/issue_comments_485054.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-08-24T21:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485054",
    "user": "mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_485055.json:
```json
{
    "body": "I am not sure either. Although it would be nice to (also) have an explanation not in terms of species of what the code does.\n\nAdditionally:\n\n```diff\n     def functorial_composition(self, *args):\n-        r\"\"\"Returns the functorial composition of ``self`` and ``g``.\n+        r\"\"\"\n+        Return the functorial composition of ``self`` and ``g``.\n```\n",
    "created_at": "2022-08-25T00:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485055",
    "user": "tscrim"
}
```

I am not sure either. Although it would be nice to (also) have an explanation not in terms of species of what the code does.

Additionally:

```diff
     def functorial_composition(self, *args):
-        r"""Returns the functorial composition of ``self`` and ``g``.
+        r"""
+        Return the functorial composition of ``self`` and ``g``.
```




---

archive/issue_comments_485056.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2022-08-30T12:09:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485056",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_485057.json:
```json
{
    "body": "Replying to [comment:5 mantepse]:\n> I have no idea whether this operation has a good interpretation on the representation theoretic level.\n\nThat was a somewhat silly statement, please excuse me, since the operation is built around a representation theoretic construction, and this construction is even described in the docstring.\n\nSo, a better question is how functorial composition relates to other operations with symmetric functions.  I do not have an answer.",
    "created_at": "2022-08-30T12:10:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485057",
    "user": "mantepse"
}
```

Replying to [comment:5 mantepse]:
> I have no idea whether this operation has a good interpretation on the representation theoretic level.

That was a somewhat silly statement, please excuse me, since the operation is built around a representation theoretic construction, and this construction is even described in the docstring.

So, a better question is how functorial composition relates to other operations with symmetric functions.  I do not have an answer.



---

archive/issue_comments_485058.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-08-30T12:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485058",
    "user": "mantepse"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_485059.json:
```json
{
    "body": "Replying to [comment:8 mantepse]:\n> Replying to [comment:5 mantepse]:\n> > I have no idea whether this operation has a good interpretation on the representation theoretic level.\n> \n> That was a somewhat silly statement, please excuse me, since the operation is built around a representation theoretic construction, and this construction is even described in the docstring.\n> \n> So, a better question is how functorial composition relates to other operations with symmetric functions.  I do not have an answer.\n\nI just realised that the functorial composition `f.functorial_composition(g)` is (at least by Begeron-Labelle-Leroux and D\u00e9coste-Labelle-Leroux) only defined for symmetric functions `g` which correspond to a permutation representation, i.e., a group action.\n\nThis does not have anything to do with the currently failing doctest, which I still have to fix.",
    "created_at": "2022-08-30T13:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485059",
    "user": "mantepse"
}
```

Replying to [comment:8 mantepse]:
> Replying to [comment:5 mantepse]:
> > I have no idea whether this operation has a good interpretation on the representation theoretic level.
> 
> That was a somewhat silly statement, please excuse me, since the operation is built around a representation theoretic construction, and this construction is even described in the docstring.
> 
> So, a better question is how functorial composition relates to other operations with symmetric functions.  I do not have an answer.

I just realised that the functorial composition `f.functorial_composition(g)` is (at least by Begeron-Labelle-Leroux and Décoste-Labelle-Leroux) only defined for symmetric functions `g` which correspond to a permutation representation, i.e., a group action.

This does not have anything to do with the currently failing doctest, which I still have to fix.



---

archive/issue_comments_485060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T14:43:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485060",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485061.json:
```json
{
    "body": "ready for review.",
    "created_at": "2022-08-30T14:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485061",
    "user": "mantepse"
}
```

ready for review.



---

archive/issue_comments_485062.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2022-08-30T14:44:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485062",
    "user": "mantepse"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_485063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-08-30T14:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485063",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485064.json:
```json
{
    "body": "If it cannot be described as an operation just on symmetric functions, then that is indicating that it probably should not be here but only in the species code that uses the lazy symmetric functions.\n\nYou're assuming `g` is a lazy symmetric function but you are allowed usual symmetric functions as input.\n\nIt took me a while to see that the `Stream_map_coefficients` is not passing the lambda function `lambda x: x, m`... Although it is still converting over the zeros. I think this could be made slightly faster by\n\n```diff\n-            g = Stream_map_coefficients(g._coeff_stream, lambda x: x, p)\n-            f = Stream_map_coefficients(self._coeff_stream, lambda x: x, p)\n+            sR = self.parent()._laurent_poly_ring\n+            g = Stream_map_coefficients(g._coeff_stream, p, R)\n+            f = Stream_map_coefficients(self._coeff_stream, p, sR)\n```\n\n\n\n```diff\n-g_u = g[u.size()]\n+g_u = g[sum(u)]\n+g_u = g[sum(u._list)]  # or even faster, but less encapsulation\n```\n\n(I know it is much better OOP to do what you had, but Python is so slow...)\n\nWouldn't floor division `//` be better than usual division `/` in `g_cycle_type()`?\n\n\n```diff\n-res = p(0)\n+res = p.zero()\n```\n\n\nInstead of `Partition(foo)`, you can use `_Partitions(foo)` to skip a few steps.\n\nTrivial detail, this double blank line looked weird to my eye:\n\n```diff\n         labellings of their vertices with two 1's and two 2's.\n-\n \n         The derivative of the symmetric function `\\sum_n h_n`, times\n         `p_1` is the neutral element with respect to functorial\n         composition::\n```\n",
    "created_at": "2022-08-31T01:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485064",
    "user": "tscrim"
}
```

If it cannot be described as an operation just on symmetric functions, then that is indicating that it probably should not be here but only in the species code that uses the lazy symmetric functions.

You're assuming `g` is a lazy symmetric function but you are allowed usual symmetric functions as input.

It took me a while to see that the `Stream_map_coefficients` is not passing the lambda function `lambda x: x, m`... Although it is still converting over the zeros. I think this could be made slightly faster by

```diff
-            g = Stream_map_coefficients(g._coeff_stream, lambda x: x, p)
-            f = Stream_map_coefficients(self._coeff_stream, lambda x: x, p)
+            sR = self.parent()._laurent_poly_ring
+            g = Stream_map_coefficients(g._coeff_stream, p, R)
+            f = Stream_map_coefficients(self._coeff_stream, p, sR)
```



```diff
-g_u = g[u.size()]
+g_u = g[sum(u)]
+g_u = g[sum(u._list)]  # or even faster, but less encapsulation
```

(I know it is much better OOP to do what you had, but Python is so slow...)

Wouldn't floor division `//` be better than usual division `/` in `g_cycle_type()`?


```diff
-res = p(0)
+res = p.zero()
```


Instead of `Partition(foo)`, you can use `_Partitions(foo)` to skip a few steps.

Trivial detail, this double blank line looked weird to my eye:

```diff
         labellings of their vertices with two 1's and two 2's.
-
 
         The derivative of the symmetric function `\sum_n h_n`, times
         `p_1` is the neutral element with respect to functorial
         composition::
```




---

archive/issue_comments_485065.json:
```json
{
    "body": "I agree that we could also move functorial composition to the species generating functions code, I am not completely sure what is better.  Here is the precise representation theoretic description:\n\nLet `S_n` be the group of permutations of `{1,...,n}` and, for a finite set `X`, let `S_X` be the group of permutations of `X`.\n\nLet `f_n: S_n -> GL(V_n)` be a sequence of representations of the symmetric groups and let `g_n: S_n -> S_{X_n}` be a sequence of group actions (also known as permutation representations of the symmetric groups).  Then their 'functorial composition' is the sequence of representations `f_{X_n} o g_n: S_n -> GL(V_{|X_n|})`.\n\nI have no idea whether this is interesting enough to warrant inclusion in `LazySymmetricFunction`.  It does enjoy some nice properties:\n\n*  `h_1 sum_{k >= 0} h_k` is a right neutral element, and if `F` corresponds to a group action, also a left neutral element.\n* `(F1 + F2).functorial_composition(G) = F1.functorial_composition(G) + F2.functorial_composition(G)`.\n* `(F1 x F2).functorial_composition(G) = F1.functorial_composition(G) x F2.functorial_composition(G)`, where `x` denotes the Hadamard (or inner tensor) product of sequences of representations.\n\nIf we do *not* want to have it as a method of `LazySymmetricFunction` I need some technical help: unfortunately I made this ticket an unnecessary dependency of #34423.  However, I can only move it into `species/generating_series.py` once `LazyPowerSeries` is gone.  How can I `rebase` #34423 on #34413 (or even better, on #34383)?",
    "created_at": "2022-08-31T21:06:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485065",
    "user": "mantepse"
}
```

I agree that we could also move functorial composition to the species generating functions code, I am not completely sure what is better.  Here is the precise representation theoretic description:

Let `S_n` be the group of permutations of `{1,...,n}` and, for a finite set `X`, let `S_X` be the group of permutations of `X`.

Let `f_n: S_n -> GL(V_n)` be a sequence of representations of the symmetric groups and let `g_n: S_n -> S_{X_n}` be a sequence of group actions (also known as permutation representations of the symmetric groups).  Then their 'functorial composition' is the sequence of representations `f_{X_n} o g_n: S_n -> GL(V_{|X_n|})`.

I have no idea whether this is interesting enough to warrant inclusion in `LazySymmetricFunction`.  It does enjoy some nice properties:

*  `h_1 sum_{k >= 0} h_k` is a right neutral element, and if `F` corresponds to a group action, also a left neutral element.
* `(F1 + F2).functorial_composition(G) = F1.functorial_composition(G) + F2.functorial_composition(G)`.
* `(F1 x F2).functorial_composition(G) = F1.functorial_composition(G) x F2.functorial_composition(G)`, where `x` denotes the Hadamard (or inner tensor) product of sequences of representations.

If we do *not* want to have it as a method of `LazySymmetricFunction` I need some technical help: unfortunately I made this ticket an unnecessary dependency of #34423.  However, I can only move it into `species/generating_series.py` once `LazyPowerSeries` is gone.  How can I `rebase` #34423 on #34413 (or even better, on #34383)?



---

archive/issue_comments_485066.json:
```json
{
    "body": "Thank you for the explanation. I am guessing you are taking the Frobenius map on these symmetric group actions/representations to get symmetric functions?\n\nSince you can implement it in `LazySymmetricFunctions`, then it probably should go there. I think we just need to do a reverse-engineering of sorts of the code into documentation. I guess if we are using the Frobenius map, then we can describe things in terms of power sums (and extend by properties you\u2019ve given?).\n\nIs there some way to tell if a lazy Symmetric function `F` corresponds to a group action? Does this just mean all of the coefficients are nonnegative integers in the Schur (or powersum?) basis?",
    "created_at": "2022-09-01T10:11:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485066",
    "user": "tscrim"
}
```

Thank you for the explanation. I am guessing you are taking the Frobenius map on these symmetric group actions/representations to get symmetric functions?

Since you can implement it in `LazySymmetricFunctions`, then it probably should go there. I think we just need to do a reverse-engineering of sorts of the code into documentation. I guess if we are using the Frobenius map, then we can describe things in terms of power sums (and extend by properties you’ve given?).

Is there some way to tell if a lazy Symmetric function `F` corresponds to a group action? Does this just mean all of the coefficients are nonnegative integers in the Schur (or powersum?) basis?



---

archive/issue_comments_485067.json:
```json
{
    "body": "Below is more information, in case you are interested.  However, punchline is that we agree.\n\nYes, to go from the representation to the symmetric function we take the Frobenius map, which is called cycle index series in species jargon.\n\nI don't see any sensible way to extend the functorial composition even to representations (i.e., sums of Schur functions with nonnegative coefficients) in the second argument.  The first argument can be any symmetric function over any ring, however.\n\nIf you live in the symmetric function world, it may be a bit surprising that the functorial composition is well defined, although it is not hard to see.  However, if you live in the species world, this is completely obvious.\n\nFinally: I don't know of a good way to check whether a symmetric function corresponds to a group action.  If it is Schur-non-negative, we have a representation, so this is necessary.  Also, it must be powersum-non-negative.  But this is not sufficient.  Per Alexandersson and Nima Amini have a charaterisation for group actions of *cyclic groups*.  It is very likely possible to do the same for group actions of the symmetric group.  In fact, you could simply check whether your character is a character in the Burnside ring, but this will be horribly inefficient.",
    "created_at": "2022-09-01T10:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485067",
    "user": "mantepse"
}
```

Below is more information, in case you are interested.  However, punchline is that we agree.

Yes, to go from the representation to the symmetric function we take the Frobenius map, which is called cycle index series in species jargon.

I don't see any sensible way to extend the functorial composition even to representations (i.e., sums of Schur functions with nonnegative coefficients) in the second argument.  The first argument can be any symmetric function over any ring, however.

If you live in the symmetric function world, it may be a bit surprising that the functorial composition is well defined, although it is not hard to see.  However, if you live in the species world, this is completely obvious.

Finally: I don't know of a good way to check whether a symmetric function corresponds to a group action.  If it is Schur-non-negative, we have a representation, so this is necessary.  Also, it must be powersum-non-negative.  But this is not sufficient.  Per Alexandersson and Nima Amini have a charaterisation for group actions of *cyclic groups*.  It is very likely possible to do the same for group actions of the symmetric group.  In fact, you could simply check whether your character is a character in the Burnside ring, but this will be horribly inefficient.



---

archive/issue_comments_485068.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T12:13:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485068",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485069.json:
```json
{
    "body": "Sorry for the merge.",
    "created_at": "2022-09-01T12:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485069",
    "user": "mantepse"
}
```

Sorry for the merge.



---

archive/issue_comments_485070.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T12:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485070",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485071.json:
```json
{
    "body": "Replying to [comment:17 mantepse]:\n> I don't see any sensible way to extend the functorial composition even to representations (i.e., sums of Schur functions with nonnegative coefficients) in the second argument.  The first argument can be any symmetric function over any ring, however.\n\nThis is confusing me a bit. Are there some restrictions on the input for this to be defined? If we are indeed limited on the inputs, then we definitely need to move this to the species code.\n\nFor the technical help, there are a few ways out of this. One is to create a new branch for the later ticket based on the new dependency and and just cherry-pick the requisite commits. Second would be a more technical rebase using the `-i` option. A third option is the most hacks where we just move the code on the replacement ticket.\n\n> If you live in the symmetric function world, it may be a bit surprising that the functorial composition is well defined, although it is not hard to see.  However, if you live in the species world, this is completely obvious.\n\nIn particular, it seems to conflict with this statement. My take on this is that it works for any pair of inputs.\n\n> Finally: I don't know of a good way to check whether a symmetric function corresponds to a group action.  If it is Schur-non-negative, we have a representation, so this is necessary.  Also, it must be powersum-non-negative.  But this is not sufficient.  Per Alexandersson and Nima Amini have a charaterisation for group actions of *cyclic groups*.  It is very likely possible to do the same for group actions of the symmetric group.  In fact, you could simply check whether your character is a character in the Burnside ring, but this will be horribly inefficient.\n\nWe can at least do a culling for the \u201ceasy\u201d check of Schur and powersum positivity. We can just then say anything beyond that, it is up to the user to make sure it is valid input (maybe with an example with the code on how to check).",
    "created_at": "2022-09-01T12:40:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485071",
    "user": "tscrim"
}
```

Replying to [comment:17 mantepse]:
> I don't see any sensible way to extend the functorial composition even to representations (i.e., sums of Schur functions with nonnegative coefficients) in the second argument.  The first argument can be any symmetric function over any ring, however.

This is confusing me a bit. Are there some restrictions on the input for this to be defined? If we are indeed limited on the inputs, then we definitely need to move this to the species code.

For the technical help, there are a few ways out of this. One is to create a new branch for the later ticket based on the new dependency and and just cherry-pick the requisite commits. Second would be a more technical rebase using the `-i` option. A third option is the most hacks where we just move the code on the replacement ticket.

> If you live in the symmetric function world, it may be a bit surprising that the functorial composition is well defined, although it is not hard to see.  However, if you live in the species world, this is completely obvious.

In particular, it seems to conflict with this statement. My take on this is that it works for any pair of inputs.

> Finally: I don't know of a good way to check whether a symmetric function corresponds to a group action.  If it is Schur-non-negative, we have a representation, so this is necessary.  Also, it must be powersum-non-negative.  But this is not sufficient.  Per Alexandersson and Nima Amini have a charaterisation for group actions of *cyclic groups*.  It is very likely possible to do the same for group actions of the symmetric group.  In fact, you could simply check whether your character is a character in the Burnside ring, but this will be horribly inefficient.

We can at least do a culling for the “easy” check of Schur and powersum positivity. We can just then say anything beyond that, it is up to the user to make sure it is valid input (maybe with an example with the code on how to check).



---

archive/issue_comments_485072.json:
```json
{
    "body": "There is absolutely no restriction on `self`.  The restriction on `g` is, that it must be the Frobenius character of a (sequence of) group actions.  The resulting Frobenius character is then well defined.\n\nIf `F` happens to be a formal sum (over any coefficient ring) of group actions, and `G` is a sequences of (true) group actions, the functorial composition is even well defined as a formal sum of group action.\n\nI am quite sure that there are other examples of methods where `self` is any member of the class but the other arguments must satisfy some conditions.\n\n> We can at least do a culling for the \u201ceasy\u201d check of Schur and powersum positivity. We can just then say anything beyond that, it is up to the user to make sure it is valid input (maybe with an example with the code on how to check). \n\nEven checking for Schur positivity may be extremely time consuming.  But I can check whether there are other easy checks (there should be).\n\nI am currently investigating a performance issue.",
    "created_at": "2022-09-01T12:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485072",
    "user": "mantepse"
}
```

There is absolutely no restriction on `self`.  The restriction on `g` is, that it must be the Frobenius character of a (sequence of) group actions.  The resulting Frobenius character is then well defined.

If `F` happens to be a formal sum (over any coefficient ring) of group actions, and `G` is a sequences of (true) group actions, the functorial composition is even well defined as a formal sum of group action.

I am quite sure that there are other examples of methods where `self` is any member of the class but the other arguments must satisfy some conditions.

> We can at least do a culling for the “easy” check of Schur and powersum positivity. We can just then say anything beyond that, it is up to the user to make sure it is valid input (maybe with an example with the code on how to check). 

Even checking for Schur positivity may be extremely time consuming.  But I can check whether there are other easy checks (there should be).

I am currently investigating a performance issue.



---

archive/issue_comments_485073.json:
```json
{
    "body": "Maybe it is okay here since we are giving this a basically symmetric-functions-only description (up to being able to make it precise when it will work, but that is not so serious) and the more I think about it, the less I am convinced by my justifications.\n\nIndeed, you\u2019re right that we can impose conditions on the inputs (including `self`) for certain methods. That was a weak argument in general; I was thinking it highlighted more than it does that we should be working with species.\n\nSince we are converting to the powersums anyways, we can check positivity there at least. I agree that the Schur positivity check is less important and can be skipped for speed.",
    "created_at": "2022-09-01T12:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485073",
    "user": "tscrim"
}
```

Maybe it is okay here since we are giving this a basically symmetric-functions-only description (up to being able to make it precise when it will work, but that is not so serious) and the more I think about it, the less I am convinced by my justifications.

Indeed, you’re right that we can impose conditions on the inputs (including `self`) for certain methods. That was a weak argument in general; I was thinking it highlighted more than it does that we should be working with species.

Since we are converting to the powersums anyways, we can check positivity there at least. I agree that the Schur positivity check is less important and can be skipped for speed.



---

archive/issue_comments_485074.json:
```json
{
    "body": "There are indeed a few obvious checks, but the code is tricky enough so that I first want to make sure I have a few good tests.\n\nHere is a first summary:\n\n* For a partition `s` of `n`, all partitions `t = g_cycle_type(n)` should have the same size, which should be the number of elements in `G[n]`, which is `n!` times the coefficient of `p[1,...,1]` in the Frobenius character of `G`. Therefore, `f_t = f[t.size()]` is only a single computation, and if `not f_t`,  we can return immediately.\n\n* the main issue is that we are potentially computing very large coefficients of `self`, and there is no way around that.\n\n* I am guessing that using `p.element_class(p, terms)` would save some time.",
    "created_at": "2022-09-01T15:08:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485074",
    "user": "mantepse"
}
```

There are indeed a few obvious checks, but the code is tricky enough so that I first want to make sure I have a few good tests.

Here is a first summary:

* For a partition `s` of `n`, all partitions `t = g_cycle_type(n)` should have the same size, which should be the number of elements in `G[n]`, which is `n!` times the coefficient of `p[1,...,1]` in the Frobenius character of `G`. Therefore, `f_t = f[t.size()]` is only a single computation, and if `not f_t`,  we can return immediately.

* the main issue is that we are potentially computing very large coefficients of `self`, and there is no way around that.

* I am guessing that using `p.element_class(p, terms)` would save some time.



---

archive/issue_comments_485075.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T21:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485075",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485076.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-09-01T21:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485076",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_485077.json:
```json
{
    "body": "Ready!",
    "created_at": "2022-09-01T21:53:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485077",
    "user": "mantepse"
}
```

Ready!



---

archive/issue_comments_485078.json:
```json
{
    "body": "Thanks. Onto the next ticket.",
    "created_at": "2022-09-01T23:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485078",
    "user": "tscrim"
}
```

Thanks. Onto the next ticket.



---

archive/issue_comments_485079.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-01T23:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485079",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485080.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2022-09-26T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485080",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_485081.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2022-09-26T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485081",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_485082.json:
```json
{
    "body": "trivial (automatic) merge, necessary to make the patchbots happy.",
    "created_at": "2022-09-26T10:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485082",
    "user": "mantepse"
}
```

trivial (automatic) merge, necessary to make the patchbots happy.



---

archive/issue_comments_485083.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-09-26T10:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485083",
    "user": "mantepse"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_485084.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-09-29T21:02:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/34185",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/34185#issuecomment-485084",
    "user": "vbraun"
}
```

Resolution: fixed
