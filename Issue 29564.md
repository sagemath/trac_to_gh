# Issue 29564: FormalPolyhedraModule - (so far finitely generated) free modules

Issue created by migration from https://trac.sagemath.org/ticket/29801

Original creator: mkoeppe

Original creation time: 2020-06-05 00:23:56

CC:  tscrim @braunmath




---

Comment by mkoeppe created at 2020-06-05 01:13:35

New commits:


---

Comment by git created at 2020-06-05 01:18:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-05 01:22:08

The results of `retract` print using a prefix "B".  Do I need to override the submodule method?


---

Comment by tscrim created at 2020-06-05 01:42:00

This is the default prefix for a submodule, so if you want a different prefix, you will need to override it with something like

```python
def submodule(self, gens, check=True, already_echelonized=False,
              unitriangular=False, category=None):
    if not already_echelonized:
        gens = self.echelon_form(gens, unitriangular)
    from sage.modules.with_basis.subquotient import SubmoduleWithBasis
        return SubmoduleWithBasis(gens, ambient=self, prefix='M',
                                  unitriangular=unitriangular,
                                  category=category)
```

However, you can set/change this dynamically at any point with:

```
sage: M_lower.print_options(prefix='V')
sage: y
V[0]
```

Although there probably should be an option added to the `submodule` to pass along such information to the submodule's constructor...


---

Comment by git created at 2020-06-05 01:46:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-05 01:49:33

Is the idea of the prefix for the submodule elements to refer to the ambient module, or to distinguish from the ambient module?


---

Comment by tscrim created at 2020-06-05 02:23:19

I am not quite sure I understand your question. All CFMs have a prefix parameter that can be set by the user to help them distinguish between the different *modules they are working with. This is used extensively in Sage (e.g., symmetric functions).


---

Comment by mkoeppe created at 2020-06-05 05:49:23

I guess I need to ask a more basic question first.  In the example:

```
   sage: M.basis()
   Finite family {conv([0], [1]): [conv([0], [1])], {[1]}: [{[1]}], conv([1], [2]): 
   [conv([1], [2])]}
   sage: M_lower.basis()
   Finite family {0: B[0]}
```

How come these two bases (of the ambient module and of the submodule) are indexed in very different ways?


---

Comment by tscrim created at 2020-06-05 11:21:41

A submodule of dimension d just uses the indexing set 0,...,d-1 because any generic submodule would not necessarily have any particular way to relate its basis with that of the ambient module. Moreover, it needs some indexing set for the basis, so it just chooses the simplest and most generic one. One possible way would be to use the leading support of each of the echeleonized basis elements, but that still feels fairly artificial/arbitrary to me.


---

Comment by mkoeppe created at 2020-06-06 00:14:16

OK, thanks a lot for the explanation.  I think I will revisit this cosmetic issue later.


---

Comment by git created at 2020-06-06 00:14:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-06 00:16:36

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-06-06 00:19:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-06 00:21:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-06 00:24:07

Changing status from new to needs_review.


---

Comment by tscrim created at 2020-06-06 00:38:26

At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?

If you do keep the category, `super_categories` needs a doctest.

Your `INPUT:` block should follow this format:

```
INPUT:

- ``foo`` -- some information
- ``bar`` -- other information that is
  really long
```

Note the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.

`FormalPolyhedraModule.__init__` needs a doctest; here we usually do a `TestSuite(M).run()` as the test.


---

Comment by mkoeppe created at 2020-06-06 00:42:07

Replying to [comment:17 tscrim]:
> At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?

It is indeed for future use, when I introduce the space generated by indicator functions of polyhedra, which is the quotient by all inclusion-exclusion relations.  That space is no longer graded, but only filtered by dimension.


---

Comment by mkoeppe created at 2020-06-06 00:44:55

But I'll follow your advice and make it just a method of the class for now.


---

Comment by git created at 2020-06-06 00:52:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-06 00:55:03

Replying to [comment:17 tscrim]:
> Your `INPUT:` block should follow this format...
> Note the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.

Thanks, fixed.

I really wish we had a linter for the docstrings that we could run locally instead of wasting reviewers' time with these formatting details and/or waiting for the patchbot...


---

Comment by git created at 2020-06-06 01:02:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-06 01:03:02

Sorry, that wasn't meant to be a suggestion to remove it; it was purely a question as I don't know what your long term structural plans are. Although I do think purely local to this ticket it is better.

Your `__init__` still needs a doctest, something like

```python
            sage: from sage.geometry.polyhedron.modules.formal_polyhedra_module import FormalPolyhedraModule
            sage: def closed_interval(a,b): return Polyhedron(vertices=[[a], [b]])
            sage: I01 = closed_interval(0, 1); I01.rename("conv([0], [1])")
            sage: I11 = closed_interval(1, 1); I11.rename("{[1]}")
            sage: I12 = closed_interval(1, 2); I12.rename("conv([1], [2])")
            sage: I02 = closed_interval(0, 2); I02.rename("conv([0], [2])")
            sage: M = FormalPolyhedraModule(QQ, 1, basis=[I01, I11, I12, I02])
            sage: TestSuite(M).run()
```


To help avoid some confusion in `degree_on_basis`, I think it would be a bit better to say `this would only be a filtration,` since this module does not (yet) have the linear relations implemented and it is in the category of graded modules.

Indeed, such a linter would be nice.


---

Comment by git created at 2020-06-06 01:16:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-06-06 01:17:16

Done.


---

Comment by mkoeppe created at 2020-06-06 01:18:59

Replying to [comment:23 tscrim]:
> Indeed, such a linter would be nice.

Meta-ticket #28936 (Adopt mainstream Python testing/linting infrastructure, describe in Developer's Guide) has several wishlist items in this direction.


---

Comment by tscrim created at 2020-06-06 02:14:31

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2020-06-06 02:14:31

Thank you.


---

Comment by mkoeppe created at 2020-06-06 02:16:29

Thanks!


---

Comment by vbraun created at 2020-06-27 09:26:20

Resolution: fixed
