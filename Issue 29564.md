# Issue 29564: FormalPolyhedraModule - (so far finitely generated) free modules

archive/issues_029564.json:
```json
{
    "body": "CC:  tscrim @braunmath\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29801\n\n",
    "created_at": "2020-06-05T00:23:56Z",
    "labels": [
        "geometry",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "FormalPolyhedraModule - (so far finitely generated) free modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29564",
    "user": "mkoeppe"
}
```
CC:  tscrim @braunmath



Issue created by migration from https://trac.sagemath.org/ticket/29801





---

archive/issue_comments_419857.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-06-05T01:13:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419857",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_419858.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-05T01:18:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419858",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419859.json:
```json
{
    "body": "The results of `retract` print using a prefix \"B\".  Do I need to override the submodule method?",
    "created_at": "2020-06-05T01:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419859",
    "user": "mkoeppe"
}
```

The results of `retract` print using a prefix "B".  Do I need to override the submodule method?



---

archive/issue_comments_419860.json:
```json
{
    "body": "This is the default prefix for a submodule, so if you want a different prefix, you will need to override it with something like\n\n```python\ndef submodule(self, gens, check=True, already_echelonized=False,\n              unitriangular=False, category=None):\n    if not already_echelonized:\n        gens = self.echelon_form(gens, unitriangular)\n    from sage.modules.with_basis.subquotient import SubmoduleWithBasis\n        return SubmoduleWithBasis(gens, ambient=self, prefix='M',\n                                  unitriangular=unitriangular,\n                                  category=category)\n```\n\nHowever, you can set/change this dynamically at any point with:\n\n```\nsage: M_lower.print_options(prefix='V')\nsage: y\nV[0]\n```\n\nAlthough there probably should be an option added to the `submodule` to pass along such information to the submodule's constructor...",
    "created_at": "2020-06-05T01:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419860",
    "user": "tscrim"
}
```

This is the default prefix for a submodule, so if you want a different prefix, you will need to override it with something like

```python
def submodule(self, gens, check=True, already_echelonized=False,
              unitriangular=False, category=None):
    if not already_echelonized:
        gens = self.echelon_form(gens, unitriangular)
    from sage.modules.with_basis.subquotient import SubmoduleWithBasis
        return SubmoduleWithBasis(gens, ambient=self, prefix='M',
                                  unitriangular=unitriangular,
                                  category=category)
```

However, you can set/change this dynamically at any point with:

```
sage: M_lower.print_options(prefix='V')
sage: y
V[0]
```

Although there probably should be an option added to the `submodule` to pass along such information to the submodule's constructor...



---

archive/issue_comments_419861.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-05T01:46:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419861",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419862.json:
```json
{
    "body": "Is the idea of the prefix for the submodule elements to refer to the ambient module, or to distinguish from the ambient module?",
    "created_at": "2020-06-05T01:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419862",
    "user": "mkoeppe"
}
```

Is the idea of the prefix for the submodule elements to refer to the ambient module, or to distinguish from the ambient module?



---

archive/issue_comments_419863.json:
```json
{
    "body": "I am not quite sure I understand your question. All CFMs have a prefix parameter that can be set by the user to help them distinguish between the different *modules they are working with. This is used extensively in Sage (e.g., symmetric functions).",
    "created_at": "2020-06-05T02:23:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419863",
    "user": "tscrim"
}
```

I am not quite sure I understand your question. All CFMs have a prefix parameter that can be set by the user to help them distinguish between the different *modules they are working with. This is used extensively in Sage (e.g., symmetric functions).



---

archive/issue_comments_419864.json:
```json
{
    "body": "I guess I need to ask a more basic question first.  In the example:\n\n```\n   sage: M.basis()\n   Finite family {conv([0], [1]): [conv([0], [1])], {[1]}: [{[1]}], conv([1], [2]): \n   [conv([1], [2])]}\n   sage: M_lower.basis()\n   Finite family {0: B[0]}\n```\n\nHow come these two bases (of the ambient module and of the submodule) are indexed in very different ways?",
    "created_at": "2020-06-05T05:49:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419864",
    "user": "mkoeppe"
}
```

I guess I need to ask a more basic question first.  In the example:

```
   sage: M.basis()
   Finite family {conv([0], [1]): [conv([0], [1])], {[1]}: [{[1]}], conv([1], [2]): 
   [conv([1], [2])]}
   sage: M_lower.basis()
   Finite family {0: B[0]}
```

How come these two bases (of the ambient module and of the submodule) are indexed in very different ways?



---

archive/issue_comments_419865.json:
```json
{
    "body": "A submodule of dimension d just uses the indexing set 0,...,d-1 because any generic submodule would not necessarily have any particular way to relate its basis with that of the ambient module. Moreover, it needs some indexing set for the basis, so it just chooses the simplest and most generic one. One possible way would be to use the leading support of each of the echeleonized basis elements, but that still feels fairly artificial/arbitrary to me.",
    "created_at": "2020-06-05T11:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419865",
    "user": "tscrim"
}
```

A submodule of dimension d just uses the indexing set 0,...,d-1 because any generic submodule would not necessarily have any particular way to relate its basis with that of the ambient module. Moreover, it needs some indexing set for the basis, so it just chooses the simplest and most generic one. One possible way would be to use the leading support of each of the echeleonized basis elements, but that still feels fairly artificial/arbitrary to me.



---

archive/issue_comments_419866.json:
```json
{
    "body": "OK, thanks a lot for the explanation.  I think I will revisit this cosmetic issue later.",
    "created_at": "2020-06-06T00:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419866",
    "user": "mkoeppe"
}
```

OK, thanks a lot for the explanation.  I think I will revisit this cosmetic issue later.



---

archive/issue_comments_419867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T00:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419867",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419868.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-06T00:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419868",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_419869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T00:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419869",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419870.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T00:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419870",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419871.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-06-06T00:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419871",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_419872.json:
```json
{
    "body": "At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?\n\nIf you do keep the category, `super_categories` needs a doctest.\n\nYour `INPUT:` block should follow this format:\n\n```\nINPUT:\n\n- ``foo`` -- some information\n- ``bar`` -- other information that is\n  really long\n```\n\nNote the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.\n\n`FormalPolyhedraModule.__init__` needs a doctest; here we usually do a `TestSuite(M).run()` as the test.",
    "created_at": "2020-06-06T00:38:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419872",
    "user": "tscrim"
}
```

At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?

If you do keep the category, `super_categories` needs a doctest.

Your `INPUT:` block should follow this format:

```
INPUT:

- ``foo`` -- some information
- ``bar`` -- other information that is
  really long
```

Note the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.

`FormalPolyhedraModule.__init__` needs a doctest; here we usually do a `TestSuite(M).run()` as the test.



---

archive/issue_comments_419873.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?\n\nIt is indeed for future use, when I introduce the space generated by indicator functions of polyhedra, which is the quotient by all inclusion-exclusion relations.  That space is no longer graded, but only filtered by dimension.",
    "created_at": "2020-06-06T00:42:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419873",
    "user": "mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> At this point, I don't see the need for having a category `PolyhedraModules`. Perhaps this is something you will expand on later, but currently you can just put the `degree_on_basis` in the `FormalPolyhedraModule` (which would belong to the category of `GradedModulesWithBasis`). So can you explain a bit why we should have this category?

It is indeed for future use, when I introduce the space generated by indicator functions of polyhedra, which is the quotient by all inclusion-exclusion relations.  That space is no longer graded, but only filtered by dimension.



---

archive/issue_comments_419874.json:
```json
{
    "body": "But I'll follow your advice and make it just a method of the class for now.",
    "created_at": "2020-06-06T00:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419874",
    "user": "mkoeppe"
}
```

But I'll follow your advice and make it just a method of the class for now.



---

archive/issue_comments_419875.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T00:52:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419875",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419876.json:
```json
{
    "body": "Replying to [comment:17 tscrim]:\n> Your `INPUT:` block should follow this format...\n> Note the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.\n\nThanks, fixed.\n\nI really wish we had a linter for the docstrings that we could run locally instead of wasting reviewers' time with these formatting details and/or waiting for the patchbot...",
    "created_at": "2020-06-06T00:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419876",
    "user": "mkoeppe"
}
```

Replying to [comment:17 tscrim]:
> Your `INPUT:` block should follow this format...
> Note the alignment (you have an additional 1 space indentation) and the double `--` for the non-bullet point.

Thanks, fixed.

I really wish we had a linter for the docstrings that we could run locally instead of wasting reviewers' time with these formatting details and/or waiting for the patchbot...



---

archive/issue_comments_419877.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T01:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419877",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419878.json:
```json
{
    "body": "Sorry, that wasn't meant to be a suggestion to remove it; it was purely a question as I don't know what your long term structural plans are. Although I do think purely local to this ticket it is better.\n\nYour `__init__` still needs a doctest, something like\n\n```python\n            sage: from sage.geometry.polyhedron.modules.formal_polyhedra_module import FormalPolyhedraModule\n            sage: def closed_interval(a,b): return Polyhedron(vertices=[[a], [b]])\n            sage: I01 = closed_interval(0, 1); I01.rename(\"conv([0], [1])\")\n            sage: I11 = closed_interval(1, 1); I11.rename(\"{[1]}\")\n            sage: I12 = closed_interval(1, 2); I12.rename(\"conv([1], [2])\")\n            sage: I02 = closed_interval(0, 2); I02.rename(\"conv([0], [2])\")\n            sage: M = FormalPolyhedraModule(QQ, 1, basis=[I01, I11, I12, I02])\n            sage: TestSuite(M).run()\n```\n\n\nTo help avoid some confusion in `degree_on_basis`, I think it would be a bit better to say `this would only be a filtration,` since this module does not (yet) have the linear relations implemented and it is in the category of graded modules.\n\nIndeed, such a linter would be nice.",
    "created_at": "2020-06-06T01:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419878",
    "user": "tscrim"
}
```

Sorry, that wasn't meant to be a suggestion to remove it; it was purely a question as I don't know what your long term structural plans are. Although I do think purely local to this ticket it is better.

Your `__init__` still needs a doctest, something like

```python
            sage: from sage.geometry.polyhedron.modules.formal_polyhedra_module import FormalPolyhedraModule
            sage: def closed_interval(a,b): return Polyhedron(vertices=[[a], [b]])
            sage: I01 = closed_interval(0, 1); I01.rename("conv([0], [1])")
            sage: I11 = closed_interval(1, 1); I11.rename("{[1]}")
            sage: I12 = closed_interval(1, 2); I12.rename("conv([1], [2])")
            sage: I02 = closed_interval(0, 2); I02.rename("conv([0], [2])")
            sage: M = FormalPolyhedraModule(QQ, 1, basis=[I01, I11, I12, I02])
            sage: TestSuite(M).run()
```


To help avoid some confusion in `degree_on_basis`, I think it would be a bit better to say `this would only be a filtration,` since this module does not (yet) have the linear relations implemented and it is in the category of graded modules.

Indeed, such a linter would be nice.



---

archive/issue_comments_419879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-06T01:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419879",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_419880.json:
```json
{
    "body": "Done.",
    "created_at": "2020-06-06T01:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419880",
    "user": "mkoeppe"
}
```

Done.



---

archive/issue_comments_419881.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> Indeed, such a linter would be nice.\n\nMeta-ticket #28936 (Adopt mainstream Python testing/linting infrastructure, describe in Developer's Guide) has several wishlist items in this direction.",
    "created_at": "2020-06-06T01:18:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419881",
    "user": "mkoeppe"
}
```

Replying to [comment:23 tscrim]:
> Indeed, such a linter would be nice.

Meta-ticket #28936 (Adopt mainstream Python testing/linting infrastructure, describe in Developer's Guide) has several wishlist items in this direction.



---

archive/issue_comments_419882.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-06T02:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419882",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_419883.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-06-06T02:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419883",
    "user": "tscrim"
}
```

Thank you.



---

archive/issue_comments_419884.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-06-06T02:16:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419884",
    "user": "mkoeppe"
}
```

Thanks!



---

archive/issue_comments_419885.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-27T09:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29564",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29564#issuecomment-419885",
    "user": "vbraun"
}
```

Resolution: fixed
