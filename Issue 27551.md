# Issue 27551: Make Sage reals and rationals more friendly to Python string formatting

archive/issues_027551.json:
```json
{
    "body": "CC:  slelievre @jcamp0x2a\n\nKeywords: format\n\nLet us make Sage reals and rationals more friendly\nto formatting commands that expect Python floats.\n\nFor example, with a Python float one can do\n\n```\nsage: a = 1.25r\nsage: \"{:0.3f}\".format(a)\n'1.250'\n```\n\nbut a similar command fails for a Sage real or rational:\n\n```\nsage: a = 1.25\nsage: \"{:0.3f}\".format(a)\nTraceback (most recent call last)\n...\nTypeError: unsupported format string passed to\nsage.rings.real_mpfr.RealLiteral.__format__\n```\n\n\n```\nsage: a = 5/4\nsage: \"{:0.3f}\".format(a)\nTraceback (most recent call last)\n...\nTypeError: unsupported format string passed to\nsage.rings.rational.Rational.__format__\n```\n\n\nThis puzzles users especially when using Python packages with Sage.\nAs things stand one needs to know to work around Sage's preparser.\nMost recently this came up in\n\n- [Ask Sage question 46408: tqdm's \"total\" parameter bug](https://ask.sagemath.org/question/46408)\n\nThe case of Sage integers was dealt with in #12788 and can provide inspiration.\n\nWe could also consider doing the same for number field elements, algebraic numbers,\ncomplex floating-point numbers, continued fractions... and other numbers in Sage\nfor which it makes sense.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27788\n\n",
    "created_at": "2019-05-06T22:49:26Z",
    "labels": [
        "numerical",
        "major",
        "enhancement"
    ],
    "title": "Make Sage reals and rationals more friendly to Python string formatting",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27551",
    "user": "slelievre"
}
```
CC:  slelievre @jcamp0x2a

Keywords: format

Let us make Sage reals and rationals more friendly
to formatting commands that expect Python floats.

For example, with a Python float one can do

```
sage: a = 1.25r
sage: "{:0.3f}".format(a)
'1.250'
```

but a similar command fails for a Sage real or rational:

```
sage: a = 1.25
sage: "{:0.3f}".format(a)
Traceback (most recent call last)
...
TypeError: unsupported format string passed to
sage.rings.real_mpfr.RealLiteral.__format__
```


```
sage: a = 5/4
sage: "{:0.3f}".format(a)
Traceback (most recent call last)
...
TypeError: unsupported format string passed to
sage.rings.rational.Rational.__format__
```


This puzzles users especially when using Python packages with Sage.
As things stand one needs to know to work around Sage's preparser.
Most recently this came up in

- [Ask Sage question 46408: tqdm's "total" parameter bug](https://ask.sagemath.org/question/46408)

The case of Sage integers was dealt with in #12788 and can provide inspiration.

We could also consider doing the same for number field elements, algebraic numbers,
complex floating-point numbers, continued fractions... and other numbers in Sage
for which it makes sense.

Issue created by migration from https://trac.sagemath.org/ticket/27788





---

archive/issue_comments_388723.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:55:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27551#issuecomment-388723",
    "user": "embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_388724.json:
```json
{
    "body": "This should be easily resolved by implementing `__format__` on the relevant types.  This might be a good beginner project.",
    "created_at": "2020-08-31T16:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27551#issuecomment-388724",
    "user": "embray"
}
```

This should be easily resolved by implementing `__format__` on the relevant types.  This might be a good beginner project.



---

archive/issue_comments_388725.json:
```json
{
    "body": "#30515 now has an implementation for real and complex numbers.\n\nImplementing this for rational numbers is a bit tricky since they have arbitrary precision, so fully parsing the [format specificier](https://docs.python.org/3/library/string.html#formatspec) seems to be necessary. Once the precision is known, one could convert to a `RealField` of suitable precision and reuse the `__format__` of its elements, but there may be some corner cases.",
    "created_at": "2020-09-06T12:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27551",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27551#issuecomment-388725",
    "user": "@mwageringel"
}
```

#30515 now has an implementation for real and complex numbers.

Implementing this for rational numbers is a bit tricky since they have arbitrary precision, so fully parsing the [format specificier](https://docs.python.org/3/library/string.html#formatspec) seems to be necessary. Once the precision is known, one could convert to a `RealField` of suitable precision and reuse the `__format__` of its elements, but there may be some corner cases.
