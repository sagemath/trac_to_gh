# Issue 27551: Make Sage reals and rationals more friendly to Python string formatting

Issue created by migration from https://trac.sagemath.org/ticket/27788

Original creator: slelievre

Original creation time: 2019-05-06 22:49:26

CC:  slelievre @jcamp0x2a

Keywords: format

Let us make Sage reals and rationals more friendly
to formatting commands that expect Python floats.

For example, with a Python float one can do

```
sage: a = 1.25r
sage: "{:0.3f}".format(a)
'1.250'
```

but a similar command fails for a Sage real or rational:

```
sage: a = 1.25
sage: "{:0.3f}".format(a)
Traceback (most recent call last)
...
TypeError: unsupported format string passed to
sage.rings.real_mpfr.RealLiteral.__format__
```


```
sage: a = 5/4
sage: "{:0.3f}".format(a)
Traceback (most recent call last)
...
TypeError: unsupported format string passed to
sage.rings.rational.Rational.__format__
```


This puzzles users especially when using Python packages with Sage.
As things stand one needs to know to work around Sage's preparser.
Most recently this came up in

- [Ask Sage question 46408: tqdm's "total" parameter bug](https://ask.sagemath.org/question/46408)

The case of Sage integers was dealt with in #12788 and can provide inspiration.

We could also consider doing the same for number field elements, algebraic numbers,
complex floating-point numbers, continued fractions... and other numbers in Sage
for which it makes sense.


---

Comment by embray created at 2019-06-14 14:55:02

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by embray created at 2020-08-31 16:41:10

This should be easily resolved by implementing `__format__` on the relevant types.  This might be a good beginner project.


---

Comment by @mwageringel created at 2020-09-06 12:20:46

#30515 now has an implementation for real and complex numbers.

Implementing this for rational numbers is a bit tricky since they have arbitrary precision, so fully parsing the [format specificier](https://docs.python.org/3/library/string.html#formatspec) seems to be necessary. Once the precision is known, one could convert to a `RealField` of suitable precision and reuse the `__format__` of its elements, but there may be some corner cases.
