# Issue 11921: Replace __getslice__ with functionality in __getitem__ in several files (part 2)

Issue created by migration from Trac.

Original creator: aapitzsch

Original creation time: 2011-11-28 10:44:10

Assignee: GeorgSWeber

CC:  fbissey jason

`__getslice__` has been deprecated for a long time in Python. This patch adds equivalent functionality to `__getitem__`, which is where the functionality should be.


---

Attachment

Currently there is one failing test in `"devel/sage/sage/rings/finite_rings/homset.py"`.

```
sage: H = Hom(GF(32, 'a'), GF(1024, 'b'))
sage: type(H[2:4])    # w/o patch
<class 'sage.structure.sequence.Sequence_generic'>
sage: type(H[2:4])    # w/ patch
<type 'list'>
```

Suggestions to solve this problem are welcome.


---

Comment by aapitzsch created at 2011-11-28 11:00:08

Changing status from new to needs_info.


---

Comment by fbissey created at 2011-11-28 11:19:58

What are in both case the types of "H" and say "H[1]"? I am actually not to worried here, I don't think the individual elements of H have ever been of type  sage.structure.sequence.Sequence_generic I am suspecting that's just a type for the slice. In this context a list is probably just as valid. We should check what the test is supposed to "test", but it may just a test that slicing is working. 

Just looked at the file before posting, what is the actual output of the test?


---

Comment by aapitzsch created at 2011-11-28 12:23:30

In both cases the same types.

```
sage: H = Hom(GF(32, 'a'), GF(1024, 'b'))
sage: type(H[1])
<class 'sage.rings.finite_rings.homset.FiniteFieldHomomorphism_im_gens'>
sage: type(H)
<class 'sage.rings.finite_rings.homset.FiniteFieldHomset_with_category'>
```


Output of the test `sage: H[2:4]`

without patch:

```
[
Ring morphism:
  From: Finite Field in a of size 2^5
  To:   Finite Field in b of size 2^10
  Defn: a |--> b^8 + b^6 + b^2,
Ring morphism:
  From: Finite Field in a of size 2^5
  To:   Finite Field in b of size 2^10
  Defn: a |--> b^9 + b^7 + b^6 + b^5 + b^4
]
```


with patch:

```
[Ring morphism:
  From: Finite Field in a of size 2^5
  To:   Finite Field in b of size 2^10
  Defn: a |--> b^8 + b^6 + b^2, Ring morphism:
  From: Finite Field in a of size 2^5
  To:   Finite Field in b of size 2^10
  Defn: a |--> b^9 + b^7 + b^6 + b^5 + b^4]
```



---

Comment by fbissey created at 2011-11-28 21:03:02

Seems like a fairly reasonable output to me does the doctest complains about formatting? If it is just that, I would just add a patch to take into account the new format.

I may be able to test this a little bit later.


---

Comment by aapitzsch created at 2011-11-29 12:34:03

Apply after trac_12093.patch


---

Comment by aapitzsch created at 2011-11-29 12:38:05

Changing status from needs_info to needs_review.


---

Attachment

With the additional patch [attachment:trac_12093_2.patch] all tests passed.


---

Comment by fbissey created at 2011-11-29 18:26:17

That's interesting but you re-introduce some *slice. Do you know why/where they are needed?


---

Comment by aapitzsch created at 2011-11-29 21:36:35

_list_ is a subclass of _Sequence_generic_ hence _Sequence_generic_ inherit `__*slice__` from _list_. I have to overwrite these `__*slice__` functions as long as Sage uses python 2.* otherwise the `__*slice__` functions of _list_ are called.


---

Comment by fbissey created at 2011-12-04 11:18:57

Replying to [comment:7 aapitzsch]:
> _list_ is a subclass of _Sequence_generic_ hence _Sequence_generic_ inherit `__*slice__` from _list_. I have to overwrite these `__*slice__` functions as long as Sage uses python 2.* otherwise the `__*slice__` functions of _list_ are called.

An unfortunate fact but you are correct. At least the code for it is minimal and will be easily removable when needed. Could you please add a comment documenting what you said just before {{{__getslice__}} in the code? That would be very helpful for future reference.


---

Attachment

Apply after trac_12093_2.patch


---

Comment by aapitzsch created at 2011-12-04 22:00:36

Replying to [comment:9 fbissey]:
> Could you please add a comment documenting what you said just before {{{__getslice__}} in the code? That would be very helpful for future reference.

Done.


---

Comment by fbissey created at 2011-12-06 02:16:31

Sorry I would liked to review this but I am quite involved with #9958 and I got some issues that I want to sort with #4260, so this is taking the back seat. Do you want to review Jason?


---

Comment by jason created at 2011-12-06 05:24:28

Where are we in the review?  Does it all need a review, or do I need to check something at the end?  (It's the last week of classes, so I'm kind of busy with end-of-semester things right now...)


---

Comment by fbissey created at 2011-12-06 11:12:19

I guess I am happy with the code and I already asked for extra stuff but it needs to be tested. I don't think it needs testing across a variety of platforms it either works or fails. Andr√© has already done some basic testing himself it needs crosschecking.


---

Comment by fbissey created at 2012-01-08 03:47:19

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2012-01-08 03:47:19

I am giving this a positive review. I am happy with the code as it is and it does everything that is possible at the current time for these instances of __*slice__.


---

Comment by jdemeyer created at 2012-01-09 23:26:14

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2012-01-09 23:26:14

This should be rebased against #9958 + #9138 + #11900 (all included in [sage-5.0.prealpha1](http://boxen.math.washington.edu/home/release/sage-5.0.prealpha1/))


---

Comment by aapitzsch created at 2012-01-11 13:49:32

based on sage-5.0.prealpha1


---

Attachment

I attached a rebased version and additionally changed the raise syntax preparing for Python 3 (see PEP 3109). Hope that's okay.


---

Comment by aapitzsch created at 2012-01-11 14:08:22

Changing status from needs_work to needs_review.


---

Comment by davidloeffler created at 2012-03-11 16:16:53

Apply trac_12093.rebased.patch

(for the patchbot)


---

Comment by davidloeffler created at 2012-03-12 17:25:02

Looks good to me, and the patchbot seems happy too. Positive review.


---

Comment by davidloeffler created at 2012-03-12 17:25:02

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-03-21 22:06:54

Resolution: fixed
