# Issue 24334: Orthogonal groups of TorsionQuadraticModules

archive/issues_024334.json:
```json
{
    "body": "CC:  tscrim vdelecroix\n\nIf `T` is a torsion quadratic module, then the orthogonal group consists of those group automorphisms that preserve the torsion quadratic form and bilinear form.\n\n- We can derive this from `sage.groups.abelian_gps.abelian_aut.AbelianGroupAutomorphismGroup_generic`#24087.\n- The class should interact well with `FGP_module_homomorphisms`,\n- If `T` is the discrimiant group of an IntegralLattice then there should be a coercion from the orthogonal group of the lattice. \n- Of course there `O(T)` must act consistently on elements of `T`.\n\nGenerators are hard to come by though ...\n\nIssue created by migration from https://trac.sagemath.org/ticket/24571\n\n",
    "created_at": "2018-01-19T15:44:54Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "Orthogonal groups of TorsionQuadraticModules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24334",
    "user": "sbrandhorst"
}
```
CC:  tscrim vdelecroix

If `T` is a torsion quadratic module, then the orthogonal group consists of those group automorphisms that preserve the torsion quadratic form and bilinear form.

- We can derive this from `sage.groups.abelian_gps.abelian_aut.AbelianGroupAutomorphismGroup_generic`#24087.
- The class should interact well with `FGP_module_homomorphisms`,
- If `T` is the discrimiant group of an IntegralLattice then there should be a coercion from the orthogonal group of the lattice. 
- Of course there `O(T)` must act consistently on elements of `T`.

Generators are hard to come by though ...

Issue created by migration from https://trac.sagemath.org/ticket/24571





---

archive/issue_comments_340725.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to group theory.",
    "created_at": "2018-01-24T08:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340725",
    "user": "sbrandhorst"
}
```

Changing component from PLEASE CHANGE to group theory.



---

archive/issue_comments_340726.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-01-24T08:30:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340726",
    "user": "sbrandhorst"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_340727.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-28T08:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340727",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340728.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-29T08:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340728",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340729.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-31T18:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340729",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340730.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-14T09:55:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340730",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340731.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-14T18:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340731",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340732.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-06T15:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340732",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340733.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-06T15:28:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340733",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340734.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-07T15:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340734",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-13T21:53:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340735",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340736.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-16T06:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340736",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340737.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-16T06:11:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340737",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340738.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-16T08:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340738",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340739.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-16T10:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340739",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340740.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-05-17T09:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340740",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340741.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-01-08T16:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340741",
    "user": "sbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_340742.json:
```json
{
    "body": "Added a slow brute force fallback to compute the generators.\nIn general one can \"write down\" the generators, but that took me a few thousand lines of code. I'll turn that into an optional package sometimes...\nMeanwhile this should do it. \n----\nNew commits:",
    "created_at": "2020-01-08T16:13:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340742",
    "user": "sbrandhorst"
}
```

Added a slow brute force fallback to compute the generators.
In general one can "write down" the generators, but that took me a few thousand lines of code. I'll turn that into an optional package sometimes...
Meanwhile this should do it. 
----
New commits:



---

archive/issue_comments_340743.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-18T10:35:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340743",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340744.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-18T10:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340744",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340745.json:
```json
{
    "body": "A bunch of little things:\n\nFor the first line of the module, it gets displayed as a title. So could you remove the period/full-stop at the end? Also, I think it should follow title capitalization, but Sage is not so consistent about this...\n\nPEP8 nitpick (just because changes are being done):\n\n```diff\n-return x*self\n+return x * self\n```\n\nand a few other similar such things.\n\n\n```diff\n     INPUT:\n \n-        - ``T`` a non degenerate torsion quadratic module.\n+    - ``T`` -- a non degenerate torsion quadratic module\n```\n\n\n`FqfOrthogonalGroup.__init__` is missing its docstring (and a `TestSuite(foo).run()` call).\n\n\n```diff\n-if not fqf.invariants() == ambient.domain().gens_orders():\n+if fqf.invariants() != ambient.domain().gens_orders():\n```\n\n\n\n```diff\n-        if check:\n-            for g in self.gens():\n-                if not self._preserves_form(g):\n-                    raise ValueError(\"%s does not preserve the quadratic form\"%g)\n+        if check and any(not self._preserves_form(g) for g in self.gens()):\n+            raise ValueError(\"%s does not preserve the quadratic form\"%g)\n```\n\n\nDo you really want specific type checking here and not subclass\n\n```python\nif not type(x) is GapElement:\n```\n\ncompared to `if not isinstance(x, GapElement):`?\n\nThe `_preserves_form` could be condensed into an `all()` statement:\n\n```python\nreturn all((gi*f).q() != gi.q() and all((gi*f).b(g[j]*f) != (gi*f).b(g[j]*f)\n                                        for j in range(i+1, len(g)))\n           for i, gi in enumerate(g)\n```\n\n\n\n```diff\n-        WARNING:\n+        .. WARNING::\n \n-        This is usually smaller than the orthogonal group of the bilinear form.\n+            This is usually smaller than the orthogonal group of the bilinear form.\n```\n\n\nI don't understand these lines here:\n\n```python\n        try:\n            gens = [matrix(x*g for x in self.smith_form_gens()) for g in gens]\n        except TypeError:\n            pass\n```\n\nWhy should it continue without modifying `gens`? It might be good to include this as a comment in the code.",
    "created_at": "2020-02-18T12:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340745",
    "user": "tscrim"
}
```

A bunch of little things:

For the first line of the module, it gets displayed as a title. So could you remove the period/full-stop at the end? Also, I think it should follow title capitalization, but Sage is not so consistent about this...

PEP8 nitpick (just because changes are being done):

```diff
-return x*self
+return x * self
```

and a few other similar such things.


```diff
     INPUT:
 
-        - ``T`` a non degenerate torsion quadratic module.
+    - ``T`` -- a non degenerate torsion quadratic module
```


`FqfOrthogonalGroup.__init__` is missing its docstring (and a `TestSuite(foo).run()` call).


```diff
-if not fqf.invariants() == ambient.domain().gens_orders():
+if fqf.invariants() != ambient.domain().gens_orders():
```



```diff
-        if check:
-            for g in self.gens():
-                if not self._preserves_form(g):
-                    raise ValueError("%s does not preserve the quadratic form"%g)
+        if check and any(not self._preserves_form(g) for g in self.gens()):
+            raise ValueError("%s does not preserve the quadratic form"%g)
```


Do you really want specific type checking here and not subclass

```python
if not type(x) is GapElement:
```

compared to `if not isinstance(x, GapElement):`?

The `_preserves_form` could be condensed into an `all()` statement:

```python
return all((gi*f).q() != gi.q() and all((gi*f).b(g[j]*f) != (gi*f).b(g[j]*f)
                                        for j in range(i+1, len(g)))
           for i, gi in enumerate(g)
```



```diff
-        WARNING:
+        .. WARNING::
 
-        This is usually smaller than the orthogonal group of the bilinear form.
+            This is usually smaller than the orthogonal group of the bilinear form.
```


I don't understand these lines here:

```python
        try:
            gens = [matrix(x*g for x in self.smith_form_gens()) for g in gens]
        except TypeError:
            pass
```

Why should it continue without modifying `gens`? It might be good to include this as a comment in the code.



---

archive/issue_comments_340746.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-18T14:07:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340746",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340747.json:
```json
{
    "body": "\n```\nFile \"src/sage/groups/fqf_orthogonal.py\", line 190, in sage.groups.fqf_orthogonal.FqfOrthogonalGroup.invariant_form\nFailed example:\n    Oq.invariant_form() is T\nExpected:\n    True\nGot:\n    False\n```\n\nBut in an interactive session I get\n\n```\nsage: q = matrix.diagonal(QQ, [2/3])\n....: T = TorsionQuadraticForm(q)\n....: Oq = T.orthogonal_group()\n....: Oq.invariant_form() is T\n....: \nTrue\n```\n\nCan you reproduce this behavior? What is going on?",
    "created_at": "2020-02-18T14:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340747",
    "user": "sbrandhorst"
}
```


```
File "src/sage/groups/fqf_orthogonal.py", line 190, in sage.groups.fqf_orthogonal.FqfOrthogonalGroup.invariant_form
Failed example:
    Oq.invariant_form() is T
Expected:
    True
Got:
    False
```

But in an interactive session I get

```
sage: q = matrix.diagonal(QQ, [2/3])
....: T = TorsionQuadraticForm(q)
....: Oq = T.orthogonal_group()
....: Oq.invariant_form() is T
....: 
True
```

Can you reproduce this behavior? What is going on?



---

archive/issue_comments_340748.json:
```json
{
    "body": "You have to create it twice to see it (see lines 71-74 (side note, probably be better to call the `TorsionQuadraticForm` `T` instead of reusing `q`)):\n\n```\nsage: qp = matrix.diagonal(QQ, [2/3])\nsage: Tp = TorsionQuadraticForm(qp)\nsage: Gp = Tp.orthogonal_group()\nsage: Gp.invariant_form() is Tp\nTrue\nsage: q = matrix.diagonal(QQ, [2/3])\nsage: T = TorsionQuadraticForm(q)\nsage: G = DiGraph([[1,2],[2,3]])\nsage: Oq = T.orthogonal_group()\nsage: Oq.invariant_form() is T\nFalse\n```\n\nSomething is not being set correctly in a cache somewhere:\n\n```\nsage: T is Tp\nFalse\nsage: Oq.invariant_form() is Tp\nTrue\nsage: Oq is Gp\nTrue\n```\n\nMy solution would be to make the results from `TorsionQuadraticForm` to be `UniqueRepresentation`. Otherwise just weaken the test slightly to be `==` instead of `is` (and make a clear note saying that the result does not have the unique representation property). (Side question: why aren't the (only ambient?) free modules in Sage a `UniqueRepresentation`?)",
    "created_at": "2020-02-19T00:10:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340748",
    "user": "tscrim"
}
```

You have to create it twice to see it (see lines 71-74 (side note, probably be better to call the `TorsionQuadraticForm` `T` instead of reusing `q`)):

```
sage: qp = matrix.diagonal(QQ, [2/3])
sage: Tp = TorsionQuadraticForm(qp)
sage: Gp = Tp.orthogonal_group()
sage: Gp.invariant_form() is Tp
True
sage: q = matrix.diagonal(QQ, [2/3])
sage: T = TorsionQuadraticForm(q)
sage: G = DiGraph([[1,2],[2,3]])
sage: Oq = T.orthogonal_group()
sage: Oq.invariant_form() is T
False
```

Something is not being set correctly in a cache somewhere:

```
sage: T is Tp
False
sage: Oq.invariant_form() is Tp
True
sage: Oq is Gp
True
```

My solution would be to make the results from `TorsionQuadraticForm` to be `UniqueRepresentation`. Otherwise just weaken the test slightly to be `==` instead of `is` (and make a clear note saying that the result does not have the unique representation property). (Side question: why aren't the (only ambient?) free modules in Sage a `UniqueRepresentation`?)



---

archive/issue_comments_340749.json:
```json
{
    "body": "My guess is that the creation of ambient free modules predates `UniqueRepresentation` and no one cared enough to change it.\n\nIndeed, it seems that torsion quadratic modules are not uniquely represented while FGP_modules are. But not via `UniqueRepresentation`.\nIn the computation of the orthogonal group we have the call\n\n```\n  Oq =  FqfOrthogonalGroup(ambient, gens, self, check=check)\n```\n\nwhich returns an instance of `UniqueRepresentation`.\n\n```\nsage: isinstance(Oq,UniqueRepresentation)\nTrue\n```\n\nTo do that, it uses the hash of `ambient`, `gens` and `self`\nbut `self` is not uniquely determined (`is`) by its hash (only up to `==`). \n\nWe could make FGP_Modules a `UniqueRepresentation` and do the same with `TorsionQuadraticModule`",
    "created_at": "2020-02-19T19:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340749",
    "user": "sbrandhorst"
}
```

My guess is that the creation of ambient free modules predates `UniqueRepresentation` and no one cared enough to change it.

Indeed, it seems that torsion quadratic modules are not uniquely represented while FGP_modules are. But not via `UniqueRepresentation`.
In the computation of the orthogonal group we have the call

```
  Oq =  FqfOrthogonalGroup(ambient, gens, self, check=check)
```

which returns an instance of `UniqueRepresentation`.

```
sage: isinstance(Oq,UniqueRepresentation)
True
```

To do that, it uses the hash of `ambient`, `gens` and `self`
but `self` is not uniquely determined (`is`) by its hash (only up to `==`). 

We could make FGP_Modules a `UniqueRepresentation` and do the same with `TorsionQuadraticModule`



---

archive/issue_comments_340750.json:
```json
{
    "body": "Another option would be to remove the `UniqueRepresentation` from\n`AbelianGroupAutomorphismGroup_gap` which is fine for me.",
    "created_at": "2020-02-19T19:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340750",
    "user": "sbrandhorst"
}
```

Another option would be to remove the `UniqueRepresentation` from
`AbelianGroupAutomorphismGroup_gap` which is fine for me.



---

archive/issue_comments_340751.json:
```json
{
    "body": "I would make them `UniqueRepresentation`s as the coercion framework works a lot better with them, it comes with pickling, and is faster when doing equality testing. It might be sufficient to just do `TorsionQuadraticModule` for this doctest. The `UniqueRepresentation` key only compares things up to `==`, not `is`.",
    "created_at": "2020-02-19T21:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340751",
    "user": "tscrim"
}
```

I would make them `UniqueRepresentation`s as the coercion framework works a lot better with them, it comes with pickling, and is faster when doing equality testing. It might be sufficient to just do `TorsionQuadraticModule` for this doctest. The `UniqueRepresentation` key only compares things up to `==`, not `is`.



---

archive/issue_comments_340752.json:
```json
{
    "body": "How about `CachedRepresentation` instead? Like for symmetric groups?",
    "created_at": "2020-02-19T21:21:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340752",
    "user": "sbrandhorst"
}
```

How about `CachedRepresentation` instead? Like for symmetric groups?



---

archive/issue_comments_340753.json:
```json
{
    "body": "At the moment I am trying to turn `FGP_Module` into a `UniqueRepresentation` but it breaks a lot of code elsewhere with non-hashable input. So maybe just doing `TorsionQuadraticModule` is okay.",
    "created_at": "2020-02-19T21:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340753",
    "user": "sbrandhorst"
}
```

At the moment I am trying to turn `FGP_Module` into a `UniqueRepresentation` but it breaks a lot of code elsewhere with non-hashable input. So maybe just doing `TorsionQuadraticModule` is okay.



---

archive/issue_comments_340754.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-19T21:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340754",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340755.json:
```json
{
    "body": "For reason to use CachedRepresentation instead of UniqueRepresentation\nI quote its\n\n\n```\nIn many applications, one wants to combine unique instance and cached\nrepresentation behaviour. This is called *unique representation* behaviour.\nWe have seen above that symmetric groups have a *cached* representation\nbehaviour. However, they do not show the *unique* representation behaviour,\nsince they are equal to groups created in a totally different way, namely to\nsubgroups::\n\n    sage: G = SymmetricGroup(6)\n    sage: G3 = G.subgroup([G((1,2,3,4,5,6)),G((1,2))])\n    sage: G is G3\n    False\n    sage: type(G) == type(G3)\n    False\n    sage: G == G3\n    True\n\n```\n\nThe same reasoning applies to both `TorsionQuadraticModule` and `AbelianGroupAutomorphismGroup_gap`",
    "created_at": "2020-02-19T22:04:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340755",
    "user": "sbrandhorst"
}
```

For reason to use CachedRepresentation instead of UniqueRepresentation
I quote its


```
In many applications, one wants to combine unique instance and cached
representation behaviour. This is called *unique representation* behaviour.
We have seen above that symmetric groups have a *cached* representation
behaviour. However, they do not show the *unique* representation behaviour,
since they are equal to groups created in a totally different way, namely to
subgroups::

    sage: G = SymmetricGroup(6)
    sage: G3 = G.subgroup([G((1,2,3,4,5,6)),G((1,2))])
    sage: G is G3
    False
    sage: type(G) == type(G3)
    False
    sage: G == G3
    True

```

The same reasoning applies to both `TorsionQuadraticModule` and `AbelianGroupAutomorphismGroup_gap`



---

archive/issue_comments_340756.json:
```json
{
    "body": "Replying to [comment:23 tscrim]:\n> The `_preserves_form` could be condensed into an `all()` statement:\n> {{{#!python\n> return all((gi*f).q() != gi.q() and all((gi*f).b(g[j]*f) != (gi*f).b(g[j]*f)\n>                                         for j in range(i+1, len(g)))\n>            for i, gi in enumerate(g)\n> }}}\nWhat is the benefit of this? I do not find it more aesthetic. \nIs it faster?",
    "created_at": "2020-02-19T22:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340756",
    "user": "sbrandhorst"
}
```

Replying to [comment:23 tscrim]:
> The `_preserves_form` could be condensed into an `all()` statement:
> {{{#!python
> return all((gi*f).q() != gi.q() and all((gi*f).b(g[j]*f) != (gi*f).b(g[j]*f)
>                                         for j in range(i+1, len(g)))
>            for i, gi in enumerate(g)
> }}}
What is the benefit of this? I do not find it more aesthetic. 
Is it faster?



---

archive/issue_comments_340757.json:
```json
{
    "body": "For comment:34: yes, it is faster.\n\nFor comment:33: I don't see that for `TorsionQuadraticModule` or `AbelianGroupAutomorphismGroup_gap`. For the symmetric groups, you can realize, e.g., `S_4` as either the group itself or as the natural subgroup of `S_5`. Since these are the same permutation group, the problem arises from `UniqueRepresentation` as the latter should know it is a subgroup but the former should not. Here, the `AbelianGroupAutomorphismGroup_gap` is created only as a specific (sub)group of automorphisms. The same reasoning holds true for `TorsionQuadraticModule`: it is identified with unique additional data.\n\nFor `FGP_Module`, this is not the case as the same Python class (representing the same module) can be created in different ways that carry different information. So I agree that this should not be a `UniqueRepresentation`.",
    "created_at": "2020-02-19T22:34:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340757",
    "user": "tscrim"
}
```

For comment:34: yes, it is faster.

For comment:33: I don't see that for `TorsionQuadraticModule` or `AbelianGroupAutomorphismGroup_gap`. For the symmetric groups, you can realize, e.g., `S_4` as either the group itself or as the natural subgroup of `S_5`. Since these are the same permutation group, the problem arises from `UniqueRepresentation` as the latter should know it is a subgroup but the former should not. Here, the `AbelianGroupAutomorphismGroup_gap` is created only as a specific (sub)group of automorphisms. The same reasoning holds true for `TorsionQuadraticModule`: it is identified with unique additional data.

For `FGP_Module`, this is not the case as the same Python class (representing the same module) can be created in different ways that carry different information. So I agree that this should not be a `UniqueRepresentation`.



---

archive/issue_comments_340758.json:
```json
{
    "body": "`UniqueRepresentation`, that is, equality if and only if it is the same object would change the behavior.\n\n```\nsage: q = TorsionQuadraticForm(matrix([2/3]))\nsage: q1 = q.submodule_with_gens([2*q.0])\nsage: q == q1\nTrue\nsage: q is q1\nFalse\n```\n\nYou can have the same group with different generators.\n\nTo me `any` is twice as slow as a simple for loop.\n\n```\nsage: def test(k):\n....:     for i in range(k):\n....:         if False:\n....:             break\n....:         \nsage: %timeit test(10^9)\n1 loop, best of 5: 18.6 s per loop\nsage: %timeit any(False for i in range(10^9))\n1 loop, best of 5: 43.4 s per loop\nsage: %timeit any(False for i in range(10^5))\nThe slowest run took 4.35 times longer than the fastest. This could mean that an intermediate result is being cached.\n100 loops, best of 5: 3.9 ms per loop\nsage: %timeit any(False for i in range(10^5))\n100 loops, best of 5: 3.88 ms per loop\nsage: %timeit test(10^5)\nThe slowest run took 4.28 times longer than the fastest. This could mean that an intermediate result is being cached.\n1000 loops, best of 5: 1.73 ms per loop\nsage: %timeit test(10^5)\n\n```\n",
    "created_at": "2020-02-20T09:11:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340758",
    "user": "sbrandhorst"
}
```

`UniqueRepresentation`, that is, equality if and only if it is the same object would change the behavior.

```
sage: q = TorsionQuadraticForm(matrix([2/3]))
sage: q1 = q.submodule_with_gens([2*q.0])
sage: q == q1
True
sage: q is q1
False
```

You can have the same group with different generators.

To me `any` is twice as slow as a simple for loop.

```
sage: def test(k):
....:     for i in range(k):
....:         if False:
....:             break
....:         
sage: %timeit test(10^9)
1 loop, best of 5: 18.6 s per loop
sage: %timeit any(False for i in range(10^9))
1 loop, best of 5: 43.4 s per loop
sage: %timeit any(False for i in range(10^5))
The slowest run took 4.35 times longer than the fastest. This could mean that an intermediate result is being cached.
100 loops, best of 5: 3.9 ms per loop
sage: %timeit any(False for i in range(10^5))
100 loops, best of 5: 3.88 ms per loop
sage: %timeit test(10^5)
The slowest run took 4.28 times longer than the fastest. This could mean that an intermediate result is being cached.
1000 loops, best of 5: 1.73 ms per loop
sage: %timeit test(10^5)

```




---

archive/issue_comments_340759.json:
```json
{
    "body": "Replying to [comment:36 sbrandhorst]:\n> `UniqueRepresentation`, that is, equality if and only if it is the same object would change the behavior.\n> {{{\n> sage: q = TorsionQuadraticForm(matrix([2/3]))\n> sage: q1 = q.submodule_with_gens([2*q.0])\n> sage: q == q1\n> True\n> sage: q is q1\n> False\n> }}}\n> You can have the same group with different generators.\n\nI see. I was thinking the extra construction data would make you want to distinguish them via equality. Okay, then using `CachedRepresentation` is good.\n\n> To me `any` is twice as slow as a simple for loop.\n> {{{\n> sage: def test(k):\n> ....:     for i in range(k):\n> ....:         if False:\n> ....:             break\n> ....:         \n> sage: %timeit test(10^9)\n> 1 loop, best of 5: 18.6 s per loop\n> sage: %timeit any(False for i in range(10^9))\n> 1 loop, best of 5: 43.4 s per loop\n> sage: %timeit any(False for i in range(10^5))\n> The slowest run took 4.35 times longer than the fastest. This could mean that an intermediate result is being cached.\n> 100 loops, best of 5: 3.9 ms per loop\n> sage: %timeit any(False for i in range(10^5))\n> 100 loops, best of 5: 3.88 ms per loop\n> sage: %timeit test(10^5)\n> The slowest run took 4.28 times longer than the fastest. This could mean that an intermediate result is being cached.\n> 1000 loops, best of 5: 1.73 ms per loop\n> sage: %timeit test(10^5)\n> \n> }}}\n\nWhen I change it to a non-trivial test, I get nearly the same timings, but with an extra 3ms for the `any` and `all`. So they are essentially the same in any practical scenario. Maybe something has changed in Python3 compared to Python2? I definitely did test this previously and saw a speedup... Oh well. I agree the current code with `for` loops is easier to understand. However, I still recommend using `for i,gi in enumerate(g):`. You may also want to have `g[i]*f` into a separate variable so you are not recomputing it a bunch of times (about 2n<sup>2</sup> times in total in fact).",
    "created_at": "2020-02-20T10:57:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340759",
    "user": "tscrim"
}
```

Replying to [comment:36 sbrandhorst]:
> `UniqueRepresentation`, that is, equality if and only if it is the same object would change the behavior.
> {{{
> sage: q = TorsionQuadraticForm(matrix([2/3]))
> sage: q1 = q.submodule_with_gens([2*q.0])
> sage: q == q1
> True
> sage: q is q1
> False
> }}}
> You can have the same group with different generators.

I see. I was thinking the extra construction data would make you want to distinguish them via equality. Okay, then using `CachedRepresentation` is good.

> To me `any` is twice as slow as a simple for loop.
> {{{
> sage: def test(k):
> ....:     for i in range(k):
> ....:         if False:
> ....:             break
> ....:         
> sage: %timeit test(10^9)
> 1 loop, best of 5: 18.6 s per loop
> sage: %timeit any(False for i in range(10^9))
> 1 loop, best of 5: 43.4 s per loop
> sage: %timeit any(False for i in range(10^5))
> The slowest run took 4.35 times longer than the fastest. This could mean that an intermediate result is being cached.
> 100 loops, best of 5: 3.9 ms per loop
> sage: %timeit any(False for i in range(10^5))
> 100 loops, best of 5: 3.88 ms per loop
> sage: %timeit test(10^5)
> The slowest run took 4.28 times longer than the fastest. This could mean that an intermediate result is being cached.
> 1000 loops, best of 5: 1.73 ms per loop
> sage: %timeit test(10^5)
> 
> }}}

When I change it to a non-trivial test, I get nearly the same timings, but with an extra 3ms for the `any` and `all`. So they are essentially the same in any practical scenario. Maybe something has changed in Python3 compared to Python2? I definitely did test this previously and saw a speedup... Oh well. I agree the current code with `for` loops is easier to understand. However, I still recommend using `for i,gi in enumerate(g):`. You may also want to have `g[i]*f` into a separate variable so you are not recomputing it a bunch of times (about 2n<sup>2</sup> times in total in fact).



---

archive/issue_comments_340760.json:
```json
{
    "body": "Good point.",
    "created_at": "2020-02-20T11:12:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340760",
    "user": "sbrandhorst"
}
```

Good point.



---

archive/issue_comments_340761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-20T11:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340761",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340762.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-20T11:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340762",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340763.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-20T19:53:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340763",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340764.json:
```json
{
    "body": "O.K. it should be ready now.",
    "created_at": "2020-02-20T19:54:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340764",
    "user": "sbrandhorst"
}
```

O.K. it should be ready now.



---

archive/issue_comments_340765.json:
```json
{
    "body": "Thank you for the changes.\n\nLast time I checked, it (surprisingly) is faster to do\n\n```diff\n-gf = tuple(h*f for h in g)\n+gf = tuple([h*f for h in g])\n```\n\nHowever, I might not do that because then it doesn't take advantage of short-circuiting and it puts everything in memory. So there is a design choice to be made here. I guess it depends on how often you think it will pass through every element in the list at least once before failing and if `g` is expected to be a \"short\" list (in some appropriate sense of the word). You know more the use-cases than I do. This probably is the correct thing to do, but I just wanted to check that you thought about these things as well.\n\nFinally, this change (2x) should be reverted:\n\n```diff\n-        .. WARNING::\n+        ..WARNING::\n```\n",
    "created_at": "2020-02-21T02:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340765",
    "user": "tscrim"
}
```

Thank you for the changes.

Last time I checked, it (surprisingly) is faster to do

```diff
-gf = tuple(h*f for h in g)
+gf = tuple([h*f for h in g])
```

However, I might not do that because then it doesn't take advantage of short-circuiting and it puts everything in memory. So there is a design choice to be made here. I guess it depends on how often you think it will pass through every element in the list at least once before failing and if `g` is expected to be a "short" list (in some appropriate sense of the word). You know more the use-cases than I do. This probably is the correct thing to do, but I just wanted to check that you thought about these things as well.

Finally, this change (2x) should be reverted:

```diff
-        .. WARNING::
+        ..WARNING::
```




---

archive/issue_comments_340766.json:
```json
{
    "body": "I guess the common use case is to create a subgroup from some hand-made matrices with `check=True`.\nThen they are tested to preserve the form. If the user did not fuck up, the answer is `True` every time so that the check goes through the whole tuple. \nAre you saying that `gf = tuple(h*f for h in g)` is not expanded in memory?",
    "created_at": "2020-02-21T08:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340766",
    "user": "sbrandhorst"
}
```

I guess the common use case is to create a subgroup from some hand-made matrices with `check=True`.
Then they are tested to preserve the form. If the user did not fuck up, the answer is `True` every time so that the check goes through the whole tuple. 
Are you saying that `gf = tuple(h*f for h in g)` is not expanded in memory?



---

archive/issue_comments_340767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-21T08:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340767",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340768.json:
```json
{
    "body": "I guess if we want speed, the right thing to do is to make `fgp_element.py` a cython file first.\nBut that is certainly for another ticket.",
    "created_at": "2020-02-21T08:38:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340768",
    "user": "sbrandhorst"
}
```

I guess if we want speed, the right thing to do is to make `fgp_element.py` a cython file first.
But that is certainly for another ticket.



---

archive/issue_comments_340769.json:
```json
{
    "body": "Fair enough. Thank you. Positive review.",
    "created_at": "2020-02-21T08:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340769",
    "user": "tscrim"
}
```

Fair enough. Thank you. Positive review.



---

archive/issue_comments_340770.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-02-21T08:58:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340770",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_340771.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-02-22T18:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340771",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_340772.json:
```json
{
    "body": "On python 2:\n\n```\n**********************************************************************\nFile \"src/sage/groups/fqf_orthogonal.py\", line 12, in sage.groups.fqf_orthogonal\nFailed example:\n    T = L.discriminant_group()\nException raised:\n    Traceback (most recent call last):\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 681, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1123, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.groups.fqf_orthogonal[1]>\", line 1, in <module>\n        T = L.discriminant_group()\n      File \"sage/misc/cachefunc.pyx\", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)\n        w = self._instance_call(*args, **kwds)\n      File \"sage/misc/cachefunc.pyx\", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)\n        return self.f(self._instance, *args, **kwds)\n      File \"/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modules/free_quadratic_module_integer_symmetric.py\", line 808, in discriminant_group\n        D = TorsionQuadraticModule(self.dual_lattice(), self)\n      File \"sage/misc/classcall_metaclass.pyx\", line 334, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)\n        return cls.classcall(cls, *args, **kwds)\n    TypeError: unbound method __classcall__() must be called with TorsionQuadraticModule instance as first argument (got ClasscallMetaclass instance instead)\n**********************************************************************\n```\n",
    "created_at": "2020-02-22T18:28:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340772",
    "user": "vbraun"
}
```

On python 2:

```
**********************************************************************
File "src/sage/groups/fqf_orthogonal.py", line 12, in sage.groups.fqf_orthogonal
Failed example:
    T = L.discriminant_group()
Exception raised:
    Traceback (most recent call last):
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 681, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1123, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.groups.fqf_orthogonal[1]>", line 1, in <module>
        T = L.discriminant_group()
      File "sage/misc/cachefunc.pyx", line 1948, in sage.misc.cachefunc.CachedMethodCaller.__call__ (build/cythonized/sage/misc/cachefunc.c:10273)
        w = self._instance_call(*args, **kwds)
      File "sage/misc/cachefunc.pyx", line 1824, in sage.misc.cachefunc.CachedMethodCaller._instance_call (build/cythonized/sage/misc/cachefunc.c:9758)
        return self.f(self._instance, *args, **kwds)
      File "/var/lib/buildbot/slave/sage2_git/build/local/lib/python2.7/site-packages/sage/modules/free_quadratic_module_integer_symmetric.py", line 808, in discriminant_group
        D = TorsionQuadraticModule(self.dual_lattice(), self)
      File "sage/misc/classcall_metaclass.pyx", line 334, in sage.misc.classcall_metaclass.ClasscallMetaclass.__call__ (build/cythonized/sage/misc/classcall_metaclass.c:1741)
        return cls.classcall(cls, *args, **kwds)
    TypeError: unbound method __classcall__() must be called with TorsionQuadraticModule instance as first argument (got ClasscallMetaclass instance instead)
**********************************************************************
```




---

archive/issue_comments_340773.json:
```json
{
    "body": "`__classcall__` should be an ``@`staticmethod`. Once changed, you can set it back to a positive review.",
    "created_at": "2020-02-23T00:04:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340773",
    "user": "tscrim"
}
```

`__classcall__` should be an ``@`staticmethod`. Once changed, you can set it back to a positive review.



---

archive/issue_comments_340774.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-02-24T17:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340774",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_340775.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-02-24T17:45:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340775",
    "user": "sbrandhorst"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_340776.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-02-26T20:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340776",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_340777.json:
```json
{
    "body": "I am getting\n\n```\nsage -t --long /usr/lib/python3.7/site-packages/sage/groups/fqf_orthogonal.py\n**********************************************************************\nFile \"/usr/lib/python3.7/site-packages/sage/groups/fqf_orthogonal.py\", line 17, in sage.groups.fqf_orthogonal\nFailed example:\n    T.gen(0) * Oq.an_element()\nExpected:\n    (1, 3)\nGot:\n    (0, 3)\n**********************************************************************\n```\n\nDoes it depends on what gap packages are installed?",
    "created_at": "2020-02-29T02:55:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340777",
    "user": "fbissey"
}
```

I am getting

```
sage -t --long /usr/lib/python3.7/site-packages/sage/groups/fqf_orthogonal.py
**********************************************************************
File "/usr/lib/python3.7/site-packages/sage/groups/fqf_orthogonal.py", line 17, in sage.groups.fqf_orthogonal
Failed example:
    T.gen(0) * Oq.an_element()
Expected:
    (1, 3)
Got:
    (0, 3)
**********************************************************************
```

Does it depends on what gap packages are installed?



---

archive/issue_comments_340778.json:
```json
{
    "body": "Maybe the `Oq.an_element()` call does? One could replace it by a hard coded element.",
    "created_at": "2020-03-01T18:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340778",
    "user": "sbrandhorst"
}
```

Maybe the `Oq.an_element()` call does? One could replace it by a hard coded element.



---

archive/issue_comments_340779.json:
```json
{
    "body": "`an_element` returns the product of the generators.\nNow the generators are produced using the gap function\n`SmallGeneratingSet`.\nI do not know how the function works internally but it seems possible this is where the packages come in.",
    "created_at": "2020-03-04T09:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340779",
    "user": "sbrandhorst"
}
```

`an_element` returns the product of the generators.
Now the generators are produced using the gap function
`SmallGeneratingSet`.
I do not know how the function works internally but it seems possible this is where the packages come in.



---

archive/issue_comments_340780.json:
```json
{
    "body": "This may be difficult to track down unless you know `gap` well. But I probably won't be the only one with a failure - unless I am missing a gap package that is meant to be in the sage's default.",
    "created_at": "2020-03-04T10:01:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340780",
    "user": "fbissey"
}
```

This may be difficult to track down unless you know `gap` well. But I probably won't be the only one with a failure - unless I am missing a gap package that is meant to be in the sage's default.



---

archive/issue_comments_340781.json:
```json
{
    "body": "Replying to [comment:56 fbissey]:\n> This may be difficult to track down unless you know `gap` well. But I probably won't be the only one with a failure - unless I am missing a gap package that is meant to be in the sage's default.\n\nI've go the same error (`(0,3)`, not `(1,3)`), on Fedora 30, x86_64, and the current 9.1.beta6 with gap_packages spkg installed.\n\nThis is not surprising, in fact, as gap_packages contain stuff that speeds up certain GAP algorithms. This test is buggy; it should be not using the call to `an_element`, but something deterministic. I've opened #29282 as a followup",
    "created_at": "2020-03-05T13:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24334",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24334#issuecomment-340781",
    "user": "dimpase"
}
```

Replying to [comment:56 fbissey]:
> This may be difficult to track down unless you know `gap` well. But I probably won't be the only one with a failure - unless I am missing a gap package that is meant to be in the sage's default.

I've go the same error (`(0,3)`, not `(1,3)`), on Fedora 30, x86_64, and the current 9.1.beta6 with gap_packages spkg installed.

This is not surprising, in fact, as gap_packages contain stuff that speeds up certain GAP algorithms. This test is buggy; it should be not using the call to `an_element`, but something deterministic. I've opened #29282 as a followup
