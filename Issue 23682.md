# Issue 23682: Sage library: standardize on C99 and C++11

archive/issues_023682.json:
```json
{
    "body": "CC:  @kiwifb\n\nI suggest to fix a default version of the C and C++ standard to compile the Sage library with.\n\nThe reason is that different C/C++ compiler come with different standards as default (older GCC defaults to C89 and C++98, newer GCC default to C11 and C++11 and I have no idea what Clang does). Explicitly adding a `-std=` flag will hide those differences.\n\nI suggest to default to C99 and C++11 because those are the versions which are already explicitly listed in a few places. So choosing those versions would also reduce some clutter in `module_list.py`. And given that we can already use `-std=c99` and `-std=c++11`, we know that our compilers support that.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23919\n\n",
    "created_at": "2017-09-22T11:39:50Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Sage library: standardize on C99 and C++11",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23682",
    "user": "https://github.com/jdemeyer"
}
```
CC:  @kiwifb

I suggest to fix a default version of the C and C++ standard to compile the Sage library with.

The reason is that different C/C++ compiler come with different standards as default (older GCC defaults to C89 and C++98, newer GCC default to C11 and C++11 and I have no idea what Clang does). Explicitly adding a `-std=` flag will hide those differences.

I suggest to default to C99 and C++11 because those are the versions which are already explicitly listed in a few places. So choosing those versions would also reduce some clutter in `module_list.py`. And given that we can already use `-std=c99` and `-std=c++11`, we know that our compilers support that.

Issue created by migration from https://trac.sagemath.org/ticket/23919





---

archive/issue_comments_331331.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-22T12:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331331",
    "user": "https://github.com/kiwifb"
}
```

New commits:



---

archive/issue_comments_331332.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-09-22T12:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331332",
    "user": "https://github.com/jdemeyer"
}
```

New commits:



---

archive/issue_comments_331333.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-22T12:19:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331333",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331334.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-22T12:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331334",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_331335.json:
```json
{
    "body": "With this ticket, Sage builds fine with GCC 4.9.4 on Gentoo Linux x86_64.",
    "created_at": "2017-09-22T12:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331335",
    "user": "https://github.com/jdemeyer"
}
```

With this ticket, Sage builds fine with GCC 4.9.4 on Gentoo Linux x86_64.



---

archive/issue_comments_331336.json:
```json
{
    "body": "Also builds fine with GCC 5.3.0 on Ubuntu 16.04.1 LTS ppc64le.",
    "created_at": "2017-09-22T12:42:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331336",
    "user": "https://github.com/jdemeyer"
}
```

Also builds fine with GCC 5.3.0 on Ubuntu 16.04.1 LTS ppc64le.



---

archive/issue_comments_331337.json:
```json
{
    "body": "I also did something to `ntl` some time ago that was purposely avoiding c++11 so some packages downstream wouldn't break for lack of support. `NTL_THREADS=off` actually disable C++11. When it is on `ntl` uses C++11 threads. Now that all the downstream packages do/can do C++11 we should turn it on, or at a minimum leave the switch alone.",
    "created_at": "2017-09-24T02:30:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331337",
    "user": "https://github.com/kiwifb"
}
```

I also did something to `ntl` some time ago that was purposely avoiding c++11 so some packages downstream wouldn't break for lack of support. `NTL_THREADS=off` actually disable C++11. When it is on `ntl` uses C++11 threads. Now that all the downstream packages do/can do C++11 we should turn it on, or at a minimum leave the switch alone.



---

archive/issue_comments_331338.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> I also did something to `ntl` some time ago that was purposely avoiding c++11 so some packages downstream wouldn't break for lack of support. `NTL_THREADS=off` actually disable C++11. When it is on `ntl` uses C++11 threads. Now that all the downstream packages do/can do C++11 we should turn it on, or at a minimum leave the switch alone.\n\n\nSorry, I tried to read this paragraph several times but I don't understand what you mean or how it is related to this ticket.",
    "created_at": "2017-09-25T07:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331338",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:10 fbissey]:
> I also did something to `ntl` some time ago that was purposely avoiding c++11 so some packages downstream wouldn't break for lack of support. `NTL_THREADS=off` actually disable C++11. When it is on `ntl` uses C++11 threads. Now that all the downstream packages do/can do C++11 we should turn it on, or at a minimum leave the switch alone.


Sorry, I tried to read this paragraph several times but I don't understand what you mean or how it is related to this ticket.



---

archive/issue_comments_331339.json:
```json
{
    "body": "Let me try again. In one of the upgrade of `ntl` _I_ purposefully disabled a switch enabling C++11 because `ntl` consumers such as `eclib` and `singular` couldn't use it (as in they would fail to build if it was enabled). \n\nI suggest that stopping to prevent `ntl` from using C++11 construct is in scope for this ticket.",
    "created_at": "2017-09-25T08:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331339",
    "user": "https://github.com/kiwifb"
}
```

Let me try again. In one of the upgrade of `ntl` _I_ purposefully disabled a switch enabling C++11 because `ntl` consumers such as `eclib` and `singular` couldn't use it (as in they would fail to build if it was enabled). 

I suggest that stopping to prevent `ntl` from using C++11 construct is in scope for this ticket.



---

archive/issue_comments_331340.json:
```json
{
    "body": "Replying to [comment:12 fbissey]:\n> I suggest that stopping to prevent `ntl` from using C++11 construct is in scope for this ticket.\n\n\nThis ticket is only about the Sage library, in other words the Cython modules using those libraries. So are you talking about Cython modules or about the libraries themselves?",
    "created_at": "2017-09-25T13:27:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331340",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:12 fbissey]:
> I suggest that stopping to prevent `ntl` from using C++11 construct is in scope for this ticket.


This ticket is only about the Sage library, in other words the Cython modules using those libraries. So are you talking about Cython modules or about the libraries themselves?



---

archive/issue_comments_331341.json:
```json
{
    "body": "Strangely, this leads to doctest failures on `i386`:\n\n```\nsage -t --warn-long 69.4 src/sage/rings/real_double.pyx\n**********************************************************************\nFile \"src/sage/rings/real_double.pyx\", line 2056, in sage.rings.real_double.RealDoubleElement.log10\nFailed example:\n    r = RDF('16.0'); r.log10()\nExpected:\n    1.2041199826559246\nGot:\n    1.2041199826559248\n**********************************************************************\nFile \"src/sage/rings/real_double.pyx\", line 2172, in sage.rings.real_double.RealDoubleElement.exp10\nFailed example:\n    r.exp10()\nExpected:\n    5.011872336272702e-33\nGot:\n    5.0118723362727734e-33\n**********************************************************************\n```",
    "created_at": "2017-09-25T13:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331341",
    "user": "https://github.com/jdemeyer"
}
```

Strangely, this leads to doctest failures on `i386`:

```
sage -t --warn-long 69.4 src/sage/rings/real_double.pyx
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2056, in sage.rings.real_double.RealDoubleElement.log10
Failed example:
    r = RDF('16.0'); r.log10()
Expected:
    1.2041199826559246
Got:
    1.2041199826559248
**********************************************************************
File "src/sage/rings/real_double.pyx", line 2172, in sage.rings.real_double.RealDoubleElement.exp10
Failed example:
    r.exp10()
Expected:
    5.011872336272702e-33
Got:
    5.0118723362727734e-33
**********************************************************************
```



---

archive/issue_comments_331342.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-09-25T13:47:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331342",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_331343.json:
```json
{
    "body": "I debugged the `i386` failures. It seems that, with GCC-6.2.0, the literal number `2.30258509299404568402` is treated as `double` with GNU extensions `-std=gnu89` but as `long double` with `-std=c89` (or `-std=c99`, this doesn't matter).",
    "created_at": "2017-09-26T09:37:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331343",
    "user": "https://github.com/jdemeyer"
}
```

I debugged the `i386` failures. It seems that, with GCC-6.2.0, the literal number `2.30258509299404568402` is treated as `double` with GNU extensions `-std=gnu89` but as `long double` with `-std=c89` (or `-std=c99`, this doesn't matter).



---

archive/issue_comments_331344.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-26T11:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331345.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-26T11:21:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331345",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331346.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-26T20:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331346",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331347.json:
```json
{
    "body": "Looks good to me and the bot is green. You talked about that before, how much time and effort would be needed to remove `lcalc` in your opinion? You said `pari` could be used directly instead and `lcalc` is obviously just rotting away.",
    "created_at": "2017-09-26T20:17:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331347",
    "user": "https://github.com/kiwifb"
}
```

Looks good to me and the bot is green. You talked about that before, how much time and effort would be needed to remove `lcalc` in your opinion? You said `pari` could be used directly instead and `lcalc` is obviously just rotting away.



---

archive/issue_comments_331348.json:
```json
{
    "body": "Replying to [comment:18 fbissey]:\n> how much time and effort would be needed to remove `lcalc` in your opinion?\n\n\nI think it would be a good project for https://pari.math.u-bordeaux.fr/Events/PARI2018/",
    "created_at": "2017-09-27T09:02:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331348",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:18 fbissey]:
> how much time and effort would be needed to remove `lcalc` in your opinion?


I think it would be a good project for https://pari.math.u-bordeaux.fr/Events/PARI2018/



---

archive/issue_comments_331349.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-29T22:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331349",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_331350.json:
```json
{
    "body": "Reviewer name...",
    "created_at": "2017-09-29T22:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331350",
    "user": "https://github.com/vbraun"
}
```

Reviewer name...



---

archive/issue_comments_331351.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-09-30T00:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331351",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_331352.json:
```json
{
    "body": "Merge failure",
    "created_at": "2017-10-04T19:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331352",
    "user": "https://github.com/vbraun"
}
```

Merge failure



---

archive/issue_comments_331353.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-04T19:26:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331353",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_331354.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-05T08:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331354",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331355.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-05T08:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331355",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_331356.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-07T10:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331356",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_331357.json:
```json
{
    "body": "This breaks on GCC 6.3.0 and 7.2.1, but works on older versions:\n\n```\n[  1/318] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/buildbot/slave/sage_git/build/local/include -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/home/buildbot/slave/sage_git/build/src -I/home/buildbot/slave/sage_git/build/src/sage/ext -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -c build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp -o build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/linbox/linbox_flint_interface.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -U_LB_DEBUG -DDISABLE_COMMENTATOR -Wall -DNDEBUG -UFFLASFFPACK_DEBUG -D__FFLASFFPACK_HAVE_CBLAS -g -O2 -DFFLAS_COMPILED -DFFPACK_COMPILED -fPIC -mmmx -mpopcnt -msse -msse2 -msse3 -msse4.1 -msse4.2 -mavx -mavx2 -mfma -mbmi -mbmi2 -mfpmath=sse -fabi-version=6 -I/home/buildbot/slave/sage_git/build/local/include/linbox -I/home/buildbot/slave/sage_git/build/local/include -std=c++11\nIn file included from /usr/include/c++/6/bits/move.h:57:0,\n                 from /usr/include/c++/6/bits/nested_exception.h:40,\n                 from /usr/include/c++/6/exception:173,\n                 from /usr/include/c++/6/ios:39,\n                 from /usr/include/c++/6/ostream:38,\n                 from /usr/include/c++/6/iostream:39,\n                 from /home/buildbot/slave/sage_git/build/local/include/linbox/linbox-config.h:45,\n                 from build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp:655:\n/usr/include/c++/6/type_traits: In instantiation of \u2018struct std::make_unsigned<__int128 unsigned>\u2019:\n/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from \u2018class Givaro::Modular<long int, __int128 unsigned>\u2019\n/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:32:36:   required from here\n/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type \u2018class std::__make_unsigned_selector<__int128 unsigned, false, false>\u2019\n     { typedef typename __make_unsigned_selector<_Tp>::__type type; };\n                                                              ^~~~\n/usr/include/c++/6/type_traits:1788:11: note: declaration of \u2018class std::__make_unsigned_selector<__int128 unsigned, false, false>\u2019\n     class __make_unsigned_selector;\n           ^~~~~~~~~~~~~~~~~~~~~~~~\n/usr/include/c++/6/type_traits: In instantiation of \u2018struct std::make_unsigned<__int128>\u2019:\n/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from \u2018class Givaro::Modular<long int, __int128>\u2019\n/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:36:35:   required from here\n/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type \u2018class std::__make_unsigned_selector<__int128, false, false>\u2019\n     { typedef typename __make_unsigned_selector<_Tp>::__type type; };\n                                                              ^~~~\n```",
    "created_at": "2017-10-07T10:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331357",
    "user": "https://github.com/vbraun"
}
```

This breaks on GCC 6.3.0 and 7.2.1, but works on older versions:

```
[  1/318] gcc -fno-strict-aliasing -g -O2 -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -fPIC -I/home/buildbot/slave/sage_git/build/local/include -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -I/home/buildbot/slave/sage_git/build/local/lib/python2.7/site-packages/numpy/core/include -I/home/buildbot/slave/sage_git/build/src -I/home/buildbot/slave/sage_git/build/src/sage/ext -Ibuild/cythonized -I/home/buildbot/slave/sage_git/build/local/include/python2.7 -c build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp -o build/temp.linux-x86_64-2.7/build/cythonized/sage/libs/linbox/linbox_flint_interface.o -fno-strict-aliasing -DCYTHON_CLINE_IN_TRACEBACK=1 -U_LB_DEBUG -DDISABLE_COMMENTATOR -Wall -DNDEBUG -UFFLASFFPACK_DEBUG -D__FFLASFFPACK_HAVE_CBLAS -g -O2 -DFFLAS_COMPILED -DFFPACK_COMPILED -fPIC -mmmx -mpopcnt -msse -msse2 -msse3 -msse4.1 -msse4.2 -mavx -mavx2 -mfma -mbmi -mbmi2 -mfpmath=sse -fabi-version=6 -I/home/buildbot/slave/sage_git/build/local/include/linbox -I/home/buildbot/slave/sage_git/build/local/include -std=c++11
In file included from /usr/include/c++/6/bits/move.h:57:0,
                 from /usr/include/c++/6/bits/nested_exception.h:40,
                 from /usr/include/c++/6/exception:173,
                 from /usr/include/c++/6/ios:39,
                 from /usr/include/c++/6/ostream:38,
                 from /usr/include/c++/6/iostream:39,
                 from /home/buildbot/slave/sage_git/build/local/include/linbox/linbox-config.h:45,
                 from build/cythonized/sage/libs/linbox/linbox_flint_interface.cpp:655:
/usr/include/c++/6/type_traits: In instantiation of ‘struct std::make_unsigned<__int128 unsigned>’:
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from ‘class Givaro::Modular<long int, __int128 unsigned>’
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:32:36:   required from here
/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type ‘class std::__make_unsigned_selector<__int128 unsigned, false, false>’
     { typedef typename __make_unsigned_selector<_Tp>::__type type; };
                                                              ^~~~
/usr/include/c++/6/type_traits:1788:11: note: declaration of ‘class std::__make_unsigned_selector<__int128 unsigned, false, false>’
     class __make_unsigned_selector;
           ^~~~~~~~~~~~~~~~~~~~~~~~
/usr/include/c++/6/type_traits: In instantiation of ‘struct std::make_unsigned<__int128>’:
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.h:46:60:   required from ‘class Givaro::Modular<long int, __int128>’
/home/buildbot/slave/sage_git/build/local/include/givaro/modular-int64.inl:36:35:   required from here
/usr/include/c++/6/type_traits:1831:62: error: invalid use of incomplete type ‘class std::__make_unsigned_selector<__int128, false, false>’
     { typedef typename __make_unsigned_selector<_Tp>::__type type; };
                                                              ^~~~
```



---

archive/issue_comments_331358.json:
```json
{
    "body": "I get it too with gcc 6.4.0.",
    "created_at": "2017-10-07T11:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331358",
    "user": "https://github.com/kiwifb"
}
```

I get it too with gcc 6.4.0.



---

archive/issue_comments_331359.json:
```json
{
    "body": "OK, I diagnosed this.\n\nLinbox really needs GNU extensions, it compiles with `-std=gnu++11` but not with `-std=c++11`.\n\nWhen building Linbox, it checks for C++11 support. With GCC 5.x, a flag is required to add C++11 support. By default, `configure` tries `-std=gnu++11` first. So, the `-std=gnu++11` flag is added to the `CXXFLAGS` of Linbox, which is propagated to the Sage library using the pkgconfig mechanism.\n\nWhen building Linbox with GCC 6 or 7, the default is `-std=gnu++11` (or `-std=gnu++14` but that difference doesn't matter here). So Linbox doesn't add any `-std` flag to `CXXFLAGS`. Now this ticket sees that no `-std` flag is added, so it adds `-std=c++11` which breaks Linbox.",
    "created_at": "2017-10-13T10:06:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331359",
    "user": "https://github.com/jdemeyer"
}
```

OK, I diagnosed this.

Linbox really needs GNU extensions, it compiles with `-std=gnu++11` but not with `-std=c++11`.

When building Linbox, it checks for C++11 support. With GCC 5.x, a flag is required to add C++11 support. By default, `configure` tries `-std=gnu++11` first. So, the `-std=gnu++11` flag is added to the `CXXFLAGS` of Linbox, which is propagated to the Sage library using the pkgconfig mechanism.

When building Linbox with GCC 6 or 7, the default is `-std=gnu++11` (or `-std=gnu++14` but that difference doesn't matter here). So Linbox doesn't add any `-std` flag to `CXXFLAGS`. Now this ticket sees that no `-std` flag is added, so it adds `-std=c++11` which breaks Linbox.



---

archive/issue_comments_331360.json:
```json
{
    "body": "It's actually slightly more complicated than that: Linbox actually never stores `-std=gnu++11` in its pkgconfig cflags. The `-std=gnu++11` was being picked up by fflas-ffpack.",
    "created_at": "2017-10-13T12:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331360",
    "user": "https://github.com/jdemeyer"
}
```

It's actually slightly more complicated than that: Linbox actually never stores `-std=gnu++11` in its pkgconfig cflags. The `-std=gnu++11` was being picked up by fflas-ffpack.



---

archive/issue_comments_331361.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-10-13T13:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331361",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_331362.json:
```json
{
    "body": "Replying to [comment:28 jdemeyer]:\n> It's actually slightly more complicated than that: Linbox actually never stores `-std=gnu++11` in its pkgconfig cflags. The `-std=gnu++11` was being picked up by fflas-ffpack.\n\n\nIt is actually tricky to do because the m4 macros that looks for support for C99 and C++11/14 do not return  a flag. They return a new value for CC/CXX, the needed flag, if any,  is not easily accessible from the macro.",
    "created_at": "2017-10-14T00:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331362",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:28 jdemeyer]:
> It's actually slightly more complicated than that: Linbox actually never stores `-std=gnu++11` in its pkgconfig cflags. The `-std=gnu++11` was being picked up by fflas-ffpack.


It is actually tricky to do because the m4 macros that looks for support for C99 and C++11/14 do not return  a flag. They return a new value for CC/CXX, the needed flag, if any,  is not easily accessible from the macro.



---

archive/issue_comments_331363.json:
```json
{
    "body": "To make it even worse: Givaro (which is the real culprint here) uses `std=gnu++11` with gcc but switches to `std=c++11` when compiling with clang. This is due to a sequence of bugs as explained there:\nhttps://github.com/linbox-team/givaro/issues/47\n\nSurprinsingly, `--std=c++11` does not make the compilation fail with clang.\nTherefore, one should be carefull not to \"force\" the `gnu++11` flag, although in the context of sage compilation, it may be a safe assumption that we are using gcc.\n\nI take note that Givaro/FFLAS-FFPACK/LinBox should be more consistent in the c++11 flag that they expose in their .pc file. Since LinBox depends on FFLAS which depends on Givaro, I would preferably only state the c++11 flag in Givaro.\nHowever, I was told [1] not to pollute the CFLAGS field in pkgconfig with anything else than preprocessor flags (-I and -D and -U).\n\n[1] https://github.com/linbox-team/givaro/pull/46",
    "created_at": "2017-10-16T14:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331363",
    "user": "https://github.com/ClementPernet"
}
```

To make it even worse: Givaro (which is the real culprint here) uses `std=gnu++11` with gcc but switches to `std=c++11` when compiling with clang. This is due to a sequence of bugs as explained there:
https://github.com/linbox-team/givaro/issues/47

Surprinsingly, `--std=c++11` does not make the compilation fail with clang.
Therefore, one should be carefull not to "force" the `gnu++11` flag, although in the context of sage compilation, it may be a safe assumption that we are using gcc.

I take note that Givaro/FFLAS-FFPACK/LinBox should be more consistent in the c++11 flag that they expose in their .pc file. Since LinBox depends on FFLAS which depends on Givaro, I would preferably only state the c++11 flag in Givaro.
However, I was told [1] not to pollute the CFLAGS field in pkgconfig with anything else than preprocessor flags (-I and -D and -U).

[1] https://github.com/linbox-team/givaro/pull/46



---

archive/issue_comments_331364.json:
```json
{
    "body": "I'm getting this on one particual 32-bit buildbot:\n\n```\n**********************************************************************\nFile \"src/sage/libs/lcalc/lcalc_Lfunction.pyx\", line 197, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\nFailed example:\n    L.hardy_z_function(2.1).imag().abs() < 1.0e-16\nExpected:\n    True\nGot:\n    False\n**********************************************************************\n1 item had failures:\n   1 of  15 in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function\n    [103 tests, 1 failure, 1.06 s]\n----------------------------------------------------------------------\n```\nActual return value is 2.11895733177441e-16. Can you also switch that to # abs tol for better doctest diagnostics?",
    "created_at": "2017-10-29T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331364",
    "user": "https://github.com/vbraun"
}
```

I'm getting this on one particual 32-bit buildbot:

```
**********************************************************************
File "src/sage/libs/lcalc/lcalc_Lfunction.pyx", line 197, in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
Failed example:
    L.hardy_z_function(2.1).imag().abs() < 1.0e-16
Expected:
    True
Got:
    False
**********************************************************************
1 item had failures:
   1 of  15 in sage.libs.lcalc.lcalc_Lfunction.Lfunction.hardy_z_function
    [103 tests, 1 failure, 1.06 s]
----------------------------------------------------------------------
```
Actual return value is 2.11895733177441e-16. Can you also switch that to # abs tol for better doctest diagnostics?



---

archive/issue_comments_331365.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-10-29T22:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331365",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_331366.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-10-30T13:38:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331366",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_331367.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-10-30T13:38:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331367",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_331368.json:
```json
{
    "body": "thanks!",
    "created_at": "2017-10-30T14:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331368",
    "user": "https://github.com/vbraun"
}
```

thanks!



---

archive/issue_comments_331369.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-30T14:22:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331369",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_331370.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-11-01T18:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23682#issuecomment-331370",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060876.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-11-01T18:07:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23682",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23682#event-60876"
}
```
