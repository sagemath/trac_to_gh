# Issue 27908: Crystal on Semistandard Set Valued Tableaux

Issue created by migration from https://trac.sagemath.org/ticket/28145

Original creator: wpoh

Original creation time: 2019-07-09 16:34:57

CC:  @jdmeza tscrim @opechenik aschilling bsalisbury1 darij

Keywords: fpsac2019

Implementation of semistandard set-valued tableaux and their type A crystal structure as described by Monical, Pechenik and Scrimshaw, see â€‹https://arxiv.org/abs/1807.03294.


---

Comment by git created at 2019-07-10 11:58:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-10 19:54:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-10 20:36:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-11 08:07:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2019-07-11 09:06:23

some details:

* This

```
Returns the excess statistic for self
```

should be (no s and a final dot)

```
Return the excess statistic for ``self``.
```

Same for "Determines", "Initializes", etc

* Always have an empty line after `EXAMPLES::`

* Comparison to None should be `right is not None`, same for "below"


---

Comment by opechenik created at 2019-07-11 11:53:30

New commits:


---

Comment by git created at 2019-07-11 13:22:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by opechenik created at 2019-07-11 13:37:27

New commits:


---

Comment by git created at 2019-07-11 16:20:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by opechenik created at 2019-07-11 16:26:20

New commits:


---

Comment by aschilling created at 2019-07-11 20:39:43

Let me know when the patch is ready for review!


---

Comment by wpoh created at 2019-07-12 11:11:15

New commits:


---

Comment by tscrim created at 2019-07-14 07:14:18

Some quick notes:

`SemistandardSetValuedTableaux` is *not* a factory class, it is an abstract base class (ABC) that also handles dispatching to the appropriate parent class. However, this should not be stated in the documentation as this is an implementation detail.

I think we should split the `SemistandardSetValuedTableau(x)` classes into a separate file. The `tableau.py` is already quite big and this is just dependent on those classes.

The `SetValuedTableaux` class should be named consistently with `Semistandard` added (explicit is better than implicit; plus we can be more loose with naming rules in papers as they are more localized). Also, I think it would be better served just being in the corresponding tableau file.

It probably is better to have the crystal just be a parent in the SVT hierarchy corresponding to a fixed shape (with possibly a max entry defined). That way you do not effectively have two such parents, but you probably need a warning saying the output of weight is slightly different than the others (although it typically behaves the same).

Remember that by the time it gets to `check`, the input should already be standardized (so checking `tuple` can be applied should have already been done).


---

Comment by aschilling created at 2019-07-14 22:37:33

I would suggest to follow a similar structure as Kirill Paramonov did for the shifted primed tableaux and crystal structure on it. He put all his code for these tableaux in the file shifted_primed_tableau.py in the combinat folder and created the corresponding crystal.


---

Comment by git created at 2019-07-20 18:32:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wpoh created at 2019-07-20 18:45:34

Replying to [comment:23 tscrim]:
> I think we should split the `SemistandardSetValuedTableau(x)` classes into a separate file. The `tableau.py` is already quite big and this is just dependent on those classes.
> 
> The `SetValuedTableaux` class should be named consistently with `Semistandard` added (explicit is better than implicit; plus we can be more loose with naming rules in papers as they are more localized). Also, I think it would be better served just being in the corresponding tableau file.
> 
> It probably is better to have the crystal just be a parent in the SVT hierarchy corresponding to a fixed shape (with possibly a max entry defined). That way you do not effectively have two such parents, but you probably need a warning saying the output of weight is slightly different than the others (although it typically behaves the same).

`SemistandardSetValuedTableau(x)` classes are now in one file (see semistandard_set_valued_tableau.py) and the crystal element inherits from `SemistandardSetValuedTableau`. Probably this is not the best way, because as you said, output of weight() may be different from those of crystal elements (in case one wishes to work in the weight lattice). I welcome suggestion or improvement on how to access both weight outputs from tableau and crystal element.

Most of the required code should be up; working on documentation, tests and cleanup soon. Do tell if other features need to be in this implementation.


---

Comment by tscrim created at 2019-07-21 07:15:26

Replying to [comment:26 wpoh]:
> Replying to [comment:23 tscrim]:
> > I think we should split the `SemistandardSetValuedTableau(x)` classes into a separate file. The `tableau.py` is already quite big and this is just dependent on those classes.
> > 
> > The `SetValuedTableaux` class should be named consistently with `Semistandard` added (explicit is better than implicit; plus we can be more loose with naming rules in papers as they are more localized). Also, I think it would be better served just being in the corresponding tableau file.
> > 
> > It probably is better to have the crystal just be a parent in the SVT hierarchy corresponding to a fixed shape (with possibly a max entry defined). That way you do not effectively have two such parents, but you probably need a warning saying the output of weight is slightly different than the others (although it typically behaves the same).
> 
> `SemistandardSetValuedTableau(x)` classes are now in one file (see semistandard_set_valued_tableau.py) and the crystal element inherits from `SemistandardSetValuedTableau`. Probably this is not the best way, because as you said, output of weight() may be different from those of crystal elements (in case one wishes to work in the weight lattice). I welcome suggestion or improvement on how to access both weight outputs from tableau and crystal element.

For the crystal elements, I think it will be faster to compute the weight by definition -- e.g., (#1s, #2s, ...) -- rather than using the generic crystals code. This also allows you to document the difference. As I mentioned, the elements of the ambient space behave in the same way as the list for item lookup, but unfortunately not for iteration.

Actually, another way out of this is just to make all of the tableaux classes a crystal. We do have `['A', NN]` for type A<sub>+oo</sub>. It will be different than for the usual tableaux, but I think that inconsistency is less surprising and easier to document.

For the class names, you can remove the `size_inf` part as the naming convention for tableaux (among others) is just adding onto the name the things which are finite/specified. Although perhaps that is a problem for the `module_generators`...maybe that could be a `Family` instead of a tuple?

This is bad:

```
        SemistandardSetValuedTableaux.__init__(self,max_entry=max_entry,category=ClassicalCrystals())
        self._shape = p
        self._cartan_type = CartanType(['A', max_entry-1])
        self.Element = CrystalElementSemistandardSetValuedTableau
```

The correct element is not created because all of the `Parent.__init__` stuff is done with the wrong `Element`, so `self.element_class` is not a subclass of `self.Element`. Just set `Element` as a normal class-level attribute.

It would be good to have both `crowding` and `uncrowding` maps accessible. I would make them *also* methods of `SemistandardTableau` and `SemistandardSetValuedTableau`, respectively.


---

Comment by git created at 2019-08-12 08:32:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-08-19 03:27:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by wpoh created at 2019-08-19 03:32:13

Good news: Based on Travis's suggestion (thanks Travis!) for iterating over countably many iterators (each generating countably many tableaux), the iterators for all semistandard set-valued tableaux works now.

Not so good news: The following tests are failing, and I still need to figure them out.


```
wencin@wencin--VirtualBox2:~/sage$ sage -t src/sage/combinat/semistandard_set_valued_tableau.py 
too few successful tests, not using stored timings
Running doctests with ID 2019-08-18-20-23-59-4aa7d8db.
Git branch: t/28145/crystal_on_semistandard_set_valued_tableaux
Using --optional=build,ccache,dochtml,dot2tex,memlimit,mpir,python2,sage
Doctesting 1 file.
sage -t src/sage/combinat/semistandard_set_valued_tableau.py
**********************************************************************
File "src/sage/combinat/semistandard_set_valued_tableau.py", line 1393, in sage.combinat.semistandard_set_valued_tableau.SemistandardSetValuedTableaux_shape.__init__
Failed example:
    TestSuite(SemistandardSetValuedTableaux([])).run()
Expected nothing
Got:
      Failure in _test_stembridge_local_axioms:
      Traceback (most recent call last):
        File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
          test_method(tester=tester)
        File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/categories/regular_crystals.py", line 749, in _test_stembridge_local_axioms
          for (i,j) in Subsets(index_set, 2):
        File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/combinat/subset.py", line 757, in __iter__
          for x in self._fast_iterator():
        File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/combinat/subset.py", line 740, in _fast_iterator
          return itertools.combinations(self._s, self._k)
        File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py", line 485, in __len__
          raise NotImplementedError('infinite set')
      NotImplementedError: infinite set
      ------------------------------------------------------------
      The following tests failed: _test_stembridge_local_axioms
    Failure in _test_elements
    Failure in _test_stembridge_local_axioms:
    Traceback (most recent call last):
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 296, in run
        test_method(tester=tester)
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/categories/regular_crystals.py", line 313, in _test_stembridge_local_axioms
        goodness = x._test_stembridge_local_axioms(index_set, verbose)
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/categories/regular_crystals.py", line 749, in _test_stembridge_local_axioms
        for (i,j) in Subsets(index_set, 2):
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/combinat/subset.py", line 757, in __iter__
        for x in self._fast_iterator():
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/combinat/subset.py", line 740, in _fast_iterator
        return itertools.combinations(self._s, self._k)
      File "/home/wencin/sage/local/lib/python2.7/site-packages/sage/categories/enumerated_sets.py", line 485, in __len__
        raise NotImplementedError('infinite set')
    NotImplementedError: infinite set
    ------------------------------------------------------------
    The following tests failed: _test_elements, _test_stembridge_local_axioms
**********************************************************************
1 item had failures:
   1 of   4 in sage.combinat.semistandard_set_valued_tableau.SemistandardSetValuedTableaux_shape.__init__
    [301 tests, 1 failure, 4.91 s]
----------------------------------------------------------------------
sage -t src/sage/combinat/semistandard_set_valued_tableau.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 5.5 seconds
    cpu time: 2.2 seconds
    cumulative wall time: 4.9 seconds

```



---

Comment by tscrim created at 2019-08-19 04:04:19

The problem is that the Stembridge local axioms test assumes that the index set is finite. This will be the first implementation of a type A<sub>oo</sub> crystal, so we are running into these little issues. So one option is to just disable the test, but I think we can easily fix it by making this change:

```diff
-            if index_set is None: index_set=self.index_set()
+            if index_set is None:
+                index_set=self.index_set()
+                if index_set in Sets().Infinite():
+                    it = iter(index_set)
+                    index_set = [it.next() for _ in range(10)]
```

that way we get the first 10 elements. The other option would be to get 10 random elements.
A final option would be to use `from sage.misc.misc import some_tuples` and throw out all of the pairs where `i == j`, that is

```diff
-            for (i,j) in Subsets(index_set, 2):
+            from sage.misc.misc import some_tuples
+            for i,j in some_tuples(index_set, 2, tester._max_runs):
+                if i == j:
+                    continue
+                # Now do the rest of the test
```



---

Comment by aschilling created at 2019-08-19 04:25:36

Replying to [comment:31 tscrim]:
> The problem is that the Stembridge local axioms test assumes that the index set is finite. This will be the first implementation of a type A<sub>oo</sub> crystal, so we are running into these little issues. 

ShiftedPrimedTableaux also contains an implementation of a type A<sub>oo</sub> crystal!


---

Comment by tscrim created at 2019-08-19 05:32:37

Replying to [comment:32 aschilling]:
> Replying to [comment:31 tscrim]:
> > The problem is that the Stembridge local axioms test assumes that the index set is finite. This will be the first implementation of a type A<sub>oo</sub> crystal, so we are running into these little issues. 
> 
> ShiftedPrimedTableaux also contains an implementation of a type A<sub>oo</sub> crystal!

I probably forgot about that. Yet, the A<sub>oo</sub> crystal there did not have `TestSuite(SPT).run()` call, so this was not previously caught.


---

Comment by git created at 2019-12-27 02:35:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2019-12-27 16:46:39

`self.parent().parent().Element` is bad because you are not using the actual element class from the category framework. Instead you should use `a_parent_obj.element_class(foo)`. Also, your `EXAMPLES::` should have a blankline after them and there is a merge conflict with the latest beta (likely trivial).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-04-14 19:41:51

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
