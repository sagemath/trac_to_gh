# Issue 23409: py3 rich comparison for modules

archive/issues_023409.json:
```json
{
    "body": "CC:  tscrim jdemeyer jhpalmieri\n\nas another mini-step in the direction of python3\n\nIssue created by migration from https://trac.sagemath.org/ticket/23646\n\n",
    "created_at": "2017-08-18T15:26:16Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "title": "py3 rich comparison for modules",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23409",
    "user": "chapoton"
}
```
CC:  tscrim jdemeyer jhpalmieri

as another mini-step in the direction of python3

Issue created by migration from https://trac.sagemath.org/ticket/23646





---

archive/issue_comments_327599.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-08-18T15:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327599",
    "user": "chapoton"
}
```

New commits:



---

archive/issue_comments_327600.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-08-18T15:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327600",
    "user": "chapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_327601.json:
```json
{
    "body": "one failing doctest   `:(`",
    "created_at": "2017-08-18T20:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327601",
    "user": "chapoton"
}
```

one failing doctest   `:(`



---

archive/issue_comments_327602.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-08-18T20:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327602",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_327603.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-19T06:44:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327603",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327604.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-08-19T06:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327604",
    "user": "chapoton"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_327605.json:
```json
{
    "body": "should be fixed now",
    "created_at": "2017-08-19T06:47:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327605",
    "user": "chapoton"
}
```

should be fixed now



---

archive/issue_comments_327606.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2017-08-19T09:52:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327606",
    "user": "chapoton"
}
```

green bot, please review



---

archive/issue_comments_327607.json:
```json
{
    "body": "Why this change:\n\n```diff\n@@ -49,7 +49,7 @@ V_{d-1}`. In the above example, this means that\n \n That is::\n \n-    sage: V.get_degree(0) == V\n+    sage: V.get_degree(0) == V.span([r1,r2,r3])\n     True\n     sage: V.get_degree(1) == V.span([r1, r2])\n     True\n```\n\nI don't fundamentally disagree with it, but I am just wondering if it was necessary to make the doctest pass. If it is just for clarity, then positive review.",
    "created_at": "2017-08-19T17:10:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327607",
    "user": "tscrim"
}
```

Why this change:

```diff
@@ -49,7 +49,7 @@ V_{d-1}`. In the above example, this means that
 
 That is::
 
-    sage: V.get_degree(0) == V
+    sage: V.get_degree(0) == V.span([r1,r2,r3])
     True
     sage: V.get_degree(1) == V.span([r1, r2])
     True
```

I don't fundamentally disagree with it, but I am just wondering if it was necessary to make the doctest pass. If it is just for clarity, then positive review.



---

archive/issue_comments_327608.json:
```json
{
    "body": "Sadly, this change was necessary to make the doctest pass. Otherwise, we are comparing a filtered vector-space (V) and a bare vector-space V.get_degree(0). And they are no longer considered to be equal. \n\nMaybe one can consider that the doctest did pass, but should not have. Otherwise, one needs to restore the old behaviour somehow.",
    "created_at": "2017-08-19T17:49:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327608",
    "user": "chapoton"
}
```

Sadly, this change was necessary to make the doctest pass. Otherwise, we are comparing a filtered vector-space (V) and a bare vector-space V.get_degree(0). And they are no longer considered to be equal. 

Maybe one can consider that the doctest did pass, but should not have. Otherwise, one needs to restore the old behaviour somehow.



---

archive/issue_comments_327609.json:
```json
{
    "body": "I see. I am slightly surprised the result did change. Anyways, now the question becomes do we want a filtered (or graded) version of an object to compare equal to its non-filtered (resp. graded) version. My thought is no to differentiate the extra structure, but there is a case to be made that it should be in the category with lesser structure (similar to how a coercion equality works).",
    "created_at": "2017-08-19T18:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327609",
    "user": "tscrim"
}
```

I see. I am slightly surprised the result did change. Anyways, now the question becomes do we want a filtered (or graded) version of an object to compare equal to its non-filtered (resp. graded) version. My thought is no to differentiate the extra structure, but there is a case to be made that it should be in the category with lesser structure (similar to how a coercion equality works).



---

archive/issue_comments_327610.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-08-20T07:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327610",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_327611.json:
```json
{
    "body": "In fact, the doctest\n\n```\nV.get_degree(0) == V\n```\n\nstill passes (is True) but the opposite comparison\n\n```\nV == V.get_degree(0)\n```\n\nis False. I do not know if this was the existing behaviour, but probably. This is because the `__eq__` for free module accepts everything that acts as a free module, whereas the `__eq__` for filtered modules only accepts filtered modules.\n\nI think (but this should be checked) that we are not changing the current behaviour.",
    "created_at": "2017-08-20T07:21:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327611",
    "user": "chapoton"
}
```

In fact, the doctest

```
V.get_degree(0) == V
```

still passes (is True) but the opposite comparison

```
V == V.get_degree(0)
```

is False. I do not know if this was the existing behaviour, but probably. This is because the `__eq__` for free module accepts everything that acts as a free module, whereas the `__eq__` for filtered modules only accepts filtered modules.

I think (but this should be checked) that we are not changing the current behaviour.



---

archive/issue_comments_327612.json:
```json
{
    "body": "Vanilla sage:\n\n```\nsage: r1 = (1, 0, 5)\nsage: r2 = (0, 1, 2)\nsage: r3 = (1, 2, 1)\nsage: V = FilteredVectorSpace({0:[r1, r2, r3], 1:[r1, r2], 3:[r1]}) \nsage: V == V.get_degree(0)\nFalse\nsage: V.get_degree(0) == V\nTrue\n```\n",
    "created_at": "2017-08-20T16:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327612",
    "user": "chapoton"
}
```

Vanilla sage:

```
sage: r1 = (1, 0, 5)
sage: r2 = (0, 1, 2)
sage: r3 = (1, 2, 1)
sage: V = FilteredVectorSpace({0:[r1, r2, r3], 1:[r1, r2], 3:[r1]}) 
sage: V == V.get_degree(0)
False
sage: V.get_degree(0) == V
True
```




---

archive/issue_comments_327613.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-08-20T16:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327613",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_327614.json:
```json
{
    "body": "Thanks for looking into this (you actually just beat me to posting). I agree that it is not good behavior, but that should be something for a separate ticket (and possibly a sage-devel discussion).",
    "created_at": "2017-08-20T16:31:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327614",
    "user": "tscrim"
}
```

Thanks for looking into this (you actually just beat me to posting). I agree that it is not good behavior, but that should be something for a separate ticket (and possibly a sage-devel discussion).



---

archive/issue_comments_327615.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-26T09:57:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23409",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23409#issuecomment-327615",
    "user": "vbraun"
}
```

Resolution: fixed
