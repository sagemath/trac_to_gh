# Issue 23409: py3 rich comparison for modules

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2017-08-18 15:26:16

CC:  tscrim jdemeyer jhpalmieri

as another mini-step in the direction of python3


---

Comment by chapoton created at 2017-08-18 15:26:44

New commits:


---

Comment by chapoton created at 2017-08-18 15:26:44

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-08-18 20:10:02

one failing doctest   `:(`


---

Comment by chapoton created at 2017-08-18 20:10:02

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-08-19 06:44:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-08-19 06:47:39

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-08-19 06:47:39

should be fixed now


---

Comment by chapoton created at 2017-08-19 09:52:14

green bot, please review


---

Comment by tscrim created at 2017-08-19 17:10:18

Why this change:

```diff
`@``@` -49,7 +49,7 `@``@` V_{d-1}`. In the above example, this means that
 
 That is::
 
-    sage: V.get_degree(0) == V
+    sage: V.get_degree(0) == V.span([r1,r2,r3])
     True
     sage: V.get_degree(1) == V.span([r1, r2])
     True
```

I don't fundamentally disagree with it, but I am just wondering if it was necessary to make the doctest pass. If it is just for clarity, then positive review.


---

Comment by chapoton created at 2017-08-19 17:49:36

Sadly, this change was necessary to make the doctest pass. Otherwise, we are comparing a filtered vector-space (V) and a bare vector-space V.get_degree(0). And they are no longer considered to be equal. 

Maybe one can consider that the doctest did pass, but should not have. Otherwise, one needs to restore the old behaviour somehow.


---

Comment by tscrim created at 2017-08-19 18:07:59

I see. I am slightly surprised the result did change. Anyways, now the question becomes do we want a filtered (or graded) version of an object to compare equal to its non-filtered (resp. graded) version. My thought is no to differentiate the extra structure, but there is a case to be made that it should be in the category with lesser structure (similar to how a coercion equality works).


---

Comment by git created at 2017-08-20 07:17:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-08-20 07:21:11

In fact, the doctest

```
V.get_degree(0) == V
```

still passes (is True) but the opposite comparison

```
V == V.get_degree(0)
```

is False. I do not know if this was the existing behaviour, but probably. This is because the `__eq__` for free module accepts everything that acts as a free module, whereas the `__eq__` for filtered modules only accepts filtered modules.

I think (but this should be checked) that we are not changing the current behaviour.


---

Comment by chapoton created at 2017-08-20 16:29:13

Vanilla sage:

```
sage: r1 = (1, 0, 5)
sage: r2 = (0, 1, 2)
sage: r3 = (1, 2, 1)
sage: V = FilteredVectorSpace({0:[r1, r2, r3], 1:[r1, r2], 3:[r1]}) 
sage: V == V.get_degree(0)
False
sage: V.get_degree(0) == V
True
```



---

Comment by tscrim created at 2017-08-20 16:31:17

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-08-20 16:31:17

Thanks for looking into this (you actually just beat me to posting). I agree that it is not good behavior, but that should be something for a separate ticket (and possibly a sage-devel discussion).


---

Comment by vbraun created at 2017-08-26 09:57:57

Resolution: fixed
