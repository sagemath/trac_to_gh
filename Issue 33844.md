# Issue 33844: numpy 1.23.x, scipy 1.9.x

Issue created by migration from https://trac.sagemath.org/ticket/34081

Original creator: mkoeppe

Original creation time: 2022-06-25 19:20:58

CC:  dimpase arojas fbissey mjo

- https://numpy.org/doc/stable/release/1.23.0-notes.html# (released)
- https://scipy.github.io/devdocs/release.1.9.0.html (rc)
  - scipy.optimize.milp (HiGHS MIP solver)

Previous update: 
- #32423 Update numpy to 1.22.x, scipy 1.8.x, networkx 2.8.x


---

Comment by mkoeppe created at 2022-07-03 00:07:08

Last 10 new commits:


---

Comment by git created at 2022-07-03 00:32:56

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-07-03 01:27:13


```
[scipy-1.9.0rc1]       hook = backend.prepare_metadata_for_build_wheel
[scipy-1.9.0rc1]   AttributeError: module 'mesonpy' has no attribute 'prepare_metadata_for_build_wheel'
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1]   During handling of the above exception, another exception occurred:
[scipy-1.9.0rc1] 
[}}}


---

Comment by git created at 2022-07-03 01:34:41

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2022-07-03 17:37:55

Opened https://github.com/scipy/scipy/issues/16536 (BUG: 1.9.0rc1 fails to build on macOS when `CXX="g++ -std=gnu++11"`)


---

Comment by git created at 2022-07-03 18:13:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-03 18:14:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-03 18:17:19

Build goes almost through but ends with:

```
[scipy-1.9.0rc1] [1569/1573] Linking target scipy/spatial/_qhull.cpython-38-darwin.so
[scipy-1.9.0rc1] [1570/1573] Compiling C++ object scipy/interpolate/_rbfinterp_pythran.cpython-38-darwin.so.p/meson-generated_..__rbfinterp_pythran.cpp.o
[scipy-1.9.0rc1] [1571/1573] Linking target scipy/interpolate/_rbfinterp_pythran.cpython-38-darwin.so
[scipy-1.9.0rc1] [1572/1573] Compiling C++ object scipy/fft/_pocketfft/pypocketfft.cpython-38-darwin.so.p/pypocketfft.cxx.o
[scipy-1.9.0rc1] [1573/1573] Linking target scipy/fft/_pocketfft/pypocketfft.cpython-38-darwin.so
[scipy-1.9.0rc1] ninja: Entering directory `/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/build'
[scipy-1.9.0rc1] [1/2] Generating scipy/generate-version with a custom command
[scipy-1.9.0rc1] [2/2] Generating scipy/generate-config with a custom command
[scipy-1.9.0rc1] Installing scipy/__config__.py to /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install/usr/local/Cellar/python@3.8/3.8.13_1/bin/../Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages//scipy
```

<--- these directories are wrong

```
[scipy-1.9.0rc1] Installing scipy/version.py to /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install/usr/local/Cellar/python@3.8/3.8.13_1/bin/../Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages//scipy
[scipy-1.9.0rc1] Installing scipy/_lib/_ccallback_c.cpython-38-darwin.so to /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install/usr/local/Cellar/python@3.8/3.8.13_1/bin/../Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/scipy/_lib
[scipy-1.9.0rc1] Stripping target 'scipy/_lib/_ccallback_c.cpython-38-darwin.so'.
[scipy-1.9.0rc1] Could not strip file.
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] Stdout:
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] Stderr:
[scipy-1.9.0rc1] /Library/Developer/CommandLineTools/usr/bin/strip: error: symbols referenced by indirect symbol table entries that can't be stripped in: /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install/usr/local/Cellar/python@3.8/3.8.13_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/site-packages/scipy/_lib/_ccallback_c.cpython-38-darwin.so
[scipy-1.9.0rc1] _PyBytes_AsStringAndSize
[scipy-1.9.0rc1] _PyBytes_FromString
[...]
[scipy-1.9.0rc1] __Py_NoneStruct
[scipy-1.9.0rc1] __Py_TrueStruct
[scipy-1.9.0rc1] ___stack_chk_guard
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] + meson setup --native-file=/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-native-file.ini -Ddebug=false -Dstrip=true -Doptimization=2 --prefix=/usr/local/Cellar/python@3.8/3.8.13_1/bin/../Frameworks/Python.framework/Versions/3.8 /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/build
[scipy-1.9.0rc1] + meson compile
[scipy-1.9.0rc1] + meson install --destdir /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install
[scipy-1.9.0rc1] Traceback (most recent call last):
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pep517/in_process/_in_process.py", line 363, in <module>
[scipy-1.9.0rc1]     main()
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pep517/in_process/_in_process.py", line 345, in main
[scipy-1.9.0rc1]     json_out['return_val'] = hook(**hook_input['kwargs'])
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pep517/in_process/_in_process.py", line 261, in build_wheel
[scipy-1.9.0rc1]     return _build_backend().build_wheel(wheel_directory, config_settings,
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 837, in build_wheel
[scipy-1.9.0rc1]     return project.wheel(out).name
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 786, in wheel
[scipy-1.9.0rc1]     wheel = _WheelBuilder(self).build(self._install_plan, self._copy_files, self._build_dir)
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 318, in build
[scipy-1.9.0rc1]     self._project.build()  # ensure project is built
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 482, in build
[scipy-1.9.0rc1]     self._meson('install', '--destdir', os.fspath(self._install_dir))
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 430, in _meson
[scipy-1.9.0rc1]     return self._proc('meson', *args)
[scipy-1.9.0rc1]   File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/mesonpy/__init__.py", line 426, in _proc
[scipy-1.9.0rc1]     subprocess.check_call(list(args))
[scipy-1.9.0rc1]   File "/usr/local/Cellar/python@3.8/3.8.13_1/Frameworks/Python.framework/Versions/3.8/lib/python3.8/subprocess.py", line 364, in check_call
[scipy-1.9.0rc1]     raise CalledProcessError(retcode, cmd)
[scipy-1.9.0rc1] subprocess.CalledProcessError: Command '['meson', 'install', '--destdir', '/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/tmp/sage/build/scipy-1.9.0rc1/src/.mesonpy-bo77bwb4/install']' returned non-zero exit status 1.
[scipy-1.9.0rc1] * Getting dependencies for wheel...
[scipy-1.9.0rc1] * Building wheel...
[scipy-1.9.0rc1] 
[scipy-1.9.0rc1] ERROR Backend subprocess exited when trying to invoke build_wheel
```



---

Comment by mkoeppe created at 2022-07-03 18:34:27

That's https://github.com/scipy/scipy/issues/16446, https://github.com/FFY00/meson-python/pull/90


---

Comment by git created at 2022-07-03 18:47:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-03 18:49:53

That fixes it, and now I get

```
[scipy-1.9.0rc1] Successfully built scipy-1.9.0rc1-cp38-cp38-macosx_12_x86_64.whl
[scipy-1.9.0rc1] WARNING: Skipping scipy as it is not installed.
[scipy-1.9.0rc1] Using pip 22.1.2 from /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/lib/python3.8/site-packages/pip (python 3.8)
[scipy-1.9.0rc1] Looking in links: /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.8/var/lib/sage/wheels
[scipy-1.9.0rc1] ERROR: scipy-1.9.0rc1-cp38-cp38-macosx_12_x86_64.whl is not a supported wheel on this platform.
```



---

Comment by mkoeppe created at 2022-07-03 19:25:04

After renaming it from `...macosx_12...` to `...macosx_12_0...`, the wheel can be installed


---

Comment by mkoeppe created at 2022-07-03 19:33:58

That's now https://github.com/FFY00/meson-python/issues/91


---

Comment by git created at 2022-07-04 02:06:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-06 01:41:30

Replying to [comment:9 mkoeppe]:
> Opened https://github.com/scipy/scipy/issues/16536 (BUG: 1.9.0rc1 fails to build on macOS when `CXX="g++ -std=gnu++11"`)

Opened #34119 (`src/bin/sage-env`: Export `CXXCPP`)


---

Comment by git created at 2022-07-09 02:48:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-26 18:38:21

Replying to [comment:17 mkoeppe]:
> That's now https://github.com/FFY00/meson-python/issues/91

Reported as resolved in meson-python 0.8.0


---

Comment by git created at 2022-07-26 18:50:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-26 19:03:52

Indeed it creates a wheel with an acceptable filename now:

```
[scipy-1.9.0rc3]   Created wheel for scipy: filename=scipy-1.9.0rc3-cp39-cp39-macosx_12_0_x86_64.whl size=22657115 sha256=d2a44150f7bd42caf6610a06c9f4282430e4e8a119273fe42e9bea02d0aa0d10
```



---

Comment by mkoeppe created at 2022-07-26 23:48:54

mesonpy introduces a hidden dependency on `patchelf` on Linux systems
https://github.com/FFY00/meson-python/blob/865183e46a3ed434c0c347c1ca752aec1ce6fce9/mesonpy/__init__.py#L927


---

Comment by git created at 2022-07-27 01:13:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-27 01:43:11

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2022-07-27 16:27:23

On `debian-stretch-standard` (https://github.com/mkoeppe/sage/runs/7532141718?check_suite_focus=true)

```
  [patchelf-0.15.0]   g++ -std=gnu++11 -DPACKAGE_NAME=\"patchelf\" -DPACKAGE_TARNAME=\"patchelf\" -DPACKAGE_VERSION=\"0.15.0\" -DPACKAGE_STRING=\"patchelf\ 0.15.0\" -DPACKAGE_BUGREPORT=\"\" -DPACKAGE_URL=\"\" -DPACKAGE=\"patchelf\" -DVERSION=\"0.15.0\" -I.    -Wall -std=c++17 -D_FILE_OFFSET_BITS=64     -g -O2 -c -o patchelf.o patchelf.cc
  [patchelf-0.15.0]   patchelf.cc:29:20: fatal error: optional: No such file or directory
  [patchelf-0.15.0]    #include <optional>
  [patchelf-0.15.0]                       ^
```



---

Comment by mkoeppe created at 2022-07-27 16:31:49

This is a C++17 feature, https://stackoverflow.com/questions/38253971/std-optional-no-such-file-or-directory. On this platform, gcc is 6.3.0-18+deb9u1 and apparently does not have sufficient C++17 support


---

Comment by mkoeppe created at 2022-07-27 16:38:14

Opened https://github.com/NixOS/patchelf/issues/393


---

Comment by git created at 2022-07-27 17:44:02

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2022-07-27 22:15:38

On `debian-stretch-standard` (https://github.com/mkoeppe/sage/runs/7545914147?check_suite_focus=true)

```
Unpacking ninja-build (1.7.2-1) ...

 ...
 ERROR: Could not detect Ninja v1.8.2 or newer

  A full log can be found at /sage/local/var/lib/sage/venv-python3.10.5/var/tmp/sage/build/meson_python-0.8.0/src/.mesonpy-7_1ejlan/build/meson-logs/meson-log.txt
```



---

Comment by git created at 2022-07-27 22:27:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-29 21:28:03

I'll rebase this away from the numpy upgrade (#34110)


---

Comment by git created at 2022-07-29 22:03:29

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mkoeppe created at 2022-07-29 22:04:10

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-08-01 01:04:15

On 32bit, it builds a wheel that is named wrong

```
  [scipy-1.9.0rc3]   Using pip 22.1.2 from /sage/local/var/lib/sage/venv-python3.10.5/lib/python3.10/site-packages/pip (python 3.10)
  [scipy-1.9.0rc3]   Looking in links: /sage/local/var/lib/sage/venv-python3.10.5/var/lib/sage/wheels
  [scipy-1.9.0rc3]   ERROR: scipy-1.9.0rc3-cp310-cp310-linux_x86_64.whl is not a supported wheel on this platform.
```

https://github.com/mkoeppe/sage/runs/7599750782?check_suite_focus=true


---

Comment by mkoeppe created at 2022-08-01 01:25:47

Opened https://github.com/FFY00/meson-python/issues/123


---

Comment by mkoeppe created at 2022-08-01 01:30:20

After renaming the wheel file to `scipy-1.9.0rc3-cp310-cp310-linux_i686.whl`, it can be installed with `pip`, and 

```
$ file venv/lib/python3.10/site-packages/scipy/**/*.so 
venv/lib/python3.10/site-packages/scipy/_lib/_ccallback_c.cpython-310-i386-linux-gnu.so:              ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, BuildID[sha1]=7ea4f88eb1db30a2264fa6414e073f9d42cb90c4, not stripped
venv/lib/python3.10/site-packages/scipy/_lib/_fpumode.cpython-310-i386-linux-gnu.so:                  ELF 32-bit LSB shared object, Intel 80386, version 1 (SYSV), dynamically linked, BuildID[sha1]=f9ae2041983e2b111529320c4b6b25d6fc1cd4d1, not stripped
...
```

confirms that this is a correct 32-bit build.


---

Comment by mkoeppe created at 2022-08-01 01:51:51

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-08-02 22:28:09

Replying to [comment:29 mkoeppe]:
> mesonpy introduces a hidden dependency on `patchelf` on Linux systems
> https://github.com/FFY00/meson-python/blob/865183e46a3ed434c0c347c1ca752aec1ce6fce9/mesonpy/__init__.py#L927

see https://github.com/FFY00/meson-python/issues/125 (Only use and depend on patchelf if it is actually needed)


---

Comment by git created at 2022-08-03 00:00:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-03 00:00:45

Tested successfully with `tox -e docker-ubuntu-bionic-i386-standard-incremental -- scipy`


---

Comment by mkoeppe created at 2022-08-03 00:01:09

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-08-03 03:53:09

The build errors are all fixed, let's get this in


---

Comment by mkoeppe created at 2022-08-04 01:57:01

On `archlinux-standard` (https://github.com/mkoeppe/sage/runs/7659424080?check_suite_focus=true) I see 

```
 [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/csgraph/__init__.py", line 182, in <module>
  [sagemath_doc_html-none]   [plotting ]     from ._laplacian import laplacian
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/csgraph/_laplacian.py", line 7, in <module>
  [sagemath_doc_html-none]   [plotting ]     from scipy.sparse.linalg import LinearOperator
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/linalg/__init__.py", line 120, in <module>
  [sagemath_doc_html-none]   [plotting ]     from ._isolve import *
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/linalg/_isolve/__init__.py", line 4, in <module>
  [sagemath_doc_html-none]   [plotting ]     from .iterative import *
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/linalg/_isolve/iterative.py", line 9, in <module>
  [sagemath_doc_html-none]   [plotting ]     from . import _iterative
  [sagemath_doc_html-none]   [plotting ] ImportError: /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/linalg/_isolve/_iterative.cpython-310-x86_64-linux-gnu.so: undefined symbol: slamch_
  [sagemath_doc_html-none]   [plotting ] /sage/src/sage/plot/plot.py:docstring of sage.plot.plot.multi_graphics:59: WARNING: Exception occurred in plotting plot-50
```



---

Comment by mkoeppe created at 2022-08-04 04:51:08

Also on `gentoo-python3.9-standard` (https://github.com/mkoeppe/sage/runs/7659423834?check_suite_focus=true) during the docbuild I see these strange errors:

```
  [sagemath_doc_html-none]   [plotting ] /sage/src/sage/plot/plot.py:docstring of sage.plot.plot.multi_graphics:59: WARNING: Exception occurred in plotting plot-50
  [sagemath_doc_html-none]   [plotting ]  from /sage/src/doc/en/reference/plotting/sage/plot/plot.rst:
  [sagemath_doc_html-none]   [plotting ] Traceback (most recent call last):
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/scipy/__init__.py", line 134, in <module>
  [sagemath_doc_html-none]   [plotting ]     from scipy.__config__ import show as show_config
  [sagemath_doc_html-none]   [plotting ] ModuleNotFoundError: No module named 'scipy.__config__'
  [sagemath_doc_html-none]   [plotting ] The above exception was the direct cause of the following exception:
  [sagemath_doc_html-none]   [plotting ] Traceback (most recent call last):
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/matplotlib/sphinxext/plot_directive.py", line 517, in _run_code
  [sagemath_doc_html-none]   [plotting ]     exec(code, ns)
  [sagemath_doc_html-none]   [plotting ]   File "<string>", line 2, in <module>
  [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 410, in wrapper
  [sagemath_doc_html-none]   [plotting ]     return func(*args, **kwds)
  [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 410, in wrapper
  [sagemath_doc_html-none]   [plotting ]     return func(*args, **kwds)
  [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 491, in wrapper
  [sagemath_doc_html-none]   [plotting ]     return func(*args, **options)
  [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/plot/matrix_plot.py", line 565, in matrix_plot
  [sagemath_doc_html-none]   [plotting ]     import scipy.sparse as scipysparse
  [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/scipy/__init__.py", line 139, in <module>
  [sagemath_doc_html-none]   [plotting ]     raise ImportError(msg) from e
  [sagemath_doc_html-none]   [plotting ] ImportError: Error importing SciPy: you cannot import SciPy while
  [sagemath_doc_html-none]   [plotting ]         being in scipy source directory; please exit the SciPy source
  [sagemath_doc_html-none]   [plotting ]         tree first and relaunch your Python interpreter.
```



---

Comment by mkoeppe created at 2022-08-04 06:17:47

I've opened https://github.com/FFY00/meson-python/issues/127 for this failure on gentoo


---

Comment by git created at 2022-08-04 06:28:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2022-08-04 06:35:39

Replying to [comment:57 mkoeppe]:
>   [sagemath_doc_html-none]   [plotting ] ImportError: /sage/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/scipy/sparse/linalg/_isolve/_iterative.cpython-310-x86_64-linux-gnu.so: undefined symbol: slamch_

I suppose this is caused by our openblas not including lapack symbols. Our distro package is fine since we haven't switched to meson (yet)


---

Comment by arojas created at 2022-08-04 06:45:45

Replying to [comment:61 arojas]:
> I suppose this is caused by our openblas not including lapack symbols. Our distro package is fine since we haven't switched to meson (yet)

Indeed, building with -Dlapack=lapack fixes this when building the distro package with meson. Not sure how to fix this in sage.


---

Comment by git created at 2022-08-04 06:49:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-08-04 07:15:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-08-04 07:15:41

Changing status from needs_review to needs_work.


---

Comment by fbissey created at 2022-08-04 07:49:02

Replying to [comment:58 mkoeppe]:
> Also on `gentoo-python3.9-standard` (https://github.com/mkoeppe/sage/runs/7659423834?check_suite_focus=true) during the docbuild I see these strange errors:
> {{{
>   [sagemath_doc_html-none]   [plotting ] /sage/src/sage/plot/plot.py:docstring of sage.plot.plot.multi_graphics:59: WARNING: Exception occurred in plotting plot-50
>   [sagemath_doc_html-none]   [plotting ]  from /sage/src/doc/en/reference/plotting/sage/plot/plot.rst:
>   [sagemath_doc_html-none]   [plotting ] Traceback (most recent call last):
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/scipy/__init__.py", line 134, in <module>
>   [sagemath_doc_html-none]   [plotting ]     from scipy.__config__ import show as show_config
>   [sagemath_doc_html-none]   [plotting ] ModuleNotFoundError: No module named 'scipy.__config__'
>   [sagemath_doc_html-none]   [plotting ] The above exception was the direct cause of the following exception:
>   [sagemath_doc_html-none]   [plotting ] Traceback (most recent call last):
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/matplotlib/sphinxext/plot_directive.py", line 517, in _run_code
>   [sagemath_doc_html-none]   [plotting ]     exec(code, ns)
>   [sagemath_doc_html-none]   [plotting ]   File "<string>", line 2, in <module>
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 410, in wrapper
>   [sagemath_doc_html-none]   [plotting ]     return func(*args, **kwds)
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 410, in wrapper
>   [sagemath_doc_html-none]   [plotting ]     return func(*args, **kwds)
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/misc/decorators.py", line 491, in wrapper
>   [sagemath_doc_html-none]   [plotting ]     return func(*args, **options)
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/src/sage/plot/matrix_plot.py", line 565, in matrix_plot
>   [sagemath_doc_html-none]   [plotting ]     import scipy.sparse as scipysparse
>   [sagemath_doc_html-none]   [plotting ]   File "/sage/local/var/lib/sage/venv-python3.9/lib/python3.9/site-packages/scipy/__init__.py", line 139, in <module>
>   [sagemath_doc_html-none]   [plotting ]     raise ImportError(msg) from e
>   [sagemath_doc_html-none]   [plotting ] ImportError: Error importing SciPy: you cannot import SciPy while
>   [sagemath_doc_html-none]   [plotting ]         being in scipy source directory; please exit the SciPy source
>   [sagemath_doc_html-none]   [plotting ]         tree first and relaunch your Python interpreter.
> }}}

I just built sage-on-gentoo with scipy 1.9.0 without issue. It was with python 3.10 and ninja_build 1.10.2 though.


---

Comment by fbissey created at 2022-08-04 09:10:43

Getting ninja to 1.11.0 didn't bring any issues in sage-on-gentoo.


---

Comment by mkoeppe created at 2022-09-02 18:47:16

New versions: scipy 1.9.1, meson 0.63.1, per update in https://github.com/FFY00/meson-python/issues/127#issuecomment-1235798227


---

Comment by git created at 2022-09-02 21:41:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-02 21:41:57

The issue in comment:58 persists after these updates


---

Comment by git created at 2022-09-04 13:50:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-04 18:03:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-04 18:43:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-09 15:24:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 17:18:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 17:20:40

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-09-28 17:35:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 17:46:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 18:31:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-28 18:54:48

Upstream indicates new versions of meson-python and scipy will be coming within 1-2 weeks - https://github.com/FFY00/meson-python/issues/127#issuecomment-1261328442


---

Comment by git created at 2022-09-28 19:25:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 20:04:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-28 20:31:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-09-30 00:54:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-30 01:34:16

The bug in comment:15 is back with the update of `meson_python` to 0.9.0

```
[scipy-1.9.1] Using pip 22.2.2 from /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/pip (python 3.10)
[scipy-1.9.1] Looking in links: /Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/local/var/lib/sage/venv-python3.10/var/lib/sage/wheels
[scipy-1.9.1] ERROR: scipy-1.9.1-cp310-cp310-macosx_12_6_x86_64.whl is not a supported wheel on this platform.
```



---

Comment by git created at 2022-09-30 01:50:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-08 04:27:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-10-08 04:41:02

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2022-10-08 04:41:02

The update to 0.10.0 has fixed the problem in comment:90, https://github.com/FFY00/meson-python/issues/160


---

Comment by git created at 2022-10-09 18:24:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-10 03:15:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-10-10 03:33:18

The failure from comment:58 is still present after these updates


---

Comment by mkoeppe created at 2022-10-10 03:33:42

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2022-10-14 17:41:56

Actually, the update of meson fixed it, I made a mistake when testing it. I've closed the upstream issue https://github.com/FFY00/meson-python/issues/127


---

Comment by mkoeppe created at 2022-10-14 17:41:56

Changing status from needs_work to needs_review.


---

Comment by git created at 2022-10-17 17:20:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2022-10-17 17:56:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-18 01:07:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-10-18 04:00:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-10-19 19:58:10

Let's get this in please.


---

Comment by dimpase created at 2022-10-19 22:40:51

I presume $\pi$-meson, $\mu$-meson, etc to follow, but OK


---

Comment by dimpase created at 2022-10-19 22:40:51

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-10-19 22:43:05

Sure, when they are stable


---

Comment by vbraun created at 2022-10-24 20:27:11

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-10-24 20:27:11

Testsuite fails 

```
[meson_python-0.10.0] =================================== FAILURES ===================================
[meson_python-0.10.0] _______________________________ test_scipy_like ________________________________
[meson_python-0.10.0] 
[meson_python-0.10.0] wheel_scipy_like = PosixPath('/private/tmp/pytest-of-root/pytest-2/test0/mesonpy-test-445hpffx/mypkg-2.3.4-cp310-cp310-macosx_11_0_x86_64.whl')
[meson_python-0.10.0] 
[meson_python-0.10.0]     @pytest.mark.skipif(win_py37, reason='An issue with missing file extension')
[meson_python-0.10.0]     def test_scipy_like(wheel_scipy_like):
[meson_python-0.10.0]         # This test is meant to exercise features commonly needed by a regular
[meson_python-0.10.0]         # Python package for scientific computing or data science:
[meson_python-0.10.0]         #   - C and Cython extensions,
[meson_python-0.10.0]         #   - including generated code,
[meson_python-0.10.0]         #   - using `install_subdir`,
[meson_python-0.10.0]         #   - packaging data files with extensions not known to Meson
[meson_python-0.10.0]         artifact = wheel.wheelfile.WheelFile(wheel_scipy_like)
[meson_python-0.10.0]     
[meson_python-0.10.0]         expecting = {
[meson_python-0.10.0]             'mypkg-2.3.4.dist-info/METADATA',
[meson_python-0.10.0]             'mypkg-2.3.4.dist-info/RECORD',
[meson_python-0.10.0]             'mypkg-2.3.4.dist-info/WHEEL',
[meson_python-0.10.0]             'mypkg/__init__.py',
[meson_python-0.10.0]             'mypkg/__config__.py',
[meson_python-0.10.0]             f'mypkg/extmod{EXT_SUFFIX}',
[meson_python-0.10.0]             f'mypkg/cy_extmod{EXT_SUFFIX}',
[meson_python-0.10.0]         }
[meson_python-0.10.0]         # Meson master has a fix for `install_subdir` that is not present in
[meson_python-0.10.0]         # 0.63.2: https://github.com/mesonbuild/meson/pull/10765
[meson_python-0.10.0]         # A backport of the fix may land in 0.63.3, if so then remove the version
[meson_python-0.10.0]         # check here and add the two expected files unconditionally.
[meson_python-0.10.0]         if meson_version and meson_version >= '0.63.99':
[meson_python-0.10.0]             expecting |= {
[meson_python-0.10.0]                 'mypkg/submod/__init__.py',
[meson_python-0.10.0]                 'mypkg/submod/unknown_filetype.npq',
[meson_python-0.10.0]             }
[meson_python-0.10.0]         if os.name == 'nt':
[meson_python-0.10.0]             # Currently Meson is installing `.dll.a` (import libraries) next to
[meson_python-0.10.0]             # `.pyd` extension modules. Those are very small, so it's not a major
[meson_python-0.10.0]             # issue - just sloppy. For now, ensure we don't fail on those
[meson_python-0.10.0]             actual_files = wheel_contents(artifact)
[meson_python-0.10.0]             for item in expecting:
[meson_python-0.10.0]                 assert item in actual_files
[meson_python-0.10.0]         else:
[meson_python-0.10.0] >           assert wheel_contents(artifact) == expecting
[meson_python-0.10.0] E           AssertionError: assert {'mypkg-2.3.4...rwin.so', ...} == {'mypkg-2.3.4...rwin.so', ...}
[meson_python-0.10.0] E             Extra items in the left set:
[meson_python-0.10.0] E             'mypkg/submod/__init__.py'
[meson_python-0.10.0] E             'mypkg/submod/unknown_filetype.npq'
[meson_python-0.10.0] E             Use -v to get more diff
[meson_python-0.10.0] 
[meson_python-0.10.0] tests/test_wheel.py:123: AssertionError
[meson_python-0.10.0] ---------------------------- Captured stdout setup -----------------------------
[meson_python-0.10.0] + meson setup --native-file=/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-native-file.ini -Ddebug=false -Doptimization=2 --prefix=/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8 /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/build
[meson_python-0.10.0] The Meson build system
[meson_python-0.10.0] Version: 0.63.3
[meson_python-0.10.0] Source dir: /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like
[meson_python-0.10.0] Build dir: /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/build
[meson_python-0.10.0] Build type: native build
[meson_python-0.10.0] Project name: scipy-like
[meson_python-0.10.0] Project version: 2.3.4
[meson_python-0.10.0] C compiler for the host machine: gcc (clang 13.0.0 "Apple clang version 13.0.0 (clang-1300.0.29.30)")
[meson_python-0.10.0] C linker for the host machine: gcc ld64 711
[meson_python-0.10.0] Cython compiler for the host machine: cython (cython 0.29.32)
[meson_python-0.10.0] Host machine cpu family: x86_64
[meson_python-0.10.0] Host machine cpu: x86_64
[meson_python-0.10.0] Program python found: YES (/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/bin/python3)
[meson_python-0.10.0] Found pkg-config: /Users/buildbot-sage/worker/sage_git/build/local/bin/pkg-config (1.8.0)
[meson_python-0.10.0] Build targets in project: 3
[meson_python-0.10.0] 
[meson_python-0.10.0] scipy-like 2.3.4
[meson_python-0.10.0] 
[meson_python-0.10.0]   User defined options
[meson_python-0.10.0]     Native files: /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-native-file.ini
[meson_python-0.10.0]     debug       : false
[meson_python-0.10.0]     optimization: 2
[meson_python-0.10.0]     prefix      : /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8
[meson_python-0.10.0] 
[meson_python-0.10.0] Found ninja-1.11.0 at /Users/buildbot-sage/worker/sage_git/build/local/bin/ninja
[meson_python-0.10.0] + meson compile
[meson_python-0.10.0] [1/6] Generating mypkg/generate-config-file with a custom command
[meson_python-0.10.0] [2/6] Compiling C object mypkg/extmod.cpython-310-darwin.so.p/extmod.c.o
[meson_python-0.10.0] [3/6] Linking target mypkg/extmod.cpython-310-darwin.so
[meson_python-0.10.0] [4/6] Compiling Cython source /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/mypkg/cy_extmod.pyx
[meson_python-0.10.0] [5/6] Compiling C object mypkg/cy_extmod.cpython-310-darwin.so.p/meson-generated_mypkg_cy_extmod.pyx.c.o
[meson_python-0.10.0] [6/6] Linking target mypkg/cy_extmod.cpython-310-darwin.so
[meson_python-0.10.0] + meson install --destdir /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install
[meson_python-0.10.0] ninja: Entering directory `/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/build'
[meson_python-0.10.0] [1/1] Generating mypkg/generate-config-file with a custom command
[meson_python-0.10.0] Installing subdir /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/mypkg/submod to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg/submod
[meson_python-0.10.0] Installing /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/mypkg/submod/__init__.py to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg/submod
[meson_python-0.10.0] Installing /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/mypkg/submod/unknown_filetype.npq to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg/submod
[meson_python-0.10.0] Installing mypkg/__config__.py to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg
[meson_python-0.10.0] Installing mypkg/extmod.cpython-310-darwin.so to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg
[meson_python-0.10.0] Installing mypkg/cy_extmod.cpython-310-darwin.so to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg
[meson_python-0.10.0] Installing /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/mypkg/__init__.py to /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0/src/tests/packages/scipy-like/.mesonpy-1hcozttf/install/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/mypkg
[meson_python-0.10.0] Copying files to wheel...
[meson_python-0.10.0] [0/4] mypkg/__config__.py
[meson_python-0.10.0] [1/4] mypkg/extmod.cpython-310-darwin.so
[meson_python-0.10.0] [2/4] mypkg/cy_extmod.cpython-310-darwin.so
[meson_python-0.10.0] [3/4] mypkg/__init__.py
[meson_python-0.10.0] [4/4] mypkg/submod
[meson_python-0.10.0] =========================== short test summary info ============================
[meson_python-0.10.0] FAILED tests/test_wheel.py::test_scipy_like - AssertionError: assert {'mypkg-...
[meson_python-0.10.0] ERROR tests/test_wheel.py::test_detect_wheel_tag_module - subprocess.CalledPr...
[meson_python-0.10.0] ========= 1 failed, 44 passed, 5 skipped, 2 xfailed, 1 error in 33.75s =========
[meson_python-0.10.0] 
[meson_python-0.10.0] real	0m34.481s
[meson_python-0.10.0] user	0m22.332s
[meson_python-0.10.0] sys	0m11.018s
[meson_python-0.10.0] ************************************************************************
[meson_python-0.10.0] Error testing package meson_python-0.10.0
[meson_python-0.10.0] ************************************************************************
[meson_python-0.10.0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[meson_python-0.10.0] explaining the problem and including the log files
[meson_python-0.10.0]   /Users/buildbot-sage/worker/sage_git/build/logs/pkgs/meson_python-0.10.0.log
[meson_python-0.10.0] and
[meson_python-0.10.0]   /Users/buildbot-sage/worker/sage_git/build/config.log
[meson_python-0.10.0] Describe your computer, operating system, etc.
[meson_python-0.10.0] If you want to try to fix the problem yourself, *don't* just cd to
[meson_python-0.10.0] /Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0 and type 'make check' or whatever is appropriate.
[meson_python-0.10.0] Instead, the following commands setup all environment variables
[meson_python-0.10.0] correctly and load a subshell for you to debug the error:
[meson_python-0.10.0]   (cd '/Users/buildbot-sage/worker/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0' && '/Users/buildbot-sage/worker/sage_git/build/sage' --buildsh)
[meson_python-0.10.0] When you are done debugging, you can type "exit" to leave the subshell.
[meson_python-0.10.0] ************************************************************************
```



---

Comment by mkoeppe created at 2022-10-24 20:44:55

Yes, there are known failures of the meson-python test suite on some platforms.


---

Comment by git created at 2022-10-24 21:40:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-10-24 21:40:22

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2022-10-31 18:39:12

Doesn't seem to work, testsuite still fails with hard error

```
[meson_python-0.10.0] =========================== short test summary info ============================
[meson_python-0.10.0] FAILED tests/test_wheel.py::test_scipy_like - AssertionError: assert {'mypkg-...
[meson_python-0.10.0] ERROR tests/test_wheel.py::test_local_lib - subprocess.CalledProcessError: Co...
[meson_python-0.10.0] ERROR tests/test_wheel.py::test_detect_wheel_tag_module - subprocess.CalledPr...
[meson_python-0.10.0] ERROR tests/test_wheel.py::test_rpath - subprocess.CalledProcessError: Comman...
[meson_python-0.10.0] ERROR tests/test_wheel.py::test_uneeded_rpath - subprocess.CalledProcessError...
[meson_python-0.10.0] ============== 1 failed, 46 passed, 2 xfailed, 4 errors in 48.55s ==============
[meson_python-0.10.0] 
[meson_python-0.10.0] real	0m49.034s
[meson_python-0.10.0] user	0m36.548s
[meson_python-0.10.0] sys	0m3.388s
[meson_python-0.10.0] ************************************************************************
[meson_python-0.10.0] Error testing package meson_python-0.10.0
[meson_python-0.10.0] ************************************************************************
[meson_python-0.10.0] Please email sage-devel (http://groups.google.com/group/sage-devel)
[meson_python-0.10.0] explaining the problem and including the log files
[meson_python-0.10.0]   /var/lib/buildbot/slave/sage_git/build/logs/pkgs/meson_python-0.10.0.log
[meson_python-0.10.0] and
[meson_python-0.10.0]   /var/lib/buildbot/slave/sage_git/build/config.log
[meson_python-0.10.0] Describe your computer, operating system, etc.
[meson_python-0.10.0] If you want to try to fix the problem yourself, *don't* just cd to
[meson_python-0.10.0] /var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0 and type 'make check' or whatever is appropriate.
[meson_python-0.10.0] Instead, the following commands setup all environment variables
[meson_python-0.10.0] correctly and load a subshell for you to debug the error:
[meson_python-0.10.0]   (cd '/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/tmp/sage/build/meson_python-0.10.0' && '/var/lib/buildbot/slave/sage_git/build/sage' --buildsh)
[meson_python-0.10.0] When you are done debugging, you can type "exit" to leave the subshell.
[meson_python-0.10.0] ************************************************************************
Makefile:3079: recipe for target 'meson_python-SAGE_VENV-no-deps' failed
make[4]: *** [meson_python-SAGE_VENV-no-deps] Error 1
Makefile:3079: recipe for target '/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/lib/sage/installed/meson_python-0.10.0' failed
make[3]: *** [/var/lib/buildbot/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/lib/sage/installed/meson_python-0.10.0] Error 2
make[3]: Target 'all-sage' not remade because of errors.
Makefile:2735: recipe for target 'all-build' failed
make[2]: *** [all-build] Error 2
make[2]: Target 'build-start' not remade because of errors.
make[2]: Leaving directory '/var/lib/buildbot/slave/sage_git/build/build/make'
```



---

Comment by vbraun created at 2022-10-31 18:39:12

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2022-10-31 18:43:04

The buildbot has

```
SAGE_CHECK_PACKAGES=!gsl,!givaro,!python2,!python3,!yasm,!zeromq,!curl,!arb,!cython,!cvxopt,!cmake,!networkx,!r,!nose,!normaliz,!rpy2,!giac,!openssl,!flint
SAGE_CHECK=yes
```

so I'm guessing the `SAGE_CHECK_PACKAGES_DEFAULT_yes` aren't merged in but overwritten? Is that the desired behavior?


---

Comment by mkoeppe created at 2022-10-31 20:05:09

Yes, by setting this environment variable, you are overriding the defaults. This works as intended.


---

Comment by mkoeppe created at 2022-10-31 20:05:09

Changing status from needs_work to positive_review.


---

Comment by git created at 2022-10-31 22:22:16

Changing status from positive_review to needs_review.


---

Comment by git created at 2022-10-31 22:22:16

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by mkoeppe created at 2022-10-31 22:22:45

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-11-07 00:03:52

Install fails on OSX Catalina with 

```
  [1216/1224] scipy/io/arff/tests/data/test7.arff
  [1217/1224] scipy/io/arff/tests/data/test8.arff
  [1218/1224] scipy/io/arff/tests/data/test9.arff
  [1219/1224] scipy/io/_harwell_boeing/__init__.py
  [1220/1224] scipy/io/_harwell_boeing/_fortran_format_parser.py
  [1221/1224] scipy/io/_harwell_boeing/hb.py
  [1222/1224] scipy/io/_harwell_boeing/tests/__init__.py
  [1223/1224] scipy/io/_harwell_boeing/tests/test_fortran_format.py
  [1224/1224] scipy/io/_harwell_boeing/tests/test_hb.py
  Preparing metadata (pyproject.toml): finished with status 'done'
Building wheels for collected packages: scipy
  Building wheel for scipy (pyproject.toml): started
  Running command Building wheel for scipy (pyproject.toml)
  Building wheel for scipy (pyproject.toml): finished with status 'done'
  Created wheel for scipy: filename=scipy-1.9.2-cp310-cp310-macosx_10_15_7_x86_64.whl size=23108774 sha256=879e2b49697cfab5f3ade64070cd1e4190bab808a13ddf592a2ad2019c1798a0
  Stored in directory: /private/tmp/pip-ephem-wheel-cache-xb5awkgq/wheels/48/64/0a/04a7b283865a80737d531abd1c9cf4c8b45e2c32c4e8771b91
Successfully built scipy
WARNING: Skipping scipy as it is not installed.
Using pip 22.3 from /Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/pip (python 3.10)
Looking in links: /Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/lib/sage/wheels
ERROR: scipy-1.9.2-cp310-cp310-macosx_10_15_7_x86_64.whl is not a supported wheel on this platform.
Warning: installing with "python3 -m pip install --verbose --no-index --find-links=/Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/lib/sage/wheels --disable-pip-version-check --isolated --no-cache-dir" failed. Retrying, adding "--no-deps --ignore-installed --ignore-requires-python"
Using pip 22.3 from /Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/lib/python3.10/site-packages/pip (python 3.10)
Looking in links: /Users/buildbot-sage/slave/sage_git/build/local/var/lib/sage/venv-python3.10.8/var/lib/sage/wheels
ERROR: scipy-1.9.2-cp310-cp310-macosx_10_15_7_x86_64.whl is not a supported wheel on this platform.
Error: installing with pip  failed
********************************************************************************
Error installing scipy-1.9.2-cp310-cp310-macosx_10_15_7_x86_64.whl
********************************************************************************
```



---

Comment by mkoeppe created at 2022-11-07 16:59:53

I have reported it upstream at https://github.com/mesonbuild/meson-python/issues/160#issuecomment-1305912020 but at some point (maybe now?) we'll have to drop support for Catalina. It's no longer supported by Apple IIRC, and also scheduled for removal on GH Actions.

Also homebrew no longer supports it - https://github.com/sagemath/sage/actions/runs/3355189832/jobs/5559268353 

```
Warning: You are using macOS 10.15.
We (and Apple) do not provide support for this old version.
It is expected behaviour that some formulae will fail to build in this old version.
It is expected behaviour that Homebrew will be buggy and slow.
Do not create any issues about this on Homebrew's GitHub repositories.
Do not create any issues even if you think this message is unrelated.
Any opened issues will be immediately closed without response.
Do not ask for help from MacHomebrew on Twitter.
You may ask for help in Homebrew's discussions but are unlikely to receive a response.
Try to figure out the problem yourself and submit a fix as a pull request.
We will review it but may or may not accept it.
```



---

Comment by vbraun created at 2022-11-15 23:43:21

Resolution: fixed


---

Comment by mkoeppe created at 2022-11-23 04:31:43

Replying to [comment:62 Antonio Rojas]:
> Replying to [comment:61 arojas]:
> > I suppose this is caused by our openblas not including lapack symbols. Our distro package is fine since we haven't switched to meson (yet)
> 
> Indeed, building with -Dlapack=lapack fixes this when building the distro package with meson. Not sure how to fix this in sage.

I've opened #34779 for this
