# Issue 29570: allow to export graph to SVG through the js display

Issue created by migration from https://trac.sagemath.org/ticket/29807

Original creator: chapoton

Original creation time: 2020-06-05 20:10:12

CC:  dcoudert


```
sage: G=graphs.PetersenGraph()
sage: G.show(method='js',vertex_labels=False)
```

opens the graph in the browser, and we add a menu there


---

Comment by chapoton created at 2020-06-05 20:11:29

this needs testing, and also we probably want either to avoid FileSaver.js or make a copy in our code
----
New commits:


---

Comment by chapoton created at 2020-06-05 20:11:29

Changing status from new to needs_review.


---

Comment by paulmasson created at 2020-06-06 01:35:42

Frédéric, you don't need to use FileSaver at all: just create a link as is done in the Three.js template and click it programmatically.


---

Comment by git created at 2020-06-06 06:34:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-06 06:34:49

Thanks for the suggestion. Here is a better tentative. Please test.


---

Comment by chapoton created at 2020-06-06 06:48:39

Maybe still missing some of the CSS information


---

Comment by dcoudert created at 2020-06-06 07:26:25

I tested it and I can save the graph with safari and chrome, and later load the svg file.

However, for a graph like that, the svg is not nice. I don't know how to improve that.

```
sage: G = digraphs.DeBruijn(2,3)
sage: G.show(method='js', edge_labels=True, link_distance=100)
```



---

Comment by chapoton created at 2020-06-06 08:25:07

Ha, loops and multiple edges ! I can hear Nathann shouting..

Maybe this could be fixed by a better transmission of the css style information. I would appreciate help from people that know this better than I do.


---

Comment by dcoudert created at 2020-06-06 09:55:31

Replying to [comment:7 chapoton]:
> Ha, loops and multiple edges ! I can hear Nathann shouting..

Indeed, too many years having him walking in front of my office ;)
FYI, he moved to g..... Zurich.

> Maybe this could be fixed by a better transmission of the css style information. I would appreciate help from people that know this better than I do.

I searched a bit, starting from

```
sage: G = digraphs.Path(2)
sage: G.show(method='js', edge_labels=True)  # and save as svg
sage: G.allow_multiple_edges(True)
sage: G.add_edges(G.edges())
sage: G.show(method='js', edge_labels=True)    # and save as svg
```

So an arc is turned to a `path` 

```
<path class="link directed" marker-end="url(#directed)" d="M30,654 L2113,654" style="stroke: rgb(170, 170, 170); stroke-width: 4px;"/>
<path class="link directed" marker-end="url(#directed)" d="M30,654Q516.0333333333333,669,1071.5,669Q1626.9666666666667,669,2113,654" style="stroke: rgb(170, 170, 170); stroke-width: 4px;"/>
```

The first one is a straight line, the second a curved one, and it is filled by default :(

From https://www.w3.org/TR/SVG/paths.html#PathElementImplementationNotes, I understood that adding `fill="none"` to the curved one, we get a nice figure.

So we need to add `<style>.link {fill:none;} </style>` at the right place, that is just before the first `<g>` (for some reason, we have `<g><g>`).

```
<svg xmlns="http://www.w3.org/2000/svg" width="2143" height="1308" pointer-events="all"><style>.link {fill:none;}</style><g><g>
```


So adding

```
var bettersource = source.replace("<g>", "<style>.link {fill:none;}</style><g>");
```

should do the job. We will have it twice, but it's safer in case a new version of d3 removes one of the `<g>`.


---

Comment by git created at 2020-06-06 13:11:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-06 13:13:00

Here is another tentative, along your lines, that keep our full css information, so that the result looks very much the same. Please test


---

Comment by dcoudert created at 2020-06-06 13:25:12

It's working well for me. And a similar trick can certainly be used to export in other formats.

It would be good to mention it in the documentation of `graph_plot_js.py`.


---

Comment by git created at 2020-06-06 16:09:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-06 16:09:38

voilà, j'ai ajouté un peu de documentation


---

Comment by dcoudert created at 2020-06-06 16:37:52

Merci Frédéric.

LGTM.


---

Comment by dcoudert created at 2020-06-06 16:37:52

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2020-06-25 08:29:17

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2020-06-25 08:29:17

one problem with doc remains


---

Comment by git created at 2020-06-25 08:34:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-06-25 08:48:06

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-06-25 08:48:06

let us wait for the patchbot report


---

Comment by dcoudert created at 2020-06-25 11:37:33

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2020-06-25 11:37:33

green !


---

Comment by vbraun created at 2020-06-27 09:26:10

Resolution: fixed
