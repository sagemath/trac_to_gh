# Issue 14155: doctest suprious UnicodeWarning

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2013-03-26 16:11:17

Assignee: mvngu

CC:  leif

Doctests currently generate a spurious unicode warining:

```
[vbraun`@`localhost hg]$ sage -t sage/tests/french_book/polynomes.py
Running doctests with ID 2013-03-26-13-06-20-1ebc47c6.
Doctesting 1 file.
sage -t sage/tests/french_book/polynomes.py
/home/vbraun/opt/sage-5.9.beta1/local/lib/python2.7/site-packages/Cython/Build/Dependencies.py:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
  if code[q-1] == u'\\':
    [107 tests, 1.1 s]
```



---

Comment by roed created at 2013-03-26 17:09:14

See also #14153.


---

Comment by vbraun created at 2013-03-26 18:44:39

I think we should ignore ansi color sequences in doctests, I'm pretty sure this is the cause behind https://groups.google.com/d/msg/sage-release/9EyC1RhSg90/BooDydikYs8J though I don't know why they are not properly disabled in Hugh's setup.


---

Comment by vbraun created at 2013-03-26 18:45:43

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-03-26 19:26:47

Replying to [comment:5 vbraun]:
> I think we should ignore ansi color sequences in doctests
Can we leave this for a different ticket until we really sure what the cause is?

Positive review to [attachment:trac_14359_doctest_unicode_warning.patch]


---

Comment by vbraun created at 2013-03-26 20:31:12

Its definitely the cause for `run_doctests` not working on the Sage command line. Switch colors off (`%color NoColor`) and it works. I don't think it really matters what Hugh's problem is.


---

Comment by roed created at 2013-03-26 21:49:30

Replying to [comment:8 vbraun]:
> Its definitely the cause for `run_doctests` not working on the Sage command line. Switch colors off (`%color NoColor`) and it works. I don't think it really matters what Hugh's problem is.

This is #14290.


---

Comment by vbraun created at 2013-03-26 22:54:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-03-27 05:45:06

Rebased.


---

Comment by jdemeyer created at 2013-03-27 16:32:30

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2013-03-27 16:32:30


```
sage -t --long devel/sage/sage/doctest/sources.py
**********************************************************************
File "devel/sage/sage/doctest/sources.py", line 664, in sage.doctest.sources.FileDocTestSource._test_enough_doctests
Failed example:
    for path, dirs, files in itertools.chain(os.walk('sage'), os.walk('doc')): # long time
        path = os.path.relpath(path)
        dirs.sort(); files.sort()
        for F in files:
            _, ext = os.path.splitext(F)
            if ext in ('.py', '.pyx', '.sage', '.spyx', '.rst'):
                filename = os.path.join(path, F)
                FDS = FileDocTestSource(filename, DocTestDefaults(long=True,optional=True))
                FDS._test_enough_doctests(verbose=False)
Expected:
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 12 tests in sage/combinat/tableau.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 1 tests in sage/ext/c_lib.pyx that are not being run
    There are 9 tests in sage/graphs/graph_plot.py that are not being run
    There are 2 tests in sage/server/notebook/worksheet.py that are not being run
    doctest:229: UnicodeWarning: Unicode equal comparison failed to convert both arguments to Unicode - interpreting them as being unequal
Got:
    There are 18 tests in sage/combinat/partition.py that are not being run
    There are 12 tests in sage/combinat/tableau.py that are not being run
    There are 3 unexpected tests being run in sage/doctest/parsing.py
    There are 1 unexpected tests being run in sage/doctest/reporting.py
    There are 1 tests in sage/ext/c_lib.pyx that are not being run
    There are 9 tests in sage/graphs/graph_plot.py that are not being run
    There are 2 tests in sage/server/notebook/worksheet.py that are not being run
**********************************************************************
```



---

Comment by jdemeyer created at 2013-03-27 16:41:24

Initial patch


---

Attachment


---

Comment by jdemeyer created at 2013-03-27 16:41:53

Changing status from needs_work to positive_review.


---

Comment by jdemeyer created at 2013-03-28 17:57:09

Resolution: fixed


---

Comment by roed created at 2013-03-28 22:47:25

Changing component from doctest to doctest framework.
