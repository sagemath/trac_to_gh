# Issue 12284: Numerical noise on OS X 10.7

archive/issues_012284.json:
```json
{
    "body": "Assignee: drkirkby\n\nWhen running Sage on OS X 10.7, there is numerical noise in some doctests.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12456\n\n",
    "created_at": "2012-02-07T10:14:06Z",
    "labels": [
        "component: porting",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Numerical noise on OS X 10.7",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12284",
    "user": "https://github.com/jdemeyer"
}
```
Assignee: drkirkby

When running Sage on OS X 10.7, there is numerical noise in some doctests.

Issue created by migration from https://trac.sagemath.org/ticket/12456





---

archive/issue_comments_144355.json:
```json
{
    "body": "How to deal with this:\n\n```\nsage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx\n**********************************************************************\nFile \"/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx\", line 7983:\n    sage: G.round(6)\nExpected:\n    [-0.422243 - 0.490087*I  0.566698 - 0.097416*I -0.500882 + 0.002251*I]\n    [-0.057002 - 0.495035*I  -0.35059 - 0.625323*I  0.255514 - 0.415284*I]\n    [ 0.394105 - 0.421778*I -0.392266 - 0.039345*I  -0.352905 + 0.62195*I]\nGot:\n    [ 0.422243 + 0.490087*I -0.566698 + 0.097416*I  0.500882 - 0.002251*I]\n    [ 0.057002 + 0.495035*I   0.35059 + 0.625323*I -0.255514 + 0.415284*I]\n    [-0.394105 + 0.421778*I  0.392266 + 0.039345*I   0.352905 - 0.62195*I]\n**********************************************************************\nFile \"/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx\", line 7987:\n    sage: M.round(6).zero_at(10^-6)\nExpected:\n    [             -1.528503                      0                      0]\n    [  0.459974 - 0.40061*I              -1.741233                      0]\n    [-0.934304 + 0.148868*I   0.54833 + 0.073202*I              -0.550725]\nGot:\n    [             1.528503                     0                     0]\n    [-0.459974 + 0.40061*I              1.741233                     0]\n    [0.934304 - 0.148868*I -0.54833 - 0.073202*I              0.550725]\n**********************************************************************\nFile \"/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx\", line 8031:\n    sage: G.round(6).zero_at(10^-6)\nExpected:\n    [-0.408248 -0.408248 -0.816497]\n    [ 0.707107 -0.707107       0.0]\n    [ -0.57735  -0.57735   0.57735]\nGot:\n    [ 0.408248  0.408248  0.816497]\n    [ 0.707107 -0.707107       0.0]\n    [ -0.57735  -0.57735   0.57735]\n**********************************************************************\nFile \"/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx\", line 8035:\n    sage: M.round(10).zero_at(10^-10)\nExpected:\n    [-2.4494897428           0.0           0.0]\n    [-3.6742346142  0.7071067812           0.0]\n    [-4.8989794856  1.4142135624           0.0]\nGot:\n    [2.4494897428          0.0          0.0]\n    [3.6742346142 0.7071067812          0.0]\n    [4.8989794856 1.4142135624          0.0]\n**********************************************************************\n```\n",
    "created_at": "2012-02-07T10:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144355",
    "user": "https://github.com/jdemeyer"
}
```

How to deal with this:

```
sage -t  -force_lib devel/sage/sage/matrix/matrix2.pyx
**********************************************************************
File "/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx", line 7983:
    sage: G.round(6)
Expected:
    [-0.422243 - 0.490087*I  0.566698 - 0.097416*I -0.500882 + 0.002251*I]
    [-0.057002 - 0.495035*I  -0.35059 - 0.625323*I  0.255514 - 0.415284*I]
    [ 0.394105 - 0.421778*I -0.392266 - 0.039345*I  -0.352905 + 0.62195*I]
Got:
    [ 0.422243 + 0.490087*I -0.566698 + 0.097416*I  0.500882 - 0.002251*I]
    [ 0.057002 + 0.495035*I   0.35059 + 0.625323*I -0.255514 + 0.415284*I]
    [-0.394105 + 0.421778*I  0.392266 + 0.039345*I   0.352905 - 0.62195*I]
**********************************************************************
File "/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx", line 7987:
    sage: M.round(6).zero_at(10^-6)
Expected:
    [             -1.528503                      0                      0]
    [  0.459974 - 0.40061*I              -1.741233                      0]
    [-0.934304 + 0.148868*I   0.54833 + 0.073202*I              -0.550725]
Got:
    [             1.528503                     0                     0]
    [-0.459974 + 0.40061*I              1.741233                     0]
    [0.934304 - 0.148868*I -0.54833 - 0.073202*I              0.550725]
**********************************************************************
File "/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx", line 8031:
    sage: G.round(6).zero_at(10^-6)
Expected:
    [-0.408248 -0.408248 -0.816497]
    [ 0.707107 -0.707107       0.0]
    [ -0.57735  -0.57735   0.57735]
Got:
    [ 0.408248  0.408248  0.816497]
    [ 0.707107 -0.707107       0.0]
    [ -0.57735  -0.57735   0.57735]
**********************************************************************
File "/Users/jdemeyer/sage-5.0.beta1-gcc/devel/sage-main/sage/matrix/matrix2.pyx", line 8035:
    sage: M.round(10).zero_at(10^-10)
Expected:
    [-2.4494897428           0.0           0.0]
    [-3.6742346142  0.7071067812           0.0]
    [-4.8989794856  1.4142135624           0.0]
Got:
    [2.4494897428          0.0          0.0]
    [3.6742346142 0.7071067812          0.0]
    [4.8989794856 1.4142135624          0.0]
**********************************************************************
```




---

archive/issue_comments_144356.json:
```json
{
    "body": "Attachment [12456_osx_lion_noise.patch](tarball://root/attachments/some-uuid/ticket12456/12456_osx_lion_noise.patch) by @jdemeyer created at 2012-02-08 21:40:02",
    "created_at": "2012-02-08T21:40:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144356",
    "user": "https://github.com/jdemeyer"
}
```

Attachment [12456_osx_lion_noise.patch](tarball://root/attachments/some-uuid/ticket12456/12456_osx_lion_noise.patch) by @jdemeyer created at 2012-02-08 21:40:02



---

archive/issue_comments_144357.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-02-09T20:08:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144357",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_144358.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-02-09T20:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144358",
    "user": "https://github.com/robertwb"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_144359.json:
```json
{
    "body": "I think a lot of these could be fixed without marking them as random (essentially disabling the test). E.g. for\n\n\n```\nsage: B.is_hermitian(algorithm='naive', tol=1.0e-17)\n```\n\n\nwe could try increasing the tolerance, and for the sign issues, we could write\n\n\n```\nG.round(6) * sgn(G[0,0])\n```\n\n\nto force the top-left entry to be positive.",
    "created_at": "2012-02-09T20:19:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144359",
    "user": "https://github.com/robertwb"
}
```

I think a lot of these could be fixed without marking them as random (essentially disabling the test). E.g. for


```
sage: B.is_hermitian(algorithm='naive', tol=1.0e-17)
```


we could try increasing the tolerance, and for the sign issues, we could write


```
G.round(6) * sgn(G[0,0])
```


to force the top-left entry to be positive.



---

archive/issue_comments_144360.json:
```json
{
    "body": "Replying to [comment:3 robertwb]:\n> I think a lot of these could be fixed without marking them as random (essentially disabling the test). E.g. for\n> \n> {{{\n> sage: B.is_hermitian(algorithm='naive', tol=1.0e-17)\n> }}}\n> \n> we could try increasing the tolerance\nDoesn't work.  On OS X 10.7, the matrix actually is Hermitian to infinite precision.\n\n> {{{\n> G.round(6) * sgn(G[0,0])\n> }}}\n> \n> to force the top-left entry to be positive. \nDoesn't work either, since you would have to do this on a row-by-row or column-by-column basis for the Gram Schmidt tests.  I think this would make things too complicated.  Besides, the important thing to check are the defining properties of the Gram-Schmidt reduction, which *is* checked in these doctests.",
    "created_at": "2012-02-09T20:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144360",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [comment:3 robertwb]:
> I think a lot of these could be fixed without marking them as random (essentially disabling the test). E.g. for
> 
> {{{
> sage: B.is_hermitian(algorithm='naive', tol=1.0e-17)
> }}}
> 
> we could try increasing the tolerance
Doesn't work.  On OS X 10.7, the matrix actually is Hermitian to infinite precision.

> {{{
> G.round(6) * sgn(G[0,0])
> }}}
> 
> to force the top-left entry to be positive. 
Doesn't work either, since you would have to do this on a row-by-row or column-by-column basis for the Gram Schmidt tests.  I think this would make things too complicated.  Besides, the important thing to check are the defining properties of the Gram-Schmidt reduction, which *is* checked in these doctests.



---

archive/issue_comments_144361.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-02-09T20:35:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144361",
    "user": "https://github.com/jdemeyer"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_144362.json:
```json
{
    "body": "Looks good to me, and passes doctests on several platforms (despite what the patchbot thinks).",
    "created_at": "2012-02-23T19:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144362",
    "user": "https://github.com/jhpalmieri"
}
```

Looks good to me, and passes doctests on several platforms (despite what the patchbot thinks).



---

archive/issue_comments_144363.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-02-23T19:31:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144363",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_144364.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-27T11:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12284",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12284#issuecomment-144364",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
