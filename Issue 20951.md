# Issue 20951: Patch to Singular build to not explicitly link to MPIR

archive/issues_020951.json:
```json
{
    "body": "CC:  @nexttime\n\nWhen building Singular on a system that has Flint (i.e. in Sage), its configure/makefiles add some compiler and linker flags specifically \"needed\" for Flint.\n\nOne of these flags includes `-lmpir` which is incongruous with the fact that Singular itself links with GMP with `-lgmp`.\n\nThis patch removes the unnecessary `-lmpir`.  As was mentioned in [this thread](https://groups.google.com/d/msg/sage-devel/6niNzyvh55I/VPtl88tUBwAJ), there has been effort in the past (for compatibility purposes) to remove explicit mentions of \"mpir\" in build systems for Sage packages in favor of \"gmp\".  This is just an example that slipped through the cracks.\n\nIt didn't cause a problem on Linux because everything in Singular linked first with GMP via `-lgmp`, so all symbols got resolved to libgmp, and libmpir was never even used (not even added as a `DT_NEEDED` entry).  However due to subtle linking differences in Cygwin (that I have no worked out the specifics of), some symbols end up being found in libgmp while most others are found in libmpir, and the resulting executables end up loading both.\n\nThis is related to #21174, but not necessarily dependent.  Not sure whether or not this is worth reporting upstream.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21188\n\n",
    "created_at": "2016-08-08T08:01:49Z",
    "labels": [
        "porting: Cygwin",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Patch to Singular build to not explicitly link to MPIR",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20951",
    "user": "@embray"
}
```
CC:  @nexttime

When building Singular on a system that has Flint (i.e. in Sage), its configure/makefiles add some compiler and linker flags specifically "needed" for Flint.

One of these flags includes `-lmpir` which is incongruous with the fact that Singular itself links with GMP with `-lgmp`.

This patch removes the unnecessary `-lmpir`.  As was mentioned in [this thread](https://groups.google.com/d/msg/sage-devel/6niNzyvh55I/VPtl88tUBwAJ), there has been effort in the past (for compatibility purposes) to remove explicit mentions of "mpir" in build systems for Sage packages in favor of "gmp".  This is just an example that slipped through the cracks.

It didn't cause a problem on Linux because everything in Singular linked first with GMP via `-lgmp`, so all symbols got resolved to libgmp, and libmpir was never even used (not even added as a `DT_NEEDED` entry).  However due to subtle linking differences in Cygwin (that I have no worked out the specifics of), some symbols end up being found in libgmp while most others are found in libmpir, and the resulting executables end up loading both.

This is related to #21174, but not necessarily dependent.  Not sure whether or not this is worth reporting upstream.

Issue created by migration from https://trac.sagemath.org/ticket/21188





---

archive/issue_comments_289786.json:
```json
{
    "body": "I would prefer to bump the Singular version number, to force the patch to take effect.\n\nAnd remember to set the ticket to needs_review when you are done.",
    "created_at": "2016-08-08T08:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289786",
    "user": "@jdemeyer"
}
```

I would prefer to bump the Singular version number, to force the patch to take effect.

And remember to set the ticket to needs_review when you are done.



---

archive/issue_comments_289787.json:
```json
{
    "body": "Okay, yes of course.",
    "created_at": "2016-08-08T11:54:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289787",
    "user": "@embray"
}
```

Okay, yes of course.



---

archive/issue_comments_289788.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-08-08T11:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289788",
    "user": "@embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_289789.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-08T11:57:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289789",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_289790.json:
```json
{
    "body": "\n```\n[singular-3.1.7p1.p2] Applying ../patches/flint-libs.patch\n[singular-3.1.7p1.p2] can't find file to patch at input line 6\n[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?\n[singular-3.1.7p1.p2] The text leading up to this was:\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] |Remove explicit references to -lmpir; instead use plain GMP (which may have\n[singular-3.1.7p1.p2] |been provided by MPIR).\n[singular-3.1.7p1.p2] |diff -ruN a/factory/configure b/factory/configure\n[singular-3.1.7p1.p2] |--- a/factory/configure  2016-08-04 14:32:27.460652100 +0200\n[singular-3.1.7p1.p2] |+++ b/factory/configure  2016-08-04 14:31:41.086952100 +0200\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] File to patch: \n[singular-3.1.7p1.p2] Skip this patch? [y] \n[singular-3.1.7p1.p2] Skipping patch.\n[singular-3.1.7p1.p2] 1 out of 1 hunk ignored\n[singular-3.1.7p1.p2] can't find file to patch at input line 18\n[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?\n[singular-3.1.7p1.p2] The text leading up to this was:\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] |diff -ruN a/factory/flint-check.m4 b/factory/flint-check.m4\n[singular-3.1.7p1.p2] |--- a/factory/flint-check.m4     2016-08-04 14:32:27.439640500 +0200\n[singular-3.1.7p1.p2] |+++ b/factory/flint-check.m4     2016-08-04 14:31:26.780956400 +0200\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] File to patch: \n[singular-3.1.7p1.p2] Skip this patch? [y] \n[singular-3.1.7p1.p2] Skipping patch.\n[singular-3.1.7p1.p2] 1 out of 1 hunk ignored\n[singular-3.1.7p1.p2] can't find file to patch at input line 30\n[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?\n[singular-3.1.7p1.p2] The text leading up to this was:\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] |diff -ruN a/Singular/configure.in b/Singular/configure.in\n[singular-3.1.7p1.p2] |--- a/Singular/configure.in      2016-08-04 14:32:25.813801600 +0200\n[singular-3.1.7p1.p2] |+++ b/Singular/configure.in      2016-08-04 14:31:08.788116800 +0200\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] File to patch: \n[singular-3.1.7p1.p2] Skip this patch? [y] \n[singular-3.1.7p1.p2] Skipping patch.\n[singular-3.1.7p1.p2] 1 out of 1 hunk ignored\n[singular-3.1.7p1.p2] can't find file to patch at input line 41\n[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?\n[singular-3.1.7p1.p2] The text leading up to this was:\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] |--- a/Singular/configure 2016-08-04 14:32:27.084437500 +0200\n[singular-3.1.7p1.p2] |+++ b/Singular/configure 2016-08-04 15:12:29.084236200 +0200\n[singular-3.1.7p1.p2] --------------------------\n[singular-3.1.7p1.p2] File to patch: \n[singular-3.1.7p1.p2] Skip this patch? [y] \n[singular-3.1.7p1.p2] Skipping patch.\n[singular-3.1.7p1.p2] 1 out of 1 hunk ignored\n[singular-3.1.7p1.p2] Error applying '../patches/flint-libs.patch'\n[singular-3.1.7p1.p2] Error building Singular (error in apply_patches).\n```\n",
    "created_at": "2016-08-08T12:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289790",
    "user": "@jdemeyer"
}
```


```
[singular-3.1.7p1.p2] Applying ../patches/flint-libs.patch
[singular-3.1.7p1.p2] can't find file to patch at input line 6
[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?
[singular-3.1.7p1.p2] The text leading up to this was:
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] |Remove explicit references to -lmpir; instead use plain GMP (which may have
[singular-3.1.7p1.p2] |been provided by MPIR).
[singular-3.1.7p1.p2] |diff -ruN a/factory/configure b/factory/configure
[singular-3.1.7p1.p2] |--- a/factory/configure  2016-08-04 14:32:27.460652100 +0200
[singular-3.1.7p1.p2] |+++ b/factory/configure  2016-08-04 14:31:41.086952100 +0200
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] File to patch: 
[singular-3.1.7p1.p2] Skip this patch? [y] 
[singular-3.1.7p1.p2] Skipping patch.
[singular-3.1.7p1.p2] 1 out of 1 hunk ignored
[singular-3.1.7p1.p2] can't find file to patch at input line 18
[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?
[singular-3.1.7p1.p2] The text leading up to this was:
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] |diff -ruN a/factory/flint-check.m4 b/factory/flint-check.m4
[singular-3.1.7p1.p2] |--- a/factory/flint-check.m4     2016-08-04 14:32:27.439640500 +0200
[singular-3.1.7p1.p2] |+++ b/factory/flint-check.m4     2016-08-04 14:31:26.780956400 +0200
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] File to patch: 
[singular-3.1.7p1.p2] Skip this patch? [y] 
[singular-3.1.7p1.p2] Skipping patch.
[singular-3.1.7p1.p2] 1 out of 1 hunk ignored
[singular-3.1.7p1.p2] can't find file to patch at input line 30
[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?
[singular-3.1.7p1.p2] The text leading up to this was:
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] |diff -ruN a/Singular/configure.in b/Singular/configure.in
[singular-3.1.7p1.p2] |--- a/Singular/configure.in      2016-08-04 14:32:25.813801600 +0200
[singular-3.1.7p1.p2] |+++ b/Singular/configure.in      2016-08-04 14:31:08.788116800 +0200
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] File to patch: 
[singular-3.1.7p1.p2] Skip this patch? [y] 
[singular-3.1.7p1.p2] Skipping patch.
[singular-3.1.7p1.p2] 1 out of 1 hunk ignored
[singular-3.1.7p1.p2] can't find file to patch at input line 41
[singular-3.1.7p1.p2] Perhaps you used the wrong -p or --strip option?
[singular-3.1.7p1.p2] The text leading up to this was:
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] |--- a/Singular/configure 2016-08-04 14:32:27.084437500 +0200
[singular-3.1.7p1.p2] |+++ b/Singular/configure 2016-08-04 15:12:29.084236200 +0200
[singular-3.1.7p1.p2] --------------------------
[singular-3.1.7p1.p2] File to patch: 
[singular-3.1.7p1.p2] Skip this patch? [y] 
[singular-3.1.7p1.p2] Skipping patch.
[singular-3.1.7p1.p2] 1 out of 1 hunk ignored
[singular-3.1.7p1.p2] Error applying '../patches/flint-libs.patch'
[singular-3.1.7p1.p2] Error building Singular (error in apply_patches).
```




---

archive/issue_comments_289791.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-08-08T12:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289791",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_289792.json:
```json
{
    "body": "Note that #17254 upgrades Singular to 4.x (but it doesn't seem this ticket will be ready soon).\n\nWhile (I've heard) a lot has changed in the new Singular version, including the build, I haven't looked at the latter yet.\n\nSo we *may* have to apply a similar patch to Singular 4.x as well.",
    "created_at": "2016-08-08T12:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289792",
    "user": "@nexttime"
}
```

Note that #17254 upgrades Singular to 4.x (but it doesn't seem this ticket will be ready soon).

While (I've heard) a lot has changed in the new Singular version, including the build, I haven't looked at the latter yet.

So we *may* have to apply a similar patch to Singular 4.x as well.



---

archive/issue_comments_289793.json:
```json
{
    "body": "It is still unclear to me why the linker didn't bail out when I built Sage with `--with-mp=gmp` from scratch on a Linux system where MPIR isn't installed.\n\nI also have no traces of MPIR in my Singular build logs even in Sage builds with MPIR.\n\n\\\\\n\nAnd btw., unless you specify `--as-needed`, any shared library you give on the linker command line will appear as a dependency in the shared library or program you create, no matter whether any symbol from it is referenced or not, provided the library can be found of course.  (This may be the default on some systems though.)\n\nAFAIK on Cygwin static import libraries are used, where in principle only object files with referenced symbols should get included into the link (unless one specifies `--whole-archive`).",
    "created_at": "2016-08-08T13:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289793",
    "user": "@nexttime"
}
```

It is still unclear to me why the linker didn't bail out when I built Sage with `--with-mp=gmp` from scratch on a Linux system where MPIR isn't installed.

I also have no traces of MPIR in my Singular build logs even in Sage builds with MPIR.

\\

And btw., unless you specify `--as-needed`, any shared library you give on the linker command line will appear as a dependency in the shared library or program you create, no matter whether any symbol from it is referenced or not, provided the library can be found of course.  (This may be the default on some systems though.)

AFAIK on Cygwin static import libraries are used, where in principle only object files with referenced symbols should get included into the link (unless one specifies `--whole-archive`).



---

archive/issue_comments_289794.json:
```json
{
    "body": "Not sure what the problem is here.  The patch applies fine for me.\n\n\n```\n[singular-3.1.7p1.p1] Applying /home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/singular-3.1.7p1.p1/patches/flint-libs.patch\n[singular-3.1.7p1.p1] patching file factory/configure\n[singular-3.1.7p1.p1] patching file factory/flint-check.m4\n[singular-3.1.7p1.p1] patching file Singular/configure.in\n[singular-3.1.7p1.p1] patching file Singular/configure\n```\n\n\nInteresting that you get a relative path in the \"Applying\" message while I get an absolute path.  Odd.",
    "created_at": "2016-08-08T15:56:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289794",
    "user": "@embray"
}
```

Not sure what the problem is here.  The patch applies fine for me.


```
[singular-3.1.7p1.p1] Applying /home/embray/src/sagemath/sage-cygwin/local/var/tmp/sage/build/singular-3.1.7p1.p1/patches/flint-libs.patch
[singular-3.1.7p1.p1] patching file factory/configure
[singular-3.1.7p1.p1] patching file factory/flint-check.m4
[singular-3.1.7p1.p1] patching file Singular/configure.in
[singular-3.1.7p1.p1] patching file Singular/configure
```


Interesting that you get a relative path in the "Applying" message while I get an absolute path.  Odd.



---

archive/issue_comments_289795.json:
```json
{
    "body": "Changing keywords from \"\" to \"FLINT not found --with-mp=gmp -lmpir\".",
    "created_at": "2016-08-08T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289795",
    "user": "@nexttime"
}
```

Changing keywords from "" to "FLINT not found --with-mp=gmp -lmpir".



---

archive/issue_comments_289796.json:
```json
{
    "body": "Replying to [comment:7 leif]:\n> It is still unclear to me why the linker didn't bail out when I built Sage with `--with-mp=gmp` from scratch on a Linux system where MPIR isn't installed.\n\nOk, looking closer, the `configure` check for FLINT simply failed (because of the `-lmpir`), and Singular \"silently\" got built without FLINT, without me ever noticing. XD\n\n\\\\\n\n> I also have no traces of MPIR in my Singular build logs even in Sage builds with MPIR.\n\nTrying again I have to take that back; no idea how, but I somehow must have misgrepped `mpir`, or accidentally only searched Sage trees that were in fact built with GMP, searched all logs but Singular's was deleted, or whatever.  When building with MPIR, `-lmpir` is of course there.\n\n----\n\nSo more or less incidentally, this ticket will also fix that when configuring Sage with `--with-mp=gmp`, currently Singular gets built without (using) FLINT. :-)",
    "created_at": "2016-08-08T16:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289796",
    "user": "@nexttime"
}
```

Replying to [comment:7 leif]:
> It is still unclear to me why the linker didn't bail out when I built Sage with `--with-mp=gmp` from scratch on a Linux system where MPIR isn't installed.

Ok, looking closer, the `configure` check for FLINT simply failed (because of the `-lmpir`), and Singular "silently" got built without FLINT, without me ever noticing. XD

\\

> I also have no traces of MPIR in my Singular build logs even in Sage builds with MPIR.

Trying again I have to take that back; no idea how, but I somehow must have misgrepped `mpir`, or accidentally only searched Sage trees that were in fact built with GMP, searched all logs but Singular's was deleted, or whatever.  When building with MPIR, `-lmpir` is of course there.

----

So more or less incidentally, this ticket will also fix that when configuring Sage with `--with-mp=gmp`, currently Singular gets built without (using) FLINT. :-)



---

archive/issue_comments_289797.json:
```json
{
    "body": "Replying to [comment:8 embray]:\n> Not sure what the problem is here.  The patch applies fine for me.\n\nThe `-p1` when patching (I think).\n\nLooks like you didn't put `latest/` in when creating the patches.\n\n(Just try `head build/pkgs/singular/patches/*.patch`.)",
    "created_at": "2016-08-08T16:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289797",
    "user": "@nexttime"
}
```

Replying to [comment:8 embray]:
> Not sure what the problem is here.  The patch applies fine for me.

The `-p1` when patching (I think).

Looks like you didn't put `latest/` in when creating the patches.

(Just try `head build/pkgs/singular/patches/*.patch`.)



---

archive/issue_comments_289798.json:
```json
{
    "body": "Oh. It looks like maybe #20933 was merged into develop since I started this branch, or something.  Or more specifically, since I committed to the branch that this branch cherry-picked from (which I don't pull in from develop often because I'm trying to get *a version* of Sage working, and pulling too frequently from develop is too much of a fast moving target).",
    "created_at": "2016-08-08T16:15:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289798",
    "user": "@embray"
}
```

Oh. It looks like maybe #20933 was merged into develop since I started this branch, or something.  Or more specifically, since I committed to the branch that this branch cherry-picked from (which I don't pull in from develop often because I'm trying to get *a version* of Sage working, and pulling too frequently from develop is too much of a fast moving target).



---

archive/issue_comments_289799.json:
```json
{
    "body": "So although #20933 was closed as fixed 11 days ago, and its milestone is 7.3, it's not merged into 7.3?\n\nOr am I missing something?",
    "created_at": "2016-08-08T16:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289799",
    "user": "@nexttime"
}
```

So although #20933 was closed as fixed 11 days ago, and its milestone is 7.3, it's not merged into 7.3?

Or am I missing something?



---

archive/issue_comments_289800.json:
```json
{
    "body": "#20933 was merged in 7.3.rc0, and the branch on this ticket also contains #20933.",
    "created_at": "2016-08-08T16:32:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289800",
    "user": "@jdemeyer"
}
```

#20933 was merged in 7.3.rc0, and the branch on this ticket also contains #20933.



---

archive/issue_comments_289801.json:
```json
{
    "body": "Replying to [comment:13 jdemeyer]:\n> #20933 was merged in 7.3.rc0, and the branch on this ticket also contains #20933.\n\nAh, ok.  I thought it was the other way around, as I recalled the patches had `latest/` in already before, but only some, and now it's `a/latest/` for these.",
    "created_at": "2016-08-08T17:22:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289801",
    "user": "@nexttime"
}
```

Replying to [comment:13 jdemeyer]:
> #20933 was merged in 7.3.rc0, and the branch on this ticket also contains #20933.

Ah, ok.  I thought it was the other way around, as I recalled the patches had `latest/` in already before, but only some, and now it's `a/latest/` for these.



---

archive/issue_comments_289802.json:
```json
{
    "body": "I thought I clarified this above, but I'm working in an older branch that is a few weeks behind because I don't want incoming changes to constantly impede my progress.\n\nBut for the purpose of creating tickets I'm branching off the latest develop and cherry-picking individual commits.",
    "created_at": "2016-08-09T09:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289802",
    "user": "@embray"
}
```

I thought I clarified this above, but I'm working in an older branch that is a few weeks behind because I don't want incoming changes to constantly impede my progress.

But for the purpose of creating tickets I'm branching off the latest develop and cherry-picking individual commits.



---

archive/issue_comments_289803.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-09T09:35:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289803",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_289804.json:
```json
{
    "body": "I updated the commit in this branch so that the newly added patch conforms to the \"standardized\" patch format, and also added a direct reference to this ticket.",
    "created_at": "2016-08-09T09:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289804",
    "user": "@embray"
}
```

I updated the commit in this branch so that the newly added patch conforms to the "standardized" patch format, and also added a direct reference to this ticket.



---

archive/issue_comments_289805.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-09T09:38:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289805",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_289806.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-09T13:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289806",
    "user": "@nexttime"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_289807.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-09T14:08:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289807",
    "user": "@nexttime"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_289808.json:
```json
{
    "body": "ROFL, this also fixes three failing doctests with GMP (two of them due to different ordering in results, the third a more weird one, namely an NTL abort when doing `unpickle_all()` twice, cf. #5838).",
    "created_at": "2016-08-09T15:58:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289808",
    "user": "@nexttime"
}
```

ROFL, this also fixes three failing doctests with GMP (two of them due to different ordering in results, the third a more weird one, namely an NTL abort when doing `unpickle_all()` twice, cf. #5838).



---

archive/issue_comments_289809.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2016-08-09T16:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289809",
    "user": "@nexttime"
}
```

Changing priority from major to critical.



---

archive/issue_comments_289810.json:
```json
{
    "body": "Or maybe even a blocker.",
    "created_at": "2016-08-09T16:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289810",
    "user": "@nexttime"
}
```

Or maybe even a blocker.



---

archive/issue_comments_289811.json:
```json
{
    "body": "Changing component from porting: Cygwin to packages: standard.",
    "created_at": "2016-08-09T16:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289811",
    "user": "@nexttime"
}
```

Changing component from porting: Cygwin to packages: standard.



---

archive/issue_comments_289812.json:
```json
{
    "body": "How was #5838 resolved before?  Were the tests just disabled or something?  I tried skimming through but it wasn't clear.\n\nUpdate: I think I see what you mean now--just that they were failing when building Sage with GMP instead of MPIR.  Well that's cool, I guess ;)",
    "created_at": "2016-08-10T08:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289812",
    "user": "@embray"
}
```

How was #5838 resolved before?  Were the tests just disabled or something?  I tried skimming through but it wasn't clear.

Update: I think I see what you mean now--just that they were failing when building Sage with GMP instead of MPIR.  Well that's cool, I guess ;)



---

archive/issue_comments_289813.json:
```json
{
    "body": "Replying to [comment:24 embray]:\n> How was #5838 resolved before?  Were the tests just disabled or something?  I tried skimming through but it wasn't clear.\n\nThe double-unpickle error presumably vanished with Singular using FLINT (because the failing code apparently gets shadowed); you can at least get it back (also with MPIR) by simply configuring Singular `--without-flint` (as I've posted [here](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88220); haven't updated #5838 yet). :-)\n\nNote that the actual test that it's \"solved\" (or \"worksforme\") was added years after the issue popped up.",
    "created_at": "2016-08-10T09:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289813",
    "user": "@nexttime"
}
```

Replying to [comment:24 embray]:
> How was #5838 resolved before?  Were the tests just disabled or something?  I tried skimming through but it wasn't clear.

The double-unpickle error presumably vanished with Singular using FLINT (because the failing code apparently gets shadowed); you can at least get it back (also with MPIR) by simply configuring Singular `--without-flint` (as I've posted [here](http://permalink.gmane.org/gmane.comp.mathematics.sage.devel/88220); haven't updated #5838 yet). :-)

Note that the actual test that it's "solved" (or "worksforme") was added years after the issue popped up.



---

archive/issue_comments_289814.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-13T22:51:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20951",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20951#issuecomment-289814",
    "user": "@vbraun"
}
```

Resolution: fixed
