# Issue 25649: Implement field_of_definition for DynamicalSystem

archive/issues_025649.json:
```json
{
    "body": "CC:  bhutz\n\nFor the nth iterate of a given DynamicalSystem, we provide a method that returns the field extension of Q over which all of the periodic points, critical points, or pre-images of a point are defined.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25886\n\n",
    "created_at": "2018-07-20T08:28:06Z",
    "labels": [
        "dynamics",
        "minor",
        "enhancement"
    ],
    "title": "Implement field_of_definition for DynamicalSystem",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25649",
    "user": "@Loops7"
}
```
CC:  bhutz

For the nth iterate of a given DynamicalSystem, we provide a method that returns the field extension of Q over which all of the periodic points, critical points, or pre-images of a point are defined.

Issue created by migration from https://trac.sagemath.org/ticket/25886





---

archive/issue_comments_361745.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T06:41:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361745",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361746.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-26T06:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361746",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361747.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-07-27T05:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361747",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361748.json:
```json
{
    "body": "I know this is not done yet, but here are some comments:\n\n----\nbase field should be more than just QQ\n- base a number field\n- base a finite field (prime field or not prime field)\n- base padic field (QQ_p)\n\nlooks like .splitting_field() is implemented for the first two, but not for p-adics. so perhaps p-adic needs to wait on that.\n\n----\nI think you are returning an 'absolute' number field and not just a number field.\n\n----\n\nIt should be possible to also return the embedding of the base field into the new field\n\n----\nI think you want this to be\n\n```\nspace = ds.domain().ambient_space()\n```\n\n----\n\n```\nwhere a formal periodic point is a point of exact period ``n``,\nor equivalently a root of the ``n``-th dynatomic polynomial. \n```\n\nThese are not equivalent. Formal is a root of the dynamtomic which is not necessarily exact period n.\n\n----\n\nIt should be\n\n```\nCR(f*point[1] - g*point[0]).univariate_polynomial()\n```\n",
    "created_at": "2018-07-27T14:24:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361748",
    "user": "bhutz"
}
```

I know this is not done yet, but here are some comments:

----
base field should be more than just QQ
- base a number field
- base a finite field (prime field or not prime field)
- base padic field (QQ_p)

looks like .splitting_field() is implemented for the first two, but not for p-adics. so perhaps p-adic needs to wait on that.

----
I think you are returning an 'absolute' number field and not just a number field.

----

It should be possible to also return the embedding of the base field into the new field

----
I think you want this to be

```
space = ds.domain().ambient_space()
```

----

```
where a formal periodic point is a point of exact period ``n``,
or equivalently a root of the ``n``-th dynatomic polynomial. 
```

These are not equivalent. Formal is a root of the dynamtomic which is not necessarily exact period n.

----

It should be

```
CR(f*point[1] - g*point[0]).univariate_polynomial()
```




---

archive/issue_comments_361749.json:
```json
{
    "body": "Okay, will work to implement these changes. However, specifically on the last point, `point` will always be either a point in `ProjectiveSpace`, in which case point[1] = 1, or a point in `AffineSpace` of dimension 1, meaning point[1] is undefined, so I think it should be okay as is. With that said, I do need to add a check for the point at infinity.",
    "created_at": "2018-07-27T20:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361749",
    "user": "@Loops7"
}
```

Okay, will work to implement these changes. However, specifically on the last point, `point` will always be either a point in `ProjectiveSpace`, in which case point[1] = 1, or a point in `AffineSpace` of dimension 1, meaning point[1] is undefined, so I think it should be okay as is. With that said, I do need to add a check for the point at infinity.



---

archive/issue_comments_361750.json:
```json
{
    "body": "Sure, points are *typically* normalized (over a field) so that the last coordinate is 1. But it is simple to create points where that is not true. So I don't think you should assume the points are normalized.\n\n\n```\nP.<x,y>=ProjectiveSpace(QQ,1)\nQ=P.point([1,2], False)\nQ\n```\n",
    "created_at": "2018-07-27T21:32:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361750",
    "user": "bhutz"
}
```

Sure, points are *typically* normalized (over a field) so that the last coordinate is 1. But it is simple to create points where that is not true. So I don't think you should assume the points are normalized.


```
P.<x,y>=ProjectiveSpace(QQ,1)
Q=P.point([1,2], False)
Q
```




---

archive/issue_comments_361751.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-02T08:48:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361751",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361752.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-08-02T08:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361752",
    "user": "@Loops7"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_361753.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-08T06:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361753",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361754.json:
```json
{
    "body": "Made the minor changes we talked about, and also caught an error in handling the point at infinity in the preimage code. Also noticed some odd behavior (unrelated to this ticket):\n\n\n```\nsage: A.<z> = AffineSpace(QQ,1)\nsage: f = DynamicalSystem([z^2], A)\nsage: g = DynamicalSystem([1/z^2], A)\nsage: type(f[0].denominator())\n<type 'sage.rings.integer.Integer'>\nsage: type(g[0].denominator())\n<type 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular'>\n```\n\n\nNamely, we get back an int when 1 is in the denominator, and a poly when 1 is in the numerator. Not sure exactly where that is stemming from as of right now.",
    "created_at": "2018-08-08T07:00:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361754",
    "user": "@Loops7"
}
```

Made the minor changes we talked about, and also caught an error in handling the point at infinity in the preimage code. Also noticed some odd behavior (unrelated to this ticket):


```
sage: A.<z> = AffineSpace(QQ,1)
sage: f = DynamicalSystem([z^2], A)
sage: g = DynamicalSystem([1/z^2], A)
sage: type(f[0].denominator())
<type 'sage.rings.integer.Integer'>
sage: type(g[0].denominator())
<type 'sage.rings.polynomial.multi_polynomial_libsingular.MPolynomial_libsingular'>
```


Namely, we get back an int when 1 is in the denominator, and a poly when 1 is in the numerator. Not sure exactly where that is stemming from as of right now.



---

archive/issue_comments_361755.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-08T14:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361755",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_361756.json:
```json
{
    "body": "Only came up with one fail test\n\n\n```\nK.<v>=QuadraticField(2)\nR.<z>=K[]\nL.<w>=K.extension(z^3-5)\nP.<x,y>=ProjectiveSpace(L,1)\nf=DynamicalSystem([x^3 + -w*x^2*y- y^3, x*y^2])\ng=f.dehomogenize(1)\nQ=g.domain()(1)\nK, phi=g.field_of_definition_preimage(1,Q,return_embedding=True);K\n```\n\n\notherwise just some minor changes\n- should reassign\n\n```\nn = int(n)\n```\n\n\n- n should be optional for critical points, so default it to 1. In fact, I would not be opposed to removing n entirely from the critical points function. If the user wants the critical points of the nth iterate, they can call nth iterate and then critical points.\n\n- I didn't built the docs yet, so I'll do that after you fix this last failed example.\n\n----\n\nTo answer the random other question. The difference is\n\n\n```\nsage: f[0].parent()\npolynomial ring\nsage: g[0].parent()\nfraction field of polynomial \n```\n\n\nwhen an affine map is initialized, it remains polys if the coordinate are all poly, otherwise it coerces to the fraction field.",
    "created_at": "2018-08-08T14:18:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361756",
    "user": "bhutz"
}
```

Only came up with one fail test


```
K.<v>=QuadraticField(2)
R.<z>=K[]
L.<w>=K.extension(z^3-5)
P.<x,y>=ProjectiveSpace(L,1)
f=DynamicalSystem([x^3 + -w*x^2*y- y^3, x*y^2])
g=f.dehomogenize(1)
Q=g.domain()(1)
K, phi=g.field_of_definition_preimage(1,Q,return_embedding=True);K
```


otherwise just some minor changes
- should reassign

```
n = int(n)
```


- n should be optional for critical points, so default it to 1. In fact, I would not be opposed to removing n entirely from the critical points function. If the user wants the critical points of the nth iterate, they can call nth iterate and then critical points.

- I didn't built the docs yet, so I'll do that after you fix this last failed example.

----

To answer the random other question. The difference is


```
sage: f[0].parent()
polynomial ring
sage: g[0].parent()
fraction field of polynomial 
```


when an affine map is initialized, it remains polys if the coordinate are all poly, otherwise it coerces to the fraction field.



---

archive/issue_comments_361757.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-09T05:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361757",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361758.json:
```json
{
    "body": "Alright, I made the changes you mentioned, including getting rid of `n` altogether in critical, since that makes the most sense to me. The error you encountered was from the added snippet in preimage in the previous commit:\n\n\n\n```\npoint = (point, 1)\n```\n\nThis handled the case of a defining a `point[1]` that can be used in the construction of a polynomial given a point on the affine line. However, I corrected it to \n\n\n\n```\npoint = (point[0], 1)\n```\n\nwhich ensures that the new point object has the right type of object in the first slot, namely an element of the base field. \n\nGiven our previous conversation, I also corrected the coordinate ring to be \n\n```\nCR = ds.domain().ambient_space().coordinate_ring()\n```\n\nwhich fixed a couple edge cases I uncovered. \n\nThe only failure I had left was \n\n\n\n```\nA.<z> = AffineSpace(QQ,1)\nf = DynamicalSystem_affine([1], A)\nf.field_of_definition_preimage(2, A(1))\n```\n\n\nHowever, this error stems from the `nth_iterate_map()` code, since it takes `1` as an integer instead of an element of `QQ[]`. I am not sure if the correction should be made in the instantiation code of `DynamicalSystem` or just a special case in `nth_iterate_map()`, but either way it is not a part of this ticket.\n\nI also removed the special case of splitting field being called on a constant polynomial and just returning the base field. Instead, I removed this case to make it more uniform in what objects we are returning. So if the field of definition is `QQ`, we will get back a \"`NumberField` with defining polynomial `x`\". One option would be to internally call splitting_field and then check if the defining polynomial of the returned number field is degree 1, so that we could return `QQ` or whatever the given base field was, but not sure if it is worth it. \n\nLet me know if this latest commit passes your tests as well.",
    "created_at": "2018-08-09T05:55:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361758",
    "user": "@Loops7"
}
```

Alright, I made the changes you mentioned, including getting rid of `n` altogether in critical, since that makes the most sense to me. The error you encountered was from the added snippet in preimage in the previous commit:



```
point = (point, 1)
```

This handled the case of a defining a `point[1]` that can be used in the construction of a polynomial given a point on the affine line. However, I corrected it to 



```
point = (point[0], 1)
```

which ensures that the new point object has the right type of object in the first slot, namely an element of the base field. 

Given our previous conversation, I also corrected the coordinate ring to be 

```
CR = ds.domain().ambient_space().coordinate_ring()
```

which fixed a couple edge cases I uncovered. 

The only failure I had left was 



```
A.<z> = AffineSpace(QQ,1)
f = DynamicalSystem_affine([1], A)
f.field_of_definition_preimage(2, A(1))
```


However, this error stems from the `nth_iterate_map()` code, since it takes `1` as an integer instead of an element of `QQ[]`. I am not sure if the correction should be made in the instantiation code of `DynamicalSystem` or just a special case in `nth_iterate_map()`, but either way it is not a part of this ticket.

I also removed the special case of splitting field being called on a constant polynomial and just returning the base field. Instead, I removed this case to make it more uniform in what objects we are returning. So if the field of definition is `QQ`, we will get back a "`NumberField` with defining polynomial `x`". One option would be to internally call splitting_field and then check if the defining polynomial of the returned number field is degree 1, so that we could return `QQ` or whatever the given base field was, but not sure if it is worth it. 

Let me know if this latest commit passes your tests as well.



---

archive/issue_comments_361759.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-09T05:58:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361759",
    "user": "@Loops7"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_361760.json:
```json
{
    "body": "All my tests pass with this version.\n\nyes, your one failure is an issue for a different ticket. I've made note of that example.\n\nIn regards to  \"Numberfield with defining polynomial x\". I personally find that annoying and would put in a check of the field degree and return QQ if it is degree 1.\n\nAlthough this led me to another interesting problem. splitting field only extends. What if the field of definition is smaller than the base_field because the coefficients of the map are actually defined over a subfield of the base field. See the next example. In this case we are not returning the object we claimed we were. We are a returning a field where all the *-points are defined, but not the minimal such field.\n\n```\nK.<v>=QuadraticField(-2)\nR.<z>=PolynomialRing(K)\nh=(z^2-1)\nh.splitting_field('v')\n```\n\nIt may be sufficient just to note in the documentation that this function only extends on so may not return the minimal such field if it is a subfield of the base. There is a plan for a function the changes the base to the minimal base for the given coefficients, but it hasn't been implemented yet. So users looking for the minimal such field would be able to first call that function and then this one.",
    "created_at": "2018-08-09T13:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361760",
    "user": "bhutz"
}
```

All my tests pass with this version.

yes, your one failure is an issue for a different ticket. I've made note of that example.

In regards to  "Numberfield with defining polynomial x". I personally find that annoying and would put in a check of the field degree and return QQ if it is degree 1.

Although this led me to another interesting problem. splitting field only extends. What if the field of definition is smaller than the base_field because the coefficients of the map are actually defined over a subfield of the base field. See the next example. In this case we are not returning the object we claimed we were. We are a returning a field where all the *-points are defined, but not the minimal such field.

```
K.<v>=QuadraticField(-2)
R.<z>=PolynomialRing(K)
h=(z^2-1)
h.splitting_field('v')
```

It may be sufficient just to note in the documentation that this function only extends on so may not return the minimal such field if it is a subfield of the base. There is a plan for a function the changes the base to the minimal base for the given coefficients, but it hasn't been implemented yet. So users looking for the minimal such field would be able to first call that function and then this one.



---

archive/issue_comments_361761.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-15T01:44:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361761",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361762.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-15T01:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361762",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361763.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-15T14:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361763",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_361764.json:
```json
{
    "body": "A number of issues came up in my testing;\n\n----\nwhy is this part of the doctests??\n\n\n```\nsage: R.<z> = G[]\nsage: R.irreducible_element(3, algorithm = 'first_lexicographic')\nz^3 + (a + 1)*z + a\n```\n\ndoesn't seem like it is relevant\n\n----\nno spaces in parameter assignment such as for\n\n```\ndomain = A\n```\n\nThere are many instances of this for all the parameters\n----\n\nthe doc says 'which all periodic points of the ``n``-th iterate are defined'. Which is not quite accurate.\n\neither 'all fixed points of the nth iterate' or 'all points with period (dividing) n'.\n\n----\n\nsome notebook failures\n\n- didn't import QQ\n\n```\nP.<x,y> = ProjectiveSpace(QQ, 1)\nf = DynamicalSystem([x^2, y^2], domain = P)\nN.<a> = f.field_of_definition_periodic(1); N\n```\n\n\n- can't deal with returning the embedding\n\n```\nP.<x,y> = ProjectiveSpace(QQ, 1)\nf = DynamicalSystem([x^2+y^2, y^2], domain = P)\nN.<a> = f.field_of_definition_periodic(2, formal=False, return_embedding=True); N\n```\n\n\n\n----\ndoctests could be a little more thorough\n\n- utilize all the parameters\n- check that when changing to the field of definition you get all the points (can just count)\n  * `2d-2` for critical\n  * `d^n + 1` for periodic (formal = False)\n  * preimages (`d^n` if not a critical point)\n\n----\nNotice that the rational_preimages function has the parameters in the opposite order\n\n\n```\nP.<x,y> = ProjectiveSpace(QQ, 1)\nf = DynamicalSystem([x^2+y^2, y^2], domain = P)\nN.<a> = f.field_of_definition_preimage(2,P(0));N\ng = f.change_ring(N)\ng.rational_preimages(P(0),2)\n```\n\n\nwould be better if they matched",
    "created_at": "2018-08-15T14:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361764",
    "user": "bhutz"
}
```

A number of issues came up in my testing;

----
why is this part of the doctests??


```
sage: R.<z> = G[]
sage: R.irreducible_element(3, algorithm = 'first_lexicographic')
z^3 + (a + 1)*z + a
```

doesn't seem like it is relevant

----
no spaces in parameter assignment such as for

```
domain = A
```

There are many instances of this for all the parameters
----

the doc says 'which all periodic points of the ``n``-th iterate are defined'. Which is not quite accurate.

either 'all fixed points of the nth iterate' or 'all points with period (dividing) n'.

----

some notebook failures

- didn't import QQ

```
P.<x,y> = ProjectiveSpace(QQ, 1)
f = DynamicalSystem([x^2, y^2], domain = P)
N.<a> = f.field_of_definition_periodic(1); N
```


- can't deal with returning the embedding

```
P.<x,y> = ProjectiveSpace(QQ, 1)
f = DynamicalSystem([x^2+y^2, y^2], domain = P)
N.<a> = f.field_of_definition_periodic(2, formal=False, return_embedding=True); N
```



----
doctests could be a little more thorough

- utilize all the parameters
- check that when changing to the field of definition you get all the points (can just count)
  * `2d-2` for critical
  * `d^n + 1` for periodic (formal = False)
  * preimages (`d^n` if not a critical point)

----
Notice that the rational_preimages function has the parameters in the opposite order


```
P.<x,y> = ProjectiveSpace(QQ, 1)
f = DynamicalSystem([x^2+y^2, y^2], domain = P)
N.<a> = f.field_of_definition_preimage(2,P(0));N
g = f.change_ring(N)
g.rational_preimages(P(0),2)
```


would be better if they matched



---

archive/issue_comments_361765.json:
```json
{
    "body": "The reason I had the bit about the irreducible element in there was because I figured these are technically examples instead of tests, so it would give some indication as to where the defining equation of the dynamical system came from, and that we actually need a field extension. \n\nI now remember why I removed the QQ case in the first place- it was because of the exact embedding inconsistency you pointed out, but I guess we can just return End(QQ)(1). \n\nAs far as the preimage parameter ordering, I initially did that to remain consistent with the other field_of_def methods, where `n` is the first parameter. It can be changed though. \n\n\n\n```\nsage: P.<x,y> = ProjectiveSpace(QQ, 1)\nsage: f = DynamicalSystem([1/3*x^3 + x*y^2, y^3], domain=P)\nsage: f.critical_points()\n[(1 : 0)]\nsage: N.<a> = f.field_of_definition_critical(); N\nNumber Field in a with defining polynomial x^2 + 1\nsage: g = f.change_ring(N)\nsage: g.critical_points()\n[(-a : 1), (a : 1), (1 : 0)]\n```\n\n\nDoes (1:0) have multiplicity 2 here, so that we satisfy the 2d-2 requirement? If so, why?",
    "created_at": "2018-08-16T04:50:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361765",
    "user": "@Loops7"
}
```

The reason I had the bit about the irreducible element in there was because I figured these are technically examples instead of tests, so it would give some indication as to where the defining equation of the dynamical system came from, and that we actually need a field extension. 

I now remember why I removed the QQ case in the first place- it was because of the exact embedding inconsistency you pointed out, but I guess we can just return End(QQ)(1). 

As far as the preimage parameter ordering, I initially did that to remain consistent with the other field_of_def methods, where `n` is the first parameter. It can be changed though. 



```
sage: P.<x,y> = ProjectiveSpace(QQ, 1)
sage: f = DynamicalSystem([1/3*x^3 + x*y^2, y^3], domain=P)
sage: f.critical_points()
[(1 : 0)]
sage: N.<a> = f.field_of_definition_critical(); N
Number Field in a with defining polynomial x^2 + 1
sage: g = f.change_ring(N)
sage: g.critical_points()
[(-a : 1), (a : 1), (1 : 0)]
```


Does (1:0) have multiplicity 2 here, so that we satisfy the 2d-2 requirement? If so, why?



---

archive/issue_comments_361766.json:
```json
{
    "body": "For the embedding, I think it's best to use\n\n```\nds.base_ring().embeddings(QQ)[0]\n```\n\nSince there will be a unique embedding of a degree 1 number field into QQ, this works regardless of what form the base ring is in.\n\n\nYes, infty has multiplicity 2. The binary form defining the critical points will have a factor of `y^2` in it. Alternatively, if you prefer to work with affine points, dehomogenize at coordinate 0, then infty is 0 in that affine patch and you can check that 0 is a double root of the resulting critical point polynomial.",
    "created_at": "2018-08-16T15:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361766",
    "user": "bhutz"
}
```

For the embedding, I think it's best to use

```
ds.base_ring().embeddings(QQ)[0]
```

Since there will be a unique embedding of a degree 1 number field into QQ, this works regardless of what form the base ring is in.


Yes, infty has multiplicity 2. The binary form defining the critical points will have a factor of `y^2` in it. Alternatively, if you prefer to work with affine points, dehomogenize at coordinate 0, then infty is 0 in that affine patch and you can check that 0 is a double root of the resulting critical point polynomial.



---

archive/issue_comments_361767.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-21T05:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361767",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361768.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-28T07:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361768",
    "user": "@Loops7"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_361769.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-08-28T12:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361769",
    "user": "bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_361770.json:
```json
{
    "body": "Functionality is looking good here. A few minor typographical issues\n\n- in a number of places the INPUT specifies number fields when it works for finite fields as well.\n\n- the comment\n\n```\nNote that the number of critical points is 2d-2, but (1:0) has multiplicity 2 in this case\n```\n\nshould go before the example not after\n\n```\nEXAMPLES: \n\nNote that the number of critical points is 2d-2, but (1:0) has multiplicity 2 in this case::\n\n    sage:\n```\n\n\n- dimension not degree in the 2 error messages\n\n```\nnot implemented for affine or projective spaces of degree >1\n```\n",
    "created_at": "2018-08-28T12:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361770",
    "user": "bhutz"
}
```

Functionality is looking good here. A few minor typographical issues

- in a number of places the INPUT specifies number fields when it works for finite fields as well.

- the comment

```
Note that the number of critical points is 2d-2, but (1:0) has multiplicity 2 in this case
```

should go before the example not after

```
EXAMPLES: 

Note that the number of critical points is 2d-2, but (1:0) has multiplicity 2 in this case::

    sage:
```


- dimension not degree in the 2 error messages

```
not implemented for affine or projective spaces of degree >1
```




---

archive/issue_comments_361771.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-08-30T05:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361771",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_361772.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-08-30T05:20:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361772",
    "user": "@Loops7"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_361773.json:
```json
{
    "body": "Looks good. Just made some minor doc updates. If you're fine with those, we can mark this positive.\n----\nNew commits:",
    "created_at": "2018-08-30T15:25:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361773",
    "user": "bhutz"
}
```

Looks good. Just made some minor doc updates. If you're fine with those, we can mark this positive.
----
New commits:



---

archive/issue_comments_361774.json:
```json
{
    "body": "Looks good to me.",
    "created_at": "2018-09-03T20:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361774",
    "user": "@Loops7"
}
```

Looks good to me.



---

archive/issue_comments_361775.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-09-03T20:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361775",
    "user": "@Loops7"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_361776.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-09-05T16:43:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25649",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25649#issuecomment-361776",
    "user": "vbraun"
}
```

Resolution: fixed
