# Issue 19303: AsymptoticExpansion.factorial

archive/issues_019303.json:
```json
{
    "body": "CC:  behackl cheuberg\n\nUse existing Stirling approximation to calculate the factorial.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19540\n\n",
    "created_at": "2015-11-07T00:24:45Z",
    "labels": [
        "asymptotic expansions",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "AsymptoticExpansion.factorial",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19303",
    "user": "dkrenn"
}
```
CC:  behackl cheuberg

Use existing Stirling approximation to calculate the factorial.

Issue created by migration from https://trac.sagemath.org/ticket/19540





---

archive/issue_comments_265078.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2015-11-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265078",
    "user": "dkrenn"
}
```

Last 10 new commits:



---

archive/issue_comments_265079.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-11-07T00:25:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265079",
    "user": "dkrenn"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_265080.json:
```json
{
    "body": "In principle, this would be fine; however, the following example fails:\n\n```\nsage: A.<m> = AsymptoticRing('m^QQ', QQ)\nsage: m.factorial()\nTraceback (most recent call last):\n...\nTypeError: ...\n>>>>>> *previous* ArithmeticError: Cannot build log(m)\nsince log(m) is not in Growth Group\nm^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.\n```\n\nThe problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.\nAnd if we have something like `log(m).factorial()`, then everything gets more involved.\nThis either needs to be fixed or documented.",
    "created_at": "2016-02-04T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265080",
    "user": "cheuberg"
}
```

In principle, this would be fine; however, the following example fails:

```
sage: A.<m> = AsymptoticRing('m^QQ', QQ)
sage: m.factorial()
Traceback (most recent call last):
...
TypeError: ...
>>>>>> *previous* ArithmeticError: Cannot build log(m)
since log(m) is not in Growth Group
m^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.
```

The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.
And if we have something like `log(m).factorial()`, then everything gets more involved.
This either needs to be fixed or documented.



---

archive/issue_comments_265081.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-04T16:03:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265081",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_265082.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-15T09:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265082",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265083.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-15T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265083",
    "user": "dkrenn"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_265084.json:
```json
{
    "body": "Replying to [comment:3 cheuberg]:\n> In principle, this would be fine; however, the following example fails:\n> {{{\n> sage: A.<m> = AsymptoticRing('m^QQ', QQ)\n> sage: m.factorial()\n> Traceback (most recent call last):\n> ...\n> TypeError: ...\n> >>>>>> *previous* ArithmeticError: Cannot build log(m)\n> since log(m) is not in Growth Group\n> m^QQ * (e<sup>(n*log(n)))</sup>QQ * (e<sup>n)</sup>QQ * n^QQ * log(n)^QQ.\n> }}}\n> The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.\n\nCorrected (needed more rewriting than thought, but now `factorial` can do much better)\n\n> And if we have something like `log(m).factorial()`, then everything gets more involved.\n> This either needs to be fixed or documented.\n\nDocumented.",
    "created_at": "2016-02-15T09:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265084",
    "user": "dkrenn"
}
```

Replying to [comment:3 cheuberg]:
> In principle, this would be fine; however, the following example fails:
> {{{
> sage: A.<m> = AsymptoticRing('m^QQ', QQ)
> sage: m.factorial()
> Traceback (most recent call last):
> ...
> TypeError: ...
> >>>>>> *previous* ArithmeticError: Cannot build log(m)
> since log(m) is not in Growth Group
> m^QQ * (e<sup>(n*log(n)))</sup>QQ * (e<sup>n)</sup>QQ * n^QQ * log(n)^QQ.
> }}}
> The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.

Corrected (needed more rewriting than thought, but now `factorial` can do much better)

> And if we have something like `log(m).factorial()`, then everything gets more involved.
> This either needs to be fixed or documented.

Documented.



---

archive/issue_comments_265085.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2016-02-15T09:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265085",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_265086.json:
```json
{
    "body": "Merged #19944 due to conflicts.",
    "created_at": "2016-02-15T09:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265086",
    "user": "dkrenn"
}
```

Merged #19944 due to conflicts.



---

archive/issue_comments_265087.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-02-16T15:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265087",
    "user": "cheuberg"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_265088.json:
```json
{
    "body": "1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.\n2. Why can't a generic growth element decide on its own? It could simply call\n\n```\nif self.is_one():\n   return tuple()\nelse:\n   return self.parent()._var_.variable_names()\n```\n\n   which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...\n\nThe rest is fine for me.",
    "created_at": "2016-02-16T15:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265088",
    "user": "cheuberg"
}
```

1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
2. Why can't a generic growth element decide on its own? It could simply call

```
if self.is_one():
   return tuple()
else:
   return self.parent()._var_.variable_names()
```

   which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...

The rest is fine for me.



---

archive/issue_comments_265089.json:
```json
{
    "body": "Replying to [comment:9 cheuberg]:\n> 1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.\n> 2. Why can't a generic growth element decide on its own? It could simply call\n> {{{\n> if self.is_one():\n>    return tuple()\n> else:\n>    return self.parent()._var_.variable_names()\n> }}}\n>    which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...\n\n1+2: In the way it is it allows to build `n.factorial()` starting in `AsymptoticRing('m^QQ * n^QQ', QQ)`; `self.parent().variable_names()` would not allow this.",
    "created_at": "2016-02-16T15:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265089",
    "user": "dkrenn"
}
```

Replying to [comment:9 cheuberg]:
> 1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
> 2. Why can't a generic growth element decide on its own? It could simply call
> {{{
> if self.is_one():
>    return tuple()
> else:
>    return self.parent()._var_.variable_names()
> }}}
>    which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...

1+2: In the way it is it allows to build `n.factorial()` starting in `AsymptoticRing('m^QQ * n^QQ', QQ)`; `self.parent().variable_names()` would not allow this.



---

archive/issue_comments_265090.json:
```json
{
    "body": "1. This would not change functionality, but the parent has a method, why not calling it.\n2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.",
    "created_at": "2016-02-16T17:13:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265090",
    "user": "cheuberg"
}
```

1. This would not change functionality, but the parent has a method, why not calling it.
2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.



---

archive/issue_comments_265091.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-16T19:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265091",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_265092.json:
```json
{
    "body": "Replying to [comment:11 cheuberg]:\n> 1. This would not change functionality, but the parent has a method, why not calling it.\n> 2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.\n\nNow I understand. Code rewritten.",
    "created_at": "2016-02-16T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265092",
    "user": "dkrenn"
}
```

Replying to [comment:11 cheuberg]:
> 1. This would not change functionality, but the parent has a method, why not calling it.
> 2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.

Now I understand. Code rewritten.



---

archive/issue_comments_265093.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-02-16T19:26:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265093",
    "user": "dkrenn"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_265094.json:
```json
{
    "body": "I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.\n\nI noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says \"It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified.\" which is a relict from the past.\n\nFurthermore, we have\n\n```\n    # set everything up to determine category\n    from sage.categories.sets_cat import Sets\n    from sage.categories.posets import Posets\n    from sage.categories.magmas import Magmas\n    from sage.categories.additive_magmas import AdditiveMagmas\n```\n\nin the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.\n\nShall we fix those in a separate ticket or right here?\n\nPlease cross-review my commit and set to positive_review if you are satisfied.\n----\nNew commits:",
    "created_at": "2016-02-17T16:32:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265094",
    "user": "cheuberg"
}
```

I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.

I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.

Furthermore, we have

```
    # set everything up to determine category
    from sage.categories.sets_cat import Sets
    from sage.categories.posets import Posets
    from sage.categories.magmas import Magmas
    from sage.categories.additive_magmas import AdditiveMagmas
```

in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.

Shall we fix those in a separate ticket or right here?

Please cross-review my commit and set to positive_review if you are satisfied.
----
New commits:



---

archive/issue_comments_265095.json:
```json
{
    "body": "Replying to [comment:15 cheuberg]:\n> I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.\n> \n> I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says \"It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified.\" which is a relict from the past.\n> \n> Furthermore, we have\n> {{{\n>     # set everything up to determine category\n>     from sage.categories.sets_cat import Sets\n>     from sage.categories.posets import Posets\n>     from sage.categories.magmas import Magmas\n>     from sage.categories.additive_magmas import AdditiveMagmas\n> }}}\n> in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.\n> \n> Shall we fix those in a separate ticket or right here?\n\nThis is now #20077.\n\n> Please cross-review my commit and set to positive_review if you are satisfied.\n\nDone.",
    "created_at": "2016-02-17T18:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265095",
    "user": "dkrenn"
}
```

Replying to [comment:15 cheuberg]:
> I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.
> 
> I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.
> 
> Furthermore, we have
> {{{
>     # set everything up to determine category
>     from sage.categories.sets_cat import Sets
>     from sage.categories.posets import Posets
>     from sage.categories.magmas import Magmas
>     from sage.categories.additive_magmas import AdditiveMagmas
> }}}
> in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.
> 
> Shall we fix those in a separate ticket or right here?

This is now #20077.

> Please cross-review my commit and set to positive_review if you are satisfied.

Done.



---

archive/issue_comments_265096.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-17T18:38:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265096",
    "user": "dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_265097.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-18T08:24:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19303",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19303#issuecomment-265097",
    "user": "vbraun"
}
```

Resolution: fixed
