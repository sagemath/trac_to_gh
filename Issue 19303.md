# Issue 19303: AsymptoticExpansion.factorial

Issue created by migration from Trac.

Original creator: dkrenn

Original creation time: 2015-11-07 00:24:45

CC:  behackl cheuberg

Use existing Stirling approximation to calculate the factorial.


---

Comment by dkrenn created at 2015-11-07 00:25:36

Last 10 new commits:


---

Comment by dkrenn created at 2015-11-07 00:25:36

Changing status from new to needs_review.


---

Comment by cheuberg created at 2016-02-04 16:03:25

In principle, this would be fine; however, the following example fails:

```
sage: A.<m> = AsymptoticRing('m^QQ', QQ)
sage: m.factorial()
Traceback (most recent call last):
...
TypeError: ...
>>>>>> *previous* ArithmeticError: Cannot build log(m)
since log(m) is not in Growth Group
m^QQ * (e^(n*log(n)))^QQ * (e^n)^QQ * n^QQ * log(n)^QQ.
```

The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.
And if we have something like `log(m).factorial()`, then everything gets more involved.
This either needs to be fixed or documented.


---

Comment by cheuberg created at 2016-02-04 16:03:25

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-02-15 09:32:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-15 09:33:56

Changing status from needs_work to needs_review.


---

Comment by dkrenn created at 2016-02-15 09:33:56

Replying to [comment:3 cheuberg]:
> In principle, this would be fine; however, the following example fails:
> {{{
> sage: A.<m> = AsymptoticRing('m^QQ', QQ)
> sage: m.factorial()
> Traceback (most recent call last):
> ...
> TypeError: ...
> >>>>>> *previous* ArithmeticError: Cannot build log(m)
> since log(m) is not in Growth Group
> m^QQ * (e<sup>(n*log(n)))</sup>QQ * (e<sup>n)</sup>QQ * n^QQ * log(n)^QQ.
> }}}
> The problem is that the method tries to build the correct growth group in `n` (hard-coded) but has no influence on the given growth group.

Corrected (needed more rewriting than thought, but now `factorial` can do much better)

> And if we have something like `log(m).factorial()`, then everything gets more involved.
> This either needs to be fixed or documented.

Documented.


---

Comment by git created at 2016-02-15 09:47:04

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by dkrenn created at 2016-02-15 09:47:38

Merged #19944 due to conflicts.


---

Comment by cheuberg created at 2016-02-16 15:52:45

Changing status from needs_review to needs_info.


---

Comment by cheuberg created at 2016-02-16 15:52:45

1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
2. Why can't a generic growth element decide on its own? It could simply call

```
if self.is_one():
   return tuple()
else:
   return self.parent()._var_.variable_names()
```

   which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...

The rest is fine for me.


---

Comment by dkrenn created at 2016-02-16 15:56:37

Replying to [comment:9 cheuberg]:
> 1. The growth elements call `self.parent()._var_.variable_names()`. I am wondering why they do not simply call `self.parent().variable_names()`.
> 2. Why can't a generic growth element decide on its own? It could simply call
> {{{
> if self.is_one():
>    return tuple()
> else:
>    return self.parent()._var_.variable_names()
> }}}
>    which would probably end in a desaster if called on a generic growth element, but we are not supposed to instantiate generic growth elements anyway ...

1+2: In the way it is it allows to build `n.factorial()` starting in `AsymptoticRing('m^QQ * n^QQ', QQ)`; `self.parent().variable_names()` would not allow this.


---

Comment by cheuberg created at 2016-02-16 17:13:08

1. This would not change functionality, but the parent has a method, why not calling it.
2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.


---

Comment by git created at 2016-02-16 19:25:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dkrenn created at 2016-02-16 19:26:54

Replying to [comment:11 cheuberg]:
> 1. This would not change functionality, but the parent has a method, why not calling it.
> 2. The generic implementation proposed here would be usable for all growth groups except products, but those have to implement their own method anyway.

Now I understand. Code rewritten.


---

Comment by dkrenn created at 2016-02-16 19:26:54

Changing status from needs_info to needs_review.


---

Comment by cheuberg created at 2016-02-17 16:32:57

I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.

I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.

Furthermore, we have

```
    # set everything up to determine category
    from sage.categories.sets_cat import Sets
    from sage.categories.posets import Posets
    from sage.categories.magmas import Magmas
    from sage.categories.additive_magmas import AdditiveMagmas
```

in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.

Shall we fix those in a separate ticket or right here?

Please cross-review my commit and set to positive_review if you are satisfied.
----
New commits:


---

Comment by dkrenn created at 2016-02-17 18:38:58

Replying to [comment:15 cheuberg]:
> I added a doctest because I wanted to know what happens for a generic growth group. At first glance, it was surprising that I do get an `AttributeError` instead of a `NotImplementedError`. The method `is_one` seems to be contributed by the category.
> 
> I noticed that the docstring of `GenericGrowthGroup` (and the other growth groups) says "It has to be a subcategory of Join of Category of groups and Category of posets. This is also the default category if None is specified." which is a relict from the past.
> 
> Furthermore, we have
> {{{
>     # set everything up to determine category
>     from sage.categories.sets_cat import Sets
>     from sage.categories.posets import Posets
>     from sage.categories.magmas import Magmas
>     from sage.categories.additive_magmas import AdditiveMagmas
> }}}
> in the class `GenericGrowthGroup` which shows all these Categories in the documentation, similar as #20045.
> 
> Shall we fix those in a separate ticket or right here?

This is now #20077.

> Please cross-review my commit and set to positive_review if you are satisfied.

Done.


---

Comment by dkrenn created at 2016-02-17 18:38:58

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-02-18 08:24:44

Resolution: fixed
