# Issue 31079: Method subs() ineffective on tensor fields

Issue created by migration from https://trac.sagemath.org/ticket/31316

Original creator: egourgoulhon

Original creation time: 2021-02-01 14:38:05

CC:  tscrim @mjungmath

Keywords: tensor field, subs, substitution

As reported in this [ask.sagemath question](https://ask.sagemath.org/question/55527/subs-in-vector-field/), tensor fields are endowed with a method `subs()` which is totally ineffective:


```
sage: E.<x,y> = EuclideanSpace()                                                                    
sage: a = var('a')                                                                                  
sage: v = E.vector_field(a*x, a^2 + y)                                                              
sage: v.display()                                                                                   
a*x e_x + (a^2 + y) e_y
sage: v.subs(a==1)                                                                                  
Vector field on the Euclidean plane E^2
sage: v.display()                                                                                   
a*x e_x + (a^2 + y) e_y
```

This is because `subs()` is inherited from the generic base class `Element` and the code of `Element.subs()` has

```
        parent = self._parent
        try:
            ngens = parent.ngens()
        except (AttributeError, NotImplementedError, TypeError):
            return self
```

Since `v.parent().ngens()` returns an `AttributeError`, this explains the silent failure. 



Currently, the required substitution can be achieved by means of the method `apply_map`:

```
sage: v.apply_map(lambda comp: comp.subs(a==1))                                                     
sage: v.display()                                                                                   
x e_x + (y + 1) e_y
```





---

Comment by @mjungmath created at 2021-02-01 15:43:21

We could simply overload `subs` and delegate this to `apply_map`? Or is there a more effective way?


---

Comment by egourgoulhon created at 2021-02-01 15:55:44

Replying to [comment:2 gh-mjungmath]:
> We could simply overload `subs` and delegate this to `apply_map`? 
Yes this is probably the route to go.


---

Comment by egourgoulhon created at 2021-02-01 15:57:41

Also, in another ticket, we could question the current treatment of  `AttributeError` in `Element.subs()` as `return self`.


---

Comment by tscrim created at 2021-02-07 22:35:39

Note that I would not expect `v.subs(a==1)` to do a substitution because it is passing in an expression `a == 1`, rather than setting a keyword `a=1`. Count the number of equals.


---

Comment by @DaveWitteMorris created at 2021-02-08 08:09:58

The `subs` method of elements of `SR` does allow (and document) this syntax, so it would make sense to allow it here, too.

```
sage: var('t');
sage: cos(x).subs(x==sin(t))
cos(sin(t))
```



---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.
