# Issue 15014: minor Steenrod algebra fixes

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2013-10-02 18:25:28

The attached patch makes some minor changes to the Steenrod algebra code:

- changes a few docstrings and comments
- one bug fix (to make `SteenrodAlgebra(2, 'wood')` raise a more meaningful error) with doctest
- cache the function `arnonC_basis` for a speed improvement. Before:

```
sage: %time B = SteenrodAlgebra(basis='arnon_c').basis(20)
CPU times: user 2.44 s, sys: 0.17 s, total: 2.60 s
Wall time: 2.51 s
sage: %time B = SteenrodAlgebra(basis='arnon_c').basis(100) # takes a loooong time
```

 After:

```
sage: %time B = SteenrodAlgebra(basis='arnon_c').basis(20)
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 0.01 s
sage: %time B = SteenrodAlgebra(basis='arnon_c').basis(100)
CPU times: user 0.57 s, sys: 0.10 s, total: 0.67 s
Wall time: 0.60 s
```




---

Attachment


---

Comment by jhpalmieri created at 2014-01-31 19:30:08

New commits:


---

Comment by jhpalmieri created at 2014-01-31 19:30:08

Changing status from new to needs_review.


---

Comment by cnassau created at 2014-04-30 13:36:18

I tested this patch against 6.2.beta8 and got this error in `steenrod_algebra_misc.py`


```
Failed example:
    get_basis_name('wood', 2)
Expected:
    Traceback (most recent call last):
    ...
    ValueError: wood is not a recognized basis at the prime 2.
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/waste/cn/sage-6.2.beta8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 480, in _run
        self.execute(example, compiled, test.globs)
      File "/waste/cn/sage-6.2.beta8/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 839, in execute
        exec compiled in globs
      File "<doctest sage.algebras.steenrod.steenrod_algebra_misc.get_basis_name[6]>", line 1, in <module>
        get_basis_name('wood', Integer(2))
      File "/waste/cn/sage-6.2.beta8/local/lib/python2.7/site-packages/sage/algebras/steenrod/steenrod_algebra_misc.py", line 166, in get_basis_name
        return result
    UnboundLocalError: local variable 'result' referenced before assignment
```


The problem is the block

```
    elif p == 2 and basis.find('wood') >= 0:
        if basis.find('y') >= 0:
            result = 'woody'
        elif basis.find('z') >= 0:
            result = 'woodz'
```

This does neither set `result` nor raise an error.


---

Comment by cnassau created at 2014-04-30 13:36:18

Changing status from needs_review to needs_work.


---

Comment by jhpalmieri created at 2014-04-30 17:22:41

I'm confused, because the next lines in the block should be

```
        else:
             raise ValueError("%s is not a recognized basis at the prime %s." % (basis, p))
```

(Precisely these lines, plus the doctest, were added to that file in this branch.) That is, it should never reach the line `return result`. All tests pass for me. Did you run `sage -b`?


---

Comment by cnassau created at 2014-04-30 17:43:47

I did indeed forget to run `sage -b` - and now that I re-read the code I think that everything should be ok as it is.

Unfortunately, I get lots of strange compilation errors when I run `sage -b` which must be totally unrelated to your fixes. I'll return to the ticket when I've figured out why my installation(s) seem to be broken...


---

Comment by jhpalmieri created at 2014-04-30 18:29:22

You may have done this already, but after checking out this branch, merge with the develop branch and run `make`, not just `sage -b`. Switching between branches can affect not just the Sage library files, but also the other parts of Sage, so running `make` will ensure that any changes are taken into account.


---

Comment by cnassau created at 2014-05-01 10:08:38

Alright, I now understand that following the dev guide I'm actually reviewing this ticket as a patch _on top of Sage 6.1_, and that's what necessitates a long running 'make' before the 'sage -b'. In my opinion it would be a lot better to somehow first re-base the patch to the current development head, so that a simple 'sage -b' would suffice. But maybe I'm still not understanding the git review process correctly...


---

Comment by cnassau created at 2014-05-01 10:10:09

Changing status from needs_work to positive_review.


---

Comment by cnassau created at 2014-05-01 10:10:09

In any case, after running 'make' and 'sage -b' all tests pass on my system. Since the changes are all straightforward I'll give this a positive review.


---

Comment by vbraun created at 2014-05-04 13:56:32

Resolution: fixed
