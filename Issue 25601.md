# Issue 25601: sagemath does not translate function('F') to F := operator "F" for fricas interface

Issue created by migration from https://trac.sagemath.org/ticket/25838

Original creator: @nasser1

Original creation time: 2018-07-12 01:46:26

CC:  rws

Keywords: integrate, fricas

When using algorithm="fricas" in integrate, I defined F as function in sagemath. BUt when the call is made to integrate using fricas, it did  not seem to be translated correctly to fricas syntax, which is 
   

```
F := operator "F"
```


So fricas was not happy. 



```
>sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 8.3.rc0, Release Date: 2018-07-08                 │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: var('x')
x
sage: F=function('F')
sage: integrate(F(x),x,algorithm="fricas")

.....
TypeError: An error occurred when FriCAS evaluated 'F(x)':

```


The Fricas syntax using Fricas directly is




```
>fricas
Checking for foreign routines
AXIOM="/usr/lib/fricas/target/x86_64-linux-gnu"
spad-lib="/usr/lib/fricas/target/x86_64-linux-gnu/lib/libspad.so"
                       FriCAS Computer Algebra System 
                            Version: FriCAS 1.3.4
                   Timestamp: Thu Jun 28 08:31:47 CDT 2018
------------------------------------------------------------------- 

(1) -> F := operator "F"

   (1)  F
                                                          Type: BasicOperator
(2) -> integrate(F(x),x)

           x
         ++
   (2)   |   F(%A)d%A
        ++
                                         Type: Union(Expression(Integer),...)

```



So many such integrals that use generic function such as the above now fail in sagemath when using FriCAS algorithm because it is not translated correctly.

Thank you

--Nasser


---

Comment by @nasser1 created at 2018-07-12 01:48:08

Changing type from PLEASE CHANGE to defect.


---

Comment by mantepse created at 2018-07-12 09:15:51

I will work on this once #25602 is reviewed.  It is not hard.


---

Comment by mantepse created at 2018-07-13 08:46:18

Changing status from new to needs_review.


---

Comment by mantepse created at 2018-07-13 08:46:18

New commits:


---

Comment by tscrim created at 2018-07-23 11:24:08

Changing keywords from "integrate, fricas" to "integrate, fricas, sagedays@icerm".


---

Comment by tscrim created at 2018-07-23 11:24:08

One (trivial, looks like a bad copy/paste) doctest failure here:

```
    def derivative(self, ex, operator):
        """
        Convert the derivative of ``self`` in FriCAS.

        INPUT:

        - ``ex`` -- a symbolic expression

        - ``operator`` -- operator

        EXAMPLES::

            sage: var('x,y,z')
            (x, y)
```

Should be `(x, y, z)`.

Otherwise LGTM.


---

Comment by git created at 2018-07-23 11:41:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2018-07-23 12:14:03

Edge case for naming functions vs. variables:

```
sage: F=function('f')
sage: f=SR.var('f')
sage: F(f).diff(f).integrate(f)
f(f)
```

amazingly this actually works with the maxima interface because:

```
sage: maxima_calculus(F(f))
'f(_SAGE_VAR_f)
```



---

Comment by mantepse created at 2018-07-23 12:33:45

I'm not sure what I'm supposed to do.  This "works" with FriCAS, too:

```
sage: F=function('f')
sage: f=SR.var('f')
sage: fricas(F(f)).D(f).integrate(f)
f(f)
```

Am I missing something?  Oh yes, a missing import, fixed.


---

Comment by git created at 2018-07-23 12:39:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by nbruin created at 2018-07-24 04:34:36

Replying to [comment:8 mantepse]:
> I'm not sure what I'm supposed to do.  This "works" with FriCAS, too:
> Am I missing something?  Oh yes, a missing import, fixed.
OK, then it's fine. I don't have FriCAS installed, so I couldn't check. When I saw `F:= operator F` I figured some care should be taken to avoid name clashes, but apparently this is taken care of already.


---

Comment by mantepse created at 2018-07-24 10:43:00

review?


---

Comment by tscrim created at 2018-07-27 14:55:37

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2018-07-27 14:55:37

LGTM now, thanks.


---

Comment by mantepse created at 2018-07-27 16:19:31

Great, many thanks!  Once #25602 is reviewed, integration via FriCAS should be useful for quite a variety of integrands!


---

Comment by vbraun created at 2018-08-26 09:45:12

Merge conflict


---

Comment by vbraun created at 2018-08-26 09:45:12

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-08-26 17:52:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2018-08-26 17:52:48

trivial rebase


---

Comment by mantepse created at 2018-08-26 17:54:00

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-08-26 22:11:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-09-01 09:10:07

Resolution: fixed
