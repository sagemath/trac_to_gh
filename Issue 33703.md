# Issue 33703: enhance maple interface

archive/issues_033703.json:
```json
{
    "body": "CC:  tscrim. @slel @kliem @kwankyu @mezzarobba\n\nby trying to convert back functions names\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33940\n\n",
    "created_at": "2022-05-31T18:50:21Z",
    "labels": [
        "interfaces: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "enhance maple interface",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33703",
    "user": "@fchapoton"
}
```
CC:  tscrim. @slel @kliem @kwankyu @mezzarobba

by trying to convert back functions names



Issue created by migration from https://trac.sagemath.org/ticket/33940





---

archive/issue_comments_479485.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-05-31T18:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479485",
    "user": "@fchapoton"
}
```

New commits:



---

archive/issue_comments_479486.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-05-31T18:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479486",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_479487.json:
```json
{
    "body": "Changing keywords from \"\" to \"maple\".",
    "created_at": "2022-05-31T18:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479487",
    "user": "@fchapoton"
}
```

Changing keywords from "" to "maple".



---

archive/issue_comments_479488.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-31T19:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479488",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479489.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-05-31T19:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479489",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479490.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2022-06-01T05:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479490",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_479491.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-01T05:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479491",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479492.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-01T06:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479492",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479493.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-01T07:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479493",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479494.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-06-01T07:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479494",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_479495.json:
```json
{
    "body": "bot is morally green, ticket ready for review. A good step forward in the translation back from maple, I would say.",
    "created_at": "2022-06-01T13:44:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479495",
    "user": "@fchapoton"
}
```

bot is morally green, ticket ready for review. A good step forward in the translation back from maple, I would say.



---

archive/issue_comments_479496.json:
```json
{
    "body": "one could also treat \"Limit\" and \"limit\" in the same way, maybe.",
    "created_at": "2022-06-03T06:40:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479496",
    "user": "@fchapoton"
}
```

one could also treat "Limit" and "limit" in the same way, maybe.



---

archive/issue_comments_479497.json:
```json
{
    "body": "This is an improvement, though the conversion remains very fragile.\n\nOne thing I don't like is that the conversion  is based purely on the textual representation of the Maple expression and does not differentiate between global and local Maple symbols. For example, `maple(\"(proc() local zeta; return zeta; end)()(2)\").sage()` yields \u03c0\u00b2/6 although the Maple `zeta` we are converting is not the one bound to the zeta function. I do understand that fixing this is beyond the scope of this ticket, but I also believe that we should make the interface more robust before trying to extend it too much.\n\nCan you explain why you needed to do this\n\n```\n         BuiltinFunction.__init__(self, 'hurwitz_zeta', nargs=2,\n                                  conversions=dict(mathematica='HurwitzZeta',\n-                                                  maple='Zeta',\n+                                                  # maple='Zeta', conflict with zeta here\n                                                   sympy='zeta'),\n                                  latex_name=r'\\zeta')\n\n```\n\n?",
    "created_at": "2022-06-08T13:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479497",
    "user": "@mezzarobba"
}
```

This is an improvement, though the conversion remains very fragile.

One thing I don't like is that the conversion  is based purely on the textual representation of the Maple expression and does not differentiate between global and local Maple symbols. For example, `maple("(proc() local zeta; return zeta; end)()(2)").sage()` yields π²/6 although the Maple `zeta` we are converting is not the one bound to the zeta function. I do understand that fixing this is beyond the scope of this ticket, but I also believe that we should make the interface more robust before trying to extend it too much.

Can you explain why you needed to do this

```
         BuiltinFunction.__init__(self, 'hurwitz_zeta', nargs=2,
                                  conversions=dict(mathematica='HurwitzZeta',
-                                                  maple='Zeta',
+                                                  # maple='Zeta', conflict with zeta here
                                                   sympy='zeta'),
                                  latex_name=r'\zeta')

```

?



---

archive/issue_comments_479498.json:
```json
{
    "body": "I agree that this is not a solid conversion. Still better than previously.\n\nIt would be much more work to switch to something else, maybe some kind of standardized   API.\n\nFor the second point, we are hitting here a limitation of our conversion system. We use different names for Zeta (one parameter) and Hurwitz zeta (two parameters). Maple uses just one name. We cannot have both a correct conversion forward and a correct conversion backward, using just a dictionary of functions names. One solution would be to enhance our conversion system to be able to make different choices for different numbers of arguments. Not for this ticket, I would say\n\nFor the time being, I chose to give priority to Zeta over Hurwitz Zeta",
    "created_at": "2022-06-11T06:35:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479498",
    "user": "@fchapoton"
}
```

I agree that this is not a solid conversion. Still better than previously.

It would be much more work to switch to something else, maybe some kind of standardized   API.

For the second point, we are hitting here a limitation of our conversion system. We use different names for Zeta (one parameter) and Hurwitz zeta (two parameters). Maple uses just one name. We cannot have both a correct conversion forward and a correct conversion backward, using just a dictionary of functions names. One solution would be to enhance our conversion system to be able to make different choices for different numbers of arguments. Not for this ticket, I would say

For the time being, I chose to give priority to Zeta over Hurwitz Zeta



---

archive/issue_comments_479499.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-06-11T07:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479499",
    "user": "@mezzarobba"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_479500.json:
```json
{
    "body": "Replying to [comment:13 chapoton]:\n> I agree that this is not a solid conversion. Still better than previously.\n\nYes, I agree.\n\n> It would be much more work to switch to something else, maybe some kind of standardized   API.\n\nMaple actually has a C API that would make it easier to have a robust interface. But yes, that would require a bit of work, and it is not clear to me if we can use it without having Maple as a build-time dependency for the corresponding binary modules.\n\n> For the second point, we are hitting here a limitation of our conversion system. We use different names for Zeta (one parameter) and Hurwitz zeta (two parameters). Maple uses just one name. We cannot have both a correct conversion forward and a correct conversion backward, using just a dictionary of functions names. One solution would be to enhance our conversion system to be able to make different choices for different numbers of arguments. Not for this ticket, I would say\n> \n> For the time being, I chose to give priority to Zeta over Hurwitz Zeta\n\nOk, thanks for the explanation.",
    "created_at": "2022-06-11T07:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479500",
    "user": "@mezzarobba"
}
```

Replying to [comment:13 chapoton]:
> I agree that this is not a solid conversion. Still better than previously.

Yes, I agree.

> It would be much more work to switch to something else, maybe some kind of standardized   API.

Maple actually has a C API that would make it easier to have a robust interface. But yes, that would require a bit of work, and it is not clear to me if we can use it without having Maple as a build-time dependency for the corresponding binary modules.

> For the second point, we are hitting here a limitation of our conversion system. We use different names for Zeta (one parameter) and Hurwitz zeta (two parameters). Maple uses just one name. We cannot have both a correct conversion forward and a correct conversion backward, using just a dictionary of functions names. One solution would be to enhance our conversion system to be able to make different choices for different numbers of arguments. Not for this ticket, I would say
> 
> For the time being, I chose to give priority to Zeta over Hurwitz Zeta

Ok, thanks for the explanation.



---

archive/issue_comments_479501.json:
```json
{
    "body": "merci !",
    "created_at": "2022-06-11T09:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479501",
    "user": "@fchapoton"
}
```

merci !



---

archive/issue_comments_479502.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-06-12T23:08:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33703",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33703#issuecomment-479502",
    "user": "@vbraun"
}
```

Resolution: fixed
