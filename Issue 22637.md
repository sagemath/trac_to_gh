# Issue 22637: py3: 2 bad calls ot iteritems

Issue created by migration from https://trac.sagemath.org/ticket/22874

Original creator: chapoton

Original creation time: 2017-04-26 10:10:15

CC:  jdemeyer slelievre

inside a pyx files, but still they break


---

Comment by chapoton created at 2017-04-26 10:10:39

New commits:


---

Comment by chapoton created at 2017-04-26 10:10:39

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-04-27 04:46:10

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2017-04-27 04:46:10

My guess as to why this reversion is needed is because `.__dict__` is a special Python method, which (IIRC) Cython does special processing for. So it, in effect, behaves like a Python object rather than a Cython object.


---

Comment by jdemeyer created at 2017-04-28 20:35:52

They break because the type isn't `dict` but `dictproxy`. For example:

```
sage: type(Integer.__dict__)
<type 'dictproxy'>
sage: isinstance(Integer.__dict__, dict)
False
```


The special Cython handling for `iteritems()` only works for actual dicts.


---

Comment by vbraun created at 2017-04-28 23:54:39

Resolution: fixed
