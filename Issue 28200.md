# Issue 28200: R: interpreter calls shouldn't print invisible values

Issue created by migration from https://trac.sagemath.org/ticket/28437

Original creator: charpent

Original creation time: 2019-08-31 18:22:50

CC:  dimpase embray slelievre arojas infinity0 @mwageringel

Keywords: r-project

In "native" R, many functins return so-called "invisible" values. When called from the command prompt, they "just return", without printing anything.

In "our" interpreter calls, those values are printed. Which might be pretty annoying if the value is large.

Example: in the  native R 


```
> A <- 1:10
> A
 [1]  1  2  3  4  5  6  7  8  9 10
```


Note that **nothing** is printed after the assignment.

From the Sage command line:

```
sage: r("A <- 1:10")
 [1]  1  2  3  4  5  6  7  8  9 10
sage: r("A")
 [1]  1  2  3  4  5  6  7  8  9 10
```


This is not limited to operator-style assignments. Native interpreter:

```
> assign("A", 1:10)
> A
 [1]  1  2  3  4  5  6  7  8  9 10
```


From Sage command prompt:


```
sage: r.assign("'A'", srange(1,11))
 [1]  1  2  3  4  5  6  7  8  9 10
sage: r("A")
 [1]  1  2  3  4  5  6  7  8  9 10
```


This leads to various little-previsible shenanigans, depending on what the function we want to use does. This goes from the booboo (e. g. `{plot}}, which returns {{{null` invisibly) to the quite serious:

Exemple: `ggplot` returns an intricate data structure describing data and aesthetics mapping, with no valid Sage representation. Interestingly, this object /is/ visible, but of class `c(gg, ggplot)`, which prints nothing but, as a side effect, plots the data...:

```
sage: A=srange(1,10)
sage: B=[u^2 for u in A]
sage: D=r.data_frame(A=A,B=B)
sage: r.library("ggplot2")
sage: foo=r("ggplot(D, aes(x=A, y=B)) + geom_point()")
sage: foo

sage: foo is None
False
sage: foo.sage()
---------------------------------------------------------------------------
LookupError                               Traceback (most recent call last)
<ipython-input-166-3844ce7d8a36> in <module>()
----> 1 foo.sage()

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/sage/interfaces/interface.py in sage(self, *args, **kwds)
   1079             [0 0]
   1080         """
-> 1081         return self._sage_(*args, **kwds)
   1082 
   1083     def __repr__(self):

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/sage/interfaces/r.py in _sage_(self)
   1797 
   1798         with localconverter(P._r_to_sage_converter) as cv:
-> 1799             parsed = robjects.r(self.name())
   1800             return parsed
   1801 

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/rpy2/robjects/__init__.py in __call__(self, string)
    358         p = _rparse(text=StrSexpVector((string,)))
    359         res = self.eval(p)
--> 360         return conversion.ri2py(res)
    361 
    362 r = R()

/usr/local/sage-P3-2/local/lib/python3.7/functools.py in wrapper(*args, **kw)
    825                             '1 positional argument')
    826 
--> 827         return dispatch(args[0].__class__)(*args, **kw)
    828 
    829     funcname = getattr(func, '__name__', 'singledispatch function')

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/sage/interfaces/r.py in _list_vector(vec)
    434         attrs = vec.list_attrs()
    435         names = vec.do_slot('names')
--> 436         values = [ cv.ri2py(val) for val in vec ]
    437         rclass = list(vec.do_slot('class')) if 'class' in attrs else vec.rclass
    438         data = zip(names, values)

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/sage/interfaces/r.py in <listcomp>(.0)
    434         attrs = vec.list_attrs()
    435         names = vec.do_slot('names')
--> 436         values = [ cv.ri2py(val) for val in vec ]
    437         rclass = list(vec.do_slot('class')) if 'class' in attrs else vec.rclass
    438         data = zip(names, values)

/usr/local/sage-P3-2/local/lib/python3.7/functools.py in wrapper(*args, **kw)
    825                             '1 positional argument')
    826 
--> 827         return dispatch(args[0].__class__)(*args, **kw)
    828 
    829     funcname = getattr(func, '__name__', 'singledispatch function')

/usr/local/sage-P3-2/local/lib/python3.7/site-packages/sage/interfaces/r.py in _list_vector(vec)
    433         # we have a R list (vector of arbitrary elements)
    434         attrs = vec.list_attrs()
--> 435         names = vec.do_slot('names')
    436         values = [ cv.ri2py(val) for val in vec ]
    437         rclass = list(vec.do_slot('class')) if 'class' in attrs else vec.rclass

LookupError: The object has no such attribute.
```


 This can give the user  serious headaches if (the printed representation) of an invisible object is latrge or complex (think results of long statistical procedures, such as random-effects regression, bootstrap or Bayesian modeling...).

The only workaround is to "catch" this invisible value as an argument to a function that will return a short (but quite possiblu meaningless) value.

Avoiding to print objects with ill-defined visibility or printability would avoid these problems...


---

Comment by @mwageringel created at 2019-09-01 19:05:12

Changing component from packages: standard to interfaces.


---

Comment by embray created at 2019-09-18 12:34:22

I agree--the libgap interface in Sage used to display `null` when calling GAP functions with return value, which was also against the spirit of GAP's REPL.  Nobody complained about this being changed.

Similarly I think this should be fixed in the R interface, even if it's technically a backwards-incompatible change (but the existing behavior is not desirable so...)


---

Comment by embray created at 2019-09-18 12:35:51

Though with 8.9rc0 out this should probably wait.


---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by mkoeppe created at 2020-05-01 04:28:42

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.
