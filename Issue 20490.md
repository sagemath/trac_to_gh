# Issue 20490: LatticePoset: about complements

archive/issues_020490.json:
```json
{
    "body": "CC:  @tscrim\n\nThere is a slight corner-case -error:\n\n```\nLatticePoset({1: []}).complements()\n```\n\nwill give `{1: [1, 1]}`.\n\nAlso I am thinking about orthocompletion. As a part of that I want a good `complements()` function in `hasse_diagram.py`. This patch will do that too.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20727\n\n",
    "created_at": "2016-05-31T08:00:27Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "LatticePoset: about complements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20490",
    "user": "https://github.com/jm58660"
}
```
CC:  @tscrim

There is a slight corner-case -error:

```
LatticePoset({1: []}).complements()
```

will give `{1: [1, 1]}`.

Also I am thinking about orthocompletion. As a part of that I want a good `complements()` function in `hasse_diagram.py`. This patch will do that too.

Issue created by migration from https://trac.sagemath.org/ticket/20727





---

archive/issue_comments_282339.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-31T08:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282339",
    "user": "https://github.com/jm58660"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_282340.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-05-31T08:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282340",
    "user": "https://github.com/jm58660"
}
```

New commits:



---

archive/issue_comments_282341.json:
```json
{
    "body": "Just a `ping`.\n\nIf wanted, I can make a patch that only corrects the corner case in `lattices.py`.",
    "created_at": "2016-07-04T13:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282341",
    "user": "https://github.com/jm58660"
}
```

Just a `ping`.

If wanted, I can make a patch that only corrects the corner case in `lattices.py`.



---

archive/issue_comments_282342.json:
```json
{
    "body": "This is essentially a positive review, but I don't know the definition of the complements of elements in a poset. I think it would be good to give this.",
    "created_at": "2016-07-05T06:52:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282342",
    "user": "https://github.com/tscrim"
}
```

This is essentially a positive review, but I don't know the definition of the complements of elements in a poset. I think it would be good to give this.



---

archive/issue_comments_282343.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n> This is essentially a positive review, but I don't know the definition of the complements of elements in a poset. I think it would be good to give this.\n\n\n(I guess you mean lattice and not poset, even if it is easy to extend the definition to every bounded poset.)\n\nIt is said in `lattices.py` at function `complements()` already: Elements `x` and `y` are complements if their meet and join are respectively the bottom and the top element of the lattice.\n\nIn how many places should it be said? In `hasse_diagram.py`? In `is_complemented()`, `is_relatively_complemented()`, and maybe later in `is_sectionally_complemented()`? This is a real question, and I can see arguments for both directions.",
    "created_at": "2016-07-05T07:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282343",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:4 tscrim]:
> This is essentially a positive review, but I don't know the definition of the complements of elements in a poset. I think it would be good to give this.


(I guess you mean lattice and not poset, even if it is easy to extend the definition to every bounded poset.)

It is said in `lattices.py` at function `complements()` already: Elements `x` and `y` are complements if their meet and join are respectively the bottom and the top element of the lattice.

In how many places should it be said? In `hasse_diagram.py`? In `is_complemented()`, `is_relatively_complemented()`, and maybe later in `is_sectionally_complemented()`? This is a real question, and I can see arguments for both directions.



---

archive/issue_comments_282344.json:
```json
{
    "body": "I think it definitely needs to be defined in `hasse_diagram.py`, to distinguish between the inherited method of `complement()` coming from `Digraphs`, which is entirely different. \n\nFor the other ones, I would include a line at the end of each linking to similar/relevant methods (ie, `is_complemented()` would have a line at the end saying `see: complements(), is_relatively_complemented(), etc.`.",
    "created_at": "2016-07-11T14:34:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282344",
    "user": "https://github.com/kevindilks"
}
```

I think it definitely needs to be defined in `hasse_diagram.py`, to distinguish between the inherited method of `complement()` coming from `Digraphs`, which is entirely different. 

For the other ones, I would include a line at the end of each linking to similar/relevant methods (ie, `is_complemented()` would have a line at the end saying `see: complements(), is_relatively_complemented(), etc.`.



---

archive/issue_comments_282345.json:
```json
{
    "body": "First, thanks for reviews!\n\nReplying to [comment:6 kdilks]:\n> I think it definitely needs to be defined in `hasse_diagram.py`, to distinguish between the inherited method of `complement()` coming from `Digraphs`, which is entirely different. \n\n\nThis patch will do that. Althought I must admit that now `lattices.py` copies code from `hasse_diagram.py`, and that is not needed.\n\n> For the other ones, I would include a line at the end of each linking to similar/relevant methods (ie, `is_complemented()` would have a line at the end saying `see: complements(), is_relatively_complemented(), etc.`.\n\n\nTrue. I guess that #20940 will be last of this serie, so it is propably right place to add seealso-links. Before that I wait comment from Travis at #20972.",
    "created_at": "2016-07-11T18:38:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282345",
    "user": "https://github.com/jm58660"
}
```

First, thanks for reviews!

Replying to [comment:6 kdilks]:
> I think it definitely needs to be defined in `hasse_diagram.py`, to distinguish between the inherited method of `complement()` coming from `Digraphs`, which is entirely different. 


This patch will do that. Althought I must admit that now `lattices.py` copies code from `hasse_diagram.py`, and that is not needed.

> For the other ones, I would include a line at the end of each linking to similar/relevant methods (ie, `is_complemented()` would have a line at the end saying `see: complements(), is_relatively_complemented(), etc.`.


True. I guess that #20940 will be last of this serie, so it is propably right place to add seealso-links. Before that I wait comment from Travis at #20972.



---

archive/issue_comments_282346.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-08-09T05:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282346",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_events_055713.json:
```json
{
    "actor": "https://github.com/jm58660",
    "created_at": "2016-08-09T05:22:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "milestone": "sage-7.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20490#event-55713"
}
```



---

archive/issue_comments_282347.json:
```json
{
    "body": "OK, I added the definition of complement directly to this function in `hasse_diagram.py`.\n\nIt feels good design to have \"internals\" in `hasse_diagram.py` and have \"interface\" at `posets.py` and `lattices.py`. But it means that some definitions and tests must be written twise, maybe with collisions (definitions of graded vs. ranked). Also some functions at `hasse_diagram.py` are only meaningfull for lattices.\n\nNow we have `certificate`-option in `is_relatively_complemented()` and `is_sectionally_complemented()`. I think we should add the same to `is_complemented()`. But that's a task for another ticket.",
    "created_at": "2016-08-09T05:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282347",
    "user": "https://github.com/jm58660"
}
```

OK, I added the definition of complement directly to this function in `hasse_diagram.py`.

It feels good design to have "internals" in `hasse_diagram.py` and have "interface" at `posets.py` and `lattices.py`. But it means that some definitions and tests must be written twise, maybe with collisions (definitions of graded vs. ranked). Also some functions at `hasse_diagram.py` are only meaningfull for lattices.

Now we have `certificate`-option in `is_relatively_complemented()` and `is_sectionally_complemented()`. I think we should add the same to `is_complemented()`. But that's a task for another ticket.



---

archive/issue_comments_282348.json:
```json
{
    "body": "What makes you think it's good design? It seems like poor design to have the code for a single function spread across different files. If somebody is working with a poset/lattice and wants to figure out what this function is doing, instead of `??` giving them the code for the algorithm, they get the interface, and they have to try and hunt down the actual internals.",
    "created_at": "2016-08-09T05:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282348",
    "user": "https://github.com/kevindilks"
}
```

What makes you think it's good design? It seems like poor design to have the code for a single function spread across different files. If somebody is working with a poset/lattice and wants to figure out what this function is doing, instead of `??` giving them the code for the algorithm, they get the interface, and they have to try and hunt down the actual internals.



---

archive/issue_comments_282349.json:
```json
{
    "body": "For example series-parallel decomposition should be doable without temporary posets, i.e. using `connected_components()` and `vertical_summands()` in Hasse diagram. Partly the problem is `UniqueRepresentation`, which means that every poset is saved to memory, and takes more time to create. And if we make a code to generate all lattices of given type (see #20516) we need test functions that does not need poset generation.\n\nBut even having all functions at `posets.py` and `lattices.py` would be simpler than current system where we internal code splitted without any logic.",
    "created_at": "2016-08-09T06:10:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282349",
    "user": "https://github.com/jm58660"
}
```

For example series-parallel decomposition should be doable without temporary posets, i.e. using `connected_components()` and `vertical_summands()` in Hasse diagram. Partly the problem is `UniqueRepresentation`, which means that every poset is saved to memory, and takes more time to create. And if we make a code to generate all lattices of given type (see #20516) we need test functions that does not need poset generation.

But even having all functions at `posets.py` and `lattices.py` would be simpler than current system where we internal code splitted without any logic.



---

archive/issue_comments_282350.json:
```json
{
    "body": "Replying to [comment:10 kdilks]:\n> What makes you think it's good design? It seems like poor design to have the code for a single function spread across different files. If somebody is working with a poset/lattice and wants to figure out what this function is doing, instead of `??` giving them the code for the algorithm, they get the interface, and they have to try and hunt down the actual internals.\n\n\nYou're forgetting the fact that by working in `HasseDiagram`, you can assume the vertices are `(0, 1, ..., n-1)` and that is a linear extension. I agree that we loose a small bit of clarity (and an extra Python function call) for the indirection, but we often gain much more speed and code simplicity by utilizing these assumptions. One way you can think of `Poset` is that it adds the extra layer of the element labels.\n\nI think we can remove all references to the deprecation because this function is no longer broken AFAIK.",
    "created_at": "2016-08-11T12:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282350",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:10 kdilks]:
> What makes you think it's good design? It seems like poor design to have the code for a single function spread across different files. If somebody is working with a poset/lattice and wants to figure out what this function is doing, instead of `??` giving them the code for the algorithm, they get the interface, and they have to try and hunt down the actual internals.


You're forgetting the fact that by working in `HasseDiagram`, you can assume the vertices are `(0, 1, ..., n-1)` and that is a linear extension. I agree that we loose a small bit of clarity (and an extra Python function call) for the indirection, but we often gain much more speed and code simplicity by utilizing these assumptions. One way you can think of `Poset` is that it adds the extra layer of the element labels.

I think we can remove all references to the deprecation because this function is no longer broken AFAIK.



---

archive/issue_comments_282351.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-11T12:52:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282351",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282352.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-08-11T12:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282352",
    "user": "https://github.com/tscrim"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_282353.json:
```json
{
    "body": "Whoops, that's right, I wanted to the comment about the deprecation removed.",
    "created_at": "2016-08-11T12:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282353",
    "user": "https://github.com/tscrim"
}
```

Whoops, that's right, I wanted to the comment about the deprecation removed.



---

archive/issue_comments_282354.json:
```json
{
    "body": "Replying to [comment:12 tscrim]:\n\n> You're forgetting the fact that by working in `HasseDiagram`, you can assume the vertices are `(0, 1, ..., n-1)` and that is a linear extension. I agree that we loose a small bit of clarity (and an extra Python function call) for the indirection, but we often gain much more speed and code simplicity by utilizing these assumptions. One way you can think of `Poset` is that it adds the extra layer of the element labels.\n\n\nBut we could have it all in one file, without `hasse_diagram.py`. But OTOH this design is quite clear to me. Also I suppose that everything can be changed in that file, as long as \"interfaces\", i.e. mostly `posets.py` and `lattices.py` stays.\n\n> I think we can remove all references to the deprecation because this function is no longer broken AFAIK.\n\n\nOK, I can remove them.",
    "created_at": "2016-08-11T13:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282354",
    "user": "https://github.com/jm58660"
}
```

Replying to [comment:12 tscrim]:

> You're forgetting the fact that by working in `HasseDiagram`, you can assume the vertices are `(0, 1, ..., n-1)` and that is a linear extension. I agree that we loose a small bit of clarity (and an extra Python function call) for the indirection, but we often gain much more speed and code simplicity by utilizing these assumptions. One way you can think of `Poset` is that it adds the extra layer of the element labels.


But we could have it all in one file, without `hasse_diagram.py`. But OTOH this design is quite clear to me. Also I suppose that everything can be changed in that file, as long as "interfaces", i.e. mostly `posets.py` and `lattices.py` stays.

> I think we can remove all references to the deprecation because this function is no longer broken AFAIK.


OK, I can remove them.



---

archive/issue_comments_282355.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-08-15T07:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282355",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_282356.json:
```json
{
    "body": "Hmm... There were no deprecations left in my code.\n\nBut anyway, I guess this can be thinked later. I changed this patch to only correct the corner case error and added tests for that.",
    "created_at": "2016-08-15T07:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282356",
    "user": "https://github.com/jm58660"
}
```

Hmm... There were no deprecations left in my code.

But anyway, I guess this can be thinked later. I changed this patch to only correct the corner case error and added tests for that.



---

archive/issue_comments_282357.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-08-15T07:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282357",
    "user": "https://github.com/jm58660"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_282358.json:
```json
{
    "body": "ok, looks good to me",
    "created_at": "2016-08-17T09:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282358",
    "user": "https://github.com/fchapoton"
}
```

ok, looks good to me



---

archive/issue_comments_282359.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-08-17T09:14:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282359",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282360.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-08-19T22:45:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20490#issuecomment-282360",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_055714.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-08-19T22:45:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20490",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20490#event-55714"
}
```
