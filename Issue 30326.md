# Issue 30326: Use configuration variable MAXIMA instead of hardcoding "maxima"

Issue created by migration from https://trac.sagemath.org/ticket/30563

Original creator: mkoeppe

Original creation time: 2020-09-12 18:24:50

CC:  thansen mjo fbissey

Upstreaming a generalized version of 
https://salsa.debian.org/science-team/sagemath/-/blob/master/debian/patches/d0-maxima.patch


---

Comment by fbissey created at 2020-09-14 01:07:24

I am guessing that ideally we want to use the variable `MAXIMA` rather than those `maxima` and `maxima-sage` from the patch. It could be interesting as I could replace 

```
	# run maxima with ecl
	sed -i "s:'maxima :'maxima -l ecl :g" \
		sage/interfaces/maxima.py \
		sage/interfaces/maxima_abstract.py
```

with a variable assignment in sage-on-gentoo.


---

Comment by mkoeppe created at 2020-09-14 04:55:35

Replying to [comment:3 fbissey]:
> I am guessing that ideally we want to use the variable `MAXIMA` 

Yes, that's the idea


---

Comment by fbissey created at 2020-09-14 10:40:54

`maxima.py` is already using `MAXIMA` that leaves us with touching `maxima_abstract.py` and a couple of things to help sage-on-debian pass its doctests out of the box.

Not sure how to proceed with `bin/sage` as it is not reading that configuration file, nor should it.


---

Comment by mkoeppe created at 2020-09-14 12:19:54

Replying to [comment:5 fbissey]:
> Not sure how to proceed with `bin/sage` as it is not reading that configuration file, nor should it.
`sage-config MAXIMA` works if `sage_conf` is installed, can fall back to `maxima`


---

Comment by fbissey created at 2020-09-14 20:43:56

Replying to [comment:6 mkoeppe]:
> Replying to [comment:5 fbissey]:
> > Not sure how to proceed with `bin/sage` as it is not reading that configuration file, nor should it.
> `sage-config MAXIMA` works if `sage_conf` is installed, can fall back to `maxima`
> 

OK, that's another issue, I don't like how sage-config is installed as a separate package but this is kind of orthogonal.


---

Comment by mkoeppe created at 2020-09-14 20:51:53

Replying to [comment:7 fbissey]:
> I don't like how sage-config is installed as a separate package but this is kind of orthogonal.

Yes, that's orthogonal.


---

Comment by fbissey created at 2020-09-15 09:42:46

I shouldn't just leave things sitting on my hard drive. 

There is a couple more things to do before calling it done.
----
New commits:


---

Comment by git created at 2020-09-15 09:47:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-09-15 10:09:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2020-09-15 10:10:36

`@`mkoeppe was the last commit the kind of things you had in mind for `src/bin/sage`?


---

Comment by mkoeppe created at 2020-09-15 15:33:13

Yes, something like this. Probably needs stderr redirection though.


---

Comment by fbissey created at 2020-09-15 19:55:13

Most definitely, but after a night sleep I think I need to change the design slightly.


---

Comment by git created at 2020-09-15 23:17:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2020-09-15 23:20:46

Changing status from new to needs_review.


---

Comment by fbissey created at 2020-09-15 23:20:46

I was overthinking things. The current branch takes care of most of the stuff in the debian patch and should work nicely in most distros with minimal effort.


---

Comment by mkoeppe created at 2020-09-16 00:06:29


```
+    exec "$maxima_cmd" "$@"
```

I think `$maxima_cmd` shouldn't be quoted here


---

Comment by fbissey created at 2020-09-16 00:19:44

Funny, I thought it should be quoted, because it could be a string with spaces in it. `maxima -l ecl` specifically. But I initially had put `"$maxima_cmd $`@`"` which failed miserably when calling `./sage --maxima` without any argument because of the space. So if it is safe for the case above, I am OK with removing the quotes.


---

Comment by mkoeppe created at 2020-09-16 00:25:52

But `exec "maxima -l ecl"` will fail


---

Comment by fbissey created at 2020-09-16 00:34:56

Indeed it does. And even if I remove the quotes there is an extra bit that needs to be dealt with. The `-l` is getting interpreted in the `[]` on line 609 so I need to do something more careful.


---

Comment by git created at 2020-09-16 00:59:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2020-09-16 01:02:08

Turns out my overnight thought of redesign are not wasted. It is much more elegant and less problematic. Any objection to the default being `maxima -l ecl`? That means it works in sage-on-gentoo with the right interpreter even if we don't ship `sage-config`. It should work with any maxima used by sage.


---

Comment by mkoeppe created at 2020-09-16 01:05:14

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-09-16 01:05:14

Looks good to me.


---

Comment by vbraun created at 2020-09-27 09:09:33

Resolution: fixed


---

Comment by fbissey created at 2020-09-28 06:30:06

I missed a case in my testing of `maxima -l ecl`. Follow up at #30676.
