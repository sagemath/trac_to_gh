# Issue 12617: Move local/bin/sage-check-64 to spkg/bin/sage-arch-env

Issue created by migration from https://trac.sagemath.org/ticket/12789

Original creator: jdemeyer

Original creation time: 2012-04-02 08:03:57

Assignee: leif

Since `sage-env` sources `$SAGE_LOCAL/bin/sage-check-64`, it makes sense to move the latter file to `$SAGE_ROOT/spkg/bin`.  I also propose to rename the file to "sage-arch-env".  I would like to support a SAGE32 flag (see #12726) and it makes sense to use the same file for this.


---

Comment by jdemeyer created at 2012-04-02 08:30:24

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-04-02 15:05:19

I haven't looked at the patches here, but #10303 and #11077 also had some ideas for clean up for `sage-check-64`.


---

Comment by jdemeyer created at 2012-04-02 15:16:21

Replying to [comment:7 jhpalmieri]:
> I haven't looked at the patches here, but #10303 and #11077 also had some ideas for clean up for `sage-check-64`.

Too bad those tickets got abandoned, as they are bitrotten now.  Anyway, I will look at those tickets and take the good ideas here.


---

Comment by jdemeyer created at 2012-04-02 20:46:00

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-04-02 20:56:42

Added items 5 and 6.

One idea from #10303 that I disagree with is to source `sage-check-64` (now `sage-arch-env`) only in `sage-spkg` and `sage-build`, i.e. when a package is being built.  I think it can be useful even within Sage, for example to compile Cython files.


---

Comment by jdemeyer created at 2012-04-02 20:56:42

Changing status from needs_work to needs_review.


---

Comment by leif created at 2012-04-02 22:07:19

Replying to [comment:10 jdemeyer]:
> Added items 5 and 6.
> 
> One idea from #10303 that I disagree with is to source `sage-check-64` (now `sage-arch-env`) only in `sage-spkg` and `sage-build`, i.e. when a package is being built.  I think it can be useful even within Sage, for example to compile Cython files.

Well, Cython should take `CFLAGS` etc. from distutils, i.e., Python.

Doesn't really make sense to change the settings (`SAGE64` or whatever) afterwards or inbetween.  Either you do (or have) a 64-bit build, or not.  The original purpose of the `sage-64.txt` file is exactly to avoid mixing up 32-bit and 64-bit builds (although there are certainly better ways to achieve this).


---

Comment by leif created at 2012-04-02 22:16:49

Shouldn't there be at least a warning if `SAGE64` is set to `"no"` but `sage-64.txt` already exists?

Since this is exactly what we want to avoid: Mixing up both.


---

Comment by jdemeyer created at 2012-04-03 06:43:43

Replying to [comment:12 leif]:
> Shouldn't there be at least a warning if `SAGE64` is set to `"no"` but `sage-64.txt` already exists?
I believe in the philosophy of "user is always right".  If the user _intentionally_ set `SAGE64=yes` and then later `SAGE64=no`, we assume he knows what he's doing.  I don't see the need for a warning.  Besides, the warning would only be printed once (`sage-64.txt` is deleted if `SAGE64=no`), so it would be easy to miss.


---

Comment by jdemeyer created at 2012-04-03 06:48:25

Replying to [comment:11 leif]:
> Well, Cython should take `CFLAGS` etc. from distutils, i.e., Python.
Perhaps, but I think it's not impossible that some Sage library code or user code wants to look at `SAGE64`.  However, I'm not going to insist on this.  I just want this ticket to get reviewed and merged, unlike #10303.


---

Attachment


---

Comment by vbraun created at 2012-05-26 18:42:36

Changing keywords from "" to "sd40.5".


---

Attachment

Looks good!


---

Comment by vbraun created at 2012-05-26 18:42:36

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-06-14 06:40:05

Resolution: fixed
