# Issue 31670: sage_bootstrap.download fails to download from pypi.io

Issue created by migration from https://trac.sagemath.org/ticket/31907

Original creator: mkoeppe

Original creation time: 2021-06-04 18:27:26

CC:  dimpase vbraun

On `ubuntu-trusty` (https://github.com/mkoeppe/sage/runs/2741662485?check_suite_focus=true)

```
  [numpy-1.20.3]   ERROR [transfer|run:135]: [Errno 403] [[[!!! BREAKING CHANGE !!!]]] Support for clients that do not support Server Name Indication is temporarily disabled and will be permanently deprecated soon. See https://status.python.org/incidents/hzmjhqsdjqgb and https://github.com/pypa/pypi-support/issues/978 [[[!!! END BREAKING CHANGE !!!]]]: '//pypi.io/packages/source/n/numpy/numpy-1.20.3.zip'
  [numpy-1.20.3]   ************************************************************************
  [numpy-1.20.3]   Traceback (most recent call last):
  [numpy-1.20.3]     File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 126, in run_safe
  [numpy-1.20.3]       run()
  [numpy-1.20.3]     File "/sage/build/bin/../sage_bootstrap/download/cmdline.py", line 108, in run
  [numpy-1.20.3]       app.download_tarball(args.url_or_tarball, args.destination, args.allow_upstream)
  [numpy-1.20.3]     File "/sage/build/bin/../sage_bootstrap/download/app.py", line 41, in download_tarball
  [numpy-1.20.3]       tarball.download(allow_upstream=allow_upstream)
  [numpy-1.20.3]     File "/sage/build/bin/../sage_bootstrap/tarball.py", line 178, in download
  [numpy-1.20.3]       raise FileNotMirroredError('tarball does not exist on mirror network and neither at the upstream URL')
  [numpy-1.20.3]   FileNotMirroredError: tarball does not exist on mirror network and neither at 
```




---

Comment by slelievre created at 2021-06-04 22:44:21

The error message includes these two urls:

- https://status.python.org/incidents/hzmjhqsdjqgb
- https://github.com/pypa/pypi-support/issues/978

where explanations involve a bunch of acronyms including:

- CDN (content delivery network)
- PSF (Python Software Foundation)
- SNI (server name indication)
- TLS (Transport Layer Security)
- VCL (Varnish conguration language)

and the general idea is that Fastly, a company that
sponsors the Python Software Foundation by providing
hosting and a content delivery network, in particular
for files at pypi.org and at pythonhosted.org,
dropped support for "non-SNI clients".

The hints in the discussion include:

- check if your Python and OpenSSL version supports SNI with
  {{{
  python2 -c "import ssl; print(ssl.HAS_SNI)"
  }}}

- append `--trusted-host pypi.org --trusted-host files.pythonhosted.org`
  to pip install commands

Related:

- [Fastly product description](https://docs.fastly.com/products/)
- [pdf snapshots of the above page in expanded form](https://docs-archive.fastly.com/snapshots/),
  including [2021-05-31](https://docs-archive.fastly.com/snapshots/static/2021-05-31-products-aio.pdf)

Not sure that helps at all but just in case.
