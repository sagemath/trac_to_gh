# Issue 13123: p_group_cohomology 2.1.3

Issue created by migration from Trac.

Original creator: SimonKing

Original creation time: 2012-07-26 15:35:36

Assignee: tbd

CC:  david.green@uni-jena.de jhpalmieri

Keywords: group cohomology

There is a new version of the optional p_group_cohomology package.

*__Installation__*

First, install Gap's Small Groups library (contained in the database_gap spkg). Then, do

```
sage -i http://sage.math.washington.edu/home/SimonKing/Cohomology/p_group_cohomology-2.1.3.spkg
```


*__Testing__*

If the environment variable `SAGE_CHECK` is set to `yes`, then a test suite is run. This will take a considerable amount of time (the test coverage is 100%). Parallel testing is possible by setting the environment variable `SAGE_NUMBER_THREADS` to the number of threads being used.

*__Documentation__*

Set the environment variable SAGE_SPKG_INSTALL_DOCS to yes. Then, while installing the package, the documentation will be put into `SAGE_ROOT/local/share/doc/p_group_cohomology/html/`. Or see [here](http://sage.math.washington.edu/home/SimonKing/Cohomology/)

*__Reasons for upgrading__*

__Name mangling__

There has been yet another Cython upgrade between sage-5.0 and sage-5.2. By consequence, Python's infamous name mangling now also applies to Python classes defined in Cython code:

```
sage: cython("""
....: class Foo:
....:     def __init__(self):
....:         self.__cache = "hi"
....: """)
sage: F = Foo()
sage: F.__cache
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)

/home/simon/SAGE/prerelease/sage-5.2.rc0/<ipython console> in <module>()

AttributeError: Foo instance has no attribute '__cache'
sage: F._Foo__cache
'hi'
```

In Sage-5.0, the attribute `F.__cache` would be available. Hence, I had to rename some attributes.

__Storing Gap data__

Some computed data (e.g., ideals in the cohomology ring simultaneously restricting to zero on a given set of subgroups) are defined in terms of data in Gap (namely, subgroups). We would like to store such data, since obviously we don't want to recompute everything from scratch.

Unfortunately, pickling of general Gap objects is not available. The new spkg version works around, so that pickling works, provided that the Gap object can be reconstructed from its string representation (which holds, e.g., for permutation groups).

__Use lower bounds for the depth__

Some completeness criteria benefit from knowing a good estimate for the depth. In some cases, a good estimate is difficult to obtain. In the new spkg version, the computation of a good bound can be interrupted by Ctrl-C, and then an easier (but potentially weaker) bound is used.

__New web repository__

Due to a hardware problem on sage.math, the data in the old web repository are lost. Meanwhile I reconstructed the data and put them to a new location (namely my home directory on sage.math) which has a back-up. The new spkg version knows about the new location of the repository.

__Creating a private data base__

When creating a "private" data base of cohomology rings, symbolic links to the "public" data base (shipped with the package) are created. The old spkg version did sometimes fail to create the symbolic links.

__A fix for `MeatAxe` matrices__

In the old spkg version, comparing an MTX matrix with None would have resulted in a crash.

*__Information for the reviewer__*

I successfully installed and tested the package with sage-5.2.rc0 on an `OpenSuse` laptop and on bsd.math. It would be nice to test it on a variety of platforms, in particular on machines of different endianness, or on 32-bit machines.

Apart from that, there is not much new mathematics in the spkg: It is mainly a bug fix release (coping with the Cython upgrade).

__SPKG__

http://sage.math.washington.edu/home/SimonKing/Cohomology/p_group_cohomology-2.1.3.spkg


---

Comment by SimonKing created at 2012-07-29 23:45:15

Changing status from new to needs_review.


---

Comment by SimonKing created at 2012-07-29 23:45:15

A few minutes ago, I posted a [modified spkg](http://sage.math.washington.edu/home/SimonKing/Cohomology/p_group_cohomology-2.1.3.spkg) (still version 2.1.3). I am sorry if you already downloaded the previously posted spkg.

Please make sure you got the right spkg: There should now be a mew method `pGroupCohomology.modular_cohomology.MODCOHO.parameter_degrees_over_field_extension`.

The reason for the change is that in the last few days I improved the heuristics to choose between different methods to construct or to prove the existence of parameters. For example, consider the mod 2 cohomology of `SmallGroup(384, 5602)` (which occurs when computing the mod 2 cohomology of the symmetric group of degree 8). The cohomology ring can be presented in degree 6, but the previously posted spkg could detect completeness only in degree 10, using Symonds' criterion. But the current spkg can prove completeness in degree 7, using the Hilbert-Poincaré criterion.

This is a new doctest.

Speaking about doctests: I still need to run the test suite on bsd.math, and post the current documentation on the project page.


---

Comment by SimonKing created at 2012-07-30 00:48:56

The tests on bsd.math pass. Building the documentation, I found a typo (wrong indentation) in the docs of the new method. Hence, unfortunately, I had to repost the package again (I am sorry).

The documentation is now put on the [project page](http://sage.math.washington.edu/home/SimonKing/Cohomology/).


---

Comment by SimonKing created at 2012-09-02 15:59:48

I already heard of users who tried to install the package version that is currently shipped with Sage - which fails for the reasons stated in the ticket description. Hence, I'd appreciate a review of the new version, so that people do not need to get an inofficial version from my web pages.

Note, however, that the currently posted new package will not work with the new versions of GAP (#13211) and Singular (#13237). I had not the time to analyse what happened, but I guess that the errors are due to a change in the random number generator in GAP - I expect the results will still be correct up to isomorphism, but differ from the expected ring presentations. At some point I'll have to take care of that.


---

Comment by jhpalmieri created at 2012-09-03 05:34:55

Hi Simon,

I'm going to try building this on several platforms. Meanwhile, here are one or two things which need easy fixes:

- the repository isn't clean: there is a file "spkg-check.orig" present.
- In spkg-check, I would suggest changing `SAGE_NUMBER_THREADS` to `SAGE_NUM_THREADS`, since the latter variable is set automatically in `SAGE_ROOT/spkg/bin/sage-env`.


---

Comment by SimonKing created at 2012-09-03 05:46:09

Replying to [comment:5 jhpalmieri]:
> Hi Simon,
> 
> I'm going to try building this on several platforms. Meanwhile, here are one or two things which need easy fixes:
> 
> - the repository isn't clean: there is a file "spkg-check.orig" present.

Thank you for spotting that!

> - In spkg-check, I would suggest changing `SAGE_NUMBER_THREADS` to `SAGE_NUM_THREADS`, since the latter variable is set automatically in `SAGE_ROOT/spkg/bin/sage-env`.

Cool, I didn't know about that one. Hence, if you define `MAKE="make -j4` then the variable will automatically be fine?


---

Comment by jhpalmieri created at 2012-09-03 05:56:47

Replying to [comment:6 SimonKing]:
> Replying to [comment:5 jhpalmieri]:
> > - In spkg-check, I would suggest changing `SAGE_NUMBER_THREADS` to `SAGE_NUM_THREADS`, since the latter variable is set automatically in `SAGE_ROOT/spkg/bin/sage-env`.
> 
> Cool, I didn't know about that one. Hence, if you define `MAKE="make -j4"` then the variable will automatically be fine?

That's right. If you want, you could mention in the documentation (or in the comments in spkg-check) that it suffices to set `MAKE`.


---

Comment by jhpalmieri created at 2012-09-03 17:23:35

Otherwise, this looks good to me. It builds and passes tests on several different platforms (linux, OS X 10.7, OpenSolaris). So if you fix the two small issues, positive review.


---

Comment by SimonKing created at 2012-10-10 10:24:10

Sorry that it took so long to fix the remaining issues. I have updated the spkg.

hg status is now fine, and am now using `SAGE_NUM_THREADS` instead of `SAGE_NUMBER_THREADS`.

Caveat: I need to test it (e.g., on bsd.math) with the latest sage prerelease - just in case. As much as I know, upgrading GAP #13211 will break a couple of things. So, the current spkg version may soon be obsolete... :(


---

Comment by SimonKing created at 2012-10-10 10:35:38

Changing status from needs_review to needs_work.


---

Comment by SimonKing created at 2012-10-10 10:35:38

Arrgh.

```
Writing /scratch/sking/sage-5.4.rc0/local/lib/python2.7/site-packages/pGroupCohomology-2.1.1-py2.7.egg-info
Traceback (most recent call last):
  File "setup.py", line 144, in <module>
    from sage.misc.misc import SAGE_DATA
ImportError: cannot import name SAGE_DATA
```

This happens after a seemingly successful installation.

Has `SAGE_DATA` been relocated? How unfortunate. Need to fix it.


---

Comment by SimonKing created at 2012-10-10 10:42:08

Apparently #13123 has changed SAGE_DATA. In particular, it seems that it is still available as an environment variable, but is not available from sage.misc.misc (which used to be the case until recently).


---

Comment by SimonKing created at 2012-10-10 11:16:02

The spkg is now updated again. The package and its documentation build fine on bsd.math.

I am now running the tests on bsd.math, and i already found some that fail (although most seem to pass). No idea if that is due to a recent Singular upgrade...

Anyway, it again needs work, because of the test failures.


---

Comment by SimonKing created at 2012-10-10 12:12:26

I got

```
Summary
-------

The following tests fail:
  pGroupCohomology
  pGroupCohomology.barcode
  pGroupCohomology.cochain.COCH.__init__
  pGroupCohomology.cochain.ChMap.__setitem__
  pGroupCohomology.cohomology.COHO.bar_code
  pGroupCohomology.cohomology.COHO.essential_ideal
  pGroupCohomology.factory.CohomologyRingFactory.set_web_db
Total time: 1154.94 sec
```

The good news is that `export MAKE="make -j3"` was enough to get parallel tests. The bad news is that the errors seem to have different reasons, and so far I don't understand any of them. In some case, it seems that files have not been written.


---

Comment by SimonKing created at 2012-10-10 12:35:48

Here are some of the failures:

----


```
    sage: (I*I).NF('std(0)').interred()  #long time
Expected:
    a_4_8*a_6_8*a_1_0^3*a_1_3
Got:
    a_4_8*a_6_8*a_1_0^3*a_1_3,
    a_4_8*a_6_8*c_8_16*a_1_0^3*a_1_3
```

That's serious, because it is a different result.

----


```
    RuntimeError: Gap produced error output
    Error, no 1st choice method found for `ReadLine' on 1 arguments

       executing makeThisSmallGroup([16,2],"/Users/SimonKing/.sage/pGroupCohomology/db/");
```

Indeed:

```
sage: from pGroupCohomology import CohomologyRing
sage: H = CohomologyRing(16,2,from_scratch=True, options='prot')
    Computing from scratch
Group data are rooted at /Users/SimonKing/.sage/pGroupCohomology/db/
    Initialize cohomology ring of SmallGroup(16,2)
    Computing data for Small Group number 2 of order 16
Traceback (most recent call last):
...
RuntimeError: Gap produced error output
Error, no 1st choice method found for `ReadLine' on 1 arguments

   executing makeThisSmallGroup([16,2],"/Users/SimonKing/.sage/pGroupCohomology/db/");
```


----


```
pGroupCohomology.cochain.COCH.__init__:
sage -t -optional -long "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/39746/dir_0/file_6.py"
Error: saveUrbildGB: opening outfile.
```


```
pGroupCohomology.cochain.ChMap.__setitem__:
sage -t -optional -long "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/39746/dir_0/file_116.py"
Error: saveUrbildGB: opening outfile.

	 [2.3 s]
```


----


```
pGroupCohomology.factory.CohomologyRingFactory.set_web_db:
sage -t -optional -long "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/39746/dir_0/file_21.py"
**********************************************************************
File "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/39746/dir_0/file_21.py", line 22:
    sage: H=CohomologyRing.web_db('8gp3') # optional - internet
Exception raised:
    Traceback (most recent call last):
    ...
    IOError: [Errno 2] No such file or directory: '/Users/SimonKing/.sage/pGroupCohomology/db/8gp3/dat/L8gp3n3d2.sobj'
```


----

Could it be that these are all I/O errors, except the first error? Perhaps a race condition when running parallel tests (one test blocking file access of other tests)?


---

Comment by SimonKing created at 2012-10-10 13:44:32

Rerunning the tests with a single thread, I get less errors:

```
The following tests fail:
  pGroupCohomology
  pGroupCohomology.barcode
  pGroupCohomology.cohomology.COHO.bar_code
  pGroupCohomology.cohomology.COHO.essential_ideal
  pGroupCohomology.factory.CohomologyRingFactory.set_web_db
Total time: 2656.55 sec
```

Next, I'll try again after wiping the .sage/pGroupCohomology/db/.


---

Comment by SimonKing created at 2012-10-10 14:17:03

Indeed it seems to be some kind of corruption in my home directory. After removing `~/.sage/pGroupCohomology` and re-installation of the package, I'm left with two copies of a single error:

```
pGroupCohomology:
File "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/77179/dir_0/file_0.py"
, line 941:
    sage: (I*I).NF('std(0)').interred()  #long time
Expected: 
    a_4_8*a_6_8*a_1_0^3*a_1_3
Got:
    a_4_8*a_6_8*a_1_0^3*a_1_3,
    a_4_8*a_6_8*c_8_16*a_1_0^3*a_1_3
**********************************************************************
pGroupCohomology.cohomology.COHO.essential_ideal:
File "/Users/SimonKing/.sage/temp/bsd.math.washington.edu/77179/dir_0/file_67.py", line 140:
    sage: (I*I).NF('std(0)').interred()  #long time
Expected:
    a_4_8*a_6_8*a_1_0^3*a_1_3
Got:
    a_4_8*a_6_8*a_1_0^3*a_1_3,
    a_4_8*a_6_8*c_8_16*a_1_0^3*a_1_3
```


Isn't that actually a Singular bug? After all, I do interreduction, and `a_4_8*a_6_8*c_8_16*a_1_0^3*a_1_3` is clearly reducible by `a_4_8*a_6_8*a_1_0^3*a_1_3`.

Provided that it is an upstream bug, what shall we do? The point of that test is that the square of the essential ideal is generated by a single non-zero element.


---

Comment by SimonKing created at 2012-10-10 14:17:03

Remove assignee tbd.


---

Comment by SimonKing created at 2012-10-10 14:41:36

Strange. I can not reproduce the problem in pure Singular. I don't know if there is any nasty side effect of a loaded library or so.


---

Comment by SimonKing created at 2012-10-10 15:00:39

Spoke too soon. I _can_ reproduce it in Singular, when I add the option `redSB`. Interesting that `redSB` is responsible for an _incomplete_ reduction! I have opened this [Singular ticket](http://www.singular.uni-kl.de:8002/trac/ticket/456).

But what does that mean to us? Of course, I could work around by temporarily switch off `redSB`.


---

Comment by SimonKing created at 2012-10-10 15:03:48

Replying to [comment:18 SimonKing]:
> But what does that mean to us? Of course, I could work around by temporarily switch off `redSB`.

It would be as follow:

```
sage: from pGroupCohomology import CohomologyRing
sage: H = CohomologyRing(64,245)
sage: I = H.essential_ideal()
sage: singular.option()
//options: redSB redTail redThrough redefine loadLib usage prompt
sage: singular.option("noredSB")
sage: singular.option()
//options: redTail redThrough redefine loadLib usage prompt
sage: (I*I).NF('std(0)').interred()            
a_4_8*a_6_8*a_1_0^3*a_1_3
sage: singular.option("redSB")
sage: (I*I).NF('std(0)').interred()
a_4_8*a_6_8*a_1_0^3*a_1_3,
a_4_8*a_6_8*c_8_16*a_1_0^3*a_1_3
```


Does the reviewer think that it is a valid work-around?


---

Comment by jhpalmieri created at 2012-10-10 15:21:27

Regarding the Singular problems: you could also include the original doctest, marked as `# known bug in Singular`. "known bug" should tell Sage to skip the doctest. In any case, you should put in a comment about the fact that Singular has a bug which requires a workaround. 

Should we test this spkg with the new GAP spkg from #13211?


---

Comment by SimonKing created at 2012-10-10 15:30:30

Replying to [comment:20 jhpalmieri]:
> Regarding the Singular problems: you could also include the original doctest, marked as `# known bug in Singular`. "known bug" should tell Sage to skip the doctest. In any case, you should put in a comment about the fact that Singular has a bug which requires a workaround. 

I have just updated my spkg, temporarily switching `redSB` off. I think that would be better than skipping the test.

> Should we test this spkg with the new GAP spkg from #13211?

IIRC, I have already tried, and there were various errors (including GAP crashes, so, it isn't just random noise). I guess this will be version 2.1.4 of the spkg...

I am now testing the updated spkg, but I think it should again be ready for review...


---

Comment by SimonKing created at 2012-10-10 15:30:30

Changing status from needs_work to needs_review.


---

Comment by SimonKing created at 2012-10-10 15:34:00

I modified the ticket description, since `SAGE_NUMBER_THREADS` now became `SAGE_NUM_THREADS`.


---

Comment by SimonKing created at 2012-10-10 20:09:54


```
-------------------------------------------------------------
All doc tests passed!
-------------------------------------------------------------

Total time: 1076.99 sec
```

Hooray!


---

Comment by jhpalmieri created at 2012-10-10 22:22:59

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2012-10-10 22:22:59

All tests passed for me on sage.math and on OS X 10.8 (Mountain Lion) with the new scipy spkg from #13541. I haven't tested on a 32-bit machine, but I'm going to give it a positive review anyway.


---

Comment by jhpalmieri created at 2012-10-11 01:28:45

All tests also pass on OpenSolaris.


---

Comment by SimonKing created at 2012-10-11 15:56:23

Just for the record: Hans Schönemann apparently was able to fix the bug in Singular - so, it will be fine in future, even without temporarily disabling `redSB`.


---

Comment by schilly created at 2012-10-14 19:05:43

i just updated this optional spkg!


---

Comment by jdemeyer created at 2012-10-15 20:44:31

Resolution: fixed
