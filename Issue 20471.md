# Issue 20471: Improve sage-logger

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2016-05-29 18:40:47

CC:  embray

1. Don't use the `-p` option at the top-level which only prints a useless `[install] `.

2. Use `sed` instead of `read/echo`. This preserves whitespace.


---

Comment by jdemeyer created at 2016-05-29 19:16:52

New commits:


---

Comment by jdemeyer created at 2016-05-29 19:16:52

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2016-05-30 07:57:51

This looks good to me. It works on OS X, for example the early parts of the `matplotlib` log look better with this, but someone should test it on some linux machines. (I don't think this is doctested, so the patchbot won't help.)


---

Comment by jdemeyer created at 2016-05-30 08:00:58

Well, it works for me (on Gentoo Linux).


---

Comment by embray created at 2016-05-30 09:35:17

I think this is fine.  I didn't mind having `[install]` on every line, because when you run `make` *not* every step is necessarily in install, but most of the time it's clear enough from context that it isn't needed.

I think it's a bit silly to call this a "blocker" though don't you?


---

Comment by embray created at 2016-05-30 09:35:17

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-05-30 10:10:01

Reviewer name


---

Comment by vbraun created at 2016-05-30 10:10:01

Changing status from positive_review to needs_work.


---

Comment by jdemeyer created at 2016-05-30 10:11:23

Changing status from needs_work to positive_review.


---

Comment by mkoeppe created at 2016-05-31 09:17:47

The recent sage-logger changes from #20640 seem to cause a minor problem.

When installing an "experimental" package, Sage warns a lot and then prompts the user. 
Because of line buffering, one does not see the prompt, but Sage just waits indefinitely.


```
sage -f latte_int
...
[latte_int-1.7.3] =========================== WARNING ===========================
[latte_int-1.7.3] You are about to download and install an experimental package.
[latte_int-1.7.3] This probably won't work at all for you! There is no guarantee
[latte_int-1.7.3] that it will build correctly, or behave as expected.
[latte_int-1.7.3] Use at your own risk!
[latte_int-1.7.3] ===============================================================
```

<--- This is where it asks "[latte_int-1.7.3] Are you sure you want to continue [Y/n]?" but this is line-buffered and not visible to the user.


---

Comment by jdemeyer created at 2016-05-31 09:23:06

Replying to [comment:8 mkoeppe]:
> The recent sage-logger changes from #20640 seem to cause a minor problem.

On which operating system is this? And does the problem remain after applying #20708?


---

Comment by mkoeppe created at 2016-05-31 11:17:43

This is on Mac OS X, after merging #20708.


---

Comment by embray created at 2016-05-31 12:59:54

Replying to [comment:8 mkoeppe]:
> The recent sage-logger changes from #20640 seem to cause a minor problem.
> 
> When installing an "experimental" package, Sage warns a lot and then prompts the user. 
> Because of line buffering, one does not see the prompt, but Sage just waits indefinitely.

I have noticed this as well.  But I think jdmeyer's fix in this ticket _should_ fix it due to the use of unbuffered sed.  (The keyboard input is still accepted, you just don't see the prompt until later).


---

Comment by mkoeppe created at 2016-05-31 15:29:14

From man sed(1) on OS X:

```
     -l      Make output line buffered.
```

Line buffered is not unbuffered.


---

Comment by vbraun created at 2016-05-31 22:53:58

Resolution: fixed
