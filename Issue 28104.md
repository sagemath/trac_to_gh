# Issue 28104: Allow doc to build with SAGE_PARI_CFG undefined

Issue created by migration from https://trac.sagemath.org/ticket/28341

Original creator: fbissey

Original creation time: 2019-08-11 01:02:32

CC:  dimpase @timokau

Follow up to #28242 which introduced `SAGE_PARI_CFG` in documentation build to identity whether or not pari is external.

This is inconvenient to distros and the behavior for external `pari` should be assumed if `SAGE_PARI_CFG` is undefined.


---

Comment by fbissey created at 2019-08-11 01:43:43

Will replace `os.environ['SAGE_PARI_CFG']` by `os.environ.get('SAGE_PARI_CFG')` in `sage_setuo/docbuild/__init__.py`.


---

Comment by fbissey created at 2019-08-11 22:09:08

`@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?


---

Comment by dimpase created at 2019-08-11 22:43:31

using SAGE_PARI_CFG in docbuild is a hack.
One should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. 

SAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc


---

Comment by fbissey created at 2019-08-11 22:47:09

Replying to [comment:5 dimpase]:
> using SAGE_PARI_CFG in docbuild is a hack.
> One should really test whether the external pari is multithreaded, this is something that can be done, I just didn't do. 
> 
> SAGE_PARI_CFG is storing the location of pari.cfg, something hard to find out, and needed to install gp2c, see https://git.sagemath.org/sage.git/diff/build/pkgs/gp2c/spkg-configure.m4?id=46772dbb31f2be940bda299136455f495c6a21dc

Yes, I figured that out. On the other hand `sage_setup/docbuild/__init__.py` may not be the right place to check. So at the moment I just want to make sure that on distro where you don't run `configure` you get the same result as what you would expect if sage doesn't build `pari` but finds it on the system.


---

Comment by dimpase created at 2019-08-11 22:54:40

Replying to [comment:3 fbissey]:
> `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?

This is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.


---

Comment by fbissey created at 2019-08-11 23:03:28

Replying to [comment:7 dimpase]:
> Replying to [comment:3 fbissey]:
> > `@`Dima just so I don't make a mistake. `''` is the value you get when `pari` is coming from the system?
> 
> This is the value I *set*. But you can just unconditionally switch to the appropriate docbuilder in Gentoo.

I remarked on that in #28242. This is about having something working out of the box without extra patching or settings. Just using `os.environ.get()` already does enable me to build the doc without `SAGE_PARI_CFG` being set, which is a progress. I am testing the alternative builder now. Not that I can currently build the doc on Volker's branch because there is a label missing in the doc for manifolds from one of the tickets he is trying to merge.


---

Comment by fbissey created at 2019-08-12 00:30:56

Changing status from new to needs_review.


---

Comment by fbissey created at 2019-08-12 00:30:56

Last 10 new commits:


---

Comment by dimpase created at 2019-08-12 05:15:49

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2019-08-12 05:15:49

lgtm


---

Comment by vbraun created at 2019-08-13 22:39:20

Resolution: fixed
