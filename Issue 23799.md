# Issue 23799: Orthogonal groups for IntegralLattices

archive/issues_023799.json:
```json
{
    "body": "Implement a class for the orthogonal group of integral lattices.\nIts elements are isometries of the ambient spaces which preserve the lattice. \n\nAs functionality:\n- Its elements have an action on elements of the ambient space and the lattice\n- action on the dual lattice\n- It is be a matrix group\n- Compute generators in case the lattice is positive definite. One can use `QuadraticForm.automorphisms()` for that.\n- It should also work for indefinite lattices. Just have some not implemented errors - like the generators.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24036\n\n",
    "created_at": "2017-10-13T15:16:29Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Orthogonal groups for IntegralLattices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23799",
    "user": "https://github.com/simonbrandhorst"
}
```
Implement a class for the orthogonal group of integral lattices.
Its elements are isometries of the ambient spaces which preserve the lattice. 

As functionality:
- Its elements have an action on elements of the ambient space and the lattice
- action on the dual lattice
- It is be a matrix group
- Compute generators in case the lattice is positive definite. One can use `QuadraticForm.automorphisms()` for that.
- It should also work for indefinite lattices. Just have some not implemented errors - like the generators.

Issue created by migration from https://trac.sagemath.org/ticket/24036





---

archive/issue_comments_333047.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to linear algebra.",
    "created_at": "2017-10-13T15:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333047",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing component from PLEASE CHANGE to linear algebra.



---

archive/issue_comments_333048.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-10-13T15:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333048",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_333049.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-08T08:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333049",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333050.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-10T14:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333050",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333051.json:
```json
{
    "body": "We still need to make sure that the actions are working.\nIn particular on the discriminantGroup.",
    "created_at": "2017-11-10T14:09:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333051",
    "user": "https://github.com/simonbrandhorst"
}
```

We still need to make sure that the actions are working.
In particular on the discriminantGroup.



---

archive/issue_comments_333052.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-25T10:07:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333052",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333053.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-11-25T16:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333053",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_333054.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2017-12-08T10:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333054",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_333055.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-08T16:55:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333055",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333056.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-08T16:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333056",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_333057.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-09T14:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333057",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333058.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-14T07:44:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333058",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333059.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-19T16:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333059",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333060.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-19T16:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333060",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333061.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-19T16:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333061",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333062.json:
```json
{
    "body": "The documentation builds and seems to look O.K. \nTests pass too. Still waiting for patchbot. \n\nOne might want to consider moving the code to a different file to improve documentation?",
    "created_at": "2018-01-19T16:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333062",
    "user": "https://github.com/simonbrandhorst"
}
```

The documentation builds and seems to look O.K. 
Tests pass too. Still waiting for patchbot. 

One might want to consider moving the code to a different file to improve documentation?



---

archive/issue_comments_333063.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-23T14:03:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333063",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333064.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-24T08:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333064",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333065.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-01-28T08:49:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333065",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333066.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-09T14:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333066",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333067.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-10T12:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333067",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333068.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-26T12:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333068",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_333069.json:
```json
{
    "body": "Some comment:\n\n* The line `submodule -- an invariant submodule` in `GroupActionOnQuotientModule` needs to be changed from submodule to quotient.\n* The actions allow `is_left=True` but then ignore it in the implementation of `_call_`.\n* There is no check that the invariant submodule and quotient module passed into the `__init__` method of `GroupOfIsometries` are actually invariant.\n* In `/src/sage/groups/matrix_gps/orthogonal.py`, you say that you add `OrthogonalMatrixGroup_with_gap` but don't, and you import `FinitelyGeneratedMatrixGroup_gap` and `Action` but don't use them.\n* It's better to use `gens is None` rather than `gens == None`\n* The `is_finite` keyword on the `orthogonal_group` method should be documented better (or removed).\n* Should `orthogonal_group` be a cached method?",
    "created_at": "2018-02-26T12:47:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333069",
    "user": "https://github.com/roed314"
}
```

Some comment:

* The line `submodule -- an invariant submodule` in `GroupActionOnQuotientModule` needs to be changed from submodule to quotient.
* The actions allow `is_left=True` but then ignore it in the implementation of `_call_`.
* There is no check that the invariant submodule and quotient module passed into the `__init__` method of `GroupOfIsometries` are actually invariant.
* In `/src/sage/groups/matrix_gps/orthogonal.py`, you say that you add `OrthogonalMatrixGroup_with_gap` but don't, and you import `FinitelyGeneratedMatrixGroup_gap` and `Action` but don't use them.
* It's better to use `gens is None` rather than `gens == None`
* The `is_finite` keyword on the `orthogonal_group` method should be documented better (or removed).
* Should `orthogonal_group` be a cached method?



---

archive/issue_comments_333070.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T13:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333070",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333071.json:
```json
{
    "body": "You wrote:\nShould orthogonal_group be a cached method? \n\nI would like that. But sometimes the input (=a list of generators) may be non-hashable and then\n`@`cashed method throws an error. Is there an easy way around?",
    "created_at": "2018-02-26T13:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333071",
    "user": "https://github.com/simonbrandhorst"
}
```

You wrote:
Should orthogonal_group be a cached method? 

I would like that. But sometimes the input (=a list of generators) may be non-hashable and then
`@`cashed method throws an error. Is there an easy way around?



---

archive/issue_comments_333072.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-26T13:51:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333072",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_333073.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-26T14:32:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333073",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_333074.json:
```json
{
    "body": "Doc builds now.",
    "created_at": "2018-02-26T14:34:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333074",
    "user": "https://github.com/simonbrandhorst"
}
```

Doc builds now.



---

archive/issue_comments_333075.json:
```json
{
    "body": "Replying to [comment:26 sbrandhorst]:\n> You wrote:\n> Should orthogonal_group be a cached method? \n> \n> I would like that. But sometimes the input (=a list of generators) may be non-hashable and then\n> ``@`cached_method` throws an error. Is there an easy way around?\n\n\nYeah, ``@`cached_method` supports a key to normalize the input, which you can use to make it hashable.  From the docstring for `cached_method`,\n\n```\n    The parameter ``key`` can be used to pass a function which creates a\n    custom cache key for inputs. In the following example, this parameter is\n    used to ignore the ``algorithm`` keyword for caching::\n\n        sage: class A(object):\n        ....:     def _f_normalize(self, x, algorithm): return x\n        ....:     @cached_method(key=_f_normalize)\n        ....:     def f(self, x, algorithm='default'): return x\n        sage: a = A()\n        sage: a.f(1, algorithm=\"default\") is a.f(1) is a.f(1, algorithm=\"algorithm\")\n        True\n```",
    "created_at": "2018-02-27T14:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333075",
    "user": "https://github.com/roed314"
}
```

Replying to [comment:26 sbrandhorst]:
> You wrote:
> Should orthogonal_group be a cached method? 
> 
> I would like that. But sometimes the input (=a list of generators) may be non-hashable and then
> ``@`cached_method` throws an error. Is there an easy way around?


Yeah, ``@`cached_method` supports a key to normalize the input, which you can use to make it hashable.  From the docstring for `cached_method`,

```
    The parameter ``key`` can be used to pass a function which creates a
    custom cache key for inputs. In the following example, this parameter is
    used to ignore the ``algorithm`` keyword for caching::

        sage: class A(object):
        ....:     def _f_normalize(self, x, algorithm): return x
        ....:     @cached_method(key=_f_normalize)
        ....:     def f(self, x, algorithm='default'): return x
        sage: a = A()
        sage: a.f(1, algorithm="default") is a.f(1) is a.f(1, algorithm="algorithm")
        True
```



---

archive/issue_comments_333076.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-02-27T14:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333076",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_333077.json:
```json
{
    "body": "But you can leave that for another ticket.  This looks good to me.",
    "created_at": "2018-02-27T14:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333077",
    "user": "https://github.com/roed314"
}
```

But you can leave that for another ticket.  This looks good to me.



---

archive/issue_comments_333078.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-04T23:29:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23799#issuecomment-333078",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_061109.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-03-04T23:29:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23799",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23799#event-61109"
}
```
