# Issue 33535: Update ipykernel to 6.13.0 - reintroduces psutil

Issue created by migration from https://trac.sagemath.org/ticket/33772

Original creator: mkoeppe

Original creation time: 2022-04-29 18:21:33

CC:  mjo was tornaria

ipykernel >= 6.7.0 now requires psutil - https://ipykernel.readthedocs.io/en/stable/changelog.html#id33


---

Comment by mkoeppe created at 2022-04-29 18:25:44

New commits:


---

Comment by fbissey created at 2022-04-29 19:45:00

Well it depends on a python package named psutils because it mimics that functionality, but the python package in question do not require the C package psutil.

https://github.com/giampaolo/psutil https://pypi.org/project/psutil/

So the plot twist is that we can really dump the old "psutil" package in favor of something designed to be more cross platform from the start.


---

Comment by mkoeppe created at 2022-04-29 19:48:50

Hm? No, it's the same Python package that was dumped in #32656 but is now needed again for ipykernel.


---

Comment by mkoeppe created at 2022-04-29 19:50:10

Upstream psutil still doesn't support Cygwin (as far as I can see)


---

Comment by fbissey created at 2022-04-29 19:51:34

My mistake, I always thought it was another package that was being discussed. In fact I may have had a wrong dependency for a while :(


---

Comment by mjo created at 2022-04-29 19:56:32

Well, I know when I'm beaten. It looks like ipykernel is making the same mistakes that sage did; (a) reckless introduction of dependencies to obtain (b) meaningless memory metrics.

I don't have the energy to fight it, I'm going outside.


---

Comment by mkoeppe created at 2022-04-29 20:04:52

After some fresh air, we can try to get a simple patch into `psutil` that minimally supports Cygwin by just returning a meaningless positive constant.

(The last attempt to get Cygwin support into `psutil` was trying to get a highly intrusive megapatch in.)


---

Comment by dimpase created at 2022-04-30 08:57:09

I doubt `psutil` will take any Cygwin patches (Erik's attempts to get the patch considered deteriorated into a huge fight).

We'd need a drop-in replacement on Cygwin :-(


---

Comment by dimpase created at 2022-04-30 08:59:22

IMHO less and less projects are willing to mess with Cygwin, (rightly) considering it to be a dying, obsolete, semi-broken, and dodgy.


---

Comment by mkoeppe created at 2022-06-26 18:56:32

I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)


---

Comment by dimpase created at 2022-06-27 06:59:51

Replying to [comment:12 mkoeppe]:
> I don't think that's a trend. In the past, no project even had a Cygwin test infrastructure. This has changed with the availability of GitHub Actions - in particular https://github.com/cygwin/cygwin-install-action
> Also, in the past, MinGW and Cygwin carried their own downstream patches for CPython etc. This is now getting increasingly upstreamed (search in https://setuptools.pypa.io/en/latest/history.html)
> 

but the upstream (Jupyter & Co) don't even try to support Cygwin.


---

Comment by dimpase created at 2022-06-30 16:14:23

I think it's OK to make ipython and jupyter optional. After all, although I'm not 100% sure, it ought to be possible to use a native Windows Jupyter to connect to the cygwin Sage jupyter kernel.


---

Comment by mkoeppe created at 2022-06-30 17:54:07

#30306 lists a number of tickets to try out and document such setups, but nobody has done the work
