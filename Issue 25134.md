# Issue 25134: py3: towards docbuild, more details

Issue created by migration from https://trac.sagemath.org/ticket/25371

Original creator: chapoton

Original creation time: 2018-05-16 09:25:48

CC:  tscrim jmantysalo




---

Comment by chapoton created at 2018-05-16 09:26:39

New commits:


---

Comment by chapoton created at 2018-05-16 09:26:39

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2018-05-16 15:06:05

Changing status from needs_review to needs_info.


---

Comment by jdemeyer created at 2018-05-16 15:06:05

What's wrong with

```
P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
```



---

Comment by chapoton created at 2018-05-16 15:50:03


```
[dochtml] [plotting ] During handling of the above exception, another exception occurred:
[dochtml] [plotting ] Traceback (most recent call last):
[dochtml] [plotting ] File "/home/chapoton/sage3/local/lib/python3.6/site-packages/matplotlib/sphinxext/plot_directive.py", line 525, in run_code
[dochtml] [plotting ] six.exec_(code, ns)
[dochtml] [plotting ] File "<string>", line 1, in <module>
[dochtml] [plotting ] File "sage/symbolic/expression.pyx", line 5721, in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)
[dochtml] [plotting ] File "sage/symbolic/expression.pyx", line 1073, in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)
[dochtml] [plotting ] TypeError: unable to convert 20*pi + 1 to an integer
```



---

Comment by jdemeyer created at 2018-05-17 10:12:41

Well, that's a genuine problem. Why shouldn't we no longer be allowed to use symbolic expressions in plots?


---

Comment by jdemeyer created at 2018-05-17 10:15:40

I reverted that because it tries to fix the doctest instead of the bug.

The other change gets positive review.
----
New commits:


---

Comment by jdemeyer created at 2018-05-17 10:15:40

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2018-05-18 17:49:49

Resolution: fixed


---

Comment by chapoton created at 2018-05-18 18:50:39

Jeroen, see your own comment here: #24758#comment:2


---

Comment by chapoton created at 2018-05-28 06:58:14

And the range behaviour itself is not working with python3. I do not think we should change that.

```
sage: list(range(20*pi+3))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9051)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.pyobject (build/cythonized/sage/symbolic/expression.cpp:6090)()

TypeError: self must be a numeric expression

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-1-3c6188e69b81> in <module>()
----> 1 list(range(Integer(20)*pi+Integer(3)))

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression.__index__ (build/cythonized/sage/symbolic/expression.cpp:35714)()

/home/chapoton/sage3/local/lib/python3.6/site-packages/sage/symbolic/expression.pyx in sage.symbolic.expression.Expression._integer_ (build/cythonized/sage/symbolic/expression.cpp:9100)()

TypeError: unable to convert 20*pi + 3 to an integer
```



---

Comment by chapoton created at 2018-06-13 16:04:28

Jeroen, would you accept this change that you refused here (in another ticket):

```patch
-        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
+        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])
```

It seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.


---

Comment by jdemeyer created at 2018-06-14 05:43:11

Replying to [comment:10 chapoton]:
> Jeroen, would you accept this change that you refused here (in another ticket):
> {{{
> #!patch
> -        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(0,20*pi+1)])
> +        P = sum([arrow2d((0,0), (cos(x*0.1),sin(x*0.1)), hue=x/(20*pi)) for x in range(floor(20*pi)+1)])
> }}}

That's not precisely the change that I rejected. You changed `20*pi` by `63` originally in multiple places.

Anyway, let me figure out exactly what `range()` accepts on Python 2 and Python 3 and then I'll comment back.


---

Comment by jdemeyer created at 2018-06-14 08:38:19

Replying to [comment:10 chapoton]:
> It seems to me that there is no issue in sage, only the fact that python3 is more strict on what it accepts inside range.

I agree. Python 2 essentially replaces `range(foo)` by `range(int(foo))`. Python 3 requires an integer as argument to `range()`.


---

Comment by chapoton created at 2018-06-14 13:37:49

Ok. I have made the ticket in #25578
