# Issue 10524: Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified

archive/issues_010524.json:
```json
{
    "body": "Assignee: jason, was\n\nCC:  jonhanke@gmail.com\n\nKeywords: GF(2), vectorspace, characteristic 2\n\nDeepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.\n\n==============================================\n\nsage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =\nDiagonalMatrix(GF(3), [1,1]))\nsage: deepcopy(V3)\nAmbient quadratic space of dimension 2 over Finite Field of size 3\nInner product matrix:\n[1 0]\n[0 1]\n\nsage: V2 = VectorSpace(GF(2), 2)\nsage: deepcopy(V2)\nVector space of dimension 2 over Finite Field of size 2\n\nsage: M2 = DiagonalMatrix(GF(2), [1,1])\nsage: deepcopy(M2)\n[1 0]\n[0 1]\n\nsage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =\nDiagonalMatrix(GF(2), [1,1]))\nsage:\nsage:\nsage: deepcopy(V2)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in\ndeepcopy(x, memo, _nil)\n    187                             raise Error(\n    188                                 \"un(deep)copyable object of type %s\"\n% cls)\n--> 189                 y = _reconstruct(x, rv, 1, memo)\n    190\n    191     memo[d] = y\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in\n_reconstruct(x, info, deep, memo)\n    321     if deep:\n    322         args = deepcopy(args, memo)\n--> 323     y = callable(*args)\n    324     memo[id(x)] = y\n    325     if listiter is not None:\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.generic_factory_unpickle\n(sage/structure/factory.c:2277)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.UniqueFactory.get_object\n(sage/structure/factory.c:1633)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so\nin sage.structure.factory.UniqueFactory.get_object\n(sage/structure/factory.c:1049)()\n\n/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so\nin sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.__hash__\n(sage/matrix/matrix_mod2_dense.c:3222)()\n\nTypeError: mutable matrices are unhashable\n\nIssue created by migration from https://trac.sagemath.org/ticket/10577\n\n",
    "created_at": "2011-01-09T22:14:42Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10524",
    "user": "https://github.com/jonhanke"
}
```
Assignee: jason, was

CC:  jonhanke@gmail.com

Keywords: GF(2), vectorspace, characteristic 2

Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.

==============================================

sage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =
DiagonalMatrix(GF(3), [1,1]))
sage: deepcopy(V3)
Ambient quadratic space of dimension 2 over Finite Field of size 3
Inner product matrix:
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2)
sage: deepcopy(V2)
Vector space of dimension 2 over Finite Field of size 2

sage: M2 = DiagonalMatrix(GF(2), [1,1])
sage: deepcopy(M2)
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
DiagonalMatrix(GF(2), [1,1]))
sage:
sage:
sage: deepcopy(V2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
deepcopy(x, memo, _nil)
    187                             raise Error(
    188                                 "un(deep)copyable object of type %s"
% cls)
--> 189                 y = _reconstruct(x, rv, 1, memo)
    190
    191     memo[d] = y

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
_reconstruct(x, info, deep, memo)
    321     if deep:
    322         args = deepcopy(args, memo)
--> 323     y = callable(*args)
    324     memo[id(x)] = y
    325     if listiter is not None:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.generic_factory_unpickle
(sage/structure/factory.c:2277)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1633)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1049)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so
in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.__hash__
(sage/matrix/matrix_mod2_dense.c:3222)()

TypeError: mutable matrices are unhashable

Issue created by migration from https://trac.sagemath.org/ticket/10577





---

archive/issue_comments_109726.json:
```json
{
    "body": "Works with 8.2.beta8\n\n```\nsage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =\n....: matrix.diagonal(GF(2), [1,1]))\nsage: deepcopy(V2)\nAmbient quadratic space of dimension 2 over Finite Field of size 2\nInner product matrix:\n[1 0]\n[0 1]\n```\n",
    "created_at": "2018-03-20T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109726",
    "user": "https://github.com/simonbrandhorst"
}
```

Works with 8.2.beta8

```
sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
....: matrix.diagonal(GF(2), [1,1]))
sage: deepcopy(V2)
Ambient quadratic space of dimension 2 over Finite Field of size 2
Inner product matrix:
[1 0]
[0 1]
```




---

archive/issue_comments_109727.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-20T12:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109727",
    "user": "https://github.com/simonbrandhorst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_109728.json:
```json
{
    "body": "adding a doctest\n----\nNew commits:",
    "created_at": "2018-04-15T12:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109728",
    "user": "https://github.com/fchapoton"
}
```

adding a doctest
----
New commits:



---

archive/issue_comments_109729.json:
```json
{
    "body": "green bot, please review",
    "created_at": "2018-04-15T14:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109729",
    "user": "https://github.com/fchapoton"
}
```

green bot, please review



---

archive/issue_comments_109730.json:
```json
{
    "body": "Add your name as an author and you have it.",
    "created_at": "2018-04-18T14:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109730",
    "user": "https://github.com/simonbrandhorst"
}
```

Add your name as an author and you have it.



---

archive/issue_comments_109731.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-04-18T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109731",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_109732.json:
```json
{
    "body": "thanx",
    "created_at": "2018-04-18T14:05:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109732",
    "user": "https://github.com/fchapoton"
}
```

thanx



---

archive/issue_comments_109733.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-05-08T17:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10524#issuecomment-109733",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_010652.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2018-05-08T17:27:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10524",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10524#event-10652"
}
```
