# Issue 10524: Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified

Issue created by migration from Trac.

Original creator: jonhanke

Original creation time: 2011-01-09 22:14:42

Assignee: jason, was

CC:  jonhanke@gmail.com

Keywords: GF(2), vectorspace, characteristic 2

Deepcopy fails on vectorspaces over GF(2) with inner_product_matrix specified, but works for vectorspaces over GF(p) if either p>2 or the inner_product_matrix is not specified.  Apparently there is some issue with using mutable matrices.

==============================================

sage: V3 = VectorSpace(GF(3), 2, inner_product_matrix =
DiagonalMatrix(GF(3), [1,1]))
sage: deepcopy(V3)
Ambient quadratic space of dimension 2 over Finite Field of size 3
Inner product matrix:
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2)
sage: deepcopy(V2)
Vector space of dimension 2 over Finite Field of size 2

sage: M2 = DiagonalMatrix(GF(2), [1,1])
sage: deepcopy(M2)
[1 0]
[0 1]

sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
DiagonalMatrix(GF(2), [1,1]))
sage:
sage:
sage: deepcopy(V2)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)

/Users/jonhanke/Documents/SAGE/sage-4.6/<ipython console> in <module>()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
deepcopy(x, memo, _nil)
    187                             raise Error(
    188                                 "un(deep)copyable object of type %s"
% cls)
--> 189                 y = _reconstruct(x, rv, 1, memo)
    190
    191     memo[d] = y

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python/copy.pyc in
_reconstruct(x, info, deep, memo)
    321     if deep:
    322         args = deepcopy(args, memo)
--> 323     y = callable(*args)
    324     memo[id(x)] = y
    325     if listiter is not None:

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.generic_factory_unpickle
(sage/structure/factory.c:2277)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1633)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/structure/factory.so
in sage.structure.factory.UniqueFactory.get_object
(sage/structure/factory.c:1049)()

/Users/jonhanke/Documents/SAGE/sage-4.6/local/lib/python2.6/site-packages/sage/matrix/matrix_mod2_dense.so
in sage.matrix.matrix_mod2_dense.Matrix_mod2_dense.__hash__
(sage/matrix/matrix_mod2_dense.c:3222)()

TypeError: mutable matrices are unhashable


---

Comment by sbrandhorst created at 2018-03-20 12:45:08

Works with 8.2.beta8

```
sage: V2 = VectorSpace(GF(2), 2, inner_product_matrix =
....: matrix.diagonal(GF(2), [1,1]))
sage: deepcopy(V2)
Ambient quadratic space of dimension 2 over Finite Field of size 2
Inner product matrix:
[1 0]
[0 1]
```



---

Comment by sbrandhorst created at 2018-03-20 12:45:08

Changing status from new to needs_review.


---

Comment by chapoton created at 2018-04-15 12:12:58

adding a doctest
----
New commits:


---

Comment by chapoton created at 2018-04-15 14:46:07

green bot, please review


---

Comment by sbrandhorst created at 2018-04-18 14:04:50

Add your name as an author and you have it.


---

Comment by chapoton created at 2018-04-18 14:05:55

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2018-04-18 14:05:55

thanx


---

Comment by vbraun created at 2018-05-08 17:27:43

Resolution: fixed
