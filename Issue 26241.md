# Issue 26241: clean graph_plot_js.py, graph_list.py and graph_input.py

archive/issues_026241.json:
```json
{
    "body": "CC:  @tscrim\n\nKeywords: py3, graph\n\nclean the files (PEP8) and simplification of some tests\n\nIssue created by migration from https://trac.sagemath.org/ticket/26478\n\n",
    "created_at": "2018-10-12T15:20:47Z",
    "labels": [
        "graph theory",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.5",
    "title": "clean graph_plot_js.py, graph_list.py and graph_input.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26241",
    "user": "@dcoudert"
}
```
CC:  @tscrim

Keywords: py3, graph

clean the files (PEP8) and simplification of some tests

Issue created by migration from https://trac.sagemath.org/ticket/26478





---

archive/issue_comments_369822.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-10-12T15:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369822",
    "user": "@dcoudert"
}
```

New commits:



---

archive/issue_comments_369823.json:
```json
{
    "body": "The most significant changes are in `graph_input.py` as I changed some tests.",
    "created_at": "2018-10-12T15:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369823",
    "user": "@dcoudert"
}
```

The most significant changes are in `graph_input.py` as I changed some tests.



---

archive/issue_comments_369824.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-10-12T15:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369824",
    "user": "@dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_369825.json:
```json
{
    "body": "For this change:\n\n```diff\n-    if not loops and any(u in neighb for u,neighb in six.iteritems(M)):\n-        if loops is False:\n-            u = next(u for u,neighb in six.iteritems(M) if u in neighb)\n-            raise ValueError(\"The graph was built with loops=False but input M has a loop at {}.\".format(u))\n-        loops = True\n-    if loops is None:\n-        loops = False\n+    if any(not isinstance(M[u], dict) for u in M):\n+        raise ValueError(\"input dict must be a consistent format\")\n+\n+    if not loops:\n+        for u, neighb in six.iteritems(M):\n+            if u in neighb:\n+                if loops is False:\n+                    raise ValueError(\"the graph was built with loops=False but input M has a loop at {}\".format(u))\n+                loops = True\n+                break\n+        if loops is None:\n+            loops = False\n```\n\nthe `any` call is actually faster. Granted, your change will result in a faster error, but I think an error message being here is unexpected. Hence it is allowed to be slow. If someone really wants the extra speed and is using that test to separate cases, they should run their own test instead of catching the error (which is faster). So I am inclined to revert this.\n\nAlso, strictly speaking, the items for `INPUT:` are not sentences and do not end in a period (although some of them are sufficiently long with multiple parts that require it). While I was letting this slide when it was previously there, the ones you are adding should not have it.\n\nAll of the other changes LGTM.",
    "created_at": "2018-10-12T22:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369825",
    "user": "@tscrim"
}
```

For this change:

```diff
-    if not loops and any(u in neighb for u,neighb in six.iteritems(M)):
-        if loops is False:
-            u = next(u for u,neighb in six.iteritems(M) if u in neighb)
-            raise ValueError("The graph was built with loops=False but input M has a loop at {}.".format(u))
-        loops = True
-    if loops is None:
-        loops = False
+    if any(not isinstance(M[u], dict) for u in M):
+        raise ValueError("input dict must be a consistent format")
+
+    if not loops:
+        for u, neighb in six.iteritems(M):
+            if u in neighb:
+                if loops is False:
+                    raise ValueError("the graph was built with loops=False but input M has a loop at {}".format(u))
+                loops = True
+                break
+        if loops is None:
+            loops = False
```

the `any` call is actually faster. Granted, your change will result in a faster error, but I think an error message being here is unexpected. Hence it is allowed to be slow. If someone really wants the extra speed and is using that test to separate cases, they should run their own test instead of catching the error (which is faster). So I am inclined to revert this.

Also, strictly speaking, the items for `INPUT:` are not sentences and do not end in a period (although some of them are sufficiently long with multiple parts that require it). While I was letting this slide when it was previously there, the ones you are adding should not have it.

All of the other changes LGTM.



---

archive/issue_comments_369826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-13T08:00:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369826",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369827.json:
```json
{
    "body": "The following lines are apparently incompatible with Python 3 (see patchbot).\n\n```diff\n+        if any(u in neighb for u,neighb in six.iteritems(M)):\n+                u = next(u for u,neighb in six.iteritems(M) if u in neighb)\n```\n\n\n```diff\n+        if any(u in neighb for u, neighb in six.iteritems(D)):\n+                u = next(u for u, neighb in six.iteritems(M) if u in neighb)\n```\n\nIs there a special trick or should I turn these lines to for loops ?",
    "created_at": "2018-10-13T11:43:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369827",
    "user": "@dcoudert"
}
```

The following lines are apparently incompatible with Python 3 (see patchbot).

```diff
+        if any(u in neighb for u,neighb in six.iteritems(M)):
+                u = next(u for u,neighb in six.iteritems(M) if u in neighb)
```


```diff
+        if any(u in neighb for u, neighb in six.iteritems(D)):
+                u = next(u for u, neighb in six.iteritems(M) if u in neighb)
```

Is there a special trick or should I turn these lines to for loops ?



---

archive/issue_comments_369828.json:
```json
{
    "body": "No, no. It's just the patchbot prefering \"iteritems\" to \"six.iteritems\". Just change the imports accordingly.\n\nAnd once again, it is never mandatory to have all green lights from the patchbot, as the patchbot is not smart..",
    "created_at": "2018-10-13T12:34:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369828",
    "user": "@fchapoton"
}
```

No, no. It's just the patchbot prefering "iteritems" to "six.iteritems". Just change the imports accordingly.

And once again, it is never mandatory to have all green lights from the patchbot, as the patchbot is not smart..



---

archive/issue_comments_369829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-13T13:40:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369829",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369830.json:
```json
{
    "body": "Good to know. As I'm not Python 3 expert, I thought it could be something else.",
    "created_at": "2018-10-13T13:41:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369830",
    "user": "@dcoudert"
}
```

Good to know. As I'm not Python 3 expert, I thought it could be something else.



---

archive/issue_comments_369831.json:
```json
{
    "body": "Doctest failures:\n\n```\nFile \"src/sage/graphs/digraph.py\", line 399, in sage.graphs.digraph.DiGraph\nFailed example:\n    D = DiGraph('IRAaDCIIOEOKcPWAo')\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: The string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short.\nGot:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: the string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short\n```\n\nand similar in `graph.py`. Once fixed and the patchbot comes back green, then it will be a positive review.",
    "created_at": "2018-10-19T15:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369831",
    "user": "@tscrim"
}
```

Doctest failures:

```
File "src/sage/graphs/digraph.py", line 399, in sage.graphs.digraph.DiGraph
Failed example:
    D = DiGraph('IRAaDCIIOEOKcPWAo')
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: The string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short.
Got:
    Traceback (most recent call last):
    ...
    RuntimeError: the string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short
```

and similar in `graph.py`. Once fixed and the patchbot comes back green, then it will be a positive review.



---

archive/issue_comments_369832.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-19T16:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369832",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369833.json:
```json
{
    "body": "I fixed the doctests. Now waiting for the patchbot.",
    "created_at": "2018-10-19T16:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369833",
    "user": "@dcoudert"
}
```

I fixed the doctests. Now waiting for the patchbot.



---

archive/issue_comments_369834.json:
```json
{
    "body": "Thanks.",
    "created_at": "2018-10-22T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369834",
    "user": "@tscrim"
}
```

Thanks.



---

archive/issue_comments_369835.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-22T02:09:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369835",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369836.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2018-10-22T22:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369836",
    "user": "@vbraun"
}
```

Merge conflict



---

archive/issue_comments_369837.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2018-10-22T22:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369837",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_369838.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-10-23T08:46:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369838",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_369839.json:
```json
{
    "body": "I fixed the merge conflict with 8.5.beta0",
    "created_at": "2018-10-23T08:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369839",
    "user": "@dcoudert"
}
```

I fixed the merge conflict with 8.5.beta0



---

archive/issue_comments_369840.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-10-23T08:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369840",
    "user": "@dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_369841.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-10-23T16:05:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369841",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_369842.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-10-24T21:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26241#issuecomment-369842",
    "user": "@vbraun"
}
```

Resolution: fixed
