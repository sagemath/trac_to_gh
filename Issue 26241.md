# Issue 26241: clean graph_plot_js.py, graph_list.py and graph_input.py

Issue created by migration from https://trac.sagemath.org/ticket/26478

Original creator: dcoudert

Original creation time: 2018-10-12 15:20:47

CC:  tscrim

Keywords: py3, graph

clean the files (PEP8) and simplification of some tests


---

Comment by dcoudert created at 2018-10-12 15:21:57

New commits:


---

Comment by dcoudert created at 2018-10-12 15:24:50

The most significant changes are in `graph_input.py` as I changed some tests.


---

Comment by dcoudert created at 2018-10-12 15:24:50

Changing status from new to needs_review.


---

Comment by tscrim created at 2018-10-12 22:49:18

For this change:

```diff
-    if not loops and any(u in neighb for u,neighb in six.iteritems(M)):
-        if loops is False:
-            u = next(u for u,neighb in six.iteritems(M) if u in neighb)
-            raise ValueError("The graph was built with loops=False but input M has a loop at {}.".format(u))
-        loops = True
-    if loops is None:
-        loops = False
+    if any(not isinstance(M[u], dict) for u in M):
+        raise ValueError("input dict must be a consistent format")
+
+    if not loops:
+        for u, neighb in six.iteritems(M):
+            if u in neighb:
+                if loops is False:
+                    raise ValueError("the graph was built with loops=False but input M has a loop at {}".format(u))
+                loops = True
+                break
+        if loops is None:
+            loops = False
```

the `any` call is actually faster. Granted, your change will result in a faster error, but I think an error message being here is unexpected. Hence it is allowed to be slow. If someone really wants the extra speed and is using that test to separate cases, they should run their own test instead of catching the error (which is faster). So I am inclined to revert this.

Also, strictly speaking, the items for `INPUT:` are not sentences and do not end in a period (although some of them are sufficiently long with multiple parts that require it). While I was letting this slide when it was previously there, the ones you are adding should not have it.

All of the other changes LGTM.


---

Comment by git created at 2018-10-13 08:00:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-13 11:43:59

The following lines are apparently incompatible with Python 3 (see patchbot).

```diff
+        if any(u in neighb for u,neighb in six.iteritems(M)):
+                u = next(u for u,neighb in six.iteritems(M) if u in neighb)
```


```diff
+        if any(u in neighb for u, neighb in six.iteritems(D)):
+                u = next(u for u, neighb in six.iteritems(M) if u in neighb)
```

Is there a special trick or should I turn these lines to for loops ?


---

Comment by chapoton created at 2018-10-13 12:34:13

No, no. It's just the patchbot prefering "iteritems" to "six.iteritems". Just change the imports accordingly.

And once again, it is never mandatory to have all green lights from the patchbot, as the patchbot is not smart..


---

Comment by git created at 2018-10-13 13:40:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-13 13:41:52

Good to know. As I'm not Python 3 expert, I thought it could be something else.


---

Comment by tscrim created at 2018-10-19 15:40:44

Doctest failures:

```
File "src/sage/graphs/digraph.py", line 399, in sage.graphs.digraph.DiGraph
Failed example:
    D = DiGraph('IRAaDCIIOEOKcPWAo')
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: The string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short.
Got:
    Traceback (most recent call last):
    ...
    RuntimeError: the string (IRAaDCIIOEOKcPWAo) seems corrupt: for n = 10, the string is too short
```

and similar in `graph.py`. Once fixed and the patchbot comes back green, then it will be a positive review.


---

Comment by git created at 2018-10-19 16:10:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-19 16:11:23

I fixed the doctests. Now waiting for the patchbot.


---

Comment by tscrim created at 2018-10-22 02:09:04

Thanks.


---

Comment by tscrim created at 2018-10-22 02:09:04

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-22 22:41:47

Merge conflict


---

Comment by vbraun created at 2018-10-22 22:41:47

Changing status from positive_review to needs_work.


---

Comment by git created at 2018-10-23 08:46:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2018-10-23 08:48:22

I fixed the merge conflict with 8.5.beta0


---

Comment by dcoudert created at 2018-10-23 08:48:22

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2018-10-23 16:05:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-10-24 21:10:51

Resolution: fixed
