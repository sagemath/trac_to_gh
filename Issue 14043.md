# Issue 14043: bell numbers in mpmath is incorrect

Issue created by migration from https://trac.sagemath.org/ticket/14247

Original creator: tscrim

Original creation time: 2013-03-09 22:11:26

Assignee: sage-combinat

CC:  fredrik.johansson

With #10170, for at least `n >= 30`, mpmath's `bell(n)` is incorrect:

```
sage: bell_number(30, 'mpmath') 
846749014511809388871680
sage: bell_number(30, 'gap')   
846749014511809332450147
```

The GAP implementation is the correct one (it agrees with OEIS and the implementation in #10170 for `n > 200`). I don't know if this is a me (i.e. this is fixed in an upgrade of mpmath not yet merged as of `5.8.beta1`), sage, or an mpmath issue.


---

Comment by fredrik.johansson created at 2013-03-11 18:09:29

It's not enough to call mpmath.bell(n) and convert to an integer since it gives a floating-point approximation; you need to set the precision to slightly more than log_2(B_n) bits.


---

Attachment


---

Comment by tscrim created at 2013-03-11 19:10:06

Changing status from new to needs_review.


---

Comment by tscrim created at 2013-03-11 19:10:06

Ah okay. Thank you.

I've uploaded a patch which gives `bell_number()` an optional argument to temporarily set mpmath's precision higher (thus `bell_number()` [with the algorithm set to 'mpmath'] effectively just wraps mpmath's `bell`).


---

Comment by fredrik.johansson created at 2013-03-11 19:50:33

It doesn't make sense to return an incorrect value by default.

A better solution would be to set the precision to say 10 bits, compute p = mpmath.mag(mpmath.bell(n)) + 10, set mpmath.prec = p, then compute ret = ZZ(int(bell(n))).


---

Comment by tscrim created at 2013-03-18 19:50:30

I've done what you suggested and folded this patch into #10170 since #10170 is not yet reviewed and this is basically part of #10170. I've also set this ticket as a duplicate.


---

Comment by ncohen created at 2013-03-24 19:28:41

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2013-03-24 19:28:41

(so that Jeroen sees it and closes it)

Nathann


---

Comment by ncohen created at 2013-03-24 19:29:22

Could you also add this to the description of #10170 and check that the bug is fixed with a doctest there ?

Nathann


---

Comment by jdemeyer created at 2013-03-29 19:09:34

Resolution: duplicate
