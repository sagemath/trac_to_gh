# Issue 29712: Dynamical Systems On Berkovich Space

Issue created by migration from https://trac.sagemath.org/ticket/29949

Original creator: @EnderWannabe

Original creation time: 2020-06-23 23:53:14

CC:  bhutz paulfili

The goal of this ticket is to implement basic dynamical system functionality on Berkovich space over `Cp`. The immediate goal is to be able to compute the image of points. Type I points can be computed with the existing functionality in Sage. Type II, III and IV points will require additional functionality, to be implemented in this ticket.

This ticket relies heavily on the implementation of Berkovich space in #29844.


---

Comment by git created at 2020-06-25 23:47:14

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-06-29 19:03:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-29 22:12:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-30 22:16:37

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-07-30 22:17:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-07-31 18:51:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-03 18:56:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-08-05 14:55:56

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by git created at 2020-08-06 14:42:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2020-08-14 16:37:13

btw, you should mark this as "needs-review" and mark yourself as author.

I'm still waiting for compilation to finish, but here is some comments from a code review. Nothing really major here.


need to include latest 29844

do you really needs the ._polys data as this is already contained in ._system._polys?



14: date needed

58: should give the class dynamical system

60: p-adic

95: affine dynamical system

98: z^2 + 1

129: extra words

172: You seem to be trapping the error in creating the dynamical system, which would give information about what failed in trying to create the dynamical system. It seems like that information would be helpful rather than the more generic error you display

175: What if you have a dynamical system defined on a subscheme?

_eq_, _neq_: you have no tests that check that two systems are unequal

256: ending .

274: need ' - '

319: shouldn't this be relative dimension? Although I'd be inclined to just say 'dimension' as the base will be a field anyway.

318: class of dynamical system

348: trailing whitespace

370: The error is really that you cannot convert not that you know it is affine. Again you masking the more specific initialization error. I can somewhat see why that might be desirable here.

374: the should be projective not affine

375: dimension_absolute. So this will fail for the base being say ZZ

379: p-adic

405: Perhaps name this as_projective_dynamical_system. There is no a cooresponding function for affine. Looking at the documentation, it seems like this function is meant to be in the class:DynamicalSystem_Berkovich. In which case the name is fine.

455: What is you scale by p?

473: extra line

505,512,536,538: ending .

524: , adjugate


The _call_ documentation isn't visible to the user, so these description need to be moved. Perhaps to the class documentation.

650: isn't that error that the point is not in the domain? again, why is the error message from the coercion not better?

652: backed

654: are defined

667: some spaces for readability

719: space - space

798: this input seems more descriptive than for the other classes

849: Wouldn't homogenization be faster that calling the constructor. Also, what if you get something other than affine/projective?

847: dimensional absolute again

874: projective Berkovich space?

898: , space

918: same as before

need blank line at the end


---

Comment by bhutz created at 2020-08-14 20:05:30

A couple more things:

- 808+. An action is defined for matrices and dynamical systems: F = F*M

- for 808-816. Why don't you do

dehomogenize_hom = list((F*M).dehomogenize(1))

I didn't try it, but doesn't that do the same thing?

- 813: R.gen(0) also works

- 872 #add comment that this is the start of Type III


- Seems like this should work, since the equivalent call works for projective

```
sage: Q.<z> = QQ[]
sage: A.<a> = NumberField(z^3 + 20)
sage: ideal = A.prime_above(3)
sage: P.<z> = AffineSpace(A, 1)
sage: B = Berkovich_Cp_Affine(A, ideal)
sage: f = DynamicalSystem_Berkovich([z^2], domain=B)
```


- This is what I mean by the subscheme examples

```
P.<x,y>=ProjectiveSpace(QQ,1)
X=P.subscheme([x-y])
f=DynamicalSystem_projective([x^2,y^2],domain=X)
DynamicalSystem_Berkovich(f)
```


Your error message does not make any sense for this one.


- I also ran a few of Benedetto's image examples from his exercises and got all correct answers.


---

Comment by git created at 2020-08-14 20:45:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-14 23:23:25

Replying to [comment:12 bhutz]:
> - This is what I mean by the subscheme examples
> {{{
> P.<x,y>=ProjectiveSpace(QQ,1)
> X=P.subscheme([x-y])
> f=DynamicalSystem_projective([x<sup>2,y</sup>2],domain=X)
> DynamicalSystem_Berkovich(f)
> }}}
> 
> Your error message does not make any sense for this one.

Changed the error message slightly. The key point I'm trying to get across is the is_ProjectiveSpace() must return True when called on the domain.

Replying to [comment:11 bhutz]:

Deleted the ._polys data, switched to dimension relative. As for the error messages in the try catch blocks, in the notebook all the error messages are displayed, so the failed conversion error messages are still shown.


---

Comment by @EnderWannabe created at 2020-08-14 23:23:37

Changing status from new to needs_review.


---

Comment by bhutz created at 2020-08-19 18:54:58

A few things here:

- look at the pyflakes plug-in for unused imports

- you're missing a few doctests for coverage (the _init_ functions)

- typo in docs:


```
The image of type III points can be computed has long as the
```


- add reference in comment


```
 # point is now type III, so we compute using Proposition 7.6 [of Benedetto]
```


- I'm also getting no tab completion for Berkovich dynamical systems. I have no idea why the tab completion isn't working. Might have to ask sage-devel that one.


---

Comment by bhutz created at 2020-08-19 18:54:58

Changing status from needs_review to needs_work.


---

Comment by git created at 2020-08-19 19:52:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @EnderWannabe created at 2020-08-19 19:56:00

Added the necessary examples for 100% coverage, and fixed the unused imports. I asked on the sage-devel google group about how to fix the auto complete.


---

Comment by git created at 2020-09-09 21:05:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2020-09-16 14:42:57

I went to check tab completion on the newest beta, and I'm sill getting no tab completion here.

Note that I had a doctest failure:


```
sage -t --warn-long 57.6 --random-seed=0 berkovich_ds.py  # 1 doctest failed
```



---

Comment by git created at 2020-09-16 15:58:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.


---

Comment by bhutz created at 2021-08-23 12:41:21

Everything builds and passes for me.

The tab complete does seem to be purely a jupyter issue. For me, disabling jedi with

```
%config Completer.use_jedi = False
```

caused tab completion to function properly.


---

Comment by bhutz created at 2021-08-23 12:41:21

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2021-08-31 22:00:57

Resolution: fixed
