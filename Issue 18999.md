# Issue 18999: Lock mirror_list file in MirrorList.__init__

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2015-09-18 07:42:14

CC:  vbraun

When building in parallel and the local `mirror_list` file is not up-to-date, running `make` will start updating the `mirror_list` many times in parallel. Solve this by locking the `mirror_list` file. This will also fix potential race conditions in reading/writing the `mirror_list` file.


---

Comment by vbraun created at 2015-09-18 10:05:23

Not all network file systems support locking, in which case this will fail with ENOLCK. E.g. nfs, depending on version & configuration. 

The most portable solution would be https://github.com/openstack/pylockfile/blob/master/lockfile/mkdirlockfile.py

Just ignoring ENOLCK is probably good enough.
----
New commits:


---

Comment by jdemeyer created at 2015-09-18 10:26:59

Replying to [comment:2 vbraun]:
> Not all network file systems support locking, in which case this will fail with ENOLCK. E.g. nfs, depending on version & configuration.

On museum kernels maybe :-)


---

Comment by git created at 2015-09-18 10:28:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-18 10:41:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2015-09-18 11:20:40

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-09-18 12:13:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-09-18 19:10:37

Resolution: fixed
