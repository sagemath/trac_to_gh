# Issue 26174: Use temporary files to evaluate long commands in libgap

Issue created by migration from https://trac.sagemath.org/ticket/26411

Original creator: SimonKing

Original creation time: 2018-10-05 11:20:32

There is a limit for the length of a string to be evaluated in libgap. Hence, similar to what is done in the pexpect interfaces, `libgap.eval(cmd)` should evaluate `cmd` with a temporary file (using `libgap.ReadAsFunction(...)()`), if `cmd` is too long.


---

Comment by SimonKing created at 2018-10-05 11:20:54

Changing keywords from "" to "libgap eval temporary file".


---

Comment by dimpase created at 2018-10-05 11:58:59

Could you supply an example code showing the issue?


---

Comment by jdemeyer created at 2018-10-05 12:15:13

Can't we fix this in libgap? That would be a much better solution rather than hacking with temporary files.


---

Comment by SimonKing created at 2018-10-05 12:36:49

Replying to [comment:2 dimpase]:
> Could you supply an example code showing the issue?

The problem arose when I tried to pickle (via string representation) the regular permutation action of `SuzukiGroup(8)`. It could be created as follows:

```
sage: G = libgap.SuzukiGroup(8)
sage: S = G.Elements()
sage: G2 = libgap.Group([libgap.PermList([S.Position(p*g) for p in S]) for g in G.GeneratorsOfGroup()])
sage: G2
<permutation group with 2 generators>
sage: s = G2.String().sage()
sage: len(s)
349083
sage: libgap.eval(s)
python2: libgap.c:184: libgap_get_input: Assertion `strlen(libGAP_stdin_buffer) < length' failed.
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-29-c712c743f5ed> in <module>()
----> 1 libgap.eval(s)

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/libs/gap/libgap.pyx in sage.libs.gap.libgap.Gap.eval (build/cythonized/sage/libs/gap/libgap.c:4269)()
    436         if not isinstance(gap_command, basestring):
    437             gap_command = str(gap_command._gap_init_())
--> 438         return make_any_gap_element(self, gap_eval(gap_command))
    439 
    440     @cached_method

/home/king/Sage/git/sage/local/lib/python2.7/site-packages/sage/libs/gap/util.pyx in sage.libs.gap.util.gap_eval (build/cythonized/sage/libs/gap/util.c:5637)()
    322             sig_off()
    323         except RuntimeError as msg:
--> 324             raise ValueError('libGAP: '+str(msg).strip())
    325 
    326         if libGAP_Symbol != libGAP_S_SEMICOLON:

ValueError: libGAP: Aborted
sage: f = tmp_filename()
sage: F = file(f,'w')
sage: F.write("return "+ s + ';\n')
sage: F.flush()
sage: %time X = libgap.ReadAsFunction(f)()
CPU times: user 106 ms, sys: 194 Âµs, total: 106 ms
Wall time: 106 ms
```


It could of course be that in my applications I could use a much more efficient work-around (after all, I just need a string from which I can reconstruct the regular permutation action of `SuzukiGroup(8)`). But at least that example shows the problem.


---

Comment by dimpase created at 2018-10-06 22:09:04

By the way, instead of

```
sage: S = G.Elements()
sage: G2 = libgap.Group([libgap.PermList([S.Position(p*g) for p in S]) for g in G.GeneratorsOfGroup()])
```

you could just do

```
sage: G2 = G.Action(G,libgap.OnRight)
```



---

Comment by jdemeyer created at 2019-01-21 10:02:19

Is this ticket still relevant after the GAP-4.10 upgrade (#22626).

As I noted above, I really don't like the proposed solution here, but if there remains a problem, we should try to fix it (either in Sage or upstream).


---

Comment by dimpase created at 2019-01-21 11:07:52

It would be much better to spend time improving the libgap interface --- e.g. in this particular case, it seems that if Sage had direct in-memory access to GAP permutation data - it's possible to call the corresponding GAP kernel functions within libgap after all - the problem would not have arisen.


---

Comment by jdemeyer created at 2019-01-22 09:00:26

Resolution: worksforme


---

Comment by jdemeyer created at 2019-01-22 09:00:26

The example from [comment:4] now seems to work.
