# Issue 12995: Clarify some comments concerning the matplotlib Delaunay code in list_plot3d.py

archive/issues_012995.json:
```json
{
    "body": "Assignee: mvngu\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/13167\n\n",
    "created_at": "2012-06-26T13:34:41Z",
    "labels": [
        "documentation",
        "minor",
        "enhancement"
    ],
    "title": "Clarify some comments concerning the matplotlib Delaunay code in list_plot3d.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/12995",
    "user": "jdemeyer"
}
```
Assignee: mvngu



Issue created by migration from https://trac.sagemath.org/ticket/13167





---

archive/issue_comments_157169.json:
```json
{
    "body": "Attachment",
    "created_at": "2012-06-26T13:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157169",
    "user": "jdemeyer"
}
```

Attachment



---

archive/issue_comments_157170.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-06-26T13:41:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157170",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_157171.json:
```json
{
    "body": "Looks fine on the face of it.    Applies fine, tests fine, code is the same after all.\n\nIs it really the mpl code, then, not scipy?  Hang on, I just haven't looked at the whole file yet...",
    "created_at": "2012-06-26T13:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157171",
    "user": "kcrisman"
}
```

Looks fine on the face of it.    Applies fine, tests fine, code is the same after all.

Is it really the mpl code, then, not scipy?  Hang on, I just haven't looked at the whole file yet...



---

archive/issue_comments_157172.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-06-26T13:47:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157172",
    "user": "kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_157173.json:
```json
{
    "body": "Ok, that's right.  Good catch.",
    "created_at": "2012-06-26T13:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157173",
    "user": "kcrisman"
}
```

Ok, that's right.  Good catch.



---

archive/issue_comments_157174.json:
```json
{
    "body": "Replying to [comment:2 kcrisman]:\n> Looks fine on the face of it.    Applies fine, tests fine, code is the same after all.\n> \n> Is it really the mpl code, then, not scipy?  Hang on, I just haven't looked at the whole file yet...\nYes. It is mpl code that is the problem here. Quoting from [mpl docs](http://matplotlib.sourceforge.net/api/mlab_api.html#matplotlib.mlab.griddata),\n\n''\nIf interp keyword is set to \u2018nn\u2018 (default), uses natural neighbor interpolation based on Delaunay triangulation. By default, this algorithm is provided by the matplotlib.delaunay package, written by Robert Kern. The triangulation algorithm in this package is known to fail on some nearly pathological cases. For this reason, a separate toolkit (mpl_tookits.natgrid) has been created that provides a more robust algorithm fof triangulation and interpolation. This toolkit is based on the NCAR natgrid library, which contains code that is not redistributable under a BSD-compatible license. When installed, this function will use the mpl_toolkits.natgrid algorithm, otherwise it will use the built-in matplotlib.delaunay package.\n''\n\nSo, essentially the delaunay code is not considered very robust.\n\nNow, I had a look at the `natgrid` code and there is one file's license which is the main problem I think, and due to which I believe it won't be possible to distribute/include it in Sage.",
    "created_at": "2012-06-26T14:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157174",
    "user": "ppurka"
}
```

Replying to [comment:2 kcrisman]:
> Looks fine on the face of it.    Applies fine, tests fine, code is the same after all.
> 
> Is it really the mpl code, then, not scipy?  Hang on, I just haven't looked at the whole file yet...
Yes. It is mpl code that is the problem here. Quoting from [mpl docs](http://matplotlib.sourceforge.net/api/mlab_api.html#matplotlib.mlab.griddata),

''
If interp keyword is set to ‘nn‘ (default), uses natural neighbor interpolation based on Delaunay triangulation. By default, this algorithm is provided by the matplotlib.delaunay package, written by Robert Kern. The triangulation algorithm in this package is known to fail on some nearly pathological cases. For this reason, a separate toolkit (mpl_tookits.natgrid) has been created that provides a more robust algorithm fof triangulation and interpolation. This toolkit is based on the NCAR natgrid library, which contains code that is not redistributable under a BSD-compatible license. When installed, this function will use the mpl_toolkits.natgrid algorithm, otherwise it will use the built-in matplotlib.delaunay package.
''

So, essentially the delaunay code is not considered very robust.

Now, I had a look at the `natgrid` code and there is one file's license which is the main problem I think, and due to which I believe it won't be possible to distribute/include it in Sage.



---

archive/issue_comments_157175.json:
```json
{
    "body": "That would be a different ticket anyway.",
    "created_at": "2012-06-26T14:35:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157175",
    "user": "kcrisman"
}
```

That would be a different ticket anyway.



---

archive/issue_comments_157176.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-07-02T15:25:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157176",
    "user": "jdemeyer"
}
```

Resolution: fixed



---

archive/issue_comments_157177.json:
```json
{
    "body": "Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?",
    "created_at": "2013-01-05T01:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157177",
    "user": "kcrisman"
}
```

Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?



---

archive/issue_comments_157178.json:
```json
{
    "body": "Replying to [comment:7 kcrisman]:\n> Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?\n\nI can't remember the context for this trac ticket. Are you suggesting that we remove the code in Sage which checks for duplicate points?",
    "created_at": "2013-01-05T03:26:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157178",
    "user": "ppurka"
}
```

Replying to [comment:7 kcrisman]:
> Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?

I can't remember the context for this trac ticket. Are you suggesting that we remove the code in Sage which checks for duplicate points?



---

archive/issue_comments_157179.json:
```json
{
    "body": "> > Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?\n> \n> I can't remember the context for this trac ticket. Are you suggesting that we remove the code in Sage which checks for duplicate points?\nI was saying that maybe we don't need to add noise any more.  But upon further review, the commit in question was about duplicate points, not points in the same subspace, so we probably still need the randomization for now.  I don't know if we have code checking for duplicates.",
    "created_at": "2013-01-05T03:41:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157179",
    "user": "kcrisman"
}
```

> > Apparently [this has been fixed upstream](https://github.com/matplotlib/matplotlib/pull/936).  ppurka, what do you think - would that take care of it, or are there other potential issues?
> 
> I can't remember the context for this trac ticket. Are you suggesting that we remove the code in Sage which checks for duplicate points?
I was saying that maybe we don't need to add noise any more.  But upon further review, the commit in question was about duplicate points, not points in the same subspace, so we probably still need the randomization for now.  I don't know if we have code checking for duplicates.



---

archive/issue_comments_157180.json:
```json
{
    "body": "Right. I think adding random noise is still needed. As I see it now, there are no changes necessary to the existing code.",
    "created_at": "2013-01-05T04:07:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/12995",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/12995#issuecomment-157180",
    "user": "ppurka"
}
```

Right. I think adding random noise is still needed. As I see it now, there are no changes necessary to the existing code.
