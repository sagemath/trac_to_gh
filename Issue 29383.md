# Issue 29383: ./configure --without-system-gmp --without-system-mpir installs both GMP and MPIR spkg

Issue created by migration from https://trac.sagemath.org/ticket/29620

Original creator: mkoeppe

Original creation time: 2020-04-29 19:11:30

CC:  mjo dimpase jhpalmieri slelievre




---

Comment by dimpase created at 2020-04-30 05:53:09

perhaps fixing this in ./configure is the most natural thing to do.


---

Comment by mkoeppe created at 2020-05-01 05:53:25

I agree


---

Comment by mjo created at 2020-05-01 14:21:08

This is ugly because `sage_spkg_install_mpir=no` can mean multiple things when you take `--with-mp` into consideration. There's a simpler statement of the problem: passing `--without-system-gmp` causes the gmp SPKG to be installed when mpir will be used anyway. I haven't been able to wrap my head around  a solution that works in all cases. We may need to introduce another variable that indicates what's actually going on, rather than trying to reverse engineer what happened from the `sage_spkg_install` variables at the end of gmp's post-check phase.


---

Comment by mkoeppe created at 2020-05-01 15:33:44

Yes, we should first define the meaning of these options.


---

Comment by mkoeppe created at 2021-03-24 19:09:52

Just got bitten by this again.


---

Comment by mkoeppe created at 2021-03-24 19:09:52

Changing priority from major to critical.


---

Comment by mjo created at 2021-03-25 00:35:07

We recently switched the default back to GMP because MPIR is bit-rotting. Being able to choose GMP instead of MPIR had obvious benefits when MPIR was the default. But is there any benefit to being able to use MPIR as an alternative when GMP is the default?


---

Comment by mkoeppe created at 2021-03-25 00:39:30

The only reason that comes to mind is that at least one package uses an mpir-specific interface: #30325.

For Sage 9.3, I would be reluctant to remove MPIR completely. But it would be good to remove this trap in our configure script.


---

Comment by mkoeppe created at 2021-03-28 01:16:10

For boost, of course, we could just remove the full `boost` package and only offer our cropped version of `boost`. It could be argued again that it's not Sage's job to provide a full `boost` installation. (Our version is ancient in any case)


---

Comment by dimpase created at 2021-03-28 15:11:50

removing full boost is certainly a good idea.


---

Comment by mkoeppe created at 2021-03-29 04:59:04

Replying to [comment:14 dimpase]:
> removing full boost is certainly a good idea.
That's now #31575.


---

Comment by mkoeppe created at 2021-05-10 17:42:09

Moving to 9.4, as 9.3 has been released.


---

Comment by mkoeppe created at 2021-09-22 03:01:07

I have opened #32549 to remove package `mpir`


---

Comment by mkoeppe created at 2021-09-25 17:33:17

Changing priority from critical to major.


---

Comment by slelievre created at 2022-01-01 22:32:01

Changing keywords from "" to "spkg-pairs".


---

Comment by slelievre created at 2022-01-01 22:32:01

Reworded ticket description (removing some bits
reproduced below) after

- ATLAS removed in #30350.
- MPIR removed in #32549 and #32727.
- work on boost and boost-cropped:
  - #31871: replace boost by boost_cropped in m4 files
  - #31575: Remove full boost package
  - #31250: Upgrade: boost_cropped 1.78.0

-----

For gmp/mpir, we have:

```
  --with-system-gmp={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system gmp
  --with-system-mpir={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system mpir
  --with-mp=system        use the system GMP as multiprecision library, if
                          possible (default)
  --with-mp=mpir          use the Sage SPKG for MPIR as multiprecision library
  --with-mp=gmp           use the Sage SPKG for GMP as multiprecision library
```

The first two are automatically generated and do not work properly. The `--with-mp` option is legacy and works properly but does not fit well with the systematic naming scheme. Removing `mpir` in #32549 removes this case.

Same for BLAS (as reported most recently in https://groups.google.com/g/sage-support/c/pqnhfUJYS-Q/m/lOQJ3EtYBwAJ):

```
  --with-system-atlas={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system atlas
  --with-system-openblas={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system openblas
  --with-blas=openblas    use OpenBLAS as BLAS library (default)
    --with-blas=atlas       use ATLAS as BLAS library
}}} 
Removing `atlas` in #30350 removes this case.

And to a lesser degree for these ones:
{{{
  --with-system-boost={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system boost
  --with-system-boost_cropped={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system boost_cropped
}}}
