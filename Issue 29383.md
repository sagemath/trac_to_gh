# Issue 29383: ./configure --without-system-gmp --without-system-mpir installs both GMP and MPIR spkg

archive/issues_029383.json:
```json
{
    "body": "CC:  mjo dimpase jhpalmieri slelievre\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29620\n\n",
    "created_at": "2020-04-29T19:11:30Z",
    "labels": [
        "build: configure",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "./configure --without-system-gmp --without-system-mpir installs both GMP and MPIR spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29383",
    "user": "mkoeppe"
}
```
CC:  mjo dimpase jhpalmieri slelievre



Issue created by migration from https://trac.sagemath.org/ticket/29620





---

archive/issue_comments_416751.json:
```json
{
    "body": "perhaps fixing this in ./configure is the most natural thing to do.",
    "created_at": "2020-04-30T05:53:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416751",
    "user": "dimpase"
}
```

perhaps fixing this in ./configure is the most natural thing to do.



---

archive/issue_comments_416752.json:
```json
{
    "body": "I agree",
    "created_at": "2020-05-01T05:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416752",
    "user": "mkoeppe"
}
```

I agree



---

archive/issue_comments_416753.json:
```json
{
    "body": "This is ugly because `sage_spkg_install_mpir=no` can mean multiple things when you take `--with-mp` into consideration. There's a simpler statement of the problem: passing `--without-system-gmp` causes the gmp SPKG to be installed when mpir will be used anyway. I haven't been able to wrap my head around  a solution that works in all cases. We may need to introduce another variable that indicates what's actually going on, rather than trying to reverse engineer what happened from the `sage_spkg_install` variables at the end of gmp's post-check phase.",
    "created_at": "2020-05-01T14:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416753",
    "user": "mjo"
}
```

This is ugly because `sage_spkg_install_mpir=no` can mean multiple things when you take `--with-mp` into consideration. There's a simpler statement of the problem: passing `--without-system-gmp` causes the gmp SPKG to be installed when mpir will be used anyway. I haven't been able to wrap my head around  a solution that works in all cases. We may need to introduce another variable that indicates what's actually going on, rather than trying to reverse engineer what happened from the `sage_spkg_install` variables at the end of gmp's post-check phase.



---

archive/issue_comments_416754.json:
```json
{
    "body": "Yes, we should first define the meaning of these options.",
    "created_at": "2020-05-01T15:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416754",
    "user": "mkoeppe"
}
```

Yes, we should first define the meaning of these options.



---

archive/issue_comments_416755.json:
```json
{
    "body": "Just got bitten by this again.",
    "created_at": "2021-03-24T19:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416755",
    "user": "mkoeppe"
}
```

Just got bitten by this again.



---

archive/issue_comments_416756.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-03-24T19:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416756",
    "user": "mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_416757.json:
```json
{
    "body": "We recently switched the default back to GMP because MPIR is bit-rotting. Being able to choose GMP instead of MPIR had obvious benefits when MPIR was the default. But is there any benefit to being able to use MPIR as an alternative when GMP is the default?",
    "created_at": "2021-03-25T00:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416757",
    "user": "mjo"
}
```

We recently switched the default back to GMP because MPIR is bit-rotting. Being able to choose GMP instead of MPIR had obvious benefits when MPIR was the default. But is there any benefit to being able to use MPIR as an alternative when GMP is the default?



---

archive/issue_comments_416758.json:
```json
{
    "body": "The only reason that comes to mind is that at least one package uses an mpir-specific interface: #30325.\n\nFor Sage 9.3, I would be reluctant to remove MPIR completely. But it would be good to remove this trap in our configure script.",
    "created_at": "2021-03-25T00:39:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416758",
    "user": "mkoeppe"
}
```

The only reason that comes to mind is that at least one package uses an mpir-specific interface: #30325.

For Sage 9.3, I would be reluctant to remove MPIR completely. But it would be good to remove this trap in our configure script.



---

archive/issue_comments_416759.json:
```json
{
    "body": "For boost, of course, we could just remove the full `boost` package and only offer our cropped version of `boost`. It could be argued again that it's not Sage's job to provide a full `boost` installation. (Our version is ancient in any case)",
    "created_at": "2021-03-28T01:16:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416759",
    "user": "mkoeppe"
}
```

For boost, of course, we could just remove the full `boost` package and only offer our cropped version of `boost`. It could be argued again that it's not Sage's job to provide a full `boost` installation. (Our version is ancient in any case)



---

archive/issue_comments_416760.json:
```json
{
    "body": "removing full boost is certainly a good idea.",
    "created_at": "2021-03-28T15:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416760",
    "user": "dimpase"
}
```

removing full boost is certainly a good idea.



---

archive/issue_comments_416761.json:
```json
{
    "body": "Replying to [comment:14 dimpase]:\n> removing full boost is certainly a good idea.\nThat's now #31575.",
    "created_at": "2021-03-29T04:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416761",
    "user": "mkoeppe"
}
```

Replying to [comment:14 dimpase]:
> removing full boost is certainly a good idea.
That's now #31575.



---

archive/issue_comments_416762.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416762",
    "user": "mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_comments_416763.json:
```json
{
    "body": "I have opened #32549 to remove package `mpir`",
    "created_at": "2021-09-22T03:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416763",
    "user": "mkoeppe"
}
```

I have opened #32549 to remove package `mpir`



---

archive/issue_comments_416764.json:
```json
{
    "body": "Changing priority from critical to major.",
    "created_at": "2021-09-25T17:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416764",
    "user": "mkoeppe"
}
```

Changing priority from critical to major.



---

archive/issue_comments_416765.json:
```json
{
    "body": "Changing keywords from \"\" to \"spkg-pairs\".",
    "created_at": "2022-01-01T22:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416765",
    "user": "slelievre"
}
```

Changing keywords from "" to "spkg-pairs".



---

archive/issue_comments_416766.json:
```json
{
    "body": "Reworded ticket description (removing some bits\nreproduced below) after\n\n- ATLAS removed in #30350.\n- MPIR removed in #32549 and #32727.\n- work on boost and boost-cropped:\n  - #31871: replace boost by boost_cropped in m4 files\n  - #31575: Remove full boost package\n  - #31250: Upgrade: boost_cropped 1.78.0\n\n-----\n\nFor gmp/mpir, we have:\n\n```\n  --with-system-gmp={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system gmp\n  --with-system-mpir={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system mpir\n  --with-mp=system        use the system GMP as multiprecision library, if\n                          possible (default)\n  --with-mp=mpir          use the Sage SPKG for MPIR as multiprecision library\n  --with-mp=gmp           use the Sage SPKG for GMP as multiprecision library\n```\n\nThe first two are automatically generated and do not work properly. The `--with-mp` option is legacy and works properly but does not fit well with the systematic naming scheme. Removing `mpir` in #32549 removes this case.\n\nSame for BLAS (as reported most recently in https://groups.google.com/g/sage-support/c/pqnhfUJYS-Q/m/lOQJ3EtYBwAJ):\n\n```\n  --with-system-atlas={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system atlas\n  --with-system-openblas={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system openblas\n  --with-blas=openblas    use OpenBLAS as BLAS library (default)\n    --with-blas=atlas       use ATLAS as BLAS library\n```\n \nRemoving `atlas` in #30350 removes this case.\n\nAnd to a lesser degree for these ones:\n\n```\n  --with-system-boost={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system boost\n  --with-system-boost_cropped={no|yes (default)|force (exit with an error if no usable version is found)}\n                          detect and use an existing system boost_cropped\n```\n",
    "created_at": "2022-01-01T22:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29383",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29383#issuecomment-416766",
    "user": "slelievre"
}
```

Reworded ticket description (removing some bits
reproduced below) after

- ATLAS removed in #30350.
- MPIR removed in #32549 and #32727.
- work on boost and boost-cropped:
  - #31871: replace boost by boost_cropped in m4 files
  - #31575: Remove full boost package
  - #31250: Upgrade: boost_cropped 1.78.0

-----

For gmp/mpir, we have:

```
  --with-system-gmp={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system gmp
  --with-system-mpir={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system mpir
  --with-mp=system        use the system GMP as multiprecision library, if
                          possible (default)
  --with-mp=mpir          use the Sage SPKG for MPIR as multiprecision library
  --with-mp=gmp           use the Sage SPKG for GMP as multiprecision library
```

The first two are automatically generated and do not work properly. The `--with-mp` option is legacy and works properly but does not fit well with the systematic naming scheme. Removing `mpir` in #32549 removes this case.

Same for BLAS (as reported most recently in https://groups.google.com/g/sage-support/c/pqnhfUJYS-Q/m/lOQJ3EtYBwAJ):

```
  --with-system-atlas={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system atlas
  --with-system-openblas={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system openblas
  --with-blas=openblas    use OpenBLAS as BLAS library (default)
    --with-blas=atlas       use ATLAS as BLAS library
```
 
Removing `atlas` in #30350 removes this case.

And to a lesser degree for these ones:

```
  --with-system-boost={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system boost
  --with-system-boost_cropped={no|yes (default)|force (exit with an error if no usable version is found)}
                          detect and use an existing system boost_cropped
```

