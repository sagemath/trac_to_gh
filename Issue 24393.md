# Issue 24393: Inconsistency in conversion from CIF

archive/issues_024393.json:
```json
{
    "body": "\n```\nsage: RR(CBF(1.7))\n1.70000000000000\n\nsage: CIF(1.7).is_exact()\nTrue\nsage: RR(RIF(1.7))\n1.70000000000000\nsage: RR(CIF(1.7))\n\n/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9530)()\n    916         if mor is not None:\n    917             if no_extra_args:\n--> 918                 return mor._call_(x)\n    919             else:\n    920                 return mor._call_with_args(x, args, kwds)\n\n/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4979)()\n    153                 print(type(C), C)\n    154                 print(type(C._element_constructor), C._element_constructor)\n--> 155             raise\n    156 \n    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):\n\n/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4841)()\n    148         cdef Parent C = self._codomain\n    149         try:\n--> 150             return C._element_constructor(x)\n    151         except Exception:\n    152             if print_warnings:\n\n/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealField_class._element_constructor_ (build/cythonized/sage/rings/real_mpfr.c:7305)()\n    643         cdef RealNumber z\n    644         z = self._new()\n--> 645         z._set(x, base)\n    646         return z\n    647 \n\n/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (build/cythonized/sage/rings/real_mpfr.c:12976)()\n   1466                 mpfr_set_inf(self.value, -1)\n   1467             else:\n-> 1468                 raise TypeError(\"unable to convert {!r} to a real number\".format(s))\n   1469 \n   1470     cdef _set_from_GEN_REAL(self, GEN g):\n\nTypeError: unable to convert '1.7000000000000000?' to a real number\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/24630\n\n",
    "created_at": "2018-02-01T07:04:28Z",
    "labels": [
        "numerical",
        "major",
        "bug"
    ],
    "title": "Inconsistency in conversion from CIF",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24393",
    "user": "rws"
}
```

```
sage: RR(CBF(1.7))
1.70000000000000

sage: CIF(1.7).is_exact()
True
sage: RR(RIF(1.7))
1.70000000000000
sage: RR(CIF(1.7))

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9530)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4979)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4841)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealField_class._element_constructor_ (build/cythonized/sage/rings/real_mpfr.c:7305)()
    643         cdef RealNumber z
    644         z = self._new()
--> 645         z._set(x, base)
    646         return z
    647 

/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (build/cythonized/sage/rings/real_mpfr.c:12976)()
   1466                 mpfr_set_inf(self.value, -1)
   1467             else:
-> 1468                 raise TypeError("unable to convert {!r} to a real number".format(s))
   1469 
   1470     cdef _set_from_GEN_REAL(self, GEN g):

TypeError: unable to convert '1.7000000000000000?' to a real number
```


Issue created by migration from https://trac.sagemath.org/ticket/24630





---

archive/issue_comments_341720.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-02-01T08:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341720",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_341721.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-02-01T08:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341721",
    "user": "rws"
}
```

New commits:



---

archive/issue_comments_341722.json:
```json
{
    "body": "Mostly looks good to me, but I don't understand why you are using `parent(x) is complex` instead of `type(x) is complex` or `isinstance(x, complex)`.",
    "created_at": "2018-02-13T16:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341722",
    "user": "mmezzarobba"
}
```

Mostly looks good to me, but I don't understand why you are using `parent(x) is complex` instead of `type(x) is complex` or `isinstance(x, complex)`.



---

archive/issue_comments_341723.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-02-14T14:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341723",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341724.json:
```json
{
    "body": "You no longer need to import `parent` (this should probably have been a `cimport` anyhow). Oh, and I missed that last time (sorry), but why are you changing `RealField_class._element_constructor_()` instead of `RealNumber._new()` \u2014 which apparently contains the logic for most other cases?",
    "created_at": "2018-02-15T16:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341724",
    "user": "mmezzarobba"
}
```

You no longer need to import `parent` (this should probably have been a `cimport` anyhow). Oh, and I missed that last time (sorry), but why are you changing `RealField_class._element_constructor_()` instead of `RealNumber._new()` â€” which apparently contains the logic for most other cases?



---

archive/issue_comments_341725.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-02-15T16:37:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341725",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341726.json:
```json
{
    "body": "Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)",
    "created_at": "2018-02-15T22:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341726",
    "user": "tscrim"
}
```

Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)



---

archive/issue_comments_341727.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)\n\nNo, the same errors are raised.",
    "created_at": "2018-02-19T07:25:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341727",
    "user": "rws"
}
```

Replying to [comment:7 tscrim]:
> Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)

No, the same errors are raised.



---

archive/issue_comments_341728.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-02-28T07:15:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341728",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341729.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-19T15:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341729",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341730.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-19T15:37:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341730",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341731.json:
```json
{
    "body": "I just saw I didn't address your last comment, sorry.",
    "created_at": "2018-03-19T15:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341731",
    "user": "rws"
}
```

I just saw I didn't address your last comment, sorry.



---

archive/issue_comments_341732.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2018-03-19T15:37:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341732",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_341733.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-03-19T20:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341733",
    "user": "jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_341734.json:
```json
{
    "body": "Can you change the exception to\n\n```\nraise TypeError(\"f\"unable to convert complex interval {self} to real number\")\n```\n\n(just trying to be consistent and using the same wording as similar exception messages)\n\nAlso, I don't like the `\"Try to\"` in the docs. Maybe write `If the imaginary part is zero, ...`\n\nApart from that, this looks good to me.",
    "created_at": "2018-03-19T20:27:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341734",
    "user": "jdemeyer"
}
```

Can you change the exception to

```
raise TypeError("f"unable to convert complex interval {self} to real number")
```

(just trying to be consistent and using the same wording as similar exception messages)

Also, I don't like the `"Try to"` in the docs. Maybe write `If the imaginary part is zero, ...`

Apart from that, this looks good to me.



---

archive/issue_comments_341735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-20T06:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341735",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_341736.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2018-03-20T06:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341736",
    "user": "rws"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_341737.json:
```json
{
    "body": "Since patchbot is okay, I'll take this as positive?",
    "created_at": "2018-03-20T06:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341737",
    "user": "rws"
}
```

Since patchbot is okay, I'll take this as positive?



---

archive/issue_comments_341738.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2018-03-21T06:18:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24393",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24393#issuecomment-341738",
    "user": "vbraun"
}
```

Resolution: fixed
