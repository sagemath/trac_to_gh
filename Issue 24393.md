# Issue 24393: Inconsistency in conversion from CIF

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2018-02-01 07:04:28


```
sage: RR(CBF(1.7))
1.70000000000000

sage: CIF(1.7).is_exact()
True
sage: RR(RIF(1.7))
1.70000000000000
sage: RR(CIF(1.7))

/home/ralf/sage/src/sage/structure/parent.pyx in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9530)()
    916         if mor is not None:
    917             if no_extra_args:
--> 918                 return mor._call_(x)
    919             else:
    920                 return mor._call_with_args(x, args, kwds)

/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4979)()
    153                 print(type(C), C)
    154                 print(type(C._element_constructor), C._element_constructor)
--> 155             raise
    156 
    157     cpdef Element _call_with_args(self, x, args=(), kwds={}):

/home/ralf/sage/src/sage/structure/coerce_maps.pyx in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4841)()
    148         cdef Parent C = self._codomain
    149         try:
--> 150             return C._element_constructor(x)
    151         except Exception:
    152             if print_warnings:

/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealField_class._element_constructor_ (build/cythonized/sage/rings/real_mpfr.c:7305)()
    643         cdef RealNumber z
    644         z = self._new()
--> 645         z._set(x, base)
    646         return z
    647 

/home/ralf/sage/src/sage/rings/real_mpfr.pyx in sage.rings.real_mpfr.RealNumber._set (build/cythonized/sage/rings/real_mpfr.c:12976)()
   1466                 mpfr_set_inf(self.value, -1)
   1467             else:
-> 1468                 raise TypeError("unable to convert {!r} to a real number".format(s))
   1469 
   1470     cdef _set_from_GEN_REAL(self, GEN g):

TypeError: unable to convert '1.7000000000000000?' to a real number
```



---

Comment by rws created at 2018-02-01 08:20:36

Changing status from new to needs_review.


---

Comment by rws created at 2018-02-01 08:20:36

New commits:


---

Comment by mmezzarobba created at 2018-02-13 16:05:30

Mostly looks good to me, but I don't understand why you are using `parent(x) is complex` instead of `type(x) is complex` or `isinstance(x, complex)`.


---

Comment by git created at 2018-02-14 14:10:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmezzarobba created at 2018-02-15 16:37:47

You no longer need to import `parent` (this should probably have been a `cimport` anyhow). Oh, and I missed that last time (sorry), but why are you changing `RealField_class._element_constructor_()` instead of `RealNumber._new()` â€” which apparently contains the logic for most other cases?


---

Comment by mmezzarobba created at 2018-02-15 16:37:47

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-02-15 22:44:41

Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)


---

Comment by rws created at 2018-02-19 07:25:47

Replying to [comment:7 tscrim]:
> Is this issue fixed by #24371? (Also, this is to warn about a possible merge conflict.)

No, the same errors are raised.


---

Comment by rws created at 2018-02-28 07:15:28

Changing status from needs_work to needs_review.


---

Comment by rws created at 2018-03-19 15:17:27

Changing status from needs_review to needs_work.


---

Comment by git created at 2018-03-19 15:37:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-03-19 15:37:57

I just saw I didn't address your last comment, sorry.


---

Comment by rws created at 2018-03-19 15:37:57

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2018-03-19 20:27:28

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2018-03-19 20:27:28

Can you change the exception to

```
raise TypeError("f"unable to convert complex interval {self} to real number")
```

(just trying to be consistent and using the same wording as similar exception messages)

Also, I don't like the `"Try to"` in the docs. Maybe write `If the imaginary part is zero, ...`

Apart from that, this looks good to me.


---

Comment by git created at 2018-03-20 06:55:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-03-20 06:57:55

Changing status from needs_work to positive_review.


---

Comment by rws created at 2018-03-20 06:57:55

Since patchbot is okay, I'll take this as positive?


---

Comment by vbraun created at 2018-03-21 06:18:54

Resolution: fixed
