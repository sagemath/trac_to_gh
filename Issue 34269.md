# Issue 34269: Document or override the arbitrary limit on number of digits printed (Python 3.10.7)

Issue created by migration from https://trac.sagemath.org/ticket/34506

Original creator: mkoeppe

Original creation time: 2022-09-08 16:06:01

CC:  arojas was lorenz

Python 3.10.7 brings a breaking change that retroactively affects all Sage versions that accept system Python 3.10.x: 

https://docs.python.org/3.10/whatsnew/changelog.html#security

See also #34271



---

Comment by mantepse created at 2022-09-08 16:34:16

I am guessing that this could be a problem for pexpect interfaces, like the one for fricas.  We are going to hit the limit with `factorial(1558)`.


---

Comment by roed created at 2022-09-08 16:36:49

Well, Python is clearly using a quadratic time algorithm for this while GMP is using a subquadratic algorithm.  I wish that Python had at least improved their algorithm when they hit this bug, rather than just setting a limit like this.


```
sage: s = '1'*1000000
sage: %time x = int(s)
CPU times: user 4.65 s, sys: 0 ns, total: 4.65 s
Wall time: 4.64 s
sage: %time x = Integer(s)
CPU times: user 32.1 ms, sys: 8.25 ms, total: 40.3 ms
Wall time: 40.3 ms
```


My vote would be to [set](https://docs.python.org/3.10/library/stdtypes.html#int-max-str-digits) the limit to either 0 (unlimited) or 1000000 at Sage startup.  Of course, Sage Integers will be unaffected.


---

Comment by was created at 2022-09-08 17:03:37

Similar pet peeve -- Python's arbitrary precision integer arithmetic is overall still asymptotically slow, whereas Chrome's V8 has huge integer arithmetic that is asymptotically "competitive" with GMP (using BigInt).  Python should too.

This is in my dev console in Chrome:

```
> n = BigInt('1'.repeat(1000000))
11111111111111111111111111111111111111111111111111â€¦111111111111111111111111111111111111111111111111n
> t=new Date(); s=n.toString(); new Date() - t
207
```


Both Safari and Firefox refuse to make large integers and complain "Out of memory".  So +1 to V8 here.  The code isn't too complicated either.  

https://twitter.com/wstein389/status/1453624662819180547


---

Comment by mantepse created at 2022-09-08 18:45:07

What a pyti: I thought, if python is so slow for this, then it might even make sense to set the limit to 1 (i.e., only allow single digit strings), in order to catch all occurrences of such conversions, and then use sage integers throughout.  Unfortunately, this is not possible.  640 is the lower limit.  I wonder whether this is a Bill Gates reference.


---

Comment by @oscarbenjamin created at 2022-09-08 22:43:57

I want to try and push back on this so I opened a discussion in core Python:
https://discuss.python.org/t/int-str-conversions-broken-in-latest-python-bugfix-releases/18889


---

Comment by was created at 2022-09-08 23:04:37

**Thanks Oscar!!**  That ticket https://github.com/python/cpython/issues/95778 is really disturbing.


---

Comment by was created at 2022-09-09 00:38:30

https://news.ycombinator.com/item?id=32753235#32768343


---

Comment by @sheerluck created at 2022-09-09 10:51:52

Sage lets me have `fibonacci(20578)` but pure python stops on `fibonacci(20577)`


---

Comment by roed created at 2022-09-09 16:09:53

Well, here's a proposal for a "fix."  This doesn't solve all the problems, but I think it's an improvement from Sage's perspective.
----
New commits:


---

Comment by roed created at 2022-09-09 16:10:04

Changing status from new to needs_review.


---

Comment by git created at 2022-09-09 16:37:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-09-09 17:43:07

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-09-09 17:43:07

Changing priority from critical to blocker.


---

Comment by mkoeppe created at 2022-09-09 17:43:07

LGTM. We should probably get this into 9.7, so I'm setting it to "blocker".


---

Comment by vbraun created at 2022-09-14 22:35:57

Resolution: fixed
