# Issue 19548: Libfplll testsuite randomly fails

archive/issues_019548.json:
```json
{
    "body": "CC:  malb jdemeyer\n\nKeywords: random_fail\n\nRegression of #19720\n\n```\nFAIL: test_lll\nFAIL: test_svp\n============================================================================\nTestsuite summary for libfplll 4.0.5\n============================================================================\n# TOTAL: 2\n# PASS:  0\n# SKIP:  0\n# XFAIL: 0\n# FAIL:  2\n# XPASS: 0\n# ERROR: 0\n============================================================================\nSee tests/test-suite.log\n============================================================================\n```\n\nLog at http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/49/steps/compile_1/logs/libfplll\n\nIssue created by migration from https://trac.sagemath.org/ticket/19785\n\n",
    "created_at": "2015-12-26T20:16:46Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "Libfplll testsuite randomly fails",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19548",
    "user": "vbraun"
}
```
CC:  malb jdemeyer

Keywords: random_fail

Regression of #19720

```
FAIL: test_lll
FAIL: test_svp
============================================================================
Testsuite summary for libfplll 4.0.5
============================================================================
# TOTAL: 2
# PASS:  0
# SKIP:  0
# XFAIL: 0
# FAIL:  2
# XPASS: 0
# ERROR: 0
============================================================================
See tests/test-suite.log
============================================================================
```

Log at http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/49/steps/compile_1/logs/libfplll

Issue created by migration from https://trac.sagemath.org/ticket/19785





---

archive/issue_comments_268692.json:
```json
{
    "body": "I assume this is a precision issue. Can you run test_lll directly to see where it fails? I'll also try to find a machine where it fails.",
    "created_at": "2015-12-27T11:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268692",
    "user": "malb"
}
```

I assume this is a precision issue. Can you run test_lll directly to see where it fails? I'll also try to find a machine where it fails.



---

archive/issue_comments_268693.json:
```json
{
    "body": "This is with `SAGE_DEBUG=yes` for the record",
    "created_at": "2015-12-27T16:14:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268693",
    "user": "vbraun"
}
```

This is with `SAGE_DEBUG=yes` for the record



---

archive/issue_comments_268694.json:
```json
{
    "body": "\n```\n$ ./test_lll \n./test_lll: error while loading shared libraries: libgmp.so.16: cannot open shared object file: No such file or directory\n[buildslave-sage@volker-desktop tests]$ ldd test_lll\n\tlinux-vdso.so.1 (0x00007ffd5afbb000)\n\tlibfplll.so.0 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs/libfplll.so.0 (0x00007fcde9776000)\n\tlibmpfr.so.4 => /lib64/libmpfr.so.4 (0x00007fcde94e9000)\n\tlibgmp.so.16 => not found\n\tlibstdc++.so.6 => /lib64/libstdc++.so.6 (0x00007fcde9167000)\n\tlibm.so.6 => /lib64/libm.so.6 (0x00007fcde8e64000)\n\tlibgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fcde8c4d000)\n\tlibc.so.6 => /lib64/libc.so.6 (0x00007fcde888c000)\n\tlibqd.so.0 => /lib64/libqd.so.0 (0x00007fcde8645000)\n\tlibgmp.so.16 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libgmp.so.16 (0x00007fcde83a7000)\n\tlibgmp.so.10 => /lib64/libgmp.so.10 (0x00007fcde812f000)\n\t/lib64/ld-linux-x86-64.so.2 (0x00005645cd815000)\n```\n\nThe build log http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/83/steps/compile_2/logs/libfplll doesn't set the rpath:\n\n```\n/bin/sh ../libtool  --tag=CXX   --mode=link g++  -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -Wl,-rpath,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -no-install -o test_lll test_lll.o  -lmpfr -lmpfr -lgmp -lgmp \nlibtool: link: g++ -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -Wl,-rpath -Wl,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -o test_lll test_lll.o  -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -lmpfr -lgmp\n```\n",
    "created_at": "2016-04-30T23:14:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268694",
    "user": "vbraun"
}
```


```
$ ./test_lll 
./test_lll: error while loading shared libraries: libgmp.so.16: cannot open shared object file: No such file or directory
[buildslave-sage@volker-desktop tests]$ ldd test_lll
	linux-vdso.so.1 (0x00007ffd5afbb000)
	libfplll.so.0 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs/libfplll.so.0 (0x00007fcde9776000)
	libmpfr.so.4 => /lib64/libmpfr.so.4 (0x00007fcde94e9000)
	libgmp.so.16 => not found
	libstdc++.so.6 => /lib64/libstdc++.so.6 (0x00007fcde9167000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fcde8e64000)
	libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fcde8c4d000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fcde888c000)
	libqd.so.0 => /lib64/libqd.so.0 (0x00007fcde8645000)
	libgmp.so.16 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libgmp.so.16 (0x00007fcde83a7000)
	libgmp.so.10 => /lib64/libgmp.so.10 (0x00007fcde812f000)
	/lib64/ld-linux-x86-64.so.2 (0x00005645cd815000)
```

The build log http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/83/steps/compile_2/logs/libfplll doesn't set the rpath:

```
/bin/sh ../libtool  --tag=CXX   --mode=link g++  -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -Wl,-rpath,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -no-install -o test_lll test_lll.o  -lmpfr -lmpfr -lgmp -lgmp 
libtool: link: g++ -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -Wl,-rpath -Wl,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -o test_lll test_lll.o  -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -lmpfr -lgmp
```




---

archive/issue_comments_268695.json:
```json
{
    "body": "I guess its not randomly failing, its just not rebuilding after the first attempt because the failure is only in the testsuite.",
    "created_at": "2016-04-30T23:16:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268695",
    "user": "vbraun"
}
```

I guess its not randomly failing, its just not rebuilding after the first attempt because the failure is only in the testsuite.



---

archive/issue_comments_268696.json:
```json
{
    "body": "Mhh, this is odd, because `Makefile.am` does set `rpath`\n\n`AM_LDFLAGS = -L$(STAGEDIR) -Wl,-rpath,$(STAGEDIR) -lfplll`\n\nhttps://github.com/dstehle/fplll/blob/master/tests/Makefile.am",
    "created_at": "2016-05-16T09:22:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268696",
    "user": "malb"
}
```

Mhh, this is odd, because `Makefile.am` does set `rpath`

`AM_LDFLAGS = -L$(STAGEDIR) -Wl,-rpath,$(STAGEDIR) -lfplll`

https://github.com/dstehle/fplll/blob/master/tests/Makefile.am



---

archive/issue_comments_268697.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-07-12T05:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268697",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_268698.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2022-07-12T05:22:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268698",
    "user": "mkoeppe"
}
```

outdated, should close



---

archive/issue_comments_268699.json:
```json
{
    "body": "Yes.",
    "created_at": "2022-07-29T20:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268699",
    "user": "klee"
}
```

Yes.



---

archive/issue_comments_268700.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-07-29T20:20:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268700",
    "user": "klee"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_268701.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2022-08-02T06:31:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19548",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19548#issuecomment-268701",
    "user": "mkoeppe"
}
```

Resolution: invalid
