# Issue 19548: Libfplll testsuite randomly fails

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2015-12-26 20:16:46

CC:  malb jdemeyer

Keywords: random_fail

Regression of #19720

```
FAIL: test_lll
FAIL: test_svp
============================================================================
Testsuite summary for libfplll 4.0.5
============================================================================
# TOTAL: 2
# PASS:  0
# SKIP:  0
# XFAIL: 0
# FAIL:  2
# XPASS: 0
# ERROR: 0
============================================================================
See tests/test-suite.log
============================================================================
```

Log at http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/49/steps/compile_1/logs/libfplll


---

Comment by malb created at 2015-12-27 11:33:14

I assume this is a precision issue. Can you run test_lll directly to see where it fails? I'll also try to find a machine where it fails.


---

Comment by vbraun created at 2015-12-27 16:14:16

This is with `SAGE_DEBUG=yes` for the record


---

Comment by vbraun created at 2016-04-30 23:14:27


```
$ ./test_lll 
./test_lll: error while loading shared libraries: libgmp.so.16: cannot open shared object file: No such file or directory
[buildslave-sage`@`volker-desktop tests]$ ldd test_lll
	linux-vdso.so.1 (0x00007ffd5afbb000)
	libfplll.so.0 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs/libfplll.so.0 (0x00007fcde9776000)
	libmpfr.so.4 => /lib64/libmpfr.so.4 (0x00007fcde94e9000)
	libgmp.so.16 => not found
	libstdc++.so.6 => /lib64/libstdc++.so.6 (0x00007fcde9167000)
	libm.so.6 => /lib64/libm.so.6 (0x00007fcde8e64000)
	libgcc_s.so.1 => /lib64/libgcc_s.so.1 (0x00007fcde8c4d000)
	libc.so.6 => /lib64/libc.so.6 (0x00007fcde888c000)
	libqd.so.0 => /lib64/libqd.so.0 (0x00007fcde8645000)
	libgmp.so.16 => /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libgmp.so.16 (0x00007fcde83a7000)
	libgmp.so.10 => /lib64/libgmp.so.10 (0x00007fcde812f000)
	/lib64/ld-linux-x86-64.so.2 (0x00005645cd815000)
```

The build log http://build.sagedev.org/release/builders/%20%20fast%20Volker%20Desktop%20%28Fedora%2022%20x86_64%29%20full/builds/83/steps/compile_2/logs/libfplll doesn't set the rpath:

```
/bin/sh ../libtool  --tag=CXX   --mode=link g++  -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -Wl,-rpath,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -no-install -o test_lll test_lll.o  -lmpfr -lmpfr -lgmp -lgmp 
libtool: link: g++ -fPIC -I/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/include/ -Wl,-rpath -Wl,/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -o test_lll test_lll.o  -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib -L/mnt/disk/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/libfplll-20160331/src/src/.libs -lfplll -lmpfr -lgmp
```



---

Comment by vbraun created at 2016-04-30 23:16:02

I guess its not randomly failing, its just not rebuilding after the first attempt because the failure is only in the testsuite.


---

Comment by malb created at 2016-05-16 09:22:10

Mhh, this is odd, because `Makefile.am` does set `rpath`

`AM_LDFLAGS = -L$(STAGEDIR) -Wl,-rpath,$(STAGEDIR) -lfplll`

https://github.com/dstehle/fplll/blob/master/tests/Makefile.am


---

Comment by mkoeppe created at 2022-07-12 05:22:57

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2022-07-12 05:22:57

outdated, should close


---

Comment by klee created at 2022-07-29 20:20:07

Yes.


---

Comment by klee created at 2022-07-29 20:20:07

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-08-02 06:31:03

Resolution: invalid
