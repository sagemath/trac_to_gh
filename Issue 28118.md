# Issue 28118: Allow precision to be passed into the elliptic_j function

Issue created by migration from https://trac.sagemath.org/ticket/28355

Original creator: menosgeze

Original creation time: 2019-08-14 20:20:39

Keywords: elliptic_j, precision, elliptic curves

For example, Wikipedia says that the j-invariant of (1+sqrt(-163))/2 is an integer, but if one computes elliptic_j for this symbolic ring element, it returns a complex number with an imaginary part not close to 0. See: 

https://en.wikipedia.org/wiki/J-invariant



```
sage: b = sqrt(-163)
sage: b = (1+b)/2
sage: elliptic_j(b)
-2.62537412640767e17 + 732.558854258998*I
sage: elliptic_j(ComplexField(100(b))
-2.6253741264076799999999999999e17 + 1.3012822400356887122945119790e-12*I
```



---

Comment by klui created at 2019-08-14 22:39:17

I see that the PARI function `ellj` also takes in precision. Should we also pass in the precision into that as well?

# Style Suggestions:
* Add extra line before function.
* Delete spaces around equal sign.
* Indentation should be a multiple of 4.

# Doc string suggestions:
* Add prec to the input line of documentation.


---

Comment by git created at 2019-09-06 22:28:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-06 22:41:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-06 23:07:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-06 23:18:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-09-06 23:22:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by menosgeze created at 2019-09-06 23:32:52

Changing status from new to needs_review.


---

Comment by menosgeze created at 2019-09-06 23:32:52

The `elliptic_j` function needed an extra precision argument `prec`, and I fixed the indentation for the `elliptic_j` function. 
----
New commits:


---

Comment by klui created at 2019-09-09 16:15:33

Changing status from needs_review to needs_work.


---

Comment by klui created at 2019-09-09 16:15:33

Docstring formatting error in the input section.

Indentation of L309 is off by one.


---

Comment by git created at 2019-09-10 02:21:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by menosgeze created at 2019-09-10 02:56:18

Changing status from needs_work to needs_review.


---

Comment by klui created at 2019-09-10 16:08:01

Changing status from needs_review to positive_review.


---

Comment by klui created at 2019-09-10 16:08:01

Looks good to me now. I think this is a useful change.

I think the current patchbot failures aren't relevant here. The tests pass on my machine.


---

Comment by chapoton created at 2019-09-11 19:11:53

reviewer name is missing


---

Comment by klui created at 2019-09-11 19:18:17

Opps. Thanks!


---

Comment by chapoton created at 2019-09-30 08:12:27

moving milestone to 9.0 (after release of 8.9)


---

Comment by vbraun created at 2019-10-05 23:11:11

On Ubuntu 10 32-bit:

```
**********************************************************************
File "src/sage/functions/special.py", line 344, in sage.functions.special.elliptic_j
Failed example:
    -elliptic_j(tau)
Expected:
    2.62537412640767e17 - 732.558854258998*I
Got:
    2.62537412640767e17 - 732.558854103088*I
**********************************************************************
File "src/sage/functions/special.py", line 346, in sage.functions.special.elliptic_j
Failed example:
    -elliptic_j(tau,75)
Expected:
    2.625374126407680000000e17 - 0.0001309913593909879441262*I
Got:
    2.625374126407680000000e17 - 0.0001309913596969636273570*I
**********************************************************************
File "src/sage/functions/special.py", line 348, in sage.functions.special.elliptic_j
Failed example:
    -elliptic_j(tau,100)
Expected:
    2.6253741264076799999999999999e17 - 1.3012822400356887122945119790e-12*I
Got:
    2.6253741264076799999999999999e17 - 1.3012822398031636140364186716e-12*I
**********************************************************************
1 item had failures:
   3 of  12 in sage.functions.special.elliptic_j
    [125 tests, 3 failures, 3.96 s]
----------------------------------------------------------------------
sage -t --long src/sage/functions/special.py  # 3 doctests failed
```



---

Comment by vbraun created at 2019-10-05 23:11:11

Changing status from positive_review to needs_work.


---

Comment by klui created at 2019-10-13 20:21:05

I did a rebase and I added tolerance for the fixing numerical doctests on 32-bit machine. I don't have access to a 32-bit machine so let's see what the patchbot say.

I'm not too sure about what to do with the ticket fields. Do I remove myself from reviewer and add myself to author? Just leave it as it?
----
New commits:


---

Comment by klui created at 2019-10-13 20:21:05

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-11-15 20:05:24


```
sage -t --long src/sage/functions/special.py  # 3 doctests failed
```

The tag "rel tol" should be on the command line in the doctest, not on the result line.

You can add yourself as author and stay also reviewer. You need someone else to review your own changes.


---

Comment by chapoton created at 2019-11-16 08:14:12

Changing status from needs_review to needs_work.


---

Comment by git created at 2019-11-21 07:10:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klui created at 2019-11-21 07:12:36

I did a rebase on develop followed by fixing the location of the tol flags.


---

Comment by klui created at 2019-11-21 07:12:36

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2019-12-10 21:15:02

ok


---

Comment by chapoton created at 2019-12-10 21:15:02

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-12-11 21:46:20

Resolution: fixed
