# Issue 18181: Clean Hyperbolicity Module

archive/issues_018181.json:
```json
{
    "body": "CC:  @nathanncohen @dcoudert\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/18418\n\n",
    "created_at": "2015-05-14T10:39:31Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.7",
    "title": "Clean Hyperbolicity Module",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18181",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```
CC:  @nathanncohen @dcoudert



Issue created by migration from https://trac.sagemath.org/ticket/18418





---

archive/issue_comments_245008.json:
```json
{
    "body": "I will perform the modifications in the description as soon as possible. Since this is my first ticket, please let me know if I make any mistake in my work.",
    "created_at": "2015-05-14T10:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245008",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

I will perform the modifications in the description as soon as possible. Since this is my first ticket, please let me know if I make any mistake in my work.



---

archive/issue_comments_245009.json:
```json
{
    "body": "Changing keywords from \"\" to \"Hyperbolicity\".",
    "created_at": "2015-05-14T10:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245009",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing keywords from "" to "Hyperbolicity".



---

archive/issue_comments_245010.json:
```json
{
    "body": "Set assignee to borassi.",
    "created_at": "2015-05-14T10:47:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245010",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Set assignee to borassi.



---

archive/issue_comments_245011.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to graph theory.",
    "created_at": "2015-05-14T11:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245011",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing component from PLEASE CHANGE to graph theory.



---

archive/issue_comments_245012.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2015-05-14T11:05:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245012",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_245013.json:
```json
{
    "body": "in the hyperbolicity method, we are not using qsort but something similar to counting sort.\nYou can certainly clean that part and put it in a specific method so that it can be reused",
    "created_at": "2015-05-15T07:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245013",
    "user": "https://github.com/dcoudert"
}
```

in the hyperbolicity method, we are not using qsort but something similar to counting sort.
You can certainly clean that part and put it in a specific method so that it can be reused



---

archive/issue_comments_245014.json:
```json
{
    "body": "David, is there any particular reason why you use variable \"triples\", instead of simply iterating twice over the array \"pairs_of_length\"? If not, I could clean this, too.",
    "created_at": "2015-05-18T09:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245014",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

David, is there any particular reason why you use variable "triples", instead of simply iterating twice over the array "pairs_of_length"? If not, I could clean this, too.



---

archive/issue_comments_245015.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-18T09:26:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245015",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_245016.json:
```json
{
    "body": "Hello,\n\n- editing remark : comments must be formatted in 80 columns format. Don't ask why ;)\n- in the sort_pairs method, you are not using quick sort but counting sort\n- there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example\n\n```\nfrom sage.ext.memory cimport check_allocarray, sage_malloc, sage_free\nelist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))\n```\n- I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.\n- the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?\n\nDavid.",
    "created_at": "2015-05-18T21:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245016",
    "user": "https://github.com/dcoudert"
}
```

Hello,

- editing remark : comments must be formatted in 80 columns format. Don't ask why ;)
- in the sort_pairs method, you are not using quick sort but counting sort
- there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example

```
from sage.ext.memory cimport check_allocarray, sage_malloc, sage_free
elist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))
```
- I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.
- the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?

David.



---

archive/issue_comments_245017.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-19T16:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245018.json:
```json
{
    "body": "Hello!\n\n> - editing remark : comments must be formatted in 80 columns format. Don't ask why ;)\n\n\nDone\n\n> - in the sort_pairs method, you are not using quick sort but counting sort\n\n\nYeah, sorry, wrong comment. Corrected.\n\n> - there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example\n> \n> ```\n> from sage.ext.memory cimport check_allocarray, sage_malloc, sage_free\n> elist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))\n> ```\n\n\nDone\n\n> - I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.\n\n\nI replaced the code of `basic` with the old cose of `basic+`.\n\n> - the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?\n\n\nI see your point: very nice solution! My solution was simply to recompute `S1` every time.",
    "created_at": "2015-05-19T16:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245018",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Hello!

> - editing remark : comments must be formatted in 80 columns format. Don't ask why ;)


Done

> - in the sort_pairs method, you are not using quick sort but counting sort


Yeah, sorry, wrong comment. Corrected.

> - there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example
> 
> ```
> from sage.ext.memory cimport check_allocarray, sage_malloc, sage_free
> elist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))
> ```


Done

> - I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.


I replaced the code of `basic` with the old cose of `basic+`.

> - the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?


I see your point: very nice solution! My solution was simply to recompute `S1` every time.



---

archive/issue_comments_245019.json:
```json
{
    "body": "Hello,\n\nBe careful with global name replacements\n\n```\n-      performs very well in practice since it cuts the search space.  This\n+      performs very well in practice since it CCL the search space.  This\n```\n\nIn method `sort_pairs`, you should\n- Add a first comment line like `Return a list of pairs sorted in decreasing order of values`. Almost all methods have such a one line description.\n- declare the types of local variables i,j,k\n\nIn method `__hyperbolicity__`, you should\n- Replace `cdef uint32_t *nb_p = <uint32_t>check...` with `cdef uint32_t nb_p` and then call `sort_pairs` with `&nb_p`  and use `nb_p` rather than `nb_p[0]`\n\nYou could also rename some methods\n- `__hyperbolicity_basic_algorithm__` -> `hyperbolicity_basic_algorithm`\n- `__hyperbolicity__` -> `hyperbolicity_CCL` \nThese methods are cdef, they are not visible at Python level.",
    "created_at": "2015-05-20T09:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245019",
    "user": "https://github.com/dcoudert"
}
```

Hello,

Be careful with global name replacements

```
-      performs very well in practice since it cuts the search space.  This
+      performs very well in practice since it CCL the search space.  This
```

In method `sort_pairs`, you should
- Add a first comment line like `Return a list of pairs sorted in decreasing order of values`. Almost all methods have such a one line description.
- declare the types of local variables i,j,k

In method `__hyperbolicity__`, you should
- Replace `cdef uint32_t *nb_p = <uint32_t>check...` with `cdef uint32_t nb_p` and then call `sort_pairs` with `&nb_p`  and use `nb_p` rather than `nb_p[0]`

You could also rename some methods
- `__hyperbolicity_basic_algorithm__` -> `hyperbolicity_basic_algorithm`
- `__hyperbolicity__` -> `hyperbolicity_CCL` 
These methods are cdef, they are not visible at Python level.



---

archive/issue_comments_245020.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-20T14:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245021.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-20T14:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245022.json:
```json
{
    "body": "Done everything!",
    "created_at": "2015-05-20T14:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245022",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Done everything!



---

archive/issue_comments_245023.json:
```json
{
    "body": "`list pairs {i,j} in increasing order` -> decreasing order ?",
    "created_at": "2015-05-20T14:36:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245023",
    "user": "https://github.com/dcoudert"
}
```

`list pairs {i,j} in increasing order` -> decreasing order ?



---

archive/issue_comments_245024.json:
```json
{
    "body": "I think in increasing order, because at line 569 I find:\n\n```\n    # ==> Defines pairs_of_length[d] for all d\n    for i from 1 <= i <= D:\n        pairs_of_length[i] = pairs_of_length[i-1] + nb_pairs_of_length[i-1]\n\n```\nwhere pairs_of_length[i] is where the list of pairs at distance i starts.",
    "created_at": "2015-05-20T15:05:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245024",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

I think in increasing order, because at line 569 I find:

```
    # ==> Defines pairs_of_length[d] for all d
    for i from 1 <= i <= D:
        pairs_of_length[i] = pairs_of_length[i-1] + nb_pairs_of_length[i-1]

```
where pairs_of_length[i] is where the list of pairs at distance i starts.



---

archive/issue_comments_245025.json:
```json
{
    "body": "You are perfectly right!\n\nFor me this patch is now good to go.\n\nDavid.",
    "created_at": "2015-05-20T15:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245025",
    "user": "https://github.com/dcoudert"
}
```

You are perfectly right!

For me this patch is now good to go.

David.



---

archive/issue_comments_245026.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-20T15:13:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245026",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245027.json:
```json
{
    "body": "Author name should be the full name, not trac username",
    "created_at": "2015-05-21T18:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245027",
    "user": "https://github.com/vbraun"
}
```

Author name should be the full name, not trac username



---

archive/issue_comments_245028.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-05-21T18:31:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245028",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_245029.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-05-22T05:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245029",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_245030.json:
```json
{
    "body": "Sorry, I have forgotten to check that.",
    "created_at": "2015-05-22T05:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245030",
    "user": "https://github.com/dcoudert"
}
```

Sorry, I have forgotten to check that.



---

archive/issue_comments_245031.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-05-22T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245031",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_245032.json:
```json
{
    "body": "Documentation doesnt' build:\n\n```\n[graphs   ] docstring of sage.graphs.hyperbolicity:10: WARNING: Block quote ends without a blank line; unexpected unindent.\n```",
    "created_at": "2015-05-22T20:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245032",
    "user": "https://github.com/vbraun"
}
```

Documentation doesnt' build:

```
[graphs   ] docstring of sage.graphs.hyperbolicity:10: WARNING: Block quote ends without a blank line; unexpected unindent.
```



---

archive/issue_comments_245033.json:
```json
{
    "body": "Michele, line 10 of the file, there is a `Z` that should be removed.",
    "created_at": "2015-05-23T06:29:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245033",
    "user": "https://github.com/dcoudert"
}
```

Michele, line 10 of the file, there is a `Z` that should be removed.



---

archive/issue_comments_245034.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-24T14:42:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245034",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_245035.json:
```json
{
    "body": "Done!",
    "created_at": "2015-05-24T14:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245035",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Done!



---

archive/issue_comments_245036.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-05-24T14:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245036",
    "user": "https://trac.sagemath.org/admin/accounts/users/borassi"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_245037.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-05-25T13:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245037",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_245038.json:
```json
{
    "body": "With the last commit, I can compile, run tests, do some other trials, build the doc and the result looks good. So it should be ok this time.",
    "created_at": "2015-05-25T13:53:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245038",
    "user": "https://github.com/dcoudert"
}
```

With the last commit, I can compile, run tests, do some other trials, build the doc and the result looks good. So it should be ok this time.



---

archive/issue_comments_245039.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-05-25T22:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18181#issuecomment-245039",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_051893.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-05-25T22:49:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18181#event-51893"
}
```
