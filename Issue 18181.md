# Issue 18181: Clean Hyperbolicity Module

Issue created by migration from Trac.

Original creator: borassi

Original creation time: 2015-05-14 10:39:31

CC:  ncohen dcoudert




---

Comment by borassi created at 2015-05-14 10:47:12

I will perform the modifications in the description as soon as possible. Since this is my first ticket, please let me know if I make any mistake in my work.


---

Comment by borassi created at 2015-05-14 10:47:12

Changing keywords from "" to "Hyperbolicity".


---

Comment by borassi created at 2015-05-14 10:47:12

Set assignee to borassi.


---

Comment by borassi created at 2015-05-14 11:05:51

Changing component from PLEASE CHANGE to graph theory.


---

Comment by borassi created at 2015-05-14 11:05:51

Changing type from PLEASE CHANGE to enhancement.


---

Comment by dcoudert created at 2015-05-15 07:41:38

in the hyperbolicity method, we are not using qsort but something similar to counting sort.
You can certainly clean that part and put it in a specific method so that it can be reused


---

Comment by borassi created at 2015-05-18 09:26:34

David, is there any particular reason why you use variable "triples", instead of simply iterating twice over the array "pairs_of_length"? If not, I could clean this, too.


---

Comment by borassi created at 2015-05-18 09:26:34

Changing status from new to needs_review.


---

Comment by dcoudert created at 2015-05-18 21:22:30

Hello,

- editing remark : comments must be formatted in 80 columns format. Don't ask why ;)
- in the sort_pairs method, you are not using quick sort but counting sort
- there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example

```
from sage.ext.memory cimport check_allocarray, sage_malloc, sage_free
elist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))
```

- I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.
- the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?

David.


---

Comment by git created at 2015-05-19 16:32:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by borassi created at 2015-05-19 16:38:03

Hello!

> - editing remark : comments must be formatted in 80 columns format. Don't ask why ;)

Done

> - in the sort_pairs method, you are not using quick sort but counting sort

Yeah, sorry, wrong comment. Corrected.

> - there is a recent and useful method for malloc. See file `generic_graph_pyx.pyx` for example
> {{{
> from sage.ext.memory cimport check_allocarray, sage_malloc, sage_free
> elist = <int*>check_allocarray(2 * len(G.edges()) + 2, sizeof(int))
> }}}

Done

> - I agree to remove `basic+`, although I would have prefer to rename `basic+` into `basic` and remove the old `basic` which is slower. The basic method is useful only for comparison purpose.

I replaced the code of `basic` with the old cose of `basic+`.

> - the purpose of the `triples` list is to avoid computing many times the sum S1. It adds a loop but reduces the number of operations. Do you have a better solution in mind ?

I see your point: very nice solution! My solution was simply to recompute `S1` every time.


---

Comment by dcoudert created at 2015-05-20 09:29:02

Hello,

Be careful with global name replacements

```
-      performs very well in practice since it cuts the search space.  This
+      performs very well in practice since it CCL the search space.  This
```


In method `sort_pairs`, you should
- Add a first comment line like `Return a list of pairs sorted in decreasing order of values`. Almost all methods have such a one line description.
- declare the types of local variables i,j,k

In method `__hyperbolicity__`, you should
- Replace `cdef uint32_t *nb_p = <uint32_t>check...` with `cdef uint32_t nb_p` and then call `sort_pairs` with `&nb_p`  and use `nb_p` rather than `nb_p[0]`

You could also rename some methods
- `__hyperbolicity_basic_algorithm__` -> `hyperbolicity_basic_algorithm`
- `__hyperbolicity__` -> `hyperbolicity_CCL` 
These methods are cdef, they are not visible at Python level.


---

Comment by git created at 2015-05-20 14:13:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-05-20 14:16:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by borassi created at 2015-05-20 14:17:48

Done everything!


---

Comment by dcoudert created at 2015-05-20 14:36:12

`list pairs {i,j} in increasing order` -> decreasing order ?


---

Comment by borassi created at 2015-05-20 15:05:24

I think in increasing order, because at line 569 I find:


```
    # ==> Defines pairs_of_length[d] for all d
    for i from 1 <= i <= D:
        pairs_of_length[i] = pairs_of_length[i-1] + nb_pairs_of_length[i-1]

```

where pairs_of_length[i] is where the list of pairs at distance i starts.


---

Comment by dcoudert created at 2015-05-20 15:13:48

You are perfectly right!

For me this patch is now good to go.

David.


---

Comment by dcoudert created at 2015-05-20 15:13:48

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-21 18:31:44

Author name should be the full name, not trac username


---

Comment by vbraun created at 2015-05-21 18:31:44

Changing status from positive_review to needs_work.


---

Comment by dcoudert created at 2015-05-22 05:01:28

Changing status from needs_work to positive_review.


---

Comment by dcoudert created at 2015-05-22 05:01:28

Sorry, I have forgotten to check that.


---

Comment by vbraun created at 2015-05-22 20:34:20

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2015-05-22 20:34:20

Documentation doesnt' build:

```
[graphs   ] docstring of sage.graphs.hyperbolicity:10: WARNING: Block quote ends without a blank line; unexpected unindent.
```



---

Comment by dcoudert created at 2015-05-23 06:29:28

Michele, line 10 of the file, there is a `Z` that should be removed.


---

Comment by git created at 2015-05-24 14:42:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by borassi created at 2015-05-24 14:43:52

Done!


---

Comment by borassi created at 2015-05-24 14:43:52

Changing status from needs_work to needs_review.


---

Comment by dcoudert created at 2015-05-25 13:53:04

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2015-05-25 13:53:04

With the last commit, I can compile, run tests, do some other trials, build the doc and the result looks good. So it should be ok this time.


---

Comment by vbraun created at 2015-05-25 22:49:41

Resolution: fixed
