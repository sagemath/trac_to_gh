# Issue 31226: Univariate matrices: improve Weak Popov form; add Popov form

archive/issues_031226.json:
```json
{
    "body": "CC:  @ke456\n\nKeywords: polynomial matrix; canonical form\n\n**Improvements for weak Popov form**:\n* extend with an option allowing column-wise transformation into column weak Popov (for consistency with other functions),\n* sort the rows by increasing leading position (for consistency with other functions),\n* make some arbitrary but clearly stated choice for where zero rows are placed (typically, at the bottom of the weak Popov form).\n\nThe latter two changes will not impact performance since they only involve row permutation. They should not either impact code that uses the current version, since the current code only guarantees that the output is weak Popov, a fact not changed by the new specification.\n\n**Normalization into Popov form**: call the weak Popov form algorithm and then use Mulders and Storjohann algorithm to transform it into the canonical Popov form. Shifts should be supported, as well as working row-wise or column-wise.\n\n**Zero rows option**: for both weak Popov and Popov forms, add an option to allow the user to specify that they want a form with the zero rows removed (option set to False by default, for compatibility). The number of rows in the returned matrix is then the rank of the input matrix.\n\nIssue created by migration from https://trac.sagemath.org/ticket/31463\n\n",
    "created_at": "2021-03-07T19:53:24Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Univariate matrices: improve Weak Popov form; add Popov form",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/31226",
    "user": "https://github.com/vneiger"
}
```
CC:  @ke456

Keywords: polynomial matrix; canonical form

**Improvements for weak Popov form**:
* extend with an option allowing column-wise transformation into column weak Popov (for consistency with other functions),
* sort the rows by increasing leading position (for consistency with other functions),
* make some arbitrary but clearly stated choice for where zero rows are placed (typically, at the bottom of the weak Popov form).

The latter two changes will not impact performance since they only involve row permutation. They should not either impact code that uses the current version, since the current code only guarantees that the output is weak Popov, a fact not changed by the new specification.

**Normalization into Popov form**: call the weak Popov form algorithm and then use Mulders and Storjohann algorithm to transform it into the canonical Popov form. Shifts should be supported, as well as working row-wise or column-wise.

**Zero rows option**: for both weak Popov and Popov forms, add an option to allow the user to specify that they want a form with the zero rows removed (option set to False by default, for compatibility). The number of rows in the returned matrix is then the rank of the input matrix.

Issue created by migration from https://trac.sagemath.org/ticket/31463





---

archive/issue_comments_445822.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445822",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_445823.json:
```json
{
    "body": "All things above have been handled in a preliminary version, except for the transformation from weak Popov to (strong) Popov which is kept for later. Minor improvements/corrections are expected; documentation should be completed; and more tests should be done and some of them included in the documentation.\n----\nNew commits:",
    "created_at": "2021-07-27T12:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445823",
    "user": "https://github.com/vneiger"
}
```

All things above have been handled in a preliminary version, except for the transformation from weak Popov to (strong) Popov which is kept for later. Minor improvements/corrections are expected; documentation should be completed; and more tests should be done and some of them included in the documentation.
----
New commits:



---

archive/issue_comments_445824.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T17:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445825.json:
```json
{
    "body": "Some testing has been done, and some minor corrections made. The documentation is fine now, it just misses some \"documentation tests\".",
    "created_at": "2021-07-27T17:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445825",
    "user": "https://github.com/vneiger"
}
```

Some testing has been done, and some minor corrections made. The documentation is fine now, it just misses some "documentation tests".



---

archive/issue_comments_445826.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T20:32:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445827.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T20:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445828.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T20:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445828",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445829.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-27T20:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445829",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445830.json:
```json
{
    "body": "Except for Popov form normalization, everything has been dealt with, including documentation and testing. Note that, to ensure backward compatibility, the computed weak Popov form is not ordered by default, unlike what was suggested in the ticket, but an option to get an ordered form is provided.",
    "created_at": "2021-07-27T20:59:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445830",
    "user": "https://github.com/vneiger"
}
```

Except for Popov form normalization, everything has been dealt with, including documentation and testing. Note that, to ensure backward compatibility, the computed weak Popov form is not ordered by default, unlike what was suggested in the ticket, but an option to get an ordered form is provided.



---

archive/issue_comments_445831.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-29T14:01:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445832.json:
```json
{
    "body": "The last commit does some minor fixes, and an implementation of Popov form normalization following the Mulders and Storjohann algorithm (first call weak Popov form, then normalize degrees by iterating on the rows). It seems to work well, and there is a good amount of doc tests already. It remains to write the corresponding documentation.",
    "created_at": "2021-07-29T14:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445832",
    "user": "https://github.com/vneiger"
}
```

The last commit does some minor fixes, and an implementation of Popov form normalization following the Mulders and Storjohann algorithm (first call weak Popov form, then normalize degrees by iterating on the rows). It seems to work well, and there is a good amount of doc tests already. It remains to write the corresponding documentation.



---

archive/issue_comments_445833.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-29T17:23:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445834.json:
```json
{
    "body": "Documentation for Popov form is now ok. Some improvements have been done in the documentation for other related methods as well (Hermite, reduced, weak Popov): the definitions are in the verification method (`is_popov`, `is_reduced`, ..) while the computing method (`popov_form`, `reduced_form`, ..) just points to the relevant definition.",
    "created_at": "2021-07-29T17:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445834",
    "user": "https://github.com/vneiger"
}
```

Documentation for Popov form is now ok. Some improvements have been done in the documentation for other related methods as well (Hermite, reduced, weak Popov): the definitions are in the verification method (`is_popov`, `is_reduced`, ..) while the computing method (`popov_form`, `reduced_form`, ..) just points to the relevant definition.



---

archive/issue_comments_445835.json:
```json
{
    "body": "Set assignee to @ke456.",
    "created_at": "2021-07-29T18:22:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445835",
    "user": "https://github.com/ke456"
}
```

Set assignee to @ke456.



---

archive/issue_comments_445836.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-29T18:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445836",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445837.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-07-29T18:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445837",
    "user": "https://github.com/vneiger"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_445838.json:
```json
{
    "body": "The comments and tests seem good, but maybe the documentation for reduced_form could be more clear about what reduced form is being computed (since it is not a canonical form). For example, is it randomly computed?\n\nThis function should also be simplified using the new weak_popov_form functionalities.",
    "created_at": "2021-07-29T18:43:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445838",
    "user": "https://github.com/ke456"
}
```

The comments and tests seem good, but maybe the documentation for reduced_form could be more clear about what reduced form is being computed (since it is not a canonical form). For example, is it randomly computed?

This function should also be simplified using the new weak_popov_form functionalities.



---

archive/issue_comments_445839.json:
```json
{
    "body": "Thank you for noticing this, indeed `reduced_form` should be simplified, it does not need to distinguish row-wise and column-wise anymore thanks to the new `weak_popov_form` features. I'm going to fix this in a commit right now.\n\nAnd indeed, the documentation is unclear because it puts too much highlight on the fact that a reduced form is not unique (for example this is also the case for weak Popov forms, and this is not even mentioned in the weak Popov documentation).\n\nI think this is more confusing than helping, since it already appears clearly in the definitions and the class description that the Popov / Hermite forms are unique, but reduced forms and weak Popov forms are not. So my proposition would be to simply remove this confusing comment: does that sound better?",
    "created_at": "2021-07-29T20:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445839",
    "user": "https://github.com/vneiger"
}
```

Thank you for noticing this, indeed `reduced_form` should be simplified, it does not need to distinguish row-wise and column-wise anymore thanks to the new `weak_popov_form` features. I'm going to fix this in a commit right now.

And indeed, the documentation is unclear because it puts too much highlight on the fact that a reduced form is not unique (for example this is also the case for weak Popov forms, and this is not even mentioned in the weak Popov documentation).

I think this is more confusing than helping, since it already appears clearly in the definitions and the class description that the Popov / Hermite forms are unique, but reduced forms and weak Popov forms are not. So my proposition would be to simply remove this confusing comment: does that sound better?



---

archive/issue_comments_445840.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-29T20:49:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445840",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445841.json:
```json
{
    "body": "Yes, I think this is a sensible solution.",
    "created_at": "2021-07-29T21:57:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445841",
    "user": "https://github.com/ke456"
}
```

Yes, I think this is a sensible solution.



---

archive/issue_comments_445842.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-07-29T22:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445842",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_445843.json:
```json
{
    "body": "Ok, done in the last commit. Is there any other thing that still needs to be verified or improved?",
    "created_at": "2021-07-29T22:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445843",
    "user": "https://github.com/vneiger"
}
```

Ok, done in the last commit. Is there any other thing that still needs to be verified or improved?



---

archive/issue_comments_445844.json:
```json
{
    "body": "I have checked again after the modifications and the functionality reflects the description of the ticket, and the testing, documentation, and style are okay as well.",
    "created_at": "2021-07-30T21:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445844",
    "user": "https://github.com/ke456"
}
```

I have checked again after the modifications and the functionality reflects the description of the ticket, and the testing, documentation, and style are okay as well.



---

archive/issue_comments_445845.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-30T21:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445845",
    "user": "https://github.com/ke456"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_445846.json:
```json
{
    "body": "Thanks for the reviewing. Then I suppose we can revert to milestone 9.4.",
    "created_at": "2021-07-30T21:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445846",
    "user": "https://github.com/vneiger"
}
```

Thanks for the reviewing. Then I suppose we can revert to milestone 9.4.



---

archive/issue_comments_445847.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/31226",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/31226#issuecomment-445847",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
