# Issue 31226: Univariate matrices: improve Weak Popov form; add Popov form

Issue created by migration from https://trac.sagemath.org/ticket/31463

Original creator: @vneiger

Original creation time: 2021-03-07 19:53:24

CC:  @ke456

Keywords: polynomial matrix; canonical form

**Improvements for weak Popov form**:
* extend with an option allowing column-wise transformation into column weak Popov (for consistency with other functions),
* sort the rows by increasing leading position (for consistency with other functions),
* make some arbitrary but clearly stated choice for where zero rows are placed (typically, at the bottom of the weak Popov form).

The latter two changes will not impact performance since they only involve row permutation. They should not either impact code that uses the current version, since the current code only guarantees that the output is weak Popov, a fact not changed by the new specification.

**Normalization into Popov form**: call the weak Popov form algorithm and then use Mulders and Storjohann algorithm to transform it into the canonical Popov form. Shifts should be supported, as well as working row-wise or column-wise.

**Zero rows option**: for both weak Popov and Popov forms, add an option to allow the user to specify that they want a form with the zero rows removed (option set to False by default, for compatibility). The number of rows in the returned matrix is then the rank of the input matrix.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by @vneiger created at 2021-07-27 12:58:22

All things above have been handled in a preliminary version, except for the transformation from weak Popov to (strong) Popov which is kept for later. Minor improvements/corrections are expected; documentation should be completed; and more tests should be done and some of them included in the documentation.
----
New commits:


---

Comment by git created at 2021-07-27 17:10:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-27 17:11:17

Some testing has been done, and some minor corrections made. The documentation is fine now, it just misses some "documentation tests".


---

Comment by git created at 2021-07-27 20:32:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-27 20:36:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-27 20:53:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-07-27 20:57:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-27 20:59:24

Except for Popov form normalization, everything has been dealt with, including documentation and testing. Note that, to ensure backward compatibility, the computed weak Popov form is not ordered by default, unlike what was suggested in the ticket, but an option to get an ordered form is provided.


---

Comment by git created at 2021-07-29 14:01:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-29 14:03:44

The last commit does some minor fixes, and an implementation of Popov form normalization following the Mulders and Storjohann algorithm (first call weak Popov form, then normalize degrees by iterating on the rows). It seems to work well, and there is a good amount of doc tests already. It remains to write the corresponding documentation.


---

Comment by git created at 2021-07-29 17:23:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-29 17:25:32

Documentation for Popov form is now ok. Some improvements have been done in the documentation for other related methods as well (Hermite, reduced, weak Popov): the definitions are in the verification method (`is_popov`, `is_reduced`, ..) while the computing method (`popov_form`, `reduced_form`, ..) just points to the relevant definition.


---

Comment by @ke456 created at 2021-07-29 18:22:31

Set assignee to @ke456.


---

Comment by git created at 2021-07-29 18:28:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-29 18:28:57

Changing status from new to needs_review.


---

Comment by @ke456 created at 2021-07-29 18:43:19

The comments and tests seem good, but maybe the documentation for reduced_form could be more clear about what reduced form is being computed (since it is not a canonical form). For example, is it randomly computed?

This function should also be simplified using the new weak_popov_form functionalities.


---

Comment by @vneiger created at 2021-07-29 20:43:10

Thank you for noticing this, indeed `reduced_form` should be simplified, it does not need to distinguish row-wise and column-wise anymore thanks to the new `weak_popov_form` features. I'm going to fix this in a commit right now.

And indeed, the documentation is unclear because it puts too much highlight on the fact that a reduced form is not unique (for example this is also the case for weak Popov forms, and this is not even mentioned in the weak Popov documentation).

I think this is more confusing than helping, since it already appears clearly in the definitions and the class description that the Popov / Hermite forms are unique, but reduced forms and weak Popov forms are not. So my proposition would be to simply remove this confusing comment: does that sound better?


---

Comment by git created at 2021-07-29 20:49:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @ke456 created at 2021-07-29 21:57:33

Yes, I think this is a sensible solution.


---

Comment by git created at 2021-07-29 22:00:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @vneiger created at 2021-07-29 22:01:54

Ok, done in the last commit. Is there any other thing that still needs to be verified or improved?


---

Comment by @ke456 created at 2021-07-30 21:05:01

I have checked again after the modifications and the functionality reflects the description of the ticket, and the testing, documentation, and style are okay as well.


---

Comment by @ke456 created at 2021-07-30 21:05:01

Changing status from needs_review to positive_review.


---

Comment by @vneiger created at 2021-07-30 21:09:49

Thanks for the reviewing. Then I suppose we can revert to milestone 9.4.


---

Comment by vbraun created at 2021-08-29 09:37:42

Resolution: fixed
