# Issue 34273: Add to check for fixed length in IntegerVector

Issue created by migration from https://trac.sagemath.org/ticket/34510

Original creator: tkarn

Original creation time: 2022-09-08 21:59:08

CC:  tscrim tkarn darij

Keywords: gsoc2022

The current IntegerVector.check method only checks for the positivity of each element. This adds a check for specified totals (`n`) and lengths (`k`).


---

Comment by tkarn created at 2022-09-08 22:17:59

Set assignee to tkarn.


---

Comment by tkarn created at 2022-09-08 22:17:59

Changing keywords from "gsoc2022" to "gsoc2022 integer-vector check".


---

Comment by tkarn created at 2022-09-08 22:36:46

There is also a defect in this:


```
sage: IV33 = IntegerVectors(n=3, k=3)
sage: IV33([0])
[0]
sage: IV33([0]) in IV33
True
```



---

Comment by tkarn created at 2022-09-08 22:45:00

New commits:


---

Comment by tkarn created at 2022-09-08 22:45:00

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-09-09 06:10:15

I would just check that it belongs to the parent. The first test should be done by that anyways.

Also, for the error message:

```
f"{self} is not an element of {self.parent()}"
```



---

Comment by tscrim created at 2022-09-09 06:10:57

Once changed and a green bot, positive review.


---

Comment by git created at 2022-09-09 19:01:15

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tkarn created at 2022-09-09 19:03:04

Should be good to go. Removing the first check allowed [-1] to be understood as an `IntegerVector` so I fixed that in the `IntegerVector.__contains__`.


---

Comment by tscrim created at 2022-09-09 22:57:31

Good catch on another bug. `[-1] in IntegerVectors()` is indeed bad. One last thing is changing

```diff
-if not isinstance(x, (list, tuple, IntegerVector)):
+if not isinstance(x, sequence):
```

using the `from collections.abc import sequence` (that way it also takes things like `Composition`s as well). We should just do that here as well (with an update to the ticket description too).


---

Comment by git created at 2022-09-13 16:17:05

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tkarn created at 2022-09-13 16:17:54

Replying to [comment:8 Travis Scrimshaw]:
> One last thing is changing
> {{{#!diff
> -if not isinstance(x, (list, tuple, IntegerVector)):
> +if not isinstance(x, sequence):
> }}}
> using the `from collections.abc import sequence`
Done!


---

Comment by tkarn created at 2022-09-13 17:53:57

Changing status from needs_review to needs_work.


---

Comment by tkarn created at 2022-09-13 17:55:47

Here's something surprising! `Composition`s are not understood as `Sequences`.


```
sage: c = Composition([3,4,2,4])
sage: from collections.abc import Sequence
sage: isinstance(c, Sequence)
False
```



---

Comment by tkarn created at 2022-09-13 18:05:30

Replying to [comment:13 Trevor Karn]:
> Here's something surprising! `Composition`s are not understood as `Sequences`.
> 
> {{{
> sage: c = Composition([3,4,2,4])
> sage: from collections.abc import Sequence
> sage: isinstance(c, Sequence)
> False
> }}}

The bug because of the `Compositions`, so I'm opening #34527 and this is now ready for review.


---

Comment by tkarn created at 2022-09-13 18:05:44

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-09-13 23:29:32

Actually, I suspect this holds for things more general things within Sage because of the extra requirements of a `__reversed__()` and `count()` methods. We can weaken this to `collection`.


---

Comment by tkarn created at 2022-09-16 18:38:59

Replying to [comment:16 Travis Scrimshaw]:
> Actually, I suspect this holds for things more general things within Sage because of the extra requirements of a `__reversed__()` and `count()` methods. We can weaken this to `collection`.

I think we discussed this offline but I just want to confirm that this should be a `Sequence` because there is implicitly a fixed order?


---

Comment by tscrim created at 2022-09-16 22:04:41

Yes, that's correct.


---

Comment by tkarn created at 2022-09-17 14:11:13

Replying to [comment:18 Travis Scrimshaw]:
> Yes, that's correct.
Ok then I think this ticket is ready for review. Am I missing anything?


---

Comment by tscrim created at 2022-09-18 00:08:12

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-09-18 00:08:12

LGTM. Thank you.


---

Comment by vbraun created at 2022-09-25 16:34:11

Resolution: fixed
