# Issue 15950: exclude legacy from sage-list-packages

Issue created by migration from https://trac.sagemath.org/ticket/16187

Original creator: vbraun

Original creation time: 2014-04-18 10:55:47




---

Comment by vbraun created at 2014-04-18 11:11:26

New commits:


---

Comment by vbraun created at 2014-04-18 11:11:26

Changing component from PLEASE CHANGE to build.


---

Comment by vbraun created at 2014-04-18 11:11:26

Changing type from PLEASE CHANGE to defect.


---

Comment by vbraun created at 2014-04-18 11:11:26

Changing status from new to needs_review.


---

Comment by leif created at 2014-04-18 12:44:34

WYAI<sup>1</sup>, change `"Using SAGE Server %s"` to `"Using Sage Server %s"`. ;-)

Dealing with package versions is SFFT<sup>2</sup>.

Otherwise LGTM, but HTI<sup>3</sup>.

----

<sup>1</sup> while you're at it

<sup>2</sup> something for a follow-up ticket

<sup>3</sup> haven't tested it


---

Comment by leif created at 2014-04-18 12:48:57

P.S.:  Title of the ticket and branch doesn't match the change, IMHO.


---

Comment by vbraun created at 2014-04-18 13:13:26

Yes, I first thought we should rip out the legacy spgks but then went for a more minimal change.


---

Comment by git created at 2014-04-18 13:14:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by leif created at 2014-04-19 15:50:17

Hmmm, I'm not very happy with the (lengthy and potentially confusing) output of `sage --{optional,experimental}`.

Perhaps we could at least drop the banner and instead replace `INSTALLED:` by `All installed packages:`  and `NOT INSTALLED:` by `{Optional,Experimental} packages not installed:` (at your taste uppercase "all", "not" etc.).




We'll see whether I'll find the time to implement some nicer output, listing all available optional / experimental packages, and if appropriate, the _installed_ version _next to each_ (not listing packages that are installed but not optional or experimental).  ;-)


---

Comment by vbraun created at 2014-04-19 15:58:57

Sooner or later we will drop the "legacy optional" packages. You are welcome to open your own ticket if/when you find the time to beautify the output.


---

Comment by leif created at 2014-04-19 17:21:44

How about this:


```
$ ./sage --optional
Using Sage Server http://www.sagemath.org/packages

Optional packages:

                                4ti2-1.6	not installed
                       PyQt_x11-4.9.1.p0	not installed
                           TOPCOM-0.17.4	not installed
                      autotools-20121217	not installed
                     beautifulsoup-3.2.1	not installed
                        benzene-20130630	not installed
                          biopython-1.61	not installed
                          brian-1.4.1.p0	not installed
                         buckygen-1.0.p1	not installed
                            cbc-2.8.1.p0	not installed
                            ccache-3.1.9	not installed
                       chomp-20130518.p1	not installed
                        cluster_seed-1.0	not installed
                            coxeter3-1.1	not installed
                     cryptominisat-2.9.6	not installed
                   cunningham_tables-1.0	not installed
      database_cremona_ellcurve-20121022	not installed
                      database_gap-4.6.4	installed version: 4.7.4
              database_jones_numfield-v4	not installed
                 database_kohel-20060803	not installed
                   database_odlyzko_zeta	not installed
                  database_pari-20130516	not installed
          database_stein_watkins_mini.p0	not installed
         database_symbolic_data-20070206	not installed
                        dot2tex-2.8.7.p2	not installed
                     extra_docs-20070208	not installed
                   gap_packages-4.6.4.p1	installed version: 4.7.4
                               gcc-4.6.4	not installed
                              gdbm-1.8.3	not installed
                       ginv-1.9-20080723	not installed
                         git-1.7.12.2.p0	installed version: 1.8.4.4
                           gnuplotpy-1.8	not installed
                             guppy-0.1.8	not installed
                         java3d-20070901	not installed
                     kash3-2008-07-31.p0	already installed
                         knoboo-20080411	not installed
                            libogg-1.1.4	not installed
                         libtheora-1.1.1	not installed
                            lie-2.2.2.p5	not installed
                             lrs-4.2b.p1	not installed
                            mpi4py-1.2.2	not installed
                                nauty-25	not installed
                         normaliz-2.8.p0	not installed
                              nose-1.1.2	not installed
                            nzmath-1.1.0	not installed
                           openmpi-1.4.3	not installed
             p_group_cohomology-2.1.4.p1	not installed
                          patchbot-2.0.1	not installed
                           phc-2.3.65.p0	not installed
                         pybtex-20120618	not installed
               pycryptoplus-20100809-git	not installed
                       pyopenssl-0.13.p0	not installed
                                pyx-0.10	not installed
                         pyzmq-2.1.11.p1	not installed
                            qhull-2010.1	not installed
                          sage_mode-0.10	not installed
                           sip-4.13.2.p0	not installed
                          trac-0.11.5.p0	not installed
                       valgrind-3.8.1.p0	not installed
                         zeromq-3.2.0.p0	not installed

Type 'sage -i package_name' to download and install a package.
```


Or maybe with the package names aligned to the left with dots to the right column?


---

Comment by leif created at 2014-04-19 17:35:53

Replying to [comment:9 leif]:
> Or maybe with the package names aligned to the left with dots to the right column?

Like this (which I prefer):

```
$ ./sage --optional
Using Sage Server http://www.sagemath.org/packages

Optional packages:

4ti2-1.6 ................................ not installed
PyQt_x11-4.9.1.p0 ....................... not installed
TOPCOM-0.17.4 ........................... not installed
autotools-20121217 ...................... not installed
beautifulsoup-3.2.1 ..................... not installed
benzene-20130630 ........................ not installed
biopython-1.61 .......................... not installed
brian-1.4.1.p0 .......................... not installed
buckygen-1.0.p1 ......................... not installed
cbc-2.8.1.p0 ............................ not installed
ccache-3.1.9 ............................ not installed
chomp-20130518.p1 ....................... not installed
cluster_seed-1.0 ........................ not installed
coxeter3-1.1 ............................ not installed
cryptominisat-2.9.6 ..................... not installed
cunningham_tables-1.0 ................... not installed
database_cremona_ellcurve-20121022 ...... not installed
database_gap-4.6.4 ...................... installed version: 4.7.4
database_jones_numfield-v4 .............. not installed
database_kohel-20060803 ................. not installed
database_odlyzko_zeta ................... not installed
database_pari-20130516 .................. not installed
database_stein_watkins_mini.p0 .......... not installed
database_symbolic_data-20070206 ......... not installed
dot2tex-2.8.7.p2 ........................ not installed
extra_docs-20070208 ..................... not installed
gap_packages-4.6.4.p1 ................... installed version: 4.7.4
gcc-4.6.4 ............................... not installed
gdbm-1.8.3 .............................. not installed
ginv-1.9-20080723 ....................... not installed
git-1.7.12.2.p0 ......................... installed version: 1.8.4.4
gnuplotpy-1.8 ........................... not installed
guppy-0.1.8 ............................. not installed
java3d-20070901 ......................... not installed
kash3-2008-07-31.p0 ..................... already installed
knoboo-20080411 ......................... not installed
libogg-1.1.4 ............................ not installed
libtheora-1.1.1 ......................... not installed
lie-2.2.2.p5 ............................ not installed
lrs-4.2b.p1 ............................. not installed
mpi4py-1.2.2 ............................ not installed
nauty-25 ................................ not installed
normaliz-2.8.p0 ......................... not installed
nose-1.1.2 .............................. not installed
nzmath-1.1.0 ............................ not installed
openmpi-1.4.3 ........................... not installed
p_group_cohomology-2.1.4.p1 ............. not installed
patchbot-2.0.1 .......................... not installed
phc-2.3.65.p0 ........................... not installed
pybtex-20120618 ......................... not installed
pycryptoplus-20100809-git ............... not installed
pyopenssl-0.13.p0 ....................... not installed
pyx-0.10 ................................ not installed
pyzmq-2.1.11.p1 ......................... not installed
qhull-2010.1 ............................ not installed
sage_mode-0.10 .......................... not installed
sip-4.13.2.p0 ........................... not installed
trac-0.11.5.p0 .......................... not installed
valgrind-3.8.1.p0 ....................... not installed
zeromq-3.2.0.p0 ......................... not installed

Type 'sage -i package_name' to download and install a package.
```



---

Comment by leif created at 2014-04-19 21:39:32

Changing keywords from "" to "--optional --experimental SAGE_SERVER".


---

Comment by leif created at 2014-04-19 21:39:32

... going with the latter.

If you're ok with my changes, just set the ticket to positive review.  (The implementation is perhaps suboptimal, but the output is fancy! ;-) )
----
New commits:


---

Comment by vbraun created at 2014-04-19 22:43:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-04-19 22:43:49

There is no need to mention the ticket number in the commit message FYI. Of course you can write anything, but in general there is no guarantee that the ticket number in the commit ends up being the ticket number that merges said commit.


---

Comment by leif created at 2014-04-20 00:44:06

Minor issue:

In case one has multiple versions of an spkg "installed", the version shown is rather random (but still _one_ of those listed in `$SAGE_ROOT/local/var/lib/sage/installed/`).

AFAIK we never delete files there, unless the installation of a _specific version_ failed, so older or previously installed versions "accumulate".

(_Moments later:_) ... Oh, that's quite new (in `sage-spkg`):

```sh
##################################################################
# Remove install markers for any other versions of this spkg.
##################################################################

rm -f "$SAGE_SPKG_INST/$PKG_BASE-"*
```


(I tested by _faking_ the installation of other versions of some packages, so at least `sage-list-packages` doesn't bail out if `.../installed/` got messed up.  And the above doesn't work for packages without a [proper] version, i.e., lacking the dash.)


---

Comment by vdelecroix created at 2014-04-20 08:41:26

Hello,

It is much better now! Some comments about the output (I did not read carefully the code for getting the values).

- Trailing whitespaces line 19 and 76.
- I would prefer use .format as it is cleaner, i.e. replace line 76 with
   {{{
   print "{:.<40}{}".format(fullname, status)
   }}}
- To be Python 3 compatible, it would be nice to replace `print X` with `print(X)` and `raise Error, "Message"` with `raise Error("Message")`.


---

Comment by leif created at 2014-04-20 11:22:37

Replying to [comment:16 vdelecroix]:
> - I would prefer use .format as it is cleaner, i.e. replace line 76 with
>    {{{
>    print "{:.<40}{}".format(fullname, status)
>    }}}

That's not Python3-compatible. B)


---

Comment by vbraun created at 2014-04-20 16:43:57

Resolution: fixed
