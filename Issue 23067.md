# Issue 23067: hold=True does not always prevent evaluation

archive/issues_023067.json:
```json
{
    "body": "CC:  @davewittemorris @slel\n\n\n```\nsage: x = SR.var(x)\nsage: x + 1/3\nx + 1/3\nsage: (x + 1/3).power(2, hold=True)\n(x + 1/3)^2\nsage: (x + 1/3).power(2, hold=True).mul(2, hold=True) # <<< evaluates!\n2*(1/9*(3*x + 1)^2)\nsage: (x + 1/3).mul(2, hold=True)\n2*(x + 1/3)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23304\n\n",
    "created_at": "2017-06-22T12:12:49Z",
    "labels": [
        "component: symbolics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "hold=True does not always prevent evaluation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23067",
    "user": "https://github.com/mezzarobba"
}
```
CC:  @davewittemorris @slel


```
sage: x = SR.var(x)
sage: x + 1/3
x + 1/3
sage: (x + 1/3).power(2, hold=True)
(x + 1/3)^2
sage: (x + 1/3).power(2, hold=True).mul(2, hold=True) # <<< evaluates!
2*(1/9*(3*x + 1)^2)
sage: (x + 1/3).mul(2, hold=True)
2*(x + 1/3)
```


Issue created by migration from https://trac.sagemath.org/ticket/23304





---

archive/issue_comments_322133.json:
```json
{
    "body": "See also #21754 and #21758.",
    "created_at": "2017-07-01T06:31:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322133",
    "user": "https://github.com/rwst"
}
```

See also #21754 and #21758.



---

archive/issue_comments_322134.json:
```json
{
    "body": "Operations like this are now better done in a hold context. With #10035:\n\n```\nsage: hold.start()\nsage: x + 1/3\nx + 1/3\nsage: (x + 1/3)^2\n(x + 1/3)^2\nsage: (x + 1/3)^2*2\n2*(x + 1/3)^2\nsage: (x + 1/3)*2\n2*(x + 1/3)\n```\n",
    "created_at": "2017-09-03T07:52:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322134",
    "user": "https://github.com/rwst"
}
```

Operations like this are now better done in a hold context. With #10035:

```
sage: hold.start()
sage: x + 1/3
x + 1/3
sage: (x + 1/3)^2
(x + 1/3)^2
sage: (x + 1/3)^2*2
2*(x + 1/3)^2
sage: (x + 1/3)*2
2*(x + 1/3)
```




---

archive/issue_comments_322135.json:
```json
{
    "body": "The upstream fix in Pynac was merged in Pynac 0.7.11.\n\nThe upgrade to Pynac 0.7.11 was done in #23820, merged in Sage 8.1.beta6.\n\nIn the present ticket we should add a doctest.",
    "created_at": "2020-09-17T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322135",
    "user": "https://github.com/slel"
}
```

The upstream fix in Pynac was merged in Pynac 0.7.11.

The upgrade to Pynac 0.7.11 was done in #23820, merged in Sage 8.1.beta6.

In the present ticket we should add a doctest.



---

archive/issue_comments_322136.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322136",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_322137.json:
```json
{
    "body": "here is a doctest\n----\nNew commits:",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322137",
    "user": "https://github.com/fchapoton"
}
```

here is a doctest
----
New commits:



---

archive/issue_comments_322138.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-02-14T19:50:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322138",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_322139.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2022-02-15T02:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322139",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_322140.json:
```json
{
    "body": "I think that using `hold=true` should give the same result as using a hold context:\n\n```\nsage: with hold:\n....:     (x + 1/3).power(2).mul(2)\n2*(x + 1/3)^2\n```\n\nBut the proposed doctest validates `2*(1/9*(3*x + 1)^2)`, so I don't think we want this doctest.\n\nGinac (and therefore pynac) was not designed with \"hold\" in mind (see also #31597), so I think it will take considerable effort to fix the many problems, but fixing the specific problem on this ticket might not be hard.  I might have time to work on these issues in the next few months, but it's great if someone else wants to do it.\n\nOne possibility would be to have two tickets: one ticket to add a doctest for the hold context right now (because it already gives a good answer), and another ticket (which will remain open) for fixing `hold = true`.",
    "created_at": "2022-02-15T02:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23067",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23067#issuecomment-322140",
    "user": "https://github.com/DaveWitteMorris"
}
```

I think that using `hold=true` should give the same result as using a hold context:

```
sage: with hold:
....:     (x + 1/3).power(2).mul(2)
2*(x + 1/3)^2
```

But the proposed doctest validates `2*(1/9*(3*x + 1)^2)`, so I don't think we want this doctest.

Ginac (and therefore pynac) was not designed with "hold" in mind (see also #31597), so I think it will take considerable effort to fix the many problems, but fixing the specific problem on this ticket might not be hard.  I might have time to work on these issues in the next few months, but it's great if someone else wants to do it.

One possibility would be to have two tickets: one ticket to add a doctest for the hold context right now (because it already gives a good answer), and another ticket (which will remain open) for fixing `hold = true`.
