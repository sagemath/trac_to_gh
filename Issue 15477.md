# Issue 15477: generalize BinaryRecurrenceSequence

archive/issues_015477.json:
```json
{
    "body": "Assignee: rws\n\nCC:  burcin mmezzarobba vivianepons\n\nKeywords: recurrence ogf\n\nThe name for the next more general mathematical object is *linear homogenous recurrence with constant coefficients*, and there are mappings to and from polynomial fractions (the latter generate the former). I am not sure about the best object name, however. Working title: Linrec.\n\nDefinition of linrec: degree n, coefficients c_0...c_(n-1), start values a_0...a_(n-1), satisfying 0 = c_0a_0 + ... + c_(n-1)a_(n-1).\n\nIssue created by migration from https://trac.sagemath.org/ticket/15714\n\n",
    "created_at": "2014-01-23T10:56:52Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "generalize BinaryRecurrenceSequence",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15477",
    "user": "rws"
}
```
Assignee: rws

CC:  burcin mmezzarobba vivianepons

Keywords: recurrence ogf

The name for the next more general mathematical object is *linear homogenous recurrence with constant coefficients*, and there are mappings to and from polynomial fractions (the latter generate the former). I am not sure about the best object name, however. Working title: Linrec.

Definition of linrec: degree n, coefficients c_0...c_(n-1), start values a_0...a_(n-1), satisfying 0 = c_0a_0 + ... + c_(n-1)a_(n-1).

Issue created by migration from https://trac.sagemath.org/ticket/15714





---

archive/issue_comments_199940.json:
```json
{
    "body": "Please comment on the interface/documentation\n----\nNew commits:",
    "created_at": "2014-01-24T11:37:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199940",
    "user": "rws"
}
```

Please comment on the interface/documentation
----
New commits:



---

archive/issue_comments_199941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-26T18:27:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199941",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199942.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-27T18:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199942",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199943.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-28T17:38:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199943",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-30T07:31:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199944",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199945.json:
```json
{
    "body": "Changing keywords from \"recurrence ogf\" to \"recurrence, sequence, ogf\".",
    "created_at": "2014-01-30T07:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199945",
    "user": "rws"
}
```

Changing keywords from "recurrence ogf" to "recurrence, sequence, ogf".



---

archive/issue_comments_199946.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-01-30T07:41:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199946",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_199947.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-02-04T15:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199947",
    "user": "mmezzarobba"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199948.json:
```json
{
    "body": "Some more comments:\n* Your code is apparently limited to sequences with integer or rational coefficients. IMHO it would be best to handle C-finite sequences over arbitrary rings (or perhaps integral domains?). If you don't want to do that, the scope of the code should be clearly documented and there should be a few checks in suitable places<sup>[1]</sup>.\n* How about making CFiniteSequences Elements of a proper Parent? Sure, it is not absolutely essential at this point, but that's something we will certainly want in the long run\u2014C-finite sequences [over a given ring] form a ring!\u2014, and designing a suitable interface from the start would save the trouble of deprecating the current one later on!\n* If you do implement a \"ring of C-Finite sequences over ...\", I'd suggest moving it outside of combinat (perhaps to a new package `sage.rings.sequences`?).\n\n[1] Currently, the following examples all behave differently:\n\n```\nsage: R.<x> = RR[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]\n55\nsage: R.<x> = GF(3)[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]\n...\nValueError: Cannot convert to CFiniteSequence.\nsage: R.<x> = CC[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]\n...\nTypeError: Unable to coerce 0.000000000000000 (<type 'sage.rings.complex_number.ComplexNumber'>) to Rational\n```\n\nTheir behaviour is not entirely unreasonable, but it only makes sense if you know that `CFiniteSequence` is going to try converting the input to a rational fraction over `QQ`.",
    "created_at": "2014-02-04T15:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199948",
    "user": "mmezzarobba"
}
```

Some more comments:
* Your code is apparently limited to sequences with integer or rational coefficients. IMHO it would be best to handle C-finite sequences over arbitrary rings (or perhaps integral domains?). If you don't want to do that, the scope of the code should be clearly documented and there should be a few checks in suitable places<sup>[1]</sup>.
* How about making CFiniteSequences Elements of a proper Parent? Sure, it is not absolutely essential at this point, but that's something we will certainly want in the long run—C-finite sequences [over a given ring] form a ring!—, and designing a suitable interface from the start would save the trouble of deprecating the current one later on!
* If you do implement a "ring of C-Finite sequences over ...", I'd suggest moving it outside of combinat (perhaps to a new package `sage.rings.sequences`?).

[1] Currently, the following examples all behave differently:

```
sage: R.<x> = RR[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]
55
sage: R.<x> = GF(3)[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]
...
ValueError: Cannot convert to CFiniteSequence.
sage: R.<x> = CC[]; fibo = CFiniteSequence(x/(1-x-x^2)); fibo[10]
...
TypeError: Unable to coerce 0.000000000000000 (<type 'sage.rings.complex_number.ComplexNumber'>) to Rational
```

Their behaviour is not entirely unreasonable, but it only makes sense if you know that `CFiniteSequence` is going to try converting the input to a rational fraction over `QQ`.



---

archive/issue_comments_199949.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-03-14T10:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199949",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199950.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-03-14T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199950",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199951.json:
```json
{
    "body": "I refrained from creating a specific parent, as the ring is isomorphic to Laurent polynomial fractions. I specifically allowed `ZZ` and `QQ`. So C-finite sequences return their parent as `Fraction Field of Univariate Polynomial Ring in x over Rational Field`.\n\nTwo guessing algorithms are implemented, Berlekamp-Massey and LLL (faster,default).\n\nAn improvement in clarity could be to replace the internal implementation via vanilla polyniomals by Laurent polyniomals (#11726).\n\nI think the math is pretty standard, though I know of no paper about the isomorphism. If I knew algebra better I would write a paper.",
    "created_at": "2014-03-14T10:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199951",
    "user": "rws"
}
```

I refrained from creating a specific parent, as the ring is isomorphic to Laurent polynomial fractions. I specifically allowed `ZZ` and `QQ`. So C-finite sequences return their parent as `Fraction Field of Univariate Polynomial Ring in x over Rational Field`.

Two guessing algorithms are implemented, Berlekamp-Massey and LLL (faster,default).

An improvement in clarity could be to replace the internal implementation via vanilla polyniomals by Laurent polyniomals (#11726).

I think the math is pretty standard, though I know of no paper about the isomorphism. If I knew algebra better I would write a paper.



---

archive/issue_comments_199952.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-12T06:26:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199952",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-31T07:35:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199954.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-31T07:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199954",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199955.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-10T10:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199955",
    "user": "rws"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_199956.json:
```json
{
    "body": "The recent move to abandon pexpect demands that the pari script in this patch should be replaced by code using libpari.",
    "created_at": "2014-06-10T10:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199956",
    "user": "rws"
}
```

The recent move to abandon pexpect demands that the pari script in this patch should be replaced by code using libpari.



---

archive/issue_comments_199957.json:
```json
{
    "body": "That demand should not hold up the ticket.",
    "created_at": "2014-07-28T16:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199957",
    "user": "rws"
}
```

That demand should not hold up the ticket.



---

archive/issue_comments_199958.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-07-28T16:03:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199958",
    "user": "rws"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_199959.json:
```json
{
    "body": "I have had a look and corrected a few little things. Now pep8 compliant.\n----\nNew commits:",
    "created_at": "2014-11-18T21:39:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199959",
    "user": "chapoton"
}
```

I have had a look and corrected a few little things. Now pep8 compliant.
----
New commits:



---

archive/issue_comments_199960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-18T21:41:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-19T09:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199962.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric, you seem to have had a good look at the code, why not do a review?",
    "created_at": "2014-12-11T07:57:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199962",
    "user": "rws"
}
```

Frédéric, you seem to have had a good look at the code, why not do a review?



---

archive/issue_comments_199963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-10T17:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199964.json:
```json
{
    "body": "Replying to [comment:15 rws]:\n> I refrained from creating a specific parent, as the ring is isomorphic to Laurent polynomial fractions. I specifically allowed `ZZ` and `QQ`. So C-finite sequences return their parent as `Fraction Field of Univariate Polynomial Ring in x over Rational Field`.\n\nI haven't looked at the new code, but I really doubt that this is a good idea: do you really want, say, the sum of a CFiniteSequence and an integer to return a rational function?!",
    "created_at": "2015-02-05T14:58:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199964",
    "user": "mmezzarobba"
}
```

Replying to [comment:15 rws]:
> I refrained from creating a specific parent, as the ring is isomorphic to Laurent polynomial fractions. I specifically allowed `ZZ` and `QQ`. So C-finite sequences return their parent as `Fraction Field of Univariate Polynomial Ring in x over Rational Field`.

I haven't looked at the new code, but I really doubt that this is a good idea: do you really want, say, the sum of a CFiniteSequence and an integer to return a rational function?!



---

archive/issue_comments_199965.json:
```json
{
    "body": "Replying to [comment:30 mmezzarobba]:\n> I haven't looked at the new code, but I really doubt that this is a good idea: do you really want, say, the sum of a CFiniteSequence and an integer to return a rational function?!\nNowhere is a function returned. The type remains a polynomial fraction.",
    "created_at": "2015-02-05T15:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199965",
    "user": "rws"
}
```

Replying to [comment:30 mmezzarobba]:
> I haven't looked at the new code, but I really doubt that this is a good idea: do you really want, say, the sum of a CFiniteSequence and an integer to return a rational function?!
Nowhere is a function returned. The type remains a polynomial fraction.



---

archive/issue_comments_199966.json:
```json
{
    "body": "Replying to [comment:31 rws]:\n> Nowhere is a function returned. The type remains a polynomial fraction.\n\nYes, that's what I mean by rational function.",
    "created_at": "2015-02-05T15:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199966",
    "user": "mmezzarobba"
}
```

Replying to [comment:31 rws]:
> Nowhere is a function returned. The type remains a polynomial fraction.

Yes, that's what I mean by rational function.



---

archive/issue_comments_199967.json:
```json
{
    "body": "Please compare:\n\n```\nsage: fr = (x/(1+x)).fraction(QQ)\nsage: 1+fr\n(2*x + 1)/(x + 1)\nsage: type(_)\n<class 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field'>\nsage: fr+1\n(2*x + 1)/(x + 1)\nsage: type(_)\n<class 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field'>\n```\n\nversus\n\n```\nsage: R.<x> = PolynomialRing(QQ, 'x')\nsage: s = CFiniteSequence(x/(1+x))\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/cfinite_sequence.py:212: DeprecationWarning: This method is deprecated.\nSee http://trac.sagemath.org/16201 for details.\n  R.set_default_prec(alen)\nsage: s\nC-finite sequence, generated by x/(x + 1)\nsage: 1+s\n(2*x + 1)/(x + 1)\nsage: s+1\nC-finite sequence, generated by (2*x + 1)/(x + 1)\nsage: CFiniteSequence(1)+s\nC-finite sequence, generated by (2*x + 1)/(x + 1)\n```\n\nWhat do yu think is wrong there? (Will fix the deprecation warning)",
    "created_at": "2015-02-05T15:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199967",
    "user": "rws"
}
```

Please compare:

```
sage: fr = (x/(1+x)).fraction(QQ)
sage: 1+fr
(2*x + 1)/(x + 1)
sage: type(_)
<class 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field'>
sage: fr+1
(2*x + 1)/(x + 1)
sage: type(_)
<class 'sage.rings.fraction_field_element.FractionFieldElement_1poly_field'>
```

versus

```
sage: R.<x> = PolynomialRing(QQ, 'x')
sage: s = CFiniteSequence(x/(1+x))
/home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/cfinite_sequence.py:212: DeprecationWarning: This method is deprecated.
See http://trac.sagemath.org/16201 for details.
  R.set_default_prec(alen)
sage: s
C-finite sequence, generated by x/(x + 1)
sage: 1+s
(2*x + 1)/(x + 1)
sage: s+1
C-finite sequence, generated by (2*x + 1)/(x + 1)
sage: CFiniteSequence(1)+s
C-finite sequence, generated by (2*x + 1)/(x + 1)
```

What do yu think is wrong there? (Will fix the deprecation warning)



---

archive/issue_comments_199968.json:
```json
{
    "body": "Replying to [comment:33 rws]:\n> {{{\n> sage: R.<x> = PolynomialRing(QQ, 'x')\n> sage: s = CFiniteSequence(x/(1+x))\n> /home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/cfinite_sequence.py:212: DeprecationWarning: This method is deprecated.\n> See http://trac.sagemath.org/16201 for details.\n>   R.set_default_prec(alen)\n> sage: s\n> C-finite sequence, generated by x/(x + 1)\n> sage: 1+s\n> (2*x + 1)/(x + 1)\n> sage: s+1\n> C-finite sequence, generated by (2*x + 1)/(x + 1)\n> sage: CFiniteSequence(1)+s\n> C-finite sequence, generated by (2*x + 1)/(x + 1)\n> }}}\n> What do yu think is wrong there? (Will fix the deprecation warning)\n\nI don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order. Moreover, I'd expect that things like `1.0+s` or `s+s'` where `s'` is another type of sequence can be made to work in the long run even if they don't all work yet.",
    "created_at": "2015-02-05T16:13:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199968",
    "user": "mmezzarobba"
}
```

Replying to [comment:33 rws]:
> {{{
> sage: R.<x> = PolynomialRing(QQ, 'x')
> sage: s = CFiniteSequence(x/(1+x))
> /home/ralf/sage/local/lib/python2.7/site-packages/sage/rings/cfinite_sequence.py:212: DeprecationWarning: This method is deprecated.
> See http://trac.sagemath.org/16201 for details.
>   R.set_default_prec(alen)
> sage: s
> C-finite sequence, generated by x/(x + 1)
> sage: 1+s
> (2*x + 1)/(x + 1)
> sage: s+1
> C-finite sequence, generated by (2*x + 1)/(x + 1)
> sage: CFiniteSequence(1)+s
> C-finite sequence, generated by (2*x + 1)/(x + 1)
> }}}
> What do yu think is wrong there? (Will fix the deprecation warning)

I don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order. Moreover, I'd expect that things like `1.0+s` or `s+s'` where `s'` is another type of sequence can be made to work in the long run even if they don't all work yet.



---

archive/issue_comments_199969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-02-05T16:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199969",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199970.json:
```json
{
    "body": "Replying to [comment:34 mmezzarobba]:\n> I don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order.\nTell you what: I'm working incrementally. I won't add the feature unless you review what is already there.",
    "created_at": "2015-02-05T16:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199970",
    "user": "rws"
}
```

Replying to [comment:34 mmezzarobba]:
> I don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order.
Tell you what: I'm working incrementally. I won't add the feature unless you review what is already there.



---

archive/issue_comments_199971.json:
```json
{
    "body": "Replying to [comment:36 rws]:\n> Replying to [comment:34 mmezzarobba]:\n> > I don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order.\n> Tell you what: I'm working incrementally. I won't add the feature unless you review what is already there.\n\nI'm not interested in just reviewing what is already there because I don't feel able to judge whether it's a step towards a proper solution or in the wrong direction. I would be interested in implementing the parent myself (and review your commits along the way) if I have time--but that's a big if, unfortunately.",
    "created_at": "2015-02-05T16:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199971",
    "user": "mmezzarobba"
}
```

Replying to [comment:36 rws]:
> Replying to [comment:34 mmezzarobba]:
> > I don't think that's how sage objects are supposed to behave! I'd expect the result of `1+s` not do depend on the order.
> Tell you what: I'm working incrementally. I won't add the feature unless you review what is already there.

I'm not interested in just reviewing what is already there because I don't feel able to judge whether it's a step towards a proper solution or in the wrong direction. I would be interested in implementing the parent myself (and review your commits along the way) if I have time--but that's a big if, unfortunately.



---

archive/issue_comments_199972.json:
```json
{
    "body": "Replying to [comment:37 mmezzarobba]:\n>I would be interested in implementing the parent myself...\nYou have my support for that.",
    "created_at": "2015-02-05T16:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199972",
    "user": "rws"
}
```

Replying to [comment:37 mmezzarobba]:
>I would be interested in implementing the parent myself...
You have my support for that.



---

archive/issue_comments_199973.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-03-22T15:24:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199973",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199974.json:
```json
{
    "body": "Hi,\n\nI just came across this code and I'm willing to review/fix whatever is left cause I would really like to see that into Sage! \n\nI do agree with the comments on the parent. I find it really weird that the parent is the fraction field. Look at this:\n\n\n\n```\nsage: R.<x> = QQ[]\nsage: fibo = CFiniteSequence(x/(1-x-x^2))\nsage: f = x/(1-x-x^2)\nsage: f == fibo\nTrue\nsage: fibo == f\nTraceback (most recent call last):\n...\nAttributeError: 'FractionFieldElement_1poly_field' object has no attribute 'ogf'\n```\n\n\nActually, do we really need the CFiniteSequence to extend FractionFieldElement? What method do we use from FractionFieldElement? It seems to me that even if a sequence is represented by a fraction, they are two complete different objects.",
    "created_at": "2015-06-01T22:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199974",
    "user": "VivianePons"
}
```

Hi,

I just came across this code and I'm willing to review/fix whatever is left cause I would really like to see that into Sage! 

I do agree with the comments on the parent. I find it really weird that the parent is the fraction field. Look at this:



```
sage: R.<x> = QQ[]
sage: fibo = CFiniteSequence(x/(1-x-x^2))
sage: f = x/(1-x-x^2)
sage: f == fibo
True
sage: fibo == f
Traceback (most recent call last):
...
AttributeError: 'FractionFieldElement_1poly_field' object has no attribute 'ogf'
```


Actually, do we really need the CFiniteSequence to extend FractionFieldElement? What method do we use from FractionFieldElement? It seems to me that even if a sequence is represented by a fraction, they are two complete different objects.



---

archive/issue_comments_199975.json:
```json
{
    "body": "You're welcome. This was my early attempt at parenting Sage objects, so there is no particular reason for any oddities. Meanwhile I found that the `guess` algorithm `\"sage\"` is less general than `\"pari\"` so you might want to change the default, too. I'll gladly review any additions you make.",
    "created_at": "2015-06-02T07:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199975",
    "user": "rws"
}
```

You're welcome. This was my early attempt at parenting Sage objects, so there is no particular reason for any oddities. Meanwhile I found that the `guess` algorithm `"sage"` is less general than `"pari"` so you might want to change the default, too. I'll gladly review any additions you make.



---

archive/issue_comments_199976.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T22:11:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199976",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199977.json:
```json
{
    "body": "I have changed the architecture so that C-Finite Sequences are no longer sub classes of fraction field elements. Instead, they just store the ogf and belong to their own ring with a proper parent and everything.\n\nI think the new implementation is much cleaner and it's addressing the issues that had been raised before: the behavior and coercions are much more consistent.\n\nAlso, it actually makes things easy for the user as you can write directly\n\n\n\n```\nsage: CFiniteSequence(1+x)\nFinite sequence [1, 1], offset = 0\n```\n\n\neven if `x` is a symbolic variable, it gets transformed into a proper fraction field element and the result still has the right parent and everything.\n\nSomeone can start reviewing my changes, rws I guess and also mmezzarobba (or whoever wants to look at it). \n\nI still haven't recompiled the doc but I will do shortly.",
    "created_at": "2015-06-05T22:19:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199977",
    "user": "VivianePons"
}
```

I have changed the architecture so that C-Finite Sequences are no longer sub classes of fraction field elements. Instead, they just store the ogf and belong to their own ring with a proper parent and everything.

I think the new implementation is much cleaner and it's addressing the issues that had been raised before: the behavior and coercions are much more consistent.

Also, it actually makes things easy for the user as you can write directly



```
sage: CFiniteSequence(1+x)
Finite sequence [1, 1], offset = 0
```


even if `x` is a symbolic variable, it gets transformed into a proper fraction field element and the result still has the right parent and everything.

Someone can start reviewing my changes, rws I guess and also mmezzarobba (or whoever wants to look at it). 

I still haven't recompiled the doc but I will do shortly.



---

archive/issue_comments_199978.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-05T23:21:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199978",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199979.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-06T07:09:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199979",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199980.json:
```json
{
    "body": "Nice work! I think this is fine. So someone just needs to look over this last commit, where I fixed the default guessing method. Also, since you while adapting the original code also reviewed it, you should insert your name in the Reviewers field.\n\nHaving this finally in mainstream Sage would motivate me to complete the already existing code for automated closed form output.",
    "created_at": "2015-06-06T07:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199980",
    "user": "rws"
}
```

Nice work! I think this is fine. So someone just needs to look over this last commit, where I fixed the default guessing method. Also, since you while adapting the original code also reviewed it, you should insert your name in the Reviewers field.

Having this finally in mainstream Sage would motivate me to complete the already existing code for automated closed form output.



---

archive/issue_comments_199981.json:
```json
{
    "body": "Luca should be Lucas, I think.\n\nI have also noted some alignement problems at the beginning of\n`class CFiniteSequence(FieldElement)`",
    "created_at": "2015-06-06T07:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199981",
    "user": "chapoton"
}
```

Luca should be Lucas, I think.

I have also noted some alignement problems at the beginning of
`class CFiniteSequence(FieldElement)`



---

archive/issue_comments_199982.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-06T07:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199982",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199983.json:
```json
{
    "body": "please use `....:` for doctest continuation (see patchbot report)",
    "created_at": "2015-06-06T16:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199983",
    "user": "chapoton"
}
```

please use `....:` for doctest continuation (see patchbot report)



---

archive/issue_comments_199984.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-07T06:12:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199984",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199985.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-09T16:16:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199985",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_199986.json:
```json
{
    "body": "I've recompiled the doc and tests and everything seems fine now. The problems reported by Chapoton have been fixed. From my point of view, this is all good. Maybe someone else could give green flag? Anyway, if nobody complains in the near future, I'll move this to positive review.",
    "created_at": "2015-06-09T16:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199986",
    "user": "VivianePons"
}
```

I've recompiled the doc and tests and everything seems fine now. The problems reported by Chapoton have been fixed. From my point of view, this is all good. Maybe someone else could give green flag? Anyway, if nobody complains in the near future, I'll move this to positive review.



---

archive/issue_comments_199987.json:
```json
{
    "body": "As you are positive, and your own last commit is fine, and a recent patchbot run passed, I'll set positive myself. Please add yourself to the reviewers, too. Marc?",
    "created_at": "2015-06-09T16:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199987",
    "user": "rws"
}
```

As you are positive, and your own last commit is fine, and a recent patchbot run passed, I'll set positive myself. Please add yourself to the reviewers, too. Marc?



---

archive/issue_comments_199988.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-09T16:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199988",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_199989.json:
```json
{
    "body": "Replying to [comment:53 rws]:\n> As you are positive, and your own last commit is fine, and a recent patchbot run passed, I'll set positive myself. Please add yourself to the reviewers, too. Marc?\n\nSorry, I don't have time to have a look now. But if you both are happy with the current code, I guess all is fine!",
    "created_at": "2015-06-09T16:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199989",
    "user": "mmezzarobba"
}
```

Replying to [comment:53 rws]:
> As you are positive, and your own last commit is fine, and a recent patchbot run passed, I'll set positive myself. Please add yourself to the reviewers, too. Marc?

Sorry, I don't have time to have a look now. But if you both are happy with the current code, I guess all is fine!



---

archive/issue_comments_199990.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-11T13:51:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15477",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15477#issuecomment-199990",
    "user": "vbraun"
}
```

Resolution: fixed
