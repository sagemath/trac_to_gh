# Issue 16112: Make UniqueFactory unpickling more flexible

Issue created by migration from Trac.

Original creator: tscrim

Original creation time: 2014-05-13 15:42:28

Assignee: tscrim

CC:  simonking nthiery

Keywords: UniqueFactory pickle

Currently `UniqueFactory`'s unpickling protocol is to call `generic_factory_unpickle()`, whose first argument _must_ be an instance of `UniqueFactory`. However we might want to change the object in the global namespace, let's say to a function, and then we will not be able to unpickle any  thing beforehand (`register_unpickle_override` can not help here because the pickle info is `(UniqueFactory`, `generic_factory_unpickle)`). Came up in #15289.


---

Comment by SimonKing created at 2014-05-14 11:34:33

Travis, you have been inserted as "Author", but I think you did not provide code. So, I took the liberty to replace your name by mine, and attach a branch. The new doctest demonstrates how to replace a unique factory by unique representation and correctly unpickle.
----
New commits:


---

Comment by SimonKing created at 2014-05-14 11:34:33

Changing status from new to needs_review.


---

Comment by git created at 2014-05-14 12:46:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by SimonKing created at 2014-05-14 12:47:14

I had to fix one detail (I made a wrong assumption on the format of `_factory_data`.


---

Comment by tscrim created at 2014-05-14 16:08:51

Hey Simon, I didn't have a chance to finish it yesterday. I will finish up what I was working on today as an alternative proposal.


---

Comment by tscrim created at 2014-05-15 16:19:22

Okay I've just put in both versions. I've implemented something similar to `register_unpickle_override()` (which I've called `register_factory_unpickle()`). This way we can handle when the factory is removed from the global namespace (such as for name change). If you could check that and agree, then we can set this to positive review. Thanks.
----
New commits:


---

Comment by SimonKing created at 2014-05-16 09:39:00

With the current branch, we provide two ways to deal with old pickles of `UniqueFactory`: If we replace the old factory by something new that has the same name, is in the same module and can process the same input as the `UniqueFactory`, then nothing more needs to be done (that's my contribution). Moreover, it is possible to override unpickling so that a new callable is used for unpickling _even if the old factory is still there_ (that's your contribution). I think both possibilities make sense. Hence, I complete the positive review.


---

Comment by SimonKing created at 2014-05-16 09:39:00

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2014-05-16 14:35:29

Thank you Simon.


---

Comment by vbraun created at 2014-05-19 12:53:23

Resolution: fixed
