# Issue 19781: init for endomorphism of projective subschemes fails

Issue created by migration from Trac.

Original creator: bhutz

Original creation time: 2016-02-05 22:47:00

Assignee: bhutz

The following example does not work


```
sage: R.<t>=PolynomialRing(QQ)
sage: P.<x,y,z> = ProjectiveSpace(R,2)
sage: X = P.subscheme(x^2-y^2)
sage: H = Hom(X,X)
sage: f = H([x^2,y^2,x*z])
```


but does work in affine space. It seems that the check in init is not quite doing the right thing.


---

Comment by bhutz created at 2016-02-09 22:53:06

Since I didn't get any input from the sage-devel thread I went ahead an implemented one possible correction to these issues. At this stage I welcome comments on the solution.

The key points are as follows

- the actual coordinates of the map remain in the coordinate ring of the ambient space (i.e., this is unchanged)

- if you initialize the map with variables from the coordinate ring of the ambient space, they are not reduced modulo the defining ideal of the subscheme (new behavior)

- if you initialize the map with variables from the coordinate ring of the subscheme, they are in the quotient, so are reduced. (unchanged)

This allows initialization to work in more situations such as for the problem in the description, but also corrects the weird behavior such as:

old behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[0 2]
[0 2]
```


new behavior

```
sage: P.<x,y,z> = ProjectiveSpace(QQ,2)
sage: X=P.subscheme([x^2-y^2])
sage: H = End(X)
sage: f = H([x^2,y^2,z^2])
sage: f.multiplier(X([1,1]),1)
[2 0]
[0 2]
```


One consequence is the projective_embedding functionality in toric variety seems to be programmed to expect the reduction. Consequently, I've had the creation code use the quotient ring variables, so that behavior matches the current doctests.

In a couple places in elliptic_curve/jacobian.py the morphism returned is now in a slightly different form. This did not seem to big a difference, so I just updated those doctests.


---

Comment by bhutz created at 2016-02-09 22:53:06

Changing status from new to needs_review.


---

Comment by git created at 2016-02-10 02:11:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-16 17:50:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-02-26 01:50:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by atowsley created at 2016-02-26 17:30:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-02-26 21:28:26

Reviewer name is missing


---

Comment by vbraun created at 2016-02-26 21:28:26

Changing status from positive_review to needs_work.


---

Comment by atowsley created at 2016-02-26 21:37:24

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-02-28 00:52:33

Resolution: fixed
