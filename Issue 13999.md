# Issue 13999: Move DOCTEST_MODE to doctesting framework

archive/issues_013999.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @jhpalmieri\n\nMove the `DOCTEST_MODE` setting to the doctesting framework, for example in the file `sage/doctest/all.py`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/14203\n\n",
    "created_at": "2013-02-28T09:41:24Z",
    "labels": [
        "doctest",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.10",
    "title": "Move DOCTEST_MODE to doctesting framework",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13999",
    "user": "@jdemeyer"
}
```
Assignee: mvngu

CC:  @jhpalmieri

Move the `DOCTEST_MODE` setting to the doctesting framework, for example in the file `sage/doctest/all.py`.

Issue created by migration from https://trac.sagemath.org/ticket/14203





---

archive/issue_comments_174780.json:
```json
{
    "body": "This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?\n\nAt some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.",
    "created_at": "2013-03-01T04:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174780",
    "user": "@jhpalmieri"
}
```

This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?

At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.



---

archive/issue_comments_174781.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?\n\nWe need a combined `lazy_import`/`deprecate` for this situation.  :-)\n\n> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.\n\nWhere would `EMBEDDED_MODE` move to?",
    "created_at": "2013-03-14T20:46:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174781",
    "user": "@roed314"
}
```

Replying to [comment:3 jhpalmieri]:
> This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?

We need a combined `lazy_import`/`deprecate` for this situation.  :-)

> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.

Where would `EMBEDDED_MODE` move to?



---

archive/issue_comments_174782.json:
```json
{
    "body": "Replying to [comment:4 roed]:\n> Where would `EMBEDDED_MODE` move to?\n\nMaybe somewhere in sagenb?",
    "created_at": "2013-03-14T20:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174782",
    "user": "@jhpalmieri"
}
```

Replying to [comment:4 roed]:
> Where would `EMBEDDED_MODE` move to?

Maybe somewhere in sagenb?



---

archive/issue_comments_174783.json:
```json
{
    "body": "Replying to [comment:4 roed]:\n> We need a combined `lazy_import`/`deprecate` for this situation.  :-)\n\nI decided to write something: see #14275.",
    "created_at": "2013-03-14T21:37:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174783",
    "user": "@roed314"
}
```

Replying to [comment:4 roed]:
> We need a combined `lazy_import`/`deprecate` for this situation.  :-)

I decided to write something: see #14275.



---

archive/issue_comments_174784.json:
```json
{
    "body": "Replying to [comment:3 jhpalmieri]:\n> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.\nAnd rename `EMBEDDED_MODE` to `HTML_MODE` or something else which describes the usage better.\n\nAnd `EMBEDDED_MODE` is actually independently defined in 6 different modules:\n\n```\ndevel/sagenb/sagenb/misc/support.py\ndevel/sage/sage/misc/pager.py\ndevel/sage/sage/misc/sageinspect.py\ndevel/sage/sage/misc/latex.py\ndevel/sage/sage/plot/plot.py\ndevel/sage/sage/server/support.py\n```\n",
    "created_at": "2013-03-18T16:48:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174784",
    "user": "@jdemeyer"
}
```

Replying to [comment:3 jhpalmieri]:
> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.
And rename `EMBEDDED_MODE` to `HTML_MODE` or something else which describes the usage better.

And `EMBEDDED_MODE` is actually independently defined in 6 different modules:

```
devel/sagenb/sagenb/misc/support.py
devel/sage/sage/misc/pager.py
devel/sage/sage/misc/sageinspect.py
devel/sage/sage/misc/latex.py
devel/sage/sage/plot/plot.py
devel/sage/sage/server/support.py
```




---

archive/issue_comments_174785.json:
```json
{
    "body": "Is `NOTEBOOK_MODE` a good name?\n\nMaybe we should import it from `sagenb.misc.support` for now, and then rename it later. Or we could do this once somewhere in the Sage library:\n\n```python\ntry:\n    from sagenb.misc.support import NOTEBOOK_MODE\nexcept ImportError:\n    from sagenb.misc.support import EMBEDDED_MODE as NOTEBOOK_MODE\n```\n\nThen there can be an independent sagenb patch eventually.",
    "created_at": "2013-03-18T19:09:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174785",
    "user": "@jhpalmieri"
}
```

Is `NOTEBOOK_MODE` a good name?

Maybe we should import it from `sagenb.misc.support` for now, and then rename it later. Or we could do this once somewhere in the Sage library:

```python
try:
    from sagenb.misc.support import NOTEBOOK_MODE
except ImportError:
    from sagenb.misc.support import EMBEDDED_MODE as NOTEBOOK_MODE
```

Then there can be an independent sagenb patch eventually.



---

archive/issue_comments_174786.json:
```json
{
    "body": "Changing assignee from mvngu to @roed314.",
    "created_at": "2013-03-28T22:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174786",
    "user": "@roed314"
}
```

Changing assignee from mvngu to @roed314.



---

archive/issue_comments_174787.json:
```json
{
    "body": "Changing component from doctest to doctest framework.",
    "created_at": "2013-03-28T22:45:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174787",
    "user": "@roed314"
}
```

Changing component from doctest to doctest framework.



---

archive/issue_comments_174788.json:
```json
{
    "body": "Is this ticket ready for review?",
    "created_at": "2013-04-03T08:14:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174788",
    "user": "@jdemeyer"
}
```

Is this ticket ready for review?



---

archive/issue_comments_174789.json:
```json
{
    "body": "Sure, why not?",
    "created_at": "2013-04-03T14:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174789",
    "user": "@jhpalmieri"
}
```

Sure, why not?



---

archive/issue_comments_174790.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-04-03T14:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174790",
    "user": "@jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174791.json:
```json
{
    "body": "initial patch",
    "created_at": "2013-04-03T17:07:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174791",
    "user": "@jhpalmieri"
}
```

initial patch



---

archive/issue_comments_174792.json:
```json
{
    "body": "Attachment [trac_14203_doctest.patch](tarball://root/attachments/some-uuid/ticket14203/trac_14203_doctest.patch) by @jhpalmieri created at 2013-04-03 17:08:03\n\nRebased to 5.9.beta2.",
    "created_at": "2013-04-03T17:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174792",
    "user": "@jhpalmieri"
}
```

Attachment [trac_14203_doctest.patch](tarball://root/attachments/some-uuid/ticket14203/trac_14203_doctest.patch) by @jhpalmieri created at 2013-04-03 17:08:03

Rebased to 5.9.beta2.



---

archive/issue_comments_174793.json:
```json
{
    "body": "Looks good to me!",
    "created_at": "2013-04-20T18:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174793",
    "user": "@vbraun"
}
```

Looks good to me!



---

archive/issue_comments_174794.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-04-20T18:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174794",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174795.json:
```json
{
    "body": "Umm... what about the #14275 situation?  I don't think this would mess things up as much as moving `EMBEDDED_MODE` but perhaps it's still unwise to do without this...",
    "created_at": "2013-04-22T13:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174795",
    "user": "@kcrisman"
}
```

Umm... what about the #14275 situation?  I don't think this would mess things up as much as moving `EMBEDDED_MODE` but perhaps it's still unwise to do without this...



---

archive/issue_comments_174796.json:
```json
{
    "body": "I don't agree with #14275, for starters. It would be a mistake to make any guarantees about the implementation of the doctesting framework. If your code depends on the location of `DOCTEST_MODE` then your code is broken.",
    "created_at": "2013-04-22T13:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174796",
    "user": "@vbraun"
}
```

I don't agree with #14275, for starters. It would be a mistake to make any guarantees about the implementation of the doctesting framework. If your code depends on the location of `DOCTEST_MODE` then your code is broken.



---

archive/issue_comments_174797.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-04-28T10:34:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13999",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13999#issuecomment-174797",
    "user": "@jdemeyer"
}
```

Resolution: fixed
