# Issue 13999: Move DOCTEST_MODE to doctesting framework

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2013-02-28 09:41:24

Assignee: mvngu

CC:  jhpalmieri

Move the `DOCTEST_MODE` setting to the doctesting framework, for example in the file `sage/doctest/all.py`.


---

Comment by jhpalmieri created at 2013-03-01 04:55:40

This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?

At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.


---

Comment by roed created at 2013-03-14 20:46:58

Replying to [comment:3 jhpalmieri]:
> This patch puts `DOCTEST_MODE` in `sage/doctest/__init__.py`. It also removes it entirely from `sage/plot/plot.py`, since it wasn't used there at all. Should we leave it there for backwards compatibility with optional/experimental packages and third party code?

We need a combined `lazy_import`/`deprecate` for this situation.  :-)

> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.

Where would `EMBEDDED_MODE` move to?


---

Comment by jhpalmieri created at 2013-03-14 20:57:13

Replying to [comment:4 roed]:
> Where would `EMBEDDED_MODE` move to?

Maybe somewhere in sagenb?


---

Comment by roed created at 2013-03-14 21:37:55

Replying to [comment:4 roed]:
> We need a combined `lazy_import`/`deprecate` for this situation.  :-)

I decided to write something: see #14275.


---

Comment by jdemeyer created at 2013-03-18 16:48:39

Replying to [comment:3 jhpalmieri]:
> At some point, we might do the same with `EMBEDDED_MODE`, but this will also require patches to sagenb, and therefore is more annoying.
And rename `EMBEDDED_MODE` to `HTML_MODE` or something else which describes the usage better.

And `EMBEDDED_MODE` is actually independently defined in 6 different modules:

```
devel/sagenb/sagenb/misc/support.py
devel/sage/sage/misc/pager.py
devel/sage/sage/misc/sageinspect.py
devel/sage/sage/misc/latex.py
devel/sage/sage/plot/plot.py
devel/sage/sage/server/support.py
```



---

Comment by jhpalmieri created at 2013-03-18 19:09:32

Is `NOTEBOOK_MODE` a good name?

Maybe we should import it from `sagenb.misc.support` for now, and then rename it later. Or we could do this once somewhere in the Sage library:

```python
try:
    from sagenb.misc.support import NOTEBOOK_MODE
except ImportError:
    from sagenb.misc.support import EMBEDDED_MODE as NOTEBOOK_MODE
```

Then there can be an independent sagenb patch eventually.


---

Comment by roed created at 2013-03-28 22:45:08

Changing assignee from mvngu to roed.


---

Comment by roed created at 2013-03-28 22:45:08

Changing component from doctest to doctest framework.


---

Comment by jdemeyer created at 2013-04-03 08:14:18

Is this ticket ready for review?


---

Comment by jhpalmieri created at 2013-04-03 14:44:57

Sure, why not?


---

Comment by jhpalmieri created at 2013-04-03 14:44:57

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2013-04-03 17:07:51

initial patch


---

Attachment

Rebased to 5.9.beta2.


---

Comment by vbraun created at 2013-04-20 18:37:02

Looks good to me!


---

Comment by vbraun created at 2013-04-20 18:37:02

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2013-04-22 13:36:17

Umm... what about the #14275 situation?  I don't think this would mess things up as much as moving `EMBEDDED_MODE` but perhaps it's still unwise to do without this...


---

Comment by vbraun created at 2013-04-22 13:58:18

I don't agree with #14275, for starters. It would be a mistake to make any guarantees about the implementation of the doctesting framework. If your code depends on the location of `DOCTEST_MODE` then your code is broken.


---

Comment by jdemeyer created at 2013-04-28 10:34:10

Resolution: fixed
