# Issue 19579: AlarmInterrupt in sage.rings.integer.Integer.divisors

Issue created by migration from https://trac.sagemath.org/ticket/19816

Original creator: vbraun

Original creation time: 2015-12-31 19:31:19

CC:  vdelecroix

Reported at https://groups.google.com/d/msg/sage-release/KrpyE8h-UO4/oW9r8EeKCQAJ

```
./sage -t src/sage/rings/integer.pyx
too many failed tests, not using stored timings
Running doctests with ID 2015-12-31-11-59-48-9f43f0a3.
Git branch: develop
Using --optional=mpir,python2,sage
Doctesting 1 file.
sage -t src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 2622, in sage.rings.integer.Integer.divisors
Failed example:
    6.divisors()
Exception raised:
    Traceback (most recent call last):
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.integer.Integer.divisors[1]>", line 1, in <module>
        Integer(6).divisors()
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 745, in displayhook
        plain_text, rich_output = self._rich_output_formatter(obj, dict())
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.py", line 610, in _rich_output_formatter
        plain_text = self._backend.plain_text_formatter(obj, **rich_repr_kwds)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 305, in plain_text_formatter
        plain_text = self._apply_pretty_printer(SagePrettyPrinter, obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.py", line 250, in _apply_pretty_printer
        printer.pretty(obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/pretty_print.py", line 147, in pretty
        ok = representation(obj, self, cycle)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/sage/repl/display/fancy_repr.py", line 157, in __call__
        pretty_repr(obj, p, cycle)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py", line 550, in inner
        p.text(',')
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python2.7/site-packages/IPython/lib/pretty.py", line 211, in text
        self.output.write(obj)
      File "/64bitdev/storage/sage-git_develop/sage/local/lib/python/StringIO.py", line 213, in write
        _complain_ifclosed(self.closed)
      File "sage/ext/interrupt/interrupt.pyx", line 204, in sage.ext.interrupt.interrupt.sage_python_check_interrupt (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:1904)
        sig_check()
      File "sage/ext/interrupt/interrupt.pyx", line 91, in sage.ext.interrupt.interrupt.sig_raise_exception (/64bitdev/storage/sage-git_develop/sage/src/build/cythonized/sage/ext/interrupt/interrupt.c:970)
        raise AlarmInterrupt
    AlarmInterrupt
**********************************************************************
1 item had failures:
   1 of  21 in sage.rings.integer.Integer.divisors
    [1055 tests, 1 failure, 11.65 s]
----------------------------------------------------------------------
sage -t src/sage/rings/integer.pyx  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 12.2 seconds
    cpu time: 5.2 seconds
    cumulative wall time: 11.6 seconds
```

This is because the preceeding doctest

```
            sage: n = prod(primes_first_n(9))
            sage: try:
            ....:     alarm(1e-5)
            ....:     _ = n._pari_divisors_small()
            ....: except AlarmInterrupt:
            ....:     pass
```

is too quick and does not catch the alarm


---

Comment by jdemeyer created at 2016-01-02 12:26:37

I would remove the doctest. The number in the doctest is not the one with the most divisors, but even computing the divisors of 2095133040 (*) only takes about 1e-4 seconds.

(*) Exercise: of all numbers less than 2<sup>31</sup>, the number 2095133040 has the maximal number of divisors, namely 1600.


---

Comment by vbraun created at 2016-01-02 12:57:06

+1

The doctests probably should always have `alarm` / `cancel_alarm` pairs to avoid such non-local effects, though that would be material for another ticket.


---

Comment by jdemeyer created at 2016-01-02 13:12:37

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2016-01-02 13:12:37

New commits:


---

Comment by jdemeyer created at 2016-01-02 13:12:37

Changing priority from major to blocker.


---

Comment by vbraun created at 2016-01-02 14:18:36

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-02 19:14:10

Resolution: fixed
