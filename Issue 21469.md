# Issue 21469: Change autotools from experimental to optional

Issue created by migration from https://trac.sagemath.org/ticket/21706

Original creator: mkoeppe

Original creation time: 2016-10-14 15:58:24

CC:  jdemeyer embray dimpase

It was changed in #18563, which changed various packages to experimental, forgetting to create individual tickets for the issues involved.

The reason for changing autotools (missing xz dependency of libtool) has since been fixed in #21047.


---

Comment by mkoeppe created at 2016-10-15 00:04:33

New commits:


---

Comment by mkoeppe created at 2016-10-15 00:04:33

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-10-15 07:27:12

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2016-10-15 07:27:12

autotools does not build for me, it seems to be a linking problem to ncurses:

```
...
gcc  -g -O2  -L/home/dima/Sage/sage/local/lib -Wl,-rpath,/home/dima/Sage/sage/local/lib  -o infokey infokey.o key.o ../lib/libtxi.a ../gnulib/lib/libgnu.a  
terminal.o: In function `terminal_get_screen_size':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:481: undefined reference to `tgetnum'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:493: undefined reference to `tgetnum'
terminal.o: In function `terminal_goto_xy':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:235: undefined reference to `tgoto'
terminal.o: In function `terminal_delete_lines':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tgoto'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tputs'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:369: undefined reference to `tputs'
terminal.o: In function `terminal_insert_lines':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tgoto'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tputs'
...
```



---

Comment by mkoeppe created at 2016-10-17 00:27:15

I think we'd need a bit more info to debug this...


---

Comment by dimpase created at 2016-10-17 08:39:11

log with sage 7.4.rc2


---

Attachment

the interesting part of the attached log is

```
checking build system type... (cached) x86_64-unknown-linux-gnu
checking for tgetent in -lncurses... no
checking for tgetent in -lcurses... no
checking for tgetent in -ltermlib... no
checking for tgetent in -ltermcap... no
checking for tgetent in -lterminfo... no
configure: WARNING: probably need a terminal library, one of: ncurses curses termlib
 termcap terminfo
checking for library with termcap variables... 
```

while `ncurses` package is installed; my guess is that perhaps the appropriate `-L` is missing in LDFLAGS.

Anyhow, I don't see exactly what's happening in `spkg-install`, and why is does not run `./confgure`, which would be an appropriate place to pass proper `-L`.


---

Comment by mkoeppe created at 2016-10-18 06:39:10

It does run configure of all the packages involved, in `Makefile.build`. 

Here (on Mac OS X) I see:

```
[autotools-20141105] checking for tgetent in -lncurses... no
[autotools-20141105] checking for tgetent in -lcurses... no
[autotools-20141105] checking for tgetent in -ltermlib... no
[autotools-20141105] checking for tgetent in -ltermcap... yes
[autotools-20141105] checking for library with termcap variables... 
```

So on this system, tgetent is not provided by the ncurses library (from Sage's ncurses spkg) either, but rather from libtermcap.


---

Comment by mkoeppe created at 2016-10-18 07:00:12

Our `ncurses` package is built using configure option `--with-termlib`, which causes `tgetent` and friends to be put into the separate library `libtinfo`, not `libncurses`.

The ancient texinfo 4.13 that is used by our `autotools` package (with comment "texinfo 5.x breaks building old versions of autotools...") does not know about `libtinfo`.


---

Comment by git created at 2016-10-18 07:23:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-10-18 07:24:40

Please try with this patch.


---

Comment by mkoeppe created at 2016-10-18 07:24:40

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2016-10-18 08:25:41

OK, this works. Although I think we should update this package to newer autotools (not on this ticket though).


---

Comment by dimpase created at 2016-10-18 08:25:41

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2016-10-18 16:10:05

Thanks! 

Could you also take a look at:
 - #21525 needs_review enhancement - package autotools: Don't depend on `$SAGE_LOCAL`

Updating autotools is #21196.


---

Comment by vbraun created at 2016-10-29 14:27:29

Resolution: fixed
