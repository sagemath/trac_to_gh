# Issue 21469: Change autotools from experimental to optional

archive/issues_021469.json:
```json
{
    "body": "CC:  jdemeyer embray dimpase\n\nIt was changed in #18563, which changed various packages to experimental, forgetting to create individual tickets for the issues involved.\n\nThe reason for changing autotools (missing xz dependency of libtool) has since been fixed in #21047.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21706\n\n",
    "created_at": "2016-10-14T15:58:24Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.4",
    "title": "Change autotools from experimental to optional",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21469",
    "user": "mkoeppe"
}
```
CC:  jdemeyer embray dimpase

It was changed in #18563, which changed various packages to experimental, forgetting to create individual tickets for the issues involved.

The reason for changing autotools (missing xz dependency of libtool) has since been fixed in #21047.

Issue created by migration from https://trac.sagemath.org/ticket/21706





---

archive/issue_comments_298062.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-15T00:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298062",
    "user": "mkoeppe"
}
```

New commits:



---

archive/issue_comments_298063.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-15T00:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298063",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298064.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-10-15T07:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298064",
    "user": "dimpase"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_298065.json:
```json
{
    "body": "autotools does not build for me, it seems to be a linking problem to ncurses:\n\n```\n...\ngcc  -g -O2  -L/home/dima/Sage/sage/local/lib -Wl,-rpath,/home/dima/Sage/sage/local/lib  -o infokey infokey.o key.o ../lib/libtxi.a ../gnulib/lib/libgnu.a  \nterminal.o: In function `terminal_get_screen_size':\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:481: undefined reference to `tgetnum'\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:493: undefined reference to `tgetnum'\nterminal.o: In function `terminal_goto_xy':\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:235: undefined reference to `tgoto'\nterminal.o: In function `terminal_delete_lines':\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tgoto'\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tputs'\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:369: undefined reference to `tputs'\nterminal.o: In function `terminal_insert_lines':\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tgoto'\n/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tputs'\n...\n```\n",
    "created_at": "2016-10-15T07:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298065",
    "user": "dimpase"
}
```

autotools does not build for me, it seems to be a linking problem to ncurses:

```
...
gcc  -g -O2  -L/home/dima/Sage/sage/local/lib -Wl,-rpath,/home/dima/Sage/sage/local/lib  -o infokey infokey.o key.o ../lib/libtxi.a ../gnulib/lib/libgnu.a  
terminal.o: In function `terminal_get_screen_size':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:481: undefined reference to `tgetnum'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:493: undefined reference to `tgetnum'
terminal.o: In function `terminal_goto_xy':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:235: undefined reference to `tgoto'
terminal.o: In function `terminal_delete_lines':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tgoto'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:365: undefined reference to `tputs'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:369: undefined reference to `tputs'
terminal.o: In function `terminal_insert_lines':
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tgoto'
/home/dima/Sage/sage/local/var/tmp/sage/build/autotools-20141105/src/texinfo-4.13/info/terminal.c:389: undefined reference to `tputs'
...
```




---

archive/issue_comments_298066.json:
```json
{
    "body": "I think we'd need a bit more info to debug this...",
    "created_at": "2016-10-17T00:27:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298066",
    "user": "mkoeppe"
}
```

I think we'd need a bit more info to debug this...



---

archive/issue_comments_298067.json:
```json
{
    "body": "log with sage 7.4.rc2",
    "created_at": "2016-10-17T08:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298067",
    "user": "dimpase"
}
```

log with sage 7.4.rc2



---

archive/issue_comments_298068.json:
```json
{
    "body": "Attachment [autotools-20141105.log](tarball://root/attachments/some-uuid/ticket21706/autotools-20141105.log) by dimpase created at 2016-10-17 08:55:19\n\nthe interesting part of the attached log is\n\n```\nchecking build system type... (cached) x86_64-unknown-linux-gnu\nchecking for tgetent in -lncurses... no\nchecking for tgetent in -lcurses... no\nchecking for tgetent in -ltermlib... no\nchecking for tgetent in -ltermcap... no\nchecking for tgetent in -lterminfo... no\nconfigure: WARNING: probably need a terminal library, one of: ncurses curses termlib\n termcap terminfo\nchecking for library with termcap variables... \n```\n\nwhile `ncurses` package is installed; my guess is that perhaps the appropriate `-L` is missing in LDFLAGS.\n\nAnyhow, I don't see exactly what's happening in `spkg-install`, and why is does not run `./confgure`, which would be an appropriate place to pass proper `-L`.",
    "created_at": "2016-10-17T08:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298068",
    "user": "dimpase"
}
```

Attachment [autotools-20141105.log](tarball://root/attachments/some-uuid/ticket21706/autotools-20141105.log) by dimpase created at 2016-10-17 08:55:19

the interesting part of the attached log is

```
checking build system type... (cached) x86_64-unknown-linux-gnu
checking for tgetent in -lncurses... no
checking for tgetent in -lcurses... no
checking for tgetent in -ltermlib... no
checking for tgetent in -ltermcap... no
checking for tgetent in -lterminfo... no
configure: WARNING: probably need a terminal library, one of: ncurses curses termlib
 termcap terminfo
checking for library with termcap variables... 
```

while `ncurses` package is installed; my guess is that perhaps the appropriate `-L` is missing in LDFLAGS.

Anyhow, I don't see exactly what's happening in `spkg-install`, and why is does not run `./confgure`, which would be an appropriate place to pass proper `-L`.



---

archive/issue_comments_298069.json:
```json
{
    "body": "It does run configure of all the packages involved, in `Makefile.build`. \n\nHere (on Mac OS X) I see:\n\n```\n[autotools-20141105] checking for tgetent in -lncurses... no\n[autotools-20141105] checking for tgetent in -lcurses... no\n[autotools-20141105] checking for tgetent in -ltermlib... no\n[autotools-20141105] checking for tgetent in -ltermcap... yes\n[autotools-20141105] checking for library with termcap variables... \n```\n\nSo on this system, tgetent is not provided by the ncurses library (from Sage's ncurses spkg) either, but rather from libtermcap.",
    "created_at": "2016-10-18T06:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298069",
    "user": "mkoeppe"
}
```

It does run configure of all the packages involved, in `Makefile.build`. 

Here (on Mac OS X) I see:

```
[autotools-20141105] checking for tgetent in -lncurses... no
[autotools-20141105] checking for tgetent in -lcurses... no
[autotools-20141105] checking for tgetent in -ltermlib... no
[autotools-20141105] checking for tgetent in -ltermcap... yes
[autotools-20141105] checking for library with termcap variables... 
```

So on this system, tgetent is not provided by the ncurses library (from Sage's ncurses spkg) either, but rather from libtermcap.



---

archive/issue_comments_298070.json:
```json
{
    "body": "Our `ncurses` package is built using configure option `--with-termlib`, which causes `tgetent` and friends to be put into the separate library `libtinfo`, not `libncurses`.\n\nThe ancient texinfo 4.13 that is used by our `autotools` package (with comment \"texinfo 5.x breaks building old versions of autotools...\") does not know about `libtinfo`.",
    "created_at": "2016-10-18T07:00:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298070",
    "user": "mkoeppe"
}
```

Our `ncurses` package is built using configure option `--with-termlib`, which causes `tgetent` and friends to be put into the separate library `libtinfo`, not `libncurses`.

The ancient texinfo 4.13 that is used by our `autotools` package (with comment "texinfo 5.x breaks building old versions of autotools...") does not know about `libtinfo`.



---

archive/issue_comments_298071.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-18T07:23:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298071",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298072.json:
```json
{
    "body": "Please try with this patch.",
    "created_at": "2016-10-18T07:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298072",
    "user": "mkoeppe"
}
```

Please try with this patch.



---

archive/issue_comments_298073.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-10-18T07:24:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298073",
    "user": "mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_298074.json:
```json
{
    "body": "OK, this works. Although I think we should update this package to newer autotools (not on this ticket though).",
    "created_at": "2016-10-18T08:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298074",
    "user": "dimpase"
}
```

OK, this works. Although I think we should update this package to newer autotools (not on this ticket though).



---

archive/issue_comments_298075.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-10-18T08:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298075",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298076.json:
```json
{
    "body": "Thanks! \n\nCould you also take a look at:\n- #21525 needs_review enhancement - package autotools: Don't depend on `$SAGE_LOCAL`\n\nUpdating autotools is #21196.",
    "created_at": "2016-10-18T16:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298076",
    "user": "mkoeppe"
}
```

Thanks! 

Could you also take a look at:
- #21525 needs_review enhancement - package autotools: Don't depend on `$SAGE_LOCAL`

Updating autotools is #21196.



---

archive/issue_comments_298077.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-29T14:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21469",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21469#issuecomment-298077",
    "user": "vbraun"
}
```

Resolution: fixed
