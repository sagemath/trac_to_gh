# Issue 31416: Images of continuous maps and embedded submanifolds as manifold subsets

Issue created by migration from https://trac.sagemath.org/ticket/31653

Original creator: mkoeppe

Original creation time: 2021-04-11 15:48:54

CC:  egourgoulhon tscrim yzh @mjungmath @mwageringel roed

We define a subclass of `ManifoldSubset`, instances of which represent the image of a continuous map.

In particular, this will allow an embedded submanifold to be considered as a subset of the ambient manifold.



---

Comment by mkoeppe created at 2021-04-11 16:03:04

There are a number of related existing methods in various components of Sage. 
`FreeModuleMorphism.pushforward` can compute the image of a submodule, and `RingHomomorphism.pushforward` can compute the image of an ideal.


---

Comment by mkoeppe created at 2021-04-11 16:18:42

Also there are various `image` methods of various morphism classes, not all with the same signature:
- without extra argument: category `FiniteDimensionalModulesWithBasis` parent method, `CrystalMorphismByGenerators`, `SimplicialComplexMorphism`, `Matrix`, `MatrixMorphism_...`, `SchemeMorphism_...`
- with an extra argument (substructure to compute the image of): `AbelianGroupMorphism`, `PermutationGroupMorphism`, `SimplicialSetMorphism`, 
- incompatible: `WordMorphism.image`


---

Comment by egourgoulhon created at 2021-04-11 16:20:30

Thanks for opening this ticket; I've added it to the metaticket #30525.


---

Comment by mkoeppe created at 2021-04-11 16:22:58

Likewise, there is some diversity regarding `inverse_image` and `preimage` methods.


---

Comment by git created at 2021-04-11 18:33:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-11 18:41:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-11 19:42:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-11 19:43:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-11 20:08:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-11 20:10:09

Early stage. Comments on this design are very welcome


---

Comment by @mjungmath created at 2021-04-11 20:48:34

Yes, I have two comments:

- I advocate f-strings:

   {{{#!diff
   -        return "Image of the {}".format(self._map)
   +        return f"Image of the {self._map}"
   }}}
   More readable and even (slightly) faster.
- I don't quite get the purpose of
   {{{#!python
return self._map(preimage) == point
   }}}
   Isn't that always true if `preimage in self._map.domain()` is already met (and the inverse is correctly defined)?


---

Comment by mkoeppe created at 2021-04-11 20:55:19

This notion of inverse is taken from `TopologicalSubmanifold`. This inverse maps the whole ambient space to the domain of the map - so one needs to check


---

Comment by mkoeppe created at 2021-04-11 20:56:08

Replying to [comment:13 gh-mjungmath]:
> - I advocate f-strings:

Yes, I like them too. Unfortunate clash of these braces with LaTeX notation though


---

Comment by @mjungmath created at 2021-04-11 21:23:21

Replying to [comment:14 mkoeppe]:
> This notion of inverse is taken from `TopologicalSubmanifold`. This inverse maps the whole ambient space to the domain of the map - so one needs to check 

Alright, I see it now. It's just a very unusual definition of inverse...

The rest looks pretty nice already. :)


---

Comment by egourgoulhon created at 2021-04-12 09:21:11

Replying to [comment:16 gh-mjungmath]:
> 
> The rest looks pretty nice already. :)

Yes, it looks nice!


---

Comment by egourgoulhon created at 2021-04-12 09:21:59

Replying to [comment:12 mkoeppe]:
> Early stage. Comments on this design are very welcome
I like it.


---

Comment by git created at 2021-04-17 17:43:13

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-04-17 17:44:37

I am considering possible extensions of the current code:
 - handle a domain `subset` directly in `ImageManifoldSubset` - which would allow us to extend `ContinuousMap.image` to take a `subset` that is not open
 - if the map is an isomorphism (and the domain `subset` open), we could create a submanifold -- but should this use extra classes `ImageTopologicalManifold`, `ImageDifferentiableManifold`, which remember the map, or just compute the result? (in either case - follow-up ticket)


---

Comment by git created at 2021-04-17 18:28:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-17 18:28:35

Changing status from new to needs_review.


---

Comment by git created at 2021-04-17 18:35:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-18 10:58:33

Some `TESTS::` fields are actually empty.


---

Comment by egourgoulhon created at 2021-04-18 11:03:45

Replying to [comment:20 mkoeppe]:
> I am considering possible extensions of the current code:
>  - handle a domain `subset` directly in `ImageManifoldSubset` - which would allow us to extend `ContinuousMap.image` to take a `subset` that is not open

Sounds legitimate.
 
>  - if the map is an isomorphism (and the domain `subset` open), we could create a submanifold -- but should this use extra classes `ImageTopologicalManifold`, `ImageDifferentiableManifold`, which remember the map, or just compute the result? (in either case - follow-up ticket)
> 

Maybe just compute the result?


---

Comment by mkoeppe created at 2021-04-18 16:07:00

Replying to [comment:25 egourgoulhon]:
> Replying to [comment:20 mkoeppe]:
> >  - if the map is an isomorphism (and the domain `subset` open), we could create a submanifold -- but should this use extra classes `ImageTopologicalManifold`, `ImageDifferentiableManifold`, which remember the map, or just compute the result? (in either case - follow-up ticket)
> > 
> 
> Maybe just compute the result?

OK, I have opened #31685 for this.


---

Comment by git created at 2021-04-18 16:36:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-04-19 17:18:06

Ready for review


---

Comment by egourgoulhon created at 2021-04-20 09:56:15

To generate the documentation regarding the new class `ImageManifoldSubset`, the following line

```
   sage/manifolds/continuous_map_image
```

should added at the end of `src/doc/en/reference/manifolds/continous_map.rst`. Also, it would be nice to modify the head of `src/sage/manifolds/subsets.py` so that it refers to it, e.g. something like:

```diff
The class :class:`ManifoldSubset` implements generic subsets of a
topological manifold. Open subsets are implemented by the class
:class:`~sage.manifolds.manifold.TopologicalManifold` (since an
open subset of a manifold is a manifold by itself), which inherits
- from :class:`ManifoldSubset`.
+ from :class:`ManifoldSubset`. Besides, subsets that are images of
+ a manifold subset under a continuous map are implemented by the
+ subclass :class:`~sage.manifolds.continuous_map_image.ImageManifoldSubset`. 
```



---

Comment by git created at 2021-04-20 16:39:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2021-04-20 22:20:22

Thanks!


---

Comment by egourgoulhon created at 2021-04-20 22:20:22

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-04-20 22:21:50

Thanks for reviewing!


---

Comment by vbraun created at 2021-06-06 13:18:10

Resolution: fixed
