# Issue 28930: Cygwin: test failures in sage.schemes.curves.zariski_vankampen with sirocco

archive/issues_028930.json:
```json
{
    "body": "CC:  @miguelmarco\n\nKeywords: cygwin sirocco\n\n#29149 fixes building Sage with the sirocco package installed on Cygwin.\n\nHowever, this then has some test failures in `sage.schemes.curves.zariski_vankampen` that I can't reproduce on Linux.  First the following test fails:\n\n\n```\nFile \"src/sage/schemes/curves/zariski_vankampen.py\", line 268, in sage.schemes.curves.zariski_vankampen.followstrand\nFailed example:\n    followstrand(f, x0, x1, -1.0) # optional - sirocco # abs tol 1e-15\nExpected:\n    [(0.0, -1.0, 0.0),\n     (0.7500000000000001, -1.015090921153253, -0.24752813818386948),\n     (1.0, -1.026166099551513, -0.32768940253604323)]\nGot:\n    [(0.0, -1.0, 0.0),\n     (0.04687500000000001, -1.0000610264662042, -0.015624364352899234),\n     (0.09376287283569926, -1.0002440686687775, -0.031249206930640684),\n     (0.14068935711887412, -1.00054911561723, -0.046879295645742315),\n     (0.18768019150872053, -1.0009762160115023, -0.06251939538085316),\n     (0.23476112890433726, -1.0015254781428102, -0.07817426805966325),\n     (0.2819579506558838, -1.0021970697475961, -0.0938486727311868),\n     (0.32683564123989106, -1.0029469806716729, -0.10873190673317454),\n     (0.36890847616239786, -1.0037475631034418, -0.12266360371442413),\n     (0.408351758902248, -1.0045828947575761, -0.13570358710012892),\n     (0.4453298364708575, -1.0054396825086667, -0.14790834427708396),\n     (0.5146637319120003, -1.007235298523974, -0.1707339873423019),\n     (0.5753308904230002, -1.0090048273677124, -0.19063761622091374),\n     (0.6284146541201252, -1.0107014101228857, -0.20799548368797782),\n     (0.6748629473551095, -1.0122968271247523, -0.22313613838778654),\n     (0.7155052039357208, -1.0137759106169235, -0.23634583220457633),\n     (0.7866291529517906, -1.0165461226074612, -0.25937181657421426),\n     (0.8399721147138429, -1.0187713227013186, -0.2765614548183696),\n     (0.8799793360353821, -1.0205207374109584, -0.28940677345545085),\n     (0.939990168017691, -1.0232704733075533, -0.30859664694102984),\n     (1.0, -1.026166099551513, -0.3276894025360433)]\n```\n\n\nThe first an last lines are correct, but none of the stuff in the middle.\n\nThen a bit later it hangs, seemingly indefinitely at\n\n\n```\nTrying (line 339):    B = zvk.braid_in_segment(g,CC(p1),CC(p2)) # optional - sirocco\n```\n\n\nwhich on Linux passes very quickly.  However, the CPU is still very active during this hang so it must be some kind of busy loop.\n\nI don't understand anything about this package except that it's using some kind of linear approximation techniques, so there might be some small numerical glitches being invoked that are causing some solutions to diverge or something.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29167\n\n",
    "created_at": "2020-02-07T17:24:35Z",
    "labels": [
        "component: algebraic topology",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Cygwin: test failures in sage.schemes.curves.zariski_vankampen with sirocco",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28930",
    "user": "https://github.com/embray"
}
```
CC:  @miguelmarco

Keywords: cygwin sirocco

#29149 fixes building Sage with the sirocco package installed on Cygwin.

However, this then has some test failures in `sage.schemes.curves.zariski_vankampen` that I can't reproduce on Linux.  First the following test fails:


```
File "src/sage/schemes/curves/zariski_vankampen.py", line 268, in sage.schemes.curves.zariski_vankampen.followstrand
Failed example:
    followstrand(f, x0, x1, -1.0) # optional - sirocco # abs tol 1e-15
Expected:
    [(0.0, -1.0, 0.0),
     (0.7500000000000001, -1.015090921153253, -0.24752813818386948),
     (1.0, -1.026166099551513, -0.32768940253604323)]
Got:
    [(0.0, -1.0, 0.0),
     (0.04687500000000001, -1.0000610264662042, -0.015624364352899234),
     (0.09376287283569926, -1.0002440686687775, -0.031249206930640684),
     (0.14068935711887412, -1.00054911561723, -0.046879295645742315),
     (0.18768019150872053, -1.0009762160115023, -0.06251939538085316),
     (0.23476112890433726, -1.0015254781428102, -0.07817426805966325),
     (0.2819579506558838, -1.0021970697475961, -0.0938486727311868),
     (0.32683564123989106, -1.0029469806716729, -0.10873190673317454),
     (0.36890847616239786, -1.0037475631034418, -0.12266360371442413),
     (0.408351758902248, -1.0045828947575761, -0.13570358710012892),
     (0.4453298364708575, -1.0054396825086667, -0.14790834427708396),
     (0.5146637319120003, -1.007235298523974, -0.1707339873423019),
     (0.5753308904230002, -1.0090048273677124, -0.19063761622091374),
     (0.6284146541201252, -1.0107014101228857, -0.20799548368797782),
     (0.6748629473551095, -1.0122968271247523, -0.22313613838778654),
     (0.7155052039357208, -1.0137759106169235, -0.23634583220457633),
     (0.7866291529517906, -1.0165461226074612, -0.25937181657421426),
     (0.8399721147138429, -1.0187713227013186, -0.2765614548183696),
     (0.8799793360353821, -1.0205207374109584, -0.28940677345545085),
     (0.939990168017691, -1.0232704733075533, -0.30859664694102984),
     (1.0, -1.026166099551513, -0.3276894025360433)]
```


The first an last lines are correct, but none of the stuff in the middle.

Then a bit later it hangs, seemingly indefinitely at


```
Trying (line 339):    B = zvk.braid_in_segment(g,CC(p1),CC(p2)) # optional - sirocco
```


which on Linux passes very quickly.  However, the CPU is still very active during this hang so it must be some kind of busy loop.

I don't understand anything about this package except that it's using some kind of linear approximation techniques, so there might be some small numerical glitches being invoked that are causing some solutions to diverge or something.

Issue created by migration from https://trac.sagemath.org/ticket/29167





---

archive/issue_comments_409016.json:
```json
{
    "body": "Thanks for looking into this.\n\nSadly, I don't have access to any windows system, so I never tested Sirocco there.\n\nAs you say, Sirocco does numerical aproximations of the movements of roots of a polynomial, but carefully testing that the step is small enough to guarantee the correctness. So it is indeed very sensitive to all the small subtleties of floating point computing.\n\nFor example, we discovered when we moved to autotools that the optimization flag -O2 can actually go against performance (and maybe even correctness) , so we had to make sure that it was compiled with no optimization options. Maybe the problem you are detecting on windows is related to that?",
    "created_at": "2020-02-08T10:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409016",
    "user": "https://github.com/miguelmarco"
}
```

Thanks for looking into this.

Sadly, I don't have access to any windows system, so I never tested Sirocco there.

As you say, Sirocco does numerical aproximations of the movements of roots of a polynomial, but carefully testing that the step is small enough to guarantee the correctness. So it is indeed very sensitive to all the small subtleties of floating point computing.

For example, we discovered when we moved to autotools that the optimization flag -O2 can actually go against performance (and maybe even correctness) , so we had to make sure that it was compiled with no optimization options. Maybe the problem you are detecting on windows is related to that?



---

archive/issue_comments_409017.json:
```json
{
    "body": "I just tested under a linux box disabling the tweek we did to prevent the compiler optimization and I get the same error as you point, so it really looks that is the cuplrit.\n\nIn particular, the only line I had to modify is this one:\n\n\n```\n: ${CXXFLAGS=-O0 -g}\n```\n\n\n\nIn the `configure.ac` file [1]\n\nMaybe that kind of autotools behaviour is platform-dependent?\n\n\n[1] https://github.com/miguelmarco/SIROCCO2/blob/master/configure.ac#L4\n\n\nP.S. I noticed that you forked the old sirocco repo. The one we are using here is the version 2 one:  https://github.com/miguelmarco/SIROCCO2",
    "created_at": "2020-02-08T11:08:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409017",
    "user": "https://github.com/miguelmarco"
}
```

I just tested under a linux box disabling the tweek we did to prevent the compiler optimization and I get the same error as you point, so it really looks that is the cuplrit.

In particular, the only line I had to modify is this one:


```
: ${CXXFLAGS=-O0 -g}
```



In the `configure.ac` file [1]

Maybe that kind of autotools behaviour is platform-dependent?


[1] https://github.com/miguelmarco/SIROCCO2/blob/master/configure.ac#L4


P.S. I noticed that you forked the old sirocco repo. The one we are using here is the version 2 one:  https://github.com/miguelmarco/SIROCCO2



---

archive/issue_comments_409018.json:
```json
{
    "body": "That's for the note about `-O0`.  I have another ticket #29149 where I'm fixing building sirocco on Cygwin (though I haven't posted the patch yet).  In particular I had to *remove* `CXXFLAGS=-O0` to even get it to build, because otherwise I had problems during linking with some templates; I'm not exactly sure why but it seems like they were being *overspecialized*, in such a way that resulted in multiple definitions for some functions.  Removing `-O0` fixed it because then the compiler would optimize out unused specializations, but there is probably a better solution.\n\nAs you say, this is likely the culprit.",
    "created_at": "2020-02-10T14:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409018",
    "user": "https://github.com/embray"
}
```

That's for the note about `-O0`.  I have another ticket #29149 where I'm fixing building sirocco on Cygwin (though I haven't posted the patch yet).  In particular I had to *remove* `CXXFLAGS=-O0` to even get it to build, because otherwise I had problems during linking with some templates; I'm not exactly sure why but it seems like they were being *overspecialized*, in such a way that resulted in multiple definitions for some functions.  Removing `-O0` fixed it because then the compiler would optimize out unused specializations, but there is probably a better solution.

As you say, this is likely the culprit.



---

archive/issue_comments_409019.json:
```json
{
    "body": "Replying to [comment:2 mmarco]:\n> P.S. I noticed that you forked the old sirocco repo. The one we are using here is the version 2 one:  https://github.com/miguelmarco/SIROCCO2\n\nI see.  When I noticed that my copy was not 2.0 I updated my fork of the repo to 2.0 as well, so I can confirm that I am building the correct version at least.",
    "created_at": "2020-02-10T14:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409019",
    "user": "https://github.com/embray"
}
```

Replying to [comment:2 mmarco]:
> P.S. I noticed that you forked the old sirocco repo. The one we are using here is the version 2 one:  https://github.com/miguelmarco/SIROCCO2

I see.  When I noticed that my copy was not 2.0 I updated my fork of the repo to 2.0 as well, so I can confirm that I am building the correct version at least.



---

archive/issue_comments_409020.json:
```json
{
    "body": "Replying to [comment:1 mmarco]:\n> For example, we discovered when we moved to autotools that the optimization flag -O2 can actually go against performance (and maybe even correctness) , so we had to make sure that it was compiled with no optimization options. Maybe the problem you are detecting on windows is related to that?\n\nDid you ever figure out what *specific* optimizations were hurting performance and/or correctness, and where those optimizations were occurring?  Because disabling *all* optimizations is a blunt hammer and probably hurts performance in other cases.  I know figuring that out can be tricky of course, but I have to ask.",
    "created_at": "2020-02-10T15:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409020",
    "user": "https://github.com/embray"
}
```

Replying to [comment:1 mmarco]:
> For example, we discovered when we moved to autotools that the optimization flag -O2 can actually go against performance (and maybe even correctness) , so we had to make sure that it was compiled with no optimization options. Maybe the problem you are detecting on windows is related to that?

Did you ever figure out what *specific* optimizations were hurting performance and/or correctness, and where those optimizations were occurring?  Because disabling *all* optimizations is a blunt hammer and probably hurts performance in other cases.  I know figuring that out can be tricky of course, but I have to ask.



---

archive/issue_comments_409021.json:
```json
{
    "body": "I was able to reproduce this on Linux also by removing `-O0` and setting `-O2` instead.",
    "created_at": "2020-02-10T15:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409021",
    "user": "https://github.com/embray"
}
```

I was able to reproduce this on Linux also by removing `-O0` and setting `-O2` instead.



---

archive/issue_comments_409022.json:
```json
{
    "body": "I can also reproduce the problem enabling basic optimizations with `-O1`, so it could be any combination of\n\n\n```\n-fauto-inc-dec \n-fbranch-count-reg \n-fcombine-stack-adjustments \n-fcompare-elim \n-fcprop-registers \n-fdce \n-fdefer-pop \n-fdelayed-branch \n-fdse \n-fforward-propagate \n-fguess-branch-probability \n-fif-conversion \n-fif-conversion2 \n-finline-functions-called-once \n-fipa-profile \n-fipa-pure-const \n-fipa-reference \n-fipa-reference-addressable \n-fmerge-constants \n-fmove-loop-invariants \n-fomit-frame-pointer \n-freorder-blocks \n-fshrink-wrap \n-fshrink-wrap-separate \n-fsplit-wide-types \n-fssa-backprop \n-fssa-phiopt \n-ftree-bit-ccp \n-ftree-ccp \n-ftree-ch \n-ftree-coalesce-vars \n-ftree-copy-prop \n-ftree-dce \n-ftree-dominator-opts \n-ftree-dse \n-ftree-forwprop \n-ftree-fre \n-ftree-phiprop \n-ftree-pta \n-ftree-scev-cprop \n-ftree-sink \n-ftree-slsr \n-ftree-sra \n-ftree-ter \n-funit-at-a-time\n```\n",
    "created_at": "2020-02-10T15:57:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409022",
    "user": "https://github.com/embray"
}
```

I can also reproduce the problem enabling basic optimizations with `-O1`, so it could be any combination of


```
-fauto-inc-dec 
-fbranch-count-reg 
-fcombine-stack-adjustments 
-fcompare-elim 
-fcprop-registers 
-fdce 
-fdefer-pop 
-fdelayed-branch 
-fdse 
-fforward-propagate 
-fguess-branch-probability 
-fif-conversion 
-fif-conversion2 
-finline-functions-called-once 
-fipa-profile 
-fipa-pure-const 
-fipa-reference 
-fipa-reference-addressable 
-fmerge-constants 
-fmove-loop-invariants 
-fomit-frame-pointer 
-freorder-blocks 
-fshrink-wrap 
-fshrink-wrap-separate 
-fsplit-wide-types 
-fssa-backprop 
-fssa-phiopt 
-ftree-bit-ccp 
-ftree-ccp 
-ftree-ch 
-ftree-coalesce-vars 
-ftree-copy-prop 
-ftree-dce 
-ftree-dominator-opts 
-ftree-dse 
-ftree-forwprop 
-ftree-fre 
-ftree-phiprop 
-ftree-pta 
-ftree-scev-cprop 
-ftree-sink 
-ftree-slsr 
-ftree-sra 
-ftree-ter 
-funit-at-a-time
```




---

archive/issue_comments_409023.json:
```json
{
    "body": "I didn't dig into the details of what specific optimization was the problem. Sorry.",
    "created_at": "2020-02-10T16:08:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409023",
    "user": "https://github.com/miguelmarco"
}
```

I didn't dig into the details of what specific optimization was the problem. Sorry.



---

archive/issue_comments_409024.json:
```json
{
    "body": "One problem I found (if not *the* problem) is that although there is a template specialization for evaluation polynomials on complex intervals:\n\n\n```\ntemplate <>\nIComplex Polynomial<IComplex>::operator () (const IComplex &x, const IComplex &y) const{\n    IComplex rop, ropx, ropy;\n\n#ifdef DEVELOPER\n    std::cerr << \"using specialized polynomial eval for \" << __PRETTY_FUNCTION__ << std::endl;\n#endif\n\n    ropx = this->evalIPolHornerXY (x, y);\n    ropy = this->evalIPolHornerYX (x, y);\n    rop  = this->evalPolClassic (x, y);\n\n\n    rop.r.a = MAX(MAX(ropx.r.a, ropy.r.a), rop.r.a);\n    rop.r.b = MIN(MIN(ropx.r.b, ropy.r.b), rop.r.b);\n    rop.i.a = MAX(MAX(ropx.i.a, ropy.i.a), rop.i.a);\n    rop.i.b = MIN(MIN(ropx.i.b, ropy.i.b), rop.i.b);\n\n    return rop;\n}\n```\n\n\nwhen building with `-O1` that specialization seems to be being ignored, and instead it's using the unspecialized template:\n\n\n```\ntemplate <class T>\nT Polynomial<T>::operator() (const T &x, const T &y) const {\n#ifdef DEVELOPER\n    std::cerr << \"using unspecialized polynomial eval for \" << __PRETTY_FUNCTION__ << std::endl;\n#endif\n    return this->evalPolClassic (x,y);\n}\n```\n\n\nI don't know why that would be but I'll keep looking...",
    "created_at": "2020-02-10T17:20:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409024",
    "user": "https://github.com/embray"
}
```

One problem I found (if not *the* problem) is that although there is a template specialization for evaluation polynomials on complex intervals:


```
template <>
IComplex Polynomial<IComplex>::operator () (const IComplex &x, const IComplex &y) const{
    IComplex rop, ropx, ropy;

#ifdef DEVELOPER
    std::cerr << "using specialized polynomial eval for " << __PRETTY_FUNCTION__ << std::endl;
#endif

    ropx = this->evalIPolHornerXY (x, y);
    ropy = this->evalIPolHornerYX (x, y);
    rop  = this->evalPolClassic (x, y);


    rop.r.a = MAX(MAX(ropx.r.a, ropy.r.a), rop.r.a);
    rop.r.b = MIN(MIN(ropx.r.b, ropy.r.b), rop.r.b);
    rop.i.a = MAX(MAX(ropx.i.a, ropy.i.a), rop.i.a);
    rop.i.b = MIN(MIN(ropx.i.b, ropy.i.b), rop.i.b);

    return rop;
}
```


when building with `-O1` that specialization seems to be being ignored, and instead it's using the unspecialized template:


```
template <class T>
T Polynomial<T>::operator() (const T &x, const T &y) const {
#ifdef DEVELOPER
    std::cerr << "using unspecialized polynomial eval for " << __PRETTY_FUNCTION__ << std::endl;
#endif
    return this->evalPolClassic (x,y);
}
```


I don't know why that would be but I'll keep looking...



---

archive/issue_comments_409025.json:
```json
{
    "body": "This seems to fix it for me:\n\n\n```\ndiff --git a/include/polynomial.hpp b/include/polynomial.hpp\nindex 88d1299..4596579 100644\n--- a/include/polynomial.hpp\n+++ b/include/polynomial.hpp\n@@ -230,6 +230,10 @@ T Polynomial<T>::operator() (const T &x, const T &y) const {\n        return this->evalPolClassic (x,y);\n }\n\n+// Defined in lib/polynomial.cpp\n+template <> IComplex Polynomial<IComplex>::operator() (const IComplex &x, const IComplex &y) const;\n+template <> MPIComplex Polynomial<MPIComplex>::operator () (const MPIComplex &x, const MPIComplex &y) const;\n+\n template <class T>\n T Polynomial<T>::diffX (const T &x, const T &y) const {\n                // coef[(i*(i+1))/2 + j] is coeficient of monomial of degree 'i',\n@@ -311,6 +315,10 @@ T Polynomial<T>::diffY (const T &x, const T &y) const {\n        return this->evalPolYClassic (x,y);\n }\n\n+// Defined in lib/polynomial.cpp\n+template<> IComplex Polynomial<IComplex>::diffY (const IComplex &x, const IComplex &y) const;\n+template<> MPIComplex Polynomial<MPIComplex>::diffY (const MPIComplex &x, const MPIComplex &y) const;\n+\n\n template <class T>\n T Polynomial<T>::diffXX (const T &x, const T &y) const {\n```\n\n\nThe problem is that sirocco.cpp includes \"polynomial.hpp\" which only has the unspecialized `operator()` defined inline, but no declaration for the specialized version, so it just use the unspecialized one.  Meanwhile, when compiling `polynomial.cpp` the unused specializations are just optimized out.\n\nThis would possibly explain the link errors I was having on Cygwin as well--I don't know why the problem only occurs on Windows but it must be generating an explicit specialization for `Polynomial<IComplex>::operator()` in `sirocco.o` and then conflicting with the one in `polynomial.o`.  Going to test that theory out now.",
    "created_at": "2020-02-10T17:36:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409025",
    "user": "https://github.com/embray"
}
```

This seems to fix it for me:


```
diff --git a/include/polynomial.hpp b/include/polynomial.hpp
index 88d1299..4596579 100644
--- a/include/polynomial.hpp
+++ b/include/polynomial.hpp
@@ -230,6 +230,10 @@ T Polynomial<T>::operator() (const T &x, const T &y) const {
        return this->evalPolClassic (x,y);
 }

+// Defined in lib/polynomial.cpp
+template <> IComplex Polynomial<IComplex>::operator() (const IComplex &x, const IComplex &y) const;
+template <> MPIComplex Polynomial<MPIComplex>::operator () (const MPIComplex &x, const MPIComplex &y) const;
+
 template <class T>
 T Polynomial<T>::diffX (const T &x, const T &y) const {
                // coef[(i*(i+1))/2 + j] is coeficient of monomial of degree 'i',
@@ -311,6 +315,10 @@ T Polynomial<T>::diffY (const T &x, const T &y) const {
        return this->evalPolYClassic (x,y);
 }

+// Defined in lib/polynomial.cpp
+template<> IComplex Polynomial<IComplex>::diffY (const IComplex &x, const IComplex &y) const;
+template<> MPIComplex Polynomial<MPIComplex>::diffY (const MPIComplex &x, const MPIComplex &y) const;
+

 template <class T>
 T Polynomial<T>::diffXX (const T &x, const T &y) const {
```


The problem is that sirocco.cpp includes "polynomial.hpp" which only has the unspecialized `operator()` defined inline, but no declaration for the specialized version, so it just use the unspecialized one.  Meanwhile, when compiling `polynomial.cpp` the unused specializations are just optimized out.

This would possibly explain the link errors I was having on Cygwin as well--I don't know why the problem only occurs on Windows but it must be generating an explicit specialization for `Polynomial<IComplex>::operator()` in `sirocco.o` and then conflicting with the one in `polynomial.o`.  Going to test that theory out now.



---

archive/issue_comments_409026.json:
```json
{
    "body": "Yep, this is exactly the link error that I got which motivated me to try removing the `-O0`.  This explains it exactly:\n\n\n```\nlibtool: link: g++ -std=gnu++11 -std=gnu++11 -shared -nostdlib /usr/lib/gcc/x86_64-pc-cygwin/7.4.0/crtbeginS.o  .libs/icomplex.o .libs/interval.o .libs/mp_complex.o .libs/mp_icomplex.o .libs/mp_interval.o .libs/polynomial.o .libs/sirocco.o   -lmpfr -lgmp -L/home/embray/src/sagemath/sage/local/lib -L/home/embray/src/sagemath/sage/local/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0 -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../.. -lstdc++ -lgcc_s -lgcc -lcygwin -ladvapi32 -lshell32 -luser32 -lkernel32 -lgcc_s -lgcc /usr/lib/gcc/x86_64-pc-cygwin/7.4.0/crtend.o  -O0 -Wl,-rpath -Wl,/home/embray/src/sagemath/sage/local/lib   -o .libs/cygsirocco-0.dll -Wl,--enable-auto-image-base -Xlinker --out-implib -Xlinker .libs/libsirocco.dll.a\n.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI8IComplexEclERKS0_S3_[_ZNK10PolynomialI8IComplexEclERKS0_S3_]+0x0): multiple definition of `Polynomial<IComplex>::operator()(IComplex const&, IComplex const&) const'\n.libs/polynomial.o:polynomial.cpp:(.text+0x642): first defined here\n.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI8IComplexE5diffYERKS0_S3_[_ZNK10PolynomialI8IComplexE5diffYERKS0_S3_]+0x0): multiple definition of `Polynomial<IComplex>::diffY(IComplex const&, IComplex const&) const'\n.libs/polynomial.o:polynomial.cpp:(.text+0xfbe): first defined here\n.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI10MPIComplexEclERKS0_S3_[_ZNK10PolynomialI10MPIComplexEclERKS0_S3_]+0x0): multiple definition of `Polynomial<MPIComplex>::operator()(MPIComplex const&, MPIComplex const&) const'\n.libs/polynomial.o:polynomial.cpp:(.text+0x188a): first defined here\n.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI10MPIComplexE5diffYERKS0_S3_[_ZNK10PolynomialI10MPIComplexE5diffYERKS0_S3_]+0x0): multiple definition of `Polynomial<MPIComplex>::diffY(MPIComplex const&, MPIComplex const&) const'\n.libs/polynomial.o:polynomial.cpp:(.text+0x22f8): first defined here\ncollect2: error: ld returned 1 exit status\n```\n",
    "created_at": "2020-02-10T17:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409026",
    "user": "https://github.com/embray"
}
```

Yep, this is exactly the link error that I got which motivated me to try removing the `-O0`.  This explains it exactly:


```
libtool: link: g++ -std=gnu++11 -std=gnu++11 -shared -nostdlib /usr/lib/gcc/x86_64-pc-cygwin/7.4.0/crtbeginS.o  .libs/icomplex.o .libs/interval.o .libs/mp_complex.o .libs/mp_icomplex.o .libs/mp_interval.o .libs/polynomial.o .libs/sirocco.o   -lmpfr -lgmp -L/home/embray/src/sagemath/sage/local/lib -L/home/embray/src/sagemath/sage/local/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0 -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../x86_64-pc-cygwin/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../lib -L/lib/../lib -L/usr/lib/../lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../../../x86_64-pc-cygwin/lib -L/usr/lib/gcc/x86_64-pc-cygwin/7.4.0/../../.. -lstdc++ -lgcc_s -lgcc -lcygwin -ladvapi32 -lshell32 -luser32 -lkernel32 -lgcc_s -lgcc /usr/lib/gcc/x86_64-pc-cygwin/7.4.0/crtend.o  -O0 -Wl,-rpath -Wl,/home/embray/src/sagemath/sage/local/lib   -o .libs/cygsirocco-0.dll -Wl,--enable-auto-image-base -Xlinker --out-implib -Xlinker .libs/libsirocco.dll.a
.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI8IComplexEclERKS0_S3_[_ZNK10PolynomialI8IComplexEclERKS0_S3_]+0x0): multiple definition of `Polynomial<IComplex>::operator()(IComplex const&, IComplex const&) const'
.libs/polynomial.o:polynomial.cpp:(.text+0x642): first defined here
.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI8IComplexE5diffYERKS0_S3_[_ZNK10PolynomialI8IComplexE5diffYERKS0_S3_]+0x0): multiple definition of `Polynomial<IComplex>::diffY(IComplex const&, IComplex const&) const'
.libs/polynomial.o:polynomial.cpp:(.text+0xfbe): first defined here
.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI10MPIComplexEclERKS0_S3_[_ZNK10PolynomialI10MPIComplexEclERKS0_S3_]+0x0): multiple definition of `Polynomial<MPIComplex>::operator()(MPIComplex const&, MPIComplex const&) const'
.libs/polynomial.o:polynomial.cpp:(.text+0x188a): first defined here
.libs/sirocco.o:sirocco.cpp:(.text$_ZNK10PolynomialI10MPIComplexE5diffYERKS0_S3_[_ZNK10PolynomialI10MPIComplexE5diffYERKS0_S3_]+0x0): multiple definition of `Polynomial<MPIComplex>::diffY(MPIComplex const&, MPIComplex const&) const'
.libs/polynomial.o:polynomial.cpp:(.text+0x22f8): first defined here
collect2: error: ld returned 1 exit status
```




---

archive/issue_comments_409027.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-02-10T18:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409027",
    "user": "https://github.com/embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_409028.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-02-10T18:58:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409028",
    "user": "https://github.com/embray"
}
```

New commits:



---

archive/issue_comments_409029.json:
```json
{
    "body": "Thanks a lot. Great work.\n\nI might need some time to review and test it though.\n\nDid you check that all test pass with this patch?\n\nAlso, what would you consider the best way to go: just patch sirocco at install time inside Sage, or release a new version of Sirocco and using that in Sage?",
    "created_at": "2020-02-10T19:12:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409029",
    "user": "https://github.com/miguelmarco"
}
```

Thanks a lot. Great work.

I might need some time to review and test it though.

Did you check that all test pass with this patch?

Also, what would you consider the best way to go: just patch sirocco at install time inside Sage, or release a new version of Sirocco and using that in Sage?



---

archive/issue_comments_409030.json:
```json
{
    "body": "Replying to [comment:14 mmarco]:\n> Thanks a lot. Great work.\n> \n> I might need some time to review and test it though.\n\nThank you for looking at it! There's no hurry.\n\n> Did you check that all test pass with this patch?\n\nPer our discussion on GitHub, yes.  I'm just reiterating here for the record.\n\n> Also, what would you consider the best way to go: just patch sirocco at install time inside Sage, or release a new version of Sirocco and using that in Sage?\n\nIt's up to you.  There's no urgency on this either way, so whatever's easiest for you.",
    "created_at": "2020-02-11T13:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409030",
    "user": "https://github.com/embray"
}
```

Replying to [comment:14 mmarco]:
> Thanks a lot. Great work.
> 
> I might need some time to review and test it though.

Thank you for looking at it! There's no hurry.

> Did you check that all test pass with this patch?

Per our discussion on GitHub, yes.  I'm just reiterating here for the record.

> Also, what would you consider the best way to go: just patch sirocco at install time inside Sage, or release a new version of Sirocco and using that in Sage?

It's up to you.  There's no urgency on this either way, so whatever's easiest for you.



---

archive/issue_comments_409031.json:
```json
{
    "body": "I just created a new release in github. The source code is available at https://github.com/miguelmarco/SIROCCO2/releases/download/v2.0.1/libsirocco-2.0.1.tar.gz",
    "created_at": "2020-02-11T14:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409031",
    "user": "https://github.com/miguelmarco"
}
```

I just created a new release in github. The source code is available at https://github.com/miguelmarco/SIROCCO2/releases/download/v2.0.1/libsirocco-2.0.1.tar.gz



---

archive/issue_comments_409032.json:
```json
{
    "body": "Oh shoot, before you made the release I should have pointed out to you the fixes I made for Cygwin.  I forgot to make a PR for them yet.  I will do that now...",
    "created_at": "2020-02-12T17:22:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409032",
    "user": "https://github.com/embray"
}
```

Oh shoot, before you made the release I should have pointed out to you the fixes I made for Cygwin.  I forgot to make a PR for them yet.  I will do that now...



---

archive/issue_comments_409033.json:
```json
{
    "body": "No problem, I can make another release (that is the good thing about numbers: we won't run out of them).",
    "created_at": "2020-02-12T19:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409033",
    "user": "https://github.com/miguelmarco"
}
```

No problem, I can make another release (that is the good thing about numbers: we won't run out of them).



---

archive/issue_comments_409034.json:
```json
{
    "body": "I made a new release on github.\n\nThe tarball is available at https://github.com/miguelmarco/SIROCCO2/releases/download/2.0.2/libsirocco-2.0.2.tar.gz",
    "created_at": "2020-02-16T19:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409034",
    "user": "https://github.com/miguelmarco"
}
```

I made a new release on github.

The tarball is available at https://github.com/miguelmarco/SIROCCO2/releases/download/2.0.2/libsirocco-2.0.2.tar.gz



---

archive/issue_comments_409035.json:
```json
{
    "body": "Erik, are you going to rebase this ticket based on the new release?",
    "created_at": "2020-02-25T01:49:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409035",
    "user": "https://github.com/tscrim"
}
```

Erik, are you going to rebase this ticket based on the new release?



---

archive/issue_comments_409036.json:
```json
{
    "body": "Yes, I've been busy with other things, but I plan to replace this ticket with one to update the sirocco spkg to the new release.",
    "created_at": "2020-03-05T12:19:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409036",
    "user": "https://github.com/embray"
}
```

Yes, I've been busy with other things, but I plan to replace this ticket with one to update the sirocco spkg to the new release.



---

archive/issue_comments_409037.json:
```json
{
    "body": "Superseded by #29284 which upgrades the SIROCCO SPKG to the new 2.0.2 release, rather than patching.",
    "created_at": "2020-03-06T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409037",
    "user": "https://github.com/embray"
}
```

Superseded by #29284 which upgrades the SIROCCO SPKG to the new 2.0.2 release, rather than patching.



---

archive/issue_comments_409038.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-03-06T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409038",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_409039.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2020-03-15T19:45:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28930",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28930#issuecomment-409039",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate
