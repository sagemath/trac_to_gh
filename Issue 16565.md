# Issue 16565: difference family database

archive/issues_016565.json:
```json
{
    "body": "CC:  @nathanncohen\n\nImport the database from the Handbook of combinatorial design inside Sage.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16802\n\n",
    "created_at": "2014-08-12T10:43:55Z",
    "labels": [
        "component: combinatorial designs"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "difference family database",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16565",
    "user": "https://github.com/videlec"
}
```
CC:  @nathanncohen

Import the database from the Handbook of combinatorial design inside Sage.

Issue created by migration from https://trac.sagemath.org/ticket/16802





---

archive/issue_comments_217646.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2014-08-12T10:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217646",
    "user": "https://github.com/videlec"
}
```

Last 10 new commits:



---

archive/issue_comments_217647.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-12T10:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217647",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-20T13:38:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217649.json:
```json
{
    "body": "Rebased above the positively reviewed #16757...",
    "created_at": "2014-08-20T13:39:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217649",
    "user": "https://github.com/videlec"
}
```

Rebased above the positively reviewed #16757...



---

archive/issue_comments_217650.json:
```json
{
    "body": "Yooooooooooooooooooooooooooooo !!!!\n\nFirst review of this patch (it will be clearer after those points have been solved):\n\n- The DF in the database: why add a 'S' in the *blocks* of short groups ? it is\n  not like it is hard to check that a block has an non-empty stabilizer. We can\n  get this info easily. Plus those 'S' have nothing to do in the blocks of a\n  design ...\n\n- The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?\n\n- The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`. You can have something like that:\n\n  {{{\n  DF_database = {\n     (v,k,l) : {\n        (v1,v2,v3): [DF1,DF2,DF3,....]\n     }\n  }\n  }}}\n  This way you can easily check whether there exists a BIBD that can be obtained from a difference family. And you can also find `(v1,v2,v3)` easily.\n\n- With a database indexed with `(v,k,l)` you can undo those modifications\n  {{{\n  -if (v,k,l) in DF_constructions:\n  +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)\n  +if G_df:\n  }}}\n\n- Block stabilizer: instead of computing the stabilizer of blocks, you could\n  just develop a block with respect to the group and remove duplicated, you know\n  ? All it takes is a simple call to `set(...)`. Much easier to understand, no\n  questions about where all those group-specific functions should be\n  implemented...\n\n  If you do that you save around 100 lines of code+doc with the three functions\n  `block_stabilizer, orbit_representatives, partial_differences`. Really I\n  would have nothing if those functions were group methods, but having to\n  implement all that just for difference families, and just to avoid a call to\n  `set()`, really ?....\n\n  Plus there is the \"short+non-abelian exception\" in `is_difference_family`,\n  that wouldn't be needed anymore in this case ....\n\n- If you insist on having all those functions to avoid calling \"set\" to simplify\n  the orbits of a block, and if you want to keep the warning above, you may also\n  have to handle the case where the group is a multiplicative+commutative group.\n\n- (That's going very far just to avoid a `set(...)` `:-P`\n\n- `difference_family` : new `short_blocks` argument. Really, WHY do you care so\n  much about short blocks ? They are just blocks whose orbit is smaller, what's\n  all the fuss about ? If we give the users access to the database, can't we\n  just give them a function that tests if a block is short and let them do what\n  they want with it ?\n\n- What's the point of filtering difference families with short blocks anyway ?\n\n- The checks in `DF_from_database`: if you want to check anything about the\n  database, it would be better to do it in the doctests than at runtime ?...\n\n- `DF_from_database`: if you actually need it, should be in `difference_family.py` not in `database.py`\n\n- isn't \"too few\" better than \"too less\" ?\n\nNathann",
    "created_at": "2014-08-20T14:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217650",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooooooooooooooooooooooooo !!!!

First review of this patch (it will be clearer after those points have been solved):

- The DF in the database: why add a 'S' in the *blocks* of short groups ? it is
  not like it is hard to check that a block has an non-empty stabilizer. We can
  get this info easily. Plus those 'S' have nothing to do in the blocks of a
  design ...

- The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?

- The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`. You can have something like that:

  {{{
  DF_database = {
     (v,k,l) : {
        (v1,v2,v3): [DF1,DF2,DF3,....]
     }
  }
  }}}
  This way you can easily check whether there exists a BIBD that can be obtained from a difference family. And you can also find `(v1,v2,v3)` easily.

- With a database indexed with `(v,k,l)` you can undo those modifications
  {{{
  -if (v,k,l) in DF_constructions:
  +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)
  +if G_df:
  }}}

- Block stabilizer: instead of computing the stabilizer of blocks, you could
  just develop a block with respect to the group and remove duplicated, you know
  ? All it takes is a simple call to `set(...)`. Much easier to understand, no
  questions about where all those group-specific functions should be
  implemented...

  If you do that you save around 100 lines of code+doc with the three functions
  `block_stabilizer, orbit_representatives, partial_differences`. Really I
  would have nothing if those functions were group methods, but having to
  implement all that just for difference families, and just to avoid a call to
  `set()`, really ?....

  Plus there is the "short+non-abelian exception" in `is_difference_family`,
  that wouldn't be needed anymore in this case ....

- If you insist on having all those functions to avoid calling "set" to simplify
  the orbits of a block, and if you want to keep the warning above, you may also
  have to handle the case where the group is a multiplicative+commutative group.

- (That's going very far just to avoid a `set(...)` `:-P`

- `difference_family` : new `short_blocks` argument. Really, WHY do you care so
  much about short blocks ? They are just blocks whose orbit is smaller, what's
  all the fuss about ? If we give the users access to the database, can't we
  just give them a function that tests if a block is short and let them do what
  they want with it ?

- What's the point of filtering difference families with short blocks anyway ?

- The checks in `DF_from_database`: if you want to check anything about the
  database, it would be better to do it in the doctests than at runtime ?...

- `DF_from_database`: if you actually need it, should be in `difference_family.py` not in `database.py`

- isn't "too few" better than "too less" ?

Nathann



---

archive/issue_comments_217651.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-20T14:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217651",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_217652.json:
```json
{
    "body": "Thanks for the rebase.\n\nReplying to [comment:4 ncohen]:\n> Yooooooooooooooooooooooooooooo !!!!\n> \n> First review of this patch (it will be clearer after those points have been solved):\n> \n> - The DF in the database: why add a 'S' in the *blocks* of short groups ?\n\nremoved\n \n> - The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?\n> - The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`.\n> - With a database indexed with `(v,k,l)` you can undo those modifications\n>   {{{\n>   -if (v,k,l) in DF_constructions:\n>   +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)\n>   +if G_df:\n>   }}}\n\n\ndone, done, done.\n\nFor the rest, some people defines difference families with short blocks (as in the Handbook) and some people do not allow them (like in Stinson for example). So you have to care about the two definitions.\n\nAbout the functions `block_stabilizer, orbit_representatives, partial_differences` it is used in basically two places: `is_difference_family` and `BIBID_from_difference_family`. You can not avoid them in the former. Nevertheless:\n- I removed `partial_differences` as it was used in only one place and is a two lines function\n- I rewrote some of the doc\n\nAs you can see, the `is_difference_family` is **very** detailed and it was very useful to debug the database from the Handbook.\n\nI do not see the need of multiplicative Abelian group in difference families...\n\n\nVincent\n----\nNew commits:",
    "created_at": "2014-08-20T16:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217652",
    "user": "https://github.com/videlec"
}
```

Thanks for the rebase.

Replying to [comment:4 ncohen]:
> Yooooooooooooooooooooooooooooo !!!!
> 
> First review of this patch (it will be clearer after those points have been solved):
> 
> - The DF in the database: why add a 'S' in the *blocks* of short groups ?

removed
 
> - The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?
> - The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`.
> - With a database indexed with `(v,k,l)` you can undo those modifications
>   {{{
>   -if (v,k,l) in DF_constructions:
>   +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)
>   +if G_df:
>   }}}


done, done, done.

For the rest, some people defines difference families with short blocks (as in the Handbook) and some people do not allow them (like in Stinson for example). So you have to care about the two definitions.

About the functions `block_stabilizer, orbit_representatives, partial_differences` it is used in basically two places: `is_difference_family` and `BIBID_from_difference_family`. You can not avoid them in the former. Nevertheless:
- I removed `partial_differences` as it was used in only one place and is a two lines function
- I rewrote some of the doc

As you can see, the `is_difference_family` is **very** detailed and it was very useful to debug the database from the Handbook.

I do not see the need of multiplicative Abelian group in difference families...


Vincent
----
New commits:



---

archive/issue_comments_217653.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-08-20T16:37:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217653",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_217654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-20T18:02:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217655.json:
```json
{
    "body": "In the last commit:\n- remove `DF_from_database` and include the code in `difference_family`\n- remove the function `orbit_representatives` (remains only `block_stabilizer`)\n- remove the argument `short_blocks` from everywhere",
    "created_at": "2014-08-20T18:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217655",
    "user": "https://github.com/videlec"
}
```

In the last commit:
- remove `DF_from_database` and include the code in `difference_family`
- remove the function `orbit_representatives` (remains only `block_stabilizer`)
- remove the argument `short_blocks` from everywhere



---

archive/issue_comments_217656.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-20T18:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217656",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_217657.json:
```json
{
    "body": "Helloooooooooooo !!!\n\nVery good code, efficient and all. I added a commit but I still have a couple of remarks :\n\n- What does that mean ?\n  {{{\n  +An example with a short block (i.e. considering restricted difference when a\n  +block has a non trivial stabilizer)::\n  }}}\n\n- I do not find the two messages about the checks over l very clear for a user:\n\n  {{{\n  sum(1/s_i) k*(k-1) = {} is not a multiple of (v-1) = {} (stabilizer sizes {})\n  }}}\n\n  The si are not defined (and it is hard to define them in an error\n  message)... What would you think of formulating that with BIBD terminology ? A\n  bit like my comment about nb_diff in the code ?\n\n- What do we do about non-commutative groups ? If we don't handle them it would\n  be nice to have an error message sayng \"the group is not commutative\". And if \n  we handle them we have to be more verbose about left/right actions and \n  everything (I personally think that it is going too far, but well)..\n\nI did several things in my commit:\n\n- move a DF that was not properly ordered\n\n- expand the doc a bit in some places\n\n- Removed the \"abelian/additive\" in `is_difference_family`, but that's also part\n  of the more general question above.\n\n- rename `c_counter` to `tmp_counter`\n\n- Replace the `ValueError` in `difference_family` with an `AssertionError`.\n\nTell me if you agree with those changes, and what you think of my questions above. Before we set this ticket to `positive_review` I will rebase it somehow, so that all design patches are linearly ordered.\n\nThanks !\n\nNathann",
    "created_at": "2014-08-21T10:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217657",
    "user": "https://github.com/nathanncohen"
}
```

Helloooooooooooo !!!

Very good code, efficient and all. I added a commit but I still have a couple of remarks :

- What does that mean ?
  {{{
  +An example with a short block (i.e. considering restricted difference when a
  +block has a non trivial stabilizer)::
  }}}

- I do not find the two messages about the checks over l very clear for a user:

  {{{
  sum(1/s_i) k*(k-1) = {} is not a multiple of (v-1) = {} (stabilizer sizes {})
  }}}

  The si are not defined (and it is hard to define them in an error
  message)... What would you think of formulating that with BIBD terminology ? A
  bit like my comment about nb_diff in the code ?

- What do we do about non-commutative groups ? If we don't handle them it would
  be nice to have an error message sayng "the group is not commutative". And if 
  we handle them we have to be more verbose about left/right actions and 
  everything (I personally think that it is going too far, but well)..

I did several things in my commit:

- move a DF that was not properly ordered

- expand the doc a bit in some places

- Removed the "abelian/additive" in `is_difference_family`, but that's also part
  of the more general question above.

- rename `c_counter` to `tmp_counter`

- Replace the `ValueError` in `difference_family` with an `AssertionError`.

Tell me if you agree with those changes, and what you think of my questions above. Before we set this ticket to `positive_review` I will rebase it somehow, so that all design patches are linearly ordered.

Thanks !

Nathann



---

archive/issue_comments_217658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-21T10:53:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217659.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-21T11:09:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_217660.json:
```json
{
    "body": "(rebased on top of #16763)",
    "created_at": "2014-08-21T11:10:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217660",
    "user": "https://github.com/nathanncohen"
}
```

(rebased on top of #16763)



---

archive/issue_comments_217661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-21T11:56:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217662.json:
```json
{
    "body": "Hello,\n\nI tried to address the issue you mentioned in comment:9...\n\nVincent",
    "created_at": "2014-08-21T11:56:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217662",
    "user": "https://github.com/videlec"
}
```

Hello,

I tried to address the issue you mentioned in comment:9...

Vincent



---

archive/issue_comments_217663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-21T12:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_217664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2014-08-21T12:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_217665.json:
```json
{
    "body": "Thanks ! Positive review to this branch ! I will rebase it on top of #16763 and switch it to `positive_review`\n\nNathann",
    "created_at": "2014-08-21T13:33:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217665",
    "user": "https://github.com/nathanncohen"
}
```

Thanks ! Positive review to this branch ! I will rebase it on top of #16763 and switch it to `positive_review`

Nathann



---

archive/issue_comments_217666.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-21T13:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217666",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217667.json:
```json
{
    "body": "Oh. Looks like I did it already. Let's go then ! `:-P`\n\nNathann",
    "created_at": "2014-08-21T13:35:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217667",
    "user": "https://github.com/nathanncohen"
}
```

Oh. Looks like I did it already. Let's go then ! `:-P`

Nathann



---

archive/issue_comments_217668.json:
```json
{
    "body": "Thanks!!\n\nVincent",
    "created_at": "2014-08-21T13:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217668",
    "user": "https://github.com/videlec"
}
```

Thanks!!

Vincent



---

archive/issue_comments_217669.json:
```json
{
    "body": "Changing status from positive_review to needs_info.",
    "created_at": "2014-08-22T11:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217669",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_info.



---

archive/issue_comments_217670.json:
```json
{
    "body": "Milestone? duplicate/wontfix?",
    "created_at": "2014-08-22T11:47:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217670",
    "user": "https://github.com/vbraun"
}
```

Milestone? duplicate/wontfix?



---

archive/issue_comments_217671.json:
```json
{
    "body": "Changing status from needs_info to positive_review.",
    "created_at": "2014-08-22T11:58:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217671",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_info to positive_review.



---

archive/issue_events_016055.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2014-08-23T13:24:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16565#event-16055"
}
```



---

archive/issue_comments_217672.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-23T13:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16565",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16565#issuecomment-217672",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
