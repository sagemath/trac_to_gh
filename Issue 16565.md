# Issue 16565: difference family database

Issue created by migration from https://trac.sagemath.org/ticket/16802

Original creator: vdelecroix

Original creation time: 2014-08-12 10:43:55

CC:  ncohen

Import the database from the Handbook of combinatorial design inside Sage.


---

Comment by vdelecroix created at 2014-08-12 10:44:34

Last 10 new commits:


---

Comment by vdelecroix created at 2014-08-12 10:44:34

Changing status from new to needs_review.


---

Comment by git created at 2014-08-20 13:38:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-08-20 13:39:19

Rebased above the positively reviewed #16757...


---

Comment by ncohen created at 2014-08-20 14:33:39

Yooooooooooooooooooooooooooooo !!!!

First review of this patch (it will be clearer after those points have been solved):

- The DF in the database: why add a 'S' in the *blocks* of short groups ? it is
  not like it is hard to check that a block has an non-empty stabilizer. We can
  get this info easily. Plus those 'S' have nothing to do in the blocks of a
  design ...

- The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?

- The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`. You can have something like that:

  {{{
  DF_database = {
     (v,k,l) : {
        (v1,v2,v3): [DF1,DF2,DF3,....]
     }
  }
  }}}
  This way you can easily check whether there exists a BIBD that can be obtained from a difference family. And you can also find `(v1,v2,v3)` easily.

- With a database indexed with `(v,k,l)` you can undo those modifications
  {{{
  -if (v,k,l) in DF_constructions:
  +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)
  +if G_df:
  }}}

- Block stabilizer: instead of computing the stabilizer of blocks, you could
  just develop a block with respect to the group and remove duplicated, you know
  ? All it takes is a simple call to `set(...)`. Much easier to understand, no
  questions about where all those group-specific functions should be
  implemented...

  If you do that you save around 100 lines of code+doc with the three functions
  `block_stabilizer, orbit_representatives, partial_differences`. Really I
  would have nothing if those functions were group methods, but having to
  implement all that just for difference families, and just to avoid a call to
  `set()`, really ?....

  Plus there is the "short+non-abelian exception" in `is_difference_family`,
  that wouldn't be needed anymore in this case ....

- If you insist on having all those functions to avoid calling "set" to simplify
  the orbits of a block, and if you want to keep the warning above, you may also
  have to handle the case where the group is a multiplicative+commutative group.

- (That's going very far just to avoid a `set(...)` `:-P`

- `difference_family` : new `short_blocks` argument. Really, WHY do you care so
  much about short blocks ? They are just blocks whose orbit is smaller, what's
  all the fuss about ? If we give the users access to the database, can't we
  just give them a function that tests if a block is short and let them do what
  they want with it ?

- What's the point of filtering difference families with short blocks anyway ?

- The checks in `DF_from_database`: if you want to check anything about the
  database, it would be better to do it in the doctests than at runtime ?...

- `DF_from_database`: if you actually need it, should be in `difference_family.py` not in `database.py`

- isn't "too few" better than "too less" ?

Nathann


---

Comment by ncohen created at 2014-08-20 14:33:39

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2014-08-20 16:37:43

Thanks for the rebase.

Replying to [comment:4 ncohen]:
> Yooooooooooooooooooooooooooooo !!!!
> 
> First review of this patch (it will be clearer after those points have been solved):
> 
> - The DF in the database: why add a 'S' in the *blocks* of short groups ?

removed
 
> - The database looks a bit messy as it is. Could you align some stuff, like the ':' or the ',' so that one can actually read it in the code ?
> - The database should be indexed with `(v,k,l)` instead of `((v1,v2,v3),k,l)`.
> - With a database indexed with `(v,k,l)` you can undo those modifications
>   {{{
>   -if (v,k,l) in DF_constructions:
>   +G_df = DF_from_database(v,k,l,short_blocks=short_blocks)
>   +if G_df:
>   }}}


done, done, done.

For the rest, some people defines difference families with short blocks (as in the Handbook) and some people do not allow them (like in Stinson for example). So you have to care about the two definitions.

About the functions `block_stabilizer, orbit_representatives, partial_differences` it is used in basically two places: `is_difference_family` and `BIBID_from_difference_family`. You can not avoid them in the former. Nevertheless:
 - I removed `partial_differences` as it was used in only one place and is a two lines function
 - I rewrote some of the doc

As you can see, the `is_difference_family` is *very* detailed and it was very useful to debug the database from the Handbook.

I do not see the need of multiplicative Abelian group in difference families...


Vincent
----
New commits:


---

Comment by vdelecroix created at 2014-08-20 16:37:43

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-08-20 18:02:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-08-20 18:03:23

In the last commit:
- remove `DF_from_database` and include the code in `difference_family`
- remove the function `orbit_representatives` (remains only `block_stabilizer`)
- remove the argument `short_blocks` from everywhere


---

Comment by git created at 2014-08-20 18:07:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-08-21 10:52:52

Helloooooooooooo !!!

Very good code, efficient and all. I added a commit but I still have a couple of remarks :

- What does that mean ?
  {{{
  +An example with a short block (i.e. considering restricted difference when a
  +block has a non trivial stabilizer)::
  }}}

- I do not find the two messages about the checks over l very clear for a user:

  {{{
  sum(1/s_i) k*(k-1) = {} is not a multiple of (v-1) = {} (stabilizer sizes {})
  }}}

  The si are not defined (and it is hard to define them in an error
  message)... What would you think of formulating that with BIBD terminology ? A
  bit like my comment about nb_diff in the code ?

- What do we do about non-commutative groups ? If we don't handle them it would
  be nice to have an error message sayng "the group is not commutative". And if 
  we handle them we have to be more verbose about left/right actions and 
  everything (I personally think that it is going too far, but well)..

I did several things in my commit:

- move a DF that was not properly ordered

- expand the doc a bit in some places

- Removed the "abelian/additive" in `is_difference_family`, but that's also part
  of the more general question above.

- rename `c_counter` to `tmp_counter`

- Replace the `ValueError` in `difference_family` with an `AssertionError`.

Tell me if you agree with those changes, and what you think of my questions above. Before we set this ticket to `positive_review` I will rebase it somehow, so that all design patches are linearly ordered.

Thanks !

Nathann


---

Comment by git created at 2014-08-21 10:53:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-08-21 11:09:52

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-08-21 11:10:19

(rebased on top of #16763)


---

Comment by git created at 2014-08-21 11:56:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-08-21 11:56:38

Hello,

I tried to address the issue you mentioned in comment:9...

Vincent


---

Comment by git created at 2014-08-21 12:01:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-08-21 12:32:17

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by ncohen created at 2014-08-21 13:33:24

Thanks ! Positive review to this branch ! I will rebase it on top of #16763 and switch it to `positive_review`

Nathann


---

Comment by ncohen created at 2014-08-21 13:35:20

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2014-08-21 13:35:20

Oh. Looks like I did it already. Let's go then ! `:-P`

Nathann


---

Comment by vdelecroix created at 2014-08-21 13:40:33

Thanks!!

Vincent


---

Comment by vbraun created at 2014-08-22 11:47:53

Changing status from positive_review to needs_info.


---

Comment by vbraun created at 2014-08-22 11:47:53

Milestone? duplicate/wontfix?


---

Comment by vdelecroix created at 2014-08-22 11:58:55

Changing status from needs_info to positive_review.


---

Comment by vbraun created at 2014-08-23 13:24:24

Resolution: fixed
