# Issue 27256: Cygwin: OpenBLAS doesn't read environment variables properly

archive/issues_027256.json:
```json
{
    "body": "In Sage we currently, by default, disable multithreading in OpenBLAS by setting `OPENBLAS_NUM_THREADS=1` in `sage-env`.\n\nWhile this is not ideal, it does reduce the likelihood of multithreading issues coming up in contexts where it wasn't explicitly requested.\n\nWhile investigating #27434, I found that there is a subtle and apparently rare bug in OpenBLAS's multithreading on Windows, which was causing the docbuild to hang, particularly while building the plot3d docs (which happen to exercise this area of the code more than anything else in Sage).\n\nIt occurred to me, however, that the docbuild should not be exhibiting the bug since we set `OPENBLAS_NUM_THREADS=1`.  It turns out this is due to a bug in OpenBLAS on Cygwin, fixed by the attached patch.\n\nI'm setting this to \"critical\" since it would be very good to have this fixed for the buildbot.  I think this bug has been affecting Cygwin for a long time, but I could never nail down why.  Nevertheless since we have lived with this bug thus far I won't consider it a blocker.\n\n**Upstream PR:** https://github.com/xianyi/OpenBLAS/pull/2060\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27493\n\n",
    "created_at": "2019-03-15T14:37:03Z",
    "labels": [
        "porting: Cygwin",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Cygwin: OpenBLAS doesn't read environment variables properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27256",
    "user": "embray"
}
```
In Sage we currently, by default, disable multithreading in OpenBLAS by setting `OPENBLAS_NUM_THREADS=1` in `sage-env`.

While this is not ideal, it does reduce the likelihood of multithreading issues coming up in contexts where it wasn't explicitly requested.

While investigating #27434, I found that there is a subtle and apparently rare bug in OpenBLAS's multithreading on Windows, which was causing the docbuild to hang, particularly while building the plot3d docs (which happen to exercise this area of the code more than anything else in Sage).

It occurred to me, however, that the docbuild should not be exhibiting the bug since we set `OPENBLAS_NUM_THREADS=1`.  It turns out this is due to a bug in OpenBLAS on Cygwin, fixed by the attached patch.

I'm setting this to "critical" since it would be very good to have this fixed for the buildbot.  I think this bug has been affecting Cygwin for a long time, but I could never nail down why.  Nevertheless since we have lived with this bug thus far I won't consider it a blocker.

**Upstream PR:** https://github.com/xianyi/OpenBLAS/pull/2060


Issue created by migration from https://trac.sagemath.org/ticket/27493





---

archive/issue_comments_384089.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27256#issuecomment-384089",
    "user": "embray"
}
```

New commits:



---

archive/issue_comments_384090.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-03-15T14:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27256#issuecomment-384090",
    "user": "embray"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_384091.json:
```json
{
    "body": "Moving all blocker/critical issues from 8.7 to 8.8.",
    "created_at": "2019-03-25T10:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27256#issuecomment-384091",
    "user": "embray"
}
```

Moving all blocker/critical issues from 8.7 to 8.8.



---

archive/issue_comments_384092.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-04T17:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27256#issuecomment-384092",
    "user": "vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_384093.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-05T20:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27256",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27256#issuecomment-384093",
    "user": "vbraun"
}
```

Resolution: fixed
