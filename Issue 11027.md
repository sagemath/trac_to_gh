# Issue 11027: Make spkg docs be built and installed after the full build

archive/issues_011027.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  @dandrake\n\nFollowing on some concerns brought up about dependencies in building spkg docs, as implemented in #10828, here is a ticket for reimplementing #10823 so that docs are built after the full Sage build.  In this way, spkg docs are built when the normal Sage docs are built, and we don't have any worries about having python or sphinx or other dependencies installed.\n\nSee http://groups.google.com/group/sage-devel/browse_thread/thread/d46ddccff06d8670 and various tickets associated with #10823\n\nIssue created by migration from https://trac.sagemath.org/ticket/11197\n\n",
    "created_at": "2011-04-14T13:50:46Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Make spkg docs be built and installed after the full build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11027",
    "user": "https://github.com/jasongrout"
}
```
Assignee: tbd

CC:  @dandrake

Following on some concerns brought up about dependencies in building spkg docs, as implemented in #10828, here is a ticket for reimplementing #10823 so that docs are built after the full Sage build.  In this way, spkg docs are built when the normal Sage docs are built, and we don't have any worries about having python or sphinx or other dependencies installed.

See http://groups.google.com/group/sage-devel/browse_thread/thread/d46ddccff06d8670 and various tickets associated with #10823

Issue created by migration from https://trac.sagemath.org/ticket/11197





---

archive/issue_comments_119937.json:
```json
{
    "body": "Here's a patch for the Sage root repo (the file spkg/install).  This should perhaps be considered a first draft, because there are a few issues/questions.\n\n- Right now, it records a log for the docbuilding in spkg/logs/numpy-1.5.1.p0-docs.log, for example, instead of just appending to the already existing spkg/logs/numpy-1.5.1.p0.log.  It's easy enough to switch it around.  Opinions?\n\n- Right now, it stores a placeholder file in spkg/installed if the docs seem to have been built correctly.  (Since after building each spkg, we delete the directory where it was built (spkg/build/numpy-...), we can't just rely on 'make' recognizing that it's already been installed, I think.)  Is this the right way to do it?\n\nA few things which I think belong on other tickets or which I don't know how to solve:\n\n- With the approach here, running \"sage -i ...\" or \"sage -f ...\" won't install the docs.  Should we add something to the sage-spkg script which tries to build the docs if SAGE_SPKG_INSTALL_DOCS is \"yes\", but fails gracefully if it can't?  Or only build the docs in sage-spkg if we can tell that the Sage library has already been installed, or some other criterion like this?  This may end up with some code duplication, or separating out the doc-building stuff into a separate script (and then gets us entangled in the base repo vs. scripts repo debate...).\n\n- I noticed that the most recent cython spkg (the one in 4.7.alpha4) has files for building the docs, at least some of which weren't added to the Mercurial repository.  I haven't checked the other spkgs for this sort of issue, but someone should...",
    "created_at": "2011-04-14T22:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119937",
    "user": "https://github.com/jhpalmieri"
}
```

Here's a patch for the Sage root repo (the file spkg/install).  This should perhaps be considered a first draft, because there are a few issues/questions.

- Right now, it records a log for the docbuilding in spkg/logs/numpy-1.5.1.p0-docs.log, for example, instead of just appending to the already existing spkg/logs/numpy-1.5.1.p0.log.  It's easy enough to switch it around.  Opinions?

- Right now, it stores a placeholder file in spkg/installed if the docs seem to have been built correctly.  (Since after building each spkg, we delete the directory where it was built (spkg/build/numpy-...), we can't just rely on 'make' recognizing that it's already been installed, I think.)  Is this the right way to do it?

A few things which I think belong on other tickets or which I don't know how to solve:

- With the approach here, running "sage -i ..." or "sage -f ..." won't install the docs.  Should we add something to the sage-spkg script which tries to build the docs if SAGE_SPKG_INSTALL_DOCS is "yes", but fails gracefully if it can't?  Or only build the docs in sage-spkg if we can tell that the Sage library has already been installed, or some other criterion like this?  This may end up with some code duplication, or separating out the doc-building stuff into a separate script (and then gets us entangled in the base repo vs. scripts repo debate...).

- I noticed that the most recent cython spkg (the one in 4.7.alpha4) has files for building the docs, at least some of which weren't added to the Mercurial repository.  I haven't checked the other spkgs for this sort of issue, but someone should...



---

archive/issue_comments_119938.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-04-14T22:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119938",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_119939.json:
```json
{
    "body": "root repo",
    "created_at": "2011-04-14T22:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119939",
    "user": "https://github.com/jhpalmieri"
}
```

root repo



---

archive/issue_comments_119940.json:
```json
{
    "body": "Attachment [trac_11197-spkg-install-docs.patch](tarball://root/attachments/some-uuid/ticket11197/trac_11197-spkg-install-docs.patch) by @jasongrout created at 2011-04-14 22:34:35\n\nReplying to [comment:6 jhpalmieri]:\n\n> Here's a patch for the Sage root repo (the file spkg/install).  This should perhaps be considered a first draft, because there are a few issues/questions. - Right now, it records a log for the docbuilding in spkg/logs/numpy-1.5.1.p0-docs.log, for example, instead of just appending to the already existing spkg/logs/numpy-1.5.1.p0.log.  It's easy enough to switch it around.  Opinions? \n\n> - Right now, it stores a placeholder file in spkg/installed if the docs seem to have been built correctly.  (Since after building each spkg, we delete the directory where it was built (spkg/build/numpy-...), we can't just rely on 'make' recognizing that it's already been installed, I think.)  Is this the right way to do it? A few things which I think belong on other tickets or which I don't know how to solve: \n\nTo me, it seems okay to think about the docs install as a separate thing from the spkg install, so it makes sense to me to have a separate log file and separate placeholder file.  I don't know much about this part of the build process, though, so my +1 doesn't count for much.\n\n\n> - With the approach here, running \"sage -i ...\" or \"sage -f ...\" won't install the docs.  Should we add something to the sage-spkg script which tries to build the docs if SAGE_SPKG_INSTALL_DOCS is \"yes\", but fails gracefully if it can't?  Or only build the docs in sage-spkg if we can tell that the Sage library has already been installed, or some other criterion like this?  This may end up with some code duplication, or separating out the doc-building stuff into a separate script (and then gets us entangled in the base repo vs. scripts repo debate...). \n\nHmm...thinking about this one still...\n\n> - I noticed that the most recent cython spkg (the one in 4.7.alpha4) has files for building the docs, at least some of which weren't added to the Mercurial repository.  I haven't checked the other spkgs for this sort of issue, but someone should...\n\nAre you talking about the docs directory containing the documentation?  That directory is part of the upstream source, so shouldn't be in the spkg repository.  However, as of a week or two ago, that docs directory has been merged into the main Cython source tree, so future versions of the spkg will not have that docs directory.",
    "created_at": "2011-04-14T22:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119940",
    "user": "https://github.com/jasongrout"
}
```

Attachment [trac_11197-spkg-install-docs.patch](tarball://root/attachments/some-uuid/ticket11197/trac_11197-spkg-install-docs.patch) by @jasongrout created at 2011-04-14 22:34:35

Replying to [comment:6 jhpalmieri]:

> Here's a patch for the Sage root repo (the file spkg/install).  This should perhaps be considered a first draft, because there are a few issues/questions. - Right now, it records a log for the docbuilding in spkg/logs/numpy-1.5.1.p0-docs.log, for example, instead of just appending to the already existing spkg/logs/numpy-1.5.1.p0.log.  It's easy enough to switch it around.  Opinions? 

> - Right now, it stores a placeholder file in spkg/installed if the docs seem to have been built correctly.  (Since after building each spkg, we delete the directory where it was built (spkg/build/numpy-...), we can't just rely on 'make' recognizing that it's already been installed, I think.)  Is this the right way to do it? A few things which I think belong on other tickets or which I don't know how to solve: 

To me, it seems okay to think about the docs install as a separate thing from the spkg install, so it makes sense to me to have a separate log file and separate placeholder file.  I don't know much about this part of the build process, though, so my +1 doesn't count for much.


> - With the approach here, running "sage -i ..." or "sage -f ..." won't install the docs.  Should we add something to the sage-spkg script which tries to build the docs if SAGE_SPKG_INSTALL_DOCS is "yes", but fails gracefully if it can't?  Or only build the docs in sage-spkg if we can tell that the Sage library has already been installed, or some other criterion like this?  This may end up with some code duplication, or separating out the doc-building stuff into a separate script (and then gets us entangled in the base repo vs. scripts repo debate...). 

Hmm...thinking about this one still...

> - I noticed that the most recent cython spkg (the one in 4.7.alpha4) has files for building the docs, at least some of which weren't added to the Mercurial repository.  I haven't checked the other spkgs for this sort of issue, but someone should...

Are you talking about the docs directory containing the documentation?  That directory is part of the upstream source, so shouldn't be in the spkg repository.  However, as of a week or two ago, that docs directory has been merged into the main Cython source tree, so future versions of the spkg will not have that docs directory.



---

archive/issue_comments_119941.json:
```json
{
    "body": "Replying to [comment:7 jason]:\n> Are you talking about the docs directory containing the documentation?  \n\nI mean that if I unpack cython-0.14.1.p2.spkg, cd into the directory and type \"hg status\", I see\n\n```\n? SPKG.txt.orig\n? doc/.hgignore\n? doc/Makefile\n? doc/README\n? doc/TODO\n? doc/_static/cython-logo-light.png\n? doc/_static/cythonlogo.png\n? doc/_static/favicon.ico\n? doc/_templates/layout.html\n? doc/conf.py\n? doc/examples/tutorial/fib1/fib.pyx\n? doc/examples/tutorial/fib1/setup.py\n? doc/examples/tutorial/great_circle/c1.pyx\n? doc/examples/tutorial/great_circle/c2.pyx\n? doc/examples/tutorial/great_circle/p1.py\n? doc/examples/tutorial/primes/primes.py\n? doc/examples/tutorial/primes/primes.pyx\n? doc/examples/tutorial/primes/setup.py\n? doc/index.rst\n? doc/sphinxext/cython_highlighting.py\n? doc/sphinxext/ipython_console_highlighting.py\n? doc/todo.txt\n? doc/welcome.rst\n```\n\nSo I guess those need to be added to .hginore, or the whole doc directory needs to added, or if everything in there has since been moved to src, we only need to get rid of SPKG.txt.orig.",
    "created_at": "2011-04-14T23:38:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119941",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:7 jason]:
> Are you talking about the docs directory containing the documentation?  

I mean that if I unpack cython-0.14.1.p2.spkg, cd into the directory and type "hg status", I see

```
? SPKG.txt.orig
? doc/.hgignore
? doc/Makefile
? doc/README
? doc/TODO
? doc/_static/cython-logo-light.png
? doc/_static/cythonlogo.png
? doc/_static/favicon.ico
? doc/_templates/layout.html
? doc/conf.py
? doc/examples/tutorial/fib1/fib.pyx
? doc/examples/tutorial/fib1/setup.py
? doc/examples/tutorial/great_circle/c1.pyx
? doc/examples/tutorial/great_circle/c2.pyx
? doc/examples/tutorial/great_circle/p1.py
? doc/examples/tutorial/primes/primes.py
? doc/examples/tutorial/primes/primes.pyx
? doc/examples/tutorial/primes/setup.py
? doc/index.rst
? doc/sphinxext/cython_highlighting.py
? doc/sphinxext/ipython_console_highlighting.py
? doc/todo.txt
? doc/welcome.rst
```

So I guess those need to be added to .hginore, or the whole doc directory needs to added, or if everything in there has since been moved to src, we only need to get rid of SPKG.txt.orig.



---

archive/issue_comments_119942.json:
```json
{
    "body": "Good point; the doc directory should be added to .hgignore.  And SPKG.txt.orig should be deleted.  Sorry; that seems pretty sloppy of me.",
    "created_at": "2011-04-15T00:15:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119942",
    "user": "https://github.com/jasongrout"
}
```

Good point; the doc directory should be added to .hgignore.  And SPKG.txt.orig should be deleted.  Sorry; that seems pretty sloppy of me.



---

archive/issue_comments_119943.json:
```json
{
    "body": "I've noted these changes on #10827.",
    "created_at": "2011-04-15T00:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119943",
    "user": "https://github.com/jasongrout"
}
```

I've noted these changes on #10827.



---

archive/issue_comments_119944.json:
```json
{
    "body": "Replying to [comment:9 jason]:\n> Good point; the doc directory should be added to .hgignore.  And SPKG.txt.orig should be deleted.  Sorry; that seems pretty sloppy of me.\n\nI've made those kinds of mistakes lots of times myself...",
    "created_at": "2011-04-15T02:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119944",
    "user": "https://github.com/jhpalmieri"
}
```

Replying to [comment:9 jason]:
> Good point; the doc directory should be added to .hgignore.  And SPKG.txt.orig should be deleted.  Sorry; that seems pretty sloppy of me.

I've made those kinds of mistakes lots of times myself...



---

archive/issue_comments_119945.json:
```json
{
    "body": "If we are moving to a two-step binary / documentation build process, how about we remove the `SAGE_SPKG_INSTALL_DOCS` environment variable and, instead, provide a \"doc\" target in the main Makefile. So you can just \"make doc\", thats much easier to discover than a cryptic environment variable.",
    "created_at": "2011-04-15T14:24:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119945",
    "user": "https://github.com/vbraun"
}
```

If we are moving to a two-step binary / documentation build process, how about we remove the `SAGE_SPKG_INSTALL_DOCS` environment variable and, instead, provide a "doc" target in the main Makefile. So you can just "make doc", thats much easier to discover than a cryptic environment variable.



---

archive/issue_comments_119946.json:
```json
{
    "body": "Replying to [comment:12 vbraun]:\n> If we are moving to a two-step binary / documentation build process, how about we remove the `SAGE_SPKG_INSTALL_DOCS` environment variable and, instead, provide a \"doc\" target in the main Makefile. So you can just \"make doc\", thats much easier to discover than a cryptic environment variable.\n\n+1",
    "created_at": "2011-04-15T15:06:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119946",
    "user": "https://github.com/jasongrout"
}
```

Replying to [comment:12 vbraun]:
> If we are moving to a two-step binary / documentation build process, how about we remove the `SAGE_SPKG_INSTALL_DOCS` environment variable and, instead, provide a "doc" target in the main Makefile. So you can just "make doc", thats much easier to discover than a cryptic environment variable.

+1



---

archive/issue_comments_119947.json:
```json
{
    "body": "Maybe we should clearly distinguish between sage's documentation and spkg documentation.  I'd expect make doc to just build Sage's documentation.  Maybe we could have two targets:  make doc (build and install Sage docs) and make spkg-doc (build and install any spkg docs).",
    "created_at": "2011-04-15T15:08:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119947",
    "user": "https://github.com/jasongrout"
}
```

Maybe we should clearly distinguish between sage's documentation and spkg documentation.  I'd expect make doc to just build Sage's documentation.  Maybe we could have two targets:  make doc (build and install Sage docs) and make spkg-doc (build and install any spkg docs).



---

archive/issue_comments_119948.json:
```json
{
    "body": "Here's a new patch.  This does the Makefile approach.  I think I like the Makefile approach, but I'm not positive, so I'm marking this as \"needs info\".  Please provide opinions about the two approaches and also about the specific patches.",
    "created_at": "2011-04-16T01:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119948",
    "user": "https://github.com/jhpalmieri"
}
```

Here's a new patch.  This does the Makefile approach.  I think I like the Makefile approach, but I'm not positive, so I'm marking this as "needs info".  Please provide opinions about the two approaches and also about the specific patches.



---

archive/issue_comments_119949.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2011-04-16T01:08:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119949",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_119950.json:
```json
{
    "body": "root repo; implement \"make spkg-doc\" from SAGE_ROOT",
    "created_at": "2011-04-16T01:09:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119950",
    "user": "https://github.com/jhpalmieri"
}
```

root repo; implement "make spkg-doc" from SAGE_ROOT



---

archive/issue_comments_119951.json:
```json
{
    "body": "Attachment [trac_11197-spkg-install-docs.v2.patch](tarball://root/attachments/some-uuid/ticket11197/trac_11197-spkg-install-docs.v2.patch) by @williamstein created at 2011-08-24 23:39:45",
    "created_at": "2011-08-24T23:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119951",
    "user": "https://github.com/williamstein"
}
```

Attachment [trac_11197-spkg-install-docs.v2.patch](tarball://root/attachments/some-uuid/ticket11197/trac_11197-spkg-install-docs.v2.patch) by @williamstein created at 2011-08-24 23:39:45



---

archive/issue_comments_119952.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd32\".",
    "created_at": "2011-08-24T23:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119952",
    "user": "https://github.com/williamstein"
}
```

Changing keywords from "" to "sd32".



---

archive/issue_comments_119953.json:
```json
{
    "body": "Hmmm, one problem I see is that a couple of spkgs would need a (re)`configure` before e.g. `make install-docs` etc. would work.\n\nAlso, many packages provide [alternate] documentation in various formats (man pages, texinfo files, HTML, dvi / PDF etc.), some of which require tools (i.e., prerequisites either provided by the system or Sage), and some even some small build process just to prepare the sources for other tools. So it isn't always clear *what* would be installed [in addition]. Re-unpacking and re-configuring an spkg just to install docs is IMHO also a bit odd, just like keeping the build directories until eventually some tools are available after the normal build has finished.\n\nThe easiest way would be to simply include some *pre-built* versions of documentation requiring external tools, and just copy / install them if `SAGE_SPKG_INSTALL_DOCS=yes` or an spkg's `spkg-install-docs` is run. This could at least in some cases increase an spkg's size significantly though.",
    "created_at": "2011-08-26T00:08:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119953",
    "user": "https://github.com/nexttime"
}
```

Hmmm, one problem I see is that a couple of spkgs would need a (re)`configure` before e.g. `make install-docs` etc. would work.

Also, many packages provide [alternate] documentation in various formats (man pages, texinfo files, HTML, dvi / PDF etc.), some of which require tools (i.e., prerequisites either provided by the system or Sage), and some even some small build process just to prepare the sources for other tools. So it isn't always clear *what* would be installed [in addition]. Re-unpacking and re-configuring an spkg just to install docs is IMHO also a bit odd, just like keeping the build directories until eventually some tools are available after the normal build has finished.

The easiest way would be to simply include some *pre-built* versions of documentation requiring external tools, and just copy / install them if `SAGE_SPKG_INSTALL_DOCS=yes` or an spkg's `spkg-install-docs` is run. This could at least in some cases increase an spkg's size significantly though.



---

archive/issue_comments_119954.json:
```json
{
    "body": "We could also support some kind of `SAGE_SPKG_INSTALL_DOCS=no` (and `=later`) in `spkg-install`, but that still doesn't tell *which kind of* documentation.\n\n(I personally would for example always install man pages by default, if available.)\n\n\nNo matter if we build / install any documents for some spkg (or whether they are available at all in the spkg itself), we could create HTML pages with links to upstream [documentation] if appropriate.\n\nSame could be done for licenses.",
    "created_at": "2011-08-26T00:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119954",
    "user": "https://github.com/nexttime"
}
```

We could also support some kind of `SAGE_SPKG_INSTALL_DOCS=no` (and `=later`) in `spkg-install`, but that still doesn't tell *which kind of* documentation.

(I personally would for example always install man pages by default, if available.)


No matter if we build / install any documents for some spkg (or whether they are available at all in the spkg itself), we could create HTML pages with links to upstream [documentation] if appropriate.

Same could be done for licenses.



---

archive/issue_comments_119955.json:
```json
{
    "body": "Right now, I'm more in favor of adding a target to the Makefile, rather than the environment variable approach.\n\nReplying to [comment:17 leif]:\n> Hmmm, one problem I see is that a couple of spkgs would need a (re)`configure` before e.g. `make install-docs` etc. would work.\n\nWell, this would be taken care of by the doc install script for the particular spkg.  The whole point of this ticket is to install the docs separately from the full build, so I'm not sure I understand your concerns.  If you want to build the docs during the build, use the approach in #10823, and the spkg-install file can take care of the proper configurations to do things efficiently.  (So maybe some spkgs would behave differently depending on whether you ran `make spkg-doc` compared to `make` with `SAGE_SPKG_INSTALL_DOCS=yes`: in the first case, a special script `spkg-install-docs` would be run, while in the first case, the code would be in `spkg-install`.  Or is that too complicated?)\n\n> Also, many packages provide [alternate] documentation in various formats (man pages, texinfo files, HTML, dvi / PDF etc.), some of which require tools (i.e., prerequisites either provided by the system or Sage), and some even some small build process just to prepare the sources for other tools. So it isn't always clear *what* would be installed [in addition]. Re-unpacking and re-configuring an spkg just to install docs is IMHO also a bit odd, just like keeping the build directories until eventually some tools are available after the normal build has finished.\n\nThere could be several possible targets: `make spkg-doc` which would build whatever the spkg maintainers thought was a sensible default, but also `make spkg-doc-html`, `make spkg-doc-man`, etc.  Perhaps the script `spkg/install-spkg-docs ` should pass an argument (\"html\", \"pdf\", \"default\", etc.) to each individual `spkg-install-docs` script.\n\n> The easiest way would be to simply include some *pre-built* versions of documentation requiring external tools, and just copy / install them if `SAGE_SPKG_INSTALL_DOCS=yes` or an spkg's `spkg-install-docs` is run. This could at least in some cases increase an spkg's size significantly though.\n\nI don't think the size increase would be acceptable.\n\nReplying to [comment:18 leif]:\n> We could also support some kind of `SAGE_SPKG_INSTALL_DOCS=no` (and `=later`) in `spkg-install`, but that still doesn't tell *which kind of* documentation.\n\nor `SAGE_SPKG_INSTALL_DOCS=html`\n\n> No matter if we build / install any documents for some spkg (or whether they are available at all in the spkg itself), we could create HTML pages with links to upstream [documentation] if appropriate.\n\nSure, that sounds like a good idea.  Probably for another ticket, once we get this framework set up.  At least, setting up these html pages would seem to require another set of ideas and therefore add another level of complications.",
    "created_at": "2011-08-26T01:35:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119955",
    "user": "https://github.com/jhpalmieri"
}
```

Right now, I'm more in favor of adding a target to the Makefile, rather than the environment variable approach.

Replying to [comment:17 leif]:
> Hmmm, one problem I see is that a couple of spkgs would need a (re)`configure` before e.g. `make install-docs` etc. would work.

Well, this would be taken care of by the doc install script for the particular spkg.  The whole point of this ticket is to install the docs separately from the full build, so I'm not sure I understand your concerns.  If you want to build the docs during the build, use the approach in #10823, and the spkg-install file can take care of the proper configurations to do things efficiently.  (So maybe some spkgs would behave differently depending on whether you ran `make spkg-doc` compared to `make` with `SAGE_SPKG_INSTALL_DOCS=yes`: in the first case, a special script `spkg-install-docs` would be run, while in the first case, the code would be in `spkg-install`.  Or is that too complicated?)

> Also, many packages provide [alternate] documentation in various formats (man pages, texinfo files, HTML, dvi / PDF etc.), some of which require tools (i.e., prerequisites either provided by the system or Sage), and some even some small build process just to prepare the sources for other tools. So it isn't always clear *what* would be installed [in addition]. Re-unpacking and re-configuring an spkg just to install docs is IMHO also a bit odd, just like keeping the build directories until eventually some tools are available after the normal build has finished.

There could be several possible targets: `make spkg-doc` which would build whatever the spkg maintainers thought was a sensible default, but also `make spkg-doc-html`, `make spkg-doc-man`, etc.  Perhaps the script `spkg/install-spkg-docs ` should pass an argument ("html", "pdf", "default", etc.) to each individual `spkg-install-docs` script.

> The easiest way would be to simply include some *pre-built* versions of documentation requiring external tools, and just copy / install them if `SAGE_SPKG_INSTALL_DOCS=yes` or an spkg's `spkg-install-docs` is run. This could at least in some cases increase an spkg's size significantly though.

I don't think the size increase would be acceptable.

Replying to [comment:18 leif]:
> We could also support some kind of `SAGE_SPKG_INSTALL_DOCS=no` (and `=later`) in `spkg-install`, but that still doesn't tell *which kind of* documentation.

or `SAGE_SPKG_INSTALL_DOCS=html`

> No matter if we build / install any documents for some spkg (or whether they are available at all in the spkg itself), we could create HTML pages with links to upstream [documentation] if appropriate.

Sure, that sounds like a good idea.  Probably for another ticket, once we get this framework set up.  At least, setting up these html pages would seem to require another set of ideas and therefore add another level of complications.



---

archive/issue_comments_119956.json:
```json
{
    "body": "Replying to [ticket:11197 jason]:\n> Following on some concerns brought up about dependencies in building spkg docs, as implemented in #10823\n\nWhat are these \"concerns\"? Can these \"concerns\" be fixed in a simpler way than adding more complexities to the Sage build procedure?",
    "created_at": "2014-11-13T14:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119956",
    "user": "https://github.com/jdemeyer"
}
```

Replying to [ticket:11197 jason]:
> Following on some concerns brought up about dependencies in building spkg docs, as implemented in #10823

What are these "concerns"? Can these "concerns" be fixed in a simpler way than adding more complexities to the Sage build procedure?



---

archive/issue_comments_119957.json:
```json
{
    "body": "Changing component from packages: standard to build.",
    "created_at": "2014-11-13T14:15:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119957",
    "user": "https://github.com/jdemeyer"
}
```

Changing component from packages: standard to build.



---

archive/issue_comments_119958.json:
```json
{
    "body": "I think it needs to be clarified why this ticket is needed.",
    "created_at": "2015-09-16T08:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119958",
    "user": "https://github.com/jdemeyer"
}
```

I think it needs to be clarified why this ticket is needed.



---

archive/issue_comments_119959.json:
```json
{
    "body": "I think the situation is:\n- we want to be able to install documentation for any of the various packages that provide it, but\n- building the documentation may have different prerequisites (e.g., Sphinx) than building the package itself.\nIt sounds like the plan in this ticket was to build documentation for the packages at the same time as building the regular Sage documentation.",
    "created_at": "2015-09-17T18:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119959",
    "user": "https://github.com/jhpalmieri"
}
```

I think the situation is:
- we want to be able to install documentation for any of the various packages that provide it, but
- building the documentation may have different prerequisites (e.g., Sphinx) than building the package itself.
It sounds like the plan in this ticket was to build documentation for the packages at the same time as building the regular Sage documentation.



---

archive/issue_comments_119960.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2021-12-02T01:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119960",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_119961.json:
```json
{
    "body": "outdated, should close",
    "created_at": "2021-12-02T01:13:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119961",
    "user": "https://github.com/mkoeppe"
}
```

outdated, should close



---

archive/issue_comments_119962.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-12-02T02:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119962",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_119963.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-12-03T18:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11027",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11027#issuecomment-119963",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid
