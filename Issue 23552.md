# Issue 23552: Drop -std=gnu99 from $CC

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2017-09-06 09:08:23

CC:  mkoeppe fbissey

This is bad:

```
$ env |grep 99
CONFIGURED_CC=gcc -std=gnu99
CC=gcc -std=gnu99
```

I did not ask for `-std=gnu99` and `configure` should not unilaterally decide that I want that.

In particular, there is a long-standing Python bug causing distutils to use `$CC` to compile C++ code leading to plenty of warnings

```
cc1plus: warning: command line option ‘-std=gnu99’ is valid for C/ObjC but not for C++
```

If I recall correctly, the analogous behaviour for clang is a hard error instead of a warning. So this might break a clang build.


---

Comment by fbissey created at 2017-09-06 09:11:13

That should only happen if we use `AC_PROG_CC_C99` in `configure.ac`.


---

Comment by jdemeyer created at 2017-09-06 09:13:51

Replying to [comment:1 fbissey]:
> That should only happen if we use `AC_PROG_CC_C99` in `configure.ac`.
...which we do in order to check that C99 is supported:

```
if test -z "$CC"; then
    SAGE_MUST_INSTALL_GCC([a C compiler is missing])
else
    # Check that we can compile C99 code
    AC_PROG_CC_C99()
    if test "x$ac_cv_prog_cc_c99" = xno
    then
        SAGE_MUST_INSTALL_GCC([your C compiler cannot compile C99 code])
    fi
fi
```



---

Comment by fbissey created at 2017-09-06 09:17:59

Right! If we don't want to default to C99 then we have to be more careful and save the compiler before testing C99 and then reset it since that macro will change `CC`.
I guess this is only troublesome for older gcc (4.x I think) which don't default to C99 without a flag. clang and recent gcc default to at least that or better, so no flag is needed or added. That must say something on who's testing :)


---

Comment by jdemeyer created at 2017-09-06 09:18:42

The easiest solution is probably to save the value of `$CC` before the test and then restore it.


---

Comment by fbissey created at 2017-09-06 09:19:27

Replying to [comment:4 jdemeyer]:
> The easiest solution is probably to save the value of `$CC` before the test and then restore it.

+1


---

Comment by jdemeyer created at 2017-09-06 09:20:01

Replying to [comment:3 fbissey]:
> I guess this is only troublesome for older gcc (4.x I think) which don't default to C99 without a flag.

I'm using

```
gcc (Gentoo 4.9.4 p1.0, pie-0.6.4) 4.9.4
Copyright (C) 2015 Free Software Foundation, Inc.
This is free software; see the source for copying conditions.  There is NO
warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
```



---

Comment by jdemeyer created at 2017-09-06 09:21:08

I'm currently working on some other things. Feel free to implement this, otherwise I'll do it later.


---

Comment by fbissey created at 2017-09-06 09:31:49

I do not have the compiler to test this. It will probably need its own configure tarball. But some testing first.


---

Comment by jdemeyer created at 2017-09-06 10:10:43

Replying to [comment:8 fbissey]:
> It will probably need its own configure tarball.

No, this is just a minor bug fix.


---

Comment by git created at 2017-09-07 01:20:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2017-09-07 01:20:58

Changing status from new to needs_review.


---

Comment by fbissey created at 2017-09-07 01:20:58

Now with a commit.


---

Comment by jdemeyer created at 2017-09-07 08:06:55

Typo: `cheking`


---

Comment by jdemeyer created at 2017-09-07 09:29:07

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-09-07 09:29:07

New commits:


---

Comment by fbissey created at 2017-09-07 09:31:39

Thanks for taking over. I was busy with "bedtime stories" for my son :)


---

Comment by vbraun created at 2017-09-10 22:06:03

Resolution: fixed
