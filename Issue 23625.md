# Issue 23625: speed_up_left_and_right_key

archive/issues_023625.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/23862\n\n",
    "created_at": "2017-09-14T21:31:31Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "speed_up_left_and_right_key",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23625",
    "user": "https://github.com/mantepse"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/23862





---

archive/issue_comments_330552.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2017-09-14T21:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330552",
    "user": "https://github.com/mantepse"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_330553.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-14T21:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330553",
    "user": "https://github.com/mantepse"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330554.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-09-14T21:42:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330554",
    "user": "https://github.com/mantepse"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_330555.json:
```json
{
    "body": "Some possible improvements:\n- if your tableau has only one row you just have to test whether the first and last elements coincide (ie no need to take the time consuming conjugate)\n- similarly, if your tableaux has one column there is nothing to check\n- now for the remaining cases, you would better use `set.issubset` as in\n\n```\ns = set(T_conj[0])\nfor i in range(1, len(T_conj)):\n    ss = set(T_conj[i])\n    if not ss.issubset(s):\n        return False\n    s = ss\n```\n\n  Doing loops is always a bad idea in Python. If you need speed, avoid them as much as possible.",
    "created_at": "2017-09-15T07:59:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330555",
    "user": "https://github.com/videlec"
}
```

Some possible improvements:
- if your tableau has only one row you just have to test whether the first and last elements coincide (ie no need to take the time consuming conjugate)
- similarly, if your tableaux has one column there is nothing to check
- now for the remaining cases, you would better use `set.issubset` as in

```
s = set(T_conj[0])
for i in range(1, len(T_conj)):
    ss = set(T_conj[i])
    if not ss.issubset(s):
        return False
    s = ss
```

  Doing loops is always a bad idea in Python. If you need speed, avoid them as much as possible.



---

archive/issue_comments_330556.json:
```json
{
    "body": "Thanks for looking!  One quick thing: I thought about using sets, but apparently I cannot assume that the elements of the tableau are hashable.\n\nI am guessing though that the method doesn't make sense then...",
    "created_at": "2017-09-15T09:52:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330556",
    "user": "https://github.com/mantepse"
}
```

Thanks for looking!  One quick thing: I thought about using sets, but apparently I cannot assume that the elements of the tableau are hashable.

I am guessing though that the method doesn't make sense then...



---

archive/issue_comments_330557.json:
```json
{
    "body": "Indeed... I thought your entries would always be integers. I am not a tableau specialist at all and I just looked at your example from the ticket description where the rows are even non-decreasing. You can still either\n   - try with sets inside a `try/except` and relies on the other version for non-hashable ones\n   - have a boolean flag somewhere `hashable` or `integer_entries` or `increasing` or ... (default to `False`) that would switch to more efficient versions\n\nPerhaps it is too much bikeshedding...",
    "created_at": "2017-09-15T09:57:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330557",
    "user": "https://github.com/videlec"
}
```

Indeed... I thought your entries would always be integers. I am not a tableau specialist at all and I just looked at your example from the ticket description where the rows are even non-decreasing. You can still either
   - try with sets inside a `try/except` and relies on the other version for non-hashable ones
   - have a boolean flag somewhere `hashable` or `integer_entries` or `increasing` or ... (default to `False`) that would switch to more efficient versions

Perhaps it is too much bikeshedding...



---

archive/issue_comments_330558.json:
```json
{
    "body": "Since `is_key_tableau` is (after this patch) unused in sage, I'd rather leave it at that and spend my energy elsewhere (in particular, in `Tableau.conjugate`)",
    "created_at": "2017-09-15T11:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330558",
    "user": "https://github.com/mantepse"
}
```

Since `is_key_tableau` is (after this patch) unused in sage, I'd rather leave it at that and spend my energy elsewhere (in particular, in `Tableau.conjugate`)



---

archive/issue_comments_330559.json:
```json
{
    "body": "Also, it is faster to use just one `all` check, which does short-circuit as soon as it gets a `False` with generators:\n\n```python\nreturn all(x in T_conj[i-1] for i in range(1, len(T_conj)) for x in T_conj[i])\n```\n\nThe definition allows general elements; however, I think it is a fair assumption that all entries of the tableau are hashable.",
    "created_at": "2017-09-15T21:07:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330559",
    "user": "https://github.com/tscrim"
}
```

Also, it is faster to use just one `all` check, which does short-circuit as soon as it gets a `False` with generators:

```python
return all(x in T_conj[i-1] for i in range(1, len(T_conj)) for x in T_conj[i])
```

The definition allows general elements; however, I think it is a fair assumption that all entries of the tableau are hashable.



---

archive/issue_comments_330560.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-18T06:38:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330560",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330561.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-10-07T08:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330561",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330562.json:
```json
{
    "body": "ok",
    "created_at": "2017-10-07T08:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330562",
    "user": "https://github.com/fchapoton"
}
```

ok



---

archive/issue_comments_330563.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-10-15T09:22:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23625#issuecomment-330563",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_060785.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-10-15T09:22:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/23625",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/23625#event-60785"
}
```
