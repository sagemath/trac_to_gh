# Issue 23625: speed_up_left_and_right_key

Issue created by migration from Trac.

Original creator: mantepse

Original creation time: 2017-09-14 21:31:31




---

Comment by mantepse created at 2017-09-14 21:42:06

Changing component from PLEASE CHANGE to combinatorics.


---

Comment by mantepse created at 2017-09-14 21:42:06

Changing status from new to needs_review.


---

Comment by mantepse created at 2017-09-14 21:42:06

Changing type from PLEASE CHANGE to enhancement.


---

Comment by vdelecroix created at 2017-09-15 07:59:38

Some possible improvements:
- if your tableau has only one row you just have to test whether the first and last elements coincide (ie no need to take the time consuming conjugate)
- similarly, if your tableaux has one column there is nothing to check
- now for the remaining cases, you would better use `set.issubset` as in

```
s = set(T_conj[0])
for i in range(1, len(T_conj)):
    ss = set(T_conj[i])
    if not ss.issubset(s):
        return False
    s = ss
```

  Doing loops is always a bad idea in Python. If you need speed, avoid them as much as possible.


---

Comment by mantepse created at 2017-09-15 09:52:26

Thanks for looking!  One quick thing: I thought about using sets, but apparently I cannot assume that the elements of the tableau are hashable.

I am guessing though that the method doesn't make sense then...


---

Comment by vdelecroix created at 2017-09-15 09:57:37

Indeed... I thought your entries would always be integers. I am not a tableau specialist at all and I just looked at your example from the ticket description where the rows are even non-decreasing. You can still either
 - try with sets inside a `try/except` and relies on the other version for non-hashable ones
 - have a boolean flag somewhere `hashable` or `integer_entries` or `increasing` or ... (default to `False`) that would switch to more efficient versions

Perhaps it is too much bikeshedding...


---

Comment by mantepse created at 2017-09-15 11:59:11

Since `is_key_tableau` is (after this patch) unused in sage, I'd rather leave it at that and spend my energy elsewhere (in particular, in `Tableau.conjugate`)


---

Comment by tscrim created at 2017-09-15 21:07:14

Also, it is faster to use just one `all` check, which does short-circuit as soon as it gets a `False` with generators:

```python
return all(x in T_conj[i-1] for i in range(1, len(T_conj)) for x in T_conj[i])
```

The definition allows general elements; however, I think it is a fair assumption that all entries of the tableau are hashable.


---

Comment by git created at 2017-09-18 06:38:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-10-07 08:06:04

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2017-10-07 08:06:04

ok


---

Comment by vbraun created at 2017-10-15 09:22:18

Resolution: fixed
