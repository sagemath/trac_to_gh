# Issue 14476: fix broken optional dot2tex doctests

archive/issues_014476.json:
```json
{
    "body": "Assignee: mvngu\n\nCC:  @nexttime\n\nSome optional dot2tex doctests are broken. Running `sage -t --optional=dot2tex,graphviz,sage` on the files containing the string `dot2tex`, I get the following errors (with sage-6.3.beta1):\n\n```\n----------------------------------------------------------------------\nsage -t sage/combinat/posets/posets.py  # 1 doctest failed\nsage -t sage/graphs/graph_latex.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\nMore precisely:\n\n```\nsage -t sage/combinat/posets/posets.py\n**********************************************************************\nFile \"sage/combinat/posets/posets.py\", line 1118, in sage.combinat.posets.posets.FinitePoset._latex_\nFailed example:\n    print P._latex_() #optional - dot2tex graphviz\nExpected:\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n    \\node (node_1) at (6bp,57bp) [draw,draw=none] {$2$};\n      \\node (node_0) at (6bp,7bp) [draw,draw=none] {$1$};\n      \\draw [black,<-] (node_1) ..controls (6bp,31.269bp) and (6bp,20.287bp)  .. (node_0);\n    %\n    \\end{tikzpicture}\nGot:\n    <BLANKLINE>\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n    \\node (node_1) at (6.000000bp,57.000000bp) [draw,draw=none] {$2$};\n      \\node (node_0) at (6.000000bp,7.000000bp) [draw,draw=none] {$1$};\n      \\draw [black,<-] (node_1) ..controls (6.000000bp,31.269000bp) and (6.000000bp,20.287000bp)  .. (node_0);\n    %\n    \\end{tikzpicture}\n    <BLANKLINE>\n**********************************************************************\n```\n\nand\n\n```\nsage -t sage/graphs/graph_latex.py\n**********************************************************************\nFile \"sage/graphs/graph_latex.py\", line 1346, in sage.graphs.graph_latex.GraphLatex.dot2tex_picture\nFailed example:\n    print G.latex_options().dot2tex_picture() # optional - dot2tex graphviz\nExpected:\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n    \\node (3333) at (...bp,...bp) [draw,draw=none] {$3333$};\n      \\node (88) at (...bp,...bp) [draw,draw=none] {$88$};\n      \\draw [black,->] (3333) ..controls (...bp,...bp) and (...bp,...bp)  .. (88);\n      \\definecolor{strokecol}{rgb}{0.0,0.0,0.0};\n      \\pgfsetstrokecolor{strokecol}\n      \\draw (...bp,...bp) node {$\\text{\\texttt{my{\\char`\\_}label}}$};\n    %\n    \\end{tikzpicture}\nGot:\n    <BLANKLINE>\n    \\begin{tikzpicture}[>=latex,line join=bevel,]\n    %%\n    \\node (node_1) at (13.000000bp,79.000000bp) [draw,draw=none] {$3333$};\n      \\node (node_0) at (13.000000bp,7.000000bp) [draw,draw=none] {$88$};\n      \\draw [black,->] (node_1) ..controls (13.000000bp,61.492000bp) and (13.000000bp,39.255000bp)  .. (node_0);\n      \\definecolor{strokecol}{rgb}{0.0,0.0,0.0};\n      \\pgfsetstrokecolor{strokecol}\n      \\draw (40.000000bp,43.000000bp) node {$\\text{\\texttt{my{\\char`\\_}label}}$};\n    %\n    \\end{tikzpicture}\n    <BLANKLINE>\n**********************************************************************\n```                                  \n\nFor the record, the list of files containing the string \"dot2tex\" (so probably containging dot2tex optional doctests) is :\n\n```\nsage/categories/crystals.py\nsage/combinat/crystals/crystals.py\nsage/combinat/perfect_matching.py\nsage/combinat/posets/linear_extensions.py\nsage/combinat/posets/posets.py\nsage/combinat/rigged_configurations/kleber_tree.py\nsage/graphs/digraph.py\nsage/graphs/dot2tex_utils.py\nsage/graphs/generic_graph.py\nsage/graphs/graph.py\nsage/graphs/graph_latex.py\n```\n\nIt is not the first time that dot2tex doctests are broken:\n\n- http://trac.sagemath.org/sage_trac/ticket/14408#comment:15\n- http://trac.sagemath.org/sage_trac/ticket/14594#comment:30\n- http://trac.sagemath.org/sage_trac/ticket/13624#comment:43\n\nIssue created by migration from https://trac.sagemath.org/ticket/14680\n\n",
    "closed_at": "2014-05-29T18:54:22Z",
    "created_at": "2013-06-03T15:38:21Z",
    "labels": [
        "component: doctest coverage",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "fix broken optional dot2tex doctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/14476",
    "user": "https://github.com/seblabbe"
}
```
Assignee: mvngu

CC:  @nexttime

Some optional dot2tex doctests are broken. Running `sage -t --optional=dot2tex,graphviz,sage` on the files containing the string `dot2tex`, I get the following errors (with sage-6.3.beta1):

```
----------------------------------------------------------------------
sage -t sage/combinat/posets/posets.py  # 1 doctest failed
sage -t sage/graphs/graph_latex.py  # 1 doctest failed
----------------------------------------------------------------------
```

More precisely:

```
sage -t sage/combinat/posets/posets.py
**********************************************************************
File "sage/combinat/posets/posets.py", line 1118, in sage.combinat.posets.posets.FinitePoset._latex_
Failed example:
    print P._latex_() #optional - dot2tex graphviz
Expected:
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (node_1) at (6bp,57bp) [draw,draw=none] {$2$};
      \node (node_0) at (6bp,7bp) [draw,draw=none] {$1$};
      \draw [black,<-] (node_1) ..controls (6bp,31.269bp) and (6bp,20.287bp)  .. (node_0);
    %
    \end{tikzpicture}
Got:
    <BLANKLINE>
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (node_1) at (6.000000bp,57.000000bp) [draw,draw=none] {$2$};
      \node (node_0) at (6.000000bp,7.000000bp) [draw,draw=none] {$1$};
      \draw [black,<-] (node_1) ..controls (6.000000bp,31.269000bp) and (6.000000bp,20.287000bp)  .. (node_0);
    %
    \end{tikzpicture}
    <BLANKLINE>
**********************************************************************
```

and

```
sage -t sage/graphs/graph_latex.py
**********************************************************************
File "sage/graphs/graph_latex.py", line 1346, in sage.graphs.graph_latex.GraphLatex.dot2tex_picture
Failed example:
    print G.latex_options().dot2tex_picture() # optional - dot2tex graphviz
Expected:
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (3333) at (...bp,...bp) [draw,draw=none] {$3333$};
      \node (88) at (...bp,...bp) [draw,draw=none] {$88$};
      \draw [black,->] (3333) ..controls (...bp,...bp) and (...bp,...bp)  .. (88);
      \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
      \pgfsetstrokecolor{strokecol}
      \draw (...bp,...bp) node {$\text{\texttt{my{\char`\_}label}}$};
    %
    \end{tikzpicture}
Got:
    <BLANKLINE>
    \begin{tikzpicture}[>=latex,line join=bevel,]
    %%
    \node (node_1) at (13.000000bp,79.000000bp) [draw,draw=none] {$3333$};
      \node (node_0) at (13.000000bp,7.000000bp) [draw,draw=none] {$88$};
      \draw [black,->] (node_1) ..controls (13.000000bp,61.492000bp) and (13.000000bp,39.255000bp)  .. (node_0);
      \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
      \pgfsetstrokecolor{strokecol}
      \draw (40.000000bp,43.000000bp) node {$\text{\texttt{my{\char`\_}label}}$};
    %
    \end{tikzpicture}
    <BLANKLINE>
**********************************************************************
```                                  

For the record, the list of files containing the string "dot2tex" (so probably containging dot2tex optional doctests) is :

```
sage/categories/crystals.py
sage/combinat/crystals/crystals.py
sage/combinat/perfect_matching.py
sage/combinat/posets/linear_extensions.py
sage/combinat/posets/posets.py
sage/combinat/rigged_configurations/kleber_tree.py
sage/graphs/digraph.py
sage/graphs/dot2tex_utils.py
sage/graphs/generic_graph.py
sage/graphs/graph.py
sage/graphs/graph_latex.py
```

It is not the first time that dot2tex doctests are broken:

- http://trac.sagemath.org/sage_trac/ticket/14408#comment:15
- http://trac.sagemath.org/sage_trac/ticket/14594#comment:30
- http://trac.sagemath.org/sage_trac/ticket/13624#comment:43

Issue created by migration from https://trac.sagemath.org/ticket/14680





---

archive/issue_comments_182940.json:
```json
{
    "body": "This patch fixes some dot2tex broken optional doctests in graph_latex and generic_graph",
    "created_at": "2013-06-03T15:41:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182940",
    "user": "https://github.com/seblabbe"
}
```

This patch fixes some dot2tex broken optional doctests in graph_latex and generic_graph



---

archive/issue_comments_182941.json:
```json
{
    "body": "Attachment [trac_14680_fix_some_dot2tex_doctests-sl.patch](tarball://root/attachments/some-uuid/ticket14680/trac_14680_fix_some_dot2tex_doctests-sl.patch) by @nexttime created at 2013-06-03 15:44:18",
    "created_at": "2013-06-03T15:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182941",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_14680_fix_some_dot2tex_doctests-sl.patch](tarball://root/attachments/some-uuid/ticket14680/trac_14680_fix_some_dot2tex_doctests-sl.patch) by @nexttime created at 2013-06-03 15:44:18



---

archive/issue_events_041976.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:35:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41976"
}
```



---

archive/issue_events_041977.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41977"
}
```



---

archive/issue_events_041978.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41978"
}
```



---

archive/issue_comments_182942.json:
```json
{
    "body": "I think we took care of a bunch/all of them in #16026, but we should (probably I will) double check and fix any others that we missed.",
    "created_at": "2014-04-04T15:46:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182942",
    "user": "https://github.com/tscrim"
}
```

I think we took care of a bunch/all of them in #16026, but we should (probably I will) double check and fix any others that we missed.



---

archive/issue_events_041979.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41979"
}
```



---

archive/issue_events_041980.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:20:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41980"
}
```



---

archive/issue_comments_182943.json:
```json
{
    "body": "I am updating this ticket description for broken optional dot2tex doctests in 6.3.beta1.",
    "created_at": "2014-05-14T08:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182943",
    "user": "https://github.com/seblabbe"
}
```

I am updating this ticket description for broken optional dot2tex doctests in 6.3.beta1.



---

archive/issue_comments_182944.json:
```json
{
    "body": "Needs review.\n\n---\nNew commits:",
    "created_at": "2014-05-14T09:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182944",
    "user": "https://github.com/seblabbe"
}
```

Needs review.

---
New commits:



---

archive/issue_comments_182945.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-14T09:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182945",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_182946.json:
```json
{
    "body": "Running `sage -tp --long --optional=dot2tex,graphviz,sage --all` passes all tests.",
    "created_at": "2014-05-29T14:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182946",
    "user": "https://github.com/a-andre"
}
```

Running `sage -tp --long --optional=dot2tex,graphviz,sage --all` passes all tests.



---

archive/issue_comments_182947.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-05-29T14:41:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182947",
    "user": "https://github.com/a-andre"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_182948.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-05-29T18:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/14476#issuecomment-182948",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_041981.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-05-29T18:54:22Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/14476",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/14476#event-41981"
}
```
