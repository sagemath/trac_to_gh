# Issue 26685: Wrong f-vector for unbounded polyhedra

Issue created by migration from Trac.

Original creator: @kliem

Original creation time: 2018-12-20 12:49:53

CC:  jipilab moritz


```
sage: Polyhedron(ieqs=[[1,-1,0],[1,1,0]]).f_vector()
(1, 2, 1)
```

This polyhedron does not have zero-dimensional faces, does it?


---

Comment by @kliem created at 2019-01-12 16:43:43

This will be probably solved at some point by
#26887
The calculation is correct there.

Also it can be corrected quickly now by calculating the dimension of the first level in the face lattice.


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by jipilab created at 2019-07-22 12:37:40

In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.

So, depending on the definition of the f-vector:

 * Counting the number of elements at each level of the face lattice
 * Vector counting the number of faces by dimension

It should return different things.

One thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.


---

Comment by @kliem created at 2019-07-22 19:00:21

#27063 will change the calculation of the f-vector (hopefully soon) to make use of `CombinatorialPolyhedron`.

This will count the number of faces per dimension, as the docstring of `f_vector` states (there is a +2 or -2 two missing, as the first entry gives the -1-dimensional faces count.

We could make this ticket depend on #27063 and then just append the docstring accordingly.

One could also fix it for now (just append a few zeros according to `n_lines`).

Replying to [comment:5 jipilab]:
> In principle, the problem is that the face lattice has four elements, but the elements on the second level are not 0-dimensional, but 1-dimensional.
> 
> So, depending on the definition of the f-vector:
> 
>  * Counting the number of elements at each level of the face lattice

I think f-vectors of fixed dimension polyhedra should be have sums/addition.
Also if one considers how adding or deleting inequalities can alter the f-vector this is strange.
Anyway, it's most important to be precise, which one we use. Adding a zero or deleting it, if one really depends one version is trivial.

>  * Vector counting the number of faces by dimension
> 
> It should return different things.
> 
> One thing that should be done, is to make this explicit in the documentation of `f_vector` once this ticket is fixed and give an example of the difference with unbounded polyhedra.


---

Comment by jipilab created at 2019-10-17 12:00:21

ping!


---

Comment by @kliem created at 2019-10-18 09:41:48

Changing status from new to needs_review.


---

Comment by @kliem created at 2019-10-18 09:41:48

#28625 fixes this.

I added some tests, improved the documentation of `f_vector` and fixed a tiny typo.
----
New commits:


---

Comment by jipilab created at 2019-10-19 10:27:40

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-10-19 10:27:40

It would be nice if the note that you gave be in a NOTE environment followed by an appropriate example illustrating what is meant.


---

Comment by git created at 2019-10-22 12:32:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-10-22 12:46:11

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-10-24 08:56:12

Changing status from needs_review to needs_work.


---

Comment by jipilab created at 2019-10-24 08:56:12

May I suggest the following:


```diff

-            In case of a polyhedron with lines (unpointed polyhedron),
-            return the number of vertices of the ``Vrepresentation``.
-            Wheras the polyhedron has no vertices, this number corresponds
-            to the number of `k`-faces, where `k` is the number of lines.
+            If the polyhedron has lines, returns the number of vertices in
+            the ``Vrepresentation``. As the represented polyhedron has 
+            no 0-dimensional faces (i.e. vertices), this number corresponds
+            to the number of `k`-faces, where `k` is the number of lines.
```


Somehow, even though I corrected the above warning. I do not like what it says at all for the following reason:


```
sage: P = Polyhedron(rays=[This is the Trac macro *1,0,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#1,0,0-macro),lines=[This is the Trac macro *0,1,0* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,1,0-macro))
sage: P.vertices()
(A vertex at (0, 0, 0),)
sage: Q = Polyhedron(lines=[[0,1,0],[0,0,1]])
sage: Q.vertices()
(A vertex at (0, 0, 0),)
sage: R = Polyhedron(rays=[[1,0,0],[0,1,0]],vertices=[[0,1,0],[1,0,0]],lines=[This is the Trac macro *0,0,1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#0,0,1-macro))
sage: R.vertices()
(A vertex at (0, 1, 0), A vertex at (1, 0, 0))
```


In Sage, the computational convention (or compromise) is that polyhedra without vertices in their V-representation still receive a canonically computed vertex in order to do computations.

With this in mind, the second sentence is wrong. Just look at the above polyhedron `R`. It has lines, and two vertices.

---> This warning is more confusing than anything. Please rephrase taking the above three examples in mind and the convention in Sage.


---

Comment by git created at 2019-10-25 09:53:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @kliem created at 2019-10-25 09:54:21

Changing status from needs_work to needs_review.


---

Comment by jipilab created at 2019-10-27 15:39:18

Looks good to me now


---

Comment by jipilab created at 2019-10-27 15:39:18

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-10-28 23:51:27

Resolution: fixed
