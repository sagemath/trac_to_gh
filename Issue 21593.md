# Issue 21593: cython testsuite fails on 32-bit

Issue created by migration from https://trac.sagemath.org/ticket/21830

Original creator: vbraun

Original creation time: 2016-11-06 19:22:59

CC:  robertwb jdemeyer fbissey


```
20867[cython-0.25.1.p0] ======================================================================
20868[cython-0.25.1.p0] FAIL: lshift_int (line 137) (pyintop.__test__)
20869[cython-0.25.1.p0] Doctest: pyintop.__test__.lshift_int (line 137)
20870[cython-0.25.1.p0] ----------------------------------------------------------------------
20871[cython-0.25.1.p0] Traceback (most recent call last):
20872[cython-0.25.1.p0]   File "/home/buildslave-sage/slave/sage_git/build/local/lib/python/doctest.py", line 2226, in runTest
20873[cython-0.25.1.p0]     raise self.failureException(self.format_failure(new.getvalue()))
20874[cython-0.25.1.p0] AssertionError: Failed doctest test for pyintop.__test__.lshift_int (line 137)
20875[cython-0.25.1.p0]   File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/c/pyintop/pyintop.so", line unknown line number, in lshift_int (line 137)
20876[cython-0.25.1.p0] 
20877[cython-0.25.1.p0] ----------------------------------------------------------------------
20878[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/c/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20879[cython-0.25.1.p0] Failed example:
20880[cython-0.25.1.p0]     bigints(lshift_int(-1))
20881[cython-0.25.1.p0] Expected:
20882[cython-0.25.1.p0]     (-8, -2147483648, -9223372036854775808, -10633823966279326983230456482242756608)
20883[cython-0.25.1.p0] Got:
20884[cython-0.25.1.p0]     (-8, -2147483648, -2147483648, -10633823966279326983230456482242756608)
20885[cython-0.25.1.p0] ----------------------------------------------------------------------
20886[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/c/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20887[cython-0.25.1.p0] Failed example:
20888[cython-0.25.1.p0]     (2**28) << 3
20889[cython-0.25.1.p0] Expected:
20890[cython-0.25.1.p0]     2147483648
20891[cython-0.25.1.p0] Got:
20892[cython-0.25.1.p0]     2147483648L
20893[cython-0.25.1.p0] ----------------------------------------------------------------------
20894[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/c/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20895[cython-0.25.1.p0] Failed example:
20896[cython-0.25.1.p0]     (2**30) << 3
20897[cython-0.25.1.p0] Expected:
20898[cython-0.25.1.p0]     8589934592
20899[cython-0.25.1.p0] Got:
20900[cython-0.25.1.p0]     8589934592L
20901[cython-0.25.1.p0] 
20902[cython-0.25.1.p0] 
20903[cython-0.25.1.p0] ======================================================================
20904[cython-0.25.1.p0] FAIL: lshift_int (line 137) (pyintop.__test__)
20905[cython-0.25.1.p0] Doctest: pyintop.__test__.lshift_int (line 137)
20906[cython-0.25.1.p0] ----------------------------------------------------------------------
20907[cython-0.25.1.p0] Traceback (most recent call last):
20908[cython-0.25.1.p0]   File "/home/buildslave-sage/slave/sage_git/build/local/lib/python/doctest.py", line 2226, in runTest
20909[cython-0.25.1.p0]     raise self.failureException(self.format_failure(new.getvalue()))
20910[cython-0.25.1.p0] AssertionError: Failed doctest test for pyintop.__test__.lshift_int (line 137)
20911[cython-0.25.1.p0]   File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/cpp/pyintop/pyintop.so", line unknown line number, in lshift_int (line 137)
20912[cython-0.25.1.p0] 
20913[cython-0.25.1.p0] ----------------------------------------------------------------------
20914[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/cpp/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20915[cython-0.25.1.p0] Failed example:
20916[cython-0.25.1.p0]     bigints(lshift_int(-1))
20917[cython-0.25.1.p0] Expected:
20918[cython-0.25.1.p0]     (-8, -2147483648, -9223372036854775808, -10633823966279326983230456482242756608)
20919[cython-0.25.1.p0] Got:
20920[cython-0.25.1.p0]     (-8, -2147483648, -2147483648, -10633823966279326983230456482242756608)
20921[cython-0.25.1.p0] ----------------------------------------------------------------------
20922[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/cpp/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20923[cython-0.25.1.p0] Failed example:
20924[cython-0.25.1.p0]     (2**28) << 3
20925[cython-0.25.1.p0] Expected:
20926[cython-0.25.1.p0]     2147483648
20927[cython-0.25.1.p0] Got:
20928[cython-0.25.1.p0]     2147483648L
20929[cython-0.25.1.p0] ----------------------------------------------------------------------
20930[cython-0.25.1.p0] File "/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src/TEST_TMP/run/cpp/pyintop/pyintop.so", line ?, in pyintop.__test__.lshift_int (line 137)
20931[cython-0.25.1.p0] Failed example:
20932[cython-0.25.1.p0]     (2**30) << 3
20933[cython-0.25.1.p0] Expected:
20934[cython-0.25.1.p0]     8589934592
20935[cython-0.25.1.p0] Got:
20936[cython-0.25.1.p0]     8589934592L
20937[cython-0.25.1.p0] 
20938[cython-0.25.1.p0] 
20939[cython-0.25.1.p0] ----------------------------------------------------------------------
20940[cython-0.25.1.p0] Ran 10216 tests in 2981.905s
20941[cython-0.25.1.p0] 
20942[cython-0.25.1.p0] FAILED (failures=2, skipped=2)
20943[cython-0.25.1.p0] Following tests excluded because of missing dependencies on your system:
20944[cython-0.25.1.p0]    Cython.Coverage
20945[cython-0.25.1.p0]    run.asyncio_generators
20946[cython-0.25.1.p0]    run.coverage_api
20947[cython-0.25.1.p0]    run.coverage_cmd
20948[cython-0.25.1.p0]    run.coverage_nogil
20949[cython-0.25.1.p0] ALL DONE
20950[cython-0.25.1.p0] make[3]: *** [test] Error 1
20951[cython-0.25.1.p0] make[3]: Leaving directory `/home/buildslave-sage/slave/sage_git/build/local/var/tmp/sage/build/cython-0.25.1.p0/src'
20952[cython-0.25.1.p0] 
20953[cython-0.25.1.p0] real	49m47.348s
20954[cython-0.25.1.p0] user	47m18.712s
20955[cython-0.25.1.p0] sys	1m40.268s
20956[cython-0.25.1.p0] ************************************************************************
20957[cython-0.25.1.p0] Error testing package cython-0.25.1.p0
20958[cython-0.25.1.p0] ************************************************************************
```



---

Comment by vbraun created at 2016-11-19 22:09:16

Upstream at https://github.com/cython/cython/issues/1530


---

Comment by vbraun created at 2016-12-10 12:30:02

Should be fixed by #22043


---

Comment by vbraun created at 2016-12-10 12:30:14

Changing status from new to needs_review.


---

Comment by Konrad127123 created at 2017-03-27 14:40:27

Changing status from needs_review to needs_work.


---

Comment by Konrad127123 created at 2017-03-27 14:40:27

Looks like it's still not quite fixed, due to the following issue:

Upstream: https://github.com/cython/cython/issues/1548

I can confirm that this causes the build to fail on 32-bit Arm (Raspbian). Debian uses the following workaround:

https://anonscm.debian.org/viewvc/python-apps/packages/cython/trunk/debian/patches/debup_workaround_verify_resolution_GH1533?view=markup&pathrev=13900


---

Comment by Konrad127123 created at 2017-03-27 15:03:03

It looks like this upstream commit is a fix for the issue I mentioned above:

https://github.com/cython/cython/commit/d92a718a26c9354fbf35f31a17de5c069865a447

(I've not tested it yet.)


---

Comment by Konrad127123 created at 2017-03-28 22:57:04

Changing status from needs_work to needs_review.


---

Comment by Konrad127123 created at 2017-03-28 22:57:04

The attached commit is upstream's patch. I tried it on 32-bit Arm (Raspbian) and the cython testsuite passed.
----
New commits:


---

Comment by fbissey created at 2017-03-28 22:59:55

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2017-03-28 22:59:55

If it is approved upstream, it is good enough for me.


---

Comment by vbraun created at 2017-03-30 22:34:53

Resolution: fixed
