# Issue 13645: deprecate degrevlex when using PolyBoRi

archive/issues_013645.json:
```json
{
    "body": "Assignee: malb\n\nCC:  polybori alexanderdreyer\n\nPolyBoRi does not support the degrevlex term ordering, so !Sage emulates it by fiddling with the variable indices. This has produced subtle bugs over and over again. In light of this, \"degrevlex\" should be removed and replaced by a piece of documentation explaining how to emulate it by hand (\"reverse your variables\").\n\nIssue created by migration from https://trac.sagemath.org/ticket/13849\n\n",
    "created_at": "2012-12-19T14:31:44Z",
    "labels": [
        "commutative algebra",
        "major",
        "enhancement"
    ],
    "title": "deprecate degrevlex when using PolyBoRi",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13645",
    "user": "malb"
}
```
Assignee: malb

CC:  polybori alexanderdreyer

PolyBoRi does not support the degrevlex term ordering, so !Sage emulates it by fiddling with the variable indices. This has produced subtle bugs over and over again. In light of this, "degrevlex" should be removed and replaced by a piece of documentation explaining how to emulate it by hand ("reverse your variables").

Issue created by migration from https://trac.sagemath.org/ticket/13849





---

archive/issue_comments_168861.json:
```json
{
    "body": "Of course I am biased, but I completely second the suggestion.\nI would like to give a little bit background.\nWith ZDDs it's not possible to implement arbitrary monomial orderings\nefficiently.\nThis is the reason why we have implemented only some orders which suffice for \nall most computations: lex., block, deglex, and degree reverse lexicographical ordering ascending.\nThe ascending is there for a reason: It is exactly like degrevlex only that x_1<x_2.\nSo, you have just to reverse variables (as malb explained) to get the same behaviour.\nAnother aspect is that we deal in PolyBoRi functions with ZDDs and suppose a certain behaviour.\nThis might result in wrong results, slow behaviour or other errors.\n\nIt's unfortunate that it does not seem feasible to have a compatibility layer, but it's really difficult to have an interface that does both expose all power and flexibility of PolyBoRi and at the same time pretends that there is no library with very specific structures under the interface.",
    "created_at": "2012-12-20T08:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168861",
    "user": "PolyBoRi"
}
```

Of course I am biased, but I completely second the suggestion.
I would like to give a little bit background.
With ZDDs it's not possible to implement arbitrary monomial orderings
efficiently.
This is the reason why we have implemented only some orders which suffice for 
all most computations: lex., block, deglex, and degree reverse lexicographical ordering ascending.
The ascending is there for a reason: It is exactly like degrevlex only that x_1<x_2.
So, you have just to reverse variables (as malb explained) to get the same behaviour.
Another aspect is that we deal in PolyBoRi functions with ZDDs and suppose a certain behaviour.
This might result in wrong results, slow behaviour or other errors.

It's unfortunate that it does not seem feasible to have a compatibility layer, but it's really difficult to have an interface that does both expose all power and flexibility of PolyBoRi and at the same time pretends that there is no library with very specific structures under the interface.



---

archive/issue_comments_168862.json:
```json
{
    "body": "We have now `DegNegLex`  (=dp_asc) in Sage, so one could use that instead (and of course reverse variables manually). But I have to look at the code again (unfortunately I'm already out of office for the holidays), since I think one can just switch to DegNegLex, when calling polybori-code, an then switch back. I've done it somewhere else for a simliar bug.",
    "created_at": "2012-12-20T12:39:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168862",
    "user": "AlexanderDreyer"
}
```

We have now `DegNegLex`  (=dp_asc) in Sage, so one could use that instead (and of course reverse variables manually). But I have to look at the code again (unfortunately I'm already out of office for the holidays), since I think one can just switch to DegNegLex, when calling polybori-code, an then switch back. I've done it somewhere else for a simliar bug.



---

archive/issue_comments_168863.json:
```json
{
    "body": "Hi Alexander, so your vote is to attempt to fix it instead of dropping it?",
    "created_at": "2012-12-20T18:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168863",
    "user": "malb"
}
```

Hi Alexander, so your vote is to attempt to fix it instead of dropping it?



---

archive/issue_comments_168864.json:
```json
{
    "body": "Replying to [comment:3 malb]:\n> Hi Alexander, so your vote is to attempt to fix it instead of dropping it?\nWell, that had been my idea. #13202 should have fixed these issues, but I did not think about multi_polynomial_sequence.py.  Of course, one could fix it here (by intraoducing a function to pboriy.pyx that wraps and dewraps `DegRevLex`). But that would only fix this special issue. But since a user could call polybori's functions manually, I must admit that is not really a solution.\n\nThe correct solution would be to split pbori.pyx into polybori-interface (just reimplemention our upstream boost.python-based interface) and the implementation of `BooleanPolynomial`, `BooleanPolynomialRing`, etc. \n\nBut I guess we won't find the time for this on short notice. (It might me a good idea, if we switch to cython upstream. This might be happen, but also not on short notice.)\n\nSo, -langerredekurzersinn- finally deprecating `DegRevLex` seem to be the best feasible way.",
    "created_at": "2012-12-20T21:20:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168864",
    "user": "AlexanderDreyer"
}
```

Replying to [comment:3 malb]:
> Hi Alexander, so your vote is to attempt to fix it instead of dropping it?
Well, that had been my idea. #13202 should have fixed these issues, but I did not think about multi_polynomial_sequence.py.  Of course, one could fix it here (by intraoducing a function to pboriy.pyx that wraps and dewraps `DegRevLex`). But that would only fix this special issue. But since a user could call polybori's functions manually, I must admit that is not really a solution.

The correct solution would be to split pbori.pyx into polybori-interface (just reimplemention our upstream boost.python-based interface) and the implementation of `BooleanPolynomial`, `BooleanPolynomialRing`, etc. 

But I guess we won't find the time for this on short notice. (It might me a good idea, if we switch to cython upstream. This might be happen, but also not on short notice.)

So, -langerredekurzersinn- finally deprecating `DegRevLex` seem to be the best feasible way.



---

archive/issue_comments_168865.json:
```json
{
    "body": "Hi!\n\nI agree with the analysis of Alexander.\nThat were my own thoughts except that I do not think that the best\nway really ends up best for the user (even if we had all time of the world).\n\nI would like to add two more thoughts.\nI think we should really encourage users\nto have a look at all the tricks in PolyBoRi and call\nPolyBoRi functions directly when needed.\nIn particular while the Sage docs feature a first class\nreference manual, our docs supplement it by profound\nadvice on performance optimization.\n\nLuckily Alexander repaired the typesetting of our docs.\nI really would have preferred him to enjoy his vacations,\nbut since he repaired it, I would like to post the following link:\n\nGiven the following behaviour\nhttp://polybori.sourceforge.net/doc/tutorial/tutorialse2.html#x3-140002.1\nany confusion about index order is really evil.\n\nMichael",
    "created_at": "2012-12-21T07:46:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168865",
    "user": "PolyBoRi"
}
```

Hi!

I agree with the analysis of Alexander.
That were my own thoughts except that I do not think that the best
way really ends up best for the user (even if we had all time of the world).

I would like to add two more thoughts.
I think we should really encourage users
to have a look at all the tricks in PolyBoRi and call
PolyBoRi functions directly when needed.
In particular while the Sage docs feature a first class
reference manual, our docs supplement it by profound
advice on performance optimization.

Luckily Alexander repaired the typesetting of our docs.
I really would have preferred him to enjoy his vacations,
but since he repaired it, I would like to post the following link:

Given the following behaviour
http://polybori.sourceforge.net/doc/tutorial/tutorialse2.html#x3-140002.1
any confusion about index order is really evil.

Michael



---

archive/issue_comments_168866.json:
```json
{
    "body": "Alright, I'll deprecate the use of degrevlex in PolyBoRi then.\n\nBut I have to admit that I don't understand:\n\n> We have now DegNegLex (=dp_asc) in Sage, so one could use that instead (and of course \n> reverse variables manually).",
    "created_at": "2012-12-21T14:23:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168866",
    "user": "malb"
}
```

Alright, I'll deprecate the use of degrevlex in PolyBoRi then.

But I have to admit that I don't understand:

> We have now DegNegLex (=dp_asc) in Sage, so one could use that instead (and of course 
> reverse variables manually).



---

archive/issue_comments_168867.json:
```json
{
    "body": "Replying to [comment:6 malb]:\n> Alright, I'll deprecate the use of degrevlex in PolyBoRi then.\n> \n> But I have to admit that I don't understand:\n> \n> > We have now DegNegLex (=dp_asc) in Sage, so one could use that instead (and of course \n> > reverse variables manually).\nBefore I added `DegNegLex`, it had not been possible to emulate `DegRevLex` by taking another ordering and revert the variable vector *manually*. This was just because that corresponding other ordering had not been there (for the user), yet. (So the automated reversion was done for allowing the user to access `dp_asc` somehow, but it was error-prone, etc...)  \n\nToday, a Sage-user can just use `DegNegLex` like a ipbori-user uses `dp_asc`, so indeed the hacked `DegRevLex` is not needed any more.",
    "created_at": "2012-12-21T21:07:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168867",
    "user": "AlexanderDreyer"
}
```

Replying to [comment:6 malb]:
> Alright, I'll deprecate the use of degrevlex in PolyBoRi then.
> 
> But I have to admit that I don't understand:
> 
> > We have now DegNegLex (=dp_asc) in Sage, so one could use that instead (and of course 
> > reverse variables manually).
Before I added `DegNegLex`, it had not been possible to emulate `DegRevLex` by taking another ordering and revert the variable vector *manually*. This was just because that corresponding other ordering had not been there (for the user), yet. (So the automated reversion was done for allowing the user to access `dp_asc` somehow, but it was error-prone, etc...)  

Today, a Sage-user can just use `DegNegLex` like a ipbori-user uses `dp_asc`, so indeed the hacked `DegRevLex` is not needed any more.



---

archive/issue_comments_168868.json:
```json
{
    "body": "Around line 377:\n\n```\ndeprecation(13849, \"using 'degrevlex' in Boolean polynomial rings is deprecated.\nIf needed, reverse the order of variables manually and use 'deglex'\")\n```\n\nshould read\n\n```\n...and use 'degneglex'\")\n```\n\nEverything else looks fine.",
    "created_at": "2013-01-15T15:22:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168868",
    "user": "AlexanderDreyer"
}
```

Around line 377:

```
deprecation(13849, "using 'degrevlex' in Boolean polynomial rings is deprecated.
If needed, reverse the order of variables manually and use 'deglex'")
```

should read

```
...and use 'degneglex'")
```

Everything else looks fine.



---

archive/issue_comments_168869.json:
```json
{
    "body": "Sorry if that reveals my ignorance, but I thought:\n\n* deglex + inversed variable ordering == degrevlex\n* degneglex == the other ordering besides deglex which PolyBoRi\u00a0supports\n\nIs that wrong?",
    "created_at": "2013-01-15T15:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168869",
    "user": "malb"
}
```

Sorry if that reveals my ignorance, but I thought:

* deglex + inversed variable ordering == degrevlex
* degneglex == the other ordering besides deglex which PolyBoRiÂ supports

Is that wrong?



---

archive/issue_comments_168870.json:
```json
{
    "body": "Martin, what you say is correct (unless you define degnexlex otherwise in some context I do not know).\nDegrevlex as in Singular corresponds to\n\n```\n1 1 1\n0 0 -1\n0 -1 0\n```\n\nor equivalenty, but redundant.\n\n```\n1 1 1\n0 0 -1\n0 -1 0\n-1 0 0\n```\n\n\nSo you see, it has to aspects (one negative and one from behind),\nthe name might be considered as broken and irritating.\n\nNegative lexicographical as in Singular (not a well ordering).\n\n\n```\n-1 0 0\n0 -1 0\n0 0  -1\n```\n\n\nAs you can see degrevlex as in Singular is composed of the\ndegree vector and\nnegative lexicographical ordering (ls), but in reversed variable ordering.\n\ndeglex as in PolyBoRi and in Singular (Dp with a big D)\n\n```\n1 1 1\n1 0 0\n0 1 0\n```\n\n\ndp_asc as in PolyBoRi (degree reverse lexicographical ordering ascending)\n\n\n```\n1 1 1\n-1 0 0\n0 -1 0\n```\n\n\nSo, the notion, degneglex can have it's benefits from systematic perspective\nas it's composed of the degree vector and the (non well ordering) negative lexicographical and indeed itself again a well ordering.\nFrom an unsystematical perspective, I just always added the ascending to the \"degree reverse lexicographical\" as it made sure it's the same order but twised\n\nIt's a simple ordering, but it is not equivalenty to degrevlex as in Singular\nand does not feature the nice theoretical properties for a certain class of systems (I've never come to the observation that that they apply in Boolean context).\n\nWhile most people agree on these notions, here is no proper standardization on notions in computational algebra.\nI have indeed already seen some people define degree reverse lexicographical ordering to be the ordering PolyBoRi calls dp_asc.",
    "created_at": "2013-01-15T18:34:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168870",
    "user": "PolyBoRi"
}
```

Martin, what you say is correct (unless you define degnexlex otherwise in some context I do not know).
Degrevlex as in Singular corresponds to

```
1 1 1
0 0 -1
0 -1 0
```

or equivalenty, but redundant.

```
1 1 1
0 0 -1
0 -1 0
-1 0 0
```


So you see, it has to aspects (one negative and one from behind),
the name might be considered as broken and irritating.

Negative lexicographical as in Singular (not a well ordering).


```
-1 0 0
0 -1 0
0 0  -1
```


As you can see degrevlex as in Singular is composed of the
degree vector and
negative lexicographical ordering (ls), but in reversed variable ordering.

deglex as in PolyBoRi and in Singular (Dp with a big D)

```
1 1 1
1 0 0
0 1 0
```


dp_asc as in PolyBoRi (degree reverse lexicographical ordering ascending)


```
1 1 1
-1 0 0
0 -1 0
```


So, the notion, degneglex can have it's benefits from systematic perspective
as it's composed of the degree vector and the (non well ordering) negative lexicographical and indeed itself again a well ordering.
From an unsystematical perspective, I just always added the ascending to the "degree reverse lexicographical" as it made sure it's the same order but twised

It's a simple ordering, but it is not equivalenty to degrevlex as in Singular
and does not feature the nice theoretical properties for a certain class of systems (I've never come to the observation that that they apply in Boolean context).

While most people agree on these notions, here is no proper standardization on notions in computational algebra.
I have indeed already seen some people define degree reverse lexicographical ordering to be the ordering PolyBoRi calls dp_asc.



---

archive/issue_comments_168871.json:
```json
{
    "body": "Hang on, that means then that the user should (a) reverse the variables and (b) choose degneglex to get degrevlex as defined in Singular?",
    "created_at": "2013-01-15T19:54:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168871",
    "user": "malb"
}
```

Hang on, that means then that the user should (a) reverse the variables and (b) choose degneglex to get degrevlex as defined in Singular?



---

archive/issue_comments_168872.json:
```json
{
    "body": "Replying to [comment:13 malb]:\n> Hang on, that means then that the user should (a) reverse the variables and (b) choose degneglex to get degrevlex as defined in Singular?\nYes, otherwise we would not had have to implemented `dp_asc` (which was really hard). Have a look at `pbori.pyx`. `DegRevLex` is exactly implemented like this. (And `DegNegLex` is Sage is exactly `PolyBoRi`'s `dp_asc`.)",
    "created_at": "2013-01-15T21:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168872",
    "user": "AlexanderDreyer"
}
```

Replying to [comment:13 malb]:
> Hang on, that means then that the user should (a) reverse the variables and (b) choose degneglex to get degrevlex as defined in Singular?
Yes, otherwise we would not had have to implemented `dp_asc` (which was really hard). Have a look at `pbori.pyx`. `DegRevLex` is exactly implemented like this. (And `DegNegLex` is Sage is exactly `PolyBoRi`'s `dp_asc`.)



---

archive/issue_comments_168873.json:
```json
{
    "body": "Dang, I've been ignorant the whole time! Thanks! I'll fix the patch accordingly and fix doctest failures etc.",
    "created_at": "2013-01-15T22:09:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168873",
    "user": "malb"
}
```

Dang, I've been ignorant the whole time! Thanks! I'll fix the patch accordingly and fix doctest failures etc.



---

archive/issue_comments_168874.json:
```json
{
    "body": "Attachment",
    "created_at": "2013-01-16T10:34:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168874",
    "user": "malb"
}
```

Attachment



---

archive/issue_comments_168875.json:
```json
{
    "body": "Patch updated and doctests pass. Note this patch has a dependency chain.",
    "created_at": "2013-01-16T10:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168875",
    "user": "malb"
}
```

Patch updated and doctests pass. Note this patch has a dependency chain.



---

archive/issue_comments_168876.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-01-16T10:45:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168876",
    "user": "malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_168877.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-01-16T21:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168877",
    "user": "AlexanderDreyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_168878.json:
```json
{
    "body": "Since we had discussed this thoroughly and the patch looks nice, I  an give a positive review, proved that the patchbot succeeds.",
    "created_at": "2013-01-16T21:57:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168878",
    "user": "AlexanderDreyer"
}
```

Since we had discussed this thoroughly and the patch looks nice, I  an give a positive review, proved that the patchbot succeeds.



---

archive/issue_comments_168879.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2013-12-05T08:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13645",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13645#issuecomment-168879",
    "user": "jdemeyer"
}
```

Resolution: fixed
