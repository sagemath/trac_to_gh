# Issue 15340: Making braid groups independent on the global option for order of permutations

Issue created by migration from Trac.

Original creator: darij

Original creation time: 2013-12-23 19:17:21

CC:  sage-combinat mmarco vbraun

Keywords: groups, combinat, braid group, permutations

<boilerplate>
As detailed in #14885, it is not healthy for code to rely on the `__mul__` operation on permutations, since this operation depends on the `Permutations().global_options()['mul']` variable which can change at runtime. It is better to use the `left_action_product` and `right_action_product` methods introduced in #15174 (formerly known as `_left_to_right_multiply_on_left` and `_left_to_right_multiply_on_right`).
</boilerplate>

The branch I'll attach later today sets out to solve this issue in `sage/groups/braid.py`. In all methods whose result depends on the `mult` global variable, the user can now set a local variable `mult` to override the global one, and this is explicited in the docstrings. (Also, some speedups have been achieved, most noticeably in the `permutation()` method which now runs about 8 times faster since permutations are being composed by list operations rather than multiplied as permutations.)

**WARNING:** Please read the TODO part I left in the comments to the sourcecode of the `_left_normal_form_perm_` method. I am not sure of my fix there and would prefer someone who knows what this method does to look over it (and document the method while at that).


---

Comment by darij created at 2013-12-23 19:57:40

Changing status from new to needs_review.


---

Comment by darij created at 2013-12-23 19:57:40

Finished. Some timings:

before:

```
sage: B5 = BraidGroup(5)
sage: %timeit B5.one().permutation()
100000 loops, best of 3: 15.3 us per loop
sage: %timeit B5([1,-2,1]).permutation()
1000 loops, best of 3: 619 us per loop
sage: %timeit B5([1,-4,2,-3,2,1,2]).permutation()
1000 loops, best of 3: 1.13 ms per loop
sage: %timeit B5([1,2,4,1,-3,-1,2,1,-3]).permutation()
1000 loops, best of 3: 1.38 ms per loop
sage: %timeit B5.one().left_normal_form()
1000000 loops, best of 3: 266 ns per loop
sage: %timeit B5([1,-2,1]).left_normal_form()
100 loops, best of 3: 2.67 ms per loop
sage: %timeit B5([1,-4,2,-3,2,1,2]).left_normal_form()
100 loops, best of 3: 6.67 ms per loop
sage: %timeit B5([1,2,4,1,-3,-1,2,1,-3]).left_normal_form()
100 loops, best of 3: 7.94 ms per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([1,2,3,4,5]))
10000 loops, best of 3: 38 us per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([3,1,4,2,5]))
1000 loops, best of 3: 381 us per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([5,4,3,2,1]))
1000 loops, best of 3: 1.1 ms per loop
```


after:

```
sage: B5 = BraidGroup(5)
sage: %timeit B5.one().permutation()
10000 loops, best of 3: 44.6 us per loop
sage: %timeit B5([1,-2,1]).permutation()
1000 loops, best of 3: 349 us per loop
sage: %timeit B5([1,-4,2,-3,2,1,2]).permutation()
1000 loops, best of 3: 490 us per loop
sage: %timeit B5([1,2,4,1,-3,-1,2,1,-3]).permutation()
1000 loops, best of 3: 566 us per loop
sage: %timeit B5.one().left_normal_form()
1000000 loops, best of 3: 418 ns per loop
sage: %timeit B5([1,-2,1]).left_normal_form()
100 loops, best of 3: 2.16 ms per loop
sage: %timeit B5([1,-4,2,-3,2,1,2]).left_normal_form()
100 loops, best of 3: 5.06 ms per loop
sage: %timeit B5([1,2,4,1,-3,-1,2,1,-3]).left_normal_form()
100 loops, best of 3: 6.29 ms per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([1,2,3,4,5]))
10000 loops, best of 3: 46.6 us per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([3,1,4,2,5]))
10000 loops, best of 3: 50.9 us per loop
sage: %timeit B5._permutation_braid_Tietze(Permutation([5,4,3,2,1]))
10000 loops, best of 3: 58.8 us per loop
```


If you are wondering why `B5.one().permutation()` is taking that long... well, it used to give the identity permutation in the `0`-th symmetric group; now it gives that in the `5`-th symmetric group. I think the latter makes more sense.
----
New commits:


---

Comment by darij created at 2013-12-23 22:44:28

Actually, I'm pretty sure now that my `_left_normal_form_perm_` is wrong for r2l order, but someone will have to tell me what it should be...


---

Comment by darij created at 2013-12-23 22:44:28

Changing status from needs_review to needs_info.


---

Comment by git created at 2014-03-24 15:51:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by darij created at 2014-03-24 15:53:28

I have rebased this on top of the new develop, and force-pushed it. (An alternative would be merging, but reviewing merge commits is error-prone.)

Am I getting the meaning of the methods right? Anyone? Care to add some doctests using both left-to-right and right-to-left options?


---

Comment by git created at 2014-07-28 23:33:36

Branch pushed to git repo; I updated commit sha1. New commits:
