# Issue 16222: polar_plot crash with expressions containing floor

Issue created by migration from https://trac.sagemath.org/ticket/16459

Original creator: rws

Original creation time: 2014-06-09 05:28:58

Reported on sage-support:

```
sage: polar_plot((1+cos(fibonacci(floor(alpha)))), (alpha, -3*pi/2,pi/2))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-d55fb7d2b898> in <module>()
----> 1 polar_plot((Integer(1)+cos(fibonacci(floor(alpha)))), (alpha, -Integer(3)*pi/Integer(2),pi/Integer(2)))

/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in fibonacci(n, algorithm)
    500         TypeError: no conversion of this rational to integer
    501     """
--> 502     n = ZZ(n)
    503     if algorithm == 'pari':
    504         return ZZ(pari(n).fibonacci())

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8905)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.NamedConvertMap._call_ (sage/structure/coerce_maps.c:5442)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._integer_ (sage/symbolic/expression.cpp:6142)()

TypeError: unable to convert x (=floor(alpha)) to an integer
```



---

Comment by nbruin created at 2014-06-09 15:37:34

Close as won't fix? `polar_plot` never gets its argument, since `fibonacci` isn't symbolic:

```
sage: fibonacci(floor(tan((abs(alpha+pi/2)^0.22))))
TypeError: unable to convert x (=floor(tan(abs(1/2*pi + alpha)^0.220000000000000))) to an integer
```

Apart from hobbling sage by equipping every conceivable function in sage with a symbolic equivalent, we can't really do something about this (perhaps document somewhere where newbies will look?)


---

Comment by kcrisman created at 2014-06-09 18:21:56

Could be worth adding examples of how to use lambda functions for precisely this contingency in several place in the docs.  Though see #8383 for some actual use cases (and how do other systems handle this?) suggesting to make symbolic versions of everything.


---

Comment by rws created at 2014-06-11 05:58:40

Changing status from new to needs_review.


---

Comment by rws created at 2014-06-11 05:58:40

Thanks. I think it best to move the discussion to #8383 where some arguments have been weighed already.


---

Comment by kcrisman created at 2014-06-11 12:28:22

Sorry, I must not have made it clear that if we aren't going to fix the symbolic equivalents thing (which seems reasonable) then we should document how to do this with lambdas for someone who might want to do this plot (for instance) nonetheless.


---

Comment by rws created at 2014-06-11 13:02:00

Changing component from symbolics to documentation.


---

Comment by rws created at 2014-06-11 13:02:00

Changing status from needs_review to needs_work.


---

Comment by rws created at 2014-06-14 08:45:19

I have added a note to the plot documentation. Where else do you think it's needed?
----
New commits:


---

Comment by rws created at 2014-06-14 08:45:19

Changing status from needs_work to needs_review.


---

Comment by kcrisman created at 2014-08-14 13:43:23

This is terse, but I think is a good start on this.  Merges and looks nice in output.


---

Comment by kcrisman created at 2014-08-14 13:43:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-08-16 07:52:28

Resolution: fixed
