# Issue 16222: polar_plot crash with expressions containing floor

archive/issues_016222.json:
```json
{
    "body": "Reported on sage-support:\n\n```\nsage: polar_plot((1+cos(fibonacci(floor(alpha)))), (alpha, -3*pi/2,pi/2))\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-5-d55fb7d2b898> in <module>()\n----> 1 polar_plot((Integer(1)+cos(fibonacci(floor(alpha)))), (alpha, -Integer(3)*pi/Integer(2),pi/Integer(2)))\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in fibonacci(n, algorithm)\n    500         TypeError: no conversion of this rational to integer\n    501     \"\"\"\n--> 502     n = ZZ(n)\n    503     if algorithm == 'pari':\n    504         return ZZ(pari(n).fibonacci())\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8905)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.NamedConvertMap._call_ (sage/structure/coerce_maps.c:5442)()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._integer_ (sage/symbolic/expression.cpp:6142)()\n\nTypeError: unable to convert x (=floor(alpha)) to an integer\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16459\n\n",
    "created_at": "2014-06-09T05:28:58Z",
    "labels": [
        "symbolics",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "polar_plot crash with expressions containing floor",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16222",
    "user": "@rwst"
}
```
Reported on sage-support:

```
sage: polar_plot((1+cos(fibonacci(floor(alpha)))), (alpha, -3*pi/2,pi/2))
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-5-d55fb7d2b898> in <module>()
----> 1 polar_plot((Integer(1)+cos(fibonacci(floor(alpha)))), (alpha, -Integer(3)*pi/Integer(2),pi/Integer(2)))

/home/ralf/sage/local/lib/python2.7/site-packages/sage/combinat/combinat.pyc in fibonacci(n, algorithm)
    500         TypeError: no conversion of this rational to integer
    501     """
--> 502     n = ZZ(n)
    503     if algorithm == 'pari':
    504         return ZZ(pari(n).fibonacci())

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/parent.so in sage.structure.parent.Parent.__call__ (sage/structure/parent.c:8905)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/structure/coerce_maps.so in sage.structure.coerce_maps.NamedConvertMap._call_ (sage/structure/coerce_maps.c:5442)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/symbolic/expression.so in sage.symbolic.expression.Expression._integer_ (sage/symbolic/expression.cpp:6142)()

TypeError: unable to convert x (=floor(alpha)) to an integer
```


Issue created by migration from https://trac.sagemath.org/ticket/16459





---

archive/issue_comments_212016.json:
```json
{
    "body": "Close as won't fix? `polar_plot` never gets its argument, since `fibonacci` isn't symbolic:\n\n```\nsage: fibonacci(floor(tan((abs(alpha+pi/2)^0.22))))\nTypeError: unable to convert x (=floor(tan(abs(1/2*pi + alpha)^0.220000000000000))) to an integer\n```\n\nApart from hobbling sage by equipping every conceivable function in sage with a symbolic equivalent, we can't really do something about this (perhaps document somewhere where newbies will look?)",
    "created_at": "2014-06-09T15:37:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212016",
    "user": "@nbruin"
}
```

Close as won't fix? `polar_plot` never gets its argument, since `fibonacci` isn't symbolic:

```
sage: fibonacci(floor(tan((abs(alpha+pi/2)^0.22))))
TypeError: unable to convert x (=floor(tan(abs(1/2*pi + alpha)^0.220000000000000))) to an integer
```

Apart from hobbling sage by equipping every conceivable function in sage with a symbolic equivalent, we can't really do something about this (perhaps document somewhere where newbies will look?)



---

archive/issue_comments_212017.json:
```json
{
    "body": "Could be worth adding examples of how to use lambda functions for precisely this contingency in several place in the docs.  Though see #8383 for some actual use cases (and how do other systems handle this?) suggesting to make symbolic versions of everything.",
    "created_at": "2014-06-09T18:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212017",
    "user": "@kcrisman"
}
```

Could be worth adding examples of how to use lambda functions for precisely this contingency in several place in the docs.  Though see #8383 for some actual use cases (and how do other systems handle this?) suggesting to make symbolic versions of everything.



---

archive/issue_comments_212018.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-06-11T05:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212018",
    "user": "@rwst"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_212019.json:
```json
{
    "body": "Thanks. I think it best to move the discussion to #8383 where some arguments have been weighed already.",
    "created_at": "2014-06-11T05:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212019",
    "user": "@rwst"
}
```

Thanks. I think it best to move the discussion to #8383 where some arguments have been weighed already.



---

archive/issue_comments_212020.json:
```json
{
    "body": "Sorry, I must not have made it clear that if we aren't going to fix the symbolic equivalents thing (which seems reasonable) then we should document how to do this with lambdas for someone who might want to do this plot (for instance) nonetheless.",
    "created_at": "2014-06-11T12:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212020",
    "user": "@kcrisman"
}
```

Sorry, I must not have made it clear that if we aren't going to fix the symbolic equivalents thing (which seems reasonable) then we should document how to do this with lambdas for someone who might want to do this plot (for instance) nonetheless.



---

archive/issue_comments_212021.json:
```json
{
    "body": "Changing component from symbolics to documentation.",
    "created_at": "2014-06-11T13:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212021",
    "user": "@rwst"
}
```

Changing component from symbolics to documentation.



---

archive/issue_comments_212022.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-06-11T13:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212022",
    "user": "@rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_212023.json:
```json
{
    "body": "I have added a note to the plot documentation. Where else do you think it's needed?\n----\nNew commits:",
    "created_at": "2014-06-14T08:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212023",
    "user": "@rwst"
}
```

I have added a note to the plot documentation. Where else do you think it's needed?
----
New commits:



---

archive/issue_comments_212024.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-06-14T08:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212024",
    "user": "@rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_212025.json:
```json
{
    "body": "This is terse, but I think is a good start on this.  Merges and looks nice in output.",
    "created_at": "2014-08-14T13:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212025",
    "user": "@kcrisman"
}
```

This is terse, but I think is a good start on this.  Merges and looks nice in output.



---

archive/issue_comments_212026.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-14T13:43:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212026",
    "user": "@kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_212027.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-16T07:52:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16222",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16222#issuecomment-212027",
    "user": "@vbraun"
}
```

Resolution: fixed
