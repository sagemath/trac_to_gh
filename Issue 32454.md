# Issue 32454: setuptools: remove old easy_install patch

Issue created by migration from https://trac.sagemath.org/ticket/32691

Original creator: mjo

Original creation time: 2021-10-14 12:27:15

CC:  mkoeppe jhpalmieri

We've got one custom patch in the setuptools SPKG, `build/pkgs/setuptools/patches/easy_install_lock.patch`. Ideally this would be unused, as easy_install has been replaced by pip.

Can it be removed?


---

Comment by mkoeppe created at 2021-10-14 15:30:13

+1 for removing it. I think this code path might still be used when installing an old package that declares "setup_requires", but none of our SPKGs need it.


---

Comment by mjo created at 2021-10-14 16:38:32

Changing status from new to needs_review.


---

Comment by mjo created at 2021-10-14 16:38:32

Ok, easy enough.
----
New commits:


---

Comment by mkoeppe created at 2021-10-14 17:56:44

Need to change the patchlevel in `package-version.txt`


---

Comment by mjo created at 2021-10-14 18:52:55

I'm not sure what you mean, there's no patchlevel in there currently? If you mean I should add one to indicate that the sources have changed... should I just bump the version to 58.0.4 instead?


---

Comment by mkoeppe created at 2021-10-14 18:57:45

Whenever we add/change/remove patches that affect what is installed, need to distinguish it from what was there before by adding a `.p0` to the version - https://doc.sagemath.org/html/en/developer/packaging.html#package-versioning

But yes, doing an upgrade of the package also does the trick. Going to 58.0.4 should be fine, or to latest 58.2.0 (https://setuptools.pypa.io/en/latest/history.html)


---

Comment by git created at 2021-10-14 19:44:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2021-10-14 19:45:47

Alright, that's what I figured. Upgraded instead.


---

Comment by jhpalmieri created at 2021-10-15 21:12:30

This works for me and looks like a pretty straightforward upgrade. I haven't tried it with any optional or experimental packages; could they lead to breakage because of removal of the patch?


---

Comment by mkoeppe created at 2021-10-15 21:46:02

`src/sage/misc/dev_tools.py` still makes a reference to `easy_install`.

Other than that, there is no direct use of `easy_install`; that includes the optional/experimental packages.

As I said in comment:1, the code path with `easy_install` could still be triggered by `setup_requires` of a package. However, for normal packages (= packages with `checksums.ini`), this cannot actually install a package from the net because we poison the http* proxy. No install, so no locking needed.

So only "script" or "pip" packages would need to be checked whether any of these use `setup_requires`


---

Comment by jhpalmieri created at 2021-10-18 21:47:09

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-10-18 21:47:09

Okay, let's move on. mkoeppe, feel free to add yourself as a reviewer and/or author depending on your role here.


---

Comment by vbraun created at 2021-10-20 23:00:44

Resolution: fixed
