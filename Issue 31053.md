# Issue 31053: Improve error message for ecl

Issue created by migration from https://trac.sagemath.org/ticket/31290

Original creator: @tobiasdiez

Original creation time: 2021-01-25 11:44:48

CC:  dimpase mjo @spaghettisalat jhpalmieri isuruf fbissey arojas mkoeppe

In case the ecl evaluation results in an error, now the command string is displayed in the error message as well. Should make debugging easier if one knows which command fails.




---

Comment by @tobiasdiez created at 2021-01-25 11:44:55

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-01-25 19:09:57

Please add doctests that illustrate this


---

Comment by git created at 2021-01-28 16:17:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @tobiasdiez created at 2021-01-28 16:17:21

Done


---

Comment by mkoeppe created at 2021-01-30 01:22:10

There seems to be another codepath that is not covered by doctests yet


---

Comment by @tobiasdiez created at 2021-01-30 10:28:17

Which code do you mean?


---

Comment by mkoeppe created at 2021-01-30 17:16:03

3 `raise` statements are changed, 1 is tested


---

Comment by nbruin created at 2021-01-30 19:59:57

Changing status from needs_review to needs_work.


---

Comment by nbruin created at 2021-01-30 19:59:57

This is not safe: the new code causes `str(<EclObject>)`, which requires a string conversion from ecl (which has just raised an error!). We have no info on what `EclObject` is; it could be a recursive, and therefore unprintable, data structure. Admittedly, we'd hope the object is evaluable, because that's what we just tried to do with it, and evaluable objects are usually printable (but don't have to be!!), but evaluation just went wrong, so should be careful.

In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`. If you want to improve the message, it would be better to change the raised message there. Note that the message constructed there just includes whatever ECL reported as error message. There may be a reason why ECL limits what it includes in the error message. If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better.


---

Comment by @tobiasdiez created at 2021-01-30 21:15:20

Thanks for the feedback!

Replying to [comment:8 nbruin]:
> In any case, you'd be catching an error that has just been constructed in `ecl_safe_eval`.
> If you want to include more ECL traceback information, then perhaps extracting it from ECL might be better. 

I agree! I didn't put it in `ecl_safe_eval` as I couldn't figure out a way to convert the argument `cl_object form` to a python string.
As I have absolutely zero experience with ECL, I have to leave it to somebody else to convince ECL to include a full traceback in its error message.

Would it be ok for now, if I print the initial (python) string passed as the constructor argument?


---

Comment by mkoeppe created at 2021-03-15 22:07:04

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by @tobiasdiez created at 2021-05-18 07:37:50

`@`nbruin, I would appreciate your feedback and recommendation on the above idea. Thanks!


---

Comment by mkoeppe created at 2021-07-19 00:44:56

Setting a new milestone for this ticket based on a cursory review.
