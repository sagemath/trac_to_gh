# Issue 20501: singular 3.1.7 fails to build using GCC 6

archive/issues_020501.json:
```json
{
    "body": "Keywords: GCC6 c++11\n\nTill #17254 is ready. Let's add another patch to singular to fix a build issue with GCC 6.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20738\n\n",
    "closed_at": "2016-07-03T21:58:58Z",
    "created_at": "2016-05-31T19:48:20Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "singular 3.1.7 fails to build using GCC 6",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20501",
    "user": "https://github.com/a-andre"
}
```
Keywords: GCC6 c++11

Till #17254 is ready. Let's add another patch to singular to fix a build issue with GCC 6.

Issue created by migration from https://trac.sagemath.org/ticket/20738





---

archive/issue_comments_282707.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-05-31T19:49:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282707",
    "user": "https://github.com/a-andre"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_282708.json:
```json
{
    "body": "This looks like OS X bits (macho-bundles). Has it also been tested on pre gcc-6.1 compilers? I guess the bots will answer that question soon.",
    "created_at": "2016-05-31T22:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282708",
    "user": "https://github.com/kiwifb"
}
```

This looks like OS X bits (macho-bundles). Has it also been tested on pre gcc-6.1 compilers? I guess the bots will answer that question soon.



---

archive/issue_comments_282709.json:
```json
{
    "body": "Can you replace `&mach_o[0]` by `mach_o` for simplicity?",
    "created_at": "2016-06-01T15:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282709",
    "user": "https://github.com/jdemeyer"
}
```

Can you replace `&mach_o[0]` by `mach_o` for simplicity?



---

archive/issue_comments_282710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-01T20:07:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_282711.json:
```json
{
    "body": "Replying to [comment:3 jdemeyer]:\n> Can you replace `&mach_o[0]` by `mach_o` for simplicity?\n\n\nDone.",
    "created_at": "2016-06-01T20:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282711",
    "user": "https://github.com/a-andre"
}
```

Replying to [comment:3 jdemeyer]:
> Can you replace `&mach_o[0]` by `mach_o` for simplicity?


Done.



---

archive/issue_comments_282712.json:
```json
{
    "body": "While this (or a similar patch I posted on sage-release) allows building Singular with GCC 6.1 (and without `-std=c++98` or `-std=c++11`), the resulting binaries crash for me (even when compiled with `-std=c++98`).\n\nSeems we have to fiddle with optimization flags as well, which doesn't necessarily mean it's GCC's fault.\n\nIIRC, with `-O1` in `CPPFLAGS` (which aren't consistently used or get overridden by other settings, just like `CXXFLAGS`), I obtained a version (of Sage 7.2 btw.) where `./sage` and `./sage --singular` did no longer segfault, but building the documentation still crashed...\n\n(The previous segfaults happened immediately when initializing libsingular, as also reported by someone else on sage-release, in a thread for Sage 7.3.beta2 related to GCC 6.1 and BRiAl.)",
    "created_at": "2016-06-30T17:51:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282712",
    "user": "https://github.com/nexttime"
}
```

While this (or a similar patch I posted on sage-release) allows building Singular with GCC 6.1 (and without `-std=c++98` or `-std=c++11`), the resulting binaries crash for me (even when compiled with `-std=c++98`).

Seems we have to fiddle with optimization flags as well, which doesn't necessarily mean it's GCC's fault.

IIRC, with `-O1` in `CPPFLAGS` (which aren't consistently used or get overridden by other settings, just like `CXXFLAGS`), I obtained a version (of Sage 7.2 btw.) where `./sage` and `./sage --singular` did no longer segfault, but building the documentation still crashed...

(The previous segfaults happened immediately when initializing libsingular, as also reported by someone else on sage-release, in a thread for Sage 7.3.beta2 related to GCC 6.1 and BRiAl.)



---

archive/issue_comments_282713.json:
```json
{
    "body": "Changing keywords from \"GCC6\" to \"GCC6 c++11\".",
    "created_at": "2016-07-03T10:44:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282713",
    "user": "https://github.com/vbraun"
}
```

Changing keywords from "GCC6" to "GCC6 c++11".



---

archive/issue_comments_282714.json:
```json
{
    "body": "My patch to Singular for C++11 is IMHO more straight-forward... ;-)\n\n```patch\n--- singular-3.1.7p1/kernel/mod_raw.cc\t2014-11-19 14:06:05.000000000 +0100\n+++ singular-3.1.7p1/kernel/mod_raw.cc\t2016-06-19 23:27:19.420554691 +0200\n@@ -38,8 +38,8 @@\n \n lib_types type_of_LIB(char *newlib, char *libnamebuf)\n {\n-  const char mach_o[]={0xfe,0xed,0xfa,0xce,0};\n-  const char mach_o_module[]={0xce,0xfa,0xed,0xfe,0};\n+  const char mach_o[]=\"\\xfe\\xed\\xfa\\xce\";\n+  const char mach_o_module[]=\"\\xce\\xfa\\xed\\xfe\";\n   int i=0;\n   while(si_bultin_libs[i]!=NULL)\n   {\n```\n\n(I've put it into `build/pkgs/singular/patches/remove_narrowing_conversion.patch`.)",
    "created_at": "2016-07-03T11:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282714",
    "user": "https://github.com/nexttime"
}
```

My patch to Singular for C++11 is IMHO more straight-forward... ;-)

```patch
--- singular-3.1.7p1/kernel/mod_raw.cc	2014-11-19 14:06:05.000000000 +0100
+++ singular-3.1.7p1/kernel/mod_raw.cc	2016-06-19 23:27:19.420554691 +0200
@@ -38,8 +38,8 @@
 
 lib_types type_of_LIB(char *newlib, char *libnamebuf)
 {
-  const char mach_o[]={0xfe,0xed,0xfa,0xce,0};
-  const char mach_o_module[]={0xce,0xfa,0xed,0xfe,0};
+  const char mach_o[]="\xfe\xed\xfa\xce";
+  const char mach_o_module[]="\xce\xfa\xed\xfe";
   int i=0;
   while(si_bultin_libs[i]!=NULL)
   {
```

(I've put it into `build/pkgs/singular/patches/remove_narrowing_conversion.patch`.)



---

archive/issue_comments_282715.json:
```json
{
    "body": "Just for the record:\n\nIf I compile everything except the Singular 3.1.7p1 package (the latter with GCC 5.4) with GCC 6.1.0, `ptestlong` passes for me (modulo the usual noise in one doctest, and two GAP tests which pass when rerun, but that's again the same as with GCC 5.x).\n\nThis still refers to Sage 7.2 (plus some work-arounds).\n\nSo the Singular problem appears to be a singular one. XD",
    "created_at": "2016-07-03T14:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282715",
    "user": "https://github.com/nexttime"
}
```

Just for the record:

If I compile everything except the Singular 3.1.7p1 package (the latter with GCC 5.4) with GCC 6.1.0, `ptestlong` passes for me (modulo the usual noise in one doctest, and two GAP tests which pass when rerun, but that's again the same as with GCC 5.x).

This still refers to Sage 7.2 (plus some work-arounds).

So the Singular problem appears to be a singular one. XD



---

archive/issue_comments_282716.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-07-03T15:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282716",
    "user": "https://github.com/vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_282717.json:
```json
{
    "body": "Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926",
    "created_at": "2016-07-03T15:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282717",
    "user": "https://github.com/vbraun"
}
```

Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926



---

archive/issue_comments_282718.json:
```json
{
    "body": "Replying to [comment:10 vbraun]:\n> Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926\n\n\nWhile it doesn't immediately crash, I'm getting doctest failures with that.\n\n`ptestlong` hasn't (fully) finished yet, but it seems just because of a singular Singular process running 100%...",
    "created_at": "2016-07-03T16:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282718",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:10 vbraun]:
> Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926


While it doesn't immediately crash, I'm getting doctest failures with that.

`ptestlong` hasn't (fully) finished yet, but it seems just because of a singular Singular process running 100%...



---

archive/issue_comments_282719.json:
```json
{
    "body": "Replying to [comment:11 leif]:\n> Replying to [comment:10 vbraun]:\n> > Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926\n\n> \n> While it doesn't immediately crash, I'm getting doctest failures with that.\n> \n> `ptestlong` hasn't (fully) finished yet, but it seems just because of a singular Singular process running 100%...\n\n\nThat's the last test it was waiting for (with Singular 100% busy for a while):\n\n```\nsage -t --long src/sage/schemes/plane_conics/con_rational_function_field.py\n    Timed out (and interrupt failed)\n**********************************************************************\nTests run before process (pid=10413) timed out:\nsage: K = FractionField(PolynomialRing(QQ, 't')) ## line 17 ##\nsage: P.<X, Y, Z> = K[] ## line 18 ##\nsage: Conic(X^2 + Y^2 - Z^2) ## line 19 ##\nProjective Conic Curve over Fraction Field of Univariate Polynomial Ring in t over Rational Field defined by X^2 + Y^2 - Z^2\nsage: K.<t> = FractionField(QQ['t']) ## line 26 ##\nsage: C = Conic([1,-t,t]) ## line 27 ##\nsage: C.has_rational_point(point = True) ## line 28 ##\n(True, (0 : 1 : 1))\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 30 ##\n0\nsage: K = FractionField(PolynomialRing(QQ, 't')) ## line 58 ##\nsage: P.<X, Y, Z> = K[] ## line 59 ##\nsage: Conic(X^2 + Y^2 - Z^2) ## line 60 ##\nProjective Conic Curve over Fraction Field of Univariate Polynomial Ring in t over Rational Field defined by X^2 + Y^2 - Z^2\nsage: K = FractionField(PolynomialRing(QQ, 't')) ## line 67 ##\nsage: Conic([K(1), 1, -1])._test_pickling() ## line 68 ##\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 76 ##\n0\nsage: c = Conic([1, 1, 1]); c ## line 83 ##\nProjective Conic Curve over Rational Field defined by x^2 + y^2 + z^2\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 86 ##\n0\nsage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 129 ##\nsage: C = Conic(K, [t^2-2, 2*t^3, -2*t^3-13*t^2-2*t+18]) ## line 130 ##\nsage: C.has_rational_point() ## line 135 ##\nTrue\nsage: C.has_rational_point(point=True) ## line 137 ##\n(True, (5*t : 8 : 1))\nsage: F.<i> = QuadraticField(-1) ## line 139 ##\nsage: R.<t> = F[] ## line 140 ##\nsage: C = Conic([1,i*t,-t^2+4]) ## line 141 ##\nsage: C.has_rational_point(point = True) ## line 142 ##\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\n(True, (-t - 2*i : -2*i : 1))\nsage: K.<t> = QQ[] ## line 149 ##\nsage: C = Conic([4, -4, 8, 1, -4, t + 4]) ## line 150 ##\nsage: C.has_rational_point(point=True) ## line 151 ##\n(True, (1/2 : 1 : 0))\nsage: K.<t> = QQ[] ## line 156 ##\nsage: C = Conic(K, [t^2, (t-1), -2*(t-1)]) ## line 157 ##\nsage: C.has_rational_point() ## line 158 ##\nFalse\nsage: C.has_rational_point(point=True) ## line 160 ##\n(False, None)\nsage: F.<t1> = FractionField(QQ['t1']) ## line 167 ##\nsage: K.<t2> = FractionField(F['t2']) ## line 168 ##\nsage: a = K(1) ## line 169 ##\nsage: b = 2*t2^2+2*t1*t2-t1^2 ## line 170 ##\nsage: c = -3*t2^4-4*t1*t2^3+8*t1^2*t2^2+16*t1^3-t2-48*t1^4 ## line 171 ##\nsage: C = Conic([a,b,c]) ## line 172 ##\nsage: C.has_rational_point() ## line 173 ##\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nsage: P.<u> = QQ[] ## line 186 ##\nsage: E = P.fraction_field() ## line 187 ##\nsage: Q.<Y> = E[] ## line 188 ##\nsage: F.<v> = E.extension(Y^2 - u^3 - 1) ## line 189 ##\nsage: R.<t> = F[] ## line 190 ##\nsage: K = R.fraction_field() ## line 191 ##\nsage: C = Conic(K, [u, v, 1]) ## line 192 ##\nsage: C.has_rational_point() ## line 193 ##\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nverbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.\nsage: K.<t> = PolynomialRing(GF(7)) ## line 205 ##\nsage: C = Conic([5*t^2+4, t^2+3*t+3, 6*t^2+3*t+2, 5*t^2+5, 4*t+3, 4*t^2+t+5]) ## line 206 ##\nsage: C.has_rational_point() ## line 207 ##\nsage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 224 ##\nsage: a = (2*t^2 - 3/2*t + 1)/(37/3*t^2 + t - 1/4) ## line 225 ##\nsage: b = (1/2*t^2 + 1/3)/(-73*t^2 - 2*t + 11/4) ## line 226 ##\nsage: c = (6934/3*t^6 + 8798/3*t^5 - 947/18*t^4 + 3949/9*t^3 + 20983/18*t^2 + 28/3*t - 131/3)/(-2701/3*t^4 - 293/3*t^3 + 301/6*t^2 + 13/4*t - 11/16) ## line 227 ##\nsage: C = Conic([a,b,c]) ## line 228 ##\nsage: C.has_rational_point(point=True) ## line 229 ##\n(True, (4*t + 4 : 2*t + 2 : 1))\nsage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 234 ##\nsage: a = (-1/3*t^6 - 14*t^5 - 1/4*t^4 + 7/2*t^2 - 1/2*t - 1)/(24/5*t^6 - t^5 - 1/4*t^4 + t^3 - 3*t^2 + 8/5*t + 5) ## line 235 ##\nsage: b = (-3*t^3 + 8*t + 1/2)/(-1/3*t^3 + 3/2*t^2 + 1/12*t + 1/2) ## line 236 ##\nsage: c = (1232009/225*t^25 - 1015925057/8100*t^24 + 1035477411553/1458000*t^23 + 7901338091/30375*t^22 - 1421379260447/729000*t^21 + 266121260843/972000*t^20 + 80808723191/486000*t^19 - 516656082523/972000*t^18 + 21521589529/40500*t^17 + 4654758997/21600*t^16 - 20064038625227/9720000*t^15 - 173054270347/324000*t^14 + 536200870559/540000*t^13 - 12710739349/50625*t^12 - 197968226971/135000*t^11 - 134122025657/810000*t^10 + 22685316301/120000*t^9 - 2230847689/21600*t^8 - 70624099679/270000*t^7 - 4298763061/270000*t^6 - 41239/216000*t^5 - 13523/36000*t^4 + 493/36000*t^3 + 83/2400*t^2 + 1/300*t + 1/200)/(-27378/125*t^17 + 504387/500*t^16 - 97911/2000*t^15 + 1023531/4000*t^14 + 1874841/8000*t^13 + 865381/12000*t^12 + 15287/375*t^11 + 6039821/6000*t^10 + 599437/1500*t^9 + 18659/250*t^8 + 1218059/6000*t^7 + 2025127/3000*t^6 + 1222759/6000*t^5 + 38573/200*t^4 + 8323/125*t^3 + 15453/125*t^2 + 17031/500*t + 441/10) ## line 237 ##\nsage: C = Conic([a,b,c]) ## line 238 ##\nsage: C.has_rational_point(point = True) # long time (4 seconds) ## line 239 ##\n\n**********************************************************************\n```\n\nExcluding unrelated failures in `src/sage/dev/`, the following tests failed (still in 7.2) with Singular built with GCC 6.1.0 and `-fno-delete-null-pointer-checks`:\n\n```\n----------------------------------------------------------------------\n...\nsage -t --long src/sage/doctest/forker.py  # 1 doctest failed\nsage -t --long src/sage/libs/singular/standard_options.py  # 2 doctests failed\nsage -t --long src/sage/matrix/matrix_double_dense.pyx  # 1 doctest failed\nsage -t --long src/sage/libs/gap/assigned_names.py  # 1 doctest failed\nsage -t --long src/sage/rings/invariant_theory.py  # 13 doctests failed\nsage -t --long src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py  # 2 doctests failed\nsage -t --long src/sage/rings/ideal.py  # 1 doctest failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed\nsage -t --long src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/ell_field.py  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/ell_curve_isogeny.py  # 1 doctest failed\nsage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # 15 doctests failed\nsage -t --long src/sage/schemes/elliptic_curves/jacobian.py  # 1 doctest failed\nsage -t --long src/sage/tests/french_book/mpoly.py  # 1 doctest failed\nsage -t --long src/sage/schemes/plane_conics/con_rational_function_field.py  # Timed out (and interrupt failed)\n----------------------------------------------------------------------\n```\n\nThe GAP failure is unrelated (but typical here, passes when rerun), while the forker doctest failure is indeed indirectly caused by Singular (or libsingular), also fails when rerun:\n\n```\nsage -t --long src/sage/doctest/forker.py\n**********************************************************************\nFile \"src/sage/doctest/forker.py\", line 1402, in sage.doctest.forker.DocTestDispatcher.serial_dispatch\nFailed example:\n    DD.serial_dispatch()\nExpected:\n    sage -t .../rings/homset.py\n        [... tests, ... s]\n    sage -t .../rings/ideal.py\n        [... tests, ... s]\nGot:\n    sage -t /data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/homset.py\n        [46 tests, 0.12 s]\n    sage -t /data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/ideal.py\n    **********************************************************************\n    File \"/data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/ideal.py\", line 1611, in sage.rings.ideal.Cyclic\n    Failed example:\n        len(B)\n    Expected:\n        45\n    Got:\n        1\n    **********************************************************************\n    1 item had failures:\n       1 of   9 in sage.rings.ideal.Cyclic\n        [351 tests, 1 failure, 52.37 s]\n**********************************************************************\n1 item had failures:\n   1 of  17 in sage.doctest.forker.DocTestDispatcher.serial_dispatch\n    [439 tests, 1 failure, 63.08 s]\n----------------------------------------------------------------------\nsage -t --long src/sage/doctest/forker.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2016-07-03T17:55:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282719",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:11 leif]:
> Replying to [comment:10 vbraun]:
> > Singular works with `-fno-delete-null-pointer-checks`, which I added at #20926

> 
> While it doesn't immediately crash, I'm getting doctest failures with that.
> 
> `ptestlong` hasn't (fully) finished yet, but it seems just because of a singular Singular process running 100%...


That's the last test it was waiting for (with Singular 100% busy for a while):

```
sage -t --long src/sage/schemes/plane_conics/con_rational_function_field.py
    Timed out (and interrupt failed)
**********************************************************************
Tests run before process (pid=10413) timed out:
sage: K = FractionField(PolynomialRing(QQ, 't')) ## line 17 ##
sage: P.<X, Y, Z> = K[] ## line 18 ##
sage: Conic(X^2 + Y^2 - Z^2) ## line 19 ##
Projective Conic Curve over Fraction Field of Univariate Polynomial Ring in t over Rational Field defined by X^2 + Y^2 - Z^2
sage: K.<t> = FractionField(QQ['t']) ## line 26 ##
sage: C = Conic([1,-t,t]) ## line 27 ##
sage: C.has_rational_point(point = True) ## line 28 ##
(True, (0 : 1 : 1))
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 30 ##
0
sage: K = FractionField(PolynomialRing(QQ, 't')) ## line 58 ##
sage: P.<X, Y, Z> = K[] ## line 59 ##
sage: Conic(X^2 + Y^2 - Z^2) ## line 60 ##
Projective Conic Curve over Fraction Field of Univariate Polynomial Ring in t over Rational Field defined by X^2 + Y^2 - Z^2
sage: K = FractionField(PolynomialRing(QQ, 't')) ## line 67 ##
sage: Conic([K(1), 1, -1])._test_pickling() ## line 68 ##
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 76 ##
0
sage: c = Conic([1, 1, 1]); c ## line 83 ##
Projective Conic Curve over Rational Field defined by x^2 + y^2 + z^2
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 86 ##
0
sage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 129 ##
sage: C = Conic(K, [t^2-2, 2*t^3, -2*t^3-13*t^2-2*t+18]) ## line 130 ##
sage: C.has_rational_point() ## line 135 ##
True
sage: C.has_rational_point(point=True) ## line 137 ##
(True, (5*t : 8 : 1))
sage: F.<i> = QuadraticField(-1) ## line 139 ##
sage: R.<t> = F[] ## line 140 ##
sage: C = Conic([1,i*t,-t^2+4]) ## line 141 ##
sage: C.has_rational_point(point = True) ## line 142 ##
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
(True, (-t - 2*i : -2*i : 1))
sage: K.<t> = QQ[] ## line 149 ##
sage: C = Conic([4, -4, 8, 1, -4, t + 4]) ## line 150 ##
sage: C.has_rational_point(point=True) ## line 151 ##
(True, (1/2 : 1 : 0))
sage: K.<t> = QQ[] ## line 156 ##
sage: C = Conic(K, [t^2, (t-1), -2*(t-1)]) ## line 157 ##
sage: C.has_rational_point() ## line 158 ##
False
sage: C.has_rational_point(point=True) ## line 160 ##
(False, None)
sage: F.<t1> = FractionField(QQ['t1']) ## line 167 ##
sage: K.<t2> = FractionField(F['t2']) ## line 168 ##
sage: a = K(1) ## line 169 ##
sage: b = 2*t2^2+2*t1*t2-t1^2 ## line 170 ##
sage: c = -3*t2^4-4*t1*t2^3+8*t1^2*t2^2+16*t1^3-t2-48*t1^4 ## line 171 ##
sage: C = Conic([a,b,c]) ## line 172 ##
sage: C.has_rational_point() ## line 173 ##
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
sage: P.<u> = QQ[] ## line 186 ##
sage: E = P.fraction_field() ## line 187 ##
sage: Q.<Y> = E[] ## line 188 ##
sage: F.<v> = E.extension(Y^2 - u^3 - 1) ## line 189 ##
sage: R.<t> = F[] ## line 190 ##
sage: K = R.fraction_field() ## line 191 ##
sage: C = Conic(K, [u, v, 1]) ## line 192 ##
sage: C.has_rational_point() ## line 193 ##
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
verbose 0 (3369: multi_polynomial_ideal.py, groebner_basis) Warning: falling back to very slow toy implementation.
sage: K.<t> = PolynomialRing(GF(7)) ## line 205 ##
sage: C = Conic([5*t^2+4, t^2+3*t+3, 6*t^2+3*t+2, 5*t^2+5, 4*t+3, 4*t^2+t+5]) ## line 206 ##
sage: C.has_rational_point() ## line 207 ##
sage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 224 ##
sage: a = (2*t^2 - 3/2*t + 1)/(37/3*t^2 + t - 1/4) ## line 225 ##
sage: b = (1/2*t^2 + 1/3)/(-73*t^2 - 2*t + 11/4) ## line 226 ##
sage: c = (6934/3*t^6 + 8798/3*t^5 - 947/18*t^4 + 3949/9*t^3 + 20983/18*t^2 + 28/3*t - 131/3)/(-2701/3*t^4 - 293/3*t^3 + 301/6*t^2 + 13/4*t - 11/16) ## line 227 ##
sage: C = Conic([a,b,c]) ## line 228 ##
sage: C.has_rational_point(point=True) ## line 229 ##
(True, (4*t + 4 : 2*t + 2 : 1))
sage: K.<t> = FractionField(PolynomialRing(QQ, 't')) ## line 234 ##
sage: a = (-1/3*t^6 - 14*t^5 - 1/4*t^4 + 7/2*t^2 - 1/2*t - 1)/(24/5*t^6 - t^5 - 1/4*t^4 + t^3 - 3*t^2 + 8/5*t + 5) ## line 235 ##
sage: b = (-3*t^3 + 8*t + 1/2)/(-1/3*t^3 + 3/2*t^2 + 1/12*t + 1/2) ## line 236 ##
sage: c = (1232009/225*t^25 - 1015925057/8100*t^24 + 1035477411553/1458000*t^23 + 7901338091/30375*t^22 - 1421379260447/729000*t^21 + 266121260843/972000*t^20 + 80808723191/486000*t^19 - 516656082523/972000*t^18 + 21521589529/40500*t^17 + 4654758997/21600*t^16 - 20064038625227/9720000*t^15 - 173054270347/324000*t^14 + 536200870559/540000*t^13 - 12710739349/50625*t^12 - 197968226971/135000*t^11 - 134122025657/810000*t^10 + 22685316301/120000*t^9 - 2230847689/21600*t^8 - 70624099679/270000*t^7 - 4298763061/270000*t^6 - 41239/216000*t^5 - 13523/36000*t^4 + 493/36000*t^3 + 83/2400*t^2 + 1/300*t + 1/200)/(-27378/125*t^17 + 504387/500*t^16 - 97911/2000*t^15 + 1023531/4000*t^14 + 1874841/8000*t^13 + 865381/12000*t^12 + 15287/375*t^11 + 6039821/6000*t^10 + 599437/1500*t^9 + 18659/250*t^8 + 1218059/6000*t^7 + 2025127/3000*t^6 + 1222759/6000*t^5 + 38573/200*t^4 + 8323/125*t^3 + 15453/125*t^2 + 17031/500*t + 441/10) ## line 237 ##
sage: C = Conic([a,b,c]) ## line 238 ##
sage: C.has_rational_point(point = True) # long time (4 seconds) ## line 239 ##

**********************************************************************
```

Excluding unrelated failures in `src/sage/dev/`, the following tests failed (still in 7.2) with Singular built with GCC 6.1.0 and `-fno-delete-null-pointer-checks`:

```
----------------------------------------------------------------------
...
sage -t --long src/sage/doctest/forker.py  # 1 doctest failed
sage -t --long src/sage/libs/singular/standard_options.py  # 2 doctests failed
sage -t --long src/sage/matrix/matrix_double_dense.pyx  # 1 doctest failed
sage -t --long src/sage/libs/gap/assigned_names.py  # 1 doctest failed
sage -t --long src/sage/rings/invariant_theory.py  # 13 doctests failed
sage -t --long src/sage/rings/asymptotic/asymptotics_multivariate_generating_functions.py  # 2 doctests failed
sage -t --long src/sage/rings/ideal.py  # 1 doctest failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long src/sage/rings/polynomial/multi_polynomial_ideal_libsingular.pyx  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/ell_field.py  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/ell_curve_isogeny.py  # 1 doctest failed
sage -t --long src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # 15 doctests failed
sage -t --long src/sage/schemes/elliptic_curves/jacobian.py  # 1 doctest failed
sage -t --long src/sage/tests/french_book/mpoly.py  # 1 doctest failed
sage -t --long src/sage/schemes/plane_conics/con_rational_function_field.py  # Timed out (and interrupt failed)
----------------------------------------------------------------------
```

The GAP failure is unrelated (but typical here, passes when rerun), while the forker doctest failure is indeed indirectly caused by Singular (or libsingular), also fails when rerun:

```
sage -t --long src/sage/doctest/forker.py
**********************************************************************
File "src/sage/doctest/forker.py", line 1402, in sage.doctest.forker.DocTestDispatcher.serial_dispatch
Failed example:
    DD.serial_dispatch()
Expected:
    sage -t .../rings/homset.py
        [... tests, ... s]
    sage -t .../rings/ideal.py
        [... tests, ... s]
Got:
    sage -t /data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/homset.py
        [46 tests, 0.12 s]
    sage -t /data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/ideal.py
    **********************************************************************
    File "/data/Sage/release/stable/sage-7.2-gcc-6.1.0/src/sage/rings/ideal.py", line 1611, in sage.rings.ideal.Cyclic
    Failed example:
        len(B)
    Expected:
        45
    Got:
        1
    **********************************************************************
    1 item had failures:
       1 of   9 in sage.rings.ideal.Cyclic
        [351 tests, 1 failure, 52.37 s]
**********************************************************************
1 item had failures:
   1 of  17 in sage.doctest.forker.DocTestDispatcher.serial_dispatch
    [439 tests, 1 failure, 63.08 s]
----------------------------------------------------------------------
sage -t --long src/sage/doctest/forker.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_282720.json:
```json
{
    "body": "All of the above Singular-related failures vanish when building Singular with `-O1 -fno-delete-null-pointer-checks`, so there's more optimization options we apparently have to disable with GCC 6.1.0.",
    "created_at": "2016-07-03T19:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282720",
    "user": "https://github.com/nexttime"
}
```

All of the above Singular-related failures vanish when building Singular with `-O1 -fno-delete-null-pointer-checks`, so there's more optimization options we apparently have to disable with GCC 6.1.0.



---

archive/issue_events_055734.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-07-03T21:58:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20501#event-55734"
}
```



---

archive/issue_comments_282721.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-07-03T21:58:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282721",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_282722.json:
```json
{
    "body": "Replying to [comment:13 leif]:\n> All of the above Singular-related failures vanish when building Singular with `-O1 -fno-delete-null-pointer-checks`, so there's more optimization options we apparently have to disable with GCC 6.1.0.\n\n\nWith `env CXXFLAGS=\"-fno-strict-overflow -fno-delete-null-pointer-checks\" ./sage -f singular` all Singular-related doctests again pass in `make ptestlong`.",
    "created_at": "2016-07-03T23:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20501",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20501#issuecomment-282722",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:13 leif]:
> All of the above Singular-related failures vanish when building Singular with `-O1 -fno-delete-null-pointer-checks`, so there's more optimization options we apparently have to disable with GCC 6.1.0.


With `env CXXFLAGS="-fno-strict-overflow -fno-delete-null-pointer-checks" ./sage -f singular` all Singular-related doctests again pass in `make ptestlong`.
