# Issue 15788: numerical inconsistency with exponential integral values Ei(x)

archive/issues_015788.json:
```json
{
    "body": "\n```\nsage: Ei(1.1,prec=300)\n/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: The prec keyword argument is deprecated. Explicitly set the precision of the input, for example Ei(RealField(300)(1)), or use the prec argument to .n() for exact inputs, e.g., Ei(1).n(300), instead.\nSee http://trac.sagemath.org/7748 for details.\n  #!/usr/bin/env python\n2.16737827956340306615064476647912607220394065907142504328679588538509331805598360907980986\n\nsage: Ei(1.1).n(300)\n2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000\n\nsage: Ei(RealField(300)(1.1))\n2.16737827956340282358378734233807621497112737591639704719499002090327541763352339357795426\n```\n\nNot sure what would be correct, though.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16025\n\n",
    "created_at": "2014-03-27T17:45:44Z",
    "labels": [
        "calculus",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "numerical inconsistency with exponential integral values Ei(x)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15788",
    "user": "@rwst"
}
```

```
sage: Ei(1.1,prec=300)
/home/ralf/sage/src/bin/sage-ipython:1: DeprecationWarning: The prec keyword argument is deprecated. Explicitly set the precision of the input, for example Ei(RealField(300)(1)), or use the prec argument to .n() for exact inputs, e.g., Ei(1).n(300), instead.
See http://trac.sagemath.org/7748 for details.
  #!/usr/bin/env python
2.16737827956340306615064476647912607220394065907142504328679588538509331805598360907980986

sage: Ei(1.1).n(300)
2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000

sage: Ei(RealField(300)(1.1))
2.16737827956340282358378734233807621497112737591639704719499002090327541763352339357795426
```

Not sure what would be correct, though.

Issue created by migration from https://trac.sagemath.org/ticket/16025





---

archive/issue_comments_204720.json:
```json
{
    "body": "Oh, dear.  This is because we auto-evaluate things with decimal points.\n\n```\nsage: Ei(1.1)\n2.16737827956340\nsage: Ei(1.1).n(300)\n2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000\n```\n\nNot sure where those other things come from - floating point remains, I guess?  Especially since the last few digits are a power of two...\n\nThe `prec` deprecation was intended for things like \n\n```\nsage: Ei(1)\nEi(1)\nsage: Ei(1).n(300)\n1.89511781635593675546652093433163426901706058173270759164622843188251383453380415354890071\n```\n\nbut apparently the warning happens no matter what.  And if you read the warning closely (!):\n\n```\nExplicitly set the precision of the input, for example \nEi(RealField(300)(1)), or use the prec argument to .n() for exact inputs, \ne.g., Ei(1).n(300), instead.\n```\n\nSo ... are you asking for more clarification of this (which I would understand) or are you saying it is wrong?   `1.1` is not \"exact\" so the warning is telling us to explicitly set the precision of the input.  Maybe the example should be one that isn't exact, and say more about that being appropriate then?",
    "created_at": "2014-03-28T01:10:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204720",
    "user": "@kcrisman"
}
```

Oh, dear.  This is because we auto-evaluate things with decimal points.

```
sage: Ei(1.1)
2.16737827956340
sage: Ei(1.1).n(300)
2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000
```

Not sure where those other things come from - floating point remains, I guess?  Especially since the last few digits are a power of two...

The `prec` deprecation was intended for things like 

```
sage: Ei(1)
Ei(1)
sage: Ei(1).n(300)
1.89511781635593675546652093433163426901706058173270759164622843188251383453380415354890071
```

but apparently the warning happens no matter what.  And if you read the warning closely (!):

```
Explicitly set the precision of the input, for example 
Ei(RealField(300)(1)), or use the prec argument to .n() for exact inputs, 
e.g., Ei(1).n(300), instead.
```

So ... are you asking for more clarification of this (which I would understand) or are you saying it is wrong?   `1.1` is not "exact" so the warning is telling us to explicitly set the precision of the input.  Maybe the example should be one that isn't exact, and say more about that being appropriate then?



---

archive/issue_comments_204721.json:
```json
{
    "body": "Replying to [comment:1 kcrisman]:\n> So ... are you asking for more clarification of this\nI was just naively comparing and, frankly, I see no reason why we should surprise the user with\n\n```\nsage: Ei(1.1).n(300)\n2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000\nsage: Ei(11/10).n(300)\n2.16737827956340282358378734233807621497112737591639704719499002090327541763352339357795426\n```\n\nUpdate:\nLet's assume I accept the convention of 1.1 being auto-evaluated as 53-bit real, then I would expect a warning of some kind on the attempt of getting 300 bits of precision from it.",
    "created_at": "2014-03-28T09:02:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204721",
    "user": "@rwst"
}
```

Replying to [comment:1 kcrisman]:
> So ... are you asking for more clarification of this
I was just naively comparing and, frankly, I see no reason why we should surprise the user with

```
sage: Ei(1.1).n(300)
2.16737827956340289858871983597055077552795410156250000000000000000000000000000000000000000
sage: Ei(11/10).n(300)
2.16737827956340282358378734233807621497112737591639704719499002090327541763352339357795426
```

Update:
Let's assume I accept the convention of 1.1 being auto-evaluated as 53-bit real, then I would expect a warning of some kind on the attempt of getting 300 bits of precision from it.



---

archive/issue_comments_204722.json:
```json
{
    "body": "I think this convention has been deciding on by others.  However, I do agree that perhaps it's confusing in the way you suggest.  I don't feel like I know enough about how people want to use reals in this way, so I wouldn't come down on either side here, but I think it's totally reasonable to [ask on sage-support](https://groups.google.com/forum/#!topic/sage-support/YI62-vWjvww) - or even on sage-devel - whether this is a silly situation.  Your example above cuts to the chase, although it happens just as well on things like\n\n```\nprint sqrt(4.001).n(300)\nprint sqrt(4001/1000).n(300)\n```\n\nso no need to invoke special functions, and I'll put that in the thread.",
    "created_at": "2014-03-28T18:27:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204722",
    "user": "@kcrisman"
}
```

I think this convention has been deciding on by others.  However, I do agree that perhaps it's confusing in the way you suggest.  I don't feel like I know enough about how people want to use reals in this way, so I wouldn't come down on either side here, but I think it's totally reasonable to [ask on sage-support](https://groups.google.com/forum/#!topic/sage-support/YI62-vWjvww) - or even on sage-devel - whether this is a silly situation.  Your example above cuts to the chase, although it happens just as well on things like

```
print sqrt(4.001).n(300)
print sqrt(4001/1000).n(300)
```

so no need to invoke special functions, and I'll put that in the thread.



---

archive/issue_comments_204723.json:
```json
{
    "body": "The functionality already exists in `sage.symbolic.constants.LimitedPrecisionConstant`:\n\n```\nsage: brun.n(30)\n1.9021606\nsage: brun.n(50)\n...\nNotImplementedError: brun is only available up to 41 bits\n```\n\n\nSo another naive question, aren't all constants that have been input by the user, limited precision? What would break or have to be implemented if they were?",
    "created_at": "2014-03-30T07:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204723",
    "user": "@rwst"
}
```

The functionality already exists in `sage.symbolic.constants.LimitedPrecisionConstant`:

```
sage: brun.n(30)
1.9021606
sage: brun.n(50)
...
NotImplementedError: brun is only available up to 41 bits
```


So another naive question, aren't all constants that have been input by the user, limited precision? What would break or have to be implemented if they were?



---

archive/issue_comments_204724.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-16T20:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204724",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_204725.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-16T20:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204725",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204726.json:
```json
{
    "body": "Somehow I feel like there should be more documentation where the examples have disappeared.  Also, is there/should there be a numerical approximation method for the CC like you added for the RR?  (This may be a dumb question.)",
    "created_at": "2014-10-17T00:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204726",
    "user": "@kcrisman"
}
```

Somehow I feel like there should be more documentation where the examples have disappeared.  Also, is there/should there be a numerical approximation method for the CC like you added for the RR?  (This may be a dumb question.)



---

archive/issue_comments_204727.json:
```json
{
    "body": "Replying to [comment:12 kcrisman]:\n> Also, is there/should there be a numerical approximation method for the CC like you added for the RR?  (This may be a dumb question.)\nThis is for `RealLiteral`, not `RealNumber`. Given that there is no `ComplexLiteral`, no it doesn't have to be added. Remark also the difference (with or without this ticket):\n\n```\nsage: a = RR(CC(1.3))\nsage: b = RR(1.3)\nsage: a == b\nTrue\nsage: RealField(200)(a)\n1.3000000000000000444089209850062616169452667236328125000000\nsage: RealField(200)(b)\n1.3000000000000000000000000000000000000000000000000000000000\n```\n",
    "created_at": "2014-10-17T05:54:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204727",
    "user": "@jdemeyer"
}
```

Replying to [comment:12 kcrisman]:
> Also, is there/should there be a numerical approximation method for the CC like you added for the RR?  (This may be a dumb question.)
This is for `RealLiteral`, not `RealNumber`. Given that there is no `ComplexLiteral`, no it doesn't have to be added. Remark also the difference (with or without this ticket):

```
sage: a = RR(CC(1.3))
sage: b = RR(1.3)
sage: a == b
True
sage: RealField(200)(a)
1.3000000000000000444089209850062616169452667236328125000000
sage: RealField(200)(b)
1.3000000000000000000000000000000000000000000000000000000000
```




---

archive/issue_comments_204728.json:
```json
{
    "body": "Replying to [comment:12 kcrisman]:\n> Somehow I feel like there should be more documentation where the examples have disappeared.\nI assume you refer to the 2 examples in `src/sage/modules/free_module_element.pyx`? They were testing the `.n()` method for vectors, but there are already plenty of tests for that (also in `src/sage/misc/functional.py` for example).",
    "created_at": "2014-10-17T06:00:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204728",
    "user": "@jdemeyer"
}
```

Replying to [comment:12 kcrisman]:
> Somehow I feel like there should be more documentation where the examples have disappeared.
I assume you refer to the 2 examples in `src/sage/modules/free_module_element.pyx`? They were testing the `.n()` method for vectors, but there are already plenty of tests for that (also in `src/sage/misc/functional.py` for example).



---

archive/issue_comments_204729.json:
```json
{
    "body": "The part of tides is being take care of in #17179",
    "created_at": "2014-10-19T21:17:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204729",
    "user": "@miguelmarco"
}
```

The part of tides is being take care of in #17179



---

archive/issue_comments_204730.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-29T11:32:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204730",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204731.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-19T22:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204731",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204732.json:
```json
{
    "body": "> Let's assume I accept the convention of 1.1 being auto-evaluated as 53-bit real, then I would expect a warning of some kind on the attempt of getting 300 bits of precision from it.\n\nWas there ever any consensus on this?  I feel like maybe there was a sage-devel thread but I don't see it linked here.",
    "created_at": "2015-01-05T16:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204732",
    "user": "@kcrisman"
}
```

> Let's assume I accept the convention of 1.1 being auto-evaluated as 53-bit real, then I would expect a warning of some kind on the attempt of getting 300 bits of precision from it.

Was there ever any consensus on this?  I feel like maybe there was a sage-devel thread but I don't see it linked here.



---

archive/issue_comments_204733.json:
```json
{
    "body": "Replying to [comment:19 kcrisman]:\n> I feel like maybe there was a sage-devel thread but I don't see it linked here.\nI believe there was no such thread. Do you think there should be one?",
    "created_at": "2015-01-05T16:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204733",
    "user": "@jdemeyer"
}
```

Replying to [comment:19 kcrisman]:
> I feel like maybe there was a sage-devel thread but I don't see it linked here.
I believe there was no such thread. Do you think there should be one?



---

archive/issue_comments_204734.json:
```json
{
    "body": "> > I feel like maybe there was a sage-devel thread but I don't see it linked here.\n> I believe there was no such thread. Do you think there should be one?\nNot necessarily, but I'm wondering whether rws is convinced by the current discussion.",
    "created_at": "2015-01-05T17:12:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204734",
    "user": "@kcrisman"
}
```

> > I feel like maybe there was a sage-devel thread but I don't see it linked here.
> I believe there was no such thread. Do you think there should be one?
Not necessarily, but I'm wondering whether rws is convinced by the current discussion.



---

archive/issue_comments_204735.json:
```json
{
    "body": "I think I have seen discussions in the meantime which I guess have changed my opinion. Hey, that comment was 9 months ago, and I have learned a bit through my work on and with Sage. So consider me convinced please.",
    "created_at": "2015-01-05T17:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204735",
    "user": "@rwst"
}
```

I think I have seen discussions in the meantime which I guess have changed my opinion. Hey, that comment was 9 months ago, and I have learned a bit through my work on and with Sage. So consider me convinced please.



---

archive/issue_comments_204736.json:
```json
{
    "body": "Actually, perhaps Jeroen was convinced by you... I haven't looked at this in some time either.",
    "created_at": "2015-01-05T17:38:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204736",
    "user": "@kcrisman"
}
```

Actually, perhaps Jeroen was convinced by you... I haven't looked at this in some time either.



---

archive/issue_comments_204737.json:
```json
{
    "body": "There wasn't much \"convincing\" needed, I agreed that there was an issue indeed.",
    "created_at": "2015-01-05T18:56:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204737",
    "user": "@jdemeyer"
}
```

There wasn't much "convincing" needed, I agreed that there was an issue indeed.



---

archive/issue_comments_204738.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-01-05T19:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204738",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204739.json:
```json
{
    "body": "I think this should go in. It passes `make ptestlong`.",
    "created_at": "2015-01-16T16:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204739",
    "user": "@rwst"
}
```

I think this should go in. It passes `make ptestlong`.



---

archive/issue_comments_204740.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-01-16T16:59:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204740",
    "user": "@rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_204741.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-01-23T23:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15788",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15788#issuecomment-204741",
    "user": "@vbraun"
}
```

Resolution: fixed
