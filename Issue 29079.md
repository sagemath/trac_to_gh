# Issue 29079: Require ./configure before make

archive/issues_029079.json:
```json
{
    "body": "CC:  @dimpase @vbraun @jhpalmieri\n\nWith #27351, `configure` suggests a list of system packages to install.\nThe printed messages are easy to miss if users rely on `make` to invoke `configure`.\n\nIn this ticket, we make it an error to invoke `make` on an un-`configure`d source tree.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29316\n\n",
    "created_at": "2020-03-11T18:47:25Z",
    "labels": [
        "build",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Require ./configure before make",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29079",
    "user": "@mkoeppe"
}
```
CC:  @dimpase @vbraun @jhpalmieri

With #27351, `configure` suggests a list of system packages to install.
The printed messages are easy to miss if users rely on `make` to invoke `configure`.

In this ticket, we make it an error to invoke `make` on an un-`configure`d source tree.

Issue created by migration from https://trac.sagemath.org/ticket/29316





---

archive/issue_comments_411604.json:
```json
{
    "body": "I just started a discussion about this on sage-devel. This ticket could be expanded, or could be part of a family of tickets, which move all calls to `./configure` out of `Makefile`. Then this would solve #29310 and maybe some other tickets with `./configure` running too frequently.",
    "created_at": "2020-04-18T20:55:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411604",
    "user": "@jhpalmieri"
}
```

I just started a discussion about this on sage-devel. This ticket could be expanded, or could be part of a family of tickets, which move all calls to `./configure` out of `Makefile`. Then this would solve #29310 and maybe some other tickets with `./configure` running too frequently.



---

archive/issue_comments_411605.json:
```json
{
    "body": "Ah, ok. Now I see there's actually a rationale for having it an error to run make without configure because you WANT it to be a manual process. It remains that there are plenty of sub-configures run by sage's make anyway.",
    "created_at": "2020-04-18T21:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411605",
    "user": "@nbruin"
}
```

Ah, ok. Now I see there's actually a rationale for having it an error to run make without configure because you WANT it to be a manual process. It remains that there are plenty of sub-configures run by sage's make anyway.



---

archive/issue_comments_411606.json:
```json
{
    "body": "Replying to [comment:3 nbruin]:\n> Ah, ok. Now I see there's actually a rationale for having it an error to run make without configure because you WANT it to be a manual process. It remains that there are plenty of sub-configures run by sage's make anyway.\n\nsub-configures prepare other makefiles, not the main makefile, so this is not recursive, as opposed to what we have at the top level now, where we basically run `make && ./configure` in a loop until we reach a stable point, from which we can `make`.  \n----\nNew commits:",
    "created_at": "2020-04-19T01:18:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411606",
    "user": "@dimpase"
}
```

Replying to [comment:3 nbruin]:
> Ah, ok. Now I see there's actually a rationale for having it an error to run make without configure because you WANT it to be a manual process. It remains that there are plenty of sub-configures run by sage's make anyway.

sub-configures prepare other makefiles, not the main makefile, so this is not recursive, as opposed to what we have at the top level now, where we basically run `make && ./configure` in a loop until we reach a stable point, from which we can `make`.  
----
New commits:



---

archive/issue_comments_411607.json:
```json
{
    "body": "I'd have left SAGE_PORT stuff in place.",
    "created_at": "2020-04-19T14:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411607",
    "user": "@dimpase"
}
```

I'd have left SAGE_PORT stuff in place.



---

archive/issue_comments_411608.json:
```json
{
    "body": "SAGE_PORT does not work at all anyway because if configure exits with an error, all the required config files are not written!",
    "created_at": "2020-04-19T14:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411608",
    "user": "@mkoeppe"
}
```

SAGE_PORT does not work at all anyway because if configure exits with an error, all the required config files are not written!



---

archive/issue_comments_411609.json:
```json
{
    "body": "If you prefer, we can push the SAGE_PORT removal to another ticket and merge in 9.1 already",
    "created_at": "2020-04-19T14:59:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411609",
    "user": "@mkoeppe"
}
```

If you prefer, we can push the SAGE_PORT removal to another ticket and merge in 9.1 already



---

archive/issue_comments_411610.json:
```json
{
    "body": "OK, can we have it in 9.1?",
    "created_at": "2020-04-19T15:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411610",
    "user": "@dimpase"
}
```

OK, can we have it in 9.1?



---

archive/issue_comments_411611.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-19T15:49:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411611",
    "user": "@dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_411612.json:
```json
{
    "body": "I actually meant to merge the SAGE_PORT removal in 9.1\nand \"require ./configure before make\" in 9.2.",
    "created_at": "2020-04-19T15:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411612",
    "user": "@mkoeppe"
}
```

I actually meant to merge the SAGE_PORT removal in 9.1
and "require ./configure before make" in 9.2.



---

archive/issue_comments_411613.json:
```json
{
    "body": "any reason to delay \"./configure before make\" ?",
    "created_at": "2020-04-19T16:01:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411613",
    "user": "@dimpase"
}
```

any reason to delay "./configure before make" ?



---

archive/issue_comments_411614.json:
```json
{
    "body": "It's a change in how developers work, and I think it would be better to have a full beta cycle to test it and get people used to it.",
    "created_at": "2020-04-19T18:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411614",
    "user": "@jhpalmieri"
}
```

It's a change in how developers work, and I think it would be better to have a full beta cycle to test it and get people used to it.



---

archive/issue_comments_411615.json:
```json
{
    "body": "I agree with John. I've created #29533 for SAGE_PORT.",
    "created_at": "2020-04-19T18:37:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411615",
    "user": "@mkoeppe"
}
```

I agree with John. I've created #29533 for SAGE_PORT.



---

archive/issue_comments_411616.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T18:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411616",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_411617.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-04-21T00:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411617",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_411618.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-21T00:45:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411618",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_411619.json:
```json
{
    "body": "It works with a fresh tarball, but I'm a little surprised that after `make distclean`, running `make` does not produce the error message. I guess `make distclean` doesn't delete `config.status`. Should it?",
    "created_at": "2020-04-22T17:52:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411619",
    "user": "@jhpalmieri"
}
```

It works with a fresh tarball, but I'm a little surprised that after `make distclean`, running `make` does not produce the error message. I guess `make distclean` doesn't delete `config.status`. Should it?



---

archive/issue_comments_411620.json:
```json
{
    "body": "Replying to [comment:19 jhpalmieri]:\n> I guess `make distclean` doesn't delete `config.status`. \n\nYes, our `distclean` is non-standard in this regard. There is a target `bdist-clean` that deletes that extra file.\n\n> Should it?\n\nHard to tell. I am not sure about the intended meaning of `misc-clean`, `bdist-clean`, `distclean`, `bootstrap-clean`, `maintainer-clean`, `fast-rebuild-clean`, as well as `micro_release`. Perhaps `@`vbraun could weigh in here.",
    "created_at": "2020-04-23T03:43:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411620",
    "user": "@mkoeppe"
}
```

Replying to [comment:19 jhpalmieri]:
> I guess `make distclean` doesn't delete `config.status`. 

Yes, our `distclean` is non-standard in this regard. There is a target `bdist-clean` that deletes that extra file.

> Should it?

Hard to tell. I am not sure about the intended meaning of `misc-clean`, `bdist-clean`, `distclean`, `bootstrap-clean`, `maintainer-clean`, `fast-rebuild-clean`, as well as `micro_release`. Perhaps `@`vbraun could weigh in here.



---

archive/issue_comments_411621.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-23T15:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411621",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_411622.json:
```json
{
    "body": "It's a step in the right direction. Adjusting make targets is another story.",
    "created_at": "2020-04-23T15:07:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411622",
    "user": "@dimpase"
}
```

It's a step in the right direction. Adjusting make targets is another story.



---

archive/issue_comments_411623.json:
```json
{
    "body": "I basically agree, but the last line in this passage from the top-level `README.md` must be changed:\n\n```\nThe `configure` script itself, if it is not already built, can be generated by\nrunning the `bootstrap` script (the latter requires _GNU autotools_ being installed).\nThe top-level `Makefile` also takes care of this automatically.\n```\n\nMaybe this whole section of `README.md` should be changed? I don't know if there are other parts of the documentation we also need to change.\n\nI can certainly delete the line, but someone who knows autotools, configure files, etc., should really read this section and make any necessary changes.",
    "created_at": "2020-04-23T21:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411623",
    "user": "@jhpalmieri"
}
```

I basically agree, but the last line in this passage from the top-level `README.md` must be changed:

```
The `configure` script itself, if it is not already built, can be generated by
running the `bootstrap` script (the latter requires _GNU autotools_ being installed).
The top-level `Makefile` also takes care of this automatically.
```

Maybe this whole section of `README.md` should be changed? I don't know if there are other parts of the documentation we also need to change.

I can certainly delete the line, but someone who knows autotools, configure files, etc., should really read this section and make any necessary changes.



---

archive/issue_comments_411624.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-04-23T21:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411624",
    "user": "@jhpalmieri"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_411625.json:
```json
{
    "body": "Another spot: in the installation guide it says\n\n```\n#. Optional:  Run the configure script to set some options that\n   influence the build process.\n```\n\n(Item 6 at http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure.)\n\nWe can probably just delete the word \"Optional\" here.",
    "created_at": "2020-04-24T02:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411625",
    "user": "@jhpalmieri"
}
```

Another spot: in the installation guide it says

```
#. Optional:  Run the configure script to set some options that
   influence the build process.
```

(Item 6 at http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure.)

We can probably just delete the word "Optional" here.



---

archive/issue_comments_411626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-14T13:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_411627.json:
```json
{
    "body": "Replying to [comment:22 jhpalmieri]:\n> the last line in this passage from the top-level `README.md` must be changed:\n> {{{\n> The `configure` script itself, if it is not already built, can be generated by\n> running the `bootstrap` script (the latter requires _GNU autotools_ being installed).\n> The top-level `Makefile` also takes care of this automatically.\n> }}}\n> Maybe this whole section of `README.md` should be changed? \n\nDone.",
    "created_at": "2020-06-14T13:42:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411627",
    "user": "@mkoeppe"
}
```

Replying to [comment:22 jhpalmieri]:
> the last line in this passage from the top-level `README.md` must be changed:
> {{{
> The `configure` script itself, if it is not already built, can be generated by
> running the `bootstrap` script (the latter requires _GNU autotools_ being installed).
> The top-level `Makefile` also takes care of this automatically.
> }}}
> Maybe this whole section of `README.md` should be changed? 

Done.



---

archive/issue_comments_411628.json:
```json
{
    "body": "Replying to [comment:23 jhpalmieri]:\n> Another spot: in the installation guide it says\n> {{{\n> #. Optional:  Run the configure script to set some options that\n>    influence the build process.\n> }}}\n> (Item 6 at http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure.)\n> \n> We can probably just delete the word \"Optional\" here.\n\nApparently this was already done by another ticket.",
    "created_at": "2020-06-14T13:43:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411628",
    "user": "@mkoeppe"
}
```

Replying to [comment:23 jhpalmieri]:
> Another spot: in the installation guide it says
> {{{
> #. Optional:  Run the configure script to set some options that
>    influence the build process.
> }}}
> (Item 6 at http://doc.sagemath.org/html/en/installation/source.html#step-by-step-installation-procedure.)
> 
> We can probably just delete the word "Optional" here.

Apparently this was already done by another ticket.



---

archive/issue_comments_411629.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-14T13:43:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411629",
    "user": "@mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_411630.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-15T08:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411630",
    "user": "@dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_411631.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-06-15T08:20:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411631",
    "user": "@dimpase"
}
```

lgtm



---

archive/issue_comments_411632.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-06-15T15:33:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411632",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_411633.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-06-22T22:34:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29079",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29079#issuecomment-411633",
    "user": "@vbraun"
}
```

Resolution: fixed
