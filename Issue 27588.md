# Issue 27588: spkg-configure.m4 for libgd

archive/issues_027588.json:
```json
{
    "body": "CC:  @orlitzky @jdemeyer @kiwifb\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/27825\n\n",
    "created_at": "2019-05-13T18:24:34Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "spkg-configure.m4 for libgd",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27588",
    "user": "https://github.com/dimpase"
}
```
CC:  @orlitzky @jdemeyer @kiwifb



Issue created by migration from https://trac.sagemath.org/ticket/27825





---

archive/issue_comments_388837.json:
```json
{
    "body": "I'm trying \n\n```\nSAGE_SPKG_CONFIGURE([libgd], [\n    AC_REQUIRE([SAGE_SPKG_CONFIGURE_FREETYPE])\n    AC_MSG_CHECKING([Installing freetype? ])\n    if test x$sage_spkg_install_freetype= xyes; then\n      AC_MSG_RESULT([Yes. Install libgd as well.])\n      sage_spkg_install_libgd=yes\n    else\n      AC_MSG_RESULT([No.])\n      PKG_CHECK_MODULES([LIBGD], [gdlib >= 2.1], [], [sage_spkg_install_libgd=yes])\n    fi\n])\n```\nto see whether this produces a working Sage (on my system libgd is not linked to iconv, according to ldd).",
    "created_at": "2019-05-13T18:31:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388837",
    "user": "https://github.com/dimpase"
}
```

I'm trying 

```
SAGE_SPKG_CONFIGURE([libgd], [
    AC_REQUIRE([SAGE_SPKG_CONFIGURE_FREETYPE])
    AC_MSG_CHECKING([Installing freetype? ])
    if test x$sage_spkg_install_freetype= xyes; then
      AC_MSG_RESULT([Yes. Install libgd as well.])
      sage_spkg_install_libgd=yes
    else
      AC_MSG_RESULT([No.])
      PKG_CHECK_MODULES([LIBGD], [gdlib >= 2.1], [], [sage_spkg_install_libgd=yes])
    fi
])
```
to see whether this produces a working Sage (on my system libgd is not linked to iconv, according to ldd).



---

archive/issue_comments_388838.json:
```json
{
    "body": "(Wall-of-text alert. There's a tl;dr at the end, but I've dumped my reasoning for review so that we don't accidentally break some case I haven't thought of.)\n\nFor posterity, we [discussed the iconv dependency on the mailing list](https://groups.google.com/forum/#!topic/sage-devel/pXJXLNzJa48).\n\nThe libgd package has an [automagic dependency](https://wiki.gentoo.org/wiki/Project:Quality_Assurance/Automagic_dependencies) on iconv, meaning that it has optional support for iconv that is enabled automatically if a suitable iconv is present at build time. At that point, iconv is no longer optional, because libgd will be compiled to call some iconv functions, and will potentially be linked to libiconv.\n\nMoreover, there are a few ways that \"libiconv\" can be implemented. On modern linux systems, the calls are all part of glibc, which is why you don't see libgd being explicitly linked against iconv on those systems. However, on other operating systems, GNU libiconv is indeed installed as a separate package, and you will find libgd linked against it on those systems.\n\nNow, I don't believe that [SageMath](SageMath) uses any of the iconv support in libgd. The only [SageMath](SageMath) file to call a GD function is `matrix/matrix_mod2_dense.pyx` (someone confirm this?), and it doesn't pass any strings to the API. The only place iconv is used in libgd is in `src/gdkanji.c`, and it's used for manipulate string encodings. So, [SageMath](SageMath) shouldn't need it.\n\nAs a result, I don't think iconv should be a dependency of the [SageMath](SageMath) libgd package, but there are some conflicting goals here that I'll catalogue:\n\n1. We'd like the libgd built by sage to be consistent across platforms. That is, it should either have iconv support or not, regardless of the OS.\n2. We'd like the detected system libgd to be as consistent as possible with the one that sage builds; however...\n3. We don't want to force the system libgd to be built with a specific configuration with regards to iconv, because that will prevent the system package from being used in a lot of cases where it otherwise could.\n\nThere's no perfect solution for all three, and in my opinion the third is the most important, which forces us to choose between (1) and (2). The two associated plans of action are,\n\n1. Leave the iconv dependency in libgd, and accept a system libgd with no such support.\n2. Drop the iconv dependency in libgd, and take whatever happens.\n\nThe second option means that the libgd built by sage won't be consistent, but it does bring the sage package to parity with the system package check. And, it's simpler. So finally,\n\n**tl;dr** I think the practical solution is to\n\n* Remove iconv from libgd's dependencies\n* Remove iconv from libgd's SPKG.txt\n* Write spkg-configure.m4 without mention of iconv (like Dima just did).",
    "created_at": "2019-05-13T20:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388838",
    "user": "https://github.com/orlitzky"
}
```

(Wall-of-text alert. There's a tl;dr at the end, but I've dumped my reasoning for review so that we don't accidentally break some case I haven't thought of.)

For posterity, we [discussed the iconv dependency on the mailing list](https://groups.google.com/forum/#!topic/sage-devel/pXJXLNzJa48).

The libgd package has an [automagic dependency](https://wiki.gentoo.org/wiki/Project:Quality_Assurance/Automagic_dependencies) on iconv, meaning that it has optional support for iconv that is enabled automatically if a suitable iconv is present at build time. At that point, iconv is no longer optional, because libgd will be compiled to call some iconv functions, and will potentially be linked to libiconv.

Moreover, there are a few ways that "libiconv" can be implemented. On modern linux systems, the calls are all part of glibc, which is why you don't see libgd being explicitly linked against iconv on those systems. However, on other operating systems, GNU libiconv is indeed installed as a separate package, and you will find libgd linked against it on those systems.

Now, I don't believe that [SageMath](SageMath) uses any of the iconv support in libgd. The only [SageMath](SageMath) file to call a GD function is `matrix/matrix_mod2_dense.pyx` (someone confirm this?), and it doesn't pass any strings to the API. The only place iconv is used in libgd is in `src/gdkanji.c`, and it's used for manipulate string encodings. So, [SageMath](SageMath) shouldn't need it.

As a result, I don't think iconv should be a dependency of the [SageMath](SageMath) libgd package, but there are some conflicting goals here that I'll catalogue:

1. We'd like the libgd built by sage to be consistent across platforms. That is, it should either have iconv support or not, regardless of the OS.
2. We'd like the detected system libgd to be as consistent as possible with the one that sage builds; however...
3. We don't want to force the system libgd to be built with a specific configuration with regards to iconv, because that will prevent the system package from being used in a lot of cases where it otherwise could.

There's no perfect solution for all three, and in my opinion the third is the most important, which forces us to choose between (1) and (2). The two associated plans of action are,

1. Leave the iconv dependency in libgd, and accept a system libgd with no such support.
2. Drop the iconv dependency in libgd, and take whatever happens.

The second option means that the libgd built by sage won't be consistent, but it does bring the sage package to parity with the system package check. And, it's simpler. So finally,

**tl;dr** I think the practical solution is to

* Remove iconv from libgd's dependencies
* Remove iconv from libgd's SPKG.txt
* Write spkg-configure.m4 without mention of iconv (like Dima just did).



---

archive/issue_comments_388839.json:
```json
{
    "body": "Replying to [comment:1 dimpase]:\n> {{{\n>     AC_MSG_CHECKING([Installing freetype? ])\n> }}}\n\n\nlibpng too?",
    "created_at": "2019-05-13T20:20:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388839",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:1 dimpase]:
> {{{
>     AC_MSG_CHECKING([Installing freetype? ])
> }}}


libpng too?



---

archive/issue_comments_388840.json:
```json
{
    "body": "yes, sure, I didn't spell out all the dependencies yet.",
    "created_at": "2019-05-13T20:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388840",
    "user": "https://github.com/dimpase"
}
```

yes, sure, I didn't spell out all the dependencies yet.



---

archive/issue_comments_388841.json:
```json
{
    "body": "No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.",
    "created_at": "2019-05-13T21:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388841",
    "user": "https://github.com/dimpase"
}
```

No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.



---

archive/issue_comments_388842.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-05-13T21:43:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388842",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_388843.json:
```json
{
    "body": "Replying to [comment:5 dimpase]:\n> No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.\n\n\nWe should still check it ourselves, for the same reason we need the redundant libpng in libgd's `dependencies`: if freetype ever drops the libpng dependency, someone would be within his rights to remove that check from the freetype macro, and would have no idea that it's going to break libgd.\n\nThat breakage will manifest on some weird system a year later, and it will take us a lot more time to track it down then than it will to play it safe now.",
    "created_at": "2019-05-14T00:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388843",
    "user": "https://github.com/orlitzky"
}
```

Replying to [comment:5 dimpase]:
> No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.


We should still check it ourselves, for the same reason we need the redundant libpng in libgd's `dependencies`: if freetype ever drops the libpng dependency, someone would be within his rights to remove that check from the freetype macro, and would have no idea that it's going to break libgd.

That breakage will manifest on some weird system a year later, and it will take us a lot more time to track it down then than it will to play it safe now.



---

archive/issue_comments_388844.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-14T08:59:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388845.json:
```json
{
    "body": "Replying to [comment:6 mjo]:\n> Replying to [comment:5 dimpase]:\n> > No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.\n\n> \n> We should still check it ourselves, for the same reason we need the redundant libpng in libgd's `dependencies`: if freetype ever drops the libpng dependency, someone would be within his rights to remove that check from the freetype macro, and would have no idea that it's going to break libgd.\n\n\nOK, fixed.",
    "created_at": "2019-05-14T09:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388845",
    "user": "https://github.com/dimpase"
}
```

Replying to [comment:6 mjo]:
> Replying to [comment:5 dimpase]:
> > No need to explicitly check for libpng being from the system, as this is done by the freetype macro run.

> 
> We should still check it ourselves, for the same reason we need the redundant libpng in libgd's `dependencies`: if freetype ever drops the libpng dependency, someone would be within his rights to remove that check from the freetype macro, and would have no idea that it's going to break libgd.


OK, fixed.



---

archive/issue_comments_388846.json:
```json
{
    "body": "Hum... Feels circular at first sight (libpng <-> zlib). Also libgd actually picks many other formats- it is one of its point. Is libpng really the only one we care about? jpeg or anything else?",
    "created_at": "2019-05-15T07:43:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388846",
    "user": "https://github.com/kiwifb"
}
```

Hum... Feels circular at first sight (libpng <-> zlib). Also libgd actually picks many other formats- it is one of its point. Is libpng really the only one we care about? jpeg or anything else?



---

archive/issue_comments_388847.json:
```json
{
    "body": "this is what we build in Sage, just look at its libgd/dependencies.",
    "created_at": "2019-05-15T08:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388847",
    "user": "https://github.com/dimpase"
}
```

this is what we build in Sage, just look at its libgd/dependencies.



---

archive/issue_comments_388848.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-15T08:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388848",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388849.json:
```json
{
    "body": "Replying to [comment:11 dimpase]:\n> this is what we build in Sage, just look at its libgd/dependencies.\n\n\nFair enough. The chain of various checks between libpng, zlib and freetype is hurting my head. I am glad we can just abstract it and let autoconf deal with it until it complains. If it can digest it and produce a working configure script that's already a strong test.",
    "created_at": "2019-05-15T08:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388849",
    "user": "https://github.com/kiwifb"
}
```

Replying to [comment:11 dimpase]:
> this is what we build in Sage, just look at its libgd/dependencies.


Fair enough. The chain of various checks between libpng, zlib and freetype is hurting my head. I am glad we can just abstract it and let autoconf deal with it until it complains. If it can digest it and produce a working configure script that's already a strong test.



---

archive/issue_comments_388850.json:
```json
{
    "body": "Thanks, but please review its dependencies too!",
    "created_at": "2019-05-15T08:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388850",
    "user": "https://github.com/dimpase"
}
```

Thanks, but please review its dependencies too!



---

archive/issue_comments_388851.json:
```json
{
    "body": "I see, it is part of the same bundle.",
    "created_at": "2019-05-15T08:16:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388851",
    "user": "https://github.com/kiwifb"
}
```

I see, it is part of the same bundle.



---

archive/issue_comments_388852.json:
```json
{
    "body": "To release manager - this might need a configure bump.",
    "created_at": "2019-05-15T08:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388852",
    "user": "https://github.com/dimpase"
}
```

To release manager - this might need a configure bump.



---

archive/issue_comments_388853.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-05-15T08:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388853",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388854.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-05-15T08:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388855.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-15T08:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388855",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388856.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-05-15T10:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388857.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-05-15T10:26:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388858.json:
```json
{
    "body": "merged all the (potentially) configure-bumping positively reviewed tickets from #27330 here.",
    "created_at": "2019-05-15T10:29:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388858",
    "user": "https://github.com/dimpase"
}
```

merged all the (potentially) configure-bumping positively reviewed tickets from #27330 here.



---

archive/issue_comments_388859.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-15T12:50:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388859",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388860.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-05-17T09:36:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388860",
    "user": "https://github.com/embray"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388861.json:
```json
{
    "body": "Please--please give me a chance to review these.",
    "created_at": "2019-05-17T09:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388861",
    "user": "https://github.com/embray"
}
```

Please--please give me a chance to review these.



---

archive/issue_comments_388862.json:
```json
{
    "body": "Ok, on my current Cygwin (which is a slightly old version by several months) the detection of my system's libpng, libfreetype, and libgd all worked (the latter after I installed the libgd-devel package of course).\n\nrw not so much because (unsurprisingly) there is not a Cygwin package for rw.  Perhaps that's something I can do; up to this point I've actually never submitted a brand new Cygwin package, but I know more-or-less how it's done and rw should be very easy to package.",
    "created_at": "2019-05-17T11:07:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388862",
    "user": "https://github.com/embray"
}
```

Ok, on my current Cygwin (which is a slightly old version by several months) the detection of my system's libpng, libfreetype, and libgd all worked (the latter after I installed the libgd-devel package of course).

rw not so much because (unsurprisingly) there is not a Cygwin package for rw.  Perhaps that's something I can do; up to this point I've actually never submitted a brand new Cygwin package, but I know more-or-less how it's done and rw should be very easy to package.



---

archive/issue_comments_388863.json:
```json
{
    "body": "Just realized I also got this in my configure output:\n\n```\nconfigure: === checking whether to install the libgd SPKG ===\nchecking Installing freetype? ... ./configure: line 11221: test: xno=: unary operator expected\n```\n\nwill look into it...",
    "created_at": "2019-05-17T11:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388863",
    "user": "https://github.com/embray"
}
```

Just realized I also got this in my configure output:

```
configure: === checking whether to install the libgd SPKG ===
checking Installing freetype? ... ./configure: line 11221: test: xno=: unary operator expected
```

will look into it...



---

archive/issue_comments_388864.json:
```json
{
    "body": "could it be just missing space in `if test...` ?",
    "created_at": "2019-05-17T12:44:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388864",
    "user": "https://github.com/dimpase"
}
```

could it be just missing space in `if test...` ?



---

archive/issue_comments_388865.json:
```json
{
    "body": "That's what it looks like.  ~~I wonder if I just accidentally deleted the space while looking at the file.~~ No, it was already missing.",
    "created_at": "2019-05-17T13:06:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388865",
    "user": "https://github.com/embray"
}
```

That's what it looks like.  ~~I wonder if I just accidentally deleted the space while looking at the file.~~ No, it was already missing.



---

archive/issue_comments_388866.json:
```json
{
    "body": "Compiles OK on Cygwin (again, with all packages relevant to this ticket taken from the system, with the exception of rw). Still want to do a bit of functional testing but I don't imagine any major problems.",
    "created_at": "2019-05-21T14:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388866",
    "user": "https://github.com/embray"
}
```

Compiles OK on Cygwin (again, with all packages relevant to this ticket taken from the system, with the exception of rw). Still want to do a bit of functional testing but I don't imagine any major problems.



---

archive/issue_comments_388867.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-05-22T20:56:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_388868.json:
```json
{
    "body": "rebased over 8.8.beta6",
    "created_at": "2019-05-22T20:58:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388868",
    "user": "https://github.com/dimpase"
}
```

rebased over 8.8.beta6



---

archive/issue_comments_388869.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-05-24T09:03:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_388870.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-06-02T20:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_388871.json:
```json
{
    "body": "rebased over 8.8.beta7, bumped up configure version",
    "created_at": "2019-06-02T20:21:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388871",
    "user": "https://github.com/dimpase"
}
```

rebased over 8.8.beta7, bumped up configure version



---

archive/issue_comments_388872.json:
```json
{
    "body": "The module `sage.matrix.matrix_mod2_dense` turns out to be the only one that actually uses libgd.  And as I noted in #27901 the need for it is actually highly dubious.  For now I don't have the bandwidth to argue with it, but it seems likely to me that it's a dependency we can drop at some point.\n\nIn any case, that module tends to depend on more libraries than most others, in part due to the use of libgd, but not solely.  Also, the libgd on Cygwin is built with all of its dependencies.  With this an other related fixes on Cygwin I get:\n\n```\n$ ldd local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.dll\n        ntdll.dll => /cygdrive/c/WINDOWS/SYSTEM32/ntdll.dll (0x7ffddbdf0000)\n        KERNEL32.DLL => /cygdrive/c/WINDOWS/System32/KERNEL32.DLL (0x7ffddbbb0000)\n        KERNELBASE.dll => /cygdrive/c/WINDOWS/System32/KERNELBASE.dll (0x7ffdd8240000)\n        cygm4ri-0-0-20140914.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/cygm4ri-0-0-20140914.dll (0x3ccae0000)\n        cyggd-3.dll => /usr/bin/cyggd-3.dll (0x3f60e0000)\n        cyggmp-10.dll => /usr/bin/cyggmp-10.dll (0x3f5a30000)\n        cygwin1.dll => /usr/bin/cygwin1.dll (0x180040000)\n        cygpng16-16.dll => /usr/bin/cygpng16-16.dll (0x3ebfb0000)\n        cygfontconfig-1.dll => /usr/bin/cygfontconfig-1.dll (0x3f64e0000)\n        cygfreetype-6.dll => /usr/bin/cygfreetype-6.dll (0x3f62f0000)\n        cygimagequant-0.dll => /usr/bin/cygimagequant-0.dll (0x3f2f40000)\n        cygjpeg-8.dll => /usr/bin/cygjpeg-8.dll (0x3f2790000)\n        libpython2.7.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/libpython2.7.dll (0x3c20d0000)\n        cygtiff-6.dll => /usr/bin/cygtiff-6.dll (0x3ea7a0000)\n        cygwebp-7.dll => /usr/bin/cygwebp-7.dll (0x3ea350000)\n        cygiconv-2.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/cygiconv-2.dll (0x3cce10000)\n        cygz.dll => /usr/bin/cygz.dll (0x3e8dc0000)\n        cygexpat-1.dll => /usr/bin/cygexpat-1.dll (0x3f68e0000)\n        cyggcc_s-seh-1.dll => /usr/bin/cyggcc_s-seh-1.dll (0x3f4640000)\n        cyggomp-1.dll => /usr/bin/cyggomp-1.dll (0x3f5730000)\n        cygjbig-2.dll => /usr/bin/cygjbig-2.dll (0x3f2810000)\n        cygbz2-1.dll => /usr/bin/cygbz2-1.dll (0x3f7050000)\n        cyglzma-5.dll => /usr/bin/cyglzma-5.dll (0x3ed760000)\n        cygXpm-4.dll => /usr/bin/cygXpm-4.dll (0x3f7340000)\n        cygX11-6.dll => /usr/bin/cygX11-6.dll (0x3f7560000)\n        cygxcb-1.dll => /usr/bin/cygxcb-1.dll (0x3ea100000)\n        cygXau-6.dll => /usr/bin/cygXau-6.dll (0x3f7540000)\n        cygXdmcp-6.dll => /usr/bin/cygXdmcp-6.dll (0x3f7490000)\n```\n\nSo the only libraries coming from Sage and not from the system are:\n\n* iconv (high priority to fix this one IMO)\n* python\n* m4ri\n\nPretty good progress I'd say!",
    "created_at": "2019-06-07T17:35:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388872",
    "user": "https://github.com/embray"
}
```

The module `sage.matrix.matrix_mod2_dense` turns out to be the only one that actually uses libgd.  And as I noted in #27901 the need for it is actually highly dubious.  For now I don't have the bandwidth to argue with it, but it seems likely to me that it's a dependency we can drop at some point.

In any case, that module tends to depend on more libraries than most others, in part due to the use of libgd, but not solely.  Also, the libgd on Cygwin is built with all of its dependencies.  With this an other related fixes on Cygwin I get:

```
$ ldd local/lib/python2.7/site-packages/sage/matrix/matrix_mod2_dense.dll
        ntdll.dll => /cygdrive/c/WINDOWS/SYSTEM32/ntdll.dll (0x7ffddbdf0000)
        KERNEL32.DLL => /cygdrive/c/WINDOWS/System32/KERNEL32.DLL (0x7ffddbbb0000)
        KERNELBASE.dll => /cygdrive/c/WINDOWS/System32/KERNELBASE.dll (0x7ffdd8240000)
        cygm4ri-0-0-20140914.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/cygm4ri-0-0-20140914.dll (0x3ccae0000)
        cyggd-3.dll => /usr/bin/cyggd-3.dll (0x3f60e0000)
        cyggmp-10.dll => /usr/bin/cyggmp-10.dll (0x3f5a30000)
        cygwin1.dll => /usr/bin/cygwin1.dll (0x180040000)
        cygpng16-16.dll => /usr/bin/cygpng16-16.dll (0x3ebfb0000)
        cygfontconfig-1.dll => /usr/bin/cygfontconfig-1.dll (0x3f64e0000)
        cygfreetype-6.dll => /usr/bin/cygfreetype-6.dll (0x3f62f0000)
        cygimagequant-0.dll => /usr/bin/cygimagequant-0.dll (0x3f2f40000)
        cygjpeg-8.dll => /usr/bin/cygjpeg-8.dll (0x3f2790000)
        libpython2.7.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/libpython2.7.dll (0x3c20d0000)
        cygtiff-6.dll => /usr/bin/cygtiff-6.dll (0x3ea7a0000)
        cygwebp-7.dll => /usr/bin/cygwebp-7.dll (0x3ea350000)
        cygiconv-2.dll => /home/embray/src/sagemath/sage-cygwin/local/bin/cygiconv-2.dll (0x3cce10000)
        cygz.dll => /usr/bin/cygz.dll (0x3e8dc0000)
        cygexpat-1.dll => /usr/bin/cygexpat-1.dll (0x3f68e0000)
        cyggcc_s-seh-1.dll => /usr/bin/cyggcc_s-seh-1.dll (0x3f4640000)
        cyggomp-1.dll => /usr/bin/cyggomp-1.dll (0x3f5730000)
        cygjbig-2.dll => /usr/bin/cygjbig-2.dll (0x3f2810000)
        cygbz2-1.dll => /usr/bin/cygbz2-1.dll (0x3f7050000)
        cyglzma-5.dll => /usr/bin/cyglzma-5.dll (0x3ed760000)
        cygXpm-4.dll => /usr/bin/cygXpm-4.dll (0x3f7340000)
        cygX11-6.dll => /usr/bin/cygX11-6.dll (0x3f7560000)
        cygxcb-1.dll => /usr/bin/cygxcb-1.dll (0x3ea100000)
        cygXau-6.dll => /usr/bin/cygXau-6.dll (0x3f7540000)
        cygXdmcp-6.dll => /usr/bin/cygXdmcp-6.dll (0x3f7490000)
```

So the only libraries coming from Sage and not from the system are:

* iconv (high priority to fix this one IMO)
* python
* m4ri

Pretty good progress I'd say!



---

archive/issue_comments_388873.json:
```json
{
    "body": "As I have now have iconv's spkg-configure.m4, on #27823, we could go ahead and add the dependency on it for libgd.\n\nby right, however, it only needs testing if system's libgd is linked to libiconv, and I don't quite know how to check this (there is a deprecated gdlib-config script one can call, though)",
    "created_at": "2019-06-11T07:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388873",
    "user": "https://github.com/dimpase"
}
```

As I have now have iconv's spkg-configure.m4, on #27823, we could go ahead and add the dependency on it for libgd.

by right, however, it only needs testing if system's libgd is linked to libiconv, and I don't quite know how to check this (there is a deprecated gdlib-config script one can call, though)



---

archive/issue_comments_388874.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2019-06-11T11:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_388875.json:
```json
{
    "body": "rebased over 8.8.rc0; no configure bump done",
    "created_at": "2019-06-11T11:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388875",
    "user": "https://github.com/dimpase"
}
```

rebased over 8.8.rc0; no configure bump done



---

archive/issue_comments_388876.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-11T11:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388876",
    "user": "https://github.com/embray"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388877.json:
```json
{
    "body": "I still have some nitpicks about the `AC_MSG_CHECKING` message formatting being inconsistent in some cases.  But I'd rather just get this done for now, and apply my nitpicks in the next round of configure updates.",
    "created_at": "2019-06-11T11:47:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388877",
    "user": "https://github.com/embray"
}
```

I still have some nitpicks about the `AC_MSG_CHECKING` message formatting being inconsistent in some cases.  But I'd rather just get this done for now, and apply my nitpicks in the next round of configure updates.



---

archive/issue_events_068977.json:
```json
{
    "actor": "https://github.com/embray",
    "created_at": "2019-06-14T14:42:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "milestone": "sage-8.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27588#event-68977"
}
```



---

archive/issue_comments_388878.json:
```json
{
    "body": "This should obviously be postponed until the next release (hopefully early on).",
    "created_at": "2019-06-14T14:42:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388878",
    "user": "https://github.com/embray"
}
```

This should obviously be postponed until the next release (hopefully early on).



---

archive/issue_comments_388879.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2019-06-18T11:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_388880.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-06-18T11:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388881.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-18T11:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388881",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388882.json:
```json
{
    "body": "I guess this has fallen through rebasing cracks...",
    "created_at": "2019-06-18T11:19:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388882",
    "user": "https://github.com/dimpase"
}
```

I guess this has fallen through rebasing cracks...



---

archive/issue_comments_388883.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:",
    "created_at": "2019-07-04T06:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. This was a forced push. Last 10 new commits:



---

archive/issue_comments_388884.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2019-07-04T06:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_388885.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-04T06:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388885",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_388886.json:
```json
{
    "body": "rebased over latest beta",
    "created_at": "2019-07-04T06:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388886",
    "user": "https://github.com/dimpase"
}
```

rebased over latest beta



---

archive/issue_comments_388887.json:
```json
{
    "body": "removed \"wont fix\" deps from the description",
    "created_at": "2019-07-04T06:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388887",
    "user": "https://github.com/dimpase"
}
```

removed "wont fix" deps from the description



---

archive/issue_events_068978.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-07-04T18:05:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27588#event-68978"
}
```



---

archive/issue_comments_388888.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-04T18:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27588",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27588#issuecomment-388888",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
