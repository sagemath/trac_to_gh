# Issue 797: %timeit on command line doesn't recognize [1..10] syntax

archive/issues_000797.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "\n```\nsage: %time [1..10]\n------------------------------------------------------------\n   File \"<timed exec>\", line 1\n     [1..10]\n          ^\n<type 'exceptions.SyntaxError'>: invalid syntax\n\nsage: %timeit [1..10]\n------------------------------------------------------------\n   File \"<magic-timeit>\", line 6\n     [1..10]\n          ^\n<type 'exceptions.SyntaxError'>: invalid syntax\n\nsage: %timeit xrange(11)\n1000000 loops, best of 3: 392 ns per loop\n```\n\nComponent: **user interface**\n\nKeywords: **timeit ipython**\n\nAuthor: **Mike Hansen**\n\nReviewer: **Jason Grout**\n\nMerged: **sage-4.3.1.rc1**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/797_\n\n",
    "closed_at": "2010-01-18T22:39:07Z",
    "created_at": "2007-10-03T00:26:36Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-4.3.1",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "%timeit on command line doesn't recognize [1..10] syntax",
    "type": "issue",
    "updated_at": "2010-01-19T04:38:39Z",
    "url": "https://github.com/sagemath/sage/issues/797",
    "user": "https://github.com/jasongrout"
}
```

```
sage: %time [1..10]
------------------------------------------------------------
   File "<timed exec>", line 1
     [1..10]
          ^
<type 'exceptions.SyntaxError'>: invalid syntax

sage: %timeit [1..10]
------------------------------------------------------------
   File "<magic-timeit>", line 6
     [1..10]
          ^
<type 'exceptions.SyntaxError'>: invalid syntax

sage: %timeit xrange(11)
1000000 loops, best of 3: 392 ns per loop
```

Component: **user interface**

Keywords: **timeit ipython**

Author: **Mike Hansen**

Reviewer: **Jason Grout**

Merged: **sage-4.3.1.rc1**

_Issue created by migration from https://trac.sagemath.org/ticket/797_





---

archive/issue_events_007470.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2007-10-03T00:26:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "0000b0",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7470"
}
```



---

archive/issue_events_007471.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2007-10-03T00:26:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7471"
}
```



---

archive/issue_events_007472.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2007-10-03T00:26:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7472"
}
```



---

archive/issue_events_007473.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-03T00:26:36Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "subject": "https://github.com/jasongrout",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7473"
}
```



---

archive/issue_events_007474.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-10-03T01:40:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "milestone_number": null,
    "milestone_title": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7474"
}
```



---

archive/issue_events_007475.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-10-29T05:55:44Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "milestone_number": null,
    "milestone_title": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7475"
}
```



---

archive/issue_events_007476.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-10-29T05:55:44Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "milestone_number": null,
    "milestone_title": "sage-2.8.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7476"
}
```



---

archive/issue_comments_003396.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe workaround now is to use the timeit command, which does send things to the preparser.\n\n```\nsage: timeit('[1..10]')\n625 loops, best of 3: 220 \u00b5s per loop\n```",
    "created_at": "2009-01-14T08:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3396",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:3" align="right">comment:3</div>

The workaround now is to use the timeit command, which does send things to the preparser.

```
sage: timeit('[1..10]')
625 loops, best of 3: 220 µs per loop
```



---

archive/issue_events_007477.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-14T08:09:49Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7477"
}
```



---

archive/issue_events_007478.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-14T08:09:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7478"
}
```



---

archive/issue_events_007479.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-01-14T08:09:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7479"
}
```



---

archive/issue_comments_003397.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nJust because there is a workaround doesn't mean this should be closed.  I reported this problem to Fernando Perez of Ipython and he \"admitted\" that it is a bug, and was working on fixing it at that last sage days.  I'm re-opening this.\n\nBy the way, it's generally very bad for anybody but me or Michael Abshoff to close tickets on trac!",
    "created_at": "2009-01-14T16:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3397",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">comment:5</div>

Just because there is a workaround doesn't mean this should be closed.  I reported this problem to Fernando Perez of Ipython and he "admitted" that it is a bug, and was working on fixing it at that last sage days.  I'm re-opening this.

By the way, it's generally very bad for anybody but me or Michael Abshoff to close tickets on trac!



---

archive/issue_events_007480.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-01-14T16:49:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/wontfix",
    "label_color": "c6c6c6",
    "label_name": "wontfix",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7480"
}
```



---

archive/issue_events_007481.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-01-14T16:49:01Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7481"
}
```



---

archive/issue_comments_003398.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI only closed it after mabshoff gave his okay on IRC.  I guess I should have posted the IRC log.",
    "created_at": "2009-01-14T17:29:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3398",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:6" align="right">comment:6</div>

I only closed it after mabshoff gave his okay on IRC.  I guess I should have posted the IRC log.



---

archive/issue_comments_003399.json:
```json
{
    "body": "Replying to [ticket:797 jason]:\n\nHere is some account of what happens in Sage 3.2.3:\n\n```\nsage: %time [1..10]\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nWall time: 0.00 s\n[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]\n```\n\nSo, the first problem is not a problem anymore.\n\n```\nsage: %timeit [1..10]\n------------------------------------------------------------\n   File \"<magic-timeit>\", line 6\n     [1..10]\n          ^\nSyntaxError: invalid syntax\n```\n\nSo, that is the only remaining issue. I am now looking at `sage/misc/sage_timeit.py`.",
    "created_at": "2009-01-21T19:23:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3399",
    "user": "https://github.com/simon-king-jena"
}
```

Replying to [ticket:797 jason]:

Here is some account of what happens in Sage 3.2.3:

```
sage: %time [1..10]
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.00 s
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
```

So, the first problem is not a problem anymore.

```
sage: %timeit [1..10]
------------------------------------------------------------
   File "<magic-timeit>", line 6
     [1..10]
          ^
SyntaxError: invalid syntax
```

So, that is the only remaining issue. I am now looking at `sage/misc/sage_timeit.py`.



---

archive/issue_comments_003400.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWe can overwrite the default magic commands in IPython:\n\n```\nsage: _ip.expose_magic(\"timeit\", lambda self, s: timeit(s))\nsage: %timeit [1..10]\n625 loops, best of 3: 58.4 \u00b5s per loop\n```",
    "created_at": "2009-01-21T20:19:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3400",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:8" align="right">comment:8</div>

We can overwrite the default magic commands in IPython:

```
sage: _ip.expose_magic("timeit", lambda self, s: timeit(s))
sage: %timeit [1..10]
625 loops, best of 3: 58.4 µs per loop
```



---

archive/issue_comments_003401.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI somehow got the impression that it is an issue with preparsing, for the following reason:\n\n```\nsage: timeit('[1..10]',preparse=False)\n------------------------------------------------------------\n   File \"<magic-timeit>\", line 6\n     [1..10]\n          ^\nSyntaxError: invalid syntax\n```\n\nThis is the same error as in \n\n```\nsage: %timeit [1..10]\n```\n\nIn the code, by default preparsing should be done; namely, in `sage_timer.py` it says\n\n```\ndef sage_timeit(stmt, globals, preparse=None, number = 0, repeat = 3, precision = 3):\n...\n    if preparse is None:\n        preparse = interpreter.do_preparse\n```\n\nNow, we also have\n\n```\nsage: from sage.misc import interpreter\nsage: interpreter.do_preparse\nTrue\n```\n\nSo, it *should* be with preparsing.\n\nFor testing, I inserted a line in the code that prints the value of `preparse`.\n\nThe curious thing is that this line is executed when doing `timeit('[1..10]')` or `timeit.eval('[1..10]')`, but it is *not* executed when doing `%timeit [1..10]`.\n\nI was just told that `%timeit ...` should do the same as `timeit.eval('...')`, but apparently it doesn't. So, perhaps it is a problem with the `%`?\n\nCan you tell me where the behaviour of `%` is defined?",
    "created_at": "2009-01-21T20:48:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3401",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

I somehow got the impression that it is an issue with preparsing, for the following reason:

```
sage: timeit('[1..10]',preparse=False)
------------------------------------------------------------
   File "<magic-timeit>", line 6
     [1..10]
          ^
SyntaxError: invalid syntax
```

This is the same error as in 

```
sage: %timeit [1..10]
```

In the code, by default preparsing should be done; namely, in `sage_timer.py` it says

```
def sage_timeit(stmt, globals, preparse=None, number = 0, repeat = 3, precision = 3):
...
    if preparse is None:
        preparse = interpreter.do_preparse
```

Now, we also have

```
sage: from sage.misc import interpreter
sage: interpreter.do_preparse
True
```

So, it *should* be with preparsing.

For testing, I inserted a line in the code that prints the value of `preparse`.

The curious thing is that this line is executed when doing `timeit('[1..10]')` or `timeit.eval('[1..10]')`, but it is *not* executed when doing `%timeit [1..10]`.

I was just told that `%timeit ...` should do the same as `timeit.eval('...')`, but apparently it doesn't. So, perhaps it is a problem with the `%`?

Can you tell me where the behaviour of `%` is defined?



---

archive/issue_events_007482.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2009-01-21T20:48:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "title_is": "%timeit doesn't recognize [1..10] syntax",
    "title_was": "timeit doesn't recognize [1..10] syntax",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7482"
}
```



---

archive/issue_comments_003402.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAre you doing this in the notebook or the command-line?  They're two totally separate things.\n\nCan you hop on IRC?",
    "created_at": "2009-01-21T20:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3402",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:10" align="right">comment:10</div>

Are you doing this in the notebook or the command-line?  They're two totally separate things.

Can you hop on IRC?



---

archive/issue_comments_003403.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nWhen you run %timeit from the command-line, it runs code in IPython and does not touch any code in the Sage library.  The issue is that the IPython magic command \"%timeit\" doesn't do the preparsing.  Fernando was working on an upstream fix for this.  An easy downstream fix for this would be to do as I suggested above and overwrite the IPython version of timeit with our own with the expose_magic function.\n\n```\nsage: _ip.expose_magic(\"timeit\", lambda self, s: timeit(s))\nsage: %timeit [1..10]\n625 loops, best of 3: 58.4 \u00b5s per loop\n```\n\nThe right place to put this would probably be in local/bin/ipy_profile_sage.py.",
    "created_at": "2009-01-21T21:09:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3403",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:11" align="right">comment:11</div>

When you run %timeit from the command-line, it runs code in IPython and does not touch any code in the Sage library.  The issue is that the IPython magic command "%timeit" doesn't do the preparsing.  Fernando was working on an upstream fix for this.  An easy downstream fix for this would be to do as I suggested above and overwrite the IPython version of timeit with our own with the expose_magic function.

```
sage: _ip.expose_magic("timeit", lambda self, s: timeit(s))
sage: %timeit [1..10]
625 loops, best of 3: 58.4 µs per loop
```

The right place to put this would probably be in local/bin/ipy_profile_sage.py.



---

archive/issue_comments_003404.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@mwhansen](#comment%3A11):\n> When you run %timeit from the command-line, it runs code in IPython and does not touch any code in the Sage library.  The issue is that the IPython magic command \"%timeit\" doesn't do the preparsing.  Fernando was working on an upstream fix for this.  An easy downstream fix for this would be to do as I suggested above and overwrite the IPython version of timeit with our own with the expose_magic function.\n> \n> ```\n> sage: _ip.expose_magic(\"timeit\", lambda self, s: timeit(s))\n> sage: %timeit [1..10]\n> 625 loops, best of 3: 58.4 \u00b5s per loop\n> ```\n> \n> The right place to put this would probably be in local/bin/ipy_profile_sage.py.\n\nThank you!\n\nWhile you replied, I tried to post the following:\n\nReplying to [@mwhansen](#comment%3A10):\n> Are you doing this in the notebook or the command-line?  They're two totally separate things.\n\nIt is command-line, and I don't know what happens on the notebook. Can you test it?\n\nIf it is in `preparser_ipython`, then the following might be the source of trouble:\n\n```\ndef preparse_ipython(line, reset=True):\n    global num_lines\n    global q_lines\n\n    L = line.lstrip()\n    if L.startswith('%'):\n        # This should be installed as an Ipython magic command,\n        # but I don't know how yet...\n        L = L[1:].strip()\n        import sage.interfaces.all\n        if L.lower() in sage.interfaces.all.interfaces:\n            switch_interface(L.lower())\n            return \"''\"\n        else:\n            # only preparse non-magic lines\n            return line\n```\n\nHence, if the line starts with `%` and if the word after `%` is not the name of an interface than simply the line is returned unchanged. \n\nBut what happens afterwards? In the end of the day, `%timeit` gets an interpretation and does call some `timeit` command!\n\n> Can you hop on IRC?\n\nI try (I never used IRC before). So, if it works, see you soon.\n\nCheers\n Simon",
    "created_at": "2009-01-21T21:15:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3404",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@mwhansen](#comment%3A11):
> When you run %timeit from the command-line, it runs code in IPython and does not touch any code in the Sage library.  The issue is that the IPython magic command "%timeit" doesn't do the preparsing.  Fernando was working on an upstream fix for this.  An easy downstream fix for this would be to do as I suggested above and overwrite the IPython version of timeit with our own with the expose_magic function.
> 
> ```
> sage: _ip.expose_magic("timeit", lambda self, s: timeit(s))
> sage: %timeit [1..10]
> 625 loops, best of 3: 58.4 µs per loop
> ```
> 
> The right place to put this would probably be in local/bin/ipy_profile_sage.py.

Thank you!

While you replied, I tried to post the following:

Replying to [@mwhansen](#comment%3A10):
> Are you doing this in the notebook or the command-line?  They're two totally separate things.

It is command-line, and I don't know what happens on the notebook. Can you test it?

If it is in `preparser_ipython`, then the following might be the source of trouble:

```
def preparse_ipython(line, reset=True):
    global num_lines
    global q_lines

    L = line.lstrip()
    if L.startswith('%'):
        # This should be installed as an Ipython magic command,
        # but I don't know how yet...
        L = L[1:].strip()
        import sage.interfaces.all
        if L.lower() in sage.interfaces.all.interfaces:
            switch_interface(L.lower())
            return "''"
        else:
            # only preparse non-magic lines
            return line
```

Hence, if the line starts with `%` and if the word after `%` is not the name of an interface than simply the line is returned unchanged. 

But what happens afterwards? In the end of the day, `%timeit` gets an interpretation and does call some `timeit` command!

> Can you hop on IRC?

I try (I never used IRC before). So, if it works, see you soon.

Cheers
 Simon



---

archive/issue_comments_003405.json:
```json
{
    "body": "Attachment: **[timeit.patch.gz](https://github.com/sagemath/sage/files/ticket797/timeit.patch.gz)**\n\nChange preparse_ipython so that %timeit results in calling timeit.eval",
    "created_at": "2009-01-21T22:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3405",
    "user": "https://github.com/simon-king-jena"
}
```

Attachment: **[timeit.patch.gz](https://github.com/sagemath/sage/files/ticket797/timeit.patch.gz)**

Change preparse_ipython so that %timeit results in calling timeit.eval



---

archive/issue_comments_003406.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nIn `preparse_ipython`, lines starting with `%` have not been changed unless they refer to some interface. I added support for `%timeit`.\n\nIdea: Call `timeit.eval`\n\nWith the patch, the following examples now work:\n\n```\nsage: %timeit [1..10]\n625 loops, best of 3: 127 \u00c2\u00b5s per loop\nsage: %timeit 'a'==\"a\"\n625 loops, best of 3: 285 ns per loop\n```\nand the other ways of calling the timer still work:\n\n```\nsage: %time [1..10]\nCPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s\nsage: timeit('[1..10]')\n625 loops, best of 3: 127 \u00c2\u00b5s per loop\n```",
    "created_at": "2009-01-21T22:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3406",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

In `preparse_ipython`, lines starting with `%` have not been changed unless they refer to some interface. I added support for `%timeit`.

Idea: Call `timeit.eval`

With the patch, the following examples now work:

```
sage: %timeit [1..10]
625 loops, best of 3: 127 Âµs per loop
sage: %timeit 'a'=="a"
625 loops, best of 3: 285 ns per loop
```
and the other ways of calling the timer still work:

```
sage: %time [1..10]
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
sage: timeit('[1..10]')
625 loops, best of 3: 127 Âµs per loop
```



---

archive/issue_events_007483.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2009-01-21T22:11:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7483"
}
```



---

archive/issue_comments_003407.json:
```json
{
    "body": "Changed keywords from none to **timeit ipython**",
    "created_at": "2009-01-21T22:11:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3407",
    "user": "https://github.com/simon-king-jena"
}
```

Changed keywords from none to **timeit ipython**



---

archive/issue_comments_003408.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@simon-king-jena](#comment%3A13):\n> In `preparse_ipython`, lines starting with `%` have not been changed unless they refer to some interface. I added support for `%timeit`.\n> \n> Idea: Call `timeit.eval`\n\nProbably I should elaborate more on how it works.\n\nIn the old version of `preparse_ipython`, it was tested whether an input line starts with '%'. If this was the case, then the word after '%' was checked. If that word referred to an interface,  the interface was used. If the word after '%' was differently, the line was returned without a change.\n\nFor the new version, I suggest to test whether the word after '%' is 'timeit'. If it is, `preparse_ipython` returns `timeit.eval(..rest of the input line..)`.",
    "created_at": "2009-01-22T19:17:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3408",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@simon-king-jena](#comment%3A13):
> In `preparse_ipython`, lines starting with `%` have not been changed unless they refer to some interface. I added support for `%timeit`.
> 
> Idea: Call `timeit.eval`

Probably I should elaborate more on how it works.

In the old version of `preparse_ipython`, it was tested whether an input line starts with '%'. If this was the case, then the word after '%' was checked. If that word referred to an interface,  the interface was used. If the word after '%' was differently, the line was returned without a change.

For the new version, I suggest to test whether the word after '%' is 'timeit'. If it is, `preparse_ipython` returns `timeit.eval(..rest of the input line..)`.



---

archive/issue_events_007484.json:
```json
{
    "actor": "https://github.com/simon-king-jena",
    "created_at": "2009-01-22T19:38:17Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "title_is": "%timeit on command line doesn't recognize [1..10] syntax",
    "title_was": "%timeit doesn't recognize [1..10] syntax",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7484"
}
```



---

archive/issue_comments_003409.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nTo emphasize another detail: My suggestion only relates with `%timeit` on the command line, not on the notebook.",
    "created_at": "2009-01-22T19:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3409",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

To emphasize another detail: My suggestion only relates with `%timeit` on the command line, not on the notebook.



---

archive/issue_comments_003410.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThis patch works for me, but I think mhansen ought to comment on this approach versus the approach he advocated above using `_ip.expose_magic(\"timeit\", lambda self, s: timeit(s))`",
    "created_at": "2009-01-28T17:36:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3410",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:16" align="right">comment:16</div>

This patch works for me, but I think mhansen ought to comment on this approach versus the approach he advocated above using `_ip.expose_magic("timeit", lambda self, s: timeit(s))`



---

archive/issue_comments_003411.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThe _ip.expose_magic approach also seems to work just as well.  I would prefer using the ipython mechanism for doing this, rather than complicating the preparser.\n\nIn fact, I'd suggest using ipython to do all of the %mode functionality as well, if it's a possibility.",
    "created_at": "2009-01-28T17:38:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3411",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:17" align="right">comment:17</div>

The _ip.expose_magic approach also seems to work just as well.  I would prefer using the ipython mechanism for doing this, rather than complicating the preparser.

In fact, I'd suggest using ipython to do all of the %mode functionality as well, if it's a possibility.



---

archive/issue_comments_003412.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nSimon,\n\nwhat do you think about the idea of using ipython to do this, like mhansen suggests above?  I think it's cleaner, it keeps the ipython stuff together (i.e., the \"%\" commands with ipython), and avoids making the preparser more complicated.",
    "created_at": "2009-03-24T21:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3412",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:18" align="right">comment:18</div>

Simon,

what do you think about the idea of using ipython to do this, like mhansen suggests above?  I think it's cleaner, it keeps the ipython stuff together (i.e., the "%" commands with ipython), and avoids making the preparser more complicated.



---

archive/issue_comments_003413.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nHi Jason,\n\nReplying to [@jasongrout](#comment%3A18):\n> what do you think about the idea of using ipython to do this, like mhansen suggests above?  I think it's cleaner, it keeps the ipython stuff together (i.e., the \"%\" commands with ipython), and avoids making the preparser more complicated.\n\nSure, it makes sense. The problem is that i have no idea about ipython, so, I guess i would not be able to do it in that way. Perhaps i should look at local/bin/ipy_profile_sage.py, but i wouldn't be upset if someone else were faster... :)\n\nCheers,\n          Simon",
    "created_at": "2009-03-25T08:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3413",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:19" align="right">comment:19</div>

Hi Jason,

Replying to [@jasongrout](#comment%3A18):
> what do you think about the idea of using ipython to do this, like mhansen suggests above?  I think it's cleaner, it keeps the ipython stuff together (i.e., the "%" commands with ipython), and avoids making the preparser more complicated.

Sure, it makes sense. The problem is that i have no idea about ipython, so, I guess i would not be able to do it in that way. Perhaps i should look at local/bin/ipy_profile_sage.py, but i wouldn't be upset if someone else were faster... :)

Cheers,
          Simon



---

archive/issue_comments_003414.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nChanging this to \"needs work\" in light of mhansen's solution above.",
    "created_at": "2009-04-22T02:04:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3414",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:20" align="right">comment:20</div>

Changing this to "needs work" in light of mhansen's solution above.



---

archive/issue_events_007485.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-04-22T02:04:14Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7485"
}
```



---

archive/issue_events_007486.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2009-04-22T02:04:14Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7486"
}
```



---

archive/issue_comments_003415.json:
```json
{
    "body": "Attachment: **[trac_797.patch.gz](https://github.com/sagemath/sage/files/ticket797/trac_797.patch.gz)**",
    "created_at": "2010-01-17T07:31:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3415",
    "user": "https://github.com/mwhansen"
}
```

Attachment: **[trac_797.patch.gz](https://github.com/sagemath/sage/files/ticket797/trac_797.patch.gz)**



---

archive/issue_events_007487.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-01-17T07:32:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7487"
}
```



---

archive/issue_events_007488.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-01-17T07:32:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7488"
}
```



---

archive/issue_comments_003416.json:
```json
{
    "body": "Author: **Mike Hansen**",
    "created_at": "2010-01-17T07:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3416",
    "user": "https://github.com/mwhansen"
}
```

Author: **Mike Hansen**



---

archive/issue_comments_003417.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nI've put a patch up which implements the expose_magic idea.",
    "created_at": "2010-01-17T07:32:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3417",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:21" align="right">comment:21</div>

I've put a patch up which implements the expose_magic idea.



---

archive/issue_comments_003418.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nLooks great!  Positive review to Mike's patch.  Only apply Mike's patch (to the local/bin repository!)",
    "created_at": "2010-01-17T08:40:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3418",
    "user": "https://github.com/jasongrout"
}
```

<div id="comment:22" align="right">comment:22</div>

Looks great!  Positive review to Mike's patch.  Only apply Mike's patch (to the local/bin repository!)



---

archive/issue_events_007489.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-01-17T08:40:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7489"
}
```



---

archive/issue_events_007490.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2010-01-17T08:40:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7490"
}
```



---

archive/issue_events_007491.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-18T22:39:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7491"
}
```



---

archive/issue_events_007492.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2010-01-18T22:39:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/797#event-7492"
}
```



---

archive/issue_comments_003419.json:
```json
{
    "body": "Merged: **sage-4.3.1.rc1**",
    "created_at": "2010-01-18T22:39:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3419",
    "user": "https://github.com/rlmill"
}
```

Merged: **sage-4.3.1.rc1**



---

archive/issue_comments_003420.json:
```json
{
    "body": "Reviewer: **Jason Grout**",
    "created_at": "2010-01-18T22:39:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/797",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/797#issuecomment-3420",
    "user": "https://github.com/rlmill"
}
```

Reviewer: **Jason Grout**
