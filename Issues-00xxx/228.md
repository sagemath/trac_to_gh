# Issue 228: bug in sage notebook cell parser and promp stripping.

archive/issues_000228.json:
```json
{
    "body": "\n```\nOn Sun, 28 Jan 2007 15:26:56 -0800, Timothy Clemans <timothy.clemans@gmail.com> wrote:\n\n>\n> Just to show that something bad seems to be happening, I looked up the\n> source for prime_pi and copied it into a cell and changed the name to\n> epi. Well I added print epi(300) and got 0. I also added print \"Hello\"\n> and got nothing. In another cell I typed prime_pi(300) and got 62. So\n> I'm sure that there is a bug in SAGE notebook with docstrings in\n> personal code.\n\nYou're absolutely right.  This is a bug in the SAGE notebook, or rather,\nand unforseen \"feature\".  In the notebook if an input cell line starts\nwith either \"sage:\" or \">>>\", then the input is viewed as an example\nthat was likely pasted in, and *only* the lines that begin with sage:\nare evaluated.  (The parser that checks for this doesn't take into\naccount triple-quoted strings!)   Unfortunately this leads to the \nfollowing sort of stupid behavior:\n```\n\n```\ndef foo(x):\n    \"\"\"\n    EXAMPLES:\n        sage: 2+2\n        4\n    \"\"\" \n    return x\n///\n4\n```\n\n```\nfoo(5)\n///\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"/home/server/sage_notebook/worksheets/_uniqued/code/13.py\", line 4, in <module>\n    exec compile(ur'foo(Integer(5))' + '\\n', '', 'single')\n  File \"/home/server/\", line 1, in <module>\n    \nNameError: name 'foo' is not defined\n```\n\n\n**Assignee:** boothby\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/228\n\n",
    "closed_at": "2007-09-20T22:24:59Z",
    "created_at": "2007-01-29T08:10:05Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.8.5",
    "title": "bug in sage notebook cell parser and promp stripping.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/228",
    "user": "https://github.com/williamstein"
}
```

```
On Sun, 28 Jan 2007 15:26:56 -0800, Timothy Clemans <timothy.clemans@gmail.com> wrote:

>
> Just to show that something bad seems to be happening, I looked up the
> source for prime_pi and copied it into a cell and changed the name to
> epi. Well I added print epi(300) and got 0. I also added print "Hello"
> and got nothing. In another cell I typed prime_pi(300) and got 62. So
> I'm sure that there is a bug in SAGE notebook with docstrings in
> personal code.

You're absolutely right.  This is a bug in the SAGE notebook, or rather,
and unforseen "feature".  In the notebook if an input cell line starts
with either "sage:" or ">>>", then the input is viewed as an example
that was likely pasted in, and *only* the lines that begin with sage:
are evaluated.  (The parser that checks for this doesn't take into
account triple-quoted strings!)   Unfortunately this leads to the 
following sort of stupid behavior:
```

```
def foo(x):
    """
    EXAMPLES:
        sage: 2+2
        4
    """ 
    return x
///
4
```

```
foo(5)
///
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/server/sage_notebook/worksheets/_uniqued/code/13.py", line 4, in <module>
    exec compile(ur'foo(Integer(5))' + '\n', '', 'single')
  File "/home/server/", line 1, in <module>
    
NameError: name 'foo' is not defined
```


**Assignee:** boothby

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/228





---

archive/issue_comments_001047.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2007-04-03T06:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1047",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

**Resolution:** fixed



---

archive/issue_events_000524.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans",
    "created_at": "2007-04-03T06:16:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/228#event-524"
}
```



---

archive/issue_comments_001048.json:
```json
{
    "body": "**Changing status** from closed to reopened.",
    "created_at": "2007-09-05T16:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1048",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

**Changing status** from closed to reopened.



---

archive/issue_comments_001049.json:
```json
{
    "body": "<a id='comment:2'></a>\nReopen ticket because a patch wasn't created and approved.",
    "created_at": "2007-09-05T16:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1049",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

<a id='comment:2'></a>
Reopen ticket because a patch wasn't created and approved.



---

archive/issue_comments_001050.json:
```json
{
    "body": "**Resolution changed** from fixed to .",
    "created_at": "2007-09-05T16:30:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1050",
    "user": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans"
}
```

**Resolution changed** from fixed to .



---

archive/issue_events_000525.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/TimothyClemans",
    "created_at": "2007-09-06T17:24:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "milestone": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/228#event-525"
}
```



---

archive/issue_comments_001051.json:
```json
{
    "body": "<a id='comment:4'></a>\nAttachment [ncalexan-228-v2.hg](tarball://root/attachments/some-uuid/ticket228/ncalexan-228-v2.hg) by @ncalexan created at 2007-09-20 21:07:07\n\nThe attached patch addresses this issue by only considering input examples if it starts with a prompt (sage: or >>>).",
    "created_at": "2007-09-20T21:07:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1051",
    "user": "https://github.com/ncalexan"
}
```

<a id='comment:4'></a>
Attachment [ncalexan-228-v2.hg](tarball://root/attachments/some-uuid/ticket228/ncalexan-228-v2.hg) by @ncalexan created at 2007-09-20 21:07:07

The attached patch addresses this issue by only considering input examples if it starts with a prompt (sage: or >>>).



---

archive/issue_events_000526.json:
```json
{
    "actor": "https://github.com/ncalexan",
    "created_at": "2007-09-20T21:07:27Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "milestone": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/228#event-526"
}
```



---

archive/issue_comments_001052.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2007-09-20T22:24:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/228#issuecomment-1052",
    "user": "https://github.com/williamstein"
}
```

**Resolution:** fixed



---

archive/issue_events_000527.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-09-20T22:24:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/228",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/228#event-527"
}
```
