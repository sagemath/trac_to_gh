# Issue 21: command line option parsing

archive/issues_000021.json:
```json
{
    "assignees": [
        "https://github.com/jdemeyer"
    ],
    "body": "We should improve and/or modernize and/or revise Sage's command-line parsing.\n\nTwo ideas, which could be debated endlessly and could also be implemented independently of each other:\n- use Python's [argparse module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script\n- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)\n\n\nDepends on #9958\n\nCC:  @kini @saraedum @gvol\n\nComponent: **user interface**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/21_\n\n",
    "created_at": "2006-09-12T23:21:18Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "command line option parsing",
    "type": "issue",
    "updated_at": "2022-12-29T01:28:25Z",
    "url": "https://github.com/sagemath/sage/issues/21",
    "user": "https://github.com/williamstein"
}
```
We should improve and/or modernize and/or revise Sage's command-line parsing.

Two ideas, which could be debated endlessly and could also be implemented independently of each other:
- use Python's [argparse module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script
- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)


Depends on #9958

CC:  @kini @saraedum @gvol

Component: **user interface**

_Issue created by migration from https://trac.sagemath.org/ticket/21_





---

archive/issue_events_000136.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-09-12T23:21:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-136"
}
```



---

archive/issue_events_000137.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-09-12T23:21:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-137"
}
```



---

archive/issue_events_000138.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-09-12T23:21:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-138"
}
```



---

archive/issue_events_000139.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-01-13T01:56:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-139"
}
```



---

archive/issue_events_000140.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-01-13T01:56:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-140"
}
```



---

archive/issue_comments_000047.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nno -- you can't combine command line options like that.  this isn't a bug\nbut a not implemented yet issue.",
    "created_at": "2007-01-13T01:56:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-47",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

no -- you can't combine command line options like that.  this isn't a bug
but a not implemented yet issue.



---

archive/issue_events_000141.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-09-11T02:11:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-2.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-141"
}
```



---

archive/issue_comments_000048.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis should be fixable, but the long term goal is to do a proper rewrite of the command line options.\n\nCheers,\n\nMichael",
    "created_at": "2007-09-11T02:11:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-48",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:2" align="right">comment:2</div>

This should be fixable, but the long term goal is to do a proper rewrite of the command line options.

Cheers,

Michael



---

archive/issue_events_000142.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-03-16T07:59:18Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "subject": "https://github.com/garyfurnish",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-142"
}
```



---

archive/issue_events_000143.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-04-04T19:55:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-143"
}
```



---

archive/issue_events_000144.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-04-04T19:55:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-144"
}
```



---

archive/issue_events_000145.json:
```json
{
    "actor": "https://github.com/garyfurnish",
    "created_at": "2008-09-24T02:59:36Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-145"
}
```



---

archive/issue_events_000146.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-09-24T02:59:36Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "subject": "https://github.com/sagetrac-mabshoff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-146"
}
```



---

archive/issue_comments_000049.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSee also #180 for a bunch of related failures due to the option parsing being dumb :o\n\nCheers,\n\nMichael",
    "created_at": "2008-09-24T02:59:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-49",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:5" align="right">comment:5</div>

See also #180 for a bunch of related failures due to the option parsing being dumb :o

Cheers,

Michael



---

archive/issue_comments_000050.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nNote that sage -bn now builds, then does notebook, though of course it doesn't fix the issue here.",
    "created_at": "2009-12-30T05:15:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-50",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:7" align="right">comment:7</div>

Note that sage -bn now builds, then does notebook, though of course it doesn't fix the issue here.



---

archive/issue_comments_000051.json:
```json
{
    "body": "Attachment: **[makefile.gz](https://github.com/sagemath/sage/files/ticket21/makefile.gz)**\n\nthe file SAGE_ROOT/makefile",
    "created_at": "2010-03-19T15:41:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-51",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[makefile.gz](https://github.com/sagemath/sage/files/ticket21/makefile.gz)**

the file SAGE_ROOT/makefile



---

archive/issue_comments_000052.json:
```json
{
    "body": "Attachment: **[makefile.diff.gz](https://github.com/sagemath/sage/files/ticket21/makefile.diff.gz)**\n\nAttachment: **[trac_21-extcode.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-extcode.patch.gz)**\n\nextcode repo",
    "created_at": "2010-03-19T15:42:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-52",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[makefile.diff.gz](https://github.com/sagemath/sage/files/ticket21/makefile.diff.gz)**

Attachment: **[trac_21-extcode.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-extcode.patch.gz)**

extcode repo



---

archive/issue_comments_000053.json:
```json
{
    "body": "sagenb repo",
    "created_at": "2010-03-19T15:42:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-53",
    "user": "https://github.com/jhpalmieri"
}
```

sagenb repo



---

archive/issue_events_000147.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-19T15:50:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-147"
}
```



---

archive/issue_comments_000054.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nAttachment: **[trac_21-sagenb.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-sagenb.patch.gz)**\n\nHere are patches.  After applying \"trac_21-scripts.patch\", you may need to make \"SAGE_ROOT/local/bin/sage-sage.py\" executable.  The build process works for me with these patches.  For the standard packages, the third line in\n\n```\nif [ \"$SAGE_LOCAL\" = \"\" ]; then\n   echo \"SAGE_LOCAL undefined ... exiting\";\n   echo \"Maybe run 'sage -sh'?\"\n   exit 1\nfi\n```\nshould be changed to \"Maybe run 'sage --sh'?\", but this doesn't affect the functioning of the packages, and otherwise, they don't need changing.  I haven't looked at optional packages.\n\nThis approaches uses Python's optparse to parse command-line options.  If someone wants to write a version using [shflags](http://code.google.com/p/shflags/) or some other package, go ahead.\n\nI propose the following approach, whether using these patches or other ones:\n\n- first, we include new command-line options but don't turn them on  by default, instead printing a message like this one when you type \"sage [...]\" with a nonempty argument: \n\n```\n    Note: Using old-style Sage command-line options. \n\n    To try out Sage's experimental GNU/Posix-style command-line options \n    (for example, 'sage --notebook' instead of 'sage -notebook'), set the \n    environment variable $SAGE_NEW_OPTIONS to something nonempty. \n    To bypass this message, set the environment variable \n    $SAGE_SKIP_OPTIONS_MESSAGE to something nonempty. \n```\n Running \"sage\" (with no arguments) would not trigger this message.  (Perhaps we could only turn this on in prerelease (alpha and rc) versions?  Alternatively, a change like this could go with the version 5.0 release.) \n\n- after a while, we switch this to \n\n```\n    Warning: Using old-style Sage command-line options. \n\n    Sage is changing to use conventional GNU/Posix-style command-line options \n    (for example, 'sage --notebook instead of 'sage -notebook).  This change will \n    become the default soon.  Meanwhile, to use this new style (and therefore \n    to avoid seeing this message), set the environment variable \n    $SAGE_NEW_OPTIONS to something nonempty. \n```\n perhaps with no easy way of disabling this message while using old-style options. \n\n- finally, we turn on the new options, perhaps with an environment variable $SAGE_OLD_OPTIONS to use the old ones, with the understanding that any changes in command-line options may not be maintained for the old version. \n\nSee [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/de30143ec073f31?tvc=2) for some discussion.",
    "created_at": "2010-03-19T15:50:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-54",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Attachment: **[trac_21-sagenb.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-sagenb.patch.gz)**

Here are patches.  After applying "trac_21-scripts.patch", you may need to make "SAGE_ROOT/local/bin/sage-sage.py" executable.  The build process works for me with these patches.  For the standard packages, the third line in

```
if [ "$SAGE_LOCAL" = "" ]; then
   echo "SAGE_LOCAL undefined ... exiting";
   echo "Maybe run 'sage -sh'?"
   exit 1
fi
```
should be changed to "Maybe run 'sage --sh'?", but this doesn't affect the functioning of the packages, and otherwise, they don't need changing.  I haven't looked at optional packages.

This approaches uses Python's optparse to parse command-line options.  If someone wants to write a version using [shflags](http://code.google.com/p/shflags/) or some other package, go ahead.

I propose the following approach, whether using these patches or other ones:

- first, we include new command-line options but don't turn them on  by default, instead printing a message like this one when you type "sage [...]" with a nonempty argument: 

```
    Note: Using old-style Sage command-line options. 

    To try out Sage's experimental GNU/Posix-style command-line options 
    (for example, 'sage --notebook' instead of 'sage -notebook'), set the 
    environment variable $SAGE_NEW_OPTIONS to something nonempty. 
    To bypass this message, set the environment variable 
    $SAGE_SKIP_OPTIONS_MESSAGE to something nonempty. 
```
 Running "sage" (with no arguments) would not trigger this message.  (Perhaps we could only turn this on in prerelease (alpha and rc) versions?  Alternatively, a change like this could go with the version 5.0 release.) 

- after a while, we switch this to 

```
    Warning: Using old-style Sage command-line options. 

    Sage is changing to use conventional GNU/Posix-style command-line options 
    (for example, 'sage --notebook instead of 'sage -notebook).  This change will 
    become the default soon.  Meanwhile, to use this new style (and therefore 
    to avoid seeing this message), set the environment variable 
    $SAGE_NEW_OPTIONS to something nonempty. 
```
 perhaps with no easy way of disabling this message while using old-style options. 

- finally, we turn on the new options, perhaps with an environment variable $SAGE_OLD_OPTIONS to use the old ones, with the understanding that any changes in command-line options may not be maintained for the old version. 

See [sage-devel](http://groups.google.com/group/sage-devel/browse_thread/thread/de30143ec073f31?tvc=2) for some discussion.



---

archive/issue_events_000148.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-19T15:50:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-148"
}
```



---

archive/issue_events_000149.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2010-03-19T15:50:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-149"
}
```



---

archive/issue_comments_000055.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI've marked this as \"needs review\", but it might need work.  In the previously cited thread from sage-devel, there was the following suggestion:\n\n```\nAnother possibility might be to first check for \"--gp\", \"--gap\", etc., \nand do those before doing the general option parsing.   I.e., just do \nwhat you already planned, but with one optimization to deal with this \nuse case. \n```\nThis is to speed up access to these programs: do a check like this in a shell script, and then pass the rest of the arguments to Python's optparse using the script included in this patch, or one like it.  Then you avoid the slight delay involved in starting up Python if you want to run \"gp\".  It would be nice to have a shell script which had a list of strings \"gp\", \"gap\", etc., checked to see if the first(?) argument was \"--STR\" for STR in this list, and if so, run the appropriate program from SAGE_LOCAL/lib, passing the rest of the line as arguments.  Having one list containing all of these strings would make it easy to customize.",
    "created_at": "2010-03-19T20:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-55",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

I've marked this as "needs review", but it might need work.  In the previously cited thread from sage-devel, there was the following suggestion:

```
Another possibility might be to first check for "--gp", "--gap", etc., 
and do those before doing the general option parsing.   I.e., just do 
what you already planned, but with one optimization to deal with this 
use case. 
```
This is to speed up access to these programs: do a check like this in a shell script, and then pass the rest of the arguments to Python's optparse using the script included in this patch, or one like it.  Then you avoid the slight delay involved in starting up Python if you want to run "gp".  It would be nice to have a shell script which had a list of strings "gp", "gap", etc., checked to see if the first(?) argument was "--STR" for STR in this list, and if so, run the appropriate program from SAGE_LOCAL/lib, passing the rest of the line as arguments.  Having one list containing all of these strings would make it easy to customize.



---

archive/issue_comments_000056.json:
```json
{
    "body": "the file SAGE_ROOT/sage",
    "created_at": "2010-03-19T21:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-56",
    "user": "https://github.com/jhpalmieri"
}
```

the file SAGE_ROOT/sage



---

archive/issue_comments_000057.json:
```json
{
    "body": "Attachment: **[sage.gz](https://github.com/sagemath/sage/files/ticket21/sage.gz)**\n\nAttachment: **[sage.diff.gz](https://github.com/sagemath/sage/files/ticket21/sage.diff.gz)**",
    "created_at": "2010-03-19T21:15:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-57",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[sage.gz](https://github.com/sagemath/sage/files/ticket21/sage.gz)**

Attachment: **[sage.diff.gz](https://github.com/sagemath/sage/files/ticket21/sage.diff.gz)**



---

archive/issue_comments_000058.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:10):\n> I've marked this as \"needs review\", but it might need work.  In the previously cited thread from sage-devel, there was the following suggestion:\n\n\n```\nAnother possibility might be to first check for \"--gp\", \"--gap\", etc., \nand do those before doing the general option parsing.   I.e., just do \nwhat you already planned, but with one optimization to deal with this \nuse case. \n```\n\nOkay, here's a new version which does this: it adds a file sage-sage-quickstart which gets run first, implementing the above idea.  Then if SAGE_NEW_OPTIONS is nonempty, it calls sage-sage.py, the Python/optparse version with GNU/Posix standard command-line options.  Otherwise, it calls the old parser sage-sage.\n\nFor the record, the commands in sage-sage-quickstart are: axiom, ecl/lisp, gap, gp, hg, ipython, maxima, mwrank, python, R, singular.  Are any others particularly sensitive to startup times?  (Using python adds something less than .1 second on my two-year old iMac, so we're not talking about a lot of time, in any case.)",
    "created_at": "2010-03-19T21:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-58",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:10):
> I've marked this as "needs review", but it might need work.  In the previously cited thread from sage-devel, there was the following suggestion:


```
Another possibility might be to first check for "--gp", "--gap", etc., 
and do those before doing the general option parsing.   I.e., just do 
what you already planned, but with one optimization to deal with this 
use case. 
```

Okay, here's a new version which does this: it adds a file sage-sage-quickstart which gets run first, implementing the above idea.  Then if SAGE_NEW_OPTIONS is nonempty, it calls sage-sage.py, the Python/optparse version with GNU/Posix standard command-line options.  Otherwise, it calls the old parser sage-sage.

For the record, the commands in sage-sage-quickstart are: axiom, ecl/lisp, gap, gp, hg, ipython, maxima, mwrank, python, R, singular.  Are any others particularly sensitive to startup times?  (Using python adds something less than .1 second on my two-year old iMac, so we're not talking about a lot of time, in any case.)



---

archive/issue_comments_000059.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nNote that Python 2.7 will include the [argparse](http://docs.python.org/dev/library/argparse.html) module, which might be easier to use than optparse.",
    "created_at": "2010-05-07T19:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-59",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Note that Python 2.7 will include the [argparse](http://docs.python.org/dev/library/argparse.html) module, which might be easier to use than optparse.



---

archive/issue_events_000150.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:33:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-150"
}
```



---

archive/issue_events_000151.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:33:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-151"
}
```



---

archive/issue_comments_000060.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nWow, this is really fantastic.",
    "created_at": "2010-06-03T04:33:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-60",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:13" align="right">comment:13</div>

Wow, this is really fantastic.



---

archive/issue_events_000152.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:36:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-152"
}
```



---

archive/issue_events_000153.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:36:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-153"
}
```



---

archive/issue_comments_000061.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI'm changing this back to needs review.  I realized when trying to apply it that I had got confused about how to even apply this.\n\nJohn, can you please post clear directions about how to use the patches attached to this ticket?\n\n```\n\nsage: hg_scripts.apply('https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz')\nAttempting to load remote file: https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz\nLoading: [..........]\ncd \"/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin\" && hg status\ncd \"/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin\" && hg status\ncd \"/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin\" && hg import   \"/scratch/wstein/sage/temp/sage.math.washington.edu/22653/tmp_0.patch\"\napplying /scratch/wstein/sage/temp/sage.math.washington.edu/22653/tmp_0.patch\npatching file sage-pkg\nHunk #1 FAILED at 40\nHunk #2 FAILED at 63\n2 out of 2 hunks FAILED -- saving rejects to file sage-pkg.rej\npatching file sage-run\nHunk #1 FAILED at 17\n1 out of 1 hunks FAILED -- saving rejects to file sage-run.rej\npatching file sage-sage\nHunk #2 FAILED at 34\nHunk #3 FAILED at 196\nHunk #4 FAILED at 212\nHunk #5 FAILED at 424\nHunk #6 FAILED at 450\nHunk #8 FAILED at 608\nHunk #9 FAILED at 744\nHunk #10 FAILED at 767\nHunk #11 succeeded at 894 with fuzz 1 (offset 0 lines).\n8 out of 11 hunks FAILED -- saving rejects to file sage-sage.rej\nabort: patch failed to apply\n```",
    "created_at": "2010-06-03T04:37:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-61",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:15" align="right">comment:15</div>

I'm changing this back to needs review.  I realized when trying to apply it that I had got confused about how to even apply this.

John, can you please post clear directions about how to use the patches attached to this ticket?

```

sage: hg_scripts.apply('https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz')
Attempting to load remote file: https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz
Loading: [..........]
cd "/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin" && hg status
cd "/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin" && hg status
cd "/mnt/usb1/scratch/wstein/build/release/4.4.3/sage-4.4.3.alpha2/local/bin" && hg import   "/scratch/wstein/sage/temp/sage.math.washington.edu/22653/tmp_0.patch"
applying /scratch/wstein/sage/temp/sage.math.washington.edu/22653/tmp_0.patch
patching file sage-pkg
Hunk #1 FAILED at 40
Hunk #2 FAILED at 63
2 out of 2 hunks FAILED -- saving rejects to file sage-pkg.rej
patching file sage-run
Hunk #1 FAILED at 17
1 out of 1 hunks FAILED -- saving rejects to file sage-run.rej
patching file sage-sage
Hunk #2 FAILED at 34
Hunk #3 FAILED at 196
Hunk #4 FAILED at 212
Hunk #5 FAILED at 424
Hunk #6 FAILED at 450
Hunk #8 FAILED at 608
Hunk #9 FAILED at 744
Hunk #10 FAILED at 767
Hunk #11 succeeded at 894 with fuzz 1 (offset 0 lines).
8 out of 11 hunks FAILED -- saving rejects to file sage-sage.rej
abort: patch failed to apply
```



---

archive/issue_events_000154.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:37:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-154"
}
```



---

archive/issue_events_000155.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2010-06-03T04:37:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-155"
}
```



---

archive/issue_comments_000062.json:
```json
{
    "body": "Attachment: **[trac_21-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz)**\n\nscripts repo",
    "created_at": "2010-06-03T06:02:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-62",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[trac_21-scripts.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-scripts.patch.gz)**

scripts repo



---

archive/issue_comments_000063.json:
```json
{
    "body": "sage repo",
    "created_at": "2010-06-03T06:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-63",
    "user": "https://github.com/jhpalmieri"
}
```

sage repo



---

archive/issue_comments_000064.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAttachment: **[trac_21-sage.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-sage.patch.gz)**\n\n> John, can you please post clear directions about how to use the patches attached to this ticket?\n\nSorry, some parts needed rebasing.  I think it's okay now.  I've modified the summary with instructions for how to apply the patches.",
    "created_at": "2010-06-03T06:04:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-64",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Attachment: **[trac_21-sage.patch.gz](https://github.com/sagemath/sage/files/ticket21/trac_21-sage.patch.gz)**

> John, can you please post clear directions about how to use the patches attached to this ticket?

Sorry, some parts needed rebasing.  I think it's okay now.  I've modified the summary with instructions for how to apply the patches.



---

archive/issue_comments_000065.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,13 @@\n-`sage -br -notebook` doesn't start the notebook but it should\n+`sage -br -notebook` doesn't start the notebook but it should.\n \n+To apply: \n+\n+- replace $SAGE_ROOT/makefile with \"makefile\".  See the diff file for reference.\n+- replace $SAGE_ROOT/sage with \"sage\".  See the diff file for reference.\n+- apply \"trac_21-extcode.patch\" to the extcode repo.\n+- apply \"trac_21-sagenb.patch\" to the sagenb repo.\n+- apply \"trac_21-scripts.patch\" to the scripts repo.\n+- apply \"trac_21-sage.patch\" to the sage repo.\n+\n+(The patches for extcode and sage are mainly changes in documentation. The critical patches are to the file \"sage\" and to the scripts repo.)\n+\n``````\n",
    "created_at": "2010-06-03T06:07:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-65",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,13 @@
-`sage -br -notebook` doesn't start the notebook but it should
+`sage -br -notebook` doesn't start the notebook but it should.
 
+To apply: 
+
+- replace $SAGE_ROOT/makefile with "makefile".  See the diff file for reference.
+- replace $SAGE_ROOT/sage with "sage".  See the diff file for reference.
+- apply "trac_21-extcode.patch" to the extcode repo.
+- apply "trac_21-sagenb.patch" to the sagenb repo.
+- apply "trac_21-scripts.patch" to the scripts repo.
+- apply "trac_21-sage.patch" to the sage repo.
+
+(The patches for extcode and sage are mainly changes in documentation. The critical patches are to the file "sage" and to the scripts repo.)
+
``````




---

archive/issue_comments_000066.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nIt appears like sage-sage.py managed to get itself into 4.4.3 (William, could this have happened when you were trying to apply it). Also, sage-apply-ticket has greatly changed since the patches were posted, so I am changing this back to needs work.",
    "created_at": "2010-11-11T19:54:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-66",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:18" align="right">comment:18</div>

It appears like sage-sage.py managed to get itself into 4.4.3 (William, could this have happened when you were trying to apply it). Also, sage-apply-ticket has greatly changed since the patches were posted, so I am changing this back to needs work.



---

archive/issue_events_000156.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2010-11-11T19:54:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-156"
}
```



---

archive/issue_events_000157.json:
```json
{
    "actor": "https://github.com/ohanar",
    "created_at": "2010-11-11T19:54:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-157"
}
```



---

archive/issue_comments_000067.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nAs far as I know, the file sage-sage.py was accidentally added in 4.4.3, but the release manager should probably delete it: it's not used anywhere.\n\nI don't have the time to rebase it right now, so if anyone else wants to work it, that would be great.",
    "created_at": "2010-11-11T20:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-67",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:19" align="right">comment:19</div>

As far as I know, the file sage-sage.py was accidentally added in 4.4.3, but the release manager should probably delete it: it's not used anywhere.

I don't have the time to rebase it right now, so if anyone else wants to work it, that would be great.



---

archive/issue_comments_000068.json:
```json
{
    "body": "Attachment: **[21-scripts-4.6.1.alpha1.patch.gz](https://github.com/sagemath/sage/files/ticket21/21-scripts-4.6.1.alpha1.patch.gz)**\n\nscripts repo, rebased on 4.6.1.alpha1",
    "created_at": "2010-11-12T10:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-68",
    "user": "https://github.com/ohanar"
}
```

Attachment: **[21-scripts-4.6.1.alpha1.patch.gz](https://github.com/sagemath/sage/files/ticket21/21-scripts-4.6.1.alpha1.patch.gz)**

scripts repo, rebased on 4.6.1.alpha1



---

archive/issue_comments_000069.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI've uploaded a patch rebased on 4.6.1.alpha1 (I also added in #8654 while I was at it). One thing I noted during rebasing it is that -tp no longer works (and hence -btp which was added since 4.4.3), I don't know optparse well enough to come up with a solution (if we want to provide one). The documentation patches will need to be rebased as well.\n\nFor anyone who wants to apply this, make sure to remove sage-sage.py before applying, the file is currently just hanging around not doing anything - mercurial doesn't even know about it.",
    "created_at": "2010-11-12T11:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-69",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:20" align="right">comment:20</div>

I've uploaded a patch rebased on 4.6.1.alpha1 (I also added in #8654 while I was at it). One thing I noted during rebasing it is that -tp no longer works (and hence -btp which was added since 4.4.3), I don't know optparse well enough to come up with a solution (if we want to provide one). The documentation patches will need to be rebased as well.

For anyone who wants to apply this, make sure to remove sage-sage.py before applying, the file is currently just hanging around not doing anything - mercurial doesn't even know about it.



---

archive/issue_comments_000070.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nohanar mentioned on #8654 that this should be rewritten (or modified) to use argparse as optparse is deprecated in Python 2.7, so I'm adding #9958 to the dependencies because argparse is shipped with 2.7. Alternatively we could make an spkg for argparse.",
    "created_at": "2011-11-01T14:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-70",
    "user": "https://github.com/kini"
}
```

<div id="comment:22" align="right">comment:22</div>

ohanar mentioned on #8654 that this should be rewritten (or modified) to use argparse as optparse is deprecated in Python 2.7, so I'm adding #9958 to the dependencies because argparse is shipped with 2.7. Alternatively we could make an spkg for argparse.



---

archive/issue_comments_000071.json:
```json
{
    "body": "Dependencies: **#9958**",
    "created_at": "2011-11-01T14:49:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-71",
    "user": "https://github.com/kini"
}
```

Dependencies: **#9958**



---

archive/issue_comments_000072.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI think waiting until 2.7 is fine.",
    "created_at": "2011-11-02T01:27:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-72",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:23" align="right">comment:23</div>

I think waiting until 2.7 is fine.



---

archive/issue_comments_000073.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nCan we edit the title and description of this ticket to reflect what we're actually trying to do here? (I would, but preferably someone who has been working on it should do it.) The goal is to completely replace the command line handler (currently a shell script) with a Python script which uses argparse for extensibility, right?",
    "created_at": "2011-11-13T10:39:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-73",
    "user": "https://github.com/kini"
}
```

<div id="comment:24" align="right">comment:24</div>

Can we edit the title and description of this ticket to reflect what we're actually trying to do here? (I would, but preferably someone who has been working on it should do it.) The goal is to completely replace the command line handler (currently a shell script) with a Python script which uses argparse for extensibility, right?



---

archive/issue_comments_000074.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nPeople CC'd to this ticket probably already know this, but the above mentioned #9958 is merged, so we can use Python 2.7 default modules such as argparse now.",
    "created_at": "2012-01-19T12:14:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-74",
    "user": "https://github.com/kini"
}
```

<div id="comment:26" align="right">comment:26</div>

People CC'd to this ticket probably already know this, but the above mentioned #9958 is merged, so we can use Python 2.7 default modules such as argparse now.



---

archive/issue_comments_000075.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@kini](#comment:26):\n> People CC'd to this ticket probably already know this, but the above mentioned #9958 is merged, so we can use Python 2.7 default modules such as argparse now.\n\nYup, I've started working on this, but its going to take awhile... :)",
    "created_at": "2012-01-24T17:20:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-75",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@kini](#comment:26):
> People CC'd to this ticket probably already know this, but the above mentioned #9958 is merged, so we can use Python 2.7 default modules such as argparse now.

Yup, I've started working on this, but its going to take awhile... :)



---

archive/issue_comments_000076.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nCapital! :) As it's a large project maybe you could post WIPs once in a while?\n\nI was planning on diving into the scripts dir myself and trying to work on this, but I guess it should be an order of magnitude easier for you, haha. Still, let me know if I can help with anything.",
    "created_at": "2012-01-24T17:34:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-76",
    "user": "https://github.com/kini"
}
```

<div id="comment:28" align="right">comment:28</div>

Capital! :) As it's a large project maybe you could post WIPs once in a while?

I was planning on diving into the scripts dir myself and trying to work on this, but I guess it should be an order of magnitude easier for you, haha. Still, let me know if I can help with anything.



---

archive/issue_comments_000077.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@kini](#comment:28):\n> Capital! :) As it's a large project maybe you could post WIPs once in a while?\n\nNo problem, once I have something of any real substance, I'll be sure to post it somewhere.\n\n> I was planning on diving into the scripts dir myself and trying to work on this, but I guess it should be an order of magnitude easier for you, haha. Still, let me know if I can help with anything.\n\nWell, I'm just starting and have had a busy week with other stuff, so you would probably be in about as good of position as myself, especially since we need to rebase this off of the 5.0 dev builds, which changed a lot of that stuff anyway.\n\nI'm finding myself annoyed at spkg/script, and all the little special cases that we have. I really just want to rip that out and try to have a (more) unified design to our parsing. My current fancy is to introduce a bunch of subcommands, like mercurial or aptitude. Some of the ones I've thought about:\n\n```\n% sage ARGS # this would be for running sage scripts, or a couple of oddball arguments\n% sage notebook ARGS\n% sage pkg ARGS # this would include spkg stuff\n% sage pkg install # since install has some special flags like -f or -s\n% sage test ARGS\n% sage build ARGS\n% sage {python,sqlite3,R,gp,...} ARGS # we can consider these programs as subcommands of sage\n```\nI haven't fully worked out what this would look like with all the arguments (such as debugging), but IMO it would greatly clean up our command line tools. Also, this would simplify many aspects of the implementation, although some hacking of argparse will still have to be done (it currently doesn't support optional subparsers, see [http://bugs.python.org/issue9253](http://bugs.python.org/issue9253)).\n\nI probably should bring this up on the devel list, but I'm tired and should go to bed before I have to be up in the morning :/.",
    "created_at": "2012-01-26T10:15:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-77",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@kini](#comment:28):
> Capital! :) As it's a large project maybe you could post WIPs once in a while?

No problem, once I have something of any real substance, I'll be sure to post it somewhere.

> I was planning on diving into the scripts dir myself and trying to work on this, but I guess it should be an order of magnitude easier for you, haha. Still, let me know if I can help with anything.

Well, I'm just starting and have had a busy week with other stuff, so you would probably be in about as good of position as myself, especially since we need to rebase this off of the 5.0 dev builds, which changed a lot of that stuff anyway.

I'm finding myself annoyed at spkg/script, and all the little special cases that we have. I really just want to rip that out and try to have a (more) unified design to our parsing. My current fancy is to introduce a bunch of subcommands, like mercurial or aptitude. Some of the ones I've thought about:

```
% sage ARGS # this would be for running sage scripts, or a couple of oddball arguments
% sage notebook ARGS
% sage pkg ARGS # this would include spkg stuff
% sage pkg install # since install has some special flags like -f or -s
% sage test ARGS
% sage build ARGS
% sage {python,sqlite3,R,gp,...} ARGS # we can consider these programs as subcommands of sage
```
I haven't fully worked out what this would look like with all the arguments (such as debugging), but IMO it would greatly clean up our command line tools. Also, this would simplify many aspects of the implementation, although some hacking of argparse will still have to be done (it currently doesn't support optional subparsers, see [http://bugs.python.org/issue9253](http://bugs.python.org/issue9253)).

I probably should bring this up on the devel list, but I'm tired and should go to bed before I have to be up in the morning :/.



---

archive/issue_events_000158.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-05-25T20:16:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-5.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-158"
}
```



---

archive/issue_events_000159.json:
```json
{
    "actor": "https://github.com/kini",
    "created_at": "2012-05-25T20:16:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-159"
}
```



---

archive/issue_comments_000078.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWe're going to try to get this in as a Sage 6.0 goal along with #13015.",
    "created_at": "2012-05-25T20:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-78",
    "user": "https://github.com/kini"
}
```

<div id="comment:30" align="right">comment:30</div>

We're going to try to get this in as a Sage 6.0 goal along with #13015.



---

archive/issue_comments_000079.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\npatchbot: apply 21-scripts-4.6.1.alpha1.patch\n\n(this doesn't actually work but at least this way the patchbot won't try to apply the other stuff, and even crash, apparently)",
    "created_at": "2012-05-25T23:06:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-79",
    "user": "https://github.com/kini"
}
```

<div id="comment:31" align="right">comment:31</div>

patchbot: apply 21-scripts-4.6.1.alpha1.patch

(this doesn't actually work but at least this way the patchbot won't try to apply the other stuff, and even crash, apparently)



---

archive/issue_events_000160.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2013-01-24T13:30:48Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-160"
}
```



---

archive/issue_events_000161.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-01-24T13:30:48Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "subject": "https://github.com/jdemeyer",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-161"
}
```



---

archive/issue_comments_000080.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nGoing with `argparse` is probably a good idea, but I would still like a special \"pre-parser\" in `bash` to handle to options\n\n```\nsage --sh\nsage -i\nsage -f\n```\n(or whatever version they will become)\n\nI think these must be available from the start, before Python has been built.",
    "created_at": "2013-01-24T13:30:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-80",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:33" align="right">comment:33</div>

Going with `argparse` is probably a good idea, but I would still like a special "pre-parser" in `bash` to handle to options

```
sage --sh
sage -i
sage -f
```
(or whatever version they will become)

I think these must be available from the start, before Python has been built.



---

archive/issue_comments_000081.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nohanar and I talked about this a bit at SD40.5. What do you think about having a totally separate executable (rather than a preparser) called `sage-sh`? Stuff like the current `sage -gap` could be called rapidly with `sage-sh -c gap`, or slowly via python with `sage gap` or what-have-you.",
    "created_at": "2013-01-24T17:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-81",
    "user": "https://github.com/kini"
}
```

<div id="comment:34" align="right">comment:34</div>

ohanar and I talked about this a bit at SD40.5. What do you think about having a totally separate executable (rather than a preparser) called `sage-sh`? Stuff like the current `sage -gap` could be called rapidly with `sage-sh -c gap`, or slowly via python with `sage gap` or what-have-you.



---

archive/issue_comments_000082.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nWilliam, among others, as alluded to [above](#comment:11), was pretty insistent that commands like `sage --gp` execute quickly, without the overhead that starting Python entails. Hence the approach in my patches on this ticket. If you want to insist that people use `sage-sh -c gp` instead, I don't think it can get a positive review unless the approach gets a positive response on sage-devel.",
    "created_at": "2013-01-24T18:33:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-82",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

William, among others, as alluded to [above](#comment:11), was pretty insistent that commands like `sage --gp` execute quickly, without the overhead that starting Python entails. Hence the approach in my patches on this ticket. If you want to insist that people use `sage-sh -c gp` instead, I don't think it can get a positive review unless the approach gets a positive response on sage-devel.



---

archive/issue_comments_000083.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nRather than building on your patches on this ticket, we're proposing completely rewriting the command line interface of Sage, and that includes changing invocation methods. That's why we've set the milestone to sage-6.0 - the idea is to tie it with the layout restructuring and new development interface that will come with the git transition (#13015). We figured that the git transition is a big enough change to warrant a major version bump (though that might end up being sage-7.0 or whatever, depending on the timeline).\n\nSo, of course, this will all go through sage-devel in time, once we figure out exactly what we're proposing.",
    "created_at": "2013-01-24T18:44:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-83",
    "user": "https://github.com/kini"
}
```

<div id="comment:36" align="right">comment:36</div>

Rather than building on your patches on this ticket, we're proposing completely rewriting the command line interface of Sage, and that includes changing invocation methods. That's why we've set the milestone to sage-6.0 - the idea is to tie it with the layout restructuring and new development interface that will come with the git transition (#13015). We figured that the git transition is a big enough change to warrant a major version bump (though that might end up being sage-7.0 or whatever, depending on the timeline).

So, of course, this will all go through sage-devel in time, once we figure out exactly what we're proposing.



---

archive/issue_comments_000084.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nOh, I understood that you were starting from scratch. I was responding to your proposal about `sage-sh`, suggesting that not all users would be happy with that solution.",
    "created_at": "2013-01-24T18:57:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-84",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

Oh, I understood that you were starting from scratch. I was responding to your proposal about `sage-sh`, suggesting that not all users would be happy with that solution.



---

archive/issue_comments_000085.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nIf you need a separate `bash` script anyway to parse some options like `--sh`, then it's a trivial exercise to parse more options (like `--gp`) in that same script.",
    "created_at": "2013-01-24T19:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-85",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:38" align="right">comment:38</div>

If you need a separate `bash` script anyway to parse some options like `--sh`, then it's a trivial exercise to parse more options (like `--gp`) in that same script.



---

archive/issue_comments_000086.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\njdemeyer: I think you misunderstand. Currently, `sage` is a bash script, which checks some options, then starts up Python to handle the rest (separately in various different code branches, no less). What we're proposing is the following scenario:\n\n`sage` is a Python script. `sage-sh` is a bash script. `sage-sh` does not parse any arguments - it just sources sage-env, does whatever other setup required, and dumps you in a shell. Any arguments to `sage-sh` are just passed to that shell. As such, `-c` would allow you to specify a command to execute in the Sage shell, such as `gap` or `gp`. `sage-sh` does not load Python unless you happen to give it `-c python` as an argument. \n\n`sage` is directly run by Python because it is a python script. `sage --sh` (or probably `sage sh` because of ohanar's subcommands idea) will cause Python to start up, parse the arguments, and then exec the bash script `sage-sh` (i.e. be very slow).\n\nThe argument would be that if you need something to happen fast and want to avoid starting up Python, or are the release manager and are doing things with Sage in a state where Python doesn't exist, you're probably writing scripts anyway and can afford to write out `sage-sh -c sage-pkg` (or whatever the package manager command ends up being) inside your script, or make an alias in your shell. If you're a normal user just typing on the command line, you won't care that Python had to start up just to parse your command line arguments.\n\nThe benefit of doing this is that the entire normal startup chain of Sage can be made pure Python, which is easier to maintain and might be more portable (?).",
    "created_at": "2013-01-24T19:27:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-86",
    "user": "https://github.com/kini"
}
```

<div id="comment:39" align="right">comment:39</div>

jdemeyer: I think you misunderstand. Currently, `sage` is a bash script, which checks some options, then starts up Python to handle the rest (separately in various different code branches, no less). What we're proposing is the following scenario:

`sage` is a Python script. `sage-sh` is a bash script. `sage-sh` does not parse any arguments - it just sources sage-env, does whatever other setup required, and dumps you in a shell. Any arguments to `sage-sh` are just passed to that shell. As such, `-c` would allow you to specify a command to execute in the Sage shell, such as `gap` or `gp`. `sage-sh` does not load Python unless you happen to give it `-c python` as an argument. 

`sage` is directly run by Python because it is a python script. `sage --sh` (or probably `sage sh` because of ohanar's subcommands idea) will cause Python to start up, parse the arguments, and then exec the bash script `sage-sh` (i.e. be very slow).

The argument would be that if you need something to happen fast and want to avoid starting up Python, or are the release manager and are doing things with Sage in a state where Python doesn't exist, you're probably writing scripts anyway and can afford to write out `sage-sh -c sage-pkg` (or whatever the package manager command ends up being) inside your script, or make an alias in your shell. If you're a normal user just typing on the command line, you won't care that Python had to start up just to parse your command line arguments.

The benefit of doing this is that the entire normal startup chain of Sage can be made pure Python, which is easier to maintain and might be more portable (?).



---

archive/issue_comments_000087.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nDoesn't this contradict?\n\nReplying to [@jhpalmieri](#comment:35):\n> William, among others, as alluded to [above](#comment:11), was pretty insistent that commands like `sage --gp` execute quickly, without the overhead that starting Python entails.\n\nReplying to [@kini](#comment:39):\n> `sage` is a Python script.",
    "created_at": "2013-01-24T20:08:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-87",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:40" align="right">comment:40</div>

Doesn't this contradict?

Replying to [@jhpalmieri](#comment:35):
> William, among others, as alluded to [above](#comment:11), was pretty insistent that commands like `sage --gp` execute quickly, without the overhead that starting Python entails.

Replying to [@kini](#comment:39):
> `sage` is a Python script.



---

archive/issue_comments_000088.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\n1) That comment is 3 years old and I imagine it's up for discussion by now.\n\n2) Replace `sage --gp` with `sage-sh -c gp` and all is well. I doubt William, among others, is talking about the exact command `sage --gp`; as long as there is a good way to start up Sage's gp quickly without loading Python, we should be fine (?).",
    "created_at": "2013-01-24T20:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-88",
    "user": "https://github.com/kini"
}
```

<div id="comment:41" align="right">comment:41</div>

1) That comment is 3 years old and I imagine it's up for discussion by now.

2) Replace `sage --gp` with `sage-sh -c gp` and all is well. I doubt William, among others, is talking about the exact command `sage --gp`; as long as there is a good way to start up Sage's gp quickly without loading Python, we should be fine (?).



---

archive/issue_comments_000089.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOK I see.  So we would have two \"top-level\" scripts then:\n`./sage` (Python-based) and `./sage-sh` (`bash`-based).  Yes, that would be fine for me.\n\nBut what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.",
    "created_at": "2013-01-24T20:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-89",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:42" align="right">comment:42</div>

OK I see.  So we would have two "top-level" scripts then:
`./sage` (Python-based) and `./sage-sh` (`bash`-based).  Yes, that would be fine for me.

But what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.



---

archive/issue_comments_000090.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@jdemeyer](#comment:42):\n> But what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.\n\nDefinitely short term I don't think it is realistic to make the entire startup entirely python because we don't have any python module to setup a suitable environment, however I think it would be good to still make separate out sage-sh:\n\nSpecifically I would have the root level sage script be (more or less)\n\n```\n#!/usr/bin/env sh\n\n\"$0-sh\" -c \"sage $*\"\n```\n\nand have `SAGE_LOCAL/bin/sage` be a pure python script.",
    "created_at": "2013-01-24T21:50:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-90",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@jdemeyer](#comment:42):
> But what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.

Definitely short term I don't think it is realistic to make the entire startup entirely python because we don't have any python module to setup a suitable environment, however I think it would be good to still make separate out sage-sh:

Specifically I would have the root level sage script be (more or less)

```
#!/usr/bin/env sh

"$0-sh" -c "sage $*"
```

and have `SAGE_LOCAL/bin/sage` be a pure python script.



---

archive/issue_comments_000091.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nGiven that part of the startup needs to be `bash` anyway (I actually think `bash` is a good language to implement `sage-env`), perhaps the two-pass argument parsing (as proposed in the comments of 3 years ago) would be best.  Have a small `sage` script written in `bash` which processes just a few options and when options aren't recognized, run all the Python `argparse` machinery.  What could be the problem with that?",
    "created_at": "2013-01-24T22:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-91",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:44" align="right">comment:44</div>

Given that part of the startup needs to be `bash` anyway (I actually think `bash` is a good language to implement `sage-env`), perhaps the two-pass argument parsing (as proposed in the comments of 3 years ago) would be best.  Have a small `sage` script written in `bash` which processes just a few options and when options aren't recognized, run all the Python `argparse` machinery.  What could be the problem with that?



---

archive/issue_comments_000092.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@jdemeyer](#comment:42):\n> But what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.\n\nRight, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.\n\nThe problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.\n\nIn any case, if I as a new Sage developer want to know or modify what option `--foo` does, there should be one obvious place to look for it. Making `sage-sh` parse arguments also means that we are shadowing arguments that could be passed on to the shell, etc. etc. Splitting argument parsing into two places is just generally a nasty design IMHO.\n\nWhy does part of the startup need to be bash, other than because of `sage-env`?",
    "created_at": "2013-01-24T22:25:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-92",
    "user": "https://github.com/kini"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@jdemeyer](#comment:42):
> But what about `sage-env` then?  That's needed by `sage-sh`, so it cannot be Python-based.

Right, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.

The problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.

In any case, if I as a new Sage developer want to know or modify what option `--foo` does, there should be one obvious place to look for it. Making `sage-sh` parse arguments also means that we are shadowing arguments that could be passed on to the shell, etc. etc. Splitting argument parsing into two places is just generally a nasty design IMHO.

Why does part of the startup need to be bash, other than because of `sage-env`?



---

archive/issue_comments_000093.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@kini](#comment:45):\n> Right, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.\n\nAre you saying that a configuration file should store the current environment? And that anytime it is changed (such as if the root directory of sage is moved) that this should be updated?\n> \n> The problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.\n\nAlso\n* argparse/optparse handles help functionality (consistent formatting), so all pre-parsed commands would still need stubs in argparse/optparse (and -1 for code duplication)\n* argparse (and maybe optparse) matches subcommands so long as they are not ambiguous. So if (for instance) sage only had the subcommands foo and bar then `sage f [args]` would be expanded to `sage foo [args]`. (this is fairly standard for software with subcommands) This functionality would be inconsistent if there were any pre-parsed commands.\n> In any case, if I as a new Sage developer want to know or modify what option `--foo` does, there should be one obvious place to look for it. Making `sage-sh` parse arguments also means that we are shadowing arguments that could be passed on to the shell, etc. etc. Splitting argument parsing into two places is just generally a nasty design IMHO.\n\n+1\n\n> Why does part of the startup need to be bash, other than because of `sage-env`?\n\nFor one of two reasons:\n\n* python may not be in `PATH` because python is not currently a dependency\n* even if python is in `PATH`, sage may not work with the default python",
    "created_at": "2013-01-25T02:33:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-93",
    "user": "https://github.com/ohanar"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@kini](#comment:45):
> Right, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.

Are you saying that a configuration file should store the current environment? And that anytime it is changed (such as if the root directory of sage is moved) that this should be updated?
> 
> The problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.

Also
* argparse/optparse handles help functionality (consistent formatting), so all pre-parsed commands would still need stubs in argparse/optparse (and -1 for code duplication)
* argparse (and maybe optparse) matches subcommands so long as they are not ambiguous. So if (for instance) sage only had the subcommands foo and bar then `sage f [args]` would be expanded to `sage foo [args]`. (this is fairly standard for software with subcommands) This functionality would be inconsistent if there were any pre-parsed commands.
> In any case, if I as a new Sage developer want to know or modify what option `--foo` does, there should be one obvious place to look for it. Making `sage-sh` parse arguments also means that we are shadowing arguments that could be passed on to the shell, etc. etc. Splitting argument parsing into two places is just generally a nasty design IMHO.

+1

> Why does part of the startup need to be bash, other than because of `sage-env`?

For one of two reasons:

* python may not be in `PATH` because python is not currently a dependency
* even if python is in `PATH`, sage may not work with the default python



---

archive/issue_comments_000094.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@ohanar](#comment:46):\n> Replying to [@kini](#comment:45):\n> > Right, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.\n\n> \n> Are you saying that a configuration file should store the current environment? And that anytime it is changed (such as if the root directory of sage is moved) that this should be updated?\n\nIt should store the current startup environment. It would change if the root directory of Sage is moved, for example, yes. But if a user decided to change an environment variable in a Sage session with `os.environ` that wouldn't become reflected in the file, of course.\n\n> > Why does part of the startup need to be bash, other than because of `sage-env`?\n\n> \n> For one of two reasons:\n> \n> * python may not be in `PATH` because python is not currently a dependency\n> * even if python is in `PATH`, sage may not work with the default python\n\nOh, right, of course. So then yes, `sage` should be bootstrapped in the way you described [above](#comment:43).",
    "created_at": "2013-01-25T07:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-94",
    "user": "https://github.com/kini"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@ohanar](#comment:46):
> Replying to [@kini](#comment:45):
> > Right, we might have a very thin bash wrapper that loads `sage-env` (which will be a bash script) before the main Python script. Or, since `sage-env` ideally should just set up environment variables and do nothing else (right?), we could turn it into a config file that was read independently by `sage-sh` and by `sage`. This would also allow us to rely less on environment variables for random things seemingly unrelated to the shell.

> 
> Are you saying that a configuration file should store the current environment? And that anytime it is changed (such as if the root directory of sage is moved) that this should be updated?

It should store the current startup environment. It would change if the root directory of Sage is moved, for example, yes. But if a user decided to change an environment variable in a Sage session with `os.environ` that wouldn't become reflected in the file, of course.

> > Why does part of the startup need to be bash, other than because of `sage-env`?

> 
> For one of two reasons:
> 
> * python may not be in `PATH` because python is not currently a dependency
> * even if python is in `PATH`, sage may not work with the default python

Oh, right, of course. So then yes, `sage` should be bootstrapped in the way you described [above](#comment:43).



---

archive/issue_comments_000095.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@kini](#comment:45):\n> Or, since `sage-env` ideally should just set up environment variables and do nothing else\n\nWell, some of these environment variables are conditional, so it's not that easy to have a file which works both from bash and from Python.  And I certainly don't see it as a problem that `sage-env` remains in `bash` as it is now.\n\n> The problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.\n\nAll these arguments are essentially irrelevant if the first pass needs to support just very few options.  Things like `./sage -tp` or `./sage -pt` would be handled anyway by the `argparse` script.\n\nOf course it's bad design to have two-pass argument parsing, but it would be so nice to keep `./sage -i` and `./sage --sh` working.\n\n> Why does part of the startup need to be bash, other than because of `sage-env`?\n\nI think `sage-env` is the main reason.",
    "created_at": "2013-01-25T07:35:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-95",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@kini](#comment:45):
> Or, since `sage-env` ideally should just set up environment variables and do nothing else

Well, some of these environment variables are conditional, so it's not that easy to have a file which works both from bash and from Python.  And I certainly don't see it as a problem that `sage-env` remains in `bash` as it is now.

> The problem with having two-pass argument parsing is that it separates the processing of arguments into multiple areas, making the architecture of the startup process needlessly complex. It is also pretty ugly to actually do this in the standard option parsing way because either you start to want to enforce arbitrary argument orders like we currently do (`sage -tp` works and `sage -pt` doesn't, `sage -br` works and `sage -rb` doesn't, etc.), or now the bash script needs to basically reimplement optparse/argparse in bash in order to correctly read the flags it's looking for.

All these arguments are essentially irrelevant if the first pass needs to support just very few options.  Things like `./sage -tp` or `./sage -pt` would be handled anyway by the `argparse` script.

Of course it's bad design to have two-pass argument parsing, but it would be so nice to keep `./sage -i` and `./sage --sh` working.

> Why does part of the startup need to be bash, other than because of `sage-env`?

I think `sage-env` is the main reason.



---

archive/issue_events_000162.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-162"
}
```



---

archive/issue_events_000163.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2013-12-17T18:39:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-163"
}
```



---

archive/issue_events_000164.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-164"
}
```



---

archive/issue_events_000165.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-165"
}
```



---

archive/issue_events_000166.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-166"
}
```



---

archive/issue_events_000167.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-167"
}
```



---

archive/issue_events_000168.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-168"
}
```



---

archive/issue_events_000169.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-169"
}
```



---

archive/issue_comments_000096.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThe command line interface continues to evolve; can someone (who cares) give a summary of what still would be needed?  [comment:24](#comment:24) still hasn't been resolved, and [comment:33](#comment:33) (as well as quick, non-Python-starting, use of `sage -maxima` and friends) seems quite relevant.",
    "created_at": "2014-11-20T13:33:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-96",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:53" align="right">comment:53</div>

The command line interface continues to evolve; can someone (who cares) give a summary of what still would be needed?  [comment:24](#comment:24) still hasn't been resolved, and [comment:33](#comment:33) (as well as quick, non-Python-starting, use of `sage -maxima` and friends) seems quite relevant.



---

archive/issue_events_000170.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-23T13:45:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-170"
}
```



---

archive/issue_events_000171.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2015-06-23T13:45:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "000080",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-171"
}
```



---

archive/issue_comments_000097.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nStill reading up on this ticket, and don't have any comments to add yet to the existing discussion.  But one question I have in general: Is anyone opposed at all to the idea of creating a new sub-command based interface, more like git, than the slightly unusual interface that uses single-character flags for subcommands?  E.g. replace `sage -t` with `sage test`.  Yes, it's more to type, but only by two characters, and is much less unusual.  The old `-t` could still be supported very easily for backwards compatibility, but perhaps with a deprecation warning.",
    "created_at": "2017-06-01T14:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-97",
    "user": "https://github.com/embray"
}
```

<div id="comment:55" align="right">comment:55</div>

Still reading up on this ticket, and don't have any comments to add yet to the existing discussion.  But one question I have in general: Is anyone opposed at all to the idea of creating a new sub-command based interface, more like git, than the slightly unusual interface that uses single-character flags for subcommands?  E.g. replace `sage -t` with `sage test`.  Yes, it's more to type, but only by two characters, and is much less unusual.  The old `-t` could still be supported very easily for backwards compatibility, but perhaps with a deprecation warning.



---

archive/issue_comments_000098.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nWilliam Stein and I were just talking about this idea yesterday. Something like this?\n\n```\nsage FILE.[sage|py|spyx]\n\nsage help\nsage help --advanced?\n\nsage -c <CMD>\n\nsage package config\nsage package name <TARBALL>\nsage package list\nsage package list standard\nsage package list optional\nsage package list experimental\nsage package apropos\nsage package download\nsage package update\nsage package fix-checksum\nsage package create\n\nsage install <PKGS>\n  options: [-f, --force] [-c, --check] [-d, --download] [-s, --save]\n   [-y, --yes] [-n, --no] [--no-dependency] [-i, --info]\n\nsage pip\n\nsage gap\nsage gap3\nsage gp\nsage maxima\nsage python\nsage python3\nsage ipython\nsage ipython3 (not yet implemented)\nsage R\nsage singular\nsage git\nsage cython\nsage cleaner\nsage ecl\nsage gdb\nsage kash\nsage lisp\nsage M2\nsage mwrank\nsage polymake\nsage scons\nsage sqlite3\nsage twistd\n\nsage shell\n\nsage notebook=[default|ssagenb|jupyter|export|jupyterlab|ipython]\n  options: --log=...\n\nsage notebook rst2ipynb ...\nsage notebook rst2txt ...\nsage notebook rst2sws ...\nsage notebook sws2rst ...\n\nsage test FILES\nsage test --all\n  options: --long, --verbose, --optional, --sagenb, --help,\n  [-p|--parallel], --randorder[=seed], --new, --initial, --debug,\n  --failed, --warn-long [timeout]\n\nsage preparse <FILE>\nsage startuptime\nsage coverage [-a, --all]\nsage search? search_src? search_doc? grep? grep_doc?\n\nsage sdist\nsage valgrind [--cacherind] [--callgrind] [--massif] [--memcheck] [--omega]\n\nsage docbuild\n  options: (run sage --docbuild --help to see)\n\nsage --nodotsage\nsage --root\nsage -q\nsage --min\nsage [-v, --version]\nsage dumpversion?\n\nsage fixdoctests ...\n\nsage build\nsage build --force\nsage build test?  (currently sage -bt ...)\nsage build run?  (currently sage -br)\n```\nMaybe some of these can be removed. Maybe some can be consolidated: do we need separate commands for gap, gp, maxima, ecl, R, etc., or can they be combined under a single command, like \"sage run <PROGRAM>\"? There is endless bikeshedding available.",
    "created_at": "2017-06-01T17:32:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-98",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:56" align="right">comment:56</div>

William Stein and I were just talking about this idea yesterday. Something like this?

```
sage FILE.[sage|py|spyx]

sage help
sage help --advanced?

sage -c <CMD>

sage package config
sage package name <TARBALL>
sage package list
sage package list standard
sage package list optional
sage package list experimental
sage package apropos
sage package download
sage package update
sage package fix-checksum
sage package create

sage install <PKGS>
  options: [-f, --force] [-c, --check] [-d, --download] [-s, --save]
   [-y, --yes] [-n, --no] [--no-dependency] [-i, --info]

sage pip

sage gap
sage gap3
sage gp
sage maxima
sage python
sage python3
sage ipython
sage ipython3 (not yet implemented)
sage R
sage singular
sage git
sage cython
sage cleaner
sage ecl
sage gdb
sage kash
sage lisp
sage M2
sage mwrank
sage polymake
sage scons
sage sqlite3
sage twistd

sage shell

sage notebook=[default|ssagenb|jupyter|export|jupyterlab|ipython]
  options: --log=...

sage notebook rst2ipynb ...
sage notebook rst2txt ...
sage notebook rst2sws ...
sage notebook sws2rst ...

sage test FILES
sage test --all
  options: --long, --verbose, --optional, --sagenb, --help,
  [-p|--parallel], --randorder[=seed], --new, --initial, --debug,
  --failed, --warn-long [timeout]

sage preparse <FILE>
sage startuptime
sage coverage [-a, --all]
sage search? search_src? search_doc? grep? grep_doc?

sage sdist
sage valgrind [--cacherind] [--callgrind] [--massif] [--memcheck] [--omega]

sage docbuild
  options: (run sage --docbuild --help to see)

sage --nodotsage
sage --root
sage -q
sage --min
sage [-v, --version]
sage dumpversion?

sage fixdoctests ...

sage build
sage build --force
sage build test?  (currently sage -bt ...)
sage build run?  (currently sage -br)
```
Maybe some of these can be removed. Maybe some can be consolidated: do we need separate commands for gap, gp, maxima, ecl, R, etc., or can they be combined under a single command, like "sage run <PROGRAM>"? There is endless bikeshedding available.



---

archive/issue_comments_000099.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nYes, something quite like that.\n\nAnd I was thinking of writing up some kind of declarative list(s) of subcommands.  In particular I was thinking two separate lists:\n\n1. One list of sage-specific sub-commands (such as `sage package` in your example above), which would automatically be translated to running individual scripts that implement them that would be named `sage-<subcommand>`. This is mostly how `git` works as well.\n\n2. One list of programs installed in the Sage distribution (`sage sh`, `sage gap`, etc.) that can be launched from the interface.  In principle one could make this automatic but I think it's better to have a hard-coded list.  I don't think a `sage run` is really necessary.  `sage sh <whatever>` is essentially the same as this, but I think it's still convenient to have shortcuts for common programs included in the Sage distribution.\n\nAlthough somewhat redundant, because it's common I would also have `sage --help` as an alias for `sage help` and `sage --help-advanced` for `sage help --advanced`, though one could bikeshed about whether those should do the exact same thing or not.\n\nI might also hide more of the development-specific commands (`sage coverage`, `sage startuptime`, etc.) behind a sub-command.",
    "created_at": "2017-06-02T08:22:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-99",
    "user": "https://github.com/embray"
}
```

<div id="comment:57" align="right">comment:57</div>

Yes, something quite like that.

And I was thinking of writing up some kind of declarative list(s) of subcommands.  In particular I was thinking two separate lists:

1. One list of sage-specific sub-commands (such as `sage package` in your example above), which would automatically be translated to running individual scripts that implement them that would be named `sage-<subcommand>`. This is mostly how `git` works as well.

2. One list of programs installed in the Sage distribution (`sage sh`, `sage gap`, etc.) that can be launched from the interface.  In principle one could make this automatic but I think it's better to have a hard-coded list.  I don't think a `sage run` is really necessary.  `sage sh <whatever>` is essentially the same as this, but I think it's still convenient to have shortcuts for common programs included in the Sage distribution.

Although somewhat redundant, because it's common I would also have `sage --help` as an alias for `sage help` and `sage --help-advanced` for `sage help --advanced`, though one could bikeshed about whether those should do the exact same thing or not.

I might also hide more of the development-specific commands (`sage coverage`, `sage startuptime`, etc.) behind a sub-command.



---

archive/issue_comments_000100.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\n(I should add, that's a very nice mock-up of what such an interface would look like, so thank you for that.)",
    "created_at": "2017-06-02T08:23:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-100",
    "user": "https://github.com/embray"
}
```

<div id="comment:58" align="right">comment:58</div>

(I should add, that's a very nice mock-up of what such an interface would look like, so thank you for that.)



---

archive/issue_comments_000101.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@embray](#comment:55):\n> E.g. replace `sage -t` with `sage test`.\n\nWhat about `sage -btp`? I use that all the time. I would hate it if that would become\n`sage buildtest -p` or worse, `make build && sage test -p`.",
    "created_at": "2017-06-02T13:01:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-101",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@embray](#comment:55):
> E.g. replace `sage -t` with `sage test`.

What about `sage -btp`? I use that all the time. I would hate it if that would become
`sage buildtest -p` or worse, `make build && sage test -p`.



---

archive/issue_comments_000102.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nWe should also think to what extent the build system should be exposed under the `sage` command. For example, we now have\n\n```\nmake FOO         # Build dependencies of FOO + FOO\nsage -i FOO      # Build toolchain + dependencies of FOO + FOO\nsage -f FOO      # Build toolchain + dependencies of FOO + *rebuild* FOO\nsage -p FOO      # Build FOO *without* dependencies\n```\nand\n\n```\nmake sagelib     # Build Sage library with dependencies\nsage -i sagelib  # Build Sage library with toolchain and dependencies\nsage -b          # Build Sage library *without* dependencies\nsage -f sagelib  # Rebuild all of the Sage library with toolchain and dependencies\nsage -ba         # Rebuild all of the Sage library *without* dependencies\n```\n\nThis is all for historical and accidental reasons, but this ticket should clean that up too.",
    "created_at": "2017-06-02T13:12:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-102",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:60" align="right">comment:60</div>

We should also think to what extent the build system should be exposed under the `sage` command. For example, we now have

```
make FOO         # Build dependencies of FOO + FOO
sage -i FOO      # Build toolchain + dependencies of FOO + FOO
sage -f FOO      # Build toolchain + dependencies of FOO + *rebuild* FOO
sage -p FOO      # Build FOO *without* dependencies
```
and

```
make sagelib     # Build Sage library with dependencies
sage -i sagelib  # Build Sage library with toolchain and dependencies
sage -b          # Build Sage library *without* dependencies
sage -f sagelib  # Rebuild all of the Sage library with toolchain and dependencies
sage -ba         # Rebuild all of the Sage library *without* dependencies
```

This is all for historical and accidental reasons, but this ticket should clean that up too.



---

archive/issue_comments_000103.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nNeedless to say, many people don't even know the subtle differences between the above commands.",
    "created_at": "2017-06-02T13:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-103",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:61" align="right">comment:61</div>

Needless to say, many people don't even know the subtle differences between the above commands.



---

archive/issue_comments_000104.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@jdemeyer](#comment:59):\n> Replying to [@embray](#comment:55):\n> > E.g. replace `sage -t` with `sage test`.\n\n> \n> What about `sage -btp`? I use that all the time. I would hate it if that would become\n> `sage buildtest -p` or worse, `make build && sage test -p`.\n\nI was actually thinking of allowing subcommands to be chained, like in `setup.py`.  So `sage build test`, where each can take optional flags if desired.",
    "created_at": "2017-06-06T09:42:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-104",
    "user": "https://github.com/embray"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@jdemeyer](#comment:59):
> Replying to [@embray](#comment:55):
> > E.g. replace `sage -t` with `sage test`.

> 
> What about `sage -btp`? I use that all the time. I would hate it if that would become
> `sage buildtest -p` or worse, `make build && sage test -p`.

I was actually thinking of allowing subcommands to be chained, like in `setup.py`.  So `sage build test`, where each can take optional flags if desired.



---

archive/issue_comments_000105.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,6 @@\n-`sage -br -notebook` doesn't start the notebook but it should.\n+We should improve and/or modernize and/or revise Sage's command-line parsing.\n \n-To apply: \n+Two ideas, which could be debated endlessly and could also be implemented independently of each other:\n+- use Python to handle the parsing, rather than a shell script\n+- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc.\n \n-- replace $SAGE_ROOT/makefile with \"makefile\".  See the diff file for reference.\n-- replace $SAGE_ROOT/sage with \"sage\".  See the diff file for reference.\n-- apply \"trac_21-extcode.patch\" to the extcode repo.\n-- apply \"trac_21-sagenb.patch\" to the sagenb repo.\n-- apply \"trac_21-scripts.patch\" to the scripts repo.\n-- apply \"trac_21-sage.patch\" to the sage repo.\n-\n-(The patches for extcode and sage are mainly changes in documentation. The critical patches are to the file \"sage\" and to the scripts repo.)\n-\n``````\n",
    "created_at": "2020-08-11T17:33:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-105",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,6 @@
-`sage -br -notebook` doesn't start the notebook but it should.
+We should improve and/or modernize and/or revise Sage's command-line parsing.
 
-To apply: 
+Two ideas, which could be debated endlessly and could also be implemented independently of each other:
+- use Python to handle the parsing, rather than a shell script
+- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc.
 
-- replace $SAGE_ROOT/makefile with "makefile".  See the diff file for reference.
-- replace $SAGE_ROOT/sage with "sage".  See the diff file for reference.
-- apply "trac_21-extcode.patch" to the extcode repo.
-- apply "trac_21-sagenb.patch" to the sagenb repo.
-- apply "trac_21-scripts.patch" to the scripts repo.
-- apply "trac_21-sage.patch" to the sage repo.
-
-(The patches for extcode and sage are mainly changes in documentation. The critical patches are to the file "sage" and to the scripts repo.)
-
``````




---

archive/issue_comments_000106.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n We should improve and/or modernize and/or revise Sage's command-line parsing.\n \n Two ideas, which could be debated endlessly and could also be implemented independently of each other:\n-- use Python to handle the parsing, rather than a shell script\n-- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc.\n+- use Python's [`argparse` module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script\n+- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)\n \n``````\n",
    "created_at": "2020-08-11T17:35:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-106",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 We should improve and/or modernize and/or revise Sage's command-line parsing.
 
 Two ideas, which could be debated endlessly and could also be implemented independently of each other:
-- use Python to handle the parsing, rather than a shell script
-- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc.
+- use Python's [`argparse` module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script
+- change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)
 
``````




---

archive/issue_comments_000107.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n We should improve and/or modernize and/or revise Sage's command-line parsing.\n \n Two ideas, which could be debated endlessly and could also be implemented independently of each other:\n-- use Python's [`argparse` module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script\n+- use Python's [argparse module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script\n - change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)\n \n``````\n",
    "created_at": "2020-08-11T17:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-107",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 We should improve and/or modernize and/or revise Sage's command-line parsing.
 
 Two ideas, which could be debated endlessly and could also be implemented independently of each other:
-- use Python's [`argparse` module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script
+- use Python's [argparse module](https://docs.python.org/3/library/argparse.html) to handle the parsing, rather than a shell script
 - change Sage's options from flags to subcommands: `sage --package ...` would be changed to `sage package ...`, etc. (comment:56 and [comment:57](#comment:57) list some possibilities)
 
``````




---

archive/issue_comments_000108.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nStrong -1 \"wontfix\" for the idea of making an incompatible change toward using \"subcommands\" after 14 years of the existence of the `sage` script.",
    "created_at": "2020-08-11T19:29:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-108",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

Strong -1 "wontfix" for the idea of making an incompatible change toward using "subcommands" after 14 years of the existence of the `sage` script.



---

archive/issue_comments_000109.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nI think the current interface of the `sage` script is pretty clumsy and dated by modern standards.  It can and should be made more user-friendly.  Just as one example of an advantage of subcommands is it makes the help documentation vastly more digestible.  I wouldn't propose changing it without maintaining backwards compatibility though.",
    "created_at": "2020-08-31T15:42:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-109",
    "user": "https://github.com/embray"
}
```

<div id="comment:67" align="right">comment:67</div>

I think the current interface of the `sage` script is pretty clumsy and dated by modern standards.  It can and should be made more user-friendly.  Just as one example of an advantage of subcommands is it makes the help documentation vastly more digestible.  I wouldn't propose changing it without maintaining backwards compatibility though.



---

archive/issue_comments_000110.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\n+1 from me to changing the sage script to support subcommands, especially if we can somehow do it in a way that preserves compatibility with the current parsing.  I wonder to what extent the following is possible:\n\n- 1. run the current shell script and if it \"works\" then done (with maybe some slight tightening)\n- 2. parse using subcommands.\n\nOr something else, e.g,. if you do \"sage [explicit list of subcommands]\" uses the subcommand approach; otherwise, fall back to the current parser.\n\nI wrote at least the first version of the current sage command line parser, and frankly I didn't know what I was doing at the time, and just sort of stupidly copied random bits and pieces of design from programs I had used.  Using python's subcommands support is a lot more systematic, and can also result in very nice modular code.",
    "created_at": "2020-08-31T17:58:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-110",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:68" align="right">comment:68</div>

+1 from me to changing the sage script to support subcommands, especially if we can somehow do it in a way that preserves compatibility with the current parsing.  I wonder to what extent the following is possible:

- 1. run the current shell script and if it "works" then done (with maybe some slight tightening)
- 2. parse using subcommands.

Or something else, e.g,. if you do "sage [explicit list of subcommands]" uses the subcommand approach; otherwise, fall back to the current parser.

I wrote at least the first version of the current sage command line parser, and frankly I didn't know what I was doing at the time, and just sort of stupidly copied random bits and pieces of design from programs I had used.  Using python's subcommands support is a lot more systematic, and can also result in very nice modular code.



---

archive/issue_comments_000111.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nSince all of the sage script's current \"subcommands\" (e.g. `sage -b`, `sage -i`) all start with hyphens, and new subcommands with be non-hyphenated, I think it would work to support both without too much ambiguity but I'd be interested in a counter-example.  `sage <filename.{py,sage}>` would still work since no sub-command would be confused with a runnable script filename.",
    "created_at": "2020-09-01T13:32:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-111",
    "user": "https://github.com/embray"
}
```

<div id="comment:69" align="right">comment:69</div>

Since all of the sage script's current "subcommands" (e.g. `sage -b`, `sage -i`) all start with hyphens, and new subcommands with be non-hyphenated, I think it would work to support both without too much ambiguity but I'd be interested in a counter-example.  `sage <filename.{py,sage}>` would still work since no sub-command would be confused with a runnable script filename.



---

archive/issue_comments_000112.json:
```json
{
    "body": "<div id=\"comment:70\" align=\"right\">comment:70</div>\n\nReplying to [@williamstein](#comment:68):\n> Using python's subcommands support is a lot more systematic, and can also result in very nice modular code.\n\nI might still just write it as a shell script.  Reason being, based on my experience implementing CLIs in Python, it tends to be much much slower to run a single command. At the very least I would do this for the top-level `sage` script.  Most subcommands would delegate to another program which might be another shell script, or could be written in Python (as is already the case).  For subcommands written in Python it's not always so bad as long as most operations you would do with that command are long enough to make the Python interpreter startup time negligible.  Those could also have further subcommands.",
    "created_at": "2020-09-01T13:37:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-112",
    "user": "https://github.com/embray"
}
```

<div id="comment:70" align="right">comment:70</div>

Replying to [@williamstein](#comment:68):
> Using python's subcommands support is a lot more systematic, and can also result in very nice modular code.

I might still just write it as a shell script.  Reason being, based on my experience implementing CLIs in Python, it tends to be much much slower to run a single command. At the very least I would do this for the top-level `sage` script.  Most subcommands would delegate to another program which might be another shell script, or could be written in Python (as is already the case).  For subcommands written in Python it's not always so bad as long as most operations you would do with that command are long enough to make the Python interpreter startup time negligible.  Those could also have further subcommands.



---

archive/issue_comments_000113.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\n> I might still just write it as a shell script.\n\n+1\n\nI should have just said \"in my experience, structuring command line parsing code as subcommands (implemented in any language) can result in very nice modular code.\"",
    "created_at": "2020-09-01T13:39:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-113",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:71" align="right">comment:71</div>

> I might still just write it as a shell script.

+1

I should have just said "in my experience, structuring command line parsing code as subcommands (implemented in any language) can result in very nice modular code."



---

archive/issue_events_000172.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-03T02:52:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-172"
}
```



---

archive/issue_events_000173.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-03T02:52:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-173"
}
```



---

archive/issue_comments_000114.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@williamstein](#comment:68):\n> +1 from me to changing the sage script to support subcommands, \n\nOne very frustrating part of subcommands is the failure of standard tab-completion to work with it:\nfor instance, for `jupyter notebook sheet.ipynb`. If there were just a command `jupyter-notebook`, it would be much easier and faster to type. Particularly with jupyter, which you nearly always use to start its notebook, it's rather frustrating. For git somehow it feels a little more natural, probably because there is naturally a larger variety of actions you want to take  through it. It also helps that most preconfigured bash tabcompletions are aware of git subcommands. (although still, distinct commands git-push, git-branch, git-pull would be faster)",
    "created_at": "2020-09-04T16:17:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-114",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@williamstein](#comment:68):
> +1 from me to changing the sage script to support subcommands, 

One very frustrating part of subcommands is the failure of standard tab-completion to work with it:
for instance, for `jupyter notebook sheet.ipynb`. If there were just a command `jupyter-notebook`, it would be much easier and faster to type. Particularly with jupyter, which you nearly always use to start its notebook, it's rather frustrating. For git somehow it feels a little more natural, probably because there is naturally a larger variety of actions you want to take  through it. It also helps that most preconfigured bash tabcompletions are aware of git subcommands. (although still, distinct commands git-push, git-branch, git-pull would be faster)



---

archive/issue_comments_000115.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nReplying to [@nbruin](#comment:73):\n> Replying to [@williamstein](#comment:68):\n> > +1 from me to changing the sage script to support subcommands, \n\n> \n> One very frustrating part of subcommands is the failure of standard tab-completion to work with it:\n\nThe question so far has been (for example) `sage --notebook` vs. `sage notebook`, and tab-completion won't work with either. Are you suggesting adding `sage-notebook` and other scripts?",
    "created_at": "2020-09-04T16:27:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-115",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:74" align="right">comment:74</div>

Replying to [@nbruin](#comment:73):
> Replying to [@williamstein](#comment:68):
> > +1 from me to changing the sage script to support subcommands, 

> 
> One very frustrating part of subcommands is the failure of standard tab-completion to work with it:

The question so far has been (for example) `sage --notebook` vs. `sage notebook`, and tab-completion won't work with either. Are you suggesting adding `sage-notebook` and other scripts?



---

archive/issue_comments_000116.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nReplying to [@jhpalmieri](#comment:74):\n\n> The question so far has been (for example) `sage --notebook` vs. `sage notebook`, and tab-completion won't work with either. Are you suggesting adding `sage-notebook` and other scripts?\n\nFrom a tab-completion point of view that would make sense, yes. (that, or learn how to extend the tab completion patterns). For this particular example, I'd use `jupyter notebook` anyway, with the sage kernel installed in the system jupyter server.\n\nThe traditional reason for having dashes in front of options/subcommands is to remove ambiguity from `sage notebook` (to run the file notebook) and `sage notebook` (to start the notebook). For that reason, I think we can only have subcommands for `sage` if `sage <file>` would have no meaning. I don't think we can discard this main function of `sage`. I think with jupyter, where there is one VERY common use, it's already a mistake to go with a subcommand design.\n\nExtrapolating from that, I think that using subcommands for the `sage` script is also the wrong fit. It works well with `git`, but users really interact differently with git.",
    "created_at": "2020-09-04T16:48:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-116",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:75" align="right">comment:75</div>

Replying to [@jhpalmieri](#comment:74):

> The question so far has been (for example) `sage --notebook` vs. `sage notebook`, and tab-completion won't work with either. Are you suggesting adding `sage-notebook` and other scripts?

From a tab-completion point of view that would make sense, yes. (that, or learn how to extend the tab completion patterns). For this particular example, I'd use `jupyter notebook` anyway, with the sage kernel installed in the system jupyter server.

The traditional reason for having dashes in front of options/subcommands is to remove ambiguity from `sage notebook` (to run the file notebook) and `sage notebook` (to start the notebook). For that reason, I think we can only have subcommands for `sage` if `sage <file>` would have no meaning. I don't think we can discard this main function of `sage`. I think with jupyter, where there is one VERY common use, it's already a mistake to go with a subcommand design.

Extrapolating from that, I think that using subcommands for the `sage` script is also the wrong fit. It works well with `git`, but users really interact differently with git.



---

archive/issue_comments_000117.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nReplying to [@nbruin](#comment:75):\n> The traditional reason for having dashes in front of options/subcommands is to remove ambiguity from `sage notebook` (to run the file notebook) and `sage notebook` (to start the notebook). For that reason, I think we can only have subcommands for `sage` if `sage <file>` would have no meaning. I don't think we can discard this main function of `sage`. I think with jupyter, where there is one VERY common use, it's already a mistake to go with a subcommand design.\n> \n> Extrapolating from that, I think that using subcommands for the `sage` script is also the wrong fit. It works well with `git`, but users really interact differently with git.\n\nI fully agree.",
    "created_at": "2020-09-04T17:48:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-117",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Replying to [@nbruin](#comment:75):
> The traditional reason for having dashes in front of options/subcommands is to remove ambiguity from `sage notebook` (to run the file notebook) and `sage notebook` (to start the notebook). For that reason, I think we can only have subcommands for `sage` if `sage <file>` would have no meaning. I don't think we can discard this main function of `sage`. I think with jupyter, where there is one VERY common use, it's already a mistake to go with a subcommand design.
> 
> Extrapolating from that, I think that using subcommands for the `sage` script is also the wrong fit. It works well with `git`, but users really interact differently with git.

I fully agree.



---

archive/issue_comments_000118.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nReplying to [@nbruin](#comment:75):\n> (that, or learn how to extend the tab completion patterns).\n\nFWIW, there are tools which can do this for you if your command line subcommands and options are all handled by argparse (rather than e.g. a top level bash script that calls out to python programs that use argparse for each subcommand, as embray suggested).\n\n[argcomplete](https://github.com/kislyuk/argcomplete) will dynamically provide on-the-fly completion candidates by actually running the argument parsing logic from the `sage` program every time you hit tab in the shell. This is always accurate but could be slow if `sage` takes a long time to get to the line of code where the argument parser is run (e.g. if it has some heavy imports).\n\n[shtab](https://github.com/iterative/shtab) also runs the argument parsing logic from the `sage` program, but it statically generates a bash completion script which you can then register with `bash-completion` by putting it in a relevant place (if you don't have root access, this can be `~/.local/share/bash-completion/completions/`). Then when you press tab in the shell, completions should be pretty instantaneous, but the completion script needs to be kept up to date with the command line interface of `sage`.\n\nIf you use a shell other than bash, it may be harder. zsh, at least, is supported by shtab and to some extent argcomplete as well.\n\nI suggest that `shtab` be run as part of the build process of Sage and that the resulting bash completion script be installed as part of the installation process. That should give out-of-the-box completion functionality to the majority of users, which would be nice. (Again, though, this would only work if the top-level `sage` does argument parsing in Python with `argparse`, and I understand that might not end up being the case for other reasons.)",
    "created_at": "2020-09-04T18:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/21#issuecomment-118",
    "user": "https://github.com/kini"
}
```

<div id="comment:77" align="right">comment:77</div>

Replying to [@nbruin](#comment:75):
> (that, or learn how to extend the tab completion patterns).

FWIW, there are tools which can do this for you if your command line subcommands and options are all handled by argparse (rather than e.g. a top level bash script that calls out to python programs that use argparse for each subcommand, as embray suggested).

[argcomplete](https://github.com/kislyuk/argcomplete) will dynamically provide on-the-fly completion candidates by actually running the argument parsing logic from the `sage` program every time you hit tab in the shell. This is always accurate but could be slow if `sage` takes a long time to get to the line of code where the argument parser is run (e.g. if it has some heavy imports).

[shtab](https://github.com/iterative/shtab) also runs the argument parsing logic from the `sage` program, but it statically generates a bash completion script which you can then register with `bash-completion` by putting it in a relevant place (if you don't have root access, this can be `~/.local/share/bash-completion/completions/`). Then when you press tab in the shell, completions should be pretty instantaneous, but the completion script needs to be kept up to date with the command line interface of `sage`.

If you use a shell other than bash, it may be harder. zsh, at least, is supported by shtab and to some extent argcomplete as well.

I suggest that `shtab` be run as part of the build process of Sage and that the resulting bash completion script be installed as part of the installation process. That should give out-of-the-box completion functionality to the majority of users, which would be nice. (Again, though, this would only work if the top-level `sage` does argument parsing in Python with `argparse`, and I understand that might not end up being the case for other reasons.)



---

archive/issue_events_000174.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-12-29T01:28:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/21",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/21#event-174"
}
```
