# Issue 174: Implement a modular Hermite Normal Form algorithm

archive/issues_000174.json:
```json
{
    "assignees": [
        "https://github.com/williamstein"
    ],
    "body": "Hermite Normal form is the analogue of echelon form over the integers.\nIt's crucial for almost all efficient computations with Z-modules (infinite \nabelian groups, finite abelian groups, lattices, modular abelian varieties\nvia lattices, etc).  \n\nMAGMA is 50 times faster even for small examples, and asymptotically\nmuch faster than GAP, PARI, and NTL. \n\nSee this page http://magma.maths.usyd.edu.au/users/allan/mat/hermite.html\nwhich is mirrored here:\nhttp://sage.math.washington.edu/sage/misc/hermite.html\n\n\n\n\nCC:  @burcin\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/174_\n\n",
    "closed_at": "2008-02-21T03:10:40Z",
    "created_at": "2006-12-01T02:15:15Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-2.10.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Implement a modular Hermite Normal Form algorithm",
    "type": "issue",
    "updated_at": "2008-02-21T03:10:40Z",
    "url": "https://github.com/sagemath/sage/issues/174",
    "user": "https://github.com/williamstein"
}
```
Hermite Normal form is the analogue of echelon form over the integers.
It's crucial for almost all efficient computations with Z-modules (infinite 
abelian groups, finite abelian groups, lattices, modular abelian varieties
via lattices, etc).  

MAGMA is 50 times faster even for small examples, and asymptotically
much faster than GAP, PARI, and NTL. 

See this page http://magma.maths.usyd.edu.au/users/allan/mat/hermite.html
which is mirrored here:
http://sage.math.washington.edu/sage/misc/hermite.html




CC:  @burcin

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/174_





---

archive/issue_events_001262.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-12-01T02:15:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1262"
}
```



---

archive/issue_events_001263.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-12-01T02:15:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1263"
}
```



---

archive/issue_events_001264.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-12-01T02:15:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1264"
}
```



---

archive/issue_events_001265.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2006-12-01T02:15:15Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1265"
}
```



---

archive/issue_comments_000549.json:
```json
{
    "body": "a student paper on fast HNF algorithms (and there are other papers out there)",
    "created_at": "2006-12-01T02:16:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-549",
    "user": "https://github.com/williamstein"
}
```

a student paper on fast HNF algorithms (and there are other papers out there)



---

archive/issue_events_001266.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-01-13T01:44:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1266"
}
```



---

archive/issue_events_001267.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-01-13T01:44:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1267"
}
```



---

archive/issue_comments_000550.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nAttachment: **[HermiteNormalForm_1.tex.gz](https://github.com/sagemath/sage/files/ticket174/HermiteNormalForm_1.tex.gz)**",
    "created_at": "2007-01-13T01:44:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-550",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:1" align="right">comment:1</div>

Attachment: **[HermiteNormalForm_1.tex.gz](https://github.com/sagemath/sage/files/ticket174/HermiteNormalForm_1.tex.gz)**



---

archive/issue_comments_000551.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThe attached paper by students describes the super-fast algorithm in MAGMA, and should\nbe reasonably easy to implement in SAGE given what we now have.",
    "created_at": "2007-03-08T10:09:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-551",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:2" align="right">comment:2</div>

The attached paper by students describes the super-fast algorithm in MAGMA, and should
be reasonably easy to implement in SAGE given what we now have.



---

archive/issue_events_001268.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-03-08T10:09:32Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "title_is": "Implement a modular Hermite Normal Form algorithm",
    "title_was": "all existing open source Hermite Normal Form implementations totally SUCK.",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1268"
}
```



---

archive/issue_events_001269.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-09-10T02:57:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1269"
}
```



---

archive/issue_comments_000552.json:
```json
{
    "body": "Attachment: **[trac-174.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174.patch.gz)**",
    "created_at": "2008-02-08T16:08:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-552",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac-174.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174.patch.gz)**



---

archive/issue_comments_000553.json:
```json
{
    "body": "Attachment: **[hnfrow.sage.gz](https://github.com/sagemath/sage/files/ticket174/hnfrow.sage.gz)**",
    "created_at": "2008-02-08T16:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-553",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[hnfrow.sage.gz](https://github.com/sagemath/sage/files/ticket174/hnfrow.sage.gz)**



---

archive/issue_comments_000554.json:
```json
{
    "body": "Attachment: **[trac-174-part2.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174-part2.patch.gz)**",
    "created_at": "2008-02-08T16:11:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-554",
    "user": "https://github.com/williamstein"
}
```

Attachment: **[trac-174-part2.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174-part2.patch.gz)**



---

archive/issue_comments_000555.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAttachment: **[trac-174-part3.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174-part3.patch.gz)**\n\nI've put the final hnf.hg bundle here:\n\n  http://sage.math.washington.edu/home/was/patches/hnf.hg\n\nThis is a bundle that I made by cleanly applying all my relevant\npatches to 2.10.2.alpha0, then do hg_sage.send(...). \n\nThe code is well documented, works well (very well tested with\nautomated testing and doctstrings), but has a HUGE MEMORY LEAK somewhere:\n\n```\nsage: a = random_matrix(ZZ,200,x=0,y=9)\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\n'234M+'\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\n'239M+'\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\n'244M+'\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\n'249M+'\n```\n\nI suspect the memleak is in the optimized GMP code I added to matrix_integer_dense, and will find out soon...",
    "created_at": "2008-02-17T01:14:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-555",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:5" align="right">comment:5</div>

Attachment: **[trac-174-part3.patch.gz](https://github.com/sagemath/sage/files/ticket174/trac-174-part3.patch.gz)**

I've put the final hnf.hg bundle here:

  http://sage.math.washington.edu/home/was/patches/hnf.hg

This is a bundle that I made by cleanly applying all my relevant
patches to 2.10.2.alpha0, then do hg_sage.send(...). 

The code is well documented, works well (very well tested with
automated testing and doctstrings), but has a HUGE MEMORY LEAK somewhere:

```
sage: a = random_matrix(ZZ,200,x=0,y=9)
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
'234M+'
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
'239M+'
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
'244M+'
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
'249M+'
```

I suspect the memleak is in the optimized GMP code I added to matrix_integer_dense, and will find out soon...



---

archive/issue_events_001270.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-02-17T01:28:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "milestone_number": null,
    "milestone_title": "sage-2.10.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1270"
}
```



---

archive/issue_events_001271.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-02-17T01:28:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1271"
}
```



---

archive/issue_comments_000556.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nHere's a big leak:\n\n```\nsage: a = random_matrix(ZZ,200,x=0,y=9); e = a.hermite_form(proof=False); p = a.pivots()\nsage: get_memory_usage()\n'192M+'\nsage: w = e._add_row_and_maintain_echelon_form(random_matrix(ZZ,1,200), p)\nsage: get_memory_usage()\n'210M+'\n```",
    "created_at": "2008-02-17T01:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-556",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:6" align="right">comment:6</div>

Here's a big leak:

```
sage: a = random_matrix(ZZ,200,x=0,y=9); e = a.hermite_form(proof=False); p = a.pivots()
sage: get_memory_usage()
'192M+'
sage: w = e._add_row_and_maintain_echelon_form(random_matrix(ZZ,1,200), p)
sage: get_memory_usage()
'210M+'
```



---

archive/issue_comments_000557.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nok, the file at http://sage.math.washington.edu/home/was/patches/hnf.hg has all the HNF stuff all working with no known issues.\n\n finally!",
    "created_at": "2008-02-17T03:46:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-557",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:7" align="right">comment:7</div>

ok, the file at http://sage.math.washington.edu/home/was/patches/hnf.hg has all the HNF stuff all working with no known issues.

 finally!



---

archive/issue_events_001272.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2008-02-17T03:46:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1272"
}
```



---

archive/issue_comments_000558.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nOk, running the final bundle under valgrind with \n\n```\nsage: a = random_matrix(ZZ,200,x=0,y=9)\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\nsage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()\n```\ndoesn't leak at all. Excellent. So positive review on memory leak issues.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-17T03:52:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-558",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:8" align="right">comment:8</div>

Ok, running the final bundle under valgrind with 

```
sage: a = random_matrix(ZZ,200,x=0,y=9)
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
sage: a._clear_cache(); e = a.hermite_form(proof=False); get_memory_usage()
```
doesn't leak at all. Excellent. So positive review on memory leak issues.

Cheers,

Michael



---

archive/issue_comments_000559.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFYI: The code has been merged, but still needs \"official\" review by a third party.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-17T11:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-559",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:9" align="right">comment:9</div>

FYI: The code has been merged, but still needs "official" review by a third party.

Cheers,

Michael



---

archive/issue_comments_000560.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nThe bundle has been extensively tested and I have verified via valgrind that it doesn't leak memory. While nobody external ever did a formal review  I am giving this a positive review due to the excessive amount of testing. Feel free to do a formal review, but please open another ticket in case  you come up with any issues.\n\nCheers,\n\nMichael",
    "created_at": "2008-02-21T03:10:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-560",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:10" align="right">comment:10</div>

The bundle has been extensively tested and I have verified via valgrind that it doesn't leak memory. While nobody external ever did a formal review  I am giving this a positive review due to the excessive amount of testing. Feel free to do a formal review, but please open another ticket in case  you come up with any issues.

Cheers,

Michael



---

archive/issue_events_001273.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-02-21T03:10:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1273"
}
```



---

archive/issue_events_001274.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-02-21T03:10:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1274"
}
```



---

archive/issue_comments_000561.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nMerged in Sage 2.10.2.alpha1",
    "created_at": "2008-02-21T03:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/174#issuecomment-561",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:11" align="right">comment:11</div>

Merged in Sage 2.10.2.alpha1



---

archive/issue_events_001275.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-02-21T03:10:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1275"
}
```



---

archive/issue_events_001276.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2008-02-21T03:10:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/174",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/174#event-1276"
}
```
