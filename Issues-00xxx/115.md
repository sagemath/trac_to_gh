# Issue 115: study alternatives to PyType_IsSubtype

archive/issues_000115.json:
```json
{
    "assignees": [
        "https://github.com/sagetrac-cwitty"
    ],
    "body": "Lots of our Pyrex code is going to be using `PyObject_TypeCheck` as a replacement for isinstance. This is a C macro (defined in python's object.h file), HOWEVER if the types don't match exactly it has to call the API PyType_IsSubType. The code for that function is shown below. Probably we can write something somewhat faster that covers many of the situations we need, because we don't need to worry about the MRO (method resolution order) stuff.\n\n```\n/* type test with subclassing support */\n\nint\nPyType_IsSubtype(PyTypeObject *a, PyTypeObject *b)\n{\n        PyObject *mro;\n\n        if (!(a->tp_flags & Py_TPFLAGS_HAVE_CLASS))\n                return b == a || b == &PyBaseObject_Type;\n\n        mro = a->tp_mro;\n        if (mro != NULL) {\n                /* Deal with multiple inheritance without recursion\n                   by walking the MRO tuple */\n                Py_ssize_t i, n;\n                assert(PyTuple_Check(mro));\n                n = PyTuple_GET_SIZE(mro);\n                for (i = 0; i < n; i++) {\n                        if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)\n                                return 1;\n                }\n                return 0;\n        }\n        else {\n                /* a is not completely initilized yet; follow tp_base */\n                do {\n                        if (a == b)\n                                return 1;\n                        a = a->tp_base;\n                } while (a != NULL);\n                return b == &PyBaseObject_Type;\n        }\n}\n```\n\n\nComponent: **misc**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/115_\n\n",
    "closed_at": "2010-08-26T20:22:44Z",
    "created_at": "2006-10-07T17:47:44Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "study alternatives to PyType_IsSubtype",
    "type": "issue",
    "updated_at": "2010-08-26T20:22:44Z",
    "url": "https://github.com/sagemath/sage/issues/115",
    "user": "https://github.com/sagetrac-dmharvey"
}
```
Lots of our Pyrex code is going to be using `PyObject_TypeCheck` as a replacement for isinstance. This is a C macro (defined in python's object.h file), HOWEVER if the types don't match exactly it has to call the API PyType_IsSubType. The code for that function is shown below. Probably we can write something somewhat faster that covers many of the situations we need, because we don't need to worry about the MRO (method resolution order) stuff.

```
/* type test with subclassing support */

int
PyType_IsSubtype(PyTypeObject *a, PyTypeObject *b)
{
        PyObject *mro;

        if (!(a->tp_flags & Py_TPFLAGS_HAVE_CLASS))
                return b == a || b == &PyBaseObject_Type;

        mro = a->tp_mro;
        if (mro != NULL) {
                /* Deal with multiple inheritance without recursion
                   by walking the MRO tuple */
                Py_ssize_t i, n;
                assert(PyTuple_Check(mro));
                n = PyTuple_GET_SIZE(mro);
                for (i = 0; i < n; i++) {
                        if (PyTuple_GET_ITEM(mro, i) == (PyObject *)b)
                                return 1;
                }
                return 0;
        }
        else {
                /* a is not completely initilized yet; follow tp_base */
                do {
                        if (a == b)
                                return 1;
                        a = a->tp_base;
                } while (a != NULL);
                return b == &PyBaseObject_Type;
        }
}
```


Component: **misc**

_Issue created by migration from https://trac.sagemath.org/ticket/115_





---

archive/issue_events_000828.json:
```json
{
    "actor": "https://github.com/sagetrac-dmharvey",
    "created_at": "2006-10-07T17:47:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-828"
}
```



---

archive/issue_events_000829.json:
```json
{
    "actor": "https://github.com/sagetrac-dmharvey",
    "created_at": "2006-10-07T17:47:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-829"
}
```



---

archive/issue_events_000830.json:
```json
{
    "actor": "https://github.com/sagetrac-dmharvey",
    "created_at": "2006-10-07T17:47:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-830"
}
```



---

archive/issue_events_000831.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-09-10T03:31:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-831"
}
```



---

archive/issue_events_000832.json:
```json
{
    "actor": "https://github.com/sagetrac-cwitty",
    "created_at": "2009-06-07T13:18:31Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-832"
}
```



---

archive/issue_events_000833.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-06-07T13:18:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20basic%20arithmetic",
    "label_color": "0000ff",
    "label_name": "c: basic arithmetic",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-833"
}
```



---

archive/issue_events_000834.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-08-26T20:22:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-834"
}
```



---

archive/issue_events_000835.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-08-26T20:22:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/feature",
    "label_color": "008080",
    "label_name": "feature",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-835"
}
```



---

archive/issue_events_000836.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-08-26T20:22:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-836"
}
```



---

archive/issue_comments_000362.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm going to close this as invalid.  I made a copy of this ticket on the Cython Trac site: http://trac.cython.org/cython_trac/ticket/572",
    "created_at": "2010-08-26T20:22:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/115#issuecomment-362",
    "user": "https://github.com/mwhansen"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm going to close this as invalid.  I made a copy of this ticket on the Cython Trac site: http://trac.cython.org/cython_trac/ticket/572



---

archive/issue_events_000837.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2010-08-26T20:22:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/115",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/115#event-837"
}
```
