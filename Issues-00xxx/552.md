# Issue 552: [with patch; positive review] come up with a better way of deciding whether or not the SAGE install has moved

archive/issues_000552.json:
```json
{
    "body": "All too often, because of symlinks, etc., my script for detecting whether or not the SAGE install\ntree has moved gets it wrong.  This is frickin' annoying.  I would like a way to determine this\nthat is much more intelligent. \n\nThe relevant code is SAGE_ROOT/local/bin/sage-location:\n\n```/usr/bin/env sage.bin\n\nimport os\n\nSAGE_ROOT = os.environ['SAGE_ROOT']\n\nlocation_file = '%s/local/lib/sage-current-location.txt'%SAGE_ROOT\n\ndef install_moved():\n    if not os.path.exists(location_file):\n        O = open(location_file,'w')\n        O.write(SAGE_ROOT)\n        O.close()\n        return False, ''   # first time -- so no need to update; this was during the build.\n\n    O = open(location_file)\n    R = O.read().strip()\n    O.close()\n    if os.path.abspath(R) != os.path.abspath(SAGE_ROOT):  # really different\n        return True, R  # it moved\n    return False, ''\n```\n\nAny better ideas???\n\nAssignee: @williamstein\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/552\n\n",
    "closed_at": "2008-10-31T21:30:19Z",
    "created_at": "2007-09-01T16:55:28Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2",
    "title": "[with patch; positive review] come up with a better way of deciding whether or not the SAGE install has moved",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/552",
    "user": "https://github.com/williamstein"
}
```
All too often, because of symlinks, etc., my script for detecting whether or not the SAGE install
tree has moved gets it wrong.  This is frickin' annoying.  I would like a way to determine this
that is much more intelligent. 

The relevant code is SAGE_ROOT/local/bin/sage-location:

```/usr/bin/env sage.bin

import os

SAGE_ROOT = os.environ['SAGE_ROOT']

location_file = '%s/local/lib/sage-current-location.txt'%SAGE_ROOT

def install_moved():
    if not os.path.exists(location_file):
        O = open(location_file,'w')
        O.write(SAGE_ROOT)
        O.close()
        return False, ''   # first time -- so no need to update; this was during the build.

    O = open(location_file)
    R = O.read().strip()
    O.close()
    if os.path.abspath(R) != os.path.abspath(SAGE_ROOT):  # really different
        return True, R  # it moved
    return False, ''
```

Any better ideas???

Assignee: @williamstein

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/552





---

archive/issue_events_001719.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1719"
}
```



---

archive/issue_comments_002933.json:
```json
{
    "body": "<a id='comment:2'></a>\nWe can use the shell program \"readlink\" since that follows symbolic links and friends. We already use it in the sage script to determine the actual location of the sage script.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-26T09:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-2933",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
We can use the shell program "readlink" since that follows symbolic links and friends. We already use it in the sage script to determine the actual location of the sage script.

Cheers,

Michael



---

archive/issue_events_001720.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "rename": {
        "from": "come up with a better way of deciding whether or not the SAGE install has moved",
        "to": "[with patch; needs review] come up with a better way of deciding whether or not the SAGE install has moved"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1720"
}
```



---

archive/issue_comments_002934.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_552.patch](tarball://root/attachments/some-uuid/ticket552/trac_552.patch) by anakha created at 2008-10-23 23:24:24\n\nos.path.realpath() takes care of symlinks.\n\nIt's that simple folks.",
    "created_at": "2008-10-23T23:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-2934",
    "user": "https://trac.sagemath.org/admin/accounts/users/anakha"
}
```

<a id='comment:3'></a>
Attachment [trac_552.patch](tarball://root/attachments/some-uuid/ticket552/trac_552.patch) by anakha created at 2008-10-23 23:24:24

os.path.realpath() takes care of symlinks.

It's that simple folks.



---

archive/issue_events_001721.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-31T21:27:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "milestone": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1721"
}
```



---

archive/issue_events_001722.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "rename": {
        "from": "[with patch; needs review] come up with a better way of deciding whether or not the SAGE install has moved",
        "to": "[with patch; positive review] come up with a better way of deciding whether or not the SAGE install has moved"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1722"
}
```



---

archive/issue_comments_002935.json:
```json
{
    "body": "<a id='comment:4'></a>\nPositive review.\n\nCheers,\n\nMichael",
    "created_at": "2008-10-31T21:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-2935",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Positive review.

Cheers,

Michael



---

archive/issue_comments_002936.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2008-10-31T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-2936",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

Resolution: fixed



---

archive/issue_events_001723.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-31T21:30:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1723"
}
```



---

archive/issue_comments_002937.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged in Sage 3.2.alpha2",
    "created_at": "2008-10-31T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-2937",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged in Sage 3.2.alpha2
