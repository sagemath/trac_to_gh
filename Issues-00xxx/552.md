# Issue 552: come up with a better way of deciding whether or not the SAGE install has moved

archive/issues_000552.json:
```json
{
    "body": "All too often, because of symlinks, etc., my script for detecting whether or not the SAGE install\ntree has moved gets it wrong.  This is frickin' annoying.  I would like a way to determine this\nthat is much more intelligent. \n\nThe relevant code is SAGE_ROOT/local/bin/sage-location:\n\n```/usr/bin/env sage.bin\n\nimport os\n\nSAGE_ROOT = os.environ['SAGE_ROOT']\n\nlocation_file = '%s/local/lib/sage-current-location.txt'%SAGE_ROOT\n\ndef install_moved():\n    if not os.path.exists(location_file):\n        O = open(location_file,'w')\n        O.write(SAGE_ROOT)\n        O.close()\n        return False, ''   # first time -- so no need to update; this was during the build.\n\n    O = open(location_file)\n    R = O.read().strip()\n    O.close()\n    if os.path.abspath(R) != os.path.abspath(SAGE_ROOT):  # really different\n        return True, R  # it moved\n    return False, ''\n```\n\nAny better ideas???\n\n**Assignee:** @williamstein\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/552\n\n",
    "closed_at": "2008-10-31T21:30:19Z",
    "created_at": "2007-09-01T16:55:28Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-3.2",
    "title": "come up with a better way of deciding whether or not the SAGE install has moved",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/552",
    "user": "https://github.com/williamstein"
}
```
All too often, because of symlinks, etc., my script for detecting whether or not the SAGE install
tree has moved gets it wrong.  This is frickin' annoying.  I would like a way to determine this
that is much more intelligent. 

The relevant code is SAGE_ROOT/local/bin/sage-location:

```/usr/bin/env sage.bin

import os

SAGE_ROOT = os.environ['SAGE_ROOT']

location_file = '%s/local/lib/sage-current-location.txt'%SAGE_ROOT

def install_moved():
    if not os.path.exists(location_file):
        O = open(location_file,'w')
        O.write(SAGE_ROOT)
        O.close()
        return False, ''   # first time -- so no need to update; this was during the build.

    O = open(location_file)
    R = O.read().strip()
    O.close()
    if os.path.abspath(R) != os.path.abspath(SAGE_ROOT):  # really different
        return True, R  # it moved
    return False, ''
```

Any better ideas???

**Assignee:** @williamstein

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/552





---

archive/issue_events_001612.json:
```json
{
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "label": "component: packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1612"
}
```



---

archive/issue_comments_003013.json:
```json
{
    "body": "<a id='comment:2'></a>\nWe can use the shell program \"readlink\" since that follows symbolic links and friends. We already use it in the sage script to determine the actual location of the sage script.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-26T09:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3013",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:2'></a>
We can use the shell program "readlink" since that follows symbolic links and friends. We already use it in the sage script to determine the actual location of the sage script.

Cheers,

Michael



---

archive/issue_comments_003014.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2008-10-23T23:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3014",
    "user": "https://trac.sagemath.org/admin/accounts/users/anakha"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_003015.json:
```json
{
    "body": "<a id='comment:3'></a>\nAttachment [trac_552.patch](tarball://root/attachments/some-uuid/ticket552/trac_552.patch) by anakha created at 2008-10-23 23:24:24\n\nos.path.realpath() takes care of symlinks.\n\nIt's that simple folks.",
    "created_at": "2008-10-23T23:24:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3015",
    "user": "https://trac.sagemath.org/admin/accounts/users/anakha"
}
```

<a id='comment:3'></a>
Attachment [trac_552.patch](tarball://root/attachments/some-uuid/ticket552/trac_552.patch) by anakha created at 2008-10-23 23:24:24

os.path.realpath() takes care of symlinks.

It's that simple folks.



---

archive/issue_events_001613.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-31T21:27:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "milestone": "sage-3.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1613"
}
```



---

archive/issue_comments_003016.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2008-10-31T21:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3016",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_003017.json:
```json
{
    "body": "<a id='comment:4'></a>\nPositive review.\n\nCheers,\n\nMichael",
    "created_at": "2008-10-31T21:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3017",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>
Positive review.

Cheers,

Michael



---

archive/issue_comments_003018.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2008-10-31T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3018",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

**Resolution:** fixed



---

archive/issue_events_001614.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/mabshoff",
    "created_at": "2008-10-31T21:30:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/552#event-1614"
}
```



---

archive/issue_comments_003019.json:
```json
{
    "body": "<a id='comment:5'></a>\nMerged in Sage 3.2.alpha2",
    "created_at": "2008-10-31T21:30:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/552",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/552#issuecomment-3019",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:5'></a>
Merged in Sage 3.2.alpha2
