# Issue 911: hash() on Graph objects changes as the object is mutated

archive/issues_000911.json:
```json
{
    "body": "This is bad:\n\n```\nsage: foo = Graph()\nsage: hash(foo)\n1033452963\nsage: foo.add_vertex(1)\nsage: hash(foo)\n1537218837\n```\n\n`__hash__` on Graph objects should be overridden to raise a TypeError.\n\n**Assignee:** @williamstein\n\n**Keywords:** graphs\n\nIssue created by migration from https://trac.sagemath.org/ticket/911\n\n",
    "closed_at": "2007-10-21T00:48:45Z",
    "created_at": "2007-10-17T06:20:15Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-2.8.8",
    "title": "hash() on Graph objects changes as the object is mutated",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/911",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```
This is bad:

```
sage: foo = Graph()
sage: hash(foo)
1033452963
sage: foo.add_vertex(1)
sage: hash(foo)
1537218837
```

`__hash__` on Graph objects should be overridden to raise a TypeError.

**Assignee:** @williamstein

**Keywords:** graphs

Issue created by migration from https://trac.sagemath.org/ticket/911





---

archive/issue_comments_005012.json:
```json
{
    "body": "<a id='comment:1'></a>\nFrom the python docs for `__hash__` at http://docs.python.org/ref/customization.html :\n\n\"If a class defines mutable objects and implements a __cmp__() or __eq__() method, it should not implement __hash__(), since the dictionary implementation requires that a key's hash value is immutable (if the object's hash value changes, it will be in the wrong hash bucket).\"\n\nCurrently, a Graph object defines a `__cmp__` method, but not a `__hash__` method.  This seems to be in accordance with the python docs.  However, I guess we are inheriting the `__hash__` method from SageObject, so we should redefine the `__hash__` method?\n\nHere's a patch:\n\n```\ndiff -r 36489d2c9a2e sage/graphs/graph.py\n--- a/sage/graphs/graph.py      Tue Oct 16 09:50:59 2007 -0500\n+++ b/sage/graphs/graph.py      Wed Oct 17 10:19:53 2007 -0500\n@@ -359,6 +359,20 @@ class GenericGraph(SageObject):\n             return self._nxg.name\n         else:\n             return repr(self)\n+\n+    def __hash__(self):\n+        \"\"\"\n+       Since graphs are mutable, they should not be hashable, so we return a type error.\n+\n+       EXAMPLE:\n+           sage: hash(Graph())\n+            Traceback (most recent call last):\n+            ...\n+            TypeError: graphs are mutable, and so therefore are unhashable\n+    \n+       \"\"\"\n+       raise TypeError, \"graphs are mutable, and so therefore are unhashable\"\n+\n \n     def _latex_(self):\n         \"\"\"\n```",
    "created_at": "2007-10-17T15:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5012",
    "user": "https://github.com/jasongrout"
}
```

<a id='comment:1'></a>
From the python docs for `__hash__` at http://docs.python.org/ref/customization.html :

"If a class defines mutable objects and implements a __cmp__() or __eq__() method, it should not implement __hash__(), since the dictionary implementation requires that a key's hash value is immutable (if the object's hash value changes, it will be in the wrong hash bucket)."

Currently, a Graph object defines a `__cmp__` method, but not a `__hash__` method.  This seems to be in accordance with the python docs.  However, I guess we are inheriting the `__hash__` method from SageObject, so we should redefine the `__hash__` method?

Here's a patch:

```
diff -r 36489d2c9a2e sage/graphs/graph.py
--- a/sage/graphs/graph.py      Tue Oct 16 09:50:59 2007 -0500
+++ b/sage/graphs/graph.py      Wed Oct 17 10:19:53 2007 -0500
@@ -359,6 +359,20 @@ class GenericGraph(SageObject):
             return self._nxg.name
         else:
             return repr(self)
+
+    def __hash__(self):
+        """
+       Since graphs are mutable, they should not be hashable, so we return a type error.
+
+       EXAMPLE:
+           sage: hash(Graph())
+            Traceback (most recent call last):
+            ...
+            TypeError: graphs are mutable, and so therefore are unhashable
+    
+       """
+       raise TypeError, "graphs are mutable, and so therefore are unhashable"
+
 
     def _latex_(self):
         """
```



---

archive/issue_comments_005013.json:
```json
{
    "body": "**Assignee:** @williamstein",
    "created_at": "2007-10-17T15:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5013",
    "user": "https://github.com/jasongrout"
}
```

**Assignee:** @williamstein



---

archive/issue_events_002806.json:
```json
{
    "actor": "https://github.com/jasongrout",
    "created_at": "2007-10-17T15:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "milestone": "sage-2.8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/911#event-2806"
}
```



---

archive/issue_comments_005014.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"graphs\".",
    "created_at": "2007-10-17T15:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5014",
    "user": "https://github.com/jasongrout"
}
```

**Changing keywords** from "" to "graphs".



---

archive/attachments_000579.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "graph_hash.patch",
    "asset_url": "tarball://root/attachments/some-uuid/ticket911/graph_hash.patch",
    "created_at": "2007-10-18T02:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "attachment",
    "url": "https://github.com/assets/some-id/some-uuid.patch",
    "user": "https://trac.sagemath.org/admin/accounts/users/ekirkman"
}
```



---

archive/issue_comments_005015.json:
```json
{
    "body": "",
    "created_at": "2007-10-18T02:35:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5015",
    "user": "https://trac.sagemath.org/admin/accounts/users/ekirkman"
}
```





---

archive/issue_comments_005016.json:
```json
{
    "body": "<a id='comment:2'></a>\nDefect resolved by attached patch.  Ready to include in 2.8.8!",
    "created_at": "2007-10-18T02:41:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5016",
    "user": "https://trac.sagemath.org/admin/accounts/users/ekirkman"
}
```

<a id='comment:2'></a>
Defect resolved by attached patch.  Ready to include in 2.8.8!



---

archive/issue_events_002807.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "rename": {
        "from": "hash() on Graph objects changes as the object is mutated",
        "to": "[tested by ekirkman] hash() on Graph objects changes as the object is mutated"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/911#event-2807"
}
```



---

archive/issue_comments_005017.json:
```json
{
    "body": "<a id='comment:3'></a>\nPlease see http://groups.google.com/group/sage-devel/t/72ca87d027fb3e63 regarding the\n\n```\n[tested by ...]\n```\nbyline.\n\nCheers,\n\nMichael",
    "created_at": "2007-10-18T10:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/911#issuecomment-5017",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:3'></a>
Please see http://groups.google.com/group/sage-devel/t/72ca87d027fb3e63 regarding the

```
[tested by ...]
```
byline.

Cheers,

Michael



---

archive/issue_events_002808.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "rename": {
        "from": "[tested by ekirkman] hash() on Graph objects changes as the object is mutated",
        "to": "hash() on Graph objects changes as the object is mutated"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/911#event-2808"
}
```



---

archive/issue_events_002809.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-21T00:48:45Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/911",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/911#event-2809"
}
```
