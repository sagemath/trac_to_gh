# Issue 789: Can't create a submodule over a QQ[x]-module

archive/issues_000789.json:
```json
{
    "assignees": [],
    "body": "Create a rank-3 free module M over QQ[x], get a random element, m, from M.  Then try to create the submodule generated by m.  SAGE complains that the module generated by 'm' is not a submodule of M:\n\n```\n\nsage: R1.<x>=PolynomialRing(QQ)\nsage: M=FreeModule(R1,3)\nsage: m=M.random_element()\nsage: N=M.submodule([m])\n---------------------------------------------------------------------------\n<type 'exceptions.ArithmeticError'>       Traceback (most recent call last)\n\n/SandBox/Justin/sb/sage-2.8.5.1/<ipython console> in <module>()\n\n/SandBox/Justin/sb/sage-2.8.5.1/local/lib/python2.5/site-packages/sage/modules/free_module.py in submodule(self, gens, check, already_echelonized)\n   1781         if check:\n   1782             if not V.is_submodule(self):\n-> 1783                 raise ArithmeticError, \"gens does not generate a submodule of self\"\n   1784         return V\n   1785 \n\n<type 'exceptions.ArithmeticError'>: gens does not generate a submodule of self\n\n```\n\n\n**Assignee:** @williamstein\n\nIssue created by migration from https://trac.sagemath.org/ticket/789\n\n",
    "closed_at": "2007-10-04T19:02:05Z",
    "created_at": "2007-10-02T18:04:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-2.8.6",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Can't create a submodule over a QQ[x]-module",
    "type": "issue",
    "updated_at": "2007-10-04T19:02:05Z",
    "url": "https://github.com/sagemath/sage/issues/789",
    "user": "https://github.com/sagetrac-justin"
}
```
Create a rank-3 free module M over QQ[x], get a random element, m, from M.  Then try to create the submodule generated by m.  SAGE complains that the module generated by 'm' is not a submodule of M:

```

sage: R1.<x>=PolynomialRing(QQ)
sage: M=FreeModule(R1,3)
sage: m=M.random_element()
sage: N=M.submodule([m])
---------------------------------------------------------------------------
<type 'exceptions.ArithmeticError'>       Traceback (most recent call last)

/SandBox/Justin/sb/sage-2.8.5.1/<ipython console> in <module>()

/SandBox/Justin/sb/sage-2.8.5.1/local/lib/python2.5/site-packages/sage/modules/free_module.py in submodule(self, gens, check, already_echelonized)
   1781         if check:
   1782             if not V.is_submodule(self):
-> 1783                 raise ArithmeticError, "gens does not generate a submodule of self"
   1784         return V
   1785 

<type 'exceptions.ArithmeticError'>: gens does not generate a submodule of self

```


**Assignee:** @williamstein

Issue created by migration from https://trac.sagemath.org/ticket/789





---

archive/issue_events_006083.json:
```json
{
    "actor": "https://github.com/sagetrac-justin",
    "created_at": "2007-10-02T18:04:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "milestone_number": null,
    "milestone_title": "sage-2.8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/789#event-6083"
}
```



---

archive/issue_events_006084.json:
```json
{
    "actor": "https://github.com/sagetrac-justin",
    "created_at": "2007-10-02T18:04:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "08517b",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/789#event-6084"
}
```



---

archive/issue_events_006085.json:
```json
{
    "actor": "https://github.com/sagetrac-justin",
    "created_at": "2007-10-02T18:04:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "008080",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/789#event-6085"
}
```



---

archive/issue_comments_003573.json:
```json
{
    "body": "<a id='comment:1'></a>\nHere's a partial explanation (more to come).\n\nThis works:\n\n```\nR1.<x>=PolynomialRing(QQ)\nM=FreeModule(R1,3)\nB=M.basis()\nf1=R1.random_element()\nf2=R1.random_element()\nn1 = f1*B[0]\nn2 = f2*B[1]\nV3=M.span([n1,n2])\n```\n\nThis (as above) is problematic:\n\n```\nm1 = M.random_element()\nm2 = M.random_element()\n\nV4 = M.submodule([m1,m2])\n!!!Boom!!!\n```\n\nAnd, we see\n\n```\nsage: type(n1)\n<type 'sage.modules.free_module_element.FreeModuleElement_generic_dense'>\nsage: type(n1) == type(m1)\nTrue\nsage: m1.parent() == M\nTrue\nsage: n1.parent() == M\nTrue\n```",
    "created_at": "2007-10-02T19:30:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/789#issuecomment-3573",
    "user": "https://github.com/sagetrac-justin"
}
```

<a id='comment:1'></a>
Here's a partial explanation (more to come).

This works:

```
R1.<x>=PolynomialRing(QQ)
M=FreeModule(R1,3)
B=M.basis()
f1=R1.random_element()
f2=R1.random_element()
n1 = f1*B[0]
n2 = f2*B[1]
V3=M.span([n1,n2])
```

This (as above) is problematic:

```
m1 = M.random_element()
m2 = M.random_element()

V4 = M.submodule([m1,m2])
!!!Boom!!!
```

And, we see

```
sage: type(n1)
<type 'sage.modules.free_module_element.FreeModuleElement_generic_dense'>
sage: type(n1) == type(m1)
True
sage: m1.parent() == M
True
sage: n1.parent() == M
True
```



---

archive/issue_comments_003574.json:
```json
{
    "body": "<a id='comment:2'></a>\nThe answer:\n\n```\nDon't have a patch yet, because I was playing fast and loose with the\nsource tree.  Here's the change I made:\n\nOriginal code:\n        x = self.fetch('echelon_form')\n        if not x is None:\n            return x\n        R = self.base_ring()\n        if not (R == ZZ or R.is_field()):\n            try:\n                E = self.matrix_over_field()\n            except TypeError:\n                raise NotImplementedError, \"Echelon form not\nimplemented over '%s'.\"%R\n        else:\n            E = self.copy()\n        if algorithm == 'default':\n            E.echelonize(cutoff=cutoff)\n        else:\n            E.echelonize(algorithm = algorithm, cutoff=cutoff)\n\nNew code (bug commented out):\n        x = self.fetch('echelon_form')\n        if not x is None:\n            return x\n        R = self.base_ring()\n#         if not (R == ZZ or R.is_field()):\n#             try:\n#                 E = self.matrix_over_field()\n#             except TypeError:\n#                 raise NotImplementedError, \"Echelon form not\nimplemented over '%s'.\"%R\n#         else:\n#             E = self.copy()\n        E = self.copy()\n        try:\n            if algorithm == 'default':\n                E.echelonize(cutoff=cutoff)\n            else:\n                E.echelonize(algorithm = algorithm, cutoff=cutoff)\n        except AttributeError, NotImplementedError:\n            raise NotImplementedError, \"Echelon form not implemented\nover '%s'.\"%R\n\nWith this change, I get the correct answer with the polynomial\nexample and the ZZ example.\n\nWhen I get a solid tree, I'll grind out a bundle and attach it to\nTrac#789.\n\nJustin\n\n```",
    "created_at": "2007-10-03T01:56:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/789#issuecomment-3574",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:2'></a>
The answer:

```
Don't have a patch yet, because I was playing fast and loose with the
source tree.  Here's the change I made:

Original code:
        x = self.fetch('echelon_form')
        if not x is None:
            return x
        R = self.base_ring()
        if not (R == ZZ or R.is_field()):
            try:
                E = self.matrix_over_field()
            except TypeError:
                raise NotImplementedError, "Echelon form not
implemented over '%s'."%R
        else:
            E = self.copy()
        if algorithm == 'default':
            E.echelonize(cutoff=cutoff)
        else:
            E.echelonize(algorithm = algorithm, cutoff=cutoff)

New code (bug commented out):
        x = self.fetch('echelon_form')
        if not x is None:
            return x
        R = self.base_ring()
#         if not (R == ZZ or R.is_field()):
#             try:
#                 E = self.matrix_over_field()
#             except TypeError:
#                 raise NotImplementedError, "Echelon form not
implemented over '%s'."%R
#         else:
#             E = self.copy()
        E = self.copy()
        try:
            if algorithm == 'default':
                E.echelonize(cutoff=cutoff)
            else:
                E.echelonize(algorithm = algorithm, cutoff=cutoff)
        except AttributeError, NotImplementedError:
            raise NotImplementedError, "Echelon form not implemented
over '%s'."%R

With this change, I get the correct answer with the polynomial
example and the ZZ example.

When I get a solid tree, I'll grind out a bundle and attach it to
Trac#789.

Justin

```



---

archive/issue_comments_003575.json:
```json
{
    "body": "HG bundle fixing the bug",
    "created_at": "2007-10-03T03:03:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/789#issuecomment-3575",
    "user": "https://github.com/sagetrac-justin"
}
```

HG bundle fixing the bug



---

archive/issue_events_006086.json:
```json
{
    "actor": "https://github.com/mwhansen",
    "created_at": "2007-10-03T05:39:27Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "milestone_number": null,
    "milestone_title": "sage-2.8.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/789#event-6086"
}
```



---

archive/issue_comments_003576.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Attachment:** [T789.hg.gz](https://github.com/sagemath/sage/files/ticket789/T789.hg.gz)",
    "created_at": "2007-10-03T05:39:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/789#issuecomment-3576",
    "user": "https://github.com/mwhansen"
}
```

<a id='comment:3'></a>
**Attachment:** [T789.hg.gz](https://github.com/sagemath/sage/files/ticket789/T789.hg.gz)



---

archive/issue_events_006087.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-04T19:02:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/789",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/789#event-6087"
}
```
