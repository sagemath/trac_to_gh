# Issue 431: dsage jobs get lost by server

archive/issues_000431.json:
```json
{
    "assignees": [
        "https://github.com/yqiang"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nApparently, a large number of jobs in a small time can cause the dsage server to hang, while there are waiting jobs and workers. \n\nComponent: **interfaces**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/431_\n\n",
    "closed_at": "2007-11-01T22:21:00Z",
    "created_at": "2007-08-16T03:12:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-2.8.11",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "dsage jobs get lost by server",
    "type": "issue",
    "updated_at": "2007-11-01T22:21:00Z",
    "url": "https://github.com/sagemath/sage/issues/431",
    "user": "https://github.com/rlmill"
}
```
<div id="comment:0"></div>

Apparently, a large number of jobs in a small time can cause the dsage server to hang, while there are waiting jobs and workers. 

Component: **interfaces**

_Issue created by migration from https://trac.sagemath.org/ticket/431_





---

archive/issue_events_003535.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T03:12:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-3.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3535"
}
```



---

archive/issue_events_003536.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T03:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20interfaces",
    "label_color": "0000ff",
    "label_name": "c: interfaces",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3536"
}
```



---

archive/issue_events_003537.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T03:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3537"
}
```



---

archive/issue_events_003538.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T03:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3538"
}
```



---

archive/issue_events_003539.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T03:12:35Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "subject": "https://github.com/rlmill",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3539"
}
```



---

archive/issue_events_003540.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-16T17:25:55Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "subject": "https://github.com/yqiang",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3540"
}
```



---

archive/issue_events_003541.json:
```json
{
    "actor": "https://github.com/yqiang",
    "created_at": "2007-08-16T17:25:55Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "subject": "https://github.com/yqiang",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3541"
}
```



---

archive/issue_comments_001522.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPlease include as much information as you can on this bug, including repro steps.",
    "created_at": "2007-08-16T17:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/431#issuecomment-1522",
    "user": "https://github.com/yqiang"
}
```

<div id="comment:1" align="right">comment:1</div>

Please include as much information as you can on this bug, including repro steps.



---

archive/issue_events_003542.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-18T21:30:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-3.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3542"
}
```



---

archive/issue_events_003543.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-08-18T21:30:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.8.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3543"
}
```



---

archive/issue_comments_001523.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nProblem seems to be a race condition between the task that downloads new jobs and the task that checks for results.  A temporary fix is to introduce a 1 second delay to all jobs to make sure this race condition doesn't happen.",
    "created_at": "2007-08-19T17:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/431#issuecomment-1523",
    "user": "https://github.com/yqiang"
}
```

<div id="comment:3" align="right">comment:3</div>

Problem seems to be a race condition between the task that downloads new jobs and the task that checks for results.  A temporary fix is to introduce a 1 second delay to all jobs to make sure this race condition doesn't happen.



---

archive/issue_events_003544.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T02:40:15Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.8.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3544"
}
```



---

archive/issue_events_003545.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T02:40:15Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3545"
}
```



---

archive/issue_events_003546.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T07:35:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3546"
}
```



---

archive/issue_events_003547.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T07:35:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3547"
}
```



---

archive/issue_events_003548.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T07:37:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-3.0",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3548"
}
```



---

archive/issue_events_003549.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-08-29T07:37:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3549"
}
```



---

archive/issue_comments_001524.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\n\n```\nReproduction steps ( takes about 6 hours ... )\n\nrlmill@sage:~/sage-2.8.4.1$ ./sage\n----------------------------------------------------------------------\n| SAGE Version 2.8.4.2.1, Release Date: 2007-09-20                   |\n| Type notebook() for the GUI, and license() for information.        |\n----------------------------------------------------------------------\n\nsage: d = dsage.start_all()\nSpawned dsage_server.py -d /home/rlmill/.sage/dsage/db/dsage.db -p 8081 -l 0 -f /home/rlmill/.sage/dsage/server.log -c /home/rlmill/.sage/dsage/pubcert.pem -k /home/rlmill/.sage/dsage/cacert.pem --statsfile=/home/rlmill/.sage/dsage/dsage.xml --ssl --noblock (pid = 25908)\n\nSpawned dsage_worker.py -s localhost -p 8081 -u rlmill -w 2 --poll 1.0 -l 0 -f /home/rlmill/.sage/dsage/worker.log --privkey=/home/rlmill/.sage/dsage/dsage_key --pubkey=/home/rlmill/.sage/dsage/dsage_key.pub --priority=20  --ssl --noblock (pid = 25911)\n\nsage: import sage.graphs.bruhat_sn\nsage: from sage.graphs.bruhat_sn import DistributedBruhatIntervals, BruhatDatabase\nsage: db = BruhatDatabase('/home/rlmill/database.db')\nsage: dbi = DistributedBruhatIntervals(d, db)\nsage: dbi.start()\n```",
    "created_at": "2007-09-20T23:42:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/431#issuecomment-1524",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:7" align="right">comment:7</div>


```
Reproduction steps ( takes about 6 hours ... )

rlmill@sage:~/sage-2.8.4.1$ ./sage
----------------------------------------------------------------------
| SAGE Version 2.8.4.2.1, Release Date: 2007-09-20                   |
| Type notebook() for the GUI, and license() for information.        |
----------------------------------------------------------------------

sage: d = dsage.start_all()
Spawned dsage_server.py -d /home/rlmill/.sage/dsage/db/dsage.db -p 8081 -l 0 -f /home/rlmill/.sage/dsage/server.log -c /home/rlmill/.sage/dsage/pubcert.pem -k /home/rlmill/.sage/dsage/cacert.pem --statsfile=/home/rlmill/.sage/dsage/dsage.xml --ssl --noblock (pid = 25908)

Spawned dsage_worker.py -s localhost -p 8081 -u rlmill -w 2 --poll 1.0 -l 0 -f /home/rlmill/.sage/dsage/worker.log --privkey=/home/rlmill/.sage/dsage/dsage_key --pubkey=/home/rlmill/.sage/dsage/dsage_key.pub --priority=20  --ssl --noblock (pid = 25911)

sage: import sage.graphs.bruhat_sn
sage: from sage.graphs.bruhat_sn import DistributedBruhatIntervals, BruhatDatabase
sage: db = BruhatDatabase('/home/rlmill/database.db')
sage: dbi = DistributedBruhatIntervals(d, db)
sage: dbi.start()
```



---

archive/issue_events_003550.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-09-20T23:42:07Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "title_is": "repro",
    "title_was": "dsage server hangs",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3550"
}
```



---

archive/issue_events_003551.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-09-20T23:42:43Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "title_is": "dsage jobs get lost by server",
    "title_was": "repro",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3551"
}
```



---

archive/issue_comments_001525.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThis seems to have been fixed by one of Yi's patches.",
    "created_at": "2007-11-01T21:56:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/431#issuecomment-1525",
    "user": "https://github.com/rlmill"
}
```

<div id="comment:9" align="right">comment:9</div>

This seems to have been fixed by one of Yi's patches.



---

archive/issue_events_003552.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-11-01T21:56:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3552"
}
```



---

archive/issue_events_003553.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-11-01T21:56:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "milestone_number": null,
    "milestone_title": "sage-2.8.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3553"
}
```



---

archive/issue_events_003554.json:
```json
{
    "actor": "https://github.com/rlmill",
    "created_at": "2007-11-01T21:56:33Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "title_is": "[is invalid] dsage jobs get lost by server",
    "title_was": "dsage jobs get lost by server",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3554"
}
```



---

archive/issue_comments_001526.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nFixed by an earlier patch of Yi according to the original reporter.",
    "created_at": "2007-11-01T22:21:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/431#issuecomment-1526",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:10" align="right">comment:10</div>

Fixed by an earlier patch of Yi according to the original reporter.



---

archive/issue_events_003555.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-11-01T22:21:00Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "title_is": "dsage jobs get lost by server",
    "title_was": "[is invalid] dsage jobs get lost by server",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3555"
}
```



---

archive/issue_events_003556.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-11-01T22:21:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/431",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/431#event-3556"
}
```
