# Issue 252: Make number fields work when polynomial not integral or not monic.

archive/issues_000252.json:
```json
{
    "assignees": [
        "https://github.com/loefflerd"
    ],
    "body": "<div id=\"comment:0\"></div>\n\nThe goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.\n\nIf the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.\n\nThe new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.\n\nDepends on #18740\n\nCC:  @katestange @sagetrac-Bouillaguet\n\nComponent: **number fields**\n\nAuthor: **Peter Bruin**\n\nBranch/Commit: **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**\n\nReviewer: **Kartik Venkatram**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/252_\n\n",
    "closed_at": "2015-08-26T03:00:18Z",
    "created_at": "2007-02-08T17:49:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-6.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Make number fields work when polynomial not integral or not monic.",
    "type": "issue",
    "updated_at": "2015-08-26T03:00:18Z",
    "url": "https://github.com/sagemath/sage/issues/252",
    "user": "https://github.com/williamstein"
}
```
<div id="comment:0"></div>

The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.

If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.

The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.

Depends on #18740

CC:  @katestange @sagetrac-Bouillaguet

Component: **number fields**

Author: **Peter Bruin**

Branch/Commit: **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**

Reviewer: **Kartik Venkatram**

_Issue created by migration from https://trac.sagemath.org/ticket/252_





---

archive/issue_events_001837.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-02-08T17:49:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1837"
}
```



---

archive/issue_events_001838.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-02-08T17:49:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1838"
}
```



---

archive/issue_events_001839.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-02-08T17:49:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1839"
}
```



---

archive/issue_events_001840.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-02-08T17:49:51Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "subject": "https://github.com/williamstein",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1840"
}
```



---

archive/issue_events_001841.json:
```json
{
    "actor": "https://github.com/sagetrac-mabshoff",
    "created_at": "2007-09-11T02:09:53Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-2.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1841"
}
```



---

archive/issue_comments_000761.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nYou may find sage.rings.algebraic_real.clear_denominators() useful here.  (If so, the function should probably be moved to a more sensible place, and perhaps renamed.)",
    "created_at": "2007-10-09T04:31:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-761",
    "user": "https://github.com/sagetrac-cwitty"
}
```

<div id="comment:2" align="right">comment:2</div>

You may find sage.rings.algebraic_real.clear_denominators() useful here.  (If so, the function should probably be moved to a more sensible place, and perhaps renamed.)



---

archive/issue_comments_000762.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe example above works.  But other things don't:\n\n```\nsage: R.<x> = QQ[]\nsage: sage: L.<b> = NumberField(x^2-1/2)\nsage: sage: L.discriminant()\n8\nsage: L.ring_of_integers()\nboom\n```",
    "created_at": "2007-10-21T01:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-762",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:3" align="right">comment:3</div>

The example above works.  But other things don't:

```
sage: R.<x> = QQ[]
sage: sage: L.<b> = NumberField(x^2-1/2)
sage: sage: L.discriminant()
8
sage: L.ring_of_integers()
boom
```



---

archive/issue_events_001842.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-21T01:59:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-2.10",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1842"
}
```



---

archive/issue_events_001843.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-21T01:59:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1843"
}
```



---

archive/issue_comments_000763.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nNotice that #4041 is a duplicate of this ticket.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-04T17:32:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-763",
    "user": "https://github.com/sagetrac-mabshoff"
}
```

<div id="comment:4" align="right">comment:4</div>

Notice that #4041 is a duplicate of this ticket.

Cheers,

Michael



---

archive/issue_events_001844.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:56:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20theory",
    "label_color": "0000ff",
    "label_name": "c: number theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1844"
}
```



---

archive/issue_events_001845.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:56:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20number%20fields",
    "label_color": "0000ff",
    "label_name": "c: number fields",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1845"
}
```



---

archive/issue_events_001846.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2009-07-20T19:56:32Z",
    "event": "unassigned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1846"
}
```



---

archive/issue_events_001847.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2009-07-20T19:56:32Z",
    "event": "assigned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "subject": "https://github.com/loefflerd",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1847"
}
```



---

archive/issue_comments_000764.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAnother example from #9408\n\n```\nsage: L.<a,b> = QQ[i].relativize(1) #Ok\nsage: L.<a,b> = QQ[i].relativize(1/2) #PariError\n```",
    "created_at": "2010-07-06T10:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-764",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:6" align="right">comment:6</div>

Another example from #9408

```
sage: L.<a,b> = QQ[i].relativize(1) #Ok
sage: L.<a,b> = QQ[i].relativize(1/2) #PariError
```



---

archive/issue_comments_000765.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nAt least the pari errors could be changed to \"not implemented\" messages in the meantime?  This is an error a new user may encounter.  It would help them to know immediately that the problem is all non-integral coefficients, so they can program around it, and to know that it is known to the developers.",
    "created_at": "2011-02-16T16:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-765",
    "user": "https://github.com/katestange"
}
```

<div id="comment:7" align="right">comment:7</div>

At least the pari errors could be changed to "not implemented" messages in the meantime?  This is an error a new user may encounter.  It would help them to know immediately that the problem is all non-integral coefficients, so they can program around it, and to know that it is known to the developers.



---

archive/issue_comments_000766.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI agree that fixing this would be very nice, but also would require completely reworking the number field code.  I think it is feasible, but do we really want to put that much effort into this?",
    "created_at": "2011-10-09T11:03:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-766",
    "user": "https://github.com/jdemeyer"
}
```

<div id="comment:9" align="right">comment:9</div>

I agree that fixing this would be very nice, but also would require completely reworking the number field code.  I think it is feasible, but do we really want to put that much effort into this?



---

archive/issue_comments_000767.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI, for myself would like to see this fixed. I would fix this myself if I had time...\n\nIn any case, current situation in Sage is not admissible. If we decide not to fix this then, should we allow to define number fields with nonintegral generators? This would also mean a lot of effort.",
    "created_at": "2011-10-09T12:35:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-767",
    "user": "https://github.com/lftabera"
}
```

<div id="comment:10" align="right">comment:10</div>

I, for myself would like to see this fixed. I would fix this myself if I had time...

In any case, current situation in Sage is not admissible. If we decide not to fix this then, should we allow to define number fields with nonintegral generators? This would also mean a lot of effort.



---

archive/issue_comments_000768.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jdemeyer](#comment%3A9):\n> I agree that fixing this would be very nice, but also would require \n> completely reworking the number field code.  I think it is feasible,\n> but do we really want to put that much effort into this?\n\nI don't know about \"we\", but it is a total no brainer that this has to get done eventually.   It is certainly easier than writing the number field code in the first place, which was hard, but not that hard.",
    "created_at": "2011-10-09T16:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-768",
    "user": "https://github.com/williamstein"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jdemeyer](#comment%3A9):
> I agree that fixing this would be very nice, but also would require 
> completely reworking the number field code.  I think it is feasible,
> but do we really want to put that much effort into this?

I don't know about "we", but it is a total no brainer that this has to get done eventually.   It is certainly easier than writing the number field code in the first place, which was hard, but not that hard.



---

archive/issue_events_001848.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-5.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1848"
}
```



---

archive/issue_events_001849.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1849"
}
```



---

archive/issue_events_001850.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20minor%20/%204",
    "label_color": "ffe799",
    "label_name": "p: minor / 4",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1850"
}
```



---

archive/issue_events_001851.json:
```json
{
    "actor": "https://github.com/sagetrac-Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1851"
}
```



---

archive/issue_comments_000769.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI just ran into this issue",
    "created_at": "2013-02-19T20:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-769",
    "user": "https://github.com/sagetrac-Bouillaguet"
}
```

<div id="comment:12" align="right">comment:12</div>

I just ran into this issue



---

archive/issue_events_001852.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-5.11",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1852"
}
```



---

archive/issue_events_001853.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1853"
}
```



---

archive/issue_events_001854.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1854"
}
```



---

archive/issue_events_001855.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1855"
}
```



---

archive/issue_events_001856.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1856"
}
```



---

archive/issue_events_001857.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1857"
}
```



---

archive/issue_events_001858.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1858"
}
```



---

archive/issue_events_001859.json:
```json
{
    "actor": "https://github.com/sagetrac-vbraun-spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "milestone_number": null,
    "milestone_title": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1859"
}
```



---

archive/issue_comments_000770.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nIn SageMath 6.7.beta1:\n\n```\nsage: R.<x> = QQ[]\nsage: L.<b> = NumberField(x^2-1/2)\nsage: L.discriminant()\n8\nsage: L.ring_of_integers()\nMaximal Order in Number Field in b with defining polynomial x^2 - 1/2\n```\nHowever, there are still problems; see e.g. #18243.  We should make use of the fact that when one feeds a non-monic or non-integral polynomial `f` to PARI's `nfinit()`, it returns a pair `[nf, c]` where `nf` is an number field isomorphic to **Q**[*x*]/(*f*) and defined by a monic integral polynomial, and `c` is a root of `f` in `nf`.",
    "created_at": "2015-04-17T22:03:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-770",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:17" align="right">comment:17</div>

In SageMath 6.7.beta1:

```
sage: R.<x> = QQ[]
sage: L.<b> = NumberField(x^2-1/2)
sage: L.discriminant()
8
sage: L.ring_of_integers()
Maximal Order in Number Field in b with defining polynomial x^2 - 1/2
```
However, there are still problems; see e.g. #18243.  We should make use of the fact that when one feeds a non-monic or non-integral polynomial `f` to PARI's `nfinit()`, it returns a pair `[nf, c]` where `nf` is an number field isomorphic to **Q**[*x*]/(*f*) and defined by a monic integral polynomial, and `c` is a root of `f` in `nf`.



---

archive/issue_comments_000771.json:
```json
{
    "body": "Dependencies: **#18740**",
    "created_at": "2015-06-19T20:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-771",
    "user": "https://github.com/pjbruin"
}
```

Dependencies: **#18740**



---

archive/issue_comments_000772.json:
```json
{
    "body": "Author: **Peter Bruin**",
    "created_at": "2015-06-19T20:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-772",
    "user": "https://github.com/pjbruin"
}
```

Author: **Peter Bruin**



---

archive/issue_comments_000773.json:
```json
{
    "body": "Commit: **[`8d0e9cc`](https://github.com/sagemath/sagetrac-mirror/commit/8d0e9cc46a967d0aa2c020365732fbaab84b996f)**",
    "created_at": "2015-06-19T20:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-773",
    "user": "https://github.com/pjbruin"
}
```

Commit: **[`8d0e9cc`](https://github.com/sagemath/sagetrac-mirror/commit/8d0e9cc46a967d0aa2c020365732fbaab84b996f)**



---

archive/issue_comments_000774.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nThis branch is work in progress; it does not solve #18243 yet, and there are probably other places where it should be checked that non-integral and/or non-monic polynomials are supported.",
    "created_at": "2015-06-19T20:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-774",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:19" align="right">comment:19</div>

This branch is work in progress; it does not solve #18243 yet, and there are probably other places where it should be checked that non-integral and/or non-monic polynomials are supported.



---

archive/issue_comments_000775.json:
```json
{
    "body": "Branch: **[u/pbruin/252-number_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/252-number_fields)**",
    "created_at": "2015-06-19T20:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-775",
    "user": "https://github.com/pjbruin"
}
```

Branch: **[u/pbruin/252-number_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/252-number_fields)**



---

archive/issue_comments_000776.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6\"><code>7840843</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>\n",
    "created_at": "2015-06-22T20:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-776",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6"><code>7840843</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>




---

archive/issue_comments_000777.json:
```json
{
    "body": "Changed commit from **[`8d0e9cc`](https://github.com/sagemath/sagetrac-mirror/commit/8d0e9cc46a967d0aa2c020365732fbaab84b996f)** to **[`7840843`](https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6)**",
    "created_at": "2015-06-22T20:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-777",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8d0e9cc`](https://github.com/sagemath/sagetrac-mirror/commit/8d0e9cc46a967d0aa2c020365732fbaab84b996f)** to **[`7840843`](https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6)**



---

archive/issue_comments_000778.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe examples in #14164 and #18243 now work.  This is mostly finished, but it needs more doctests to show that number fields defined by non-monic and non-integral polynomials are supported.",
    "created_at": "2015-06-22T20:41:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-778",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:21" align="right">comment:21</div>

The examples in #14164 and #18243 now work.  This is mostly finished, but it needs more doctests to show that number fields defined by non-monic and non-integral polynomials are supported.



---

archive/issue_comments_000779.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124\"><code>fce3c70</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>\n",
    "created_at": "2015-06-24T10:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-779",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124"><code>fce3c70</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>




---

archive/issue_comments_000780.json:
```json
{
    "body": "Changed commit from **[`7840843`](https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6)** to **[`fce3c70`](https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124)**",
    "created_at": "2015-06-24T10:03:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-780",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7840843`](https://github.com/sagemath/sagetrac-mirror/commit/78408430db0bd43a0cd1e886c0d6b42184bd6dd6)** to **[`fce3c70`](https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124)**



---

archive/issue_events_001860.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-06-24T10:12:09Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1860"
}
```



---

archive/issue_comments_000781.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,5 @@\n-Make number fields work when polynomial not integral or not monic.\n+The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.\n \n-```\n-sage: R.<x> = QQ[]\n-sage: L.<b> = NumberField(x^2-1/2)\n-sage: L.discriminant()\n-Traceback (most recent call last):\n-...\n-gen.PariError:  (8)\n-```\n+If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.\n+\n+The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.\n``````\n",
    "created_at": "2015-06-24T10:12:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-781",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,5 @@
-Make number fields work when polynomial not integral or not monic.
+The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.
 
-```
-sage: R.<x> = QQ[]
-sage: L.<b> = NumberField(x^2-1/2)
-sage: L.discriminant()
-Traceback (most recent call last):
-...
-gen.PariError:  (8)
-```
+If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.
+
+The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.
``````




---

archive/issue_comments_000782.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c\"><code>566770a</code></a></td><td><code>Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00\"><code>88fbd3d</code></a></td><td><code>trac #18379 doc typo in pari/gen</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303\"><code>d27251d</code></a></td><td><code>trac #18739 raise into py3 syntax</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d\"><code>5373b8e</code></a></td><td><code>Trac 18739: reviewer comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf87651ae81026fefe9e3c194556c55864f3b1c4\"><code>bf87651</code></a></td><td><code>Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c661096b45e80a7227eba537ae1f7dc9e3836c1d\"><code>c661096</code></a></td><td><code>Trac 18740: reduce overhead for relative number field elements</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2\"><code>7575686</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>\n",
    "created_at": "2015-07-03T09:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-782",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/566770a42a5e7f6c22c8449e2e0f0b57cdb7808c"><code>566770a</code></a></td><td><code>Merge branch 'u/pbruin/18739-pari_rnf_conversion' into 6.8.b5</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/88fbd3d61d0c316aadffaa980c90d0f7eb16eb00"><code>88fbd3d</code></a></td><td><code>trac #18379 doc typo in pari/gen</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d27251de48beac243d5c3b1d8e6f4b607c375303"><code>d27251d</code></a></td><td><code>trac #18739 raise into py3 syntax</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5373b8eeeeca1aef7816c85ccdf36d576850375d"><code>5373b8e</code></a></td><td><code>Trac 18739: reviewer comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf87651ae81026fefe9e3c194556c55864f3b1c4"><code>bf87651</code></a></td><td><code>Merge branch 'ticket/18739-pari_rnf_conversion' into ticket/18740-relative_number_fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c661096b45e80a7227eba537ae1f7dc9e3836c1d"><code>c661096</code></a></td><td><code>Trac 18740: reduce overhead for relative number field elements</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2"><code>7575686</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>




---

archive/issue_comments_000783.json:
```json
{
    "body": "Changed commit from **[`fce3c70`](https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124)** to **[`7575686`](https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2)**",
    "created_at": "2015-07-03T09:47:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-783",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fce3c70`](https://github.com/sagemath/sagetrac-mirror/commit/fce3c709dbeb1b7073b432527fe31a53eb7b8124)** to **[`7575686`](https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2)**



---

archive/issue_comments_000784.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e\"><code>b8fdeda</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>\n",
    "created_at": "2015-07-22T11:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-784",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e"><code>b8fdeda</code></a></td><td><code>Trac 252: allow non-monic and non-integral polynomials in number fields</code></td></tr></table>




---

archive/issue_comments_000785.json:
```json
{
    "body": "Changed commit from **[`7575686`](https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2)** to **[`b8fdeda`](https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e)**",
    "created_at": "2015-07-22T11:44:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-785",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7575686`](https://github.com/sagemath/sagetrac-mirror/commit/75756863cfd4ded5796d83696cf13f5ebb1670d2)** to **[`b8fdeda`](https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e)**



---

archive/issue_comments_000786.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nThe above version fixes `composite_fields()` to correctly solve #14164 and #18243.",
    "created_at": "2015-07-22T11:47:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-786",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:26" align="right">comment:26</div>

The above version fixes `composite_fields()` to correctly solve #14164 and #18243.



---

archive/issue_comments_000787.json:
```json
{
    "body": "Changed commit from **[`b8fdeda`](https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e)** to **[`d122714`](https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3)**",
    "created_at": "2015-08-21T07:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-787",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b8fdeda`](https://github.com/sagemath/sagetrac-mirror/commit/b8fdeda84073d4c72e042cd64e68678e099d292e)** to **[`d122714`](https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3)**



---

archive/issue_comments_000788.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3\"><code>d122714</code></a></td><td><code>Merge branch 'develop' into ticket/252-number_fields</code></td></tr></table>\n",
    "created_at": "2015-08-21T07:50:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-788",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3"><code>d122714</code></a></td><td><code>Merge branch 'develop' into ticket/252-number_fields</code></td></tr></table>




---

archive/issue_events_001861.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-22T22:02:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1861"
}
```



---

archive/issue_events_001862.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-22T22:02:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1862"
}
```



---

archive/issue_comments_000789.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nSomething weird seems to be going on with factoring. This is \"normal\" behavior for a number field.\n\n```\nsage: F.<a> = NumberField(x^3+x+1)\nsage: F(2).factor()\n2\nsage: F(3).factor()\n(a^2 + a + 2) * (-a + 1)\nsage: (a^2 + a + 2).factor()\na^2 + a + 2\nsage: F.factor(3)\n(Fractional ideal (a^2 + a + 2)) * (Fractional ideal (-a + 1))\nsage: (-a+1).factor()\n-a + 1\n```\n\nThis is not.\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: F(2).factor()\n(-47*a^2 + 21*a - 93/2) * (-1/2*a^2 + 1/2*a)^2 * (1/2*a^2 + 1/2*a)\nsage: F.factor(2)\n(Fractional ideal (-1/2*a^2 + 1/2*a))^2 * (Fractional ideal (1/2*a^2 + 1/2*a))\nsage: (-47*a^2 + 21*a - 93/2).norm()\n-8192\nsage: (-47*a^2 + 21*a - 93/2).factor()\n(3718815975/16384*a^2 - 1336872061/16384*a + 7884913157/32768) * (-1/2*a^2 + 1/2*a)^14 * (1/2*a^2 + 1/2*a)^-1\nsage: (1/2*a^2 + 1/2*a).factor()\n(13/512*a^2 - 11/512*a - 7/256) * (-1/2*a^2 + 1/2*a)^-4\n```\n\nSomehow, it's not controlling primes over the leading coefficient properly...",
    "created_at": "2015-08-22T22:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-789",
    "user": "https://github.com/sagetrac-kartikv"
}
```

<div id="comment:28" align="right">comment:28</div>

Something weird seems to be going on with factoring. This is "normal" behavior for a number field.

```
sage: F.<a> = NumberField(x^3+x+1)
sage: F(2).factor()
2
sage: F(3).factor()
(a^2 + a + 2) * (-a + 1)
sage: (a^2 + a + 2).factor()
a^2 + a + 2
sage: F.factor(3)
(Fractional ideal (a^2 + a + 2)) * (Fractional ideal (-a + 1))
sage: (-a+1).factor()
-a + 1
```

This is not.

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: F(2).factor()
(-47*a^2 + 21*a - 93/2) * (-1/2*a^2 + 1/2*a)^2 * (1/2*a^2 + 1/2*a)
sage: F.factor(2)
(Fractional ideal (-1/2*a^2 + 1/2*a))^2 * (Fractional ideal (1/2*a^2 + 1/2*a))
sage: (-47*a^2 + 21*a - 93/2).norm()
-8192
sage: (-47*a^2 + 21*a - 93/2).factor()
(3718815975/16384*a^2 - 1336872061/16384*a + 7884913157/32768) * (-1/2*a^2 + 1/2*a)^14 * (1/2*a^2 + 1/2*a)^-1
sage: (1/2*a^2 + 1/2*a).factor()
(13/512*a^2 - 11/512*a - 7/256) * (-1/2*a^2 + 1/2*a)^-4
```

Somehow, it's not controlling primes over the leading coefficient properly...



---

archive/issue_comments_000790.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nThe underlying problem seems to be converting PARI ideals in Hilbert normal form to Sage ideals:\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: Fp = F.pari_nf()\nsage: I = F.ideal(2)\nsage: Ip = I.pari_hnf()\nsage: fact = Fp.idealfactor(Ip)\nsage: Jp = fact[0, 0]\nsage: Fp.idealnorm(Jp)\n2\nsage: J = F.ideal(Jp)\nsage: J.norm()\n1/2             # should be 2, like Fp.idealnorm(Jp)\n```",
    "created_at": "2015-08-24T13:29:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-790",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:29" align="right">comment:29</div>

The underlying problem seems to be converting PARI ideals in Hilbert normal form to Sage ideals:

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: Fp = F.pari_nf()
sage: I = F.ideal(2)
sage: Ip = I.pari_hnf()
sage: fact = Fp.idealfactor(Ip)
sage: Jp = fact[0, 0]
sage: Fp.idealnorm(Jp)
2
sage: J = F.ideal(Jp)
sage: J.norm()
1/2             # should be 2, like Fp.idealnorm(Jp)
```



---

archive/issue_comments_000791.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nActually the bug is in the conversion from PARI elements expressed on the integral basis:\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: b = F.random_element()\nsage: F(F.pari_nf().nfalgtobasis(b)) == b\nFalse  # should be True\n```\nI'm working on a patch.",
    "created_at": "2015-08-24T16:41:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-791",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:30" align="right">comment:30</div>

Actually the bug is in the conversion from PARI elements expressed on the integral basis:

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: b = F.random_element()
sage: F(F.pari_nf().nfalgtobasis(b)) == b
False  # should be True
```
I'm working on a patch.



---

archive/issue_comments_000792.json:
```json
{
    "body": "Changed commit from **[`d122714`](https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3)** to **[`fd2743f`](https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db)**",
    "created_at": "2015-08-24T17:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-792",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d122714`](https://github.com/sagemath/sagetrac-mirror/commit/d1227146064d0e4ebcaf313f6eeec5c70713dde3)** to **[`fd2743f`](https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db)**



---

archive/issue_comments_000793.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db\"><code>fd2743f</code></a></td><td><code>Trac 252: fix conversion from PARI elements expressed on the integral basis</code></td></tr></table>\n",
    "created_at": "2015-08-24T17:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-793",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db"><code>fd2743f</code></a></td><td><code>Trac 252: fix conversion from PARI elements expressed on the integral basis</code></td></tr></table>




---

archive/issue_events_001863.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-08-24T17:17:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1863"
}
```



---

archive/issue_events_001864.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-08-24T17:17:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1864"
}
```



---

archive/issue_comments_000794.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nPositive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.",
    "created_at": "2015-08-24T17:53:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-794",
    "user": "https://github.com/sagetrac-kartikv"
}
```

<div id="comment:33" align="right">comment:33</div>

Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.



---

archive/issue_events_001865.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-24T17:53:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1865"
}
```



---

archive/issue_events_001866.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-24T17:53:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1866"
}
```



---

archive/issue_comments_000795.json:
```json
{
    "body": "<div id=\"comment:34\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906\"><code>d4660f1</code></a></td><td><code>Trac 252: additional examples</code></td></tr></table>\n",
    "created_at": "2015-08-25T11:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-795",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:34"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906"><code>d4660f1</code></a></td><td><code>Trac 252: additional examples</code></td></tr></table>




---

archive/issue_comments_000796.json:
```json
{
    "body": "Changed commit from **[`fd2743f`](https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db)** to **[`d4660f1`](https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906)**",
    "created_at": "2015-08-25T11:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-796",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fd2743f`](https://github.com/sagemath/sagetrac-mirror/commit/fd2743f092ecbffd79f49dc6cd18552631c407db)** to **[`d4660f1`](https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906)**



---

archive/issue_comments_000797.json:
```json
{
    "body": "<div id=\"comment:35\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880\"><code>8b86c52</code></a></td><td><code>Trac 252: additional examples</code></td></tr></table>\n",
    "created_at": "2015-08-25T11:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-797",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:35"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880"><code>8b86c52</code></a></td><td><code>Trac 252: additional examples</code></td></tr></table>




---

archive/issue_comments_000798.json:
```json
{
    "body": "Changed commit from **[`d4660f1`](https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906)** to **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**",
    "created_at": "2015-08-25T11:40:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-798",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d4660f1`](https://github.com/sagemath/sagetrac-mirror/commit/d4660f119eb45da3d9520b5f3b598ca5a6753906)** to **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**



---

archive/issue_comments_000799.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@sagetrac-kartikv](#comment%3A33):\n> Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.\n\nThanks for your comments.  If you approve of the new examples you can set this to positive review (and remember to fill in your [real] name as reviewer).",
    "created_at": "2015-08-25T11:43:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-799",
    "user": "https://github.com/pjbruin"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@sagetrac-kartikv](#comment%3A33):
> Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.

Thanks for your comments.  If you approve of the new examples you can set this to positive review (and remember to fill in your [real] name as reviewer).



---

archive/issue_events_001867.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-08-25T11:43:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1867"
}
```



---

archive/issue_events_001868.json:
```json
{
    "actor": "https://github.com/pjbruin",
    "created_at": "2015-08-25T11:43:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1868"
}
```



---

archive/issue_comments_000800.json:
```json
{
    "body": "Reviewer: **Kartik Venkatram**",
    "created_at": "2015-08-25T13:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-800",
    "user": "https://github.com/sagetrac-kartikv"
}
```

Reviewer: **Kartik Venkatram**



---

archive/issue_events_001869.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-25T13:49:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1869"
}
```



---

archive/issue_events_001870.json:
```json
{
    "actor": "https://github.com/sagetrac-kartikv",
    "created_at": "2015-08-25T13:49:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1870"
}
```



---

archive/issue_comments_000801.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nPerfect.",
    "created_at": "2015-08-25T13:49:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-801",
    "user": "https://github.com/sagetrac-kartikv"
}
```

<div id="comment:37" align="right">comment:37</div>

Perfect.



---

archive/issue_events_001871.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-26T03:00:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1871"
}
```



---

archive/issue_events_001872.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "a9cc833615a77c61f37b161fa471f57377ada516",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2015-08-26T03:00:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/252#event-1872"
}
```



---

archive/issue_comments_000802.json:
```json
{
    "body": "Changed branch from **[u/pbruin/252-number_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/252-number_fields)** to **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**",
    "created_at": "2015-08-26T03:00:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/252#issuecomment-802",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/pbruin/252-number_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/pbruin/252-number_fields)** to **[`8b86c52`](https://github.com/sagemath/sagetrac-mirror/commit/8b86c525a43dcfbab01224e3416722a1b29a9880)**
