# Issue 252: Make number fields work when polynomial not integral or not monic.

archive/issues_000252.json:
```json
{
    "body": "The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.\n\nIf the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.\n\nThe new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.\n\nAssignee: @loefflerd\n\nCC:  @katestange bouillaguet\n\nBranch/Commit: 8b86c525a43dcfbab01224e3416722a1b29a9880\n\nReviewer: Kartik Venkatram\n\nAuthor: Peter Bruin\n\nDependencies: #18740\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/252\n\n",
    "closed_at": "2015-08-26T03:00:18Z",
    "created_at": "2007-02-08T17:49:51Z",
    "labels": [
        "component: number fields",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make number fields work when polynomial not integral or not monic.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/252",
    "user": "https://github.com/williamstein"
}
```
The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.

If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.

The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.

Assignee: @loefflerd

CC:  @katestange bouillaguet

Branch/Commit: 8b86c525a43dcfbab01224e3416722a1b29a9880

Reviewer: Kartik Venkatram

Author: Peter Bruin

Dependencies: #18740

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/252





---

archive/issue_comments_001204.json:
```json
{
    "body": "<a id='comment:2'></a>You may find sage.rings.algebraic_real.clear_denominators() useful here.  (If so, the function should probably be moved to a more sensible place, and perhaps renamed.)",
    "created_at": "2007-10-09T04:31:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1204",
    "user": "https://trac.sagemath.org/admin/accounts/users/cwitty"
}
```

<a id='comment:2'></a>You may find sage.rings.algebraic_real.clear_denominators() useful here.  (If so, the function should probably be moved to a more sensible place, and perhaps renamed.)



---

archive/issue_comments_001205.json:
```json
{
    "body": "<a id='comment:3'></a>The example above works.  But other things don't:\n\n```\nsage: R.<x> = QQ[]\nsage: sage: L.<b> = NumberField(x^2-1/2)\nsage: sage: L.discriminant()\n8\nsage: L.ring_of_integers()\nboom\n```",
    "created_at": "2007-10-21T01:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1205",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:3'></a>The example above works.  But other things don't:

```
sage: R.<x> = QQ[]
sage: sage: L.<b> = NumberField(x^2-1/2)
sage: sage: L.discriminant()
8
sage: L.ring_of_integers()
boom
```



---

archive/issue_events_000527.json:
```json
{
    "actor": "https://github.com/williamstein",
    "created_at": "2007-10-21T01:59:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-527"
}
```



---

archive/issue_comments_001206.json:
```json
{
    "body": "<a id='comment:4'></a>Notice that #4041 is a duplicate of this ticket.\n\nCheers,\n\nMichael",
    "created_at": "2008-09-04T17:32:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1206",
    "user": "https://trac.sagemath.org/admin/accounts/users/mabshoff"
}
```

<a id='comment:4'></a>Notice that #4041 is a duplicate of this ticket.

Cheers,

Michael



---

archive/issue_comments_001207.json:
```json
{
    "body": "Changing component from number theory to number fields.",
    "created_at": "2009-07-20T19:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1207",
    "user": "https://github.com/loefflerd"
}
```

Changing component from number theory to number fields.



---

archive/issue_comments_001208.json:
```json
{
    "body": "Changing assignee from @williamstein to @loefflerd.",
    "created_at": "2009-07-20T19:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1208",
    "user": "https://github.com/loefflerd"
}
```

Changing assignee from @williamstein to @loefflerd.



---

archive/issue_comments_001209.json:
```json
{
    "body": "Changing upstream from \"\" to \"N/A\"",
    "created_at": "2010-07-06T10:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1209",
    "user": "https://github.com/lftabera"
}
```

Changing upstream from "" to "N/A"



---

archive/issue_comments_001210.json:
```json
{
    "body": "<a id='comment:6'></a>Another example from #9408\n\n```\nsage: L.<a,b> = QQ[i].relativize(1) #Ok\nsage: L.<a,b> = QQ[i].relativize(1/2) #PariError\n```",
    "created_at": "2010-07-06T10:59:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1210",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:6'></a>Another example from #9408

```
sage: L.<a,b> = QQ[i].relativize(1) #Ok
sage: L.<a,b> = QQ[i].relativize(1/2) #PariError
```



---

archive/issue_comments_001211.json:
```json
{
    "body": "<a id='comment:7'></a>At least the pari errors could be changed to \"not implemented\" messages in the meantime?  This is an error a new user may encounter.  It would help them to know immediately that the problem is all non-integral coefficients, so they can program around it, and to know that it is known to the developers.",
    "created_at": "2011-02-16T16:57:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1211",
    "user": "https://github.com/katestange"
}
```

<a id='comment:7'></a>At least the pari errors could be changed to "not implemented" messages in the meantime?  This is an error a new user may encounter.  It would help them to know immediately that the problem is all non-integral coefficients, so they can program around it, and to know that it is known to the developers.



---

archive/issue_comments_001212.json:
```json
{
    "body": "<a id='comment:9'></a>I agree that fixing this would be very nice, but also would require completely reworking the number field code.  I think it is feasible, but do we really want to put that much effort into this?",
    "created_at": "2011-10-09T11:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1212",
    "user": "https://github.com/jdemeyer"
}
```

<a id='comment:9'></a>I agree that fixing this would be very nice, but also would require completely reworking the number field code.  I think it is feasible, but do we really want to put that much effort into this?



---

archive/issue_comments_001213.json:
```json
{
    "body": "<a id='comment:10'></a>I, for myself would like to see this fixed. I would fix this myself if I had time...\n\nIn any case, current situation in Sage is not admissible. If we decide not to fix this then, should we allow to define number fields with nonintegral generators? This would also mean a lot of effort.",
    "created_at": "2011-10-09T12:35:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1213",
    "user": "https://github.com/lftabera"
}
```

<a id='comment:10'></a>I, for myself would like to see this fixed. I would fix this myself if I had time...

In any case, current situation in Sage is not admissible. If we decide not to fix this then, should we allow to define number fields with nonintegral generators? This would also mean a lot of effort.



---

archive/issue_comments_001214.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:\n> I agree that fixing this would be very nice, but also would require \n> completely reworking the number field code.  I think it is feasible,\n> but do we really want to put that much effort into this?\n\n\nI don't know about \"we\", but it is a total no brainer that this has to get done eventually.   It is certainly easier than writing the number field code in the first place, which was hard, but not that hard.",
    "created_at": "2011-10-09T16:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1214",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:11'></a>Replying to [comment:9 jdemeyer]:
> I agree that fixing this would be very nice, but also would require 
> completely reworking the number field code.  I think it is feasible,
> but do we really want to put that much effort into this?


I don't know about "we", but it is a total no brainer that this has to get done eventually.   It is certainly easier than writing the number field code in the first place, which was hard, but not that hard.



---

archive/issue_events_000528.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-2.9.1",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-528"
}
```



---

archive/issue_events_000529.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet",
    "created_at": "2013-02-19T20:45:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-529"
}
```



---

archive/issue_comments_001215.json:
```json
{
    "body": "<a id='comment:12'></a>I just ran into this issue",
    "created_at": "2013-02-19T20:45:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1215",
    "user": "https://trac.sagemath.org/admin/accounts/users/Bouillaguet"
}
```

<a id='comment:12'></a>I just ran into this issue



---

archive/issue_events_000530.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-5.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-530"
}
```



---

archive/issue_events_000531.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2013-08-13T15:34:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-531"
}
```



---

archive/issue_events_000532.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-5.12",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-532"
}
```



---

archive/issue_events_000533.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-01-30T21:20:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-533"
}
```



---

archive/issue_events_000534.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-6.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-534"
}
```



---

archive/issue_events_000535.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-05-06T15:19:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-535"
}
```



---

archive/issue_events_000536.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-6.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-536"
}
```



---

archive/issue_events_000537.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-537"
}
```



---

archive/issue_comments_001216.json:
```json
{
    "body": "<a id='comment:17'></a>In SageMath 6.7.beta1:\n\n```\nsage: R.<x> = QQ[]\nsage: L.<b> = NumberField(x^2-1/2)\nsage: L.discriminant()\n8\nsage: L.ring_of_integers()\nMaximal Order in Number Field in b with defining polynomial x^2 - 1/2\n```\nHowever, there are still problems; see e.g. #18243.  We should make use of the fact that when one feeds a non-monic or non-integral polynomial `f` to PARI's `nfinit()`, it returns a pair `[nf, c]` where `nf` is an number field isomorphic to **Q**[*x*]/(*f*) and defined by a monic integral polynomial, and `c` is a root of `f` in `nf`.",
    "created_at": "2015-04-17T22:03:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1216",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:17'></a>In SageMath 6.7.beta1:

```
sage: R.<x> = QQ[]
sage: L.<b> = NumberField(x^2-1/2)
sage: L.discriminant()
8
sage: L.ring_of_integers()
Maximal Order in Number Field in b with defining polynomial x^2 - 1/2
```
However, there are still problems; see e.g. #18243.  We should make use of the fact that when one feeds a non-monic or non-integral polynomial `f` to PARI's `nfinit()`, it returns a pair `[nf, c]` where `nf` is an number field isomorphic to **Q**[*x*]/(*f*) and defined by a monic integral polynomial, and `c` is a root of `f` in `nf`.



---

archive/issue_comments_001217.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#18740\"",
    "created_at": "2015-06-19T20:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1217",
    "user": "https://github.com/pjbruin"
}
```

Changing dependencies from "" to "#18740"



---

archive/issue_comments_001218.json:
```json
{
    "body": "Changing author from \"\" to \"Peter Bruin\"",
    "created_at": "2015-06-19T20:18:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1218",
    "user": "https://github.com/pjbruin"
}
```

Changing author from "" to "Peter Bruin"



---

archive/issue_comments_001219.json:
```json
{
    "body": "Changing commit from \"\" to \"8d0e9cc46a967d0aa2c020365732fbaab84b996f\"",
    "created_at": "2015-06-19T20:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1219",
    "user": "https://github.com/pjbruin"
}
```

Changing commit from "" to "8d0e9cc46a967d0aa2c020365732fbaab84b996f"



---

archive/issue_comments_001220.json:
```json
{
    "body": "<a id='comment:19'></a>This branch is work in progress; it does not solve #18243 yet, and there are probably other places where it should be checked that non-integral and/or non-monic polynomials are supported.",
    "created_at": "2015-06-19T20:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1220",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:19'></a>This branch is work in progress; it does not solve #18243 yet, and there are probably other places where it should be checked that non-integral and/or non-monic polynomials are supported.



---

archive/issue_comments_001221.json:
```json
{
    "body": "Changing branch from \"\" to \"u/pbruin/252-number_fields\"",
    "created_at": "2015-06-19T20:23:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1221",
    "user": "https://github.com/pjbruin"
}
```

Changing branch from "" to "u/pbruin/252-number_fields"



---

archive/issue_comments_001222.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-22T20:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1222",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_001223.json:
```json
{
    "body": "Changing commit from \"8d0e9cc46a967d0aa2c020365732fbaab84b996f\" to \"78408430db0bd43a0cd1e886c0d6b42184bd6dd6\"",
    "created_at": "2015-06-22T20:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1223",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8d0e9cc46a967d0aa2c020365732fbaab84b996f" to "78408430db0bd43a0cd1e886c0d6b42184bd6dd6"



---

archive/issue_comments_001224.json:
```json
{
    "body": "<a id='comment:21'></a>The examples in #14164 and #18243 now work.  This is mostly finished, but it needs more doctests to show that number fields defined by non-monic and non-integral polynomials are supported.",
    "created_at": "2015-06-22T20:41:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1224",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:21'></a>The examples in #14164 and #18243 now work.  This is mostly finished, but it needs more doctests to show that number fields defined by non-monic and non-integral polynomials are supported.



---

archive/issue_comments_001225.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-06-24T10:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1225",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_001226.json:
```json
{
    "body": "Changing commit from \"78408430db0bd43a0cd1e886c0d6b42184bd6dd6\" to \"fce3c709dbeb1b7073b432527fe31a53eb7b8124\"",
    "created_at": "2015-06-24T10:03:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1226",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "78408430db0bd43a0cd1e886c0d6b42184bd6dd6" to "fce3c709dbeb1b7073b432527fe31a53eb7b8124"



---

archive/issue_comments_001227.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-06-24T10:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1227",
    "user": "https://github.com/pjbruin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_001228.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,15 +1,8 @@\n-Make number fields work when polynomial not integral or not monic.\n+The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.\n \n-```\n-sage: R.<x> = QQ[]\n-sage: L.<b> = NumberField(x^2-1/2)\n-sage: L.discriminant()\n-Traceback (most recent call last):\n-...\n-gen.PariError:  (8)\n-```\n+If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.\n \n-Assignee: @williamstein\n+The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.\n \n Comment: 1\n \n``````\n",
    "created_at": "2015-06-24T10:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1228",
    "user": "https://github.com/pjbruin"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,15 +1,8 @@
-Make number fields work when polynomial not integral or not monic.
+The goal of this ticket is to make number fields work when the defining polynomial is not integral or not monic.
 
-```
-sage: R.<x> = QQ[]
-sage: L.<b> = NumberField(x^2-1/2)
-sage: L.discriminant()
-Traceback (most recent call last):
-...
-gen.PariError:  (8)
-```
+If the user specifies a non-integral or non-monic polynomial to define an absolute or relative number field, we define the corresponding PARI number field by a monic integral polynomial obtained from the PARI functions `polredbest` and `rnfpolredbest`, respectively.
 
-Assignee: @williamstein
+The new methods `NumberField_generic._pari_absolute_structure()` and `NumberField_relative._pari_relative_structure()` return the data needed to convert elements between the Sage `NumberField` and the PARI `nf` structure.
 
 Comment: 1
 
``````




---

archive/issue_comments_001229.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1229",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_001230.json:
```json
{
    "body": "Changing commit from \"fce3c709dbeb1b7073b432527fe31a53eb7b8124\" to \"75756863cfd4ded5796d83696cf13f5ebb1670d2\"",
    "created_at": "2015-07-03T09:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1230",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fce3c709dbeb1b7073b432527fe31a53eb7b8124" to "75756863cfd4ded5796d83696cf13f5ebb1670d2"



---

archive/issue_comments_001231.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-07-22T11:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_001232.json:
```json
{
    "body": "Changing commit from \"75756863cfd4ded5796d83696cf13f5ebb1670d2\" to \"b8fdeda84073d4c72e042cd64e68678e099d292e\"",
    "created_at": "2015-07-22T11:44:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "75756863cfd4ded5796d83696cf13f5ebb1670d2" to "b8fdeda84073d4c72e042cd64e68678e099d292e"



---

archive/issue_comments_001233.json:
```json
{
    "body": "<a id='comment:26'></a>The above version fixes `composite_fields()` to correctly solve #14164 and #18243.",
    "created_at": "2015-07-22T11:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1233",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:26'></a>The above version fixes `composite_fields()` to correctly solve #14164 and #18243.



---

archive/issue_comments_001234.json:
```json
{
    "body": "Changing commit from \"b8fdeda84073d4c72e042cd64e68678e099d292e\" to \"d1227146064d0e4ebcaf313f6eeec5c70713dde3\"",
    "created_at": "2015-08-21T07:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1234",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b8fdeda84073d4c72e042cd64e68678e099d292e" to "d1227146064d0e4ebcaf313f6eeec5c70713dde3"



---

archive/issue_comments_001235.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-21T07:50:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_001236.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-22T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1236",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_001237.json:
```json
{
    "body": "<a id='comment:28'></a>Something weird seems to be going on with factoring. This is \"normal\" behavior for a number field.\n\n```\nsage: F.<a> = NumberField(x^3+x+1)\nsage: F(2).factor()\n2\nsage: F(3).factor()\n(a^2 + a + 2) * (-a + 1)\nsage: (a^2 + a + 2).factor()\na^2 + a + 2\nsage: F.factor(3)\n(Fractional ideal (a^2 + a + 2)) * (Fractional ideal (-a + 1))\nsage: (-a+1).factor()\n-a + 1\n```\n\nThis is not.\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: F(2).factor()\n(-47*a^2 + 21*a - 93/2) * (-1/2*a^2 + 1/2*a)^2 * (1/2*a^2 + 1/2*a)\nsage: F.factor(2)\n(Fractional ideal (-1/2*a^2 + 1/2*a))^2 * (Fractional ideal (1/2*a^2 + 1/2*a))\nsage: (-47*a^2 + 21*a - 93/2).norm()\n-8192\nsage: (-47*a^2 + 21*a - 93/2).factor()\n(3718815975/16384*a^2 - 1336872061/16384*a + 7884913157/32768) * (-1/2*a^2 + 1/2*a)^14 * (1/2*a^2 + 1/2*a)^-1\nsage: (1/2*a^2 + 1/2*a).factor()\n(13/512*a^2 - 11/512*a - 7/256) * (-1/2*a^2 + 1/2*a)^-4\n```\n\nSomehow, it's not controlling primes over the leading coefficient properly...",
    "created_at": "2015-08-22T22:02:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1237",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

<a id='comment:28'></a>Something weird seems to be going on with factoring. This is "normal" behavior for a number field.

```
sage: F.<a> = NumberField(x^3+x+1)
sage: F(2).factor()
2
sage: F(3).factor()
(a^2 + a + 2) * (-a + 1)
sage: (a^2 + a + 2).factor()
a^2 + a + 2
sage: F.factor(3)
(Fractional ideal (a^2 + a + 2)) * (Fractional ideal (-a + 1))
sage: (-a+1).factor()
-a + 1
```

This is not.

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: F(2).factor()
(-47*a^2 + 21*a - 93/2) * (-1/2*a^2 + 1/2*a)^2 * (1/2*a^2 + 1/2*a)
sage: F.factor(2)
(Fractional ideal (-1/2*a^2 + 1/2*a))^2 * (Fractional ideal (1/2*a^2 + 1/2*a))
sage: (-47*a^2 + 21*a - 93/2).norm()
-8192
sage: (-47*a^2 + 21*a - 93/2).factor()
(3718815975/16384*a^2 - 1336872061/16384*a + 7884913157/32768) * (-1/2*a^2 + 1/2*a)^14 * (1/2*a^2 + 1/2*a)^-1
sage: (1/2*a^2 + 1/2*a).factor()
(13/512*a^2 - 11/512*a - 7/256) * (-1/2*a^2 + 1/2*a)^-4
```

Somehow, it's not controlling primes over the leading coefficient properly...



---

archive/issue_comments_001238.json:
```json
{
    "body": "<a id='comment:29'></a>The underlying problem seems to be converting PARI ideals in Hilbert normal form to Sage ideals:\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: Fp = F.pari_nf()\nsage: I = F.ideal(2)\nsage: Ip = I.pari_hnf()\nsage: fact = Fp.idealfactor(Ip)\nsage: Jp = fact[0, 0]\nsage: Fp.idealnorm(Jp)\n2\nsage: J = F.ideal(Jp)\nsage: J.norm()\n1/2             # should be 2, like Fp.idealnorm(Jp)\n```",
    "created_at": "2015-08-24T13:29:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1238",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:29'></a>The underlying problem seems to be converting PARI ideals in Hilbert normal form to Sage ideals:

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: Fp = F.pari_nf()
sage: I = F.ideal(2)
sage: Ip = I.pari_hnf()
sage: fact = Fp.idealfactor(Ip)
sage: Jp = fact[0, 0]
sage: Fp.idealnorm(Jp)
2
sage: J = F.ideal(Jp)
sage: J.norm()
1/2             # should be 2, like Fp.idealnorm(Jp)
```



---

archive/issue_comments_001239.json:
```json
{
    "body": "<a id='comment:30'></a>Actually the bug is in the conversion from PARI elements expressed on the integral basis:\n\n```\nsage: F.<a> = NumberField(2*x^3+x+1)\nsage: b = F.random_element()\nsage: F(F.pari_nf().nfalgtobasis(b)) == b\nFalse  # should be True\n```\nI'm working on a patch.",
    "created_at": "2015-08-24T16:41:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1239",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:30'></a>Actually the bug is in the conversion from PARI elements expressed on the integral basis:

```
sage: F.<a> = NumberField(2*x^3+x+1)
sage: b = F.random_element()
sage: F(F.pari_nf().nfalgtobasis(b)) == b
False  # should be True
```
I'm working on a patch.



---

archive/issue_comments_001240.json:
```json
{
    "body": "Changing commit from \"d1227146064d0e4ebcaf313f6eeec5c70713dde3\" to \"fd2743f092ecbffd79f49dc6cd18552631c407db\"",
    "created_at": "2015-08-24T17:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1240",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d1227146064d0e4ebcaf313f6eeec5c70713dde3" to "fd2743f092ecbffd79f49dc6cd18552631c407db"



---

archive/issue_comments_001241.json:
```json
{
    "body": "<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-24T17:16:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1241",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_001242.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-24T17:17:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1242",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_001243.json:
```json
{
    "body": "<a id='comment:33'></a>Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.",
    "created_at": "2015-08-24T17:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1243",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

<a id='comment:33'></a>Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.



---

archive/issue_comments_001244.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-24T17:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1244",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_001245.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-25T11:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1245",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_001246.json:
```json
{
    "body": "Changing commit from \"fd2743f092ecbffd79f49dc6cd18552631c407db\" to \"d4660f119eb45da3d9520b5f3b598ca5a6753906\"",
    "created_at": "2015-08-25T11:38:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1246",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fd2743f092ecbffd79f49dc6cd18552631c407db" to "d4660f119eb45da3d9520b5f3b598ca5a6753906"



---

archive/issue_comments_001247.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-25T11:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1247",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_001248.json:
```json
{
    "body": "Changing commit from \"d4660f119eb45da3d9520b5f3b598ca5a6753906\" to \"8b86c525a43dcfbab01224e3416722a1b29a9880\"",
    "created_at": "2015-08-25T11:40:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1248",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d4660f119eb45da3d9520b5f3b598ca5a6753906" to "8b86c525a43dcfbab01224e3416722a1b29a9880"



---

archive/issue_comments_001249.json:
```json
{
    "body": "<a id='comment:36'></a>Replying to [comment:33 kartikv]:\n> Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.\n\nThanks for your comments.  If you approve of the new examples you can set this to positive review (and remember to fill in your [real] name as reviewer).",
    "created_at": "2015-08-25T11:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1249",
    "user": "https://github.com/pjbruin"
}
```

<a id='comment:36'></a>Replying to [comment:33 kartikv]:
> Positive review. I think there should probably be an example in the docstring to NumberField that demonstrates/tests this functionality (since it has been missing for so long), but otherwise ready to submit. You're welcome to use my example or any of yours from deeper in the number field code.

Thanks for your comments.  If you approve of the new examples you can set this to positive review (and remember to fill in your [real] name as reviewer).



---

archive/issue_comments_001250.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-25T11:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1250",
    "user": "https://github.com/pjbruin"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_001251.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kartik Venkatram\"",
    "created_at": "2015-08-25T13:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1251",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

Changing reviewer from "" to "Kartik Venkatram"



---

archive/issue_comments_001252.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-25T13:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1252",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_001253.json:
```json
{
    "body": "<a id='comment:37'></a>Perfect.",
    "created_at": "2015-08-25T13:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1253",
    "user": "https://trac.sagemath.org/admin/accounts/users/kartikv"
}
```

<a id='comment:37'></a>Perfect.



---

archive/issue_events_000538.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-08-26T03:00:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/252#event-538"
}
```



---

archive/issue_comments_001254.json:
```json
{
    "body": "Changing branch from \"u/pbruin/252-number_fields\" to \"8b86c525a43dcfbab01224e3416722a1b29a9880\"",
    "created_at": "2015-08-26T03:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1254",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/pbruin/252-number_fields" to "8b86c525a43dcfbab01224e3416722a1b29a9880"



---

archive/issue_comments_001255.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-08-26T03:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/252",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/252#issuecomment-1255",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
