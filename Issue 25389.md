# Issue 25389: intergrate with giac returns undef

archive/issues_025389.json:
```json
{
    "body": "CC:  @frederichan-IMJPRG parisse @rwst @slel\n\nKeywords: giac\n\nIs this a known issue?  Using sage 8.3 beta 6.\n\n\n\n```\n    sage: var('t')\n    sage: integrate(exp(t)/(t + 1)^2,t,algorithm=\"giac\")\n    undef\n\n```\n\n\nBut using `giac` directly, it can integrate it with no problem\n\n\n\n```\n    >giac\n    // Using locale /usr/share/locale/\n    // en_US.utf8\n    // /usr/share/locale/\n    // giac\n    // UTF-8\n    // Maximum number of parallel threads 8\n    Help file /usr/share/giac/doc/en/aide_cas not found\n    Added 26 synonyms\n    Welcome to giac readline interface\n    (c) 2001,2017 B. Parisse & others\n    Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html\n    Released under the GPL license 3.0 or above\n    See http://www.gnu.org for license details\n    May contain BSD licensed software parts (lapack, atlas, tinymt)\n    -------------------------------------------------\n     0>> integrate(exp(t)/(t + 1)^2,t)\n     (t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))\n    // Time 0.01\n    1>> \n\n```\n\n\nSo why did `sage` return `udef` for this result?\n\nFirst time reporting bug to sage. I do not know what all the options to select from the menu below. Feel free to change as needed.\n\nThank you,\n\n--Nasser\n\nIssue created by migration from https://trac.sagemath.org/ticket/25626\n\n",
    "created_at": "2018-06-21T11:05:14Z",
    "labels": [
        "interfaces",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.7",
    "title": "intergrate with giac returns undef",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25389",
    "user": "@nasser1"
}
```
CC:  @frederichan-IMJPRG parisse @rwst @slel

Keywords: giac

Is this a known issue?  Using sage 8.3 beta 6.



```
    sage: var('t')
    sage: integrate(exp(t)/(t + 1)^2,t,algorithm="giac")
    undef

```


But using `giac` directly, it can integrate it with no problem



```
    >giac
    // Using locale /usr/share/locale/
    // en_US.utf8
    // /usr/share/locale/
    // giac
    // UTF-8
    // Maximum number of parallel threads 8
    Help file /usr/share/giac/doc/en/aide_cas not found
    Added 26 synonyms
    Welcome to giac readline interface
    (c) 2001,2017 B. Parisse & others
    Homepage http://www-fourier.ujf-grenoble.fr/~parisse/giac.html
    Released under the GPL license 3.0 or above
    See http://www.gnu.org for license details
    May contain BSD licensed software parts (lapack, atlas, tinymt)
    -------------------------------------------------
     0>> integrate(exp(t)/(t + 1)^2,t)
     (t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))
    // Time 0.01
    1>> 

```


So why did `sage` return `udef` for this result?

First time reporting bug to sage. I do not know what all the options to select from the menu below. Feel free to change as needed.

Thank you,

--Nasser

Issue created by migration from https://trac.sagemath.org/ticket/25626





---

archive/issue_comments_357977.json:
```json
{
    "body": "Regarding the bug: maybe the `Ei` in the result could not be converted to Sage?\n\nRegarding the Trac ticket: not sure if this belongs to \"interfaces\" or \"symbolics\".\n\nWas this fixed in another ticket? This is what I get with Sage 8.3.rc3:\n\n```\nsage: version()\n'SageMath version 8.3.rc3, Release Date: 2018-07-28'\nsage: t = SR.var('t')\nsage: integrate(exp(t)/(t + 1)^2, t, algorithm=\"giac\")\nintegrate(e^t/(t + 1)^2, t)\n```\n",
    "created_at": "2018-09-19T16:18:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357977",
    "user": "@slel"
}
```

Regarding the bug: maybe the `Ei` in the result could not be converted to Sage?

Regarding the Trac ticket: not sure if this belongs to "interfaces" or "symbolics".

Was this fixed in another ticket? This is what I get with Sage 8.3.rc3:

```
sage: version()
'SageMath version 8.3.rc3, Release Date: 2018-07-28'
sage: t = SR.var('t')
sage: integrate(exp(t)/(t + 1)^2, t, algorithm="giac")
integrate(e^t/(t + 1)^2, t)
```




---

archive/issue_comments_357978.json:
```json
{
    "body": "Oh, I see, instead of `undef` I got the unevaluated integral back.\n\nSlightly better than `undef`, but if Giac can compute it we would like to get the evaluated result.",
    "created_at": "2018-09-19T16:21:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357978",
    "user": "@slel"
}
```

Oh, I see, instead of `undef` I got the unevaluated integral back.

Slightly better than `undef`, but if Giac can compute it we would like to get the evaluated result.



---

archive/issue_comments_357979.json:
```json
{
    "body": "Giac does the following\n\n```\ngiac: integrate(exp(t)*(t+1)^-2,t)                                              \nintegrate(exp(1/(t+1)^-1-1)*(t+1)^-2,t)\ngiac: integrate(exp(t)/(t+1)^2,t)                                               \n(t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))\n```\n",
    "created_at": "2020-08-17T07:16:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357979",
    "user": "@fchapoton"
}
```

Giac does the following

```
giac: integrate(exp(t)*(t+1)^-2,t)                                              
integrate(exp(1/(t+1)^-1-1)*(t+1)^-2,t)
giac: integrate(exp(t)/(t+1)^2,t)                                               
(t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))
```




---

archive/issue_comments_357980.json:
```json
{
    "body": "NB: it seems that it is not giac himself that is changing the quotient to a product but the conversion filter called before using giac:\n\n```\nsage: t=var('t')                                                                                              \nsage: F=exp(t)/(1+t)^2                                                                                        \nsage: giac(F)                                                                                                 \n(t+1)^-2*exp(t)\nsage: giac(str(F))                                                                                            \nexp(t)/(t+1)^2\nsage: giac(str(F)).integrate(t)                                                                               \n(t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))\n```\n",
    "created_at": "2020-08-17T10:48:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357980",
    "user": "@frederichan-IMJPRG"
}
```

NB: it seems that it is not giac himself that is changing the quotient to a product but the conversion filter called before using giac:

```
sage: t=var('t')                                                                                              
sage: F=exp(t)/(1+t)^2                                                                                        
sage: giac(F)                                                                                                 
(t+1)^-2*exp(t)
sage: giac(str(F))                                                                                            
exp(t)/(t+1)^2
sage: giac(str(F)).integrate(t)                                                                               
(t*Ei(t+1)+Ei(t+1)-exp(1)*exp(t))/(t*exp(1)+exp(1))
```




---

archive/issue_comments_357981.json:
```json
{
    "body": "Well, the expression itself is not considered as a quotient in sage:\n\n```\nsage: t = SR.var('t')                                                           \nsage: F = exp(t)/(t + 1)^2                                                      \nsage: F.operands()                                                              \n[(t + 1)^(-2), e^t]\nsage: F.operator()                                                              \n<function mul_vararg at 0x7f4b14362310>\n```\n",
    "created_at": "2020-12-13T09:22:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357981",
    "user": "@fchapoton"
}
```

Well, the expression itself is not considered as a quotient in sage:

```
sage: t = SR.var('t')                                                           
sage: F = exp(t)/(t + 1)^2                                                      
sage: F.operands()                                                              
[(t + 1)^(-2), e^t]
sage: F.operator()                                                              
<function mul_vararg at 0x7f4b14362310>
```




---

archive/issue_comments_357982.json:
```json
{
    "body": "I don't think Sage's symbolic expressions are ever\nrecorded as differences or quotients, only as sums\n(summing the opposite for a difference) and products\n(multiplying by the inverse for a quotient).",
    "created_at": "2020-12-13T14:44:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357982",
    "user": "@slel"
}
```

I don't think Sage's symbolic expressions are ever
recorded as differences or quotients, only as sums
(summing the opposite for a difference) and products
(multiplying by the inverse for a quotient).



---

archive/issue_comments_357983.json:
```json
{
    "body": "In Sage 9.3.rc0:\n\n```\nsage: t = SR.var('t')\nsage: integrate(exp(t)/(t + 1)^2, t, algorithm=\"giac\")\n(t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)\n```\n\n\nProbably one of the `giac` or `giacpy_sage` upgrades solved that.\n\nShould we add a doctest?",
    "created_at": "2021-03-27T15:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357983",
    "user": "@slel"
}
```

In Sage 9.3.rc0:

```
sage: t = SR.var('t')
sage: integrate(exp(t)/(t + 1)^2, t, algorithm="giac")
(t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)
```


Probably one of the `giac` or `giacpy_sage` upgrades solved that.

Should we add a doctest?



---

archive/issue_comments_357984.json:
```json
{
    "body": "Changing keywords from \"giac\" to \"giac, beginner\".",
    "created_at": "2021-03-27T15:25:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357984",
    "user": "@slel"
}
```

Changing keywords from "giac" to "giac, beginner".



---

archive/issue_comments_357985.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357985",
    "user": "@mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_357986.json:
```json
{
    "body": "Changing keywords from \"giac, beginner\" to \"giac, beginner, integral\".",
    "created_at": "2021-12-21T10:51:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357986",
    "user": "@fchapoton"
}
```

Changing keywords from "giac, beginner" to "giac, beginner, integral".



---

archive/issue_comments_357987.json:
```json
{
    "body": "New commits:",
    "created_at": "2022-04-19T02:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357987",
    "user": "@Rajat-Sirohi"
}
```

New commits:



---

archive/issue_comments_357988.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-04-19T02:44:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357988",
    "user": "@Rajat-Sirohi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_357989.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-04-19T05:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357989",
    "user": "@kwankyu"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_357990.json:
```json
{
    "body": "Perfect.",
    "created_at": "2022-04-19T05:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357990",
    "user": "@kwankyu"
}
```

Perfect.



---

archive/issue_comments_357991.json:
```json
{
    "body": "Well, with giac 1.9 which has just been allowed from the system I get\n\n```\nsage -t --long --random-seed=138683552333987748337622634611718883378 /usr/lib/python3.10/site-packages/sage/calculus/calculus.py\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/calculus/calculus.py\", line 387, in sage.calculus.calculus\nFailed example:\n    integrate(exp(t)/(t + 1)^2, t, algorithm=\"giac\")\nExpected:\n    (t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)\nGot:\n    ((t + 1)*(1/(t + 1) - 1)*Ei(-(t + 1)*(1/(t + 1) - 1) + 1) - Ei(-(t + 1)*(1/(t + 1) - 1) + 1) + e^(-(t + 1)*(1/(t + 1) - 1) + 1))/((t + 1)*(1/(t + 1) - 1)*e - e)\n```\n\nI haven't really checked whether it can be simplified to the previous form or not.",
    "created_at": "2022-05-24T09:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357991",
    "user": "@kiwifb"
}
```

Well, with giac 1.9 which has just been allowed from the system I get

```
sage -t --long --random-seed=138683552333987748337622634611718883378 /usr/lib/python3.10/site-packages/sage/calculus/calculus.py
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/calculus/calculus.py", line 387, in sage.calculus.calculus
Failed example:
    integrate(exp(t)/(t + 1)^2, t, algorithm="giac")
Expected:
    (t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)
Got:
    ((t + 1)*(1/(t + 1) - 1)*Ei(-(t + 1)*(1/(t + 1) - 1) + 1) - Ei(-(t + 1)*(1/(t + 1) - 1) + 1) + e^(-(t + 1)*(1/(t + 1) - 1) + 1))/((t + 1)*(1/(t + 1) - 1)*e - e)
```

I haven't really checked whether it can be simplified to the previous form or not.



---

archive/issue_comments_357992.json:
```json
{
    "body": "Replying to [comment:19 fbissey]:\n> Well, with giac 1.9 which has just been allowed from the system I get\n> {{{\n> sage -t --long --random-seed=138683552333987748337622634611718883378 /usr/lib/python3.10/site-packages/sage/calculus/calculus.py\n> **********************************************************************\n> File \"/usr/lib/python3.10/site-packages/sage/calculus/calculus.py\", line 387, in sage.calculus.calculus\n> Failed example:\n>     integrate(exp(t)/(t + 1)^2, t, algorithm=\"giac\")\n> Expected:\n>     (t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)\n> Got:\n>     ((t + 1)*(1/(t + 1) - 1)*Ei(-(t + 1)*(1/(t + 1) - 1) + 1) - Ei(-(t + 1)*(1/(t + 1) - 1) + 1) + e^(-(t + 1)*(1/(t + 1) - 1) + 1))/((t + 1)*(1/(t + 1) - 1)*e - e)\n> }}}\n> I haven't really checked whether it can be simplified to the previous form or not.\nIn fact, when you simplify the second expression, it is indeed equivalent to the first.",
    "created_at": "2022-05-24T10:18:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357992",
    "user": "@Rajat-Sirohi"
}
```

Replying to [comment:19 fbissey]:
> Well, with giac 1.9 which has just been allowed from the system I get
> {{{
> sage -t --long --random-seed=138683552333987748337622634611718883378 /usr/lib/python3.10/site-packages/sage/calculus/calculus.py
> **********************************************************************
> File "/usr/lib/python3.10/site-packages/sage/calculus/calculus.py", line 387, in sage.calculus.calculus
> Failed example:
>     integrate(exp(t)/(t + 1)^2, t, algorithm="giac")
> Expected:
>     (t*Ei(t + 1) + Ei(t + 1) - e^(t + 1))/(t*e + e)
> Got:
>     ((t + 1)*(1/(t + 1) - 1)*Ei(-(t + 1)*(1/(t + 1) - 1) + 1) - Ei(-(t + 1)*(1/(t + 1) - 1) + 1) + e^(-(t + 1)*(1/(t + 1) - 1) + 1))/((t + 1)*(1/(t + 1) - 1)*e - e)
> }}}
> I haven't really checked whether it can be simplified to the previous form or not.
In fact, when you simplify the second expression, it is indeed equivalent to the first.



---

archive/issue_comments_357993.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-05-24T22:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357993",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_357994.json:
```json
{
    "body": "Follow up at #34037",
    "created_at": "2022-06-21T01:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25389",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25389#issuecomment-357994",
    "user": "@kiwifb"
}
```

Follow up at #34037
