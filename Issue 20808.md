# Issue 20808: Implement Zariski-VanKampen method to compute fundamental groups of complements of plane curves.

archive/issues_020808.json:
```json
{
    "body": "CC:  gjorgenson @bhutz caravantes @tscrim\n\nThis ticket implements the computation of the fundamental group of the complement of a plane (affine or projective) curve over the rationals or number fields with an embedding in QQbar (in theory it could be done for more general fields, but most likely wouldn't be practical).\n\nIt relies on the SIROCCO library [1] that performs a certified root continuation method specifically tailored for this task.\n\nIssue created by migration from https://trac.sagemath.org/ticket/21045\n\n",
    "created_at": "2016-07-18T08:42:37Z",
    "labels": [
        "component: algebraic geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Implement Zariski-VanKampen method to compute fundamental groups of complements of plane curves.",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20808",
    "user": "https://github.com/miguelmarco"
}
```
CC:  gjorgenson @bhutz caravantes @tscrim

This ticket implements the computation of the fundamental group of the complement of a plane (affine or projective) curve over the rationals or number fields with an embedding in QQbar (in theory it could be done for more general fields, but most likely wouldn't be practical).

It relies on the SIROCCO library [1] that performs a certified root continuation method specifically tailored for this task.

Issue created by migration from https://trac.sagemath.org/ticket/21045





---

archive/issue_comments_287155.json:
```json
{
    "body": "Attachment [libsirocco-1.1.tar.gz](tarball://root/attachments/some-uuid/ticket21045/libsirocco-1.1.tar.gz) by @miguelmarco created at 2016-07-18 08:43:04\n\nThe sirocco library.",
    "created_at": "2016-07-18T08:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287155",
    "user": "https://github.com/miguelmarco"
}
```

Attachment [libsirocco-1.1.tar.gz](tarball://root/attachments/some-uuid/ticket21045/libsirocco-1.1.tar.gz) by @miguelmarco created at 2016-07-18 08:43:04

The sirocco library.



---

archive/issue_comments_287156.json:
```json
{
    "body": "Add link to Sirocco library in ticket description.",
    "created_at": "2016-07-18T09:07:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287156",
    "user": "https://github.com/slel"
}
```

Add link to Sirocco library in ticket description.



---

archive/issue_comments_287157.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-07-19T15:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287157",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_287158.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-07-19T15:11:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287158",
    "user": "https://github.com/miguelmarco"
}
```

New commits:



---

archive/issue_comments_287159.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-01-12T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287159",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_287160.json:
```json
{
    "body": "This does no longer merge with current sage releases.",
    "created_at": "2017-01-12T06:48:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287160",
    "user": "https://github.com/cheuberg"
}
```

This does no longer merge with current sage releases.



---

archive/issue_comments_287161.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-07T23:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287162.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-04-08T19:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287162",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_287163.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2017-04-08T19:01:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287163",
    "user": "https://github.com/miguelmarco"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_287164.json:
```json
{
    "body": "I think it is ready for review.\n\nNote that in order for the functionality to be available, the package sirocco 2 must be installed. The tarball must be downloaded and copied to the upstream directory.\n\nNote also that currently the file name must be corrected (there is a superfluous underscore). I asked the webmaster to correct it.",
    "created_at": "2017-04-08T19:03:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287164",
    "user": "https://github.com/miguelmarco"
}
```

I think it is ready for review.

Note that in order for the functionality to be available, the package sirocco 2 must be installed. The tarball must be downloaded and copied to the upstream directory.

Note also that currently the file name must be corrected (there is a superfluous underscore). I asked the webmaster to correct it.



---

archive/issue_comments_287165.json:
```json
{
    "body": "The quick comments:\n\n- For bullet points, you need to format them as:\n  {{{\n- a really long line continues\n  at the same starting point\n  }}}\n- Is there a reason why `contpath_mp` and `contpath` are not `cpdef`? Subsequently, they could have a specified return type? For `contpath_mp`, you could fill in the list in a second for loop to avoid the list comprehension.\n- For `contpath`, do you want to force input types?\n- Error messages should start with a lower case.\n- Do you want to make zariski_vankampen.py a Cython file for speed?\n- You don't need to do this `j = <int>i`; the `range` will give you `int`, especially if you `cdef int i`.\n- `res` does not seem to be used in `contpath_mp`.\n- I think there are better ways to construct a new (unset) `RealField` (in `contpath_mp`), but I don't remember how to do so offhand. You should also create the parent outside of the for loop.\n- `fundamental_group` appears twice in `affine_curve.py`.",
    "created_at": "2017-04-08T20:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287165",
    "user": "https://github.com/tscrim"
}
```

The quick comments:

- For bullet points, you need to format them as:
  {{{
- a really long line continues
  at the same starting point
  }}}
- Is there a reason why `contpath_mp` and `contpath` are not `cpdef`? Subsequently, they could have a specified return type? For `contpath_mp`, you could fill in the list in a second for loop to avoid the list comprehension.
- For `contpath`, do you want to force input types?
- Error messages should start with a lower case.
- Do you want to make zariski_vankampen.py a Cython file for speed?
- You don't need to do this `j = <int>i`; the `range` will give you `int`, especially if you `cdef int i`.
- `res` does not seem to be used in `contpath_mp`.
- I think there are better ways to construct a new (unset) `RealField` (in `contpath_mp`), but I don't remember how to do so offhand. You should also create the parent outside of the for loop.
- `fundamental_group` appears twice in `affine_curve.py`.



---

archive/issue_comments_287166.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-09T17:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287166",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287167.json:
```json
{
    "body": "Thanks for the review.\n\nReplying to [comment:8 tscrim]:\n> The quick comments:\n> \n> - For bullet points, you need to format them as:\n>   {{{\n> - a really long line continues\n>   at the same starting point\n>   }}}\n\nFixed (I think I didn't miss anyone).\n\n> - Is there a reason why `contpath_mp` and `contpath` are not `cpdef`? Subsequently, they could have a specified return type? For `contpath_mp`, you could fill in the list in a second for loop to avoid the list comprehension.\n\nThere is a reason for that: I didn't know about cpdef until now. \n\nAbout the return type, it should be list[list[RealNumber]], but that doesn't seem to work. list[list] works though.\n\nWhat is exactly the problem with list comprehension?\n\n> - For `contpath`, do you want to force input types?\n\nDone, but I don't see any advantage in doing so. If there is a speedup, it is negligible.\n\n> - Error messages should start with a lower case.\n\nFixed.\n\n\n> - Do you want to make zariski_vankampen.py a Cython file for speed?\n\nI tried it, but got some error messages related to the use of parallel functions.\n\nAnyways, I don't expect a significant speedup by compiling it: the bottlenecks are calls to external functions (mainly discriminant computation and contpath calls). The only part that could benefit from compilation is the braid reconstruction from the piecewise linear paths, but my experience shows that this time is very small compared to the computation of the paths themselves.\n\nI could try to cythonize it, but would need some help.\n\n> - You don't need to do this `j = <int>i`; the `range` will give you `int`, especially if you `cdef int i`.\n\nFixed.\n\n> - `res` does not seem to be used in `contpath_mp`.\n\nFixed.\n\n> - I think there are better ways to construct a new (unset) `RealField` (in `contpath_mp`), but I don't remember how to do so offhand. You should also create the parent outside of the for loop.\n\nI tried several ways and this was the one that worked. If you remember a better way, please let me know.\n\n> - `fundamental_group` appears twice in `affine_curve.py`.\n\nFixed.",
    "created_at": "2017-04-09T17:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287167",
    "user": "https://github.com/miguelmarco"
}
```

Thanks for the review.

Replying to [comment:8 tscrim]:
> The quick comments:
> 
> - For bullet points, you need to format them as:
>   {{{
> - a really long line continues
>   at the same starting point
>   }}}

Fixed (I think I didn't miss anyone).

> - Is there a reason why `contpath_mp` and `contpath` are not `cpdef`? Subsequently, they could have a specified return type? For `contpath_mp`, you could fill in the list in a second for loop to avoid the list comprehension.

There is a reason for that: I didn't know about cpdef until now. 

About the return type, it should be list[list[RealNumber]], but that doesn't seem to work. list[list] works though.

What is exactly the problem with list comprehension?

> - For `contpath`, do you want to force input types?

Done, but I don't see any advantage in doing so. If there is a speedup, it is negligible.

> - Error messages should start with a lower case.

Fixed.


> - Do you want to make zariski_vankampen.py a Cython file for speed?

I tried it, but got some error messages related to the use of parallel functions.

Anyways, I don't expect a significant speedup by compiling it: the bottlenecks are calls to external functions (mainly discriminant computation and contpath calls). The only part that could benefit from compilation is the braid reconstruction from the piecewise linear paths, but my experience shows that this time is very small compared to the computation of the paths themselves.

I could try to cythonize it, but would need some help.

> - You don't need to do this `j = <int>i`; the `range` will give you `int`, especially if you `cdef int i`.

Fixed.

> - `res` does not seem to be used in `contpath_mp`.

Fixed.

> - I think there are better ways to construct a new (unset) `RealField` (in `contpath_mp`), but I don't remember how to do so offhand. You should also create the parent outside of the for loop.

I tried several ways and this was the one that worked. If you remember a better way, please let me know.

> - `fundamental_group` appears twice in `affine_curve.py`.

Fixed.



---

archive/issue_comments_287168.json:
```json
{
    "body": "I can do a first attempt at cythonizing. Do you have a good test case that is not too slow nor too fast to do profiling on to see where the current bottlenecks are?\n\nThe reason I bring up the list comprehension is Cython cannot handle them in c(p)def (maybe just cpdef) functions.",
    "created_at": "2017-04-10T00:35:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287168",
    "user": "https://github.com/tscrim"
}
```

I can do a first attempt at cythonizing. Do you have a good test case that is not too slow nor too fast to do profiling on to see where the current bottlenecks are?

The reason I bring up the list comprehension is Cython cannot handle them in c(p)def (maybe just cpdef) functions.



---

archive/issue_comments_287169.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-10T17:39:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287169",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287170.json:
```json
{
    "body": "I fixed some doctest and a bug that prevented it to work when the variables where not x and y.\n\nAbout nontrivial examples to test, here are two:\n\nThis one is a good example of the power of sirocco: this group is computed in a few seconds, and as far as I know, it has never been computed before (even though the curve has been explicitely studied)\n\n\n```\nsage: F = NumberField(QQ[x]('x^2+1'), 'I', embedding = QQbar(I))\nsage: F.inject_variables()\nDefining I\nsage: P.<x,y,z> = ProjectiveSpace(F,2)\nsage: c = P.curve((4131/160000*I + 20493/640000)*x^4*y^2 + (-21883/240000*I - 243083/4320000)*x^3*y^3 + (4301/60000*I + 22393/1440000)*x^2*y^4 + (-729/50000*I - 145071/1600000)*x^4*y*z + (4391/400000*I + 92699/800000)*x^3*y^2*z + (20251/100000*I + 50513/900000)*x^2*y^3*z + (-4301/18750*I - 22393/450000)*x*y^4*z + (-72171/4000000*I + 767637/16000000)*x^4*z^2 + (121131/1000000*I + 147717/1000000)*x^3*y*z^2 + (-42633/125000*I - 169493/375000)*x^2*y^2*z^2 + (6341/62500*I + 97183/562500)*x*y^3*z^2 + (8602/46875*I + 22393/562500)*y^4*z^2 + (1323/250000*I - 167481/1000000)*x^3*z^3 + (-3621/62500*I + 47037/250000)*x^2*y*z^3 + (5189/15625*I + 24559/125000)*x*y^2*z^3 + (-14404/46875*I - 80002/421875)*y^3*z^3 + (189/5000*I + 81/625)*x^2*z^4 + (-177/1250*I - 339/1250)*x*y*z^4 + (68/625*I + 253/1875)*y^2*z^4)\nsage: c.fundamental_group()\nFinitely presented group < x2, x56 | x2^-1*x56*(x2^-1*x56^-1)^3*x2*x56*x2^-1*x56^-1, (x56^-1*x2^-1)^2*x56*x2*x56^2*x2^-1*x56^-1*x2*x56*x2*x56^-1, x56^-1*x2^-1*(x56*x2)^2*x56^-1*x2^-1*x56^-1*x2*x56^2*x2*x56^-1*x2^-1*x56^-1 >\n\n```\n\n\nThis other one takes a couple of minutes in my laptop. It was the motivation for the writing of GAP3's VKCURVE package (which computes it in almost half an hour in the same computer):\n\n\n```\nsage: A.<x,y> = AffineSpace(QQ,2)\nsage: c = A.curve(746496+3732480*x-3111936*x*y^2-93281756/27*x*y^4+58341596/27*x*y^6+7464960*x^2-384*y^2-9334272*x^2*y^2    +17556484/27*x^2*y^4+43196/27*x^2*y^6+7464576*x^3-756138248/81*x^3*y^2+192792964/81*x^3*y^4+16/81*x^3*y^6+3730944*x^4   -139967996/81*y^4-84021416/27*x^4*y^2+82088/27*x^4*y^4+744192*x^5+43192/27*x^5*y^2-1720/27*x^5*y^4 -124412/81*x^6   +777600800*y^6+95896/81*x^6*y^2-8/81*x^6*y^4-10364/27*x^7-4/27*x^7*y^2+4/27*x^8-8/81*y^8-4/27*x^8*y^2+4/81*x^9)\nFinitely presented group < x0, x21, x29, x41, x54 | x29^-1*x54^-1*x29*x54*x29*x54^-1, x41^-1*x29*x41*x29*x41^-1*x29^-1, x29^-1*x0*x29*x0*x29^-1*x0^-1, x21*x29*x21^-1*x29^-1*x21^-1*x29, x41^-1*x0^-1*x41^-1*x0*x41*x0, x54^-1*x21^-1*x54^-1*x21*x54*x21, x41*x21*x41^-1*x21^-1*x41^-1*x21, x21*x0*x21*x0^-1*x21^-1*x0^-1, x41*x54*x41*x54^-1*x41^-1*x54^-1, x54^-1*x0^-1*x54^-1*x0*x54*x0, x41*x21*x29*x21^-1*x41^-1*x21*x29^-1*x21^-1, x41*x54*x41^-1*x29*x54^-1*x41^-1*x54*x29^-1, x21^-1*x0*x54*x0^-1*x21*x0*x54^-1*x0^-1, x0^-1*x41*x21*x41^-1*x0*x41*x21^-1*x41^-1, x21^-1*x0*x41*x0^-1*x21*x0*x41^-1*x0^-1, x21^-1*x54^-1*x0*x54*x21*x54^-1*x0^-1*x54, x29^-1*x54^-1*x0^-1*x54*x29*x54^-1*x0*x54, x29^-1*x0*x54*x0^-1*x29*x0*x54^-1*x0^-1, x29*x0^2*x29^-1*x54^-1*x29*x0^-2*x29^-1*x54, x29^-1*x41*x54*x21*x41^-1*x29*x41*x21^-1*x54^-1*x41^-1, x0*x54^-1*x41*x54*x0^-1*x29^-1*x21^-1*x54^-1*x41^-1*x54*x21*x29, x29^-1*x21^-1*x29*x0*x41*x54*x21*x29*x21^-1*x54^-1*x41^-1*x0^-1, x41^-1*x0^-1*x21*x29*x0*x41*x54*x21*x0^-1*x29^-1*x21^-1*x54^-1, x0^-1*x29^-1*x21*x54^-1*x29*x0*x29*x41*x54*x21^-1*x29*x41^-1*x54^-1*x41^-1, x41^-1*x54^-1*x29*x0^-1*x41*x54*x21*x29*x21*x41^-1*x0*x29^-1*x21^-1*x54^-1, x21^-1*x54^-1*x29*x21^-1*x41^-1*x0*x41*x54*x0*x41^-1*x0^-1*x21*x29^-1*x54, x54*x21*x29*x0*x29^-1*x54*x21^-1*x54^-1*x41^-1*x0^-1*x29^-1*x0*x41*x21^-1, x41*x54*x21*x29*x0*x21^-1*x29*x41*x21*x29^2*x21*x29^-1*x21^-1*x41^-2*x0^-1*x29^-1*x21^-1*x54^-1*x41^-1*x21^-1, x29*x21^-1*x0*x54^2*x41*x54*x21*x0*x29^-1*x41*x0^-1*x21^-1*x0^-2*x54^-1*x41^-1*x0^-1*x29^-1*x21^-1*x29*x0^-1*x21^2, x29*x41^-1*x0*x41*(x21*x54)^2*x0*x54*x21*x0*x29^-1*x21^-1*x41*x54^-1*x41^-1*x29^-1*(x29^-1*x0^-1)^2*x29^-1*x54^-1*x0^-1*x21 >\n\n```\n\n\nI did some tests cythonizing some of the functions in `zariski_vankampen.py`, and I could not observe any speedup at all. I don't think it will be worth the effort.\n\nAre you sure about the list comprehension problem? It seems to work fine in this cpdef'ed function.",
    "created_at": "2017-04-10T17:59:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287170",
    "user": "https://github.com/miguelmarco"
}
```

I fixed some doctest and a bug that prevented it to work when the variables where not x and y.

About nontrivial examples to test, here are two:

This one is a good example of the power of sirocco: this group is computed in a few seconds, and as far as I know, it has never been computed before (even though the curve has been explicitely studied)


```
sage: F = NumberField(QQ[x]('x^2+1'), 'I', embedding = QQbar(I))
sage: F.inject_variables()
Defining I
sage: P.<x,y,z> = ProjectiveSpace(F,2)
sage: c = P.curve((4131/160000*I + 20493/640000)*x^4*y^2 + (-21883/240000*I - 243083/4320000)*x^3*y^3 + (4301/60000*I + 22393/1440000)*x^2*y^4 + (-729/50000*I - 145071/1600000)*x^4*y*z + (4391/400000*I + 92699/800000)*x^3*y^2*z + (20251/100000*I + 50513/900000)*x^2*y^3*z + (-4301/18750*I - 22393/450000)*x*y^4*z + (-72171/4000000*I + 767637/16000000)*x^4*z^2 + (121131/1000000*I + 147717/1000000)*x^3*y*z^2 + (-42633/125000*I - 169493/375000)*x^2*y^2*z^2 + (6341/62500*I + 97183/562500)*x*y^3*z^2 + (8602/46875*I + 22393/562500)*y^4*z^2 + (1323/250000*I - 167481/1000000)*x^3*z^3 + (-3621/62500*I + 47037/250000)*x^2*y*z^3 + (5189/15625*I + 24559/125000)*x*y^2*z^3 + (-14404/46875*I - 80002/421875)*y^3*z^3 + (189/5000*I + 81/625)*x^2*z^4 + (-177/1250*I - 339/1250)*x*y*z^4 + (68/625*I + 253/1875)*y^2*z^4)
sage: c.fundamental_group()
Finitely presented group < x2, x56 | x2^-1*x56*(x2^-1*x56^-1)^3*x2*x56*x2^-1*x56^-1, (x56^-1*x2^-1)^2*x56*x2*x56^2*x2^-1*x56^-1*x2*x56*x2*x56^-1, x56^-1*x2^-1*(x56*x2)^2*x56^-1*x2^-1*x56^-1*x2*x56^2*x2*x56^-1*x2^-1*x56^-1 >

```


This other one takes a couple of minutes in my laptop. It was the motivation for the writing of GAP3's VKCURVE package (which computes it in almost half an hour in the same computer):


```
sage: A.<x,y> = AffineSpace(QQ,2)
sage: c = A.curve(746496+3732480*x-3111936*x*y^2-93281756/27*x*y^4+58341596/27*x*y^6+7464960*x^2-384*y^2-9334272*x^2*y^2    +17556484/27*x^2*y^4+43196/27*x^2*y^6+7464576*x^3-756138248/81*x^3*y^2+192792964/81*x^3*y^4+16/81*x^3*y^6+3730944*x^4   -139967996/81*y^4-84021416/27*x^4*y^2+82088/27*x^4*y^4+744192*x^5+43192/27*x^5*y^2-1720/27*x^5*y^4 -124412/81*x^6   +777600800*y^6+95896/81*x^6*y^2-8/81*x^6*y^4-10364/27*x^7-4/27*x^7*y^2+4/27*x^8-8/81*y^8-4/27*x^8*y^2+4/81*x^9)
Finitely presented group < x0, x21, x29, x41, x54 | x29^-1*x54^-1*x29*x54*x29*x54^-1, x41^-1*x29*x41*x29*x41^-1*x29^-1, x29^-1*x0*x29*x0*x29^-1*x0^-1, x21*x29*x21^-1*x29^-1*x21^-1*x29, x41^-1*x0^-1*x41^-1*x0*x41*x0, x54^-1*x21^-1*x54^-1*x21*x54*x21, x41*x21*x41^-1*x21^-1*x41^-1*x21, x21*x0*x21*x0^-1*x21^-1*x0^-1, x41*x54*x41*x54^-1*x41^-1*x54^-1, x54^-1*x0^-1*x54^-1*x0*x54*x0, x41*x21*x29*x21^-1*x41^-1*x21*x29^-1*x21^-1, x41*x54*x41^-1*x29*x54^-1*x41^-1*x54*x29^-1, x21^-1*x0*x54*x0^-1*x21*x0*x54^-1*x0^-1, x0^-1*x41*x21*x41^-1*x0*x41*x21^-1*x41^-1, x21^-1*x0*x41*x0^-1*x21*x0*x41^-1*x0^-1, x21^-1*x54^-1*x0*x54*x21*x54^-1*x0^-1*x54, x29^-1*x54^-1*x0^-1*x54*x29*x54^-1*x0*x54, x29^-1*x0*x54*x0^-1*x29*x0*x54^-1*x0^-1, x29*x0^2*x29^-1*x54^-1*x29*x0^-2*x29^-1*x54, x29^-1*x41*x54*x21*x41^-1*x29*x41*x21^-1*x54^-1*x41^-1, x0*x54^-1*x41*x54*x0^-1*x29^-1*x21^-1*x54^-1*x41^-1*x54*x21*x29, x29^-1*x21^-1*x29*x0*x41*x54*x21*x29*x21^-1*x54^-1*x41^-1*x0^-1, x41^-1*x0^-1*x21*x29*x0*x41*x54*x21*x0^-1*x29^-1*x21^-1*x54^-1, x0^-1*x29^-1*x21*x54^-1*x29*x0*x29*x41*x54*x21^-1*x29*x41^-1*x54^-1*x41^-1, x41^-1*x54^-1*x29*x0^-1*x41*x54*x21*x29*x21*x41^-1*x0*x29^-1*x21^-1*x54^-1, x21^-1*x54^-1*x29*x21^-1*x41^-1*x0*x41*x54*x0*x41^-1*x0^-1*x21*x29^-1*x54, x54*x21*x29*x0*x29^-1*x54*x21^-1*x54^-1*x41^-1*x0^-1*x29^-1*x0*x41*x21^-1, x41*x54*x21*x29*x0*x21^-1*x29*x41*x21*x29^2*x21*x29^-1*x21^-1*x41^-2*x0^-1*x29^-1*x21^-1*x54^-1*x41^-1*x21^-1, x29*x21^-1*x0*x54^2*x41*x54*x21*x0*x29^-1*x41*x0^-1*x21^-1*x0^-2*x54^-1*x41^-1*x0^-1*x29^-1*x21^-1*x29*x0^-1*x21^2, x29*x41^-1*x0*x41*(x21*x54)^2*x0*x54*x21*x0*x29^-1*x21^-1*x41*x54^-1*x41^-1*x29^-1*(x29^-1*x0^-1)^2*x29^-1*x54^-1*x0^-1*x21 >

```


I did some tests cythonizing some of the functions in `zariski_vankampen.py`, and I could not observe any speedup at all. I don't think it will be worth the effort.

Are you sure about the list comprehension problem? It seems to work fine in this cpdef'ed function.



---

archive/issue_comments_287171.json:
```json
{
    "body": "I've hit that list comprehension problem before. *shrugs*\n\nFrom doing some profiling, I agree that there is no real gain from the extra Cythonization.\n\nI made some changes to improve the Cython generated code, removed trailing whitespace, cleaned up the documentation and imports, and some other misc tweaks. So the code should be slight improvement in speed, but likely marginal. Mainly it is cleaner code.\n\nIf my changes look good, then you can set a positive review (unless you can add an doctest to the functions in `libs/sirocco.pyx`, but this is preferable).\n----\nNew commits:",
    "created_at": "2017-04-16T23:55:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287171",
    "user": "https://github.com/tscrim"
}
```

I've hit that list comprehension problem before. *shrugs*

From doing some profiling, I agree that there is no real gain from the extra Cythonization.

I made some changes to improve the Cython generated code, removed trailing whitespace, cleaned up the documentation and imports, and some other misc tweaks. So the code should be slight improvement in speed, but likely marginal. Mainly it is cleaner code.

If my changes look good, then you can set a positive review (unless you can add an doctest to the functions in `libs/sirocco.pyx`, but this is preferable).
----
New commits:



---

archive/issue_comments_287172.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-17T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287172",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_287173.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2017-04-17T10:43:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287173",
    "user": "https://github.com/miguelmarco"
}
```

Thanks for the review!



---

archive/issue_comments_287174.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-04-21T22:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287174",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_287175.json:
```json
{
    "body": "On 32-bit\n\n```\nsage -t --long src/sage/schemes/curves/zariski_vankampen.py\n**********************************************************************\nFile \"src/sage/schemes/curves/zariski_vankampen.py\", line 196, in sage.schemes.curves.zariski_vankampen.segments\nFailed example:\n    segments(disc)\nExpected:\n    [(-2.84740787203333 - 2.84740787203333*I,\n    -2.14285714285714 + 1.11022302462516e-16*I),\n    (-2.84740787203333 + 2.84740787203333*I,\n    -2.14285714285714 + 1.11022302462516e-16*I),\n    (2.50000000000000 + 2.50000000000000*I,\n    1.26513881334184 + 2.19128470333546*I),\n    (2.50000000000000 + 2.50000000000000*I,\n    2.50000000000000 - 2.50000000000000*I),\n    (1.26513881334184 + 2.19128470333546*I, 0.000000000000000),\n    (0.000000000000000, 1.26513881334184 - 2.19128470333546*I),\n    (2.50000000000000 - 2.50000000000000*I,\n    1.26513881334184 - 2.19128470333546*I),\n    (-2.84740787203333 + 2.84740787203333*I,\n    1.26513881334184 + 2.19128470333546*I),\n    (-2.14285714285714 + 1.11022302462516e-16*I, 0.000000000000000),\n    (-2.84740787203333 - 2.84740787203333*I,\n    1.26513881334184 - 2.19128470333546*I)]\nGot:\n    [(-2.84740787203333 - 2.84740787203333*I,\n      -2.14285714285714 + 8.65735434729675e-17*I),\n     (-2.84740787203333 + 2.84740787203333*I,\n      -2.14285714285714 + 8.65735434729675e-17*I),\n     (2.50000000000000 + 2.50000000000000*I,\n      1.26513881334184 + 2.19128470333546*I),\n     (2.50000000000000 + 2.50000000000000*I,\n      2.50000000000000 - 2.50000000000000*I),\n     (1.26513881334184 + 2.19128470333546*I, 1.97324795392362e-17),\n     (1.97324795392362e-17, 1.26513881334184 - 2.19128470333546*I),\n     (2.50000000000000 - 2.50000000000000*I,\n      1.26513881334184 - 2.19128470333546*I),\n     (-2.84740787203333 + 2.84740787203333*I,\n      1.26513881334184 + 2.19128470333546*I),\n     (-2.14285714285714 + 8.65735434729675e-17*I, 1.97324795392362e-17),\n     (-2.84740787203333 - 2.84740787203333*I,\n      1.26513881334184 - 2.19128470333546*I)]\n**********************************************************************\n1 item had failures:\n   1 of   6 in sage.schemes.curves.zariski_vankampen.segments\n    [37 tests, 1 failure, 1.29 s]\n```\n",
    "created_at": "2017-04-21T22:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287175",
    "user": "https://github.com/vbraun"
}
```

On 32-bit

```
sage -t --long src/sage/schemes/curves/zariski_vankampen.py
**********************************************************************
File "src/sage/schemes/curves/zariski_vankampen.py", line 196, in sage.schemes.curves.zariski_vankampen.segments
Failed example:
    segments(disc)
Expected:
    [(-2.84740787203333 - 2.84740787203333*I,
    -2.14285714285714 + 1.11022302462516e-16*I),
    (-2.84740787203333 + 2.84740787203333*I,
    -2.14285714285714 + 1.11022302462516e-16*I),
    (2.50000000000000 + 2.50000000000000*I,
    1.26513881334184 + 2.19128470333546*I),
    (2.50000000000000 + 2.50000000000000*I,
    2.50000000000000 - 2.50000000000000*I),
    (1.26513881334184 + 2.19128470333546*I, 0.000000000000000),
    (0.000000000000000, 1.26513881334184 - 2.19128470333546*I),
    (2.50000000000000 - 2.50000000000000*I,
    1.26513881334184 - 2.19128470333546*I),
    (-2.84740787203333 + 2.84740787203333*I,
    1.26513881334184 + 2.19128470333546*I),
    (-2.14285714285714 + 1.11022302462516e-16*I, 0.000000000000000),
    (-2.84740787203333 - 2.84740787203333*I,
    1.26513881334184 - 2.19128470333546*I)]
Got:
    [(-2.84740787203333 - 2.84740787203333*I,
      -2.14285714285714 + 8.65735434729675e-17*I),
     (-2.84740787203333 + 2.84740787203333*I,
      -2.14285714285714 + 8.65735434729675e-17*I),
     (2.50000000000000 + 2.50000000000000*I,
      1.26513881334184 + 2.19128470333546*I),
     (2.50000000000000 + 2.50000000000000*I,
      2.50000000000000 - 2.50000000000000*I),
     (1.26513881334184 + 2.19128470333546*I, 1.97324795392362e-17),
     (1.97324795392362e-17, 1.26513881334184 - 2.19128470333546*I),
     (2.50000000000000 - 2.50000000000000*I,
      1.26513881334184 - 2.19128470333546*I),
     (-2.84740787203333 + 2.84740787203333*I,
      1.26513881334184 + 2.19128470333546*I),
     (-2.14285714285714 + 8.65735434729675e-17*I, 1.97324795392362e-17),
     (-2.84740787203333 - 2.84740787203333*I,
      1.26513881334184 - 2.19128470333546*I)]
**********************************************************************
1 item had failures:
   1 of   6 in sage.schemes.curves.zariski_vankampen.segments
    [37 tests, 1 failure, 1.29 s]
```




---

archive/issue_comments_287176.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-22T14:56:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_287177.json:
```json
{
    "body": "I guess that is a discrpancy on the rounding unit. Added some tolerance to the doctest.",
    "created_at": "2017-04-22T14:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287177",
    "user": "https://github.com/miguelmarco"
}
```

I guess that is a discrpancy on the rounding unit. Added some tolerance to the doctest.



---

archive/issue_comments_287178.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2017-04-22T14:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287178",
    "user": "https://github.com/miguelmarco"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_287179.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-25T17:40:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20808#issuecomment-287179",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_019740.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2017-04-25T17:40:18Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20808",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20808#event-19740"
}
```
