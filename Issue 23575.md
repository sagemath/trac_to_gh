# Issue 23575: py3: let the repr of integers be a string

Issue created by migration from https://trac.sagemath.org/ticket/23812

Original creator: chapoton

Original creation time: 2017-09-09 11:21:35

CC:  embray jdemeyer

and not forced to be "bytes"


---

Comment by chapoton created at 2017-09-09 11:22:08

Changing status from new to needs_review.


---

Comment by git created at 2017-09-09 11:22:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-09-10 08:22:24

I wonder if we should have a general function to convert from `bytes` to `str` and back in Sage. For example, like in cypari2: https://github.com/defeo/cypari2/blob/master/cypari2/string_utils.pyx


---

Comment by chapoton created at 2017-09-10 09:59:32

It seems that we also need to change the repr of rational numbers..


---

Comment by chapoton created at 2017-09-11 18:54:15

ping ?


---

Comment by jdemeyer created at 2017-09-12 10:10:07

As I said, I think we should have a general solution instead of this.


---

Comment by jdemeyer created at 2017-09-12 10:10:07

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-09-12 10:11:47

There is

```
src/sage/misc/six.py:def u(x):
```

but this is not doing exactly that.


---

Comment by embray created at 2017-09-12 20:06:09

I don't think this is the right answer.  There a dozens of places where a similar conversion is needed.  There needs to be a generic function for this kind of thing.


---

Comment by chapoton created at 2017-09-13 06:44:26

This is maybe not the definitive word. If you feel you can do better quickly, please do.

Nethertheless, there are not so many casting to bytes:

```
git grep -c "<bytes>" *.pyx
src/sage/libs/ecl.pyx:2
src/sage/libs/homfly.pyx:1
src/sage/libs/pynac/pynac.pyx:1
src/sage/numerical/backends/cvxopt_backend.pyx:1
src/sage/numerical/backends/cvxopt_sdp_backend.pyx:1
src/sage/numerical/backends/ppl_backend.pyx:1
src/sage/rings/integer.pyx:1
```

and integer.pyx is certainly the most important place where we need to correct the casting to bytes.


---

Comment by jdemeyer created at 2017-09-13 09:07:23

Replying to [comment:9 chapoton]:
> Nethertheless, there are not so many casting to bytes:

I think most of the time, the `bytes` is implicit because it's just what corresponds to `char *` in C. For example, in code like

```
def f():
    cdef char* cstr = ....
    return cstr
```

Cython will automatically convert `cstr` to Python `bytes`. Since Sage deals with a lot of C libraries, I would guess that this happens in a lot of places.


---

Comment by git created at 2017-09-13 16:07:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-09-13 16:57:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-09-13 16:58:20

what do you think of the new branch ?


---

Comment by chapoton created at 2017-09-14 08:24:16

see also #23648


---

Comment by embray created at 2017-09-15 15:22:23

Yeah, this really needs some opposite of `string_to_bytes()` from #23648.  This isn't a great approach.  And although in the vast majority of cases we can assume that the return values in these cases will be in ASCII, it's a bad pattern to repeat, because if anything happens to _not_ return ASCII using this pattern you'll get something like this on Python 2:


```
>>> str(b'\xe2\x98\x83'.decode('utf8'))
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeEncodeError: 'ascii' codec can't encode character u'\u2603' in position 0: ordinal not in range(128)
```



---

Comment by chapoton created at 2017-10-18 16:59:53

Changing keywords from "" to "unicode".


---

Comment by chapoton created at 2017-10-22 19:07:51

I would appreciate if Erik or another expert of unicode issues works on the matter here and all related tickets dealing with unicode adaptations for python3. I understand when one tells me that my solutions are not good, but please then propose another branch.


---

Comment by embray created at 2017-10-23 10:10:39

Set assignee to embray.


---

Comment by embray created at 2017-10-23 10:10:39

Replying to [comment:17 chapoton]:
> I would appreciate if Erik or another expert of unicode issues works on the matter here and all related tickets dealing with unicode adaptations for python3. I understand when one tells me that my solutions are not good, but please then propose another branch.
> 

I hear you-- I need to get my Python 3 build working again but I do want to help with this stuff.  Please feel free to assign such tickets to me.


---

Comment by chapoton created at 2017-11-10 12:45:24

I have created a new ticket that just wants to introduce the conversion tools: #24186.


---

Comment by embray created at 2017-11-15 08:10:36

Oops, this patch is now for some reason deleting all of rationals.pyx?

I'm going to see if I can rework this with my new string conversion functions.


---

Comment by chapoton created at 2017-11-15 08:39:59

Replying to [comment:20 embray]:
> Oops, this patch is now for some reason deleting all of rationals.pyx?

probably a known bug in trac git plugin

> I'm going to see if I can rework this with my new string conversion functions.

ok. Beware also of #24136


---

Comment by chapoton created at 2018-01-05 12:31:49

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2018-01-05 12:31:49

let us get rid of this one as duplicate


---

Comment by chapoton created at 2018-01-10 14:27:36

ping ? any objection to close as invalid ?


---

Comment by embray created at 2018-01-10 15:24:13

Resolution: wontfix
