# Issue 33460: incorrect test for equality of vectors over SR

Issue created by migration from https://trac.sagemath.org/ticket/33697

Original creator: @DaveWitteMorris

Original creation time: 2022-04-12 19:28:41

As reported in [this sage-devel thread](https://groups.google.com/g/sage-devel/c/uNw5wgJFc94/m/nGrwcHO_AgAJ), sage can report that two unequal vectors over the symbolic ring `SR` are equal:

```
sage: assume(x > 0)
sage: v = vector(SR, [x])
sage: w = vector(SR, [1])
sage: v == w
True
```

The problem comes from the fact that `if lx != rx:` is not the same as `if not(lx == rx):` when `lx` and `rx` are in `SR`.  More precisely, for a symbolic relation such as `f(x) == g(x)`, the docstring of `sage.symbolic.expression.__bool__` says `bool` will return `True` if the relation is true for all possible values of `x`, and will return `False` otherwise. Therefore, it is often the case that `bool(f(x) == g(x))` and `bool(f(x) != g(x))` are both `False`.

```
sage: assume(x > 0)
sage: bool(x == 1)
False
sage: bool(x != 1)
False
```


The test for equality of vectors uses the comparison `if lx != rx:` on each component, but it should use `if not(lx == rx):`.  What happens in the example is that there is a value of `x` for which `x` is equal to `1`. This means that `bool(x != 1)` is `False`, so sagemath erroneously concludes that `v == w` should be true.

This bug does not arise without `assume(x > 0)`, because inequality of symbolic relations does not follow the docstring's description when there are no assumptions.


---

Comment by @DaveWitteMorris created at 2022-04-12 19:44:46

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2022-04-12 19:44:46

Changed milestone to 9.6, but perhaps should be 9.7 because 9.6 is in release-candidate stage (and perhaps the priority should not be "critical").
----
New commits:


---

Comment by tscrim created at 2022-04-25 00:53:12

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-04-25 00:53:12

LGTM. I also agree on both points.


---

Comment by tscrim created at 2022-04-25 00:53:12

Changing priority from critical to major.


---

Comment by @DaveWitteMorris created at 2022-04-25 18:42:43

Thanks!


---

Comment by vbraun created at 2022-05-22 09:57:34

Resolution: fixed
