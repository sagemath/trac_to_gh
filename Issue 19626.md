# Issue 19626: Static error rate channel does not always add as many errors as expected

Issue created by migration from https://trac.sagemath.org/ticket/19863

Original creator: dlucas

Original creation time: 2016-01-11 14:43:49

CC:  jsrn

I noticed the following:


```
V = VectorSpace(GF(2), 2)
Chan = channels.StaticErrorRateChannel(V, 1)
for i in range(100):
    c = V.random_element()
    r = Chan(c)
    assert c != r

AssertionError
```


This is due to a line in the `transmit_unsafe` methods which replaces values of the transmitted vector by random values picked from the base ring of the transmitted vector.
It works with high probability for big rings, but obviously not for my example.

In any case, it does not respect the promised behaviour and thus should be fixed.


---

Comment by dlucas created at 2016-01-11 14:44:57

Changing status from new to needs_review.


---

Comment by dlucas created at 2016-01-11 14:44:57

I fixed the bug, this is now open for review.
----
New commits:


---

Comment by jsrn created at 2016-01-11 18:46:39

Could you please introduce `R = V.base_ring()`?


---

Comment by jsrn created at 2016-01-11 18:54:23

Could you add something like your code as a test? E.g. something like


```
V = VectorSpace(GF(2), 1000)
Chan = channels.StaticErrorRateChannel(V, 367)
assert (c - Chan.transmit(c)).hamming_weight() == 367
```



Otherwise, the code looks good, builds fine and passes.


---

Comment by git created at 2016-01-11 19:09:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2016-01-11 19:10:38

Done and done. Thanks for the help.

David


---

Comment by jsrn created at 2016-01-11 19:30:33

Oh, I guess the doctest is better written with output instead of assert:


```
   sage: (c - Chan.transmit(c)).hamming_weight()
   367
```



---

Comment by git created at 2016-01-11 19:40:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2016-01-11 19:41:18

I agree. Done!


---

Comment by jsrn created at 2016-01-11 20:10:23

Cool. Green light.


---

Comment by jsrn created at 2016-01-11 20:10:23

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-01-12 22:07:06

Resolution: fixed
