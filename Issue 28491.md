# Issue 28491: gap fails its test suite

Issue created by migration from https://trac.sagemath.org/ticket/28728

Original creator: jhpalmieri

Original creation time: 2019-11-13 19:59:32

`./sage -f -c gap` fails with errors like

```
########> Diff in /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.be\
ta5/local/var/tmp/sage/build/gap-4.10.2.p1/src/tst/testinstall/strings.tst:44
# Input is:
x:="\0xFF";
# Expected output:
"\377"
# But found:
"ÿ"
########
########> Diff in /Users/jpalmier/Desktop/Sage/sage_builds/TESTING/sage-9.0.be\
ta5/local/var/tmp/sage/build/gap-4.10.2.p1/src/tst/testinstall/strings.tst:48
# Input is:
x:="A string with \0xFF Hex stuff \0x42 in it";
# Expected output:
"A string with \377 Hex stuff B in it"
# But found:
"A string with ÿ Hex stuff B in it"
########
```



---

Comment by embray created at 2020-01-06 14:10:03

Ticket retargeted after milestone closed


---

Comment by dimpase created at 2020-03-12 17:16:28

is this on an unusual locale/architecture?


---

Comment by jhpalmieri created at 2020-03-12 18:47:24

This is with OS X 10.14.6. I don't think I have a locale set. I have this:

```
$ echo $LANG
en_US.UTF-8
```



---

Comment by dimpase created at 2020-03-12 19:01:06

check out if https://github.com/gap-system/homebrew-gap/issues/2#issuecomment-558382314
helps

```
export LC_CTYPE=en_US.UTF-8
```



---

Comment by jhpalmieri created at 2020-03-12 19:15:06

Replying to [comment:4 dimpase]:
> check out if https://github.com/gap-system/homebrew-gap/issues/2#issuecomment-558382314
> helps
> {{{
> export LC_CTYPE=en_US.UTF-8
> }}}

That fixed it: the test suite passes.

In other news, the test suite appears fragile in other ways: I just ran tests on another OS X machine (10.15), and no files `testinstall/*` which come alphabetically after `intarith.tst` were tested: the testing stopped after `intarith.tst`. In particular, it didn't test the file `strings.tst`, which was problematic on the first machine.


---

Comment by mkoeppe created at 2020-03-13 00:50:27

I also get the same testsuite failure in `ubuntu-xenial-standard` (https://github.com/mkoeppe/sage/runs/503945069), `ubuntu-bionic-standard`, `debian-buster-standard`, etc.


---

Comment by jhpalmieri created at 2020-03-14 01:04:48

Can you set `LC_TYPE=en_US.UTF-8' and see if that helps?


---

Comment by mkoeppe created at 2020-03-14 03:06:54

The fix on the branch helped on my macOS system. Tests for other platform run at https://github.com/mkoeppe/sage/actions/runs/55431568
----
New commits:


---

Comment by mkoeppe created at 2020-03-14 03:12:07

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2020-03-14 05:12:15

Works for me. Thanks for creating the branch.


---

Comment by jhpalmieri created at 2020-03-14 05:12:15

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-03-17 23:35:49

Resolution: fixed
