# Issue 18826: Coercions and basic arithmetic for complex balls

Issue created by migration from Trac.

Original creator: mmezzarobba

Original creation time: 2015-08-20 16:46:58

CC:  cheuberg




---

Comment by git created at 2015-08-25 07:18:24

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:


---

Comment by mmezzarobba created at 2015-08-25 07:26:39

Changing keywords from "" to "arb".


---

Comment by mmezzarobba created at 2015-08-25 07:26:39

Changing status from new to needs_review.


---

Comment by cheuberg created at 2015-09-04 09:33:44

I started reviewing this and just a few first comments ... 

* SEEALSO block at the beginning of complex_ball_acb.html: show human readable names of the modules instead of sage.rings....
* `ComplexBallField.construction()`: one-sentence-description: Replace "Returns" by "Return" (see developper guide)
* `ComplexBallField.gen()`, `.gens()`, `.ngens()`: Missing one-sentence-description


---

Comment by git created at 2015-09-04 11:40:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-07 13:51:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cheuberg created at 2015-09-07 13:57:39

I have now reviewed this patch and added a few reviewer commits.

Questions:

* `ComplexBall.__init__`: why `Element.__init__` instead of `RingElement.__init__`

* `.some_elements`: Is `1/3` intentional (this is an elaborate way of writing 0 in python)

* Why is the representation `real - imag*I` restricted to exact negative imaginary parts and does not apply to
  `1 + [-0.333]*I`

* `.__contains__`, `.contains_exact`: why do we have two distinct methods here? Why is an integer or a rational as the argument of `.__contains__` not handeled separately by the relevant .acb functions?

Apart from that, a few documentation issues:

* `_complex_mpfr_field_`: missing INPUT: section (parameter `parent`)

* `_real_mpfi_`: missing INPUT: section (parameter parent), One-sentence-description mentions "real number" instead of "real interval".

* `_mpfr_`: missing INPUT: section (parameter `parent`)

* `.mid`, `.squash`: missing OUTPUT: section

* `.mid` should have "see also" section (`.squash`)

* `.identical` refers to a method `contains` which does not exist.

* `.contains_exact`, `.identical`, `.overlaps`: missing INPUT: section (parameter `other`)


---

Comment by cheuberg created at 2015-09-07 13:57:39

Changing status from needs_review to needs_info.


---

Comment by mmezzarobba created at 2015-09-07 15:31:02

Replying to [comment:10 cheuberg]:
> I have now reviewed this patch and added a few reviewer commits.

Thanks!

> Questions:
> 
> * `ComplexBall.__init__`: why `Element.__init__` instead of `RingElement.__init__`

Because I neglected to change it after changing the parent class. (I hate Python...)

> * `.some_elements`: Is `1/3` intentional (this is an elaborate way of writing 0 in python)

It wasn't intentional.

> * Why is the representation `real - imag*I` restricted to exact negative imaginary parts and does not apply to
>   `1 + [-0.333]*I`

The old version would return things like `1.000000000000000 + - 0.5000000000000000*I` for exactly representable imaginary parts. I only implemented a minimal fix, thinking that the version with `... + [...]` was clear enough and perhaps clearer otherwise (especially for intervals containing zero), but I have no strong feelings either way.

> * `.__contains__`, `.contains_exact`: why do we have two distinct methods here? Why is an integer or a rational as the argument of `.__contains__` not handeled separately by the relevant .acb functions?

The idea was to have a version that first converts its argument to a ball (and thus can accept a wide range of argument types), but may not recognize that the argument is contained in the other ball if the conversion is not precise enough, and a version for which a result of `False` always guarantees that the argument is not in the ball. We could just document for which argument types the result of `in` is guaranteed to be accurate, but I felt it'd be clearer that way. Here too, I'm open to discussion if you don't like that choice.

> Apart from that, a few documentation issues:
>
> * `_complex_mpfr_field_`: missing INPUT: section (parameter `parent`)
> 
> * `_real_mpfi_`: missing INPUT: section (parameter parent), One-sentence-description mentions "real number" instead of "real interval".
> 
> * `_mpfr_`: missing INPUT: section (parameter `parent`)
> 
> * `.mid`, `.squash`: missing OUTPUT: section
> 
> * `.mid` should have "see also" section (`.squash`)
> 
> * `.identical` refers to a method `contains` which does not exist.
> 
> * `.contains_exact`, `.identical`, `.overlaps`: missing INPUT: section (parameter `other`)

Thanks. But note that the formal requirement of pointless INPUT/OUTPUT sections in docstrings is apparently going to be relaxed (#19041), so I'm not sure we need them INPUT sections every time you noted they were missing.


---

Comment by mmezzarobba created at 2015-09-07 15:53:08

Changing status from needs_info to needs_work.


---

Comment by cheuberg created at 2015-09-07 17:44:07

Replying to [comment:11 mmezzarobba]:
> > Questions:
> > 
> > * `ComplexBall.__init__`: why `Element.__init__` instead of `RingElement.__init__`
> 
> Because I neglected to change it after changing the parent class. (I hate Python...)

If I remember correctly, there is some reason not to use `super`.

> > * Why is the representation `real - imag*I` restricted to exact negative imaginary parts and does not apply to
> >   `1 + [-0.333]*I`
> 
> The old version would return things like `1.000000000000000 + - 0.5000000000000000*I` for exactly representable imaginary parts. I only implemented a minimal fix, thinking that the version with `... + [...]` was clear enough and perhaps clearer otherwise (especially for intervals containing zero), but I have no strong feelings either way.

No strong feelings from my side; I was just wondering reading the code. For intervals containing the zero, it might indeed be strange.

> 
> > * `.__contains__`, `.contains_exact`: why do we have two distinct methods here? Why is an integer or a rational as the argument of `.__contains__` not handeled separately by the relevant .acb functions?
> 
> The idea was to have a version that first converts its argument to a ball (and thus can accept a wide range of argument types), but may not recognize that the argument is contained in the other ball if the conversion is not precise enough, and a version for which a result of `False` always guarantees that the argument is not in the ball. We could just document for which argument types the result of `in` is guaranteed to be accurate, but I felt it'd be clearer that way. Here too, I'm open to discussion if you don't like that choice.

I think that `rational in ball` and `integer in ball` should give correct results in any case. 

> 
> > Apart from that, a few documentation issues:
> >
> > * `_complex_mpfr_field_`: missing INPUT: section (parameter `parent`)
> > 
> > * `_real_mpfi_`: missing INPUT: section (parameter parent), One-sentence-description mentions "real number" instead of "real interval".
> > 
> > * `_mpfr_`: missing INPUT: section (parameter `parent`)
> > 
> > * `.mid`, `.squash`: missing OUTPUT: section
> > 
> > * `.mid` should have "see also" section (`.squash`)
> > 
> > * `.identical` refers to a method `contains` which does not exist.
> > 
> > * `.contains_exact`, `.identical`, `.overlaps`: missing INPUT: section (parameter `other`)
> 
> Thanks. But note that the formal requirement of pointless INPUT/OUTPUT sections in docstrings is apparently going to be relaxed (#19041), so I'm not sure we need them INPUT sections every time you noted they were missing.

I know; the question is what is obvious and what not. My feelings are not very strong here.


---

Comment by mmezzarobba created at 2015-09-08 12:31:40

Changing status from needs_work to needs_review.


---

Comment by mmezzarobba created at 2015-09-08 12:31:40

New commits:


---

Comment by cheuberg created at 2015-09-08 18:40:52

fine for me.


---

Comment by cheuberg created at 2015-09-08 18:40:52

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2015-09-08 20:30:49

Thanks for the review!


---

Comment by cheuberg created at 2015-09-24 13:04:45

I pushed a fix for the doctest issue on 32-bit (cf. #18546) but have not yet tested it under 32 bit.
----
New commits:


---

Comment by cheuberg created at 2015-09-24 13:05:03

Changing status from positive_review to needs_review.


---

Comment by cheuberg created at 2015-09-25 06:04:20

Replying to [comment:20 cheuberg]:
> but have not yet tested it under 32 bit.

tests on my (virtual) 32 bit machine pass.


---

Comment by mmezzarobba created at 2015-10-15 08:29:04

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2015-10-15 08:38:22

Just a comment for a follow-up: it would be better to use method names more consistent with `RIF`/`CIF`:
* `above_abs` and `below_abs` should be renamed `magnitude` and `mignitude` for analogy with `RIF` and, after #19403, also `CIF`.
* `mid` should be `center`


---

Comment by jdemeyer created at 2015-10-15 09:03:08

Or perhaps `above_abs` is not exactly the same as `magnitude` since the latter returns a real number instead of a ball. Still, it would be nice to implement `magnitude` like `RIF`.


---

Comment by mmezzarobba created at 2015-10-15 12:15:46

Replying to [comment:26 jdemeyer]:
> Or perhaps `above_abs` is not exactly the same as `magnitude` since the latter returns a real number instead of a ball. Still, it would be nice to implement `magnitude` like `RIF`.

Yes.

Regarding `center()`, I'd prefer to keep the name `mid()`, if only to emphazise that the midpoint is part of the defining data of the ball (and thus always is exact, while `mpfi_mid()` involves a rounding), but I have nothing against adding `center()` as an alias.


---

Comment by mmezzarobba created at 2015-10-15 12:40:51

It looks like the trac server ignored my push for some reason, but as far as I can tell the branch merges cleanly.


---

Comment by jdemeyer created at 2015-10-15 13:40:32

Replying to [comment:27 mmezzarobba]:
> Replying to [comment:26 jdemeyer]:
> > Or perhaps `above_abs` is not exactly the same as `magnitude` since the latter returns a real number instead of a ball. Still, it would be nice to implement `magnitude` like `RIF`.
> 
> Yes.
> 
> Regarding `center()`, I'd prefer to keep the name `mid()`, if only to emphazise that the midpoint is part of the defining data of the ball (and thus always is exact, while `mpfi_mid()` involves a rounding), but I have nothing against adding `center()` as an alias.

For most practical purposes, the rounding or not is just an implementation detail. Personally, I would prefer to use just one method name (for example, I don't like that some types implement `prec()` and some implement `precision()` but not all implement both: that's just confusing). Given that `center()` has been around for a while, I would prefer to use `center()` (and only that) also for arb.


---

Comment by jdemeyer created at 2015-10-15 13:40:59

By the way, I might be interesting in reviewing this ticket but only after the dependencies have been merged.


---

Comment by jdemeyer created at 2015-10-15 13:45:56

Replying to [comment:29 mmezzarobba]:
> It looks like the trac server ignored my push for some reason, but as far as I can tell the branch merges cleanly.

There is no branch...


---

Comment by jdemeyer created at 2015-10-15 13:45:56

Changing status from positive_review to needs_work.


---

Comment by mmezzarobba created at 2015-10-15 14:08:58

Replying to [comment:32 jdemeyer]:
> Replying to [comment:29 mmezzarobba]:
> > It looks like the trac server ignored my push for some reason, but as far as I can tell the branch merges cleanly.
> 
> There is no branch...

Oops, now I understand. Thanks!
----
Last 10 new commits:


---

Comment by mmezzarobba created at 2015-10-15 14:09:09

Changing status from needs_work to positive_review.


---

Comment by cheuberg created at 2015-10-16 10:18:42

Did no longer merge cleanly with latest version of dependency #18546. Please check the merge.
----
New commits:


---

Comment by cheuberg created at 2015-10-16 10:18:42

Changing status from positive_review to needs_review.


---

Comment by mmezzarobba created at 2015-10-16 10:54:17

replacing the branch by my version of the merge because I also rebased the follow-ups


---

Comment by cheuberg created at 2015-10-16 11:06:22

content of both branches is equal. Thus back to positive.


---

Comment by cheuberg created at 2015-10-16 11:06:22

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-10-30 08:33:30

Resolution: fixed
