# Issue 30344: src/pyproject.toml

Issue created by migration from https://trac.sagemath.org/ticket/30581

Original creator: mkoeppe

Original creation time: 2020-09-16 02:42:36

CC:  @tobiasdiez jhpalmieri dimpase

Adding PEP 517 metadata


---

Comment by mkoeppe created at 2020-09-16 03:32:37

Build fails with 

```
    File "/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-build-t5v70h8w/sage/misc/package.py", line 319, in installed_packages
      installed.update(pip_installed_packages())
    File "/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-build-t5v70h8w/sage/misc/package.py", line 154, in pip_installed_packages
      for package in json.loads(stdout)}
    File "/usr/local/Cellar/python@3.8/3.8.5/Frameworks/Python.framework/Versions/3.8/lib/python3.8/json/__init__.py", line 357, in loads
      return _default_decoder.decode(s)
    File "/usr/local/Cellar/python@3.8/3.8.5/Frameworks/Python.framework/Versions/3.8/lib/python3.8/json/decoder.py", line 337, in decode
      obj, end = self.raw_decode(s, idx=_w(s, 0).end())
    File "/usr/local/Cellar/python@3.8/3.8.5/Frameworks/Python.framework/Versions/3.8/lib/python3.8/json/decoder.py", line 355, in raw_decode
      raise JSONDecodeError("Expecting value", s, err.value) from None
  json.decoder.JSONDecodeError: Expecting value: line 1 column 1 (char 0)
  ************************************************************************
  Error building the Sage library
  ************************************************************************
```

----
New commits:


---

Comment by git created at 2020-11-15 04:26:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2020-11-15 04:31:51

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2020-11-15 13:11:18

Is the following addition really necessary?

```
+# PEP 517 builds do not have . in sys.path
+sys.path.insert(0, os.path.dirname(__file__))
```


Not having `.` in the path is needed for the build isolation. (I'm fine with adding it for the moment and removing it in a follow-up ticket.)

Otherwise looks good to me!


---

Comment by mkoeppe created at 2020-11-15 18:06:47

I needed it when I first worked on this ticket; I'll double check if it's still necessary now. Thanks!


---

Comment by mkoeppe created at 2020-11-15 18:29:59

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111


---

Comment by mkoeppe created at 2020-12-06 18:17:38

Changing keywords from "" to "sd111".


---

Comment by mkoeppe created at 2021-01-19 02:18:58

Replying to [comment:11 gh-tobiasdiez]:
> Is the following addition really necessary?
> {{{
> +# PEP 517 builds do not have . in sys.path
> +sys.path.insert(0, os.path.dirname(__file__))
> }}}
> 
> Not having `.` in the path is needed for the build isolation. (I'm fine with adding it for the moment and removing it in a follow-up ticket.)

Yes, this is needed for finding `sage.env`, for example


---

Comment by mkoeppe created at 2021-01-21 00:45:42

This ticket is hard to test separately, so I have merged it into #30913. We can close this one here.


---

Comment by mkoeppe created at 2021-01-21 00:45:42

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2021-07-29 19:13:43

Resolution: duplicate
