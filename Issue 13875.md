# Issue 13875: Cython interface to pselect() system call

Issue created by migration from https://trac.sagemath.org/ticket/14079

Original creator: jdemeyer

Original creation time: 2013-02-07 13:00:59

Assignee: jason

Useful for the new doctesting framework.


---

Comment by jdemeyer created at 2013-02-11 09:07:44

I'm intentionally not setting it to needs_review yet, because I want to first have a use case (that will be #12415). But that being said, the code here is supposed to be finished.


---

Comment by roed created at 2013-02-11 14:18:14

Testing on 5.6 I get a doctest framework error (since you use the new `....:` continuation).  But testing on 5.7.beta1 with #12415 I get a timeout on line 308 (`r, w, x, t = PSelecter().pselect([f,g,f,f,g])`).


---

Comment by jdemeyer created at 2013-02-11 14:25:14

Replying to [comment:3 roed]:
> with #12415 I get a timeout on line 308 (`r, w, x, t = PSelecter().pselect([f,g,f,f,g])`).
On which kind of system is that?


---

Comment by roed created at 2013-02-11 14:31:24

Replying to [comment:4 jdemeyer]:
> Replying to [comment:3 roed]:
> > with #12415 I get a timeout on line 308 (`r, w, x, t = PSelecter().pselect([f,g,f,f,g])`).
> On which kind of system is that?

OS X 10.6.8, Core 2 Duo.


---

Comment by jdemeyer created at 2013-02-12 17:28:34

Updated patch (I haven't looked at the OS X specific issue).


---

Comment by roed created at 2013-02-12 20:01:09

See http://stackoverflow.com/questions/14045801/different-pselect-behaviour-on-osx-vs-linux for a possible explanation of what's going on on OS X.


---

Comment by jdemeyer created at 2013-02-12 21:59:14

Thanks for the pointer, but that doesn't seem to be the problem: no signals are involved in the failing tests you mention.


---

Comment by jdemeyer created at 2013-02-23 00:29:14

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2013-02-23 00:29:14

New version, works for me on OS X 10.6 with the latest version of #12415. Note that parallel testing on OS X is broken, but normal testing (with `-p 1`) works.


---

Comment by roed created at 2013-02-24 11:24:00

Apply failed....


---

Comment by roed created at 2013-02-24 11:24:08

Changing status from needs_review to needs_work.


---

Attachment


---

Comment by jdemeyer created at 2013-02-25 11:01:34

Changing status from needs_work to needs_review.


---

Comment by roed created at 2013-02-25 11:52:33

What was the problem on OS X?


---

Comment by jdemeyer created at 2013-02-25 12:17:49

The problem on OS X is:

```
sage: import select
sage: f = open(os.devnull)
sage: select.select([],[],[f])
([], [], [<open file '/dev/null', mode 'r' at 0x113ac7420>])
```

For some reason, most files have an "exceptional condition" by default on OS X. I have no idea why or what this means.


---

Comment by roed created at 2013-02-25 12:30:54

So is this causing the problems for parallel testing on OS X?  Do you know how to get around it?


---

Comment by jdemeyer created at 2013-02-25 13:43:10

Replying to [comment:15 roed]:
> So is this causing the problems for parallel testing on OS X?
No, this has nothing to do with parallel. The parallel testing should be fixed now.

The parallel testing problem with #12415 on OS X was due to `Pdb()` importing `readline`. Importing readline hangs (probably because more than one process tries to take control over the terminal somehow). The solution is simply not starting `Pdb` if not needed.


---

Comment by vbraun created at 2013-02-28 19:35:24

Looks good to me. Doesn't actually depend on #12415


---

Comment by vbraun created at 2013-02-28 19:39:42

Changing status from needs_review to needs_work.


---

Comment by vbraun created at 2013-02-28 19:39:42

I get the following:

```
Traceback (most recent call last):
  File "/home/vbraun/.sage//tmp/pselect_21760.py", line 458, in <module>
    runner=runner)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/sagedoctest.py", line 54, in testmod_returning_runner
    runner=runner)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 1819, in testmod_returning_runner
    for test in finder.find(m, name, globs=globs, extraglobs=extraglobs):
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 839, in find
    self._find(tests, obj, name, module, source_lines, globs, {})
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 893, in _find
    globs, seen)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 881, in _find
    test = self._get_test(obj, name, module, globs, source_lines)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 965, in _get_test
    filename, lineno)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 594, in get_doctest
    return DocTest(self.get_examples(string, name), globs,
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 608, in get_examples
    return [x for x in self.parse(string, name)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 570, in parse
    self._parse_example(m, name, lineno)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 628, in _parse_example
    self._check_prompt_blank(source_lines, indent, name, lineno)
  File "/home/vbraun/opt/sage-5.8.beta1/local/bin/ncadoctest.py", line 715, in _check_prompt_blank
    line[indent:indent+3], line))
ValueError: line 14 of the docstring for __main__.example_6 lacks blank after ...: '            ....:     global got_child'
Exception raised by doctesting framework. Use -verbose for details.
```



---

Comment by jdemeyer created at 2013-02-28 19:42:10

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2013-02-28 19:42:10

Replying to [comment:19 vbraun]:
> I get the following:
> {{{
> Exception raised by doctesting framework. Use -verbose for details.
> }}}
That's exactly why there was a dependency on #12415, I'm using new doctest syntax.


---

Comment by roed created at 2013-03-01 01:57:13

Changing status from needs_review to positive_review.


---

Comment by roed created at 2013-03-01 01:57:13

I just talked to Volker.  Looks good to us.


---

Comment by jdemeyer created at 2013-03-14 08:10:29

Resolution: fixed
