# Issue 16451: replace pexpect interface calls with library where possible

archive/issues_016451.json:
```json
{
    "body": "CC:  @kiwifb @frederichan-IMJPRG @nexttime @slel\n\nKeywords: expect, pexpect, library\n\nThis meta-ticket tracks efforts to replace pexpect interface calls with library calls, in order to minimize the usage of expect for time-critical code. Packages used by Sage where this seems possible include\n\n* mwrank\n* GAP\n* Singular\n* ECL/Maxima\n* PARI/GP (a few scripts #16687)\n\nThe following packages are used via pexpect in the Sage library (noninteractively) and these calls should be replaced somehow in\nthe long term (this is a wishlist):\n\n* Axiom (through fricas)\n* giac\n* kash\n* Macaulay2\n* Octave\n* qepcad\n* Scilab (two unused functions in `matrix/matrix1.pyx`)\n\nIssue created by migration from https://trac.sagemath.org/ticket/16688\n\n",
    "created_at": "2014-07-20T07:38:24Z",
    "labels": [
        "component: interfaces"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "replace pexpect interface calls with library where possible",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16451",
    "user": "https://github.com/rwst"
}
```
CC:  @kiwifb @frederichan-IMJPRG @nexttime @slel

Keywords: expect, pexpect, library

This meta-ticket tracks efforts to replace pexpect interface calls with library calls, in order to minimize the usage of expect for time-critical code. Packages used by Sage where this seems possible include

* mwrank
* GAP
* Singular
* ECL/Maxima
* PARI/GP (a few scripts #16687)

The following packages are used via pexpect in the Sage library (noninteractively) and these calls should be replaced somehow in
the long term (this is a wishlist):

* Axiom (through fricas)
* giac
* kash
* Macaulay2
* Octave
* qepcad
* Scilab (two unused functions in `matrix/matrix1.pyx`)

Issue created by migration from https://trac.sagemath.org/ticket/16688





---

archive/issue_comments_215982.json:
```json
{
    "body": "The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.",
    "created_at": "2014-07-20T09:45:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215982",
    "user": "https://github.com/kiwifb"
}
```

The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.



---

archive/issue_comments_215983.json:
```json
{
    "body": "Further motivation for this:\n\n```\nsage: scilab(str(range(20)))  # works\nsage: scilab(str(range(30)))  # BOOM!\n```\n\n(Note -- scilab(range(20)) doesn't work but should!)\n\nAnd also\n\n```\nsage: r(range(30))  # works\nsage: r(range(10000)) # boom\n```\n\nWorksheet with the above: https://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2015-02-04-062417-scilab-limits.sagews\n\nThese sorts of problems were reported by many people over the years, most recently by JC Boulet  of INRA.",
    "created_at": "2015-02-04T14:31:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215983",
    "user": "https://github.com/williamstein"
}
```

Further motivation for this:

```
sage: scilab(str(range(20)))  # works
sage: scilab(str(range(30)))  # BOOM!
```

(Note -- scilab(range(20)) doesn't work but should!)

And also

```
sage: r(range(30))  # works
sage: r(range(10000)) # boom
```

Worksheet with the above: https://cloud.sagemath.com/projects/4a5f0542-5873-4eed-a85c-a18c706e8bcd/files/support/2015-02-04-062417-scilab-limits.sagews

These sorts of problems were reported by many people over the years, most recently by JC Boulet  of INRA.



---

archive/issue_comments_215984.json:
```json
{
    "body": "I would say it's a motivation to improve the pexpect interfaces (see for example #17704, #17718, #17686, #17719).\n\nI claim that such interfaces can be made to work, it's just a mess in Sage.",
    "created_at": "2015-02-04T16:45:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215984",
    "user": "https://github.com/jdemeyer"
}
```

I would say it's a motivation to improve the pexpect interfaces (see for example #17704, #17718, #17686, #17719).

I claim that such interfaces can be made to work, it's just a mess in Sage.



---

archive/issue_comments_215985.json:
```json
{
    "body": "Replying to [comment:1 fbissey]:\n> The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.\n\n\nThere is, especially when you're programming both sides. You can have two processes communicate through a pipe or stream without one of the parties pretending to be a terminal.\n\nThat said, the fact that the notebook *does* use pexpect makes it easier to use it to interface with R, octave, magma, etc, so we do get some benefit from it.",
    "created_at": "2015-02-04T17:43:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215985",
    "user": "https://github.com/nbruin"
}
```

Replying to [comment:1 fbissey]:
> The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.


There is, especially when you're programming both sides. You can have two processes communicate through a pipe or stream without one of the parties pretending to be a terminal.

That said, the fact that the notebook *does* use pexpect makes it easier to use it to interface with R, octave, magma, etc, so we do get some benefit from it.



---

archive/issue_comments_215986.json:
```json
{
    "body": "Replying to [comment:5 nbruin]:\n> Replying to [comment:1 fbissey]:\n> > The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.\n\n> \n> There is, especially when you're programming both sides. You can have two processes communicate through a pipe or stream without one of the parties pretending to be a terminal.\n\n\nI completely agree.    IPython and also https://github.com/sagemath/cloud/blob/master/sage_server.py are both examples of better ways of communication between two processes without using pexpect.  Basically, you setup a traditional client/server and a messaging protocol.  Python and many other languages makes that sort of thing pretty easy.  But... it would be harder to implement something like that in a special purpose system like Pari or Magma.  It might be impossible with Magma without source code access (not sure what the status of networking is now). \n\n\n> That said, the fact that the notebook *does* use pexpect makes it easier to use it to interface with R, octave, magma, etc, so we do get some benefit from it.\n\n\nAs the author of exactly the part of the notebook that uses pexpect, etc., I don't agree with this statement so much -- instead, the two are somewhat orthogonal.   The connection (1) \"notebook_server <--> python processes\" is done using pexpect in sagenb.  The interfaces to R/octave/magma, etc. are connections (2) \"python processes <--> R/octave/magma/etc.\".   You can certainly swap out (1) for a connection built using TCP (rather than pexpect) with no impact on (2); in fact, that's precisely what I did with SageMathCloud. \n\nThat said, maybe you just meant that work on the abstract base class Expect for the interfaces benefits both sagenb and the R/octave/magma, etc., interfaces...",
    "created_at": "2015-02-04T18:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215986",
    "user": "https://github.com/williamstein"
}
```

Replying to [comment:5 nbruin]:
> Replying to [comment:1 fbissey]:
> > The notebook also uses pexpect. I am not sure there is much of an alternative there but at least we should try to move it to a more modern pexpect. Trying to do so results in breakages that I have no idea how to solve currently.

> 
> There is, especially when you're programming both sides. You can have two processes communicate through a pipe or stream without one of the parties pretending to be a terminal.


I completely agree.    IPython and also https://github.com/sagemath/cloud/blob/master/sage_server.py are both examples of better ways of communication between two processes without using pexpect.  Basically, you setup a traditional client/server and a messaging protocol.  Python and many other languages makes that sort of thing pretty easy.  But... it would be harder to implement something like that in a special purpose system like Pari or Magma.  It might be impossible with Magma without source code access (not sure what the status of networking is now). 


> That said, the fact that the notebook *does* use pexpect makes it easier to use it to interface with R, octave, magma, etc, so we do get some benefit from it.


As the author of exactly the part of the notebook that uses pexpect, etc., I don't agree with this statement so much -- instead, the two are somewhat orthogonal.   The connection (1) "notebook_server <--> python processes" is done using pexpect in sagenb.  The interfaces to R/octave/magma, etc. are connections (2) "python processes <--> R/octave/magma/etc.".   You can certainly swap out (1) for a connection built using TCP (rather than pexpect) with no impact on (2); in fact, that's precisely what I did with SageMathCloud. 

That said, maybe you just meant that work on the abstract base class Expect for the interfaces benefits both sagenb and the R/octave/magma, etc., interfaces...



---

archive/issue_comments_215987.json:
```json
{
    "body": "I do agree that when alternatives to pexpect are available, we should use the alternatives. But for the programs which don't offer alternatives, pexpect should be able to work.",
    "created_at": "2015-02-05T08:04:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16451#issuecomment-215987",
    "user": "https://github.com/jdemeyer"
}
```

I do agree that when alternatives to pexpect are available, we should use the alternatives. But for the programs which don't offer alternatives, pexpect should be able to work.
