# Issue 33011: Fix timeout in feature test for Mathematica

Issue created by migration from https://trac.sagemath.org/ticket/33248

Original creator: slelievre

Original creation time: 2022-01-30 15:08:40

CC:  slelievre

Keywords: features, mathematica

Doctesting `src/sage/features/interfaces.py`
fails for me with a timeout.

```
sage: from sage.features.interfaces import Mathematica
sage: Mathematica().is_present()
```



---

Comment by slelievre created at 2022-01-30 15:44:20

Set milestone to sage-9.6 after Sage 9.5 release.


---

Comment by slelievre created at 2022-01-30 17:07:47

Could we give up on `Mathematica().is_present()`
after say a minute?

Maybe using one of the answers to:

- [Stack Overflow question 492519: Timeout on a function call](https://stackoverflow.com/q/492519)


---

Comment by slabbe created at 2022-01-30 19:16:49

Do you know at which line it gets stuck in what is below ?


```python
    def _is_present(self):
        """
        TESTS::

            sage: from sage.features.interfaces import InterfaceFeature
            sage: from sage.interfaces.sage0 import Sage
            sage: f = InterfaceFeature("sage0", "sage.interfaces.sage0")
            sage: f.is_present()
            FeatureTestResult('sage0', True)
        """
        result = self.module.is_present()
        if not result:
            return result
        m = importlib.import_module(self.module.name)
        try:
            interface = getattr(m, self.name)
        except Exception as exception:
            return FeatureTestResult(self, False,
                                     reason=f"Interface {self.name} cannot be imported: {exception}")
        try:
            interface('2+3')
            return FeatureTestResult(self, True)
        except Exception as exception:
            return FeatureTestResult(self, False,
                                     reason=f"Interface {interface} is not functional: {exception}")

```



---

Comment by mkoeppe created at 2022-01-30 19:58:35

I think this doctest should be marked `# not tested`


---

Comment by slelievre created at 2022-01-31 09:00:19

Mathematica is installed on that machine
but requires a password or token to start.

Running `math` in a shell session goes:

```
$ math
Mathematica 12.1.1 Kernel for Linux x86 (64-bit)
Copyright 1988-2020 Wolfram Research, Inc.

Mathematica 12.1.1 Kernel cannot find a valid password.

For automatic Web Activation enter your activation key
(enter return to skip Web Activation):
```


This is likely what makes the feature detection hang.


---

Comment by slelievre created at 2022-01-31 10:08:10

Changing status from new to needs_review.


---

Comment by slelievre created at 2022-01-31 10:08:10

Replying to [comment:4 mkoeppe]:
> I think this doctest should be marked `# not tested`

Here is a branch doing that.
----
New commits:


---

Comment by slelievre created at 2022-01-31 10:08:10

Changing keywords from "features, mathematica" to "features, mathematica, timeout".


---

Comment by mkoeppe created at 2022-01-31 18:02:52

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-02-13 10:16:36

Resolution: fixed
