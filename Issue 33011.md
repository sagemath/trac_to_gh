# Issue 33011: Fix timeout in feature test for Mathematica

archive/issues_033011.json:
```json
{
    "body": "CC:  @slel\n\nKeywords: features, mathematica\n\nDoctesting `src/sage/features/interfaces.py`\nfails for me with a timeout.\n\n```\nsage: from sage.features.interfaces import Mathematica\nsage: Mathematica().is_present()\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33248\n\n",
    "created_at": "2022-01-30T15:08:40Z",
    "labels": [
        "component: doctest framework",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Fix timeout in feature test for Mathematica",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33011",
    "user": "https://github.com/slel"
}
```
CC:  @slel

Keywords: features, mathematica

Doctesting `src/sage/features/interfaces.py`
fails for me with a timeout.

```
sage: from sage.features.interfaces import Mathematica
sage: Mathematica().is_present()
```


Issue created by migration from https://trac.sagemath.org/ticket/33248





---

archive/issue_comments_470159.json:
```json
{
    "body": "Set milestone to sage-9.6 after Sage 9.5 release.",
    "created_at": "2022-01-30T15:44:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470159",
    "user": "https://github.com/slel"
}
```

Set milestone to sage-9.6 after Sage 9.5 release.



---

archive/issue_events_087802.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2022-01-30T15:44:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33011#event-87802"
}
```



---

archive/issue_comments_470160.json:
```json
{
    "body": "Could we give up on `Mathematica().is_present()`\nafter say a minute?\n\nMaybe using one of the answers to:\n\n- [Stack Overflow question 492519: Timeout on a function call](https://stackoverflow.com/q/492519)",
    "created_at": "2022-01-30T17:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470160",
    "user": "https://github.com/slel"
}
```

Could we give up on `Mathematica().is_present()`
after say a minute?

Maybe using one of the answers to:

- [Stack Overflow question 492519: Timeout on a function call](https://stackoverflow.com/q/492519)



---

archive/issue_comments_470161.json:
```json
{
    "body": "Do you know at which line it gets stuck in what is below ?\n\n\n```python\n    def _is_present(self):\n        \"\"\"\n        TESTS::\n\n            sage: from sage.features.interfaces import InterfaceFeature\n            sage: from sage.interfaces.sage0 import Sage\n            sage: f = InterfaceFeature(\"sage0\", \"sage.interfaces.sage0\")\n            sage: f.is_present()\n            FeatureTestResult('sage0', True)\n        \"\"\"\n        result = self.module.is_present()\n        if not result:\n            return result\n        m = importlib.import_module(self.module.name)\n        try:\n            interface = getattr(m, self.name)\n        except Exception as exception:\n            return FeatureTestResult(self, False,\n                                     reason=f\"Interface {self.name} cannot be imported: {exception}\")\n        try:\n            interface('2+3')\n            return FeatureTestResult(self, True)\n        except Exception as exception:\n            return FeatureTestResult(self, False,\n                                     reason=f\"Interface {interface} is not functional: {exception}\")\n\n```\n",
    "created_at": "2022-01-30T19:16:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470161",
    "user": "https://github.com/seblabbe"
}
```

Do you know at which line it gets stuck in what is below ?


```python
    def _is_present(self):
        """
        TESTS::

            sage: from sage.features.interfaces import InterfaceFeature
            sage: from sage.interfaces.sage0 import Sage
            sage: f = InterfaceFeature("sage0", "sage.interfaces.sage0")
            sage: f.is_present()
            FeatureTestResult('sage0', True)
        """
        result = self.module.is_present()
        if not result:
            return result
        m = importlib.import_module(self.module.name)
        try:
            interface = getattr(m, self.name)
        except Exception as exception:
            return FeatureTestResult(self, False,
                                     reason=f"Interface {self.name} cannot be imported: {exception}")
        try:
            interface('2+3')
            return FeatureTestResult(self, True)
        except Exception as exception:
            return FeatureTestResult(self, False,
                                     reason=f"Interface {interface} is not functional: {exception}")

```




---

archive/issue_comments_470162.json:
```json
{
    "body": "I think this doctest should be marked `# not tested`",
    "created_at": "2022-01-30T19:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470162",
    "user": "https://github.com/mkoeppe"
}
```

I think this doctest should be marked `# not tested`



---

archive/issue_comments_470163.json:
```json
{
    "body": "Mathematica is installed on that machine\nbut requires a password or token to start.\n\nRunning `math` in a shell session goes:\n\n```\n$ math\nMathematica 12.1.1 Kernel for Linux x86 (64-bit)\nCopyright 1988-2020 Wolfram Research, Inc.\n\nMathematica 12.1.1 Kernel cannot find a valid password.\n\nFor automatic Web Activation enter your activation key\n(enter return to skip Web Activation):\n```\n\n\nThis is likely what makes the feature detection hang.",
    "created_at": "2022-01-31T09:00:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470163",
    "user": "https://github.com/slel"
}
```

Mathematica is installed on that machine
but requires a password or token to start.

Running `math` in a shell session goes:

```
$ math
Mathematica 12.1.1 Kernel for Linux x86 (64-bit)
Copyright 1988-2020 Wolfram Research, Inc.

Mathematica 12.1.1 Kernel cannot find a valid password.

For automatic Web Activation enter your activation key
(enter return to skip Web Activation):
```


This is likely what makes the feature detection hang.



---

archive/issue_comments_470164.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-01-31T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470164",
    "user": "https://github.com/slel"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_470165.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> I think this doctest should be marked `# not tested`\n\nHere is a branch doing that.\n----\nNew commits:",
    "created_at": "2022-01-31T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470165",
    "user": "https://github.com/slel"
}
```

Replying to [comment:4 mkoeppe]:
> I think this doctest should be marked `# not tested`

Here is a branch doing that.
----
New commits:



---

archive/issue_comments_470166.json:
```json
{
    "body": "Changing keywords from \"features, mathematica\" to \"features, mathematica, timeout\".",
    "created_at": "2022-01-31T10:08:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470166",
    "user": "https://github.com/slel"
}
```

Changing keywords from "features, mathematica" to "features, mathematica, timeout".



---

archive/issue_comments_470167.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-31T18:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470167",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_087803.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-13T10:16:36Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/33011#event-87803"
}
```



---

archive/issue_comments_470168.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-13T10:16:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33011#issuecomment-470168",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
