# Issue 32489: quaternion ideals' .scale() incorrectly copies cached left and right orders

archive/issues_032489.json:
```json
{
    "body": "CC:  @pjbruin\n\nThe method `QuaternionFractionalIdeal_rational.scale()` simply copies over the existing left and right orders of `self` to the scaled ideal. This is incorrect when the scaling factor does not lie in the center of the algebra, as demonstrated by this example:\n\n\n```sage\nsage: Quat.<i,j,k> = QuaternionAlgebra(-1,-19)\nsage: a = 1+2*i+3*j+4*k\nsage: I = Quat.maximal_order().unit_ideal()\nsage: I.right_order()\nOrder of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/2*j, 1/2*i + 1/2*k, j, k)\nsage: I.scale(a).right_order()\nOrder of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/2*j, 1/2*i + 1/2*k, j, k)\nsage: J = Quat.ideal(I.scale(a).basis(), check=False)\nsage: J == I.scale(a)\nTrue\nsage: J.right_order()\nOrder of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/10*j + 109/5*k, 1/48*i + 1/120*j + 8411/240*k, 1/5*j + 218/5*k, 120*k)\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32726\n\n",
    "created_at": "2021-10-20T06:52:32Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "quaternion ideals' .scale() incorrectly copies cached left and right orders",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32489",
    "user": "https://github.com/yyyyx4"
}
```
CC:  @pjbruin

The method `QuaternionFractionalIdeal_rational.scale()` simply copies over the existing left and right orders of `self` to the scaled ideal. This is incorrect when the scaling factor does not lie in the center of the algebra, as demonstrated by this example:


```sage
sage: Quat.<i,j,k> = QuaternionAlgebra(-1,-19)
sage: a = 1+2*i+3*j+4*k
sage: I = Quat.maximal_order().unit_ideal()
sage: I.right_order()
Order of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/2*j, 1/2*i + 1/2*k, j, k)
sage: I.scale(a).right_order()
Order of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/2*j, 1/2*i + 1/2*k, j, k)
sage: J = Quat.ideal(I.scale(a).basis(), check=False)
sage: J == I.scale(a)
True
sage: J.right_order()
Order of Quaternion Algebra (-1, -19) with base ring Rational Field with basis (1/2 + 1/10*j + 109/5*k, 1/48*i + 1/120*j + 8411/240*k, 1/5*j + 218/5*k, 120*k)
```


Issue created by migration from https://trac.sagemath.org/ticket/32726





---

archive/issue_comments_462875.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-20T08:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462875",
    "user": "https://github.com/yyyyx4"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462876.json:
```json
{
    "body": "Bumping priority since this bug can lead to mathematical errors.",
    "created_at": "2021-10-21T02:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462876",
    "user": "https://github.com/yyyyx4"
}
```

Bumping priority since this bug can lead to mathematical errors.



---

archive/issue_comments_462877.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462877",
    "user": "https://github.com/mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_comments_462878.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-01-18T09:03:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462878",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462879.json:
```json
{
    "body": "This looks OK to me but I'm not an expert so I have two questions:\n\n1. I guess scaling on the right doesn't affect the left order, and vice-versa?\n2. Is it OK to assume that the base ring is `QQ`?",
    "created_at": "2022-01-23T21:50:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462879",
    "user": "https://github.com/orlitzky"
}
```

This looks OK to me but I'm not an expert so I have two questions:

1. I guess scaling on the right doesn't affect the left order, and vice-versa?
2. Is it OK to assume that the base ring is `QQ`?



---

archive/issue_comments_462880.json:
```json
{
    "body": "Thanks for having a look.\n\n1. Yes; the left order of `I` is `{x in the algebra | x\u00b7I \u2286 I}`. Scaling happens element-wise, so these inclusions are preserved under right scaling. Similarly on the other side.\n2. Yes; the class `QuaternionFractionalIdeal_rational` is specific to `QQ`.",
    "created_at": "2022-01-24T02:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462880",
    "user": "https://github.com/yyyyx4"
}
```

Thanks for having a look.

1. Yes; the left order of `I` is `{x in the algebra | x·I ⊆ I}`. Scaling happens element-wise, so these inclusions are preserved under right scaling. Similarly on the other side.
2. Yes; the class `QuaternionFractionalIdeal_rational` is specific to `QQ`.



---

archive/issue_comments_462881.json:
```json
{
    "body": "LGTM then, thanks.",
    "created_at": "2022-01-24T12:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462881",
    "user": "https://github.com/orlitzky"
}
```

LGTM then, thanks.



---

archive/issue_comments_462882.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-01-24T12:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462882",
    "user": "https://github.com/orlitzky"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462883.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-01-31T23:31:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32489",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32489#issuecomment-462883",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
