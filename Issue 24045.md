# Issue 24045: BooleanFunction.truth_table(format="hex") returns wrong values

Issue created by migration from https://trac.sagemath.org/ticket/24282

Original creator: pleopardi

Original creation time: 2017-11-26 11:14:36

Sometimes, especially with functions of 8 variables, the method BooleanFunction.truth_table(format='hex") returns incorrect values that are also too long.

Example:


```
sage: from sage.rings.integer_ring import ZZ
sage: from sage.crypto.boolean_function import BooleanFunction
sage: hex_str = "0123456789112345678921234567893123456789412345678951234567896123"
sage: len(hex_str)
64
sage: bf = BooleanFunction(hex_str)
sage: bf.nvariables()
8
sage: bf_tt_hex = bf.truth_table(format="hex")
sage: bf_tt_hex
'123456789112345678921234567893123456789412345670123456789112345678921234567893123456789412345678951234567896123'
sage: len(bf_tt_hex)
111
sage: S = ZZ(bf.truth_table(), 2).str(16)
sage: padding = "0" * ((1 << (bf.nvariables() - 2)) - len(S))
sage: tt_hex = padding + S
sage: tt_hex
'0123456789112345678921234567893123456789412345678951234567896123'
sage: len(tt_hex)
64
```


The example also shows how the code in  https://github.com/sagemath/sage/blob/develop/src/sage/crypto/boolean_function.pyx lines 566 to 576 should be fixed. A suggested patch is attached. 

The example can also be used as the basis for a test case once the patch has been applied.


---

Attachment

Patch to boolean_function.pyx to retrun correct value for truth_table(format='hex')


---

Comment by dimpase created at 2017-11-26 11:50:58

Thanks. Could you provide a test example and a git branch for the fix, too?


---

Comment by pleopardi created at 2017-11-28 12:22:22

A working test example may take me a little time as I have not yet built Sage from Git. I could mock up a test example for someone else to test, if that is acceptable.


---

Comment by pleopardi created at 2017-11-28 12:38:03

Also, I am new at providing Git branches for Sage. I will carefully read the instructions at http://doc.sagemath.org/html/en/developer/manual_git.html and use them to provide a Git branch. This may have to wait until the weekend.


---

Comment by pleopardi created at 2017-12-02 08:21:06

As far as I can tell, I have pushed my recommended changes to the branch u/pleopardi/fix_boolean_function_truth_table_hex

This is the first time I have created a branch in trac, so I may have made a mistake that I'm not aware of.


---

Comment by pleopardi created at 2017-12-02 08:21:06

Changing status from new to needs_review.


---

Comment by dimpase created at 2017-12-04 23:33:56

I would have cut most of these 

```
sage: len(T)
...
```

from the example in your branch.
Have you tried building the documentation with this branch applied?


---

Comment by git created at 2017-12-06 08:44:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by pleopardi created at 2017-12-06 08:49:11

I have now cut some of the len expressions from the doctest, have retested sage/crypto, and have tried rebuilding the documentation. All seems fine to me.


---

Comment by dimpase created at 2017-12-06 09:21:48

Looks good to me; however, it probably needs testing on a 32-bit machine. Hopefully a patchbot will do.

PS. Please enter the author's name in Authors.


---

Comment by dimpase created at 2017-12-06 09:21:48

Changing status from needs_review to positive_review.


---

Comment by pleopardi created at 2017-12-06 12:31:50

I have added my name to Authors.


---

Comment by vbraun created at 2017-12-13 17:37:52

Resolution: fixed
