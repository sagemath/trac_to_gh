# Issue 24045: BooleanFunction.truth_table(format="hex") returns wrong values

archive/issues_024045.json:
```json
{
    "body": "Sometimes, especially with functions of 8 variables, the method BooleanFunction.truth_table(format='hex\") returns incorrect values that are also too long.\n\nExample:\n\n\n```\nsage: from sage.rings.integer_ring import ZZ\nsage: from sage.crypto.boolean_function import BooleanFunction\nsage: hex_str = \"0123456789112345678921234567893123456789412345678951234567896123\"\nsage: len(hex_str)\n64\nsage: bf = BooleanFunction(hex_str)\nsage: bf.nvariables()\n8\nsage: bf_tt_hex = bf.truth_table(format=\"hex\")\nsage: bf_tt_hex\n'123456789112345678921234567893123456789412345670123456789112345678921234567893123456789412345678951234567896123'\nsage: len(bf_tt_hex)\n111\nsage: S = ZZ(bf.truth_table(), 2).str(16)\nsage: padding = \"0\" * ((1 << (bf.nvariables() - 2)) - len(S))\nsage: tt_hex = padding + S\nsage: tt_hex\n'0123456789112345678921234567893123456789412345678951234567896123'\nsage: len(tt_hex)\n64\n```\n\n\nThe example also shows how the code in  https://github.com/sagemath/sage/blob/develop/src/sage/crypto/boolean_function.pyx lines 566 to 576 should be fixed. A suggested patch is attached. \n\nThe example can also be used as the basis for a test case once the patch has been applied.\n\nIssue created by migration from https://trac.sagemath.org/ticket/24282\n\n",
    "created_at": "2017-11-26T11:14:36Z",
    "labels": [
        "cryptography",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.2",
    "title": "BooleanFunction.truth_table(format=\"hex\") returns wrong values",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/24045",
    "user": "pleopardi"
}
```
Sometimes, especially with functions of 8 variables, the method BooleanFunction.truth_table(format='hex") returns incorrect values that are also too long.

Example:


```
sage: from sage.rings.integer_ring import ZZ
sage: from sage.crypto.boolean_function import BooleanFunction
sage: hex_str = "0123456789112345678921234567893123456789412345678951234567896123"
sage: len(hex_str)
64
sage: bf = BooleanFunction(hex_str)
sage: bf.nvariables()
8
sage: bf_tt_hex = bf.truth_table(format="hex")
sage: bf_tt_hex
'123456789112345678921234567893123456789412345670123456789112345678921234567893123456789412345678951234567896123'
sage: len(bf_tt_hex)
111
sage: S = ZZ(bf.truth_table(), 2).str(16)
sage: padding = "0" * ((1 << (bf.nvariables() - 2)) - len(S))
sage: tt_hex = padding + S
sage: tt_hex
'0123456789112345678921234567893123456789412345678951234567896123'
sage: len(tt_hex)
64
```


The example also shows how the code in  https://github.com/sagemath/sage/blob/develop/src/sage/crypto/boolean_function.pyx lines 566 to 576 should be fixed. A suggested patch is attached. 

The example can also be used as the basis for a test case once the patch has been applied.

Issue created by migration from https://trac.sagemath.org/ticket/24282





---

archive/issue_comments_337071.json:
```json
{
    "body": "Attachment [boolean_function-correct_truth_table_hex.patch](tarball://root/attachments/some-uuid/ticket24282/boolean_function-correct_truth_table_hex.patch) by pleopardi created at 2017-11-26 11:16:16\n\nPatch to boolean_function.pyx to retrun correct value for truth_table(format='hex')",
    "created_at": "2017-11-26T11:16:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337071",
    "user": "pleopardi"
}
```

Attachment [boolean_function-correct_truth_table_hex.patch](tarball://root/attachments/some-uuid/ticket24282/boolean_function-correct_truth_table_hex.patch) by pleopardi created at 2017-11-26 11:16:16

Patch to boolean_function.pyx to retrun correct value for truth_table(format='hex')



---

archive/issue_comments_337072.json:
```json
{
    "body": "Thanks. Could you provide a test example and a git branch for the fix, too?",
    "created_at": "2017-11-26T11:50:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337072",
    "user": "dimpase"
}
```

Thanks. Could you provide a test example and a git branch for the fix, too?



---

archive/issue_comments_337073.json:
```json
{
    "body": "A working test example may take me a little time as I have not yet built Sage from Git. I could mock up a test example for someone else to test, if that is acceptable.",
    "created_at": "2017-11-28T12:22:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337073",
    "user": "pleopardi"
}
```

A working test example may take me a little time as I have not yet built Sage from Git. I could mock up a test example for someone else to test, if that is acceptable.



---

archive/issue_comments_337074.json:
```json
{
    "body": "Also, I am new at providing Git branches for Sage. I will carefully read the instructions at http://doc.sagemath.org/html/en/developer/manual_git.html and use them to provide a Git branch. This may have to wait until the weekend.",
    "created_at": "2017-11-28T12:38:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337074",
    "user": "pleopardi"
}
```

Also, I am new at providing Git branches for Sage. I will carefully read the instructions at http://doc.sagemath.org/html/en/developer/manual_git.html and use them to provide a Git branch. This may have to wait until the weekend.



---

archive/issue_comments_337075.json:
```json
{
    "body": "As far as I can tell, I have pushed my recommended changes to the branch u/pleopardi/fix_boolean_function_truth_table_hex\n\nThis is the first time I have created a branch in trac, so I may have made a mistake that I'm not aware of.",
    "created_at": "2017-12-02T08:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337075",
    "user": "pleopardi"
}
```

As far as I can tell, I have pushed my recommended changes to the branch u/pleopardi/fix_boolean_function_truth_table_hex

This is the first time I have created a branch in trac, so I may have made a mistake that I'm not aware of.



---

archive/issue_comments_337076.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-12-02T08:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337076",
    "user": "pleopardi"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_337077.json:
```json
{
    "body": "I would have cut most of these \n\n```\nsage: len(T)\n...\n```\n\nfrom the example in your branch.\nHave you tried building the documentation with this branch applied?",
    "created_at": "2017-12-04T23:33:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337077",
    "user": "dimpase"
}
```

I would have cut most of these 

```
sage: len(T)
...
```

from the example in your branch.
Have you tried building the documentation with this branch applied?



---

archive/issue_comments_337078.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-12-06T08:44:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337078",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_337079.json:
```json
{
    "body": "I have now cut some of the len expressions from the doctest, have retested sage/crypto, and have tried rebuilding the documentation. All seems fine to me.",
    "created_at": "2017-12-06T08:49:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337079",
    "user": "pleopardi"
}
```

I have now cut some of the len expressions from the doctest, have retested sage/crypto, and have tried rebuilding the documentation. All seems fine to me.



---

archive/issue_comments_337080.json:
```json
{
    "body": "Looks good to me; however, it probably needs testing on a 32-bit machine. Hopefully a patchbot will do.\n\nPS. Please enter the author's name in Authors.",
    "created_at": "2017-12-06T09:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337080",
    "user": "dimpase"
}
```

Looks good to me; however, it probably needs testing on a 32-bit machine. Hopefully a patchbot will do.

PS. Please enter the author's name in Authors.



---

archive/issue_comments_337081.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-12-06T09:21:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337081",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_337082.json:
```json
{
    "body": "I have added my name to Authors.",
    "created_at": "2017-12-06T12:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337082",
    "user": "pleopardi"
}
```

I have added my name to Authors.



---

archive/issue_comments_337083.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-12-13T17:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/24045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/24045#issuecomment-337083",
    "user": "vbraun"
}
```

Resolution: fixed
