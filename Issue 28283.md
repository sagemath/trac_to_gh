# Issue 28283: random_matrix shouldn't error out on missing num_pivots with algorithm='echelon_form'

archive/issues_028283.json:
```json
{
    "body": "The following innocent code gives a TypeError:\n\n```\ne=random_matrix(ZZ,4,5,algorithm='echelon_form')\n```\n\nwhile I should have given:\n\n```\ne=random_matrix(ZZ,4,5,algorithm='echelon_form', num_pivots=3)\n```\n\n\nThe code should just use a random value for the number of pivots when the argument isn't given.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28520\n\n",
    "created_at": "2019-09-19T20:42:17Z",
    "labels": [
        "linear algebra",
        "major",
        "bug"
    ],
    "title": "random_matrix shouldn't error out on missing num_pivots with algorithm='echelon_form'",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28283",
    "user": "Snark"
}
```
The following innocent code gives a TypeError:

```
e=random_matrix(ZZ,4,5,algorithm='echelon_form')
```

while I should have given:

```
e=random_matrix(ZZ,4,5,algorithm='echelon_form', num_pivots=3)
```


The code should just use a random value for the number of pivots when the argument isn't given.

Issue created by migration from https://trac.sagemath.org/ticket/28520





---

archive/issue_comments_399540.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2020-01-06T14:10:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28283#issuecomment-399540",
    "user": "embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_399541.json:
```json
{
    "body": "I would like to work on this issue. \nSo, when either `random_matrix()` or `matrix.random()` is called with the keyword argument `algorithm=echelon_form`, the following piece of code gets run:\n\n\n```\n   def random_matrix(...):\n      ...\n      elif algorithm == 'echelon_form':\n          return random_rref_matrix(parent, *args, **kwds)\n```\n\n\nThis calls the following signature:\n\n\n```\ndef random_rref_matrix(parent, num_pivots)\n```\n\n\nBoth of these pieces of code are in the file: `sage/local/lib/python3.7/site-packages/sage/matrix/special.py`\n\nNow I guess I have two options to fix it:\n\n1. Make changes in the `random_matrix()` function:\n    I could check whether kwds has the value `num_pivots`. If it doesn't, I will call `random_rref_matrix` with a random number in the range [0, min(nrows, ncols)]. Will also have to check if `ncols` is there or not. \n\nI guess this is safe but will make the code look a little ugly.\n\n2. Make changes to the `random_rref_matrix()` function:\n    I will change the signature to include a `*args` and a `**kwds`. Check within the function for the existence of `num_pivots` and assign `num_pivots` appropriately if it is not there. \n\nWill have to ensure the error messages would be the same as before? Seems a bit unsafe as a lot of other functions might call this function, but should be cleaner.\n\nWhich way should I proceed? Is there anything I'm missing?",
    "created_at": "2020-01-18T14:22:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28283#issuecomment-399541",
    "user": "@Tinkidinki"
}
```

I would like to work on this issue. 
So, when either `random_matrix()` or `matrix.random()` is called with the keyword argument `algorithm=echelon_form`, the following piece of code gets run:


```
   def random_matrix(...):
      ...
      elif algorithm == 'echelon_form':
          return random_rref_matrix(parent, *args, **kwds)
```


This calls the following signature:


```
def random_rref_matrix(parent, num_pivots)
```


Both of these pieces of code are in the file: `sage/local/lib/python3.7/site-packages/sage/matrix/special.py`

Now I guess I have two options to fix it:

1. Make changes in the `random_matrix()` function:
    I could check whether kwds has the value `num_pivots`. If it doesn't, I will call `random_rref_matrix` with a random number in the range [0, min(nrows, ncols)]. Will also have to check if `ncols` is there or not. 

I guess this is safe but will make the code look a little ugly.

2. Make changes to the `random_rref_matrix()` function:
    I will change the signature to include a `*args` and a `**kwds`. Check within the function for the existence of `num_pivots` and assign `num_pivots` appropriately if it is not there. 

Will have to ensure the error messages would be the same as before? Seems a bit unsafe as a lot of other functions might call this function, but should be cleaner.

Which way should I proceed? Is there anything I'm missing?



---

archive/issue_comments_399542.json:
```json
{
    "body": "Link to the Google groups discussion pertaining to this ticket: https://groups.google.com/forum/#!topic/sage-devel/Hvk1CeF8dw0\n\nEssentially, the proposal in the previous comment I made would not work as it would not maintain the random distribution from which matrices are sampled (as matrices are not equally distributed for each 'number of pivots'). The solution was to either explicitly decide a distribution and write code to generate matrices from it (see Google groups discussion) or to default at `num_pivots` being equal to the maximum number of pivots. \n\nI personally feel the former approach is better as it provides greater functionality - anyone who wants maximum number of pivots could just specify it, however, there currently exists no functionality to generate a completely random echelon matrix. \n\nHopefully this helps whoever picks up this ticket.",
    "created_at": "2020-02-14T05:50:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28283#issuecomment-399542",
    "user": "@Tinkidinki"
}
```

Link to the Google groups discussion pertaining to this ticket: https://groups.google.com/forum/#!topic/sage-devel/Hvk1CeF8dw0

Essentially, the proposal in the previous comment I made would not work as it would not maintain the random distribution from which matrices are sampled (as matrices are not equally distributed for each 'number of pivots'). The solution was to either explicitly decide a distribution and write code to generate matrices from it (see Google groups discussion) or to default at `num_pivots` being equal to the maximum number of pivots. 

I personally feel the former approach is better as it provides greater functionality - anyone who wants maximum number of pivots could just specify it, however, there currently exists no functionality to generate a completely random echelon matrix. 

Hopefully this helps whoever picks up this ticket.



---

archive/issue_comments_399543.json:
```json
{
    "body": "Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.",
    "created_at": "2020-05-01T04:28:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28283#issuecomment-399543",
    "user": "mkoeppe"
}
```

Moving tickets to milestone sage-9.2 based on a review of last modification date, branch status, and severity.



---

archive/issue_comments_399544.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-04-07T19:29:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28283",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28283#issuecomment-399544",
    "user": "mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.
