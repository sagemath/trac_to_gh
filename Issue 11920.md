# Issue 11920: get doctest coverage of databases/stein_watkins.py to 100%

Issue created by migration from https://trac.sagemath.org/ticket/12092

Original creator: minz

Original creation time: 2011-11-28 09:22:02

Assignee: mvngu

CC:  was

Part of metaticket #12024


---

Comment by minz created at 2011-11-28 09:27:46

Changing status from new to needs_review.


---

Comment by minz created at 2011-11-28 09:27:46

One thing I found curious was the function _lines(s). It doesn't seem to be used anywhere and moreover when iterating over the input string, it skips over the last line. (Was this somehow related to #10582 ?)


---

Comment by kcrisman created at 2012-02-10 02:36:19

In general, this looks good.  However, I have a suspicion that it may not actually work.  Note that all the original doctests at the top have

```
# optional - stein_watkins_database
```

Should that be added to the others?  Likely.

I agree about `_lines`.  It's not used anywhere.

```

sage: search_src('\._lines')
databases/stein_watkins.py:202:        sage: l = sage.databases.stein_watkins._lines("\n some \ntext")
geometry/cone.py:392:        cone._lines = lines
geometry/cone.py:2765:            self._lines = lines
geometry/cone.py:2766:        return self._lines
geometry/polyhedra.py:3054:            return self._lines
geometry/polyhedra.py:3056:            self._lines = [list(x) for x in self.line_generator()]
geometry/polyhedra.py:3057:            return self._lines   
interfaces/qepcad.py:2183:        self._lines = lines
```

This has been in Sage practically from the beginning, though.  cc:ing William, but I suppose we can leave it in for now.

```
changeset:   0:039f6310c6fe
user:        tornaria@math.utexas.edu
date:        Sat Feb 11 01:13:08 2006 +0000
summary:     [project @ original sage-0.10.12]
```



---

Comment by kcrisman created at 2012-02-10 02:36:19

Changing status from needs_review to needs_work.


---

Comment by minz created at 2012-02-12 16:04:14

Many thanks for your comments! "# optional ..." now added everywhere.


---

Comment by minz created at 2012-02-12 16:04:14

Changing status from needs_work to needs_review.


---

Comment by davidloeffler created at 2012-03-14 12:13:39

In testing this, I spotted that the instructions at the head of the file for installing the mini Stein-Watkins database are wrong: instead of

```
sage -i stein-watkins-ecdb-mini
```

it should be

```
sage -i database_stein_watkins_mini.p0
```

(at least, I tried various permutations and that's the only one I could find that worked). 

More seriously, the download link for the full database, [http://modular.ucsd.edu/sagedb/](http://modular.ucsd.edu/sagedb/), seems to be dead; and one of the new doctests *fails* if only the mini Stein-Watkins database, not the full one, is installed.

I suggest we seek clarification of this on sage-devel before going any further with this ticket.


---

Comment by davidloeffler created at 2012-03-14 12:13:39

Changing status from needs_review to needs_info.


---

Comment by davidloeffler created at 2012-03-14 14:04:57

Apply [attachment:trac_12092_doctests-v2.patch], [attachment:trac_12092-review.patch]

Here's a patch which updates the web links, and adds a short explanation of what the `ecdb_num_curves` function actually does. We should probably sit on this one until the trivial issue with "sage -i" not automatically downloading the right version of the mini spkg is fixed, since we might then have to change the instructions here. (I guess reporting this on sage-nt counts as "upstream"?)


---

Comment by davidloeffler created at 2012-03-14 14:05:32

Sorry, patchbot doesn't understand trac links. Trying again:

Apply trac_12092_doctests-v2.patch, trac_12092-review.patch


---

Comment by jdemeyer created at 2012-04-02 09:21:51

Replying to [comment:5 davidloeffler]:
> We should probably sit on this one until the trivial issue with "sage -i" not automatically downloading the right version of the mini spkg is fixed

I answered this on sage-nt:

```
The problem is the name of the package is missing a version number: it
should be something like
database_stein_watkins_mini-VERSION.p0.spkg

(where VERSION should be a date like 20120314 if there is no real
version number)
```



---

Comment by davidloeffler created at 2012-04-03 19:02:18

Who is able to change the offending file name?


---

Comment by chapoton created at 2012-11-14 16:15:06

folded and rebased on 5.2


---

Comment by chapoton created at 2012-11-14 16:16:29

Changing status from needs_info to needs_review.


---

Attachment

apply trac_12092_doctests-v3.patch

I have folded the two patches and rebased on 5.2. I hope that I have not lost something in the process.


---

Comment by jdemeyer created at 2013-02-06 16:28:30

Can this ticket get reviewed before this work gets lost?


---

Comment by kcrisman created at 2013-02-06 18:37:16

When running optional doctests before installing,

```
    IOError: The Stein-Watkins data file /Users/...sage-5.7.beta3/local/share/stein-watkins-ecdb/a.000.bz2 must be installed.
```

But of course there is no such file.  And attempting the "small" version gives

```
$ sage -i database-stein-watkins-mini.p0
Attempting to download package database-stein-watkins-mini.p0
>>> Checking online list of optional packages.
[.]
>>> Checking online list of experimental packages.
[.]
>>> Checking online list of standard packages.
[.]
>>> Checking online list of archive packages.
[.]
Error: could not find a package matching database-stein-watkins-mini.p0 in http://www.sagemath.org/packages
```

same without the p0.  However, checking the list of optional packages shows that

```
$ sage -i database_stein_watkins_mini.p0
```

works - and only that with the p0, interestingly.

However, that is not enough to pass the tests.  It's not clear to me if there is a bug that none of the tests seems to work with it, or not.

> Who is able to change the offending file name?
I think that for now this solution is appropriate, given that the instructions are clear (or will be, once I submit a reviewer patch for the underscores).

It will take me a while to download the actual database to make sure that tests do pass then :)


---

Comment by kcrisman created at 2013-02-06 18:47:15

Okay, without knowing whether there is a reason to have some doctests `stein_watkins_database` and others `database_stein_watkins`, I'm making that uniform.


---

Comment by kcrisman created at 2013-02-06 18:49:38

Patchbot, apply trac_12092_doctests-v3.patch and trac_12092-reviewer.patch


---

Comment by kcrisman created at 2013-02-07 02:20:58

> However, that is not enough to pass the tests.  It's not clear to me if there is a bug that none of the tests seems to work with it, or not.
Or at least not all of them.
> It will take me a while to download the actual database to make sure that tests do pass then :)

```

sage -t -optional "devel/sage/sage/databases/stein_watkins.py"
	 [107.2 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 107.2 seconds
```

I suppose in principle my reviewer patch needs a review.  Jeroen, since you wanted this in, perhaps you could do the honors - it's one real change and then I made things consistent.  (Unless we really want to identify which tests work with and without the "mini" package.)


---

Comment by jdemeyer created at 2013-02-07 07:18:18

I think you made it uniform in the wrong way.  The actual package name is "database_stein_watkins_mini.p0", so the `sage -i` command needs to be fixed.  I would also use

```
# optional - database_stein_watkins
```

everywhere.


---

Comment by kcrisman created at 2013-02-07 14:54:32

Right, but the point is that the mini package doesn't allow all tests to pass, only the "big" one, which is called stein-watkins-ecdb.spkg.  I didn't want to go against the flow and use ecdb when no previous tests did.  The tests without the optional do pass under normal conditions (without either spkg installed), so I don't know that needs to be fixed.

I didn't read this as the sage -i command needing a fix - the thread referenced makes it clear that the "right" fix is to rename that spkg database_stein_watkins_mini-1.p0 or something.

Anyway, this isn't that important to me, so I am not really motivated to do any other fixing on it.  It's probably not worth the effort, honestly.


---

Comment by jdemeyer created at 2013-02-07 15:03:48

I didn't say you needed to rename the package, but at least in the documentation give a "sage -i" command which works:

```
sage -i http://modular.math.washington.edu/sagedb/stein-watkins-ecdb.spkg
```

and

```
sage -i database_stein_watkins_mini.p0
```

(you might have unintentionally changed that last command)

I don't think it's particularly important to fix this ticket, but I always find it a pity to leave tickets "almost ready" when they are fairly trivial to fix.


---

Comment by kcrisman created at 2013-02-07 15:08:16

> I didn't say you needed to rename the package, but at least in the documentation give a "sage -i" command which works:
> {{{
> sage -i http://modular.math.washington.edu/sagedb/stein-watkins-ecdb.spkg
> }}}
I just left the old instructions to "manually" download, which I used.  Would this work, then?  I imagine so.
> {{{
> sage -i database_stein_watkins_mini.p0
> }}}
> (you might have unintentionally changed that last command)
Yup, you are totally right, glad I asked for review!  I'll fix that too.
> I don't think it's particularly important to fix this ticket, but I always find it a pity to leave tickets "almost ready" when they are fairly trivial to fix.
Agreed; what I meant was that it wasn't important to bikeshed here.


---

Attachment

I know why I missed that erroneous change - because I had already changed that line to put underscores in, so I wasn't surprised to see the diff at that spot.  Thanks a lot for catching that.

All is well now?  I did check that the "big" command works and change a little verbiage appropriately.


---

Comment by kcrisman created at 2013-02-07 15:14:15

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-02-07 15:47:19

Good!


---

Comment by jdemeyer created at 2013-02-09 12:12:11

Resolution: fixed
