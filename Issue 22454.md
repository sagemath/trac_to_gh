# Issue 22454: Cypari2 sigabrt in debug build

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2017-03-27 17:00:34

CC:  defeo jdemeyer

A build with `SAGE_DEBUG=yes` yields numerous failures of the form

```
File "src/sage/libs/cypari2/closure.pyx", line 13, in sage.libs.cypari2.closure
Failed example:
    f()
Expected:
    42
Got:
    <BLANKLINE>
    *** WARNING *** sig_block() with sig_on_count = 2, block_sigint = 1
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4558)[0x7f3d3fa8a558]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x25b7)[0x7f3d336ea5b7]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e19)[0x7f3d336eae19]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e86)[0x7f3d336eae86]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x27bb)[0x7f3d336ea7bb]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2c00)[0x7f3d336eac00]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x28fc)[0x7f3d336ea8fc]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/pari/convert_gmp.so(+0x2833)[0x7f353cf9d833]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82d71)[0x7f3d35a15d71]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x83087)[0x7f3d35a16087]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82fdd)[0x7f3d35a15fdd]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d8c5)[0x7f3d33c638c5]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15db3f)[0x7f3d33c63b3f]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1530a7)[0x7f3d33c590a7]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2c2d)[0x7f3d334a2c2d]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2f58)[0x7f3d334a2f58]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46e355)[0x7f3d3f659355]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46b373)[0x7f3d3f656373]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x476acc)[0x7f3d3f661acc]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(closure_callgenvec+0x173)[0x7f3d3f663053]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x146e4d)[0x7f3d33c4ce4d]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1463be)[0x7f3d33c4c3be]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyCFunction_Call+0xbc)[0x7f3d4ca31ba0]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d063)[0x7f3d33c63063]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148c7a)[0x7f3d33c4ec7a]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148a83)[0x7f3d33c4ea83]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f3d4c9ccf3a]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1636fe)[0x7f3d4cade6fe]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x162a40)[0x7f3d4cadda40]
[...]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f3d4cb0d76f]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2f)[0x7f3d4cb29b3a]
    python(main+0x20)[0x400806]
    /lib64/libc.so.6(__libc_start_main+0xf1)[0x7f3d4bca7401]
    python(_start+0x2a)[0x40071a]
    ------------------------------------------------------------------------
    42
**********************************************************************
```



---

Comment by jdemeyer created at 2017-03-28 12:32:30

Resolution: duplicate


---

Comment by jdemeyer created at 2017-03-28 12:32:30

Duplicate of #22584 I guess.


---

Comment by vbraun created at 2017-04-22 20:10:40

Changing status from closed to new.


---

Comment by vbraun created at 2017-04-22 20:10:40

Issue still exists, reopening...


---

Comment by vbraun created at 2017-04-22 20:10:40

Resolution changed from duplicate to 


---

Comment by jdemeyer created at 2017-04-23 13:22:40

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-04-23 13:22:40

New commits:


---

Comment by vbraun created at 2017-04-23 14:08:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2017-04-23 18:11:13

Note that this still doesn't fix the issue 100%. It's an improvement over the existing situation, but there is still a non-deterministic problem with `bernmm.pyx` (probably due to the use of multi-threading, see https://github.com/sagemath/cysignals/issues/21)


---

Comment by vbraun created at 2017-04-25 17:39:58

Resolution: fixed
