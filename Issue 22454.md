# Issue 22454: Cypari2 sigabrt in debug build

archive/issues_022454.json:
```json
{
    "body": "CC:  @defeo @jdemeyer\n\nA build with `SAGE_DEBUG=yes` yields numerous failures of the form\n\n```\nFile \"src/sage/libs/cypari2/closure.pyx\", line 13, in sage.libs.cypari2.closure\nFailed example:\n    f()\nExpected:\n    42\nGot:\n    <BLANKLINE>\n    *** WARNING *** sig_block() with sig_on_count = 2, block_sigint = 1\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4558)[0x7f3d3fa8a558]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x25b7)[0x7f3d336ea5b7]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e19)[0x7f3d336eae19]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e86)[0x7f3d336eae86]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x27bb)[0x7f3d336ea7bb]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2c00)[0x7f3d336eac00]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x28fc)[0x7f3d336ea8fc]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/pari/convert_gmp.so(+0x2833)[0x7f353cf9d833]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82d71)[0x7f3d35a15d71]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x83087)[0x7f3d35a16087]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82fdd)[0x7f3d35a15fdd]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d8c5)[0x7f3d33c638c5]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15db3f)[0x7f3d33c63b3f]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1530a7)[0x7f3d33c590a7]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2c2d)[0x7f3d334a2c2d]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2f58)[0x7f3d334a2f58]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46e355)[0x7f3d3f659355]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46b373)[0x7f3d3f656373]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x476acc)[0x7f3d3f661acc]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(closure_callgenvec+0x173)[0x7f3d3f663053]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x146e4d)[0x7f3d33c4ce4d]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1463be)[0x7f3d33c4c3be]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyCFunction_Call+0xbc)[0x7f3d4ca31ba0]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d063)[0x7f3d33c63063]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148c7a)[0x7f3d33c4ec7a]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148a83)[0x7f3d33c4ea83]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f3d4c9ccf3a]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1636fe)[0x7f3d4cade6fe]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x162a40)[0x7f3d4cadda40]\n[...]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f3d4cb0d76f]\n    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2f)[0x7f3d4cb29b3a]\n    python(main+0x20)[0x400806]\n    /lib64/libc.so.6(__libc_start_main+0xf1)[0x7f3d4bca7401]\n    python(_start+0x2a)[0x40071a]\n    ------------------------------------------------------------------------\n    42\n**********************************************************************\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/22691\n\n",
    "created_at": "2017-03-27T17:00:34Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Cypari2 sigabrt in debug build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22454",
    "user": "@vbraun"
}
```
CC:  @defeo @jdemeyer

A build with `SAGE_DEBUG=yes` yields numerous failures of the form

```
File "src/sage/libs/cypari2/closure.pyx", line 13, in sage.libs.cypari2.closure
Failed example:
    f()
Expected:
    42
Got:
    <BLANKLINE>
    *** WARNING *** sig_block() with sig_on_count = 2, block_sigint = 1
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/cysignals/signals.so(+0x4558)[0x7f3d3fa8a558]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x25b7)[0x7f3d336ea5b7]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e19)[0x7f3d336eae19]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2e86)[0x7f3d336eae86]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x27bb)[0x7f3d336ea7bb]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x2c00)[0x7f3d336eac00]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/stack.so(+0x28fc)[0x7f3d336ea8fc]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/pari/convert_gmp.so(+0x2833)[0x7f353cf9d833]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82d71)[0x7f3d35a15d71]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x83087)[0x7f3d35a16087]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/rings/integer.so(+0x82fdd)[0x7f3d35a15fdd]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d8c5)[0x7f3d33c638c5]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15db3f)[0x7f3d33c63b3f]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1530a7)[0x7f3d33c590a7]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2c2d)[0x7f3d334a2c2d]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/closure.so(+0x2f58)[0x7f3d334a2f58]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46e355)[0x7f3d3f659355]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x46b373)[0x7f3d3f656373]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(+0x476acc)[0x7f3d3f661acc]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpari-gmp.so.5(closure_callgenvec+0x173)[0x7f3d3f663053]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x146e4d)[0x7f3d33c4ce4d]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x1463be)[0x7f3d33c4c3be]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyCFunction_Call+0xbc)[0x7f3d4ca31ba0]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x15d063)[0x7f3d33c63063]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148c7a)[0x7f3d33c4ec7a]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/python2.7/site-packages/sage/libs/cypari2/gen.so(+0x148a83)[0x7f3d33c4ea83]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyObject_Call+0x7f)[0x7f3d4c9ccf3a]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x1636fe)[0x7f3d4cade6fe]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(+0x162a40)[0x7f3d4cadda40]
[...]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(PyRun_AnyFileExFlags+0x88)[0x7f3d4cb0d76f]
    /mnt/disk/home/buildslave-sage/slave/sage_git/build/local/lib/libpython2.7.so.1.0(Py_Main+0xd2f)[0x7f3d4cb29b3a]
    python(main+0x20)[0x400806]
    /lib64/libc.so.6(__libc_start_main+0xf1)[0x7f3d4bca7401]
    python(_start+0x2a)[0x40071a]
    ------------------------------------------------------------------------
    42
**********************************************************************
```


Issue created by migration from https://trac.sagemath.org/ticket/22691





---

archive/issue_comments_312894.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2017-03-28T12:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312894",
    "user": "@jdemeyer"
}
```

Resolution: duplicate



---

archive/issue_comments_312895.json:
```json
{
    "body": "Duplicate of #22584 I guess.",
    "created_at": "2017-03-28T12:32:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312895",
    "user": "@jdemeyer"
}
```

Duplicate of #22584 I guess.



---

archive/issue_comments_312896.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2017-04-22T20:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312896",
    "user": "@vbraun"
}
```

Changing status from closed to new.



---

archive/issue_comments_312897.json:
```json
{
    "body": "Issue still exists, reopening...",
    "created_at": "2017-04-22T20:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312897",
    "user": "@vbraun"
}
```

Issue still exists, reopening...



---

archive/issue_comments_312898.json:
```json
{
    "body": "Resolution changed from duplicate to ",
    "created_at": "2017-04-22T20:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312898",
    "user": "@vbraun"
}
```

Resolution changed from duplicate to 



---

archive/issue_comments_312899.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-23T13:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312899",
    "user": "@jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_312900.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-04-23T13:22:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312900",
    "user": "@jdemeyer"
}
```

New commits:



---

archive/issue_comments_312901.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-23T14:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312901",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_312902.json:
```json
{
    "body": "Note that this still doesn't fix the issue 100%. It's an improvement over the existing situation, but there is still a non-deterministic problem with `bernmm.pyx` (probably due to the use of multi-threading, see https://github.com/sagemath/cysignals/issues/21)",
    "created_at": "2017-04-23T18:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312902",
    "user": "@jdemeyer"
}
```

Note that this still doesn't fix the issue 100%. It's an improvement over the existing situation, but there is still a non-deterministic problem with `bernmm.pyx` (probably due to the use of multi-threading, see https://github.com/sagemath/cysignals/issues/21)



---

archive/issue_comments_312903.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-25T17:39:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22454",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22454#issuecomment-312903",
    "user": "@vbraun"
}
```

Resolution: fixed
