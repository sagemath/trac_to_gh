# Issue 20439: Projective closure and affine patches for algebraic curves

Issue created by migration from https://trac.sagemath.org/ticket/20676

Original creator: gjorgenson

Original creation time: 2016-05-25 04:38:11

CC:  bhutz mmarco

Given a curve in affine space, find its projective closure. Conversely, given a projective curve, find its affine patches with respect to the standard affine coordinate charts.


---

Comment by git created at 2016-05-25 21:19:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mmarco created at 2016-05-25 22:12:20

I have two questions:

1) Are you sure you really need to compute the groebner basis to compute the projective closue? If I am not missing something, just homogenizing the generators, you should get the generators of the projective ideal.

2) I think it would be better to keep the names of the variables when we compute the affine patches (or at least, to have an option to do so). It can be confusing to the user to force a change in the name of the coordinates. An option to choose the names of the new variables in the projective closure would be nice too.


---

Comment by gjorgenson created at 2016-05-25 23:39:48

Replying to [comment:3 mmarco]:

Thanks for looking at this. I think it's not always the case that a given set of generators is sufficient for finding generators for the ideal of the projective closure. One example I have seen referenced in some texts is the twisted cubic in A3 defined by the ideal `(y-x^2, z-x^3)`. Its projective closure is `(x^2 − wy, xy − wz, y^2 − xz)`, but if the given generators of the first ideal are homogenized we get `(wy-x^2, zw<sup>2-x</sup>3)` instead.

A proof is given in the book ideals, varieties, algorithms that if the generators of a groebner basis (with respect to a graded monomial ordering) for the defining ideal of an affine variety are homogenized, then the result is a set of generators for the ideal of the projective closure, so I tried to emulate that here.

I'll work on getting some flexibility with the variable names.


---

Comment by bhutz created at 2016-05-26 00:09:02

As Grayson pointed out the twisted cubic is the typical example for needing the gb.

For the variables. Actually it is not a good idea to name them the same as they really aren't the same variables.  More importantly, you need to be careful to keep track of the embedding as well, since if you homogenize the affine patch, you would expect to get something back in the same projective space. Take a look at the functionality for projective space and projective subschemes (or in #16838) to see what I mean.


---

Comment by mmarco created at 2016-05-26 07:32:27

Thanks for the correction. I knew I was missing something.

About the names of the variables... right now they might be named the same or not deppending on what were the original names. So I still think that there should be at least on option to let the user decide how are the new variables named: the same way as before, maybe adding a "bar" at the end, or completely new ones.

And bhutz is totally right about the morphisms: that is the important thing to compute (either in this methods or in separated ones).


---

Comment by git created at 2016-05-26 08:11:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-05-26 08:15:43

Okay, I actually just finished up an attempt to better manage the creation of ambient spaces in the projective closure/affine patches computation. I tried piggy-backing off of the existing projective_embedding and affine_patch functionality for projective/affine spaces, and it seems to be working so far. Things like:

```
P.<x,y,z,w> = ProjectiveSpace(QQ,3)
C = Curve([y*z - x^2,w^2 - x*y])
C.ambient_space() == C.affine_patch(0).projective_closure().ambient_space()
```

and

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
C.ambient_space() == C.projective_closure().affine_patch(0).ambient_space()
```

should now return true. Is this the right way to keep track of everything?

I also found something that seems strange:

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
A == C.ambient_space()
```

returns false. As far as I can tell, this isn't an issue for projective space curves. Also, there seems to be an issue with the class structure of space curves vs plane curves. Right now there is a ProjectiveSpaceCurve_generic class, and a ProjectiveCurve_generic class, with the latter corresponding to plane curves, but the plane curve class does not inherit from the space curve class. Similarly for affine curves. Is there a reason why plane curves shouldn't inherit from the space curve class?


---

Comment by mmarco created at 2016-05-26 12:31:18

I would say it is a bug in Sage. Apparently, schemes don't have rich comparison implemented.


---

Comment by bhutz created at 2016-05-26 13:00:49

re: variable names.

The way this is handled for general affine and projective subschemes is to allow the user to specify the space that it will be embedded into (or dehomogenized into). This is better functionality than just specifying the variable names, since you can then embedded different curves into the same space.

re: ambient space

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
A == C.ambient_space()
```

I haven't looked at the code, but it looks like Curve assumes you are passing in elements from a polynomial ring and doesn't see if they are actually from a particular affine space and hence creates a new affine space. This is a bug. If you pass in elements of the coordinate ring of an affine space, then the curve should be in that space. It may be that you need to include an optional parameter for the space and/or perhaps have an A.curve() function.

one last thought: Should these curve classes inherit from affine and projective subscheme as well? This could save you a fair amount of code duplication (such as for affine_patch and projective_embedding.


---

Comment by git created at 2016-05-30 00:01:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-06-02 20:50:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-02 20:54:30

Changing status from new to needs_review.


---

Comment by bhutz created at 2016-06-04 13:00:57

- line 1916:

`R.ideal([R(f) for f in self.defining_polynomials()])`
could be replaced with
`self.defining_ideal()`

- projective closure should take projective space parameter

```
A.<x,y> = AffineSpace(QQ, 2)
P.<u,v,w>=ProjectiveSpace(QQ,2)
C = Curve([y-x^2], A)
D=C.projective_closure(1,P)
```


- Affine patch should take affine space parameter

```
A.<x,y> = AffineSpace(QQ, 2)
P.<u,v,w>=ProjectiveSpace(QQ,2)
C = Curve([u^2-v^2], P)
C.affine_patch(1,A)
```


- Affine patch should have a default patch and that default should match up with the projective closure default

```
A.<x,y,z> = AffineSpace(GF(3), 3)
C = Curve([y-x^2,z-x^3], A)
D=C.projective_closure()
D.affine_patch()==C
```


- you should mention in the doc for projective embedding that the image is the projective closure


---

Comment by bhutz created at 2016-06-04 13:00:57

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2016-06-04 14:50:52

err...having a default for affine_patch() doesn't really make sense, so ignore that part.


---

Comment by git created at 2016-06-04 22:37:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by gjorgenson created at 2016-06-04 22:39:52

Changing keywords from "" to "gsoc2016".


---

Comment by gjorgenson created at 2016-06-04 22:39:52

Changing status from needs_work to needs_review.


---

Comment by git created at 2016-06-07 23:07:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2016-06-09 01:46:38

this looks good now


---

Comment by bhutz created at 2016-06-09 01:46:38

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-06-09 20:28:20

Resolution: fixed
