# Issue 20439: Projective closure and affine patches for algebraic curves

archive/issues_020439.json:
```json
{
    "body": "CC:  @bhutz @miguelmarco\n\nGiven a curve in affine space, find its projective closure. Conversely, given a projective curve, find its affine patches with respect to the standard affine coordinate charts.\n\nIssue created by migration from https://trac.sagemath.org/ticket/20676\n\n",
    "created_at": "2016-05-25T04:38:11Z",
    "labels": [
        "component: algebraic geometry",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.3",
    "title": "Projective closure and affine patches for algebraic curves",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/20439",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```
CC:  @bhutz @miguelmarco

Given a curve in affine space, find its projective closure. Conversely, given a projective curve, find its affine patches with respect to the standard affine coordinate charts.

Issue created by migration from https://trac.sagemath.org/ticket/20676





---

archive/issue_comments_281321.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-25T21:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281321",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281322.json:
```json
{
    "body": "I have two questions:\n\n1) Are you sure you really need to compute the groebner basis to compute the projective closue? If I am not missing something, just homogenizing the generators, you should get the generators of the projective ideal.\n\n2) I think it would be better to keep the names of the variables when we compute the affine patches (or at least, to have an option to do so). It can be confusing to the user to force a change in the name of the coordinates. An option to choose the names of the new variables in the projective closure would be nice too.",
    "created_at": "2016-05-25T22:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281322",
    "user": "https://github.com/miguelmarco"
}
```

I have two questions:

1) Are you sure you really need to compute the groebner basis to compute the projective closue? If I am not missing something, just homogenizing the generators, you should get the generators of the projective ideal.

2) I think it would be better to keep the names of the variables when we compute the affine patches (or at least, to have an option to do so). It can be confusing to the user to force a change in the name of the coordinates. An option to choose the names of the new variables in the projective closure would be nice too.



---

archive/issue_comments_281323.json:
```json
{
    "body": "Replying to [comment:3 mmarco]:\n\nThanks for looking at this. I think it's not always the case that a given set of generators is sufficient for finding generators for the ideal of the projective closure. One example I have seen referenced in some texts is the twisted cubic in A3 defined by the ideal `(y-x^2, z-x^3)`. Its projective closure is `(x^2 \u2212 wy, xy \u2212 wz, y^2 \u2212 xz)`, but if the given generators of the first ideal are homogenized we get `(wy-x^2, zw<sup>2-x</sup>3)` instead.\n\nA proof is given in the book ideals, varieties, algorithms that if the generators of a groebner basis (with respect to a graded monomial ordering) for the defining ideal of an affine variety are homogenized, then the result is a set of generators for the ideal of the projective closure, so I tried to emulate that here.\n\nI'll work on getting some flexibility with the variable names.",
    "created_at": "2016-05-25T23:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281323",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Replying to [comment:3 mmarco]:

Thanks for looking at this. I think it's not always the case that a given set of generators is sufficient for finding generators for the ideal of the projective closure. One example I have seen referenced in some texts is the twisted cubic in A3 defined by the ideal `(y-x^2, z-x^3)`. Its projective closure is `(x^2 − wy, xy − wz, y^2 − xz)`, but if the given generators of the first ideal are homogenized we get `(wy-x^2, zw<sup>2-x</sup>3)` instead.

A proof is given in the book ideals, varieties, algorithms that if the generators of a groebner basis (with respect to a graded monomial ordering) for the defining ideal of an affine variety are homogenized, then the result is a set of generators for the ideal of the projective closure, so I tried to emulate that here.

I'll work on getting some flexibility with the variable names.



---

archive/issue_comments_281324.json:
```json
{
    "body": "As Grayson pointed out the twisted cubic is the typical example for needing the gb.\n\nFor the variables. Actually it is not a good idea to name them the same as they really aren't the same variables.  More importantly, you need to be careful to keep track of the embedding as well, since if you homogenize the affine patch, you would expect to get something back in the same projective space. Take a look at the functionality for projective space and projective subschemes (or in #16838) to see what I mean.",
    "created_at": "2016-05-26T00:09:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281324",
    "user": "https://github.com/bhutz"
}
```

As Grayson pointed out the twisted cubic is the typical example for needing the gb.

For the variables. Actually it is not a good idea to name them the same as they really aren't the same variables.  More importantly, you need to be careful to keep track of the embedding as well, since if you homogenize the affine patch, you would expect to get something back in the same projective space. Take a look at the functionality for projective space and projective subschemes (or in #16838) to see what I mean.



---

archive/issue_comments_281325.json:
```json
{
    "body": "Thanks for the correction. I knew I was missing something.\n\nAbout the names of the variables... right now they might be named the same or not deppending on what were the original names. So I still think that there should be at least on option to let the user decide how are the new variables named: the same way as before, maybe adding a \"bar\" at the end, or completely new ones.\n\nAnd bhutz is totally right about the morphisms: that is the important thing to compute (either in this methods or in separated ones).",
    "created_at": "2016-05-26T07:32:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281325",
    "user": "https://github.com/miguelmarco"
}
```

Thanks for the correction. I knew I was missing something.

About the names of the variables... right now they might be named the same or not deppending on what were the original names. So I still think that there should be at least on option to let the user decide how are the new variables named: the same way as before, maybe adding a "bar" at the end, or completely new ones.

And bhutz is totally right about the morphisms: that is the important thing to compute (either in this methods or in separated ones).



---

archive/issue_comments_281326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-26T08:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281327.json:
```json
{
    "body": "Okay, I actually just finished up an attempt to better manage the creation of ambient spaces in the projective closure/affine patches computation. I tried piggy-backing off of the existing projective_embedding and affine_patch functionality for projective/affine spaces, and it seems to be working so far. Things like:\n\n```\nP.<x,y,z,w> = ProjectiveSpace(QQ,3)\nC = Curve([y*z - x^2,w^2 - x*y])\nC.ambient_space() == C.affine_patch(0).projective_closure().ambient_space()\n```\n\nand\n\n```\nA.<x,y,z> = AffineSpace(QQ,3)\nC = Curve([y-x^2,z-x^3])\nC.ambient_space() == C.projective_closure().affine_patch(0).ambient_space()\n```\n\nshould now return true. Is this the right way to keep track of everything?\n\nI also found something that seems strange:\n\n```\nA.<x,y,z> = AffineSpace(QQ,3)\nC = Curve([y-x^2,z-x^3])\nA == C.ambient_space()\n```\n\nreturns false. As far as I can tell, this isn't an issue for projective space curves. Also, there seems to be an issue with the class structure of space curves vs plane curves. Right now there is a ProjectiveSpaceCurve_generic class, and a ProjectiveCurve_generic class, with the latter corresponding to plane curves, but the plane curve class does not inherit from the space curve class. Similarly for affine curves. Is there a reason why plane curves shouldn't inherit from the space curve class?",
    "created_at": "2016-05-26T08:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281327",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Okay, I actually just finished up an attempt to better manage the creation of ambient spaces in the projective closure/affine patches computation. I tried piggy-backing off of the existing projective_embedding and affine_patch functionality for projective/affine spaces, and it seems to be working so far. Things like:

```
P.<x,y,z,w> = ProjectiveSpace(QQ,3)
C = Curve([y*z - x^2,w^2 - x*y])
C.ambient_space() == C.affine_patch(0).projective_closure().ambient_space()
```

and

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
C.ambient_space() == C.projective_closure().affine_patch(0).ambient_space()
```

should now return true. Is this the right way to keep track of everything?

I also found something that seems strange:

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
A == C.ambient_space()
```

returns false. As far as I can tell, this isn't an issue for projective space curves. Also, there seems to be an issue with the class structure of space curves vs plane curves. Right now there is a ProjectiveSpaceCurve_generic class, and a ProjectiveCurve_generic class, with the latter corresponding to plane curves, but the plane curve class does not inherit from the space curve class. Similarly for affine curves. Is there a reason why plane curves shouldn't inherit from the space curve class?



---

archive/issue_comments_281328.json:
```json
{
    "body": "I would say it is a bug in Sage. Apparently, schemes don't have rich comparison implemented.",
    "created_at": "2016-05-26T12:31:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281328",
    "user": "https://github.com/miguelmarco"
}
```

I would say it is a bug in Sage. Apparently, schemes don't have rich comparison implemented.



---

archive/issue_comments_281329.json:
```json
{
    "body": "re: variable names.\n\nThe way this is handled for general affine and projective subschemes is to allow the user to specify the space that it will be embedded into (or dehomogenized into). This is better functionality than just specifying the variable names, since you can then embedded different curves into the same space.\n\nre: ambient space\n\n```\nA.<x,y,z> = AffineSpace(QQ,3)\nC = Curve([y-x^2,z-x^3])\nA == C.ambient_space()\n```\n\nI haven't looked at the code, but it looks like Curve assumes you are passing in elements from a polynomial ring and doesn't see if they are actually from a particular affine space and hence creates a new affine space. This is a bug. If you pass in elements of the coordinate ring of an affine space, then the curve should be in that space. It may be that you need to include an optional parameter for the space and/or perhaps have an A.curve() function.\n\none last thought: Should these curve classes inherit from affine and projective subscheme as well? This could save you a fair amount of code duplication (such as for affine_patch and projective_embedding.",
    "created_at": "2016-05-26T13:00:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281329",
    "user": "https://github.com/bhutz"
}
```

re: variable names.

The way this is handled for general affine and projective subschemes is to allow the user to specify the space that it will be embedded into (or dehomogenized into). This is better functionality than just specifying the variable names, since you can then embedded different curves into the same space.

re: ambient space

```
A.<x,y,z> = AffineSpace(QQ,3)
C = Curve([y-x^2,z-x^3])
A == C.ambient_space()
```

I haven't looked at the code, but it looks like Curve assumes you are passing in elements from a polynomial ring and doesn't see if they are actually from a particular affine space and hence creates a new affine space. This is a bug. If you pass in elements of the coordinate ring of an affine space, then the curve should be in that space. It may be that you need to include an optional parameter for the space and/or perhaps have an A.curve() function.

one last thought: Should these curve classes inherit from affine and projective subscheme as well? This could save you a fair amount of code duplication (such as for affine_patch and projective_embedding.



---

archive/issue_comments_281330.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-30T00:01:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281331.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-02T20:50:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281331",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281332.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-06-02T20:54:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281332",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_281333.json:
```json
{
    "body": "- line 1916:\n\n`R.ideal([R(f) for f in self.defining_polynomials()])`\ncould be replaced with\n`self.defining_ideal()`\n\n- projective closure should take projective space parameter\n\n```\nA.<x,y> = AffineSpace(QQ, 2)\nP.<u,v,w>=ProjectiveSpace(QQ,2)\nC = Curve([y-x^2], A)\nD=C.projective_closure(1,P)\n```\n\n\n- Affine patch should take affine space parameter\n\n```\nA.<x,y> = AffineSpace(QQ, 2)\nP.<u,v,w>=ProjectiveSpace(QQ,2)\nC = Curve([u^2-v^2], P)\nC.affine_patch(1,A)\n```\n\n\n- Affine patch should have a default patch and that default should match up with the projective closure default\n\n```\nA.<x,y,z> = AffineSpace(GF(3), 3)\nC = Curve([y-x^2,z-x^3], A)\nD=C.projective_closure()\nD.affine_patch()==C\n```\n\n\n- you should mention in the doc for projective embedding that the image is the projective closure",
    "created_at": "2016-06-04T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281333",
    "user": "https://github.com/bhutz"
}
```

- line 1916:

`R.ideal([R(f) for f in self.defining_polynomials()])`
could be replaced with
`self.defining_ideal()`

- projective closure should take projective space parameter

```
A.<x,y> = AffineSpace(QQ, 2)
P.<u,v,w>=ProjectiveSpace(QQ,2)
C = Curve([y-x^2], A)
D=C.projective_closure(1,P)
```


- Affine patch should take affine space parameter

```
A.<x,y> = AffineSpace(QQ, 2)
P.<u,v,w>=ProjectiveSpace(QQ,2)
C = Curve([u^2-v^2], P)
C.affine_patch(1,A)
```


- Affine patch should have a default patch and that default should match up with the projective closure default

```
A.<x,y,z> = AffineSpace(GF(3), 3)
C = Curve([y-x^2,z-x^3], A)
D=C.projective_closure()
D.affine_patch()==C
```


- you should mention in the doc for projective embedding that the image is the projective closure



---

archive/issue_comments_281334.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-06-04T13:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281334",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_281335.json:
```json
{
    "body": "err...having a default for affine_patch() doesn't really make sense, so ignore that part.",
    "created_at": "2016-06-04T14:50:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281335",
    "user": "https://github.com/bhutz"
}
```

err...having a default for affine_patch() doesn't really make sense, so ignore that part.



---

archive/issue_comments_281336.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-04T22:37:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281336",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281337.json:
```json
{
    "body": "Changing keywords from \"\" to \"gsoc2016\".",
    "created_at": "2016-06-04T22:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281337",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing keywords from "" to "gsoc2016".



---

archive/issue_comments_281338.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-06-04T22:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281338",
    "user": "https://trac.sagemath.org/admin/accounts/users/gjorgenson"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_281339.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-07T23:07:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281339",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_281340.json:
```json
{
    "body": "this looks good now",
    "created_at": "2016-06-09T01:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281340",
    "user": "https://github.com/bhutz"
}
```

this looks good now



---

archive/issue_comments_281341.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-06-09T01:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281341",
    "user": "https://github.com/bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_019403.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2016-06-09T20:28:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/20439#event-19403"
}
```



---

archive/issue_comments_281342.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-06-09T20:28:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/20439",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/20439#issuecomment-281342",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
