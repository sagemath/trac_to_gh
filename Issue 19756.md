# Issue 19756: Arb: parse symbolic expressions

archive/issues_019756.json:
```json
{
    "body": "CC:  @behackl dakrenn @mezzarobba @fredrik-johansson\n\nKeywords: arb\n\nCurrent behaviour:\n\n```\nsage: RBF(zeta(3))\n[1.202056903159590 +/- 5.38e-16]\nsage: RBF(2*zeta(3))\nTraceback (most recent call last):\n...\nTypeError: unable to convert 2*zeta(3) to a RealBall\n```\n\nThat is unfortunate (imagine that this is part of a large symbolic expression, involving various constants, logarithms etc.)\n\nI assume that the first call succeeds because `RIF` can handle it.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19993\n\n",
    "created_at": "2016-02-01T10:34:59Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.1",
    "title": "Arb: parse symbolic expressions",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19756",
    "user": "https://github.com/cheuberg"
}
```
CC:  @behackl dakrenn @mezzarobba @fredrik-johansson

Keywords: arb

Current behaviour:

```
sage: RBF(zeta(3))
[1.202056903159590 +/- 5.38e-16]
sage: RBF(2*zeta(3))
Traceback (most recent call last):
...
TypeError: unable to convert 2*zeta(3) to a RealBall
```

That is unfortunate (imagine that this is part of a large symbolic expression, involving various constants, logarithms etc.)

I assume that the first call succeeds because `RIF` can handle it.

Issue created by migration from https://trac.sagemath.org/ticket/19993





---

archive/issue_comments_271261.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-02-01T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271261",
    "user": "https://github.com/cheuberg"
}
```

New commits:



---

archive/issue_comments_271262.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-02-01T10:44:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271262",
    "user": "https://github.com/cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_271263.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-02-02T10:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271263",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_271264.json:
```json
{
    "body": "I am now dealing with the failing doctests on the patchbot.",
    "created_at": "2016-02-02T10:53:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271264",
    "user": "https://github.com/cheuberg"
}
```

I am now dealing with the failing doctests on the patchbot.



---

archive/issue_comments_271265.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-02-02T11:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271265",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_271266.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-02-02T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271266",
    "user": "https://github.com/cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_271267.json:
```json
{
    "body": "The failing doctests were probably introduced by #19082; thus I had to merge 7.1.beta1 to fix them (only errors were affected, mostly they improved; in one occurrence, we now have a slightly worse error). All this is due to not involving RIFs less frequently.",
    "created_at": "2016-02-02T11:04:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271267",
    "user": "https://github.com/cheuberg"
}
```

The failing doctests were probably introduced by #19082; thus I had to merge 7.1.beta1 to fix them (only errors were affected, mostly they improved; in one occurrence, we now have a slightly worse error). All this is due to not involving RIFs less frequently.



---

archive/issue_comments_271268.json:
```json
{
    "body": "It might be worth handling rational arguments in some cases, if it's not too complicated?\n\nx<sup>(2/3)</sup> -> arb_pow_fmpq\n\nexp(I*pi/3) -> arb_sin_cos_pi_fmpq\n\ngamma(1/3) -> arb_gamma_fmpq",
    "created_at": "2016-02-02T11:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271268",
    "user": "https://github.com/fredrik-johansson"
}
```

It might be worth handling rational arguments in some cases, if it's not too complicated?

x<sup>(2/3)</sup> -> arb_pow_fmpq

exp(I*pi/3) -> arb_sin_cos_pi_fmpq

gamma(1/3) -> arb_gamma_fmpq



---

archive/issue_comments_271269.json:
```json
{
    "body": "Replying to [comment:8 fredrik.johansson]:\n> It might be worth handling rational arguments in some cases, if it's not too complicated?\n\n\nFor each operand in a symbolic expression, we could check whether it is an element of `QQ` and, in that case, just take the `.pyobject` of the operand instead of converting it into the Real Ball Field. Then it would be the responsibility of the respective functions to deal with those elements appropriately (either by the coercion model or by hand).\n\n\n> x<sup>(2/3)</sup> -> arb_pow_fmpq\n\n\nin that case, we should also modify `__pow__` which currently does not consider rational exponents.\n\n> \n> exp(I*pi/3) -> arb_sin_cos_pi_fmpq\n\n\nI am not sure that we want to do that much parsing of a symbolic expression.\n\n> gamma(1/3) -> arb_gamma_fmpq\n\n\ntricky: we would have to hardwire this function because we'd have to call `RealBallField.gamma`.\n\nI think I'd prefer to postpone such optimizations to a follow-up ticket.",
    "created_at": "2016-02-02T13:31:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271269",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:8 fredrik.johansson]:
> It might be worth handling rational arguments in some cases, if it's not too complicated?


For each operand in a symbolic expression, we could check whether it is an element of `QQ` and, in that case, just take the `.pyobject` of the operand instead of converting it into the Real Ball Field. Then it would be the responsibility of the respective functions to deal with those elements appropriately (either by the coercion model or by hand).


> x<sup>(2/3)</sup> -> arb_pow_fmpq


in that case, we should also modify `__pow__` which currently does not consider rational exponents.

> 
> exp(I*pi/3) -> arb_sin_cos_pi_fmpq


I am not sure that we want to do that much parsing of a symbolic expression.

> gamma(1/3) -> arb_gamma_fmpq


tricky: we would have to hardwire this function because we'd have to call `RealBallField.gamma`.

I think I'd prefer to postpone such optimizations to a follow-up ticket.



---

archive/issue_comments_271270.json:
```json
{
    "body": "LGTM, and as suggested, everything else should be on a follow up ticket.\n\nBTW, is\n\n```\nsage: zeta(RIF(3)).parent()\nComplex Field with 53 bits of precision\n```\nknown? (It works with balls, so no need to worry about this ticket...)",
    "created_at": "2016-02-12T18:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271270",
    "user": "https://github.com/dkrenn"
}
```

LGTM, and as suggested, everything else should be on a follow up ticket.

BTW, is

```
sage: zeta(RIF(3)).parent()
Complex Field with 53 bits of precision
```
known? (It works with balls, so no need to worry about this ticket...)



---

archive/issue_comments_271271.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-02-12T18:43:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271271",
    "user": "https://github.com/dkrenn"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_271272.json:
```json
{
    "body": "Replying to [comment:10 dkrenn]:\n> BTW, is\n> \n> ```\n> sage: zeta(RIF(3)).parent()\n> Complex Field with 53 bits of precision\n> ```\n> known? (It works with balls, so no need to worry about this ticket...)\n\n\nreused the existing ticket #16782 for this report.",
    "created_at": "2016-02-13T09:55:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271272",
    "user": "https://github.com/cheuberg"
}
```

Replying to [comment:10 dkrenn]:
> BTW, is
> 
> ```
> sage: zeta(RIF(3)).parent()
> Complex Field with 53 bits of precision
> ```
> known? (It works with balls, so no need to worry about this ticket...)


reused the existing ticket #16782 for this report.



---

archive/issue_events_054517.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-02-13T23:56:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/19756#event-54517"
}
```



---

archive/issue_comments_271273.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-02-13T23:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271273",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_271274.json:
```json
{
    "body": "A bug proably introduced by this ticket:\n\n```\nsage: RBF(exp(1), 1)\n[2.718281828459045 +/- 5.41e-16]\n```\nSee #28469.",
    "created_at": "2019-09-10T12:17:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19756",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19756#issuecomment-271274",
    "user": "https://github.com/mezzarobba"
}
```

A bug proably introduced by this ticket:

```
sage: RBF(exp(1), 1)
[2.718281828459045 +/- 5.41e-16]
```
See #28469.
