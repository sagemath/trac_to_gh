# Issue 23097: Implementing Well's Algorithm

Issue created by migration from https://trac.sagemath.org/ticket/23334

Original creator: rlmiller

Original creation time: 2017-06-28 15:55:50

Keywords: GSOC

Implementing Well's Algorithm for GSOC 2017


---

Comment by rlmiller created at 2017-06-28 15:56:15

Set assignee to rlmiller.


---

Comment by rlmiller created at 2017-06-28 15:57:36

Changing priority from major to minor.


---

Comment by rlmiller created at 2017-06-28 15:57:36

Changing component from PLEASE CHANGE to algebra.


---

Comment by rlmiller created at 2017-06-28 15:57:36

Changing status from new to needs_info.


---

Comment by rlmiller created at 2017-06-28 21:59:37

Changing component from algebra to algebraic geometry.


---

Comment by git created at 2017-06-30 16:21:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-07-04 00:21:55

Fixed test errors so we are ready to review. Wondering if we should take out a new ticket so we can change all the prec to 53.


---

Comment by rlmiller created at 2017-07-04 00:21:55

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2017-07-05 06:14:18

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2017-07-05 06:14:18

doc does not build:

```
+[dochtml] OSError: [schemes  ] /local/sage-patchbot/sage/local/lib/python2.7/site-packages/sage/schemes/projective/projective_point.py:
docstring of sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:39:
 WARNING: Explicit markup ends without a blank line; unexpected unindent.
```



---

Comment by bhutz created at 2017-07-06 19:58:45

Changing type from PLEASE CHANGE to enhancement.


---

Comment by bhutz created at 2017-07-06 19:58:45

A took a first look and here are a few initial comments:

- also change the description of the algorithm in canonical_height in projective_morphism

- move reference to reference file and add citations here

- 1031: line too long

- a bunch of your earlier work is to get integer coefficients and coordinates. I'd recommend using the built in functions instead
 - f.normalize_coordinates() - removes gcd and clears denominators
 - Q.normalize_coordinates() - removes gcd
 - Q.clear_denominators() - clears denominators

- 'not err == None'  should be  'not err is None'

- Height_I - lower case

- you do a lot of extraneous variable assignment for example
 - P = self
 - f = F
 - A_0, B_0

you don't need all these extra variables floating around

- and something not minor: The error bound calculation seems to be failing. I put in Wells example 4.4 as a test (which I recommend you do as well) and got the appropriate value when assigning N but not when assigning err.


```
RSA768 = 1230186684530117755130494958384962720772853569595334792197322452151726400507263657518745202199786469389956474942774063845925192557326303453731548268507917026122142913461670429214311602221240479274737794080665351419597459856902143413
P.<x,y>=ProjectiveSpace(QQ,1)
H=End(P)
f=H([RSA768*x^2+y^2,x*y])
Q=P(RSA768,1)
Q.canonical_height(f, err=0.00000000000000001)
930.66293109982349403319550850
Q.canonical_height(f, N=50)
931.18256422718194018675677246
```


same was true for simple functions as well.


---

Comment by bhutz created at 2017-07-06 19:58:45

Changing keywords from "GSOC" to "gsoc2017".


---

Comment by bhutz created at 2017-07-07 17:31:41

never mind about the error bound issue. When I use the correct parameter it works as expected.


---

Comment by git created at 2017-07-11 01:07:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-07-11 15:03:50

Changing status from needs_work to needs_review.


---

Comment by rlmiller created at 2017-07-11 15:03:50

Added requested example and simplified code. 
----
New commits:


---

Comment by bhutz created at 2017-07-13 14:54:06

The functionality works fine in tests and the notebook. However, I have a couple minor suggestions and a part I don't understand why it works.

- add citation to projective morphism canonical_height

- shouldn't this part go under ALGORITHM?

```
If function is defined over ``QQ`` uses Wells Algorithm, which allows us to
        not have to factor the resultant.
```


- Does this line really need .abs()?

```
1154: H = H + R(g).abs().log()/(d**(n+1))
```


- line 1145 Res.abs() is better than abs(Res)


- Note sure if it is better, but couldn't you do

```
N = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d))
```



- lines 1157-8: you really seem to be computing

```
h = self.green_function(F, 0 , **kwds) - H + R(t).log()
```

I'm also slightly confused by why this is right. Doesn't Wells' paper (proposition 2.3) have

```
h = self.global_height() - self.green_function(F,0) - H
```

I assume that R(t).log() is the correction for the function coordinate normalization.


---

Comment by bhutz created at 2017-07-13 14:54:06

Changing status from needs_review to needs_work.


---

Comment by rlmiller created at 2017-07-13 17:58:34

The reason our formula looks a bit different is due to the difference between what Wells calls H_infty and what greens function actually returns for the infinite place. 

Left * N = ceil(R(abs(Res)).log().log(d) - R(d-1).log(d) - R(err).log(d)) as is because that way it will look more like Well's Algorithm.

----
New commits:


---

Comment by rlmiller created at 2017-07-13 17:58:34

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-07-13 18:29:35

You should still condense those two lines down to one (1157-8) and perhaps you should add a comment about the difference in notation.


---

Comment by git created at 2017-07-14 00:05:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2017-07-17 08:37:12

doc still does not build :

```
sage.schemes.projective.projective_point.SchemeMorphism_point_projective_ring.canonical_height:79: WARNING: Literal block expected; none found.
```

probably because of the RSA768 line

Note that in the same function, you should not indent the content of the ALGORITHM section.

*EDIT*:

Something else: in the reference file, the link to arxiv should be written

```
:arxiv:`1602.04920v1`
```



---

Comment by chapoton created at 2017-07-17 08:37:12

Changing status from needs_review to needs_work.


---

Comment by bhutz created at 2017-07-17 12:58:36

also when you combined 1157,1158 you left in the redundant term (you are both adding and subtracting this term)


```
R(self[1].abs()).log()
```



---

Comment by git created at 2017-07-20 16:41:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-07-20 16:43:27

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-07-21 07:17:20

Several typos here:

```
Looks diffrent than Well's Algorithm because of the diffrence
...
for the infite place
```


Also `range(0, N)` should be `range(N)`

This

```
+            h = self.green_function(F, 0 , **kwds) - H + R(t).log()
+            return h
```

can be made in one line (no need to store h)


---

Comment by git created at 2017-07-21 15:02:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bhutz created at 2017-07-21 17:21:16

docs build and all tests pass. I this is ready.


---

Comment by bhutz created at 2017-07-21 17:21:16

Changing status from needs_review to positive_review.


---

Comment by bhutz created at 2017-07-21 19:35:23

Changing component from algebraic geometry to dynamics.


---

Comment by rlmiller created at 2017-07-26 20:13:27

Changing status from positive_review to needs_work.


---

Comment by rlmiller created at 2017-07-26 20:13:27

Need to make sure all "Wells'", are in the correct form. Just quick typo fixes.


---

Comment by git created at 2017-07-27 02:05:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rlmiller created at 2017-07-27 02:06:30

Changing status from needs_work to needs_review.


---

Comment by bhutz created at 2017-07-27 11:59:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-08-03 22:11:22

Resolution: fixed
