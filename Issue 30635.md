# Issue 30635: lrslib compilation failure

Issue created by migration from https://trac.sagemath.org/ticket/30872

Original creator: vdelecroix

Original creation time: 2020-11-07 16:40:06

CC:  mkoeppe dimpase

On archlinux

- config.log
- config.status
- lrslib-062+autotools-2017-03-03.p1.log


---

Attachment


---

Attachment


---

Attachment


---

Comment by vdelecroix created at 2020-11-07 17:05:49


```diff
diff --git a/lrsgmp.c b/lrsgmp.c
index ba83d82..182b4fa 100755
--- a/lrsgmp.c
+++ b/lrsgmp.c
@@ -250,7 +250,7 @@ readrat (lrs_mp Na, lrs_mp Da)	/* read a rational or integer and convert to lrs_
 }
 
 #ifdef PLRS
-string prat (char name[], lrs_mp Nin, lrs_mp Din)	/*reduce and print Nin/Din  */
+string prat (const char name[], lrs_mp Nin, lrs_mp Din)	/*reduce and print Nin/Din  */
 {
 
 	//create stream to collect output
@@ -284,7 +284,7 @@ string prat (char name[], lrs_mp Nin, lrs_mp Din)	/*reduce and print Nin/Din  */
 	return str;
 }
 
-char *cprat (char name[], lrs_mp Nin, lrs_mp Din) 
+char *cprat (const char name[], lrs_mp Nin, lrs_mp Din)
 {
 	char *ret;
 	unsigned long len;
@@ -311,7 +311,7 @@ char *cprat (char name[], lrs_mp Nin, lrs_mp Din)
 	return ret;
 }
 
-string pmp (char name[], lrs_mp Nt)	/*print the long precision integer a */
+string pmp (const char name[], lrs_mp Nt)	/*print the long precision integer a */
 {
 	
 	//create stream to collect output
@@ -333,7 +333,7 @@ string pmp (char name[], lrs_mp Nt)	/*print the long precision integer a */
 #else
 
 void
-pmp (char name[], lrs_mp Nt)
+pmp (const char name[], lrs_mp Nt)
 {
   fprintf (lrs_ofp, "%s", name);
   if (sign (Nt) != NEG)
@@ -343,7 +343,7 @@ pmp (char name[], lrs_mp Nt)
 }
 
 void 
-prat (char name[], lrs_mp Nin, lrs_mp Din)
+prat (const char name[], lrs_mp Nin, lrs_mp Din)
      /*print the long precision rational Nt/Dt  */
 {
 	lrs_mp temp1, temp2;
@@ -458,7 +458,7 @@ lrs_getdigits (long *a, long *b)
 }
 
 void *
-xcalloc (long n, long s, long l, char *f)
+xcalloc (long n, long s, long l, const char *f)
 {
   void *tmp;
 
diff --git a/lrsgmp.h b/lrsgmp.h
index 6bc18a7..2f0e138 100755
--- a/lrsgmp.h
+++ b/lrsgmp.h
@@ -168,13 +168,13 @@ void atomp (const char s[], lrs_mp a);	/* convert string to lrs_mp integer
 long compare (lrs_mp a, lrs_mp b);	/* a ? b and returns -1,0,1 for <,=,>             */
 void linint (lrs_mp a, long ka, lrs_mp b, long kb);     /* compute a*ka+b*kb --> a        */
 #ifdef PLRS
-string pmp (char name[], lrs_mp a);	/* print the long precision integer a             */
-string prat (char name[], lrs_mp Nt, lrs_mp Dt);	/* reduce and print  Nt/Dt                        */
-char *cprat(char name[], lrs_mp Nt, lrs_mp Dt); /* C version of prat */
+string pmp (const char name[], lrs_mp a);	/* print the long precision integer a             */
+string prat (const char name[], lrs_mp Nt, lrs_mp Dt);	/* reduce and print  Nt/Dt                        */
+char *cprat(const char name[], lrs_mp Nt, lrs_mp Dt); /* C version of prat */
 long plrs_readrat (lrs_mp Na, lrs_mp Da, const char * rat);	/* take a rational number and convert to lrs_mp   */
 #else
-void pmp (char name[], lrs_mp a);	/* print the long precision integer a             */
-void prat (char name[], lrs_mp Nt, lrs_mp Dt);	/* reduce and print  Nt/Dt                        */
+void pmp (const char name[], lrs_mp a);	/* print the long precision integer a             */
+void prat (const char name[], lrs_mp Nt, lrs_mp Dt);	/* reduce and print  Nt/Dt                        */
 #endif
 void readmp (lrs_mp a);		/* read an integer and convert to lrs_mp          */
 long readrat (lrs_mp Na, lrs_mp Da);	/* read a rational or int and convert to lrs_mp   */
@@ -214,7 +214,7 @@ void *calloc ();
 void *malloc ();
 #endif
 
-void *xcalloc (long n, long s, long l, char *f);
+void *xcalloc (long n, long s, long l, const char *f);
 
 void lrs_default_digits_overflow ();
 
diff --git a/lrslib.c b/lrslib.c
index ffe1ffa..3a5276c 100755
--- a/lrslib.c
+++ b/lrslib.c
@@ -110,7 +110,7 @@ lrs_main (int argc, char *argv[])
 #else
   if ( !lrs_init ("\n*lrs:"))
     return 1;
-  printf("\n%s",AUTHOR);
+  printf("\n%s", LRSLIB_AUTHOR);
 #endif
 
 /*********************************************************************************/
@@ -765,7 +765,7 @@ redund_main (int argc, char *argv[])
     return 1;
 
   printf ("\n");
-  printf (AUTHOR);
+  printf (LRSLIB_AUTHOR);
 
 /*********************************************************************************/
 /* Step 1: Allocate lrs_dat, lrs_dic and set up the problem                      */
@@ -1100,8 +1100,8 @@ lrs_init (char *name)       /* returns TRUE if successful, else FALSE */
 {
 
   printf ("%s", name);
-  printf (TITLE);
-  printf (VERSION);
+  printf (LRSLIB_TITLE);
+  printf (LRSLIB_VERSION);
   printf ("(");
   printf (BIT); 
   printf (","); 
@@ -1124,8 +1124,8 @@ lrs_close (char *name)
 {
 
   fprintf (lrs_ofp, "\n*%s", name);
-  fprintf (lrs_ofp, TITLE);
-  fprintf (lrs_ofp, VERSION);
+  fprintf (lrs_ofp, LRSLIB_TITLE);
+  fprintf (lrs_ofp, LRSLIB_VERSION);
   fprintf (lrs_ofp, "(");
   fprintf (lrs_ofp, BIT);
   fprintf (lrs_ofp, ",");
diff --git a/lrslib.h b/lrslib.h
index 5857877..7ec43cd 100755
--- a/lrslib.h
+++ b/lrslib.h
@@ -1,7 +1,7 @@
 /* lrslib.hpp (vertex enumeration using lexicographic reverse search) */
-#define TITLE "lrslib "
-#define VERSION "v.6.2 2016.3.28"   
-#define AUTHOR "*Copyright (C) 1995,2016, David Avis   avis@cs.mcgill.ca "
+#define LRSLIB_TITLE "lrslib "
+#define LRSLIB_VERSION "v.6.2 2016.3.28"
+#define LRSLIB_AUTHOR "*Copyright (C) 1995,2016, David Avis   avis@cs.mcgill.ca "
 
 /* This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
diff --git a/lrslong.c b/lrslong.c
index 2ea741d..4dccfc1 100755
--- a/lrslong.c
+++ b/lrslong.c
@@ -456,7 +456,7 @@ lrs_getdigits (long *a, long *b)
 }
 
 void *
-xcalloc (long n, long s, long l, char *f)
+xcalloc (long n, long s, long l, const char *f)
 {
   void *tmp;
 
diff --git a/lrslong.h b/lrslong.h
index 1913b18..30e925f 100755
--- a/lrslong.h
+++ b/lrslong.h
@@ -225,7 +225,7 @@ void stringcpy (char *s, char *t);	/* copy t to s pointer version
 
 void *calloc ();
 void *malloc ();
-void *xcalloc (long n, long s, long l, char *f);
+void *xcalloc (long n, long s, long l, const char *f);
 
 void lrs_default_digits_overflow ();
 
diff --git a/lrsmp.c b/lrsmp.c
index 7607dbe..aef732a 100755
--- a/lrsmp.c
+++ b/lrsmp.c
@@ -1063,7 +1063,7 @@ mulrat (lrs_mp Na, lrs_mp Da, lrs_mp Nb, lrs_mp Db, lrs_mp Nc, lrs_mp Dc)
 
 
 void *
-xcalloc (long n, long s, long l, char *f)
+xcalloc (long n, long s, long l, const char *f)
 {
   void *tmp;
 
diff --git a/lrsmp.h b/lrsmp.h
index 39001fe..5e1f2e7 100755
--- a/lrsmp.h
+++ b/lrsmp.h
@@ -224,7 +224,7 @@ void lrs_getdigits (long *a, long *b);	/* send digit information to user
 
 void stringcpy (char *s, char *t);	/* copy t to s pointer version                            */
 
-void *xcalloc (long n, long s, long l, char *f);
+void *xcalloc (long n, long s, long l, const char *f);
 
 void lrs_default_digits_overflow ();
 void digits_overflow ();
diff --git a/lrsnash.c b/lrsnash.c
index ed4b55f..363ef77 100755
--- a/lrsnash.c
+++ b/lrsnash.c
@@ -70,7 +70,7 @@ int openIO(void) {
   if (!lrs_init("*lrsnash:"))
     return FALSE;
   fprintf(stderr, "\n");
-  fprintf(stderr, AUTHOR);
+  fprintf(stderr, LRSLIB_AUTHOR);
   fprintf(stderr, "\n");
 	if(Outfile != NULL) {
 	  if ((lrs_ofp = fopen(Outfile, "w")) == NULL) {
diff --git a/lrsnashlib.c b/lrsnashlib.c
index 6c05c7f..ab575fc 100755
--- a/lrsnashlib.c
+++ b/lrsnashlib.c
@@ -19,6 +19,7 @@
 #include "lrslib.h"
 #include "lrsnashlib.h"
 
+long FirstTime;
 
 //========================================================================
 // Standard solver. Modified version of main() from lrsNash
@@ -804,7 +805,7 @@ int lrs_solve_nash_legacy (int argc, char *argv[])
   if ( !lrs_init ("\n*nash:"))
     return 1;
   printf("\n");
-  printf(AUTHOR);
+  printf(LRSLIB_AUTHOR);
 
 /*********************************************************************************/
 /* Step 1: Allocate lrs_dat, lrs_dic and set up the problem                      */
diff --git a/lrsnashlib.h b/lrsnashlib.h
index caf8a5c..809b765 100755
--- a/lrsnashlib.h
+++ b/lrsnashlib.h
@@ -65,7 +65,7 @@ void initFwidth(game *g);
 void updateFwidth(game *g, int col, int pos, char *str);
 
 
-long FirstTime;          /* set this to true for every new game to be solved */
+extern long FirstTime;          /* set this to true for every new game to be solved */
 static long Debug_flag;
 static long Verbose_flag;
 
diff --git a/mplrs.c b/mplrs.c
index d5db655..4944be2 100755
--- a/mplrs.c
+++ b/mplrs.c
@@ -1933,7 +1933,7 @@ void recv_counting_stats(int target)
 void initial_print(void)
 {
 		fprintf(consumer.output, "*mplrs:%s%s(%s)%d processes\n%s\n",
-			TITLE,VERSION,ARITH,mplrs.size,AUTHOR);
+			LRSLIB_TITLE,LRSLIB_VERSION,ARITH,mplrs.size,LRSLIB_AUTHOR);
 		fprintf(consumer.output, "*Input taken from %s\n",
 			mplrs.input_filename);
 		fprintf(consumer.output, "*Starting depth of %d maxcobases=%d ",
@@ -1945,8 +1945,8 @@ void initial_print(void)
 			fprintf(consumer.output, "*countonly\n");
 		if (consumer.output==stdout)
 			return;
-		printf("*mplrs:%s%s(%s)%d processes\n%s\n",TITLE,VERSION,ARITH,
-		       mplrs.size,AUTHOR);
+		printf("*mplrs:%s%s(%s)%d processes\n%s\n",LRSLIB_TITLE,LRSLIB_VERSION,ARITH,
+		       mplrs.size,LRSLIB_AUTHOR);
 		printf("*Input taken from %s\n",mplrs.input_filename);
 		printf("*Output written to: %s\n",consumer.output_filename);
 		printf("*Starting depth of %d maxcobases=%d ", master.initdepth,
diff --git a/plrs.cpp b/plrs.cpp
index 755dd52..060b687 100755
--- a/plrs.cpp
+++ b/plrs.cpp
@@ -347,7 +347,7 @@ int main(int argc, char* argv[]){
 	gettimeofday(&start, NULL);
 
 	//Print version
-	printf("*plrs:%s%s(%s)",TITLE,VERSION,ARITH);
+	printf("*plrs:%s%s(%s)",LRSLIB_TITLE,LRSLIB_VERSION,ARITH);
 
 	string outputfile;
         int firstfile=1;
@@ -397,7 +397,7 @@ int main(int argc, char* argv[]){
         }
 
         printf("%d processes\n",MAXTHREADS);
-        printf("%s\n",AUTHOR);
+        printf("%s\n",LRSLIB_AUTHOR);
 
 	if(INPUTFILE.empty()){
 		printf("No input file.\n");
@@ -418,7 +418,7 @@ int main(int argc, char* argv[]){
 	
         if(OUTSTREAM)
             {
-	     OUTSTREAM <<"*plrs:"<<TITLE<<VERSION<<"("<<ARITH<<")"<<MAXTHREADS<<" processes"<<endl<<AUTHOR<<endl;
+	     OUTSTREAM <<"*plrs:"<<LRSLIB_TITLE<<LRSLIB_VERSION<<"("<<ARITH<<")"<<MAXTHREADS<<" processes"<<endl<<LRSLIB_AUTHOR<<endl;
 	     OUTSTREAM <<"*Input taken from "<<INPUTFILE<<endl;
             }
 	if (PLRS_DEBUG_PHASE1)
```



---

Comment by mkoeppe created at 2020-11-07 17:27:18

Upstream for our spkg is at https://github.com/mkoeppe/lrslib


---

Comment by mkoeppe created at 2021-04-07 19:29:15

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-05-17 22:23:31

Will be fixed in the update in #27745


---

Comment by mkoeppe created at 2021-05-17 22:23:31

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-05-25 17:40:46

Changing priority from critical to major.


---

Comment by tmonteil created at 2021-07-31 16:46:44

Changing status from needs_review to positive_review.


---

Comment by slelievre created at 2021-07-31 17:58:02

Resolution: fixed
