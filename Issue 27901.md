# Issue 27901: py3: misc/dev_tools.py

archive/issues_027901.json:
```json
{
    "body": "The file `misc/dev_tools.py` has a Python 3 doctest failure:\n\n```\nFile \"src/sage/misc/dev_tools.py\", line 160, in sage.misc.dev_tools.load_submodules\nFailed example:\n    sage.misc.dev_tools.load_submodules(sage.combinat)\nExpected nothing\nGot:\n    load sage.combinat.designs.orthogonal_arrays_find_recursive...failed\n```\n\nThis comes from this block:\n\n```\n        except (ValueError, AttributeError, TypeError, ImportError):\n            # we might get error because of cython code that has been\n            # compiled but with source removed\n            sys.stdout.write(\"failed\\n\")\n```\n\nIf I add a `raise` command at the end of this, I see\n\n```\nsage: sage.misc.dev_tools.load_submodules(sage.combinat)\nload sage.combinat.algebraic_combinatorics... succeeded\n...\nload sage.combinat.designs.orthogonal_arrays_find_recursive...failed\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-d8b886cdfe68> in <module>()\n----> 1 sage.misc.dev_tools.load_submodules(sage.combinat)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/misc/dev_tools.py in load_submodules(module, exclude_pattern)\n    198             sys.stdout.flush()\n    199             loader = importer.find_module(module_name)\n--> 200             loader.load_module(module_name)\n    201             sys.stdout.write(\" succeeded\\n\")\n    202         except (ValueError, AttributeError, TypeError, ImportError):\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in _check_name_wrapper(self, name, *args, **kwargs)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in load_module(self, fullname)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in load_module(self, fullname)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load_module_shim(self, fullname)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load(spec)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load_unlocked(spec)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in exec_module(self, module)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _call_with_frames_removed(f, *args, **kwds)\n\n/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/combinat/designs/orthogonal_arrays_find_recursive.pyx in init sage.combinat.designs.orthogonal_arrays_find_recursive (build/cythonized/sage/combinat/designs/orthogonal_arrays_find_recursive.c:13225)()\n    798 # Associates to n the list of k,x with x>1 such that there exists an\n    799 # OA(k,n+x)-OA(k,x). Useful in find_brouwer_separable_design\n--> 800 cdef dict _QDM = sage.combinat.designs.database.QDM\n    801 cdef dict ioa_indexed_by_n_minus_x = {}\n    802 for x in _QDM.itervalues():\n\nAttributeError: module 'sage.combinat.designs' has no attribute 'database'\n```\n\nI don't know why this fails. A related mystery: in a fresh Python 3 Sage session:\n\n```\nsage: sage.misc.dev_tools.load_submodules(sage.combinat)\n...\nsage: sage: sage.combinat.designs.database\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-218d9965f21f> in <module>()\n----> 1 sage.combinat.designs.database\n\nAttributeError: module 'sage.combinat.designs' has no attribute 'database'\nsage: import sage.combinat.designs.database\nsage: sage.combinat.designs.database\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-4-218d9965f21f> in <module>()\n----> 1 sage.combinat.designs.database\n\nAttributeError: module 'sage.combinat.designs' has no attribute 'database'\n```\n\nwhereas if you restart Sage and skip the first line:\n\n```\nsage: sage.combinat.designs.database\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-218d9965f21f> in <module>()\n----> 1 sage.combinat.designs.database\n\nAttributeError: module 'sage.combinat.designs' has no attribute 'database'\nsage: import sage.combinat.designs.database\nsage: sage.combinat.designs.database\n<module 'sage.combinat.designs.database' from '/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/combinat/designs/database.py'>\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/28138\n\n",
    "created_at": "2019-07-08T21:25:17Z",
    "labels": [
        "python3",
        "major",
        "bug"
    ],
    "title": "py3: misc/dev_tools.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27901",
    "user": "jhpalmieri"
}
```
The file `misc/dev_tools.py` has a Python 3 doctest failure:

```
File "src/sage/misc/dev_tools.py", line 160, in sage.misc.dev_tools.load_submodules
Failed example:
    sage.misc.dev_tools.load_submodules(sage.combinat)
Expected nothing
Got:
    load sage.combinat.designs.orthogonal_arrays_find_recursive...failed
```

This comes from this block:

```
        except (ValueError, AttributeError, TypeError, ImportError):
            # we might get error because of cython code that has been
            # compiled but with source removed
            sys.stdout.write("failed\n")
```

If I add a `raise` command at the end of this, I see

```
sage: sage.misc.dev_tools.load_submodules(sage.combinat)
load sage.combinat.algebraic_combinatorics... succeeded
...
load sage.combinat.designs.orthogonal_arrays_find_recursive...failed
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-d8b886cdfe68> in <module>()
----> 1 sage.misc.dev_tools.load_submodules(sage.combinat)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/misc/dev_tools.py in load_submodules(module, exclude_pattern)
    198             sys.stdout.flush()
    199             loader = importer.find_module(module_name)
--> 200             loader.load_module(module_name)
    201             sys.stdout.write(" succeeded\n")
    202         except (ValueError, AttributeError, TypeError, ImportError):

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in _check_name_wrapper(self, name, *args, **kwargs)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in load_module(self, fullname)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in load_module(self, fullname)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load_module_shim(self, fullname)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load(spec)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _load_unlocked(spec)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap_external.py in exec_module(self, module)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/importlib/_bootstrap.py in _call_with_frames_removed(f, *args, **kwds)

/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/combinat/designs/orthogonal_arrays_find_recursive.pyx in init sage.combinat.designs.orthogonal_arrays_find_recursive (build/cythonized/sage/combinat/designs/orthogonal_arrays_find_recursive.c:13225)()
    798 # Associates to n the list of k,x with x>1 such that there exists an
    799 # OA(k,n+x)-OA(k,x). Useful in find_brouwer_separable_design
--> 800 cdef dict _QDM = sage.combinat.designs.database.QDM
    801 cdef dict ioa_indexed_by_n_minus_x = {}
    802 for x in _QDM.itervalues():

AttributeError: module 'sage.combinat.designs' has no attribute 'database'
```

I don't know why this fails. A related mystery: in a fresh Python 3 Sage session:

```
sage: sage.misc.dev_tools.load_submodules(sage.combinat)
...
sage: sage: sage.combinat.designs.database
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-218d9965f21f> in <module>()
----> 1 sage.combinat.designs.database

AttributeError: module 'sage.combinat.designs' has no attribute 'database'
sage: import sage.combinat.designs.database
sage: sage.combinat.designs.database
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-4-218d9965f21f> in <module>()
----> 1 sage.combinat.designs.database

AttributeError: module 'sage.combinat.designs' has no attribute 'database'
```

whereas if you restart Sage and skip the first line:

```
sage: sage.combinat.designs.database
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-218d9965f21f> in <module>()
----> 1 sage.combinat.designs.database

AttributeError: module 'sage.combinat.designs' has no attribute 'database'
sage: import sage.combinat.designs.database
sage: sage.combinat.designs.database
<module 'sage.combinat.designs.database' from '/Users/jpalmier/Desktop/Sage/sage_builds/PYTHON3/sage-8.9.beta1/local/lib/python3.7/site-packages/sage/combinat/designs/database.py'>
```


Issue created by migration from https://trac.sagemath.org/ticket/28138





---

archive/issue_comments_393994.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-07-08T21:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27901#issuecomment-393994",
    "user": "jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_393995.json:
```json
{
    "body": "I don't understand what's going on, but this branch seems to fix the problem.\n----\nNew commits:",
    "created_at": "2019-07-08T21:30:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27901#issuecomment-393995",
    "user": "jhpalmieri"
}
```

I don't understand what's going on, but this branch seems to fix the problem.
----
New commits:



---

archive/issue_comments_393996.json:
```json
{
    "body": "Probably caused by #27916\n\nThe fix looks good",
    "created_at": "2019-07-09T06:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27901#issuecomment-393996",
    "user": "chapoton"
}
```

Probably caused by #27916

The fix looks good



---

archive/issue_comments_393997.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-07-09T06:46:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27901#issuecomment-393997",
    "user": "chapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_393998.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-07-10T01:31:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27901",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27901#issuecomment-393998",
    "user": "vbraun"
}
```

Resolution: fixed
