# Issue 23212: Fast logarithm for p-adic floats

archive/issues_023212.json:
```json
{
    "body": "CC:  roed saraedum\n\nThis ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23449\n\n",
    "created_at": "2017-07-18T04:34:26Z",
    "labels": [
        "padics",
        "major",
        "enhancement"
    ],
    "title": "Fast logarithm for p-adic floats",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23212",
    "user": "caruso"
}
```
CC:  roed saraedum

This ticket provides a fast implementation of the computation of the logarithm for p-adic floats. It is the continuation of #23043.


Issue created by migration from https://trac.sagemath.org/ticket/23449





---

archive/issue_comments_324740.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd87\".",
    "created_at": "2017-07-18T04:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324740",
    "user": "caruso"
}
```

Changing keywords from "" to "sd87".



---

archive/issue_comments_324741.json:
```json
{
    "body": "New commits:",
    "created_at": "2017-07-18T04:36:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324741",
    "user": "caruso"
}
```

New commits:



---

archive/issue_comments_324742.json:
```json
{
    "body": "Xavier, what's the status of this ticket?  What still needs to be done before it's ready for review?\n----\nNew commits:",
    "created_at": "2017-08-03T22:00:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324742",
    "user": "roed"
}
```

Xavier, what's the status of this ticket?  What still needs to be done before it's ready for review?
----
New commits:



---

archive/issue_comments_324743.json:
```json
{
    "body": "I have a question.\n\nIf x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?",
    "created_at": "2017-08-05T12:43:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324743",
    "user": "caruso"
}
```

I have a question.

If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?



---

archive/issue_comments_324744.json:
```json
{
    "body": "Replying to [comment:5 caruso]:\n> I have a question.\n> \n> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?\n\nThis shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.",
    "created_at": "2017-09-22T19:37:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324744",
    "user": "kedlaya"
}
```

Replying to [comment:5 caruso]:
> I have a question.
> 
> If x is a floating point number which is very close to a `p^n`-root of unity, say `x = zeta_(p^n) + h` with h very small, the log(x) has a very high valuation. In that case, what should we do? Should we compute log(x) at the relative precision specified in the parent (but this can be costly if h is very small) or should we instead compute log(x) at some reasonable precision and don't care if the returned result is not sharp?

This shouldn't be an issue if we handle things right way: before computing the series expansion, first replace x by `x<sup>{p</sup>n}` for some n which is large enough to raise the valuation of x-1 above some fixed cutoff (say 1). Then divide the final answer by `p^n`.



---

archive/issue_comments_324745.json:
```json
{
    "body": "I'm not sure that your answer resolves my problem.\n\nSuppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.\nIf `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.\n\nIn comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).\n\nAm I mistaken?",
    "created_at": "2018-03-11T20:37:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324745",
    "user": "caruso"
}
```

I'm not sure that your answer resolves my problem.

Suppose that we are working with `e*N` digits of precision (where e is the absolute ramification index) and that `h` has valuation `e*N/2`.
If `x = zeta_(p^n) + h`, then the result of `x<sup>{p</sup>n}` will be `1 + p<sup>n*h/zeta_(p</sup>n)` truncated modulo `p^N`. Therefore, the value we will get for `log(x)` is `h/zeta_(p^n)` truncated modulo `p^(N-n)`. Thus only `e*(N/2 - n)` digits will be correct. This is not sharp.

In comparison, if we just expand the series of `log(1 + h')` with `h' = zeta_(p^n) - 1 + h`, we get `e*N/2` correct digits (the first `e*N/2` digits vanish), which is a bit better (but still not sharp).

Am I mistaken?



---

archive/issue_comments_324746.json:
```json
{
    "body": "Changing keywords from \"sd87\" to \"sd87, padicIMA\".",
    "created_at": "2018-07-22T20:25:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324746",
    "user": "roed"
}
```

Changing keywords from "sd87" to "sd87, padicIMA".



---

archive/issue_comments_324747.json:
```json
{
    "body": "Changing keywords from \"sd87, padicIMA\" to \"sd87, padicIMA, padicBordeaux\".",
    "created_at": "2019-09-07T12:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23212",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23212#issuecomment-324747",
    "user": "roed"
}
```

Changing keywords from "sd87, padicIMA" to "sd87, padicIMA, padicBordeaux".
