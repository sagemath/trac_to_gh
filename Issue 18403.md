# Issue 18403: Topological manifolds: scalar fields

archive/issues_018403.json:
```json
{
    "body": "Assignee: @egourgoulhon\n\nCC:  mbejger\n\nKeywords: topological manifolds\n\nThis ticket implements scalar fields on topological manifolds. This is a follow up of ticket #18529 within the [SageManifolds project](http://sagemanifolds.obspm.fr/). See the meta-ticket #18528 for an overview.\nBy *scalar field*, it is meant a continuous map f: M --> K, where K is a topological field and M a topological manifold over K.\n\nThis ticket implements the following Python classes:\n- `CoordFunction`: abstract base class for coordinate functions, i.e. functions\n  V\\subset K<sup>n</sup> --> K, where V is some chart codomain and n=dim(M)\n  - `CoordFunctionSymb`: symbolic coordinate functions\n- `MultiCoordFunction`: functions V\\subset K<sup>n</sup> --> K<sup>m</sup>, where V is some chart codomain and m some\n  positive integer\n- `ScalarFieldAlgebra`: set C<sup>0</sup>(M) of scalar fields M --> K as a commutative algebra over K \n  (Parent class)\n- `ScalarField`: scalar field M --> K (Element class)\nInternally, `ScalarField`'s are described by their coordinate representations in various charts, which are implemented as a dictionary of `CoordFunction`'s, with the charts as keys. \nAt the moment, there is only one concrete class for coordinate functions: `CoordFunctionSymb` (functions described by symbolic expressions of the coordinates), but in the future there should be numerical coordinate functions (hence the abstract base class `CoordFunction`).\n\nIssue created by migration from https://trac.sagemath.org/ticket/18640\n\n",
    "created_at": "2015-06-08T21:42:27Z",
    "labels": [
        "component: geometry"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.2",
    "title": "Topological manifolds: scalar fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18403",
    "user": "https://github.com/egourgoulhon"
}
```
Assignee: @egourgoulhon

CC:  mbejger

Keywords: topological manifolds

This ticket implements scalar fields on topological manifolds. This is a follow up of ticket #18529 within the [SageManifolds project](http://sagemanifolds.obspm.fr/). See the meta-ticket #18528 for an overview.
By *scalar field*, it is meant a continuous map f: M --> K, where K is a topological field and M a topological manifold over K.

This ticket implements the following Python classes:
- `CoordFunction`: abstract base class for coordinate functions, i.e. functions
  V\subset K<sup>n</sup> --> K, where V is some chart codomain and n=dim(M)
  - `CoordFunctionSymb`: symbolic coordinate functions
- `MultiCoordFunction`: functions V\subset K<sup>n</sup> --> K<sup>m</sup>, where V is some chart codomain and m some
  positive integer
- `ScalarFieldAlgebra`: set C<sup>0</sup>(M) of scalar fields M --> K as a commutative algebra over K 
  (Parent class)
- `ScalarField`: scalar field M --> K (Element class)
Internally, `ScalarField`'s are described by their coordinate representations in various charts, which are implemented as a dictionary of `CoordFunction`'s, with the charts as keys. 
At the moment, there is only one concrete class for coordinate functions: `CoordFunctionSymb` (functions described by symbolic expressions of the coordinates), but in the future there should be numerical coordinate functions (hence the abstract base class `CoordFunction`).

Issue created by migration from https://trac.sagemath.org/ticket/18640





---

archive/issue_comments_249641.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-14T21:43:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249641",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249642.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-15T15:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249642",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249643.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-16T16:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249643",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249644.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-17T08:56:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249644",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249645.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-18T16:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249645",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249646.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-23T15:42:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249646",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249647.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-26T16:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249647",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-23T16:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249649.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-01T22:11:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249649",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249650.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-13T21:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249650",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249651.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-14T14:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249651",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-15T13:16:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249653.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-15T20:44:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249653",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_249654.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2015-10-19T09:18:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249654",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_249655.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-09T10:18:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249655",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249656.json:
```json
{
    "body": "The above commit takes into account [this discussion on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/Vzfj1haZHho) and on ticket #18529: it removes `UniqueRepresentation` for the class `ScalarFieldAlgebra`, leaving only `WithEqualityById`.",
    "created_at": "2015-11-09T10:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249656",
    "user": "https://github.com/egourgoulhon"
}
```

The above commit takes into account [this discussion on sage-devel](https://groups.google.com/forum/#!topic/sage-devel/Vzfj1haZHho) and on ticket #18529: it removes `UniqueRepresentation` for the class `ScalarFieldAlgebra`, leaving only `WithEqualityById`.



---

archive/issue_comments_249657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-11-17T13:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249658.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-02T16:24:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249658",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249659.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-06T20:43:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249659",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-06T21:24:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249661.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-12-16T17:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249661",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249662.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-03T19:56:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-11T10:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249663",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249664.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-01-24T20:45:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249664",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249665.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-04-28T13:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249665",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249666.json:
```json
{
    "body": "Yay, finally had time to go through this. So, compared to the previous ticket, there is a lot less to discuss. I've mostly pushed a bunch of documentation changes on my last commit. However, I think there are still a few things to do.\n\n- I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC. Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.\n\n  Also, I converted the methods in `CoordFunction` to ``@`abstract_method` since these get picked up by the `TestSuite` as opposed to raising a `NotImplementedError`. (I haven't fixed the doctests yet in case the ABC gets removed.)\n\n- I understand why you want to put \"the\" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.\n\n- Similarly, in the docstrings, we should change \"the *\" to \"this *\" (sorry I didn't catch this previously).\n\n- I don't like `omit_function_args` and `nice_derivatives` being included in the global namespace. I think these are better converted to global options. The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. Either that, or we just have one object `ManifoldOptions` into the global namespace (but I am less favorable to this option).\n\n- There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).\n\nThere's still likely a few more things that might need a little bit of attention, but I am pretty sure these are all of the main points.",
    "created_at": "2016-04-28T14:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249666",
    "user": "https://github.com/tscrim"
}
```

Yay, finally had time to go through this. So, compared to the previous ticket, there is a lot less to discuss. I've mostly pushed a bunch of documentation changes on my last commit. However, I think there are still a few things to do.

- I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC. Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.

  Also, I converted the methods in `CoordFunction` to ``@`abstract_method` since these get picked up by the `TestSuite` as opposed to raising a `NotImplementedError`. (I haven't fixed the doctests yet in case the ABC gets removed.)

- I understand why you want to put "the" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.

- Similarly, in the docstrings, we should change "the *" to "this *" (sorry I didn't catch this previously).

- I don't like `omit_function_args` and `nice_derivatives` being included in the global namespace. I think these are better converted to global options. The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. Either that, or we just have one object `ManifoldOptions` into the global namespace (but I am less favorable to this option).

- There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).

There's still likely a few more things that might need a little bit of attention, but I am pretty sure these are all of the main points.



---

archive/issue_comments_249667.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2016-04-28T14:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249667",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_249668.json:
```json
{
    "body": "Replying to [comment:28 tscrim]:\n> Yay, finally had time to go through this. So, compared to the previous ticket, there is a lot less to discuss. I've mostly pushed a bunch of documentation changes on my last commit. \n\nThank you very much for working on this !\n\n>However, I think there are still a few things to do.\n> \n> - I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC.\n\nYes there will be other subclasses of `CoordFunction`: a major project is to have a subclass for numerical functions, in order to deal with numerical manifolds (for instance computer-generated spacetimes on a grid). This was the very purpose for creating this ABC: it provides the unique interface with the rest of tensor calculus on manifolds, factoring out what has to be implemented by a concrete class (the abstract methods). So I think it is important to maintain the ABC.\n\n> Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.\n\nOK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)\n\n>   Also, I converted the methods in `CoordFunction` to ``@`abstract_method` since these get picked up by the `TestSuite` as opposed to raising a `NotImplementedError`.\n\nThanks. I didn't know about this.\n\n> (I haven't fixed the doctests yet in case the ABC gets removed.)\n> \n> - I understand why you want to put \"the\" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.\n>\n\nSorry, I am not sure I understand what you mean. Can you elaborate on this?\n \n> - Similarly, in the docstrings, we should change \"the *\" to \"this *\" (sorry I didn't catch this previously).\n> \n> - I don't like `omit_function_args` and `nice_derivatives` being included in the global namespace. I think these are better converted to global options. \n\nAgreed.\n\n>The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. \n\n`TopologicalManifold` sounds good, since this where the charts live in the current approach.\n\n>Either that, or we just have one object `ManifoldOptions` into the global namespace (but I am less favorable to this option).\n> \n> - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).\n\nIndeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.\n> \n> There's still likely a few more things that might need a little bit of attention, but I am pretty sure these are all of the main points.",
    "created_at": "2016-04-29T09:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249668",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:28 tscrim]:
> Yay, finally had time to go through this. So, compared to the previous ticket, there is a lot less to discuss. I've mostly pushed a bunch of documentation changes on my last commit. 

Thank you very much for working on this !

>However, I think there are still a few things to do.
> 
> - I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC.

Yes there will be other subclasses of `CoordFunction`: a major project is to have a subclass for numerical functions, in order to deal with numerical manifolds (for instance computer-generated spacetimes on a grid). This was the very purpose for creating this ABC: it provides the unique interface with the rest of tensor calculus on manifolds, factoring out what has to be implemented by a concrete class (the abstract methods). So I think it is important to maintain the ABC.

> Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.

OK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)

>   Also, I converted the methods in `CoordFunction` to ``@`abstract_method` since these get picked up by the `TestSuite` as opposed to raising a `NotImplementedError`.

Thanks. I didn't know about this.

> (I haven't fixed the doctests yet in case the ABC gets removed.)
> 
> - I understand why you want to put "the" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.
>

Sorry, I am not sure I understand what you mean. Can you elaborate on this?
 
> - Similarly, in the docstrings, we should change "the *" to "this *" (sorry I didn't catch this previously).
> 
> - I don't like `omit_function_args` and `nice_derivatives` being included in the global namespace. I think these are better converted to global options. 

Agreed.

>The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. 

`TopologicalManifold` sounds good, since this where the charts live in the current approach.

>Either that, or we just have one object `ManifoldOptions` into the global namespace (but I am less favorable to this option).
> 
> - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).

Indeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.
> 
> There's still likely a few more things that might need a little bit of attention, but I am pretty sure these are all of the main points.



---

archive/issue_comments_249669.json:
```json
{
    "body": "Replying to [comment:29 egourgoulhon]:\n> Replying to [comment:28 tscrim]:\n> > - I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC.\n> \n> Yes there will be other subclasses of `CoordFunction`: a major project is to have a subclass for numerical functions, in order to deal with numerical manifolds (for instance computer-generated spacetimes on a grid). This was the very purpose for creating this ABC: it provides the unique interface with the rest of tensor calculus on manifolds, factoring out what has to be implemented by a concrete class (the abstract methods). So I think it is important to maintain the ABC.\n\nI guess what I am asking is how much of concrete class `CoordFunctionSym` can be lifted to the ABC?\n\n> > Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.\n> \n> OK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)\n\nIt should be a fairly small class; a parent that takes a chart as input. I can work on this for my next commit.\n\n> > - I understand why you want to put \"the\" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.\n> \n> Sorry, I am not sure I understand what you mean. Can you elaborate on this?\n\nWhen you say \"the manifold,\" you are saying there is a unique manifold. Context makes it clear exactly which manifold you're talking about (and hence unique), but for something like documentation, \"this manifold\" better defines what you are reference (although personally, I would just replace it by ```self```...).\n\n> >The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. \n> \n> `TopologicalManifold` sounds good, since this where the charts live in the current approach.\n\nI will do this on the next commit.\n\n> > - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).\n> \n> Indeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.\n\nSo we will just watch what happens with #20475, which might means we need to mark them as `# known bug` and revert them in #20475.",
    "created_at": "2016-04-29T20:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249669",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:29 egourgoulhon]:
> Replying to [comment:28 tscrim]:
> > - I am guessing there will eventually be another subclass of `CoordFunction`? At present, there does not seem to be a reason to have an ABC.
> 
> Yes there will be other subclasses of `CoordFunction`: a major project is to have a subclass for numerical functions, in order to deal with numerical manifolds (for instance computer-generated spacetimes on a grid). This was the very purpose for creating this ABC: it provides the unique interface with the rest of tensor calculus on manifolds, factoring out what has to be implemented by a concrete class (the abstract methods). So I think it is important to maintain the ABC.

I guess what I am asking is how much of concrete class `CoordFunctionSym` can be lifted to the ABC?

> > Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.
> 
> OK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)

It should be a fairly small class; a parent that takes a chart as input. I can work on this for my next commit.

> > - I understand why you want to put "the" in the string representations (e.g., in `ScalarFieldAlgebra`) because it is how we would say it (in English), but this breaks convention with other parts of Sage. Moreover, it implies a certain amount of uniqueness to the manifold. However, there could be 2 different manifolds with the same dimension, name, etc.
> 
> Sorry, I am not sure I understand what you mean. Can you elaborate on this?

When you say "the manifold," you are saying there is a unique manifold. Context makes it clear exactly which manifold you're talking about (and hence unique), but for something like documentation, "this manifold" better defines what you are reference (although personally, I would just replace it by ```self```...).

> >The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. 
> 
> `TopologicalManifold` sounds good, since this where the charts live in the current approach.

I will do this on the next commit.

> > - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).
> 
> Indeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.

So we will just watch what happens with #20475, which might means we need to mark them as `# known bug` and revert them in #20475.



---

archive/issue_comments_249670.json:
```json
{
    "body": "Replying to [comment:30 tscrim]:\n> \n> I guess what I am asking is how much of concrete class `CoordFunctionSym` can be lifted to the ABC?\n> \n\nNot much: I would say that `CoordFunctionSymb` is optimal: everything that could be lifted to the ABC `CoordFunction` is already  there. \n\n> > > Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.\n> > \n> > OK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)\n> \n> It should be a fairly small class; a parent that takes a chart as input. I can work on this for my next commit.\n\nOK thanks. \n> \n\n> \n> When you say \"the manifold,\" you are saying there is a unique manifold. Context makes it clear exactly which manifold you're talking about (and hence unique), but for something like documentation, \"this manifold\" better defines what you are reference (although personally, I would just replace it by ```self```...).\n\nThanks for these explanations. As you, I would favor `self` (which is completely unambiguous), but I remember a discussion on sage-devel, the conclusion of which was that one should avoid the mention of `self` in the documentation, to make it more readable for newcomers. So let's go for \"this manifold\". \n\n> \n> > >The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. \n> > \n> > `TopologicalManifold` sounds good, since this where the charts live in the current approach.\n> \n> I will do this on the next commit.\n\nOK very good.\n> \n> > > - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).\n> > \n> > Indeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.\n> \n> So we will just watch what happens with #20475, which might means we need to mark them as `# known bug` and revert them in #20475.\n\nOK.",
    "created_at": "2016-04-30T10:04:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249670",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:30 tscrim]:
> 
> I guess what I am asking is how much of concrete class `CoordFunctionSym` can be lifted to the ABC?
> 

Not much: I would say that `CoordFunctionSymb` is optimal: everything that could be lifted to the ABC `CoordFunction` is already  there. 

> > > Moreover, you could probably make any numerical coordinate chart be `._express` with the appropriate methods. However, I am wondering if there should be a parent for `CoordFunction` (and have `CoordFunction` be a subclass of `AlgebraElement`), which would allow you to not duplicate code and use the coercion framework. Actually, perhaps `CoordFunction` should be a subclass of `Morphism`.
> > 
> > OK, I will give a try to this, introducing the proper algebra (no time to do it right now, though...)
> 
> It should be a fairly small class; a parent that takes a chart as input. I can work on this for my next commit.

OK thanks. 
> 

> 
> When you say "the manifold," you are saying there is a unique manifold. Context makes it clear exactly which manifold you're talking about (and hence unique), but for something like documentation, "this manifold" better defines what you are reference (although personally, I would just replace it by ```self```...).

Thanks for these explanations. As you, I would favor `self` (which is completely unambiguous), but I remember a discussion on sage-devel, the conclusion of which was that one should avoid the mention of `self` in the documentation, to make it more readable for newcomers. So let's go for "this manifold". 

> 
> > >The question becomes what to attach the global options to. I am thinking `Manifold` (a function is a Python object too, so we can attach data to it) and `TopologicalManifold`. 
> > 
> > `TopologicalManifold` sounds good, since this where the charts live in the current approach.
> 
> I will do this on the next commit.

OK very good.
> 
> > > - There are failing doctests in `utilities.py` likely due to recent changes in the symbolic function code (independent of my changes).
> > 
> > Indeed this reflects some bug in the latest pynac (cf. #20456); fortunately it is fixed by #20475; so if the latter is merged before the current ticket, we can leave the doctests as they are.
> 
> So we will just watch what happens with #20475, which might means we need to mark them as `# known bug` and revert them in #20475.

OK.



---

archive/issue_comments_249671.json:
```json
{
    "body": "Another question, should `MultiCoordFunction` be a subclass of `CoordFunction`, should they have a common ABC, or should they be unrelated (as they are now)?",
    "created_at": "2016-05-01T18:36:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249671",
    "user": "https://github.com/tscrim"
}
```

Another question, should `MultiCoordFunction` be a subclass of `CoordFunction`, should they have a common ABC, or should they be unrelated (as they are now)?



---

archive/issue_comments_249672.json:
```json
{
    "body": "Replying to [comment:32 tscrim]:\n> Another question, should `MultiCoordFunction` be a subclass of `CoordFunction`, should they have a common ABC, or should they be unrelated (as they are now)?\n\nIt seems to me that they should be unrelated, as far as inheritance is concerned. Basically a `MultiCoordFunction` object is a tuple of `CoordFunction` objects.",
    "created_at": "2016-05-01T19:51:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249672",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:32 tscrim]:
> Another question, should `MultiCoordFunction` be a subclass of `CoordFunction`, should they have a common ABC, or should they be unrelated (as they are now)?

It seems to me that they should be unrelated, as far as inheritance is concerned. Basically a `MultiCoordFunction` object is a tuple of `CoordFunction` objects.



---

archive/issue_comments_249673.json:
```json
{
    "body": "Okay, next question. Do you have a reason why `jacobian` does not return a matrix?",
    "created_at": "2016-05-01T20:27:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249673",
    "user": "https://github.com/tscrim"
}
```

Okay, next question. Do you have a reason why `jacobian` does not return a matrix?



---

archive/issue_comments_249674.json:
```json
{
    "body": "Ah, it is because its elements are instances of `CoordFunction` rather than elements of `SR`. Nevermind.",
    "created_at": "2016-05-01T20:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249674",
    "user": "https://github.com/tscrim"
}
```

Ah, it is because its elements are instances of `CoordFunction` rather than elements of `SR`. Nevermind.



---

archive/issue_comments_249675.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-03T05:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249675",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249676.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2016-05-03T05:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249676",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_249677.json:
```json
{
    "body": "Wee, finally had time to get it all done. I started to use ```self``` because I recall less consensus on the sage-devel thread; a good chuck of code uses it; if we add more code, it becomes standard; and it simplifies a number of the doc sentences' structure. I did not implement as much coercion as might be possible (i.e., coordinate functions could coerce to the smallest chart they are defined on), but the door is open to do so. I also added the global options and marked the tests in `utilities.py` as `# known bug`. So if my changes are good with you, then we can set this to a positive review.",
    "created_at": "2016-05-03T05:18:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249677",
    "user": "https://github.com/tscrim"
}
```

Wee, finally had time to get it all done. I started to use ```self``` because I recall less consensus on the sage-devel thread; a good chuck of code uses it; if we add more code, it becomes standard; and it simplifies a number of the doc sentences' structure. I did not implement as much coercion as might be possible (i.e., coordinate functions could coerce to the smallest chart they are defined on), but the door is open to do so. I also added the global options and marked the tests in `utilities.py` as `# known bug`. So if my changes are good with you, then we can set this to a positive review.



---

archive/issue_comments_249678.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-05T21:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249678",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249679.json:
```json
{
    "body": "Replying to [comment:37 tscrim]:\n> Wee, finally had time to get it all done. \n\nThanks a lot for your work. It's nice to have the coordinate functions in the parent/element scheme! In the above commit, I have simply changed the category of the parent to `CommutativeAlgebras(SR)` and suppressed the alias `is_commutative`. I have also added a few doctests and made some slight improvements in the documentation.\n>I started to use ```self``` because I recall less consensus on the sage-devel thread; a good chuck of code uses it; if we add more code, it becomes standard; and it simplifies a number of the doc sentences' structure. \nOK\n>I did not implement as much coercion as might be possible (i.e., coordinate functions could coerce to the smallest chart they are defined on), but the door is open to do so. \nIndeed.\n>I also added the global options and marked the tests in `utilities.py` as `# known bug`.\nFine.\n>So if my changes are good with you, then we can set this to a positive review.\nPlease wait until tomorrow: I will check that the changes propagate nicely to all tickets of #18528 (I've done it already for the next ticket (#18725).",
    "created_at": "2016-05-05T22:08:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249679",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:37 tscrim]:
> Wee, finally had time to get it all done. 

Thanks a lot for your work. It's nice to have the coordinate functions in the parent/element scheme! In the above commit, I have simply changed the category of the parent to `CommutativeAlgebras(SR)` and suppressed the alias `is_commutative`. I have also added a few doctests and made some slight improvements in the documentation.
>I started to use ```self``` because I recall less consensus on the sage-devel thread; a good chuck of code uses it; if we add more code, it becomes standard; and it simplifies a number of the doc sentences' structure. 
OK
>I did not implement as much coercion as might be possible (i.e., coordinate functions could coerce to the smallest chart they are defined on), but the door is open to do so. 
Indeed.
>I also added the global options and marked the tests in `utilities.py` as `# known bug`.
Fine.
>So if my changes are good with you, then we can set this to a positive review.
Please wait until tomorrow: I will check that the changes propagate nicely to all tickets of #18528 (I've done it already for the next ticket (#18725).



---

archive/issue_comments_249680.json:
```json
{
    "body": "Your changes look good to me. So if everything propagates up nicely. Then you can set a positive review (unfortunately it seems like this won't get into 7.2 :/).",
    "created_at": "2016-05-05T22:48:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249680",
    "user": "https://github.com/tscrim"
}
```

Your changes look good to me. So if everything propagates up nicely. Then you can set a positive review (unfortunately it seems like this won't get into 7.2 :/).



---

archive/issue_comments_249681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-06T03:47:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249682.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-05-06T14:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249682",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_249683.json:
```json
{
    "body": "Replying to [comment:42 tscrim]:\n> Your changes look good to me. So if everything propagates up nicely. Then you can set a positive review (unfortunately it seems like this won't get into 7.2 :/).\n\nGood news: I've propagated the changes to all tickets up to #19209 (pseudo-Riemannian metrics): everything works fine! (this was also the occasion to move all print instructions to Python3 syntax and to correct the bibliographic references according to #20496). So everything is OK for me.",
    "created_at": "2016-05-06T21:16:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249683",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:42 tscrim]:
> Your changes look good to me. So if everything propagates up nicely. Then you can set a positive review (unfortunately it seems like this won't get into 7.2 :/).

Good news: I've propagated the changes to all tickets up to #19209 (pseudo-Riemannian metrics): everything works fine! (this was also the occasion to move all print instructions to Python3 syntax and to correct the bibliographic references according to #20496). So everything is OK for me.



---

archive/issue_comments_249684.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-05-06T22:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249684",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_249685.json:
```json
{
    "body": "Great. All is good with me. Positive review.",
    "created_at": "2016-05-06T22:00:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249685",
    "user": "https://github.com/tscrim"
}
```

Great. All is good with me. Positive review.



---

archive/issue_comments_249686.json:
```json
{
    "body": "Replying to [comment:46 tscrim]:\n> Great. All is good with me. Positive review.\n\nThanks !",
    "created_at": "2016-05-07T07:40:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249686",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:46 tscrim]:
> Great. All is good with me. Positive review.

Thanks !



---

archive/issue_comments_249687.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-05-17T07:16:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18403#issuecomment-249687",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
