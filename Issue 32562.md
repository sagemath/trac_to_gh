# Issue 32562: Explicitly set MPMATH_SAGE env variable

Issue created by migration from https://trac.sagemath.org/ticket/32799

Original creator: arojas

Original creation time: 2021-10-30 11:02:28

CC:  mkoeppe fbissey dimpase isuruf




---

Comment by arojas created at 2021-10-30 11:14:01

Changing type from PLEASE CHANGE to defect.


---

Comment by arojas created at 2021-10-30 11:14:01

Changing status from new to needs_review.


---

Comment by arojas created at 2021-10-30 11:14:01

New commits:


---

Comment by arojas created at 2021-10-30 11:14:01

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by slelievre created at 2021-10-30 11:29:18

See also

- #25445: Incompatibilities in Sage mpmath cause downstream issues in SymPy
- [sage-devel, 2021-10-17](https://groups.google.com/g/sage-devel/c/Zo2LFxtOJBE):
  BUG: Si(pi).n() throws error in sage 9.2-2
- [sage-devel, 2021-03-18](https://groups.google.com/g/sage-devel/c/MSDXHtzb00Q):
  Pointy Python question related to Sage


---

Comment by fbissey created at 2021-10-30 19:13:36

This is the minimum to do vanilla sage. I have already endorsed the approach in principle months ago. I am not sure I would check `MPMATH_SAGE` first since I'd always want it to be `1`, unless I explicitly want to break things.

I would like more opinion on that one because not providing a way to override is contentious.


---

Comment by mkoeppe created at 2021-10-30 19:20:46

We should probably set this environment variable in the Sage Python library, not in the `sage-env` script.


---

Comment by fbissey created at 2021-10-30 19:26:32

Replying to [comment:5 mkoeppe]:
> We should probably set this environment variable in the Sage Python library, not in the `sage-env` script.

I agree with that. If I knew how to do it, there would already be a ticket for it ready to review. The stuff I tried didn't work, the only things I can think of require cooperation from mpmath devs.


---

Comment by git created at 2021-10-30 19:36:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2021-10-30 19:40:42

Replying to [comment:6 fbissey]: 
> I agree with that. If I knew how to do it, there would already be a ticket for it ready to review. The stuff I tried didn't work, the only things I can think of require cooperation from mpmath devs.

Does this not work for you?


---

Comment by fbissey created at 2021-10-30 19:54:23

No, because it is too late to set an environment variable. You are already in the application and it is run with the variables it was launched with. You would need a python variable to tell `mpmath` that it has been imported from `sage`.


---

Comment by fbissey created at 2021-10-30 19:56:21

It would work if you started a new application like what happens in `sage/interface/*.py` with `pexpect` but not while running.


---

Comment by arojas created at 2021-10-30 20:13:06

Replying to [comment:9 fbissey]:
> No, because it is too late to set an environment variable. You are already in the application and it is run with the variables it was launched with. You would need a python variable to tell `mpmath` that it has been imported from `sage`.

Can you give more details on how exactly it is failing for you? Because everything seems to work fine for me (both doctests and running stuff from a sage session)


---

Comment by fbissey created at 2021-10-30 21:03:41

OK, it surprisingly works. I must have had a messed up environment when I tried it.


---

Comment by fbissey created at 2021-10-30 21:03:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-11-02 22:36:25

Resolution: fixed
