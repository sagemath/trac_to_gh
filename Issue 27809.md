# Issue 27809: Improving the weight_function check in _check_weight_function method

Issue created by migration from https://trac.sagemath.org/ticket/28046

Original creator: @rajat1433

Original creation time: 2019-06-23 01:40:38

CC:  dcoudert

Currently if any string is inputted as a weight in weight_function the _check_weight_function converts it into a float without raising any error.
But this can be problematic as per below example.



```

sage: g = digraphs.DeBruijn(2, 3)
sage: shortest_path_func = g._backend.bidirectional_dijkstra
sage: def weight_function(e):
....:     return e[2]
....: 
sage: shortest_path_func('000', '111', weight_function=weight_function)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-c0f776a1b620> in <module>()
----> 1 shortest_path_func('000', '111', weight_function=weight_function)

/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:24892)()
   2707                         # negative value of distance + edge_label is stored in
   2708                         # priority_queue to get minimum distance
-> 2709                         pq.push(((-(distance + edge_label), side), (v, w)))
   2710 
   2711         # No meeting point has been found

TypeError: unsupported operand type(s) for +: 'int' and 'str'
```


So this ticket aims at fixing this issue.


---

Comment by @rajat1433 created at 2019-06-23 01:42:52

Set assignee to @rajat1433.


---

Comment by git created at 2019-06-23 02:09:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dcoudert created at 2019-06-23 08:26:40

- The doctest with `G = digraphs.DeBruijn(2, 3)` is failing with Python 3: the tested edge is not the same.
So use instead `G = Graph({0: {1: '123'}})` 

- Use a temporary variable to store `weight_function(e)` and so avoid to call the function twice.

- In the `raise` statement of the `if isinstance(...):`, there is not need for a proper message.  Here, you can raise what you want, the error message will be catch by the except statement.


---

Comment by dcoudert created at 2019-06-23 08:28:47

Also, in Python3 we will have the `str` versus `bytes` issue..., so use `isinstance(weight_function(e), (str, bytes))`


---

Comment by git created at 2019-06-23 09:15:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @rajat1433 created at 2019-06-23 09:38:02

Changing status from new to needs_review.


---

Comment by dcoudert created at 2019-06-23 09:38:56

Changing status from needs_review to positive_review.


---

Comment by dcoudert created at 2019-06-23 09:38:56

LGTM.


---

Comment by vbraun created at 2019-06-28 04:29:24

Resolution: fixed
