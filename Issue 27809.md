# Issue 27809: Improving the weight_function check in _check_weight_function method

archive/issues_027809.json:
```json
{
    "body": "CC:  @dcoudert\n\nCurrently if any string is inputted as a weight in weight_function the _check_weight_function converts it into a float without raising any error.\nBut this can be problematic as per below example.\n\n\n\n```\n\nsage: g = digraphs.DeBruijn(2, 3)\nsage: shortest_path_func = g._backend.bidirectional_dijkstra\nsage: def weight_function(e):\n....:     return e[2]\n....: \nsage: shortest_path_func('000', '111', weight_function=weight_function)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-8-c0f776a1b620> in <module>()\n----> 1 shortest_path_func('000', '111', weight_function=weight_function)\n\n/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:24892)()\n   2707                         # negative value of distance + edge_label is stored in\n   2708                         # priority_queue to get minimum distance\n-> 2709                         pq.push(((-(distance + edge_label), side), (v, w)))\n   2710 \n   2711         # No meeting point has been found\n\nTypeError: unsupported operand type(s) for +: 'int' and 'str'\n```\n\n\nSo this ticket aims at fixing this issue.\n\nIssue created by migration from https://trac.sagemath.org/ticket/28046\n\n",
    "created_at": "2019-06-23T01:40:38Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.9",
    "title": "Improving the weight_function check in _check_weight_function method",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27809",
    "user": "https://github.com/rajat1433"
}
```
CC:  @dcoudert

Currently if any string is inputted as a weight in weight_function the _check_weight_function converts it into a float without raising any error.
But this can be problematic as per below example.



```

sage: g = digraphs.DeBruijn(2, 3)
sage: shortest_path_func = g._backend.bidirectional_dijkstra
sage: def weight_function(e):
....:     return e[2]
....: 
sage: shortest_path_func('000', '111', weight_function=weight_function)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-c0f776a1b620> in <module>()
----> 1 shortest_path_func('000', '111', weight_function=weight_function)

/home/rajat/new_version/sage-8.7.beta6/local/lib/python2.7/site-packages/sage/graphs/base/c_graph.pyx in sage.graphs.base.c_graph.CGraphBackend.bidirectional_dijkstra (build/cythonized/sage/graphs/base/c_graph.cpp:24892)()
   2707                         # negative value of distance + edge_label is stored in
   2708                         # priority_queue to get minimum distance
-> 2709                         pq.push(((-(distance + edge_label), side), (v, w)))
   2710 
   2711         # No meeting point has been found

TypeError: unsupported operand type(s) for +: 'int' and 'str'
```


So this ticket aims at fixing this issue.

Issue created by migration from https://trac.sagemath.org/ticket/28046





---

archive/issue_comments_392373.json:
```json
{
    "body": "Set assignee to @rajat1433.",
    "created_at": "2019-06-23T01:42:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392373",
    "user": "https://github.com/rajat1433"
}
```

Set assignee to @rajat1433.



---

archive/issue_comments_392374.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-23T02:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392374",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_392375.json:
```json
{
    "body": "- The doctest with `G = digraphs.DeBruijn(2, 3)` is failing with Python 3: the tested edge is not the same.\nSo use instead `G = Graph({0: {1: '123'}})` \n\n- Use a temporary variable to store `weight_function(e)` and so avoid to call the function twice.\n\n- In the `raise` statement of the `if isinstance(...):`, there is not need for a proper message.  Here, you can raise what you want, the error message will be catch by the except statement.",
    "created_at": "2019-06-23T08:26:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392375",
    "user": "https://github.com/dcoudert"
}
```

- The doctest with `G = digraphs.DeBruijn(2, 3)` is failing with Python 3: the tested edge is not the same.
So use instead `G = Graph({0: {1: '123'}})` 

- Use a temporary variable to store `weight_function(e)` and so avoid to call the function twice.

- In the `raise` statement of the `if isinstance(...):`, there is not need for a proper message.  Here, you can raise what you want, the error message will be catch by the except statement.



---

archive/issue_comments_392376.json:
```json
{
    "body": "Also, in Python3 we will have the `str` versus `bytes` issue..., so use `isinstance(weight_function(e), (str, bytes))`",
    "created_at": "2019-06-23T08:28:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392376",
    "user": "https://github.com/dcoudert"
}
```

Also, in Python3 we will have the `str` versus `bytes` issue..., so use `isinstance(weight_function(e), (str, bytes))`



---

archive/issue_comments_392377.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-06-23T09:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_392378.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-06-23T09:38:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392378",
    "user": "https://github.com/rajat1433"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_392379.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-06-23T09:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392379",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_392380.json:
```json
{
    "body": "LGTM.",
    "created_at": "2019-06-23T09:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392380",
    "user": "https://github.com/dcoudert"
}
```

LGTM.



---

archive/issue_events_025804.json:
```json
{
    "actor": "@vbraun",
    "created_at": "2019-06-28T04:29:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/27809#event-25804"
}
```



---

archive/issue_comments_392381.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-06-28T04:29:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27809",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27809#issuecomment-392381",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
