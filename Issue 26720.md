# Issue 26720: bug in polynomial real root (bis)

archive/issues_026720.json:
```json
{
    "body": "CC:  cwitty @mezzarobba\n\nA maximum recursion depth `RuntimeError` is obtained with\n\n```\nl = [1, 0, 3, 2, -1, 0, 1, 2, -2, 0, 0, 27, 1, -1, -1, 1,\n     1, 0, -2, 1, 1, 1, -2, 0, -176, -3, -1, 116, 2, -1,\n     0, 0, -2, 8, 8, 34, 3, 1, 0, -1, -6, 1]\np = ZZ['x'](l)\np.roots(AA)\n```\n\nThe full traceback is\n\n```\nRuntimeError                              Traceback (most recent call last)\n<ipython-input-303-35d8367cd398> in <module>()\n      1 l = list(p)\n----> 2 ZZ['x'](l).roots(AA)\n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:62263)()\n   7748 \n   7749                 if is_AlgebraicRealField(L):\n-> 7750                     rts = real_roots(self, retval='algebraic_real')\n   7751                 else:\n   7752                     diam = ~(ZZ(1) << L.prec())\n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.real_roots (build/cythonized/sage/rings/polynomial/real_roots.c:44168)()\n   4053 \n   4054             oc = ocean(ctx, bernstein_polynomial_factory_ratlist(b), linear_map(left, right))\n-> 4055             oc.find_roots()\n   4056             oceans.append((oc, factor, exp))\n   4057 \n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.find_roots (build/cythonized/sage/rings/polynomial/real_roots.c:33037)()\n   3069         \"\"\"\n   3070         while not self.all_done():\n-> 3071             self.refine_all()\n   3072             self.increase_precision()\n   3073 \n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.refine_all (build/cythonized/sage/rings/polynomial/real_roots.c:33332)()\n   3114         while isle is not self.endpoint:\n   3115             if not isle.done(self.ctx):\n-> 3116                 isle.refine(self.ctx)\n   3117             isle = isle.rgap.risland\n   3118 \n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine (build/cythonized/sage/rings/polynomial/real_roots.c:35647)()\n   3367         self.shrink_bp(ctx)\n   3368         try:\n-> 3369             self.refine_recurse(ctx, self.bp, self.ancestors, [], True)\n   3370         except PrecisionError:\n   3371             pass\n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()\n   3515                         return\n   3516                 else:\n-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)\n   3518                     assert(self.lgap.upper == p2.lower)\n   3519                     bp = p2\n\n... last 1 frames repeated, from the frame below ...\n\n/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()\n   3515                         return\n   3516                 else:\n-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)\n   3518                     assert(self.lgap.upper == p2.lower)\n   3519                     bp = p2\n\nRuntimeError: maximum recursion depth exceeded while calling a Python object\n```\n\n\n(See also #26955 for another bug)\n\nIssue created by migration from https://trac.sagemath.org/ticket/26957\n\n",
    "created_at": "2018-12-25T17:00:52Z",
    "labels": [
        "component: algebra",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "bug in polynomial real root (bis)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26720",
    "user": "https://github.com/videlec"
}
```
CC:  cwitty @mezzarobba

A maximum recursion depth `RuntimeError` is obtained with

```
l = [1, 0, 3, 2, -1, 0, 1, 2, -2, 0, 0, 27, 1, -1, -1, 1,
     1, 0, -2, 1, 1, 1, -2, 0, -176, -3, -1, 116, 2, -1,
     0, 0, -2, 8, 8, 34, 3, 1, 0, -1, -6, 1]
p = ZZ['x'](l)
p.roots(AA)
```

The full traceback is

```
RuntimeError                              Traceback (most recent call last)
<ipython-input-303-35d8367cd398> in <module>()
      1 l = list(p)
----> 2 ZZ['x'](l).roots(AA)

/usr/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:62263)()
   7748 
   7749                 if is_AlgebraicRealField(L):
-> 7750                     rts = real_roots(self, retval='algebraic_real')
   7751                 else:
   7752                     diam = ~(ZZ(1) << L.prec())

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.real_roots (build/cythonized/sage/rings/polynomial/real_roots.c:44168)()
   4053 
   4054             oc = ocean(ctx, bernstein_polynomial_factory_ratlist(b), linear_map(left, right))
-> 4055             oc.find_roots()
   4056             oceans.append((oc, factor, exp))
   4057 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.find_roots (build/cythonized/sage/rings/polynomial/real_roots.c:33037)()
   3069         """
   3070         while not self.all_done():
-> 3071             self.refine_all()
   3072             self.increase_precision()
   3073 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.refine_all (build/cythonized/sage/rings/polynomial/real_roots.c:33332)()
   3114         while isle is not self.endpoint:
   3115             if not isle.done(self.ctx):
-> 3116                 isle.refine(self.ctx)
   3117             isle = isle.rgap.risland
   3118 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine (build/cythonized/sage/rings/polynomial/real_roots.c:35647)()
   3367         self.shrink_bp(ctx)
   3368         try:
-> 3369             self.refine_recurse(ctx, self.bp, self.ancestors, [], True)
   3370         except PrecisionError:
   3371             pass

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()
   3515                         return
   3516                 else:
-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)
   3518                     assert(self.lgap.upper == p2.lower)
   3519                     bp = p2

... last 1 frames repeated, from the frame below ...

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()
   3515                         return
   3516                 else:
-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)
   3518                     assert(self.lgap.upper == p2.lower)
   3519                     bp = p2

RuntimeError: maximum recursion depth exceeded while calling a Python object
```


(See also #26955 for another bug)

Issue created by migration from https://trac.sagemath.org/ticket/26957





---

archive/issue_comments_375394.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375394",
    "user": "https://github.com/embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_375395.json:
```json
{
    "body": "Moving all blocker/critical issues from 8.7 to 8.8.",
    "created_at": "2019-03-25T10:41:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375395",
    "user": "https://github.com/embray"
}
```

Moving all blocker/critical issues from 8.7 to 8.8.



---

archive/issue_comments_375396.json:
```json
{
    "body": "Moving open critical and blocker issues to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:39:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375396",
    "user": "https://github.com/embray"
}
```

Moving open critical and blocker issues to the next release milestone (optimistically).



---

archive/issue_comments_375397.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375397",
    "user": "https://github.com/embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_375398.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-20T20:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375398",
    "user": "https://github.com/bmlivin"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_375399.json:
```json
{
    "body": "Like its sister ticket ([#26955](https://trac.sagemath.org/ticket/26955)), this appears to be fixed in Sage 9.2.beta12, if not earlier.",
    "created_at": "2020-09-20T20:57:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375399",
    "user": "https://github.com/bmlivin"
}
```

Like its sister ticket ([#26955](https://trac.sagemath.org/ticket/26955)), this appears to be fixed in Sage 9.2.beta12, if not earlier.



---

archive/issue_comments_375400.json:
```json
{
    "body": "But #20390 is still present. Strange.",
    "created_at": "2020-09-21T05:38:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375400",
    "user": "https://github.com/mezzarobba"
}
```

But #20390 is still present. Strange.



---

archive/issue_comments_375401.json:
```json
{
    "body": "Please let's add a doctest.",
    "created_at": "2020-10-05T10:09:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375401",
    "user": "https://github.com/slel"
}
```

Please let's add a doctest.



---

archive/issue_comments_375402.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-10-05T10:10:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375402",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_375403.json:
```json
{
    "body": "**not fixed** in 9.2.rc0 for me\n----\nNew commits:",
    "created_at": "2020-10-06T16:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375403",
    "user": "https://github.com/fchapoton"
}
```

**not fixed** in 9.2.rc0 for me
----
New commits:



---

archive/issue_comments_375404.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26720",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26720#issuecomment-375404",
    "user": "https://github.com/mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
