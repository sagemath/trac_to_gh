# Issue 26720: bug in polynomial real root (bis)

Issue created by migration from https://trac.sagemath.org/ticket/26957

Original creator: vdelecroix

Original creation time: 2018-12-25 17:00:52

CC:  â€‹cwitty mmezzarobba

A maximum recursion depth `RuntimeError` is obtained with

```
l = [1, 0, 3, 2, -1, 0, 1, 2, -2, 0, 0, 27, 1, -1, -1, 1,
     1, 0, -2, 1, 1, 1, -2, 0, -176, -3, -1, 116, 2, -1,
     0, 0, -2, 8, 8, 34, 3, 1, 0, -1, -6, 1]
p = ZZ['x'](l)
p.roots(AA)
```

The full traceback is

```
RuntimeError                              Traceback (most recent call last)
<ipython-input-303-35d8367cd398> in <module>()
      1 l = list(p)
----> 2 ZZ['x'](l).roots(AA)

/usr/lib/python2.7/site-packages/sage/rings/polynomial/polynomial_element.pyx in sage.rings.polynomial.polynomial_element.Polynomial.roots (build/cythonized/sage/rings/polynomial/polynomial_element.c:62263)()
   7748 
   7749                 if is_AlgebraicRealField(L):
-> 7750                     rts = real_roots(self, retval='algebraic_real')
   7751                 else:
   7752                     diam = ~(ZZ(1) << L.prec())

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.real_roots (build/cythonized/sage/rings/polynomial/real_roots.c:44168)()
   4053 
   4054             oc = ocean(ctx, bernstein_polynomial_factory_ratlist(b), linear_map(left, right))
-> 4055             oc.find_roots()
   4056             oceans.append((oc, factor, exp))
   4057 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.find_roots (build/cythonized/sage/rings/polynomial/real_roots.c:33037)()
   3069         """
   3070         while not self.all_done():
-> 3071             self.refine_all()
   3072             self.increase_precision()
   3073 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.ocean.refine_all (build/cythonized/sage/rings/polynomial/real_roots.c:33332)()
   3114         while isle is not self.endpoint:
   3115             if not isle.done(self.ctx):
-> 3116                 isle.refine(self.ctx)
   3117             isle = isle.rgap.risland
   3118 

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine (build/cythonized/sage/rings/polynomial/real_roots.c:35647)()
   3367         self.shrink_bp(ctx)
   3368         try:
-> 3369             self.refine_recurse(ctx, self.bp, self.ancestors, [], True)
   3370         except PrecisionError:
   3371             pass

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()
   3515                         return
   3516                 else:
-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)
   3518                     assert(self.lgap.upper == p2.lower)
   3519                     bp = p2

... last 1 frames repeated, from the frame below ...

/usr/lib/python2.7/site-packages/sage/rings/polynomial/real_roots.pyx in sage.rings.polynomial.real_roots.island.refine_recurse (build/cythonized/sage/rings/polynomial/real_roots.c:37473)()
   3515                         return
   3516                 else:
-> 3517                     self.refine_recurse(ctx, p1, ancestors, history, False)
   3518                     assert(self.lgap.upper == p2.lower)
   3519                     bp = p2

RuntimeError: maximum recursion depth exceeded while calling a Python object
```


(See also #26955 for another bug)


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by embray created at 2019-03-25 10:41:19

Moving all blocker/critical issues from 8.7 to 8.8.


---

Comment by embray created at 2019-07-03 11:39:12

Moving open critical and blocker issues to the next release milestone (optimistically).


---

Comment by embray created at 2019-12-30 14:48:17

Ticket retargeted after milestone closed


---

Comment by @bmlivin created at 2020-09-20 20:57:13

Changing status from new to needs_review.


---

Comment by @bmlivin created at 2020-09-20 20:57:13

Like its sister ticket ([#26955](https://trac.sagemath.org/ticket/26955)), this appears to be fixed in Sage 9.2.beta12, if not earlier.


---

Comment by mmezzarobba created at 2020-09-21 05:38:54

But #20390 is still present. Strange.


---

Comment by slelievre created at 2020-10-05 10:09:18

Changing priority from critical to major.


---

Comment by slelievre created at 2020-10-05 10:09:18

Please let's add a doctest.


---

Comment by slelievre created at 2020-10-05 10:10:00

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2020-10-06 16:51:04

**not fixed** in 9.2.rc0 for me
----
New commits:


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
