# Issue 23136: Fix structure coefficients for simple Lie algebras in Chevalley basis

archive/issues_023136.json:
```json
{
    "body": "CC:  sage-combinat @bsalisbury1\n\nCurrently, there is a discrepancy between `L._basis_key` and the sorting order for `L._indices`, which cases `L.structure_coefficients(True)` to be incorrect. This leads to\n\n```\nsage: L = lie_algebras.sl(QQ, 2)\nsage: L.universal_enveloping_algebra() # BOOM\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/23373\n\n",
    "created_at": "2017-07-06T00:05:33Z",
    "labels": [
        "algebra",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.0",
    "title": "Fix structure coefficients for simple Lie algebras in Chevalley basis",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23136",
    "user": "@tscrim"
}
```
CC:  sage-combinat @bsalisbury1

Currently, there is a discrepancy between `L._basis_key` and the sorting order for `L._indices`, which cases `L.structure_coefficients(True)` to be incorrect. This leads to

```
sage: L = lie_algebras.sl(QQ, 2)
sage: L.universal_enveloping_algebra() # BOOM
```


Issue created by migration from https://trac.sagemath.org/ticket/23373





---

archive/issue_comments_323626.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-07-06T00:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323626",
    "user": "@tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_323627.json:
```json
{
    "body": "I also add some extra safeguards in `L.structure_coefficients` to get rid of the assumption that structure coefficients are indexed by pairs `(a, b)` with `a < b`.\n----\nNew commits:",
    "created_at": "2017-07-06T00:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323627",
    "user": "@tscrim"
}
```

I also add some extra safeguards in `L.structure_coefficients` to get rid of the assumption that structure coefficients are indexed by pairs `(a, b)` with `a < b`.
----
New commits:



---

archive/issue_comments_323628.json:
```json
{
    "body": "ok, green bot, let it be",
    "created_at": "2017-07-07T08:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323628",
    "user": "@fchapoton"
}
```

ok, green bot, let it be



---

archive/issue_comments_323629.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-07T08:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323629",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_323630.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-07-25T22:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323630",
    "user": "@vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_323631.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py\n**********************************************************************\nFile \"src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py\", line 415, in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis\nFailed example:\n    PBW.degree_on_basis(((H*F)^10).trailing_support())\nExpected:\n    20\nGot:\n    11\n**********************************************************************\n1 item had failures:\n   1 of   7 in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis\n    [98 tests, 1 failure, 6.02 s]\n```\n",
    "created_at": "2017-07-25T22:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323631",
    "user": "@vbraun"
}
```


```
sage -t --long src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py
**********************************************************************
File "src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py", line 415, in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis
Failed example:
    PBW.degree_on_basis(((H*F)^10).trailing_support())
Expected:
    20
Got:
    11
**********************************************************************
1 item had failures:
   1 of   7 in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis
    [98 tests, 1 failure, 6.02 s]
```




---

archive/issue_comments_323632.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-26T02:25:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323632",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_323633.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2017-07-26T02:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323633",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_323634.json:
```json
{
    "body": "I forgot that `leading/trailing_support()` does not use the print key by default and instead we need to pass it explicitly. This (and #23375) need review over this change.",
    "created_at": "2017-07-26T02:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323634",
    "user": "@tscrim"
}
```

I forgot that `leading/trailing_support()` does not use the print key by default and instead we need to pass it explicitly. This (and #23375) need review over this change.



---

archive/issue_comments_323635.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-26T14:49:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323635",
    "user": "@tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_323636.json:
```json
{
    "body": "Green 8.0 patchbot; the 8.1beta0 seems to have some independent build issue.",
    "created_at": "2017-07-30T17:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323636",
    "user": "@tscrim"
}
```

Green 8.0 patchbot; the 8.1beta0 seems to have some independent build issue.



---

archive/issue_comments_323637.json:
```json
{
    "body": "ok, let it be again",
    "created_at": "2017-07-31T11:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323637",
    "user": "@fchapoton"
}
```

ok, let it be again



---

archive/issue_comments_323638.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-07-31T11:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323638",
    "user": "@fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_323639.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-08-01T22:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23136",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23136#issuecomment-323639",
    "user": "@vbraun"
}
```

Resolution: fixed
