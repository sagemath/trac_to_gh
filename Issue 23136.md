# Issue 23136: Fix structure coefficients for simple Lie algebras in Chevalley basis

Issue created by migration from https://trac.sagemath.org/ticket/23373

Original creator: tscrim

Original creation time: 2017-07-06 00:05:33

CC:  sage-combinat bsalisbury1

Currently, there is a discrepancy between `L._basis_key` and the sorting order for `L._indices`, which cases `L.structure_coefficients(True)` to be incorrect. This leads to

```
sage: L = lie_algebras.sl(QQ, 2)
sage: L.universal_enveloping_algebra() # BOOM
```



---

Comment by tscrim created at 2017-07-06 00:10:22

Changing status from new to needs_review.


---

Comment by tscrim created at 2017-07-06 00:10:22

I also add some extra safeguards in `L.structure_coefficients` to get rid of the assumption that structure coefficients are indexed by pairs `(a, b)` with `a < b`.
----
New commits:


---

Comment by chapoton created at 2017-07-07 08:19:31

ok, green bot, let it be


---

Comment by chapoton created at 2017-07-07 08:19:31

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-07-25 22:32:08

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2017-07-25 22:32:08


```
sage -t --long src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py
**********************************************************************
File "src/sage/algebras/lie_algebras/poincare_birkhoff_witt.py", line 415, in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis
Failed example:
    PBW.degree_on_basis(((H*F)^10).trailing_support())
Expected:
    20
Got:
    11
**********************************************************************
1 item had failures:
   1 of   7 in sage.algebras.lie_algebras.poincare_birkhoff_witt.PoincareBirkhoffWittBasis.degree_on_basis
    [98 tests, 1 failure, 6.02 s]
```



---

Comment by git created at 2017-07-26 02:25:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-26 02:37:56

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2017-07-26 02:48:53

I forgot that `leading/trailing_support()` does not use the print key by default and instead we need to pass it explicitly. This (and #23375) need review over this change.


---

Comment by tscrim created at 2017-07-26 14:49:48

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2017-07-30 17:23:38

Green 8.0 patchbot; the 8.1beta0 seems to have some independent build issue.


---

Comment by chapoton created at 2017-07-31 11:05:29

ok, let it be again


---

Comment by chapoton created at 2017-07-31 11:05:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-08-01 22:25:10

Resolution: fixed
