# Issue 27397: Refine coding code and documentation

Issue created by migration from https://trac.sagemath.org/ticket/27634

Original creator: klee

Original creation time: 2019-04-10 11:20:39

CC:  jsrn

Lots of refinement for `sage/coding` folder:

- 100% coverage for doctests

- reorganize the section on coding in the documentation 

- pyflakes fixes

- add `random_received_vector` method to linear codes

- many small fixes


---

Comment by git created at 2019-04-10 11:21:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-04-10 11:25:31

Changing status from new to needs_review.


---

Comment by git created at 2019-04-11 20:45:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-12 05:14:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-04-16 05:09:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-05-28 00:25:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-08 13:40:49

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2019-06-11 06:15:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-06-25 07:34:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-03 09:48:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-07-03 11:37:56

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).


---

Comment by git created at 2019-07-04 02:10:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-04 02:35:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-07-04 19:56:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @927589452 created at 2019-07-14 12:53:04

removed 
was fixed in the latest of the commits


---

Comment by git created at 2019-07-30 05:12:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2019-07-30 14:00:47

This is very nice and thorough cleanup. Here are some comments from glancing
through the code (I'm currently compiling):

* You've added forwarding of arguments to `Decoder.connected_encoder()`. But
  this is semantically not what was intended with the method. For
  `decode_to_message`, the decoder must have a specific type of encoder in mind
  (which is, in many cases, the same as having a specific generator matrix in
  mind), and this method enables the user to get exactly that encoder. So the
  user should not be required, indeed allowed, to supply any arguments to that
  encoder. How would he know which ones to give? If a sub-class of `Decoder`
  uses an encoder with specific arguments forwarded to it, then that decoder
  class must override `connected_encoder` and return the correct encoder. The
  `_connected_encoder_name` is simply a shorthand which covers most cases.

  In short, I recommend you roll back this particular change.

* Since we're already modifying `_repr_` for Goppa code, let's add their field,
  i.e. change their representation to e.g. `[8, 2] Goppa code over GF(2)`.

* The documentation for `__eq__` is unhelpful. Let's change it into something
  like

  {{{
  Test whether ``other`` defines the same Goppa code in the sense that defining
  set and generating polynomial is the same.
  }}}

  And then under EXAMPLES document this surprising behaviour of equality:

  {{{
  Note that this check will be false if e.g. ``other`` represents the same
  linear code as ``self`` but not constructed as a Goppa code:

  sage: E = LinearCode(C.generator_matrix())
  sage C == E
  False
  }}}

  A similar caveat should be placed on several other code classes, actually. If
  you feel motivated to put those in, I'd be happy, but I'm not insisting ;-)

* I disagree with your abbreviation in the first line of the module doc of
  `grs_code.py`. Writing out "Generalized Reed-Solomon codes" in full is more
  helpful.

* The first line of the module doc of `hamming_code.py` should say "Hamming
  codes", plural.

* Module doc of `linear_code.py` second paragraph

   {{{
      (...) `n-k`-dimensional (...)  ->>  `(n-k)`-dimensional
   }}}

* In `linear_code.py`, I disagree with your abbreviation of the error message
  when using not registered encoders/decoders (around line 506). Your shorter
  error messages are much less helpful.

* I'm not sure I like `random_received_vector` and its friend. It is a very specific use case to add exactly `t` errors to a codeword, and for this I don't mind the user typing out a few extra lines by using the `StaticErrorRateChannel`, which also introduces him/her to the much broader concept of channels. Rather, I'm in favour of adding to the class/module documentation how to use the channels (though it is also in the coding theory tutorial)

  If you insist on those methods, `random_received_vector_and_codeword` could (should) be compactly implemented
  by using the `StaticErrorRateChannel` channel.

  The documentation of the `random_received_vector` functions should perhaps be 
  clarified by adding something like the following paragraph:

  {{{
  Note that even though the returned vector is assured to be distance exactly
  ``distance`` from some codeword in ``self``, it might still be closer than
  ``distance`` to another codeword if ``distance`` is more than `d/2`, where `d`
  is the minimum distance of ``self``.
  }}}

  Perhaps `random_received_vector_and_codeword` should be obtained by an
  optional argument to `random_received_vector` called `return_codeword =
  False`. Note that then the doc should have an `OUTPUT` block to describe the
  output semantics.

  The doc states that ``distance`` should be positive, but it should say
  "non-negative".

Best,
Johan


---

Comment by jsrn created at 2019-07-30 14:41:32

* I'm now browsing through the compiled doc of `linear_code.py`, and "`self`" (with only one back-tick) appears quite often. Please do a search-replace for this. 

* I disagree with your renaming "Derived code constructions" to "Code constructions" in the main doc for the coding module. The latter is very confusable with e.g. "the quadratic residue code construction", amplified by the file `code_constructions.py` containing exactly such constructions. I suggest using `Derived codes` or keeping `Derived code constructions`.

* I discovered that the documentation for `codes_catalog` is completely broken (see under the main documentation of Coding, under "Index of code constructions"). The reason is that the introspective magic function that should generate the table doesn't really work with imported non-local classes. I've manually written the entire table in full and pushed that to the branch.
----
New commits:


---

Comment by klee created at 2019-07-31 02:39:11

> * You've added forwarding of arguments to `Decoder.connected_encoder()`. But
>   this is semantically not what was intended with the method. For
>   `decode_to_message`, the decoder must have a specific type of encoder in mind
>   (which is, in many cases, the same as having a specific generator matrix in
>   mind), and this method enables the user to get exactly that encoder. So the
>   user should not be required, indeed allowed, to supply any arguments to that
>   encoder. How would he know which ones to give? If a sub-class of `Decoder`
>   uses an encoder with specific arguments forwarded to it, then that decoder
>   class must override `connected_encoder` and return the correct encoder. The
>   `_connected_encoder_name` is simply a shorthand which covers most cases.
> 
>   In short, I recommend you roll back this particular change.

I agree. Done rolling back.

> 
> * Since we're already modifying `_repr_` for Goppa code, let's add their field,
>   i.e. change their representation to e.g. `[8, 2] Goppa code over GF(2)`.

Done.
 
> * The documentation for `__eq__` is unhelpful. Let's change it into something
>   like
> 
>   {{{
>   Test whether ``other`` defines the same Goppa code in the sense that defining
>   set and generating polynomial is the same.
>   }}}

I added your text after the original.
 
>   And then under EXAMPLES document this surprising behaviour of equality:
> 
>   {{{
>   Note that this check will be false if e.g. ``other`` represents the same
>   linear code as ``self`` but not constructed as a Goppa code:
> 
>   sage: E = LinearCode(C.generator_matrix())
>   sage C == E
>   False
>   }}}

Done.

>   A similar caveat should be placed on several other code classes, actually. If
>   you feel motivated to put those in, I'd be happy, but I'm not insisting ;-)

This behavior of equality check is common in Sage. I don't worry much. But I will add more examples if I feel motivated :-)

> * I disagree with your abbreviation in the first line of the module doc of
>   `grs_code.py`. Writing out "Generalized Reed-Solomon codes" in full is more
>   helpful.

Right. Done.
 
> * The first line of the module doc of `hamming_code.py` should say "Hamming
>   codes", plural.

Done.

> * Module doc of `linear_code.py` second paragraph
> 
>    {{{
>       (...) `n-k`-dimensional (...)  ->>  `(n-k)`-dimensional
>    }}}
> 
> * In `linear_code.py`, I disagree with your abbreviation of the error message
>   when using not registered encoders/decoders (around line 506). Your shorter
>   error messages are much less helpful.

I felt that it was too much verbose. The user should learn what the message says from the documentation.

But ok as I respect your wisdom. I recovered the original message. 

> * I'm not sure I like `random_received_vector` and its friend. It is a very specific use case to add exactly `t` errors to a codeword, and for this I don't mind the user typing out a few extra lines by using the `StaticErrorRateChannel`, which also introduces him/her to the much broader concept of channels. Rather, I'm in favour of adding to the class/module documentation how to use the channels (though it is also in the coding theory tutorial)

I added that when I was moving my code in Magma to Sage, without much appreciation of the channel concept myself. Now I see that `random_received_vector` does not fit well with the overall design of  the coding module.

I decided to remove it.


---

Comment by klee created at 2019-07-31 03:14:36

Replying to [comment:29 jsrn]:
> * I'm now browsing through the compiled doc of `linear_code.py`, and "`self`" (with only one back-tick) appears quite often. Please do a search-replace for this. 

Done.

> * I disagree with your renaming "Derived code constructions" to "Code constructions" in the main doc for the coding module. The latter is very confusable with e.g. "the quadratic residue code construction", amplified by the file `code_constructions.py` containing exactly such constructions. I suggest using `Derived codes` or keeping `Derived code constructions`.

It seems a typo... I will keep `Derived code constructions`.

> 
> * I discovered that the documentation for `codes_catalog` is completely broken (see under the main documentation of Coding, under "Index of code constructions"). The reason is that the introspective magic function that should generate the table doesn't really work with imported non-local classes. I've manually written the entire table in full and pushed that to the branch.

Merged. Fixed a doctest failure along with it.


---

Comment by klee created at 2019-07-31 03:15:25

New commits:


---

Comment by git created at 2019-07-31 03:18:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jsrn created at 2019-07-31 06:22:41

Great, thanks for reacting so fast! Let's get this into Sage :-) Positive review.


---

Comment by jsrn created at 2019-07-31 06:22:41

Changing status from needs_review to positive_review.


---

Comment by git created at 2019-07-31 06:48:43

Changing status from positive_review to needs_review.


---

Comment by git created at 2019-07-31 06:48:43

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by klee created at 2019-07-31 06:55:12

Ah... I could not resist rushing these final changes to this ticket. Sorry.

I renamed "channel_constructions.py" to "channel.py" and "goppa.py" to "goppa_code.py". This seems to me more conforming to other file names. 

I worry that you may object to the former change. If so, let me know.


---

Comment by jsrn created at 2019-07-31 07:05:53

I'm OK with those changes, it's more conforming. Positive review.


---

Comment by jsrn created at 2019-07-31 07:05:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-08-02 21:00:12

See patchbot:

```
sage -t --long src/doc/en/thematic_tutorials/structures_in_coding_theory.rst  # 2 doc
tests failed
```



---

Comment by vbraun created at 2019-08-02 21:00:12

Changing status from positive_review to needs_work.


---

Comment by git created at 2019-08-03 10:58:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by klee created at 2019-08-03 22:04:30

Changing status from needs_work to positive_review.


---

Comment by klee created at 2019-08-03 22:04:30

Doctest failures in thematic tutorials were fixed by simple string replacements for changed module names.


---

Comment by vbraun created at 2019-08-05 20:02:39

Resolution: fixed
