# Issue 16741: Update gdb

Issue created by migration from https://trac.sagemath.org/ticket/16978

Original creator: vbraun

Original creation time: 2014-09-12 15:06:13

CC:  simonking jpflori fbissey

New upstream tarball: ftp://sourceware.org/pub/gdb/releases/gdb-7.8.tar.gz


---

Comment by vbraun created at 2014-09-12 15:18:56

Useful with `SAGE_DEBUG=yes`, of course.
----
New commits:


---

Comment by vbraun created at 2014-09-12 15:18:56

Changing status from new to needs_review.


---

Comment by SimonKing created at 2014-09-13 09:34:22

What is supposed to be done for reviewing?

Building: Just doing `make distclean`, `export SAGE_DEBUG=yes` and `make`? Or is this an optional package, and one needs to just do `sage -i gdb` in an existing Sage install built with `SAGE_DEBUG=yes`?

Testing: What would one usually do to test that gdb works? Sure, I can do `sage -gdb` and then run a program that crashes...


---

Comment by vbraun created at 2014-09-13 11:15:56

The most interesting part is of course that you can use cygdb with a debug build. The system gdb will be built with a non-debug Python and hence have mismatching CPython structures. 

To build you need to run `sage -i gdb`. It is not built by default. You can build with or without `SAGE_DEBUG`, and you can only use cygdb if the Python build matches.


---

Comment by SimonKing created at 2014-09-13 12:19:20

Replying to [comment:4 vbraun]:
> The most interesting part is of course that you can use cygdb with a debug build. The system gdb will be built with a non-debug Python and hence have mismatching CPython structures. 

I don't understand that comment. Does "system gdb" mean that we are using the system wide gdb here? 

> To build you need to run `sage -i gdb`. It is not built by default. You can build with or without `SAGE_DEBUG`, and you can only use cygdb if the Python build matches.

Will the Python build match if I take a sage install created with `SAGE_DEBUG=yes`, and later do `sage -i gdb`?


---

Comment by vbraun created at 2014-09-13 13:45:07

Replying to [comment:5 SimonKing]:
> I don't understand that comment. Does "system gdb" mean that we are using the system wide gdb here? 

No, what I'm trying to say is that the distributor had built gdb a long time ago without debug Python.

> Will the Python build match if I take a sage install created with `SAGE_DEBUG=yes`, and later do `sage -i gdb`?

If and only if you don't change the setting of the `SAGE_DEBUG` environment variable in the meantime.


---

Comment by SimonKing created at 2014-09-13 14:00:04

Replying to [comment:6 vbraun]:
> > Will the Python build match if I take a sage install created with `SAGE_DEBUG=yes`, and later do `sage -i gdb`?
> 
> If and only if you don't change the setting of the `SAGE_DEBUG` environment variable in the meantime.

OK, I will do "make" and "sage -i gdb" without break, and without changing `SAGE_DEBUG`.

What happens if I change later some Cython file and compile this without `SAGE_DEBUG`. Would gdb work on that file, since it only matters that Python itself was build with `SAGE_DEBUG`? Or would gdb simply not work on that single non-debug compiled Cython file?


---

Comment by SimonKing created at 2014-09-13 14:02:14


```
king@linux-etl7:~/Sage/debug/sage> ./sage -i gdb
Found local metadata for gdb-7.8
Attempting to download package gdb-7.8
>>> Trying to download http://www.sagemath.org/packages/upstream/gdb/gdb-7.8.tar.gz
[Traceback (most recent call last):
  File "<stdin>", line 35, in <module>
  File "/home/king/Sage/debug/sage/local/lib/python/urllib.py", line 240, in retrieve
    fp = self.open(url, data)
  File "/home/king/Sage/debug/sage/local/lib/python/urllib.py", line 208, in open
    return getattr(self, name)(url)
  File "/home/king/Sage/debug/sage/local/lib/python/urllib.py", line 359, in open_http
    return self.http_error(url, fp, errcode, errmsg, headers)
  File "/home/king/Sage/debug/sage/local/lib/python/urllib.py", line 376, in http_error
    return self.http_error_default(url, fp, errcode, errmsg, headers)
  File "<stdin>", line 17, in http_error_default
IOError: [Errno 404] Not Found: '//www.sagemath.org/packages/upstream/gdb/gdb-7.8.tar.gz'
Error: failed to download package gdb-7.8
```

What to do? I thought that after checking out the branch attached to this ticket, the gdb sources would be found.


---

Comment by SimonKing created at 2014-09-13 14:04:13

Aha, I suppose I need to put the upstream sources manually into `SAGE_ROOT/upstream/`, right?


---

Comment by vbraun created at 2014-09-13 14:04:25

You need to put the source tarball in the "upstream" directory. Its not mirrored until the ticket is reviewed...


---

Comment by vbraun created at 2014-09-23 11:19:06

Anybody dare press the positive review button on this trivial ticket?


---

Comment by fbissey created at 2014-09-23 11:45:29

Sure I'll push. One remark though about the configuration options. The dependencies on gmp, mpfr, mpc, ppl and what not are bogus and only appear because the top configuration of gcc, binutils and gdb is mostly shared. gdb doesn't use them at all so setting them is a waste of characters.


---

Comment by fbissey created at 2014-09-23 11:45:29

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-09-25 12:05:33

Resolution: fixed
