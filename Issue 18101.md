# Issue 18101: bell_polynomial(n,k) should always return a polynomial

Issue created by migration from Trac.

Original creator: tmonteil

Original creation time: 2015-04-29 20:12:06

CC:  kdilks

As reported in [this ask question](http://ask.sagemath.org/question/26682/bell_polynomialnkcoefficients-raises-an-error/), `bell_polynomial(n,k)` sometimes returns a rational number, while the documents claims that it outputs a polynomial in `n-k+1` variables over `\QQ`.



---

Comment by tmonteil created at 2015-04-29 20:46:43

Changing status from new to needs_review.


---

Comment by tmonteil created at 2015-04-29 20:46:43

Side question : is there a good reason for the variables to start at `x_1` and not `x_0` ?
----
New commits:


---

Comment by vdelecroix created at 2015-04-29 22:43:13

Replying to [comment:2 tmonteil]:
> Side question : is there a good reason for the variables to start at `x_1` and not `x_0` ?

Indeed, it would be much simpler without this ugly

```
R = QQ[tuple(['x_'+str(i) for i in range(1, n-k+2)])]
```

that would just become

```
R = PolynomialRing(QQ, 'x', n-k+1)
```

On the other hand, [wikipedia](http://en.wikipedia.org/wiki/Bell_polynomials) starts at 1.

Vincent


---

Comment by pluschny created at 2015-04-30 11:41:06

Vincent, this is indeed the core question and I am happy that you mention it!

The old way to enumerate things here (not only at Wikipedia) is to to start with x_1 and to let the lower triangular matrix of coefficients start at the offset (1,1). Nevertheless the same authors define B_{0,0} = 1 but simply ignore B_{0,k} for k>0. This is a big problem affecting many number triangles on OEIS in particular older versions of the Stirling numbers (see for example the unfortunate (1,1) based definition https://oeis.org/A008275) and of the Lah numbers (https://oeis.org/A008297).

So it depends on how bold the authors of Sage want to be: I am certainly in favor of the definition with x_0, x_1,... which makes thing much cleaner and in agreement with the definition of the Stirling numbers and Lah numbers as they are defined in the recent literature (D. E. Knuth for example, Concrete Mathematics) with an offset (0,0).

Peter

ADDED: For what it's worth I explain my point of view a bit more explicit here:

https://oeis.org/wiki/User:Peter_Luschny/Marginalia

(Link updated.)


---

Comment by git created at 2015-05-04 14:26:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-05-04 14:28:22

While we are at it, is there a good reason for the base ring of the polynomials to be `QQ` and not `ZZ` ?


---

Comment by git created at 2015-05-21 15:46:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-05-23 21:47:36

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2015-05-23 21:47:36

This is ugly

```diff
- return result
+ return R(result)
```

Could you instead make it in such way that the coefficients belong to `ZZ`. With the current version you are intensively using coercion `ZZ[x0,x1,...] -> QQ[x0,x1,...]` for no good reasons. i.e. just use `//` instead of `/` here

```
coefficient = factorial(n) / (factorial_product * power_factorial_product)
```



---

Comment by git created at 2015-05-31 20:23:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-05-31 20:26:25

Changing status from needs_work to needs_review.


---

Comment by kdilks created at 2015-06-09 17:14:55

Docstring giving definition for the Bell Polynomial needs to be changed to reflect the new numbering of x_0,x_1,... as opposed to x_1,x_2,... .


---

Comment by git created at 2015-06-10 06:23:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-06-10 06:39:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2015-06-10 06:43:54

Thanks to notice, i have updated the formula (that was actually missing some braces and was unreadable, see http://doc.sagemath.org/html/en/reference/combinat/sage/combinat/combinat.html#sage.combinat.combinat.bell_polynomial)


---

Comment by kdilks created at 2015-10-02 02:50:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-10-12 07:16:32

Resolution: fixed
