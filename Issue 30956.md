# Issue 30956: sage -t broken on debian sage

Issue created by migration from https://trac.sagemath.org/ticket/31193

Original creator: slabbe

Original creation time: 2021-01-07 10:52:08

CC:  thansen

On the machine that belongs to a colleague of mine, on Ubuntu 20.04.1 LTS, after installing sage with 

```
sudo apt install sage
```



```
$ sage -t file.py
```


gives the following error (because it searches for optional packages):

```
/usr/lib/python3/dist-packages/apport/report.py:13: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
  import fnmatch, glob, traceback, errno, sys, atexit, locale, imp, stat
Traceback (most recent call last):
  File "/usr/share/sagemath/bin/sage-runtests", line 178, in <module>
    DC = DocTestController(options, args)
  File "/usr/lib/python3/dist-packages/sage/doctest/control.py", line 358, in __init__
    for pkg in list_packages('optional', local=True).values():
  File "/usr/lib/python3/dist-packages/sage/misc/package.py", line 236, in list_packages
    for p in os.listdir(SAGE_PKGS):
FileNotFoundError: [Errno 2] No such file or directory: '/usr/share/sagemath/build/pkgs'
```



A workaround is to specify an empty list of optional packages as follows:

```
$ sage -t --optional=sage file.py
no stored timings available
Running doctests with ID 2021-01-07-10-54-23-a3e52fcd.
Using --optional=memlimit,sage
Doctesting 1 file.
sage -t file.py
...
```

which works correctly.


---

Comment by chapoton created at 2021-01-07 11:01:15

Check with the latest beta.


---

Comment by slabbe created at 2021-01-07 11:05:25

ok, but the latest beta is not on debian yet


---

Comment by mkoeppe created at 2021-01-07 18:25:57

Debian packaging bugs should be reported to Debian.


---

Comment by mkoeppe created at 2021-01-07 18:30:05

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-01-07 18:30:05

And it's likely fixed by #30940


---

Comment by tmonteil created at 2021-05-16 21:17:54

`@`slabbe, the following bug report should already do the trick: https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=931223

Otherwise, you can have a look at: https://www.debian.org/Bugs/Reporting


---

Comment by tmonteil created at 2021-05-16 21:17:54

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2021-06-24 20:15:37

Resolution: invalid
