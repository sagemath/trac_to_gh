# Issue 14367: Improve UTF-8 support in LaTeX documentation

Issue created by migration from https://trac.sagemath.org/ticket/14571

Original creator: jdemeyer

Original creation time: 2013-05-12 09:38:37

Assignee: mvngu

CC:  vbraun ddrake

Volker Braun wrote in #14375:
> Oh we are still building pdf docs, that uses the deprecated utf8x that doesn't even ship with `TeXlive-2012` any more.


---

Attachment


---

Comment by vbraun created at 2013-05-12 09:54:24

#14561 will introduce a unicode Sha to the docs, this is hacked around in the patch so we don't have to mess with cyrillic fonts. I don't think that this one character in the pdf version merits any further work, though reviewer patches are of course welcome...


---

Comment by vbraun created at 2013-05-12 11:29:13

Changing status from new to needs_review.


---

Comment by chapoton created at 2013-05-15 19:04:13

Changing keywords from "" to "unicode".


---

Comment by vbraun created at 2013-05-17 17:30:18

Dan, are you feeling comfortable reviewing the LaTeX stuff?


---

Comment by dimpase created at 2013-05-21 13:46:08

Did you try building Russian Sage docs with this patch?
They are in `utf8`. Unless I miss something, just by looking at the patch I gather that apart from "Ш", not much will show properly.

I might consider using `cm-unicode`: http://www.ctan.org/pkg/cm-unicode


---

Comment by jpflori created at 2013-05-22 08:53:17

Why not use utf8 and properly feed fontenc with the needed encodings instead of using utf8x?
That's surely not the best solution, but could do the trick.
Is it still shipped with TeXLive?
By the way, how do you figure out what is shipped within a given TeXLive distribution?


---

Comment by vbraun created at 2013-05-22 09:03:54

Russian docs look fine to me. The russian docs have an extra `conf.py` that sets up cyrillic. I tried to enable it globally but then got some incompatibilities with the rest of the docs. Might have been a TeX bug but then I don't think printing a single Sha in the algebraic geometry docs is that important. 

jpflori: Thats what the patch does, essentially. You can learn about TexLive using `tlmgr --help`


---

Comment by jpflori created at 2013-05-22 09:16:13

Replying to [comment:7 vbraun]:
> jpflori: Thats what the patch does, essentially. You can learn about TexLive using `tlmgr --help`
Does not seem to be shipped in Ubuntu's TeXLive packages... surely because using the TeXLive package manager on top of Ubuntu's one is not supported and will never be and I don't really want to use my own TeXLive install rather than what Ubuntu/Debian provides.
I can still do "apt-file search utf8x.def", but my Debian install already uses some preview of TeXLive 2013, and it still provides utf8x.def in the texlive-latex-extra package which from its description might indeed not be from vanilla TeXLive.


---

Comment by vbraun created at 2013-05-22 09:25:11

Ok utf8x.def is actually available in the ucs package in TeXlive. Though it is still unmaintained, e.g. http://tex.stackexchange.com/questions/13067/utf8x-vs-utf8-inputenc


---

Comment by vbraun created at 2013-05-22 09:29:19

Russian pdf docs


---

Attachment

I've attached the russian pdf docs if anybody wants to see the result.


---

Comment by dimpase created at 2013-05-23 06:51:07

Replying to [comment:10 vbraun]:
> I've attached the russian pdf docs if anybody wants to see the result.
OK; I also checked that this patch works with `TeXLive 2012` distribution (with Russian support installed, naturally). On the other hand, it also has

```
-rw-r--r--  1 root  wheel  8036 Apr 21  2012 texmf-dist/tex/latex/ucs/utf8x.def
```


So " that doesn't even ship with `TeXLive-2012`" is not correct.


---

Comment by jdemeyer created at 2013-05-25 20:00:45

Replying to [comment:11 dimpase]:
> OK; I also checked that this patch works with `TeXLive 2012` distribution (with Russian support installed, naturally). On the other hand, it also has
> {{{
> -rw-r--r--  1 root  wheel  8036 Apr 21  2012 texmf-dist/tex/latex/ucs/utf8x.def
> }}}
> 
> So " that doesn't even ship with `TeXLive-2012`" is not correct.

So, is there even a problem then?


---

Comment by vbraun created at 2013-05-25 20:11:32

Only if you don't want to depend on old/deprecated/unmaintained TeX packages.


---

Comment by dimpase created at 2013-05-26 02:51:26

Replying to [comment:14 vbraun]:
> Only if you don't want to depend on old/deprecated/unmaintained TeX packages.

if so, could the patch merely be cutting `x` from `utf8x` ?


---

Comment by vbraun created at 2013-05-26 09:59:17

We could leave the obscure utf8x bug workaround in there, if thats what you are asking.

Utf8 (non-x) is slightly different for characters that don't belong to the current font encoding. One possible workaround is to manually declare them as in the patch. That concerns two places in all of the Sage docs.


---

Comment by dimpase created at 2013-05-26 10:31:52

Replying to [comment:16 vbraun]:
> We could leave the obscure utf8x bug workaround in there, if thats what you are asking.

I was asking whether we can replace the current patch with one-char patch, removing `x` from `utf8x` in the line

```
latex_elements['inputenc'] = '\\usepackage[utf8x]{inputenc}'
```


> 
> Utf8 (non-x) is slightly different for characters that don't belong to the current font encoding. One possible workaround is to manually declare them as in the patch. That concerns two places in all of the Sage docs.

so it seems that the answer is "no". I just stumbled upon this tex.stackexchange [discussion](http://tex.stackexchange.com/questions/13067/utf8x-vs-utf8-inputenc). Tricky stuff... One comment is actually saying that `utf8x` is being maintained again...


---

Comment by vbraun created at 2013-05-26 10:52:10

Thats the link from comment:9 ...


---

Comment by jdemeyer created at 2013-05-26 20:14:05

Replying to [comment:14 vbraun]:
> Only if you don't want to depend on old/deprecated/unmaintained TeX packages.
By itself this is not necessarily a problem, there are certainly Sage packages which are no longer developed. Of course it's better to use newer packages, but my impression is that there is no obvious replacement for `utf8x`, so maybe we should just leave it...

But I don't know much about `TeX`, I'm just guessing based on the discussion above.


---

Comment by vbraun created at 2013-05-26 21:07:05

I don't get it. There **is** an obvious replacement, utf8. Its a base LaTeX package and not squirreled away in the ancient ucs package. Every LaTeX developer seems to agree that its better to use utf8 than utf8x. A patch to switch is right here. Why would one even consider sticking with the old stuff?


---

Comment by jpflori created at 2013-05-26 21:11:40

I agree with Volker, let's get away from utf8x if possible, it has been unmaintained for a long time and is not in the basic texlive distribution (at least on Debian its in a "-extra" archive).

What may be misleading in the patch is that a \usepackage{utf8x} is removed but no \usepackage{utf8} appears but I guess the utf8 is imported somewhere else at some point.


---

Comment by vbraun created at 2013-05-26 21:33:10

You don't need to specify utf8, its the default in Sphinx. See http://sphinx-doc.org/config.html#confval-latex_elements


---

Comment by jhpalmieri created at 2013-05-26 22:15:56

I also agree that we should get rid of `utf8x`. I wasn't that excited about it when it first went in (in #8036), so I'm happy to see its removal.


---

Comment by dimpase created at 2013-05-27 00:59:00

Replying to [comment:23 jhpalmieri]:
> I also agree that we should get rid of `utf8x`. I wasn't that excited about it when it first went in (in #8036), so I'm happy to see its removal.

I don't see why this is needed. `utf8x` is a part of maintained, since 2011, [ucs package](http://ctan.org/pkg/ucs); #8036 is older, and indeed at that point `utf8x` was an orphan. It is a slight extension (and very useful) of standard LaTeX, so what?

E.g. I don't see how you can avoid `utf8x` in the [example](http://trac.sagemath.org/sage_trac/attachment/ticket/8036/utf8.tex) on #8036, at least without Babel. That is, if you write some unicode `Ж` (different from `Ш`, which is taken care of) somewhere, it won't display right in pdf, and may even fail to compile with `pdflatex`.


---

Comment by jhpalmieri created at 2013-05-27 05:30:42

utf8x.sty does not seem to be included in TeX Live 2012. (I just tried to compile a file using `\includepackage{utf8x}`, and it failed.) That seems like a good reason to get rid of it. You're suggesting instead

```
\usepackage{ucs}
\usepackage[utf8x]{inputenc}
```

maybe?


---

Comment by dimpase created at 2013-05-27 06:03:39

Replying to [comment:25 jhpalmieri]:
> utf8x.sty does not seem to be included in TeX Live 2012. (I just tried to compile a file using `\includepackage{utf8x}`, and it failed.) That seems like a good reason to get rid of it. You're suggesting instead
> {{{
> \usepackage{ucs}
> \usepackage[utf8x]{inputenc}
> }}}
> maybe?
sure. In fact the patch on this ticket proposes to remove a line containing

```
\usepackage[utf8x]{inputenc}
```



---

Comment by dimpase created at 2013-06-05 12:48:49

as discussed, `\usepackage[utf8x]{inputenc}` is not deprecated. What is the purpose of this ticket then?


---

Comment by dimpase created at 2013-06-05 12:48:49

Changing status from needs_review to needs_info.


---

Comment by vbraun created at 2013-06-05 13:00:21

It is discouraged by most (all?) LaTeX developers, and utf8 is recommended instead. Maybe its not officially deprecated, but morally it is. utf8x clashes with various other packages, whereas utf8 is more friendly to its neighbors.


---

Comment by dimpase created at 2013-06-05 13:31:34

Replying to [comment:28 vbraun]:
> It is discouraged by most (all?) LaTeX developers, and utf8 is recommended instead. Maybe its not officially deprecated, but morally it is. utf8x clashes with various other packages, whereas utf8 is more friendly to its neighbors.

Are these mere outdated rumours, about it being deprecated (it was orphaned for a while, but this is no longer the case)? Aren't you confusing this option of `inputenc` with an outdated package `utf8x` ?


---

Comment by vbraun created at 2013-06-05 13:39:37

utf8x isn't even a package, it a piece of the ucs package.

The fact that somebody maintains it for backwards compatibility does not change the fact that its approach is fundamentally incompatible with a load of existing packages, e.g. http://tex.stackexchange.com/questions/49610/use-biblatex-and-utf8


---

Comment by dimpase created at 2013-06-05 14:09:21

Replying to [comment:30 vbraun]:
> utf8x isn't even a package, it a piece of the ucs package.
sure.
> 
> The fact that somebody maintains it for backwards compatibility does not change the fact that its approach is fundamentally incompatible with a load of existing packages, e.g. http://tex.stackexchange.com/questions/49610/use-biblatex-and-utf8

the fact that `biblatex` (a `contrib` package we don't use, AFAIK) is not compatible with `ucs` (another `contrib` package) does not mean we should rush to change what we have, I think. Note that `biblatex` is incompatible with lots of other packages, cf. [Sect 1.5.4](http://www.math.upenn.edu/tex_docs/latex/biblatex/biblatex.pdf). 

Do you know any other packages incompatible with `ucs`? I don't.


---

Comment by vbraun created at 2013-06-05 14:17:58

http://www.ctan.org/pkg/csquotes is also incompatible. Hyperref is also incompatible with ucs, though you can work around it by some hackery with `\PrerenderUnicode`. How many examples do you need?


---

Comment by dimpase created at 2013-06-05 16:20:52

Replying to [comment:32 vbraun]:
> http://www.ctan.org/pkg/csquotes is also incompatible. 
another `contrib` package produced by the same guy, P.Lehman, currently listed as inactive. There is a jungle of packages in `contrib`, where compatibility is not of a major concern, apparently. 

This patch fixes a non-existing problem, and is marked as a blocker... :-)


---

Comment by vbraun created at 2013-06-05 17:36:15

hyperref is not a contrib package


---

Comment by dimpase created at 2013-06-05 17:39:39

Changing status from needs_info to needs_review.


---

Comment by dimpase created at 2013-06-05 17:40:43

OK, OK, sorry... As I sat on this for so long :–)


---

Comment by dimpase created at 2013-06-05 17:40:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2013-06-05 17:53:33

Damn, I was just about to point out that ucs is one of the "jungle of packages" in contrib. Don't you hate it if you remember a good argument too late ;-)

Thanks!


---

Comment by jdemeyer created at 2013-06-05 19:51:20

Resolution: fixed
