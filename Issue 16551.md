# Issue 16551: segfault in numerical_integral()

Issue created by migration from Trac.

Original creator: rws

Original creation time: 2014-08-09 14:28:08

CC:  kcrisman

Keywords: integral, numerics, crash


```
sage: numerical_integral(sin(x^2)/(x^2), 1, infinity, max_points=10^10)
---------------------------------------------------------------------------
SignalError                               Traceback (most recent call last)
<ipython-input-7-a164db8ca706> in <module>()
----> 1 numerical_integral(sin(x**Integer(2))/(x**Integer(2)), Integer(1), infinity, max_points=Integer(10)**Integer(10))

/home/ralf/sage/local/lib/python2.7/site-packages/sage/gsl/integration.so in sage.gsl.integration.numerical_integral (build/cythonized/sage/gsl/integration.c:2626)()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1208)()

SignalError: Segmentation fault
```

Has the impementer not tested some boundaries? Can we have better error messages please? That's exactly what's turning people off.


---

Comment by rws created at 2014-08-09 15:41:39

Changing priority from major to critical.


---

Comment by rws created at 2014-08-09 15:41:39

Segfaults are always critical.


---

Comment by kcrisman created at 2014-08-11 06:39:46

What platform is this on?  On Mac OS X 10.7 I get `(0.285725372660691, 7.519910599701474e-05)` for both Sage 5.12 and 6.2.


---

Comment by kcrisman created at 2014-08-11 06:53:42

> What platform is this on?  On Mac OS X 10.7 I get `(0.285725372660691, 7.519910599701474e-05)` for both Sage 5.12 and 6.2.
This could be a good situation to ask on sage-devel; there are a wide variety of systems there and if everyone tried quickly you might get a lot of feedback.  It's too bad the traceback is so short, that's not a lot of info to go on :( as usually I like tracking these things down.

On SMC, which is Ubuntu:

```
$ sage
┌────────────────────────────────────────────────────────────────────┐
│ Sage Version 6.3, Release Date: 2014-08-10                         │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
sage: numerical_integral(sin(x^2)/(x^2), 1, infinity, max_points=10^10)
---------------------------------------------------------------------------
SignalError                               Traceback (most recent call last)
<ipython-input-1-a164db8ca706> in <module>()
----> 1 numerical_integral(sin(x**Integer(2))/(x**Integer(2)), Integer(1), infinity, max_points=Integer(10)**Integer(10))
 
/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/gsl/integration.so in sage.gsl.integration.numerical_integral (build/cythonized/sage/gsl/integration.c:2626)
()
 
/usr/local/sage/sage-6.3.beta6/local/lib/python2.7/site-packages/sage/ext/c_lib.so in sage.ext.c_lib.sig_raise_exception (build/cythonized/sage/ext/c_lib.c:1208)()
 
SignalError: Segmentation fault
sage: 
Exiting Sage (CPU time 0m0.30s, Wall time 0m7.00s).
~$ uname -a
Linux compute20dc0 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux
```

Does yours only happen with Sage 6.3?  I don't have that yet locally, though on 6.3.beta5 all is still well.


---

Comment by rws created at 2014-11-06 16:07:53

It still happens in 6.4rc1. Changing `a,b` does not matter, so all functions `gsl_integration_qag*` are affected but not the `qng` method:

```
sage: integrate(sin(x^2)/(x^2), 1, infinity).n()
0.285736646322853
sage: numerical_integral(sin(x^2)/(x^2), 1,infinity, max_points=10^10, algorithm='qng')
(nan, nan)
```



---

Comment by rws created at 2014-11-06 16:51:53

OK, the reason is, `gsl_integration_workspace_alloc` returns `NULL` which is then fed into the `qag` integration. So, the code needs to catch it and give an error message.


---

Comment by rws created at 2014-11-06 16:59:32

Changing status from new to needs_review.


---

Comment by rws created at 2014-11-06 16:59:32

New commits:


---

Comment by jdemeyer created at 2014-11-07 09:15:54

should be `MemoryError`.


---

Comment by jdemeyer created at 2014-11-07 09:16:00

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-11-07 09:23:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-11-07 09:24:14

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2014-11-07 09:25:59

Needs testing on 32-bit.


---

Comment by jdemeyer created at 2014-11-07 09:25:59

Changing status from needs_review to needs_info.


---

Comment by chapoton created at 2018-03-10 08:03:09

let us try again..
----
New commits:


---

Comment by chapoton created at 2018-03-10 08:03:09

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2018-06-07 19:07:12

ping ?


---

Comment by mmezzarobba created at 2018-06-08 12:51:20

Changing status from needs_review to positive_review.


---

Comment by mmezzarobba created at 2018-06-08 12:51:35

Changing priority from critical to major.


---

Comment by vbraun created at 2018-06-10 22:43:19

On OSX:

```
**********************************************************************
File "src/sage/calculus/integration.pyx", line 237, in sage.calculus.integration.?
Failed example:
    numerical_integral(sin(x^2)/(x^2), 1,infinity, max_points=10^10)
Expected:
    Traceback (most recent call last):
    ...
    MemoryError: could not allocate workspace: max_points too big
Got:
    (0.285725372660691, 7.519910599701474e-05)
```



---

Comment by vbraun created at 2018-06-10 22:43:25

Changing status from positive_review to needs_work.


---

Comment by vbraun created at 2018-06-11 15:09:27

Fails on 32-bit, too


---

Comment by rws created at 2018-06-11 15:41:37

Well `10^10 > 2^32` so it may have been an int size problem from the start...


---

Comment by vbraun created at 2018-06-11 18:27:45

The OSX box is 64-bit


---

Comment by vdelecroix created at 2018-08-03 19:20:18

update milestone 8.3 -> 8.4
