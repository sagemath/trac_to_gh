# Issue 11287: Implement sage -rst2notebook

Issue created by migration from https://trac.sagemath.org/ticket/11459

Original creator: slabbe

Original creation time: 2011-06-10 15:54:43

Assignee: slabbe

CC:  kcrisman kini jasonbhill

Convert a rst file into a notebook file (text file). 

The idea is that in general I wrote code using the Sage Code Convention where examples are formatted in ReST. Then converting rst examples to the notebook would be nice. Also, ReST file is more fun to edit than the html/cells notebook text file.

I implemented a script called `rst2notebook` available [on the Sage Combinat server](http://combinat.sagemath.org/hgwebdir.cgi/misc/file/ef17ccb37589/notebook2rst/).

In this script, I use docutils to translate a rst file into html file. From this, I convert blocks into cells. Note that I do not use sphinx so that not all usual Sage Rest syntax is working. But I am able to make math role work by adding dollar signs.

I am planning to make this script more clean during [Sage Days 31](http://wiki.sagemath.org/days31), I hope based on sphinx and written as patches.

Related to : #10637 (Implement sage -sws2rst) and #10652.

I mentionned the idea on sage-devel in December 2010 [here](http://groups.google.com/group/sage-devel/browse_thread/thread/5d86874cd359e1a5/eda52be07a9fb994).


---

Comment by slabbe created at 2011-06-14 00:55:50

Changing keywords from "" to "sd31, days31".


---

Comment by kcrisman created at 2011-06-14 17:23:04

Maybe this should be rst2sws rather than rst2notebook?  By analogy with #10637 sws2rst.


---

Comment by slabbe created at 2011-06-15 10:08:11

Replying to [comment:2 kcrisman]:
> Maybe this should be rst2sws rather than rst2notebook?  By analogy with #10637 sws2rst.

By rst2notebook, I mean something different. I mean the worksheet txt file which is made of html code and `{{{`'s cells. I agree rst2notebook is confusing. Maybe `sage -rst2worksheet_txt` would be better?

By the way, I also implemented the `sage -rst2sws`. I still need to add some doctests and do some more testing before it needs review. I hope to get to that point by wednesday.

Sébastien


---

Comment by kcrisman created at 2011-06-15 16:15:21

Replying to [comment:3 slabbe]:
> Replying to [comment:2 kcrisman]:
> > Maybe this should be rst2sws rather than rst2notebook?  By analogy with #10637 sws2rst.
> 
> By rst2notebook, I mean something different. I mean the worksheet txt file which is made of html code and `{{{`'s cells. I agree rst2notebook is confusing. Maybe `sage -rst2worksheet_txt` would be better?

Hmm, or something like that.  That is really long.  But rst2worksheet would be misleading as well, so maybe that's the best option.

What about rst2txt?

> By the way, I also implemented the `sage -rst2sws`. I still need to add some doctests and do some more testing before it needs review. I hope to get to that point by wednesday.

Great! Except for the fact that I usually need to go the other direction - but of course those are also appearing.


---

Comment by slabbe created at 2011-06-15 17:19:30

> What about rst2txt?

Well, at first, I excluded that because txt extension are often used for  writing ReST files. But, on the other hand, when one uploads a file  having a `.txt` extension from the notebook, it is assume to be  that worksheet txt file made of html code and triple braces cells. So I  think you are right. rst2txt is a good suggestion. Thank you!



> > By the way, I also implemented the `sage -rst2sws`. I still need to add some doctests and do some more testing before it needs review. I hope to get to that point by wednesday.
> Great! Except for the fact that I usually need to go the other direction - but of course those are also appearing.

Why BTW? I feel I am the only one that needs more the rst -> sws  way?! I write all my examples in ReST syntax in my personal code, that  might be why.


---

Attachment

Applies on the new flask sagenb repository


---

Comment by jasonbhill created at 2011-06-21 01:26:13

I'm testing this, but I wanted to give others a heads-up on something. (Maybe Kini can shed some light on this from the hg side of things.)

I'm currently using the flask repo (the ~official~ one...) and have a symlink redirecting devel/sagenb->flask. The path for various diffs in this patch should be following that sagenb symlink, but they're following my sage->sage-main (or whatever clone I'm working in) repo instead.


---

Comment by kini created at 2011-06-21 02:08:12

The root of the sagenb repository is _in_ your `devel/sagenb`, i.e. already beyond the symlink. The paths should have nothing to do with that (and look fine to me fwiw). Are you applying it in the right place?


---

Comment by jasonbhill created at 2011-06-21 02:27:01

Yup... "sagenb" and "sage" are the two symlinks in devel. All of my patches are attempting to following the latter. 

I'm using hg_sage.apply("address"). My usual workflow is to create a clone, build into that clone, then apply any patches. This has always worked, but then again I am always working under the "sage" symlink. But, in this situation the patch (regardless of branch) is attempting to apply in "devel/sage->my_".

How might one apply this otherwise ... in a specific location?


---

Comment by kini created at 2011-06-21 03:14:12

Ah. Use `hg_sagenb` instead of `hg_sage` - try tab completing `hg_` in the Sage console to see the list of repositories you have access to. `hg_sage` is the Sage library, `hg_sagenb` is the notebook, `hg_extcode` seems to be for the interfaces to other software, `hg_scripts` is for the sage command line tools and related stuff, `hg_root` is for some miscellaneous "top-level" stuff.

I would personally recommend using Mercurial from the command line, though - it allows you to see what you are doing more precisely, where patches are going exactly, etc.


---

Comment by kini created at 2011-06-21 03:21:26

To be precise, `hg_sage` points to `devel/sage`, `hg_sagenb` points to `devel/sagenb`, `hg_extcode` points to `data/extcode`, and `hg_scripts` points to `local/bin`, if you want to go exploring. Using `sage -clone` and `sage -b <branchname>` only apply to `devel/sage` - other repositories are left uncloned and unmodified.

By the way, you might consider dropping by [IRC](http://sagemath.org/help-irc.html) to talk about these things in realtime instead of posting to this trac ticket, as this is getting quite off-topic... :)


---

Comment by slabbe created at 2011-06-21 15:46:53

Salut!

Just to give an update about the status of the patches on this ticket :

1. trac11459_rst2notebook_sagenb-sl.patch : I was not able to export the patch once I qfinish it and pushed it on my branch on the sagenb google code. Hence, the patch available here do not have the very last modification I did just before I made qfinish. So if you are testing it, it would be better if you test my sagenb branch. Anyhow, I do not intend to change my sagenb branch. I believe it is ready for review.

Question for kini : How can I export the patch once it is qfinished (commited) so that I upload here the latest version?

2. trac11459_rst2notebook_localbin-sl.patch : The script needs work. I want to implement better options about escaping backslashes. I should be able to finish this in the next days during the week. Once this is done, I will change the status of this ticket to needs review.

Sébastien


---

Comment by kini created at 2011-06-21 17:18:53

You can turn committed changes back into patches with `hg qimport -r tip` if you want. If you want to leave them committed but export a patch, use `hg export tip > file.patch`. (don't forget to put "[diff]\ngit=yes" in your `~/.hgrc`.)


---

Comment by slabbe created at 2011-06-22 14:41:23

> Hence, the patch available here do not have the very last modification I did just before I made qfinish.

It was not true finally. The patch trac11459_rst2notebook_sagenb-sl.patch available here contains the very last modifications.


---

Attachment

Applies in the local/bin repository


---

Comment by slabbe created at 2011-06-22 14:44:19

Changing status from new to needs_review.


---

Comment by slabbe created at 2011-06-22 14:44:19

I finished working on the `local/bin` scripts and just re-uploaded the patch.

Now needs review!


---

Attachment

apply to $SAGE_ROOT


---

Attachment

apply to $SAGE_LOCAL/bin


---

Comment by kini created at 2012-05-16 14:37:34

Hi Sebastien,

I've rebased the scripts patch to Sage 5.0. Because the file formerly at `$SAGE_LOCAL/bin/sage-sage` is now at `$SAGE_ROOT/spkg/bin/sage`, it had to be split into two patches.

The notebook patch will probably need to be rebased as well, but since we're doing development of sagenb on github now, it won't go here on trac. I'll see what I can do...


---

Comment by kini created at 2012-05-17 12:21:17

Never mind, it looks like you [already got that code into sagenb](https://github.com/sagemath/sagenb/commit/44733a2965e89e43a28431cb46eca38108771a3c) after all.


---

Comment by kini created at 2012-05-17 12:21:39

whoops


---

Comment by kini created at 2012-05-25 20:51:31

Changing status from needs_review to positive_review.


---

Comment by kini created at 2012-05-25 20:51:31

So here is a reviewer patch, and positive review for this ticket. Everything looks good to me.


---

Comment by kini created at 2012-05-25 20:51:31

Changing keywords from "sd31, days31" to "sd31, days31, sd40.5".


---

Comment by kini created at 2012-05-25 20:51:47

Changing keywords from "sd31, days31, sd40.5" to "sd31 days31 sd40.5".


---

Comment by kini created at 2012-05-25 21:11:22

apply to $SAGE_ROOT


---

Attachment

Whoops, forgot the other reviewer patch...


---

Comment by slabbe created at 2012-05-25 22:27:21

Hi Kini,

Thanks for looking at this!

I remember I wanted to remove the guillemets (") in the line of documentation of both scripts:

          "..  escape-backslashes" 

Can you update your patch to do it, if you agree? I am sorry I never did it...

Is the new notebook now part of Sage ? If I want to test this ticket, should I install the latest sage-alpha or should I install the new sage-notebook?

Sébastien


---

Comment by kini created at 2012-05-25 23:35:28

Changing status from positive_review to needs_work.


---

Comment by kini created at 2012-05-25 23:35:28

OK, I'll do it, and I'll also modify the file `sage-rst2txt` which I completely overlooked...!

The new notebook is not part of Sage yet (though it finally got positive review a couple of hours ago - #11080). If you want to test the ticket, follow the instructions on #11080 to install the new notebook first.


---

Comment by kini created at 2012-05-25 23:46:01

apply to $SAGE_LOCAL/bin


---

Attachment

OK, there we go.


---

Comment by kini created at 2012-05-25 23:46:40

Changing status from needs_work to positive_review.


---

Comment by slabbe created at 2012-05-29 13:04:36

Thanks for the review Keshav!


---

Comment by jdemeyer created at 2012-06-02 12:10:07

Resolution: fixed


---

Comment by kcrisman created at 2012-06-21 16:57:56

Hi!  I'm trying to get #10637 (the other direction) in shape for positive review, and I notice there are no patches here documenting in the Sage library how to use this.  I guess that's because they just make text and sws.  Was there any place that you would think would be natural, other than `sage -advanced`?


---

Comment by slabbe created at 2012-06-21 18:17:08

> Was there any place that you would think would be natural, other than sage -advanced?

Note: There is some documentation in `sage -rst2sws -h` as well.

It would be a good idea to add documentation somewhere in the Sage reference manual. Where are the other sage-scripts documented?


---

Comment by kcrisman created at 2012-06-21 18:39:25

My sense is that they are not.

Okay, I'll look at your script and see how you implement that, then do that at #10637.  That would suffice for the purposes there.

Do you want to open another ticket to document (at least some) of the scripts in the usual reference manual?


---

Comment by kcrisman created at 2012-06-21 19:00:09

By the way, not that you have to deal with this now, see [http://docs.python.org/library/optparse.html](http://docs.python.org/library/optparse.html):

```
Deprecated since version 2.7: The optparse module is deprecated and will not be developed further; 
development will continue with the argparse module.
```

Oh well.


---

Comment by jdemeyer created at 2012-07-23 06:59:15

This "depends" on #11080 but somehow got merged anyway.


---

Comment by slabbe created at 2012-07-26 14:13:33

Replying to [comment:38 jdemeyer]:
> This "depends" on #11080 but somehow got merged anyway.

It depends on code written in the new sagenb indeed. That means the script won't work on sage-5.1 : it will get an import error I would guess. The thing is that there is no test for the script... so you could not see that the script was broken without #11080. Or worse, in the future, if a patch on sagenb breaks the script, we won't know it. How should a script be doctested?


---

Comment by slabbe created at 2012-07-26 14:22:25

The part of the script which depends on the new sagenb is the following :


```python
# Do the translation html -> worksheet txt 
from sagenb.notebook.docHTMLProcessor import docutilsHTMLProcessor 
translator = docutilsHTMLProcessor() 
worksheet_txt = translator.process_doc_html(html) 
 
# create a Notebook 
from sagenb.notebook.notebook import Notebook 
from sage.misc.misc import tmp_dir 
nb = Notebook(tmp_dir()+'.sagenb') 
 
# create a worksheet 
W = nb.create_new_worksheet(title, 'admin') 
W.edit_save(worksheet_txt) 
 
# export the worksheet as sws 
nb.export_worksheet(W.filename(), output, title=title) 
 
# delete the Notebook 
nb.delete() 
```


Is it possible that such code get broken in future version of sagenb?


---

Comment by jdemeyer created at 2012-07-26 14:38:14

Replying to [comment:39 slabbe]:
> How should a script be doctested?
You can have a look at `sage/tests/cmdline.py` for many examples.

In any case, such a test should be the subject of a new ticket.


---

Comment by slabbe created at 2012-07-26 16:14:52

> In any case, such a test should be the subject of a new ticket.

This is now #13297.
