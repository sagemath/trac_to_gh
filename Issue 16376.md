# Issue 16376: fix content of polynomials

Issue created by migration from https://trac.sagemath.org/ticket/16613

Original creator: vdelecroix

Original creation time: 2014-07-04 06:33:18

CC:  mkosters davidloeffler




---

Comment by bruno created at 2016-03-02 17:40:47

Changing status from new to needs_info.


---

Comment by bruno created at 2016-03-02 17:40:47

The content of a polynomial is sometimes defined as the gcd of its coefficients, and sometimes as the ideal generated by the coefficients. In SageMath, we have inconsistencies between polynomial rings:

* For Flint, NTL, p-adics and multivariate polynomial rings, `content` returns the gcd of the coefficients.

* The generic implementation (for the class `rings.polynomial.polynomial_element.Polynomial`) returns an ideal. This is means that for polynomials over _weird_ rings, and for all sparsely represented univariate polynomials, `content` returns an ideal.

*I propose to make all the implementations return a element of the base ring rather than an ideal.*

Rationale: 

* This means changing only one method.
* This is consistent with [MuPAD](http://fr.mathworks.com/help/symbolic/mupad_ref/content.html), [Maple](http://www.maplesoft.com/support/help/Maple/view.aspx?path=content), [Mathematica](http://reference.wolfram.com/language/ref/FactorTermsList.html) (though the name of the function is different) and [Magma](http://magma.maths.usyd.edu.au/magma/handbook/text/214#1841) (also for the [multivariate case](http://magma.maths.usyd.edu.au/magma/handbook/text/227#2005))
* This is the definition taken for instance by von zur Gathen and Gerhard in _Modern Computer Algebra_ or Cohen in _A course in Computational Number Theory_.

P.S.: I cc the author and reviewer of #12218 in which the generic `content` was implemented.


---

Comment by bruno created at 2016-03-02 17:41:07

Addendum: One could also let the possibility of having the ideal, with one of the following two propositions. I am not sure this is useful.

* Add a keyword `ideal` so that an ideal is returned if `ideal` is set to `True` (defaut `False`).
* Create a new method `content_ideal` or `ideal_content` for today's behavior of the generic implementation.


---

Comment by kedlaya created at 2016-04-09 04:44:44

I'm okay with having a method `content_ideal` for the generic behavior. But what is supposed to be returned by `content` when the content ideal is not principal? This is certainly likely to happen if the base ring is the ring of integers in a number field. Perhaps it is best if `content` is only implemented in those cases where it has a sensible definition at the level of elements.


---

Comment by bruno created at 2016-04-11 15:54:40

Replying to [comment:4 kedlaya]:
> I'm okay with having a method `content_ideal` for the generic behavior. But what is supposed to be returned by `content` when the content ideal is not principal? This is certainly likely to happen if the base ring is the ring of integers in a number field. Perhaps it is best if `content` is only implemented in those cases where it has a sensible definition at the level of elements.

Of course, this is a difficulty... Well, I propose then to implement `content` for polynomials over principal ideal domains (so that it returns a element of the domain, not an ideal), and `content_ideal` more generally. And of course to add a deprecation warning for `content` over non principal ideal domains. We may also add a warning (no deprecation) for the new behavior of `content` in the generic implementation.

I'll work on a proposal and let you tell me what you think about it.


---

Comment by bruno created at 2016-04-13 13:05:47

I am trying to provide some code for this. I'd like opinions on two points:

1. To avoid future inconsistencies, I plan to implement not only `content` and `content_ideal`, but also the related `primitive_part` and `is_primitive` for all polynomial rings with consistent semantics. Do you think it is appropriate to do so in this ticket, or do you think that it's better to stick with `content` and `content_ideal` only?

2. What should it be the semantic for fields? 

------
#### Remarks for the semantics for fields:

Currently, there is a method `is_primitive` which uses three distinct (and documented!) semantics:
   * An irreducible polynomial of degree _m_ over **F**<sub>p</sub> is primitive if its roots generate **F**<sub>p^m</sub>;
   * A polynomial over a ring is primitive if its coefficients generate the unit ideal;
   * Primitivity is undefined for polynomials over an infinite field, that is an exception is raised.

I guess that there should not be any opposition for `content_ideal` to return the unit ideal. For `content`, I see three possibilities (there may be more):
   * Raise an exception;
   * Return `1` (or more precisely `self._parent.one()`);
   * Return `gcd(self.coefficients())` (knowing that `gcd(2/3,4/5)=2/15` with the current semantics for `gcd`.
And I would say that in all three cases, `primitive_part` should return `self` divided by its content, using for content the same semantic as above. Finally, the case of `is_primitive` is complicated because of the semantic for finite fields. One possibility could be to find another name for this semantic for finite fields but 1. I guess that "primitive" is really the word used in mathematics for this property, and 2. this may break some existing code (and given the current discussions on sage-devel, I doubt the community would favor this!).

P.S.: I _really_ would like that we reach some consensus on the semantics before including any code in order to limit as much as possible future backward incompatible changes!


---

Comment by kedlaya created at 2016-04-14 02:25:55

It generally is best for the development workflow if individual tickets are as limited as possible. So I would vote in favor of creating a second ticket to deal with `is_primitive` and `primitive_part` after the status of `content` is resolved.

Regarding `primitive`, both uses seem to be quite entrenched in the mathematical literature, and so I think we are obliged to maintain the dichotomy.


---

Comment by bruno created at 2016-05-20 13:31:50

Changing keywords from "" to "polynomial, content".


---

Comment by bruno created at 2016-05-20 13:31:50

Changing status from needs_info to needs_review.


---

Comment by bruno created at 2016-05-20 13:31:50

Based on answers on this ticket and on [sage-devel](https://groups.google.com/forum/#!topic/sage-devel/DP_R3rl0vH0), I've implemented the solution with two methods `content` and `content_ideal`. Right now, there is now warning nor deprecation. If necessary, I can add a warning for the generic method `content` as follows:


```python
from sage.warnings import warn
warn("This method now returns the gcd of the coefficients of the input polynomial. Use content_ideal()` to get the ideal generated by the coefficients.")
```



---

Comment by saraedum created at 2016-12-16 05:06:50

The changes look fine to me.
It is my understanding that we should deprecate, i.e., `content()` should say `content() is not going to return an ideal but an element in the future. Use content_ideal() instead.`

What do you think?


---

Comment by saraedum created at 2016-12-16 05:07:08

Changing status from needs_review to needs_info.


---

Comment by bruno created at 2016-12-16 09:48:08

Replying to [comment:9 saraedum]:
> The changes look fine to me.
> It is my understanding that we should deprecate, i.e., `content()` should say `content() is not going to return an ideal but an element in the future. Use content_ideal() instead.`

Do you mean that right now, `content()` should still return an ideal but be deprecated, and that it should only later (in one year from now) return the gcd of the coefficients? What about changing the behavior right now, but with a warning? Another idea (to combine both in some sense) is the following:
* Make `content()` still return an ideal, with deprecation;
* Add right now a flag `ideal=True` to the method, so that people can already use the "new behavior" in their codes, using `content(ideal=False)`;
* In one year: remove deprecation and make the default value of `ideal` to `False`, or even remove completely the `ideal=...` parameter, or make it useless. 

What do you think?


---

Comment by saraedum created at 2016-12-16 14:26:52

Replying to [comment:11 bruno]:
> Replying to [comment:9 saraedum]:
> > The changes look fine to me.
> > It is my understanding that we should deprecate, i.e., `content()` should say `content() is not going to return an ideal but an element in the future. Use content_ideal() instead.`
> 
> Do you mean that right now, `content()` should still return an ideal but be deprecated, and that it should only later (in one year from now) return the gcd of the coefficients?
Yes.

> What about changing the behavior right now, but with a warning?
That would certainly break existing code. It points you to the place where you have to fix it so it would be fine with me. I am not sure what our policy is here.

> Another idea (to combine both in some sense) is the following:
> * Make `content()` still return an ideal, with deprecation;
> * Add right now a flag `ideal=True` to the method, so that people can already use the "new behavior" in their codes, using `content(ideal=False)`;
> * In one year: remove deprecation and make the default value of `ideal` to `False`, or even remove completely the `ideal=...` parameter, or make it useless.
If we go for this we should remove that parameter completely after some time. I am also fine with this approach but I find it a bit weird to do deprecation by introducing something deprecated (the `ideal` parameter).

> What do you think?
I think the first option (do not change `content()` at first but print a warning) is the cleanest option.


---

Comment by git created at 2017-01-17 08:37:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-01-17 11:11:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-01-17 11:24:33

Changing status from needs_info to needs_review.


---

Comment by bruno created at 2017-01-17 11:24:33

Ok, I've deprecated `content` when it existed and returned an ideal, and we'll perform the complete switch later on.


---

Comment by saraedum created at 2017-02-09 05:39:28

Changing status from needs_review to needs_info.


---

Comment by saraedum created at 2017-02-09 05:39:28

Does `SEEALSO: :meth:content` still make sense?


---

Comment by git created at 2017-02-09 14:41:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-02-09 14:43:14

Removed irrelevant SEEALSO.


---

Comment by bruno created at 2017-02-09 14:43:14

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2017-02-09 15:13:41

My 2 cents: I don't like the deprecation of `content` then only to replace it by something that has different functionality. I am close to considering this a bug, and as such, we do not need to deprecate. So the idea of using a temporary flag, which we then deprecate after we remove the ability to return an ideal from `content`, is the best way forward IMO. It's two steps, but it is the most consistent with Sage's policies.


---

Comment by git created at 2017-06-27 16:11:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-06-28 09:04:51

I've merged `develop` (8.0.beta11) into this ticket's branch since it did not apply. 

Now I agree with Travis that the deprecation is a bit a pity. It will force users to make two changes instead of one when they need the content (as a value rather than an ideal): Now they write `p.content().gen()`, they need to change to `p.content_ideal().gen()` due to the current deprecation warning, and in some months (years?) they'll finally be able to write `p.content()` to avoid the useless construction of the ideal. I'm strongly in favor of having a way for users to directly use the new semantic. 

As such, I would go for making `content` return a value without any deprecation. If the there's enough time left, this backward incompatible change may occur with the new release 8.0.


---

Comment by chapoton created at 2017-07-17 09:54:20

does not apply


---

Comment by chapoton created at 2017-07-17 09:54:20

Changing status from needs_review to needs_work.


---

Comment by git created at 2017-07-25 13:04:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-07-25 13:05:17

Applies again!


---

Comment by bruno created at 2017-07-25 13:05:34

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2017-07-25 17:03:38

failing doctests, see patchbot reports


---

Comment by git created at 2017-07-25 17:54:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-07-25 17:55:48

Should be OK now (I'll watch the patchbot logs), I made a mistake during the merge.


---

Comment by git created at 2017-07-27 12:22:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-09-06 17:15:49

Changing status from needs_review to needs_info.


---

Comment by saraedum created at 2017-09-06 17:15:49

The implementation looks good to me.

What is the deprecation strategy now? Do we want this to go in and have a followup ticket (to be merged in a year) to have content return an element? If so, there should be such a ticket and a comment in the code.

Or do we want to change this without deprecation? We missed the 8.0 window, so I am slightly in favor of the two step change.


---

Comment by slelievre created at 2017-11-19 16:23:55

In the docstring of `content_ideal`, it would be nice to include a hint such as:

> When the base ring is a gcd ring, the content as a ring element
> is the generator of the content ideal: `f.content_ideal().gen()`

with an example.


---

Comment by git created at 2017-11-23 13:49:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2017-11-23 13:53:09

Replying to [comment:30 saraedum]:
> Or do we want to change this without deprecation? We missed the 8.0 window, so I am slightly in favor of the two step change.

I was in favor of a direct change with the argument of "the sooner the better" but the result was endless discussions and the ticket waits for 3 years! So in order for this ridiculously simple issue to be fixed _at some point_, let's say we implement the two phase change.

Replying to [comment:32 slelievre]:
Agree, done! Note that I put this comment only for univariate polynomial rings since in the multivariate case, a method `content` exists (and is linked).

Now needs review (again!).


---

Comment by bruno created at 2017-11-23 13:53:09

Changing status from needs_info to needs_review.


---

Comment by tscrim created at 2017-11-23 22:19:36

I think we should just change the behavior (hopefully in an early beta) and put a `.. NOTE::` if you do not want to go with the suggestion in comment:19.


---

Comment by saraedum created at 2018-01-05 23:56:49

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-01-13 11:55:37

Resolution: fixed
