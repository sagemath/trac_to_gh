# Issue 26327: Sage 8.3 gfortran 7.2 build error on RPI3B Raspbian stretch

Issue created by migration from Trac.

Original creator: @Pavel-Sayekat

Original creation time: 2018-10-27 05:01:09

Keywords: gfortran, raspbian stretch

Error building Sage.
 
The following package(s) may have failed to build (not necessarily
during this run of 'make all-start'):
 
* package: gfortran-7.2.0
  log file: /home/pi/sage-8.3/logs/pkgs/gfortran-7.2.0.log
  build directory: /home/pi/sage-8.3/local/var/tmp/sage/build/gfortran-7.2.0
 
The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.
 
Makefile:31: recipe for target 'all-start' failed
make[1]: *** [all-start] Error 1
make[1]: Leaving directory '/home/pi/sage-8.3'
Makefile:13: recipe for target 'all' failed
make: *** [all] Error 2


---

Comment by fbissey created at 2018-10-27 09:06:56

We would need some of that file at least `/home/pi/sage-8.3/logs/pkgs/gfortran-7.2.0.log` to figure things out. Two other things come to mind:
* trying sage 8.4 now that is is out
* installing gfortran from your distribution so sage doesn't have to build its own


---

Attachment

gfortran-7.2.0.log


---

Comment by @Pavel-Sayekat created at 2018-10-27 15:52:10

$ sudo dpkg -l gfortran
Desired=Unknown/Install/Remove/Purge/Hold
+++-====================================-=======================-=======================-=============================================================================
ii  gfortran                             4:6.3.0-4               armhf                   GNU Fortran 95 compiler
| Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
|/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
|                                                                                                  
|--------------------------------------------------------------------------------------------------
|/ Name                                 Version                 Architecture            Description
Added the log and some more info.


---

Comment by fbissey created at 2018-10-27 20:04:29

Replying to [comment:2 gh-Pavel-Sayekat]:
> $ sudo dpkg -l gfortran
> Desired=Unknown/Install/Remove/Purge/Hold
> | Status=Not/Inst/Conf-files/Unpacked/halF-conf/Half-inst/trig-aWait/Trig-pend
> |/ Err?=(none)/Reinst-required (Status,Err: uppercase=bad)
> ||/ Name                                 Version                 Architecture            Description
> +++-====================================-=======================-=======================-=============================================================================
> ii  gfortran                             4:6.3.0-4               armhf                   GNU Fortran 95 compiler
> 
> Added the log and some more info.

So is it installed?


---

Comment by fbissey created at 2018-10-27 20:08:13

It looks like you don't have enough memory to perform the untaring

```
ound local metadata for gfortran-7.2.0
Using cached file /home/pi/sage-8.3/upstream/gcc-7.2.0.tar.xz
gfortran-7.2.0
====================================================
Setting up build directory for gfortran-7.2.0
Traceback (most recent call last):
  File "/home/pi/sage-8.3/build/bin/sage-uncompress-spkg", line 23, in <module>
    run()
  File "/home/pi/sage-8.3/build/bin/../sage_bootstrap/uncompress/cmdline.py", line 53, in run
    archive = open_archive(filename)
  File "/home/pi/sage-8.3/build/bin/../sage_bootstrap/uncompress/action.py", line 38, in open_archive
    return cls(filename)
  File "/home/pi/sage-8.3/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 152, in __new__
    return SageBaseTarFile(mode="r", fileobj=BytesIO(data))
MemoryError
```


This is quite weird. Also is there a `/home/pi/sage-8.3/config.log` and could you post it if you have it. If you already gfortran I want to know why sage decided to compile its own.


---

Comment by @Pavel-Sayekat created at 2018-10-28 05:11:29

May be the pi ran out of memory, so I stopped all extra services or processes and being able to double up the free memory (oops! for the past) and now I am compiling sage-8.4, was getting make error suggesting "Set the environment variableSAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this" and fixed that by running "ln -sf /usr/lib/arm-linux-gnueabihf/libstdc++.so.6.0.21 /home/pi/sage-8.4/local/lib/libstdc++.so.6".  Now it is compiling, lets see how it goes.

So what to do with this ticket now? I can re-deploy sage-8.3 anytime and start from the failure part if necessary.


---

Attachment

sage-8.4/config.log


---

Comment by fbissey created at 2018-11-01 00:37:58

Even with the config.log I don't understand why building gfortran was triggered. 

If you can build sage successfully without any additional problems we can just close the ticket. We'll advise on that later.


---

Comment by @Pavel-Sayekat created at 2018-11-13 19:07:25

I am not working on version 8.3 anymore, trying 8.4 but not yet succeeded. So you can close this ticket as it is irrelevant now.


---

Comment by @Pavel-Sayekat created at 2018-11-14 08:55:00

Changing component from PLEASE CHANGE to build.


---

Comment by @Pavel-Sayekat created at 2018-11-14 08:55:00

Changing type from PLEASE CHANGE to defect.


---

Comment by @Pavel-Sayekat created at 2018-11-14 08:57:46

Am I able to close this ticket as it seems I am not.


---

Comment by fbissey created at 2018-11-14 08:59:04

Resolution: wontfix


---

Comment by fbissey created at 2018-11-14 08:59:04

Well I can.


---

Comment by chapoton created at 2020-05-13 11:24:01

Changing keywords from "gfortran, raspbian stretch" to "gfortran, raspbian stretch, raspberry".
