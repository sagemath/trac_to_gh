# Issue 13783: Combinatorial m-ary trees

archive/issues_013783.json:
```json
{
    "body": "Assignee: sage-combinat\n\nCC:  @hivert sage-combinat @tscrim @darijgr\n\nKeywords: trees\n\nJust as in #8703 we want to implement trees with a fixed number of subtrees (equivalent of binary trees but with m subtrees). Especially to use them in the context of the m-Tamari lattices.\u00a0\n\nThis ticket depends on #8703 as we use the implantation of RootedTrees\n\nIssue created by migration from https://trac.sagemath.org/ticket/13987\n\n",
    "created_at": "2013-01-22T16:46:59Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Combinatorial m-ary trees",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13783",
    "user": "@VivianePons"
}
```
Assignee: sage-combinat

CC:  @hivert sage-combinat @tscrim @darijgr

Keywords: trees

Just as in #8703 we want to implement trees with a fixed number of subtrees (equivalent of binary trees but with m subtrees). Especially to use them in the context of the m-Tamari lattices. 

This ticket depends on #8703 as we use the implantation of RootedTrees

Issue created by migration from https://trac.sagemath.org/ticket/13987





---

archive/issue_comments_171092.json:
```json
{
    "body": "Changing assignee from sage-combinat to @VivianePons.",
    "created_at": "2013-01-22T17:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171092",
    "user": "@VivianePons"
}
```

Changing assignee from sage-combinat to @VivianePons.



---

archive/issue_comments_171093.json:
```json
{
    "body": "New commits:",
    "created_at": "2013-11-07T17:46:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171093",
    "user": "@VivianePons"
}
```

New commits:



---

archive/issue_comments_171094.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-11T07:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171094",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171095.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-06-09T14:31:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171095",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171096.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-07-08T07:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171096",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171097.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-25T16:29:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171097",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171098.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-01T09:48:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171098",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171099.json:
```json
{
    "body": "I am going to set this to **needs_review**. I hope that somebody else is still interested.",
    "created_at": "2017-03-01T09:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171099",
    "user": "@fchapoton"
}
```

I am going to set this to **needs_review**. I hope that somebody else is still interested.



---

archive/issue_comments_171100.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-03-01T09:49:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171100",
    "user": "@fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_171101.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-03-10T17:07:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171101",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171102.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-04-03T20:27:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171102",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171103.json:
```json
{
    "body": "ok, green bot at last. Now one can start looking at the code..",
    "created_at": "2017-04-04T19:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171103",
    "user": "@fchapoton"
}
```

ok, green bot at last. Now one can start looking at the code..



---

archive/issue_comments_171104.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-06-02T07:47:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171104",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171105.json:
```json
{
    "body": "Green bot, please review.",
    "created_at": "2017-07-25T07:06:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171105",
    "user": "@fchapoton"
}
```

Green bot, please review.



---

archive/issue_comments_171106.json:
```json
{
    "body": "Are these trees plane?",
    "created_at": "2017-07-25T08:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171106",
    "user": "@darijgr"
}
```

Are these trees plane?



---

archive/issue_comments_171107.json:
```json
{
    "body": "yes, these are the rooted trees where every vertex has a list of m sons.",
    "created_at": "2017-07-25T08:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171107",
    "user": "@fchapoton"
}
```

yes, these are the rooted trees where every vertex has a list of m sons.



---

archive/issue_comments_171108.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-21T04:08:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171108",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171109.json:
```json
{
    "body": "Is my doc correct? (In particular, am I right in assuming that leaves can carry no labels?)",
    "created_at": "2017-11-21T04:09:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171109",
    "user": "@darijgr"
}
```

Is my doc correct? (In particular, am I right in assuming that leaves can carry no labels?)



---

archive/issue_comments_171110.json:
```json
{
    "body": "yes.\n\nsome remarks:\n\n* you can see the trees using `%display unicode_art`\n\n* there is a doctest still using binary trees\n\n* maybe the import of BinaryTrees is not needed",
    "created_at": "2017-11-21T07:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171110",
    "user": "@fchapoton"
}
```

yes.

some remarks:

* you can see the trees using `%display unicode_art`

* there is a doctest still using binary trees

* maybe the import of BinaryTrees is not needed



---

archive/issue_comments_171111.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-21T21:16:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171111",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171112.json:
```json
{
    "body": "Thanks. I've fixed the doctest. I don't know why the import of BinaryTrees wouldn't be needed. A good point can be made for conversions between `MaryTree(2, ...)` and `BinaryTree(...)`, but this can wait for another ticket.\n\nNow to review the rest of this...",
    "created_at": "2017-11-21T21:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171112",
    "user": "@darijgr"
}
```

Thanks. I've fixed the doctest. I don't know why the import of BinaryTrees wouldn't be needed. A good point can be made for conversions between `MaryTree(2, ...)` and `BinaryTree(...)`, but this can wait for another ticket.

Now to review the rest of this...



---

archive/issue_comments_171113.json:
```json
{
    "body": "Unicode Art doesn't seem to work:\n\n```\nsage: t = MAryTree(2, [[], []])\nsage: t\n[[., .], [., .]]\nsage: %display unicode_art\nsage: t\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-4-b7269fa25085> in <module>()\n----> 1 t\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)\n    244             self.start_displayhook()\n    245             self.write_output_prompt()\n--> 246             format_dict, md_dict = self.compute_format_data(result)\n    247             self.update_user_ns(result)\n    248             self.fill_exec_result(result)\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in compute_format_data(self, result)\n    148 \n    149         \"\"\"\n--> 150         return self.shell.display_formatter.format(result)\n    151 \n    152     # This can be set to True by the write_output_prompt method in a subclass\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/display/formatter.pyc in format(self, obj, include, exclude)\n    200         \"\"\"\n    201         # First, use Sage rich output if there is any\n--> 202         sage_format, sage_metadata = self.dm.displayhook(obj)\n    203         assert PLAIN_TEXT in sage_format, 'plain text is always present'\n    204         if not set(sage_format.keys()).issubset(self.default_mime()):\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in displayhook(self, obj)\n    805             return\n    806         self._backend.set_underscore_variable(obj)\n--> 807         plain_text, rich_output = self._rich_output_formatter(obj, dict())\n    808         return self._backend.displayhook(plain_text, rich_output)\n    809 \n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in _rich_output_formatter(self, obj, rich_repr_kwds)\n    631         if rich_output is None:\n    632             rich_output = self._preferred_text_formatter(\n--> 633                 obj, plain_text=plain_text, **rich_repr_kwds)\n    634         # promote output container types to backend-specific containers\n    635         plain_text = self._promote_output(plain_text)\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in _preferred_text_formatter(self, obj, plain_text, **kwds)\n    528             return out\n    529         if want == 'unicode_art' and OutputUnicodeArt in supported:\n--> 530             out = self._backend.unicode_art_formatter(obj, **kwds)\n    531             if type(out) is not OutputUnicodeArt:\n    532                 raise OutputTypeException('backend returned wrong output type, require UnicodeArt')\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.pyc in unicode_art_formatter(self, obj, **kwds)\n    422             result = unicode_art(*obj, sep=' ')\n    423         else:\n--> 424             result = unicode_art(obj)\n    425         from sage.repl.rich_output.output_basic import OutputUnicodeArt\n    426         return OutputUnicodeArt(str(result))\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/unicode_art.pyc in unicode_art(*obj, **kwds)\n    119         raise ValueError('unknown keyword arguments: {0}'.format(list(kwds)))\n    120     if len(obj) == 1:\n--> 121         return _unicode_art_factory.build(obj[0])\n    122     if not isinstance(separator, UnicodeArt):\n    123         separator = _unicode_art_factory.build(separator)\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/character_art_factory.pyc in build(self, obj)\n    124                 return self.build_set(obj)\n    125         elif isinstance(obj, SageObject):\n--> 126             return self.build_from_magic_method(obj)\n    127         else:\n    128             return self.build_from_string(obj)\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/character_art_factory.pyc in build_from_magic_method(self, obj)\n    156         \"\"\"\n    157         magic_method = getattr(obj, self.magic_method_name)\n--> 158         return magic_method()\n    159 \n    160     def build_from_string(self, obj):\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/combinat/abstract_tree.pyc in _unicode_art_(self)\n   1294 \n   1295         # General case\n-> 1296         l_repr = [subtree._unicode_art_() for subtree in self]\n   1297         acc = l_repr.pop(0)\n   1298         whitesep = acc._root\n\n/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/combinat/abstract_tree.pyc in _unicode_art_(self)\n   1296         l_repr = [subtree._unicode_art_() for subtree in self]\n   1297         acc = l_repr.pop(0)\n-> 1298         whitesep = acc._root\n   1299         lf_sep = u\" \" * whitesep + u\"\u256d\" + u\"\u2500\" * (acc._l - acc._root)\n   1300         ls_sep = u\" \" * whitesep + u\"\u2502\" + u\" \" * (acc._l - acc._root)\n\nAttributeError: 'UnicodeArt' object has no attribute '_root'\n```\n\n\nNot sure if this is much of an issue, though.",
    "created_at": "2017-11-21T21:20:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171113",
    "user": "@darijgr"
}
```

Unicode Art doesn't seem to work:

```
sage: t = MAryTree(2, [[], []])
sage: t
[[., .], [., .]]
sage: %display unicode_art
sage: t
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-4-b7269fa25085> in <module>()
----> 1 t

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in __call__(self, result)
    244             self.start_displayhook()
    245             self.write_output_prompt()
--> 246             format_dict, md_dict = self.compute_format_data(result)
    247             self.update_user_ns(result)
    248             self.fill_exec_result(result)

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/IPython/core/displayhook.pyc in compute_format_data(self, result)
    148 
    149         """
--> 150         return self.shell.display_formatter.format(result)
    151 
    152     # This can be set to True by the write_output_prompt method in a subclass

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/display/formatter.pyc in format(self, obj, include, exclude)
    200         """
    201         # First, use Sage rich output if there is any
--> 202         sage_format, sage_metadata = self.dm.displayhook(obj)
    203         assert PLAIN_TEXT in sage_format, 'plain text is always present'
    204         if not set(sage_format.keys()).issubset(self.default_mime()):

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in displayhook(self, obj)
    805             return
    806         self._backend.set_underscore_variable(obj)
--> 807         plain_text, rich_output = self._rich_output_formatter(obj, dict())
    808         return self._backend.displayhook(plain_text, rich_output)
    809 

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in _rich_output_formatter(self, obj, rich_repr_kwds)
    631         if rich_output is None:
    632             rich_output = self._preferred_text_formatter(
--> 633                 obj, plain_text=plain_text, **rich_repr_kwds)
    634         # promote output container types to backend-specific containers
    635         plain_text = self._promote_output(plain_text)

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/display_manager.pyc in _preferred_text_formatter(self, obj, plain_text, **kwds)
    528             return out
    529         if want == 'unicode_art' and OutputUnicodeArt in supported:
--> 530             out = self._backend.unicode_art_formatter(obj, **kwds)
    531             if type(out) is not OutputUnicodeArt:
    532                 raise OutputTypeException('backend returned wrong output type, require UnicodeArt')

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/repl/rich_output/backend_base.pyc in unicode_art_formatter(self, obj, **kwds)
    422             result = unicode_art(*obj, sep=' ')
    423         else:
--> 424             result = unicode_art(obj)
    425         from sage.repl.rich_output.output_basic import OutputUnicodeArt
    426         return OutputUnicodeArt(str(result))

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/unicode_art.pyc in unicode_art(*obj, **kwds)
    119         raise ValueError('unknown keyword arguments: {0}'.format(list(kwds)))
    120     if len(obj) == 1:
--> 121         return _unicode_art_factory.build(obj[0])
    122     if not isinstance(separator, UnicodeArt):
    123         separator = _unicode_art_factory.build(separator)

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/character_art_factory.pyc in build(self, obj)
    124                 return self.build_set(obj)
    125         elif isinstance(obj, SageObject):
--> 126             return self.build_from_magic_method(obj)
    127         else:
    128             return self.build_from_string(obj)

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/typeset/character_art_factory.pyc in build_from_magic_method(self, obj)
    156         """
    157         magic_method = getattr(obj, self.magic_method_name)
--> 158         return magic_method()
    159 
    160     def build_from_string(self, obj):

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/combinat/abstract_tree.pyc in _unicode_art_(self)
   1294 
   1295         # General case
-> 1296         l_repr = [subtree._unicode_art_() for subtree in self]
   1297         acc = l_repr.pop(0)
   1298         whitesep = acc._root

/home/dgrinber/sage-7.5.1/local/lib/python2.7/site-packages/sage/combinat/abstract_tree.pyc in _unicode_art_(self)
   1296         l_repr = [subtree._unicode_art_() for subtree in self]
   1297         acc = l_repr.pop(0)
-> 1298         whitesep = acc._root
   1299         lf_sep = u" " * whitesep + u"╭" + u"─" * (acc._l - acc._root)
   1300         ls_sep = u" " * whitesep + u"│" + u" " * (acc._l - acc._root)

AttributeError: 'UnicodeArt' object has no attribute '_root'
```


Not sure if this is much of an issue, though.



---

archive/issue_comments_171114.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T04:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171114",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171115.json:
```json
{
    "body": "(2) Not sure why this behavior:\n\n```\nsage: MAryTree(4, 4)\n[., ., ., .]\nsage: MAryTree(4, 3)\n[., ., ., .]\nsage: MAryTree(4, 2)\n[., ., ., .]\nsage: MAryTree(4, 1)\n[., ., ., .]\n```\n\nWhat is the purpose of the numerical second parameter if it makes no difference?\n\n(3) Is it intentional that `check` only checks the \"outer layer\", i.e., the list of the direct children of the root?",
    "created_at": "2017-11-22T04:30:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171115",
    "user": "@darijgr"
}
```

(2) Not sure why this behavior:

```
sage: MAryTree(4, 4)
[., ., ., .]
sage: MAryTree(4, 3)
[., ., ., .]
sage: MAryTree(4, 2)
[., ., ., .]
sage: MAryTree(4, 1)
[., ., ., .]
```

What is the purpose of the numerical second parameter if it makes no difference?

(3) Is it intentional that `check` only checks the "outer layer", i.e., the list of the direct children of the root?



---

archive/issue_comments_171116.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T05:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171116",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171117.json:
```json
{
    "body": "I've reviewed the mathematics and documentation. Now we need someone to check the OOP, specifically the methods with the following names:\n\n```\n__classcall_private__\n_auto_parent\n__init__\n__call__\n_element_constructor_\n_parent_for_\nelement_class\n```\n\nand someone to fix the issues in comment:29 and comment:31.",
    "created_at": "2017-11-22T05:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171117",
    "user": "@darijgr"
}
```

I've reviewed the mathematics and documentation. Now we need someone to check the OOP, specifically the methods with the following names:

```
__classcall_private__
_auto_parent
__init__
__call__
_element_constructor_
_parent_for_
element_class
```

and someone to fix the issues in comment:29 and comment:31.



---

archive/issue_comments_171118.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T09:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171118",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171119.json:
```json
{
    "body": "I have fixed the ascii and unicode art.\n\nAlso enhanced the \"an_element\" method for labelled case.",
    "created_at": "2017-11-22T09:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171119",
    "user": "@fchapoton"
}
```

I have fixed the ascii and unicode art.

Also enhanced the "an_element" method for labelled case.



---

archive/issue_comments_171120.json:
```json
{
    "body": "> (3) Is it intentional that `check` only checks the \"outer layer\", i.e., the list of the direct children of the root?\n\nThis is exactly the existing behaviour in binary trees. So I guess we can keep that for the moment. The recursive check is handled when creating a tree, I think.\n\n```\nsage: from sage.combinat.abstract_tree import from_hexacode\nsage: M = MAryTrees(3)\nsage: from_hexacode('300200', M)\n...\nTypeError: This is not a 3-ary tree\n```\n",
    "created_at": "2017-11-22T09:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171120",
    "user": "@fchapoton"
}
```

> (3) Is it intentional that `check` only checks the "outer layer", i.e., the list of the direct children of the root?

This is exactly the existing behaviour in binary trees. So I guess we can keep that for the moment. The recursive check is handled when creating a tree, I think.

```
sage: from sage.combinat.abstract_tree import from_hexacode
sage: M = MAryTrees(3)
sage: from_hexacode('300200', M)
...
TypeError: This is not a 3-ary tree
```




---

archive/issue_comments_171121.json:
```json
{
    "body": "Some comments:\n\n- I think it would be good to do a `TestSuite` on something like `MAryTree(3, [])` as an extra security check in the `MAryTree.__init__`.\n- Do we want this MRO: `class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)`? If it is the other way -- `class MAryTrees_all(MAryTrees, DisjointUnionEnumeratedSets)` -- then I think we can remove the `__call__`. Even without changing the order, do we need it to go up the `MAryTrees` path?\n- Do we want to have 2-ary trees create the corresponding `BinaryTree*` class? This would mean we do not have to convert back and forth.\n- Related, do we want to have `BinaryTree*` inherit from its corresponding `MAryTree*` class?\n- The `LabelledMAryTrees.__call__` can be removed.\n- Lowercase error messages: `\"Invalid word\"` and `\"Wrong number of nodes\"`.\n- There is a non-standard `.. note::` block.\n- We should also specify in the `MAryTree` class-level doc that m-ary trees are plane/ordered trees.\n\nI can make these changes tomorrow (tonight I am feeling a little lazy `^^;;`).",
    "created_at": "2017-11-22T10:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171121",
    "user": "@tscrim"
}
```

Some comments:

- I think it would be good to do a `TestSuite` on something like `MAryTree(3, [])` as an extra security check in the `MAryTree.__init__`.
- Do we want this MRO: `class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)`? If it is the other way -- `class MAryTrees_all(MAryTrees, DisjointUnionEnumeratedSets)` -- then I think we can remove the `__call__`. Even without changing the order, do we need it to go up the `MAryTrees` path?
- Do we want to have 2-ary trees create the corresponding `BinaryTree*` class? This would mean we do not have to convert back and forth.
- Related, do we want to have `BinaryTree*` inherit from its corresponding `MAryTree*` class?
- The `LabelledMAryTrees.__call__` can be removed.
- Lowercase error messages: `"Invalid word"` and `"Wrong number of nodes"`.
- There is a non-standard `.. note::` block.
- We should also specify in the `MAryTree` class-level doc that m-ary trees are plane/ordered trees.

I can make these changes tomorrow (tonight I am feeling a little lazy `^^;;`).



---

archive/issue_comments_171122.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-11-22T11:57:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171122",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171123.json:
```json
{
    "body": "I did some of the simple suggested changes.\n\nI would rather not have any inheritance between BinaryTrees and MAryTrees. Conversion is enough.",
    "created_at": "2017-11-22T11:58:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171123",
    "user": "@fchapoton"
}
```

I did some of the simple suggested changes.

I would rather not have any inheritance between BinaryTrees and MAryTrees. Conversion is enough.



---

archive/issue_comments_171124.json:
```json
{
    "body": "OK, what about point (2)?\n\nAnd I'm fine with no inheritance; it's enough that the constructor is working.",
    "created_at": "2017-11-22T18:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171124",
    "user": "@darijgr"
}
```

OK, what about point (2)?

And I'm fine with no inheritance; it's enough that the constructor is working.



---

archive/issue_comments_171125.json:
```json
{
    "body": "Replying to [comment:40 chapoton]:\n> I did some of the simple suggested changes.\n\nThank you.\n\n> I would rather not have any inheritance between BinaryTrees and MAryTrees. Conversion is enough.\n\nWhy not? It doesn't make sense to me both mathematically and programmatically. I can understand you wanting to postpone it for a later ticket (although I think change it really quickly), but I don't understand the opposition to having inheritance (and the constructors returning the `BinaryTree*` object when `m = 2`). Am I missing something about the structures of these classes?",
    "created_at": "2017-11-22T22:30:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171125",
    "user": "@tscrim"
}
```

Replying to [comment:40 chapoton]:
> I did some of the simple suggested changes.

Thank you.

> I would rather not have any inheritance between BinaryTrees and MAryTrees. Conversion is enough.

Why not? It doesn't make sense to me both mathematically and programmatically. I can understand you wanting to postpone it for a later ticket (although I think change it really quickly), but I don't understand the opposition to having inheritance (and the constructors returning the `BinaryTree*` object when `m = 2`). Am I missing something about the structures of these classes?



---

archive/issue_comments_171126.json:
```json
{
    "body": "Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).",
    "created_at": "2019-07-03T11:37:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171126",
    "user": "@embray"
}
```

Moving tickets from the Sage 8.8 milestone that have been actively worked on in the last six months to the next release milestone (optimistically).



---

archive/issue_comments_171127.json:
```json
{
    "body": "I have made a fresh new branch with a single commit, as the previous one was polluted by many merge commits.\n----\nNew commits:",
    "created_at": "2019-07-24T11:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171127",
    "user": "@fchapoton"
}
```

I have made a fresh new branch with a single commit, as the previous one was polluted by many merge commits.
----
New commits:



---

archive/issue_comments_171128.json:
```json
{
    "body": "Ticket retargeted after milestone closed",
    "created_at": "2019-12-30T14:48:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171128",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed



---

archive/issue_comments_171129.json:
```json
{
    "body": "Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.",
    "created_at": "2020-04-14T19:41:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171129",
    "user": "@mkoeppe"
}
```

Batch modifying tickets that will likely not be ready for 9.1, based on a review of the ticket title, branch/review status, and last modification date.



---

archive/issue_comments_171130.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-15T06:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171130",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_171131.json:
```json
{
    "body": "What's the status of the review on this ticket?",
    "created_at": "2020-08-16T13:45:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171131",
    "user": "@mkoeppe"
}
```

What's the status of the review on this ticket?



---

archive/issue_comments_171132.json:
```json
{
    "body": "I don't remember more than is said in the comments above, and I'm not going to have time for this in the foreseeable time... sorry, not very useful I know.",
    "created_at": "2020-08-17T08:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171132",
    "user": "@darijgr"
}
```

I don't remember more than is said in the comments above, and I'm not going to have time for this in the foreseeable time... sorry, not very useful I know.



---

archive/issue_comments_171133.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171133",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_171134.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171134",
    "user": "@mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_171135.json:
```json
{
    "body": "I'd like to try and help get this finished, though I'm not sure I'm qualified to be final judge and jury on the OOP/MRO aspects. At the very least, I can implement Travis's suggestion of removing ```LabelledMAryTrees.__call__``` , and try to reverse the order of inheritance for ```class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)``` and remove the ```__call__`` and make sure nothing breaks.\n\nIn terms of m=2, people seem fine with having conversion for now, and having inheritance be part of a later ticket to get this finished.\n\nI can implement Travis's suggestion that the documentation being clearer about these being ordered/plane trees.\n\nIn terms of ```check``` only checking the outer layer, I'm pretty sure this should be fine, and it will recursively check the entire tree. But I can try and make a test case to be sure.\n\nI'll make a thorough pass in the next day or two to test things out, check doc and examples for clarity to somebody that may not be as familiar with m-ary trees, and make sure the doc compiles properly. One thing that's more a note to self to fix later when I do this is that enumerated m-ary trees of a given size is still labeled as 'enumerated set of binary trees of a given size' in the code.\n\nAlso reminder to self to check (1) as part of comment:37.",
    "created_at": "2021-07-27T14:33:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171135",
    "user": "@kevindilks"
}
```

I'd like to try and help get this finished, though I'm not sure I'm qualified to be final judge and jury on the OOP/MRO aspects. At the very least, I can implement Travis's suggestion of removing ```LabelledMAryTrees.__call__``` , and try to reverse the order of inheritance for ```class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)``` and remove the ```__call__`` and make sure nothing breaks.

In terms of m=2, people seem fine with having conversion for now, and having inheritance be part of a later ticket to get this finished.

I can implement Travis's suggestion that the documentation being clearer about these being ordered/plane trees.

In terms of ```check``` only checking the outer layer, I'm pretty sure this should be fine, and it will recursively check the entire tree. But I can try and make a test case to be sure.

I'll make a thorough pass in the next day or two to test things out, check doc and examples for clarity to somebody that may not be as familiar with m-ary trees, and make sure the doc compiles properly. One thing that's more a note to self to fix later when I do this is that enumerated m-ary trees of a given size is still labeled as 'enumerated set of binary trees of a given size' in the code.

Also reminder to self to check (1) as part of comment:37.



---

archive/issue_comments_171136.json:
```json
{
    "body": "In terms of ```class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)```versus ```class MAryTrees_all(MAryTrees, DisjointUnionEnumeratedSets)``` , the way it is now matches what is done in binary trees. \n\nI can't manage to track down exactly what's happening, but as the doc indicates, the ```__call__``` methods are necessary to make sure that empty input is treated as ```None``` instead of getting passed as ```0```. Maybe something inherited from ```OrderedTrees``` and their assumption that there are no empty trees (and thus ```OrderedTrees()() == OrderedTrees()([])```? Switching the MRO above did not resolve the issue. \n\nThis fix/hack is also implemented in ```BinaryTrees```, though only for ```BinaryTrees_all```. So ```BinaryTrees()() == BinaryTrees()(None) == .```, but in ``BinaryTrees_size``, ```BinaryTrees(0)()``` gives an error about the int 0 not being callable, whereas ```BinaryTrees(0)(None) == ```.\n\nI would be of the opinion that if the way things done here is the way they've been forever in ```BinaryTrees```, then they shouldn't be holding back this ticket from getting a positive review.",
    "created_at": "2021-07-29T02:35:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171136",
    "user": "@kevindilks"
}
```

In terms of ```class MAryTrees_all(DisjointUnionEnumeratedSets, MAryTrees)```versus ```class MAryTrees_all(MAryTrees, DisjointUnionEnumeratedSets)``` , the way it is now matches what is done in binary trees. 

I can't manage to track down exactly what's happening, but as the doc indicates, the ```__call__``` methods are necessary to make sure that empty input is treated as ```None``` instead of getting passed as ```0```. Maybe something inherited from ```OrderedTrees``` and their assumption that there are no empty trees (and thus ```OrderedTrees()() == OrderedTrees()([])```? Switching the MRO above did not resolve the issue. 

This fix/hack is also implemented in ```BinaryTrees```, though only for ```BinaryTrees_all```. So ```BinaryTrees()() == BinaryTrees()(None) == .```, but in ``BinaryTrees_size``, ```BinaryTrees(0)()``` gives an error about the int 0 not being callable, whereas ```BinaryTrees(0)(None) == ```.

I would be of the opinion that if the way things done here is the way they've been forever in ```BinaryTrees```, then they shouldn't be holding back this ticket from getting a positive review.



---

archive/issue_comments_171137.json:
```json
{
    "body": "Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13783",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13783#issuecomment-171137",
    "user": "@mkoeppe"
}
```

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.
