# Issue 15395: improving subgraph search

archive/issues_015395.json:
```json
{
    "body": "CC:  @nathanncohen @lobiCode @dcoudert\n\nHello!\n\nI recently needed to decide whether some large graphs contain the Petersen graph P. As it turned out the task was time consuming since almost none of the graphs contained P.\n\nMy original graphs had many vertices of degree 1 and 2 but apparently subgraph_search does not make use of this. The above optimization was a big improvement for this scenario\n\n\n```\ndef subgraph_search_wrapper(G, H):\n    G2 = G.copy()\n    d = min(H.degree())\n    while min(G2.degree()) < d:\n       G2.delete_vertices([v for v in G2 if G2.degree(v) < c])\n    return G2.subgraph_search(H)\n```\n\n\nas an example\n\n\n```\nsage: %timeit G.subgraph_search(H)\n1 loops, best of 3: 41.9 s per loop\nsage: %timeit subgraph_search_wrapper(G, H)\n10 loops, best of 3: 78 ms per loop\n```\n\n\nWhile I think the above optimization is valid I believe there has to be a more proper way to implement it (perhaps in generic_graph.pyx?) hence I leave this here for further discussion by you guys.\n\nBest,\n\nJernej\n\nIssue created by migration from https://trac.sagemath.org/ticket/15632\n\n",
    "created_at": "2014-01-05T10:39:21Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "improving subgraph search",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15395",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```
CC:  @nathanncohen @lobiCode @dcoudert

Hello!

I recently needed to decide whether some large graphs contain the Petersen graph P. As it turned out the task was time consuming since almost none of the graphs contained P.

My original graphs had many vertices of degree 1 and 2 but apparently subgraph_search does not make use of this. The above optimization was a big improvement for this scenario


```
def subgraph_search_wrapper(G, H):
    G2 = G.copy()
    d = min(H.degree())
    while min(G2.degree()) < d:
       G2.delete_vertices([v for v in G2 if G2.degree(v) < c])
    return G2.subgraph_search(H)
```


as an example


```
sage: %timeit G.subgraph_search(H)
1 loops, best of 3: 41.9 s per loop
sage: %timeit subgraph_search_wrapper(G, H)
10 loops, best of 3: 78 ms per loop
```


While I think the above optimization is valid I believe there has to be a more proper way to implement it (perhaps in generic_graph.pyx?) hence I leave this here for further discussion by you guys.

Best,

Jernej

Issue created by migration from https://trac.sagemath.org/ticket/15632





---

archive/issue_comments_198406.json:
```json
{
    "body": "You can use the k-core of G instead, with k=min(H.degree()). So the pre-processing could be like:\n\n```\n k = min(H.degree())\n if k>min(G.degree()):\n    cores = G.cores(with_labels=True)\n    G2 = G.subgraph([u for u in cores if cores[u]>=k])\n else:\n    G2 = G\n return G2.subgraph_search(H)\n```\n",
    "created_at": "2014-01-05T12:14:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198406",
    "user": "https://github.com/dcoudert"
}
```

You can use the k-core of G instead, with k=min(H.degree()). So the pre-processing could be like:

```
 k = min(H.degree())
 if k>min(G.degree()):
    cores = G.cores(with_labels=True)
    G2 = G.subgraph([u for u in cores if cores[u]>=k])
 else:
    G2 = G
 return G2.subgraph_search(H)
```




---

archive/issue_comments_198407.json:
```json
{
    "body": "Hellooooooo !\n\nDavid's suggestion is the right one for your problem.\n\nI have to add that I would be glad to improve some algorithms in Sage, but that I can only do this if I am allowed to. In particular, it would be quite nice if somebody could review #14589, for it *can* definitely help to improve the performances of algorithms like `subgraph_search`.\n\nNathann",
    "created_at": "2014-01-05T13:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198407",
    "user": "https://github.com/nathanncohen"
}
```

Hellooooooo !

David's suggestion is the right one for your problem.

I have to add that I would be glad to improve some algorithms in Sage, but that I can only do this if I am allowed to. In particular, it would be quite nice if somebody could review #14589, for it *can* definitely help to improve the performances of algorithms like `subgraph_search`.

Nathann



---

archive/issue_comments_198408.json:
```json
{
    "body": "Hey!\n\nAllowed to by whom? :)))\n\nFor the #14589 thing if nobody helps you within a week I'm gonna review it.\n\nBest,\n\nJernej",
    "created_at": "2014-01-05T13:46:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198408",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Hey!

Allowed to by whom? :)))

For the #14589 thing if nobody helps you within a week I'm gonna review it.

Best,

Jernej



---

archive/issue_comments_198409.json:
```json
{
    "body": "Yooooooo !\n\n> Allowed to by whom? :)))\n\nBy whoever reviews that patch `:-P`\n\n> For the #14589 thing if nobody helps you within a week I'm gonna review it.\n\nWell... Nobody did for 8 months. Would you be willing to bet ? `:-P`\n\nNathann",
    "created_at": "2014-01-05T13:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198409",
    "user": "https://github.com/nathanncohen"
}
```

Yooooooo !

> Allowed to by whom? :)))

By whoever reviews that patch `:-P`

> For the #14589 thing if nobody helps you within a week I'm gonna review it.

Well... Nobody did for 8 months. Would you be willing to bet ? `:-P`

Nathann



---

archive/issue_comments_198410.json:
```json
{
    "body": "Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?\n\nBest,\n\nJernej",
    "created_at": "2014-01-09T22:02:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198410",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?

Best,

Jernej



---

archive/issue_comments_198411.json:
```json
{
    "body": "Yoooooo !\n\n> Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?\n\nWell, it would definitely be cool to have this available through a flag in `subgraph_search*`. Do you think it should be the default behaviour ?\n\nNathann",
    "created_at": "2014-01-10T09:03:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198411",
    "user": "https://github.com/nathanncohen"
}
```

Yoooooo !

> Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?

Well, it would definitely be cool to have this available through a flag in `subgraph_search*`. Do you think it should be the default behaviour ?

Nathann



---

archive/issue_comments_198412.json:
```json
{
    "body": "I am afraid of calling `.subgraph` to remove just one or two vertices, in a function that must be fast...\n\nNathann",
    "created_at": "2014-01-10T09:04:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198412",
    "user": "https://github.com/nathanncohen"
}
```

I am afraid of calling `.subgraph` to remove just one or two vertices, in a function that must be fast...

Nathann



---

archive/issue_comments_198413.json:
```json
{
    "body": "Replying to [comment:6 ncohen]:\n> Yoooooo !\n> \n> > Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?\n> \n> Well, it would definitely be cool to have this available through a flag in `subgraph_search*`. Do you think it should be the default behaviour ? \nThe answer to this most likely depends on the  average structure of input graphs which we do not know anything about. Hence its definitely something that the user should know. So yeah, a preprocessing flag looks like a good option, though I am not sure we lose that much performance by always doing the preprocesing phase. \n\n \n> Nathann",
    "created_at": "2014-01-10T10:36:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198413",
    "user": "https://trac.sagemath.org/admin/accounts/users/azi"
}
```

Replying to [comment:6 ncohen]:
> Yoooooo !
> 
> > Now you can tell me if you wish we include this preprocesing thing or you see a better way to improve subgraph search altogether?
> 
> Well, it would definitely be cool to have this available through a flag in `subgraph_search*`. Do you think it should be the default behaviour ? 
The answer to this most likely depends on the  average structure of input graphs which we do not know anything about. Hence its definitely something that the user should know. So yeah, a preprocessing flag looks like a good option, though I am not sure we lose that much performance by always doing the preprocesing phase. 

 
> Nathann



---

archive/issue_comments_198414.json:
```json
{
    "body": "> though I am not sure we lose that much performance by always doing the preprocesing phase. \n\nI have no idea. I am just scared of `.subgraph` `:-P`\n\nNathann",
    "created_at": "2014-01-10T11:15:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15395",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15395#issuecomment-198414",
    "user": "https://github.com/nathanncohen"
}
```

> though I am not sure we lose that much performance by always doing the preprocesing phase. 

I have no idea. I am just scared of `.subgraph` `:-P`

Nathann
