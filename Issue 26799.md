# Issue 26799: FusionRing enhancements

archive/issues_026799.json:
```json
{
    "body": "CC:  @dwbump @tscrim sage-combinat buciumas @willieab @physicstravels\n\nKeywords: FusionRing\n\nThe FusionRing, implemented in #26440 is the WZW fusion or Verlinde algebra. It needs certain methods to be useful: the twist or ribbon element, the S-matrix and the quantum dimension. This ticket is to implement these methods.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27036\n\n",
    "created_at": "2019-01-09T21:21:43Z",
    "labels": [
        "combinatorics",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "FusionRing enhancements",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26799",
    "user": "@dwbump"
}
```
CC:  @dwbump @tscrim sage-combinat buciumas @willieab @physicstravels

Keywords: FusionRing

The FusionRing, implemented in #26440 is the WZW fusion or Verlinde algebra. It needs certain methods to be useful: the twist or ribbon element, the S-matrix and the quantum dimension. This ticket is to implement these methods.

Issue created by migration from https://trac.sagemath.org/ticket/27036





---

archive/issue_comments_376917.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2019-01-09T21:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376917",
    "user": "@dwbump"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_376918.json:
```json
{
    "body": "Set assignee to @dwbump.",
    "created_at": "2019-01-11T23:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376918",
    "user": "@dwbump"
}
```

Set assignee to @dwbump.



---

archive/issue_comments_376919.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-01-11T23:29:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376919",
    "user": "@dwbump"
}
```

New commits:



---

archive/issue_comments_376920.json:
```json
{
    "body": "Work issues:\n\n* Further testing is needed. This should be able to duplicate the tables in arXiv:0712.1377: On classification of modular tensor categories. Eric Rowell, Richard Stong, Zhenghan Wang.\n* Add a reference to that paper.\n* Some methods need docstrings.\n* `s_matrix` should return entries in a `CyclotomicField`, not `CC`.\n* `s_matrix` element method should be kept but the code within the loop `for i in rng:` should be split off so the user can optionally work with an individual pair of elements rather than a matrix.\n* Type E s-matrices seem conjugated. Figure out why.\n\nDesign decisions:\n\n* Should the `FusionRing` be moved to a separate file? (*perhaps not necessary unless code becomes much longer*)\n* What is the right way to make methods special to `FusionRing` not available to parent class `WeylCharacterRing`? (*fixed*)\n* Can the `ordered_basis`, `fusion_labels` and `basis` methods be intelligently reorganized, and can we use python `OrderedDict` for the basis?\n\nFigure out the right `CyclotomicField` which may be the square root of the one currently used.",
    "created_at": "2019-01-11T23:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376920",
    "user": "@dwbump"
}
```

Work issues:

* Further testing is needed. This should be able to duplicate the tables in arXiv:0712.1377: On classification of modular tensor categories. Eric Rowell, Richard Stong, Zhenghan Wang.
* Add a reference to that paper.
* Some methods need docstrings.
* `s_matrix` should return entries in a `CyclotomicField`, not `CC`.
* `s_matrix` element method should be kept but the code within the loop `for i in rng:` should be split off so the user can optionally work with an individual pair of elements rather than a matrix.
* Type E s-matrices seem conjugated. Figure out why.

Design decisions:

* Should the `FusionRing` be moved to a separate file? (*perhaps not necessary unless code becomes much longer*)
* What is the right way to make methods special to `FusionRing` not available to parent class `WeylCharacterRing`? (*fixed*)
* Can the `ordered_basis`, `fusion_labels` and `basis` methods be intelligently reorganized, and can we use python `OrderedDict` for the basis?

Figure out the right `CyclotomicField` which may be the square root of the one currently used.



---

archive/issue_comments_376921.json:
```json
{
    "body": "There is the `UniversalCyclotomicField` if you do not want to be so careful about which roots you want.\n\nAs for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.",
    "created_at": "2019-01-13T17:24:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376921",
    "user": "@tscrim"
}
```

There is the `UniversalCyclotomicField` if you do not want to be so careful about which roots you want.

As for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.



---

archive/issue_comments_376922.json:
```json
{
    "body": "Replying to [comment:4 tscrim]:\n\n> As for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.\n\nThe original comment:3 is not clear but the issue is actually with `WeylCharacterRing.Element` methods.\nthat only pertain to `FusionRing` elements.\n\nSo I checked that the following works. We add a `FusionRing.Element` class that inherits from\n`WeylCharacterRing.Element`. Then we move the `WeylCharacterRing.Element` methods such\nas `is_simple_obj`,`twists`, etc. to the new class.",
    "created_at": "2019-01-14T02:48:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376922",
    "user": "@dwbump"
}
```

Replying to [comment:4 tscrim]:

> As for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.

The original comment:3 is not clear but the issue is actually with `WeylCharacterRing.Element` methods.
that only pertain to `FusionRing` elements.

So I checked that the following works. We add a `FusionRing.Element` class that inherits from
`WeylCharacterRing.Element`. Then we move the `WeylCharacterRing.Element` methods such
as `is_simple_obj`,`twists`, etc. to the new class.



---

archive/issue_comments_376923.json:
```json
{
    "body": "Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.",
    "created_at": "2019-01-15T18:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376923",
    "user": "@embray"
}
```

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.



---

archive/issue_comments_376924.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-17T22:01:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376924",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376925.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-01-29T20:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376925",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376926.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-01T23:25:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376926",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376927.json:
```json
{
    "body": "Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)",
    "created_at": "2019-03-25T10:56:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376927",
    "user": "@embray"
}
```

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)



---

archive/issue_comments_376928.json:
```json
{
    "body": "As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).",
    "created_at": "2019-06-14T14:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376928",
    "user": "@embray"
}
```

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).



---

archive/issue_comments_376929.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-29T19:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376929",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_376930.json:
```json
{
    "body": "This patch is important but was neglected for a while. We are reviving it. The old branch was called `public/fusion-27036` but this has been superceded by `public/fusion_ring_operations-27036`.\n\n* The old patch was ported to python3 and recent development branch by  physicstravels.\n* The ordered_basis method has been abandoned in favor of a scheme based on the get_order and set_order methods of `CombinatorialFreeModule`.\n* The method `fusion_matrix` was eliminated.\n----\nNew commits:",
    "created_at": "2020-06-17T04:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376930",
    "user": "@dwbump"
}
```

This patch is important but was neglected for a while. We are reviving it. The old branch was called `public/fusion-27036` but this has been superceded by `public/fusion_ring_operations-27036`.

* The old patch was ported to python3 and recent development branch by  physicstravels.
* The ordered_basis method has been abandoned in favor of a scheme based on the get_order and set_order methods of `CombinatorialFreeModule`.
* The method `fusion_matrix` was eliminated.
----
New commits:



---

archive/issue_comments_376931.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-17T04:17:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376931",
    "user": "@dwbump"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_376932.json:
```json
{
    "body": "A work issue: the `get_order` method of `CombinatorialFreeModule` is cached and this can cause incorrect results if the order is changed using `set_order`. Example:\n\n\n```\nsage: A13=FusionRing(\"A1\",3)\nsage: b = list(A13.basis().keys()); b\n[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]\nsage: b.reverse(); b\n[(3/2, -3/2), (1, -1), (1/2, -1/2), (0, 0)]\nsage: A13.set_order(b)\nsage: A13.get_order()\n[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]\n```\n\n\nThis does not happen every time. Sometimes the correct order is reported after exactly these commands. More testing is needed to say whether there is a reproducible failure.\n\nAn obvious fix (not tried yet) would be to remove the ``@`cached_method` from `get_order` in `free_module.py`. One can argue that the caching is of minimal value. When get_order is called, if `self._order` is not `None`, its contents is returned. This is what will happen every time it is called except the first time. So arguably the value of the caching is small, and has the effect of breaking `set_order`.\n\nIsn't this a problem for other `CombinatorialFreeModules` besides `FusionRings`?",
    "created_at": "2020-06-17T04:38:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376932",
    "user": "@dwbump"
}
```

A work issue: the `get_order` method of `CombinatorialFreeModule` is cached and this can cause incorrect results if the order is changed using `set_order`. Example:


```
sage: A13=FusionRing("A1",3)
sage: b = list(A13.basis().keys()); b
[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]
sage: b.reverse(); b
[(3/2, -3/2), (1, -1), (1/2, -1/2), (0, 0)]
sage: A13.set_order(b)
sage: A13.get_order()
[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]
```


This does not happen every time. Sometimes the correct order is reported after exactly these commands. More testing is needed to say whether there is a reproducible failure.

An obvious fix (not tried yet) would be to remove the ``@`cached_method` from `get_order` in `free_module.py`. One can argue that the caching is of minimal value. When get_order is called, if `self._order` is not `None`, its contents is returned. This is what will happen every time it is called except the first time. So arguably the value of the caching is small, and has the effect of breaking `set_order`.

Isn't this a problem for other `CombinatorialFreeModules` besides `FusionRings`?



---

archive/issue_comments_376933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-17T12:58:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376933",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376934.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-19T17:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376934",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376935.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-19T17:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376935",
    "user": "@dwbump"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_376936.json:
```json
{
    "body": "In the reference manual, the `FusionRing` methods are mixed up with the `WeylCharacterRing` methods.\n\nIs there a way to keep them separate?\n\nDo we need to move the FusionRing class to a separate file?",
    "created_at": "2020-06-20T05:04:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376936",
    "user": "@dwbump"
}
```

In the reference manual, the `FusionRing` methods are mixed up with the `WeylCharacterRing` methods.

Is there a way to keep them separate?

Do we need to move the FusionRing class to a separate file?



---

archive/issue_comments_376937.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-21T00:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376937",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376938.json:
```json
{
    "body": "The last commits moved `FusionRing` to a separate file which fixes the reference manual; and renamed the highest_weight method of a `FusionRing` to weight.",
    "created_at": "2020-06-21T00:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376938",
    "user": "@dwbump"
}
```

The last commits moved `FusionRing` to a separate file which fixes the reference manual; and renamed the highest_weight method of a `FusionRing` to weight.



---

archive/issue_comments_376939.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T13:48:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376939",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376940.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-22T19:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376940",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-23T17:09:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376941",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376942.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-23T17:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376942",
    "user": "@dwbump"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_376943.json:
```json
{
    "body": "I am changing the status to `needs work` pending some further revisions and testing.",
    "created_at": "2020-06-23T17:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376943",
    "user": "@dwbump"
}
```

I am changing the status to `needs work` pending some further revisions and testing.



---

archive/issue_comments_376944.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-24T15:59:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376944",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376945.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-25T22:12:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376945",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376946.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-25T23:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376946",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376947.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-25T23:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376947",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376948.json:
```json
{
    "body": "This version passes a fairly convincing test, which is that the Verlinde formula can be verified for any given `FusionRing`. Ths exercises most of the code. Details are in the reference manual\n\nA temporary build of the documentation may be found at this URL:\n\nhttp://match.stanford.edu/reference/combinat/sage/combinat/root_system/fusion_ring.html",
    "created_at": "2020-06-26T00:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376948",
    "user": "@dwbump"
}
```

This version passes a fairly convincing test, which is that the Verlinde formula can be verified for any given `FusionRing`. Ths exercises most of the code. Details are in the reference manual

A temporary build of the documentation may be found at this URL:

http://match.stanford.edu/reference/combinat/sage/combinat/root_system/fusion_ring.html



---

archive/issue_comments_376949.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-26T00:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376949",
    "user": "@dwbump"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_376950.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-26T03:02:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376950",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376951.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-06-26T03:04:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376951",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_376952.json:
```json
{
    "body": "I went through and did some changes.\n\nThe most significant is to `q_dimension` to not do the division where there could be a lot of cancelling factors. This might be slower when no factors will cancel (I didn't test), but I expect it to be asymptotically faster.\n\nI remove the resetting of the order when calling `fusion_labels()` as I think this functionality should be kept separate.\n\nI also added an explicit parameter in `fusion_labels()` to ask the user if they want to inject the variables. If this happened by default (or always), it could have very subtle side effects, lost computations, or errors because the variable name is not in the correct format.\n\nEverything else was documentation related.",
    "created_at": "2020-06-26T03:07:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376952",
    "user": "@tscrim"
}
```

I went through and did some changes.

The most significant is to `q_dimension` to not do the division where there could be a lot of cancelling factors. This might be slower when no factors will cancel (I didn't test), but I expect it to be asymptotically faster.

I remove the resetting of the order when calling `fusion_labels()` as I think this functionality should be kept separate.

I also added an explicit parameter in `fusion_labels()` to ask the user if they want to inject the variables. If this happened by default (or always), it could have very subtle side effects, lost computations, or errors because the variable name is not in the correct format.

Everything else was documentation related.



---

archive/issue_comments_376953.json:
```json
{
    "body": "The patchbot is reporting duplicate references [BK2001] and it turns out there are three.\n\nIn `combinat.dyke_words` \n\n    [BK2001] J. Bandlow, K. Killpatrick -- *An area-to_inv bijection\n    between Dyck paths and 312-avoiding permutations*, Electronic\n    Journal of Combinatorics, Volume 8, Issue 1 (2001).\n\nIn `/doc/en/reference/references/index.rst`\n\n    [BK2001] Bakalov and Kirillov, *Lectures on tensor categories and modular functors*,  AMS (2001)\n\ncited in `fusion.py` and:\n\n    [BK2001] W. Bruns and R. Koch, *Computing the integral closure of an\n    affine semigroup*. Uni. Iaggelonicae Acta Math. 39, (2001),  59-70\n\ncited in `geometry.cones` and `geometry.integral_points`. The Bandlow and Killpatrick paper is not in `index.rst`.",
    "created_at": "2020-06-26T13:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376953",
    "user": "@dwbump"
}
```

The patchbot is reporting duplicate references [BK2001] and it turns out there are three.

In `combinat.dyke_words` 

    [BK2001] J. Bandlow, K. Killpatrick -- *An area-to_inv bijection
    between Dyck paths and 312-avoiding permutations*, Electronic
    Journal of Combinatorics, Volume 8, Issue 1 (2001).

In `/doc/en/reference/references/index.rst`

    [BK2001] Bakalov and Kirillov, *Lectures on tensor categories and modular functors*,  AMS (2001)

cited in `fusion.py` and:

    [BK2001] W. Bruns and R. Koch, *Computing the integral closure of an
    affine semigroup*. Uni. Iaggelonicae Acta Math. 39, (2001),  59-70

cited in `geometry.cones` and `geometry.integral_points`. The Bandlow and Killpatrick paper is not in `index.rst`.



---

archive/issue_comments_376954.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-26T16:26:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376954",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376955.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T04:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376955",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376956.json:
```json
{
    "body": "I wasn't aware of that. Thank you for catching that. If\n\nThe references in `combinat/dyck_words.py` probably should be moved to the master reference file to avoid this as well, but that is for another ticket.\n\nOne additional trivial thing to fix:\n\n```diff\n     def get_order(self):\n-        r\"\"\"This returns the weights of the basis vectors in a fixed order.\n+        r\"\"\"\n+        Return the weights of the basis vectors in a fixed order.\n+\n         You may change the order of the basis using :meth:`CombinatorialFreeModule.set_order`\n```\n\n\nOnce done, I think we can set a positive review as we can change the caching in `combinat/free_module.py` easily enough on a later ticket.",
    "created_at": "2020-06-27T08:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376956",
    "user": "@tscrim"
}
```

I wasn't aware of that. Thank you for catching that. If

The references in `combinat/dyck_words.py` probably should be moved to the master reference file to avoid this as well, but that is for another ticket.

One additional trivial thing to fix:

```diff
     def get_order(self):
-        r"""This returns the weights of the basis vectors in a fixed order.
+        r"""
+        Return the weights of the basis vectors in a fixed order.
+
         You may change the order of the basis using :meth:`CombinatorialFreeModule.set_order`
```


Once done, I think we can set a positive review as we can change the caching in `combinat/free_module.py` easily enough on a later ticket.



---

archive/issue_comments_376957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T16:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376957",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376958.json:
```json
{
    "body": "| One additional trivial thing to fix:\nI fixed that. I also added the Ising MTC as an example.",
    "created_at": "2020-06-27T16:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376958",
    "user": "@dwbump"
}
```

| One additional trivial thing to fix:
I fixed that. I also added the Ising MTC as an example.



---

archive/issue_comments_376959.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T16:13:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376959",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376960.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-27T16:20:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376960",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-28T01:10:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376962.json:
```json
{
    "body": "Unfortunately, I had misused the term ``total_quantum_order`` which is actually the square root of the computed quantity, at least in the paper of Rowell, Stong and Wang.\n\nTherefore I changed the term to ``global_q_dimension`` which is consistent with the literature.",
    "created_at": "2020-06-28T01:14:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376962",
    "user": "@dwbump"
}
```

Unfortunately, I had misused the term ``total_quantum_order`` which is actually the square root of the computed quantity, at least in the paper of Rowell, Stong and Wang.

Therefore I changed the term to ``global_q_dimension`` which is consistent with the literature.



---

archive/issue_comments_376963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-28T04:55:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-28T14:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376964",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376965.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-06-29T00:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376965",
    "user": "@dwbump"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_376966.json:
```json
{
    "body": "The Verlinde formula is not quite stated in the usual way, because a complex conjugation is omitted, and `N_ijk` is used instead of `Nk_ij`. This appears to be correct (on the basis of testing) but why is it correct mathematically?\n\nSince this isue came up I'm temporarily changing the ticket to Needs Work.",
    "created_at": "2020-06-29T00:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376966",
    "user": "@dwbump"
}
```

The Verlinde formula is not quite stated in the usual way, because a complex conjugation is omitted, and `N_ijk` is used instead of `Nk_ij`. This appears to be correct (on the basis of testing) but why is it correct mathematically?

Since this isue came up I'm temporarily changing the ticket to Needs Work.



---

archive/issue_comments_376967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T02:37:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376967",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376968.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T04:25:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376968",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376969.json:
```json
{
    "body": "I added a bit more explanation about the Verlinde formula.",
    "created_at": "2020-06-29T04:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376969",
    "user": "@dwbump"
}
```

I added a bit more explanation about the Verlinde formula.



---

archive/issue_comments_376970.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-06-29T04:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376970",
    "user": "@dwbump"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_376971.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T04:56:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376971",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376972.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T05:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376972",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376973.json:
```json
{
    "body": "I ended up changing the `_test_verlinde` to go through only some of the basis elements up to a limit in case someone wants to run the `TestSuite` on a very large dimensional fusion ring. This is close to what is done in `_test_associativity`. If you disagree, then I can revert this. If you are happy with the last change and tweaks, then you can set a positive review.",
    "created_at": "2020-06-29T05:45:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376973",
    "user": "@tscrim"
}
```

I ended up changing the `_test_verlinde` to go through only some of the basis elements up to a limit in case someone wants to run the `TestSuite` on a very large dimensional fusion ring. This is close to what is done in `_test_associativity`. If you disagree, then I can revert this. If you are happy with the last change and tweaks, then you can set a positive review.



---

archive/issue_comments_376974.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-06-29T14:43:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376974",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_376975.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-06-29T17:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376975",
    "user": "@dwbump"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_376976.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-08T23:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376976",
    "user": "@mkoeppe"
}
```

Resolution: fixed



---

archive/issue_comments_376977.json:
```json
{
    "body": "These have been merged into 9.2.beta4",
    "created_at": "2020-07-08T23:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26799",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26799#issuecomment-376977",
    "user": "@mkoeppe"
}
```

These have been merged into 9.2.beta4
