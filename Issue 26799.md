# Issue 26799: FusionRing enhancements

Issue created by migration from https://trac.sagemath.org/ticket/27036

Original creator: bump

Original creation time: 2019-01-09 21:21:43

CC:  bump tscrim sage-combinat buciumas @willieab @physicstravels

Keywords: FusionRing

The FusionRing, implemented in #26440 is the WZW fusion or Verlinde algebra. It needs certain methods to be useful: the twist or ribbon element, the S-matrix and the quantum dimension. This ticket is to implement these methods.


---

Comment by bump created at 2019-01-09 21:22:30

Changing type from PLEASE CHANGE to enhancement.


---

Comment by bump created at 2019-01-11 23:29:34

Set assignee to bump.


---

Comment by bump created at 2019-01-11 23:29:34

New commits:


---

Comment by bump created at 2019-01-11 23:42:16

Work issues:

* Further testing is needed. This should be able to duplicate the tables in arXiv:0712.1377: On classification of modular tensor categories. Eric Rowell, Richard Stong, Zhenghan Wang.
* Add a reference to that paper.
* Some methods need docstrings.
* `s_matrix` should return entries in a `CyclotomicField`, not `CC`.
* `s_matrix` element method should be kept but the code within the loop `for i in rng:` should be split off so the user can optionally work with an individual pair of elements rather than a matrix.
* Type E s-matrices seem conjugated. Figure out why.

Design decisions:

* Should the `FusionRing` be moved to a separate file? (*perhaps not necessary unless code becomes much longer*)
* What is the right way to make methods special to `FusionRing` not available to parent class `WeylCharacterRing`? (*fixed*)
* Can the `ordered_basis`, `fusion_labels` and `basis` methods be intelligently reorganized, and can we use python `OrderedDict` for the basis?

Figure out the right `CyclotomicField` which may be the square root of the one currently used.


---

Comment by tscrim created at 2019-01-13 17:24:58

There is the `UniversalCyclotomicField` if you do not want to be so careful about which roots you want.

As for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.


---

Comment by bump created at 2019-01-14 02:48:22

Replying to [comment:4 tscrim]:

> As for making methods special to `FusionRing` not for the WCR, you should put those methods in the subclass.

The original comment:3 is not clear but the issue is actually with `WeylCharacterRing.Element` methods.
that only pertain to `FusionRing` elements.

So I checked that the following works. We add a `FusionRing.Element` class that inherits from
`WeylCharacterRing.Element`. Then we move the `WeylCharacterRing.Element` methods such
as `is_simple_obj`,`twists`, etc. to the new class.


---

Comment by embray created at 2019-01-15 18:15:21

Retarging tickets optimistically to the next milestone.  If you are responsible for this ticket (either its reporter or owner) and don't believe you are likely to complete this ticket before the next release (8.7) please retarget this ticket's milestone to sage-pending or sage-wishlist.


---

Comment by git created at 2019-01-17 22:01:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-01-29 20:34:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2019-02-01 23:25:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by embray created at 2019-03-25 10:56:15

Ticket retargeted after milestone closed (if you don't believe this ticket is appropriate for the Sage 8.8 release please retarget manually)


---

Comment by embray created at 2019-06-14 14:54:19

As the Sage-8.8 release milestone is pending, we should delete the sage-8.8 milestone for tickets that are not actively being worked on or that still require significant work to move forward.  If you feel that this ticket should be included in the next Sage release at the soonest please set its milestone to the next release milestone (sage-8.9).


---

Comment by mkoeppe created at 2020-04-29 19:28:56

Changing status from new to needs_review.


---

Comment by bump created at 2020-06-17 04:17:28

This patch is important but was neglected for a while. We are reviving it. The old branch was called `public/fusion-27036` but this has been superceded by `public/fusion_ring_operations-27036`.

* The old patch was ported to python3 and recent development branch by  physicstravels.
* The ordered_basis method has been abandoned in favor of a scheme based on the get_order and set_order methods of `CombinatorialFreeModule`.
* The method `fusion_matrix` was eliminated.
----
New commits:


---

Comment by bump created at 2020-06-17 04:17:28

Changing status from needs_review to needs_work.


---

Comment by bump created at 2020-06-17 04:38:38

A work issue: the `get_order` method of `CombinatorialFreeModule` is cached and this can cause incorrect results if the order is changed using `set_order`. Example:


```
sage: A13=FusionRing("A1",3)
sage: b = list(A13.basis().keys()); b
[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]
sage: b.reverse(); b
[(3/2, -3/2), (1, -1), (1/2, -1/2), (0, 0)]
sage: A13.set_order(b)
sage: A13.get_order()
[(0, 0), (1/2, -1/2), (1, -1), (3/2, -3/2)]
```


This does not happen every time. Sometimes the correct order is reported after exactly these commands. More testing is needed to say whether there is a reproducible failure.

An obvious fix (not tried yet) would be to remove the ``@`cached_method` from `get_order` in `free_module.py`. One can argue that the caching is of minimal value. When get_order is called, if `self._order` is not `None`, its contents is returned. This is what will happen every time it is called except the first time. So arguably the value of the caching is small, and has the effect of breaking `set_order`.

Isn't this a problem for other `CombinatorialFreeModules` besides `FusionRings`?


---

Comment by git created at 2020-06-17 12:58:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-19 17:38:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-19 17:46:46

Changing status from needs_work to needs_review.


---

Comment by bump created at 2020-06-20 05:04:33

In the reference manual, the `FusionRing` methods are mixed up with the `WeylCharacterRing` methods.

Is there a way to keep them separate?

Do we need to move the FusionRing class to a separate file?


---

Comment by git created at 2020-06-21 00:28:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-21 00:32:33

The last commits moved `FusionRing` to a separate file which fixes the reference manual; and renamed the highest_weight method of a `FusionRing` to weight.


---

Comment by git created at 2020-06-22 13:48:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-22 19:22:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-23 17:09:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-23 17:13:19

Changing status from needs_review to needs_work.


---

Comment by bump created at 2020-06-23 17:13:19

I am changing the status to `needs work` pending some further revisions and testing.


---

Comment by git created at 2020-06-24 15:59:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-25 22:12:22

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-25 23:29:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-25 23:48:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-26 00:03:51

This version passes a fairly convincing test, which is that the Verlinde formula can be verified for any given `FusionRing`. Ths exercises most of the code. Details are in the reference manual

A temporary build of the documentation may be found at this URL:

http://match.stanford.edu/reference/combinat/sage/combinat/root_system/fusion_ring.html


---

Comment by bump created at 2020-06-26 00:03:51

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-06-26 03:02:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-26 03:04:08

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by tscrim created at 2020-06-26 03:07:10

I went through and did some changes.

The most significant is to `q_dimension` to not do the division where there could be a lot of cancelling factors. This might be slower when no factors will cancel (I didn't test), but I expect it to be asymptotically faster.

I remove the resetting of the order when calling `fusion_labels()` as I think this functionality should be kept separate.

I also added an explicit parameter in `fusion_labels()` to ask the user if they want to inject the variables. If this happened by default (or always), it could have very subtle side effects, lost computations, or errors because the variable name is not in the correct format.

Everything else was documentation related.


---

Comment by bump created at 2020-06-26 13:19:45

The patchbot is reporting duplicate references [BK2001] and it turns out there are three.

In `combinat.dyke_words` 

    [BK2001] J. Bandlow, K. Killpatrick -- *An area-to_inv bijection
    between Dyck paths and 312-avoiding permutations*, Electronic
    Journal of Combinatorics, Volume 8, Issue 1 (2001).

In `/doc/en/reference/references/index.rst`

    [BK2001] Bakalov and Kirillov, *Lectures on tensor categories and modular functors*,  AMS (2001)

cited in `fusion.py` and:

    [BK2001] W. Bruns and R. Koch, *Computing the integral closure of an
    affine semigroup*. Uni. Iaggelonicae Acta Math. 39, (2001),  59-70

cited in `geometry.cones` and `geometry.integral_points`. The Bandlow and Killpatrick paper is not in `index.rst`.


---

Comment by git created at 2020-06-26 16:26:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-27 04:56:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-27 08:40:39

I wasn't aware of that. Thank you for catching that. If

The references in `combinat/dyck_words.py` probably should be moved to the master reference file to avoid this as well, but that is for another ticket.

One additional trivial thing to fix:

```diff
     def get_order(self):
-        r"""This returns the weights of the basis vectors in a fixed order.
+        r"""
+        Return the weights of the basis vectors in a fixed order.
+
         You may change the order of the basis using :meth:`CombinatorialFreeModule.set_order`
```


Once done, I think we can set a positive review as we can change the caching in `combinat/free_module.py` easily enough on a later ticket.


---

Comment by git created at 2020-06-27 16:02:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-27 16:08:31

| One additional trivial thing to fix:
I fixed that. I also added the Ising MTC as an example.


---

Comment by git created at 2020-06-27 16:13:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-27 16:20:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 01:10:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-28 01:14:38

Unfortunately, I had misused the term ``total_quantum_order`` which is actually the square root of the computed quantity, at least in the paper of Rowell, Stong and Wang.

Therefore I changed the term to ``global_q_dimension`` which is consistent with the literature.


---

Comment by git created at 2020-06-28 04:55:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-28 14:03:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-29 00:53:21

Changing status from needs_review to needs_work.


---

Comment by bump created at 2020-06-29 00:53:21

The Verlinde formula is not quite stated in the usual way, because a complex conjugation is omitted, and `N_ijk` is used instead of `Nk_ij`. This appears to be correct (on the basis of testing) but why is it correct mathematically?

Since this isue came up I'm temporarily changing the ticket to Needs Work.


---

Comment by git created at 2020-06-29 02:37:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-29 04:25:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-29 04:52:19

I added a bit more explanation about the Verlinde formula.


---

Comment by bump created at 2020-06-29 04:52:19

Changing status from needs_work to needs_review.


---

Comment by git created at 2020-06-29 04:56:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-06-29 05:43:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2020-06-29 05:45:29

I ended up changing the `_test_verlinde` to go through only some of the basis elements up to a limit in case someone wants to run the `TestSuite` on a very large dimensional fusion ring. This is close to what is done in `_test_associativity`. If you disagree, then I can revert this. If you are happy with the last change and tweaks, then you can set a positive review.


---

Comment by git created at 2020-06-29 14:43:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bump created at 2020-06-29 17:40:08

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2020-07-08 23:18:12

Resolution: fixed


---

Comment by mkoeppe created at 2020-07-08 23:18:12

These have been merged into 9.2.beta4
