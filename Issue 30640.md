# Issue 30640: Trac: Link to Github actions results, in particular for linters

Issue created by migration from https://trac.sagemath.org/ticket/30877

Original creator: mkoeppe

Original creation time: 2020-11-09 03:57:14

CC:  dimpase chapoton embray

Follow-up from #30404 (Add pyright and pycodestyle checks as Github actions):

What is left to do is to add the integration of the github action output to trac. That can be done as follows:
1. Sync trac branches to sagetrac-mirror (by post-commit hook)
2. Activate github actions in the sagetrac-mirror github repo
3. Add the following code to either the patchbot output or to the trac ticket header (next to the patchbot button)

```
<a href="https://github.com/sagemath/sagetrac-mirror/actions?query=workflow%3ALint+branch%3BRANCH"><img src="https://github.com/sagemath/sagetrac-mirror/workflows/Lint/badge.svg?branch=BRANCH&event=push"/></a>
```

Here BRANCH needs to be replaced by the branch.
Giving something similar to

![](https://github.com/tobiasdiez/sage/workflows/Lint/badge.svg?branch=patch-2&event=push)

As this requires rights to the github repo and trac config, I cannot do this and have to leave it to somebody else.




---

Comment by chapoton created at 2020-11-09 07:48:17

see also https://github.com/sagemath/sage_trac_plugin/pull/21


---

Comment by @tobiasdiez created at 2020-11-09 11:54:44

Thanks chapton for the pointer! Based on your code, I've added a badge for github as well: https://github.com/sagemath/sage_trac_plugin/pull/22

`@`dimpase could you please extend the post-commit hook to push to include github as well. That would be awesome! Thanks.


---

Comment by dimpase created at 2020-11-09 12:48:31

Replying to [comment:2 gh-tobiasdiez]:
> Thanks chapton for the pointer! Based on your code, I've added a badge for github as well: https://github.com/sagemath/sage_trac_plugin/pull/22
> 
> `@`dimpase could you please extend the post-commit hook to push to include github as well. That would be awesome! Thanks.

I'm trying to re-create a mirror on github atm. Our repo apparently has too many branches for GH to take it in one go. So it has to go branch  by branch, tag by tag...


---

Comment by @tobiasdiez created at 2020-11-18 14:27:49

Replying to [comment:3 dimpase]:
> I'm trying to re-create a mirror on github atm. Our repo apparently has too many branches for GH to take it in one go. So it has to go branch  by branch, tag by tag...

Thanks a lot! It appears the initial sync was successful but it stopped pushing further updates to github about 8 days ago. 

It would also be great if you could activate the github actions in the sagetrac mirror.


---

Comment by dimpase created at 2020-11-18 16:25:46

Replying to [comment:4 gh-tobiasdiez]:
> Replying to [comment:3 dimpase]:
> > I'm trying to re-create a mirror on github atm. Our repo apparently has too many branches for GH to take it in one go. So it has to go branch  by branch, tag by tag...
> 
> Thanks a lot! It appears the initial sync was successful but it stopped pushing further updates to github about 8 days ago. 

OK, I've finally got around to install the hook to actually do the mirror-pushing, it seems to work now.
> 
> It would also be great if you could activate the github actions in the sagetrac mirror.

All actions? I've done this for the time being, so it's active now, but perhaps we need to look into trimming the list.


---

Comment by @tobiasdiez created at 2020-11-18 20:20:17

Changing status from new to needs_review.


---

Comment by @tobiasdiez created at 2020-11-18 20:20:17

Nice! After #30404 and #30910, the only github actions that should run after a push are the linter tests (that only take a couple of min). 

So, the only thing left is to review and merge https://github.com/sagemath/sage_trac_plugin/pull/22, so I'll put this ticket on "ready-for-review" now.


---

Comment by dimpase created at 2020-11-19 00:57:53

I don't understand how sage_trac_plugin is supposed to be doing anything here.
There is something to be done on trac server, yes...


---

Comment by @tobiasdiez created at 2020-11-19 08:21:34

To my understanding the sage_trac_plugin handles the sage-specific customization of trac. Isn't this the case?


---

Comment by dimpase created at 2020-11-19 09:52:39

Replying to [comment:9 gh-tobiasdiez]:
> To my understanding the sage_trac_plugin handles the sage-specific customization of trac. Isn't this the case?

sage_trac_plugin is a **client** (mostly a git extension, with various addons to 
deal with trac tickets).

It does have a kind of [GitLab](GitLab) integration (used by the release manager, I suppose),
- this integration does autoimatic opening/managing of trac tickets for MRs on [GitLab](GitLab).
Anything added there would only affect trac tickets opened via [GitLab](GitLab), I guess.


I don't think there is a config for our trac **server** maintained as a git repo anywhere.
(At least I don't know).


---

Comment by dimpase created at 2020-11-19 09:52:39

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2020-11-19 09:55:48

GitHub's "select actions to allow" looks like

```
Allow specified actions
Enter a comma-separated list of actions

...

Wildcards, tags, and SHAs are allowed. Examples: monalisa/octocat@*, monalisa/octocat@v2, monalisa/*
```

Could you provide a list of actions to enable this way, in this format?


---

Comment by dimpase created at 2020-11-19 09:57:06

I'm stopping the actions for now, as now pushes to trac git trigger a full Actions testsuite.


---

Comment by @tobiasdiez created at 2020-11-19 10:03:23

Replying to [comment:11 dimpase]:
> GitHub's "select actions to allow" looks like
> ...
> Could you provide a list of actions to enable this way, in this format?

To my knowledge, that's for specifying which actions are allowed in the workflows (i.e. as steps in the workflow, e.g. checkout), but not the workflows itself.
The trigger for the workflows are specified at the beginning of the workflow file.


---

Comment by @tobiasdiez created at 2020-11-19 10:04:35

Replying to [comment:12 dimpase]:
> I'm stopping the actions for now, as now pushes to trac git trigger a full Actions testsuite.

Which testsuites were triggered? I looked at it yesterday and it was only the WSL one, which is deactivated with #30910.


---

Comment by dimpase created at 2020-11-19 10:40:12

Replying to [comment:14 gh-tobiasdiez]:
> Replying to [comment:12 dimpase]:
> > I'm stopping the actions for now, as now pushes to trac git trigger a full Actions testsuite.
> 
> Which testsuites were triggered? I looked at it yesterday and it was only the WSL one, which is deactivated with #30910.

that's right, only `Build & Test WSL` were activated. Should we wait for #30910 to be merged?


---

Comment by dimpase created at 2020-11-19 10:43:20

Replying to [comment:13 gh-tobiasdiez]:
> Replying to [comment:11 dimpase]:
> > GitHub's "select actions to allow" looks like
> > ...
> > Could you provide a list of actions to enable this way, in this format?
> 
> To my knowledge, that's for specifying which actions are allowed in the workflows (i.e. as steps in the workflow, e.g. checkout), but not the workflows itself.
> The trigger for the workflows are specified at the beginning of the workflow file.

well, you know much more about Actions than me. Are you saying that after #30910, and #30404, if we enable all actions on the repo, then only linters will be run?


---

Comment by @tobiasdiez created at 2020-11-19 11:27:09

Replying to [comment:16 dimpase]:
> well, you know much more about Actions than me. Are you saying that after #30910, and #30404, if we enable all actions on the repo, then only linters will be run?

Yes, the linters are then the only workflows that run on push. It's a good idea to wait until #30910 is merged to reenable the actions.

Is there something I can help with concerning the trac modifications that are necessary? Who would be the right person to talk with about these things?


---

Comment by dimpase created at 2020-11-19 12:07:30

`@`embray (in cc on this ticket, I also sent an email) knows all about the settings of trac, and I just spent some time looking at the configs etc there, but could not see where the structure of the ticket page is set up.


---

Comment by @tobiasdiez created at 2020-11-29 13:50:39

`@`dimpase, #30910 is now merged so it should be ok to activate the github actions again (some older branches might still trigger this workflow, but that shouldn't be a problem). Thanks!

`@`embray, please let me know if I can help with the trac integration!


---

Comment by dimpase created at 2020-11-30 10:52:50

Replying to [comment:20 gh-tobiasdiez]:
> `@`dimpase, #30910 is now merged so it should be ok to activate the github actions again (some older branches might still trigger this workflow, but that shouldn't be a problem). Thanks!
> 
ok, done.


---

Comment by @tobiasdiez created at 2020-11-30 12:40:21

Thanks!


---

Comment by mkoeppe created at 2021-02-13 20:51:01

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.


---

Comment by @tobiasdiez created at 2021-02-26 16:52:31

Changing status from needs_work to positive_review.


---

Comment by @tobiasdiez created at 2021-02-26 16:52:31

Thanks to embray, this is now implemented. 

(Not sure what is the workflow for "resolved but doesn't need merge", so I'll set it simply to positive review.)


---

Comment by embray created at 2021-02-26 16:59:53

Resolution: worksforme


---

Comment by tmonteil created at 2021-02-26 17:42:27

Does this mean that now Microsoft knows at what time i connect to trac, from which location, which tickets i am interested in, etc ?

If it is the case, i think this should be made optional and disabled by default, or the plugin should do some caching so that trac serves the picture, not github.


---

Comment by embray created at 2021-03-02 13:31:39

Replying to [comment:26 tmonteil]:
> Does this mean that now Microsoft knows at what time i connect to trac, from which location, which tickets i am interested in, etc ?
> 
> If it is the case, i think this should be made optional and disabled by default, or the plugin should do some caching so that trac serves the picture, not github.
> 

Grains of sand on a beach.  If you're that paranoid about it you can connect through an anonymous VPN and disable tracking cookies which I'm sure you (and I as well) already do.
