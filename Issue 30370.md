# Issue 30370: Replace use of `sage.misc.package.PackageNotFoundError`, is_package_installed by features

archive/issues_030370.json:
```json
{
    "body": "CC:  @kiwifb @seblabbe @jhpalmieri\n\n\n```\n$ git grep sage.misc.package\nsrc/sage/databases/cremona.py:from sage.misc.package import is_package_installed\nsrc/sage/databases/jones.py:from sage.misc.package import PackageNotFoundError\nsrc/sage/doctest/control.py:                    from sage.misc.package import list_packages\nsrc/sage/game_theory/normal_form_game.py:from sage.misc.package import PackageNotFoundError\nsrc/sage/game_theory/normal_form_game.py:            from sage.misc.package import PackageNotFoundError\nsrc/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError\nsrc/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError\nsrc/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError\nsrc/sage/groups/braid.py:from sage.misc.package import PackageNotFoundError\nsrc/sage/interfaces/kash.py:            from sage.misc.package import PackageNotFoundError\nsrc/sage/matrix/matrix_space.py:                    from sage.misc.package import PackageNotFoundError\nsrc/sage/misc/all.py:lazy_import('sage.misc.package', ('installed_packages', 'is_package_installed',\nsrc/sage/rings/polynomial/multi_polynomial_ideal.py:            from sage.misc.package import PackageNotFoundError\nsrc/sage/sat/solvers/cryptominisat.py:            from sage.misc.package import PackageNotFoundError\nsrc/sage/sat/solvers/picosat.py:            from sage.misc.package import PackageNotFoundError\nsrc/sage_setup/optional_extension.py:from sage.misc.package import list_packages\nsrc/sage_setup/optional_extension.py:    from sage.misc.package import is_package_installed\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30607\n\n",
    "created_at": "2020-09-18T20:58:16Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Replace use of `sage.misc.package.PackageNotFoundError`, is_package_installed by features",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30370",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kiwifb @seblabbe @jhpalmieri


```
$ git grep sage.misc.package
src/sage/databases/cremona.py:from sage.misc.package import is_package_installed
src/sage/databases/jones.py:from sage.misc.package import PackageNotFoundError
src/sage/doctest/control.py:                    from sage.misc.package import list_packages
src/sage/game_theory/normal_form_game.py:from sage.misc.package import PackageNotFoundError
src/sage/game_theory/normal_form_game.py:            from sage.misc.package import PackageNotFoundError
src/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError
src/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError
src/sage/graphs/graph.py:                from sage.misc.package import PackageNotFoundError
src/sage/groups/braid.py:from sage.misc.package import PackageNotFoundError
src/sage/interfaces/kash.py:            from sage.misc.package import PackageNotFoundError
src/sage/matrix/matrix_space.py:                    from sage.misc.package import PackageNotFoundError
src/sage/misc/all.py:lazy_import('sage.misc.package', ('installed_packages', 'is_package_installed',
src/sage/rings/polynomial/multi_polynomial_ideal.py:            from sage.misc.package import PackageNotFoundError
src/sage/sat/solvers/cryptominisat.py:            from sage.misc.package import PackageNotFoundError
src/sage/sat/solvers/picosat.py:            from sage.misc.package import PackageNotFoundError
src/sage_setup/optional_extension.py:from sage.misc.package import list_packages
src/sage_setup/optional_extension.py:    from sage.misc.package import is_package_installed
```


Issue created by migration from https://trac.sagemath.org/ticket/30607





---

archive/issue_comments_432680.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-19T21:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432680",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432681.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-19T22:51:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432681",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432682.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-20T01:27:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432682",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_432683.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-23T12:59:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432683",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_432684.json:
```json
{
    "body": "Without the Jones database installed, I confirm the following works:\n\n```\nsage: from sage.features.databases import DatabaseJones                         \nsage: DatabaseJones().is_present()                                              \nFeatureTestResult(\"John Jones's tables of number fields\", False)\nsage: bool(_)                                                                   \nFalse\nsage: DatabaseJones().absolute_path()                                           \nTraceback (most recent call last):\n...\nFeatureNotPresentError: John Jones's tables of number fields is not available.\n'jones/jones.sobj' not found in any of ['/home/slabbe/GitBox/sage/local/share']\nTo install John Jones's tables of number fields you can try to run 'sage -i database_jones_numfield'.\n```\n\n\nAfter doing `sage -i database_jones_numfield`, I confirm the following works:\n\n```\nsage: from sage.features.databases import DatabaseJones                         \nsage: DatabaseJones().is_present()                                              \nFeatureTestResult(\"John Jones's tables of number fields\", True)\nsage: DatabaseJones().absolute_path()                                           \n'/home/slabbe/GitBox/sage/local/share/jones/jones.sobj'\n```\n",
    "created_at": "2020-09-24T08:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432684",
    "user": "https://github.com/seblabbe"
}
```

Without the Jones database installed, I confirm the following works:

```
sage: from sage.features.databases import DatabaseJones                         
sage: DatabaseJones().is_present()                                              
FeatureTestResult("John Jones's tables of number fields", False)
sage: bool(_)                                                                   
False
sage: DatabaseJones().absolute_path()                                           
Traceback (most recent call last):
...
FeatureNotPresentError: John Jones's tables of number fields is not available.
'jones/jones.sobj' not found in any of ['/home/slabbe/GitBox/sage/local/share']
To install John Jones's tables of number fields you can try to run 'sage -i database_jones_numfield'.
```


After doing `sage -i database_jones_numfield`, I confirm the following works:

```
sage: from sage.features.databases import DatabaseJones                         
sage: DatabaseJones().is_present()                                              
FeatureTestResult("John Jones's tables of number fields", True)
sage: DatabaseJones().absolute_path()                                           
'/home/slabbe/GitBox/sage/local/share/jones/jones.sobj'
```




---

archive/issue_comments_432685.json:
```json
{
    "body": "Without lrslib installed, I confirm the following works (error is properly raised):\n\n\n```\nsage: p1 = matrix([[-7, -5, 5],\n....:              [5, 5, 3],\n....:              [1, -6, 1]])\nsage: p2 = matrix([[-9, 7, 9],\n....:              [6, -2, -3],\n....:              [-4, 6, -10]])\nsage: biggame = NormalFormGame([p1, p2])\nsage: biggame._solve_lrs()\nTraceback (most recent call last):\n...\nFileNotFoundError: [Errno 2] No such file or directory: 'lrsnash'\n...\nDuring handling of the above exception, another exception occurred:\n...\nFeatureNotPresentError: lrslib is not available.\nCalling lrsnash failed with [Errno 2] No such file or directory: 'lrsnash'\nTo install lrslib you can try to run 'sage -i lrslib'.\nFurther installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.\n```\n\n\nAnd then, I confirm this works as suggested by the error message:\n\n\n```\nsage: !sage -i lrslib  \n...\nsage: biggame._solve_lrs()                                                      \n[[(0, 1, 0), (1, 0, 0)],\n [(1/3, 2/3, 0), (0, 1/6, 5/6)],\n [(1/3, 2/3, 0), (1/7, 0, 6/7)],\n [(1, 0, 0), (0, 0, 1)]]\n```\n",
    "created_at": "2020-09-24T09:03:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432685",
    "user": "https://github.com/seblabbe"
}
```

Without lrslib installed, I confirm the following works (error is properly raised):


```
sage: p1 = matrix([[-7, -5, 5],
....:              [5, 5, 3],
....:              [1, -6, 1]])
sage: p2 = matrix([[-9, 7, 9],
....:              [6, -2, -3],
....:              [-4, 6, -10]])
sage: biggame = NormalFormGame([p1, p2])
sage: biggame._solve_lrs()
Traceback (most recent call last):
...
FileNotFoundError: [Errno 2] No such file or directory: 'lrsnash'
...
During handling of the above exception, another exception occurred:
...
FeatureNotPresentError: lrslib is not available.
Calling lrsnash failed with [Errno 2] No such file or directory: 'lrsnash'
To install lrslib you can try to run 'sage -i lrslib'.
Further installation instructions might be available at http://cgm.cs.mcgill.ca/~avis/C/lrs.html.
```


And then, I confirm this works as suggested by the error message:


```
sage: !sage -i lrslib  
...
sage: biggame._solve_lrs()                                                      
[[(0, 1, 0), (1, 0, 0)],
 [(1/3, 2/3, 0), (0, 1/6, 5/6)],
 [(1/3, 2/3, 0), (1/7, 0, 6/7)],
 [(1, 0, 0), (0, 0, 1)]]
```




---

archive/issue_comments_432686.json:
```json
{
    "body": "Finally, I confirm the new behavior for `PackageNotFoundError`:\n\n```\nsage: from sage.misc.package import PackageNotFoundError                        \nsage: raise PackageNotFoundError(\"my_package\")                                  \n...\nDeprecationWarning: Instead of raising PackageNotFoundError, raise sage.features.FeatureNotPresentError\nSee https://trac.sagemath.org/30607 for details.\n...\nTraceback (most recent call last):\n...\nPackageNotFoundError: the package 'my_package' was not found. You can install it by running 'sage -i my_package' in a shell\n```\n",
    "created_at": "2020-09-24T09:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432686",
    "user": "https://github.com/seblabbe"
}
```

Finally, I confirm the new behavior for `PackageNotFoundError`:

```
sage: from sage.misc.package import PackageNotFoundError                        
sage: raise PackageNotFoundError("my_package")                                  
...
DeprecationWarning: Instead of raising PackageNotFoundError, raise sage.features.FeatureNotPresentError
See https://trac.sagemath.org/30607 for details.
...
Traceback (most recent call last):
...
PackageNotFoundError: the package 'my_package' was not found. You can install it by running 'sage -i my_package' in a shell
```




---

archive/issue_comments_432687.json:
```json
{
    "body": "`sage -tp --optional=sage,optional,external src/sage/databases/jones.py src/sage/features/__init__.py src/sage/features/databases.py src/sage/game_theory/normal_form_game.py src/sage/misc/package.py --show-skipped` works ok (except one issue already fixed in #30632).\n\nTo me it is a positive review. Let's wait for the patchbot to see if everything is green.",
    "created_at": "2020-09-24T09:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432687",
    "user": "https://github.com/seblabbe"
}
```

`sage -tp --optional=sage,optional,external src/sage/databases/jones.py src/sage/features/__init__.py src/sage/features/databases.py src/sage/game_theory/normal_form_game.py src/sage/misc/package.py --show-skipped` works ok (except one issue already fixed in #30632).

To me it is a positive review. Let's wait for the patchbot to see if everything is green.



---

archive/issue_comments_432688.json:
```json
{
    "body": "I think the pyflakes warning is a flake",
    "created_at": "2020-09-26T14:12:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432688",
    "user": "https://github.com/mkoeppe"
}
```

I think the pyflakes warning is a flake



---

archive/issue_comments_432689.json:
```json
{
    "body": "Sorry for the delay in follow-up, I was busy with other TODOs this week.",
    "created_at": "2020-10-02T10:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432689",
    "user": "https://github.com/seblabbe"
}
```

Sorry for the delay in follow-up, I was busy with other TODOs this week.



---

archive/issue_comments_432690.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-02T10:02:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432690",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_432691.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-10-03T17:29:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432691",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_432692.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-05T20:13:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30370#issuecomment-432692",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_027906.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-05T20:13:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30370",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30370#event-27906"
}
```
