# Issue 17015: bug fix in StrongTableaux.marked_CST_to_transposition_sequence

archive/issues_017015.json:
```json
{
    "body": "CC:  @anneschilling @tscrim\n\nAnne Schilling pointed out the following error in the algorithm to convert a strong marked column strict tableau to a sequence of transpositions:\n\n```\nsage: StrongTableaux.marked_CST_to_transposition_sequence([[-1,-2,-2,-2,-2],[-2,2],[2]],3)\n[[4, 5], [3, 4], [2, 4], [2, 3], [1, 2], [0, 1]]\n```\n\nhowever the answer should be `[[4,5],[3,4],[2,3],[1,2],[-1,0],[0,1]]` and the problem arises because it was never clear in the algorithm for converting a marked column strict tableau into a sequence of transpositions what conditions I need to check to make sure I was applying a valid transposition.  In fact, there was a comment in the code that indicated my worry that one might be able to apply two transpositions and reduce the length by 1.\n\nThis is exactly what happens in this case because if you apply the sequence of transpositions t_{2,4} on t_{3,4} t_{4,5} T then in fact t_{2,4} does reduce the length of shape of the tableau by 1, but there are no cells of content 2 and 3 in the tableau t_{3,4} t_{4,5} T.\n\nIt looks like there are a couple of ways of catching this condition.  It might be sufficient to check that applying the transposition t_{2,4} is not valid (because it really should be applying t_{-2,0} instead).  That fix might or might not be sufficient (and a counterexample will be difficult to identify).  To be more thorough, I will verify that if t_{ij} decreases the length of the core by 1, then the labels of the cells in range(i,j) that are removed include exactly one negative label.\n\nIssue created by migration from https://trac.sagemath.org/ticket/17252\n\n",
    "created_at": "2014-10-29T13:50:34Z",
    "labels": [
        "component: combinatorics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "bug fix in StrongTableaux.marked_CST_to_transposition_sequence",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/17015",
    "user": "https://github.com/zabrocki"
}
```
CC:  @anneschilling @tscrim

Anne Schilling pointed out the following error in the algorithm to convert a strong marked column strict tableau to a sequence of transpositions:

```
sage: StrongTableaux.marked_CST_to_transposition_sequence([[-1,-2,-2,-2,-2],[-2,2],[2]],3)
[[4, 5], [3, 4], [2, 4], [2, 3], [1, 2], [0, 1]]
```

however the answer should be `[[4,5],[3,4],[2,3],[1,2],[-1,0],[0,1]]` and the problem arises because it was never clear in the algorithm for converting a marked column strict tableau into a sequence of transpositions what conditions I need to check to make sure I was applying a valid transposition.  In fact, there was a comment in the code that indicated my worry that one might be able to apply two transpositions and reduce the length by 1.

This is exactly what happens in this case because if you apply the sequence of transpositions t_{2,4} on t_{3,4} t_{4,5} T then in fact t_{2,4} does reduce the length of shape of the tableau by 1, but there are no cells of content 2 and 3 in the tableau t_{3,4} t_{4,5} T.

It looks like there are a couple of ways of catching this condition.  It might be sufficient to check that applying the transposition t_{2,4} is not valid (because it really should be applying t_{-2,0} instead).  That fix might or might not be sufficient (and a counterexample will be difficult to identify).  To be more thorough, I will verify that if t_{ij} decreases the length of the core by 1, then the labels of the cells in range(i,j) that are removed include exactly one negative label.

Issue created by migration from https://trac.sagemath.org/ticket/17252





---

archive/issue_comments_225430.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-10-29T14:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225430",
    "user": "https://github.com/zabrocki"
}
```

New commits:



---

archive/issue_comments_225431.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-10-29T15:03:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225431",
    "user": "https://github.com/zabrocki"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_225432.json:
```json
{
    "body": "More testing shows that checking the conditions in the ribbon is not sufficient.\n\nExample:\nLet\n`T = [[-1, -2, -5, 5, -5, 5, -5], [-3, -4, 5, 5], [5]]`\nif you apply the transposition t_{6,7} to T then the shape will be `[6,3]` leaving\n`[[-1, -2, -5, 5, -5, 5], [-3, -4, 5]]`\nand the marking is in cell (0,6) as hoped\nif you apply the transposition t_{5,7} to T then the shape will be` [5,2,1]` leaving\n`[[-1, -2, -5, 5, -5], [-3, -4], [5]]`\n\nThe markings in both cases are correct, but the right transposition to apply is the t_{5,7}.\n\nThe only way reason why you don't want to apply the t_{6,7} is just because no corner cell of t_{6,7} T has a marking.  But I can only hope that checking this catches all cases.",
    "created_at": "2014-10-29T16:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225432",
    "user": "https://github.com/zabrocki"
}
```

More testing shows that checking the conditions in the ribbon is not sufficient.

Example:
Let
`T = [[-1, -2, -5, 5, -5, 5, -5], [-3, -4, 5, 5], [5]]`
if you apply the transposition t_{6,7} to T then the shape will be `[6,3]` leaving
`[[-1, -2, -5, 5, -5, 5], [-3, -4, 5]]`
and the marking is in cell (0,6) as hoped
if you apply the transposition t_{5,7} to T then the shape will be` [5,2,1]` leaving
`[[-1, -2, -5, 5, -5], [-3, -4], [5]]`

The markings in both cases are correct, but the right transposition to apply is the t_{5,7}.

The only way reason why you don't want to apply the t_{6,7} is just because no corner cell of t_{6,7} T has a marking.  But I can only hope that checking this catches all cases.



---

archive/issue_comments_225433.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-10-29T16:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225433",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_225434.json:
```json
{
    "body": "Testing if one of the corner cells has a mark is not sufficient because it could be that the next ribbon to remove is of shape (1,1) and the marked cell will not be on a corner.\n\nI am coming to the conclusion that the test will need to be recursive.  That is, the transposition sequence begins in t_{ij} if t_{ij} is a removable ribbon and if t_{ij} T has a transposition sequence which reduces it to empty.",
    "created_at": "2014-10-29T17:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225434",
    "user": "https://github.com/zabrocki"
}
```

Testing if one of the corner cells has a mark is not sufficient because it could be that the next ribbon to remove is of shape (1,1) and the marked cell will not be on a corner.

I am coming to the conclusion that the test will need to be recursive.  That is, the transposition sequence begins in t_{ij} if t_{ij} is a removable ribbon and if t_{ij} T has a transposition sequence which reduces it to empty.



---

archive/issue_comments_225435.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-29T19:48:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225435",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225436.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-29T20:29:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225436",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225437.json:
```json
{
    "body": "I've been testing these functions and don't see any obvious change in speed, and this does seem to completely fix the bug.\n\nThe solution that I have posted is to make the function which converts a column strict marked tableau into a sequence of transpositions recursive.  The solution is to say that the transposition sequence which reduces a tableau T of shape \\gamma to empty begins with t_{ij} if the cells of content j is negative -v and the other labels of are v (and this is what was being done before) and t_{ij} T can be reduced to an empty tableau (and this part is new).\n\nI had to add this second condition because it seems that we can't decide if applying t_{ij} to a column strict marked tableau yields a valid column strict marked tableau just by looking it in any obvious way.  Examples need to be pretty large before this bug was triggered.",
    "created_at": "2014-10-29T21:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225437",
    "user": "https://github.com/zabrocki"
}
```

I've been testing these functions and don't see any obvious change in speed, and this does seem to completely fix the bug.

The solution that I have posted is to make the function which converts a column strict marked tableau into a sequence of transpositions recursive.  The solution is to say that the transposition sequence which reduces a tableau T of shape \gamma to empty begins with t_{ij} if the cells of content j is negative -v and the other labels of are v (and this is what was being done before) and t_{ij} T can be reduced to an empty tableau (and this part is new).

I had to add this second condition because it seems that we can't decide if applying t_{ij} to a column strict marked tableau yields a valid column strict marked tableau just by looking it in any obvious way.  Examples need to be pretty large before this bug was triggered.



---

archive/issue_comments_225438.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-10-29T21:04:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225438",
    "user": "https://github.com/zabrocki"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_225439.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-29T21:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225440.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-10-30T05:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225440",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_225441.json:
```json
{
    "body": "Hi Mike,\n\nThanks for the quick fix of this issue! I rebased the branch on top of the latest development version of Sage and will run some more tests.\n\nBest,\n\nAnne",
    "created_at": "2014-10-30T05:21:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225441",
    "user": "https://github.com/anneschilling"
}
```

Hi Mike,

Thanks for the quick fix of this issue! I rebased the branch on top of the latest development version of Sage and will run some more tests.

Best,

Anne



---

archive/issue_comments_225442.json:
```json
{
    "body": "Changing keywords from \"\" to \"tableaux\".",
    "created_at": "2014-10-30T05:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225442",
    "user": "https://github.com/anneschilling"
}
```

Changing keywords from "" to "tableaux".



---

archive/issue_comments_225443.json:
```json
{
    "body": "Looks good now!\n\nAnne",
    "created_at": "2014-10-30T06:09:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225443",
    "user": "https://github.com/anneschilling"
}
```

Looks good now!

Anne



---

archive/issue_comments_225444.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-10-30T06:10:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225444",
    "user": "https://github.com/anneschilling"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_225445.json:
```json
{
    "body": "Thanks for reviewing and finding the bug.\n-Mike",
    "created_at": "2014-10-30T13:21:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225445",
    "user": "https://github.com/zabrocki"
}
```

Thanks for reviewing and finding the bug.
-Mike



---

archive/issue_comments_225446.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-10-30T22:28:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/17015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/17015#issuecomment-225446",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
