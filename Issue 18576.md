# Issue 18576: New decoding structure for linear codes

Issue created by migration from Trac.

Original creator: dlucas

Original creation time: 2015-06-29 12:22:36

CC:  jsrn jpflori vdelecroix defeo cpernet

For now, linear codes don't have a proper structure for decoding, where "decoding" means using an error-correction algorithm to recover the original codeword.

We propose in this ticket a new structure, designed to handle word -> codeword and word -> message transformations.

We provide the following:

    - An abstract class `Decoder`, for inheritances purposes. Every `Decoder` will inherit from this class. It contains:
        - a default constructor;
        - `decode_to_code` and `decode_to_message` default implementation;
        - several methods to get information on the instance of the class and
        - explanations on what to do to create a new decoder subclass. 

    - An exception class `DecodingFailure`, for errors related to decoding algorithms. 

    - Methods for decoding handling in `AbstractLinearCode` (see Design) 

## Design

Decoding depends on the algorithm used to find and correct the errors in a provided word.
For instance, there exists decoding algorithms able to locate and correct up to a certain amount of errors, and will fail if there is more errors than this bound. Some others will return a list of codewords containing the original codeword.
And there also exist probabilistic decoding algorithms, alongside with deterministic ones.
To describe these behaviours, we introduced a list of type, called `_decoder_type` which is a set of keywords describing the decoding algorithm used in the class.

Besides, different decoding algorithms might return different elements, even if they work for the same code family. For instance, with Reed-Solomon codes, key equation decoding returns a vector, while Berlekamp-Welch decoding algorithm returns a polynomial. To keep this behaviour, we added a field `connected_encoder_name`, which contains the name of the encoder used by the decoder when it comes to encode/unencode operations.

We also propose to the user two different decoding methods, `decode_to_code` and `decode_to_message`, the former correcting the errors and returning an element from the code, the latter correcting the errors and returning an element from the message space of its `connected_encoder`. Thanks to a default implementation, reimplmenting both is not needed. One only needs to override one of these two methods in a `Decoder` class, and the default implementation will be used to perform the other one.   

Furthermore, we propose here the exact same structure of registration for decoders as the one we introduced in #18376, namely. We also propose the same default behaviour for codes.
Each code will have a `default_encoder`, so if one does not want to be bothered by multiple decoding algorithm when he just wants to decode a word `y` for his code `C`, all he has to do is to write `C.decode_to_code(y)`, and the default decoder will be used to correct the errors in `y`.

With this structure, we are able to represent different decoding algorithms for each code, even if they have different behaviour. We also have a versatile structure which allows specific experimentation on chosen decoding algorithms alongside with generic decodings in which the algorithm does not matter.


## Note

This ticket relies on the encoding structure proposed on trac #18376, as every decoder has to be linked with an encoder.


---

Comment by dlucas created at 2015-06-29 12:33:00

Changing status from new to needs_review.


---

Comment by dlucas created at 2015-06-29 12:33:00

New commits:


---

Comment by git created at 2015-09-02 08:10:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-09-09 14:58:00

I modified this tickets accordingly with reviewer's remarks in #18376, as these two are quite symmetrical. It's still ready for review.


---

Comment by git created at 2015-10-16 08:44:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-10-16 08:47:17

I merged with latest beta and resolved conflicts.
I also updated some things accordingly with what was said in #18376, fixed a typo in encoder and added forgotten GPL licence blocks in `encoders_catalog` and `decoders_catalog`.

Still pending for review.


---

Comment by git created at 2015-10-23 08:22:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-10-23 08:24:21

I fixed a few things patchbot was complaining about. It'll probably continue to complain on coverage but I don't see the point of adding doctests on a deprecated function so if the reviewer agrees I'm going to ignore this warning. 
This is still pending for review.


---

Comment by git created at 2015-11-08 23:58:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-08 23:59:33

I updated to latest beta and fixed the conflicts that arose after that merge. It's ready for review again.


---

Comment by git created at 2015-11-09 15:35:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-09 15:37:29

`linear_code` module is now lazily imported in `sd_codes`, so `decoder` is no longer available in global namespace.


---

Comment by cpernet created at 2015-11-24 12:59:32

The semantic of the field: `input_space` of a decoder is unclear.
It seems to me that it should corresponds to the ambient space of the associated code, and it is implemented this way line 246 of decoder.py or line 4028 of linear_code.py. 
But line 75 of decoder.py, it is set to `code.base_field()`.

Also a clear definition of what this field means should be added somewhere.


---

Comment by cpernet created at 2015-11-24 13:18:33

In the current state, the output of the hash function does not depend on the code, but only on its dimensions. (changing some coeffcients in the generating matrix G line 107 of decoder.py does not change the hash of the linear code and therefore does not change the hash of the decoder neither.

This remark is just to point out this inconsistency: either add a __hash__ in encoder and in linear_code or remove the hash here.


---

Comment by cpernet created at 2015-11-24 16:08:38

line 183 of decoder.py: `decode_to_message` decodes `r` to the message space of self's **connected_encoder** (not **code**)


---

Comment by cpernet created at 2015-11-25 09:32:37

Overriding method `decoding_radius` is optional, but documentation (line 41 of decoder.py) says it is required.


---

Comment by git created at 2015-11-25 10:33:59

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-25 10:36:48

I added a clear definition of `input_space` in the constructor of `Decoder` in `decoder.py`, fixed the errors you noticed and added a hash function to `LinearCode`, with an extra doctest which check if the bug you found is fixed (see ll 3908-3911 in `linear_code.py`).


---

Comment by cpernet created at 2015-11-25 13:36:21

linear_code.py : lines 878 and 883 are redundant.


---

Comment by cpernet created at 2015-11-25 14:12:32

minor spelling corrections in linear_code.py
- filling -> filling in 4 occurences 
- an -> a lines 829 and 824
- lines 1613 and 1639: remove "test"


---

Comment by cpernet created at 2015-11-25 14:32:33

line 3904 of linear_code.py: differs -> differ

In the same __hash__ method: the XOR of hash(Str) twice is equivalent to applying the identity. One of them should be removed or replaced by hash(G) maybe. not sure to understand the motivation behind doing this XOR. hash((G,Str)) should do the job.


---

Comment by dlucas created at 2015-11-25 14:46:21

"XORing" hash(Str) twice is a mistake, it should (and will) be `[...] ^ hash(G) ^ hash(Str)`.

Regarding the motivation behing the xor, I did as advised in [Python doc](https://docs.python.org/2.7/reference/datamodel.html#object.__hash__) crossed with this useful (imho) question on [stack overflow](http://stackoverflow.com/questions/2909106/python-whats-a-correct-and-good-way-to-implement-hash)

>it is advised to somehow mix together (e.g. using exclusive or) the hash values for the components of the object that also play a part in comparison of objects.


---

Comment by cpernet created at 2015-11-25 15:23:21

I'm confused by the syndrome method.
It really looks to me as a "NearestNeighbor" decoding, not as syndrome decoding.

Syndrome decoding means (following Roth's Book)
1/ compute the syndrome s=Hy  where H is the parity check matrix
2/ Among the coset of vectors sharing the same syndrome, return the coset leader, with minimal Hamming weight

I don't see any parity check matrix here, and the output is simply the leader of the coset of **all** r+C vectors.

+ fix the docstring "Returns the all ..."


---

Comment by dlucas created at 2015-11-25 15:28:30

I definitely agree. But these methods were written before me, and all I did here was to make them fit in the new structure.
Writing a true (and efficient) syndrome decoder is of course on the map, as a short term goal, but I think it does not belong to this ticket.


---

Comment by cpernet created at 2015-11-25 16:01:05

decoder.py line 184: connectoed -> connected


---

Comment by git created at 2015-11-25 16:01:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-25 16:03:15

Last push fixes all your comments but the last one. I wait for the (potential) other remarks before writing another patch :)


---

Comment by git created at 2015-11-25 16:05:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-25 16:05:56

As you just told me it was ok, here's the fix for the typo you noticed.


---

Comment by git created at 2015-11-25 16:09:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cpernet created at 2015-11-25 16:12:41

All my remarks have been addressed.
I'm giving this ticket a positive review.


---

Comment by cpernet created at 2015-11-25 16:12:41

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-11-25 20:18:25

Merge conflict, possibly with #16080


---

Comment by vbraun created at 2015-11-25 20:18:25

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-11-26 13:29:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by dlucas created at 2015-11-26 13:30:40

Changing status from needs_work to needs_review.


---

Comment by dlucas created at 2015-11-26 13:30:40

I merged in #16080 and fixed the conflict in `linear_code.py`.
This should do the trick!


---

Comment by cpernet created at 2015-11-26 14:27:46

This merge works for me.
Positive review.


---

Comment by cpernet created at 2015-11-26 14:27:46

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-11-26 18:23:50

Resolution: fixed
