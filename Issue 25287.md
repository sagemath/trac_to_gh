# Issue 25287: clean univariate Laurent polynomials

archive/issues_025287.json:
```json
{
    "body": "CC:  tscrim vklein\n\n1. faster creation of new Laurent polynomial via a `cdef _new_c` method\n2. Make rich comparison compatible with polynomials\n3. make Laurent polynomial complient with coercion for `/` so that the result is always a rational fration.\n4. allow construction of Laurent polynomial from rational fraction\n\nAs a consequence of 2 and 3, many doctests had to be corrected in `sage/algebras/`.\n\nIssue created by migration from https://trac.sagemath.org/ticket/25524\n\n",
    "created_at": "2018-06-07T07:23:48Z",
    "labels": [
        "basic arithmetic",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.3",
    "title": "clean univariate Laurent polynomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/25287",
    "user": "vdelecroix"
}
```
CC:  tscrim vklein

1. faster creation of new Laurent polynomial via a `cdef _new_c` method
2. Make rich comparison compatible with polynomials
3. make Laurent polynomial complient with coercion for `/` so that the result is always a rational fration.
4. allow construction of Laurent polynomial from rational fraction

As a consequence of 2 and 3, many doctests had to be corrected in `sage/algebras/`.

Issue created by migration from https://trac.sagemath.org/ticket/25524





---

archive/issue_comments_356467.json:
```json
{
    "body": "New commits:",
    "created_at": "2018-06-07T07:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356467",
    "user": "vdelecroix"
}
```

New commits:



---

archive/issue_comments_356468.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-06-07T07:24:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356468",
    "user": "vdelecroix"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_356469.json:
```json
{
    "body": "I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial. IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.\n\nI would also appreciate it if you could put back in the linebreaks on the long outputs.\n\nThe `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use\n\n```sage\ncdef type t = type(self)\ncdef LaurentPolynomial_univariate p = t.__new__(t)\n```\n\nfollowing `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.",
    "created_at": "2018-06-07T09:32:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356469",
    "user": "tscrim"
}
```

I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial. IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.

I would also appreciate it if you could put back in the linebreaks on the long outputs.

The `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use

```sage
cdef type t = type(self)
cdef LaurentPolynomial_univariate p = t.__new__(t)
```

following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.



---

archive/issue_comments_356470.json:
```json
{
    "body": "Replying to [comment:2 tscrim]:\n> I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.\n\nPeople are familiar with integers and\n\n```\nsage: parent(1 / 1)\nRational Field\n```\n\nHere `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and\n\n```\nsage: R = QQ['x']\nsage: parent(R.one() / R.one())\nFraction Field of Univariate Polynomial Ring in x over Rational Field\n```\n\nStill `R.one() / R.one()` looks like an integer.\n\n> IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.\n\nI am willing to ask on sage-devel as the current situation is a bug with respect to\n\n    The parent of `a / b` should only depend on the parent of `a` and `b`.\n\nI can imagine two alternatives\n1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.\n2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.\n\n> I would also appreciate it if you could put back in the linebreaks on the long outputs.\n\nThis I can do. The changes in output look ok? They seem to come from the change in ordering for Laurent polynomials.\n\n> The `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use\n> {{{#!sage\n> cdef type t = type(self)\n> cdef LaurentPolynomial_univariate p = t.__new__(t)\n> }}}\n> following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.\n\nI have to investigate how Cython is optimizing this.",
    "created_at": "2018-06-07T10:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356470",
    "user": "vdelecroix"
}
```

Replying to [comment:2 tscrim]:
> I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.

People are familiar with integers and

```
sage: parent(1 / 1)
Rational Field
```

Here `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and

```
sage: R = QQ['x']
sage: parent(R.one() / R.one())
Fraction Field of Univariate Polynomial Ring in x over Rational Field
```

Still `R.one() / R.one()` looks like an integer.

> IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.

I am willing to ask on sage-devel as the current situation is a bug with respect to

    The parent of `a / b` should only depend on the parent of `a` and `b`.

I can imagine two alternatives
1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.
2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.

> I would also appreciate it if you could put back in the linebreaks on the long outputs.

This I can do. The changes in output look ok? They seem to come from the change in ordering for Laurent polynomials.

> The `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use
> {{{#!sage
> cdef type t = type(self)
> cdef LaurentPolynomial_univariate p = t.__new__(t)
> }}}
> following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.

I have to investigate how Cython is optimizing this.



---

archive/issue_comments_356471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2018-06-07T15:55:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_356472.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-06-07T16:04:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356472",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_356473.json:
```json
{
    "body": "Note also that `//` does the job\n\n```\nsage: L.<q> = LaurentPolynomialRing(QQ)\nsage: 1 // q\nq^-1\nsage: parent(_)\nUnivariate Laurent Polynomial Ring in q over Rational Field\n```\n",
    "created_at": "2018-06-07T16:05:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356473",
    "user": "vdelecroix"
}
```

Note also that `//` does the job

```
sage: L.<q> = LaurentPolynomialRing(QQ)
sage: 1 // q
q^-1
sage: parent(_)
Univariate Laurent Polynomial Ring in q over Rational Field
```




---

archive/issue_comments_356474.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> Replying to [comment:2 tscrim]:\n> > I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.\n> \n> People are familiar with integers and\n> {{{\n> sage: parent(1 / 1)\n> Rational Field\n> }}}\n> Here `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and\n> {{{\n> sage: R = QQ['x']\n> sage: parent(R.one() / R.one())\n> Fraction Field of Univariate Polynomial Ring in x over Rational Field\n> }}}\n> Still `R.one() / R.one()` looks like an integer.\n\nThe problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)\n\n> > IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.\n> \n> I am willing to ask on sage-devel as the current situation is a bug with respect to\n> \n>     The parent of `a / b` should only depend on the parent of `a` and `b`.\n> \n> I can imagine two alternatives\n> 1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.\n\nThat is not what I am proposing. I am proposing keeping the current behavior: a special case for monomials in a Laurent polynomial ring.\n\n> 2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.\n> \n> > I would also appreciate it if you could put back in the linebreaks on the long outputs.\n> \n> This I can do. The changes in output look ok? They seem to come from the change in ordering for Laurent polynomials.\n\nThank you. Yes, I do as they are behaving the same as polynomials, in particular, `-x < 0` is now consistent. (IMO, having something like `X + (-q^2)*Y` is a bit ugly, but that is a separate issue.)\n\n> > The `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use\n> > {{{#!sage\n> > cdef type t = type(self)\n> > cdef LaurentPolynomial_univariate p = t.__new__(t)\n> > }}}\n> > following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.\n> \n> I have to investigate how Cython is optimizing this.\n\nI think this is a serious issue that needs to be addressed:\n\n```sage\nsage: from sage.rings.polynomial.laurent_polynomial import LaurentPolynomial_univariate\nsage: class Foo(Parent):\n....:     def __init__(self):\n....:         Parent.__init__(self, base=QQ, category=Rings())\n....:         self._assign_names('x')\n....:     def an_element(self):\n....:         return self.element_class(self, [3], -3)\n....:     def polynomial_ring(self):\n....:         return PolynomialRing(QQ, 'x')\n....:     def fraction_field(self):\n....:         return self.polynomial_ring().fraction_field()\n....:     class Element(LaurentPolynomial_univariate):\n....:         pass\n....:     \nsage: F = Foo()\nsage: x = F.an_element(); x\n3*x^-3\nsage: type(x)\n<class '__main__.Foo_with_category.element_class'>\nsage: x.inverse_of_unit()\n1/3*x^3\nsage: type(x.inverse_of_unit())\n<type 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate'>\n```\n",
    "created_at": "2018-06-08T02:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356474",
    "user": "tscrim"
}
```

Replying to [comment:3 vdelecroix]:
> Replying to [comment:2 tscrim]:
> > I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.
> 
> People are familiar with integers and
> {{{
> sage: parent(1 / 1)
> Rational Field
> }}}
> Here `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and
> {{{
> sage: R = QQ['x']
> sage: parent(R.one() / R.one())
> Fraction Field of Univariate Polynomial Ring in x over Rational Field
> }}}
> Still `R.one() / R.one()` looks like an integer.

The problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)

> > IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.
> 
> I am willing to ask on sage-devel as the current situation is a bug with respect to
> 
>     The parent of `a / b` should only depend on the parent of `a` and `b`.
> 
> I can imagine two alternatives
> 1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.

That is not what I am proposing. I am proposing keeping the current behavior: a special case for monomials in a Laurent polynomial ring.

> 2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.
> 
> > I would also appreciate it if you could put back in the linebreaks on the long outputs.
> 
> This I can do. The changes in output look ok? They seem to come from the change in ordering for Laurent polynomials.

Thank you. Yes, I do as they are behaving the same as polynomials, in particular, `-x < 0` is now consistent. (IMO, having something like `X + (-q^2)*Y` is a bit ugly, but that is a separate issue.)

> > The `_new_c` also does not mitigate the subclass issue. In fact, it makes it worse if I want to do a Python subclass as I now have no way to override `_new_c` used in those other methods. I would instead use
> > {{{#!sage
> > cdef type t = type(self)
> > cdef LaurentPolynomial_univariate p = t.__new__(t)
> > }}}
> > following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.
> 
> I have to investigate how Cython is optimizing this.

I think this is a serious issue that needs to be addressed:

```sage
sage: from sage.rings.polynomial.laurent_polynomial import LaurentPolynomial_univariate
sage: class Foo(Parent):
....:     def __init__(self):
....:         Parent.__init__(self, base=QQ, category=Rings())
....:         self._assign_names('x')
....:     def an_element(self):
....:         return self.element_class(self, [3], -3)
....:     def polynomial_ring(self):
....:         return PolynomialRing(QQ, 'x')
....:     def fraction_field(self):
....:         return self.polynomial_ring().fraction_field()
....:     class Element(LaurentPolynomial_univariate):
....:         pass
....:     
sage: F = Foo()
sage: x = F.an_element(); x
3*x^-3
sage: type(x)
<class '__main__.Foo_with_category.element_class'>
sage: x.inverse_of_unit()
1/3*x^3
sage: type(x.inverse_of_unit())
<type 'sage.rings.polynomial.laurent_polynomial.LaurentPolynomial_univariate'>
```




---

archive/issue_comments_356475.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-06-08T02:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356475",
    "user": "tscrim"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_356476.json:
```json
{
    "body": "Replying to [comment:7 tscrim]:\n> Replying to [comment:3 vdelecroix]:\n> > Replying to [comment:2 tscrim]:\n> > > I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.\n> > \n> > People are familiar with integers and\n> > {{{\n> > sage: parent(1 / 1)\n> > Rational Field\n> > }}}\n> > Here `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and\n> > {{{\n> > sage: R = QQ['x']\n> > sage: parent(R.one() / R.one())\n> > Fraction Field of Univariate Polynomial Ring in x over Rational Field\n> > }}}\n> > Still `R.one() / R.one()` looks like an integer.\n> \n> The problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)\n\nDucktyping is dangerous\n\n```\nsage: 3.is_unit()\nFalse\nsage: (3/1).is_unit()\nTrue\n```\n\n\nMoreover, having Laurent polynomials behaving in a different way that any other element in Sage is not helping users. They would better learn that `a / b` has a parent that only depends on `parent(a)` and `parent(b)` and not parent by parent special cases.\n \n> > > IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.\n> > \n> > I am willing to ask on sage-devel as the current situation is a bug with respect to\n> > \n> >     The parent of `a / b` should only depend on the parent of `a` and `b`.\n> > \n> > I can imagine two alternatives\n> > 1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.\n> \n> That is not what I am proposing. I am proposing keeping the current behavior: a special case for monomials in a Laurent polynomial ring.\n\nThis is the worse thing ever. If I write\n\n```\ndef my_function(a, b):\n    c = a / b\n    ... # furter work with c\n```\n\nthen depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.\n\n> > 2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.\n\nDiscussion at: https://groups.google.com/forum/#!topic/sage-devel/48F1MBo-rEc",
    "created_at": "2018-06-08T16:57:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356476",
    "user": "vdelecroix"
}
```

Replying to [comment:7 tscrim]:
> Replying to [comment:3 vdelecroix]:
> > Replying to [comment:2 tscrim]:
> > > I disagree with `1/x` not being a Laurent polynomial (and I think by extension `~x`). This is far too common for people to do and then have to deal with rational functions for something that looks like a Laurent polynomial.
> > 
> > People are familiar with integers and
> > {{{
> > sage: parent(1 / 1)
> > Rational Field
> > }}}
> > Here `1 / 1` looks like an integer. Also people are more familiar with polynomials rather than Laurent polynomials and
> > {{{
> > sage: R = QQ['x']
> > sage: parent(R.one() / R.one())
> > Fraction Field of Univariate Polynomial Ring in x over Rational Field
> > }}}
> > Still `R.one() / R.one()` looks like an integer.
> 
> The problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)

Ducktyping is dangerous

```
sage: 3.is_unit()
False
sage: (3/1).is_unit()
True
```


Moreover, having Laurent polynomials behaving in a different way that any other element in Sage is not helping users. They would better learn that `a / b` has a parent that only depends on `parent(a)` and `parent(b)` and not parent by parent special cases.
 
> > > IIRC, there were some sage-devel discussions on this. If you do want to make this change, then you need to ask on sage-devel.
> > 
> > I am willing to ask on sage-devel as the current situation is a bug with respect to
> > 
> >     The parent of `a / b` should only depend on the parent of `a` and `b`.
> > 
> > I can imagine two alternatives
> > 1. Allow `a / b` only when `b` is invertible which is what you seem to suggest. As a consequence `1 / (1 + q)` will raise an error and one would have to explicitely convert to the fraction field to make it work.
> 
> That is not what I am proposing. I am proposing keeping the current behavior: a special case for monomials in a Laurent polynomial ring.

This is the worse thing ever. If I write

```
def my_function(a, b):
    c = a / b
    ... # furter work with c
```

then depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.

> > 2. Make `a / b` always return a rational fraction. This is the behavior of all parents in Sage (or at least integers and polynomials). This is also what I proposed in the current branch.

Discussion at: https://groups.google.com/forum/#!topic/sage-devel/48F1MBo-rEc



---

archive/issue_comments_356477.json:
```json
{
    "body": "This is a good argument:\n\nReplying to [comment:9 vdelecroix]:\n> This is the worse thing ever. If I write\n> {{{\n> def my_function(a, b):\n>     c = a / b\n>     ... # furter work with c\n> }}}\n> then depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.",
    "created_at": "2018-06-08T18:35:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356477",
    "user": "jdemeyer"
}
```

This is a good argument:

Replying to [comment:9 vdelecroix]:
> This is the worse thing ever. If I write
> {{{
> def my_function(a, b):
>     c = a / b
>     ... # furter work with c
> }}}
> then depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.



---

archive/issue_comments_356478.json:
```json
{
    "body": "Replying to [comment:3 vdelecroix]:\n> Replying to [comment:2 tscrim]:\n> > {{{#!sage\n> > cdef type t = type(self)\n> > cdef LaurentPolynomial_univariate p = t.__new__(t)\n> > }}}\n> > following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.\n> \n> I have to investigate how Cython is optimizing this.\n\nCython deals with this quite well. It optimizes both `type(self)` and `t.__new__(t)`.",
    "created_at": "2018-06-08T18:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356478",
    "user": "jdemeyer"
}
```

Replying to [comment:3 vdelecroix]:
> Replying to [comment:2 tscrim]:
> > {{{#!sage
> > cdef type t = type(self)
> > cdef LaurentPolynomial_univariate p = t.__new__(t)
> > }}}
> > following `sage.groups.perm_gps.permgroup_element.PermutationGroupElement._new_c`.
> 
> I have to investigate how Cython is optimizing this.

Cython deals with this quite well. It optimizes both `type(self)` and `t.__new__(t)`.



---

archive/issue_comments_356479.json:
```json
{
    "body": "Replying to [comment:10 jdemeyer]:\n> This is a good argument:\n> \n> Replying to [comment:9 vdelecroix]:\n> > This is the worse thing ever. If I write\n> > {{{\n> > def my_function(a, b):\n> >     c = a / b\n> >     ... # furter work with c\n> > }}}\n> > then depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.\n\nHowever, that *should* break if `b` is not a monomial and you are expecting a Laurent polynomial for `c`. If you know that `c` generically should be a Laurent polynomial, even when `b` is not a monomial, then you should be using `//` anyways. So I don't think this is a good reason.\n\nAddendum - Upon re-reading this, I realized that such code should be using `//`, even when `b` is a monomial. However, I think it makes the code harder to debug (see comment:13 below).",
    "created_at": "2018-06-09T02:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356479",
    "user": "tscrim"
}
```

Replying to [comment:10 jdemeyer]:
> This is a good argument:
> 
> Replying to [comment:9 vdelecroix]:
> > This is the worse thing ever. If I write
> > {{{
> > def my_function(a, b):
> >     c = a / b
> >     ... # furter work with c
> > }}}
> > then depending on whether `b` is a monomial or not I will end up with different objects for `c`. It is much safer to have predictible output.

However, that *should* break if `b` is not a monomial and you are expecting a Laurent polynomial for `c`. If you know that `c` generically should be a Laurent polynomial, even when `b` is not a monomial, then you should be using `//` anyways. So I don't think this is a good reason.

Addendum - Upon re-reading this, I realized that such code should be using `//`, even when `b` is a monomial. However, I think it makes the code harder to debug (see comment:13 below).



---

archive/issue_comments_356480.json:
```json
{
    "body": "Replying to [comment:9 vdelecroix]:\n> Replying to [comment:7 tscrim]:\n> > The problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)\n> \n> Ducktyping is dangerous\n> {{{\n> sage: 3.is_unit()\n> False\n> sage: (3/1).is_unit()\n> True\n> }}}\n\nThat is misleading IMO because it is asking two different questions because of the parent. However, I agree that ducktyping for everything does not work, but for most cases, it is fine (e.g., `range(4/2)`).\n\n> Moreover, having Laurent polynomials behaving in a different way that any other element in Sage is not helping users. They would better learn that `a / b` has a parent that only depends on `parent(a)` and `parent(b)` and not parent by parent special cases.\n\nI agree that this is a good general principle, but having such a hard rule will likely turn users away because of the unexpected behaviors. It also forces people to write code that will have logic bugs that are harder to find and detect than errors that will be raised during computations.",
    "created_at": "2018-06-09T02:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356480",
    "user": "tscrim"
}
```

Replying to [comment:9 vdelecroix]:
> Replying to [comment:7 tscrim]:
> > The problem with this argument is methods. Elements of `ZZ` and `QQ` have nearly identical methods so ducktyping will work between the two. However, this is a very different story for (Laurent) polynomials versus rational functions, in part because the latter is very generic. (I think part of the reason why we use the fraction field of the polynomial ring is so there is less ambiguity with things like 1/x versus x<sup>-1</sup>.)
> 
> Ducktyping is dangerous
> {{{
> sage: 3.is_unit()
> False
> sage: (3/1).is_unit()
> True
> }}}

That is misleading IMO because it is asking two different questions because of the parent. However, I agree that ducktyping for everything does not work, but for most cases, it is fine (e.g., `range(4/2)`).

> Moreover, having Laurent polynomials behaving in a different way that any other element in Sage is not helping users. They would better learn that `a / b` has a parent that only depends on `parent(a)` and `parent(b)` and not parent by parent special cases.

I agree that this is a good general principle, but having such a hard rule will likely turn users away because of the unexpected behaviors. It also forces people to write code that will have logic bugs that are harder to find and detect than errors that will be raised during computations.



---

archive/issue_comments_356481.json:
```json
{
    "body": "merge failures because of #25737",
    "created_at": "2018-08-07T20:14:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/25287",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/25287#issuecomment-356481",
    "user": "vdelecroix"
}
```

merge failures because of #25737
