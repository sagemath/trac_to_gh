# Issue 21345: PARI: use PROT_NONE for unused virtual stack memory

archive/issues_021345.json:
```json
{
    "body": "CC:  bober leif\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/21582\n\n",
    "created_at": "2016-09-23T21:18:00Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "PARI: use PROT_NONE for unused virtual stack memory",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21345",
    "user": "jdemeyer"
}
```
CC:  bober leif



Issue created by migration from https://trac.sagemath.org/ticket/21582





---

archive/issue_comments_296170.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-23T21:29:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296170",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296171.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-24T06:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296171",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-09-24T06:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296172",
    "user": "jdemeyer"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_296173.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2016-09-24T10:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296173",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_296174.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-09-25T19:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296174",
    "user": "bober"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_296175.json:
```json
{
    "body": "Looks good to me. make ptest gives a few unrelated doctest failures that seem to be completely unrelated (and also occur on other branches).\n\nThe memory commit accounting works as expected for me; an immediate test is that I can test and build the documentation in parallel, while I couldn't before. Another test is that I can get parisizemax in my gprc and watch the committed memory go up and then down during a significant computation.\n\nAlso, it is at least not completely broken on OS X: https://groups.google.com/d/msg/sage-devel/rw4h229qZbk/oxeKCX-kBgAJ\n\n\nI just want to add that I don't really like that this seems to be relying on undocumented (as far as I can tell) low level memory management features, though it is behavior that seems to be used by other libraries that have interesting memory management strategies, such as openJDK and jemalloc. So be it.",
    "created_at": "2016-09-25T19:44:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296175",
    "user": "bober"
}
```

Looks good to me. make ptest gives a few unrelated doctest failures that seem to be completely unrelated (and also occur on other branches).

The memory commit accounting works as expected for me; an immediate test is that I can test and build the documentation in parallel, while I couldn't before. Another test is that I can get parisizemax in my gprc and watch the committed memory go up and then down during a significant computation.

Also, it is at least not completely broken on OS X: https://groups.google.com/d/msg/sage-devel/rw4h229qZbk/oxeKCX-kBgAJ


I just want to add that I don't really like that this seems to be relying on undocumented (as far as I can tell) low level memory management features, though it is behavior that seems to be used by other libraries that have interesting memory management strategies, such as openJDK and jemalloc. So be it.



---

archive/issue_comments_296176.json:
```json
{
    "body": "Replying to [comment:11 bober]:\n> I just want to add that I don't really like that this seems to be relying on undocumented (as far as I can tell) low level memory management features, though it is behavior that seems to be used by other libraries that have interesting memory management strategies, such as openJDK and jemalloc. So be it.\n\nIndeed. It seems to be a more-or-less known trick, but it's not officially documented.",
    "created_at": "2016-09-26T13:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296176",
    "user": "jdemeyer"
}
```

Replying to [comment:11 bober]:
> I just want to add that I don't really like that this seems to be relying on undocumented (as far as I can tell) low level memory management features, though it is behavior that seems to be used by other libraries that have interesting memory management strategies, such as openJDK and jemalloc. So be it.

Indeed. It seems to be a more-or-less known trick, but it's not officially documented.



---

archive/issue_comments_296177.json:
```json
{
    "body": "Thanks for the review by the way!",
    "created_at": "2016-09-26T13:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296177",
    "user": "jdemeyer"
}
```

Thanks for the review by the way!



---

archive/issue_comments_296178.json:
```json
{
    "body": "Thank you for fixing problems that might only affect me!",
    "created_at": "2016-09-28T01:55:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296178",
    "user": "bober"
}
```

Thank you for fixing problems that might only affect me!



---

archive/issue_comments_296179.json:
```json
{
    "body": "Curious as to whether I'll get a notification when this gets merged...",
    "created_at": "2016-10-02T12:59:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296179",
    "user": "leif"
}
```

Curious as to whether I'll get a notification when this gets merged...



---

archive/issue_comments_296180.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-10-20T06:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296180",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_296181.json:
```json
{
    "body": "See patchbot",
    "created_at": "2016-10-20T06:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296181",
    "user": "vbraun"
}
```

See patchbot



---

archive/issue_comments_296182.json:
```json
{
    "body": "The reason is that several tickets bump the PARI version number.\n\n#21622 has an explicit instruction to merge it together with #21582 (this ticket). That did not happen.\n\nInstead, please merge this together with #21637, which also includes a PARI version bump.",
    "created_at": "2016-10-20T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296182",
    "user": "jdemeyer"
}
```

The reason is that several tickets bump the PARI version number.

#21622 has an explicit instruction to merge it together with #21582 (this ticket). That did not happen.

Instead, please merge this together with #21637, which also includes a PARI version bump.



---

archive/issue_comments_296183.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-10-20T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296183",
    "user": "jdemeyer"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_296184.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-10-21T07:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296184",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_296185.json:
```json
{
    "body": "Jeroen, do you know what the status is upstream? The thread do not point to a final commit.",
    "created_at": "2016-10-21T08:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296185",
    "user": "fbissey"
}
```

Jeroen, do you know what the status is upstream? The thread do not point to a final commit.



---

archive/issue_comments_296186.json:
```json
{
    "body": "It's still being discussed on pari-dev (the mailing list website tracks messages per month, so you need to look at october 2016): http://pari.math.u-bordeaux.fr/archives/pari-dev-1610/msg00015.html",
    "created_at": "2016-10-21T08:49:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296186",
    "user": "jdemeyer"
}
```

It's still being discussed on pari-dev (the mailing list website tracks messages per month, so you need to look at october 2016): http://pari.math.u-bordeaux.fr/archives/pari-dev-1610/msg00015.html



---

archive/issue_comments_296187.json:
```json
{
    "body": "Note that this patch really only matters in very specific cases. So it won't matter much if you don't apply it for sage-on-gentoo.",
    "created_at": "2016-10-21T08:50:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296187",
    "user": "jdemeyer"
}
```

Note that this patch really only matters in very specific cases. So it won't matter much if you don't apply it for sage-on-gentoo.



---

archive/issue_comments_296188.json:
```json
{
    "body": "Thanks for the info, saves me some work. It will give a doctest failure though.",
    "created_at": "2016-10-21T08:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296188",
    "user": "fbissey"
}
```

Thanks for the info, saves me some work. It will give a doctest failure though.



---

archive/issue_comments_296189.json:
```json
{
    "body": "Replying to [comment:24 fbissey]:\n> It will give a doctest failure though.\n\nTrue, but that might be easily fixed with a minor adjustment to my patch.",
    "created_at": "2016-10-21T09:04:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21345",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21345#issuecomment-296189",
    "user": "jdemeyer"
}
```

Replying to [comment:24 fbissey]:
> It will give a doctest failure though.

True, but that might be easily fixed with a minor adjustment to my patch.
