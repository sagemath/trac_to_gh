# Issue 15781: Symmetric group conjugacy class iterator

archive/issues_015781.json:
```json
{
    "body": "Assignee: Vincent Delecroix\n\nCC:  amri\n\nKeywords: symmetric group, permutations, iterator\n\nUsing the underlying GAP commands it takes forever to iterate over conjugacy classes of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16018\n\n",
    "created_at": "2014-03-26T20:55:18Z",
    "labels": [
        "combinatorics",
        "major",
        "enhancement"
    ],
    "title": "Symmetric group conjugacy class iterator",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/15781",
    "user": "vdelecroix"
}
```
Assignee: Vincent Delecroix

CC:  amri

Keywords: symmetric group, permutations, iterator

Using the underlying GAP commands it takes forever to iterate over conjugacy classes of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.

Issue created by migration from https://trac.sagemath.org/ticket/16018





---

archive/issue_comments_204621.json:
```json
{
    "body": "I iterate over partitions `l` of `n` and construct a permutation representative by\n\n(1,2, ... l<sub>1</sub>) (l<sub>1</sub>+1, ... l<sub>1</sub>+l<sub>2</sub>) ... (l<sub>1</sub>+...+l<sub>k-1</sub>, .. n)\n\nwhere `k` is the length of `l`. Here's my timings:\n\n```\nsage: S = SymmetricGroup(5)\nsage: %timeit S.conjugacy_classes_representatives()\n100 loops, best of 3: 2.08 ms per loop\nsage: S = SymmetricGroup(12)\nsage: %timeit S.conjugacy_classes_representatives()\n10 loops, best of 3: 29.5 ms per loop\nsage: S = SymmetricGroup(25)\nsage: %timeit S.conjugacy_classes_representatives()\n1 loops, best of 3: 1.06 s per loop\n\nsage: S = SymmetricGroup(5)\nsage: %timeit S.conjugacy_classes()\n10 loops, best of 3: 99.3 ms per loop\nsage: S = SymmetricGroup(12)\nsage: %timeit S.conjugacy_classes()\n1 loops, best of 3: 1.1 s per loop\n```\n\nWithout my branch:\n\n```\nsage: S = SymmetricGroup(5)\nsage: %timeit S.conjugacy_classes_representatives()\n1 loops, best of 3: 55.8 ms per loop\nsage: S = SymmetricGroup(12)\nsage: %timeit S.conjugacy_classes_representatives()\n1 loops, best of 3: 565 ms per loop\nsage: S = SymmetricGroup(25)\nsage: %timeit S.conjugacy_classes_representatives()\n1 loops, best of 3: 14.5 s per loop\n\nsage: S = SymmetricGroup(5)\nsage: %timeit S.conjugacy_classes()\n10 loops, best of 3: 115 ms per loop\nsage: S = SymmetricGroup(12)\nsage: %timeit S.conjugacy_classes()\n1 loops, best of 3: 1.23 s per loop\n```\n\nSo we get about 14x-20x speedup in the representative function, but surprisingly, minimal gain in listing all conjugacy classes. Anyways, I think this is an improvement. I've also added a specific iterator method for the conjugacy classes.\n----\nNew commits:",
    "created_at": "2014-11-24T02:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204621",
    "user": "tscrim"
}
```

I iterate over partitions `l` of `n` and construct a permutation representative by

(1,2, ... l<sub>1</sub>) (l<sub>1</sub>+1, ... l<sub>1</sub>+l<sub>2</sub>) ... (l<sub>1</sub>+...+l<sub>k-1</sub>, .. n)

where `k` is the length of `l`. Here's my timings:

```
sage: S = SymmetricGroup(5)
sage: %timeit S.conjugacy_classes_representatives()
100 loops, best of 3: 2.08 ms per loop
sage: S = SymmetricGroup(12)
sage: %timeit S.conjugacy_classes_representatives()
10 loops, best of 3: 29.5 ms per loop
sage: S = SymmetricGroup(25)
sage: %timeit S.conjugacy_classes_representatives()
1 loops, best of 3: 1.06 s per loop

sage: S = SymmetricGroup(5)
sage: %timeit S.conjugacy_classes()
10 loops, best of 3: 99.3 ms per loop
sage: S = SymmetricGroup(12)
sage: %timeit S.conjugacy_classes()
1 loops, best of 3: 1.1 s per loop
```

Without my branch:

```
sage: S = SymmetricGroup(5)
sage: %timeit S.conjugacy_classes_representatives()
1 loops, best of 3: 55.8 ms per loop
sage: S = SymmetricGroup(12)
sage: %timeit S.conjugacy_classes_representatives()
1 loops, best of 3: 565 ms per loop
sage: S = SymmetricGroup(25)
sage: %timeit S.conjugacy_classes_representatives()
1 loops, best of 3: 14.5 s per loop

sage: S = SymmetricGroup(5)
sage: %timeit S.conjugacy_classes()
10 loops, best of 3: 115 ms per loop
sage: S = SymmetricGroup(12)
sage: %timeit S.conjugacy_classes()
1 loops, best of 3: 1.23 s per loop
```

So we get about 14x-20x speedup in the representative function, but surprisingly, minimal gain in listing all conjugacy classes. Anyways, I think this is an improvement. I've also added a specific iterator method for the conjugacy classes.
----
New commits:



---

archive/issue_comments_204622.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-11-24T02:21:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204622",
    "user": "tscrim"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_204623.json:
```json
{
    "body": "Hi Travis,\n\nThe title of the ticket was perhaps not clear enough, I wanted to iterate through the elements of a given conjugacy class... Let us assume that the purpose changed ;-)\n\nVincent",
    "created_at": "2014-11-24T02:43:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204623",
    "user": "vdelecroix"
}
```

Hi Travis,

The title of the ticket was perhaps not clear enough, I wanted to iterate through the elements of a given conjugacy class... Let us assume that the purpose changed ;-)

Vincent



---

archive/issue_comments_204624.json:
```json
{
    "body": "Ah, so the description should have been something like:\n\nUsing the underlying GAP commands it takes forever to iterate over *a conjugacy class* of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.\n\nI'd definitely like to speed that up as well. Do you have that code to iterate over a particular conjugacy class? I'm happy to add that onto here and review it.\n\nA question, do you think should we add similar methods to `Permutations_n`?",
    "created_at": "2014-11-24T03:02:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204624",
    "user": "tscrim"
}
```

Ah, so the description should have been something like:

Using the underlying GAP commands it takes forever to iterate over *a conjugacy class* of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.

I'd definitely like to speed that up as well. Do you have that code to iterate over a particular conjugacy class? I'm happy to add that onto here and review it.

A question, do you think should we add similar methods to `Permutations_n`?



---

archive/issue_comments_204625.json:
```json
{
    "body": "Replying to [comment:5 tscrim]:\n> Ah, so the description should have been something like:\n> \n> Using the underlying GAP commands it takes forever to iterate over *a conjugacy class* of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.\n> \n> I'd definitely like to speed that up as well. Do you have that code to iterate over a particular conjugacy class? I'm happy to add that onto here and review it.\n\nI do. Let me add it to the branch.\n\n> A question, do you think should we add similar methods to `Permutations_n`?\n\nI don't know. Most of the time I found that playing with classes makes life harder and I mostly program using tuple and/or lists (this is what my iterator is). One way to make it would be:\n- have this iterator (somehow hidden) that output lists\n- use it for both `SymmetricGroup` and `Permutations_n`\n\nWhat do you think?\n\nVincent",
    "created_at": "2014-11-24T03:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204625",
    "user": "vdelecroix"
}
```

Replying to [comment:5 tscrim]:
> Ah, so the description should have been something like:
> 
> Using the underlying GAP commands it takes forever to iterate over *a conjugacy class* of the Symmetric group. In this ticket we implement a very simple and very naive one that does the job.
> 
> I'd definitely like to speed that up as well. Do you have that code to iterate over a particular conjugacy class? I'm happy to add that onto here and review it.

I do. Let me add it to the branch.

> A question, do you think should we add similar methods to `Permutations_n`?

I don't know. Most of the time I found that playing with classes makes life harder and I mostly program using tuple and/or lists (this is what my iterator is). One way to make it would be:
- have this iterator (somehow hidden) that output lists
- use it for both `SymmetricGroup` and `Permutations_n`

What do you think?

Vincent



---

archive/issue_comments_204626.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-24T03:28:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204626",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204627.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-11-24T06:22:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204627",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204628.json:
```json
{
    "body": "Replying to [comment:6 vdelecroix]:\n> I do. Let me add it to the branch.\n\nThanks.\n\n> > A question, do you think should we add similar methods to `Permutations_n`?\n> \n> I don't know. Most of the time I found that playing with classes makes life harder and I mostly program using tuple and/or lists (this is what my iterator is). One way to make it would be:\n> - have this iterator (somehow hidden) that output lists\n> - use it for both `SymmetricGroup` and `Permutations_n`\n> \n> What do you think?\n\nWell, I went ahead and played with classes. I implemented a class specifically for conjugacy classes of the symmetric group (in part for the future with implementing a direct computation of character tables directly in Sage, in part to override the behavior of `ConjugacyClassGap` and allow easier future refactoring). However I left your function as a low-level iterator.\n\nI'm leaning towards just leaving it until we consider `Partitions_n` as a group (at which time we'll be throwing a lot of functionality at it I think). I designed the current version with this in mind (that I didn't want to do this right now `:p`).",
    "created_at": "2014-11-24T06:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204628",
    "user": "tscrim"
}
```

Replying to [comment:6 vdelecroix]:
> I do. Let me add it to the branch.

Thanks.

> > A question, do you think should we add similar methods to `Permutations_n`?
> 
> I don't know. Most of the time I found that playing with classes makes life harder and I mostly program using tuple and/or lists (this is what my iterator is). One way to make it would be:
> - have this iterator (somehow hidden) that output lists
> - use it for both `SymmetricGroup` and `Permutations_n`
> 
> What do you think?

Well, I went ahead and played with classes. I implemented a class specifically for conjugacy classes of the symmetric group (in part for the future with implementing a direct computation of character tables directly in Sage, in part to override the behavior of `ConjugacyClassGap` and allow easier future refactoring). However I left your function as a low-level iterator.

I'm leaning towards just leaving it until we consider `Partitions_n` as a group (at which time we'll be throwing a lot of functionality at it I think). I designed the current version with this in mind (that I didn't want to do this right now `:p`).



---

archive/issue_comments_204629.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-03T10:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204629",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204630.json:
```json
{
    "body": "Looks good to me. I tested it out for some examples and it seemed to work correctly. There seemed to be one small issue in the documentation for index_set() which I corrected.\n----\nNew commits:",
    "created_at": "2014-12-03T10:53:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204630",
    "user": "amri"
}
```

Looks good to me. I tested it out for some examples and it seemed to work correctly. There seemed to be one small issue in the documentation for index_set() which I corrected.
----
New commits:



---

archive/issue_comments_204631.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-12-03T16:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204631",
    "user": "tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_204632.json:
```json
{
    "body": "Thanks Amri. You're change is good with me.",
    "created_at": "2014-12-03T16:13:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204632",
    "user": "tscrim"
}
```

Thanks Amri. You're change is good with me.



---

archive/issue_comments_204633.json:
```json
{
    "body": "Doctests fail:\n\n```\nsage -t --long --warn-long 38.5 src/sage/groups/perm_gps/permgroup.py\n**********************************************************************\nFile \"src/sage/groups/perm_gps/permgroup.py\", line 1855, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.conjugacy_class\nFailed example:\n    G.conjugacy_class(g)\nExpected:\n    Conjugacy class of (1,2,3,4) in Symmetric group of order 4! as a permutation group\nGot:\n    Conjugacy class of cycle type [4] in Symmetric group of order 4! as a permutation group\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.groups.perm_gps.permgroup.PermutationGroup_generic.conjugacy_class\n    [787 tests, 1 failure, 8.76 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 38.5 src/sage/groups/perm_gps/permgroup.py  # 1 doctest failed\n----------------------------------------------------------------------\nTotal time for all tests: 8.9 seconds\n    cpu time: 5.1 seconds\n    cumulative wall time: 8.8 seconds\n\nsage -t --long --warn-long 38.5 src/sage/groups/conjugacy_classes.py\n**********************************************************************\nFile \"src/sage/groups/conjugacy_classes.py\", line 27, in sage.groups.conjugacy_classes\nFailed example:\n    G.conjugacy_class(g)\nExpected:\n    Conjugacy class of (1,2,3,4) in Symmetric group of order 4! as a permutation group\nGot:\n    Conjugacy class of cycle type [4] in Symmetric group of order 4! as a permutation group\n**********************************************************************\n```\n",
    "created_at": "2014-12-04T01:12:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204633",
    "user": "vbraun"
}
```

Doctests fail:

```
sage -t --long --warn-long 38.5 src/sage/groups/perm_gps/permgroup.py
**********************************************************************
File "src/sage/groups/perm_gps/permgroup.py", line 1855, in sage.groups.perm_gps.permgroup.PermutationGroup_generic.conjugacy_class
Failed example:
    G.conjugacy_class(g)
Expected:
    Conjugacy class of (1,2,3,4) in Symmetric group of order 4! as a permutation group
Got:
    Conjugacy class of cycle type [4] in Symmetric group of order 4! as a permutation group
**********************************************************************
1 item had failures:
   1 of   4 in sage.groups.perm_gps.permgroup.PermutationGroup_generic.conjugacy_class
    [787 tests, 1 failure, 8.76 s]
----------------------------------------------------------------------
sage -t --long --warn-long 38.5 src/sage/groups/perm_gps/permgroup.py  # 1 doctest failed
----------------------------------------------------------------------
Total time for all tests: 8.9 seconds
    cpu time: 5.1 seconds
    cumulative wall time: 8.8 seconds

sage -t --long --warn-long 38.5 src/sage/groups/conjugacy_classes.py
**********************************************************************
File "src/sage/groups/conjugacy_classes.py", line 27, in sage.groups.conjugacy_classes
Failed example:
    G.conjugacy_class(g)
Expected:
    Conjugacy class of (1,2,3,4) in Symmetric group of order 4! as a permutation group
Got:
    Conjugacy class of cycle type [4] in Symmetric group of order 4! as a permutation group
**********************************************************************
```




---

archive/issue_comments_204634.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2014-12-04T01:13:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204634",
    "user": "vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_204635.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-12-04T01:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204635",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_204636.json:
```json
{
    "body": "Trivial fixes.",
    "created_at": "2014-12-04T01:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204636",
    "user": "tscrim"
}
```

Trivial fixes.



---

archive/issue_comments_204637.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-12-04T01:23:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204637",
    "user": "tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_204638.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-12-04T16:12:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/15781",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/15781#issuecomment-204638",
    "user": "vbraun"
}
```

Resolution: fixed
