# Issue 33118: Generate coverage results and upload to codecov

archive/issues_033118.json:
```json
{
    "body": "CC:  @mkoeppe\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/33355\n\n",
    "created_at": "2022-02-15T20:44:14Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Generate coverage results and upload to codecov",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33118",
    "user": "@tobiasdiez"
}
```
CC:  @mkoeppe



Issue created by migration from https://trac.sagemath.org/ticket/33355





---

archive/issue_comments_471953.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-15T23:06:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471953",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471954.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2022-02-16T12:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471954",
    "user": "@tobiasdiez"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_471955.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2022-02-16T12:41:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471955",
    "user": "@tobiasdiez"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_471956.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T12:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471956",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471957.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T13:26:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471957",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471958.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T16:09:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471958",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471959.json:
```json
{
    "body": "Use `sage -sh -c \"....\"` to run a shell command `....` in the Sage environment.",
    "created_at": "2022-02-17T16:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471959",
    "user": "@mkoeppe"
}
```

Use `sage -sh -c "...."` to run a shell command `....` in the Sage environment.



---

archive/issue_comments_471960.json:
```json
{
    "body": "Or use `sage -python -m coverage ...`",
    "created_at": "2022-02-17T16:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471960",
    "user": "@mkoeppe"
}
```

Or use `sage -python -m coverage ...`



---

archive/issue_comments_471961.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T17:08:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471961",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471962.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-17T19:31:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471962",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471963.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-18T12:55:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471963",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471964.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-18T21:59:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471964",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471965.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-19T10:05:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471965",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471966.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-19T10:05:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471966",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471967.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-19T11:36:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471967",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471968.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> Or use `sage -python -m coverage ...`\n\nThanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)\n\nI just noticed that elementary things like git and sudo are missing in the standard docker image. Would it make sense to add these tools?",
    "created_at": "2022-02-19T18:58:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471968",
    "user": "@tobiasdiez"
}
```

Replying to [comment:7 mkoeppe]:
> Or use `sage -python -m coverage ...`

Thanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)

I just noticed that elementary things like git and sudo are missing in the standard docker image. Would it make sense to add these tools?



---

archive/issue_comments_471969.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-19T19:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471969",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_471970.json:
```json
{
    "body": "Replying to [comment:15 gh-tobiasdiez]:\n> Replying to [comment:7 mkoeppe]:\n> > Or use `sage -python -m coverage ...`\n> \n> Thanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)\n\nThis is a goal that has not been achieved yet. What `sage-env` does is still needed for some things in the Sage library. See for example #31296.",
    "created_at": "2022-02-19T20:02:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471970",
    "user": "@mkoeppe"
}
```

Replying to [comment:15 gh-tobiasdiez]:
> Replying to [comment:7 mkoeppe]:
> > Or use `sage -python -m coverage ...`
> 
> Thanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)

This is a goal that has not been achieved yet. What `sage-env` does is still needed for some things in the Sage library. See for example #31296.



---

archive/issue_comments_471971.json:
```json
{
    "body": "Replying to [comment:15 gh-tobiasdiez]:\n> Replying to [comment:7 mkoeppe]:\n> > Or use `sage -python -m coverage ...`\n> \n> Thanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)\n> \n> I just noticed that elementary things like git and sudo are missing in the standard docker image. Would it make sense to add these tools?\n\nI added `git` to `-recommended`, see #33296, #33277, but we're not building the image yet. We could replace `-standard` but `-recommended`. Probably best after #33062.\n\nYou don't need `sudo`, you are running as `root`.",
    "created_at": "2022-02-19T20:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471971",
    "user": "@mkoeppe"
}
```

Replying to [comment:15 gh-tobiasdiez]:
> Replying to [comment:7 mkoeppe]:
> > Or use `sage -python -m coverage ...`
> 
> Thanks that worked well! (Why is this command actually necessary? I thought its the job of `sage-conf` to handle all environment variables)
> 
> I just noticed that elementary things like git and sudo are missing in the standard docker image. Would it make sense to add these tools?

I added `git` to `-recommended`, see #33296, #33277, but we're not building the image yet. We could replace `-standard` but `-recommended`. Probably best after #33062.

You don't need `sudo`, you are running as `root`.



---

archive/issue_comments_471972.json:
```json
{
    "body": "Replying to [comment:18 mkoeppe]:\n> You don't need `sudo`, you are running as `root`.\n\nIt's more for convenience and coherence - normally github actions don't run as sudo.",
    "created_at": "2022-03-02T12:47:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471972",
    "user": "@tobiasdiez"
}
```

Replying to [comment:18 mkoeppe]:
> You don't need `sudo`, you are running as `root`.

It's more for convenience and coherence - normally github actions don't run as sudo.



---

archive/issue_comments_471973.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2022-03-02T12:59:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471973",
    "user": "@tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_471974.json:
```json
{
    "body": "I am getting\n\"There was a problem getting the source code from your provider. Unable to show line by line coverage. \"\n\nhttps://app.codecov.io/gh/sagemath/sagetrac-mirror/blob/ec045eb0168b937e35375e803979975df4aa6564/src/sage/categories/chain_complexes.py",
    "created_at": "2022-03-02T17:14:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471974",
    "user": "@mkoeppe"
}
```

I am getting
"There was a problem getting the source code from your provider. Unable to show line by line coverage. "

https://app.codecov.io/gh/sagemath/sagetrac-mirror/blob/ec045eb0168b937e35375e803979975df4aa6564/src/sage/categories/chain_complexes.py



---

archive/issue_comments_471975.json:
```json
{
    "body": "The link is working for me. Maybe a temporary issues on their side?",
    "created_at": "2022-03-02T17:57:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471975",
    "user": "@tobiasdiez"
}
```

The link is working for me. Maybe a temporary issues on their side?



---

archive/issue_comments_471976.json:
```json
{
    "body": "Working now for me too",
    "created_at": "2022-03-02T19:44:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471976",
    "user": "@mkoeppe"
}
```

Working now for me too



---

archive/issue_comments_471977.json:
```json
{
    "body": "Looking great, thanks for this work!",
    "created_at": "2022-03-02T19:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471977",
    "user": "@mkoeppe"
}
```

Looking great, thanks for this work!



---

archive/issue_comments_471978.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-03-02T19:47:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471978",
    "user": "@mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_471979.json:
```json
{
    "body": "Thanks for the review!",
    "created_at": "2022-03-02T20:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471979",
    "user": "@tobiasdiez"
}
```

Thanks for the review!



---

archive/issue_comments_471980.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-03-08T08:12:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471980",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_471981.json:
```json
{
    "body": "currently not working in the \"Build and Test\" badge, shouting :\n\n```\nRun ./venv/bin/python3 -m coverage combine src/.coverage/\n  ./venv/bin/python3 -m coverage combine src/.coverage/\n  ./venv/bin/python3 -m coverage xml\n  find . -name *coverage*\n  shell: sh -e {0}\nCouldn't combine from non-existent path 'src/.coverage/'\nError: Process completed with exit code 1.\n```\n",
    "created_at": "2022-03-31T19:00:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471981",
    "user": "@fchapoton"
}
```

currently not working in the "Build and Test" badge, shouting :

```
Run ./venv/bin/python3 -m coverage combine src/.coverage/
  ./venv/bin/python3 -m coverage combine src/.coverage/
  ./venv/bin/python3 -m coverage xml
  find . -name *coverage*
  shell: sh -e {0}
Couldn't combine from non-existent path 'src/.coverage/'
Error: Process completed with exit code 1.
```




---

archive/issue_comments_471982.json:
```json
{
    "body": "Which ticket shows this behavior? It is still working correctly in the latest beta: https://github.com/sagemath/sagetrac-mirror/runs/5710760370?check_suite_focus=true",
    "created_at": "2022-03-31T19:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471982",
    "user": "@tobiasdiez"
}
```

Which ticket shows this behavior? It is still working correctly in the latest beta: https://github.com/sagemath/sagetrac-mirror/runs/5710760370?check_suite_focus=true



---

archive/issue_comments_471983.json:
```json
{
    "body": "see #33629 for example",
    "created_at": "2022-04-02T10:09:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471983",
    "user": "@fchapoton"
}
```

see #33629 for example



---

archive/issue_comments_471984.json:
```json
{
    "body": "Okay, was actually an issue with pyright. Fixed in #33631.",
    "created_at": "2022-04-02T11:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471984",
    "user": "@tobiasdiez"
}
```

Okay, was actually an issue with pyright. Fixed in #33631.



---

archive/issue_comments_471985.json:
```json
{
    "body": "Can we get the badge now?",
    "created_at": "2022-04-05T04:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471985",
    "user": "@mkoeppe"
}
```

Can we get the badge now?



---

archive/issue_comments_471986.json:
```json
{
    "body": "the badge \"Build & Test\" is still broken by problems about coverage\n\nfor example, see\n\nhttps://github.com/sagemath/sagetrac-mirror/runs/6117339523?check_suite_focus=true\n\nshouting\n\n```\nRun ./venv/bin/python3 -m coverage combine src/.coverage/\n6\n/__w/sagetrac-mirror/sagetrac-mirror/venv/bin/python3: No module named coverage\n7\nError: Process completed with exit code 1.\n```\n",
    "created_at": "2022-04-22T06:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471986",
    "user": "@fchapoton"
}
```

the badge "Build & Test" is still broken by problems about coverage

for example, see

https://github.com/sagemath/sagetrac-mirror/runs/6117339523?check_suite_focus=true

shouting

```
Run ./venv/bin/python3 -m coverage combine src/.coverage/
6
/__w/sagetrac-mirror/sagetrac-mirror/venv/bin/python3: No module named coverage
7
Error: Process completed with exit code 1.
```




---

archive/issue_comments_471987.json:
```json
{
    "body": "I've opened #33747 for this",
    "created_at": "2022-04-22T22:01:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33118",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33118#issuecomment-471987",
    "user": "@mkoeppe"
}
```

I've opened #33747 for this
