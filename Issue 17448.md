# Issue 17448: Wrong shell test for "sage -n=..."

Issue created by migration from https://trac.sagemath.org/ticket/17685

Original creator: tmonteil

Original creation time: 2015-01-28 16:20:08

CC:  vbraun fbissey rbeezer

As reported on [this ask question](http://ask.sagemath.org/question/25624/sagetex-hyphen-in-filename-forbidden/), the command `sage <filename>` is understood as `sage -n=...` command if `<filename>` contains `-n`. This is due to a wrong use of shell regex.


```
$ sage file-name.py
CRITICAL:root:unknown notebook: None
Error, notebook must be one of default, ipython, sagenb but got None
```




---

Comment by tmonteil created at 2015-01-28 16:55:03

Changing status from new to needs_review.


---

Comment by tmonteil created at 2015-01-28 16:55:03

New commits:


---

Comment by vdelecroix created at 2015-01-28 17:48:01

Hello,

Just by curiosity, why did you remove the `"`?

Vincent


---

Comment by fbissey created at 2015-01-28 19:10:57

I have been getting that an awful lot with doctesting of test/cmdline.py. I wonder if I keep getting temporary filename that trigger this. I will eagerly test this.


---

Comment by fbissey created at 2015-01-28 19:14:45

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2015-01-28 19:14:45

Funky I have been complaining about that since sage 6.4 at least and no one could give me a lead on what was wrong. I give this a positive review.


---

Comment by vdelecroix created at 2015-01-28 19:51:18

author name + reviewer name!


---

Comment by fbissey created at 2015-01-28 20:30:47

Replying to [comment:8 vdelecroix]:
> author name + reviewer name!

Yes I should have filled my bits. I know why I always had the problem on my main machine. The host name is part of the temporary file name. My machine hostname is "qcd-nzi3", automatic fail.

I think you cannot have the `"` because it would have to be matched with the rest of the expression, I could be wrong about that one.


---

Comment by kcrisman created at 2015-01-28 20:50:14

Nice work!  If you wanted to remove the `=~` at the same time (see [comment:2:ticket:17513 here]) that would be swell, if no one would object to it (improves portability, I would think).


---

Comment by vbraun created at 2015-01-29 13:25:57

Resolution: fixed


---

Comment by rbeezer created at 2015-01-30 04:45:17

I added myself as a cc, and the changes say I deleted a commit?  I hope I didn't make a mess here.


---

Comment by fbissey created at 2015-01-30 05:08:14

I don't think you deleted anything but now that it is merged it moved to a branch - I think. I won't try to comment on a closed ticket to check the behavior though.


---

Comment by kcrisman created at 2015-01-30 15:29:15

This has happened to me often enough that I am pretty sure fbissey is right - the next comment even after a push sometimes makes those messages appear (also even on github).


---

Comment by tmonteil created at 2015-01-30 16:22:39

Replying to [comment:4 vdelecroix]:
> Just by curiosity, why did you remove the `"`?

If i put a global quote `"^-n=.*"`, then everything is escaped so `^` and `.*` will not be recognized as special characters (it will recognize strings containing the substring `^-n=.*`). So i would have to do `^"-n=".*` to only escape `-n=`. Now, looking at `man 7 regex`, it seems that `=` is special only if surrounded by some bracket, and `-` is special only for intervals like `A-Z`. So, since it is not the case, we should be safe without quotes (though i usually like to put lot of quotes in bash, just to be sure), hence i thought "if something goes wrong with that apparently less safe way, then it will be good because then we could help fixing bash."

Replying to [comment:10 kcrisman]:
> Nice work! If you wanted to remove the `=~` at the same time (see here) that would be swell, if no one would object to it (improves portability, I would think).

It seems that i am a bit late, i did not think the ticket will be merged so fast. Actually, even `[[` is a bashism, not only `=~`, so it is indeed a good proposition to get rid of this construction. See #17699 for a follow up.


---

Comment by jhpalmieri created at 2015-01-30 16:57:17

The issue isn't really "bashisms": the file starts with `#!/usr/bin/env bash`, so we're using bash. The issue is with compatibility with ancient versions of bash (pre version 3, I guess) which don't include things like `=~`.


---

Comment by kcrisman created at 2015-01-30 17:51:33

John P. is correct.  That said, there probably are plenty of places we could increase portability - see all the Solaris and also [other ports](http://trac.sagemath.org/query?status=needs_info&status=needs_review&status=needs_work&status=new&status=positive_review&component=porting%3A+AIX+or+HP-UX&col=id&col=summary&col=status&col=type&col=priority&col=milestone&col=component&order=priority) where this occasionally caused problems.  Even Cygwin where `dash` is sometimes the only thing available...
