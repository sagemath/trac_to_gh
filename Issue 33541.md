# Issue 33541: Replace sagetex by texsurgery

archive/issues_033541.json:
```json
{
    "body": "CC:  dimpase mmarco pang\n\nhttps://pypi.org/project/texsurgery/\n\nIssue created by migration from https://trac.sagemath.org/ticket/33778\n\n",
    "created_at": "2022-04-30T18:16:26Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Replace sagetex by texsurgery",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/33541",
    "user": "mkoeppe"
}
```
CC:  dimpase mmarco pang

https://pypi.org/project/texsurgery/

Issue created by migration from https://trac.sagemath.org/ticket/33778





---

archive/issue_comments_477458.json:
```json
{
    "body": "looks promising.",
    "created_at": "2022-05-01T08:52:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477458",
    "user": "dimpase"
}
```

looks promising.



---

archive/issue_comments_477459.json:
```json
{
    "body": "I'm not sure what the goal of this ticket is. (1) Stop distributing `sagetex` with Sage? (2) Advertise `texsurgery` in our documentation instead of `sagetex`? (3) Is there any reason to distribute `texsurgery` with Sage?\n\nParts of `texsurgery` seem a little clunkier: the command-line version works like\n\n```\ntexsurgery input_file.tex -o output_file.tex\n```\n\nand it's a little annoying to have to create a second TeX file. Can it all be automated using `latexmk`, the way `sagetex` can?\n\nMaybe this ticket should do (2), or at least advertise `texsurgery` in addition to `sagetex`. Maybe also (3), if (3) is a good idea. Then a later ticket could remove `sagetex` as a standard package.",
    "created_at": "2022-05-01T16:39:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477459",
    "user": "jhpalmieri"
}
```

I'm not sure what the goal of this ticket is. (1) Stop distributing `sagetex` with Sage? (2) Advertise `texsurgery` in our documentation instead of `sagetex`? (3) Is there any reason to distribute `texsurgery` with Sage?

Parts of `texsurgery` seem a little clunkier: the command-line version works like

```
texsurgery input_file.tex -o output_file.tex
```

and it's a little annoying to have to create a second TeX file. Can it all be automated using `latexmk`, the way `sagetex` can?

Maybe this ticket should do (2), or at least advertise `texsurgery` in addition to `sagetex`. Maybe also (3), if (3) is a good idea. Then a later ticket could remove `sagetex` as a standard package.



---

archive/issue_comments_477460.json:
```json
{
    "body": "Since it is pip installable, do we really need to add it? \n\n`sage -pip install texsurgery` should just work, right?\n\n\n> Parts of texsurgery seem a little clunkier\n\nSuggestions for improvement are more than welcome.",
    "created_at": "2022-05-01T23:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477460",
    "user": "mmarco"
}
```

Since it is pip installable, do we really need to add it? 

`sage -pip install texsurgery` should just work, right?


> Parts of texsurgery seem a little clunkier

Suggestions for improvement are more than welcome.



---

archive/issue_comments_477461.json:
```json
{
    "body": "Replying to [comment:4 mmarco]:\n> Since it is pip installable, do we really need to add it? \n> \n> `sage -pip install texsurgery` should just work, right?\n> \n> \n> > Parts of texsurgery seem a little clunkier\n> \n> Suggestions for improvement are more than welcome.\n\n`latexmk` automation would be great: a version of https://mirrors.rit.edu/CTAN/support/latexmk/example_rcfiles/pythontex-latexmkrc (see also https://ctan.org/tex-archive/support/latexmk/example_rcfiles). Being able to use a single command `latexmk FILE` is very handy, and it's not clear to me how to do this with `texsurgery`.",
    "created_at": "2022-05-02T04:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477461",
    "user": "jhpalmieri"
}
```

Replying to [comment:4 mmarco]:
> Since it is pip installable, do we really need to add it? 
> 
> `sage -pip install texsurgery` should just work, right?
> 
> 
> > Parts of texsurgery seem a little clunkier
> 
> Suggestions for improvement are more than welcome.

`latexmk` automation would be great: a version of https://mirrors.rit.edu/CTAN/support/latexmk/example_rcfiles/pythontex-latexmkrc (see also https://ctan.org/tex-archive/support/latexmk/example_rcfiles). Being able to use a single command `latexmk FILE` is very handy, and it's not clear to me how to do this with `texsurgery`.



---

archive/issue_comments_477462.json:
```json
{
    "body": "`latexmk` may be adjusted to run whatever shell script it has to run, in case one cannot just put in `.latexmk` things like pipes, i.e.\n`pdflatex = 'texsurgery input_file.tex | ...`",
    "created_at": "2022-05-02T12:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477462",
    "user": "dimpase"
}
```

`latexmk` may be adjusted to run whatever shell script it has to run, in case one cannot just put in `.latexmk` things like pipes, i.e.
`pdflatex = 'texsurgery input_file.tex | ...`



---

archive/issue_comments_477463.json:
```json
{
    "body": "One problem is that pdflatex is not pipe friendly. It expects an actual file as input.",
    "created_at": "2022-05-02T14:36:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477463",
    "user": "mmarco"
}
```

One problem is that pdflatex is not pipe friendly. It expects an actual file as input.



---

archive/issue_comments_477464.json:
```json
{
    "body": "Replying to [comment:4 mmarco]:\n> Since it is pip installable, do we really need to add it? \n\nAfter adding it (see branch), it will be more discoverable because it will be listed in https://doc.sagemath.org/html/en/reference/spkg/index.html#optional-packages\n----\nNew commits:",
    "created_at": "2022-05-02T22:00:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477464",
    "user": "mkoeppe"
}
```

Replying to [comment:4 mmarco]:
> Since it is pip installable, do we really need to add it? 

After adding it (see branch), it will be more discoverable because it will be listed in https://doc.sagemath.org/html/en/reference/spkg/index.html#optional-packages
----
New commits:



---

archive/issue_comments_477465.json:
```json
{
    "body": "Replying to [comment:7 mmarco]:\n> One problem is that pdflatex is not pipe friendly. It expects an actual file as input. \nBut there is a `-jobname=` option, which for all purposes is basically what you need. E.g.\n\n```\n$ cat t.tex \n\\documentclass{article}\n\\begin{document}\nBlah, $x^2$.\n\\end{document}\n$\n$ cat t.tex | pdflatex -jobname=t\nThis is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)\n restricted \\write18 enabled.\n**entering extended mode\nLaTeX2e <2020-02-02> patch level 5\nL3 programming layer <2020-04-06>\n*(/usr/share/texlive/texmf-dist/tex/latex/base/article.cls\nDocument Class: article 2019/12/20 v1.4l Standard LaTeX document class\n(/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo))\n(/usr/share/texlive/texmf-dist/tex/latex/l3backend/l3backend-pdfmode.def)\nNo file t.aux.\n\n*\n*[1{/usr/share/texlive/texmf-dist/fonts/map/pdftex/updmap/pdftex.map}] (./t.aux)\n</usr/share/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmmi10.pfb></usr/\nshare/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb></usr/share/t\nexlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr7.pfb>\nOutput written on t.pdf (1 page, 25571 bytes).\nTranscript written on t.log.\n```\n\n\n(if one sets `jobname=foo` then one gets `foo.pdf` as output)",
    "created_at": "2022-05-03T13:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477465",
    "user": "dimpase"
}
```

Replying to [comment:7 mmarco]:
> One problem is that pdflatex is not pipe friendly. It expects an actual file as input. 
But there is a `-jobname=` option, which for all purposes is basically what you need. E.g.

```
$ cat t.tex 
\documentclass{article}
\begin{document}
Blah, $x^2$.
\end{document}
$
$ cat t.tex | pdflatex -jobname=t
This is pdfTeX, Version 3.14159265-2.6-1.40.21 (TeX Live 2020) (preloaded format=pdflatex)
 restricted \write18 enabled.
**entering extended mode
LaTeX2e <2020-02-02> patch level 5
L3 programming layer <2020-04-06>
*(/usr/share/texlive/texmf-dist/tex/latex/base/article.cls
Document Class: article 2019/12/20 v1.4l Standard LaTeX document class
(/usr/share/texlive/texmf-dist/tex/latex/base/size10.clo))
(/usr/share/texlive/texmf-dist/tex/latex/l3backend/l3backend-pdfmode.def)
No file t.aux.

*
*[1{/usr/share/texlive/texmf-dist/fonts/map/pdftex/updmap/pdftex.map}] (./t.aux)
</usr/share/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmmi10.pfb></usr/
share/texlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr10.pfb></usr/share/t
exlive/texmf-dist/fonts/type1/public/amsfonts/cm/cmr7.pfb>
Output written on t.pdf (1 page, 25571 bytes).
Transcript written on t.log.
```


(if one sets `jobname=foo` then one gets `foo.pdf` as output)



---

archive/issue_comments_477466.json:
```json
{
    "body": "> Maybe this ticket should do (2), or at least advertise `texsurgery` in addition to `sagetex`. Maybe also (3), if (3) is a good idea. Then a later ticket could remove `sagetex` as a standard package.\n\nAdvertising in addition seems fine.  Certainly something that supports multiple kernels in a single document (including R, Julia?) would be pretty cool.  As optional package, seems reasonable.\n\nPossible issues with anything beyond that, collated here for convenience, not because this ticket is necessarily about deprecating `sagetex`:\n* There seem to be a fairly large number of people who use `sagetex` (based on help requests as well as its direct support in !TeXShop), so there would probably need to be some kind of migration tool if we were to dump it for some reason.  \n* It's also not clear whether it supports easy graphics generation; there is an allusion to graphics, but the documentation seems to still be pretty rudimentary (after all, still not at release 1.0).  If we recommend it above `sagetex` sometime, it would be reasonable to ask for essentially the same ease of use.\n* Does !TeXShop support this?  I can't find anything in a quick search.  \n\nCc:ing Pablo since it is quite convenient that he is both a Sage developer and the lead of this project :)",
    "created_at": "2022-05-09T12:24:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477466",
    "user": "kcrisman"
}
```

> Maybe this ticket should do (2), or at least advertise `texsurgery` in addition to `sagetex`. Maybe also (3), if (3) is a good idea. Then a later ticket could remove `sagetex` as a standard package.

Advertising in addition seems fine.  Certainly something that supports multiple kernels in a single document (including R, Julia?) would be pretty cool.  As optional package, seems reasonable.

Possible issues with anything beyond that, collated here for convenience, not because this ticket is necessarily about deprecating `sagetex`:
* There seem to be a fairly large number of people who use `sagetex` (based on help requests as well as its direct support in !TeXShop), so there would probably need to be some kind of migration tool if we were to dump it for some reason.  
* It's also not clear whether it supports easy graphics generation; there is an allusion to graphics, but the documentation seems to still be pretty rudimentary (after all, still not at release 1.0).  If we recommend it above `sagetex` sometime, it would be reasonable to ask for essentially the same ease of use.
* Does !TeXShop support this?  I can't find anything in a quick search.  

Cc:ing Pablo since it is quite convenient that he is both a Sage developer and the lead of this project :)



---

archive/issue_comments_477467.json:
```json
{
    "body": "Ideally, one would write LaTeX macros (or a `sagetex` document class) which would take input with our SageTeX macros and use `texsurgery` behind the curtains.",
    "created_at": "2022-05-10T08:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/33541",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/33541#issuecomment-477467",
    "user": "dimpase"
}
```

Ideally, one would write LaTeX macros (or a `sagetex` document class) which would take input with our SageTeX macros and use `texsurgery` behind the curtains.
