# Issue 20016: bug in strongly connected test for static digraphs

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2016-03-23 01:05:31

CC:  â€‹dimpase

Keywords: bug

Using the strongly connected graph from [this page](https://graph-tool.skewed.de/performance) I got

```
sage: import networkx
sage: g = networkx.read_graphml("pgp.xml")
sage: networkx.is_strongly_connected(g)
True
sage: G = DiGraph(g)
sage: G.is_strongly_connected()
True
```

But the test goes wrong with the static sparse backend

```
sage: G2 = DiGraph(g, immutable=True)
sage: G2.is_strongly_connected()
False
sage: G == G2
True
```



---

Comment by vdelecroix created at 2016-03-23 01:49:38

I guess that there are much more methods that actually do not work. The thing is that there are uninitialized variables used by some of the methods in `CGraph` that are not initialized by `StaticSparseCGraph`. In the current case it is `num_verts` (that is available as `self.g.n`) and `num_arcs` (that is available as `self.g.m`). Adding at the end of `__init__`.

```diff
diff --git a/src/sage/graphs/base/static_sparse_backend.pyx b/src/sage/graphs/base/static_sparse_backend.pyx
index 06b19cf..2a98a96 100644
--- a/src/sage/graphs/base/static_sparse_backend.pyx
+++ b/src/sage/graphs/base/static_sparse_backend.pyx
`@``@` -95,6 +95,9 `@``@` cdef class StaticSparseCGraph(CGraph):
         bitset_init(self.active_vertices,  self.g.n+1)
         bitset_set_first_n(self.active_vertices, self.g.n)
 
+        self.num_verts = self.g.n
+        self.num_arcs = self.g.m
+
     def __dealloc__(self):
         r"""
         Freeing the memory
```

But it looks like more a "work around" than a "real fix".


---

Comment by dcoudert created at 2016-03-23 09:44:38

At least adding these lines at the end of the init method, with possibly other initialization, we ensure that all backends provide the same information.
I'm surprized none of us noticed that before.
David.


---

Comment by vdelecroix created at 2016-03-23 12:55:48

There are other weird stuff

```
sage: G = Graph([(0,1)])
sage: G2 = G.copy(immutable=True)
sage: G2._backend.is_connected()
Traceback (most recent call last):
...
AttributeError: 'sage.graphs.base.static_sparse_backend.StaticSpars'
object has no attribute 'num_edges'
```

The thing is that it is not clear to me what attributes and methods should be implemented in a new backend.


---

Comment by dcoudert created at 2016-03-23 13:13:58

Well, at least basic features like number of nodes and edges should be in all backends.


---

Comment by vdelecroix created at 2016-03-23 13:22:47

New commits:


---

Comment by vdelecroix created at 2016-03-23 13:22:47

Changing status from new to needs_review.


---

Comment by dcoudert created at 2016-03-23 13:40:33

the patch is working well and passes but has one doctest error (I tried `sage -tp src/sage/graphs/` 

```
sage -t src/sage/graphs/base/c_graph.pyx
    Error: Source line number found

```

certainly due to:
`doctest:858: DeprecationWarning: _out_degree is deprecated`

David.


---

Comment by git created at 2016-03-23 13:57:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-23 13:57:57

That was it! Thanks.


---

Comment by dcoudert created at 2016-03-23 14:16:41

why are you using notation `"Graph size mismatch: %s vs. %s" % (g.num_arcs, randg.size()))` instead of `"Graph size mismatch: {} vs. {}".format(g.num_arcs, randg.size()))` ?


---

Comment by vdelecroix created at 2016-03-23 14:26:21

I did not change anything there. Just `g_num.verts() -> g.num_verts` and `g._num_arcs() -> g.num_arcs`. Though I can use format.


---

Comment by dcoudert created at 2016-03-23 14:35:02

ok, let it as is.


---

Comment by dcoudert created at 2016-03-23 14:35:02

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2016-03-23 14:39:52

Thanks!


---

Comment by vbraun created at 2016-03-26 11:30:52

Resolution: fixed
