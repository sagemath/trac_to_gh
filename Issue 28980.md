# Issue 28980: extract code from OEIS

Issue created by migration from https://trac.sagemath.org/ticket/29217

Original creator: chapoton

Original creation time: 2020-02-18 21:00:16

CC:  tmonteil moritz vdelecroix slabbe tscrim kcrisman

at least try to, and open the possibility to check the code there


---

Comment by chapoton created at 2020-02-18 21:01:21

New commits:


---

Comment by git created at 2020-02-18 21:20:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-19 20:42:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-21 16:49:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-21 21:11:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-22 07:18:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-22 09:49:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-24 20:20:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-02-25 16:25:44

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-02-25 16:41:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-06 21:01:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-03-23 15:20:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-04-01 07:57:58

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-04-01 08:18:09

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-04-01 08:19:35

ok, this should be ready to go. Un volontaire ?


---

Comment by chapoton created at 2020-04-01 08:19:35

Changing status from new to needs_review.


---

Comment by git created at 2020-04-01 08:22:02

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-04-01 08:25:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tmonteil created at 2020-04-03 21:32:00

Changing status from needs_review to needs_info.


---

Comment by tmonteil created at 2020-04-03 21:32:00

What about improving the existing `program` method instead of creating a new method ?

I would suggest to offer the possiblilty to type `s.program('pari')` and get a `FancyTuple` of the corresponding programs (as it is for `maple` and `mathematica`). It is also more friendly for the user than having to parse the tuples in the search for programs in a given language. If no argument is given, i would suggest to return a dictionary "language -> FancyTuple of programs", that is easier to deal with than list of tuples.

Regarding the `test_compile_sage_code`, you could add a `check` option to the `program` method.


---

Comment by git created at 2020-04-04 09:28:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-04-04 09:33:13

Salut Thierry, merci pour les commentaires.

Voici un nouvel essai. J'ai intégré dans "programs" l'extraction des codes, mais pas la vérification. Comme la vérification ne concerne que le code sage, je pense qu'il vaut mieux la garder à part pour le moment. A la limite, je peux l'enlever si tu veux.

Tout cette extraction est rendu bien pénible par l'état de l'OEIS, et par leur refus de créer un champ par langage, qui serait la seule chose logique à faire.

Mon objectif à long terme serait de vérifier automatiquement tout le code sage dans l'OEIS. On en est encore bien loin, mais j'ai déjà trouvé des problèmes, et poussé fort vers la compatibilité avec Python3.


---

Comment by chapoton created at 2020-04-04 10:28:50

Changing status from needs_info to needs_review.


---

Comment by kcrisman created at 2020-04-06 13:16:13

Auto-translate from a non-reliable auto-translator in case it proves useful to some reviewers.  I assume "wise" is "sage" which is pretty darned funny.  No implication should be inferred that Trac comments need to be in English, by the way!  Contributions welcome from [A](https://www.omniglot.com/writing/aari.htm) to [Z](https://www.omniglot.com/writing/zuwara.htm).

----

Hi Thierry, thanks for the comments.

Here is a new test. I integrated in "programs" the extraction of the codes, but not the verification. As the verification only concerns the wise code, I think it is better to keep it separate for the moment. Ultimately, I can remove it if you want.

All this extraction is made very painful by the state of the OEIS, and by their refusal to create a field by language, which would be the only logical thing to do.

My long term goal would be to automatically check all of the wise code in the OEIS. We are still far from it, but I have already found problems, and pushed hard towards compatibility with Python3.


---

Comment by chapoton created at 2020-04-06 14:10:22

Hello ! For good translations, I am using https://www.deepl.com/translator

In French, we have "sage" for the person and "sauge" for the plant.

Any comments on the ticket idea or on the code ?


---

Comment by kcrisman created at 2020-04-06 14:20:25

Other than saying that it would be a good idea to have a way to automate code extraction in this way (and for people to include lots more Sage code in the OEIS!), no comments.


---

Comment by tmonteil created at 2020-04-06 14:22:49

Why are you enclosing the FancyTuple into another layer of list for maple and mathematica ? Each entry of the FancyTuple seems to be either a comment or a on-liner program already:


```
sage: s = oeis(45)
sage: s.programs('maple')
[0: A000045 := proc(n) combinat[fibonacci](n); end;
 1: ZL:=[S, {a = Atom, b = Atom, S = Prod(X,Sequence(Prod(X,b))), X = Sequence(b,card >= 1)}, unlabelled]: seq(combstruct[count](ZL, size=n), n=0..38); # _Zerinvary Lajos_, Apr 04 2008
 2: spec := [B, {B=Sequence(Set(Z, card>1))}, unlabeled ]: seq(combstruct[count](spec, size=n), n=1..39); # _Zerinvary Lajos_, Apr 04 2008
 3: # The following Maple command isFib(n) yields true or false depending on whether n is a Fibonacci number or not.
 4: with(combinat): isFib := proc(n) local a: a := proc(n) local j: for j while fibonacci(j) <= n do fibonacci(j) end do: fibonacci(j-1) end proc: evalb(a(n) = n) end proc: # _Emeric Deutsch_, Nov 11 2014]
sage: s.programs('mathematica')
[0: Table[Fibonacci[k], {k, 0, 50}] (* _Mohammad K. Azarian_, Jul 11 2015 *)
 1: Table[2^n Sqrt @ Product[(Cos[Pi k/(n + 1)]^2 + 1/4), {k, n}] // FullSimplify, {n, 15}]; (* Kasteleyn's formula specialized, Sarah-Marie Belcastro (smbelcas(AT)toroidalsnark.net), Jul 04 2009 *)
 2: LinearRecurrence[{1, 1}, {0, 1}, 40] (* _Harvey P. Dale_, Aug 03 2014 *)
 3: Fibonacci[Range[0, 20]] (* _Eric W. Weisstein_, Sep 22 2017 *)
 4: CoefficientList[Series[-(x/(-1 + x + x^2)), {x, 0, 20}], x] (* _Eric W. Weisstein_, Sep 22 2017 *)]
```


Also, for other languages, the cutting seems not working:


```
sage: s.programs('python')
[0: # As b-file:
 1: from gmpy2 import fib
 2: for n in range(100): print(str(n) + " " + str(fib(n)))  # _Bruno Berselli_, Dec 06 2016,
  0: # From _Jaap Spies_, Jan 05 2007:
  1: def fib():
  2:     """ Generates the Fibonacci numbers, starting with 0 """
  3:     x, y = 0, 1
  4:     while 1:
  5:         yield x
  6:         x, y = y, x+y
  7: f = fib()
  8: a = [next(f) for _ in range(100)]
  9: def A000045(n):
 10:     """ Returns Fibonacci number with index n, offset 0 """
 11:     return a[n]
 12: def A000045_list(N):
 13:     """ Returns a list of the first n Fibonacci numbers """
 14:     return a[:N]]
```



---

Comment by tmonteil created at 2020-04-06 14:22:49

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2020-04-06 18:48:50

Replying to [comment:25 tmonteil]:
> Why are you enclosing the FancyTuple into another layer of list for maple and mathematica ? Each entry of the FancyTuple seems to be either a comment or a on-liner program already:

I am not able to cut the maple or mathematica code into pieces, as there is nothing in these fields that separate independant programs, that could very well take several consecutive lines. So I have only "one program" for each. And to be consistent with all other languages, I return a list of one single FancyTuple.

Of course, one can give up coherence, make a special treatment and return one single FancyTuple for these specific languages. Would you prefer to have this very specific behaviour for "maple" and "mathematica" parameters ?

> Also, for other languages, the cutting seems not working:

I do not understand your second question. Where is the problem ? The output is a list of two FancyTuple, each FancyTuple contains one independant python program. In the example you give, the cutting has been performed correctly, using the information provided in the field, where lines starting by (langname) mark the start of a new program block.


---

Comment by chapoton created at 2020-04-11 15:33:17

Changing status from needs_work to needs_info.


---

Comment by chapoton created at 2020-04-11 15:33:17

Thierry ? Je peux changer le traitement des champs Maple et Mathematica, si tu préfères.


---

Comment by git created at 2020-04-17 07:15:28

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2020-04-17 13:15:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-04-19 18:41:18

Changing status from needs_info to needs_review.


---

Comment by chapoton created at 2020-04-19 18:41:18

Comments anybody ?


---

Comment by git created at 2020-04-23 13:58:04

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2020-04-23 14:00:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-01 19:51:17

Salut Thierry. Est-ce que tu aurais un petit moment pour regarder à nouveau, en particulier ma réponse à tes critiques dans le comment:26 ?


---

Comment by git created at 2020-05-07 18:33:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2020-05-08 07:12:29

green bot. Thierry, s'il te plait ?


---

Comment by chapoton created at 2020-05-15 06:45:36

anybody else for a review ?


---

Comment by tscrim created at 2020-05-15 23:57:22

Is this correct?

```python
raise True
```



---

Comment by git created at 2020-05-16 07:27:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DaveWitteMorris created at 2020-05-16 07:44:13

I noticed a minor typo in a docstring (not your fault). In line 108 there is a single backquote where double is needed:

```
-What does the Taylor expansion of the `e^(e^x-1)`` function have to do with
+What does the Taylor expansion of the ``e^(e^x-1)`` function have to do with
```

----
New commits:


---

Comment by git created at 2020-05-16 08:40:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-16 08:41:14

Thanks, fixed both the wrong raise and the doc typo (using single quote for latex).


---

Comment by @DaveWitteMorris created at 2020-05-16 09:20:32

If you want to use latex on line 108, then I think you need to change the round brackets `( )` to curly brackets `{ }`. As it is now, I think the exponent only has the first round bracket, and `e^x-1)` is back on the baseline.


---

Comment by git created at 2020-05-16 09:21:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2020-05-16 09:21:39

indeed, done, thanks


---

Comment by chapoton created at 2020-05-20 08:53:11

any other comment, someone ?


---

Comment by tscrim created at 2020-05-21 01:24:15

I have no other comments, and I would be willing to set a positive review if there are no objections.


---

Comment by chapoton created at 2020-05-24 12:01:43

Well. Thierry has got ample time to answer comment:25, and never did, in spite of repeated sollicitations.


---

Comment by tscrim created at 2020-05-25 01:40:32

Then positive review.


---

Comment by tscrim created at 2020-05-25 01:40:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2020-05-31 08:48:45

Resolution: fixed


---

Comment by slabbe created at 2020-06-29 13:59:34

See a follow-up ticket: #30019
