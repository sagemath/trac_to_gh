# Issue 20993: py3 some removed members of types module

Issue created by migration from https://trac.sagemath.org/ticket/21230

Original creator: chapoton

Original creation time: 2016-08-12 09:58:49

doing another easy part of the ticket #15994


---

Comment by chapoton created at 2016-08-12 09:59:31

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-08-12 09:59:31

New commits:


---

Comment by jdemeyer created at 2016-08-12 11:30:00

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-08-12 11:30:00

Change

```
from six import class_types as ClassType
```

to

```
from six import class_types
```

and fix the code accordingly: don't use `isinstance(x, (type, ClassType))` but use `isinstance(x, class_types)`.


---

Comment by jdemeyer created at 2016-08-12 11:30:59

In `src/sage/combinat/designs/ext_rep.py`, I think you can remove `from types import *` (and you could also remove the duplicate `import sys`).


---

Comment by git created at 2016-08-12 12:34:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-12 12:36:20

done. I have also changed the other similar "import X as Y".


---

Comment by chapoton created at 2016-08-12 12:36:20

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-08-12 12:52:06

Replying to [comment:2 jdemeyer]:
> fix the code accordingly: don't use `isinstance(x, (type, ClassType))` but use `isinstance(x, class_types)`.


---

Comment by jdemeyer created at 2016-08-12 12:52:06

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-08-12 12:53:55

More seriously: `nested_class.pyx` needs `from __future__ import abolute_import` for this to work otherwise Sage doesn't even start.


---

Comment by git created at 2016-08-12 12:58:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-12 12:59:20

ok, done.

Concerning the future import: once again, we are hurt by the existence of a module named "six" inside misc. I wonder if it is used anywhere.


---

Comment by chapoton created at 2016-08-12 12:59:20

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-08-12 13:00:32

Replying to [comment:9 chapoton]:
> once again, we are hurt by the existence of a module named "six" inside misc.

Guess who caused this:

```diff
commit 55939be60650094fc3d119fab649a70148a29fd9
Author: Frédéric Chapoton <chapoton@math.univ-lyon1.fr>
Date:   Sun Jul 10 11:57:02 2016 +0200

    py3 imports in misc folder

diff --git a/src/sage/misc/six.py b/src/sage/misc/six.py
index 15eee19..ffb431c 100644
--- a/src/sage/misc/six.py
+++ b/src/sage/misc/six.py
@@ -1,8 +1,9 @@
 """
 Python 2 and 3 Compatibility
 """
+from __future__ import absolute_import
 
-from six import *
+from .six import *
 
 def with_metaclass(meta, *bases):
     """
```



---

Comment by jdemeyer created at 2016-08-12 13:03:09

Since a `NestedClassMetaclass` is also a `type`, you can replace

```
if isinstance(v, (class_types, NestedClassMetaclass))
```

by

```
if isinstance(v, class_types)
```



---

Comment by jdemeyer created at 2016-08-12 13:04:23

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2016-08-12 13:04:23

There is still `type, class_types` in `src/sage/combinat/root_system/cartan_type.py`


---

Comment by git created at 2016-08-12 13:04:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-08-12 13:06:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-12 15:56:20

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2016-08-12 15:56:20

done


---

Comment by jdemeyer created at 2016-08-12 19:12:16


```
sage -t --long src/sage/misc/sageinspect.py
**********************************************************************
File "src/sage/misc/sageinspect.py", line 252, in sage.misc.sageinspect._extract_embedded_signature
Failed example:
    print(_extract_embedded_signature(MainClass.NestedClass.NestedSubClass.dummy.__doc__, 'dummy')[0])
Expected:
    File: sage/misc/nested_class.pyx (starting at line 315)
    ...
Got:
    File: sage/misc/nested_class.pyx (starting at line 314)
    <BLANKLINE>
                    A dummy method to demonstrate the embedding of
                    method signature for nested classes.
    <BLANKLINE>
                    TESTS::
    <BLANKLINE>
                        sage: from sage.misc.nested_class import MainClass
                        sage: print(MainClass.NestedClass.NestedSubClass.dummy.__doc__)
                        NestedSubClass.dummy(self, x, *args, r=(1, 2, 3.4), **kwds)
                        File: sage/misc/nested_class.pyx (starting at line 315)
                        <BLANKLINE>
                                        A dummy method to demonstrate the embedding of
                                        method signature for nested classes.
                        ...
    <BLANKLINE>
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   6 in sage.misc.sageinspect._extract_embedded_signature
    [288 tests, 1 failure, 16.06 s]
sage -t --long src/sage/misc/nested_class.pyx
**********************************************************************
File "src/sage/misc/nested_class.pyx", line 322, in sage.misc.nested_class.MainClass.NestedClass.NestedSubClass.dummy
Failed example:
    print(MainClass.NestedClass.NestedSubClass.dummy.__doc__)
Expected:
    NestedSubClass.dummy(self, x, *args, r=(1, 2, 3.4), **kwds)
    File: sage/misc/nested_class.pyx (starting at line 315)
    <BLANKLINE>
                    A dummy method to demonstrate the embedding of
                    method signature for nested classes.
    ...
Got:
    NestedSubClass.dummy(self, x, *args, r=(1, 2, 3.4), **kwds)
    File: sage/misc/nested_class.pyx (starting at line 314)
    <BLANKLINE>
                    A dummy method to demonstrate the embedding of
                    method signature for nested classes.
    <BLANKLINE>
                    TESTS::
    <BLANKLINE>
                        sage: from sage.misc.nested_class import MainClass
                        sage: print(MainClass.NestedClass.NestedSubClass.dummy.__doc__)
                        NestedSubClass.dummy(self, x, *args, r=(1, 2, 3.4), **kwds)
                        File: sage/misc/nested_class.pyx (starting at line 315)
                        <BLANKLINE>
                                        A dummy method to demonstrate the embedding of
                                        method signature for nested classes.
                        ...
    <BLANKLINE>
    <BLANKLINE>
**********************************************************************
1 item had failures:
   1 of   3 in sage.misc.nested_class.MainClass.NestedClass.NestedSubClass.dummy
    [68 tests, 1 failure, 1.82 s]
```



---

Comment by jdemeyer created at 2016-08-12 19:12:16

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-08-12 19:19:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-08-12 19:26:01

done


---

Comment by chapoton created at 2016-08-12 19:26:01

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2016-08-12 20:37:44

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-08-14 19:05:36

Resolution: fixed
