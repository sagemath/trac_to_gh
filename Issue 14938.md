# Issue 14938: python inspect inconsistency

Issue created by migration from https://trac.sagemath.org/ticket/15175

Original creator: felixs

Original creation time: 2013-09-08 09:41:37

I have discovered weird behaviour while debugging a doctest in
dynamic_class.py. A minimal example looks like this:


```
$ ./sage -t src/sage/structure/dynamic_class.py
[..]
passed!
[..]
$ touch local/lib/python2.7/site-packages/sage/structure/dynamic_class.py
$ ./sage -t src/sage/structure/dynamic_class.py
[..]
    inspect.getfile(Foo2)
Expected:
    '.../sage/structure/dynamic_class.pyc'
Got:
    '.../local/lib/python2.7/site-packages/sage/structure/dynamic_class.py'
[..]
```


The reason is, that py_compile.compile() produces bytecode different
from what a python call silently creates (other than that, there _seems_
to be no difference).

Now in general, there is nothing wrong with silently generated pyc
files, so imo there shouldn't be a problem in this case.

The simplest solution would be just expecting

```
    '.../sage/structure/dynamic_class.py...',
```

instead, as this will not only pass the test, but also documents the randomness.
Is there anything else within the sage library that relies on one or the
other outcome of a getfile call?



---

Comment by nbruin created at 2013-09-08 19:41:08

There's `edit` that relies on looked up files, but it seems to not care about whether a `py` or a `pyc` gets returned.

Note, by the way, that changing anything in `local/lib/python2.7/site-packages/sage/` is a really bad idea: those changes just get overwritten the next time the sage library is "installed" (built).


---

Comment by felixs created at 2013-09-08 20:23:25

Replying to [comment:1 nbruin]:
> There's `edit` that relies on looked up files, but it seems to not care about whether a `py` or a `pyc` gets returned.

So, the doctest should neither, right?

> Note, by the way, that changing anything in `local/lib/python2.7/site-packages/sage/` is a really bad idea: those changes just get overwritten the next time the sage library is "installed" (built).

I am aware of that, this was meant to conveniently demonstrate the inconsistency.

(The mashed build/install routine is an artifact of a development unfriendly build system. There are alternatives, e.g. #14834)


---

Comment by jdemeyer created at 2015-09-16 08:14:33

I remember fixing this in some other ticket.


---

Comment by jdemeyer created at 2015-09-16 08:14:33

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2015-09-16 08:14:37

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-09-25 08:28:29

Resolution: fixed
