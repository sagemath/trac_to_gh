# Issue 30113: Remove ATLAS

archive/issues_030113.json:
```json
{
    "body": "CC:  jhpalmieri dimpase fbissey jpflori\n\n(from #19719)\n\nOur version of ATLAS is outdated and has not been tested in a long time. Latest upstream version as of 2020-08-13 is 3.11.40, released 2018-10-02, see \u200bhttps://github.com/math-atlas/math-atlas/releases\n\nWe remove this package.\n\nHowever, we keep the makefile variable `BLAS` (used in packages' `dependencies` files) and configure variable SAGE_BLAS, rather than hardcoding openblas. It will make it easier to plug in another BLAS implementation if one comes along in the future, and it is also needed for #29387.\n\nIssue created by migration from https://trac.sagemath.org/ticket/30350\n\n",
    "created_at": "2020-08-13T18:12:14Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "title": "Remove ATLAS",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30113",
    "user": "mkoeppe"
}
```
CC:  jhpalmieri dimpase fbissey jpflori

(from #19719)

Our version of ATLAS is outdated and has not been tested in a long time. Latest upstream version as of 2020-08-13 is 3.11.40, released 2018-10-02, see â€‹https://github.com/math-atlas/math-atlas/releases

We remove this package.

However, we keep the makefile variable `BLAS` (used in packages' `dependencies` files) and configure variable SAGE_BLAS, rather than hardcoding openblas. It will make it easier to plug in another BLAS implementation if one comes along in the future, and it is also needed for #29387.

Issue created by migration from https://trac.sagemath.org/ticket/30350





---

archive/issue_comments_428182.json:
```json
{
    "body": "Here is an attempt. I have questions:\n- what to do with `openblas/spkg-configure.m4`? Any changes necessary?\n- what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?\n- I don't know anything about cygwin, so I don't know what to do about the installation instructions referring to ATLAS in `src/doc/en/installation/source.rst`.\nAnyway, this is a start.\n----\nNew commits:",
    "created_at": "2021-01-30T19:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428182",
    "user": "jhpalmieri"
}
```

Here is an attempt. I have questions:
- what to do with `openblas/spkg-configure.m4`? Any changes necessary?
- what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?
- I don't know anything about cygwin, so I don't know what to do about the installation instructions referring to ATLAS in `src/doc/en/installation/source.rst`.
Anyway, this is a start.
----
New commits:



---

archive/issue_comments_428183.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-01-30T19:14:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428183",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_428184.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428184",
    "user": "mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_428185.json:
```json
{
    "body": "I support removing this package in 9.5. The branch needs rebasing",
    "created_at": "2021-09-21T22:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428185",
    "user": "mkoeppe"
}
```

I support removing this package in 9.5. The branch needs rebasing



---

archive/issue_comments_428186.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-09-22T00:15:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428186",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_428187.json:
```json
{
    "body": "Rebased. I deleted the reference to ATLAS in the cygwin instructions in `src/doc/en/installation/source.rst`, but the other questions in comment:4 remain.",
    "created_at": "2021-09-22T00:17:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428187",
    "user": "jhpalmieri"
}
```

Rebased. I deleted the reference to ATLAS in the cygwin instructions in `src/doc/en/installation/source.rst`, but the other questions in comment:4 remain.



---

archive/issue_comments_428188.json:
```json
{
    "body": "Replying to [comment:4 jhpalmieri]:\n> - what to do with `openblas/spkg-configure.m4`? Any changes necessary?\n\nWe could either keep the `--with-blas=...` option but make it an error if anything other than `openblas` is passed, or remove it.",
    "created_at": "2021-09-22T00:21:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428188",
    "user": "mkoeppe"
}
```

Replying to [comment:4 jhpalmieri]:
> - what to do with `openblas/spkg-configure.m4`? Any changes necessary?

We could either keep the `--with-blas=...` option but make it an error if anything other than `openblas` is passed, or remove it.



---

archive/issue_comments_428189.json:
```json
{
    "body": "Replying to [comment:4 jhpalmieri]:\n> - what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?\n\nNo change needed. The scripts just set the environment variable to a safe value so the installation does not pick up random things that may be in the user's environment. (Not sure why the default is different for macOS and for other systems.)",
    "created_at": "2021-09-22T00:25:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428189",
    "user": "mkoeppe"
}
```

Replying to [comment:4 jhpalmieri]:
> - what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?

No change needed. The scripts just set the environment variable to a safe value so the installation does not pick up random things that may be in the user's environment. (Not sure why the default is different for macOS and for other systems.)



---

archive/issue_comments_428190.json:
```json
{
    "body": "The changes to the documentation look fine.",
    "created_at": "2021-09-22T00:27:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428190",
    "user": "mkoeppe"
}
```

The changes to the documentation look fine.



---

archive/issue_comments_428191.json:
```json
{
    "body": "Is this the way to remove the `--with-blas` option?\n\n```diff\ndiff --git a/build/pkgs/openblas/spkg-configure.m4 b/build/pkgs/openblas/spkg-configure.m4\nindex 177bbb1d4f..c81533ba71 100644\n--- a/build/pkgs/openblas/spkg-configure.m4\n+++ b/build/pkgs/openblas/spkg-configure.m4\n@@ -110,26 +110,5 @@ SAGE_SPKG_CONFIGURE([openblas], [\n   LIBS=\"$SAVE_LIBS\"\n   CFLAGS=\"$SAVE_CFLAGS\"\n  ])\n- ], [\n-  dnl REQUIRED-CHECK\n-  AS_IF([test \"x$with_blas\" = xopenblas], [\n-     sage_require_openblas=yes\n-     sage_require_atlas=no])\n-  ], [\n-  dnl PRE\n-  AC_MSG_CHECKING([BLAS library])\n-  AC_ARG_WITH([blas],\n-  [AS_HELP_STRING([--with-blas=openblas],\n-    [use OpenBLAS as BLAS library (default)])]\n-  [AS_HELP_STRING([--with-blas=atlas],\n-    [use ATLAS as BLAS library])],,\n-    [with_blas=openblas]  # default\n-  )\n-  AS_CASE([\"$with_blas\"],\n-    [openblas], [],\n-    [atlas],    [sage_spkg_install_openblas=no],\n-                [AC_MSG_ERROR([allowed values for --with-blas are 'atlas' and 'openblas'])])\n-  AC_MSG_RESULT([$with_blas])\n-  AC_SUBST([SAGE_BLAS], [$with_blas])\n-  ]\n+ ]\n )\n```\n",
    "created_at": "2021-09-22T01:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428191",
    "user": "jhpalmieri"
}
```

Is this the way to remove the `--with-blas` option?

```diff
diff --git a/build/pkgs/openblas/spkg-configure.m4 b/build/pkgs/openblas/spkg-configure.m4
index 177bbb1d4f..c81533ba71 100644
--- a/build/pkgs/openblas/spkg-configure.m4
+++ b/build/pkgs/openblas/spkg-configure.m4
@@ -110,26 +110,5 @@ SAGE_SPKG_CONFIGURE([openblas], [
   LIBS="$SAVE_LIBS"
   CFLAGS="$SAVE_CFLAGS"
  ])
- ], [
-  dnl REQUIRED-CHECK
-  AS_IF([test "x$with_blas" = xopenblas], [
-     sage_require_openblas=yes
-     sage_require_atlas=no])
-  ], [
-  dnl PRE
-  AC_MSG_CHECKING([BLAS library])
-  AC_ARG_WITH([blas],
-  [AS_HELP_STRING([--with-blas=openblas],
-    [use OpenBLAS as BLAS library (default)])]
-  [AS_HELP_STRING([--with-blas=atlas],
-    [use ATLAS as BLAS library])],,
-    [with_blas=openblas]  # default
-  )
-  AS_CASE(["$with_blas"],
-    [openblas], [],
-    [atlas],    [sage_spkg_install_openblas=no],
-                [AC_MSG_ERROR([allowed values for --with-blas are 'atlas' and 'openblas'])])
-  AC_MSG_RESULT([$with_blas])
-  AC_SUBST([SAGE_BLAS], [$with_blas])
-  ]
+ ]
 )
```




---

archive/issue_comments_428192.json:
```json
{
    "body": "Yes, that looks right",
    "created_at": "2021-09-22T01:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428192",
    "user": "mkoeppe"
}
```

Yes, that looks right



---

archive/issue_comments_428193.json:
```json
{
    "body": "After removing, this line:\n\n```\nbuild/make/Makefile.in:BLAS = @SAGE_BLAS@\n```\n\nneeds changing",
    "created_at": "2021-09-22T01:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428193",
    "user": "mkoeppe"
}
```

After removing, this line:

```
build/make/Makefile.in:BLAS = @SAGE_BLAS@
```

needs changing



---

archive/issue_comments_428194.json:
```json
{
    "body": "Can I just change it to `BLAS = openblas`?",
    "created_at": "2021-09-22T01:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428194",
    "user": "jhpalmieri"
}
```

Can I just change it to `BLAS = openblas`?



---

archive/issue_comments_428195.json:
```json
{
    "body": "Yes",
    "created_at": "2021-09-22T01:43:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428195",
    "user": "mkoeppe"
}
```

Yes



---

archive/issue_comments_428196.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-22T01:45:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428196",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428197.json:
```json
{
    "body": "Okay, here are those changes.",
    "created_at": "2021-09-22T01:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428197",
    "user": "jhpalmieri"
}
```

Okay, here are those changes.



---

archive/issue_comments_428198.json:
```json
{
    "body": "`build/pkgs/atlas/distros/` still contains some stuff",
    "created_at": "2021-09-22T02:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428198",
    "user": "mkoeppe"
}
```

`build/pkgs/atlas/distros/` still contains some stuff



---

archive/issue_comments_428199.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-22T02:30:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428199",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_428200.json:
```json
{
    "body": "Fixed, thanks.",
    "created_at": "2021-09-22T02:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428200",
    "user": "jhpalmieri"
}
```

Fixed, thanks.



---

archive/issue_comments_428201.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-22T02:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428201",
    "user": "mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_428202.json:
```json
{
    "body": "This seems to work well.",
    "created_at": "2021-09-22T02:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428202",
    "user": "mkoeppe"
}
```

This seems to work well.



---

archive/issue_comments_428203.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-22T02:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428203",
    "user": "mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_428204.json:
```json
{
    "body": "Thank you!",
    "created_at": "2021-09-22T05:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428204",
    "user": "jhpalmieri"
}
```

Thank you!



---

archive/issue_comments_428205.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-09T11:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30113",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30113#issuecomment-428205",
    "user": "vbraun"
}
```

Resolution: fixed
