# Issue 30113: Remove ATLAS

Issue created by migration from https://trac.sagemath.org/ticket/30350

Original creator: mkoeppe

Original creation time: 2020-08-13 18:12:14

CC:  jhpalmieri dimpase fbissey jpflori

(from #19719)

Our version of ATLAS is outdated and has not been tested in a long time. Latest upstream version as of 2020-08-13 is 3.11.40, released 2018-10-02, see â€‹https://github.com/math-atlas/math-atlas/releases

We remove this package.

However, we keep the makefile variable `BLAS` (used in packages' `dependencies` files) and configure variable SAGE_BLAS, rather than hardcoding openblas. It will make it easier to plug in another BLAS implementation if one comes along in the future, and it is also needed for #29387.


---

Comment by jhpalmieri created at 2021-01-30 19:14:14

Here is an attempt. I have questions:
- what to do with `openblas/spkg-configure.m4`? Any changes necessary?
- what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?
- I don't know anything about cygwin, so I don't know what to do about the installation instructions referring to ATLAS in `src/doc/en/installation/source.rst`.
Anyway, this is a start.
----
New commits:


---

Comment by git created at 2021-01-30 19:14:40

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by mkoeppe created at 2021-09-21 22:53:15

I support removing this package in 9.5. The branch needs rebasing


---

Comment by git created at 2021-09-22 00:15:53

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2021-09-22 00:17:18

Rebased. I deleted the reference to ATLAS in the cygwin instructions in `src/doc/en/installation/source.rst`, but the other questions in comment:4 remain.


---

Comment by mkoeppe created at 2021-09-22 00:21:56

Replying to [comment:4 jhpalmieri]:
> - what to do with `openblas/spkg-configure.m4`? Any changes necessary?

We could either keep the `--with-blas=...` option but make it an error if anything other than `openblas` is passed, or remove it.


---

Comment by mkoeppe created at 2021-09-22 00:25:10

Replying to [comment:4 jhpalmieri]:
> - what about the `spkg-install.in` scripts for `scipy` and `numpy`? They refer to an `ATLAS` environment variable. Leave as is or change?

No change needed. The scripts just set the environment variable to a safe value so the installation does not pick up random things that may be in the user's environment. (Not sure why the default is different for macOS and for other systems.)


---

Comment by mkoeppe created at 2021-09-22 00:27:47

The changes to the documentation look fine.


---

Comment by jhpalmieri created at 2021-09-22 01:36:22

Is this the way to remove the `--with-blas` option?

```diff
diff --git a/build/pkgs/openblas/spkg-configure.m4 b/build/pkgs/openblas/spkg-configure.m4
index 177bbb1d4f..c81533ba71 100644
--- a/build/pkgs/openblas/spkg-configure.m4
+++ b/build/pkgs/openblas/spkg-configure.m4
@@ -110,26 +110,5 @@ SAGE_SPKG_CONFIGURE([openblas], [
   LIBS="$SAVE_LIBS"
   CFLAGS="$SAVE_CFLAGS"
  ])
- ], [
-  dnl REQUIRED-CHECK
-  AS_IF([test "x$with_blas" = xopenblas], [
-     sage_require_openblas=yes
-     sage_require_atlas=no])
-  ], [
-  dnl PRE
-  AC_MSG_CHECKING([BLAS library])
-  AC_ARG_WITH([blas],
-  [AS_HELP_STRING([--with-blas=openblas],
-    [use OpenBLAS as BLAS library (default)])]
-  [AS_HELP_STRING([--with-blas=atlas],
-    [use ATLAS as BLAS library])],,
-    [with_blas=openblas]  # default
-  )
-  AS_CASE(["$with_blas"],
-    [openblas], [],
-    [atlas],    [sage_spkg_install_openblas=no],
-                [AC_MSG_ERROR([allowed values for --with-blas are 'atlas' and 'openblas'])])
-  AC_MSG_RESULT([$with_blas])
-  AC_SUBST([SAGE_BLAS], [$with_blas])
-  ]
+ ]
 )
```



---

Comment by mkoeppe created at 2021-09-22 01:38:49

Yes, that looks right


---

Comment by mkoeppe created at 2021-09-22 01:40:20

After removing, this line:

```
build/make/Makefile.in:BLAS = @SAGE_BLAS@
```

needs changing


---

Comment by jhpalmieri created at 2021-09-22 01:42:37

Can I just change it to `BLAS = openblas`?


---

Comment by mkoeppe created at 2021-09-22 01:43:28

Yes


---

Comment by git created at 2021-09-22 01:45:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-09-22 01:49:31

Okay, here are those changes.


---

Comment by mkoeppe created at 2021-09-22 02:17:50

`build/pkgs/atlas/distros/` still contains some stuff


---

Comment by git created at 2021-09-22 02:30:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2021-09-22 02:30:54

Fixed, thanks.


---

Comment by mkoeppe created at 2021-09-22 02:47:49

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-09-22 02:51:46

This seems to work well.


---

Comment by mkoeppe created at 2021-09-22 02:51:46

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2021-09-22 05:30:25

Thank you!


---

Comment by vbraun created at 2021-10-09 11:10:34

Resolution: fixed
