# Issue 30211: src/tox.ini: Add validation of rst files and docstrings via a quick docbuild

Issue created by migration from https://trac.sagemath.org/ticket/30448

Original creator: mkoeppe

Original creation time: 2020-08-26 23:42:27

CC:  @tobiasdiez jhpalmieri dimpase chapoton @davewittemorris etn40ff tscrim klee




---

Comment by @tobiasdiez created at 2020-08-30 20:45:20

There are also linters for rst files: rstcheck or doc8


---

Comment by mkoeppe created at 2020-08-30 21:35:03

Yes, see also my comments in #30415


---

Comment by mkoeppe created at 2020-09-07 23:20:17

Replying to [comment:6 mkoeppe]:
> Yes, see also my comments in #30415
... added to the description


---

Comment by mkoeppe created at 2020-09-07 23:55:13

As a first stab at docstring validation, I have added `tox -e pydocstyle`. This will need some configuration -- right now it gives just too many warnings.
----
Last 10 new commits:


---

Comment by @tobiasdiez created at 2020-12-10 16:42:44

For the automated check, it's also a problem that Sage uses a custom doc style and not one of the more standardized ones like pep257, numpy or google.
https://www.python.org/dev/peps/pep-0257/
https://numpydoc.readthedocs.io/en/latest/format.html
https://google.github.io/styleguide/pyguide.html#383-functions-and-methods

Are there any plans to migrate to one of these standards?


---

Comment by mkoeppe created at 2020-12-10 17:22:22

I'm not aware of migration plans


---

Comment by jhpalmieri created at 2020-12-11 22:12:25

Replying to [comment:15 mkoeppe]:
> I'm not aware of migration plans

Nor am I, but it's something to consider.


---

Comment by @tobiasdiez created at 2020-12-12 20:23:44

I've created #31044 for this.


---

Comment by mkoeppe created at 2020-12-12 20:45:58

Also if the decision is made to migrate, to do the actual migration we will certainly need a parser for the sage-style doc.


---

Comment by mkoeppe created at 2021-03-24 02:04:25

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.


---

Comment by git created at 2022-07-12 00:35:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2022-07-12 00:54:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-12 00:58:54

Not sure if we should add all roles from https://www.sphinx-doc.org/en/master/usage/restructuredtext/roles.html and https://www.sphinx-doc.org/en/master/usage/restructuredtext/domains.html#cross-referencing-python-objects


---

Comment by git created at 2022-07-12 01:06:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:10:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:33:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:37:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:44:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:47:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 01:54:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:06:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:11:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:15:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:25:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:32:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:51:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 02:57:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 03:01:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 03:21:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2022-07-12 03:27:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-12 03:28:59

I stop here for now, contributions welcome


---

Comment by mkoeppe created at 2022-07-12 04:51:30

Remaining failures see https://github.com/sagemath/sagetrac-mirror/runs/7294638131?check_suite_focus=true


---

Comment by klee created at 2022-07-12 05:13:54

Replying to [comment:51 mkoeppe]:
> Remaining failures see https://github.com/sagemath/sagetrac-mirror/runs/7294638131?check_suite_focus=true

May I open a meta ticket to deal with them?


---

Comment by mkoeppe created at 2022-07-12 05:41:37

Good idea


---

Comment by git created at 2022-07-12 05:47:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2022-07-12 05:47:40

Changing status from new to needs_review.


---

Comment by klee created at 2022-07-12 05:49:29

New commits:


---

Comment by klee created at 2022-07-12 05:51:21

Okay. I will open a separate ticket.


---

Comment by klee created at 2022-07-12 05:55:16

Here is the meta ticket: #34157


---

Comment by klee created at 2022-07-12 06:24:17

Done. It is a ticket party. Whet your appetite.


---

Comment by klee created at 2022-07-12 07:12:16

Perhaps

```diff
diff --git a/src/sage/graphs/domination.py b/src/sage/graphs/domination.py
index 25ac512233..8cc1e57de9 100644
--- a/src/sage/graphs/domination.py
+++ b/src/sage/graphs/domination.py
@@ -513,7 +513,7 @@ def _cand_ext_enum(G, to_dom, u_next):
 
         .. WARNING::
 
-            The same output may be output several times (up to ``H`` times).
+            The same output may be output several times (up to `|H|` times).
 
         In order to later remove duplicates, we here output pairs ``(ext, i)``
         where ``ext`` is the output candidate extension and ``i`` counts how
@@ -593,7 +593,7 @@ def minimal_dominating_sets(G, to_dominate=None, work_on_copy=True):
     - ``work_on_copy`` -- boolean (default: ``True``); whether or not to work on
       a copy of the input graph; if set to ``False``, the input graph will be
       modified (relabeled).
-    
+
     OUTPUT:
 
     An iterator over the inclusion-minimal sets of vertices of ``G``.
```



---

Comment by mkoeppe created at 2022-07-12 07:24:57

Thanks for catching this, please push it to the ticket


---

Comment by git created at 2022-07-12 07:50:05

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by klee created at 2022-07-12 07:51:10

Otherwise, it looks good to me.


---

Comment by klee created at 2022-07-12 07:51:10

Changing status from needs_review to positive_review.


---

Comment by mkoeppe created at 2022-07-12 13:21:30

Thanks!


---

Comment by jhpalmieri created at 2022-07-13 23:05:17

A bug in `flake8-rst-docstrings`? See #34168#comment:14, also #34167 and #34169.


---

Comment by jhpalmieri created at 2022-07-13 23:16:42

Or maybe we're just sloppy in how we use reStructuredText, and we should add explicit titles our files, like

```diff
diff --git a/src/sage/categories/category_with_axiom.py b/src/sage/categories/category_with_axiom.py
index 237ad5dfed..d11bf0fe8a 100644
--- a/src/sage/categories/category_with_axiom.py
+++ b/src/sage/categories/category_with_axiom.py
@@ -1,5 +1,7 @@
 r"""
+======
 Axioms
+======
 
 This documentation covers how to implement axioms and proceeds with an
 overview of the implementation of the axiom infrastructure. It assumes
```

I don't know `rst` syntax well enough to know if a single word at the start of a text block has special significance, but I think it might. This might also explain the issue with "noreplace" in `sagedoc.py` in #34172.


---

Comment by jhpalmieri created at 2022-07-14 00:24:47

I can't get the syntax

```
###### Axioms
###### }}}
to compile: it yields an error. At #34168 we've diagnosed what looks like a bug in `flake8-rst-docstrings`, and fixing that would be my preferred resolution.


---

Comment by vbraun created at 2022-07-21 21:12:18

Resolution: fixed
