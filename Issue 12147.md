# Issue 12147: OS X Lion: gsl fails self tests

Issue created by migration from https://trac.sagemath.org/ticket/12319

Original creator: jhpalmieri

Original creation time: 2012-01-18 03:36:10

Assignee: tbd

Keywords: osx lion gsl darwin

As with pari (#12315), on OS X Lion, if you set SAGE_CHECK=yes and build gsl, some tests fail.  If we set `SAGE_DEBUG=yes`, which uses `-O0` instead of `-O2` as a compiler flag, then self tests all pass.  Modifying the spkg to use `-O1` instead of `-O2` also makes all tests pass.  So a possible fix for spkg-install:

```diff
diff --git a/spkg-install b/spkg-install
--- a/spkg-install
+++ b/spkg-install
@@ -27,6 +27,8 @@ fi
 
 if [ "x$SAGE_DEBUG" = xyes ] ; then
   CFLAGS="$CFLAGS -g -O0" # No optimisation, aids debugging. 
+elif [[ "$UNAME" = "Darwin" && `uname -r | sed 's/\([^.]*\)\..*/\1/'` = '11' ]]
+  CFLAGS="$CFLAGS -g -O1" # Lower level of optimisation for OS X Lion
 else
   CFLAGS="$CFLAGS -g -O2" # Normal optimisation. 
 fi
```



---

Comment by jhpalmieri created at 2012-01-26 23:00:38

Doing

```
CC=gcc-4.2
export GCC
```

in spkg-install fixes this.  (See #12315 for a similar fix for Pari.)


---

Comment by jhpalmieri created at 2012-01-29 06:00:26

Here's a new spkg which uses gcc-4.2.  Self tests pass for me with this.


---

Comment by jhpalmieri created at 2012-01-29 06:00:26

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2012-02-04 06:20:48

Since gcc-4.2 is not present by default, let's use clang instead.  Self-tests pass for me with the updated spkg.


---

Attachment

patch for gsl spkg; for reference only


---

Comment by jhpalmieri created at 2012-04-21 17:22:09

This should be closed, since the gcc spkg (#12369) fixes the issues.


---

Comment by jhpalmieri created at 2012-04-21 17:22:09

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2012-04-26 20:12:42

Resolution: wontfix
