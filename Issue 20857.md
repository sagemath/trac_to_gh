# Issue 20857: Sage package for SCIP integer programming solver

Issue created by migration from Trac.

Original creator: mkoeppe

Original creation time: 2016-07-25 19:03:00

CC:  malb schilly jason dimpase vdelecroix chapoton jdemeyer slelievre tscrim embray vbraun

Split out from the larger ticket #10879. This ticket just adds an spkg, not the Cython interface.

"SCIP is currently one of the fastest non-commercial mixed integer programming (MIP) solvers. It is also a framework for Constraint Integer Programming and branch-cut-and-price. It allows total control of the solution process and the access of detailed information down to the guts of the solver." -- http://scip.zib.de/

Features interesting to Sage:

 * SCIP is pretty fast for Mixed Integer Programming
 * SCIP is a Constraint Integer Programming solver and allows non-linear constraints
 * SCIP's source code is available
 * SoPlex (the LP solver which is part of scipoptsuite) has an exact mode which is said to be working well
 * A beta version of SCIP can do exact MIP: http://scip.zib.de/#exact using qsopt_ex (see also #18766)

However, the SCIP license prevents us from redistributing the SCIP source code:
http://scip.zib.de/#license

To build a SCIP for Sage do:

 * pull from this ticket
 * download the SCIP Optimisation Suite from http://scip.zib.de/download.php?fname=scipoptsuite-3.2.1.tgz
 * put tarfile scipoptsuite-3.2.1.tgz in `$SAGE_ROOT/upstream/`
 * `sage -f scipoptsuite`


Follow-up: #21003: Add SCIP backend using PySCIPOpt


---

Comment by git created at 2016-07-26 00:19:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-26 20:00:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-07-26 20:24:58

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2016-07-26 20:24:58

It finally builds on Mac OS X.
Needs testing / review.


---

Comment by git created at 2016-07-28 18:56:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-28 22:29:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-07-29 03:47:06

On 7.3.rc0 with my Ubuntu 14.04 LTS, I could not get this to build:

```
Found local metadata for scipoptsuite-3.2.1
Using cached file /home/travis/sage-build/upstream/scipoptsuite-3.2.1.tgz
scipoptsuite-3.2.1
====================================================
Setting up build directory for scipoptsuite-3.2.1
Finished extraction
****************************************************
Host system:
Linux apricot 3.13.0-87-generic #133-Ubuntu SMP Tue May 24 18:32:09 UTC 2016 x86_64 x86_6
4 x86_64 GNU/Linux
****************************************************
C compiler: gcc
C compiler version:
Using built-in specs.
COLLECT_GCC=gcc
COLLECT_LTO_WRAPPER=/usr/lib/gcc/x86_64-linux-gnu/4.9/lto-wrapper
Target: x86_64-linux-gnu
Configured with: ../src/configure -v --with-pkgversion='Ubuntu 4.9.3-8ubuntu2~14.04' --wi
th-bugurl=file:///usr/share/doc/gcc-4.9/README.Bugs --enable-languages=c,c++,java,go,d,fo
rtran,objc,obj-c++ --prefix=/usr --program-suffix=-4.9 --enable-shared --enable-linker-bu
ild-id --libexecdir=/usr/lib --without-included-gettext --enable-threads=posix --with-gxx
-include-dir=/usr/include/c++/4.9 --libdir=/usr/lib --enable-nls --with-sysroot=/ --enabl
e-clocale=gnu --enable-libstdcxx-debug --enable-libstdcxx-time=yes --enable-gnu-unique-ob
ject --disable-vtable-verify --enable-plugin --with-system-zlib --disable-browser-plugin 
--enable-java-awt=gtk --enable-gtk-cairo --with-java-home=/usr/lib/jvm/java-1.5.0-gcj-4.9
-amd64/jre --enable-java-home --with-jvm-root-dir=/usr/lib/jvm/java-1.5.0-gcj-4.9-amd64 -
-with-jvm-jar-dir=/usr/lib/jvm-exports/java-1.5.0-gcj-4.9-amd64 --with-arch-directory=amd
64 --with-ecj-jar=/usr/share/java/eclipse-ecj.jar --enable-objc-gc --enable-multiarch --d
isable-werror --with-arch-32=i686 --with-abi=m64 --with-multilib-list=m32,m64,mx32 --enab
le-multilib --with-tune=generic --enable-checking=release --build=x86_64-linux-gnu --host
=x86_64-linux-gnu --target=x86_64-linux-gnu
Thread model: posix
gcc version 4.9.3 (Ubuntu 4.9.3-8ubuntu2~14.04) 
****************************************************
soplex-2.2.1/COPYING
soplex-2.2.1/INSTALL
...
soplex-2.2.1/src/usertimer.cpp
soplex-2.2.1/src/wallclocktimer.cpp
patching file Makefile
Compiling SoPlex
make: Entering an unknown directory
make: *** empty string invalid as file name.  Stop.
make: Leaving an unknown directory
Error building SOPLEX.
```

The log file doesn't contain anything else of interest, but I can post it if you want. Tell me what you need from me or what I can do to debug.


---

Comment by tscrim created at 2016-07-29 03:47:06

Changing status from needs_review to needs_work.


---

Comment by mkoeppe created at 2016-07-29 05:49:47

"Entering an unknown directory", very mysterious.
Perhaps you can go to the temporary build directory and do a "bash -x spkg-install" and post the result.
Thanks!


---

Comment by git created at 2016-07-29 19:15:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-29 21:41:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-30 02:19:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-07-30 02:35:18

OK, I've solved this particular problem, but it needs more work regarding the shared libraries on Linux.


---

Comment by tscrim created at 2016-07-30 14:18:00

Sorry for the delay in getting back to this. Yes, this installed for me now. However, the `spkg-install` is non-trivial, so I would prefer someone with a bit more expertise, such as Jeroen (jdemeyer), Erik (embray) or Volker (vbraun), to look over it before giving this a positive review.


---

Comment by git created at 2016-07-31 23:16:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-31 23:45:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-07-31 23:47:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-07-31 23:51:51

Changing status from needs_work to needs_review.


---

Comment by mkoeppe created at 2016-07-31 23:51:51

OK, now it works also on Linux. Needs review.


---

Comment by tscrim created at 2016-08-02 17:05:00

FYI, recent changes also compile on my Ubuntu.

Erik, Volker, or Jeroen, do one of you have time to look over the build setup? Also, a more general question, can we rehost the tarball?


---

Comment by mkoeppe created at 2016-08-02 17:11:42

Replying to [comment:19 tscrim]:
> can we rehost the tarball?

No. Users need to download it themselves from the ZIB server. Details:
http://listserv.zib.de/pipermail/scip/2015-July/002448.html


---

Comment by jdemeyer created at 2016-08-03 11:12:04

Given that we cannot host the tarball, I would really want to see this as an "experimental" package, just like the component on this ticket suggests.

Besides this, if the package has successfully been built on Linux and OS X, that is sufficient for me to have positive_review.


---

Comment by tscrim created at 2016-08-03 14:09:22

Matthias, have you asked SCIP whether or not we could host the tarball on our mirrors and/or have Sage have some kind of automatic download of the tarball (but not hosted on our mirrors)?


---

Comment by dimpase created at 2016-08-03 14:11:47

We did have a long discussion with ZIB on this, and the answer was no. They want to count their downloads, full stop.


---

Comment by git created at 2016-08-03 18:02:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2016-08-03 18:07:49

Replying to [comment:22 jdemeyer]:
> Given that we cannot host the tarball, I would really want to see this as an "experimental" package, just like the component on this ticket suggests.

OK, done.
 
> Besides this, if the package has successfully been built on Linux and OS X, that is sufficient for me to have positive_review.

OK, could you take a look at #21151, which I have marked as a dependency - it's a minor update to TOPCOM so that it still installs when  scipoptsuite has been installed.


---

Comment by tscrim created at 2016-08-03 21:39:43

Replying to [comment:24 dimpase]:
> We did have a long discussion with ZIB on this, and the answer was no. They want to count their downloads, full stop.

We can't even set it up so that running `sage -i scipoptsuite` automatically goes through and does the download?


---

Comment by jdemeyer created at 2016-08-03 21:47:27

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2016-08-03 21:47:27

I think this is sufficient for an experimental package.


---

Comment by mkoeppe created at 2016-08-03 22:17:59

Replying to [comment:27 tscrim]:
> Replying to [comment:24 dimpase]:
> We can't even set it up so that running `sage -i scipoptsuite` automatically goes through and does the download?

As per http://listserv.zib.de/pipermail/scip/2015-July/002448.html :
  Q: Users could "download and install" this copy by running "sage -i scip"
 
  A: In this case you would have to ensure that people notice and acknowledge that
  they use SCIP under the Academic License, which excludes any commercial
  usage.

So some kind of license display and acknowledgement prompt could be done. I don't want to work on this, though. If you want to add this, please make a follow-up ticket.


---

Comment by mkoeppe created at 2016-08-03 22:18:10

Replying to [comment:28 jdemeyer]:
> I think this is sufficient for an experimental package.

Thanks!


---

Comment by mkoeppe created at 2016-08-03 22:18:33

#21151?


---

Comment by vbraun created at 2016-08-10 22:27:36

Resolution: fixed


---

Comment by jdemeyer created at 2016-10-14 13:04:06

Replying to [comment:11 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[c21e1bb](https://git.sagemath.org/sage.git/commit/?id=c21e1bb613acbad9a76957ce8bbe48ef1bb8bef5)||`Redo SCIP patches, install missing headers`||

Why were the patches put inside a `scip` subdirectory? I see no reason for that (`scipoptsuite` is the only package doing this)


---

Comment by mkoeppe created at 2016-10-14 15:30:00

SCIPoptsuite itself is a "distribution", consisting of SoPlex, SCIP, and other packages, whose tar.gz files are included in the tarball of SCIPoptsuite. (Not all of these packages have a separate upstream download.)

The patches are relative to the `scip` subdirectory that is created after unpacking the included SCIP tar.gz. They are generated from a git repository of SCIP.
