# Issue 13424: refactor xgcd

Issue created by migration from Trac.

Original creator: saraedum

Original creation time: 2012-10-19 15:53:40

Assignee: AlexGhitza

Currently, some classes define a _xgcd method which is called by a xgcd method of euclidean domain elements. Most elements already define xgcd directly, and I see no real use in having this method in between.

The attached patch renames all _xgcd methods to xgcd and also streamlines the use of `@`coerce_binop on them.

This is similar to #13441.


---

Comment by saraedum created at 2012-10-21 00:57:42

Changing status from new to needs_review.


---

Comment by saraedum created at 2012-10-27 15:05:47

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2012-10-27 15:05:47

I want to remove `self` from the docstrings.


---

Comment by saraedum created at 2012-11-19 19:14:39

The patch introduces a speed penalty for integers. Therefore I left the method `_xgcd` in for integers for places where this really matters. The following timings are `without/with` the patch applied.

```
sage: x,y=3,21
sage: timeit('x.xgcd(y)')
625 loops, best of 3: 986 ns/1.56 µs per loop
sage: timeit('x._xgcd(y)')
625 loops, best of 3: 713 ns/704 ns per loop
sage: x,y=1/3,1/21
sage: timeit('x.xgcd(y)')
625 loops, best of 3: --- --/7.92 µs per loop
sage: R.<t> = QQbar[]
sage: x,y=t-1,t^2-1
sage: timeit('x.xgcd(y)')
125 loops, best of 3: 1.17 ms/1.18 ms per loop
sage: R.<t> = PolynomialRing(GF(3),implementation="NTL")
sage: x,y=t-1,t^2-1
sage: timeit('x.xgcd(y)')
625 loops, best of 3: 80 µs/80.9 µs per loop
```


Notice that there was no `xgcd` method for rational numbers before since it was defined only for `PrincipalIdealDomainElement` which `FieldElement` does not inherit from.

Also the docstring for Integers talked about some `weirdness` that was actually not present anymore. I checked all combinations of integers between -20 and 20 but could not find a single case where the output of xgcd without the `minimal` option produced something really surprising.

If the patchbot does not find any problems, then this is ready for review.


---

Comment by saraedum created at 2012-11-19 19:14:52

Changing status from needs_work to needs_review.


---

Attachment

identical to the previous patch — but the patchbot somehow didn't want to pick up the new patch


---

Attachment

Apply only trac_13628.2.patch


---

Comment by tscrim created at 2012-11-25 08:06:46

Two minor things; the `INPUT:` and `OUTPUT:` blocks in the `fields.py` and `polynomial_modn_dense_ntl.pyx` files are indented one to many times and I prefer to have tuples in parenthesis `(r, s, t)` in the documentation. Thanks.


---

Comment by vbraun created at 2013-12-23 13:23:41

Please rebase...


---

Comment by niles created at 2014-01-28 15:22:11

rebased to sage 6.0 and converted to git branch; no other changes

merges cleanly in local repository in spite of what trac says
----
New commits:


---

Comment by tscrim created at 2014-01-30 16:55:51

The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. If you're happy with my changes, then go ahead and set this to positive review.
----
New commits:


---

Comment by niles created at 2014-01-30 18:11:20

Replying to [comment:11 tscrim]:
> The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. 


Got some failing doctests here; if you fix them I can give positive review to your changes.  (You could also change tuples in the documentation to use parentheses, which I like too.)  Are you giving positive review to the other parts of the patch?



```
sage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 254, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic
Failed example:
    [s for s in dir(Q.category().element_class) if not s.startswith('_')]
Expected:
    ['cartesian_product', 'is_idempotent', 'is_one', 'lift', 'xgcd']
Got:
    ['cartesian_product', 'is_idempotent', 'is_one', 'is_unit', 'lift']
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 267, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic
Failed example:
    [s for s in dir(Q.category().element_class) if not s.startswith('_')]
Expected:
    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift']
Got:
    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift', 'xgcd']
**********************************************************************



sage -t --long src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 5390, in sage.rings.integer.Integer._xgcd
Failed example:
    -5._xgcd(0, minimal=True)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: bad operand type for unary -: 'tuple'
**********************************************************************


sage -t --long src/sage/rings/arith.py
**********************************************************************
File "src/sage/rings/arith.py", line 1886, in sage.rings.arith.xgcd
Failed example:
    g, a, b = xgcd(5/1, 7/1); g, a, b
Expected:
    (1, 3, -2)
Got:
    (1, 1/5, 0)
**********************************************************************
```



---

Comment by git created at 2014-01-30 20:27:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-01-30 20:29:14

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-01-30 20:33:00

Fixed. The first two just had to be changed due to the method's definition moving locations. The third was an order of operations mistake. The last one, because `5/1` and `7/1` are in `\QQ`, I think is okay to change it to the output rather than treating them as integers which was what was previously happening.


---

Comment by niles created at 2014-01-31 15:25:17

Thanks for the fixes.  Checking the documentation, I found a couple of problems in `sage.rings.Integer`:  

* There is a typo "NOET" in the docstring for `xgcd`
* The MATH blocks for the Bezout identity in `xgcd` and `_xgcd` each have an extra `\rm`: The syntax `\mbox{\rm self}` renders as "\rm self".  Probably the block can just be replaced with a backtick-quoted line, since that's what's used in other xgcd docsstrings:

```
``g = s * self + t * n``
```

* `\rm self` occurs in another line of `_xgcd` docstring, but since this is an underscore method I don't know how to check the built docstring.  Maybe remove it since the other `\rm`'s caused trouble, but this is a minor point since no regular user will view the built documentation for `_xgcd`.

Everything else looks fine, so I can give positive review to the reviewer patch when these (admittedly annoying) details are fixed.


---

Comment by git created at 2014-01-31 15:41:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2014-01-31 15:48:53

Whoops, that typo was from me. I've fixed the MATH block to use `\mathrm{self}`. If that works for you, then you can set this to positive review. Thanks.


---

Comment by niles created at 2014-01-31 15:52:33

Changing status from needs_review to positive_review.


---

Comment by niles created at 2014-01-31 15:52:33

Looks good.


---

Comment by vbraun created at 2014-02-02 20:33:44

Resolution: fixed
