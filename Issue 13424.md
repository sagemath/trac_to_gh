# Issue 13424: refactor xgcd

archive/issues_013424.json:
```json
{
    "body": "Assignee: @aghitza\n\nCurrently, some classes define a _xgcd method which is called by a xgcd method of euclidean domain elements. Most elements already define xgcd directly, and I see no real use in having this method in between.\n\nThe attached patch renames all _xgcd methods to xgcd and also streamlines the use of `@`coerce_binop on them.\n\nThis is similar to #13441.\n\nIssue created by migration from https://trac.sagemath.org/ticket/13628\n\n",
    "created_at": "2012-10-19T15:53:40Z",
    "labels": [
        "basic arithmetic",
        "trivial",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.2",
    "title": "refactor xgcd",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13424",
    "user": "@saraedum"
}
```
Assignee: @aghitza

Currently, some classes define a _xgcd method which is called by a xgcd method of euclidean domain elements. Most elements already define xgcd directly, and I see no real use in having this method in between.

The attached patch renames all _xgcd methods to xgcd and also streamlines the use of `@`coerce_binop on them.

This is similar to #13441.

Issue created by migration from https://trac.sagemath.org/ticket/13628





---

archive/issue_comments_165469.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2012-10-21T00:57:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165469",
    "user": "@saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_165470.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2012-10-27T15:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165470",
    "user": "@saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_165471.json:
```json
{
    "body": "I want to remove `self` from the docstrings.",
    "created_at": "2012-10-27T15:05:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165471",
    "user": "@saraedum"
}
```

I want to remove `self` from the docstrings.



---

archive/issue_comments_165472.json:
```json
{
    "body": "The patch introduces a speed penalty for integers. Therefore I left the method `_xgcd` in for integers for places where this really matters. The following timings are `without/with` the patch applied.\n\n```\nsage: x,y=3,21\nsage: timeit('x.xgcd(y)')\n625 loops, best of 3: 986 ns/1.56 \u00b5s per loop\nsage: timeit('x._xgcd(y)')\n625 loops, best of 3: 713 ns/704 ns per loop\nsage: x,y=1/3,1/21\nsage: timeit('x.xgcd(y)')\n625 loops, best of 3: --- --/7.92 \u00b5s per loop\nsage: R.<t> = QQbar[]\nsage: x,y=t-1,t^2-1\nsage: timeit('x.xgcd(y)')\n125 loops, best of 3: 1.17 ms/1.18 ms per loop\nsage: R.<t> = PolynomialRing(GF(3),implementation=\"NTL\")\nsage: x,y=t-1,t^2-1\nsage: timeit('x.xgcd(y)')\n625 loops, best of 3: 80 \u00b5s/80.9 \u00b5s per loop\n```\n\n\nNotice that there was no `xgcd` method for rational numbers before since it was defined only for `PrincipalIdealDomainElement` which `FieldElement` does not inherit from.\n\nAlso the docstring for Integers talked about some `weirdness` that was actually not present anymore. I checked all combinations of integers between -20 and 20 but could not find a single case where the output of xgcd without the `minimal` option produced something really surprising.\n\nIf the patchbot does not find any problems, then this is ready for review.",
    "created_at": "2012-11-19T19:14:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165472",
    "user": "@saraedum"
}
```

The patch introduces a speed penalty for integers. Therefore I left the method `_xgcd` in for integers for places where this really matters. The following timings are `without/with` the patch applied.

```
sage: x,y=3,21
sage: timeit('x.xgcd(y)')
625 loops, best of 3: 986 ns/1.56 µs per loop
sage: timeit('x._xgcd(y)')
625 loops, best of 3: 713 ns/704 ns per loop
sage: x,y=1/3,1/21
sage: timeit('x.xgcd(y)')
625 loops, best of 3: --- --/7.92 µs per loop
sage: R.<t> = QQbar[]
sage: x,y=t-1,t^2-1
sage: timeit('x.xgcd(y)')
125 loops, best of 3: 1.17 ms/1.18 ms per loop
sage: R.<t> = PolynomialRing(GF(3),implementation="NTL")
sage: x,y=t-1,t^2-1
sage: timeit('x.xgcd(y)')
625 loops, best of 3: 80 µs/80.9 µs per loop
```


Notice that there was no `xgcd` method for rational numbers before since it was defined only for `PrincipalIdealDomainElement` which `FieldElement` does not inherit from.

Also the docstring for Integers talked about some `weirdness` that was actually not present anymore. I checked all combinations of integers between -20 and 20 but could not find a single case where the output of xgcd without the `minimal` option produced something really surprising.

If the patchbot does not find any problems, then this is ready for review.



---

archive/issue_comments_165473.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2012-11-19T19:14:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165473",
    "user": "@saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_165474.json:
```json
{
    "body": "Attachment [trac_13628.patch](tarball://root/attachments/some-uuid/ticket13628/trac_13628.patch) by @saraedum created at 2012-11-22 13:23:59\n\nidentical to the previous patch \u2014 but the patchbot somehow didn't want to pick up the new patch",
    "created_at": "2012-11-22T13:23:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165474",
    "user": "@saraedum"
}
```

Attachment [trac_13628.patch](tarball://root/attachments/some-uuid/ticket13628/trac_13628.patch) by @saraedum created at 2012-11-22 13:23:59

identical to the previous patch — but the patchbot somehow didn't want to pick up the new patch



---

archive/issue_comments_165475.json:
```json
{
    "body": "Attachment [trac_13628.2.patch](tarball://root/attachments/some-uuid/ticket13628/trac_13628.2.patch) by @saraedum created at 2012-11-22 13:24:49\n\nApply only trac_13628.2.patch",
    "created_at": "2012-11-22T13:24:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165475",
    "user": "@saraedum"
}
```

Attachment [trac_13628.2.patch](tarball://root/attachments/some-uuid/ticket13628/trac_13628.2.patch) by @saraedum created at 2012-11-22 13:24:49

Apply only trac_13628.2.patch



---

archive/issue_comments_165476.json:
```json
{
    "body": "Two minor things; the `INPUT:` and `OUTPUT:` blocks in the `fields.py` and `polynomial_modn_dense_ntl.pyx` files are indented one to many times and I prefer to have tuples in parenthesis `(r, s, t)` in the documentation. Thanks.",
    "created_at": "2012-11-25T08:06:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165476",
    "user": "@tscrim"
}
```

Two minor things; the `INPUT:` and `OUTPUT:` blocks in the `fields.py` and `polynomial_modn_dense_ntl.pyx` files are indented one to many times and I prefer to have tuples in parenthesis `(r, s, t)` in the documentation. Thanks.



---

archive/issue_comments_165477.json:
```json
{
    "body": "Please rebase...",
    "created_at": "2013-12-23T13:23:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165477",
    "user": "@vbraun"
}
```

Please rebase...



---

archive/issue_comments_165478.json:
```json
{
    "body": "rebased to sage 6.0 and converted to git branch; no other changes\n\nmerges cleanly in local repository in spite of what trac says\n----\nNew commits:",
    "created_at": "2014-01-28T15:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165478",
    "user": "@nilesjohnson"
}
```

rebased to sage 6.0 and converted to git branch; no other changes

merges cleanly in local repository in spite of what trac says
----
New commits:



---

archive/issue_comments_165479.json:
```json
{
    "body": "The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. If you're happy with my changes, then go ahead and set this to positive review.\n----\nNew commits:",
    "created_at": "2014-01-30T16:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165479",
    "user": "@tscrim"
}
```

The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. If you're happy with my changes, then go ahead and set this to positive review.
----
New commits:



---

archive/issue_comments_165480.json:
```json
{
    "body": "Replying to [comment:11 tscrim]:\n> The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. \n\n\nGot some failing doctests here; if you fix them I can give positive review to your changes.  (You could also change tuples in the documentation to use parentheses, which I like too.)  Are you giving positive review to the other parts of the patch?\n\n\n\n```\nsage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 254, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic\nFailed example:\n    [s for s in dir(Q.category().element_class) if not s.startswith('_')]\nExpected:\n    ['cartesian_product', 'is_idempotent', 'is_one', 'lift', 'xgcd']\nGot:\n    ['cartesian_product', 'is_idempotent', 'is_one', 'is_unit', 'lift']\n**********************************************************************\nFile \"src/sage/rings/polynomial/polynomial_quotient_ring.py\", line 267, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic\nFailed example:\n    [s for s in dir(Q.category().element_class) if not s.startswith('_')]\nExpected:\n    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift']\nGot:\n    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift', 'xgcd']\n**********************************************************************\n\n\n\nsage -t --long src/sage/rings/integer.pyx\n**********************************************************************\nFile \"src/sage/rings/integer.pyx\", line 5390, in sage.rings.integer.Integer._xgcd\nFailed example:\n    -5._xgcd(0, minimal=True)\nException raised:\n    Traceback (most recent call last):\n    ...\n    TypeError: bad operand type for unary -: 'tuple'\n**********************************************************************\n\n\nsage -t --long src/sage/rings/arith.py\n**********************************************************************\nFile \"src/sage/rings/arith.py\", line 1886, in sage.rings.arith.xgcd\nFailed example:\n    g, a, b = xgcd(5/1, 7/1); g, a, b\nExpected:\n    (1, 3, -2)\nGot:\n    (1, 1/5, 0)\n**********************************************************************\n```\n",
    "created_at": "2014-01-30T18:11:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165480",
    "user": "@nilesjohnson"
}
```

Replying to [comment:11 tscrim]:
> The branch I've attached is based on `develop` (and fixes the merge conflcit) and has some minor docstring review changes. 


Got some failing doctests here; if you fix them I can give positive review to your changes.  (You could also change tuples in the documentation to use parentheses, which I like too.)  Are you giving positive review to the other parts of the patch?



```
sage -t --long src/sage/rings/polynomial/polynomial_quotient_ring.py
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 254, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic
Failed example:
    [s for s in dir(Q.category().element_class) if not s.startswith('_')]
Expected:
    ['cartesian_product', 'is_idempotent', 'is_one', 'lift', 'xgcd']
Got:
    ['cartesian_product', 'is_idempotent', 'is_one', 'is_unit', 'lift']
**********************************************************************
File "src/sage/rings/polynomial/polynomial_quotient_ring.py", line 267, in sage.rings.polynomial.polynomial_quotient_ring.PolynomialQuotientRing_generic
Failed example:
    [s for s in dir(Q.category().element_class) if not s.startswith('_')]
Expected:
    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift']
Got:
    ['cartesian_product', 'gcd', 'is_idempotent', 'is_one', 'is_unit', 'lcm', 'lift', 'xgcd']
**********************************************************************



sage -t --long src/sage/rings/integer.pyx
**********************************************************************
File "src/sage/rings/integer.pyx", line 5390, in sage.rings.integer.Integer._xgcd
Failed example:
    -5._xgcd(0, minimal=True)
Exception raised:
    Traceback (most recent call last):
    ...
    TypeError: bad operand type for unary -: 'tuple'
**********************************************************************


sage -t --long src/sage/rings/arith.py
**********************************************************************
File "src/sage/rings/arith.py", line 1886, in sage.rings.arith.xgcd
Failed example:
    g, a, b = xgcd(5/1, 7/1); g, a, b
Expected:
    (1, 3, -2)
Got:
    (1, 1/5, 0)
**********************************************************************
```




---

archive/issue_comments_165481.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-30T20:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165481",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_165482.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-30T20:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165482",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_165483.json:
```json
{
    "body": "Fixed. The first two just had to be changed due to the method's definition moving locations. The third was an order of operations mistake. The last one, because `5/1` and `7/1` are in `\\QQ`, I think is okay to change it to the output rather than treating them as integers which was what was previously happening.",
    "created_at": "2014-01-30T20:33:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165483",
    "user": "@tscrim"
}
```

Fixed. The first two just had to be changed due to the method's definition moving locations. The third was an order of operations mistake. The last one, because `5/1` and `7/1` are in `\QQ`, I think is okay to change it to the output rather than treating them as integers which was what was previously happening.



---

archive/issue_comments_165484.json:
```json
{
    "body": "Thanks for the fixes.  Checking the documentation, I found a couple of problems in `sage.rings.Integer`:  \n\n* There is a typo \"NOET\" in the docstring for `xgcd`\n* The MATH blocks for the Bezout identity in `xgcd` and `_xgcd` each have an extra `\\rm`: The syntax `\\mbox{\\rm self}` renders as \"\\rm self\".  Probably the block can just be replaced with a backtick-quoted line, since that's what's used in other xgcd docsstrings:\n\n```\n``g = s * self + t * n``\n```\n\n* `\\rm self` occurs in another line of `_xgcd` docstring, but since this is an underscore method I don't know how to check the built docstring.  Maybe remove it since the other `\\rm`'s caused trouble, but this is a minor point since no regular user will view the built documentation for `_xgcd`.\n\nEverything else looks fine, so I can give positive review to the reviewer patch when these (admittedly annoying) details are fixed.",
    "created_at": "2014-01-31T15:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165484",
    "user": "@nilesjohnson"
}
```

Thanks for the fixes.  Checking the documentation, I found a couple of problems in `sage.rings.Integer`:  

* There is a typo "NOET" in the docstring for `xgcd`
* The MATH blocks for the Bezout identity in `xgcd` and `_xgcd` each have an extra `\rm`: The syntax `\mbox{\rm self}` renders as "\rm self".  Probably the block can just be replaced with a backtick-quoted line, since that's what's used in other xgcd docsstrings:

```
``g = s * self + t * n``
```

* `\rm self` occurs in another line of `_xgcd` docstring, but since this is an underscore method I don't know how to check the built docstring.  Maybe remove it since the other `\rm`'s caused trouble, but this is a minor point since no regular user will view the built documentation for `_xgcd`.

Everything else looks fine, so I can give positive review to the reviewer patch when these (admittedly annoying) details are fixed.



---

archive/issue_comments_165485.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-01-31T15:41:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165485",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_165486.json:
```json
{
    "body": "Whoops, that typo was from me. I've fixed the MATH block to use `\\mathrm{self}`. If that works for you, then you can set this to positive review. Thanks.",
    "created_at": "2014-01-31T15:48:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165486",
    "user": "@tscrim"
}
```

Whoops, that typo was from me. I've fixed the MATH block to use `\mathrm{self}`. If that works for you, then you can set this to positive review. Thanks.



---

archive/issue_comments_165487.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-01-31T15:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165487",
    "user": "@nilesjohnson"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_165488.json:
```json
{
    "body": "Looks good.",
    "created_at": "2014-01-31T15:52:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165488",
    "user": "@nilesjohnson"
}
```

Looks good.



---

archive/issue_comments_165489.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-02-02T20:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13424",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13424#issuecomment-165489",
    "user": "@vbraun"
}
```

Resolution: fixed
