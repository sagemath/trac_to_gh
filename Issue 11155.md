# Issue 11155: isogeny code uses deprecated(?) multi-variate gcd

archive/issues_011155.json:
```json
{
    "body": "Assignee: cremona\n\nKeywords: isogeny multivariate dual\n\nIn sage.schemes.elliptic_curves.ell_curve_isogeny (of sage 4.6.2) the routine two_torsion_part() invokes a gcd on two polynomials.  When the polynomials belong to a multivariate ring, an error occurs.  Perhaps this is because the gcd routine in sage.rings.polynomial.multi_polynomial_element has been commented out (because it uses Singular?!).\n\nConverting psi (and perhaps psi2) to univariate polynomials within two_torsion_part() before taking the gcd seems to work, but there seems to be other code in the module which uses a multivariate ring when a univariate ring would suffice (e.g. in __init_from_kernel_polynomial).\n\nI discovered this error when trying to create a dual isogeny (for an elliptic curve over Q(t)).  The original isogeny was a cyclic 2-isogeny and thus the dual should also be a cyclic 2-isogeny.  Without giving more details on how I created the curve, let me simply report the error message which results when I call isogeny.dual():\n\nTraceback (most recent call last):\n  File \"<stdin>\", line 1, in <module>\n  File \"_sage_input_5.py\", line 10, in <module>\n    exec compile(u'open(\"___code___.py\",\"w\").write(\"# -*- coding: utf-8 -*-\\\\n\" + _support_.preparse_worksheet_cell(base64.b64decode(\"cHNpID0gcGhpLmR1YWwoKQ==\"),globals())+\"\\\\n\"); execfile(os.path.abspath(\"___code___.py\"))\n  File \"\", line 1, in <module>\n    \n  File \"/private/var/folders/4V/4VAOdForFpanThca5kJ5xE+++TI/-Tmp-/tmp8DXIBC/___code___.py\", line 2, in <module>\n    exec compile(u'psi = phi.dual()\n  File \"\", line 1, in <module>\n    \n  File \"/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 3248, in dual\n    phi_hat = EllipticCurveIsogeny(E1, None, E2, d)\n  File \"/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 914, in __init__\n    self.__init_from_kernel_polynomial(kernel, degree)\n  File \"/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 2038, in __init_from_kernel_polynomial\n    psi_G = two_torsion_part(E, poly_ring, psi, degree);\n  File \"/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py\", line 453, in two_torsion_part\n    psi_G = poly_ring(psi.gcd(psi_2))\n  File \"element.pyx\", line 327, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2715)\n  File \"parent.pyx\", line 277, in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2841)\n  File \"parent.pyx\", line 177, in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2663)\nAttributeError: 'MPolynomial_polydict' object has no attribute 'gcd'\n\nIssue created by migration from https://trac.sagemath.org/ticket/11327\n\n",
    "created_at": "2011-05-11T16:27:45Z",
    "labels": [
        "elliptic curves",
        "major",
        "bug"
    ],
    "title": "isogeny code uses deprecated(?) multi-variate gcd",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11155",
    "user": "cjh"
}
```
Assignee: cremona

Keywords: isogeny multivariate dual

In sage.schemes.elliptic_curves.ell_curve_isogeny (of sage 4.6.2) the routine two_torsion_part() invokes a gcd on two polynomials.  When the polynomials belong to a multivariate ring, an error occurs.  Perhaps this is because the gcd routine in sage.rings.polynomial.multi_polynomial_element has been commented out (because it uses Singular?!).

Converting psi (and perhaps psi2) to univariate polynomials within two_torsion_part() before taking the gcd seems to work, but there seems to be other code in the module which uses a multivariate ring when a univariate ring would suffice (e.g. in __init_from_kernel_polynomial).

I discovered this error when trying to create a dual isogeny (for an elliptic curve over Q(t)).  The original isogeny was a cyclic 2-isogeny and thus the dual should also be a cyclic 2-isogeny.  Without giving more details on how I created the curve, let me simply report the error message which results when I call isogeny.dual():

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "_sage_input_5.py", line 10, in <module>
    exec compile(u'open("___code___.py","w").write("# -*- coding: utf-8 -*-\\n" + _support_.preparse_worksheet_cell(base64.b64decode("cHNpID0gcGhpLmR1YWwoKQ=="),globals())+"\\n"); execfile(os.path.abspath("___code___.py"))
  File "", line 1, in <module>
    
  File "/private/var/folders/4V/4VAOdForFpanThca5kJ5xE+++TI/-Tmp-/tmp8DXIBC/___code___.py", line 2, in <module>
    exec compile(u'psi = phi.dual()
  File "", line 1, in <module>
    
  File "/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 3248, in dual
    phi_hat = EllipticCurveIsogeny(E1, None, E2, d)
  File "/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 914, in __init__
    self.__init_from_kernel_polynomial(kernel, degree)
  File "/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 2038, in __init_from_kernel_polynomial
    psi_G = two_torsion_part(E, poly_ring, psi, degree);
  File "/Applications/sage/local/lib/python2.6/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py", line 453, in two_torsion_part
    psi_G = poly_ring(psi.gcd(psi_2))
  File "element.pyx", line 327, in sage.structure.element.Element.__getattr__ (sage/structure/element.c:2715)
  File "parent.pyx", line 277, in sage.structure.parent.getattr_from_other_class (sage/structure/parent.c:2841)
  File "parent.pyx", line 177, in sage.structure.parent.raise_attribute_error (sage/structure/parent.c:2663)
AttributeError: 'MPolynomial_polydict' object has no attribute 'gcd'

Issue created by migration from https://trac.sagemath.org/ticket/11327





---

archive/issue_comments_122269.json:
```json
{
    "body": "I have run into this myself, but never had time to fix it as the problem always seemed to grow bigger.  Feel free to make a patch!  Before you do, please note that there are other patches around which affect this file -- one of which splits it into two -- so it would best to work on top of that.",
    "created_at": "2011-05-11T16:34:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122269",
    "user": "cremona"
}
```

I have run into this myself, but never had time to fix it as the problem always seemed to grow bigger.  Feel free to make a patch!  Before you do, please note that there are other patches around which affect this file -- one of which splits it into two -- so it would best to work on top of that.



---

archive/issue_comments_122270.json:
```json
{
    "body": "Applies to 4.7.1.rc1",
    "created_at": "2011-07-29T14:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122270",
    "user": "cremona"
}
```

Applies to 4.7.1.rc1



---

archive/issue_comments_122271.json:
```json
{
    "body": "Attachment [trac_11327-isogs.patch](tarball://root/attachments/some-uuid/ticket11327/trac_11327-isogs.patch) by cremona created at 2011-07-29 14:43:20\n\nThe patch trac_11327-isogs.patch was made by me from an edited version of ell_curve_isogeny.py which cjh sent me.  It needs work.",
    "created_at": "2011-07-29T14:43:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122271",
    "user": "cremona"
}
```

Attachment [trac_11327-isogs.patch](tarball://root/attachments/some-uuid/ticket11327/trac_11327-isogs.patch) by cremona created at 2011-07-29 14:43:20

The patch trac_11327-isogs.patch was made by me from an edited version of ell_curve_isogeny.py which cjh sent me.  It needs work.



---

archive/issue_comments_122272.json:
```json
{
    "body": "Very sorry to have forgotten about this after 3 years.  I just created a new ticket and a simpler solution to a similar problem at #16779.  The patch I will put there does not solve the problem over function fields, and this ticket should remain open but with #16779 as a dependency.",
    "created_at": "2014-08-07T09:32:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122272",
    "user": "cremona"
}
```

Very sorry to have forgotten about this after 3 years.  I just created a new ticket and a simpler solution to a similar problem at #16779.  The patch I will put there does not solve the problem over function fields, and this ticket should remain open but with #16779 as a dependency.



---

archive/issue_comments_122273.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-09T16:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122273",
    "user": "cremona"
}
```

New commits:



---

archive/issue_comments_122274.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-09T16:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122274",
    "user": "cremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_122275.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-13T10:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122275",
    "user": "wuthrich"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_122276.json:
```json
{
    "body": "All tests pass and the problem is solved indeed. Thanks also for all the improvments on the documentation.\n\nTiny: There is a \"#\" appearing in the documentation of the class `EllipticCurveIsogeny`. So I changed that.\n----\nNew commits:",
    "created_at": "2014-08-13T10:42:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122276",
    "user": "wuthrich"
}
```

All tests pass and the problem is solved indeed. Thanks also for all the improvments on the documentation.

Tiny: There is a "#" appearing in the documentation of the class `EllipticCurveIsogeny`. So I changed that.
----
New commits:



---

archive/issue_comments_122277.json:
```json
{
    "body": "Thanks a lot!",
    "created_at": "2014-08-13T10:53:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122277",
    "user": "cremona"
}
```

Thanks a lot!



---

archive/issue_comments_122278.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-13T17:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11155",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11155#issuecomment-122278",
    "user": "vbraun"
}
```

Resolution: fixed
