# Issue 18323: Upgrade arb to 2.6.0

archive/issues_018323.json:
```json
{
    "body": "CC:  @mezzarobba @fredrik-johansson @jhpalmieri\n\nUpgrade the optional arb spkg to version 2.6.0.\n\nTar.gz file at [https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz](https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz)\n\nIssue created by migration from https://trac.sagemath.org/ticket/18560\n\n",
    "created_at": "2015-05-31T09:32:48Z",
    "labels": [
        "packages: optional",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.8",
    "title": "Upgrade arb to 2.6.0",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18323",
    "user": "@cheuberg"
}
```
CC:  @mezzarobba @fredrik-johansson @jhpalmieri

Upgrade the optional arb spkg to version 2.6.0.

Tar.gz file at [https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz](https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz)

Issue created by migration from https://trac.sagemath.org/ticket/18560





---

archive/issue_comments_248580.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-05-31T09:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248580",
    "user": "@cheuberg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_248581.json:
```json
{
    "body": "Changing keywords from \"\" to \"arb\".",
    "created_at": "2015-05-31T09:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248581",
    "user": "@cheuberg"
}
```

Changing keywords from "" to "arb".



---

archive/issue_comments_248582.json:
```json
{
    "body": "New commits:",
    "created_at": "2015-05-31T09:53:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248582",
    "user": "@cheuberg"
}
```

New commits:



---

archive/issue_comments_248583.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-05-31T10:18:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248583",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248584.json:
```json
{
    "body": "Replying to [comment:2 git]:\n> Branch pushed to git repo; I updated commit sha1. New commits:\n> ||[8d0b599](http://git.sagemath.org/sage.git/commit/?id=8d0b5995900b15f4594421f9baac0fe0faaa6574)||`Trac #18560: fix doctests after arb upgrade`||\n\nPerhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?",
    "created_at": "2015-06-01T07:07:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248584",
    "user": "@mezzarobba"
}
```

Replying to [comment:2 git]:
> Branch pushed to git repo; I updated commit sha1. New commits:
> ||[8d0b599](http://git.sagemath.org/sage.git/commit/?id=8d0b5995900b15f4594421f9baac0fe0faaa6574)||`Trac #18560: fix doctests after arb upgrade`||

Perhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?



---

archive/issue_comments_248585.json:
```json
{
    "body": "Replying to [comment:3 mmezzarobba]:\n> Perhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?\n\n- I do not know whether the doctest framework can handle this --- how would it cope with the special representation of a `RealBall`?\n- I think that at least some kind of plausibility checking is interesting --- if the old and new balls do not intersect, we'd be in trouble.\n- On the other hand, changing doctests with each new revision of arb seems to be uncomfortable, too.",
    "created_at": "2015-06-01T07:24:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248585",
    "user": "@cheuberg"
}
```

Replying to [comment:3 mmezzarobba]:
> Perhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?

- I do not know whether the doctest framework can handle this --- how would it cope with the special representation of a `RealBall`?
- I think that at least some kind of plausibility checking is interesting --- if the old and new balls do not intersect, we'd be in trouble.
- On the other hand, changing doctests with each new revision of arb seems to be uncomfortable, too.



---

archive/issue_comments_248586.json:
```json
{
    "body": "Replying to [comment:4 cheuberg]:\n> Replying to [comment:3 mmezzarobba]:\n> > Perhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?\n> \n> - I do not know whether the doctest framework can handle this --- how would it cope with the special representation of a `RealBall`?\n\nThe tolerance simply applies independently to the center and the radius, so that in many cases `# abs tol 1e-15` will do something reasonable.",
    "created_at": "2015-06-01T07:31:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248586",
    "user": "@mezzarobba"
}
```

Replying to [comment:4 cheuberg]:
> Replying to [comment:3 mmezzarobba]:
> > Perhaps it would be better to add tolerances so that the tests pass with both versions of arb. What do you think?
> 
> - I do not know whether the doctest framework can handle this --- how would it cope with the special representation of a `RealBall`?

The tolerance simply applies independently to the center and the radius, so that in many cases `# abs tol 1e-15` will do something reasonable.



---

archive/issue_comments_248587.json:
```json
{
    "body": "This builds and passes its test suite on OS X 10.10.3.",
    "created_at": "2015-06-01T15:28:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248587",
    "user": "@jhpalmieri"
}
```

This builds and passes its test suite on OS X 10.10.3.



---

archive/issue_comments_248588.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-01T15:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248588",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248589.json:
```json
{
    "body": "\n```\nbash-3.2$ ./sage -i arb\nFound local metadata for arb-2.6.0\nFound local sources at /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz\nChecksum: e8c367b9f617262b4a7e9956cf49b6acf5c0db24 vs 096b61d0576821d9ef6c1d0880df3d225f8bfdf3\nInvalid checksum for /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz\n```\n",
    "created_at": "2015-06-01T15:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248589",
    "user": "@jdemeyer"
}
```


```
bash-3.2$ ./sage -i arb
Found local metadata for arb-2.6.0
Found local sources at /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz
Checksum: e8c367b9f617262b4a7e9956cf49b6acf5c0db24 vs 096b61d0576821d9ef6c1d0880df3d225f8bfdf3
Invalid checksum for /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz
```




---

archive/issue_comments_248590.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-01T16:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248590",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248591.json:
```json
{
    "body": "Replying to [comment:7 jdemeyer]:\n> {{{\n> bash-3.2$ ./sage -i arb\n> Found local metadata for arb-2.6.0\n> Found local sources at /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz\n> Checksum: e8c367b9f617262b4a7e9956cf49b6acf5c0db24 vs 096b61d0576821d9ef6c1d0880df3d225f8bfdf3\n> Invalid checksum for /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz\n> }}}\n\nI do not understand what happened.\nI just tried it again:\n\n```\n$ wget https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz\n...\n$ sha1sum 2.6.0.tar.gz \ne8c367b9f617262b4a7e9956cf49b6acf5c0db24  2.6.0.tar.gz\n```\n\nwhich is what the checksum should be.\n\nI now put a copy of the tar.gz file to http://www.math.aau.at/user/cheuberg/sage/arb-2.6.0.tar.gz , could you please try that file (which also has a better file name for our purposes)? Thank you.\n\nAs I cannot reproduce the problem, I set the ticket back to needs_review.",
    "created_at": "2015-06-01T16:17:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248591",
    "user": "@cheuberg"
}
```

Replying to [comment:7 jdemeyer]:
> {{{
> bash-3.2$ ./sage -i arb
> Found local metadata for arb-2.6.0
> Found local sources at /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz
> Checksum: e8c367b9f617262b4a7e9956cf49b6acf5c0db24 vs 096b61d0576821d9ef6c1d0880df3d225f8bfdf3
> Invalid checksum for /Users/jdemeyer/sage/upstream/arb-2.6.0.tar.gz
> }}}

I do not understand what happened.
I just tried it again:

```
$ wget https://github.com/fredrik-johansson/arb/archive/2.6.0.tar.gz
...
$ sha1sum 2.6.0.tar.gz 
e8c367b9f617262b4a7e9956cf49b6acf5c0db24  2.6.0.tar.gz
```

which is what the checksum should be.

I now put a copy of the tar.gz file to http://www.math.aau.at/user/cheuberg/sage/arb-2.6.0.tar.gz , could you please try that file (which also has a better file name for our purposes)? Thank you.

As I cannot reproduce the problem, I set the ticket back to needs_review.



---

archive/issue_comments_248592.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-01T16:17:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248592",
    "user": "@cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248593.json:
```json
{
    "body": "OK, the problem was that `curl` (which I used to download the package) doesn't follow redirects.",
    "created_at": "2015-06-01T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248593",
    "user": "@jdemeyer"
}
```

OK, the problem was that `curl` (which I used to download the package) doesn't follow redirects.



---

archive/issue_comments_248594.json:
```json
{
    "body": "Why are you choosing absolute tolerances over relative tolerances in the doctests?",
    "created_at": "2015-06-02T12:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248594",
    "user": "@jdemeyer"
}
```

Why are you choosing absolute tolerances over relative tolerances in the doctests?



---

archive/issue_comments_248595.json:
```json
{
    "body": "Can you make the files `spkg-install` and `spkg-check` executable please?",
    "created_at": "2015-06-02T12:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248595",
    "user": "@jdemeyer"
}
```

Can you make the files `spkg-install` and `spkg-check` executable please?



---

archive/issue_comments_248596.json:
```json
{
    "body": "About the doctests: I would actually prefer to just change the doctests without tolerance. It's kind of ugly to have to add tolerances everywhere. And most tests don't change, so it's not so bad.",
    "created_at": "2015-06-02T12:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248596",
    "user": "@jdemeyer"
}
```

About the doctests: I would actually prefer to just change the doctests without tolerance. It's kind of ugly to have to add tolerances everywhere. And most tests don't change, so it's not so bad.



---

archive/issue_comments_248597.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-06-02T12:31:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248597",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_248598.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-06-02T18:06:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248598",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_248599.json:
```json
{
    "body": "Replying to [comment:14 jdemeyer]:\n> Why are you choosing absolute tolerances over relative tolerances in the doctests?\n\nIn most cases, the relative changes in the radius is around 0.1, but I would not like to allow a relative tolerance of 0.1 for the center of the ball. Unless there is a way of specifying different relative tolerances for radius and center of the ball?",
    "created_at": "2015-06-02T18:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248599",
    "user": "@cheuberg"
}
```

Replying to [comment:14 jdemeyer]:
> Why are you choosing absolute tolerances over relative tolerances in the doctests?

In most cases, the relative changes in the radius is around 0.1, but I would not like to allow a relative tolerance of 0.1 for the center of the ball. Unless there is a way of specifying different relative tolerances for radius and center of the ball?



---

archive/issue_comments_248600.json:
```json
{
    "body": "Replying to [comment:16 jdemeyer]:\n> About the doctests: I would actually prefer to just change the doctests without tolerance. It's kind of ugly to have to add tolerances everywhere. And most tests don't change, so it's not so bad.\n\nIt might well be the case that the tolerances I introduced above might be too small when the upgrade to the next arb version or that other tests require new tolerances. At the moment, we could easily go back to the modified doctests I already reverted once. And switching back to tolerances when we realize that we keep changing doctests with every arb version would not to be hard, either.\n\nOTOH: I am not sure whether all machines will return the same error in all computations, but that's perhaps something that Fredrik could comment on?\n\nMarc, you suggested using tolerances. Any further comments on this issue?",
    "created_at": "2015-06-02T18:21:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248600",
    "user": "@cheuberg"
}
```

Replying to [comment:16 jdemeyer]:
> About the doctests: I would actually prefer to just change the doctests without tolerance. It's kind of ugly to have to add tolerances everywhere. And most tests don't change, so it's not so bad.

It might well be the case that the tolerances I introduced above might be too small when the upgrade to the next arb version or that other tests require new tolerances. At the moment, we could easily go back to the modified doctests I already reverted once. And switching back to tolerances when we realize that we keep changing doctests with every arb version would not to be hard, either.

OTOH: I am not sure whether all machines will return the same error in all computations, but that's perhaps something that Fredrik could comment on?

Marc, you suggested using tolerances. Any further comments on this issue?



---

archive/issue_comments_248601.json:
```json
{
    "body": "Replying to [comment:20 cheuberg]:\n> OTOH: I am not sure whether all machines will return the same error in all computations\n\nAs far as I understand, yes, they will.\n\n> Marc, you suggested using tolerances. Any further comments on this issue?\n\nNot really. I agree with you on the choice of absolute tolerances, and I don't understand Jeroen's argument against tolerances, but honestly I don't care much.",
    "created_at": "2015-06-03T06:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248601",
    "user": "@mezzarobba"
}
```

Replying to [comment:20 cheuberg]:
> OTOH: I am not sure whether all machines will return the same error in all computations

As far as I understand, yes, they will.

> Marc, you suggested using tolerances. Any further comments on this issue?

Not really. I agree with you on the choice of absolute tolerances, and I don't understand Jeroen's argument against tolerances, but honestly I don't care much.



---

archive/issue_comments_248602.json:
```json
{
    "body": "Replying to [comment:21 mmezzarobba]:\n> I don't understand Jeroen's argument against tolerances, but honestly I don't care much.\nThe problem with tolerances is:\n1. since a ball is defined by 2 numbers, it will always be awkward to use tolerances since you cannot easily give different tolerances for the center and radius.\n2. it makes reviewing harder, since a reviewer must check whether all the given tolerances make sense\n3. `arb` is supposed to be system-independent, so we actually want to know if even the last digit of some result is wrong.",
    "created_at": "2015-06-03T08:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248602",
    "user": "@jdemeyer"
}
```

Replying to [comment:21 mmezzarobba]:
> I don't understand Jeroen's argument against tolerances, but honestly I don't care much.
The problem with tolerances is:
1. since a ball is defined by 2 numbers, it will always be awkward to use tolerances since you cannot easily give different tolerances for the center and radius.
2. it makes reviewing harder, since a reviewer must check whether all the given tolerances make sense
3. `arb` is supposed to be system-independent, so we actually want to know if even the last digit of some result is wrong.



---

archive/issue_comments_248603.json:
```json
{
    "body": "Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided, but it's safest to think of arb as actually employing randomization, which unfortunately doesn't play well with doctesting. Two reasonable workarounds would be:\n\n1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.\n\n2. Implement a doctest directive that parses intervals and checks whether the actual and expected outputs overlap (this could also take a tolerance and verify that the new actual output is not too imprecise, e.g. 53-bit pi suddenly coming out as [3.1 +/- 0.1]).",
    "created_at": "2015-06-03T13:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248603",
    "user": "@fredrik-johansson"
}
```

Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided, but it's safest to think of arb as actually employing randomization, which unfortunately doesn't play well with doctesting. Two reasonable workarounds would be:

1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.

2. Implement a doctest directive that parses intervals and checks whether the actual and expected outputs overlap (this could also take a tolerance and verify that the new actual output is not too imprecise, e.g. 53-bit pi suddenly coming out as [3.1 +/- 0.1]).



---

archive/issue_comments_248604.json:
```json
{
    "body": "The two statements seem to contradict each other:\n\nReplying to [comment:23 fredrik.johansson]:\n> Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided\n\n> it's safest to think of arb as actually employing randomization",
    "created_at": "2015-06-04T06:15:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248604",
    "user": "@jdemeyer"
}
```

The two statements seem to contradict each other:

Replying to [comment:23 fredrik.johansson]:
> Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided

> it's safest to think of arb as actually employing randomization



---

archive/issue_comments_248605.json:
```json
{
    "body": "Replying to [comment:23 fredrik.johansson]:\n> 1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.\nIf we go with this, I would not make a difference between normal interactive Sage output and doctests. Just print balls with fewer digits always, like we already do for `RR`.\n\n> 2. Implement a doctest directive that parses intervals and checks whether the actual and expected outputs overlap (this could also take a tolerance and verify that the new actual output is not too imprecise, e.g. 53-bit pi suddenly coming out as [3.1 +/- 0.1]).\n\nThis would require writing a much more complicated doctest parser (remember you don't just want balls, but also polynomials/lists/matrices with ball coefficients and then you'll also want support for complex numbers, mpfi intervals and who knows what), I don't think this is a realistic solution.",
    "created_at": "2015-06-04T06:20:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248605",
    "user": "@jdemeyer"
}
```

Replying to [comment:23 fredrik.johansson]:
> 1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.
If we go with this, I would not make a difference between normal interactive Sage output and doctests. Just print balls with fewer digits always, like we already do for `RR`.

> 2. Implement a doctest directive that parses intervals and checks whether the actual and expected outputs overlap (this could also take a tolerance and verify that the new actual output is not too imprecise, e.g. 53-bit pi suddenly coming out as [3.1 +/- 0.1]).

This would require writing a much more complicated doctest parser (remember you don't just want balls, but also polynomials/lists/matrices with ball coefficients and then you'll also want support for complex numbers, mpfi intervals and who knows what), I don't think this is a realistic solution.



---

archive/issue_comments_248606.json:
```json
{
    "body": "Replying to [comment:22 jdemeyer]:\n> 2. it makes reviewing harder, since a reviewer must check whether all the given tolerances make sense\n\nI cannot tell whether it is harder to review tolerances or changes to doctests like in commit [8d0b599](http://git.sagemath.org/sage.git/commit/?h=3b534cbb91702fb1f7fd1dfd4b69974bb0411b4e&id=8d0b5995900b15f4594421f9baac0fe0faaa6574).",
    "created_at": "2015-06-04T07:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248606",
    "user": "@cheuberg"
}
```

Replying to [comment:22 jdemeyer]:
> 2. it makes reviewing harder, since a reviewer must check whether all the given tolerances make sense

I cannot tell whether it is harder to review tolerances or changes to doctests like in commit [8d0b599](http://git.sagemath.org/sage.git/commit/?h=3b534cbb91702fb1f7fd1dfd4b69974bb0411b4e&id=8d0b5995900b15f4594421f9baac0fe0faaa6574).



---

archive/issue_comments_248607.json:
```json
{
    "body": "Replying to [comment:25 jdemeyer]:\n> Replying to [comment:23 fredrik.johansson]:\n> > 1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.\n> If we go with this, I would not make a difference between normal interactive Sage output and doctests. Just print balls with fewer digits always, like we already do for `RR`.\n\nI do not like the idea of always printing less information than we actually have. After all, we precisely know the error, so dilluting it seems somehow crude.",
    "created_at": "2015-06-04T07:13:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248607",
    "user": "@cheuberg"
}
```

Replying to [comment:25 jdemeyer]:
> Replying to [comment:23 fredrik.johansson]:
> > 1. Print doctest examples with a few digits less than the computed precision, so that most of the radius bound in the printed output comes from the decimal rounding. This will only rarely cause a last digit to flip over unpredictably. The disadvantage is that the doctest does not show the actual computed interval. On the other hand, the output is a neater representation of the mathematical value. For example, if you print pi to 10 digits, you should always get [3.141592654 +/- 4.11e-10] beyond a certain working precision (from 43 bits, in fact) since the actual difference between pi and 3.141592654 is 4.102...e-10.
> If we go with this, I would not make a difference between normal interactive Sage output and doctests. Just print balls with fewer digits always, like we already do for `RR`.

I do not like the idea of always printing less information than we actually have. After all, we precisely know the error, so dilluting it seems somehow crude.



---

archive/issue_comments_248608.json:
```json
{
    "body": "Replying to [comment:27 cheuberg]:\n> I do not like the idea of always printing less information than we actually have.\nOn the other hand, when do you really care about seeing the last few digits in a many-digit number? Like I said, we are already printing elements of `RR` like that and I don't think anybody ever complained about it.",
    "created_at": "2015-06-04T07:37:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248608",
    "user": "@jdemeyer"
}
```

Replying to [comment:27 cheuberg]:
> I do not like the idea of always printing less information than we actually have.
On the other hand, when do you really care about seeing the last few digits in a many-digit number? Like I said, we are already printing elements of `RR` like that and I don't think anybody ever complained about it.



---

archive/issue_comments_248609.json:
```json
{
    "body": "Replying to [comment:24 jdemeyer]:\n> The two statements seem to contradict each other:\n> \n> Replying to [comment:23 fredrik.johansson]:\n> > Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided\n> \n> > it's safest to think of arb as actually employing randomization\n\nWhat I mean is that you might run through billions of values before you see a difference, but if you assume that a difference *never* occurs and implicitly base your code on this assumption (perhaps forgoing using the radius information before converting output to floating-point numbers), then it could potentially bite you in a serious way when it does.",
    "created_at": "2015-06-04T11:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248609",
    "user": "@fredrik-johansson"
}
```

Replying to [comment:24 jdemeyer]:
> The two statements seem to contradict each other:
> 
> Replying to [comment:23 fredrik.johansson]:
> > Results can differ on 32-bit and 64-bit system but this should not happen often. Gratuitous nondeterminism is avoided
> 
> > it's safest to think of arb as actually employing randomization

What I mean is that you might run through billions of values before you see a difference, but if you assume that a difference *never* occurs and implicitly base your code on this assumption (perhaps forgoing using the radius information before converting output to floating-point numbers), then it could potentially bite you in a serious way when it does.



---

archive/issue_comments_248610.json:
```json
{
    "body": "Replying to [comment:29 fredrik.johansson]:\n> it could potentially bite you in a serious way when it does.\nWell, doctests never \"bite you in a serious way\" so I'm willing to take my chances here.\n\nIf the problem turns out to be more common then expected, we can still change our strategy.",
    "created_at": "2015-06-04T11:23:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248610",
    "user": "@jdemeyer"
}
```

Replying to [comment:29 fredrik.johansson]:
> it could potentially bite you in a serious way when it does.
Well, doctests never "bite you in a serious way" so I'm willing to take my chances here.

If the problem turns out to be more common then expected, we can still change our strategy.



---

archive/issue_comments_248611.json:
```json
{
    "body": "As for the number of digits to print, why not print many digits by default but do something like this in (some of the) doctests:\n\n`RBF = RealBallField(53, print_digits=10)`",
    "created_at": "2015-06-04T11:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248611",
    "user": "@fredrik-johansson"
}
```

As for the number of digits to print, why not print many digits by default but do something like this in (some of the) doctests:

`RBF = RealBallField(53, print_digits=10)`



---

archive/issue_comments_248612.json:
```json
{
    "body": "Replying to [comment:31 fredrik.johansson]:\n> As for the number of digits to print, why not print many digits by default but do something like this in (some of the) doctests:\n> \n> `RBF = RealBallField(53, print_digits=10)`\n-1 because it clutters the doctests for no obvious advantage.",
    "created_at": "2015-06-04T11:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248612",
    "user": "@jdemeyer"
}
```

Replying to [comment:31 fredrik.johansson]:
> As for the number of digits to print, why not print many digits by default but do something like this in (some of the) doctests:
> 
> `RBF = RealBallField(53, print_digits=10)`
-1 because it clutters the doctests for no obvious advantage.



---

archive/issue_comments_248613.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-06-04T15:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248613",
    "user": "@cheuberg"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_248614.json:
```json
{
    "body": "Replying to [comment:30 jdemeyer]:\n> Well, doctests never \"bite you in a serious way\" so I'm willing to take my chances here.\n> \n> If the problem turns out to be more common then expected, we can still change our strategy.\n\nThere is only one way to find out how common that problem will be ...\n\nThus I attach a branch without tolerances, but with modified doctests (as before), plus `spkg-{check,install}` executable as discussed above.\n\n----\nNew commits:",
    "created_at": "2015-06-04T15:15:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248614",
    "user": "@cheuberg"
}
```

Replying to [comment:30 jdemeyer]:
> Well, doctests never "bite you in a serious way" so I'm willing to take my chances here.
> 
> If the problem turns out to be more common then expected, we can still change our strategy.

There is only one way to find out how common that problem will be ...

Thus I attach a branch without tolerances, but with modified doctests (as before), plus `spkg-{check,install}` executable as discussed above.

----
New commits:



---

archive/issue_comments_248615.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-06-05T11:42:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248615",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_248616.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-06-06T12:47:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18323",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18323#issuecomment-248616",
    "user": "@vbraun"
}
```

Resolution: fixed
