# Issue 16705: Construct isogenies graph in elliptic curves

Issue created by migration from https://trac.sagemath.org/ticket/16942

Original creator: sbesnier

Original creation time: 2014-09-07 02:50:10

CC:  defeo cremona jpflori

Let E be an EllipticCurve.  

We can not yet construct the graph of the j-invariants of the curves which are isougenous to E... This commit fills this little gap.


---

Comment by sbesnier created at 2014-09-07 02:51:03

New commits:


---

Comment by git created at 2014-09-07 02:52:18

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-09-08 18:38:19

I have made a cosmetic cleanup of the branch.

But it does not work, test do not pass for me. The doc should say (and the tests should also care) that this is optional, because requiring a database.
----
New commits:


---

Comment by git created at 2014-10-05 21:58:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-10-09 19:07:47

Do you want to put this in the state "needs review" ?


---

Comment by sbesnier created at 2014-10-09 19:19:37

Changing status from new to needs_review.


---

Comment by sbesnier created at 2014-10-09 19:19:37

I thought I did it... Thank you.


---

Comment by chapoton created at 2014-11-05 20:06:04

It seems that `db_modular_polynomials` is not available using
 `sage -i db_modular_polynomials`

I think it would be good to explain how to install this database in the doc, if there is some other way.

And `AttributeError` should be `ValueError` instead.

And `.. note::` should be `.. NOTE::`


---

Comment by chapoton created at 2014-11-05 20:06:04

Changing status from needs_review to needs_info.


---

Comment by git created at 2014-12-28 20:56:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-07-24 07:44:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-07-24 07:44:46

This now does no longer depends on any database.


---

Comment by chapoton created at 2015-07-24 07:44:46

Changing status from needs_info to needs_review.


---

Comment by pbruin created at 2015-07-24 08:00:21

Should the method perhaps be renamed `isogeny_graph()`?  I think "isogeny graph" is much more widely used than "isogenies graph" (and Google agrees).


---

Comment by git created at 2015-07-24 08:06:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cremona created at 2015-07-24 08:19:37

I did not understand the purpose of this ticket from its description, but I do now that I read the code.  For elliptic curves over Q and other number fields we have a class for isogeny classes, which has (amongst other methods) a method for displaying the graph.  So I wonder whether it might be possible to put this new code under the same umbrella.  But that would be more work, so I do not want to delay this.

Certainly "isogeny graph" is a better term.


---

Comment by pbruin created at 2015-07-24 08:23:21

I don't have time to really review this now (last working day before my holidays), but why does this return a directed graph?  If there is an isogeny in one direction, there always is the dual isogeny in the opposite direction.


---

Comment by cremona created at 2015-07-24 08:29:38

Good point.  And the behaviour for "l = characteristic" should be documented;  probably not allowed?

Using the modular polynomial is one way to do it.  You could also make use of the existing method E.isogenies_prime_degree().  But in fact as it stands this function is not a method of elliptic curves at all, the input is really just and element j of a finite field.  So surely there could be a separate function (not a class method) with input an element of F_q and a prime l, and output a graph on some subset of Fq, and then the elliptic curve class method would call that on its j-invariant.


---

Comment by pbruin created at 2015-07-24 08:38:56

Replying to [comment:16 cremona]:
> Using the modular polynomial is one way to do it.  You could also make use of the existing method E.isogenies_prime_degree().  But in fact as it stands this function is not a method of elliptic curves at all, the input is really just and element j of a finite field.  So surely there could be a separate function (not a class method) with input an element of F_q and a prime l, and output a graph on some subset of Fq, and then the elliptic curve class method would call that on its j-invariant.
Actually, the method should perhaps even (optionally?) return the graph of actual elliptic curves instead of the graph of _j_-invariants.  It is likely that the user will want to know exactly which curves over the base field appear in the isogeny graph; if you just have the _j_-invariants, you only know them up to twist.


---

Comment by git created at 2015-07-24 09:15:58

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-11-10 14:45:47

I am not really the man to give a positive review, given that I am not an expert.

There seems to remain an issue about directed graph versus undirected graph..


---

Comment by pbruin created at 2015-11-11 08:19:38

Replying to [comment:20 chapoton]:
> There seems to remain an issue about directed graph versus undirected graph..
Yes, and it should also be possible to get the actual elliptic curves in the isogeny class, not just their _j_-invariants (see comment:17).  It would probably be a good idea to look at the method `EllipticCurve_rational_field.isogeny_graph()` and try to keep the interface consistent with that.


---

Comment by pbruin created at 2015-11-11 08:19:52

Changing status from needs_review to needs_work.


---

Comment by cremona created at 2015-11-11 14:11:04

Replying to [comment:21 pbruin]:
> Replying to [comment:20 chapoton]:
> > There seems to remain an issue about directed graph versus undirected graph..
> Yes, and it should also be possible to get the actual elliptic curves in the isogeny class, not just their _j_-invariants (see comment:17).  It would probably be a good idea to look at the method `EllipticCurve_rational_field.isogeny_graph()` and try to keep the interface consistent with that.

Agreed.  There will be differences:  over number fields isogeny classes are finite;  in non-CM cases there is a unique degree of cyclic isogeny between any 2 curves in the class, and the graph we draw uses only those of prime degree which is enough to connect the graph.  In CM cases, the situation is very similar to ordinary e.c. over finite fields: isogenies come in 2 types, "horizontal" (between curves whose endomorphism rings are the same order), and "vertical" (between curves whose endo rings are different orders in the same imaginary quadratic field).  Vertical isogenies are as before, with a unique cyclic degree;  but the horizontal ones do not have unique degrees, in the sense that if two curves hace CM by the same imaginary quadratic order, of discriminant D say, then the set of degrees of isogenies between them is the set of positive integers represented by some binary quadratic form of discriminant D.  I toyed with the idea of using the quadratic form as a label for the edges in this case, but in the end went for the smallest prime represented by the form.

Over a finite field, in the ordinary case,the curves in an isogeny class all have the same number of points and their endo rings are all orders in the same i.q.field,  and one can again distinguish between horizontal and vertical isogenies.  The graph is usually referred to as a "volcano" on account of its shape, where "vertical" and "horizontal" now have physical meaning.  If coders are up to the challenge we could have some spectacular isogeny graphs!  but getting the layout to look good would be a challenge.

And then there are supersingular curves.  Here, for any two isogenous curves, all but finitely many positive integers arise as isogeny degrees between them (see the last chapter of Kohel's thesis), and I don't see any reason for not just showing a complete graph.


---

Comment by git created at 2017-08-26 16:15:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by defeo created at 2017-09-04 16:38:15

Hello. Thanks `@`chapoton for taking the time to rebase this.

But, honestly, shouldn't we say this code is not going to be merged?

I am sure there is a lot of interest right now in isogeny graphs over finite fields (because post-quantum crypto, you know), and it would be good if Sage offered some functionality. However this code hardly covers all interesting cases, and it has design issues.

If we could agree on the correct API, I'd be happy to rewrite the code. Let me summarize the issues:

- A function on Fq which outputs a graph labeled by j-invariants, VS a function on elliptic curves which outputs a graph labeled by curves. My opinion is that both are useful, so we could implement both.

- Undirected VS directed graph. The problem is that, although generically these graphs are simple undirected graphs, there are lots of pathological cases:
  - Self-loops,
  - multi-edges,
  - j-invariants 0 and 1728 are especially nasty (same dual for many isogenies).

- The method: modular polynomials VS `isogenies_prime_degree()`. As far as I recall, `isogenies_prime_degree()` factors the division polynomial. It is more expensive, but it requires no optional database (and can in principle cover any degree, although it becomes unrealistic when degrees get large).

Let me add one more issue: fool-proofness. The size of these graphs is polynomial in the field *SIZE*! I'm sure a lot of beginners would create a cyptographic-size finite field and then ask for an isogeny graph. This would of course take forever. Maybe we could print a warning when the expected size is too large.

`@`cremona, `@`pbruin, comments?


---

Comment by cremona created at 2020-12-16 11:59:54

See my comments on #30199.


---

Comment by cremona created at 2020-12-16 12:01:05

By the way, Sage's optional database of David Kohel's modular polynomials is tiny.  Andrew Sutherland has a very much larger database.


---

Comment by defeo created at 2020-12-16 13:28:08

Maybe we can close this ticket, now that #30199 is going to get in?

Re the modular polynomial database, yes, I had been toying with repackaging it for a while. I hope to be able to finish that work some day...

Maybe it would be good to create a meta-ticket summarizing all wanted functionality regarding isogeny classes and graphs? I can do that if you like.
