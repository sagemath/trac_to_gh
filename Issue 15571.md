# Issue 15571: Remove genus2reduction

Issue created by migration from Trac.

Original creator: jdemeyer

Original creation time: 2014-02-11 09:55:16

genus2reduction has now been ported to the Sage library and is available in PARI itself as the `genus2red()` function. We should remove the package and use the new PARI function instead.


---

Comment by git created at 2014-09-18 12:17:35

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2014-09-18 12:17:59

Changing status from new to needs_review.


---

Comment by git created at 2014-09-19 13:06:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-09-19 13:10:46

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by git created at 2014-09-19 13:14:22

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by chapoton created at 2014-09-21 19:41:52

There is an `EXAMPLES:` missing a double `::`


---

Comment by git created at 2014-09-21 20:38:15

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-10-05 19:11:15

There was a pyflakes warning about a missing definition. I made a correction in a function call for that reason.

Also made a few pep8 changes.
----
New commits:


---

Comment by pbruin created at 2014-10-07 11:49:54

Do you have a reference for the following manipulations?

```python
if minimal_equation.degree() == 5:
    minimal_disc *= minimal_equation[5]**2
# Multiply with suitable power of 2 of the form 2^(2*(d-1) - 12)
b = 2 * (minimal_equation.degree() - 1)
k = QQ((12 - minimal_disc.valuation(2), b)).ceil()
minimal_disc >>= 12 - b*k
minimal_disc = ZZ(minimal_disc)
```

Is the power of 2 in fact important, given that this is supposed to output the minimal discriminant away from 2?


---

Comment by jdemeyer created at 2014-10-07 12:19:00

Replying to [comment:13 pbruin]:
> Do you have a reference for the following manipulations?
They are based on looking at the PARI source code. But I must admit that I don't understand everything 100% clearly.

The line

```
if minimal_equation.degree() == 5:
    minimal_disc *= minimal_equation[5]**2
```

is based on

```
  RgX_to_6(polr, &a0,&a1,&a2,&a3,&a4,&a5,&a6);
  I.j10 = !signe(a0)? mulii(sqri(a1), ZX_disc(polr)): ZX_disc(polr);
```


The factor `2^(-12)` comes from

```
I.j10 = gmul2n(I.j10,-12);
```

and the multiplication by `2^(2*(d-1))` comes from

```
dd = polval(polr,gen_2) & (~1); /* = 2 floor(val/2) */
polr = gmul2n(polr, -dd);
```

which multiplies the whole polynomial by a power of 4.
Multiplying a polynomial of degree `d` by a constant `c` multiplies the discriminant by `c^(d-1)`.

> Is the power of 2 in fact important?
I have no idea. I tried to reproduce as best as possible the output of the old `genus2reduction` program. That is also the reason why I emulated the `raw()` method and wrote to `divisors_to_string()` function: to check for myself if the new output was the same as the old output. Modulo some small details, this seems indeed to be the case.


---

Comment by pbruin created at 2014-10-07 16:16:33

I'm not absolutely sure either, but from the last bit of PARI code you quoted, the following change seems to stay closer to the original:

```diff
diff --git a/src/sage/interfaces/genus2reduction.py b/src/sage/interfaces/genus2reduction.py
index 73d41d6..01c4019 100644
--- a/src/sage/interfaces/genus2reduction.py
+++ b/src/sage/interfaces/genus2reduction.py
`@``@` -514,9 +514,9 `@``@` class Genus2reduction(SageObject):
         minimal_disc = QQ(res[2].poldisc()).abs()
         if minimal_equation.degree() == 5:
             minimal_disc *= minimal_equation[5]**2
-        # Multiply with suitable power of 2 of the form 2^(2*(d-1) - 12)
+        # Multiply with suitable power of 2 of the form 2^(2*d - 12)
         b = 2 * (minimal_equation.degree() - 1)
-        k = QQ((12 - minimal_disc.valuation(2), b)).ceil()
+        k = min(a.valuation(2) for a in Q**2 + 4*P) & ~1
         minimal_disc >>= 12 - b*k
         minimal_disc = ZZ(minimal_disc)
 
```

This does not affect any doctests in `genus2reduction.py`.


---

Comment by pbruin created at 2014-10-07 16:26:15

Actually my version above is certainly wrong, because it is not invariant under scaling of the variables in the original equation.  However, your formula seems to mean that the 2-adic valuation of the minimal discriminant is bounded on the set of all genus 2 curves, which I can hardly believe, since it isn't even true for elliptic curves.


---

Comment by pbruin created at 2014-10-07 16:54:21

We can also decide to give up trying to imitate the original program perfectly and allow the power of 2 to be different.  I am attaching a patch that does this.

I also think you used an incorrect criterion to decide when the 2-part of the conductor was not computed.  For example, one of the current doctests has the line

```
Conductor (away from 2): 954
```

Note that the "away from 2" part should only be there if the returned conductor is odd.  According to the PARI documentation, we should check if 2 appears to the power -1 in the factorisation (fake at 2 in this case) of the conductor.  This is fixed by the last part of the patch.


---

Attachment

What you say (and your patch) makes sense.


---

Comment by jdemeyer created at 2014-10-08 13:37:09

Replying to [comment:16 pbruin]:
> However, your formula seems to mean that the 2-adic valuation of the minimal discriminant is bounded on the set of all genus 2 curves, which I can hardly believe, since it isn't even true for elliptic curves.
After thinking about this some more, perhaps my code is correct but it depends on the interpretation of "Minimal Discriminant (away from 2)". If you interpret it as "smallest positive integer which occurs as discriminant of a model of the given curve over Z[1/2]", then my code might be correct.


---

Comment by jdemeyer created at 2014-10-08 13:44:22

New commits:


---

Comment by pbruin created at 2014-10-08 17:10:53

Replying to [comment:19 jdemeyer]:
> Replying to [comment:16 pbruin]:
> > However, your formula seems to mean that the 2-adic valuation of the minimal discriminant is bounded on the set of all genus 2 curves, which I can hardly believe, since it isn't even true for elliptic curves.
> After thinking about this some more, perhaps my code is correct but it depends on the interpretation of "Minimal Discriminant (away from 2)". If you interpret it as "smallest positive integer which occurs as discriminant of a model of the given curve over Z[1/2]", then my code might be correct.
Possibly, but I would be surprised if this definition coincides with the one used by the original `genus2reduction` program.  Anyway, I don't think it makes sense to spend too much time on finding a nice definition for "minimal discriminant away from 2", so any power of 2 in the "minimal discriminant away from 2" is fine with me.


---

Comment by pbruin created at 2014-10-08 17:10:53

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-10-09 22:30:39

Resolution: fixed
