# Issue 11740: Clarify simplify_radical and Maxima's radcan

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2011-10-10 12:46:13

Assignee: mvngu

CC:  burcin zimmerma

We use Maxima's [radcan](http://maxima.sourceforge.net/docs/manual/en/maxima_9.html#Item_003a-radcan) (warning - link may change) for `simplify_radical`.  The documentation claims 

```
Simplifies expr, which can contain logs, exponentials, and radicals, by
converting it into a form which is canonical over a large class of expressions
and a given ordering of variables; that is, all functionally equivalent forms
are mapped into a unique form. For a somewhat larger class of expressions,
radcan produces a regular form. Two equivalent expressions in this class do
not necessarily have the same appearance, but their difference can be
simplified by radcan to zero.

For some expressions radcan is quite time consuming. This is the cost of
exploring certain relationships among the components of the expression for
simplifications based on factoring and partial-fraction expansions of
exponents. 
```

but it can be really hard to tell exactly what this all means.  See [this ask.sagemath.org question](http://ask.sagemath.org/question/767/simplification-errors-in-simple-expressions) and #8497, to which this is a followup.


---

Comment by kcrisman created at 2013-06-18 18:44:58

We should probably solve this at the same time as #12737.


---

Comment by burcin created at 2013-06-18 19:58:23

Replying to [ticket:11912 kcrisman]:

> The plan is to rename `simplify_radical()` to `radcan()` to match the upstream name. We can then alias `simplify_radical()` to `radcan()`, and deprecate the `simplify_radical()` name.

Why would we use the Maxima name? It doesn't match any Sage convention. I suggest `radical_canonicalize()` or `canonicalize_radical()` in anticipation of other `canonicalize_*()` methods.


---

Comment by mjo created at 2013-06-18 20:33:13

There is `Expression.rectform()` (also my fault), but I don't particularly care about the name. Of those two I think I prefer `radical_canonicalize()`.


---

Comment by mjo created at 2013-06-18 20:34:12

Actually, I take that back -- `canonicalize_radical()` would be better for tab completion if we add other `canonicalize_foo()` methods.


---

Attachment

Here's the deprecation/rename, and a few changes to the docs. I haven't been able to come up with any good use cases for radcan(), but I'm not feeling very imaginative today.


---

Comment by mjo created at 2013-06-18 23:25:39

Note: I haven't updated the function name anywhere, so a ton of tests fail. Just looking for some ideas for now.


---

Comment by kcrisman created at 2013-06-18 23:33:14

Yeah, and we'll need a doctest for the deprecation as well.  Let's think about this for a day or two, but resolve it by the end of SD 48.   I think that looking at the simplifications that `simplify_radical()` does would be sufficient.


---

Comment by kcrisman created at 2013-06-18 23:33:14

Changing keywords from "" to "sd48".


---

Comment by kcrisman created at 2013-07-03 18:18:30

See [comment:21:ticket:12737 this comment] for both some good use cases *and* some potential new aliases...


---

Comment by mjo created at 2014-11-17 03:21:38

Rewrote the patch as a git branch, and added the deprecation tests. Also fixed the usage in the rest of the sage library.
----
New commits:


---

Comment by mjo created at 2014-11-17 03:21:38

Changing status from new to needs_review.


---

Comment by kcrisman created at 2014-11-17 17:34:00

Probably see also #3520.


---

Comment by kcrisman created at 2014-11-18 03:41:44

Any thoughts on `canonicalize_exp` or `canonicalize_log`?  (One could even deprecate the other functions in favor of the other names... just thinking out loud.)  I also think this one should depend on #14630, because then you can also mention it in a few examples where it would be relevant (e.g. `If you don't want this kind of "simplification,"...`), not to mention the likely conflict in the patches anyway.


---

Comment by git created at 2014-11-18 15:22:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2014-11-18 15:33:07

I just pushed another commit adding the example from #3520. I'm against adding `canonicalize_exp` and `canonicalize_log` methods, since they don't seem to serve a purpose and can cause bugs. For example, see the change I made in relation.py:


```
 #Try to apply some simplifications to see if left - right == 0
- simp_list = [difference.simplify_log, difference.simplify_rational, difference.simplify_exp,difference.simplify_radical,difference.simplify_trig]
+ simp_list = [difference.simplify_log, difference.simplify_rational,difference.canonicalize_radical,difference.simplify_trig]
```


Both `simplify_exp` and `simplify_radical` were being called, wasting cycles, because they're the same thing!

I can see the benefit for things like `full_simplify()` where we're mimicking the Mathematica name so that new users can find it through tab completion. But for `canonicalize_*` I don't think it's going to do us any good.

I agree that ideally this and #14630 should have some kind of dependency, but practically, they both may sit around waiting for review for a while. I'd rather not put up roadblocks to either one getting reviewed; when one of them gets in, I'll go update the other branch.


---

Comment by kcrisman created at 2014-11-18 16:09:24

> I can see the benefit for things like `full_simplify()` where we're mimicking the Mathematica name so that new users can find it through tab completion. But for `canonicalize_*` I don't think it's going to do us any good.

Hmm.  So should this even be called `canonicalize_radical` or maybe something else that indicates it doesn't just do radicals?  I wonder why they chose that name in Maxima - maybe there is something in the algorithm that is 'radical'?  (Pun intended.)


---

Comment by kcrisman created at 2014-11-18 16:10:53

Also, I think you repeated some wording in the doc - maybe it's repeated in Maxima, but still that seems unnecessary here.

```
+            All functionally equivalent forms are mapped into a unique
+            form. For a somewhat larger class of expressions, produces
+            a regular form. Two equivalent expressions in this class
+            do not necessarily have the same appearance, but their
+            difference can be transformed by radcan to zero.
+
```



---

Comment by git created at 2014-11-18 16:22:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mjo created at 2014-11-18 16:29:59

Replying to [comment:19 kcrisman]:
> 
> Hmm.  So should this even be called `canonicalize_radical` or maybe something else that indicates it doesn't just do radicals?  I wonder why they chose that name in Maxima - maybe there is something in the algorithm that is 'radical'?  (Pun intended.)

Maybe you just have to think of the complex square root in terms of the complex exponential and logarithm, at which point it becomes OK for `canonicalize_radical()` to affect certain log/exp expressions?


---

Comment by kcrisman created at 2014-11-18 16:36:40

In `def simplify`,

```
        .. seealso::

           :meth:`simplify_full`, :meth:`simplify_trig`,
           :meth:`simplify_rational`, :meth:`simplify_factorial`,
           :meth:`simplify_log`
```

You just removed it here rather than replacing it; intentional or not?  It's still useful, could put a reference in.   

(For that matter, we also now have several _other_ `simplify_foo` methods which should be added to the lists of simplifications in a few places.)


```diff
 # Add elementwise methods.
 for method in ['simplify', 'simplify_exp', 'simplify_factorial',
         'simplify_log', 'simplify_radical', 'simplify_rational',
-        'simplify_trig', 'simplify_full', 'trig_expand', 'trig_reduce']:
+        'simplify_trig', 'simplify_full', 'trig_expand',
+        'canonicalize_radical', 'trig_reduce']:
     setattr(Vector_symbolic_dense, method, apply_map(getattr(Expression, method)))
```

Why is this keeping `simplify_radical`?

> Maybe you just have to think of the complex square root in terms of the complex exponential and logarithm, at which point it becomes OK for canonicalize_radical() to affect certain log/exp expressions?
Sure!  But I mean that the name, if anything, is more about exp/log then as opposed to radicals.  Just seems curious, and wondering whether a better name is possible.  It may not be.


---

Comment by mjo created at 2014-11-18 16:51:52

Replying to [comment:23 kcrisman]:
> In `def simplify`,
> {{{
>         .. seealso::
> 
>            :meth:`simplify_full`, :meth:`simplify_trig`,
>            :meth:`simplify_rational`, :meth:`simplify_factorial`,
>            :meth:`simplify_log`
> }}}
> You just removed it here rather than replacing it; intentional or not?  It's still useful, could put a reference in.


Intentional, since it's no longer a `simplify_*` method. But I'm fine with having it listed there.



> (For that matter, we also now have several _other_ `simplify_foo` methods which should be added to the lists of simplifications in a few places.)



I'm happy to add these. I've been meaning to add `simplify_rectform()` to `simplify_full()` once I stop making changes all over expression.pyx. Maybe in that ticket, or #14630 is probably where it's most appropriate since it adds yet another `simplify_*` method.



> {{{#!diff
>  # Add elementwise methods.
>  for method in ['simplify', 'simplify_exp', 'simplify_factorial',
>          'simplify_log', 'simplify_radical', 'simplify_rational',
> -        'simplify_trig', 'simplify_full', 'trig_expand', 'trig_reduce']:
> +        'simplify_trig', 'simplify_full', 'trig_expand',
> +        'canonicalize_radical', 'trig_reduce']:
>      setattr(Vector_symbolic_dense, method, apply_map(getattr(Expression, method)))
> }}}
> Why is this keeping `simplify_radical`?


That code is adding methods to a class -- if we remove `simplify_radical` entirely, it will break code that attempts to call `simplify_radical` on a vector. Instead I leave it there to throw the deprecation warning.


---

Comment by git created at 2014-11-18 16:55:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2014-11-20 18:21:57

Okay, I think it's probably time for this.  Sadly.  I'm happy with it, but building doc and testing yet to be done by me.


---

Comment by kcrisman created at 2014-11-20 18:27:36

Doc looks good!  Now just waiting on `make ptest`.


---

Comment by kcrisman created at 2014-11-20 19:06:25

Changing status from needs_review to positive_review.


---

Comment by mjo created at 2014-11-20 22:47:51

Thanks for taking the time to review this!


---

Comment by vbraun created at 2014-11-22 17:18:36

Resolution: fixed
