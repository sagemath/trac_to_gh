# Issue 34144: Add infinte q-Pochhammer symbol

Issue created by migration from https://trac.sagemath.org/ticket/34381

Original creator: tscrim

Original creation time: 2022-08-17 02:30:55

CC:  mantepse chapoton

`(z; q)_{\infty}` has a nice expression for its coefficients in `z`. We implement this very important series as a lazy Laurent series.


---

Comment by tscrim created at 2022-08-17 03:13:46

After doing this, we might want to move the construction of the underlying function to the lazy series ring. We might also want to special case composition of a lazy Laurent series with a monomial in a lazy Laurent series.
----
New commits:


---

Comment by tscrim created at 2022-08-17 03:13:46

Changing keywords from "" to "q_pochhammer, euler function".


---

Comment by tscrim created at 2022-08-17 03:13:46

Changing status from new to needs_review.


---

Comment by tscrim created at 2022-08-17 03:14:45

This also does not conflict with #32324.


---

Comment by mantepse created at 2022-08-17 06:27:21

Cool!  It makes me happy to see so many possibilities opening up!

Question: what do you mean with moving the construction of the underlying function to the `LazyLaurentSeriesRing`?

Idea / Suggestion: maybe it makes sense to use "dummy" (or something similar) instead of "z" for the variable name, to make it clear to the reader that it plays no role.  Of course, this would equally apply to all the other special functions.  I am not sure about the benefit / cost ratio, I am not even sure that there would be a benefit.


---

Comment by tscrim created at 2022-08-17 07:04:50

Replying to [comment:4 mantepse]:
> Question: what do you mean with moving the construction of the underlying function to the `LazyLaurentSeriesRing`?

For each of these special functions, we first construct a series `f`. So I propose having, e.g., `L.sin()` return `f(z) = sin(z)` in the variable of that lazy Laurent series ring. This avoids a composition call. I feel like it might make for a more natural home for, e.g., `euler()`.

> Idea / Suggestion: maybe it makes sense to use "dummy" (or something similar) instead of "z" for the variable name, to make it clear to the reader that it plays no role.  Of course, this would equally apply to all the other special functions.  I am not sure about the benefit / cost ratio, I am not even sure that there would be a benefit.

It gets substituted out every time. So it is never visible, and so I see no net change (although it would make a bug easier to spot if we ended up in the very unlikely scenario that the composition returned the wrong parent). If we wanted to do this, we should do it for all special functions simultaneously on a follow-up ticket.


---

Comment by mantepse created at 2022-08-17 08:26:30

Replying to [comment:5 tscrim]:
> Replying to [comment:4 mantepse]:
> > Question: what do you mean with moving the construction of the underlying function to the `LazyLaurentSeriesRing`?
> 
> For each of these special functions, we first construct a series `f`. So I propose having, e.g., `L.sin()` return `f(z) = sin(z)` in the variable of that lazy Laurent series ring. This avoids a composition call. I feel like it might make for a more natural home for, e.g., `euler()`.

Indeed, that makes a lot of sense to me.  Similarly for all the other special functions where we end up composing with self in the last line.


---

Comment by git created at 2022-08-22 07:55:11

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by tscrim created at 2022-08-22 07:56:51

Replying to [comment:6 mantepse]:
> Replying to [comment:5 tscrim]:
> > Replying to [comment:4 mantepse]:
> > > Question: what do you mean with moving the construction of the underlying function to the `LazyLaurentSeriesRing`?
> > 
> > For each of these special functions, we first construct a series `f`. So I propose having, e.g., `L.sin()` return `f(z) = sin(z)` in the variable of that lazy Laurent series ring. This avoids a composition call. I feel like it might make for a more natural home for, e.g., `euler()`.
> 
> Indeed, that makes a lot of sense to me.  Similarly for all the other special functions where we end up composing with self in the last line.

I did this just for the functions implemented on this ticket. Although I forgot to revert back my merge with #32324, but since that is positively reviewed, I am just adding it as a dependency (if you'll allow me to be lazy about it).


---

Comment by mantepse created at 2022-08-22 08:07:34

No problem.  For #32367 I need a few more operations on lazy series, like reversion for `LazySymmetricFunctions`, "functorial composition", etc., see #34383.  However, I think I am making progress.

Do you prefer to get `LazyTaylorSeries` into sage, and rename it to `LazyPowerSeries` later?  I would need more time (and possibly a zoom call) to be able to get rid of `LazyPowerSeries` right now.


---

Comment by tscrim created at 2022-08-22 08:27:55

Replying to [comment:9 mantepse]:
> No problem.  For #32367 I need a few more operations on lazy series, like reversion for `LazySymmetricFunctions`, "functorial composition", etc., see #34383.  However, I think I am making progress.

That's good to hear. Let me know if I can help.

> Do you prefer to get `LazyTaylorSeries` into sage, and rename it to `LazyPowerSeries` later?  I would need more time (and possibly a zoom call) to be able to get rid of `LazyPowerSeries` right now.

Yes. I think it would be good to have that functionality available and get people to start using it.

Send me an email if you want to do a Zoom call too.


---

Comment by git created at 2022-08-29 01:08:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-08-29 01:08:44

Bot was green modulo the pyflakes issues, which I have just pushed. I have also tested this locally post change.


---

Comment by mantepse created at 2022-09-15 19:01:48

Changing keywords from "q_pochhammer, euler function" to "q_pochhammer, euler function, LazyPowerSeries".


---

Comment by mantepse created at 2022-09-15 19:37:08

I am a bit unhappy about the amount of (documentation) duplication, especially, since it would be nice to do this for all the "special" functions.


---

Comment by tscrim created at 2022-09-15 23:58:51

Unfortunately that is not possible. Note that they are actually different functions with different doctests. We can make a link, but we cannot do any duplication.


---

Comment by git created at 2022-10-22 07:37:42

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2022-10-22 08:07:27

One tiny thing: I think that we should be explicit that the function passed should be interpreted as coefficients:

```
sage: L.<q> = LazyLaurentSeriesRing(ZZ)
sage: phi = q.euler()
sage: phi
1 - q - q^2 + q^5 + O(q^7)
sage: L.<q> = LazyLaurentSeriesRing(LazyDirichletSeriesRing(QQ, "s"))
sage: phi = q.euler()
sage: phi
(-1 - 1/(2^s) + 1/(5^s) + 1/(7^s) + O(1/(8^s)))
```



```diff
diff --git a/src/sage/rings/lazy_series_ring.py b/src/sage/rings/lazy_series_ring.py
index b7b1953f52f..51e2b1c365f 100644
--- a/src/sage/rings/lazy_series_ring.py
+++ b/src/sage/rings/lazy_series_ring.py
@@ -1550,7 +1550,7 @@ class LazyLaurentSeriesRing(LazySeriesRing):
         one = qP.one()
         def coeff(n):
             return (-1)**n * q**binomial(n, 2) / qP.prod(one - q**i for i in range(1, n+1))
-        return self(coeff, valuation=0)
+        return self(coefficients=coeff, valuation=0)
 
     def euler(self):
         r"""
@@ -1588,7 +1588,7 @@ class LazyLaurentSeriesRing(LazySeriesRing):
             if rem:
                 return ZZ.zero()
             return (-1) ** ((m + 1) // 6)
-        return self(coeff, valuation=0)
+        return self(coefficients=coeff, valuation=0)
 ######################################################################
```


If this looks OK to you, let's go (with a big "thank you" for reviewing all the other issues, and being careful with #15248, etc.)!


---

Comment by mantepse created at 2022-10-24 08:45:32

Changing status from needs_review to needs_work.


---

Comment by git created at 2022-10-28 07:04:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2022-10-28 07:05:37

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2022-10-28 07:05:37

Good catch. Thank you.

(No problem. Sorry I haven't been able to work so much on the other tickets, but I right now have a bit of time at least.)


---

Comment by mantepse created at 2022-10-28 10:16:41

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2022-10-29 08:12:36

Thank you.


---

Comment by vbraun created at 2022-11-07 20:26:20

Resolution: fixed
