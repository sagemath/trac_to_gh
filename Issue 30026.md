# Issue 30026: declare_union yields wrong results

Issue created by migration from https://trac.sagemath.org/ticket/30263

Original creator: @mjungmath

Original creation time: 2020-08-01 07:11:42

CC:  egourgoulhon tscrim

Keywords: sets, union


```
sage: M = Manifold(3, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V'); W = M.open_subset('W')
sage: M.declare_union(U, V, W)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-3-c7f527dcc1ea> in <module>()
----> 1 M.declare_union(U, V, W)

TypeError: declare_union() takes 3 positional arguments but 4 were given
sage: M.declare_union(U, V.union(W))
sage: U.union(V).union(W)
Open subset U_union_V_union_W of the 3-dimensional differentiable manifold M
sage: U.union(V.union(W))
3-dimensional differentiable manifold M
```


I propose to allow more than two arguments for `declare_union`. Furthermore, something went wrong with the commutativity of the union. This should be investigated, too.


---

Comment by mkoeppe created at 2021-04-07 19:29:15

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review.


---

Comment by mkoeppe created at 2021-04-18 17:02:40

Unions of several subsets also appear in another form - as open covers (which are merely lists of subsets and not manifold subsets in their own right). One might ask whether this could be unified as well.


---

Comment by mkoeppe created at 2021-04-21 19:50:47

An issue with the existing code is that through a sequence of `declare_union` calls, it is possible to obtain a situation in which two subsets must be the same, although `declare_union` makes a (not very effective) attempt to stop the user from doing so (by checking whether the two arguments are the same).

In terms of the poset of subsets that is defined by the `_subsets` (and `_supersets`) attributes (which is visualized by the code from #31680), this is quite problematic. 

This could be solved by introducing equivalence classes of subsets - for example by keeping the `_subsets` relation acyclic and introducing an `_equal_sets` attribute; loops that update subsets will have to be modified.
The elements of the poset introduced in #31680 then would be equivalence classes of subsets rather than subsets.


---

Comment by mkoeppe created at 2021-04-24 02:49:59

Last 10 new commits:


---

Comment by git created at 2021-04-24 20:35:40

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-24 21:32:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-25 00:33:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2021-04-25 06:16:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mkoeppe created at 2021-05-03 05:51:02

Last 10 new commits:
