# Issue 20363: more failing tests related to cplex / gurobi

Issue created by migration from https://trac.sagemath.org/ticket/20600

Original creator: mkoeppe

Original creation time: 2016-05-13 01:00:09

CC:  vdelecroix dimpase chapoton

Keywords: lp

This is a follow-up on #20328. 
Apparently there are still failing tests. 
Not sure how I missed them when testing #20328.


```
egret:~/s/sage/sage-develop (t/20548/public/20548)$ sage -t --optional=sage,coin,cvxopt,cplex,gurobi src/sage/numerical/
too few successful tests, not using stored timings
Running doctests with ID 2016-05-12-17-56-33-cc004516.
Git branch: t/20548/public/20548
Using --optional=coin,cplex,cvxopt,gurobi,sage
Doctesting 43 files.
[...]
sage -t src/sage/numerical/backends/cplex_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/cplex_backend.pyx", line 196, in sage.numerical.backends.cplex_backend.CPLEXBackend.add_variables
Failed example:
    p.col_name(5)              # optional - CPLEX
Expected:
    'a'
Got:
    'b'
**********************************************************************
File "src/sage/numerical/backends/cplex_backend.pyx", line 1024, in sage.numerical.backends.cplex_backend.CPLEXBackend.get_relative_objective_gap
Failed example:
    pb.get_best_objective_value()                        # optional - CPLEX
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 496, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 858, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.numerical.backends.cplex_backend.CPLEXBackend.get_relative_objective_gap[7]>", line 1, in <module>
        pb.get_best_objective_value()                        # optional - CPLEX
    AttributeError: 'sage.numerical.backends.cplex_backend.CPLEXBackend' object has no attribute 'get_best_objective_value'
**********************************************************************
2 items had failures:
   1 of  11 in sage.numerical.backends.cplex_backend.CPLEXBackend.add_variables
   1 of  10 in sage.numerical.backends.cplex_backend.CPLEXBackend.get_relative_objective_gap
    [265 tests, 2 failures, 0.20 s]
[...]
sage -t src/sage/numerical/backends/gurobi_backend.pyx
**********************************************************************
File "src/sage/numerical/backends/gurobi_backend.pyx", line 45, in sage.numerical.backends.gurobi_backend.GurobiBackend
Failed example:
    TestSuite(p.get_backend()).run(skip="_test_pickling")         # optional - Gurobi
Expected nothing
Got:
    Failure in _test_add_linear_constraints:
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "sage/numerical/backends/generic_backend.pyx", line 556, in sage.numerical.backends.generic_backend.GenericBackend._test_add_linear_constraints (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:6154)
        p.add_linear_constraints(nrows_added, None, 2)
      File "sage/numerical/backends/generic_backend.pyx", line 509, in sage.numerical.backends.generic_backend.GenericBackend.add_linear_constraints (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:5924)
        cpdef add_linear_constraints(self, int number, lower_bound, upper_bound, names=None):
      File "sage/numerical/backends/generic_backend.pyx", line 535, in sage.numerical.backends.generic_backend.GenericBackend.add_linear_constraints (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:5809)
        raise NotImplementedError()
    NotImplementedError
    ------------------------------------------------------------
    Failure in _test_copy:
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "sage/numerical/backends/generic_backend.pyx", line 1129, in sage.numerical.backends.generic_backend.GenericBackend._test_copy (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:10824)
        self._do_test_problem_data(tester, cp)
      File "sage/numerical/backends/generic_backend.pyx", line 1103, in sage.numerical.backends.generic_backend.GenericBackend._do_test_problem_data (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:10548)
        assert_equal_problem_data(method)
      File "sage/numerical/backends/generic_backend.pyx", line 1100, in sage.numerical.backends.generic_backend.GenericBackend._do_test_problem_data.assert_equal_problem_data (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:9925)
        tester.assertEqual(getattr(self, method)(), getattr(cp, method)(),
      File "/Users/mkoeppe/cvs/sage/local/lib/python/unittest/case.py", line 515, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/Users/mkoeppe/cvs/sage/local/lib/python/unittest/case.py", line 508, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: problem_name does not match
    ------------------------------------------------------------
    Failure in _test_copy_does_not_share_data:
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "sage/numerical/backends/generic_backend.pyx", line 1139, in sage.numerical.backends.generic_backend.GenericBackend._test_copy_does_not_share_data (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:11033)
        self._do_test_problem_data(tester, cpcp)
      File "sage/numerical/backends/generic_backend.pyx", line 1103, in sage.numerical.backends.generic_backend.GenericBackend._do_test_problem_data (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:10548)
        assert_equal_problem_data(method)
      File "sage/numerical/backends/generic_backend.pyx", line 1100, in sage.numerical.backends.generic_backend.GenericBackend._do_test_problem_data.assert_equal_problem_data (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:9925)
        tester.assertEqual(getattr(self, method)(), getattr(cp, method)(),
      File "/Users/mkoeppe/cvs/sage/local/lib/python/unittest/case.py", line 515, in assertEqual
        assertion_func(first, second, msg=msg)
      File "/Users/mkoeppe/cvs/sage/local/lib/python/unittest/case.py", line 508, in _baseAssertEqual
        raise self.failureException(msg)
    AssertionError: problem_name does not match
    ------------------------------------------------------------
    Failure in _test_copy_some_mips:
    Traceback (most recent call last):
      File "/Users/mkoeppe/cvs/sage/local/lib/python2.7/site-packages/sage/misc/sage_unittest.py", line 283, in run
        test_method(tester = tester)
      File "sage/numerical/backends/generic_backend.pyx", line 1148, in sage.numerical.backends.generic_backend.GenericBackend._test_copy_some_mips (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:11206)
        p.add_linear_constraints(5, 0, None)
      File "sage/numerical/backends/generic_backend.pyx", line 509, in sage.numerical.backends.generic_backend.GenericBackend.add_linear_constraints (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:5924)
        cpdef add_linear_constraints(self, int number, lower_bound, upper_bound, names=None):
      File "sage/numerical/backends/generic_backend.pyx", line 535, in sage.numerical.backends.generic_backend.GenericBackend.add_linear_constraints (/Users/mkoeppe/cvs/sage/src/build/cythonized/sage/numerical/backends/generic_backend.c:5809)
        raise NotImplementedError()
    NotImplementedError
    ------------------------------------------------------------
    The following tests failed: _test_add_linear_constraints, _test_copy, _test_copy_does_not_share_data, _test_copy_some_mips
**********************************************************************
File "src/sage/numerical/backends/gurobi_backend.pyx", line 476, in sage.numerical.backends.gurobi_backend.GurobiBackend.remove_constraint
Failed example:
    p.get_values([x,y])                          # optional - Gurobi
Expected:
    [0.0, 3.0]
Got:
    [-0.0, 3.0]
**********************************************************************
File "src/sage/numerical/backends/gurobi_backend.pyx", line 511, in sage.numerical.backends.gurobi_backend.GurobiBackend.add_linear_constraint
Failed example:
    p.row(0)                                                                # optional - Gurobi
Expected:
    ([0, 1, 2, 3, 4], [0.0, 1.0, 2.0, 3.0, 4.0])
Got:
    ([1, 2, 3, 4], [1.0, 2.0, 3.0, 4.0])
**********************************************************************
File "src/sage/numerical/backends/gurobi_backend.pyx", line 581, in sage.numerical.backends.gurobi_backend.GurobiBackend.row
Failed example:
    p.row(0)                                                         # optional - Gurobi
Expected:
    ([0, 1, 2, 3, 4], [0.0, 1.0, 2.0, 3.0, 4.0])
Got:
    ([1, 2, 3, 4], [1.0, 2.0, 3.0, 4.0])
**********************************************************************
File "src/sage/numerical/backends/gurobi_backend.pyx", line 634, in sage.numerical.backends.gurobi_backend.GurobiBackend.row_bounds
Failed example:
    p.row(0)                                                          # optional - Gurobi
Expected:
    ([0, 1, 2, 3, 4], [0.0, 1.0, 2.0, 3.0, 4.0])
Got:
    ([1, 2, 3, 4], [1.0, 2.0, 3.0, 4.0])
**********************************************************************
5 items had failures:
   1 of   3 in sage.numerical.backends.gurobi_backend.GurobiBackend
   1 of   9 in sage.numerical.backends.gurobi_backend.GurobiBackend.add_linear_constraint
   1 of  12 in sage.numerical.backends.gurobi_backend.GurobiBackend.remove_constraint
   1 of   7 in sage.numerical.backends.gurobi_backend.GurobiBackend.row
   1 of   7 in sage.numerical.backends.gurobi_backend.GurobiBackend.row_bounds
    [212 tests, 5 failures, 0.23 s]
----------------------------------------------------------------------
sage -t src/sage/numerical/backends/cplex_backend.pyx  # 2 doctests failed
sage -t src/sage/numerical/backends/gurobi_backend.pyx  # 5 doctests failed
----------------------------------------------------------------------
```



---

Comment by git created at 2016-05-24 15:53:42

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:


---

Comment by mkoeppe created at 2016-05-24 15:54:31

Changing status from new to needs_review.


---

Comment by dimpase created at 2016-06-22 16:12:18

Changing status from needs_review to positive_review.


---

Comment by dimpase created at 2016-06-22 16:12:18

looks good to me


---

Comment by vbraun created at 2016-06-24 07:26:08

Resolution: fixed
