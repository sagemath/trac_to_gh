# Issue 32451: Matrix_dense API functions set_unsafe_si vs. set_unsafe_int

archive/issues_032451.json:
```json
{
    "body": "CC:  @kliem @tscrim\n\n`src/sage/matrix/matrix_dense.pxd`\ndefines the general API\n`cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)`\n\nbut `src/sage/matrix/matrix_integer_dense.pyx` does not implement it; instead, it implements \n`cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value)`\n\nThis should be unified.\nLikewise probably with `get`.\n\n`set_unsafe_si` is used in \nsrc/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/32688\n\n",
    "created_at": "2021-10-14T00:38:21Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.6",
    "title": "Matrix_dense API functions set_unsafe_si vs. set_unsafe_int",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/32451",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @kliem @tscrim

`src/sage/matrix/matrix_dense.pxd`
defines the general API
`cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)`

but `src/sage/matrix/matrix_integer_dense.pyx` does not implement it; instead, it implements 
`cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value)`

This should be unified.
Likewise probably with `get`.

`set_unsafe_si` is used in 
src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx





Issue created by migration from https://trac.sagemath.org/ticket/32688





---

archive/issue_comments_462433.json:
```json
{
    "body": "\n```\n$ git grep \"et_unsafe_\"\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,3,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,2,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,1,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,0,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,0,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,1,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,2,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,3,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,3,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,2,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,1,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,0,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,0,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,1,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,2,tmp)\nsrc/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,3,tmp)\nsrc/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                    incidence_matrix.set_unsafe_si(0, i, 1)\nsrc/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                    incidence_matrix.set_unsafe_si(Vindex, Hindex, 1)\nsrc/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                incidence_matrix.set_unsafe_si(Vindex, Hindex, 1)\nsrc/sage/geometry/polyhedron/combinatorial_polyhedron/list_of_faces.pyx:                M.set_unsafe_si(i, j, 1)\nsrc/sage/matrix/change_ring.pyx:            M.set_unsafe_double(i,j,A.get_unsafe_double(i,j))\nsrc/sage/matrix/matrix_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)\nsrc/sage/matrix/matrix_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):\nsrc/sage/matrix/matrix_gfpn_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)\nsrc/sage/matrix/matrix_gfpn_dense.pxd:    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j)\nsrc/sage/matrix/matrix_gfpn_dense.pyx:    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j):\nsrc/sage/matrix/matrix_gfpn_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):\nsrc/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, const mpz_t value)\nsrc/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value)\nsrc/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value)\nsrc/sage/matrix/matrix_integer_dense.pxd:    cdef inline void get_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, mpz_t value)\nsrc/sage/matrix/matrix_integer_dense.pxd:    cdef inline double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j)\nsrc/sage/matrix/matrix_integer_dense.pyx:        self.set_unsafe_mpz(i, j, (<Integer>x).value)\nsrc/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, const mpz_t value):\nsrc/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value):\nsrc/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value):\nsrc/sage/matrix/matrix_integer_dense.pyx:        self.get_unsafe_mpz(i, j, z.value)\nsrc/sage/matrix/matrix_integer_dense.pyx:    cdef inline void get_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, mpz_t value):\nsrc/sage/matrix/matrix_integer_dense.pyx:    cdef inline double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j):\nsrc/sage/matrix/matrix_integer_dense.pyx:                self.get_unsafe_mpz(i,j,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:                        self.set_unsafe_mpz(i,j,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:                        self.set_unsafe_mpz(i,k,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:                            self.set_unsafe_mpz(i,j,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:                            self.set_unsafe_mpz(i,k,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:                res.set_unsafe_si(i,j,res_l[k])\nsrc/sage/matrix/matrix_integer_dense.pyx:                self.get_unsafe_mpz(i,j,tmp)\nsrc/sage/matrix/matrix_integer_dense.pyx:            M.set_unsafe_mpz(i,j,tmp[j])\nsrc/sage/matrix/matrix_mod2_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)\nsrc/sage/matrix/matrix_mod2_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):\nsrc/sage/matrix/matrix_modn_dense_double.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):\nsrc/sage/matrix/matrix_modn_dense_float.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):\nsrc/sage/matrix/matrix_modn_dense_template.pxi:                L.set_unsafe_double(i, j, A_row[j])\nsrc/sage/matrix/matrix_modn_dense_template_header.pxi:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)\nsrc/sage/matrix/matrix_modn_sparse.pyx:                ans.set_unsafe_int(i, j, s)\nsrc/sage/matrix/matrix_real_double_dense.pxd:    cdef set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value)\nsrc/sage/matrix/matrix_real_double_dense.pxd:    cdef double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j)\nsrc/sage/matrix/matrix_real_double_dense.pyx:    cdef set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value):\nsrc/sage/matrix/matrix_real_double_dense.pyx:    cdef double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j):\nsrc/sage/matrix/misc.pyx:            A.get_unsafe_mpz(i, j, a)\nsrc/sage/matrix/misc.pyx:                A.get_unsafe_mpz(i, j, tmp)\nsrc/sage/rings/polynomial/real_roots.pyx:        m.get_unsafe_mpz(k,a,tmp)\n```\n\n\nOverall this is hardly being used. I would probably go by the scheme `set_unsafe_<type>`.\nAs `si` is not a type, I prefer `set_unsafe_int`, `set_unsafe_long`, `set_unsafe_double`.",
    "created_at": "2021-10-14T09:35:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462433",
    "user": "https://github.com/kliem"
}
```


```
$ git grep "et_unsafe_"
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,3,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,2,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,1,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(n-i-1,0,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,0,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,1,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,2,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            A.set_unsafe_mpz(i,3,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,3,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,2,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,1,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,0,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,0,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,1,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,2,tmp)
src/sage/algebras/quatalg/quaternion_algebra_cython.pyx:            H.get_unsafe_mpz(i,3,tmp)
src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                    incidence_matrix.set_unsafe_si(0, i, 1)
src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                    incidence_matrix.set_unsafe_si(Vindex, Hindex, 1)
src/sage/geometry/polyhedron/combinatorial_polyhedron/base.pyx:                incidence_matrix.set_unsafe_si(Vindex, Hindex, 1)
src/sage/geometry/polyhedron/combinatorial_polyhedron/list_of_faces.pyx:                M.set_unsafe_si(i, j, 1)
src/sage/matrix/change_ring.pyx:            M.set_unsafe_double(i,j,A.get_unsafe_double(i,j))
src/sage/matrix/matrix_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)
src/sage/matrix/matrix_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):
src/sage/matrix/matrix_gfpn_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)
src/sage/matrix/matrix_gfpn_dense.pxd:    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j)
src/sage/matrix/matrix_gfpn_dense.pyx:    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j):
src/sage/matrix/matrix_gfpn_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):
src/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, const mpz_t value)
src/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value)
src/sage/matrix/matrix_integer_dense.pxd:    cdef void set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value)
src/sage/matrix/matrix_integer_dense.pxd:    cdef inline void get_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, mpz_t value)
src/sage/matrix/matrix_integer_dense.pxd:    cdef inline double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j)
src/sage/matrix/matrix_integer_dense.pyx:        self.set_unsafe_mpz(i, j, (<Integer>x).value)
src/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, const mpz_t value):
src/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_si(self, Py_ssize_t i, Py_ssize_t j, long value):
src/sage/matrix/matrix_integer_dense.pyx:    cdef void set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value):
src/sage/matrix/matrix_integer_dense.pyx:        self.get_unsafe_mpz(i, j, z.value)
src/sage/matrix/matrix_integer_dense.pyx:    cdef inline void get_unsafe_mpz(self, Py_ssize_t i, Py_ssize_t j, mpz_t value):
src/sage/matrix/matrix_integer_dense.pyx:    cdef inline double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j):
src/sage/matrix/matrix_integer_dense.pyx:                self.get_unsafe_mpz(i,j,tmp)
src/sage/matrix/matrix_integer_dense.pyx:                        self.set_unsafe_mpz(i,j,tmp)
src/sage/matrix/matrix_integer_dense.pyx:                        self.set_unsafe_mpz(i,k,tmp)
src/sage/matrix/matrix_integer_dense.pyx:                            self.set_unsafe_mpz(i,j,tmp)
src/sage/matrix/matrix_integer_dense.pyx:                            self.set_unsafe_mpz(i,k,tmp)
src/sage/matrix/matrix_integer_dense.pyx:                res.set_unsafe_si(i,j,res_l[k])
src/sage/matrix/matrix_integer_dense.pyx:                self.get_unsafe_mpz(i,j,tmp)
src/sage/matrix/matrix_integer_dense.pyx:            M.set_unsafe_mpz(i,j,tmp[j])
src/sage/matrix/matrix_mod2_dense.pxd:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)
src/sage/matrix/matrix_mod2_dense.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):
src/sage/matrix/matrix_modn_dense_double.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):
src/sage/matrix/matrix_modn_dense_float.pyx:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value):
src/sage/matrix/matrix_modn_dense_template.pxi:                L.set_unsafe_double(i, j, A_row[j])
src/sage/matrix/matrix_modn_dense_template_header.pxi:    cdef set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value)
src/sage/matrix/matrix_modn_sparse.pyx:                ans.set_unsafe_int(i, j, s)
src/sage/matrix/matrix_real_double_dense.pxd:    cdef set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value)
src/sage/matrix/matrix_real_double_dense.pxd:    cdef double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j)
src/sage/matrix/matrix_real_double_dense.pyx:    cdef set_unsafe_double(self, Py_ssize_t i, Py_ssize_t j, double value):
src/sage/matrix/matrix_real_double_dense.pyx:    cdef double get_unsafe_double(self, Py_ssize_t i, Py_ssize_t j):
src/sage/matrix/misc.pyx:            A.get_unsafe_mpz(i, j, a)
src/sage/matrix/misc.pyx:                A.get_unsafe_mpz(i, j, tmp)
src/sage/rings/polynomial/real_roots.pyx:        m.get_unsafe_mpz(k,a,tmp)
```


Overall this is hardly being used. I would probably go by the scheme `set_unsafe_<type>`.
As `si` is not a type, I prefer `set_unsafe_int`, `set_unsafe_long`, `set_unsafe_double`.



---

archive/issue_comments_462434.json:
```json
{
    "body": "New commits:",
    "created_at": "2021-10-14T09:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462434",
    "user": "https://github.com/kliem"
}
```

New commits:



---

archive/issue_comments_462435.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-10-14T09:54:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462435",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462436.json:
```json
{
    "body": "There are two problems with the general API:\n\n- It takes in `int` instead of a `long`.\n- It is not declared `void`, which means that there is an error check after each call.\n\nHowever, I can't claim that I have a use case for either one in `CombinatorialPolyhedron`. So we could remove `set_unsafe_long` and `get_unsafe_long` for `set_unsafe_int` and `get_unsafe_int` altogether, if you think this is better.",
    "created_at": "2021-10-14T10:10:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462436",
    "user": "https://github.com/kliem"
}
```

There are two problems with the general API:

- It takes in `int` instead of a `long`.
- It is not declared `void`, which means that there is an error check after each call.

However, I can't claim that I have a use case for either one in `CombinatorialPolyhedron`. So we could remove `set_unsafe_long` and `get_unsafe_long` for `set_unsafe_int` and `get_unsafe_int` altogether, if you think this is better.



---

archive/issue_comments_462437.json:
```json
{
    "body": "Yes, I think getting rid of `set_unsafe_si` (= `set_unsafe_long`) would be best.\n\nBut I think this needs deprecation (in the docstring) because it has been there since 2014\n\nIs changing `set_unsafe_int` to declare void a problem?",
    "created_at": "2021-10-14T19:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462437",
    "user": "https://github.com/mkoeppe"
}
```

Yes, I think getting rid of `set_unsafe_si` (= `set_unsafe_long`) would be best.

But I think this needs deprecation (in the docstring) because it has been there since 2014

Is changing `set_unsafe_int` to declare void a problem?



---

archive/issue_comments_462438.json:
```json
{
    "body": "`void` doesn't catch error at all. What makes sense is a declaration like\n\n`cdef int set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value) except -1`.",
    "created_at": "2021-10-25T13:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462438",
    "user": "https://github.com/kliem"
}
```

`void` doesn't catch error at all. What makes sense is a declaration like

`cdef int set_unsafe_int(self, Py_ssize_t i, Py_ssize_t j, int value) except -1`.



---

archive/issue_comments_462439.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T14:03:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462439",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462440.json:
```json
{
    "body": "Replying to [comment:4 mkoeppe]:\n> \n> But I think this needs deprecation (in the docstring) because it has been there since 2014\n\nHow would you deprecate a cython function. Either people are going to find out the hard way or nobody is using it anyway.",
    "created_at": "2021-10-25T14:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462440",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:4 mkoeppe]:
> 
> But I think this needs deprecation (in the docstring) because it has been there since 2014

How would you deprecate a cython function. Either people are going to find out the hard way or nobody is using it anyway.



---

archive/issue_comments_462441.json:
```json
{
    "body": "Just the old-fashioned way: Add a comment to the docstring that says \"don't use\".",
    "created_at": "2021-10-25T15:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462441",
    "user": "https://github.com/mkoeppe"
}
```

Just the old-fashioned way: Add a comment to the docstring that says "don't use".



---

archive/issue_comments_462442.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-25T16:26:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462442",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462443.json:
```json
{
    "body": "There are two test failures (apart from the one in `integer.pyx`):\n\n```\nsage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py\n**********************************************************************\nFile \"src/sage/modules/free_module_integer.py\", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL\nFailed example:\n    new_min <= old_min\nExpected:\n    True\nGot:\n    False\n\nsage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py\n**********************************************************************\nFile \"src/sage/schemes/toric/sheaf/klyachko.py\", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation\nFailed example:\n    Vtilde.cohomology(dim=True, weight=(0,))\nExpected:\n    (1, 0)\nGot:\n    (0, 0)\n```\n\nAre these from the changes on the ticket or just from random fuzzing?",
    "created_at": "2021-10-26T06:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462443",
    "user": "https://github.com/mkoeppe"
}
```

There are two test failures (apart from the one in `integer.pyx`):

```
sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py
**********************************************************************
File "src/sage/modules/free_module_integer.py", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL
Failed example:
    new_min <= old_min
Expected:
    True
Got:
    False

sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py
**********************************************************************
File "src/sage/schemes/toric/sheaf/klyachko.py", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation
Failed example:
    Vtilde.cohomology(dim=True, weight=(0,))
Expected:
    (1, 0)
Got:
    (0, 0)
```

Are these from the changes on the ticket or just from random fuzzing?



---

archive/issue_comments_462444.json:
```json
{
    "body": "LGTM but another look by someone more experienced with Cython would be valuable",
    "created_at": "2021-10-26T06:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462444",
    "user": "https://github.com/mkoeppe"
}
```

LGTM but another look by someone more experienced with Cython would be valuable



---

archive/issue_comments_462445.json:
```json
{
    "body": "Replying to [comment:10 mkoeppe]:\n> There are two test failures (apart from the one in `integer.pyx`):\n> {{{\n> sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py\n> **********************************************************************\n> File \"src/sage/modules/free_module_integer.py\", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL\n> Failed example:\n>     new_min <= old_min\n> Expected:\n>     True\n> Got:\n>     False\n> \n> sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py\n> **********************************************************************\n> File \"src/sage/schemes/toric/sheaf/klyachko.py\", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation\n> Failed example:\n>     Vtilde.cohomology(dim=True, weight=(0,))\n> Expected:\n>     (1, 0)\n> Got:\n>     (0, 0)\n> }}}\n> Are these from the changes on the ticket or just from random fuzzing?\n> \n\nYes, I added them to #32544.",
    "created_at": "2021-10-26T07:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462445",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:10 mkoeppe]:
> There are two test failures (apart from the one in `integer.pyx`):
> {{{
> sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/modules/free_module_integer.py
> **********************************************************************
> File "src/sage/modules/free_module_integer.py", line 370, in sage.modules.free_module_integer.FreeModule_submodule_with_basis_integer.LLL
> Failed example:
>     new_min <= old_min
> Expected:
>     True
> Got:
>     False
> 
> sage -t --long --random-seed=23747002002644886606785003174022326205 src/sage/schemes/toric/sheaf/klyachko.py
> **********************************************************************
> File "src/sage/schemes/toric/sheaf/klyachko.py", line 951, in sage.schemes.toric.sheaf.klyachko.KlyachkoBundle_class.random_deformation
> Failed example:
>     Vtilde.cohomology(dim=True, weight=(0,))
> Expected:
>     (1, 0)
> Got:
>     (0, 0)
> }}}
> Are these from the changes on the ticket or just from random fuzzing?
> 

Yes, I added them to #32544.



---

archive/issue_comments_462446.json:
```json
{
    "body": "We don't need to deprecate the Cython function since that is definitely internal-use only. Someone has to really be reaching into the internals a bit to use it, so they should be comfortable enough with dealing with the resulting error. They almost certainly won't read the documentation change; so they will have the same issue once we remove it. So, IMO, we should just remove it now.\n\nWhy do we need to allow an error to be raised with the `set_unsafe`? The point of `unsafe` is that it is allowed to crash Sage if it is trying to do something invalid. All of the other implementations follow this AFAIK. Is there some reason you want errors to be handled there?",
    "created_at": "2021-10-26T11:07:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462446",
    "user": "https://github.com/tscrim"
}
```

We don't need to deprecate the Cython function since that is definitely internal-use only. Someone has to really be reaching into the internals a bit to use it, so they should be comfortable enough with dealing with the resulting error. They almost certainly won't read the documentation change; so they will have the same issue once we remove it. So, IMO, we should just remove it now.

Why do we need to allow an error to be raised with the `set_unsafe`? The point of `unsafe` is that it is allowed to crash Sage if it is trying to do something invalid. All of the other implementations follow this AFAIK. Is there some reason you want errors to be handled there?



---

archive/issue_comments_462447.json:
```json
{
    "body": "So far `set_unsafe` only assumes the coordinates unsafely, but does coerce the object and catches resulting errors. However, we can change this behavior.",
    "created_at": "2021-10-26T11:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462447",
    "user": "https://github.com/kliem"
}
```

So far `set_unsafe` only assumes the coordinates unsafely, but does coerce the object and catches resulting errors. However, we can change this behavior.



---

archive/issue_comments_462448.json:
```json
{
    "body": "That doesn't seem to be the case for `Matrix_integer_dense`. The `set_unsafe` immediately calls `set_unsafe_mpz`, which is a `void`, after a (unprotected) cast.\n\nWhere is it doing the coercion? From looking at the code, the only place it could possibly be doing this is in `Matrix_integer_dense._hnf_modn`. I would say it is the job of that function (or more generally, any function calling the `set_unsafe_int`) to ensure the input is valid. Can you be more specific about what fails if we don't allow the error to propagate?",
    "created_at": "2021-10-26T11:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462448",
    "user": "https://github.com/tscrim"
}
```

That doesn't seem to be the case for `Matrix_integer_dense`. The `set_unsafe` immediately calls `set_unsafe_mpz`, which is a `void`, after a (unprotected) cast.

Where is it doing the coercion? From looking at the code, the only place it could possibly be doing this is in `Matrix_integer_dense._hnf_modn`. I would say it is the job of that function (or more generally, any function calling the `set_unsafe_int`) to ensure the input is valid. Can you be more specific about what fails if we don't allow the error to propagate?



---

archive/issue_events_086553.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T20:21:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32451#event-86553"
}
```



---

archive/issue_comments_462449.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2022-02-19T18:29:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462449",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_462450.json:
```json
{
    "body": "Replying to [comment:15 tscrim]:\n> That doesn't seem to be the case for `Matrix_integer_dense`. The `set_unsafe` immediately calls `set_unsafe_mpz`, which is a `void`, after a (unprotected) cast.\n> \n> Where is it doing the coercion? From looking at the code, the only place it could possibly be doing this is in `Matrix_integer_dense._hnf_modn`. I would say it is the job of that function (or more generally, any function calling the `set_unsafe_int`) to ensure the input is valid. Can you be more specific about what fails if we don't allow the error to propagate?\n\nSorry for the late reply.\n\nHere it is doing some coercion:\n\n\n```\nsage: matrix(RDF,3,range(9))\n[0.0 1.0 2.0]\n[3.0 4.0 5.0]\n[6.0 7.0 8.0]\nsage: A = matrix(RDF,3,range(9))\nsage: cython('''\n....: from sage.matrix.matrix_double_dense cimport Matrix_double_dense\n....: def foo(Matrix_double_dense A, i, j, object x):\n....:     A.set_unsafe(i, j, x)\n....: ''')\nsage: foo(A, 0, 0, 'a')\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-14-4a46d43f4024> in <module>\n----> 1 foo(A, Integer(0), Integer(0), 'a')\n\n~/.sage/temp/kliem-ThinkPad-L570/4973/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx_0.foo()\n      2 from sage.matrix.matrix_double_dense cimport Matrix_double_dense\n      3 def foo(Matrix_double_dense A, i, j, object x):\n----> 4     A.set_unsafe(i, j, x)\n\n~/Applications/sage/local/lib/python3.8/site-packages/sage/matrix/matrix_double_dense.pyx in sage.matrix.matrix_double_dense.Matrix_double_dense.set_unsafe (build/cythonized/sage/matrix/matrix_double_dense.c:4311)()\n    239         status = cnumpy.PyArray_SETITEM(self._matrix_numpy,\n    240                         cnumpy.PyArray_GETPTR2(self._matrix_numpy, i, j),\n--> 241                         self._python_dtype(value))\n    242         #TODO: Throw an error if status == -1\n    243 \n\nValueError: could not convert string to float: 'a'\n```\n\n\nOtherwise `set_unsafe_si` does do coercion by the signature:\n\n\n```\nsage: A = matrix(ZZ,3,range(9))\nsage: cython('''\n....: from sage.matrix.matrix_integer_dense cimport Matrix_integer_dense\n....: def foo(Matrix_integer_dense A, i, j, object x):\n....:     A.set_unsafe_si(i, j, x)\n....: ''')\nsage: foo(A, 0, 0, '2')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-13-b9ea546bfc8b> in <module>\n----> 1 foo(A, Integer(0), Integer(0), '2')\n\n~/.sage/temp/kliem-ThinkPad-L570/5379/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx_0.foo()\n      2 from sage.matrix.matrix_integer_dense cimport Matrix_integer_dense\n      3 def foo(Matrix_integer_dense A, i, j, object x):\n----> 4     A.set_unsafe_si(i, j, x)\n\nTypeError: an integer is required\n```\n",
    "created_at": "2022-02-19T19:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462450",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:15 tscrim]:
> That doesn't seem to be the case for `Matrix_integer_dense`. The `set_unsafe` immediately calls `set_unsafe_mpz`, which is a `void`, after a (unprotected) cast.
> 
> Where is it doing the coercion? From looking at the code, the only place it could possibly be doing this is in `Matrix_integer_dense._hnf_modn`. I would say it is the job of that function (or more generally, any function calling the `set_unsafe_int`) to ensure the input is valid. Can you be more specific about what fails if we don't allow the error to propagate?

Sorry for the late reply.

Here it is doing some coercion:


```
sage: matrix(RDF,3,range(9))
[0.0 1.0 2.0]
[3.0 4.0 5.0]
[6.0 7.0 8.0]
sage: A = matrix(RDF,3,range(9))
sage: cython('''
....: from sage.matrix.matrix_double_dense cimport Matrix_double_dense
....: def foo(Matrix_double_dense A, i, j, object x):
....:     A.set_unsafe(i, j, x)
....: ''')
sage: foo(A, 0, 0, 'a')
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-14-4a46d43f4024> in <module>
----> 1 foo(A, Integer(0), Integer(0), 'a')

~/.sage/temp/kliem-ThinkPad-L570/4973/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_4973_tmp_mfpt1cva_pyx_0.foo()
      2 from sage.matrix.matrix_double_dense cimport Matrix_double_dense
      3 def foo(Matrix_double_dense A, i, j, object x):
----> 4     A.set_unsafe(i, j, x)

~/Applications/sage/local/lib/python3.8/site-packages/sage/matrix/matrix_double_dense.pyx in sage.matrix.matrix_double_dense.Matrix_double_dense.set_unsafe (build/cythonized/sage/matrix/matrix_double_dense.c:4311)()
    239         status = cnumpy.PyArray_SETITEM(self._matrix_numpy,
    240                         cnumpy.PyArray_GETPTR2(self._matrix_numpy, i, j),
--> 241                         self._python_dtype(value))
    242         #TODO: Throw an error if status == -1
    243 

ValueError: could not convert string to float: 'a'
```


Otherwise `set_unsafe_si` does do coercion by the signature:


```
sage: A = matrix(ZZ,3,range(9))
sage: cython('''
....: from sage.matrix.matrix_integer_dense cimport Matrix_integer_dense
....: def foo(Matrix_integer_dense A, i, j, object x):
....:     A.set_unsafe_si(i, j, x)
....: ''')
sage: foo(A, 0, 0, '2')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-13-b9ea546bfc8b> in <module>
----> 1 foo(A, Integer(0), Integer(0), '2')

~/.sage/temp/kliem-ThinkPad-L570/5379/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_5379_tmp_3b6fet_r_pyx_0.foo()
      2 from sage.matrix.matrix_integer_dense cimport Matrix_integer_dense
      3 def foo(Matrix_integer_dense A, i, j, object x):
----> 4     A.set_unsafe_si(i, j, x)

TypeError: an integer is required
```




---

archive/issue_comments_462451.json:
```json
{
    "body": "Actually, I'm mistaken. Apparently this typechicking by cython is done before actually calling this function:\n\n\n```\nsage: cython('''\n....: cdef void foo(int a):\n....:     pass\n....:     \n....: def foo2(object a):\n....:     foo(a)\n....: ''')\nsage: foo2('2')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-0205a4bb239b> in <module>\n----> 1 foo2('2')\n\n~/.sage/temp/kliem-ThinkPad-L570/5777/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx_0.foo2()\n      4 \n      5 def foo2(object a):\n----> 6     foo(a)\n\nTypeError: an integer is required\n```\n",
    "created_at": "2022-02-19T19:24:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462451",
    "user": "https://github.com/kliem"
}
```

Actually, I'm mistaken. Apparently this typechicking by cython is done before actually calling this function:


```
sage: cython('''
....: cdef void foo(int a):
....:     pass
....:     
....: def foo2(object a):
....:     foo(a)
....: ''')
sage: foo2('2')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-0205a4bb239b> in <module>
----> 1 foo2('2')

~/.sage/temp/kliem-ThinkPad-L570/5777/spyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx/_home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx_0.pyx in _home_jonathan__sage_temp_kliem_ThinkPad_L570_5777_tmp_8jwi5wrg_pyx_0.foo2()
      4 
      5 def foo2(object a):
----> 6     foo(a)

TypeError: an integer is required
```




---

archive/issue_comments_462452.json:
```json
{
    "body": "I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.\n\nCan we also just remove the `_si` methods since these should no longer be used? If you aren't going to remove them, then they should emit a deprecation. (But as I said above, IMO it is not necessary to deprecate them.)",
    "created_at": "2022-02-20T04:47:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462452",
    "user": "https://github.com/tscrim"
}
```

I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.

Can we also just remove the `_si` methods since these should no longer be used? If you aren't going to remove them, then they should emit a deprecation. (But as I said above, IMO it is not necessary to deprecate them.)



---

archive/issue_comments_462453.json:
```json
{
    "body": "Replying to [comment:21 tscrim]:\n> I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.\n\nAs mentioned above, the methods `set_unsafe_si` and `set_unsafe_int` already have error handling by the signature. So, the `except -1` can safely go.\n\n> \n> Can we also just remove the `_si` methods since these should no longer be used? If you aren't going to remove them, then they should emit a deprecation. (But as I said above, IMO it is not necessary to deprecate them.)\n\nI agree, deprecation for cython functions doesn't really work.",
    "created_at": "2022-02-20T13:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462453",
    "user": "https://github.com/kliem"
}
```

Replying to [comment:21 tscrim]:
> I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.

As mentioned above, the methods `set_unsafe_si` and `set_unsafe_int` already have error handling by the signature. So, the `except -1` can safely go.

> 
> Can we also just remove the `_si` methods since these should no longer be used? If you aren't going to remove them, then they should emit a deprecation. (But as I said above, IMO it is not necessary to deprecate them.)

I agree, deprecation for cython functions doesn't really work.



---

archive/issue_comments_462454.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-20T16:03:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462454",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462455.json:
```json
{
    "body": "Actually, `set_unsafe_int` defaults for `Matrix_dense` to just call `set_unsafe`.\n\nThis might raise an error, e.g. if it's not implemented.",
    "created_at": "2022-02-20T16:07:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462455",
    "user": "https://github.com/kliem"
}
```

Actually, `set_unsafe_int` defaults for `Matrix_dense` to just call `set_unsafe`.

This might raise an error, e.g. if it's not implemented.



---

archive/issue_comments_462456.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2022-02-21T06:11:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462456",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_462457.json:
```json
{
    "body": "\n```\n+    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j):\n+        \"\"\"\n+        Return (j, i) entry of self as a new Integer.\n```\n\n\nWhy (j, i)?",
    "created_at": "2022-02-21T06:39:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462457",
    "user": "https://github.com/mkoeppe"
}
```


```
+    cdef inline int get_unsafe_int(self, Py_ssize_t i, Py_ssize_t j):
+        """
+        Return (j, i) entry of self as a new Integer.
```


Why (j, i)?



---

archive/issue_comments_462458.json:
```json
{
    "body": "Because its a typo I copy-pasted.",
    "created_at": "2022-02-21T06:40:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462458",
    "user": "https://github.com/kliem"
}
```

Because its a typo I copy-pasted.



---

archive/issue_comments_462459.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-21T06:44:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462459",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462460.json:
```json
{
    "body": "Replying to [comment:22 gh-kliem]:\n> Replying to [comment:21 tscrim]:\n> > I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.\n> \n> As mentioned above, the methods `set_unsafe_si` and `set_unsafe_int` already have error handling by the signature. So, the `except -1` can safely go.\n\nThey are the only methods to not return a `void` (necessitated by the `except -1`), which you added.\n\nReplying to [comment:24 gh-kliem]:\n> This might raise an error, e.g. if it's not implemented. \n\nIt is allowed to crash as it is a promise that method is implemented and being an `unsafe` method.\n\nI still think we shouldn't introduce this inconsistency and keep it a `void` with no `except -1`.",
    "created_at": "2022-02-22T05:47:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462460",
    "user": "https://github.com/tscrim"
}
```

Replying to [comment:22 gh-kliem]:
> Replying to [comment:21 tscrim]:
> > I still don't think it is necessary to do any error handling for the `unsafe` methods, and I would like to be consistent with the `unsafe` methods.
> 
> As mentioned above, the methods `set_unsafe_si` and `set_unsafe_int` already have error handling by the signature. So, the `except -1` can safely go.

They are the only methods to not return a `void` (necessitated by the `except -1`), which you added.

Replying to [comment:24 gh-kliem]:
> This might raise an error, e.g. if it's not implemented. 

It is allowed to crash as it is a promise that method is implemented and being an `unsafe` method.

I still think we shouldn't introduce this inconsistency and keep it a `void` with no `except -1`.



---

archive/issue_comments_462461.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2022-02-22T14:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462461",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462462.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2022-02-27T00:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462462",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_462463.json:
```json
{
    "body": "Thank you. Bot is (morally) green. I am setting this to a positive review.",
    "created_at": "2022-02-27T00:36:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462463",
    "user": "https://github.com/tscrim"
}
```

Thank you. Bot is (morally) green. I am setting this to a positive review.



---

archive/issue_comments_462464.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2022-02-27T22:00:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/32451#issuecomment-462464",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086554.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-02-27T22:00:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/32451",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/32451#event-86554"
}
```
