# Issue 18942: Chain homotopies

Issue created by migration from Trac.

Original creator: jhpalmieri

Original creation time: 2015-09-10 02:13:28

CC:  tscrim chapoton

This ticket add chain homotopies, chain contractions, and duals of chain maps and chain homotopies. This is a dependency for #6101 and #6102.



---

Comment by jhpalmieri created at 2015-09-10 02:28:32

New commits:


---

Comment by jhpalmieri created at 2015-09-10 02:28:32

Changing status from new to needs_review.


---

Comment by git created at 2015-09-10 15:18:17

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-09-10 15:20:26

It's too messy for me to disentangle this from #6102, so that ticket and this are now dependencies of each other. In particular, the most natural way to construct examples of chain contractions is to use the algebraic topological model of a complex (which is part of #6102). So some of the examples here use code that is part of #6102. The actual code here doesn't depend on #6102, just those few examples.


---

Comment by git created at 2015-09-11 18:15:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-11 18:21:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-09-12 16:24:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-09-12 16:27:23

#18246 broke the default hashing of chain homotopies, so I've added a `__hash__` method, and also one for chain maps.


---

Comment by chapoton created at 2015-09-14 13:11:34

This looks strange, in chain_complex_morphism.py:

```
+        self._matrix_dictionary = {}
+        for i in matrices:
+            m = matrices[i]
+            # Use immutable matrices because they're hashable.
+            m.set_immutable()
+            self._matrix_dictionary[i] = m
         self._matrix_dictionary = matrices
```

Should the last line be removed ?


---

Comment by jhpalmieri created at 2015-09-14 15:16:06

Yes, thank you.


---

Comment by git created at 2015-09-14 15:16:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by cnassau created at 2015-09-23 19:13:27

I've been playing around with this for the last week and I'm essentially ready to give the ticket a positive review. I can think of a couple of very minor improvements that might be better addressed in a follow-up ticket:
   - add syntactic sugar to replace `H._g` with something like `H[1]`, or `H.endpoint(1)` or whatever
   - create a parent for chain homotopies so that linear combinations can be taken easily

I encountered one more serious surprise in my experiments, and I'm not quite sure how to address this: I was starting with a chain complex `C` over the integers, and I wanted to work with its reduction modulo 2. The code that I came up with actually messed up the original complex:

```
sage: d1 = matrix([[-1,1,0],[1,-1,0],[-1,0,1],[1,0,-1]]).transpose()
sage: d2 = matrix([[-1,-1,+1,+1],[1,1,1,1]]).transpose()
sage: C=ChainComplex({2:d2,1:d1},degree_of_differential=-1,base_ring=ZZ)
sage: ascii_art(C)
                                [-1  1]      
            [-1  1 -1  1]       [-1  1]      
            [ 1 -1  0  0]       [ 1  1]      
            [ 0  0  1 -1]       [ 1  1]      
 0 <-- C_0 <-------------- C_1 <-------- C_2 <-- 0 
sage: D=ChainComplex(C._diff,degree_of_differential=C.degree_of_differential(),base_ring=GF(2))
sage: ascii_art(C)
                            [1 1]      
            [1 1 1 1]       [1 1]      
            [1 1 0 0]       [1 1]      
            [0 0 1 1]       [1 1]      
 0 <-- C_0 <---------- C_1 <------ C_2 <-- 0 
```

I would have expected an error here, and possibly a more convenient way to carry out the base change.

As for the patchbot errors: these are a bit confusing; I think they're all due to the fact that the dependencies of the ticket have not been properly merged for the test. Given the dependencies with #6101, #6102 I wonder if it isn't the best approach to approve them all at once, eventually.... (?)


---

Comment by jhpalmieri created at 2015-09-23 19:34:31

With your example, using `D = Chain Complex(C.differential(), ...)` works better than with `C._diff`, because `C.differential()` returns a copy of the defining data, and so modifying it won't change `C`. It can be dangerous using hidden attributes, and the corresponding methods ought to be safer.

If you are willing to give this a positive review, then #6101 should come next, but neither will get merged without the other.


---

Comment by chapoton created at 2015-10-07 15:36:09

a few remarks on the doc:

* please remove the dot at the end of the title line of the new file.

* Please remove the \circ in H \circ H at several places where it appears (or, if you really prefer, put such a composition symbol everywhere else), for coherence with other compositions.

* What happens in chain homotopy if the given g is None ? This should be explained in the doc.

* The def of "dual" of chain homotopy class should start with `r"""`

* In dual for chain contraction, skip one line after the first sentence


---

Comment by chapoton created at 2015-10-07 15:36:09

Changing keywords from "" to "homotopy".


---

Comment by chapoton created at 2015-10-07 15:36:09

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-10-07 19:42:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jhpalmieri created at 2015-10-07 19:43:54

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2015-10-07 19:43:54

Replying to [comment:14 chapoton]:
> a few remarks on the doc:
> 
> * please remove the dot at the end of the title line of the new file.

Done
 
> * Please remove the \circ in H \circ H at several places where it appears (or, if you really prefer, put such a composition symbol everywhere else), for coherence with other compositions.

Done (removed `\circ`)
 
> * What happens in chain homotopy if the given g is None ? This should be explained in the doc.

This was already there, but I added a sentence.
 
> * The def of "dual" of chain homotopy class should start with `r"""`

Right, fixed.
 
> * In dual for chain contraction, skip one line after the first sentence

Done.


---

Comment by chapoton created at 2015-10-07 19:46:17

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2015-10-07 19:46:17

ok, thanks. Then good to go. It will of course be pending until #6102 is reviewed.


---

Comment by vbraun created at 2015-10-17 08:44:31

Circular dependency, please make up your mind what you want merged first


---

Comment by chapoton created at 2015-10-17 12:55:58

This one first please, but it will not pass the doctests alone.


---

Comment by vbraun created at 2015-10-18 12:06:20

Resolution: fixed
