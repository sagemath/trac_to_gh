# Issue 23577: Fix is_preperiodic function domain check

archive/issues_023577.json:
```json
{
    "body": "CC:  @bhutz\n\nCurrently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point \"is\" the domain of the map will fail, as is_preperiodic currently does:\n\n```python\nsage: R.<X> = PolynomialRing(QQ)\nsage: K.<a> = NumberField(X^2 + X - 1)\nsage: P.<x,y> = ProjectiveSpace(K,1)\nsage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])\nsage: Q = P.point([a,1])\nsage: f.nth_iterate(Q,2) == Q\nTrue\nsage: Q.is_preperiodic(f)\nTraceback (most recent call last):\n...\nTypeError: point must be in domain of map\nsage: f.domain() is P\nFalse\nsage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory\nTrue\n```\n\nInstead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under \"is\", and then things will work as expected. This fix changes that.\n\nIssue created by migration from https://trac.sagemath.org/ticket/23814\n\n",
    "created_at": "2017-09-09T18:04:05Z",
    "labels": [
        "dynamics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.1",
    "title": "Fix is_preperiodic function domain check",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23577",
    "user": "@pfili"
}
```
CC:  @bhutz

Currently, if we define a DynamicalSystem_projective without specifying the underlying domain (which is probably the most likely way the user will do this), the init function recreates the underlying projective space. As a result, any function that checks if the domain of a point "is" the domain of the map will fail, as is_preperiodic currently does:

```python
sage: R.<X> = PolynomialRing(QQ)
sage: K.<a> = NumberField(X^2 + X - 1)
sage: P.<x,y> = ProjectiveSpace(K,1)
sage: f = DynamicalSystem_projective([x^2-2*y^2, y^2])
sage: Q = P.point([a,1])
sage: f.nth_iterate(Q,2) == Q
True
sage: Q.is_preperiodic(f)
Traceback (most recent call last):
...
TypeError: point must be in domain of map
sage: f.domain() is P
False
sage: f.domain() == P # It's basically the same but the space is not uniquely represented in memory
True
```

Instead, is_preperiodic should be using == to check that the domains are equivalent, rather than exactly the same under "is", and then things will work as expected. This fix changes that.

Issue created by migration from https://trac.sagemath.org/ticket/23814





---

archive/issue_comments_330364.json:
```json
{
    "body": "Last 10 new commits:",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330364",
    "user": "@pfili"
}
```

Last 10 new commits:



---

archive/issue_comments_330365.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-09-09T18:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330365",
    "user": "@pfili"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_330366.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330366",
    "user": "@bhutz"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330367.json:
```json
{
    "body": "Looks fine. Just fixed a minor typo.\n----\nNew commits:",
    "created_at": "2017-09-09T18:43:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330367",
    "user": "@bhutz"
}
```

Looks fine. Just fixed a minor typo.
----
New commits:



---

archive/issue_comments_330368.json:
```json
{
    "body": "merge conflict",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330368",
    "user": "@bhutz"
}
```

merge conflict



---

archive/issue_comments_330369.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2017-09-11T23:40:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330369",
    "user": "@bhutz"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_330370.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-09-11T23:43:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330370",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_330371.json:
```json
{
    "body": "fixed",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330371",
    "user": "@bhutz"
}
```

fixed



---

archive/issue_comments_330372.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-09-11T23:44:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330372",
    "user": "@bhutz"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_330373.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-09-18T18:58:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330373",
    "user": "@pfili"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_330374.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-09-24T13:03:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23577",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23577#issuecomment-330374",
    "user": "@vbraun"
}
```

Resolution: fixed
