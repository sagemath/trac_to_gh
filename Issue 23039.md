# Issue 23039: SIGABRT from GF(2^128)(0)^-1

Issue created by migration from https://trac.sagemath.org/ticket/23276

Original creator: dimpase

Original creation time: 2017-06-19 09:43:16

CC:  jdemeyer malb

This apparently comes from a missing signon/off in NTL interface.
As [reported on sage-devel](https://groups.google.com/d/msg/sage-devel/u7oHHEaf-nM/Fkn59rPnAwAJ).


---

Attachment

backtrace


---

Comment by dimpase created at 2017-06-19 09:50:53


```
sage: GF(2^128)(0)^-1
------------------------------------------------------------------------
/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/cysignals/signals.so(+0x59f8)[0x7fd96c97e9f8]
/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/cysignals/signals.so(+0x5a65)[0x7fd96c97ea65]
/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/cysignals/signals.so(+0x89ca)[0x7fd96c9819ca]
/lib64/libpthread.so.0(+0x11040)[0x7fd97c5a2040]
/lib64/libc.so.6(gsignal+0x104)[0x7fd97bb2b074]
/lib64/libc.so.6(abort+0x16a)[0x7fd97bb2c4da]
/home/dima/Sage/sage-dev/local/lib/libntl.so.33(_ZN3NTL13TerminalErrorEPKc+0x2b)[0x7fd95fdffd3b]
/home/dima/Sage/sage-dev/local/lib/libntl.so.33(_ZN3NTL6InvModERNS_4GF2XERKS0_S3_+0x84)[0x7fd95fccf534]
/home/dima/Sage/sage-dev/local/lib/libntl.so.33(_ZN3NTL8PowerModERNS_4GF2XERKS0_RKNS_2ZZERKNS_11GF2XModulusE+0x110)[0x7fd95fccf790]
/home/dima/Sage/sage-dev/local/lib/python2.7/site-packages/sage/rings/finite_rings/element_ntl_gf2e.so(+0x19fd5)[0x7fd70e010fd5]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyNumber_Power+0x1de)[0x7fd97c7fc4ce]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x45f8)[0x7fd97c8b9ce8]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fd97c8bf0c9]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x6551)[0x7fd97c8bbc41]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalFrameEx+0x7e96)[0x7fd97c8bd586]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCodeEx+0x81c)[0x7fd97c8befac]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyEval_EvalCode+0x19)[0x7fd97c8bf0c9]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyRun_FileExFlags+0x8a)[0x7fd97c8e39da]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(PyRun_SimpleFileExFlags+0xe7)[0x7fd97c8e4ed7]
/home/dima/Sage/sage-dev/local/lib/libpython2.7.so.1.0(Py_Main+0xcc1)[0x7fd97c8fbaa1]
/lib64/libc.so.6(__libc_start_main+0xf0)[0x7fd97bb181e0]
python(_start+0x2a)[0x40065a]
------------------------------------------------------------------------
Attaching gdb to process id 8113.
...
```



---

Comment by jdemeyer created at 2017-06-19 13:01:57

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2017-06-19 13:01:57

New commits:


---

Comment by jdemeyer created at 2017-06-19 13:01:57

Changing component from interfaces to basic arithmetic.


---

Comment by git created at 2017-06-19 13:05:16

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by dimpase created at 2017-06-19 13:46:05

I get exactly the same error as before with this patch.
How about adding a doctest that does exactly this:

```
sage: GF(2^128)(0)^-1
```



---

Comment by dimpase created at 2017-06-19 13:51:00

Changing status from needs_review to needs_work.


---

Comment by dimpase created at 2017-06-19 13:51:00

Note that it works for `GF(2<sup>k)(0)</sup>-1` with `k<16`, but dumps code as soon as `k` is `16` or bigger.

At this point one stops using givaro and and starts using NTL, so that's why it is different.


---

Comment by git created at 2017-06-19 14:53:14

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jdemeyer created at 2017-06-19 14:56:02

Right, there were *two* bugs (one in `__invert__` and one in `__pow__`). This should fix both of them. It also makes some unrelated changes to fix compiler warnings.


---

Comment by dimpase created at 2017-06-19 15:18:22

OK, looks good. For consistency, could you perhaps add to `raise ZeroDivisionError`
in `sage/rings/finite_rings/element_givaro` (and perhaps in the other places there) the same message `'division by zero in finite field'` as you do in `element_ntl_gf2e`?


---

Comment by git created at 2017-06-20 09:25:48

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jdemeyer created at 2017-06-20 09:27:57

Changing status from needs_work to needs_review.


---

Comment by dimpase created at 2017-06-20 10:02:32

LGTM


---

Comment by dimpase created at 2017-06-20 10:02:32

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2017-06-22 07:23:59

Resolution: fixed
