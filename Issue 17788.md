# Issue 17788: SkewTableau.rectify() optimization

Issue created by migration from Trac.

Original creator: MariaMonks

Original creation time: 2015-03-21 01:02:00

CC:  opechenik darij mariamonks tscrim jpswanson jkeitel

Keywords: days64, tableau

The SkewTableau.rectify() command currently runs JDT rather than taking the reading word of the tableau and Schensted-inserting it.  This is inefficient for skew tableaux lambda/mu having a large inner shape mu.  However, we still want to run the former algorithm if mu is small.  A cutoff point between these two algorithms should be added as an input which can be optionally changed by the user.


---

Attachment


---

Comment by opechenik created at 2015-04-03 22:46:01

Seems to guess the better algorithm in most cases. Examples below. Speed-ups range from minimal to more than an order of magnitude.

sage: T = SkewTableau([[None, None, 3, 7],[1,2,4],[5,6,7]])
sage: %timeit T.rectify()
1000 loops, best of 3: 505 µs per loop
sage: %timeit T.rectify(force='jdt')
1000 loops, best of 3: 501 µs per loop
sage: %timeit T.rectify(force='schensted')
1000 loops, best of 3: 685 µs per loop

sage: U = SkewTableau([[None, None, None, 3,4],[None, None, 1], [None, 2], [1,5]])
sage: %timeit U.rectify()
1000 loops, best of 3: 619 µs per loop
sage: %timeit U.rectify(force='jdt')
1000 loops, best of 3: 1.04 ms per loop
sage: %timeit U.rectify(force='schensted')
1000 loops, best of 3: 615 µs per loop

sage: V = SkewTableau([This is the Trac macro *None for i in range* that was inherited from the migration called with arguments (5))](https://trac.sagemath.org/wiki/WikiMacros#None for i in range-macro)* 7 + [This is the Trac macro *None, None, None, None, 1* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#None, None, None, None, 1-macro))
sage: %timeit V.rectify()
1000 loops, best of 3: 438 µs per loop
sage: %timeit V.rectify(force='jdt')
100 loops, best of 3: 7.17 ms per loop
sage: %timeit V.rectify(force='schensted')
1000 loops, best of 3: 441 µs per loop
----
New commits:


---

Comment by opechenik created at 2015-04-03 22:47:24

Changing status from new to needs_review.


---

Comment by jpswanson created at 2015-04-09 04:48:36

I changed 'force' to 'algorithm', which seems more common. I also cleaned up the code a bit, added error handling, and added a corresponding test. I'm not entirely convinced the output should be a `StandardTableau`, `SemistandardTableau`, or `Tableau` rather than just a `Tableau`, but I left that part as-is.
----
New commits:


---

Comment by darij created at 2015-04-10 20:31:26

Was this a review, Josh?

I have two minor gripes (although I don't have a complete review, sorry):

1. The `la` and `la_size` definitions should be inside the `if algorithm is None` branch. They aren't used otherwise.

2. Avoid the use of `Word`s when you don't need them (e.g., when lists are sufficient). I am fairly sure (a quick experiment will suffice to tell) that `Tableau([]).insert_word(self.to_word())` can be replaced by `Tableau([]).insert_word(sum(row for row in reversed(self), []))` and will speed up the method.


---

Comment by opechenik created at 2015-04-10 21:11:08

I implemented Darij's first suggestion, which is obviously correct.

The second suggestion doesn't work. For one thing, you are missing '[]'s. But even then your approach doesn't strip off the 'None's.

I also reordered to have it check standardness before semistandardness at the end.

Thanks for all your edits Josh!


---

Comment by darij created at 2015-04-10 23:55:20

Oops, sorry. Programming in my head doesn't work as well as I wish it to.
I'd still prefer to use words as little as possible. What about
`Tableau([]).insert_word([i for row in reversed(self) for i in row if i is not None])` ?
----
New commits:


---

Comment by jpswanson created at 2015-04-12 20:02:53

`@`darij: yes, I had intended that to be a review (hence the reviewers change), since I had looked through the code, checked for basic reasonability, and run the combanat doctests. I also ended up making to my mind small cleanup changes that themselves needed to be reviewed. Perhaps because I ended up making nearly as many changes as the original I shouldn't have set myself as reviewer quite yet?

As for words, I agree with darij's most recent suggestion, except it should probably be a generator rather than a list comprehension (just delete the square brackets). It seems that in practice this is what you'd want to use most of the time anyway. How does adding an `iter_word` or `word_iter` (any preference on name?) method to `SkewTableau` sound? It would just yield from your iterator. I'll probably add such a thing during tableaux cleanup regardless, but that's a ways off.


---

Comment by darij created at 2015-04-17 06:20:34

Last 10 new commits:


---

Comment by darij created at 2015-04-17 06:20:34

Changing keywords from "days64, tableau" to "days64, tableau, days67".


---

Comment by darij created at 2015-04-17 07:22:51

If my last commit (94af4b0) looks good to you, please set this to positive_review. (The other commits that were added are from #18024 and reviewed.)
Thanks for this ticket!


---

Comment by MariaMonks created at 2015-04-17 14:05:20

Hey guys, I'm traveling this week and don't have the proper setup to look at the code, but I looked over some of the changes you guys are making and I approve!  Nice work all.  (This is NOT a review, just a comment.)


---

Comment by tscrim created at 2015-04-17 22:04:11

I don't quite like the `as_word` argument as you start mucking with the output type. I think the better thing to do would be to either explicitly factor out the `to_word` to `to_flat_list` and have

```python
def to_word(self):
    return Word(self.to_flat_list())
```

or just call `[x for row in self for x in row if x is not None]` instead of `self.to_word()`. My personal preference is the second option since it is a one-liner with the (nested list comprehension).


---

Comment by git created at 2015-04-24 18:14:52

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-04-24 18:18:56

Nice suggestion about list comprehension -- it sped up the `to_word` on skew tableaux by a factor of 2 (even with the correct `reversed(self)` instead of `self`).

I am not sure about having two different `to_word` methods, though. That would require two different `to_word_by_row` and two different `to_word_by_column` methods, too, and would look a bit wasteful. Think of it as a function whose output type is a sum type parametrized by the input -- not exactly a dirty hack. On the other hand, I would really not want it called `to_flat_list`, since besides flattening the list it partially reverses it too.


---

Comment by tscrim created at 2015-04-25 00:06:52

I am okay with just not implementing the methods now and just copying the list-comprehension to the places where you just need the reading word as a list. However, I still don't like having the output type vary significantly based upon input choices. How about `to_word_list`? There wouldn't be much in the way of code duplication as the `to_word` would call `to_word_list`. Although I'm not completely opposed to removing the `to_word` altogether (but I'm not 100% sure about it either).


---

Comment by git created at 2015-10-10 19:11:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-10-10 19:14:00

I have removed the `as_word` argument in `to_word` as just using a simple list comprehension is easier and cleaner. If we find a need to not return a word and we are copying that list comprehension everywhere, then we will can add a separate method. Darij, if I understood you correctly, you were okay with allowing this and are ready to set a positive review, correct?


---

Comment by git created at 2015-10-10 19:24:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-10-10 19:39:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by darij created at 2015-10-10 20:24:00

Changing status from needs_review to positive_review.


---

Comment by darij created at 2015-10-10 20:24:19

LGTM then!


---

Comment by vbraun created at 2015-10-10 22:38:04

docs don't build


---

Comment by vbraun created at 2015-10-10 22:38:04

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-10-10 22:48:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2015-10-10 22:48:33

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-10-12 07:16:19

Resolution: fixed
