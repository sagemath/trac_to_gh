# Issue 24927: Embedded submanifolds

Issue created by migration from Trac.

Original creator: @FlorentinJ

Original creation time: 2018-04-13 15:34:30

CC:  egourgoulhon tscrim

Keywords: submanifold, embedding, immersion, manifold

This ticket implements submanifolds immersed or embedded in topological or differentiable manifolds.

It doesn't yet implement calculations on these submanifolds, but can find coordinates adapted to a foliation, which is the first step in 3+1 formalism in general relativity.

This is part of the â€‹[SageManifolds project](http://sagemanifolds.obspm.fr/); see the metaticket #18528 for an overview. 


---

Comment by git created at 2018-04-13 20:36:33

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-17 08:43:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-27 10:05:54

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-27 10:18:30

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-04-27 12:17:56

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-15 09:01:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-05-15 09:04:15

Changing status from new to needs_review.


---

Comment by git created at 2018-05-21 13:30:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-05-21 15:17:46

Thanks for this piece of work!

Here are some (rather minor) comments:
- About the directory structure: instead of having everything in the subdirectory `src/sage/manifolds/submanifold`, one could (i) put `differentiable_submanifold.py` and `pseudo_riemannian_submanifold.py` into a subdirectory `src/sage/manifolds/differentiable/submanifold` and (ii) put `topological_submanifold.py` in `src/sage/manifolds` (no need for a subdirectory here since it is only one file). In this way, everything related with differentiable manifolds is kept under `src/sage/manifolds/differentiable`
- One doctest fails in `src/sage/manifold/differentiable/real_line.py` due to the change of the keyword parameter `ambient` to `base_manifold`
- For the class `OpenInterval` defined in `src/sage/manifold/differentiable/real_line.py`, the new keyword argument `base_manifold` of `__init__` sounds a little akward in this context; maybe it could be replaced by `base_interval` or `ambient_interval`; also `ambient` in the docstring of `OpenInterval` must be updated. 
- Maybe you could introduce a method `TopologicalSubmanifold.set_embedding` that would perform both `set_immersion` and `declare_embedding`. 
- In the docstring of `set_immersion`, the description of `phi_inverse` should be extended, by precising that this is the inverse of phi onto its image; besides, `phi_inverse` is a not a good keyword, `inverse` or `inverse_from_image` is probably better
- Some PEP8 recommendations: don't use spaces around the = sign when used to indicate a keyword argument and do not use `\` to break a line inside parentheses; for instance, rewrite lines 360-361 of `topological_submanifold.py` as

```
            sage: N.set_immersion(phi, phi_inverse=phi_inv, var=t,
            ....:                 t_inverse={t:phi_inv_t})
```

- Put back quotes around LaTeX expressions in docstrings, so that Sphinx can render them properly: for instance, in the docstrings of `topological_submanifold.py`, replace all `\phi` by ``\phi``.
- In the documentation of `TopologicalSubmanifold.plot`: ``ParametricSurface`` should be replaced by ```ParametricSurface``` and `:func: `ParametricSurface`` by `:class:`~sage.plot.plot3d.parametric_surface.ParametricSurface``


---

Comment by egourgoulhon created at 2018-05-21 15:38:48

Changing status from needs_review to needs_work.


---

Comment by tscrim created at 2018-05-21 16:44:05

I don't think it is worthwhile to have a directory with 1-2 files unless you plan for it to grow. At least to me, I don't see it growing much. So for (i), I would just put them both in `manifolds/differentiable`.


---

Comment by git created at 2018-05-22 09:19:03

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-05-22 09:20:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-05-22 09:21:07

Changing status from needs_work to needs_review.


---

Comment by egourgoulhon created at 2018-05-22 14:23:58

Changing status from needs_review to needs_work.


---

Comment by egourgoulhon created at 2018-05-22 14:23:58

Thanks for these changes. In particular, I agree with Travis (comment:13) that there is no need for a specific subdirectory. 

A few more comments, first regarding the code:

- In class `sage.manifolds.subset.ManifoldSubset` a method `ambient()` was introduced as an alias of `manifold()`. For submanifolds, which inherit from `ManifoldSubset`, this clashes with the meaning given to _ambient_. To avoid any confusion and since it does not appear to be massively used, I would remove the alias `ambient = manifold` in `src/sage/manifolds/subset.py`.
- One should probably introduce accessor methods in class `TopologicalSubmanifold`:
  - `ambient()`
  - `immersion()`
  - `embedding()`
- In lines 2464 and 2490 of `src/sage/manifolds/manifold.py`, one should pass the argument `ambient` as `ambient=ambient` (it is a good policy to always specify the keyword in passing keyword arguments, in case the order of arguments is changed)

Regarding the documentation: 

- In `src/doc/en/reference/manifolds/index.rst`, I don't think it is worth to have a whole section devoted to submanifolds in the main menu. It seems more relevant to add the various submanifolds as subsections of the sections they belong to: topological submanifolds in topological manifolds, etc. In doing so, there is no longer any need of the file `submanifold.rst`
- In `src/sage/manifolds/differentiable/differentiable_submanifold.py`, a better title would be _Submanifolds of differentiable manifolds_. Also here you should specify what is meant by _submanifold_: in the current phrasing, it defaults to _embedded submanifold_ (I am OK with this), but you should allow for _immersed submanifolds_
- In the docstring of the methods `set_embedding` and `set_immersion`, it is said that the default value of the parameter `t_inverse` is `{}`, while it is actually `None`
- A typo in line 128 of `topological_submanifold.py`: "or computed" --> "are computed" (I guess)


---

Comment by git created at 2018-05-24 12:14:12

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @FlorentinJ created at 2018-05-24 12:25:30

Changing status from needs_work to needs_review.


---

Comment by @FlorentinJ created at 2018-05-24 12:25:30

I'm not sure removing the method `ambient` is a good idea given that it is an abstract method of a parent class of `ManifoldSubset`, and so should be implemented in every child class.

Not doing so raises errors during calls of `TestSuite`.


---

Comment by tscrim created at 2018-05-24 15:05:49

I don't see the harm in having such an alias. It is good for consistency/duck-typing and a similar pattern has been used for free modules. However, the nomenclature clash might require renaming one of the methods.


---

Comment by egourgoulhon created at 2018-05-25 14:15:58

Replying to [comment:20 tscrim]:
> I don't see the harm in having such an alias. It is good for consistency/duck-typing and a similar pattern has been used for free modules. However, the nomenclature clash might require renaming one of the methods.

OK let us keep the alias `ambient` in `ManifoldSubset`; in some sense, it is coherent to redefine it for submanifolds (as it is now), so there is no need for renaming.


---

Comment by git created at 2018-05-25 16:58:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by egourgoulhon created at 2018-05-25 17:01:21

I've just pushed some reviewer tweaks, which regard mostly the documentation. 
On my side, it's OK for a positive review. Travis, do you have any further comment?


---

Comment by tscrim created at 2018-05-26 04:57:24

Nope.


---

Comment by tscrim created at 2018-05-26 04:57:24

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2018-05-28 07:45:37

Resolution: fixed
