# Issue 32276: Segmention fault when substituting empty list into polynomial

Issue created by migration from https://trac.sagemath.org/ticket/32513

Original creator: @MarcusAichmayr

Original creation time: 2021-09-14 12:12:28

Keywords: polynomial, substitution

When substituting an empty list into a polynomial, a segmention fault is triggered.
This was tested on `CoCalc` with `SageMath 9.4`.
It is also present in `SageMath 9.2` and `9.3`.

The following leads to a segmention fault:


```
sage: R.<x> = PolynomialRing(ZZ)
sage: x.substitute([]) # segmention fault
```


Note that this does not happen in the case of symbolic expressions:


```
sage: var('y')
sage: y.substitute([])
y
```



---

Comment by lorenz created at 2021-09-15 03:20:10

Changing component from symbolics to algebra.


---

Comment by @DaveWitteMorris created at 2021-09-15 08:00:36

Thanks for the bug report.

Here is a more precise source of the problem:

```
sage: R.<x> = PolynomialRing(ZZ)
sage: Polynomial.__call__(x, []) # segmention fault
```


I think the segfault is in line 751 of `src/sage/rings/polynomial/polynomial_element.pyx` (i.e., the last line of this code snippet):

```
if args:
    if a is not None:
        raise TypeError("unsupported mix of keyword and positional arguments")
    if isinstance(args[0], (list, tuple)):
        if len(args) > 1:
            raise TypeError("invalid arguments")
        args = args[0]
    a, args = args[0], args[1:]
```

The line `args = args[0]` sets `args` to be the empty list (because that is the argument that we supplied), so accessing `args[0]` after that is a very bad idea.


---

Comment by @DaveWitteMorris created at 2021-09-18 04:15:45

Changing status from new to needs_review.


---

Comment by @DaveWitteMorris created at 2021-09-18 04:15:45

New commits:


---

Comment by mmezzarobba created at 2021-09-18 09:35:24

Looks like this is my fault. Thanks for the fix!


---

Comment by mmezzarobba created at 2021-09-18 09:35:24

Changing status from needs_review to positive_review.


---

Comment by @DaveWitteMorris created at 2021-09-18 16:09:56

Thanks for the prompt review!  (And thanks for writing clear code that made it easy to fix this weird corner case.)


---

Comment by vbraun created at 2021-09-25 23:17:56

Resolution: fixed
