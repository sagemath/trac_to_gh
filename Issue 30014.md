# Issue 30014: ExtPowerFreeModule, ExtPowerDualFreeModule: Simplify _repr_

archive/issues_030014.json:
```json
{
    "body": "CC:  @egourgoulhon @tscrim @mjungmath\n\n... using `ZZ.ordinal_str()`\n\nIssue created by migration from https://trac.sagemath.org/ticket/30251\n\n",
    "created_at": "2020-07-30T02:17:13Z",
    "labels": [
        "linear algebra",
        "trivial",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "ExtPowerFreeModule, ExtPowerDualFreeModule: Simplify _repr_",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30014",
    "user": "@mkoeppe"
}
```
CC:  @egourgoulhon @tscrim @mjungmath

... using `ZZ.ordinal_str()`

Issue created by migration from https://trac.sagemath.org/ticket/30251





---

archive/issue_comments_426659.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-30T02:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426659",
    "user": "@mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_426660.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-30T02:18:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426660",
    "user": "@mkoeppe"
}
```

New commits:



---

archive/issue_comments_426661.json:
```json
{
    "body": "Nice simplification! To secure it, one should probably perform\n\n```diff\n- self._degree = degree\n+ self._degree = ZZ(degree)\n```\n\nin the `__init__` method of `ExtPowerFreeModule` and `ExtPowerDualFreeModule`.",
    "created_at": "2020-07-30T12:16:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426661",
    "user": "@egourgoulhon"
}
```

Nice simplification! To secure it, one should probably perform

```diff
- self._degree = degree
+ self._degree = ZZ(degree)
```

in the `__init__` method of `ExtPowerFreeModule` and `ExtPowerDualFreeModule`.



---

archive/issue_comments_426662.json:
```json
{
    "body": "Good idea!",
    "created_at": "2020-07-30T15:35:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426662",
    "user": "@mkoeppe"
}
```

Good idea!



---

archive/issue_comments_426663.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-30T15:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426663",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426664.json:
```json
{
    "body": "(pushed to wrong ticket)",
    "created_at": "2020-07-30T16:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426664",
    "user": "git"
}
```

(pushed to wrong ticket)



---

archive/issue_comments_426665.json:
```json
{
    "body": "(repaired push to wrong ticket)",
    "created_at": "2020-07-30T16:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426665",
    "user": "git"
}
```

(repaired push to wrong ticket)



---

archive/issue_comments_426666.json:
```json
{
    "body": "This is just a general comment not only related to this ticket (I picked this ticket randomly), but worth to emphasize once again: the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence. Please be aware of that fact. I don't think it will go so far, but it would be very sad if the `manifolds` module would be unusable in the upcoming version of Sage.\n\nFurthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.",
    "created_at": "2020-07-30T16:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426666",
    "user": "@mjungmath"
}
```

This is just a general comment not only related to this ticket (I picked this ticket randomly), but worth to emphasize once again: the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence. Please be aware of that fact. I don't think it will go so far, but it would be very sad if the `manifolds` module would be unusable in the upcoming version of Sage.

Furthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.



---

archive/issue_comments_426667.json:
```json
{
    "body": "Replying to [comment:8 gh-mjungmath]:\n> the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence.\n\nThanks. Well, that's why we have doctests and peer review. I run the doctests also in the manifolds module -- and the patchbot runs all doctests.\n\n> Furthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.\n\nAbsolutely. I'll hope to do that when I have learned more about the manifolds code (I hope to be using this code soon for some of my research), or when it becomes necessary because of changes in the tensor modules code. Do feel free to make these changes if you would like them earlier.",
    "created_at": "2020-07-30T17:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426667",
    "user": "@mkoeppe"
}
```

Replying to [comment:8 gh-mjungmath]:
> the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence.

Thanks. Well, that's why we have doctests and peer review. I run the doctests also in the manifolds module -- and the patchbot runs all doctests.

> Furthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.

Absolutely. I'll hope to do that when I have learned more about the manifolds code (I hope to be using this code soon for some of my research), or when it becomes necessary because of changes in the tensor modules code. Do feel free to make these changes if you would like them earlier.



---

archive/issue_comments_426668.json:
```json
{
    "body": "Replying to [comment:8 gh-mjungmath]:\n> This is just a general comment not only related to this ticket (I picked this ticket randomly), but worth to emphasize once again: the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence. Please be aware of that fact. I don't think it will go so far, but it would be very sad if the `manifolds` module would be unusable in the upcoming version of Sage.\n\n\nThanks for expressing your concern. However, as Matthias pointed out in his reply (comment:9), doctests shall prevent breakage in the manifold part. It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. When there is a significant change in the manifold/tensor code, I usually run by hand some selected examples from the above page, typically, the [S2 sphere](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb), the [S3 one](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S3_Hopf.ipynb), the [Kerr spacetime](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb) (good test of parallel computation of the Riemann tensor) and the [anti-de Sitter space](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_anti_de_Sitter.ipynb). An automated test suite would be of great help in this respect. \n\nAnother concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). \n\nThat being said, I think the changes in the `tensor` modules proposed by Matthias are great improvements. In particular, they shall make `FiniteRankFreeModule` usable for other purposes than tensor field computations on smooth manifolds. \n\n> Furthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.\n\nIndeed!",
    "created_at": "2020-07-30T18:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426668",
    "user": "@egourgoulhon"
}
```

Replying to [comment:8 gh-mjungmath]:
> This is just a general comment not only related to this ticket (I picked this ticket randomly), but worth to emphasize once again: the deeper you dig and the more comprehensive your modifications are in the `tensor` module, the more likely it may corrupt the manifolds code, as there is a *very* strong dependence. Please be aware of that fact. I don't think it will go so far, but it would be very sad if the `manifolds` module would be unusable in the upcoming version of Sage.


Thanks for expressing your concern. However, as Matthias pointed out in his reply (comment:9), doctests shall prevent breakage in the manifold part. It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. When there is a significant change in the manifold/tensor code, I usually run by hand some selected examples from the above page, typically, the [S2 sphere](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S2.ipynb), the [S3 one](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_sphere_S3_Hopf.ipynb), the [Kerr spacetime](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb) (good test of parallel computation of the Riemann tensor) and the [anti-de Sitter space](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_anti_de_Sitter.ipynb). An automated test suite would be of great help in this respect. 

Another concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). 

That being said, I think the changes in the `tensor` modules proposed by Matthias are great improvements. In particular, they shall make `FiniteRankFreeModule` usable for other purposes than tensor field computations on smooth manifolds. 

> Furthermore, since the `manifolds` module is similarly structured, it is very likely that analogous improvements can be applied there, too.

Indeed!



---

archive/issue_comments_426669.json:
```json
{
    "body": "Replying to [comment:10 egourgoulhon]:\n> It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. \n\n+1. Could they possibly be added as thematic tutorials in the main sage tree, or are there technical limitations that would prevent that?\n\n> Another concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). \n\nYes, this is an important point - and one for which Sage unfortunately does not have a very good solution. Sure - we notice performance regressions sometimes when doctests suddenly time out. But obviously doctests are not very well suited as benchmarks. (One might think about \"# optional - benchmark\" annotations though...)\n\n(By the way, some of the doctests in sage.manifolds probably should be marked \"long\" -- I frequently see them time out in the automated tests on [GitHub](GitHub) actions - see for example https://github.com/sagemath/sage/runs/910575697?check_suite_focus=true)",
    "created_at": "2020-07-30T18:16:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426669",
    "user": "@mkoeppe"
}
```

Replying to [comment:10 egourgoulhon]:
> It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. 

+1. Could they possibly be added as thematic tutorials in the main sage tree, or are there technical limitations that would prevent that?

> Another concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). 

Yes, this is an important point - and one for which Sage unfortunately does not have a very good solution. Sure - we notice performance regressions sometimes when doctests suddenly time out. But obviously doctests are not very well suited as benchmarks. (One might think about "# optional - benchmark" annotations though...)

(By the way, some of the doctests in sage.manifolds probably should be marked "long" -- I frequently see them time out in the automated tests on [GitHub](GitHub) actions - see for example https://github.com/sagemath/sage/runs/910575697?check_suite_focus=true)



---

archive/issue_comments_426670.json:
```json
{
    "body": "Thanks for pointing this out in such detail, Eric. I was not sure how \"deep\" the doctesting of the patchbot actually goes.\n\n> That being said, I think the changes in the tensor modules proposed by Matthias are great improvements. In particular, they shall make FiniteRankFreeModule usable for other purposes than tensor field computations on smooth manifolds. \n\nI didn't mean to be dismissive, sorry. I think the modifications and the effort by Matthias are extremely beneficial to the project. :)",
    "created_at": "2020-07-30T18:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426670",
    "user": "@mjungmath"
}
```

Thanks for pointing this out in such detail, Eric. I was not sure how "deep" the doctesting of the patchbot actually goes.

> That being said, I think the changes in the tensor modules proposed by Matthias are great improvements. In particular, they shall make FiniteRankFreeModule usable for other purposes than tensor field computations on smooth manifolds. 

I didn't mean to be dismissive, sorry. I think the modifications and the effort by Matthias are extremely beneficial to the project. :)



---

archive/issue_comments_426671.json:
```json
{
    "body": "No worries!",
    "created_at": "2020-07-30T18:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426671",
    "user": "@mkoeppe"
}
```

No worries!



---

archive/issue_comments_426672.json:
```json
{
    "body": "Good to go. Thanks!",
    "created_at": "2020-07-30T21:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426672",
    "user": "@egourgoulhon"
}
```

Good to go. Thanks!



---

archive/issue_comments_426673.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-30T21:06:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426673",
    "user": "@egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_426674.json:
```json
{
    "body": "Thank you!",
    "created_at": "2020-07-30T21:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426674",
    "user": "@mkoeppe"
}
```

Thank you!



---

archive/issue_comments_426675.json:
```json
{
    "body": "Replying to [comment:11 mkoeppe]:\n> Replying to [comment:10 egourgoulhon]:\n> > It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. \n> \n> +1. Could they possibly be added as thematic tutorials in the main sage tree, or are there technical limitations that would prevent that?\n\nThe large CPU times could prevent to add these examples to the thematic tutorials, which are doctested at each run of `make ptestlong`. For instance, if you look at the last cell of the [Kerr notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb), you see that it takes about 6 min when running in parallel on 8 processes. NB: most of this CPU time is not spent in the actual tensor calculations, but in the simplifications of the involved symbolic expressions. \n> \n> > Another concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). \n> \n> Yes, this is an important point - and one for which Sage unfortunately does not have a very good solution. Sure - we notice performance regressions sometimes when doctests suddenly time out. But obviously doctests are not very well suited as benchmarks. (One might think about \"# optional - benchmark\" annotations though...)\n> \n> (By the way, some of the doctests in sage.manifolds probably should be marked \"long\" -- I frequently see them time out in the automated tests on [GitHub](GitHub) actions - see for example https://github.com/sagemath/sage/runs/910575697?check_suite_focus=true)\n\nYes, we should open a ticket for this.",
    "created_at": "2020-07-30T21:29:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426675",
    "user": "@egourgoulhon"
}
```

Replying to [comment:11 mkoeppe]:
> Replying to [comment:10 egourgoulhon]:
> > It remains true that doctests are not exhaustive and it will be more satisfactory to have a more comprehensive test suite, albeit more CPU consuming. Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. 
> 
> +1. Could they possibly be added as thematic tutorials in the main sage tree, or are there technical limitations that would prevent that?

The large CPU times could prevent to add these examples to the thematic tutorials, which are doctested at each run of `make ptestlong`. For instance, if you look at the last cell of the [Kerr notebook](https://nbviewer.jupyter.org/github/sagemanifolds/SageManifolds/blob/master/Notebooks/SM_Kerr.ipynb), you see that it takes about 6 min when running in parallel on 8 processes. NB: most of this CPU time is not spent in the actual tensor calculations, but in the simplifications of the involved symbolic expressions. 
> 
> > Another concern one might have is performance, which is not tracked by doctests, but could be in the test suite (note that there is a total CPU time measurement in the Kerr notebook mentioned above). 
> 
> Yes, this is an important point - and one for which Sage unfortunately does not have a very good solution. Sure - we notice performance regressions sometimes when doctests suddenly time out. But obviously doctests are not very well suited as benchmarks. (One might think about "# optional - benchmark" annotations though...)
> 
> (By the way, some of the doctests in sage.manifolds probably should be marked "long" -- I frequently see them time out in the automated tests on [GitHub](GitHub) actions - see for example https://github.com/sagemath/sage/runs/910575697?check_suite_focus=true)

Yes, we should open a ticket for this.



---

archive/issue_comments_426676.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-14T22:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426676",
    "user": "@vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_426677.json:
```json
{
    "body": "Replying to [comment:10 egourgoulhon]:\n>\n> Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. \n\nOr use [nbval](https://pypi.org/project/nbval/).",
    "created_at": "2020-08-14T23:26:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426677",
    "user": "@slel"
}
```

Replying to [comment:10 egourgoulhon]:
>
> Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. 

Or use [nbval](https://pypi.org/project/nbval/).



---

archive/issue_comments_426678.json:
```json
{
    "body": "Replying to [comment:18 slelievre]:\n> Replying to [comment:10 egourgoulhon]:\n> >\n> > Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. \n> \n> Or use [nbval](https://pypi.org/project/nbval/).\n\nThank you Samuel for the tip! I was not aware of nbval.",
    "created_at": "2020-08-17T09:40:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30014",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30014#issuecomment-426678",
    "user": "@egourgoulhon"
}
```

Replying to [comment:18 slelievre]:
> Replying to [comment:10 egourgoulhon]:
> >
> > Such a suite could be derived from the [manifold examples page](https://sagemanifolds.obspm.fr/examples.html). I guess one shall first turn these Jupyter notebooks into rst files, via the export menu. 
> 
> Or use [nbval](https://pypi.org/project/nbval/).

Thank you Samuel for the tip! I was not aware of nbval.
