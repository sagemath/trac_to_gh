# Issue 12906: Make it easier to do custom tick formatting

Issue created by migration from Trac.

Original creator: kcrisman

Original creation time: 2012-06-02 01:38:33

Assignee: jason, was

CC:  ppurka

[This sage-support thread](https://groups.google.com/forum/?fromgroups#!topic/sage-support/pQ3RHcyLRPM) raised the interesting question of having not just custom ticks, but then custom formatting of said ticks one-by-one (say, setting the ticks but wanting them labeled `x_0`, `x_1`, etc.).

User "ObsessiveMathsFreak" contributed the following code there.

```
==========================

def plot_labels(x_ticks,x_labels,y_ticks,y_labels,fontsize=12):
    import matplotlib.ticker
    def latex_ticklabels(lbls_x,lbls_y):
        return [matplotlib.ticker.FixedFormatter(lbls_x),matplotlib.ticker.FixedFormatter(lbls_y)]
    
    ft=fontsize
    return plot([],ticks=[x_ticks,y_ticks],tick_formatter=latex_ticklabels(x_labels,y_labels),fontsize=ft)



PL=plot_labels([1,3],["$x_1$","$x_2$"],[1,2,3.5],["$y_1$","$y_2$","$y_3$"],fontsize=15)

P0=plot(x,(x,0,2))
P1=plot(x^2,(x,0,4))

show(P0+PL)
show(P1+PL)

==========================

I hope this is useful
```


Maybe there is a way we can work that into our tick and formatting framework.


---

Comment by kcrisman created at 2012-07-07 03:27:31

See also #9578 and #2189.


---

Comment by ppurka created at 2012-07-07 08:26:16

I already have a solution for this. See the originally linked thread. I am waiting for some of the other tickets related to the plot commands to get merged so that I don't need to rebase this.


---

Comment by kcrisman created at 2012-07-07 13:51:03

I'll put that here as well.

```diff
# patch
diff --git a/sage/plot/graphics.py b/sage/plot/graphics.py
--- a/sage/plot/graphics.py
+++ b/sage/plot/graphics.py
`@``@` -1913,7 +1913,7 `@``@`
                     raise ValueError('Expand the range of the dependent variable to allow two multiples of your tick locator (option `ticks`).')
 
             x_formatter, y_formatter = tick_formatter
-            from matplotlib.ticker import FuncFormatter
+            from matplotlib.ticker import FuncFormatter, FixedFormatter
             from sage.misc.latex import latex
             from sage.symbolic.ring import SR
             if x_formatter is None:
`@``@` -1924,6 +1924,8 `@``@`
                 x_formatter = FuncFormatter(lambda n,pos: _multiple_of_constant(n,pos,x_const))
             elif x_formatter == "latex":
                 x_formatter = FuncFormatter(lambda n,pos: '$%s$'%latex(n))
+            elif isinstance(x_formatter, (list, tuple)):
+                x_formatter = FixedFormatter(x_formatter)
             if y_formatter is None:
                 y_formatter = OldScalarFormatter()
             elif y_formatter in SR:
`@``@` -1932,6 +1934,8 `@``@`
                 y_formatter = FuncFormatter(lambda n,pos: _multiple_of_constant(n,pos,y_const))
             elif y_formatter == "latex":
                 y_formatter = FuncFormatter(lambda n,pos: '$%s$'%latex(n))
+            elif isinstance(y_formatter, (list, tuple)):
+                y_formatter = FixedFormatter(y_formatter)
 
             subplot.xaxis.set_major_locator(x_locator)
             subplot.yaxis.set_major_locator(y_locator)
```

You also said:

This can be tested with a plot like this:

```
plot(x, (x,0,2), ticks=[[1,2],[1,2,3.5]], tick_formatter=[["$x_1$","$x_2$"],["$y_1$","$y_2$","$y_3$"]])
```

There should probably be more checks like

```
len(ticks[0]) == len(tick_formatter[0])
```

and so on, but that can be addressed in a proper patch.


---

Comment by kcrisman created at 2012-07-07 13:51:53

> There should probably be more checks like
Yeah, and that `ticks` was in fact passed in, etc.  This will be very nice.


---

Comment by ppurka created at 2012-07-19 07:15:54

Added patch for custom tick labeling.


---

Comment by ppurka created at 2012-07-19 07:15:54

Changing status from new to needs_review.


---

Comment by kcrisman created at 2012-07-19 13:34:57

Swift glance is all I have time for now, but on the face of it this seems good.  ppurka, do we want the possibility of custom formatting even if for some reason someone just guesses that there are three ticks and then pass in the correct list?  What about if people send in other custom tick options?  For instance, I could imagine 

```
plot(sin(x),(x,-2*pi,2*pi),ticks=pi,tick_formatter=['$-2\pi$',_,_,'','$2\pi$'])
```

or something.  Notice also that we want to make sure that it works properly with the `tick_formatter` convention that if there is only one item, not a list of two lists/`None`, then it corresponds to the horizontal axis.  Otherwise things get too weird.


---

Comment by ppurka created at 2012-07-19 14:04:54

The docstring says

```
         If the value of this keyword is a single item, then this will
         give the formatting for the horizontal axis *only* (except for
         the ""latex"" option).  If it is a list or tuple, the first is
         for the horizontal axis, the second for the vertical axis. The
         options are below:
```

Notice that prior to this, a list was not allowed only for the horizontal axis. It was always a `single item`, whatever that meant (and it didn't mean a list).

I really want to force the requirement of having `ticks` and `tick_formatter` being of correct lengths. I want to avoid situations where,for instance, the user inputs `ticks=pi` and then doesn't give the correct number of custom labels. Is there some easy way of determining how many tick positions will be present in an axis?


---

Comment by kcrisman created at 2012-07-19 14:10:55

Yeah, that was probably a little sloppy, and in any case, this is new functionality.  If it doesn't break the old one... since these things have to be strings, maybe one could check if the first item was a string, and then let it go through...  Just seems like

```
plot(sin(x),(x,-2*pi,2*pi),ticks=[1,2,3],tick_formatter=['a','b','c'])
```

should work, by analogy with the other things that already work.

My point is that there isn't an easy way to determine how many there will be, but that once one _does_ know (for instance, by plotting the picture with `ticks=pi`), then they might as well be able to do the formatting I suggest.  Wouldn't matplotlib raise an error we could catch if the formatter (at least, the `FixedFormatter`) had too many/too few entries?


---

Comment by ppurka created at 2012-07-19 14:35:01

Actually matplotlib does not complain at all. I can remove the check for the lengths of `ticks` and `tick_formatter` and it will do all of what you mention above. Then it will be up to the user to ensure sane input.

EDIT: Also, the entries of the list passed in `tick_fomratter` need not be strings. They can be even numbers.


---

Comment by kcrisman created at 2012-07-19 14:41:43

> Actually matplotlib does not complain at all. I can remove the check for the lengths of `ticks` and `tick_formatter` and it will do all of what you mention above. Then it will be up to the user to ensure sane input.
Oh, that's actually bad.  I happen to like sanity checks for things like this - despite the fact that we _should_ know what we're doing, this is math software, not software software, so I think it's better to have that.  Hmm, I'm not sure to do now.  Is there a way to get the number of major ticks from mpl before using the formatter?  Sorry for so many questions; hopefully someone else will have more well-baked ideas.


---

Comment by kcrisman created at 2012-07-19 14:43:01

> EDIT: Also, the entries of the list passed in tick_fomratter need not be strings. They can be even numbers.

Hmm, but what would it do with the preparser?  Like if `tick_formatter=[[1,3,88],None]`?  Would we get just the printed version, or ... just curious.  I'm sorry I only have time to kibitz and not actually try this out.


---

Comment by ppurka created at 2012-07-19 14:46:33

Replying to [comment:12 kcrisman]:
> > EDIT: Also, the entries of the list passed in tick_fomratter need not be strings. They can be even numbers.
> 
> Hmm, but what would it do with the preparser?  Like if `tick_formatter=[[1,3,88],None]`?  Would we get just the printed version, or ... just curious.  I'm sorry I only have time to kibitz and not actually try this out.
It seems to work just fine. It evaluates the expression and prints the result as the tick label.


---

Comment by jdemeyer created at 2012-07-27 20:39:29

Please fill in your real name as Author.


---

Comment by vbraun created at 2012-10-09 10:09:28

Looks good to me.


---

Comment by kcrisman created at 2013-01-03 20:03:13

> Looks good to me.
Is that a positive review?  My suggestions were not enough to warrant holding this up.


---

Comment by knsam created at 2013-03-14 19:49:17

*ping*: Hello! It looks like we are really close here! Can we look into this and see if we can merge this into Sage? :)


---

Comment by kcrisman created at 2013-03-15 00:23:09

Changing status from needs_review to positive_review.


---

Comment by ppurka created at 2013-03-15 02:43:45

Thanks ;-)


---

Comment by jdemeyer created at 2013-03-18 09:44:46

This should be rebased to sage-5.9.beta0:

```
applying /padic/release/merger/patches/trac_13078-add_custom_tick_labeling.patch
patching file sage/plot/graphics.py
Hunk #1 succeeded at 1420 with fuzz 2 (offset 31 lines).
patching file sage/plot/plot.py
Hunk #1 succeeded at 134 with fuzz 1 (offset 0 lines).
```



---

Comment by jdemeyer created at 2013-03-18 09:44:46

Changing status from positive_review to needs_work.


---

Comment by ppurka created at 2013-03-19 08:03:12

apply to devel/sage


---

Comment by ppurka created at 2013-03-19 08:04:30

Changing status from needs_work to positive_review.


---

Attachment

Rebased it to sage-5.9.beta0. There are no updates, and the only changes should be zero fuzz and zero offset. Hence, I am setting it back to positive review.


---

Comment by jdemeyer created at 2013-03-20 14:43:50

Resolution: fixed
