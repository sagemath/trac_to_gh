# Issue 18052: Faster output for large graphs

Issue created by migration from https://trac.sagemath.org/ticket/18289

Original creator: vbraun

Original creation time: 2015-04-23 13:15:29

CC:  ncohen dcoudert

Rich output for graphs can be very slow. Suggestion: implement a size cutoff (#of vertices/edges) above which no graphics is produced, or a different kind of graphics than the usual spring-layout graph.


---

Comment by vbraun created at 2015-04-23 13:24:50

Note that `__repr__` did not change:

```
sage: repr(graphs.RandomGNP(500,.2))
'RandomGNP(500,0.200000000000000): Graph on 500 vertices'
```

This is only about rich output, which is different from the standard `repr`.

If you want rich output of graphs to be just text then thats fine with me, but show() and pretty_print() will then also just be text.


---

Comment by ncohen created at 2015-04-23 13:25:54

I want the graphs to be printed as they were before. If you want to change the behaviour of .show() that will be a one-year deprecation warning, as usual. Please. You are making things very complicated for whoever uses graphs.

Nathann


---

Comment by vbraun created at 2015-04-23 13:32:40

We don't need deprecation for bugs. show() behaving different for graphs than for everything else is a bug.

You can still get graphical output, you'll just have to call graph.plot() instead of show(graph).


---

Comment by ncohen created at 2015-04-23 13:34:11

I am not here to discuss whether `show` is implemented as it should, Volker. You changed the default output to plot graphs instead of displaying text, and I ask you to please revert that. It is very impractical for us. Please.

Nathann


---

Comment by vbraun created at 2015-04-23 13:34:55

I said already that I'm happy to do that if thats what you really want.


---

Comment by ncohen created at 2015-04-23 13:36:05

I do not remember your saying that you would agree to *revert* those changes. If you did please excuse me, and please do that. Thank you,

Nathann


---

Comment by vbraun created at 2015-04-23 13:48:52

New commits:


---

Comment by ncohen created at 2015-04-23 13:59:12

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-04-23 13:59:38

Thanks,

Nathann


---

Comment by ncohen created at 2015-04-23 13:59:38

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2015-04-23 14:14:22

> This is only about rich output, which is different from the standard repr.

For the record, I think that most users will not understand this subtle difference.  I know that I don't.  What is "rich output", anyway?

That said, if you think it's a pretty nasty bug that `show` has different results for different object types, that could be worth discussing on sage-devel.  I guess for most non-plot objects I can think of, `show` does some LaTeXing, right?  And it seems reasonable to me to have different default outputs for

```
sage: Obj
```

for different kinds of objects - a plot should be shown, a symbolic expression should just be printed, a matrix should be printed unless it's too big, etc., while

```
sage: Obj.show()
```

should "show" the object in some meaningful way.  But maybe that's related to the `pretty_print`, which I never really used but maybe is becoming more important?

Sorry for this postscript, I just feel like there are some hairs being split here that are perhaps overly infinitesimally split already.


---

Comment by vbraun created at 2015-04-23 14:21:33

Rich output (`_rich_repr_`) is a hook for an object to provide more than just text output to the UI. 

The functions show and pretty_print display the rich output immediately (like print), without waiting for the current computation to finish.

The `graph.show()` method does its own thing, though the graph plotting (wtf is `GraphPlot`) reinvents the wheel in slightly less round ways so often that I have lost count.


---

Comment by ncohen created at 2015-04-23 14:29:43

> The `graph.show()` method does its own thing, though the graph plotting (wtf is `GraphPlot`) reinvents the wheel in slightly less round ways so often that I have lost count.

I barely ever touched the file, except to add some doc and handle default options somewhat correctly. If you think that we can do without it by using some more general code I really have no objection to make.

About the difference between show/pretty_print/repr, I have to agree with Karl-Dieter that I find the differences rather thin. Maybe `_rich_repr_` makes sense for latex output which would look better in the notebook, and would be impossible to read in the console? For graphs, however, there is no general way to have a 'readable/enlightenning' plot, so the best is probably to not represent it graphically unless requested explicitly.

Nathann


---

Comment by kcrisman created at 2015-04-23 14:34:36

Anyway, I don't have any skin in this game but just wanted to figure out what the game was even about.


---

Comment by git created at 2015-04-23 14:35:04

Changing status from positive_review to needs_review.


---

Comment by git created at 2015-04-23 14:35:04

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by dcoudert created at 2015-04-23 14:35:32

Hello,

I arrive after the battle in this ticket since it took me some time to compile beta2. For some unknown reason, `make` results in the construction of `a tout of sage` in all languages. A bit too much. I should learn how to use it to speed up compilation.

I'm happy that the automatic show this behavior has been removed. I'm playing with many graphs with (tens of) thousands of nodes, most of the times remotely on a server, and it is very annoying (and long) when the server tries to display an image...

David.


---

Comment by vbraun created at 2015-04-23 14:37:13

Thats why I proposed a size cutoff. IMHO it is truly helpful to students to see graphics if the graph is small. But then I don't really care that much.


---

Comment by dcoudert created at 2015-04-23 14:53:21

Here size does not matter. When you are like me working remotely, even small graphs could be a problem. I just had problems to close my ssh connection (from a standard mac book air with yosemite to a linux server). I had to kill it. I don't know what's going on, and I'm not sure I want to know...
 
I understand that this behavior could be interesting for students working on the notebook, but not at all for me (working only in console mode).
So I'm glad it is removed.

David.


---

Comment by vbraun created at 2015-04-23 14:55:21

Maybe you just want to turn graphics off (`%display graphics disable`) instead of making your ssh-over-300-baud-modem workflow the model for how a modern UI should operate.


---

Comment by ncohen created at 2015-04-23 14:55:50

> Thats why I proposed a size cutoff. IMHO it is truly helpful to students to see graphics if the graph is small. But then I don't really care that much.

HMmmmmm... Well, I know that in the SMC, William changed the behavior of view(g) so that it is an alias of `g.show(method="js")`. So somehow it is a bit easier to view graphs.

Nathann


---

Comment by dcoudert created at 2015-04-23 15:29:30

Replying to [comment:19 vbraun]:
> Maybe you just want to turn graphics off (`%display graphics disable`) instead of making your ssh-over-300-baud-modem workflow the model for how a modern UI should operate.

Sorry for being old-style, but it is very convenient for me to launch computations on a server remotely (ssh and screen), some of them lasting for days. I would really appreciate not to be forced to type extra commands at run time.

David.


---

Comment by novoselt created at 2015-04-23 15:36:55

I think part of the problem is with putting potentially difficult things into magic methods, which to some extent is fixed for matrices. Rather than having `_latex_` and `_repr_` produce code for accurate representations, they should call some other method for doing it in simple cases and otherwise return a sensible summary about size/structure. Those who really want to typeset big objects can call those non-magic methods directly.

As for extra commands for researches vs. extra commands for students (and teachers who deal with these students!), I'd say that students are at least as big a target for Sage and the choice is not at all clear. Except that it tends to be way easier to teach extra commands to researches...


---

Comment by vbraun created at 2015-04-23 15:45:35

Replying to [comment:21 dcoudert]:
> Sorry for being old-style, but it is very convenient for me to launch computations on a server remotely (ssh and screen), some of them lasting for days. I would really appreciate not to be forced to type extra commands at run time.

Tough, but IMHO that is not a use case that we should optimize the Sage user interface for at the expense of making it harder to use for novices.


---

Comment by ncohen created at 2015-04-23 15:50:05

> Tough, but IMHO that is not a use case that we should optimize the Sage user interface for at the expense of making it harder to use for novices.

Hey Hey... It is not exactly 'hard to use for novices'. We get a plot of a graph with `g.plot()`, `g.show()`, `plot(g)` and `show(g)`. It is not exactly like we go out of our way to hide stuff `:-P`

Nathann

edit: show(g) actually prints some LaTeX code. I can't say that I see the point of that, and the choice of 'show' for such a thing is a bit mysterious to me.


---

Comment by vdelecroix created at 2015-04-23 15:54:19

Note that the picture for

```
sage: Graph()
```

was especially helpful! I am glad this gets reverted.

Vincent


---

Comment by vbraun created at 2015-04-23 15:58:01

Maybe you also want to complain about `Graphics()` being useless output?


---

Comment by vbraun created at 2015-04-23 15:59:30

Replying to [comment:24 ncohen]:
> edit: show(g) actually prints some LaTeX code. I can't say that I see the point of that, and the choice of 'show' for such a thing is a bit mysterious to me.

The show() function prints latex for objects that do not define rich output, under the assumption that you didn't want text output since you could have had that without show().


---

Comment by ncohen created at 2015-04-23 16:03:49

> The show() function prints latex for objects that do not define rich output, under the assumption that you didn't want text output since you could have had that without show().

Is it a good idea? I mean, having `show(<something>)` output LaTeX code? We have a `latex(<something>)` already. Also, 'show me a graph' is probably better answered with a picture than with code that you have to copy/paste in a file, before compiling it.


---

Comment by kcrisman created at 2015-04-23 16:06:01

> Maybe you also want to complain about `Graphics()` being useless output?

Naturally that is sarcastic, but one can point out that it's hard to imagine someone wanting non-graphical output for a graphic, while for a graph it's not really clear one wants a picture of the graph.  I also like

```
sage: Graphics().show(xmin=-20,xmax=20)
```


> s it a good idea? I mean, having show(<something>) output LaTeX code?

I think it outputs LaTeXed output, not the actual code for the LaTeX, just to be clear.


---

Comment by vbraun created at 2015-04-23 16:11:20

Replying to [comment:28 ncohen]:
> Is it a good idea? I mean, having `show(<something>)` output LaTeX code?

As I said, its IMHO not a good idea to not make use of the rich output for graphs. But apparently we can't agree on the time of the day here. Meanwhile, William can make SMC user-friendly. Maybe we should just send all new users there and not have them download free software to their own computers.


---

Comment by ncohen created at 2015-04-23 16:33:12

> As I said, its IMHO not a good idea to not make use of the rich output for graphs. But apparently we can't agree on the time of the day here.

It is very easy to get a graphical representation of a graph in Sage. This being said, we also need the basic feature of "typing the name of an object in order to see what exactly it is". And for this a string description (possibly indicating the name of the graph) is a good thing.

> Meanwhile, William can make SMC user-friendly. Maybe we should just send all new users there and not have them download free software to their own computers.

William's work these days is apparently totally dedicated to the user interface problems. He  tries to gather money to this aim, tries to hire people to do that, while we implement new mathematical features, fix the bugs, i.e. make this thing good and reliable for what we need. I regret it very often that he takes whatever he needs from us, improves what he likes for his own ends and does not contribute *back* to the project. He must have found thousands of bugs, imperfections and inconsistencies.


---

Comment by ncohen created at 2015-04-23 16:46:48

P.S.: Apparently `show(graphs.PetersenGraph())` does not always produce the same output: Karl-Dieter sees a png picture, and I only see LaTeX code being printed in the console. Same version of Sage. He runs mac, I run debian.


---

Comment by vbraun created at 2015-04-23 17:10:50

Without this branch, `show(graphs.PetersenGraph())` displays a picture on sage-6.7.beta2. With it there is no picture.


---

Comment by vbraun created at 2015-04-23 17:15:13

Replying to [comment:31 ncohen]:
> I regret it very often that he takes whatever he needs from us, improves what he likes for his own ends and does not contribute *back* to the project.

Did it ever occur to you that he can't do that because whenever one tries to improve output somebody starts a week-long email thread because they don't like more verbose  output / it doesn't fit into their workflow of using sage over a super-slow network connection and they can't be bothered to turn graphics off?


---

Comment by kcrisman created at 2015-04-23 17:21:06

> Without this branch, `show(graphs.PetersenGraph())` displays a picture on sage-6.7.beta2. With it there is no picture.
Just confirming that I get a graph in 6.5 and 6.7.beta2; I haven't tried this one.  Is it possibly platform-dependent, or perhaps dependent upon some env var about how to automatically display pngs or something?


---

Comment by ncohen created at 2015-04-24 06:41:02

Volker, if this branch indeed makes `show(g)` output LaTeX code, then could you revert this change too? It is a regression.


---

Comment by dcoudert created at 2015-04-24 08:52:13

Replying to [comment:34 vbraun]:
> Did it ever occur to you that he can't do that because whenever one tries to improve output somebody starts a week-long email thread because they don't like more verbose  output / it doesn't fit into their workflow of using sage over a super-slow network connection and they can't be bothered to turn graphics off?

I didn't know that it was possible to turn graphics off. Is there a way to turn it off by default?
Also, when you travel, you frequently have to use super-slow connections or connections with volume constraints (e.g. a few MB per day). You then try to limit the amount of data you transmit. It happens to me last week in Chile, and now I hate automatic system updates.


---

Comment by ncohen created at 2015-04-24 09:26:40

https://groups.google.com/d/msg/sage-release/C0bw1IA7g58/rqWiN_LdysQJ


---

Comment by vbraun created at 2015-04-24 22:36:53

Replying to [comment:37 dcoudert]:
> I didn't know that it was possible to turn graphics off. Is there a way to turn it off by default?

Sage loads `~/.sage/init.sage` on startup, so you just have to put `%display graphics disable` in there to turn it off by default.


---

Comment by ncohen created at 2015-04-25 06:13:12

About the speed of plots for graphs: after some profiling it seems that the computation of positions is not at fault. All I see for the moment is that the time is taken by the matplotlib primitives. I'll continue looking.

Volker, could you fix this regression?

Nathann


---

Comment by vbraun created at 2015-04-25 12:51:39

So whats the preferred behavior:
* Show graphs as picture (if the graph is small)
* Do not participate in rich output, graphs cannot be shown as picture (unless you plot them)
* Keep the inconsistent behavior bug-for-bug where `show(graph)` does something different than the displayhook, and leave graphs as the only object in Sage that does not work.


---

Comment by ncohen created at 2015-04-25 13:01:29

> So whats the preferred behavior:
> * Show graphs as picture (if the graph is small)
> * Do not participate in rich output, graphs cannot be shown as picture (unless you plot them)
> * Keep the inconsistent behavior bug-for-bug where `show(graph)` does something different than the displayhook, and leave graphs as the only object in Sage that does not work.

Without addressing the actual implementation, it seems rather clear to me that whoever types `show(a_graph)` wants a picture of it.

The problem with graphs is that it is potentially very slow to plot them (apparently because of matplotlib), but in general there is not "one good drawing" of a graph. Moreover, at the moment the default plotting algorithm will give you a different drawing every time you call it.

Having a different behaviour depending on the size of the graph does not look good to me either, for it is not like for matrices where you see the whole matrix or just a one-line description: indeed, for graphs it would open a new windows (with a picture) in some cases or print a line of text.

All in all, having `show(a_graph)` display the TikZ/LaTeX code of the graph is definitely not what we would expect from the command.

Nathann


---

Comment by vbraun created at 2015-04-25 13:17:00

But when the user types

```
sage: g = compute_some_graph()
sage: g
```

then they do not want a picture? The displayhook is just an implicit way of telling the UI to show something.

Unrelated to this ticket, but I agree that we don't want huge tikz output. Maybe the `._latex_()` method isn't the right place to spit that out anyways. E.g. open the SageNB notebook, tick the "typeset" checkbox, and then run `graphs.RandomGNP(500,.2)`. Bonus points if you can guess correctly what happens without trying it out (I could not)


---

Comment by vdelecroix created at 2015-04-25 13:18:45

Replying to [comment:43 vbraun]:
> But when the user types
> {{{
> sage: g = compute_some_graph()
> sage: g
> }}}
> then they do not want a picture? The displayhook is just an implicit way of telling the UI to show something.

I would say:
- always no in the console
- yes in a notebook iff the graph is not empty and have less than 20 vertices


---

Comment by ncohen created at 2015-04-25 13:30:50

> But when the user types
> {{{
> sage: g = compute_some_graph()
> sage: g
> }}}
> then they do not want a picture? The displayhook is just an implicit way of telling the UI to show something.

A plot is just 'one representation' of a graph. Like for posets, for matrices (they have a .plot too). I type 'g' very often just to see whether this variable that is named 'g' in indeed a graph (as you would for any other Python object), but also because it tells me whether that graph allows multiple edges or loops.

This being said, like Vincent I expect that the expected behaviour is different in the notebook. If you want to improve that side of the interface, however, I believe that it might be better to output *both* in the notebook:
- The one-line description that we have in the console
- A drawing

Of course, not being able to plot large graphs is a problem. So like for matrices, perhaps a size limit may be good.. But really, most graphs do *NOT* look good when you plot them, and the result may appear very very very unprofessional, which is probably something you want to avoid:


```
sage: graphs.RandomGNP(50,.5).show()
```


Perhaps the default layout can be slightly improved, but I have no idea how to solve the performance problem with matplotlib.

> Unrelated to this ticket, but I agree that we don't want huge tikz output.

Why is that unrelated to this ticket? Didn't you say that this change (from picture to latex output) had been made by #17821?

> Bonus points if you can guess correctly what happens without trying it out (I could not)

With this branch applied it gives me the latex code `O_o`

Nathann


---

Comment by dcoudert created at 2015-04-25 13:49:49

Replying to [comment:39 vbraun]:
> Replying to [comment:37 dcoudert]:
> > I didn't know that it was possible to turn graphics off. Is there a way to turn it off by default?
> 
> Sage loads `~/.sage/init.sage` on startup, so you just have to put `%display graphics disable` in there to turn it off by default.

Thanks a lot!


---

Comment by vbraun created at 2015-04-25 13:57:40

Replying to [comment:45 ncohen]:
> Why is that unrelated to this ticket? Didn't you say that this change (from picture to latex output) had been made by #17821?

With this branch you actually notice that the latex output is unwieldy. But SageNB + typeset checked has suffered from that for a long time, and that is not related to this ticket or the rich output framework.


---

Comment by ncohen created at 2015-04-25 14:10:09

> With this branch you actually notice that the latex output is unwieldy. But SageNB + typeset checked has suffered from that for a long time, and that is not related to this ticket or the rich output framework.

I do not understand: before #17821 the syntax `show(a_graph)` worked fine in the console, and now it print latex code to the screen. Surely you will agree that this is a regression that must be fixed?


---

Comment by vbraun created at 2015-04-25 14:15:13

I disagree that it "worked fine", showing a graph explicitly (immediately) and via the displayhook resulted in two different behaviors. In particular you couldn't output the displayhook format programmatically, for example in `@`interact. Of course one could get text output but not in a uniform way that would also work with other Sage objects.


---

Comment by ncohen created at 2015-04-25 14:20:02

Before #17821 typing `show(a_graph)` in the console displayed a picture. Now it fills your screen with latex code. You broke it, so now please fix it.


---

Comment by kcrisman created at 2015-04-25 15:04:07

> Now it fills your screen with latex code. You broke it, so now please fix it.
(Pretty please with sugar on top, right?)


---

Comment by vbraun created at 2015-04-25 16:05:21

As I said before, the fact that `graph._latex_()` spews endless tikz code (that often fails to compile, breaking SageNB) is an unrelated bug. It should output something like $G_{123}$ that actually can be displayed for reasonably large graphs.

As for things that are actually on-topic, I suggest we make a new display preference `plot_graphs` with values `yes`, `no`, `cutoff` (feel free to suggest other names). Then graphs and other graph-like objects (e.g. posets) can use that to decide how to show themselves. The commandline would default to `no`, others to `cutoff`.


---

Comment by vbraun created at 2015-04-26 00:54:31

Here is a branch which implements a vertex cut off and 

```
sage: %display plot_graphs never
```

which is the default on the commandline and doctests. 
----
New commits:


---

Comment by vbraun created at 2015-04-26 01:57:55

I've opened #18302 to deprecate (or warn against) the `show()` function


---

Comment by mantepse created at 2015-04-26 06:17:30

Replying to [comment:52 vbraun]:
> As I said before, the fact that `graph._latex_()` spews endless tikz code (that often fails to compile, breaking SageNB) is an unrelated bug. It should output something like $G_{123}$ that actually can be displayed for reasonably large graphs.

I might be completely misunderstanding things, but would like to make sure: easy access to the tikz code is very very very important to me.  Is there a difference between `latex(g)` and `g.__latex__`?  What would be the point of having $G_{123}$ as output?  At least for me it would be completely useless.


---

Comment by ncohen created at 2015-04-26 06:47:47

> I might be completely misunderstanding things, but would like to make sure: easy access to the tikz code is very very very important to me.  Is there a difference between `latex(g)` and `g.__latex__`?  What would be the point of having $G_{123}$ as output?  At least for me it would be completely useless.

The key to the non-discussion above is this:


```
sage: show is pretty_print
True
```


That `show` is an alias for `pretty_print` is a problem here, for `show(g)` seems to indicate a plot while `pretty_print(g)` seems to indicate the kind of latex representation that Volker wants.

Even though `show(g)` is indeed used frequently (Volker removes those doctests in this branch), it is definitely hard to do anything coherent when two functions with such different meanings are aliases of each other.

Soooooooo well. If we can solve the problem by deprecating the `show` alias, and if in the meantime it still displays a plot for graphs while hinting at `Graph.show` or `Graph.plot`, then nobody will be lost. What do you think?

Nathann


---

Comment by mantepse created at 2015-04-26 18:18:55

I don't understand.  On my sage, I have


```
sage: show is pretty_print
False
```

and I do not really see a reason why `show` should be `pretty_print`.  I would expect (depending on the situation) different things from these two commands.

Please enlighten me, if you still have hope for me :-)


---

Comment by vdelecroix created at 2015-04-26 18:20:25

Replying to [comment:58 mantepse]:
> I don't understand.  On my sage, I have
> 
> {{{
> sage: show is pretty_print
> False
> }}}
> and I do not really see a reason why `show` should be `pretty_print`.  I would expect (depending on the situation) different things from these two commands.
> 
> Please enlighten me, if you still have hope for me :-)

Which version are you running? In sage-6.7.beta2 (console) I got `True` as well.

Vincent


---

Comment by mantepse created at 2015-04-26 18:37:23

sage-6.5.  OK, it's a recent change, that's why I didn't understand.  Sorry about that, I only saw understood what #17821 does now.  I guess it's too late now to complain :-)

(In case it clarifies - my expectations would be:

* `show`: open an external viewer if sensible, i.e., for graphs, posets, graphics, etc.
* `pretty_print`: try to print as nicely as possible in the current environment.  I guess that this function should depend on context.  I exclusively use emacs in which case I'd expect it to use ascii-art when available.
* `latex`: return a latex string that I can copy-paste into a paper.

(I think that `plot` is not really a good name for showing a graph in an external viewer.  I never plot graphs :-)


---

Comment by vbraun created at 2015-04-26 23:54:39

Well thats certainly yet another variant of the difference between show and pretty_print. I don't understand how the name `show` suggests that it has something to do with whether an external viewer is launched. Also, in the notebook there are no external viewers yet `show` and `pretty_print` still were subtly different (not in useful or predictable ways, though)

One of the meanings of "plot" is: a plan, map, diagram, or other graphic representation, as of land, a building, etc. Doesn't sound like such a bad fit to me. Though feel free to suggest a better name.


---

Comment by vbraun created at 2015-04-27 00:10:49

Replying to [comment:56 mantepse]:
> Is there a difference between `latex(g)` and `g.__latex__`?  What would be the point of having $G_{123}$ as output?  At least for me it would be completely useless.

* `latex(g)` just calls `g._latex_()`, so they are equivalent
* We should certainly have a way to get the tikz code. 
* The problem is that if you click the "typeset" checkbox in SageNB then it calls `latex()` for every output. But typesetting tikz often fails, resulting in a quite broken notebook. For large-ish graphs we shouldn't go that route in the displayhook.

The two logical options are either 
* move the tikz output, something like `graph.plot(format='tikz')`, or
* not call `graph._latex_()` when typesetting output, for example implementing a different latex view it in `graph._rich_repr_()`


---

Comment by novoselt created at 2015-04-27 00:24:03

With the addition of `_rich_repr_`, perhaps we should have in the guidelines that `_latex_` and `_plot_` always produce "full object" no matter how likely it is to be useful, while `_rich_repr_` makes a decision about truncating large objects and picking graphics over formula or returning some incomplete description like latexed count of vertices and edges. There have to be, of course, some easy way to programmatically force calls of `_latex_` or `_plot_` without direct use of underscore methods. I guess with the new system we get `pretty_print(latex(x))` and `pretty_print(plot(x))`.

And I have to admit that `show(latex(x))` and `show(plot(x))` are more natural - perhaps we can have new function `show` that will do what it says - show a given LaTeX, graphics, or HTML expression, without trying to decide what to do with other types. `display` is another suitable name that will match dispayhook terminology nicely.


---

Comment by git created at 2015-04-27 01:38:11

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-27 01:50:49

In the last commit I special-cased latex rich output. Now at least the notebook is usable with `%display latex` turned on...


---

Comment by ncohen created at 2015-04-27 06:31:53

Hello Volker,

This ticket is about reverting the changes from #17821, and your last commits are adding customization to the 'pretty_print' output. Could we stick to the subject, and could you add this (deprecated) show function which behaves like `show(a_graph)` used to behave (with a deprecation of course)?

Thanks,

Nathann


---

Comment by mantepse created at 2015-04-27 07:35:09

Replying to [comment:62 vbraun]:
> Replying to [comment:56 mantepse]:
> > Is there a difference between `latex(g)` and `g.__latex__`?  What would be the point of having $G_{123}$ as output?  At least for me it would be completely useless.
> 
> * `latex(g)` just calls `g._latex_()`, so they are equivalent
> * We should certainly have a way to get the tikz code. 
> * The problem is that if you click the "typeset" checkbox in SageNB then it calls `latex()` for every output. But typesetting tikz often fails, resulting in a quite broken notebook. For large-ish graphs we shouldn't go that route in the displayhook.
> 
> The two logical options are either 
> * move the tikz output, something like `graph.plot(format='tikz')`, or
> * not call `graph._latex_()` when typesetting output, for example implementing a different latex view it in `graph._rich_repr_()`

Since a SageNB user will hardly type `latex` by hand (I'm not using the notebook, so I'm guessing), why should `latex` print anything but code useful for inclusion in a paper?

I think it's hardly possible to reuse output functionality too much, since the use cases are quite diverse.  So, if I understand you correctly, I would very much prefer the second solution.  It would be a shame if I can use `latex(matrix)` and `latex(symbolic_expression)` but not `latex(graph)`.


---

Comment by mantepse created at 2015-04-27 07:49:39

Replying to [comment:61 vbraun]:

> One of the meanings of "plot" is: a plan, map, diagram, or other graphic representation, as of land, a building, etc. Doesn't sound like such a bad fit to me. Though feel free to suggest a better name.

I have not yet encountered this meaning in the context of computer graphics.  Wikipedia doesn't have it either, see http://en.wikipedia.org/wiki/Plot_%28graphics%29, vs. http://en.wikipedia.org/wiki/Graph_drawing.

Although I don't use it, there is currently a distinction between `show` and `plot` for matrices, and I'd say it matches what I expect.  `plot` tries to interpret the matrix as  something like a contour plot, whereas `show` opens an external viewer to see a big matrix in all detail.


---

Comment by vbraun created at 2015-04-28 15:09:02

A plotter is a type of printer for diagrams, that is certainly well-established in computer graphics circles.

`show()` only opens an external viewer on the ipython commandline. We need to think bigger than in terms of a single UI here.


---

Comment by ncohen created at 2015-04-28 15:17:36

> `show()` only opens an external viewer on the ipython commandline.

In Sage, once this branch is applied we get this:


```
sage: show(graphs.PetersenGraph())
G_{10}
```


Could you change this branch so that `show(graphs.PetersenGraph())` opens a window and displays a graph, as it has been the case for years?

Thanks,

Nathann


---

Comment by vbraun created at 2015-04-28 15:37:00

It does that without this branch. I'm happy with that if you are. I'm only against show() returning something else than the displayhook.


---

Comment by ncohen created at 2015-04-28 16:05:05

> It does that without this branch.

Without this branch (i.e. with beta3) this command opens a window with a plot:


```
sage: show(graphs.PetersenGraph())
```


> I'm happy with that if you are.

I am not. `G_{10}` means nothing to somebody in the graph world, and the previous output was way more informative:


```
sage: Graph(4,loops=True,multiedges=True)
Looped multi-graph on 4 vertices
```


> I'm only against show() returning something else than the displayhook.

I am against 'show()' returning anything else than what it has been returning for the last 5 years. You can add a deprecation warning if you plan to remove 'show()' (I would agree with it), but anything else would be problematic: you cannot expect `show(g)` to be different from `g.show()`.

In the meantime, as per our deprecation policy, the result should still be the same for one year.

There is no reason to consider `show(a_graph) # opens a window` as a bug either. I consider it as a feature, as do most of the people I talk with.

Nathann


---

Comment by vbraun created at 2015-04-28 16:31:03

Replying to [comment:72 ncohen]:
> I am not. `G_{10}` means nothing to somebody in the graph world, and the previous output was way more informative:

Well do you have any way of using latex to improve on the plain text output? I just put that there to avoid calling `_latex_()` in SageNB. We can also return `\verb{Looped multi-graph on 4 vertices}`, though that is kind of lame. 

This is related to why I said on sage-devel that the commandline backend shouldn't claim to support latex output, printing the latex version just makes it worse.

> There is no reason to consider `show(a_graph) # opens a window` as a bug either. 

It doesn't do that (or, rather, it only does that in the commandline ui). Do you really think that the SageNB behavior where show switches from tkz graphics to matplotlib graphics is a feature?


---

Comment by ncohen created at 2015-04-28 16:42:10

> Well do you have any way of using latex to improve on the plain text output?

What is wrong with displaying plain text?

> It doesn't do that (or, rather, it only does that in the commandline ui). Do you really think that the SageNB behavior where show switches from tkz graphics to matplotlib graphics is a feature?

Why do you keep bringing the notebook up? I never mentionned anything related to the notebook. I do not use it, I am just barely aware that it exists and is simultaneously being replaced by Jupyter and SMC.

All I ask is for you to revert the changes you made that break several things I (and others) work with. Namely:

- `show(graphs.PetersenGraph())` used to open a window and plot the graph
- `graphs.PetersenGraph()` used to display `Petersen graph: Graph on 10 vertices`

If, additionally, you want to deprecate 'show' (in another ticket) I have absolutely nothing against that. The semantics of `show` and `pretty_print` are very different, and since you made one an alias of the other we have been discussing the problems it caused.

Nathann


---

Comment by git created at 2015-04-29 01:23:31

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-29 01:30:41

Replying to [comment:74 ncohen]:
> > Well do you have any way of using latex to improve on the plain text output?
> What is wrong with displaying plain text?

Seems like we are missing an opportunity. But if graph theory is the only field of mathematics that doesn't benefit from Latex's typesetting capabilities then thats fine with me...


> Why do you keep bringing the notebook up? I never mentionned anything related to the notebook. I do not use it, I am just barely aware that it exists and is simultaneously being replaced by Jupyter and SMC.

None of the three has a notion of exec'ing an external viewer, so if you prefer you can just replace SageNB with one of the other browser-based notebook. And I keep bringing this shit up precisely because I want the IPython notebook to work without having to maintain a fork like SMC. You can't define behavior in terms of "I want/don't want an external viewer launched", that is crap. It arguably was crap 10 years ago, but nowadays the technical debt of that simplistic view is really catching up with us.


---

Comment by bump created at 2015-04-29 03:14:05

From a point of view of developmental transparency, it seems to me that the right thing would be to just back out #17821 and then put up another patch in another ticket that could be reviewed, rather than to try to combine the reversion with further changes. Currently things are broken, so there is an urgency to getting things fixed.

```
sage: CartanMatrix("E8~").dynkin_diagram()
Launched png viewer for         O 2
	|
        |
O---O---O---O---O---O---O---O
1   3   4   5   6   7   8   0
E8~
```



---

Comment by vbraun created at 2015-04-29 04:33:59

On the other hand, if we would always unmerge tickets because of a real or preceived regression then we would spend our entire time unmerging. Really, that is what beta releases are for.

As for the Cartan matrix, its the same as

```
sage: pi.n(100), CartanMatrix("E8~").dynkin_diagram()
(3.1415926535897932384626433833,         O 2
         |
         |
 O---O---O---O---O---O---O---O
 1   3   4   5   6   7   8   0   
 E8~)
```

To avoid that, we need a way to distinguish ascii art from composable strings. We do have a mechanism for that, namely `_ascii_art_` vs. plain `_repr_`. I've made #18328 for that.

The attached branch now doesn't display graphs pictorially on the command line, so at least it doesn't trigger your particular ascii art problem any more.


---

Comment by ncohen created at 2015-04-29 06:16:55

> On the other hand, if we would always unmerge tickets because of a real or preceived regression then we would spend our entire time unmerging.

I am also against this ticket that you merged, I also believe that it created a lot of mess, and I also believe that it should be unmerged. Stop forcing your changes on us.

We do NOT like this change. How many tickets have you already created to fix th problems it caused? Please *REVERT* it.

You just renamed this ticket from "revert the changes" to "make graph display configurable": I do not want to be forced to agree with changes that do not concern me (for example in the notebook) in order for graphs to be fixed. Please rename this ticket to its old name, and fix what you broke. And *only that*. 

Or more simply, please revert #17821 and redo things without breaking anything.

Nathann


---

Comment by novoselt created at 2015-04-29 06:55:23

We LOVE the changes that Volker has done to the display system - while there is some dust in the process (and he pointed out that beta releases are there to allow cleaning up), it actually makes sense now to have Sage as math software and multiple interfaces to it that don't have to be adjusted with every new version of Sage, potentially breaking more and more things that are very hard to test automatically. This certainly was the case with SageMathCell and I am pretty sure with SageNB, since each version of the latter required changes to Sage beyond just bumping version numbers.

I also get the impression that graphs are the only things "heavily broken" by recent changes, which suggests that the problems are with the way how graphs are set up. Or maybe I am wrong and Sage is only used for graphs, that's why there are few complains for other areas.


---

Comment by ncohen created at 2015-04-29 07:05:17

> We LOVE the changes that Volker has done to the display system - while there is some dust in the process

If the original ticket had been better advertised, and if there were doctests for what was broken this ticket would have been set to `needs_work`. When developing in Sage that's how it works: we don't just write code that breaks things that other persons use and "fix them later", beta or no beta. It is in `needs_work` until there is no problem with it, and then it gets merged. Whatever this ticket does, it was definitely not ready.

So please undo the changes first, and reimplement what you want to properly.

Nathann


---

Comment by ncohen created at 2015-04-29 07:23:35

> I also get the impression that graphs are the only things "heavily broken" by recent changes, which suggests that the problems are with the way how graphs are set up.

Possibly because some of the changes in #17821 are graph-specific? Try it in beta3:


```
sage: graphs.PetersenGraph() # plots a picture
sage: posets.ChainPoset(4) # does not plot a picture
```


If everything that *can* be plotted *was* plotted you would hear a lot more noise. But no, #17821 did this for graphs in particular. This inconsistency must be reverted too.

Nathann


---

Comment by vbraun created at 2015-04-29 11:12:42

Replying to [comment:80 ncohen]:
> You just renamed this ticket from "revert the changes" to "make graph display configurable"

You renamed my ticket to "revert the changes", I just reverted your renaming of my ticket. If you don't agree feel free to open your own ticket, or air your grievances on sage-devel. Or we can move on and do something constructive.

I added pictorial representation to graphs because somebody went through a lot of trouble to hack that as a special case into `show(graph)` (but not for posets). I never wanted everything to be plotted that has a plot method. I thought it would be appreciated if I replace said kludge with always showing graphs as pictures. Ok, now I know you actually don't want graphs shown as pictures, except in `show(graph)` to preserve the inconsistency until we can deprecate it. Fine with me. The attached branch now implements this.


---

Comment by vdelecroix created at 2015-04-29 11:47:42

Hello,

Perhaps it would be cool to first decide once for all the semantic of all our display functions and methods in sage? There was a thread open for that purpose in Sage. I guess we could open a ticket only for deciding what should we do with `show`, `plot`, `pretty_print` `print`, etc.

Concerning the current branch, I would prefer that the

```
is_small = (0 < self.num_verts() < 20)
plot_graph = display_manager.preferences.plot_graphs != 'never' and \
  (display_manager.preferences.plot_graphs == 'always' or is_small)
```

actually belongs to the display manager itself. People implenting classes should not have to worry about the display manager preferences. Don't you think? I would separate:

- which methods the class could possibly implement (e.g. `_latex_`, `_rich_latex_`, `_ascii_art_`, `plot`)
- and let the display manager decide when we do things like `object`, `plot(object)` or `latex(object)`

Vincent


---

Comment by ncohen created at 2015-04-29 11:57:01

Yo,

> I added pictorial representation to graphs because somebody went through a lot of trouble to hack that as a special case into `show(graph)` (but not for posets). I never wanted everything to be plotted that has a plot method. I thought it would be appreciated if I replace said kludge with always showing graphs as pictures. Ok, now I know you actually don't want graphs shown as pictures, except in `show(graph)` to preserve the inconsistency until we can deprecate it. Fine with me. 

Wow. And it only took a week of posts. How constructive can we get?

> The attached branch now implements this.

And much more. Here is a first-pass review:

- Thanks for fixing the command-line usage

- With your modifications, the notebook displays a picture of the graph when it
  has order 0<..<20. Notebook users, who may be beginners, could get used to
  graphs that are displayed so easily, and not know what do to when, by adding a
  vertex to their graph, they can't obtain a plot anymore. When the graphs is
  *not* plotted because it is too large, it may be good to hint at how they
  could get a plot, a bit like what happens for matrices:

  {{{
  sage: identity_matrix(100)
  100 x 100 dense matrix over Integer Ring (use the '.str()' method to see the entries)
  }}}

  What would you think of returning a string similar to that in the notebook
  when the graph is too big to be automatically plotted?

  {{{
  Petersen graph: Graph on 10 vertices (use the '.show()' method to see the graph)
  }}}

- The one-line description, and the information we get from it, is not provided
  by the drawing only. What would you think, when in the notebook, to do both at
  once: print the string *AND* plot the graph? Users would get (strictly) more than what
  they get in the command-line interface because their UI has more capacities.

  The useful information is especially the number of vertices and whether the
  graph allows loops/multiple edges.

  I also thought of adding the number of edges there, eventually: this
  information will be useful to both kind of users.

- Could you explain this part of the code?
  {{{
  output = self.plot(**kwds)._rich_repr_(display_manager)
  if output is not None:
      return output
  }}}
  In which case would this call return a "None"?

- About other graph-like objects
  {{{
  Whether to graphically display graphs, posets, and other
  graph-like objects. When not specified small objects are show
  graphically and large objects as textual overview.
  }}}
  Posets do not inherit from graphs. Neither do automata, crystals, and many of
  the things that you may want to be plotted. Thus, currently this piece of
  documentation is incorrect (for posets), but we may also want to add
  others. Otherwise, graphs will just be an oddity in the notebook.

- Do you still plan to deprecate show in #18302?

- About the backend `default_preferences` functions that you add: right now they
  build an object (containing the preferences) that they return, but in order to
  change one specific preference one needs to overwrite the function with a new
  one. What would you think of having a `DisplayPreferences` object in each of
  those backends files? This way we would be able to change their settings in a
  `~/.sage/sage.init` file with just a line, i.e. something like:
  {{{
  sage.repl.rich_output.backend_ipython.display_preferences["figsize"]=10000
  }}}

Nathann


---

Comment by git created at 2015-04-29 14:53:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-29 15:13:18

Replying to [comment:86 ncohen]:
>   What would you think of returning a string similar to that in the notebook
>   when the graph is too big to be automatically plotted?

Sounds good, done

> - What would you think, when in the notebook, to do both at
>   once: print the string *AND* plot the graph? 

Sounds good, but will have to think about the proper implementation first. Right now there are only rich output containers for a particular type. So we either 
* render the text inside the image (meh)
* add an optional caption to all image output types (maybe), or
* add a rich output type that is a container of other rich output types (probably want this for other purposes, too)
I'd say that is material for another ticket.

> - Could you explain this part of the code?
>   {{{
>   output = self.plot(**kwds)._rich_repr_(display_manager)
>   if output is not None:
>       return output
>   }}}
>   In which case would this call return a "None"?

By convention, the `_rich_repr_` method can just return `None` to indicate that there is no rich output, e.g. because the desired output types is not supported. The display framework then falls back to `_repr_`.

> - About other graph-like objects

I've adjusted the docstring. I don't have any immediate plans to switch other objects to graphical output, though we should think about that when the dust has settled...

> - Do you still plan to deprecate show in #18302?

yes

> - What would you think of having a `DisplayPreferences` object in each of
>   those backends files?

Sounds good, though I wanted to revisit the preferences system to make it more general and make them more like google app engine ndb models. IMHO we need an easy-to-use validating(!) option system for graphics options and the like. The display preferences are just a quick implementation that I needed. It is better than dumb dictionaries, but not as good as it can be.


---

Comment by ncohen created at 2015-04-29 15:30:25

Hello,

> Sounds good, but will have to think about the proper implementation first. Right now there are only rich output containers for a particular type. So we either 
> * render the text inside the image (meh)
> * add an optional caption to all image output types (maybe), or
> * add a rich output type that is a container of other rich output types (probably want this for other purposes, too)
> I'd say that is material for another ticket.

I agree that the 1) is a bit 'meh' (as you say), but what about doing this for the moment, knowing that it will be improved later? It is the cheapest thing that we can do for the moment.

> By convention, the `_rich_repr_` method can just return `None` to indicate that there is no rich output, e.g. because the desired output types is not supported. The display framework then falls back to `_repr_`.

Okayyy, thanks !

> > - About other graph-like objects
> 
> I've adjusted the docstring. I don't have any immediate plans to switch other objects to graphical output, though we should think about that when the dust has settled...

Oh. Well, I was sending this when you posted your message:
https://groups.google.com/d/topic/sage-devel/2dBo6Cm-sIc/discussion

Let's see what happens.

> > - Do you still plan to deprecate show in #18302?
> 
> yes
Great!

> Sounds good, though I wanted to revisit the preferences system to make it more general and make them more like google app engine ndb models. IMHO we need an easy-to-use validating(!) option system for graphics options and the like.

Couldn't agree more. I recently had to review some code which dealt with an awful lot of options, and screens of code were only there to check that.

> The display preferences are just a quick implementation that I needed. It is better than dumb dictionaries, but not as good as it can be.

Great idea. We should have some "check_type" module with functions like that:


```
    sage: check_nonnegative_value(-2,"x") # exception if the value is negative or not in RR
    ...
    ValueError: 'x' (=-2) must be a nonnegative value

    check_allowed_value('d',"x",["A","B","C"]) # exception if x is not allowed
    ...
    ValueError: 'x' (='d') must be equal to one of "A","B","C"

    check_list_of_integers([1,2,3,"a",9]) # raise exception if not a list, or contains non-integers
    ...
    ValueError: "a" is not an integer
```


Then perhaps `DisplayPreferences` could just be a dictionary with a modified `__setitem__`?

Nathann


---

Comment by vbraun created at 2015-04-30 03:48:56

The `DisplayPreferences` right now does the following:

```
sage: prefs = DisplayPreferences()
sage: prefs.text = 'ascii_art'  # dot-notation for tab completion
sage: prefs                     # nice output
Display preferences:
* graphics is not specified
* text = ascii_art
sage: prefs.text?               # help documents setting and lists allowed values
sage: prefs.text = 'foo'        # validates
Traceback (most recent call last)
...
ValueError: value must be unset (None) or one of ('plain', 'ascii_art', 'latex'), got foo
```

What is IMHO missing is a nice syntax to declare your own preferences and validation for anything that is not a choice out of a finite list of strings. I'd rather have tab-completion and built-in help with `?` than dictionary notation.


---

Comment by git created at 2015-04-30 21:17:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-30 21:18:22

The graph repr string is now used as title if there is not one already.


---

Comment by ncohen created at 2015-05-01 11:57:22

What do we do about this branch ? The guys on sage-devel did not seem overly enthusiastic.

https://groups.google.com/d/msg/sage-devel/2dBo6Cm-sIc/oaq-DUZ8utkJ
https://groups.google.com/d/msg/sage-devel/2dBo6Cm-sIc/57KPWJQ2K3gJ

As I mentionned on that thread, I don't object to this modification (in the notebook only) provided that graphs are not the only things that are automatically displayed.

Nathann


---

Comment by vbraun created at 2015-05-02 03:00:49

You can't just ask customers what they want and then try to give that to them (Steve Jobs)


---

Comment by ncohen created at 2015-05-02 05:54:39

> You can't just ask customers what they want and then try to give that to them (Steve Jobs)

If you want, in this ticket we can finalize the implementation of this gadget of yours, only it will not be the default. If so, what about the list of things that are automatically plotted "when the flag is enabled"?

The mechanism of `DiplayPreferences` for ech backend isn't bad really. Even though I am not a big fan of automatic pictures either.

Nathann


---

Comment by git created at 2015-05-03 16:11:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-05-03 16:41:54

Here is a list of objects that IMHO should be plotted by default if the object is simple enough and if the graphics can be displayed inline:
* braids and knots
* polygons, fans (2d only)
* audio files (sage.media.wav)
* time-series finance data
* posets
* quivers
* certain game configurations, knutson-tao, others?
In addition, wrapped graphics in some interfaces should be drawn graphically by default, e.g. the gnuplot interface. Though I think its premature to make a final decision, there are still some bits missing like javascript interactive output. Also, we need a better framework for supplementing plain text with graphics vs. only showing graphics. The rich output should probably in general have a flag to show rich output in addition to plain text vs. only show the rich output.

I've added a workaround for dynkin diagrams until we get to #18328. IMHO this is enough for one ticket.


---

Comment by vbraun created at 2015-05-03 16:51:37

A more general name for the option might be `extra_graphics` instead of `plot_graphs`. Or maybe `supplemental_graphics`?


---

Comment by ncohen created at 2015-05-03 16:59:12

Hellooooooooooooooooooo,

> Here is a list of objects that IMHO should be plotted by default if the object is simple enough and if the graphics can be displayed inline:

Sounds good. Why do you think we should *not* render small 3D objects too?

> The rich output should probably in general have a flag to show rich output in addition to plain text vs. only show the rich output.

Hmmmmm. I am afraid that such decisions could have to be made locally, for each specific object `:-/`

> I've added a workaround for dynkin diagrams until we get to #18328. IMHO this is enough for one ticket.

I would like the graphs to not be the only objects that are automatically plotted. I will write a commit for `Posets`, `Quivers` and `Polygons`. Perhaps Braids and Knots too, if I figure out how it works inside.

> A more general name for the option might be `extra_graphics` instead of `plot_graphs`. Or maybe `supplemental_graphics`?

What about `draw_graphics` or `plot_graphics` ?

Nathann


---

Comment by ncohen created at 2015-05-03 17:00:40

Oh. And also, plotting should *not* be the default in the notebook either, considering the latest posts on sage-devel. I have no strong objection myself, but please convince them first before doing that.


---

Comment by vbraun created at 2015-05-03 17:17:05

Plotting graphs was the default in SageNB, its also the default in Mathematica (https://reference.wolfram.com/language/ref/Graph.html). Nobody objected to plotting graphs in the notebook, they all mistakenly assumed that you were talking about the commandline interface.


---

Comment by vbraun created at 2015-05-03 17:21:48

Replying to [comment:99 ncohen]:
> Sounds good. Why do you think we should *not* render small 3D objects too?

Basically because our 3d graphics sucks too hard right now.


> > The rich output should probably in general have a flag to show rich output in addition to plain text vs. only show the rich output.
> Hmmmmm. I am afraid that such decisions could have to be made locally, for each specific object `:-/`

Yes, but that is a feature. The object itself knows best how to display itself.

> What about `draw_graphics` or `plot_graphics`?

The names don't capture the behavior of "graphics if it can be displayed unobtrusively"


---

Comment by ncohen created at 2015-05-03 17:41:03

Helloooooooo,

> Basically because our 3d graphics sucks too hard right now.

Oh.

> The names don't capture the behavior of "graphics if it can be displayed unobtrusively"

Should the name of the parameter capture it? Right now it can be set to 'always'. It is the value that `plot_graphs` takes that should carry the meaning of "if it is small".

What about renaming the parameter to `graphical_rich_repr`, taking values like `never`, `always`, `when_unobtrusive` (I am not a smart man). I also believe that it would be better to work with `if value == 'always' or value == 'when_unobtrusive'` rather than `if value != 'never'`. We don't know what will happen with this parameter.

> Plotting graphs was the default in SageNB, its
> also the default in Mathematica 
> (https://reference.wolfram.com/language/ref/Graph.html).

Well, this branch is not about SageNB but about the notebook, and the notebook behaves like Sage does on this respect.

> Nobody objected to plotting graphs in the notebook, 
> they all mistakenly assumed that you were talking about the
> commandline interface.

Even if that were true, that would not mean that their 'no' should be taken as a "yes, let the notebook plot small objects automatically". If you think that they don't mind this change, mail to sage-devel and ask them again. 

I just don't want to give a positive review to a change when a question was asked and people said "don't do it". That's all.

I added a small commit at public/18289 for a `_rich_repr_` in Posets and Polyhedra. I was not able to find the Quiver class [1]. It is mostly a copy/paste of your code for graphs.

Nathann

[1] By the way what is this?
http://www.sagemath.org/doc/reference/quivers/index.html
http://www.sagemath.org/doc/reference/combinat/sage/combinat/cluster_algebra_quiver/quiver.html


---

Comment by vbraun created at 2015-05-03 18:28:11

Replying to [comment:103 ncohen]:
> Should the name of the parameter capture it? Right now it can be set to 'always'. It is the value that `plot_graphs` takes that should carry the meaning of "if it is small".

Preferences have a default behavior. In this case the default is to let the object decide, which is useful for most user interfaces. The commandline is a special case in that it is a non-graphical UI.

> What about renaming the parameter to `graphical_rich_repr`

No ;-) For starters, that sounds like it would apply to plots.

I think the case where you want to display plain text + graphics is precisely where you don't want the graphics if it cannot be displayed inline. So rename `plot_graphs` to `supplemental_graphics`, and enhance the rich output system to have a flag for replacing text vs. supplementing text (ideally in another ticket)

> > Plotting graphs was the default in SageNB, its
> > also the default in Mathematica 
> > (https://reference.wolfram.com/language/ref/Graph.html).
> 
> Well, this branch is not about SageNB but about the notebook, and the notebook behaves like Sage does on this respect.

THE notebook is still SageNB, which is the default for `sage --notebook`. The IPython notebook is still work in progress, in part because the rich output system is not finished. Any previous behavior of the IPython notebook is a bug unless noted otherwise. The IPython notebook is finished when it becomes the default.

> [1] By the way what is this?
> http://www.sagemath.org/doc/reference/quivers/index.html
> http://www.sagemath.org/doc/reference/combinat/sage/combinat/cluster_algebra_quiver/quiver.html

Thats what I meant. Simon also has a ticket with more quiver stuff somewhere on trac.


---

Comment by vbraun created at 2015-05-03 18:48:14

Probably better name: `supplemental_plot` to clarify that we are talking about plotting...


---

Comment by git created at 2015-05-04 15:03:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-05-04 15:11:17

Yoooooooo !

Do you plan to add more `_rich_repr_` functions in this ticket?


---

Comment by vbraun created at 2015-05-04 15:25:11

No. I'll work on unrelated build system stuff in the next couple of days.


---

Comment by ncohen created at 2015-05-04 15:28:29

Okay. So can I (or you) set 'supplemental_plot' to 'never' everywhere so that this branch can be merged?


---

Comment by vbraun created at 2015-05-04 16:05:05

How about a one-year deprecation before we change the behavior away from the current SageNB feature of pictorially displaying a graph?


---

Comment by vbraun created at 2015-05-04 16:08:00

At the most I'd be OK with making "never" the default everywhere except the IPython notebook.


---

Comment by ncohen created at 2015-05-04 16:09:57

> How about a one-year deprecation before we change the behavior away from the current SageNB feature of pictorially displaying a graph?

You have been hinting at this several times but I do not understand: if you type `graphs.PetersenGraph()` in a notebook running a release which is not beta3, you will *not* get a picture, will you? So what would there be to deprecate?

Nathann


---

Comment by vbraun created at 2015-05-04 16:10:38

You do get a picture (if the "typeset" checkbox is checked)


---

Comment by ncohen created at 2015-05-04 16:15:13

> You do get a picture (if the "typeset" checkbox is checked)

Oh. The LaTeX picture I expect? This picture is totally different from the one you get when you run `.plot()`. The 'typeset' checkbox is unchecked by default, isn't it?


---

Comment by novoselt created at 2015-05-04 16:22:13

Replying to [comment:111 vbraun]:
> At the most I'd be OK with making "never" the default everywhere except the IPython notebook. 

Let's please keep defaults in different notebooks as close to each other as it is feasible...


---

Comment by vbraun created at 2015-05-04 16:27:05

Replying to [comment:114 ncohen]:
> The LaTeX picture I expect?

Yes. Its perhaps ill-advised that it used the latex picture unconditionally (fixed in this ticket) but its a picture nevertheless.


---

Comment by ncohen created at 2015-05-04 16:35:25

> > The LaTeX picture I expect?
> 
> Yes. Its perhaps ill-advised that it used the latex picture unconditionally (fixed in this ticket) but its a picture nevertheless.

It is a picture indeed. The default behaviour, however, is to not display any. That is also consistent with Sage in command-line, and with Sage Math Cloud. So what about not changing that with this branch?

Let us set this this 'supplemental_plot' variable to 'never' everywhere, and if you want to change this eventually please ask on sage-devel first.

Nathann


---

Comment by vbraun created at 2015-05-04 16:38:17

I disagree, a user interface that is less inviting than Mathematica to newcomers directly violates our mission statement.


---

Comment by vbraun created at 2015-05-04 16:54:35

Poll at https://groups.google.com/forum/#!topic/sage-devel/GkG3SXXFKRQ


---

Comment by ncohen created at 2015-05-04 18:28:23

Excellent!


---

Comment by ncohen created at 2015-05-04 18:29:37

... though you could have easily been a bit less partial in the question `:-PPPP`


---

Comment by ncohen created at 2015-05-05 07:15:13

Okay, looks like everybody who has an opinion votes for it. Soooooo what do we do? Make it the default for Sage notebook+IPython notebook?

Nathann


---

Comment by ncohen created at 2015-05-06 09:29:42

Changing status from needs_review to needs_info.


---

Comment by vbraun created at 2015-05-08 22:56:50

Yes. Just as in the attached branch


---

Comment by vbraun created at 2015-05-08 22:56:50

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2015-05-09 06:21:23

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-05-09 06:21:23

Oh. I expected to see a trace of it in some `backend_sagenb` file, but you apparently decided that the "default interface" for Sage was the notebook, and that all other interfaces (i.e. the comand line) was the one that had to be specified explicitly.

I only hope that the command line will not silently 'inherit' in the future some of the notebook's behaviour.

Nathann


---

Comment by vbraun created at 2015-05-09 23:03:13

Resolution: fixed
