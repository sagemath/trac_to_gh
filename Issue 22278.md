# Issue 22278: py: little cleanup of iteritems

Issue created by migration from https://trac.sagemath.org/ticket/22515

Original creator: chapoton

Original creation time: 2017-03-05 09:32:35

CC:  tscrim jdemeyer aapitzsch dkrenn

* no need for six.iteritems in pyx files

* try not to use .iteritems in the doc


---

Comment by chapoton created at 2017-03-05 09:33:18

waiting for the bots
----
New commits:


---

Comment by chapoton created at 2017-03-05 09:33:18

Changing status from new to needs_review.


---

Comment by chapoton created at 2017-03-06 07:30:19

Jeroen, do you confirm that one can keep using the method `.iteritems` in pyx files ?

green bot, please review.


---

Comment by chapoton created at 2017-03-07 09:03:37

ping ?


---

Comment by jdemeyer created at 2017-03-07 10:39:12

Replying to [comment:2 chapoton]:
> Jeroen, do you confirm that one can keep using the method `.iteritems` in pyx files ?

Yes because Cython optimizes `dict.iteritems()`. It never actually calls the Python method `iteritems()`, it has its own implementation for iterating over a dict. I should mention that this only works for objects of exact type `dict` (not subclasses).

This is also why `six.iteritems` (and many other `six` functions like `six.moves.range`) should be avoided in Cython: it prevents Cython from doing certain optimizations.


---

Comment by jdemeyer created at 2017-03-07 10:45:21

Changing status from needs_review to positive_review.


---

Comment by jhpalmieri created at 2017-03-10 20:32:42

Is #22398 going to cause a new problem along these lines?


---

Comment by chapoton created at 2017-03-10 20:41:40

this is fixed here, as you can see in the branch


---

Comment by jhpalmieri created at 2017-03-10 20:47:23

Sorry, I got confused with the line numbers: I thought a different instance of `iteritems(x)` was fixed here. Never mind.


---

Comment by vbraun created at 2017-03-10 23:13:09

Resolution: fixed
