# Issue 16084: Improve caching for spaces of modular forms

Issue created by migration from Trac.

Original creator: saraedum

Original creation time: 2014-05-10 12:23:08

Spaces of modular forms do manual caching which causes trouble at #11895. This ticket aims to cleanup the code to use `cached_method`, factories, and `UniqueRepresentation` where appropriate.


---

Comment by saraedum created at 2014-05-11 15:07:30

New commits:


---

Comment by saraedum created at 2014-05-11 15:07:30

Changing status from new to needs_review.


---

Comment by saraedum created at 2014-05-11 23:46:49

Although all doctests pass, I think there are still potential issues with pickling when caches contain circular references.


---

Comment by saraedum created at 2014-05-11 23:46:49

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-05-12 17:51:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2014-05-12 17:52:02

Changing status from needs_work to needs_review.


---

Comment by git created at 2014-07-23 16:46:51

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2014-08-26 20:14:04

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2014-08-26 20:14:04

failing doctests, see patchbot reports


---

Comment by git created at 2016-03-21 14:00:29

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2016-03-23 01:19:10

Changing status from needs_work to needs_review.


---

Comment by saraedum created at 2016-03-23 01:19:53

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2016-03-24 02:20:41

Changing keywords from "" to "days71".


---

Comment by git created at 2017-07-21 19:49:45

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-07-21 19:50:25

Changing keywords from "days71" to "days71, sd87".


---

Comment by saraedum created at 2017-07-21 19:50:25

Changing status from needs_work to needs_review.


---

Comment by aly.deines created at 2017-07-21 22:05:46

Changing status from needs_review to needs_work.


---

Comment by aly.deines created at 2017-07-21 22:05:46

This doesn't want to import ClearCacheOnPickle


```
aly`@`aly-laptop:~/Sage/develop/sage$ ./sage -tp src/sage/modular/
Traceback (most recent call last):
  File "/home/aly/Sage/develop/sage/src/bin/sage-runtests", line 89, in <module>
    from sage.doctest.control import DocTestController
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 33, in <module>
    from .sources import FileDocTestSource, DictAsObject
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 33, in <module>
    from .parsing import SageDocTestParser
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 55, in <module>
    from sage.all import RealIntervalField
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/all.py", line 105, in <module>
    from sage.algebras.all   import *
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/all.py", line 22, in <module>
    import sage.algebras.catalog as algebras
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/catalog.py", line 62, in <module>
    from sage.algebras.iwahori_hecke_algebra import IwahoriHeckeAlgebra as IwahoriHecke
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py", line 34, in <module>
    from sage.combinat.root_system.weyl_group import WeylGroup
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py", line 118, in <module>
    from . import type_A
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_A.py", line 17, in <module>
    from . import ambient_space
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.py", line 16, in <module>
    from sage.misc.cachefunc import ClearCacheOnPickle
ImportError: cannot import name ClearCacheOnPickle
```

