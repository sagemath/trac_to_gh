# Issue 16084: Improve caching for spaces of modular forms

archive/issues_016084.json:
```json
{
    "body": "Spaces of modular forms do manual caching which causes trouble at #11895. This ticket aims to cleanup the code to use `cached_method`, factories, and `UniqueRepresentation` where appropriate.\n\nIssue created by migration from https://trac.sagemath.org/ticket/16321\n\n",
    "created_at": "2014-05-10T12:23:08Z",
    "labels": [
        "modular forms",
        "minor",
        "enhancement"
    ],
    "title": "Improve caching for spaces of modular forms",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16084",
    "user": "saraedum"
}
```
Spaces of modular forms do manual caching which causes trouble at #11895. This ticket aims to cleanup the code to use `cached_method`, factories, and `UniqueRepresentation` where appropriate.

Issue created by migration from https://trac.sagemath.org/ticket/16321





---

archive/issue_comments_209552.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-05-11T15:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209552",
    "user": "saraedum"
}
```

New commits:



---

archive/issue_comments_209553.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-05-11T15:07:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209553",
    "user": "saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_209554.json:
```json
{
    "body": "Although all doctests pass, I think there are still potential issues with pickling when caches contain circular references.",
    "created_at": "2014-05-11T23:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209554",
    "user": "saraedum"
}
```

Although all doctests pass, I think there are still potential issues with pickling when caches contain circular references.



---

archive/issue_comments_209555.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-05-11T23:46:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209555",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209556.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-05-12T17:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209556",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209557.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2014-05-12T17:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209557",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209558.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-07-23T16:46:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209558",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209559.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-08-26T20:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209559",
    "user": "chapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209560.json:
```json
{
    "body": "failing doctests, see patchbot reports",
    "created_at": "2014-08-26T20:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209560",
    "user": "chapoton"
}
```

failing doctests, see patchbot reports



---

archive/issue_comments_209561.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-03-21T14:00:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209561",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209562.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-03-23T01:19:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209562",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209563.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-03-23T01:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209563",
    "user": "saraedum"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209564.json:
```json
{
    "body": "Changing keywords from \"\" to \"days71\".",
    "created_at": "2016-03-24T02:20:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209564",
    "user": "saraedum"
}
```

Changing keywords from "" to "days71".



---

archive/issue_comments_209565.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2017-07-21T19:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209565",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_209566.json:
```json
{
    "body": "Changing keywords from \"days71\" to \"days71, sd87\".",
    "created_at": "2017-07-21T19:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209566",
    "user": "saraedum"
}
```

Changing keywords from "days71" to "days71, sd87".



---

archive/issue_comments_209567.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2017-07-21T19:50:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209567",
    "user": "saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_209568.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2017-07-21T22:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209568",
    "user": "aly.deines"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_209569.json:
```json
{
    "body": "This doesn't want to import ClearCacheOnPickle\n\n\n```\naly@aly-laptop:~/Sage/develop/sage$ ./sage -tp src/sage/modular/\nTraceback (most recent call last):\n  File \"/home/aly/Sage/develop/sage/src/bin/sage-runtests\", line 89, in <module>\n    from sage.doctest.control import DocTestController\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 33, in <module>\n    from .sources import FileDocTestSource, DictAsObject\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py\", line 33, in <module>\n    from .parsing import SageDocTestParser\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py\", line 55, in <module>\n    from sage.all import RealIntervalField\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/all.py\", line 105, in <module>\n    from sage.algebras.all   import *\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/all.py\", line 22, in <module>\n    import sage.algebras.catalog as algebras\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/catalog.py\", line 62, in <module>\n    from sage.algebras.iwahori_hecke_algebra import IwahoriHeckeAlgebra as IwahoriHecke\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py\", line 34, in <module>\n    from sage.combinat.root_system.weyl_group import WeylGroup\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py\", line 118, in <module>\n    from . import type_A\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_A.py\", line 17, in <module>\n    from . import ambient_space\n  File \"/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.py\", line 16, in <module>\n    from sage.misc.cachefunc import ClearCacheOnPickle\nImportError: cannot import name ClearCacheOnPickle\n```\n",
    "created_at": "2017-07-21T22:05:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16084",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16084#issuecomment-209569",
    "user": "aly.deines"
}
```

This doesn't want to import ClearCacheOnPickle


```
aly@aly-laptop:~/Sage/develop/sage$ ./sage -tp src/sage/modular/
Traceback (most recent call last):
  File "/home/aly/Sage/develop/sage/src/bin/sage-runtests", line 89, in <module>
    from sage.doctest.control import DocTestController
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 33, in <module>
    from .sources import FileDocTestSource, DictAsObject
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/sources.py", line 33, in <module>
    from .parsing import SageDocTestParser
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/doctest/parsing.py", line 55, in <module>
    from sage.all import RealIntervalField
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/all.py", line 105, in <module>
    from sage.algebras.all   import *
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/all.py", line 22, in <module>
    import sage.algebras.catalog as algebras
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/catalog.py", line 62, in <module>
    from sage.algebras.iwahori_hecke_algebra import IwahoriHeckeAlgebra as IwahoriHecke
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/algebras/iwahori_hecke_algebra.py", line 34, in <module>
    from sage.combinat.root_system.weyl_group import WeylGroup
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/__init__.py", line 118, in <module>
    from . import type_A
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/type_A.py", line 17, in <module>
    from . import ambient_space
  File "/home/aly/Sage/develop/sage/local/lib/python2.7/site-packages/sage/combinat/root_system/ambient_space.py", line 16, in <module>
    from sage.misc.cachefunc import ClearCacheOnPickle
ImportError: cannot import name ClearCacheOnPickle
```

