# Issue 32316: Fix coefficient method for modular forms

Issue created by migration from https://trac.sagemath.org/ticket/32553

Original creator: @DavidAyotte

Original creation time: 2021-09-22 18:51:41

Keywords: modular forms coefficient

Currently, the `coefficient` method appear in the TAB-completion for a modular form, but an error occur when one tries to use it.


```
sage: f = ModularForms(1, 12).0
sage: f.coefficient # hit TAB
                    f.coefficient
                    f.coefficients
sage: f.coefficient(10)
Traceback (most recent call last):
...
AttributeError: 'Sequence_generic' object has no attribute 'keys'
```




---

Comment by @DavidAyotte created at 2021-10-21 17:47:19

New commits:


---

Comment by @DavidAyotte created at 2021-10-21 17:47:19

Changing status from new to needs_review.


---

Comment by mkoeppe created at 2021-12-18 19:53:12

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.


---

Comment by vdelecroix created at 2021-12-29 10:19:39

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2021-12-29 10:19:39

The conversion `int(n)` is not ideal since `n=3/2` would be converted to `1`.


---

Comment by @DavidAyotte created at 2021-12-29 20:01:59

Hello Vincent, thank you very much for reviewing this!

I've tried the code with your example and, strangely, I got:


```
sage: f = ModularForms(1, 12).0
sage: f.coefficient(3/2)
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```


I have no idea why this happens, because you are indeed right, in the command line interface we do have:


```
sage: int(3/2)
1
```



---

Comment by git created at 2021-12-29 20:06:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2021-12-29 20:07:35

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2021-12-30 09:27:24

The error comes from

```
sage: f.q_expansion(3/2)
Traceback (most recent call last):
...
TypeError: no conversion of this rational to integer
```



---

Comment by vdelecroix created at 2021-12-30 09:29:09

I would rather do

```
n = Integer(n)
return self.q_expansion(n+1)[n]
```

so that the error message will be clearer, ie pointing to the line `n = ZZ(n)`.


---

Comment by git created at 2022-01-04 14:28:08

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by @DavidAyotte created at 2022-01-04 14:30:09

Replying to [comment:9 vdelecroix]:
> I would rather do
> {{{
> n = Integer(n)
> return self.q_expansion(n+1)[n]
> }}}
> so that the error message will be clearer, ie pointing to the line `n = ZZ(n)`.

Thank you for the suggestion! Happy new year!


---

Comment by vdelecroix created at 2022-01-05 08:04:56

Changing status from needs_review to needs_work.


---

Comment by vdelecroix created at 2022-01-05 08:04:56

Happy new year!


---

Comment by @DavidAyotte created at 2022-01-05 17:54:32

I might be wrong, but the failed doctest don't seem related to this ticket, see #32782 and #33026.


---

Comment by @DavidAyotte created at 2022-01-05 17:54:32

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2022-01-05 17:57:14

Sorry. I wanted to set it to positive review the first time. Wrong manipulation.


---

Comment by vdelecroix created at 2022-01-05 17:57:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2022-01-31 23:31:23

Resolution: fixed
