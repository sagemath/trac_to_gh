# Issue 10915: GAP interface doesn't handle input with multiple lines correctly

Issue created by migration from Trac.

Original creator: iandrus

Original creation time: 2011-03-23 19:39:47

Assignee: iandrus

Keywords: gap

The following GAP input (say in the notebook)

```
if 4>3 then
Print("You should see me.");
fi;
```

gets changed to 

```
if 4>3 thenPrint("You should see me.");fi;
```

before sending to GAP.  Obviously this fails since `thenPrint` should be two words.

It also doesn't strip comments correctly as can be seen by

```
## here is a comment
if 4>3 then
 Print("here");
fi
```

which returns nothing.


---

Attachment


---

Comment by iandrus created at 2011-03-23 21:00:53

Changing status from new to needs_review.


---

Comment by iandrus created at 2011-03-23 21:00:53

The reason they didn't send it all at once seems to be that the interface doesn't properly handle continuation prompts (it deletes enough characters for the whole prompt). Sending all on one line avoids them... except of course when it doesn't.  In particular something like

```
if true then
```

in the notebook will cause all sorts of unhappiness (3 characters cut off the end of the output) until a cell like 

```
fi
```

is evaluated.  Hopefully this should be fixed now.  We probably shouldn't worry too much about the above case since a similar cell with 

```
if false then
```

will simply cause everything to stop being evaluated until a closing cell is evaluated.  I don't see a way around this, and it should probably be considered user error.


---

Comment by kini created at 2011-03-25 15:45:38

I'm getting doctest errors in, I think, four files, but I stupidly didn't log them. Confirming...

(does this patch depend on any other patches? I'm running it on 4.7.alpha3)


---

Comment by kini created at 2011-03-25 17:31:22

... OK, I ran the test again.


```
The following tests failed:

        sage -t -long 4.7.alpha3-main/devel/sage-main/sage/interfaces/maxima.py # 4 doctests failed
        sage -t -long 4.7.alpha3-main/devel/sage-main/sage/tests/startup.py # 1 doctests failed
```


The startup.py failure is not important, and the maxima failure seems to remain even when I unapply your patch and rebuild, so I have no idea what's going on with that.


---

Comment by rbeezer created at 2011-03-25 17:58:11

This passes all tests for me, plus the two modules Kini mentioned above.  Parallel testing on 4.7.alpha1, 64-bit Ubuntu.


---

Comment by kini created at 2011-03-25 19:31:50

Changing status from needs_review to positive_review.


---

Comment by kini created at 2011-03-25 19:31:50

OK, looks all clear to me. Works as advertised, tested manually in the console too. Positive review. I guess the maxima thing is just something weird about alpha2 or alpha3, maybe specific to sage.math.washington.edu, since you guys are using alpha1.


---

Comment by jdemeyer created at 2011-04-07 08:38:18

Resolution: fixed
