# Issue 11237: Remove old notebook files

Issue created by migration from https://trac.sagemath.org/ticket/11409

Original creator: jdemeyer

Original creation time: 2011-05-31 08:57:48

Assignee: jason

CC:  fbissey was kini

Check whether the files in `SAGE_ROOT/devel/sage/sage/server/notebook` are still used.  If not, remove them.


---

Comment by jdemeyer created at 2011-06-07 15:12:39

Patch for local/bin


---

Attachment


---

Comment by jdemeyer created at 2011-06-09 16:56:59

Patch for SAGENB


---

Attachment


---

Comment by jdemeyer created at 2011-06-16 19:08:21

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2011-06-16 19:08:21

After applying the patches, running sdist, and then make from scratch, I get the following results:

```
$ cd $SAGE_ROOT
$ grep -e 'server.simple' -e 'server.notebook' -e 'server.introspect' -R .
Binary file ./devel/sage/.hg/store/data/doc/en/reference/notebook.rst.i matches
Binary file ./devel/sage/.hg/store/data/_m_a_n_i_f_e_s_t.in.i matches
Binary file ./devel/sage/.hg/store/00manifest.d matches
Binary file ./devel/sage-main/.hg/store/data/doc/en/reference/notebook.rst.i matches
Binary file ./devel/sage-main/.hg/store/data/_m_a_n_i_f_e_s_t.in.i matches
Binary file ./devel/sage-main/.hg/store/00manifest.d matches
./local/share/texmf/tex/generic/sagetex/remote-sagetex.dtx:% in \texttt{sage/server/simple/twist.py}.
```


This proves that the deleted files are no longer referenced (expect for a comment in SageTeX, this has been reported to Dan Drake).


---

Comment by jdemeyer created at 2011-06-16 19:08:34

Changing component from misc to notebook.


---

Comment by kcrisman created at 2011-06-23 03:29:54

Just as a comment, William made some reference at Sage Days 31 to a deprecation period and that these files were needed to enable people to migrate to the new notebook (not the really new flask notebook, nor the old new notebook, but the medium new separate sagenb notebook, I think).  I don't know how accurate that is, but thought I should mention it.


---

Comment by jdemeyer created at 2011-06-23 13:15:15

Replying to [comment:15 kcrisman]:
> Just as a comment, William made some reference at Sage Days 31 to a deprecation period and that these files were needed to enable people to migrate to the new notebook (not the really new flask notebook, nor the old new notebook, but the medium new separate sagenb notebook, I think).

How long should we wait then?  sagenb has existed at least since sage-4.2, released 25 october 2009 (almost 2 years ago).  I think that is sufficient time.


---

Comment by kcrisman created at 2011-06-23 13:21:41

That long, eh?  

Anyway, since he mentioned it, I figure it would be worth asking him, since he mentioned it.  Being a BDFL has its privileges :)  

To be fair, I don't feel like I can review this in any case; it would have to be someone pretty familiar with the mechanics of the change to sagenb.   But it would be really nice to take care of this, you are right.


---

Comment by jdemeyer created at 2011-07-24 11:41:00

Changing assignee from jason to jdemeyer.


---

Comment by jdemeyer created at 2011-07-24 11:41:00

Changing priority from major to critical.


---

Comment by kini created at 2011-12-25 07:34:43

This was mentioned on [sage-support](https://groups.google.com/d/topic/sage-support/o6jQfwSDI6k/discussion).


---

Comment by kcrisman created at 2012-02-10 18:18:07

From [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/7e2e94cc66d63cbf/78e24a6e39d2e413?show_docid=78e24a6e39d2e413#):

```

More importantly, it would be very useful if when we remove the code 
from devel/sage/sage/server that is needed to migrate, we include an 
error message that says: "Please migrate this Sage notebook server 
install by installing a version of Sage between 4.3 and 4.8, 
inclusive." 
Incidentally, I also plan to support the format of the sage notebook 
server files from 4.3 indefinitely.  It doesn't involve any version 
specific pickles, etc. 
 -- William 
```

So I guess something here about this.


---

Comment by kcrisman created at 2012-02-10 18:18:07

Changing status from needs_review to needs_work.


---

Comment by jdemeyer created at 2012-04-04 10:03:02

Rebased [attachment:11409.patch]


---

Comment by jdemeyer created at 2012-04-09 20:19:33

Misc changes


---

Attachment

Replying to [comment:20 kcrisman]:
> From [this sage-notebook thread](http://groups.google.com/group/sage-notebook/browse_thread/thread/7e2e94cc66d63cbf/78e24a6e39d2e413?show_docid=78e24a6e39d2e413#):
> {{{
> 
> More importantly, it would be very useful if when we remove the code 
> from devel/sage/sage/server that is needed to migrate, we include an 
> error message that says: "Please migrate this Sage notebook server 
> install by installing a version of Sage between 4.3 and 4.8, 
> inclusive." 
> Incidentally, I also plan to support the format of the sage notebook 
> server files from 4.3 indefinitely.  It doesn't involve any version 
> specific pickles, etc. 
>  -- William 
> }}}
> So I guess something here about this.

I'm not clear on what is required. Where would this error message appear? During an upgrade, or when running Sage? Or should we just add something to the top-level README file?


---

Comment by kcrisman created at 2012-04-12 02:11:26

I would imagine ideally on an upgrade (that is, attempting to use a too-new Sage with too-old notebook files) it would "detect" super-old notebook files somehow, perhaps because they ask to use these files?  The readme might be too subtle of a solution.


---

Comment by jdemeyer created at 2012-04-12 06:27:50

I think we should support the following situation:
 1. User has old version sage-x.y.z on his own laptop, runs Sage using the notebook interface.
 2. His worksheets are stored in `$DOT_SAGE`.
 3. He upgrades Sage to version 5.1 (either by `sage -upgrade` or just reinstalling from scratch).
 4. He starts up the new notebook.
 5. He finds his worksheets are still there.  Maybe some of his old code doesn't work anymore, but at least it should be there.

We should support this for as old versions as possible.


---

Comment by jdemeyer created at 2012-04-12 06:28:38

Another thing is opening `.sws` files, but William said that the format for these hasn't changed since long.  So that should be less of a worry.


---

Comment by jhpalmieri created at 2012-11-13 20:03:14

[See William's comment.](https://groups.google.com/d/topic/sage-devel/DZQuFd8Vb38/discussion) Shall we just delete the code now?


---

Comment by was created at 2012-11-14 15:33:40

Replying to [comment:27 jhpalmieri]:
> [See William's comment.](https://groups.google.com/d/topic/sage-devel/DZQuFd8Vb38/discussion) Shall we just delete the code now?

Yes!


---

Comment by ppurka created at 2012-11-14 16:14:28

Replying to [comment:28 was]:
> Replying to [comment:27 jhpalmieri]:
> > [See William's comment.](https://groups.google.com/d/topic/sage-devel/DZQuFd8Vb38/discussion) Shall we just delete the code now?
> 
> Yes!
I see a recursion here. ;)


---

Attachment

rebased version of "11409.patch"


---

Comment by jhpalmieri created at 2012-12-06 02:47:33

modification of 11409_scripts.patch


---

Attachment

I had to modify [attachment:11409_scripts.patch] to get `sage -n` to work.


---

Comment by jhpalmieri created at 2012-12-06 02:49:05

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2012-12-06 02:49:05

Given William's comment, I am marking this as "needs review".


---

Comment by jhpalmieri created at 2012-12-06 21:24:48

I have created a [pull request](https://github.com/sagemath/sagenb/pull/121) for the sagenb changes.


---

Comment by jhpalmieri created at 2012-12-08 05:45:32

I moved the scripts patch to #13794 and made that ticket a prerequisite for this one.


---

Comment by ppurka created at 2012-12-08 06:08:28

The patches (except the sagenb patch which doesn't apply to sagenb-main in 5.5rc0) + the changes in the pull request work. I tested interacts, plots, jmol and all of them are working.


---

Comment by kini created at 2013-03-22 02:53:25

ppurka: So, positive review? If so, I'll merge jhpalmieri's pull request and include it in #14330.


---

Comment by ppurka created at 2013-03-22 03:03:18

It *was* positive review from me a couple of months ago. I will check it again later today to see that nothing is broken.


---

Comment by ohanar created at 2013-04-02 21:19:39

Changing priority from critical to major.


---

Comment by kcrisman created at 2013-06-11 16:55:17

Note that jhpalmieri's pull request was indeed merged and might even be in Sage now, I think.


---

Comment by chapoton created at 2013-09-08 07:34:42

rebased on 5.12.beta4


---

Attachment

I have rebased the patch on 5.12.beta4

I had also to put back the import of alarm and cancel_alarm in server/misc.py

for the bot: apply only trac_11409-rebased-v2.patch


---

Comment by chapoton created at 2013-09-15 07:52:39

apply only trac_11409-rebased-v2.patch


---

Comment by chapoton created at 2013-10-19 12:41:10

hello, the bot is green, so there is an opportunity to review this now !


---

Comment by ppurka created at 2013-10-28 11:31:40

Changing status from needs_review to positive_review.


---

Comment by ppurka created at 2013-10-28 11:31:40

This looks fine to me. Irrespective of what the bot says, it applies just fine to 5.13.beta1. I tested 3D plots, 2D plots, debug() functionality, and interacts, and they are all working.


---

Attachment


---

Comment by jdemeyer created at 2013-10-28 22:21:53

Changing status from positive_review to needs_review.


---

Comment by ppurka created at 2013-10-29 00:05:29

Why didn't the patchbot catch this error earlier? I had only a laptop to run all doctests, so I was expecting the patchbot to report any such problems.


---

Comment by jdemeyer created at 2013-10-29 11:12:31

Replying to [comment:46 ppurka]:
> Why didn't the patchbot catch this error earlier? I had only a laptop to run all doctests, so I was expecting the patchbot to report any such problems.
I guess the patchbot doesn't understand the "apply" instruction

```
cd sage/server && hg remove introspect.py notebook simple && hg commit -m "Trac #11409: Remove old notebook files
```



---

Comment by ppurka created at 2013-10-29 11:14:06

Sorry, the new patch actually introduces the doctest failure. I still get the old result in my copy of 5.13.beta1.


---

Comment by jdemeyer created at 2013-10-29 11:16:43

Replying to [comment:48 ppurka]:
> I still get the old result in my copy of 5.13.beta1.
Did you actually *remove* the old notebook files?


---

Comment by ppurka created at 2013-10-29 12:00:00

Replying to [comment:49 jdemeyer]:
> Did you actually *remove* the old notebook files?
Thanks! I rechecked everything in the notebook after trying this. It works fine, and also doctests fine.


---

Comment by ppurka created at 2013-10-29 12:00:00

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2013-10-31 19:15:55

Resolution: fixed
