# Issue 13997: During upgrade to sage 5.7 ppl is using gmpxx headers from the system

archive/issues_013997.json:
```json
{
    "body": "Assignee: tbd\n\nCC:  vbraun dimpase\n\nThis is a problem reported by user Pong on sage-devel [https://groups.google.com/forum/?hl=en&fromgroups=#!topic/sage-devel/iVudo_7dSFU](https://groups.google.com/forum/?hl=en&fromgroups=#!topic/sage-devel/iVudo_7dSFU)\nFrom hi failure log it appears that ppl tries to use the system gmpxx headers. which in this case is from gmp 5.1.0 which is imcompatible with this version ppl see [https://bugs.gentoo.org/show_bug.cgi?id=447928](https://bugs.gentoo.org/show_bug.cgi?id=447928) for example:\n\n```\nmake[5]: Entering directory `/home/pong/sage-current/spkg/build/ppl-0.11.2.p1/src/src'\n/bin/sh ../libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I..  -I.. -I../src    -g -O2 -frounding-math  -I/home/pong/sage-current/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c -o Box.lo Box.cc\nlibtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -I.. -I../src -g -O2 -frounding-math -I/home/pong/sage-current/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c Box.cc  -fPIC -DPIC -o .libs/Box.o\nIn file included from checked.defs.hh:29:0,\n                 from Checked_Number.defs.hh:28,\n                 from Coefficient.types.hh:16,\n                 from Coefficient.defs.hh:27,\n                 from Box.defs.hh:29,\n                 from Box.cc:25:\nmp_std_bits.defs.hh:48:7: error: redefinition of 'class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >'\n/usr/include/gmpxx.h:3269:21: error: previous definition of 'class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >'\nmp_std_bits.defs.hh:109:7: error: redefinition of 'class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >'\n/usr/include/gmpxx.h:3306:21: error: previous definition of 'class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >'\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/14201\n\n",
    "created_at": "2013-02-27T22:12:37Z",
    "labels": [
        "packages: standard",
        "major",
        "bug"
    ],
    "title": "During upgrade to sage 5.7 ppl is using gmpxx headers from the system",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/13997",
    "user": "fbissey"
}
```
Assignee: tbd

CC:  vbraun dimpase

This is a problem reported by user Pong on sage-devel [https://groups.google.com/forum/?hl=en&fromgroups=#!topic/sage-devel/iVudo_7dSFU](https://groups.google.com/forum/?hl=en&fromgroups=#!topic/sage-devel/iVudo_7dSFU)
From hi failure log it appears that ppl tries to use the system gmpxx headers. which in this case is from gmp 5.1.0 which is imcompatible with this version ppl see [https://bugs.gentoo.org/show_bug.cgi?id=447928](https://bugs.gentoo.org/show_bug.cgi?id=447928) for example:

```
make[5]: Entering directory `/home/pong/sage-current/spkg/build/ppl-0.11.2.p1/src/src'
/bin/sh ../libtool  --tag=CXX   --mode=compile g++ -DHAVE_CONFIG_H -I. -I..  -I.. -I../src    -g -O2 -frounding-math  -I/home/pong/sage-current/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c -o Box.lo Box.cc
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -I.. -I../src -g -O2 -frounding-math -I/home/pong/sage-current/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c Box.cc  -fPIC -DPIC -o .libs/Box.o
In file included from checked.defs.hh:29:0,
                 from Checked_Number.defs.hh:28,
                 from Coefficient.types.hh:16,
                 from Coefficient.defs.hh:27,
                 from Box.defs.hh:29,
                 from Box.cc:25:
mp_std_bits.defs.hh:48:7: error: redefinition of 'class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >'
/usr/include/gmpxx.h:3269:21: error: previous definition of 'class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >'
mp_std_bits.defs.hh:109:7: error: redefinition of 'class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >'
/usr/include/gmpxx.h:3306:21: error: previous definition of 'class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >'
```


Issue created by migration from https://trac.sagemath.org/ticket/14201





---

archive/issue_comments_174735.json:
```json
{
    "body": "Is it possible to ask SAGE to sage to use other headers during compilation? If so, I will try to fix this issue but need some pointers to start.\nAs Fran\u00e7ois said, looks like the spkg-install file already export flags to instruct SAGE to look for the libraries that comes with SAGE instead of those system-wide. What else should I look for?",
    "created_at": "2013-03-02T16:35:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174735",
    "user": "pong"
}
```

Is it possible to ask SAGE to sage to use other headers during compilation? If so, I will try to fix this issue but need some pointers to start.
As François said, looks like the spkg-install file already export flags to instruct SAGE to look for the libraries that comes with SAGE instead of those system-wide. What else should I look for?



---

archive/issue_comments_174736.json:
```json
{
    "body": "I've made a new spkg with the latest upstream version and am setting the `--with-gmp-include` configure option. Let us know if that fixes the issue!",
    "created_at": "2013-03-02T17:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174736",
    "user": "vbraun"
}
```

I've made a new spkg with the latest upstream version and am setting the `--with-gmp-include` configure option. Let us know if that fixes the issue!



---

archive/issue_comments_174737.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2013-03-02T17:35:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174737",
    "user": "vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_174738.json:
```json
{
    "body": "Attachment [trac_14201_ppl_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket14201/trac_14201_ppl_doctest_fixes.patch) by vbraun created at 2013-03-02 18:06:50\n\nInitial patch",
    "created_at": "2013-03-02T18:06:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174738",
    "user": "vbraun"
}
```

Attachment [trac_14201_ppl_doctest_fixes.patch](tarball://root/attachments/some-uuid/ticket14201/trac_14201_ppl_doctest_fixes.patch) by vbraun created at 2013-03-02 18:06:50

Initial patch



---

archive/issue_comments_174739.json:
```json
{
    "body": "I need some help in checking the new package. What I did is simply replace the old ppl spkg with the new one in \n$SAGE_LOCAL/spkg/standard then rerun sage -upgrade. It result in an error as well.\n\nI tried to apply to patch however, the way I know is by issuing hg_sage.patch('filename') inside sage but since I don't have a running copy of sage on the machine. I'm lost. How can I (or do I need to) apply the patch using my system hg instead?\n\nAlso I make myself a reviewer.",
    "created_at": "2013-03-03T00:33:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174739",
    "user": "pong"
}
```

I need some help in checking the new package. What I did is simply replace the old ppl spkg with the new one in 
$SAGE_LOCAL/spkg/standard then rerun sage -upgrade. It result in an error as well.

I tried to apply to patch however, the way I know is by issuing hg_sage.patch('filename') inside sage but since I don't have a running copy of sage on the machine. I'm lost. How can I (or do I need to) apply the patch using my system hg instead?

Also I make myself a reviewer.



---

archive/issue_comments_174740.json:
```json
{
    "body": "Now I am rebuilding sage. Will report the result.",
    "created_at": "2013-03-03T00:36:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174740",
    "user": "pong"
}
```

Now I am rebuilding sage. Will report the result.



---

archive/issue_comments_174741.json:
```json
{
    "body": "Perhaps I screwed somthing up earlier, sage -b results in errors as well. \n\n\n```\nIn file included from sage/libs/ppl.cpp:264:0:\n/home/pong/sage-current/local/include/ppl.hh:3687:7: error: redefinition of \u2018class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >\u2019\n/usr/include/gmpxx.h:3269:21: error: previous definition of \u2018class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >\u2019\n/home/pong/sage-current/local/include/ppl.hh:3748:7: error: redefinition of \u2018class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >\u2019\n/usr/include/gmpxx.h:3306:21: error: previous definition of \u2018class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >\u2019\nerror: command 'gcc' failed with exit status 1\ngcc -fno-strict-aliasing -fwrapv -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/home/pong/sage-current/local/include -I/home/pong/sage-current/local/include/csage -I/home/pong/sage-current/devel/sage/sage/ext -I/home/pong/sage-current/local/include/python2.7 -c sage/libs/ratpoints.c -o build/temp.linux-x86_64-2.7/sage/libs/ratpoints.o -w\nError installing modified sage library code.\n```\n\n\nCan I get some instructions on how to start over again?",
    "created_at": "2013-03-03T00:54:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174741",
    "user": "pong"
}
```

Perhaps I screwed somthing up earlier, sage -b results in errors as well. 


```
In file included from sage/libs/ppl.cpp:264:0:
/home/pong/sage-current/local/include/ppl.hh:3687:7: error: redefinition of ‘class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >’
/usr/include/gmpxx.h:3269:21: error: previous definition of ‘class std::numeric_limits<__gmp_expr<__mpz_struct [1], __mpz_struct [1]> >’
/home/pong/sage-current/local/include/ppl.hh:3748:7: error: redefinition of ‘class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >’
/usr/include/gmpxx.h:3306:21: error: previous definition of ‘class std::numeric_limits<__gmp_expr<__mpq_struct [1], __mpq_struct [1]> >’
error: command 'gcc' failed with exit status 1
gcc -fno-strict-aliasing -fwrapv -DNDEBUG -g -fwrapv -O3 -Wall -Wstrict-prototypes -fPIC -I/home/pong/sage-current/local/include -I/home/pong/sage-current/local/include/csage -I/home/pong/sage-current/devel/sage/sage/ext -I/home/pong/sage-current/local/include/python2.7 -c sage/libs/ratpoints.c -o build/temp.linux-x86_64-2.7/sage/libs/ratpoints.o -w
Error installing modified sage library code.
```


Can I get some instructions on how to start over again?



---

archive/issue_comments_174742.json:
```json
{
    "body": "pong, can you post the ppl build log? To install the spkg you just need \n\n```\nsage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg\n```\n",
    "created_at": "2013-03-03T07:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174742",
    "user": "vbraun"
}
```

pong, can you post the ppl build log? To install the spkg you just need 

```
sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg
```




---

archive/issue_comments_174743.json:
```json
{
    "body": "For the record, the compilation of `Box.o` in my log used\n\n```\nlibtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -I.. -I../src -I/home/vbraun/opt/sage-5.8.beta2/local/include -g -O2 -frounding-math -I/home/vbraun/opt/sage-5.8.beta2/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c Box.cc  -fPIC -DPIC -o .libs/Box.o\n```\n\nwhich has the correct header path.",
    "created_at": "2013-03-03T08:03:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174743",
    "user": "vbraun"
}
```

For the record, the compilation of `Box.o` in my log used

```
libtool: compile:  g++ -DHAVE_CONFIG_H -I. -I.. -I.. -I../src -I/home/vbraun/opt/sage-5.8.beta2/local/include -g -O2 -frounding-math -I/home/vbraun/opt/sage-5.8.beta2/local/include -W -Wall -MT Box.lo -MD -MP -MF .deps/Box.Tpo -c Box.cc  -fPIC -DPIC -o .libs/Box.o
```

which has the correct header path.



---

archive/issue_comments_174744.json:
```json
{
    "body": "Just to make sure Volker, do you have the gmp 5.1 headers from your system installed? It strikes me that this problem wouldn't be apparent on most distributions because the headers are not installed by default.\n\nI think if you don't have the headers installed it may be a good idea to try with a fake header in /usr/include that would stop the compilation.",
    "created_at": "2013-03-03T08:13:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174744",
    "user": "fbissey"
}
```

Just to make sure Volker, do you have the gmp 5.1 headers from your system installed? It strikes me that this problem wouldn't be apparent on most distributions because the headers are not installed by default.

I think if you don't have the headers installed it may be a good idea to try with a fake header in /usr/include that would stop the compilation.



---

archive/issue_comments_174745.json:
```json
{
    "body": "Attachment [ppl-1.0.log](tarball://root/attachments/some-uuid/ticket14201/ppl-1.0.log) by pong created at 2013-03-03 22:32:59",
    "created_at": "2013-03-03T22:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174745",
    "user": "pong"
}
```

Attachment [ppl-1.0.log](tarball://root/attachments/some-uuid/ticket14201/ppl-1.0.log) by pong created at 2013-03-03 22:32:59



---

archive/issue_comments_174746.json:
```json
{
    "body": "Hi Volker, unfortunately I got the same error message after issuing\n\n```\nsage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg\n```\n\n\nPlease see the attached log for details.",
    "created_at": "2013-03-03T22:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174746",
    "user": "pong"
}
```

Hi Volker, unfortunately I got the same error message after issuing

```
sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg
```


Please see the attached log for details.



---

archive/issue_comments_174747.json:
```json
{
    "body": "Could you attach config.log (possibly compressed as it may be very big) from /home/pong/sage-current/spkg/build/ppl-1.0/src/ ?",
    "created_at": "2013-03-03T22:40:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174747",
    "user": "fbissey"
}
```

Could you attach config.log (possibly compressed as it may be very big) from /home/pong/sage-current/spkg/build/ppl-1.0/src/ ?



---

archive/issue_comments_174748.json:
```json
{
    "body": "Attachment [config.log.gz](tarball://root/attachments/some-uuid/ticket14201/config.log.gz) by pong created at 2013-03-03 23:03:38\n\nAttached. Hope that helps.",
    "created_at": "2013-03-03T23:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174748",
    "user": "pong"
}
```

Attachment [config.log.gz](tarball://root/attachments/some-uuid/ticket14201/config.log.gz) by pong created at 2013-03-03 23:03:38

Attached. Hope that helps.



---

archive/issue_comments_174749.json:
```json
{
    "body": "Not really much of interest unfortunately apart from this bit which means we may have to think about doing something extra about mpir\n\n```\nconfigure:9491: checking for the GMP library version 4.1.3 or above\nconfigure:9580: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5\n/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11\nconfigure:9580: $? = 0\nconfigure:9580: ./conftest\nconfigure:9580: $? = 0\nconfigure:9581: result: yes\nconfigure:9603: checking size of mp_limb_t\nconfigure:9608: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5\n/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11\nconfigure:9608: $? = 0\nconfigure:9608: ./conftest\nconfigure:9608: $? = 0\nconfigure:9623: result: 8\nconfigure:9634: checking whether GMP has been compiled with support for exceptions\nconfigure:9674: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5\n/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11\nconfigure:9674: $? = 0\nconfigure:9674: ./conftest\nconfigure:9674: $? = 0\nconfigure:9675: result: yes\nconfigure:9736: checking for __mpz_struct._mp_alloc\nconfigure:9736: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5\nconfigure:9736: $? = 0\nconfigure:9736: result: yes\nconfigure:9748: checking for __mpz_struct._mp_size\nconfigure:9748: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5\nconfigure:9748: $? = 0\nconfigure:9748: result: yes\nconfigure:9760: checking for __mpz_struct._mp_d\nconfigure:9760: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5\nconfigure:9760: $? = 0\nconfigure:9760: result: yes\n```\n\nWe will have to bit the bullet and dissect configure.ac.",
    "created_at": "2013-03-03T23:17:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174749",
    "user": "fbissey"
}
```

Not really much of interest unfortunately apart from this bit which means we may have to think about doing something extra about mpir

```
configure:9491: checking for the GMP library version 4.1.3 or above
configure:9580: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5
/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11
configure:9580: $? = 0
configure:9580: ./conftest
configure:9580: $? = 0
configure:9581: result: yes
configure:9603: checking size of mp_limb_t
configure:9608: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5
/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11
configure:9608: $? = 0
configure:9608: ./conftest
configure:9608: $? = 0
configure:9623: result: 8
configure:9634: checking whether GMP has been compiled with support for exceptions
configure:9674: g++ -o conftest  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  -I/home/pong/sage-current/local/include  -L/home/pong/sage-current/local/lib conftest.cpp  -L/home/pong/sage-current/local/lib -lgmpxx -lgmp >&5
/usr/bin/ld: warning: libgmp.so.7, needed by /home/pong/sage-current/local/lib/libgmpxx.so, may conflict with libgmp.so.11
configure:9674: $? = 0
configure:9674: ./conftest
configure:9674: $? = 0
configure:9675: result: yes
configure:9736: checking for __mpz_struct._mp_alloc
configure:9736: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5
configure:9736: $? = 0
configure:9736: result: yes
configure:9748: checking for __mpz_struct._mp_size
configure:9748: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5
configure:9748: $? = 0
configure:9748: result: yes
configure:9760: checking for __mpz_struct._mp_d
configure:9760: g++ -c  -g -O2 -frounding-math  -I/home/pong/sage-current/local/include  conftest.cpp >&5
configure:9760: $? = 0
configure:9760: result: yes
```

We will have to bit the bullet and dissect configure.ac.



---

archive/issue_comments_174750.json:
```json
{
    "body": "Stupid questions:\n 1) why are you using sage's gcc and not your distro's compiler?\n 2) Is the file /home/pong/sage-current/local/include/gmpxx.h present?",
    "created_at": "2013-03-04T01:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174750",
    "user": "fbissey"
}
```

Stupid questions:
 1) why are you using sage's gcc and not your distro's compiler?
 2) Is the file /home/pong/sage-current/local/include/gmpxx.h present?



---

archive/issue_comments_174751.json:
```json
{
    "body": "Hi Fran\u00e7ois,\n\n    1) I don't even know that SAGE is not using my distro gcc. I just type sage -upgrade or sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg\n        \n        How can I force sage to use the system gcc?\n\n     2) gmpxx.h is not present in /home/pong/sage-current/local/include/\n         (only gmp.h is there).",
    "created_at": "2013-03-04T02:11:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174751",
    "user": "pong"
}
```

Hi François,

    1) I don't even know that SAGE is not using my distro gcc. I just type sage -upgrade or sage -f http://www.stp.dias.ie/~vbraun/Sage/spkg/ppl-1.0.spkg
        
        How can I force sage to use the system gcc?

     2) gmpxx.h is not present in /home/pong/sage-current/local/include/
         (only gmp.h is there).



---

archive/issue_comments_174752.json:
```json
{
    "body": "Jackpot. So the upgrade of mpir must have been messed up. We would need to look at mpir-2.6.0.p0.log.",
    "created_at": "2013-03-04T02:50:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174752",
    "user": "fbissey"
}
```

Jackpot. So the upgrade of mpir must have been messed up. We would need to look at mpir-2.6.0.p0.log.



---

archive/issue_comments_174753.json:
```json
{
    "body": "Attachment [mpir-2.6.0.p0.log.gz](tarball://root/attachments/some-uuid/ticket14201/mpir-2.6.0.p0.log.gz) by pong created at 2013-03-04 06:21:50",
    "created_at": "2013-03-04T06:21:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174753",
    "user": "pong"
}
```

Attachment [mpir-2.6.0.p0.log.gz](tarball://root/attachments/some-uuid/ticket14201/mpir-2.6.0.p0.log.gz) by pong created at 2013-03-04 06:21:50



---

archive/issue_comments_174754.json:
```json
{
    "body": "Okay attached. See if you and/or Volker can locate the problem.",
    "created_at": "2013-03-04T06:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174754",
    "user": "pong"
}
```

Okay attached. See if you and/or Volker can locate the problem.



---

archive/issue_comments_174755.json:
```json
{
    "body": "Ouch\n\n```\nConfiguring MPIR with the following options:\n    --prefix=\"/home/pong/sage-current/local\" --libdir=\"/home/pong/sage-current/local/lib\" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static\n```\n\ncxx is disabled... Investigating the mpir spkg. Can you try to reinstall mpir and see if it install the gmpxx.h headers this time?",
    "created_at": "2013-03-04T08:26:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174755",
    "user": "fbissey"
}
```

Ouch

```
Configuring MPIR with the following options:
    --prefix="/home/pong/sage-current/local" --libdir="/home/pong/sage-current/local/lib" --enable-gmpcompat --enable-shared  --disable-cxx --disable-static
```

cxx is disabled... Investigating the mpir spkg. Can you try to reinstall mpir and see if it install the gmpxx.h headers this time?



---

archive/issue_comments_174756.json:
```json
{
    "body": "OK I think I have a chain of events. mpir is built with \"--disable-cxx\" when you upgrade the toolchain (in other words gcc). So mpir got built without c++ support to upgrade gcc. Once gcc was done it should have rebuild mpir with c++ support enabled. It didn't happen - instead the build moved on to other things until it came to ppl where the lack of c++ headers from sage meant that it looked for headers in system location leading to the point this report has been filled.\n\nIt is likely that on another distro the following would have happened:\n\n1) gmp headers of an appropriate version are installed and the build proceed with a mismatch between libgmp and libgmpxx and no one is the wiser when something breaks at run time if any.\n\n2) No headers are installed and the problem is easily spotted as a lack of headers.\n\nI wonder if that tell us something about the number of people running sage with gmp headers installed. Of course the problem can only occur during an upgrade.\n\nPong, just rebuilding mpir should solve the problem.",
    "created_at": "2013-03-04T08:40:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174756",
    "user": "fbissey"
}
```

OK I think I have a chain of events. mpir is built with "--disable-cxx" when you upgrade the toolchain (in other words gcc). So mpir got built without c++ support to upgrade gcc. Once gcc was done it should have rebuild mpir with c++ support enabled. It didn't happen - instead the build moved on to other things until it came to ppl where the lack of c++ headers from sage meant that it looked for headers in system location leading to the point this report has been filled.

It is likely that on another distro the following would have happened:

1) gmp headers of an appropriate version are installed and the build proceed with a mismatch between libgmp and libgmpxx and no one is the wiser when something breaks at run time if any.

2) No headers are installed and the problem is easily spotted as a lack of headers.

I wonder if that tell us something about the number of people running sage with gmp headers installed. Of course the problem can only occur during an upgrade.

Pong, just rebuilding mpir should solve the problem.



---

archive/issue_comments_174757.json:
```json
{
    "body": "Ok, I think you have located the problem. After issuing\n\n```\n sage -f mpir-2.6.0.p0.spkg\n```\n\ngmpxx.h appears in /home/pong/sage-current/local/include\n\nI have one more question, now should I rebuild will ppl-1.0.spkg or with ppl-0.11.2.p1.spkg? I wonder if I rebuild with ppl-1.0 will that affects my next upgrade (since it may still be a newer version of ppl for the next release of sage).",
    "created_at": "2013-03-04T16:01:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174757",
    "user": "pong"
}
```

Ok, I think you have located the problem. After issuing

```
 sage -f mpir-2.6.0.p0.spkg
```

gmpxx.h appears in /home/pong/sage-current/local/include

I have one more question, now should I rebuild will ppl-1.0.spkg or with ppl-0.11.2.p1.spkg? I wonder if I rebuild with ppl-1.0 will that affects my next upgrade (since it may still be a newer version of ppl for the next release of sage).



---

archive/issue_comments_174758.json:
```json
{
    "body": "Ok, I have rebuilt SAGE and everything seem working. Thanks to Volker, it has ppl-1.0 now. However, I don't think I have applied the patch.\n\nShall we consider closing the ticket?",
    "created_at": "2013-03-05T17:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174758",
    "user": "pong"
}
```

Ok, I have rebuilt SAGE and everything seem working. Thanks to Volker, it has ppl-1.0 now. However, I don't think I have applied the patch.

Shall we consider closing the ticket?



---

archive/issue_comments_174759.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2013-03-05T17:26:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174759",
    "user": "pong"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_174760.json:
```json
{
    "body": "Replying to [comment:19 fbissey]:\n> Once gcc was done it should have rebuild mpir with c++ support enabled. It didn't happen\n\nThere is still the question of why. One possibility is that the build of GCC got interrupted and left in a partially installed state (enough to make `spkg/install` think that GCC is installed).",
    "created_at": "2013-03-05T17:58:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174760",
    "user": "jdemeyer"
}
```

Replying to [comment:19 fbissey]:
> Once gcc was done it should have rebuild mpir with c++ support enabled. It didn't happen

There is still the question of why. One possibility is that the build of GCC got interrupted and left in a partially installed state (enough to make `spkg/install` think that GCC is installed).



---

archive/issue_comments_174761.json:
```json
{
    "body": "pong: could you also attach `spkg/logs/gcc-4.6.3.log`",
    "created_at": "2013-03-05T17:58:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174761",
    "user": "jdemeyer"
}
```

pong: could you also attach `spkg/logs/gcc-4.6.3.log`



---

archive/issue_comments_174762.json:
```json
{
    "body": "I made #14232 for the PPL update since we probably want to do that anyways.",
    "created_at": "2013-03-05T18:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174762",
    "user": "vbraun"
}
```

I made #14232 for the PPL update since we probably want to do that anyways.



---

archive/issue_comments_174763.json:
```json
{
    "body": "Attachment [gcc-4.6.3.log.gz](tarball://root/attachments/some-uuid/ticket14201/gcc-4.6.3.log.gz) by pong created at 2013-03-06 00:29:10\n\nJust uploaded my gcc-4.6.3 log",
    "created_at": "2013-03-06T00:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174763",
    "user": "pong"
}
```

Attachment [gcc-4.6.3.log.gz](tarball://root/attachments/some-uuid/ticket14201/gcc-4.6.3.log.gz) by pong created at 2013-03-06 00:29:10

Just uploaded my gcc-4.6.3 log



---

archive/issue_comments_174764.json:
```json
{
    "body": "OK, so for some reason GCC managed to build at first, but then GCC was reinstalled and it failed the second time.  I mainly wonder why GCC was installed more than once.\n\npong: maybe you should also upload your top-level `install.log` file, hopefully that will clear things up",
    "created_at": "2013-03-06T10:42:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174764",
    "user": "jdemeyer"
}
```

OK, so for some reason GCC managed to build at first, but then GCC was reinstalled and it failed the second time.  I mainly wonder why GCC was installed more than once.

pong: maybe you should also upload your top-level `install.log` file, hopefully that will clear things up



---

archive/issue_comments_174765.json:
```json
{
    "body": "Attachment [install.log.gz](tarball://root/attachments/some-uuid/ticket14201/install.log.gz) by pong created at 2013-03-06 16:44:26",
    "created_at": "2013-03-06T16:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174765",
    "user": "pong"
}
```

Attachment [install.log.gz](tarball://root/attachments/some-uuid/ticket14201/install.log.gz) by pong created at 2013-03-06 16:44:26



---

archive/issue_comments_174766.json:
```json
{
    "body": "Here is my install.log. I've just browsed through it... I'm puzzled by a \"jump\" of dates towards to end when the dealing with ppl. What does this file actually log?\n\nWho knows, I might have screwed things up between various sage -upgrade, sage -b and sage -f...\nHowever, I should point out that after I rebuilt mpir (so that gmpxx.h is in the local directory), the first run of sage -upgrade (or sage -b), I forgot which one I issued, still failed. It's the second run that fixed everything.",
    "created_at": "2013-03-06T16:53:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174766",
    "user": "pong"
}
```

Here is my install.log. I've just browsed through it... I'm puzzled by a "jump" of dates towards to end when the dealing with ppl. What does this file actually log?

Who knows, I might have screwed things up between various sage -upgrade, sage -b and sage -f...
However, I should point out that after I rebuilt mpir (so that gmpxx.h is in the local directory), the first run of sage -upgrade (or sage -b), I forgot which one I issued, still failed. It's the second run that fixed everything.



---

archive/issue_comments_174767.json:
```json
{
    "body": "It's hard to reproduce exactly what happened post-mortem. I don't understand why I don't see the GCC build in the `install.log` for example.\n\nI'd say let's close this ticket as \"invalid\".",
    "created_at": "2013-03-06T20:30:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174767",
    "user": "jdemeyer"
}
```

It's hard to reproduce exactly what happened post-mortem. I don't understand why I don't see the GCC build in the `install.log` for example.

I'd say let's close this ticket as "invalid".



---

archive/issue_comments_174768.json:
```json
{
    "body": "I agree. Let's close this ticket as \"invalid\".\nThanks for everyone's help.",
    "created_at": "2013-03-06T21:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174768",
    "user": "pong"
}
```

I agree. Let's close this ticket as "invalid".
Thanks for everyone's help.



---

archive/issue_comments_174769.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2013-03-07T08:23:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/13997",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/13997#issuecomment-174769",
    "user": "jdemeyer"
}
```

Resolution: invalid
