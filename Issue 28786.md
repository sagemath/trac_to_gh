# Issue 28786: In a python 3 build, use system Python packages

archive/issues_028786.json:
```json
{
    "body": "CC:  @tobihan tmonteil @orlitzky @timokau @kiwifb @isuruf @mezzarobba @embray @dimpase @thierry-freebsd @dkwo\n\nThis is a followup on \n- #29013: In a python3 build, install all Python packages into a venv\n- #27824: `spkg-configure.m4` for python3\n\nIn the next step, we enable use of system site packages.\n\nIssue created by migration from https://trac.sagemath.org/ticket/29023\n\n",
    "created_at": "2020-01-15T23:48:55Z",
    "labels": [
        "packages: standard",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "In a python 3 build, use system Python packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/28786",
    "user": "@mkoeppe"
}
```
CC:  @tobihan tmonteil @orlitzky @timokau @kiwifb @isuruf @mezzarobba @embray @dimpase @thierry-freebsd @dkwo

This is a followup on 
- #29013: In a python3 build, install all Python packages into a venv
- #27824: `spkg-configure.m4` for python3

In the next step, we enable use of system site packages.

Issue created by migration from https://trac.sagemath.org/ticket/29023





---

archive/issue_comments_406629.json:
```json
{
    "body": "I think there should be an option to disable the use of system packages. Sage's installation is already compilcated enough and I don't want a faulty package to mess up sage.",
    "created_at": "2020-04-05T18:21:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406629",
    "user": "@Volker-Weissmann"
}
```

I think there should be an option to disable the use of system packages. Sage's installation is already compilcated enough and I don't want a faulty package to mess up sage.



---

archive/issue_comments_406630.json:
```json
{
    "body": "You can already do `./configure --with-system-python3=no` to avoid using the system's Python. Are you asking for something which allows the use of the system Python but not the system Python packages? Is it likely that there will be a good system Python installation which has faulty Python packages?",
    "created_at": "2020-04-05T18:27:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406630",
    "user": "@jhpalmieri"
}
```

You can already do `./configure --with-system-python3=no` to avoid using the system's Python. Are you asking for something which allows the use of the system Python but not the system Python packages? Is it likely that there will be a good system Python installation which has faulty Python packages?



---

archive/issue_comments_406631.json:
```json
{
    "body": "I just found out about the ./configure --help option. --with-system-python3 is actually exactly what I meant.",
    "created_at": "2020-04-05T18:32:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406631",
    "user": "@Volker-Weissmann"
}
```

I just found out about the ./configure --help option. --with-system-python3 is actually exactly what I meant.



---

archive/issue_comments_406632.json:
```json
{
    "body": "Replying to [comment:1 gh-Volker-Weissmann]:\n> I think there should be an option to disable the use of system packages. Sage's installation is already compilcated enough and I don't want a faulty package to mess up sage.\nThanks for the input. I've updated the ticket description.",
    "created_at": "2020-04-05T20:10:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406632",
    "user": "@mkoeppe"
}
```

Replying to [comment:1 gh-Volker-Weissmann]:
> I think there should be an option to disable the use of system packages. Sage's installation is already compilcated enough and I don't want a faulty package to mess up sage.
Thanks for the input. I've updated the ticket description.



---

archive/issue_comments_406633.json:
```json
{
    "body": "I think once python system packages are detected, the spkg-configure mechanism becomes interesting for packagers. Looking forward to this change.",
    "created_at": "2020-04-17T06:46:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406633",
    "user": "@tobihan"
}
```

I think once python system packages are detected, the spkg-configure mechanism becomes interesting for packagers. Looking forward to this change.



---

archive/issue_comments_406634.json:
```json
{
    "body": "I don't think python packages would be handled through spkg-configure. \nI think it's better to turn sagelib into a pip-installable package and provide standard prereq information -- see #29041 (at ./bootstrap time, generate src/requirements.txt, src/constraints.txt, src/setup.cfg [install_requires] from build/pkgs)",
    "created_at": "2020-04-17T18:49:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406634",
    "user": "@mkoeppe"
}
```

I don't think python packages would be handled through spkg-configure. 
I think it's better to turn sagelib into a pip-installable package and provide standard prereq information -- see #29041 (at ./bootstrap time, generate src/requirements.txt, src/constraints.txt, src/setup.cfg [install_requires] from build/pkgs)



---

archive/issue_comments_406635.json:
```json
{
    "body": "I tried to create an experimental `spkg-configure.m4` for cvxopt in #29665, and it seems OK for me. Any comments?",
    "created_at": "2020-05-08T14:48:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406635",
    "user": "@thierry-FreeBSD"
}
```

I tried to create an experimental `spkg-configure.m4` for cvxopt in #29665, and it seems OK for me. Any comments?



---

archive/issue_comments_406636.json:
```json
{
    "body": "If you take look at sage-env you see the line \n\nPYTHONUSERBASE=\"$DOT_SAGE/local\"\n\nbut I think it should be\n\nPYTHONUSERBASE=\"$SAGE_ROOT/local\"\n\n, because (at least on my machine) the folder $DOT_SAGE/local does not exist.",
    "created_at": "2020-05-08T14:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406636",
    "user": "@Volker-Weissmann"
}
```

If you take look at sage-env you see the line 

PYTHONUSERBASE="$DOT_SAGE/local"

but I think it should be

PYTHONUSERBASE="$SAGE_ROOT/local"

, because (at least on my machine) the folder $DOT_SAGE/local does not exist.



---

archive/issue_comments_406637.json:
```json
{
    "body": "The way to enable system site packages is to use `--system-site-packages` when creating the venv.\n\nUsing PYTHONUSERBASE is not a suitable way forward.",
    "created_at": "2020-05-08T14:59:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406637",
    "user": "@mkoeppe"
}
```

The way to enable system site packages is to use `--system-site-packages` when creating the venv.

Using PYTHONUSERBASE is not a suitable way forward.



---

archive/issue_comments_406638.json:
```json
{
    "body": "(And neither is an ad-hoc modification of PYTHONPATH proposed in #29665.)",
    "created_at": "2020-05-08T14:59:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406638",
    "user": "@mkoeppe"
}
```

(And neither is an ad-hoc modification of PYTHONPATH proposed in #29665.)



---

archive/issue_comments_406639.json:
```json
{
    "body": "Replying to [comment:10 gh-Volker-Weissmann]:\n> the folder $DOT_SAGE/local does not exist.\n\nUsers create this folder if they want to install user packages, for example using `sage -pip install --user ...`",
    "created_at": "2020-05-08T15:06:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406639",
    "user": "@mkoeppe"
}
```

Replying to [comment:10 gh-Volker-Weissmann]:
> the folder $DOT_SAGE/local does not exist.

Users create this folder if they want to install user packages, for example using `sage -pip install --user ...`



---

archive/issue_comments_406640.json:
```json
{
    "body": "Ok. Thank you. I thought it was a bug. But this means that if you run\n\nsudo pip uninstall cython\npip install cython\n\ncou can't build sage.",
    "created_at": "2020-05-08T15:14:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406640",
    "user": "@Volker-Weissmann"
}
```

Ok. Thank you. I thought it was a bug. But this means that if you run

sudo pip uninstall cython
pip install cython

cou can't build sage.



---

archive/issue_comments_406641.json:
```json
{
    "body": "Well, isolating the Sage user installation scheme from the Python user installation scheme was done deliberately in the past to avoid possible breakage by incompatible installations.\n\nThis decision may have to be revisited at some point, but I don't think it's necessary for this ticket. \n\nSage's install scripts will continue to make sure that the Sage venv has all necessary packages - whether user of system site packages is enabled or not.",
    "created_at": "2020-05-08T15:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406641",
    "user": "@mkoeppe"
}
```

Well, isolating the Sage user installation scheme from the Python user installation scheme was done deliberately in the past to avoid possible breakage by incompatible installations.

This decision may have to be revisited at some point, but I don't think it's necessary for this ticket. 

Sage's install scripts will continue to make sure that the Sage venv has all necessary packages - whether user of system site packages is enabled or not.



---

archive/issue_comments_406642.json:
```json
{
    "body": "Just a quick note that I plan to work on this for Sage 9.3, not earlier.",
    "created_at": "2020-05-08T15:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406642",
    "user": "@mkoeppe"
}
```

Just a quick note that I plan to work on this for Sage 9.3, not earlier.



---

archive/issue_comments_406643.json:
```json
{
    "body": "Replying to [comment:15 mkoeppe]:\n> Well, isolating the Sage user installation scheme from the Python user installation scheme was done deliberately in the past to avoid possible breakage by incompatible installations.\n\nIt's not always easy to know what the programmers thought. What is the best source to learn things like this? Reading the tickets?",
    "created_at": "2020-05-08T16:13:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406643",
    "user": "@Volker-Weissmann"
}
```

Replying to [comment:15 mkoeppe]:
> Well, isolating the Sage user installation scheme from the Python user installation scheme was done deliberately in the past to avoid possible breakage by incompatible installations.

It's not always easy to know what the programmers thought. What is the best source to learn things like this? Reading the tickets?



---

archive/issue_comments_406644.json:
```json
{
    "body": "That, and asking questions on the sage-devel list, I suppose.",
    "created_at": "2020-05-08T16:19:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406644",
    "user": "@mkoeppe"
}
```

That, and asking questions on the sage-devel list, I suppose.



---

archive/issue_comments_406645.json:
```json
{
    "body": "In the case of PYTHONUSERBASE, comments in sage-env point to some relevant tickets.",
    "created_at": "2020-05-08T16:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406645",
    "user": "@mkoeppe"
}
```

In the case of PYTHONUSERBASE, comments in sage-env point to some relevant tickets.



---

archive/issue_comments_406646.json:
```json
{
    "body": "Thank you.",
    "created_at": "2020-05-08T16:28:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406646",
    "user": "@Volker-Weissmann"
}
```

Thank you.



---

archive/issue_comments_406647.json:
```json
{
    "body": "Before it makes sense to work on this, we should update all Python packages (#29141); in particular, `setuptools`, `pip`, ... (#29803)",
    "created_at": "2020-06-05T18:12:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406647",
    "user": "@mkoeppe"
}
```

Before it makes sense to work on this, we should update all Python packages (#29141); in particular, `setuptools`, `pip`, ... (#29803)



---

archive/issue_comments_406648.json:
```json
{
    "body": "Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/28786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/28786#issuecomment-406648",
    "user": "@mkoeppe"
}
```

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.
