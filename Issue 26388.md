# Issue 26388: Update maxima to 5.42.1

archive/issues_026388.json:
```json
{
    "body": "CC:  @jdemeyer @kiwifb @timokau @saraedum @slel\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/26625\n\n",
    "created_at": "2018-11-03T17:10:35Z",
    "labels": [],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "Update maxima to 5.42.1",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/26388",
    "user": "https://github.com/antonio-rojas"
}
```
CC:  @jdemeyer @kiwifb @timokau @saraedum @slel



Issue created by migration from https://trac.sagemath.org/ticket/26625





---

archive/issue_comments_371146.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-03T17:18:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371147.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to packages: standard.",
    "created_at": "2018-11-03T17:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371147",
    "user": "https://github.com/antonio-rojas"
}
```

Changing component from PLEASE CHANGE to packages: standard.



---

archive/issue_comments_371148.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2018-11-03T17:28:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371148",
    "user": "https://github.com/antonio-rojas"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_371149.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-11-03T21:03:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371150.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-11-03T21:04:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371150",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_371151.json:
```json
{
    "body": "No progress concerning the patch set. That's a bit annoying.",
    "created_at": "2018-11-04T08:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371151",
    "user": "https://github.com/kiwifb"
}
```

No progress concerning the patch set. That's a bit annoying.



---

archive/issue_comments_371152.json:
```json
{
    "body": "I am getting\n\n```\nsage -t --long /usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py\n**********************************************************************\nFile \"/usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py\", line 728, in sage.symbolic.integration.integral.integrate\nFailed example:\n    integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)\nExpected:\n    integrate(abs(sin(x)), x, 0, 2*pi)\nGot:\n    0\n**********************************************************************\n```\n",
    "created_at": "2018-11-04T10:12:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371152",
    "user": "https://github.com/kiwifb"
}
```

I am getting

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py", line 728, in sage.symbolic.integration.integral.integrate
Failed example:
    integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
Expected:
    integrate(abs(sin(x)), x, 0, 2*pi)
Got:
    0
**********************************************************************
```




---

archive/issue_comments_371153.json:
```json
{
    "body": "Which is wrong of course.",
    "created_at": "2018-11-04T10:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371153",
    "user": "https://github.com/kiwifb"
}
```

Which is wrong of course.



---

archive/issue_comments_371154.json:
```json
{
    "body": "And now that I look at the code in that area I see this is #10914 coming back.\n\n```\n    We will not get an evaluated answer here, which is better than\n    the previous (wrong) answer of zero. See :trac:`10914`::\n        sage: f = abs(sin(x))\n        sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)\n        integrate(abs(sin(x)), x, 0, 2*pi)\n```\n",
    "created_at": "2018-11-04T10:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371154",
    "user": "https://github.com/kiwifb"
}
```

And now that I look at the code in that area I see this is #10914 coming back.

```
    We will not get an evaluated answer here, which is better than
    the previous (wrong) answer of zero. See :trac:`10914`::
        sage: f = abs(sin(x))
        sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
        integrate(abs(sin(x)), x, 0, 2*pi)
```




---

archive/issue_comments_371155.json:
```json
{
    "body": "Replying to [comment:10 fbissey]:\n> And now that I look at the code in that area I see this is #10914 coming back.\n> {{{\n>     We will not get an evaluated answer here, which is better than\n>     the previous (wrong) answer of zero. See :trac:`10914`::\n>         sage: f = abs(sin(x))\n>         sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)\n>         integrate(abs(sin(x)), x, 0, 2*pi)\n> }}}\n\nWeird, since maxima does give the right answer now",
    "created_at": "2018-11-04T10:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371155",
    "user": "https://github.com/antonio-rojas"
}
```

Replying to [comment:10 fbissey]:
> And now that I look at the code in that area I see this is #10914 coming back.
> {{{
>     We will not get an evaluated answer here, which is better than
>     the previous (wrong) answer of zero. See :trac:`10914`::
>         sage: f = abs(sin(x))
>         sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
>         integrate(abs(sin(x)), x, 0, 2*pi)
> }}}

Weird, since maxima does give the right answer now



---

archive/issue_comments_371156.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2018-11-04T10:47:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371156",
    "user": "https://github.com/antonio-rojas"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_371157.json:
```json
{
    "body": "Since I was looking from the sage-on-gentoo perspective there is always the possibility that the maxima maintainer re-introduced a bug (doubtful but possible).",
    "created_at": "2018-11-04T10:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371157",
    "user": "https://github.com/kiwifb"
}
```

Since I was looking from the sage-on-gentoo perspective there is always the possibility that the maxima maintainer re-introduced a bug (doubtful but possible).



---

archive/issue_comments_371158.json:
```json
{
    "body": "FWIW this is the commit that breaks it\n\nhttps://sourceforge.net/p/maxima/code/ci/801a0bb782fd09b9907a599541e1bff622ea453d\n\nI can't decrypt what it means though, or why it breaks this test in sage but not in maxima itself.",
    "created_at": "2018-11-04T15:59:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371158",
    "user": "https://github.com/antonio-rojas"
}
```

FWIW this is the commit that breaks it

https://sourceforge.net/p/maxima/code/ci/801a0bb782fd09b9907a599541e1bff622ea453d

I can't decrypt what it means though, or why it breaks this test in sage but not in maxima itself.



---

archive/issue_comments_371159.json:
```json
{
    "body": "Regarding integrals of abs(sin(x)) and related, see\n\n- https://trac.sagemath.org/query?order=id&desc=1&summary=~abs(sin\n\nTo explore anything to do with Maxima, it's important to remember\nthat Sage starts Maxima by setting some defaults including `domain : complex`\nand loading some packages including `abs_integrate`, leading to differences\nwith running Maxima on its own.\n\nSee [lines 171 to 173 in src/sage/interfaces/maxima_lib.py](https://github.com/sagemath/sage/blob/6187d261eca3c980e575b53d1a31f580ba8cfdfd/src/sage/interfaces/maxima_lib.py#L171)\n\n```\ninit_code = ['besselexpand : true', 'display2d : false',\n            'domain : complex', 'keepfloat : true',\n            'load(to_poly_solve)', 'load(simplify_sum)',\n            'load(abs_integrate)', 'load(diag)']\n```\n\n\nBugs in Maxima can be discussed on the maxima-discuss mailing list,\nalways recalling these specifics of running Maxima in Sage.\n\n- http://maxima.sourceforge.net/maximalist.html",
    "created_at": "2019-01-14T22:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371159",
    "user": "https://github.com/slel"
}
```

Regarding integrals of abs(sin(x)) and related, see

- https://trac.sagemath.org/query?order=id&desc=1&summary=~abs(sin

To explore anything to do with Maxima, it's important to remember
that Sage starts Maxima by setting some defaults including `domain : complex`
and loading some packages including `abs_integrate`, leading to differences
with running Maxima on its own.

See [lines 171 to 173 in src/sage/interfaces/maxima_lib.py](https://github.com/sagemath/sage/blob/6187d261eca3c980e575b53d1a31f580ba8cfdfd/src/sage/interfaces/maxima_lib.py#L171)

```
init_code = ['besselexpand : true', 'display2d : false',
            'domain : complex', 'keepfloat : true',
            'load(to_poly_solve)', 'load(simplify_sum)',
            'load(abs_integrate)', 'load(diag)']
```


Bugs in Maxima can be discussed on the maxima-discuss mailing list,
always recalling these specifics of running Maxima in Sage.

- http://maxima.sourceforge.net/maximalist.html



---

archive/issue_comments_371160.json:
```json
{
    "body": "Ah indeed, after 'load(abs_integrate)' I can reproduce the issue in maxima\n\n```\n(%i2) load(abs_integrate);\n(%o2) /usr/share/maxima/5.42.1/share/contrib/integration/abs_integrate.mac\n(%i3) integrate(abs(sin(x)),x,0,2*%pi);\n(%o3)                                  0\n```\n",
    "created_at": "2019-01-14T22:51:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371160",
    "user": "https://github.com/antonio-rojas"
}
```

Ah indeed, after 'load(abs_integrate)' I can reproduce the issue in maxima

```
(%i2) load(abs_integrate);
(%o2) /usr/share/maxima/5.42.1/share/contrib/integration/abs_integrate.mac
(%i3) integrate(abs(sin(x)),x,0,2*%pi);
(%o3)                                  0
```




---

archive/issue_comments_371161.json:
```json
{
    "body": "Upstream report: https://sourceforge.net/p/maxima/bugs/3519/",
    "created_at": "2019-01-14T23:12:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371161",
    "user": "https://github.com/antonio-rojas"
}
```

Upstream report: https://sourceforge.net/p/maxima/bugs/3519/



---

archive/issue_comments_371162.json:
```json
{
    "body": "For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):\n\n- https://sourceforge.net/p/maxima/bugs/search/?q=\"abs(sin\"\n- https://sourceforge.net/p/maxima/bugs/search/?q=\"abs(cos\"",
    "created_at": "2019-01-14T23:34:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371162",
    "user": "https://github.com/slel"
}
```

For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):

- https://sourceforge.net/p/maxima/bugs/search/?q="abs(sin"
- https://sourceforge.net/p/maxima/bugs/search/?q="abs(cos"



---

archive/issue_comments_371163.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2019-02-09T20:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_371164.json:
```json
{
    "body": "Replying to [comment:18 slelievre]:\n> For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):\n> \n> - https://sourceforge.net/p/maxima/bugs/search/?q=\"abs(sin\"\n> - https://sourceforge.net/p/maxima/bugs/search/?q=\"abs(cos\"\n\nAlso for reference, see #12731 and/or [the wiki part about abs_integrate problems](https://trac.sagemath.org/wiki/symbolics#Integrationtickets).",
    "created_at": "2019-02-12T20:16:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371164",
    "user": "https://github.com/kcrisman"
}
```

Replying to [comment:18 slelievre]:
> For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):
> 
> - https://sourceforge.net/p/maxima/bugs/search/?q="abs(sin"
> - https://sourceforge.net/p/maxima/bugs/search/?q="abs(cos"

Also for reference, see #12731 and/or [the wiki part about abs_integrate problems](https://trac.sagemath.org/wiki/symbolics#Integrationtickets).



---

archive/issue_comments_371165.json:
```json
{
    "body": "Adding #12731 as a dependency, since it seems unlikely this will get any attention upstream.",
    "created_at": "2019-04-24T17:30:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371165",
    "user": "https://github.com/antonio-rojas"
}
```

Adding #12731 as a dependency, since it seems unlikely this will get any attention upstream.



---

archive/issue_comments_371166.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-05-23T00:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371166",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_371167.json:
```json
{
    "body": "I am putting this as \"need_review\" since #12731 is getting attention. I am ready to move this ticket to a positive review once #12731 is merged.",
    "created_at": "2019-05-23T00:24:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371167",
    "user": "https://github.com/kiwifb"
}
```

I am putting this as "need_review" since #12731 is getting attention. I am ready to move this ticket to a positive review once #12731 is merged.



---

archive/issue_comments_371168.json:
```json
{
    "body": "Changing keywords from \"\" to \"upgrade, maxima\".",
    "created_at": "2019-05-24T03:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371168",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "upgrade, maxima".



---

archive/issue_comments_371169.json:
```json
{
    "body": "#12731 is closed so this can go in.",
    "created_at": "2019-05-25T01:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371169",
    "user": "https://github.com/kiwifb"
}
```

#12731 is closed so this can go in.



---

archive/issue_comments_371170.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-05-25T01:26:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371170",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_066056.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2019-05-25T17:11:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "milestone": "sage-8.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26388#event-66056"
}
```



---

archive/issue_events_066057.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2019-05-27T19:54:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/26388#event-66057"
}
```



---

archive/issue_comments_371171.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-05-27T19:54:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/26388",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/26388#issuecomment-371171",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
