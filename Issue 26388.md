# Issue 26388: Update maxima to 5.42.1

Issue created by migration from https://trac.sagemath.org/ticket/26625

Original creator: arojas

Original creation time: 2018-11-03 17:10:35

CC:  jdemeyer fbissey @timokau saraedum slelievre




---

Comment by git created at 2018-11-03 17:18:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2018-11-03 17:28:22

Changing component from PLEASE CHANGE to packages: standard.


---

Comment by arojas created at 2018-11-03 17:28:22

Changing type from PLEASE CHANGE to enhancement.


---

Comment by git created at 2018-11-03 21:03:20

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by arojas created at 2018-11-03 21:04:16

Changing status from new to needs_review.


---

Comment by fbissey created at 2018-11-04 08:35:40

No progress concerning the patch set. That's a bit annoying.


---

Comment by fbissey created at 2018-11-04 10:12:47

I am getting

```
sage -t --long /usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py
**********************************************************************
File "/usr/lib64/python2.7/site-packages/sage/symbolic/integration/integral.py", line 728, in sage.symbolic.integration.integral.integrate
Failed example:
    integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
Expected:
    integrate(abs(sin(x)), x, 0, 2*pi)
Got:
    0
**********************************************************************
```



---

Comment by fbissey created at 2018-11-04 10:14:44

Which is wrong of course.


---

Comment by fbissey created at 2018-11-04 10:43:52

And now that I look at the code in that area I see this is #10914 coming back.

```
    We will not get an evaluated answer here, which is better than
    the previous (wrong) answer of zero. See :trac:`10914`::
        sage: f = abs(sin(x))
        sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
        integrate(abs(sin(x)), x, 0, 2*pi)
```



---

Comment by arojas created at 2018-11-04 10:47:44

Replying to [comment:10 fbissey]:
> And now that I look at the code in that area I see this is #10914 coming back.
> {{{
>     We will not get an evaluated answer here, which is better than
>     the previous (wrong) answer of zero. See :trac:`10914`::
>         sage: f = abs(sin(x))
>         sage: integrate(f, x, 0, 2*pi)  # long time (4s on sage.math, 2012)
>         integrate(abs(sin(x)), x, 0, 2*pi)
> }}}

Weird, since maxima does give the right answer now


---

Comment by arojas created at 2018-11-04 10:47:56

Changing status from needs_review to needs_work.


---

Comment by fbissey created at 2018-11-04 10:50:05

Since I was looking from the sage-on-gentoo perspective there is always the possibility that the maxima maintainer re-introduced a bug (doubtful but possible).


---

Comment by arojas created at 2018-11-04 15:59:33

FWIW this is the commit that breaks it

https://sourceforge.net/p/maxima/code/ci/801a0bb782fd09b9907a599541e1bff622ea453d

I can't decrypt what it means though, or why it breaks this test in sage but not in maxima itself.


---

Comment by slelievre created at 2019-01-14 22:29:26

Regarding integrals of abs(sin(x)) and related, see

- https://trac.sagemath.org/query?order=id&desc=1&summary=~abs(sin

To explore anything to do with Maxima, it's important to remember
that Sage starts Maxima by setting some defaults including `domain : complex`
and loading some packages including `abs_integrate`, leading to differences
with running Maxima on its own.

See [lines 171 to 173 in src/sage/interfaces/maxima_lib.py](https://github.com/sagemath/sage/blob/6187d261eca3c980e575b53d1a31f580ba8cfdfd/src/sage/interfaces/maxima_lib.py#L171)

```
init_code = ['besselexpand : true', 'display2d : false',
            'domain : complex', 'keepfloat : true',
            'load(to_poly_solve)', 'load(simplify_sum)',
            'load(abs_integrate)', 'load(diag)']
```


Bugs in Maxima can be discussed on the maxima-discuss mailing list,
always recalling these specifics of running Maxima in Sage.

- http://maxima.sourceforge.net/maximalist.html


---

Comment by arojas created at 2019-01-14 22:51:45

Ah indeed, after 'load(abs_integrate)' I can reproduce the issue in maxima

```
(%i2) load(abs_integrate);
(%o2) /usr/share/maxima/5.42.1/share/contrib/integration/abs_integrate.mac
(%i3) integrate(abs(sin(x)),x,0,2*%pi);
(%o3)                                  0
```



---

Comment by arojas created at 2019-01-14 23:12:38

Upstream report: https://sourceforge.net/p/maxima/bugs/3519/


---

Comment by slelievre created at 2019-01-14 23:34:05

For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):

- https://sourceforge.net/p/maxima/bugs/search/?q="abs(sin"
- https://sourceforge.net/p/maxima/bugs/search/?q="abs(cos"


---

Comment by git created at 2019-02-09 20:39:09

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by kcrisman created at 2019-02-12 20:16:31

Replying to [comment:18 slelievre]:
> For reference, Maxima bugs dealing with abs(sin(x)) or abs(cos(x)):
> 
> - https://sourceforge.net/p/maxima/bugs/search/?q="abs(sin"
> - https://sourceforge.net/p/maxima/bugs/search/?q="abs(cos"

Also for reference, see #12731 and/or [the wiki part about abs_integrate problems](https://trac.sagemath.org/wiki/symbolics#Integrationtickets).


---

Comment by arojas created at 2019-04-24 17:30:01

Adding #12731 as a dependency, since it seems unlikely this will get any attention upstream.


---

Comment by fbissey created at 2019-05-23 00:24:51

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2019-05-23 00:24:51

I am putting this as "need_review" since #12731 is getting attention. I am ready to move this ticket to a positive review once #12731 is merged.


---

Comment by slelievre created at 2019-05-24 03:50:01

Changing keywords from "" to "upgrade, maxima".


---

Comment by fbissey created at 2019-05-25 01:26:20

#12731 is closed so this can go in.


---

Comment by fbissey created at 2019-05-25 01:26:20

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2019-05-27 19:54:07

Resolution: fixed
