# Issue 17894: pip requires ssl

Issue created by migration from https://trac.sagemath.org/ticket/18131

Original creator: vbraun

Original creation time: 2015-04-07 08:57:56

CC:  vdelecroix tmonteil dkrenn




---

Comment by jdemeyer created at 2015-04-07 11:38:22

The easiest fix is reverting #17913.


---

Comment by vbraun created at 2015-04-07 11:55:51

And revert making pip standard since it depends on a non-standard component ;-)


---

Comment by kcrisman created at 2015-04-07 13:55:33

> And revert making pip standard since it depends on a non-standard component ;-)
Haha, good point!


---

Comment by kcrisman created at 2015-04-07 13:57:48

> The easiest fix is reverting #17913.
If there is an easy way to get sagenb to install webassets only as needed for the "newui" branch, I would be very happy to cut a new release of that.  I just don't have time to sift through all that now, and won't until mid-May.  So perhaps reverting #17913 for now is the better plan and then in 6.7 (or whatever the next number is) doing this first.


---

Comment by jdemeyer created at 2015-04-07 15:31:31

Replying to [comment:6 kcrisman]:
> If there is an easy way to get sagenb to install webassets only as needed
Are you trying to tell me that `webassets` is not even needed for sagenb?


---

Comment by kcrisman created at 2015-04-07 15:49:57

> > If there is an easy way to get sagenb to install webassets only as needed
> Are you trying to tell me that `webassets` is not even needed for sagenb?
Somewhere buried in all the tickets about webassets is what I believe is correct information - that it _is_ needed to use the "newui" branch, and at some point someone (not me) added webassets by default to sagenb so that one could try that branch out (indeed, some people apparently use it) without any further work.  I do not believe it is necessary by default, and one could pretty easily try out that hypothesis.  BUT I don't have the time to test this and especially not to provide the infrastructure to tell people what to do if webassets wasn't default but they wanted to try out the branch (partly because I'm not sure what they would have to do).


---

Comment by fbissey created at 2015-04-08 00:23:28

Hum webassets is one of these packages where the tarball you download from github and the one you get from pypi are different - for the same release.

May be we could avoid the whole pip business by just changing the source tarball used for webassets. I think the pypi tarball may contain the stuff that triggered the behavior that Volker tried to correct with pip in #17913.

The tarball to use would be https://github.com/miracle2k/webassets/archive/0.10.1.tar.gz (may need renaming) instead of https://pypi.python.org/packages/source/w/webassets/webassets-0.10.1.tar.gz as currently used.


---

Comment by fbissey created at 2015-04-08 08:54:51

Woah... Big jump in version - for those who want to know according to github the release number has gone from 1.5.6 in May 2014 to 6.0.0 in December 2014. Does a recent merge before 6.1.1 solve our problem?
----
New commits:


---

Comment by vbraun created at 2015-04-08 09:30:54

I don't think the relevant code changed


---

Comment by vbraun created at 2015-04-08 10:00:30

It seems that urllib3 (bundled in pip) already fouls, so it'll be difficult to wean it off ssl: https://github.com/shazow/urllib3/issues/584


---

Comment by fbissey created at 2015-04-08 10:16:05

I see and https://github.com/shazow/urllib3/issues/320 had a fix merged but only for python-3.x.


---

Comment by git created at 2015-04-08 10:39:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-08 10:42:06

Changing status from new to needs_review.


---

Comment by vbraun created at 2015-04-08 10:44:00

I've added `-Z` to avoid zipping eggs (which always bites you later since shared libraries can't be loaded from zipped eggs). Maybe that helps with webassets...


---

Comment by jdemeyer created at 2015-04-09 09:13:54

Can we please _not_ update `pip` here and make this a ticket about reverting the use of `pip` for `sagenb`?


---

Comment by vbraun created at 2015-04-09 09:14:49

We don't use pip for anything (in fact, we can't rely on it working as we have seen). So why not update it?


---

Comment by jdemeyer created at 2015-04-09 09:28:17

Replying to [comment:19 vbraun]:
> So why not update it?
If it would be an optional package, that would be fine. But `pip` is standard, so it is built when building Sage. If this new version of `pip` doesn't build on somebody's system, then Sage is broken on that system.


---

Comment by vbraun created at 2015-04-09 09:32:30

Thats a theoretical possibility, but its also the recommended package manager for python. I'd be willing to bet that the latest version of pip has already been installed and used on more systems than Sage ever will be.


---

Comment by jdemeyer created at 2015-04-09 09:37:11

Replying to [comment:21 vbraun]:
> Thats a theoretical possibility, but its also the recommended package manager for python. I'd be willing to bet that the latest version of pip has already been installed and used on more systems than Sage ever will be.
That's all true, but even then: installing `pip` in Sage is not the same as installing `pip` system-wide.

It's just a matter of not introducing unneeded risks.

Besides, if upstream fixes [https://github.com/shazow/urllib3/issues/584](https://github.com/shazow/urllib3/issues/584), we would need to upgrade again anyway...


---

Comment by vbraun created at 2015-04-09 09:42:25

We need to upgrade regularly anyway... in fact we should have a process that pulls in updates from non-mathematics Python packages automatically (without me manually udpating package-version.txt all the time) if they pass the tests. 

There are also risks in not updating, you might run into bugs that have long been fixed. In particular, pip packages a bunch of ssl stuff to secure downloads. Having a version from years ago is a security risk as it'll probably still accept ssl cipher suites that are now deemed unsafe.


---

Comment by jdemeyer created at 2015-04-10 08:42:21

Changing status from needs_review to positive_review.


---

Comment by tmonteil created at 2015-04-11 16:14:40

I modified the title and the description of the ticket since what is positively reviewed did not correspond. I agree with Jeroen that there should have been two separate tickets since two different issues are addressed here.


---

Comment by tmonteil created at 2015-04-11 16:48:05

Changing status from positive_review to needs_work.


---

Comment by tmonteil created at 2015-04-11 16:48:05

Dependencies in `build/deps` should be reverted as well.


---

Comment by git created at 2015-04-11 20:07:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vbraun created at 2015-04-11 20:08:43

Done


---

Comment by vbraun created at 2015-04-11 20:08:43

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2015-04-11 20:10:51

Resolution: fixed
