# Issue 19133: Porting to "El Capitan" (OS  X 10.11)

archive/issues_019133.json:
```json
{
    "body": "CC:  jhpalmieri yomcat cnassau\n\nCurrently sage is not working at all on OS X 10.11. The aim of this ticket is to remedy to that.\n\nPoints identified so far:\n* Libraries which do not have a properly set `install_name` fail to load\n* The fix for #18254 (`R`) should have been applied more widely on future release\n* The fix for building `git` without `openssl` on OS X in #17091 is not working anymore and needs replacing with something less subtle\n* `R` also has `install_name` problems but they shouldn't prevent the running of `sage` itself\n* With all the above (except for `R`'s `install_name` problems) is fixed `sage` segfault on startup.\n\nIssue created by migration from https://trac.sagemath.org/ticket/19370\n\n",
    "created_at": "2015-10-07T21:59:01Z",
    "labels": [
        "porting",
        "major",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "Porting to \"El Capitan\" (OS  X 10.11)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/19133",
    "user": "fbissey"
}
```
CC:  jhpalmieri yomcat cnassau

Currently sage is not working at all on OS X 10.11. The aim of this ticket is to remedy to that.

Points identified so far:
* Libraries which do not have a properly set `install_name` fail to load
* The fix for #18254 (`R`) should have been applied more widely on future release
* The fix for building `git` without `openssl` on OS X in #17091 is not working anymore and needs replacing with something less subtle
* `R` also has `install_name` problems but they shouldn't prevent the running of `sage` itself
* With all the above (except for `R`'s `install_name` problems) is fixed `sage` segfault on startup.

Issue created by migration from https://trac.sagemath.org/ticket/19370





---

archive/issue_comments_262536.json:
```json
{
    "body": "Some of the bits included in the patch are clean up:\n* `cliquer`: removed  MACOSX_DEPLOYMENT_TARGET, this is set globaly and putting 10.3 means rpath cannot be used if we go that route (bit me when the first version of this was focusing on rpathing everything)\n* `conway_polynomials`: the modification enable it to be installed without segfaulting `sage`. The `import` statement is pinpointed to the only needed bit.\n* `git`: `openssl` was first disabled if you use 10.8 and then just disabled on any OS X.",
    "created_at": "2015-10-07T22:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262536",
    "user": "fbissey"
}
```

Some of the bits included in the patch are clean up:
* `cliquer`: removed  MACOSX_DEPLOYMENT_TARGET, this is set globaly and putting 10.3 means rpath cannot be used if we go that route (bit me when the first version of this was focusing on rpathing everything)
* `conway_polynomials`: the modification enable it to be installed without segfaulting `sage`. The `import` statement is pinpointed to the only needed bit.
* `git`: `openssl` was first disabled if you use 10.8 and then just disabled on any OS X.



---

archive/issue_comments_262537.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-10-07T23:19:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262537",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_262538.json:
```json
{
    "body": "Building with `SAGE_DEBUG=1` to try to get to the root of the present segfault. `maxima` will not build on top of `ecl` built with `SAGE_DEBUG=1` (regardless of setting for `maxima` itself). I do not know if it is unique to `El Capitan`.",
    "created_at": "2015-10-08T01:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262538",
    "user": "fbissey"
}
```

Building with `SAGE_DEBUG=1` to try to get to the root of the present segfault. `maxima` will not build on top of `ecl` built with `SAGE_DEBUG=1` (regardless of setting for `maxima` itself). I do not know if it is unique to `El Capitan`.



---

archive/issue_comments_262539.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> Building with `SAGE_DEBUG=1` to try to get to the root of the present segfault. `maxima` will not build on top of `ecl` built with `SAGE_DEBUG=1` (regardless of setting for `maxima` itself). I do not know if it is unique to `El Capitan`.\nAnd same thing with `zn_poly` compiled against `mpir` with `SAGE_DEBUG=1`. Again I am not sure it is specific to `El Capitan`.",
    "created_at": "2015-10-08T04:27:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262539",
    "user": "fbissey"
}
```

Replying to [comment:4 fbissey]:
> Building with `SAGE_DEBUG=1` to try to get to the root of the present segfault. `maxima` will not build on top of `ecl` built with `SAGE_DEBUG=1` (regardless of setting for `maxima` itself). I do not know if it is unique to `El Capitan`.
And same thing with `zn_poly` compiled against `mpir` with `SAGE_DEBUG=1`. Again I am not sure it is specific to `El Capitan`.



---

archive/issue_comments_262540.json:
```json
{
    "body": "Do you mean `SAGE_DEBUG=yes`? I don't see any reason why `SAGE_DEBUG=1` would have any effect. In any case, I just tried a build on OS X 10.10 with `SAGE_DEBUG=1` and it went fine. Now I'm trying with `SAGE_DEBUG=yes`. I'll report on the results tomorrow.",
    "created_at": "2015-10-08T05:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262540",
    "user": "jhpalmieri"
}
```

Do you mean `SAGE_DEBUG=yes`? I don't see any reason why `SAGE_DEBUG=1` would have any effect. In any case, I just tried a build on OS X 10.10 with `SAGE_DEBUG=1` and it went fine. Now I'm trying with `SAGE_DEBUG=yes`. I'll report on the results tomorrow.



---

archive/issue_comments_262541.json:
```json
{
    "body": "I thought the important bit was for `SAGE_DEBUG` to be defined but may be some `spkg-install` look specifically for `yes`.",
    "created_at": "2015-10-08T06:16:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262541",
    "user": "fbissey"
}
```

I thought the important bit was for `SAGE_DEBUG` to be defined but may be some `spkg-install` look specifically for `yes`.



---

archive/issue_comments_262542.json:
```json
{
    "body": "things get out of hands with `singular` when compiled with `SAGE_DEBUG=yes` (and it has to be yes) some symbols are in other libraries that are not linked into sage on OS X.\n\n```\nImportError: dlopen(/Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so, 2): Symbol not found: _om_BinPageIndicies\n  Referenced from: /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so\n  Expected in: /Users/fbissey/build/sage-6.7.beta4/local/lib/libsingular.dylib\n in /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so\n```\n\nand\n\n```\nMirage:sage-6.7.beta4 fbissey$ nm local/lib/libsingular.dylib | grep  _om_BinPageIndicies\nMirage:sage-6.7.beta4 fbissey$ \nMirage:sage-6.7.beta4 fbissey$ nm local/lib/libomalloc.a | grep  _om_BinPageIndicies\nwarning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: no name list\nwarning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: no name list\n0000000000007758 S _om_BinPageIndicies\n                 U _om_BinPageIndicies\n                 U _om_BinPageIndicies\n                 U _om_BinPageIndicies\n                 U _om_BinPageIndicies\n                 U _om_BinPageIndicies\n                 U _om_BinPageIndicies\n```\n\nUnfortunately libomalloc is not linked into sage as far as I can see.",
    "created_at": "2015-10-08T06:48:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262542",
    "user": "fbissey"
}
```

things get out of hands with `singular` when compiled with `SAGE_DEBUG=yes` (and it has to be yes) some symbols are in other libraries that are not linked into sage on OS X.

```
ImportError: dlopen(/Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so, 2): Symbol not found: _om_BinPageIndicies
  Referenced from: /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so
  Expected in: /Users/fbissey/build/sage-6.7.beta4/local/lib/libsingular.dylib
 in /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_libsingular.so
```

and

```
Mirage:sage-6.7.beta4 fbissey$ nm local/lib/libsingular.dylib | grep  _om_BinPageIndicies
Mirage:sage-6.7.beta4 fbissey$ 
Mirage:sage-6.7.beta4 fbissey$ nm local/lib/libomalloc.a | grep  _om_BinPageIndicies
warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: no name list
warning: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/nm: no name list
0000000000007758 S _om_BinPageIndicies
                 U _om_BinPageIndicies
                 U _om_BinPageIndicies
                 U _om_BinPageIndicies
                 U _om_BinPageIndicies
                 U _om_BinPageIndicies
                 U _om_BinPageIndicies
```

Unfortunately libomalloc is not linked into sage as far as I can see.



---

archive/issue_comments_262543.json:
```json
{
    "body": "Run the command `grep -R SAGE_DEBUG build/pkgs/` to see the uses of `SAGE_DEBUG`: most test whether it is \"yes\".\n\nOn OS X 10.10 with `SAGE_DEBUG=yes` for the entire Sage build, `maxima` fails to build, `zn_poly` and `singular` build successfully. (I do not have `SAGE_CHECK` set, by the way.)",
    "created_at": "2015-10-08T14:57:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262543",
    "user": "jhpalmieri"
}
```

Run the command `grep -R SAGE_DEBUG build/pkgs/` to see the uses of `SAGE_DEBUG`: most test whether it is "yes".

On OS X 10.10 with `SAGE_DEBUG=yes` for the entire Sage build, `maxima` fails to build, `zn_poly` and `singular` build successfully. (I do not have `SAGE_CHECK` set, by the way.)



---

archive/issue_comments_262544.json:
```json
{
    "body": "OK retrying with `SAGE_DEBUG=yes` I should have thought of grepping. Interesting that maxima fails when `ecl` has debug code. There are a few extra things that seem to be required to link when `sage` itself is not compiled with `-DNDEBUG`, at least on OS X but that's possibly a different issue.",
    "created_at": "2015-10-08T21:36:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262544",
    "user": "fbissey"
}
```

OK retrying with `SAGE_DEBUG=yes` I should have thought of grepping. Interesting that maxima fails when `ecl` has debug code. There are a few extra things that seem to be required to link when `sage` itself is not compiled with `-DNDEBUG`, at least on OS X but that's possibly a different issue.



---

archive/issue_comments_262545.json:
```json
{
    "body": "For the record, the symbol is indeed in libsingular on OSX10.10:\n\n```\n$ nm local/lib/libsingular.dylib | grep  _om_BinPageIndicies\n0000000000674a58 S _om_BinPageIndicies\n```\n",
    "created_at": "2015-10-08T23:02:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262545",
    "user": "vbraun"
}
```

For the record, the symbol is indeed in libsingular on OSX10.10:

```
$ nm local/lib/libsingular.dylib | grep  _om_BinPageIndicies
0000000000674a58 S _om_BinPageIndicies
```




---

archive/issue_comments_262546.json:
```json
{
    "body": "Thanks for the info Volker, I will have to check if it is, in a non-debug build of singular.",
    "created_at": "2015-10-08T23:04:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262546",
    "user": "fbissey"
}
```

Thanks for the info Volker, I will have to check if it is, in a non-debug build of singular.



---

archive/issue_comments_262547.json:
```json
{
    "body": "PS: The libsingular compile log (logs/pkgs/singular-3.1.7p1.p0.log) shows that it links against omalloc. Maybe double check that its not the Singular build system's fault\n\n```\ng++ -dynamiclib -twolevel_namespace -weak_reference_mismatches weak -undefined dynamic_lookup -L/Users/vbraun/Sage/local/lib -lflint -lmpfr -lmpir -single_module -o libsingular.dylib \\\n        iparith.o mpsr_Tok.o claptmpl.o \\\n        grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o s_buff.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o denom_list.o minpoly.o countedref.o singmathic.o semaphore.o rlimit.o slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -lkernel -L../kernel -L../factory -L../libfac -L/Users/vbraun/Sage/local/lib -lsingfac -lsingcf -lntl -lreadline -L/Users/vbraun/Sage/local/lib -lflint -lmpfr -lmpir -lgmp -lomalloc\n```\n",
    "created_at": "2015-10-08T23:05:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262547",
    "user": "vbraun"
}
```

PS: The libsingular compile log (logs/pkgs/singular-3.1.7p1.p0.log) shows that it links against omalloc. Maybe double check that its not the Singular build system's fault

```
g++ -dynamiclib -twolevel_namespace -weak_reference_mismatches weak -undefined dynamic_lookup -L/Users/vbraun/Sage/local/lib -lflint -lmpfr -lmpir -single_module -o libsingular.dylib \
        iparith.o mpsr_Tok.o claptmpl.o \
        grammar.o scanner.o attrib.o blackbox.o eigenval_ip.o extra.o fehelp.o feOpt.o ipassign.o ipconv.o ipid.o iplib.o ipprint.o ipshell.o newstruct.o lists.o sdb.o fglm.o interpolation.o silink.o ssiLink.o s_buff.o subexpr.o janet.o wrapper.o libparse.o sing_win.o gms.o pcv.o maps_ip.o walk.o walk_ip.o cntrlc.o misc_ip.o calcSVD.o pipeLink.o Minor.o MinorProcessor.o MinorInterface.o bigintm.o pyobject_setup.o denom_list.o minpoly.o countedref.o singmathic.o semaphore.o rlimit.o slInit_Static.o mpsr_Put.o mpsr_PutPoly.o mpsr_GetPoly.o mpsr_sl.o mpsr_Get.o mpsr_GetMisc.o mpsr_Error.o ndbm.o sing_dbm.o -lkernel -L../kernel -L../factory -L../libfac -L/Users/vbraun/Sage/local/lib -lsingfac -lsingcf -lntl -lreadline -L/Users/vbraun/Sage/local/lib -lflint -lmpfr -lmpir -lgmp -lomalloc
```




---

archive/issue_comments_262548.json:
```json
{
    "body": "PPS: let me know if you want an account on the OSX 10.10 buildbot to compare with...",
    "created_at": "2015-10-08T23:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262548",
    "user": "vbraun"
}
```

PPS: let me know if you want an account on the OSX 10.10 buildbot to compare with...



---

archive/issue_comments_262549.json:
```json
{
    "body": "I'll think about the offer but I may be too split for time to run things on the two fronts at the same time. I will definitely check what happens here regarding `singular`.\n\nI really need to get a debug build in shape if I want to track that segfault.",
    "created_at": "2015-10-08T23:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262549",
    "user": "fbissey"
}
```

I'll think about the offer but I may be too split for time to run things on the two fronts at the same time. I will definitely check what happens here regarding `singular`.

I really need to get a debug build in shape if I want to track that segfault.



---

archive/issue_comments_262550.json:
```json
{
    "body": "OK I think the `singular` problem was due to left over stuff from an install without `SAGE_DEBUG=yes` first before a properly built version with debugging enabled. It looks all right now.\n\nBut debugging doesn't come easy\n\n```\nMirage:sage-6.7.beta4 fbissey$ ./sage -gdb\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath Version 6.9.rc2, Release Date: 2015-10-03                 \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nForcing sage-location, probably because a new package was installed.\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nDone updating paths.\nGNU gdb (GDB) 7.8\nCopyright (C) 2014 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \"show copying\"\nand \"show warranty\" for details.\nThis GDB was configured as \"x86_64-apple-darwin15.0.0\".\nType \"show configuration\" for configuration details.\nFor bug reporting instructions, please see:\n<http://www.gnu.org/software/gdb/bugs/>.\nFind the GDB manual and other documentation resources online at:\n<http://www.gnu.org/software/gdb/documentation/>.\nFor help, type \"help\".\nType \"apropos word\" to search for commands related to \"word\"...\nReading symbols from python...\nwarning: `/Users/fbissey/build/sage-6.7.beta4/local/var/tmp/sage/build/python2-2.7.9/src/Modules/python.o': can't open to read symbols: No such file or directory.\n(no debugging symbols found)...done.\nwarning: `/Users/fbissey/build/sage-6.7.beta4/local/var/tmp/sage/build/python2-2.7.9/src/Modules/python.o': can't open to read symbols: No such file or directory.\nPython Exception <class 'cElementTree.ParseError'> no element found: line 1, column 0: \n/var/folders/0g/jzxs892s22dflvl1ccnj98hh0000gn/T/tmp38HlSs:557: Error in sourced command file:\nError occurred in Python command: no element found: line 1, column 0\n/Users/fbissey/build/sage-6.7.beta4/local/bin/sage-gdb-commands:1: Error in sourced command file:\nUnable to find Mach task port for process-id 98761: (os/kern) failure (0x5).\n (please check gdb is codesigned - see taskgated(8))\n(gdb) q\nclose failed in file object destructor:\nIOError: [Errno 9] Bad file descriptor\n```\n\nanyone has a clue?",
    "created_at": "2015-10-09T02:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262550",
    "user": "fbissey"
}
```

OK I think the `singular` problem was due to left over stuff from an install without `SAGE_DEBUG=yes` first before a properly built version with debugging enabled. It looks all right now.

But debugging doesn't come easy

```
Mirage:sage-6.7.beta4 fbissey$ ./sage -gdb
┌────────────────────────────────────────────────────────────────────┐
│ SageMath Version 6.9.rc2, Release Date: 2015-10-03                 │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
Forcing sage-location, probably because a new package was installed.
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Done updating paths.
GNU gdb (GDB) 7.8
Copyright (C) 2014 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-apple-darwin15.0.0".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from python...
warning: `/Users/fbissey/build/sage-6.7.beta4/local/var/tmp/sage/build/python2-2.7.9/src/Modules/python.o': can't open to read symbols: No such file or directory.
(no debugging symbols found)...done.
warning: `/Users/fbissey/build/sage-6.7.beta4/local/var/tmp/sage/build/python2-2.7.9/src/Modules/python.o': can't open to read symbols: No such file or directory.
Python Exception <class 'cElementTree.ParseError'> no element found: line 1, column 0: 
/var/folders/0g/jzxs892s22dflvl1ccnj98hh0000gn/T/tmp38HlSs:557: Error in sourced command file:
Error occurred in Python command: no element found: line 1, column 0
/Users/fbissey/build/sage-6.7.beta4/local/bin/sage-gdb-commands:1: Error in sourced command file:
Unable to find Mach task port for process-id 98761: (os/kern) failure (0x5).
 (please check gdb is codesigned - see taskgated(8))
(gdb) q
close failed in file object destructor:
IOError: [Errno 9] Bad file descriptor
```

anyone has a clue?



---

archive/issue_comments_262551.json:
```json
{
    "body": "Thats normal, a self-compiled gdb lacks permissions on OSX to debug. Run gdb as root or figure out how to properly codesign it (the latter didn't work for me when I tried once it but is supposed to work).",
    "created_at": "2015-10-09T08:38:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262551",
    "user": "vbraun"
}
```

Thats normal, a self-compiled gdb lacks permissions on OSX to debug. Run gdb as root or figure out how to properly codesign it (the latter didn't work for me when I tried once it but is supposed to work).



---

archive/issue_comments_262552.json:
```json
{
    "body": "*feeling really silly* I should know that. May have to cut some optimization and avoid stripping.\n\n```\n#0  0x0000000106adaf1b in get_adjusted_ptr(std::type_info const*, std::type_info const*, void**) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib\n#1  0x0000000106adb7c9 in __gxx_personality_v0 () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib\n#2  0x00007fff8490a9ba in _Unwind_RaiseException () from /usr/lib/system/libunwind.dylib\n#3  0x0000000106adbe39 in __cxa_rethrow () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib\n#4  0x000000010e5d39e2 in __pyx_f_4sage_8symbolic_8function_15BuiltinFunction__is_registered(__pyx_obj_4sage_8symbolic_8function_BuiltinFunction*) ()\n   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#5  0x000000010e5b083d in __pyx_pf_4sage_8symbolic_8function_8Function___init__(__pyx_obj_4sage_8symbolic_8function_Function*, _object*, _object*, _object*, _object*, _object*, _object*) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#6  0x000000010e5af5dc in __pyx_pw_4sage_8symbolic_8function_8Function_1__init__(_object*, _object*, _object*) ()\n   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#7  0x00000001000b4461 in wrap_init () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#8  0x000000010003a12b in wrapper_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#9  0x0000000100014e89 in PyObject_Call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#10 0x0000000100122f94 in PyEval_CallObjectWithKeywords () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#11 0x0000000100039156 in wrapperdescr_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#12 0x000000010e5ec75e in __Pyx_PyObject_Call(_object*, _object*, _object*) ()\n   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#13 0x000000010e5cdd52 in __pyx_pf_4sage_8symbolic_8function_15BuiltinFunction___init__(__pyx_obj_4sage_8symbolic_8function_BuiltinFunction*, _object*, _object*, _object*, _object*, _object*, _object*) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#14 0x000000010e5cd660 in __pyx_pw_4sage_8symbolic_8function_15BuiltinFunction_1__init__(_object*, _object*, _object*) ()\n   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so\n#15 0x00000001000b4461 in wrap_init () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n#16 0x000000010003a12b in wrapper_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib\n```\n\nat least we are starting to get somewhere.",
    "created_at": "2015-10-09T09:38:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262552",
    "user": "fbissey"
}
```

*feeling really silly* I should know that. May have to cut some optimization and avoid stripping.

```
#0  0x0000000106adaf1b in get_adjusted_ptr(std::type_info const*, std::type_info const*, void**) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib
#1  0x0000000106adb7c9 in __gxx_personality_v0 () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib
#2  0x00007fff8490a9ba in _Unwind_RaiseException () from /usr/lib/system/libunwind.dylib
#3  0x0000000106adbe39 in __cxa_rethrow () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libstdc++.6.dylib
#4  0x000000010e5d39e2 in __pyx_f_4sage_8symbolic_8function_15BuiltinFunction__is_registered(__pyx_obj_4sage_8symbolic_8function_BuiltinFunction*) ()
   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#5  0x000000010e5b083d in __pyx_pf_4sage_8symbolic_8function_8Function___init__(__pyx_obj_4sage_8symbolic_8function_Function*, _object*, _object*, _object*, _object*, _object*, _object*) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#6  0x000000010e5af5dc in __pyx_pw_4sage_8symbolic_8function_8Function_1__init__(_object*, _object*, _object*) ()
   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#7  0x00000001000b4461 in wrap_init () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#8  0x000000010003a12b in wrapper_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#9  0x0000000100014e89 in PyObject_Call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#10 0x0000000100122f94 in PyEval_CallObjectWithKeywords () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#11 0x0000000100039156 in wrapperdescr_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#12 0x000000010e5ec75e in __Pyx_PyObject_Call(_object*, _object*, _object*) ()
   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#13 0x000000010e5cdd52 in __pyx_pf_4sage_8symbolic_8function_15BuiltinFunction___init__(__pyx_obj_4sage_8symbolic_8function_BuiltinFunction*, _object*, _object*, _object*, _object*, _object*, _object*) () from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#14 0x000000010e5cd660 in __pyx_pw_4sage_8symbolic_8function_15BuiltinFunction_1__init__(_object*, _object*, _object*) ()
   from /Users/fbissey/build/sage-6.7.beta4/local/lib/python2.7/site-packages/sage/symbolic/function.so
#15 0x00000001000b4461 in wrap_init () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
#16 0x000000010003a12b in wrapper_call () from /Users/fbissey/build/sage-6.7.beta4/local/lib/libpython2.7.dylib
```

at least we are starting to get somewhere.



---

archive/issue_comments_262553.json:
```json
{
    "body": "Looks like it uses the system clang _Unwind_RaiseException, whereas it should be using the one from SAGE_ROOT/local/lib/libgcc",
    "created_at": "2015-10-09T09:52:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262553",
    "user": "vbraun"
}
```

Looks like it uses the system clang _Unwind_RaiseException, whereas it should be using the one from SAGE_ROOT/local/lib/libgcc



---

archive/issue_comments_262554.json:
```json
{
    "body": "Yes I can find the symbol in `libgcc_s_x86_64.1.dylib`. I may have to re-attempt rpath-ing the whole thing. I am fairly sure that the first time I only managed to rpath all the dylibs, unfortunately python modules, still in `.so` in vanilla sage, are bundles which is a different linking option on OS X.",
    "created_at": "2015-10-09T10:10:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262554",
    "user": "fbissey"
}
```

Yes I can find the symbol in `libgcc_s_x86_64.1.dylib`. I may have to re-attempt rpath-ing the whole thing. I am fairly sure that the first time I only managed to rpath all the dylibs, unfortunately python modules, still in `.so` in vanilla sage, are bundles which is a different linking option on OS X.



---

archive/issue_comments_262555.json:
```json
{
    "body": "I just got El Capitan running on a virtual machine! To celebrate, I tried a sage-build based on this ticket's branch. I get segfaults in zn_poly and maxima (among other things). Both seem to be alignment-problems; here is the backtrace for maxima, running ecl:\n\n\n```\n(sage-sh) cn@el-capitan:src$ gdb ecl\nGNU gdb (GDB) 7.8\n...\n(gdb) run\n...\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n(gdb) where\n#0  0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n#1  0x00007fff5fbfeee0 in ?? ()\n#2  0x00000001002c22b8 in ?? () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#3  0x0000000000002364 in ?? ()\n#4  0x0000000100175081 in ecl_char_upcase () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#5  0x00000001001c25df in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#6  0x00000001001c26c7 in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#7  0x00000001001c32aa in _ecl_sethash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#8  0x00000001001c3db4 in ecl_sethash () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#9  0x0000000100004c4d in cl_boot () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n#10 0x0000000100000df1 in main ()\n```\n\n\nI think there is a chance these might be misconfigurations as a consequence of the virtualisation, but I thought I'd share this anyway...",
    "created_at": "2015-10-10T16:02:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262555",
    "user": "cnassau"
}
```

I just got El Capitan running on a virtual machine! To celebrate, I tried a sage-build based on this ticket's branch. I get segfaults in zn_poly and maxima (among other things). Both seem to be alignment-problems; here is the backtrace for maxima, running ecl:


```
(sage-sh) cn@el-capitan:src$ gdb ecl
GNU gdb (GDB) 7.8
...
(gdb) run
...
Program received signal SIGSEGV, Segmentation fault.
0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
(gdb) where
#0  0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
#1  0x00007fff5fbfeee0 in ?? ()
#2  0x00000001002c22b8 in ?? () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#3  0x0000000000002364 in ?? ()
#4  0x0000000100175081 in ecl_char_upcase () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#5  0x00000001001c25df in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#6  0x00000001001c26c7 in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#7  0x00000001001c32aa in _ecl_sethash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#8  0x00000001001c3db4 in ecl_sethash () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#9  0x0000000100004c4d in cl_boot () from /Users/cn/sage/local/lib//libecl.15.3.dylib
#10 0x0000000100000df1 in main ()
```


I think there is a chance these might be misconfigurations as a consequence of the virtualisation, but I thought I'd share this anyway...



---

archive/issue_comments_262556.json:
```json
{
    "body": "Replying to [comment:22 cnassau]:\n\nWith SAGE_CHECK=yes I get two test failures (segfaults from t-divrem_1, t-fat) from gmp. These seem to be similar to the ones described here for gmp-6.0.0 on Yosemite: https://gmplib.org/list-archives/gmp-bugs/2014-June/003499.html\n\nDebugging this with gdb seems difficult; all I manage to get (from running test t-divrem_1) is\n\n```\nProgram received signal SIGSEGV, Segmentation fault.\n0x00007fff911b92da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n(gdb) where\nPython Exception <type 'exceptions.ImportError'> dlopen(/Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so, 2): Symbol not found: __Py_RefTotal\n  Referenced from: /Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so\n  Expected in: flat namespace\n in /Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so: \n#0  0x00007fff911b92da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n#1  0x0000000000000000 in ?? ()\n```\n",
    "created_at": "2015-10-11T09:44:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262556",
    "user": "cnassau"
}
```

Replying to [comment:22 cnassau]:

With SAGE_CHECK=yes I get two test failures (segfaults from t-divrem_1, t-fat) from gmp. These seem to be similar to the ones described here for gmp-6.0.0 on Yosemite: https://gmplib.org/list-archives/gmp-bugs/2014-June/003499.html

Debugging this with gdb seems difficult; all I manage to get (from running test t-divrem_1) is

```
Program received signal SIGSEGV, Segmentation fault.
0x00007fff911b92da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
(gdb) where
Python Exception <type 'exceptions.ImportError'> dlopen(/Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so, 2): Symbol not found: __Py_RefTotal
  Referenced from: /Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so
  Expected in: flat namespace
 in /Users/cn/sage/local/lib/python2.7/lib-dynload/itertools.so: 
#0  0x00007fff911b92da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
#1  0x0000000000000000 in ?? ()
```




---

archive/issue_comments_262557.json:
```json
{
    "body": "Replying to [comment:22 cnassau]:\n> I just got El Capitan running on a virtual machine! To celebrate, I tried a sage-build based on this ticket's branch. I get segfaults in zn_poly and maxima (among other things). Both seem to be alignment-problems; here is the backtrace for maxima, running ecl:\n> \n> {{{\n> (sage-sh) cn`@`el-capitan:src$ gdb ecl\n> GNU gdb (GDB) 7.8\n> ...\n> (gdb) run\n> ...\n> Program received signal SIGSEGV, Segmentation fault.\n> 0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n> (gdb) where\n> #0  0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib\n> #1  0x00007fff5fbfeee0 in ?? ()\n> #2  0x00000001002c22b8 in ?? () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #3  0x0000000000002364 in ?? ()\n> #4  0x0000000100175081 in ecl_char_upcase () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #5  0x00000001001c25df in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #6  0x00000001001c26c7 in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #7  0x00000001001c32aa in _ecl_sethash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #8  0x00000001001c3db4 in ecl_sethash () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #9  0x0000000100004c4d in cl_boot () from /Users/cn/sage/local/lib//libecl.15.3.dylib\n> #10 0x0000000100000df1 in main ()\n> }}}\n> \n> I think there is a chance these might be misconfigurations as a consequence of the virtualisation, but I thought I'd share this anyway...\n\n\nWell I had to build `ecl` without `SAGE_DEBUG=yes` for `maxima` to build. Same thing with `zn_poly`, I had to build `mpir` without `SAGE_DEBUG=yes` for it to build.",
    "created_at": "2015-10-11T21:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262557",
    "user": "fbissey"
}
```

Replying to [comment:22 cnassau]:
> I just got El Capitan running on a virtual machine! To celebrate, I tried a sage-build based on this ticket's branch. I get segfaults in zn_poly and maxima (among other things). Both seem to be alignment-problems; here is the backtrace for maxima, running ecl:
> 
> {{{
> (sage-sh) cn`@`el-capitan:src$ gdb ecl
> GNU gdb (GDB) 7.8
> ...
> (gdb) run
> ...
> Program received signal SIGSEGV, Segmentation fault.
> 0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
> (gdb) where
> #0  0x00007fff89cf32da in stack_not_16_byte_aligned_error () from /usr/lib/system/libdyld.dylib
> #1  0x00007fff5fbfeee0 in ?? ()
> #2  0x00000001002c22b8 in ?? () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #3  0x0000000000002364 in ?? ()
> #4  0x0000000100175081 in ecl_char_upcase () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #5  0x00000001001c25df in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #6  0x00000001001c26c7 in _hash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #7  0x00000001001c32aa in _ecl_sethash_equalp () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #8  0x00000001001c3db4 in ecl_sethash () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #9  0x0000000100004c4d in cl_boot () from /Users/cn/sage/local/lib//libecl.15.3.dylib
> #10 0x0000000100000df1 in main ()
> }}}
> 
> I think there is a chance these might be misconfigurations as a consequence of the virtualisation, but I thought I'd share this anyway...


Well I had to build `ecl` without `SAGE_DEBUG=yes` for `maxima` to build. Same thing with `zn_poly`, I had to build `mpir` without `SAGE_DEBUG=yes` for it to build.



---

archive/issue_comments_262558.json:
```json
{
    "body": "I think we are hit by this incredibly trivial (and incredibly powerful) bug in the gmp build-system: https://lists.macosforge.org/pipermail/macports-tickets/2014-September/170442.html \n\nThe problem is that OS 10.10 and OS 10.11 are erroneously recognized as OSX 10.1 (!) Among other things this leads to a corrupted gcc which is hit by internal compiler errors when optimization is turned on.\n\nI have added a (somewhat hasty) patch for gmp which at least fixes the two test failures t-divrem_1 and t-fat. This patch is on the trac branch u/cnassau/capitan . The gmp test-suite still fails, but now at a later stage (cxx).",
    "created_at": "2015-10-11T21:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262558",
    "user": "cnassau"
}
```

I think we are hit by this incredibly trivial (and incredibly powerful) bug in the gmp build-system: https://lists.macosforge.org/pipermail/macports-tickets/2014-September/170442.html 

The problem is that OS 10.10 and OS 10.11 are erroneously recognized as OSX 10.1 (!) Among other things this leads to a corrupted gcc which is hit by internal compiler errors when optimization is turned on.

I have added a (somewhat hasty) patch for gmp which at least fixes the two test failures t-divrem_1 and t-fat. This patch is on the trac branch u/cnassau/capitan . The gmp test-suite still fails, but now at a later stage (cxx).



---

archive/issue_comments_262559.json:
```json
{
    "body": "That bug is old. It can be worked around by setting MACOSX_DEPLOYMENT_TARGET=10.9, see src/bin/sage-env. The latter file almost certainly needs to be updated to also set it for 10.11",
    "created_at": "2015-10-11T22:25:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262559",
    "user": "vbraun"
}
```

That bug is old. It can be worked around by setting MACOSX_DEPLOYMENT_TARGET=10.9, see src/bin/sage-env. The latter file almost certainly needs to be updated to also set it for 10.11



---

archive/issue_comments_262560.json:
```json
{
    "body": "Indeed, with the obvious \"fix\" in sage-env I could now build all of sage and start running the doctests. My 40G harddrive overflowed during the build because I kept the full installation logs (sigh), and I now get plenty of doctest failures, apparently due to missing packages (sympy, conway_polynomials, ...). Will have to rebuild, it seems...",
    "created_at": "2015-10-12T09:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262560",
    "user": "cnassau"
}
```

Indeed, with the obvious "fix" in sage-env I could now build all of sage and start running the doctests. My 40G harddrive overflowed during the build because I kept the full installation logs (sigh), and I now get plenty of doctest failures, apparently due to missing packages (sympy, conway_polynomials, ...). Will have to rebuild, it seems...



---

archive/issue_comments_262561.json:
```json
{
    "body": "Yup, after a clean rebuild I get just these errors from \"make ptest\":\n\n```\n----------------------------------------------------------------------\nsage -t src/sage/libs/lcalc/lcalc_Lfunction.pyx  # 85 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1863.5 seconds\n    cpu time: 5238.4 seconds\n    cumulative wall time: 7144.0 seconds\nmake: *** [ptest] Error 1\n```\n",
    "created_at": "2015-10-12T12:50:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262561",
    "user": "cnassau"
}
```

Yup, after a clean rebuild I get just these errors from "make ptest":

```
----------------------------------------------------------------------
sage -t src/sage/libs/lcalc/lcalc_Lfunction.pyx  # 85 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1863.5 seconds
    cpu time: 5238.4 seconds
    cumulative wall time: 7144.0 seconds
make: *** [ptest] Error 1
```




---

archive/issue_comments_262562.json:
```json
{
    "body": "I wonder how to proceed from here: the resulting sage is functional, but libraries are only found in the original build-location. Using install_name_tool for all produced dynlibs seems unpractical to me...\n\nCould we maybe trick the linker into \"flat_namespace\" mode by exporting something like `CFLAGS=\"-Wl,-flat_namespace\"` globally? Any opinions if that might be a viable option?",
    "created_at": "2015-10-12T14:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262562",
    "user": "cnassau"
}
```

I wonder how to proceed from here: the resulting sage is functional, but libraries are only found in the original build-location. Using install_name_tool for all produced dynlibs seems unpractical to me...

Could we maybe trick the linker into "flat_namespace" mode by exporting something like `CFLAGS="-Wl,-flat_namespace"` globally? Any opinions if that might be a viable option?



---

archive/issue_comments_262563.json:
```json
{
    "body": "Replying to [comment:30 cnassau]:\n> Could we maybe trick the linker into \"flat_namespace\" mode by exporting something like `CFLAGS=\"-Wl,-flat_namespace\"` globally? \n\nNo. This breaks lots of things...",
    "created_at": "2015-10-12T16:53:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262563",
    "user": "cnassau"
}
```

Replying to [comment:30 cnassau]:
> Could we maybe trick the linker into "flat_namespace" mode by exporting something like `CFLAGS="-Wl,-flat_namespace"` globally? 

No. This breaks lots of things...



---

archive/issue_comments_262564.json:
```json
{
    "body": "All doctests pass for me with the attached branch, although the linker really doesn't like having `MACOSX_DEPLOYMENT_TARGET` being set to 10.9.\n----\nNew commits:",
    "created_at": "2015-10-13T02:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262564",
    "user": "ohanar"
}
```

All doctests pass for me with the attached branch, although the linker really doesn't like having `MACOSX_DEPLOYMENT_TARGET` being set to 10.9.
----
New commits:



---

archive/issue_comments_262565.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-10-13T02:15:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262565",
    "user": "ohanar"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_262566.json:
```json
{
    "body": "I thought I had done `lcalc`, obviously not. I am guessing that may have been a big source of my troubles.",
    "created_at": "2015-10-13T04:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262566",
    "user": "fbissey"
}
```

I thought I had done `lcalc`, obviously not. I am guessing that may have been a big source of my troubles.



---

archive/issue_comments_262567.json:
```json
{
    "body": "OK testing it. Andrew, is it ok if I review your changes and you review mine? I guess Christian can do some reviewing too. That would mean we would have one reviewer that is not also an author.",
    "created_at": "2015-10-13T21:15:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262567",
    "user": "fbissey"
}
```

OK testing it. Andrew, is it ok if I review your changes and you review mine? I guess Christian can do some reviewing too. That would mean we would have one reviewer that is not also an author.



---

archive/issue_comments_262568.json:
```json
{
    "body": "And `sage` starts here too. I'll run the doctests overnight since my poor laptop is not that fast. But I am not expecting any problems. Please check I didn't do anything wrong with your name in the appropriate fields Andrew.",
    "created_at": "2015-10-14T02:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262568",
    "user": "fbissey"
}
```

And `sage` starts here too. I'll run the doctests overnight since my poor laptop is not that fast. But I am not expecting any problems. Please check I didn't do anything wrong with your name in the appropriate fields Andrew.



---

archive/issue_comments_262569.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-10-14T02:05:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262569",
    "user": "fbissey"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_262570.json:
```json
{
    "body": "Replying to [comment:34 fbissey]:\n> OK testing it. Andrew, is it ok if I review your changes and you review mine? I guess Christian can do some reviewing too. That would mean we would have one reviewer that is not also an author.\n\nAndrew's last changes for `lcalc` also fixes the one doctest failure that I saw previously. `\"make ptest\"` works for me now, so I think compile-wise everything is as it should be. \n\nI have a couple of issues on my mind that I think should be addressed. Pls feel free to convince me that these are non-issues and/or better addressed in a different ticket:\n\n- testing compilation of optional packages (so far no tests have been done)\n\n- how do we deal with the fact that the resulting sage is broken when you move it to a different folder?\n\nThis second issue is not fixable by changing compilation options, I believe, so we should just forbid relocation. I think something like this is required:\n\n  1) \"sage --bdist\" should build sage in the directory \"/Application/SageMath-$Version-...\" and sage will only run in this directory.\n  2) The README in the resulting app should be updated to say that the Sage icon should be dragged into the Application folder. Alternatively, we should implement an installer.\n  3) `sage` should print a warning \"This copy of sage can only be run in dirctory /Application/Sage...\" and exit.",
    "created_at": "2015-10-14T07:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262570",
    "user": "cnassau"
}
```

Replying to [comment:34 fbissey]:
> OK testing it. Andrew, is it ok if I review your changes and you review mine? I guess Christian can do some reviewing too. That would mean we would have one reviewer that is not also an author.

Andrew's last changes for `lcalc` also fixes the one doctest failure that I saw previously. `"make ptest"` works for me now, so I think compile-wise everything is as it should be. 

I have a couple of issues on my mind that I think should be addressed. Pls feel free to convince me that these are non-issues and/or better addressed in a different ticket:

- testing compilation of optional packages (so far no tests have been done)

- how do we deal with the fact that the resulting sage is broken when you move it to a different folder?

This second issue is not fixable by changing compilation options, I believe, so we should just forbid relocation. I think something like this is required:

  1) "sage --bdist" should build sage in the directory "/Application/SageMath-$Version-..." and sage will only run in this directory.
  2) The README in the resulting app should be updated to say that the Sage icon should be dragged into the Application folder. Alternatively, we should implement an installer.
  3) `sage` should print a warning "This copy of sage can only be run in dirctory /Application/Sage..." and exit.



---

archive/issue_comments_262571.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-10-14T07:13:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262571",
    "user": "cnassau"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_262572.json:
```json
{
    "body": "Thanks for your comments Christian. I believe they raise very important point.\n\nIn this ticket I focused on getting sage to build, but we may need to emphasise that it is not currently relocatable at the end of the build process somewhere. There may be ways to fix that situation in the future but unless someone builds a special tool the task is complicated.\n\nThe suggestion of building in a standard location to produce redistributable binaries is interesting.\n\nSome optional packages may have similar issues with `install_name` that `singular` and al were displaying. Those should be inspected and fixed.\n\nBut I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately. I also should note that this ticket basically fixed outstanding issues from other old tickets (#16044 and #17513 were basically all about fixing `install_names` and it is now done properly). I would argue that it generally improves the quality of the build on any version of OS X. \n\nIssues about producing binaries, optional package and so on can be put in a follow up ticket, let people be able to build the thing.",
    "created_at": "2015-10-14T07:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262572",
    "user": "fbissey"
}
```

Thanks for your comments Christian. I believe they raise very important point.

In this ticket I focused on getting sage to build, but we may need to emphasise that it is not currently relocatable at the end of the build process somewhere. There may be ways to fix that situation in the future but unless someone builds a special tool the task is complicated.

The suggestion of building in a standard location to produce redistributable binaries is interesting.

Some optional packages may have similar issues with `install_name` that `singular` and al were displaying. Those should be inspected and fixed.

But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately. I also should note that this ticket basically fixed outstanding issues from other old tickets (#16044 and #17513 were basically all about fixing `install_names` and it is now done properly). I would argue that it generally improves the quality of the build on any version of OS X. 

Issues about producing binaries, optional package and so on can be put in a follow up ticket, let people be able to build the thing.



---

archive/issue_comments_262573.json:
```json
{
    "body": "> But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately.\n\nNo problem. Could you maybe create a new ticket for the follow up issues? I'd be happy to set this ticket back to positive-review then.",
    "created_at": "2015-10-14T07:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262573",
    "user": "cnassau"
}
```

> But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately.

No problem. Could you maybe create a new ticket for the follow up issues? I'd be happy to set this ticket back to positive-review then.



---

archive/issue_comments_262574.json:
```json
{
    "body": "The branch didn't work for me:\n\n\n\n```\nError building the documentation.\n\nNote: incremental documentation builds sometimes cause spurious\nerror messages. To be certain that these are real errors, run\n\"make doc-clean\" first and try again.\nTraceback (most recent call last):\n  File \"/Applications/sage-devel/src/doc/common/builder.py\", line 1626, in <module>\n    getattr(get_builder(name), type)()\n  File \"/Applications/sage-devel/src/doc/common/builder.py\", line 292, in _wrapper\n    getattr(get_builder(document), 'inventory')(*args, **kwds)\n  File \"/Applications/sage-devel/src/doc/common/builder.py\", line 503, in _wrapper\n    x.get(99999)\n  File \"/Applications/sage-devel/local/lib/python/multiprocessing/pool.py\", line 558, in get\n    raise self._value\nOSError: [polynomia] /Applications/sage-devel/src/doc/en/reference/polynomial_rings/index.rst:7: WARNING: toctree contains reference to nonexisting document u'sage/rings/polynomial/polynomial_ring_constructor'\n\nmake[2]: *** [doc-html] Error 1\nmake[1]: *** [all] Error 2\n\nreal\t28m59.891s\nuser\t106m18.548s\nsys\t10m28.679s\n***************************************************************\nError building Sage.\n\nThe following package(s) may have failed to build (not necessarily\nduring this run of 'make all'):\n\n* documentation: dochtml\n  log file: /Applications/sage-devel/logs/pkgs/../dochtml.log\n\nThe build directory may contain configuration files and other potentially\nhelpful information. WARNING: if you now run 'make' again, the build\ndirectory will, by default, be deleted. Set the environment variable\nSAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.\n\nmake: *** [all] Error 1\nCade:sage-devel yomcat$ ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath Version 6.9, Release Date: 2015-10-10                     \u2502\n\u2502 Type \"notebook()\" for the browser-based notebook interface.        \u2502\n\u2502 Type \"help()\" for help.                                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\nForcing sage-location, probably because a new package was installed.\nUpdating various hardcoded paths...\n(Please wait at most a few minutes.)\nDO NOT INTERRUPT THIS.\nDone updating paths.\n\n**********************************************************************\n\nOops, Sage crashed. We do our best to make it stable, but...\n\nA crash report was automatically generated with the following information:\n  - A verbatim copy of the crash traceback.\n  - A copy of your input history during this session.\n  - Data on your current Sage configuration.\n\nIt was left in the file named:\n\t'/Users/yomcat/.sage/ipython_genutils-0.1.0/Sage_crash_report.txt'\nIf you can email this file to the developers, the information in it will help\nthem in understanding and correcting the problem.\n\nYou can mail it to: sage-support at sage-support@googlegroups.com\nwith the subject 'Sage Crash Report'.\n\nIf you want to do it now, the following command will work (under Unix):\nmail -s 'Sage Crash Report' sage-support@googlegroups.com < /Users/yomcat/.sage/ipython_genutils-0.1.0/Sage_crash_report.txt\n\nTo ensure accurate tracking of this issue, please file a report about it at:\nhttp://trac.sagemath.org\n\nHit <Enter> to quit (your terminal may close):\n```\n\n\nI may have done something wrong however.",
    "created_at": "2015-10-14T08:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262574",
    "user": "yomcat"
}
```

The branch didn't work for me:



```
Error building the documentation.

Note: incremental documentation builds sometimes cause spurious
error messages. To be certain that these are real errors, run
"make doc-clean" first and try again.
Traceback (most recent call last):
  File "/Applications/sage-devel/src/doc/common/builder.py", line 1626, in <module>
    getattr(get_builder(name), type)()
  File "/Applications/sage-devel/src/doc/common/builder.py", line 292, in _wrapper
    getattr(get_builder(document), 'inventory')(*args, **kwds)
  File "/Applications/sage-devel/src/doc/common/builder.py", line 503, in _wrapper
    x.get(99999)
  File "/Applications/sage-devel/local/lib/python/multiprocessing/pool.py", line 558, in get
    raise self._value
OSError: [polynomia] /Applications/sage-devel/src/doc/en/reference/polynomial_rings/index.rst:7: WARNING: toctree contains reference to nonexisting document u'sage/rings/polynomial/polynomial_ring_constructor'

make[2]: *** [doc-html] Error 1
make[1]: *** [all] Error 2

real	28m59.891s
user	106m18.548s
sys	10m28.679s
***************************************************************
Error building Sage.

The following package(s) may have failed to build (not necessarily
during this run of 'make all'):

* documentation: dochtml
  log file: /Applications/sage-devel/logs/pkgs/../dochtml.log

The build directory may contain configuration files and other potentially
helpful information. WARNING: if you now run 'make' again, the build
directory will, by default, be deleted. Set the environment variable
SAGE_KEEP_BUILT_SPKGS to 'yes' to prevent this.

make: *** [all] Error 1
Cade:sage-devel yomcat$ ./sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath Version 6.9, Release Date: 2015-10-10                     │
│ Type "notebook()" for the browser-based notebook interface.        │
│ Type "help()" for help.                                            │
└────────────────────────────────────────────────────────────────────┘
Forcing sage-location, probably because a new package was installed.
Updating various hardcoded paths...
(Please wait at most a few minutes.)
DO NOT INTERRUPT THIS.
Done updating paths.

**********************************************************************

Oops, Sage crashed. We do our best to make it stable, but...

A crash report was automatically generated with the following information:
  - A verbatim copy of the crash traceback.
  - A copy of your input history during this session.
  - Data on your current Sage configuration.

It was left in the file named:
	'/Users/yomcat/.sage/ipython_genutils-0.1.0/Sage_crash_report.txt'
If you can email this file to the developers, the information in it will help
them in understanding and correcting the problem.

You can mail it to: sage-support at sage-support@googlegroups.com
with the subject 'Sage Crash Report'.

If you want to do it now, the following command will work (under Unix):
mail -s 'Sage Crash Report' sage-support@googlegroups.com < /Users/yomcat/.sage/ipython_genutils-0.1.0/Sage_crash_report.txt

To ensure accurate tracking of this issue, please file a report about it at:
http://trac.sagemath.org

Hit <Enter> to quit (your terminal may close):
```


I may have done something wrong however.



---

archive/issue_comments_262575.json:
```json
{
    "body": "Replying to [comment:39 yomcat]:\nHard to say what the problem could be without looking into the build logs. I would suggest to try a (very) clean rebuild first, using a fresh checkout; without the fixes in this branch you might end up with a corrupted \"gcc\" in local/bin, and that potentially messes up every subsequent build in the same installation. I would suggest to\n\n- use a fresh checkout\n- make sure the environment is sane (no CC, CXX, CFLAGS, etc.)\n- build single-threaded, i.e. no MAKE=\"make -j...\"\n\nIf this also fails it might help to post the full build log somewhere.",
    "created_at": "2015-10-14T09:16:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262575",
    "user": "cnassau"
}
```

Replying to [comment:39 yomcat]:
Hard to say what the problem could be without looking into the build logs. I would suggest to try a (very) clean rebuild first, using a fresh checkout; without the fixes in this branch you might end up with a corrupted "gcc" in local/bin, and that potentially messes up every subsequent build in the same installation. I would suggest to

- use a fresh checkout
- make sure the environment is sane (no CC, CXX, CFLAGS, etc.)
- build single-threaded, i.e. no MAKE="make -j..."

If this also fails it might help to post the full build log somewhere.



---

archive/issue_comments_262576.json:
```json
{
    "body": "Replying to [comment:40 cnassau]:\n\nI redid the build with a `make distclean` (I did this the first time, but I think something went wrong with it), followed by `export MAKE=\"make -j6\"; make ptestlong`, and all tests passed.",
    "created_at": "2015-10-14T17:50:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262576",
    "user": "yomcat"
}
```

Replying to [comment:40 cnassau]:

I redid the build with a `make distclean` (I did this the first time, but I think something went wrong with it), followed by `export MAKE="make -j6"; make ptestlong`, and all tests passed.



---

archive/issue_comments_262577.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-10-14T18:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262577",
    "user": "cnassau"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_262578.json:
```json
{
    "body": "Replying to [comment:41 yomcat]:\n> Replying to [comment:40 cnassau]:\n> \n> I redid the build with a `make distclean` (I did this the first time, but I think something went wrong with it), followed by `export MAKE=\"make -j6\"; make ptestlong`, and all tests passed.\n\nWonderful! I'll give this ticket its positive review back then.",
    "created_at": "2015-10-14T18:10:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262578",
    "user": "cnassau"
}
```

Replying to [comment:41 yomcat]:
> Replying to [comment:40 cnassau]:
> 
> I redid the build with a `make distclean` (I did this the first time, but I think something went wrong with it), followed by `export MAKE="make -j6"; make ptestlong`, and all tests passed.

Wonderful! I'll give this ticket its positive review back then.



---

archive/issue_comments_262579.json:
```json
{
    "body": "Replying to [comment:38 cnassau]:\n> \n> > But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately.\n> \n> No problem. Could you maybe create a new ticket for the follow up issues? I'd be happy to set this ticket back to positive-review then.\n\nI have now created #19410 for this.",
    "created_at": "2015-10-14T18:18:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262579",
    "user": "cnassau"
}
```

Replying to [comment:38 cnassau]:
> 
> > But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately.
> 
> No problem. Could you maybe create a new ticket for the follow up issues? I'd be happy to set this ticket back to positive-review then.

I have now created #19410 for this.



---

archive/issue_comments_262580.json:
```json
{
    "body": "We could support \"upgrading\" to `El Capitan` by bumping the versions of `lcalc`, `R`, `singular` and `cliquer`. That would force their rebuild.",
    "created_at": "2015-10-14T20:30:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262580",
    "user": "fbissey"
}
```

We could support "upgrading" to `El Capitan` by bumping the versions of `lcalc`, `R`, `singular` and `cliquer`. That would force their rebuild.



---

archive/issue_comments_262581.json:
```json
{
    "body": "With this branch on OS X 10.11, Cython failed its test suite for me. See [log file http://www.math.washington.edu/~palmieri/Sage/cython-0.23.1.p0.log].\n\nShould we set this back to \"needs work\"?\n\n(I also had a failure with gf2x, but I think that was an instance of #18882. It passed its test suite when I ran it a second time.)",
    "created_at": "2015-10-15T23:02:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262581",
    "user": "jhpalmieri"
}
```

With this branch on OS X 10.11, Cython failed its test suite for me. See [log file http://www.math.washington.edu/~palmieri/Sage/cython-0.23.1.p0.log].

Should we set this back to "needs work"?

(I also had a failure with gf2x, but I think that was an instance of #18882. It passed its test suite when I ran it a second time.)



---

archive/issue_comments_262582.json:
```json
{
    "body": "I am quite unwilling to put it back to work personally but this needs investigating. Would upgrading `cython` to 0.23.3 (#19334) improve the situation? And of course is it an `El Capitan` only problem or does it show up anywhere else?",
    "created_at": "2015-10-15T23:14:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262582",
    "user": "fbissey"
}
```

I am quite unwilling to put it back to work personally but this needs investigating. Would upgrading `cython` to 0.23.3 (#19334) improve the situation? And of course is it an `El Capitan` only problem or does it show up anywhere else?



---

archive/issue_comments_262583.json:
```json
{
    "body": "Just do it on a separate ticket.",
    "created_at": "2015-10-16T00:31:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262583",
    "user": "vbraun"
}
```

Just do it on a separate ticket.



---

archive/issue_comments_262584.json:
```json
{
    "body": "I see the same problem on OS X 10.10, so let's keep this as \"positive review\".",
    "created_at": "2015-10-16T00:34:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262584",
    "user": "jhpalmieri"
}
```

I see the same problem on OS X 10.10, so let's keep this as "positive review".



---

archive/issue_comments_262585.json:
```json
{
    "body": "> But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately. I also should note that this ticket basically fixed outstanding issues from other old tickets (#16044 and #17513 were basically all about fixing `install_names` and it is now done properly). I would argue that it generally improves the quality of the build on any version of OS X. \n\nSo would you feel that #16044 is now invalid/fixed?  Certainly that would seem to be the case, though the relocation issue isn't fixed, I guess.  Anyway I have now finally given up on building anything after Sage 6.4.1 on PPC Macs because of a few different issues, not least of which is the continued upward spiral of gcc versions.  (Naturally one definitely can build it!  But not so easily from scratch, you must first build a newer gcc to build the newest gcc, and that's not automatic enough for me to bother with it.)",
    "created_at": "2015-10-16T01:47:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262585",
    "user": "kcrisman"
}
```

> But I think we have an important milestone, `sage` can be built on `El Capitan` and I think after adding a warning we should merge it immediately. I also should note that this ticket basically fixed outstanding issues from other old tickets (#16044 and #17513 were basically all about fixing `install_names` and it is now done properly). I would argue that it generally improves the quality of the build on any version of OS X. 

So would you feel that #16044 is now invalid/fixed?  Certainly that would seem to be the case, though the relocation issue isn't fixed, I guess.  Anyway I have now finally given up on building anything after Sage 6.4.1 on PPC Macs because of a few different issues, not least of which is the continued upward spiral of gcc versions.  (Naturally one definitely can build it!  But not so easily from scratch, you must first build a newer gcc to build the newest gcc, and that's not automatic enough for me to bother with it.)



---

archive/issue_comments_262586.json:
```json
{
    "body": "I suggest we mark it won't fix. I have no machine and no intentions to test this on Tiger. But yes in principle it would solve the issues. Funny that I was kind of force to push a branch to get sage to build on a new version of OS X with fix that were spotted that far back (and for which there was solutions that far back too).",
    "created_at": "2015-10-16T01:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262586",
    "user": "fbissey"
}
```

I suggest we mark it won't fix. I have no machine and no intentions to test this on Tiger. But yes in principle it would solve the issues. Funny that I was kind of force to push a branch to get sage to build on a new version of OS X with fix that were spotted that far back (and for which there was solutions that far back too).



---

archive/issue_comments_262587.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-10-16T08:22:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262587",
    "user": "vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_262588.json:
```json
{
    "body": "for uniqueness of names",
    "created_at": "2017-07-19T09:22:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/19133",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/19133#issuecomment-262588",
    "user": "chapoton"
}
```

for uniqueness of names
