# Issue 18808: better subs method for matrices

archive/issues_018808.json:
```json
{
    "body": "As mentioned on [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n2Sc8moP7Jk) the `.subs()` method of matrices behaves badly with polynomials.\n\n```python\nsage: x = polygen(ZZ)\nsage: matrix([[x]]).subs(x=1)\nTraceback (most recent call last):\n...\nValueError: must not specify both a keyword and positional argument\nsage: x.subs(1).parent()\nInteger Ring\nsage: matrix([[x]]).subs(1).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Univariate\nPolynomial Ring in x over Integer Ring\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/19045\n\n",
    "created_at": "2015-08-17T11:05:40Z",
    "labels": [
        "component: linear algebra"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.9",
    "title": "better subs method for matrices",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/18808",
    "user": "https://github.com/videlec"
}
```
As mentioned on [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n2Sc8moP7Jk) the `.subs()` method of matrices behaves badly with polynomials.

```python
sage: x = polygen(ZZ)
sage: matrix([[x]]).subs(x=1)
Traceback (most recent call last):
...
ValueError: must not specify both a keyword and positional argument
sage: x.subs(1).parent()
Integer Ring
sage: matrix([[x]]).subs(1).parent()
Full MatrixSpace of 1 by 1 dense matrices over Univariate
Polynomial Ring in x over Integer Ring
```

Issue created by migration from https://trac.sagemath.org/ticket/19045





---

archive/issue_comments_256932.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2015-08-17T11:09:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256932",
    "user": "https://github.com/videlec"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_256933.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T11:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256933",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256934.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-17T12:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256934",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_256935.json:
```json
{
    "body": "Looks good. What about 'does on coefficient': isn't a 's' missing there?\n\nOtherwise it's good. Regardless of what you choose to do with this, you can set the ticket to `positive_review` on my behalf.\n\nNathann",
    "created_at": "2015-08-17T12:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256935",
    "user": "https://github.com/nathanncohen"
}
```

Looks good. What about 'does on coefficient': isn't a 's' missing there?

Otherwise it's good. Regardless of what you choose to do with this, you can set the ticket to `positive_review` on my behalf.

Nathann



---

archive/issue_comments_256936.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2015-08-17T12:02:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256936",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_256937.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-17T12:02:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256937",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_256938.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-17T12:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256938",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_256939.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2015-08-17T12:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256939",
    "user": "https://github.com/videlec"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_256940.json:
```json
{
    "body": "Thanks Nathann.",
    "created_at": "2015-08-17T12:19:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256940",
    "user": "https://github.com/videlec"
}
```

Thanks Nathann.



---

archive/issue_comments_256941.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2015-08-17T13:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256941",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_256942.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2015-08-17T13:11:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256942",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_256943.json:
```json
{
    "body": "The current situation is not homogeneous:\n\n```\nsage: R.<x> = ZZ[]\nsage: M = matrix([[x]])\nsage: M.subs({x:1}).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Integer Ring\n\nsage: R.<x,y,z> = ZZ[]\nsage: M = matrix([[x]])\nsage: M.subs({x:1}).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring\n```\n\nThis is probably due to a problem in the substitution at the polynomial level.\n\nAlso, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.",
    "created_at": "2015-08-17T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256943",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

The current situation is not homogeneous:

```
sage: R.<x> = ZZ[]
sage: M = matrix([[x]])
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Integer Ring

sage: R.<x,y,z> = ZZ[]
sage: M = matrix([[x]])
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring
```

This is probably due to a problem in the substitution at the polynomial level.

Also, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.



---

archive/issue_comments_256944.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-17T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256944",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_256945.json:
```json
{
    "body": "Even worse:\n\n```\nsage: R.<x,y,z> = ZZ[]\nsage: M = matrix([[x]])\nsage: M.subs({x:1}).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring\nsage: M.subs({x:RDF(1)}).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Real Double Field\n```",
    "created_at": "2015-08-17T13:32:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256945",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Even worse:

```
sage: R.<x,y,z> = ZZ[]
sage: M = matrix([[x]])
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring
sage: M.subs({x:RDF(1)}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Real Double Field
```



---

archive/issue_comments_256946.json:
```json
{
    "body": "Replying to [comment:9 tmonteil]: \n> This is probably due to a problem in the substitution at the polynomial level.\n\n\nIt is. And then indepent of this ticket.\n\n```\nsage: R.<x,y,z> = ZZ[]\nsage: x.subs(x=1).parent()\nMultivariate Polynomial Ring in x, y, z over Integer Ring\nsage: x.subs(x=RDF(1)).parent()\nReal Double Field\n```\nThe above subs is clearly broken and you are welcome to fix it.\n\nThe method `matrix.subs()` is just a shortcut to apply `subs` to all coefficients. It is needed because otherwise there is the one that is inherited from `Element`.\n\n> Also, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.\n\n\nI do not see what I can do better for the sake of this ticket. This is not clear enough to me what I should do. Perhaps opening a ticket \"give specifications for subs and include it in the coercion model\"?",
    "created_at": "2015-08-17T13:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256946",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:9 tmonteil]: 
> This is probably due to a problem in the substitution at the polynomial level.


It is. And then indepent of this ticket.

```
sage: R.<x,y,z> = ZZ[]
sage: x.subs(x=1).parent()
Multivariate Polynomial Ring in x, y, z over Integer Ring
sage: x.subs(x=RDF(1)).parent()
Real Double Field
```
The above subs is clearly broken and you are welcome to fix it.

The method `matrix.subs()` is just a shortcut to apply `subs` to all coefficients. It is needed because otherwise there is the one that is inherited from `Element`.

> Also, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.


I do not see what I can do better for the sake of this ticket. This is not clear enough to me what I should do. Perhaps opening a ticket "give specifications for subs and include it in the coercion model"?



---

archive/issue_comments_256947.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2015-08-31T09:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256947",
    "user": "https://github.com/nathanncohen"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_256948.json:
```json
{
    "body": "I'm setting this back to `positive_review`, as comment [comment:9] is no reason to hold this branch.\n\nNathann",
    "created_at": "2015-08-31T09:35:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256948",
    "user": "https://github.com/nathanncohen"
}
```

I'm setting this back to `positive_review`, as comment [comment:9] is no reason to hold this branch.

Nathann



---

archive/issue_events_052998.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2015-09-01T14:06:53Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/18808#event-52998"
}
```



---

archive/issue_comments_256949.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2015-09-01T14:06:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256949",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_256950.json:
```json
{
    "body": "- the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?\n\n- the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.\n\n- having ticket merged that fast is a good way not to fix the real problem.",
    "created_at": "2015-09-01T14:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256950",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

- the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?

- the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.

- having ticket merged that fast is a good way not to fix the real problem.



---

archive/issue_comments_256951.json:
```json
{
    "body": "Replying to [comment:14 tmonteil]:\n> - the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?\n\n\nYes\n\n```\nsage: R.<x> = PolynomialRing(ZZ) \nsage: m = matrix(R, [[x]]) \nsage: m.subs(3).parent()\nFull MatrixSpace of 1 by 1 dense matrices over Integer Ring\n```\n\n> - the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.\n\n\nThis is **not** a dependency. But I opened #19130.\n\n> - having ticket merged that fast is a good way not to fix the real problem.\n\n\nnot merging ticket is also a good way to not fix it ;-)",
    "created_at": "2015-09-04T00:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/18808",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/18808#issuecomment-256951",
    "user": "https://github.com/videlec"
}
```

Replying to [comment:14 tmonteil]:
> - the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?


Yes

```
sage: R.<x> = PolynomialRing(ZZ) 
sage: m = matrix(R, [[x]]) 
sage: m.subs(3).parent()
Full MatrixSpace of 1 by 1 dense matrices over Integer Ring
```

> - the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.


This is **not** a dependency. But I opened #19130.

> - having ticket merged that fast is a good way not to fix the real problem.


not merging ticket is also a good way to not fix it ;-)
