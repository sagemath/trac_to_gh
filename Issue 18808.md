# Issue 18808: better subs method for matrices

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2015-08-17 11:05:40

As mentioned on [this sage-devel thread](https://groups.google.com/forum/#!topic/sage-devel/n2Sc8moP7Jk) the `.subs()` method of matrices behaves badly with polynomials.

```python
sage: x = polygen(ZZ)
sage: matrix([This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)).subs(x=1)
Traceback (most recent call last):
...
ValueError: must not specify both a keyword and positional argument
sage: x.subs(1).parent()
Integer Ring
sage: matrix([This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)).subs(1).parent()
Full MatrixSpace of 1 by 1 dense matrices over Univariate
Polynomial Ring in x over Integer Ring
```



---

Comment by vdelecroix created at 2015-08-17 11:09:27

Changing status from new to needs_review.


---

Comment by git created at 2015-08-17 11:09:34

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2015-08-17 12:02:32

Changing status from needs_review to positive_review.


---

Comment by ncohen created at 2015-08-17 12:02:32

Looks good. What about 'does on coefficient': isn't a 's' missing there?

Otherwise it's good. Regardless of what you choose to do with this, you can set the ticket to `positive_review` on my behalf.

Nathann


---

Comment by ncohen created at 2015-08-17 12:02:41

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2015-08-17 12:02:48

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-08-17 12:17:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2015-08-17 12:19:35

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2015-08-17 12:19:35

Thanks Nathann.


---

Comment by git created at 2015-08-17 13:11:24

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2015-08-17 13:11:24

Changing status from positive_review to needs_review.


---

Comment by tmonteil created at 2015-08-17 13:27:54

The current situation is not homogeneous:


```
sage: R.<x> = ZZ[]
sage: M = matrix([This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro))
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Integer Ring

sage: R.<x,y,z> = ZZ[]
sage: M = matrix([This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro))
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring
```


This is probably due to a problem in the substitution at the polynomial level.

Also, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.


---

Comment by tmonteil created at 2015-08-17 13:27:54

Changing status from needs_review to needs_work.


---

Comment by tmonteil created at 2015-08-17 13:32:59

Even worse:


```
sage: R.<x,y,z> = ZZ[]
sage: M = matrix([This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro))
sage: M.subs({x:1}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Multivariate Polynomial Ring in x, y, z over Integer Ring
sage: M.subs({x:RDF(1)}).parent()
Full MatrixSpace of 1 by 1 dense matrices over Real Double Field
```



---

Comment by vdelecroix created at 2015-08-17 13:40:23

Replying to [comment:9 tmonteil]: 
> This is probably due to a problem in the substitution at the polynomial level.

It is. And then indepent of this ticket.

```
sage: R.<x,y,z> = ZZ[]
sage: x.subs(x=1).parent()
Multivariate Polynomial Ring in x, y, z over Integer Ring
sage: x.subs(x=RDF(1)).parent()
Real Double Field
```

The above subs is clearly broken and you are welcome to fix it.

The method `matrix.subs()` is just a shortcut to apply `subs` to all coefficients. It is needed because otherwise there is the one that is inherited from `Element`.

> Also, the parent of the result should be determined by the parent of the matrix and the parent of the substitued values, not only the entries of the result, or it will be unpredictable.

I do not see what I can do better for the sake of this ticket. This is not clear enough to me what I should do. Perhaps opening a ticket "give specifications for subs and include it in the coercion model"?


---

Comment by ncohen created at 2015-08-31 09:35:54

Changing status from needs_work to positive_review.


---

Comment by ncohen created at 2015-08-31 09:35:54

I'm setting this back to `positive_review`, as comment [comment:9] is no reason to hold this branch.

Nathann


---

Comment by vbraun created at 2015-09-01 14:06:53

Resolution: fixed


---

Comment by tmonteil created at 2015-09-01 14:35:56

- the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?

- the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.

- having ticket merged that fast is a good way not to fix the real problem.


---

Comment by vdelecroix created at 2015-09-04 00:12:24

Replying to [comment:14 tmonteil]:
> - the problem this ticket is supposed to address is about the .subs() method changing the parent (see the linked thread). Is it fixed ?

Yes

```
sage: R.<x> = PolynomialRing(ZZ) 
sage: m = matrix(R, [This is the Trac macro *x* that was inherited from the migration](https://trac.sagemath.org/wiki/WikiMacros#x-macro)) 
sage: m.subs(3).parent()
Full MatrixSpace of 1 by 1 dense matrices over Integer Ring
```


> - the problem actually comes from an inconsistent subs for polynomials. This is usually called a dependency, and there is even a field for that on trac, so that we ensure the actual problem get solved.

This is *not* a dependency. But I opened #19130.

> - having ticket merged that fast is a good way not to fix the real problem.

not merging ticket is also a good way to not fix it ;-)
