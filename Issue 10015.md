# Issue 10015: R's spkg-install calls "sage -f ..." to install the contained Rpy spkg

archive/issues_010015.json:
```json
{
    "body": "Assignee: @nexttime\n\nCC:  @qed777\n\nKeywords: sage-spkg deps scripts dependency\n\nThis already caused trouble when the Sage scripts spkg wasn't yet installed, and making all standard packages depend on the complete set of Sage scripts (which had actually then been done) is an overkill.\n\nThere's a lot wrong with this spkg, and the Rpy spkg should be moved out of R's (#9906), but as a short-term solution, I decided to just replace the call to `$SAGE_ROOT/sage` (which requires `sage-sage`) by a direct one to `$SAGE_ROOT/local/bin/sage-spkg`, which should be present in any case, s.t. we don't have to make the R spkg depend on the Sage scripts spkg.\n\nThe new p4 spkg does not address any other issues.\n\nIssue created by migration from https://trac.sagemath.org/ticket/10016\n\n",
    "created_at": "2010-09-25T20:52:27Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-4.6",
    "title": "R's spkg-install calls \"sage -f ...\" to install the contained Rpy spkg",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/10015",
    "user": "https://github.com/nexttime"
}
```
Assignee: @nexttime

CC:  @qed777

Keywords: sage-spkg deps scripts dependency

This already caused trouble when the Sage scripts spkg wasn't yet installed, and making all standard packages depend on the complete set of Sage scripts (which had actually then been done) is an overkill.

There's a lot wrong with this spkg, and the Rpy spkg should be moved out of R's (#9906), but as a short-term solution, I decided to just replace the call to `$SAGE_ROOT/sage` (which requires `sage-sage`) by a direct one to `$SAGE_ROOT/local/bin/sage-spkg`, which should be present in any case, s.t. we don't have to make the R spkg depend on the Sage scripts spkg.

The new p4 spkg does not address any other issues.

Issue created by migration from https://trac.sagemath.org/ticket/10016





---

archive/issue_comments_100419.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2010-09-25T22:37:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100419",
    "user": "https://github.com/nexttime"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_100420.json:
```json
{
    "body": "Attachment [trac_10016-r-2.10.1.p3-p4.spkg.patch](tarball://root/attachments/some-uuid/ticket10016/trac_10016-r-2.10.1.p3-p4.spkg.patch) by @nexttime created at 2010-09-25 22:49:47\n\nDiff between the p3 and p4 spkg (actually a Mercurial patch). For reference/review.",
    "created_at": "2010-09-25T22:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100420",
    "user": "https://github.com/nexttime"
}
```

Attachment [trac_10016-r-2.10.1.p3-p4.spkg.patch](tarball://root/attachments/some-uuid/ticket10016/trac_10016-r-2.10.1.p3-p4.spkg.patch) by @nexttime created at 2010-09-25 22:49:47

Diff between the p3 and p4 spkg (actually a Mercurial patch). For reference/review.



---

archive/issue_comments_100421.json:
```json
{
    "body": "\n```\n# sage -f \"$RPY_VER\".spkg # EVIL\n```\n\nI think you have different standards of evil than I do :)\n\nBut this sounds like a good intermediate step here.  What I understand of the change in the script makes sense.  I don't know how `tee` works, and whether `pipestatus` really is in the path or what it does, so I sadly can't review this.  Maybe you should cc: the maintainers?  (Which I think are jason and was.)",
    "created_at": "2010-09-26T00:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100421",
    "user": "https://github.com/kcrisman"
}
```


```
# sage -f "$RPY_VER".spkg # EVIL
```

I think you have different standards of evil than I do :)

But this sounds like a good intermediate step here.  What I understand of the change in the script makes sense.  I don't know how `tee` works, and whether `pipestatus` really is in the path or what it does, so I sadly can't review this.  Maybe you should cc: the maintainers?  (Which I think are jason and was.)



---

archive/issue_comments_100422.json:
```json
{
    "body": "I just noticed this doesn't fully work with spaces in the path, but since spaces aren't supported yet anyway (and most probably won't be soon), and this is just a temporary solution (cf. #9906), I'm not going to change the fairly large spkg again *here*...",
    "created_at": "2010-09-29T15:18:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100422",
    "user": "https://github.com/nexttime"
}
```

I just noticed this doesn't fully work with spaces in the path, but since spaces aren't supported yet anyway (and most probably won't be soon), and this is just a temporary solution (cf. #9906), I'm not going to change the fairly large spkg again *here*...



---

archive/issue_comments_100423.json:
```json
{
    "body": "Replying to [comment:3 leif]:\n> [...] I'm not going to change the fairly large spkg again *here*...\n\n... unless somebody finds other things that have to be fixed here.",
    "created_at": "2010-09-29T15:20:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100423",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:3 leif]:
> [...] I'm not going to change the fairly large spkg again *here*...

... unless somebody finds other things that have to be fixed here.



---

archive/issue_comments_100424.json:
```json
{
    "body": "So because of the tee command, is the install log for rpy going to appear in both r-2.10.1.p4.log and rpy2-2.0.8.log?\n\nI suppose I should try it and see.  Should I use the \"deps\" file from #9896?",
    "created_at": "2010-09-29T16:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100424",
    "user": "https://github.com/jhpalmieri"
}
```

So because of the tee command, is the install log for rpy going to appear in both r-2.10.1.p4.log and rpy2-2.0.8.log?

I suppose I should try it and see.  Should I use the "deps" file from #9896?



---

archive/issue_comments_100425.json:
```json
{
    "body": "Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.",
    "created_at": "2010-09-29T17:04:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100425",
    "user": "https://github.com/jhpalmieri"
}
```

Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.



---

archive/issue_comments_100426.json:
```json
{
    "body": "Trac...\n\nReplying to [comment:5 jhpalmieri]:\n> So because of the tee command, is the install log for rpy going to appear in both r-2.10.1.p4.log and rpy2-2.0.8.log?\n\nI will appear in both. Note that previously the `./sage -f ...` directly wrote (appended) to `$SAGE_ROOT/install.log` as well, which I consider also a bug.\n\n> I suppose I should try it and see.  Should I use the \"deps\" file from #9896?\n\nThis makes no difference, since R still depends on the scripts in both.\n(But you could remove the dependency of R on `sage_scripts` in the `deps.v2b` at #9896.)",
    "created_at": "2010-09-29T17:08:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100426",
    "user": "https://github.com/nexttime"
}
```

Trac...

Replying to [comment:5 jhpalmieri]:
> So because of the tee command, is the install log for rpy going to appear in both r-2.10.1.p4.log and rpy2-2.0.8.log?

I will appear in both. Note that previously the `./sage -f ...` directly wrote (appended) to `$SAGE_ROOT/install.log` as well, which I consider also a bug.

> I suppose I should try it and see.  Should I use the "deps" file from #9896?

This makes no difference, since R still depends on the scripts in both.
(But you could remove the dependency of R on `sage_scripts` in the `deps.v2b` at #9896.)



---

archive/issue_comments_100427.json:
```json
{
    "body": "LOL, `s/I will/It will/`.",
    "created_at": "2010-09-29T17:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100427",
    "user": "https://github.com/nexttime"
}
```

LOL, `s/I will/It will/`.



---

archive/issue_comments_100428.json:
```json
{
    "body": "Replying to [comment:6 jhpalmieri]:\n> Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.\n\nGood idea. But you should (at least) also remove `local/bin/sage-sage` to make such a test effective. In principle, you could remove everything from `local/bin` except `sage-spkg` and `sage-env` IIRC, but you'd have to install the new R spkg by copying it to `spkg/` and then running `make` (or just `make build`).\n\nOr rebuild Sage from scratch with the new R spkg and such deps, as I did...",
    "created_at": "2010-09-29T17:25:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100428",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:6 jhpalmieri]:
> Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.

Good idea. But you should (at least) also remove `local/bin/sage-sage` to make such a test effective. In principle, you could remove everything from `local/bin` except `sage-spkg` and `sage-env` IIRC, but you'd have to install the new R spkg by copying it to `spkg/` and then running `make` (or just `make build`).

Or rebuild Sage from scratch with the new R spkg and such deps, as I did...



---

archive/issue_comments_100429.json:
```json
{
    "body": "Replying to [comment:9 leif]:\n> Replying to [comment:6 jhpalmieri]:\n> > Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.\n> \n> Good idea. But you should (at least) also remove `local/bin/sage-sage` to make such a test effective. In principle, you could remove everything from `local/bin` except `sage-spkg` and `sage-env` IIRC, but you'd have to install the new R spkg by copying it to `spkg/` and then running `make` (or just `make build`).\n\nAnd of course remove `spkg/installed/sage_scripts-*` before running `make`.\n\n> Or rebuild Sage from scratch with the new R spkg and such deps, as I did...",
    "created_at": "2010-09-29T17:31:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100429",
    "user": "https://github.com/nexttime"
}
```

Replying to [comment:9 leif]:
> Replying to [comment:6 jhpalmieri]:
> > Just to experiment, I took deps from #9896, took out the dependency of R on sage-scripts, and *put in* a dependency of sage-scripts on R.
> 
> Good idea. But you should (at least) also remove `local/bin/sage-sage` to make such a test effective. In principle, you could remove everything from `local/bin` except `sage-spkg` and `sage-env` IIRC, but you'd have to install the new R spkg by copying it to `spkg/` and then running `make` (or just `make build`).

And of course remove `spkg/installed/sage_scripts-*` before running `make`.

> Or rebuild Sage from scratch with the new R spkg and such deps, as I did...



---

archive/issue_comments_100430.json:
```json
{
    "body": "Argh, *\"copying it to `spkg/`\"* should read *\"copying it to `spkg/standard/`\"*.",
    "created_at": "2010-09-29T17:34:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100430",
    "user": "https://github.com/nexttime"
}
```

Argh, *"copying it to `spkg/`"* should read *"copying it to `spkg/standard/`"*.



---

archive/issue_comments_100431.json:
```json
{
    "body": "I wasn't clear: I'm building from scratch with the modified deps and the new R spkg, so I didn't need to remove anything.  (I had a few false starts, but \"make distclean\" fixed those.)",
    "created_at": "2010-09-29T17:52:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100431",
    "user": "https://github.com/jhpalmieri"
}
```

I wasn't clear: I'm building from scratch with the modified deps and the new R spkg, so I didn't need to remove anything.  (I had a few false starts, but "make distclean" fixed those.)



---

archive/issue_comments_100432.json:
```json
{
    "body": "This looks good to me.  With my purely experimental version of deps, it emphasizes the problem on #9434: since sage-scripts is installed very late, there are many warning messages about being unable to find sage-banner.",
    "created_at": "2010-09-29T21:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100432",
    "user": "https://github.com/jhpalmieri"
}
```

This looks good to me.  With my purely experimental version of deps, it emphasizes the problem on #9434: since sage-scripts is installed very late, there are many warning messages about being unable to find sage-banner.



---

archive/issue_comments_100433.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2010-09-29T21:04:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100433",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_100434.json:
```json
{
    "body": "Thanks for reviewing this.\n\nReplying to [comment:13 jhpalmieri]:\n> [...] With my purely experimental version of deps, it emphasizes the problem on #9434: since sage-scripts is installed very late, there are many warning messages about being unable to find sage-banner.\n\n:D",
    "created_at": "2010-09-29T21:08:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100434",
    "user": "https://github.com/nexttime"
}
```

Thanks for reviewing this.

Replying to [comment:13 jhpalmieri]:
> [...] With my purely experimental version of deps, it emphasizes the problem on #9434: since sage-scripts is installed very late, there are many warning messages about being unable to find sage-banner.

:D



---

archive/issue_comments_100435.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2010-09-29T23:55:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/10015#issuecomment-100435",
    "user": "https://github.com/qed777"
}
```

Resolution: fixed



---

archive/issue_events_025396.json:
```json
{
    "actor": "https://github.com/qed777",
    "created_at": "2010-09-29T23:55:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/10015",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/10015#event-25396"
}
```
