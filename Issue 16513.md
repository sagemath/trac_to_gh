# Issue 16513: libgap fails converting string GapElements to Sage

archive/issues_016513.json:
```json
{
    "body": "Keywords: conversion, string\n\nThis blocks combinatorial usage of libgap (see #16719):\n\n```\nsage: ans=libgap.eval(\"'c'\")\nsage: type(ans)\n<type 'sage.libs.gap.element.GapElement'>\nsage: ans.sage()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-3-3aef44f215a1> in <module>()\n----> 1 ans.sage()\n\n/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)()\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16750\n\n",
    "created_at": "2014-08-02T09:29:44Z",
    "labels": [
        "component: interfaces",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.3",
    "title": "libgap fails converting string GapElements to Sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16513",
    "user": "https://github.com/rwst"
}
```
Keywords: conversion, string

This blocks combinatorial usage of libgap (see #16719):

```
sage: ans=libgap.eval("'c'")
sage: type(ans)
<type 'sage.libs.gap.element.GapElement'>
sage: ans.sage()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-3-3aef44f215a1> in <module>()
----> 1 ans.sage()

/home/ralf/sage/local/lib/python2.7/site-packages/sage/libs/gap/element.so in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)()
```


Issue created by migration from https://trac.sagemath.org/ticket/16750





---

archive/issue_comments_217003.json:
```json
{
    "body": "To convert datatypes are supposed to use\n\n```\nsage: gap_string = libgap('sage_string')\nsage: gap_string.sage()\n'sage_string'\n```\nand not the eval() form. Though I agree that there is a bug in the eval().",
    "created_at": "2014-08-02T12:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217003",
    "user": "https://github.com/vbraun"
}
```

To convert datatypes are supposed to use

```
sage: gap_string = libgap('sage_string')
sage: gap_string.sage()
'sage_string'
```
and not the eval() form. Though I agree that there is a bug in the eval().



---

archive/issue_comments_217004.json:
```json
{
    "body": "The single quote is a single character constant in GAP. There is no single-character type in Python...\n\n```\nsage: libgap.eval(\"'ca'\")\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-27-41441932e6b8> in <module>()\n----> 1 libgap.eval(\"'ca'\")\n\n/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.Gap.eval (build/cythonized/sage/libs/gap/libgap.c:3790)()\n\n/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/libs/gap/util.so in sage.libs.gap.util.gap_eval (build/cythonized/sage/libs/gap/util.c:4487)()\n\nValueError: libGAP: Syntax error: missing single quote in character constant\n'ca';\n ^\n```",
    "created_at": "2014-08-02T12:50:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217004",
    "user": "https://github.com/vbraun"
}
```

The single quote is a single character constant in GAP. There is no single-character type in Python...

```
sage: libgap.eval("'ca'")
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-27-41441932e6b8> in <module>()
----> 1 libgap.eval("'ca'")

/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/libs/gap/libgap.so in sage.libs.gap.libgap.Gap.eval (build/cythonized/sage/libs/gap/libgap.c:3790)()

/home/vbraun/Code/sage/local/lib/python2.7/site-packages/sage/libs/gap/util.so in sage.libs.gap.util.gap_eval (build/cythonized/sage/libs/gap/util.c:4487)()

ValueError: libGAP: Syntax error: missing single quote in character constant
'ca';
 ^
```



---

archive/issue_comments_217005.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-08-02T13:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217005",
    "user": "https://github.com/vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_217006.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-08-02T13:11:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217006",
    "user": "https://github.com/vbraun"
}
```

New commits:



---

archive/issue_comments_217007.json:
```json
{
    "body": "Looks straightforward. I do not think any other doctest is affected so I spare me a patchbot run.",
    "created_at": "2014-08-03T06:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217007",
    "user": "https://github.com/rwst"
}
```

Looks straightforward. I do not think any other doctest is affected so I spare me a patchbot run.



---

archive/issue_comments_217008.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-03T06:03:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217008",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217009.json:
```json
{
    "body": "Holding back for just a moment, as I'm no longer sure it's ok.",
    "created_at": "2014-08-04T08:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217009",
    "user": "https://github.com/rwst"
}
```

Holding back for just a moment, as I'm no longer sure it's ok.



---

archive/issue_comments_217010.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-08-04T08:05:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217010",
    "user": "https://github.com/rwst"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_217011.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-04T09:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217011",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217012.json:
```json
{
    "body": "The `sage()` member function of `T_CHAR` will be passed to parent because no `T_CHAR` child is implemented.\n\n```\nsage: ans=libgap.eval(\"UnorderedTuples(['a', 'b', 'c'],2)\"); ans\n[ \"aa\", \"ab\", \"ac\", \"bb\", \"bc\", \"cc\" ]\nsage: a=ans[0]; a\n\"aa\"\nsage: a[0]\n'a'\nsage: type(_)\n<type 'sage.libs.gap.element.GapElement'>\nsage: a[0]._type_number()\n(9L, 'T_CHAR')\nsage: a[0].sage()\nTraceback (most recent call last):\n  File \"<ipython-input-50-b805c595d1a5>\", line 1, in <module>\n    a[Integer(0)].sage()\n  File \"element.pyx\", line 1024, in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)\nNotImplementedError: cannot construct equivalent Sage object\n```\nI have changed your patch according to my belief what went wrong. If you disagree then, well, fix it yourself 8)",
    "created_at": "2014-08-04T09:47:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217012",
    "user": "https://github.com/rwst"
}
```

The `sage()` member function of `T_CHAR` will be passed to parent because no `T_CHAR` child is implemented.

```
sage: ans=libgap.eval("UnorderedTuples(['a', 'b', 'c'],2)"); ans
[ "aa", "ab", "ac", "bb", "bc", "cc" ]
sage: a=ans[0]; a
"aa"
sage: a[0]
'a'
sage: type(_)
<type 'sage.libs.gap.element.GapElement'>
sage: a[0]._type_number()
(9L, 'T_CHAR')
sage: a[0].sage()
Traceback (most recent call last):
  File "<ipython-input-50-b805c595d1a5>", line 1, in <module>
    a[Integer(0)].sage()
  File "element.pyx", line 1024, in sage.libs.gap.element.GapElement.sage (build/cythonized/sage/libs/gap/element.c:8749)
NotImplementedError: cannot construct equivalent Sage object
```
I have changed your patch according to my belief what went wrong. If you disagree then, well, fix it yourself 8)



---

archive/issue_comments_217013.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-08-04T09:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_217014.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-08-04T09:52:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217014",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_217015.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-04T09:54:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217015",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_217016.json:
```json
{
    "body": "I read some more of the GAP String code and its pretty complicated with different string representations. I've replaced your commit. This also fixes the string convertion issue you noted on the other ticket. Can you give it at try?\n\n---\nNew commits:",
    "created_at": "2014-08-04T19:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217016",
    "user": "https://github.com/vbraun"
}
```

I read some more of the GAP String code and its pretty complicated with different string representations. I've replaced your commit. This also fixes the string convertion issue you noted on the other ticket. Can you give it at try?

---
New commits:



---

archive/issue_comments_217017.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-08-04T19:07:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217017",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_217018.json:
```json
{
    "body": "ptestlong:\n\n```\nsage -t --long src/sage/groups/braid.py  # 5 doctests failed\nsage -t --long src/sage/groups/finitely_presented.py  # 25 doctests failed\nsage -t --long src/sage/groups/finitely_presented_named.py  # 4 doctests failed\nsage -t --long src/sage/homology/simplicial_complex.py  # 3 doctests failed\nsage -t --long src/sage/groups/libgap_mixin.py  # 1 doctest failed\nsage -t --long src/sage/groups/perm_gps/partn_ref2/refinement_generic.pyx  # 1 doctest failed\nsage -t --long src/sage/groups/raag.py  # 16 doctests failed\nsage -t --long src/sage/groups/libgap_wrapper.pyx  # 1 doctest failed\n```\nAppears to go back to a single fail.",
    "created_at": "2014-08-05T09:42:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217018",
    "user": "https://github.com/rwst"
}
```

ptestlong:

```
sage -t --long src/sage/groups/braid.py  # 5 doctests failed
sage -t --long src/sage/groups/finitely_presented.py  # 25 doctests failed
sage -t --long src/sage/groups/finitely_presented_named.py  # 4 doctests failed
sage -t --long src/sage/homology/simplicial_complex.py  # 3 doctests failed
sage -t --long src/sage/groups/libgap_mixin.py  # 1 doctest failed
sage -t --long src/sage/groups/perm_gps/partn_ref2/refinement_generic.pyx  # 1 doctest failed
sage -t --long src/sage/groups/raag.py  # 16 doctests failed
sage -t --long src/sage/groups/libgap_wrapper.pyx  # 1 doctest failed
```
Appears to go back to a single fail.



---

archive/issue_comments_217019.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-08-05T15:23:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_217020.json:
```json
{
    "body": "Fails in new files:\n\n```\nsage -t --long src/sage/groups/perm_gps/permgroup.py  # 2 doctests failed\nsage -t --long src/sage/groups/perm_gps/permgroup_element.pyx  # 2 doctests failed\n```",
    "created_at": "2014-08-05T16:00:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217020",
    "user": "https://github.com/rwst"
}
```

Fails in new files:

```
sage -t --long src/sage/groups/perm_gps/permgroup.py  # 2 doctests failed
sage -t --long src/sage/groups/perm_gps/permgroup_element.pyx  # 2 doctests failed
```



---

archive/issue_comments_217021.json:
```json
{
    "body": "It does? I remembered to run tests this time and it works for me. Can you post the error?",
    "created_at": "2014-08-05T16:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217021",
    "user": "https://github.com/vbraun"
}
```

It does? I remembered to run tests this time and it works for me. Can you post the error?



---

archive/issue_comments_217022.json:
```json
{
    "body": "Don't know what *that was, it passes now after checking out a different branch, compiling, and back again.\n\nAnyway, it all looks good.",
    "created_at": "2014-08-06T06:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217022",
    "user": "https://github.com/rwst"
}
```

Don't know what *that was, it passes now after checking out a different branch, compiling, and back again.

Anyway, it all looks good.



---

archive/issue_comments_217023.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-08-06T06:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217023",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_049064.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2014-08-06T16:16:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16513#event-49064"
}
```



---

archive/issue_comments_217024.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-08-06T16:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16513",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16513#issuecomment-217024",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
