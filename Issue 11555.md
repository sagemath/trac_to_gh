# Issue 11555: Even more minor Cygwin fixes for FLINT

Issue created by migration from https://trac.sagemath.org/ticket/11727

Original creator: kcrisman

Original creation time: 2011-08-24 02:42:59

Assignee: tbd

CC:  mhansen dimpase leif jdemeyer

I'm not quite sure how this happened, but apparently in newer Cygwins patch won't accept certain things.

FLINT now doesn't actually work on one of my Cygwins, even after #11547, because of an extra line that crept into one of the patches.

```
--- src/mpn_extras.h	2009-09-23 18:03:27.000000000 +0800
+++ patches/mpn_extras.h	2011-04-25 22:36:33.000000000 +0800
@@ -22,7 +22,6 @@
 #ifndef MPN_EXTRAS_H
 #define MPN_EXTRAS_H
 
-#include "flint.h"
 #include "ZmodF_poly.h"
 
 #include "longlong_wrapper.h"

```

Note the newline at the end; removing this solves the problem.  I guess this didn't cause trouble on other systems, since these patches are applied universally.  I can't even figure out where this change happened.

See also #9858 and #10328 for other updates to FLINT needed.


---

Comment by dimpase created at 2011-08-24 03:01:15

I suppose here hg did not see the file being opened in Unix mode, and saved in DOS mode. If I open it in vim I see

```
--- src/mpn_extras.h    2009-09-23 18:03:27.000000000 +0800
+++ patches/mpn_extras.h        2011-04-25 22:36:33.000000000 +0800
@@ -22,7 +22,6 @@
 #ifndef MPN_EXTRAS_H^M
 #define MPN_EXTRAS_H^M
 ^M
-#include "flint.h"^M
 #include "ZmodF_poly.h"^M
 ^M
 #include "longlong_wrapper.h"^M
```

these `^M` are DOS LF/CR symbols. You can go over the spkg leading to this one, to track where exactly this got in.
I can only say that in p6 spkg I created back in April it was still OK.

What you need to do is to save this file in Unix mode and re-package...


---

Comment by kini created at 2011-08-24 03:32:44

The CR characters were introduced to this file in p7, as you can see by doing `hg log -p patches/mpn_extras.h.patch` in the spkg directory.


---

Comment by dimpase created at 2011-08-24 11:45:21

Replying to [comment:2 kini]:
> The CR characters were introduced to this file in p7, as you can see by doing `hg log -p patches/mpn_extras.h.patch` in the spkg directory.

in fact hg log -p mpn_extras.h.patch shows this change, done by Jeroen, so this came in p7. I cc to him. He didn't notice, apparently. The whole src/ directory is in DOS mode there...


---

Comment by kcrisman created at 2011-08-24 17:59:49

Okay, see [http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg](http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg) for a fix.  Can someone very quickly just check that this has fixed it? (I can't see this in pico/nano.)

I think that if it works for me, and you review it, then that would be sufficient for positive review.


---

Comment by kcrisman created at 2011-08-24 19:31:40

This fixes the problem.  I don't see any crud in the spkg, either.

cc:ing Jeroen as apparently he did it as well.  I'd appreciate a quick review for folks, if possible :)


---

Comment by kcrisman created at 2011-08-24 19:31:40

Changing status from new to needs_review.


---

Comment by dimpase created at 2011-08-25 02:22:31

Replying to [comment:4 kcrisman]:
> Okay, see [http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg](http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg) for a fix.  Can someone very quickly just check that this has fixed it? (I can't see this in pico/nano.)
> 
> I think that if it works for me, and you review it, then that would be sufficient for positive review.

patches/mpn_extras.h.patch
is in DOS mode. As well, some files in src/are in DOS mode, too.
Please convert all the files in the spkg into Unix mode.
This is in fact just on-liner (assuming dos2unix installed):

```
flint-1.5.0.p9$ find . -type f -exec dos2unix '{}' \;
```

New package, with this done, at http://boxen.math.washington.edu/home/dima/packages/flint-1.5.0.p9.spkg
I checked in on Linux and MacOSX only - please check on Cygwin.


---

Comment by kcrisman created at 2011-08-25 12:12:36

Thanks.  I have no idea what is going on with this - I only use Mac for developing (don't create patches/spkgs on Cygwin) so I am very unfamiliar with all this.  My editors don't show these things.  

(I'll try to check this on Cygwin soon - having some problems getting new builds started post 4.7.1, something might have changed in prereq or spkg/standard/deps.)


---

Comment by kcrisman created at 2011-08-25 13:24:32

Okay, your version did not change SPKG.txt (maybe mine didn't either?) so I did that, and then even added a tag for the p9 (thanks, [Leif](http://trac.sagemath.org/sage_trac/ticket/11550#comment:46)!) Still at [http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg](http://sage.math.washington.edu/home/kcrisman/flint-1.5.0.p9.spkg).


---

Comment by dimpase created at 2011-08-25 17:23:31

Replying to [comment:8 kcrisman]:
> Thanks.  I have no idea what is going on with this - I only use Mac for developing (don't create patches/spkgs on Cygwin) so I am very unfamiliar with all this.  My editors don't show these things.  

well, on every Mac there is vim, which you can run in terminal window - and it will show you the encoding...


---

Comment by kcrisman created at 2011-08-28 00:31:19

This still fixes the patch problem on Cygwin, builds ok.  Positive review.  Thanks, Dima, for catching the precise cause of this.


---

Comment by kcrisman created at 2011-08-28 00:31:19

Changing status from needs_review to positive_review.


---

Comment by leif created at 2011-08-28 00:52:14

How's the storm? Did all machines survive?

----

If you can tell me what _DOS *file* endings_ are... ;) (DOS actually used `^Z` to indicate the end of a text file.)

Hopefully this will be the last spkg in the FLINT 1.5.0 series, so I can finally rebase my 1.5.2 one on it.


---

Comment by dimpase created at 2011-08-28 05:52:12

Replying to [comment:12 leif]:
> How's the storm? Did all machines survive?
> 
> ----
> 
> If you can tell me what _DOS *file* endings_ are... ;) (DOS actually used `^Z` to indicate the end of a text file.)

yeah, "line endings" meant, indeed.


---

Comment by kcrisman created at 2011-08-29 19:38:23

> How's the storm? Did all machines survive?
Turned out to be more of a non-event here, fortunately.  Elsewhere on the US East Coast, not so much.
> Hopefully this will be the last spkg in the FLINT 1.5.0 series, so I can finally rebase my 1.5.2 one on it.
Yes, let's hope!


---

Comment by leif created at 2011-09-08 07:20:00

Please don't put tabs into the ticket's description, as trac (at least our current version) doesn't properly handle these (i.e., doesn't escape them when exporting).


---

Comment by leif created at 2011-09-12 18:23:52

Resolution: fixed
