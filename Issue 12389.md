# Issue 12389: Factoring padic polynomials

Issue created by migration from Trac.

Original creator: bsinclai

Original creation time: 2012-02-22 09:12:51

Assignee: roed

CC:  roed pbruin

A native sage implementation of padic polynomial factoring


---

Attachment


---

Comment by saraedum created at 2013-01-12 17:45:31

On the wiki page about padic factoring it says that the implementation doesn't work correctly for some examples. Is there only a problem with some specific cases? I just tried a few products of low degree polynomials and the factorizations seemed ok.

I want to try to debug the code, so if you know of any simple examples for which it doesn't work, that would be helpful.


---

Comment by bsinclai created at 2013-01-26 22:41:51

Other than the poor state of documentation and polish, I cannot find any faults.  I have run the code through all of the previously failed examples with no issue outside of occasionally having insufficient precision.  The newton polygon code does not elegantly handle the infinite slope case (the case where the current phi actually divides Phi), but it doesn't have to for factoring since it can be (and is) caught earlier in the loop.


---

Comment by spice created at 2013-02-28 18:37:51

Patch applies correctly on 7.5 and all doctests written so far pass. However:

In the doctest from `pfactortree()`:

```
sage: from sage.rings.polynomial.padics.factor.factoring import jorder4,pfactortree 
sage: f = ZpFM(2,24,'terse')['x']( (x^32+16)*(x^32+16+2^16*x^2)+2^34 ) 
sage: pfactortree(f) # long (3.8s) 
[(1 + O(2^24))*x^64 + (65536 + O(2^24))*x^34 + (32 + O(2^24))*x^32 + (1048576 + O(2^24))*x^2 + (256 + O(2^24))] 
```

This is just returning the polynomial unfactored, so demonstrably the factoring isn't working here. We should get:

```
sage: f = ZpFM(2,24,'terse')['x']( (x^32+16)*(x^32+16+2^16*x^2)+2^34 )
sage: f.factor()
((1 + O(2^24))*x^32 + (65536 + O(2^24))*x^2 + (16 + O(2^24))) * ((1 + O(2^24))*x^32 + (16 + O(2^24)))
```

Also, we should rework this code so that a sage Factorization object is returned, and that pfactortree is called by the `.factor()` method attached to p-adic polynomials.


---

Comment by roed created at 2013-03-01 22:09:16

Replying to [comment:3 spice]:
> Patch applies correctly on 7.5 and all doctests written so far pass. However:
> 
> In the doctest from `pfactortree()`:
> {{{
> sage: from sage.rings.polynomial.padics.factor.factoring import jorder4,pfactortree 
> sage: f = ZpFM(2,24,'terse')['x']( (x<sup>32+16)*(x</sup>32+16+2<sup>16*x</sup>2)+2^34 ) 
> sage: pfactortree(f) # long (3.8s) 
> [(1 + O(2<sup>24))*x</sup>64 + (65536 + O(2<sup>24))*x</sup>34 + (32 + O(2<sup>24))*x</sup>32 + (1048576 + O(2<sup>24))*x</sup>2 + (256 + O(2^24))] 
> }}}
> This is just returning the polynomial unfactored, so demonstrably the factoring isn't working here. We should get:
> {{{
> sage: f = ZpFM(2,24,'terse')['x']( (x<sup>32+16)*(x</sup>32+16+2<sup>16*x</sup>2)+2^34 )
> sage: f.factor()
> ((1 + O(2<sup>24))*x</sup>32 + (65536 + O(2<sup>24))*x</sup>2 + (16 + O(2^24))) * ((1 + O(2<sup>24))*x</sup>32 + (16 + O(2^24)))
> }}}
> Also, we should rework this code so that a sage Factorization object is returned, and that pfactortree is called by the `.factor()` method attached to p-adic polynomials.

Note that increasing the precision yields a factorization:


```
sage: f = ZpFM(2,44,'terse')['x']( (x^32+16)*(x^32+16+2^16*x^2) + 2^34)
sage: pfactortree(f)
[(1 + O(2^44))*x^32 + (7242791239680 + O(2^44))*x^30 + (13194407968768 + O(2^44))*x^28 + (7902202888192 + O(2^44))*x^26 + (2147483648 + O(2^44))*x^24 + (442381107200 + O(2^44))*x^22 + (21474836480 + O(2^44))*x^20 + (6193337597952 + O(2^44))*x^18 + (240518168576 + O(2^44))*x^16 + (2405122965504 + O(2^44))*x^14 + (2886218022912 + O(2^44))*x^12 + (16766847680512 + O(2^44))*x^10 + (1099511627776 + O(2^44))*x^8 + (2190164885504 + O(2^44))*x^6 + (14293651161088 + O(2^44))*x^4 + (14178492350464 + O(2^44))*x^2 + (8796093022224 + O(2^44)),
 (1 + O(2^44))*x^32 + (10349394804736 + O(2^44))*x^30 + (8796093022208 + O(2^44))*x^28 + (5291936645120 + O(2^44))*x^26 + (17149804937216 + O(2^44))*x^22 + (11398848446464 + O(2^44))*x^18 + (15187063078912 + O(2^44))*x^14 + (825338363904 + O(2^44))*x^10 + (15402021158912 + O(2^44))*x^6 + (3413693759488 + O(2^44))*x^2 + (8797166764048 + O(2^44))]
```


In the case Simon pointed out, adding `2^34` doesn't do anything since the precision cap of the base ring is 24, so we have an actual example of a reducible polynomial being claimed to be irreducible.


---

Comment by saraedum created at 2013-05-26 23:34:45

The algorithm used in ``pfactortree`` only works for square-free polynomials, so I don't think this is a bug. Square-free decomposition doesn't work currently though, see #13439.


---

Comment by saraedum created at 2013-05-26 23:36:03

Oh wait. I looked at the wrong numbers sorry.


---

Attachment


---

Comment by bsinclai created at 2013-10-14 02:21:13

This new patch replaces the first and has a great deal of improvements, bug-fixes, and documentation.  The examples should be more sensible now.

It should successfully factor monic, square-free, fixed-mod padic polynomials without fail.

I am running more tests to ensure its validity as well as implementing the transformations needed to handle non-monic cases, which would leave it only dependant on square-free decomposition.


---

Comment by saraedum created at 2013-10-14 13:51:24

Nice. I volunteer to review this once it is ready. On a first look, several methods still don't have docstrings (but you are probably aware of this).


---

Comment by jdemeyer created at 2013-11-22 14:13:51

Please be aware of #15422 (which fixes some bugs in Sage's factoring of non-squarefree p-adic polynomials).


---

Comment by git created at 2014-01-07 04:19:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bsinclai created at 2014-01-08 22:29:21

New commits:


---

Comment by bsinclai created at 2014-01-08 22:29:21

Changing status from new to needs_review.


---

Comment by jdemeyer created at 2014-01-09 13:34:01

Some comments (not planning to actually review this):
1. I would hope that this code works for all kinds of p-adic polynomials (over `Zp`, over `Qp`, over field extensions, all with different kinds of precision). Still, (almost) all examples in the doctests use `ZpFM`.
1. The `factor()` method doesn't actually use this code. What's the point then?
1. It would be good if this code would also support the `factor_padic()` method for polynomials over `ZZ` and `QQ`.
1. What happens if the assumption the the polynomial is squarefree doesn't hold?
1. Units in the `Factorization` should be put in the "unit" part, this is wrong:

```
sage: x = polygen(ZpFM(2,10))
sage: pfactor(3*x)[1]
(1 + 2 + O(2^10), 1)
```

1. Similarly, the primes should actually be primes, this should have a factor 2 with multiplicity 2:

```
sage: x = polygen(ZpFM(2,10))
sage: pfactor(4*x)[1]
(2^2 + O(2^10), 1)
```



---

Comment by jdemeyer created at 2014-01-09 16:39:57

The new code also seems slower than the `factor()` which is already in Sage (at least when #15654 is applied).

```
sage: x = polygen(ZpFM(3,50))
sage: pol = (x-1)^100 + x
sage: %time F1=factor(pol)
CPU times: user 0.68 s, sys: 0.00 s, total: 0.68 s
Wall time: 0.68 s
sage: %time F2=pfactor(pol)
CPU times: user 2.17 s, sys: 0.01 s, total: 2.18 s
Wall time: 2.16 s
```



---

Comment by jdemeyer created at 2014-01-09 19:29:30

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-01-09 23:45:41

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2014-01-10 01:07:06

Replying to [comment:22 jdemeyer]:
> The new code also seems slower than the `factor()` which is already in Sage (at least when #15654 is applied).

It hasn't been optimized, so I'm hoping that these timings will improve (currently, a lot of time is spent in initialization of various objects that can be reduced).


---

Comment by saraedum created at 2017-06-06 03:31:34

Changing keywords from "" to "sd86.5".


---

Comment by saraedum created at 2017-06-06 03:31:34

New commits:


---

Comment by git created at 2017-06-10 17:15:04

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2017-07-17 17:36:14

Changing keywords from "sd86.5" to "sd86.5, sd87".


---

Comment by bsinclai created at 2017-07-18 21:12:10

Last 10 new commits:


---

Comment by bsinclai created at 2017-07-18 21:18:44

Changing status from needs_work to needs_review.


---

Comment by git created at 2017-07-19 04:26:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-19 19:14:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-07-20 03:12:24

Last 10 new commits:


---

Comment by git created at 2017-07-20 05:39:55

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-20 07:04:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-20 07:12:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2017-07-20 08:14:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by saraedum created at 2017-07-20 08:31:32

I think it would be very nice to come up with a parent for FrameElt and FrameEltTerm and then inherit from Element for these. This would make implementation of arithmetic much easier I think.

Isn't FrameElt basically just a sparse polynomial whose coefficients are FrameEltTerm? I actually find it surprising that FrameEltTerm exists. It's just wrapping a FrameElt except in the base case where it is wrapping a constant. I think that a tower of sparse polynomial rings could give you the same much more easily.

Not sure if you feel like rewriting this or if we should postpone this.


---

Comment by saraedum created at 2017-07-20 08:31:32

Changing status from needs_review to needs_work.


---

Comment by saraedum created at 2017-07-20 08:31:47

Changing status from needs_work to needs_info.


---

Comment by bsinclai created at 2017-07-20 16:37:32

I think that in the end, finding a parent for FrameElt and FrameEltTerm make sense.  FrameElts are sparse polynomials of FrameEltTerms and FrameEltTerms are either representations of p-adic integers as valuation-and-unit or (FrameElt in phi<sub>i-1</sub>)*phi<sub>i</sub><sup>deg</sup>.  However, there are specialized mechanics to consider and these objects are at the core of most of this code.

I think that this would be worthwhile, but might make sense to do as part of a refactor that also collapses segments and residual factors into frames and cleans up the object interface.


---

Comment by git created at 2017-07-21 17:01:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by roed created at 2018-07-23 00:09:38

New commits:


---

Comment by roed created at 2018-07-23 00:09:38

Changing keywords from "sd86.5, sd87" to "sd86.5, sd87, padicIMA".


---

Comment by git created at 2018-07-23 03:39:33

Branch pushed to git repo; I updated commit sha1. New commits:
