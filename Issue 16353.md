# Issue 16353: interface sympy Diophantine function(s)

Issue created by migration from https://trac.sagemath.org/ticket/16590

Original creator: rws

Original creation time: 2014-06-30 06:24:27

CC:  cremona

Keywords: pellian, integers, solution

In sympy solution of Diophantine equations is available for several types of equations. This meta-ticket aims at

* making the resp. sympy functions fully usable with Sage
  1. symbolic expressions
  2. univariate polynomials
  3. multivariate polynomials
  4. quadratic forms
  5. lists of linear 1/2/3
* implementing a global `solve_diophantine()` function that wraps the sympy functionality
* where useful implementing member functions `solve_diophantine()`


---

Comment by rws created at 2014-06-30 13:54:47

However, the last solution shown in the workaround is incomplete, see https://github.com/sympy/sympy/issues/7671. Still, it would be good to have the functionality at hand in Sage.


---

Comment by rws created at 2014-07-03 16:27:27


```
sage: sage: from sympy.solvers.diophantine import *
sage: sage: from sympy import sympify
sage: diop_solve(sympify(x*y-10))
{(-10, -1), (-5, -2), (-2, -5), (-1, -10), (1, 10), (2, 5), (5, 2), (10, 1)}

sage: solve(x*y==10,x)
[x == 10/y]
sage: assume(x,'integer')
sage: assume(y,'integer')
sage: solve(x*y==10,x,y,solution_dict=True)
([{x: 10/y}], [1])
```

Solve with assumption `'integer'` for all variables should definitely call `diop_solve()`, but also the shorter `solve_diophantine(expr)` without assumptions should be available. Not sure what the output of `[1]` above means.


---

Comment by rws created at 2014-07-04 15:43:48

Irrelevant comment deleted. Sorry.


---

Comment by rws created at 2014-07-05 15:23:47

Set assignee to rws.


---

Comment by git created at 2014-07-08 16:21:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-07-09 08:55:06

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-07-09 08:57:09

This is completed IMO, modulo the review. The failing doctest depends on #16624, so I'll wait with setting 'needs review' for that.


---

Comment by git created at 2014-11-03 10:19:24

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2014-11-03 10:53:13

Changing status from new to needs_review.


---

Comment by rws created at 2014-11-03 10:53:13

Merged in #16624.

Edit: removed nonsense


---

Comment by rws created at 2014-11-03 15:22:11

The `x^2-9` doctest failure is only fixed in sympy master but not 0.7.5, so we would still have to wait for this fix. I would however support any reviewer that wants to have the code in Sage---just remove that doctest, the failure is not our fault.


---

Comment by git created at 2015-03-05 13:56:57

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-03-05 14:03:39

With the new sympy, also the last doctest passes. Squashed it all into one commit.
----
New commits:


---

Comment by jkeitel created at 2015-04-15 09:48:10

Some of the tests depend on ordering at the moment:


```
File "src/sage/symbolic/expression.pyx", line 10089, in sage.symbolic.expression.Expression.solve_diophantine
Failed example:
    solve_diophantine(x^2+y^2==25)
Expected:
    [(-4, 3), (4, -3), (0, -5), (-4, -3), (0, 5), (4, 3)]
Got:
    [(4, -3), (0, -5), (-4, -3), (-4, 3), (0, 5), (4, 3)]
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10105, in sage.symbolic.expression.Expression.solve_diophantine
Failed example:
    solve_diophantine(x*y-y==10, (x,y))
Expected:
    [(6, 2), (2, 10), (3, 5), (0, -10), (-1, -5), (11, 1), (-4, -2), (-9, -1)]
Got:
    [(-1, -5), (0, -10), (-9, -1), (-4, -2), (2, 10), (11, 1), (6, 2), (3, 5)]
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10107, in sage.symbolic.expression.Expression.solve_diophantine
Failed example:
    solve_diophantine(x*y-y==10, solution_dict=True)
Expected:
    [{x: 6, y: 2},
     {x: 2, y: 10},
     {x: 3, y: 5},
     {x: 0, y: -10},
     {x: -1, y: -5},
     {x: 11, y: 1},
     {x: -4, y: -2},
     {x: -9, y: -1}]
Got:
    [{y: -5, x: -1},
     {y: -10, x: 0},
     {y: -1, x: -9},
     {y: -2, x: -4},
     {y: 10, x: 2},
     {y: 1, x: 11},
     {y: 2, x: 6},
     {y: 5, x: 3}]
```



---

Comment by git created at 2015-04-15 14:26:27

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-04-15 14:27:49

Fixed. Why dictionaries have to be sorted to be comparable is beyond me.


---

Comment by rws created at 2015-04-20 06:28:16

Passes all patchbot tests.


---

Comment by knsam created at 2015-05-12 07:06:43

I would like to review this ticket and perhaps contribute more code around this theme. I am working on a review of this code and should be available before the end of this week. :-)


---

Comment by knsam created at 2015-05-14 22:42:46

OK, so this ticket is really an interface to Sympy code and all the tests pass. 

A suggestion that you might want to consider: Pell's equation is in no reasonable sense a correct attribution. I would prefer Brahmagupta-Pell equation. For historic comments, see A. Weil's book "Number Theory, An approach through history from Hammurapi to Legendre" or Whitford's book "Pell's equation" for some of the early history. 

Modulo this, positive review.


---

Comment by rws created at 2015-05-15 06:41:31

I agree with the attribution change. Please add your name to the Reviewers field of the ticket. Thanks for the review.
----
New commits:


---

Comment by tscrim created at 2015-05-18 15:33:43

Would anyone believe I actually recently have a use for this, for me coming and my combinatorial/representation theory background? :P Just a trivial push to get this into Sage.


---

Comment by tscrim created at 2015-05-18 15:33:43

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-18 19:27:04

doctests depends on x/y order which is apparently random:

```
sage -t --long src/sage/symbolic/expression.pyx
**********************************************************************
File "src/sage/symbolic/expression.pyx", line 10122, in sage.symbolic.expression.Expression.solve_diophantine
Failed example:
    res.sort(); res
Expected:
    [{y: -1, x: -9},
     {y: -2, x: -4},
     {y: -5, x: -1},
     {y: -10, x: 0},
     {y: 10, x: 2},
     {y: 5, x: 3},
     {y: 2, x: 6},
     {y: 1, x: 11}]
Got:
    [{x: 0, y: -10},
     {x: -1, y: -5},
     {x: -4, y: -2},
     {x: -9, y: -1},
     {x: 11, y: 1},
     {x: 6, y: 2},
     {x: 3, y: 5},
     {x: 2, y: 10}]
**********************************************************************
1 item had failures:
   1 of  20 in sage.symbolic.expression.Expression.solve_diophantine
    [2394 tests, 1 failure, 31.23 s]
```



---

Comment by vbraun created at 2015-05-18 19:27:04

Changing status from positive_review to needs_work.


---

Comment by git created at 2015-05-24 15:59:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-05-24 16:00:32

Changing status from needs_work to needs_review.


---

Comment by tscrim created at 2015-05-24 16:26:12

This test

```python
all(sol[i] == res[i] for i in range(len(sol)))
```

still depends on the order of the _solutions_ (which is machine dependent as per Volker's note), not the (only) print order of the `dict`s. So I think a better test would be

```python
all(solution in res for solution in sol)
```



---

Comment by git created at 2015-05-24 16:32:01

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-05-24 16:32:36

Thanks!


---

Comment by tscrim created at 2015-05-24 16:35:55

Sorry, I just realized this isn't quite sufficient. We should also add an `and len(res) == len(sol)` as there could be more "solutions" in `sol` than there should be. Once you add that, you can set positive review. Thanks.


---

Comment by git created at 2015-05-24 16:43:32

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2015-05-24 16:44:47

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-05-25 07:29:57

Resolution: fixed
