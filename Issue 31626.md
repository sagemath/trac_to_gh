# Issue 31626: Fricas doesn't build on OS X Big Sur/Xcode 12

Issue created by migration from https://trac.sagemath.org/ticket/31863

Original creator: jhpalmieri

Original creation time: 2021-05-27 05:42:01

CC:  dimpase

As the summary says. Log attached.


---

Attachment

Same error on macOS Catalina. Upstream report?


---

Comment by dimpase created at 2021-05-28 08:16:11

it's C compiler strictness. Maybe could be worked around with CFLAGS (hopefully). I've opened
 https://github.com/fricas/fricas/issues/59


---

Comment by mantepse created at 2021-05-28 16:11:33

Changing keywords from "" to "fricas".


---

Comment by dimpase created at 2021-06-01 20:20:01

Thanks to gh-spaghettisalat, we do have a fix
https://github.com/spaghettisalat/fricas/commit/378ceaaf92beebf34c308b3470dc1d804c74c5b2
I'll post a patch


---

Comment by dimpase created at 2021-06-01 20:28:19

New commits:


---

Comment by dimpase created at 2021-06-01 20:28:19

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2021-06-02 17:26:47

This builds for me but it doesn't seem to work:

```
sage: integral(sin(x), x, algorithm='fricas')
```

hangs. `fricas` does start when I use the Sage shell, or when I explicitly run `local/bin/fricas`.


---

Comment by mantepse created at 2021-06-02 18:25:04

Could you please try the following and post output:

```
sage: fricas("1+1")
2
sage: fricas.eval("1+1")
'\n   2\n'                                                                                                                                                                  
sage: fricas.eval("integrate(x, x)")
'\n   1  2\n   - x\n   2\n'       
```



---

Comment by mantepse created at 2021-06-02 18:31:26

One more:

```
sage: fricas.eval("1+1", reformat=False)
'\n|startAlgebraOutput|\n   2\n|endOfAlgebraOutput|'
```



---

Comment by dimpase created at 2021-06-02 19:46:42

Replying to [comment:6 jhpalmieri]:
> This builds for me but it doesn't seem to work:
> {{{
> sage: integral(sin(x), x, algorithm='fricas')
> }}}
> hangs. `fricas` does start when I use the Sage shell, or when I explicitly run `local/bin/fricas`.

this works for me. Perhaps you need to run `source .homebrew-build-env` before starting Sage?
(Try fricas doctests, too, please, in `src/sage/interfaces/fricas.py`)


---

Comment by jhpalmieri created at 2021-06-02 21:50:55

I quit Sage and restarted, and now things are working. The `src/sage/interfaces/fricas.py` doctests pass, too. Maybe the first time the FriCAS process got hung up once and then never recovered, so every call to `fricas("1+1")` hung.

Things aren't perfect, but no need to hold up this ticket. If I start Sage and run `integral(sin(x), x, algorithm='fricas')`, and then immediately hit ctrl-C, then running `integral(sin(x), x, algorithm='fricas')` again fails:

```
...
KeyboardInterrupt: 
sage: integral(sin(x), x, algorithm='fricas')                                             
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/interfaces/interface.py in _coerce_from_special_method(self, x)
    329         try:
--> 330             return (x.__getattribute__(s))(self)
    331         except AttributeError:


 ...


~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/repl/ipython_extension.py in wrapper(*args, **kwargs)
    561         if not wrapper.has_run:
--> 562             result = func(*args, **kwargs)
    563             wrapper.has_run = True

~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/interfaces/sympy.py in sympy_init()
    871     import sympy.core.function
--> 872     sympy.core.function._undef_sage_helper = UndefSageHelper()
    873     Integral._sage_ = _sympysage_integral

AttributeError: module 'sympy' has no attribute 'core'

During handling of the above exception, another exception occurred:

TypeError                                 Traceback (most recent call last)
<ipython-input-2-7edbac68b0f9> in <module>
----> 1 integral(sin(x), x, algorithm='fricas')

~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/misc/functional.py in integral(x, *args, **kwds)
    757     """
    758     if hasattr(x, 'integral'):
--> 759         return x.integral(*args, **kwds)
    760     else:
    761         from sage.symbolic.ring import SR


 ...


~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/interfaces/interface.py in __call__(self, x, name)
    300             # user-assigned name might change its value, so we return a
    301             # new element.
--> 302             result = self._coerce_from_special_method(x)
    303             return result if name is None else result.name(new_name=name)
    304         except TypeError:

~/Desktop/Sage/sage_builds/TESTING/sage-9.4.beta0/local/lib/python3.9/site-packages/sage/interfaces/interface.py in _coerce_from_special_method(self, x)
    330             return (x.__getattribute__(s))(self)
    331         except AttributeError:
--> 332             return self(x._interface_init_())
    333 
    334     def _coerce_impl(self, x, use_special=True):

TypeError: Expression._interface_init_() takes exactly one argument (0 given)
```

It succeeds after that.


---

Comment by dimpase created at 2021-06-03 10:55:07

I think the latter illustrates flakiness of pexpect interface, and not something specifically wrong with this patch (which was about building errors).
Positive review?


---

Comment by jhpalmieri created at 2021-06-03 16:54:14

Yes, let's proceed.


---

Comment by jhpalmieri created at 2021-06-03 16:54:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2021-06-21 21:16:52

Resolution: fixed
