# Issue 29285: layout_planar fails on disconnected graphs

archive/issues_029285.json:
```json
{
    "body": "Keywords: layout planar embedding connected triangulate\n\n`layout_planar` fails on disconnected graphs\n\n\n```\nsage: g = Graph(2)\nsage: g.layout_planar()\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-5-5590605c1dc8> in <module>()\n----> 1 g.layout_planar()\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n     68     # first make sure that the graph has at least 3 vertices, and that it is connected\n     69     if g.order() < 3:\n---> 70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n     71     if not g.is_connected():\n     72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n\nValueError: A Graph with less than 3 vertices doesn't have any triangulation.\n```\n\n\nThe error message is different when the graph has more vertices:\n\n```\nsage: g = Graph(3)\nsage: g.layout_planar()\n---------------------------------------------------------------------------\nNotImplementedError                       Traceback (most recent call last)\n<ipython-input-7-5590605c1dc8> in <module>()\n----> 1 g.layout_planar()\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\n/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)\n     70         raise ValueError(\"A Graph with less than 3 vertices doesn't have any triangulation.\")\n     71     if not g.is_connected():\n---> 72         raise NotImplementedError(\"_triangulate() only knows how to handle connected graphs.\")\n     73 \n     74     # At this point we know that the graph is connected, has at least 3\n\nNotImplementedError: _triangulate() only knows how to handle connected graphs.\n```\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/29522\n\n",
    "created_at": "2020-04-17T17:02:03Z",
    "labels": [
        "component: graph theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.1",
    "title": "layout_planar fails on disconnected graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/29285",
    "user": "https://github.com/jfraymond"
}
```
Keywords: layout planar embedding connected triangulate

`layout_planar` fails on disconnected graphs


```
sage: g = Graph(2)
sage: g.layout_planar()
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-5-5590605c1dc8> in <module>()
----> 1 g.layout_planar()

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
     68     # first make sure that the graph has at least 3 vertices, and that it is connected
     69     if g.order() < 3:
---> 70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
     71     if not g.is_connected():
     72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")

ValueError: A Graph with less than 3 vertices doesn't have any triangulation.
```


The error message is different when the graph has more vertices:

```
sage: g = Graph(3)
sage: g.layout_planar()
---------------------------------------------------------------------------
NotImplementedError                       Traceback (most recent call last)
<ipython-input-7-5590605c1dc8> in <module>()
----> 1 g.layout_planar()

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

/home/jf/sage/local/lib/python3.7/site-packages/sage/graphs/schnyder.py in _triangulate(g, comb_emb)
     70         raise ValueError("A Graph with less than 3 vertices doesn't have any triangulation.")
     71     if not g.is_connected():
---> 72         raise NotImplementedError("_triangulate() only knows how to handle connected graphs.")
     73 
     74     # At this point we know that the graph is connected, has at least 3

NotImplementedError: _triangulate() only knows how to handle connected graphs.
```


Issue created by migration from https://trac.sagemath.org/ticket/29522





---

archive/issue_comments_414646.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414646",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_414647.json:
```json
{
    "body": "I changed the order of the first tests in method `_triangulate` of `schnyder.py`.\n----\nNew commits:",
    "created_at": "2020-04-18T10:06:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414647",
    "user": "https://github.com/dcoudert"
}
```

I changed the order of the first tests in method `_triangulate` of `schnyder.py`.
----
New commits:



---

archive/issue_comments_414648.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-18T21:13:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414648",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414649.json:
```json
{
    "body": "I changed the code of the function dealing with disconnected graphs for the spring layout (`spring_layout_fast_split`) so that it can work with any layout function.\nThe new function dealing with disconnected graphs and arbitrary layout functions is `layout_split`.\nThe `layout_planar` function now calls it when the graph is not connected.",
    "created_at": "2020-04-18T21:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414649",
    "user": "https://github.com/jfraymond"
}
```

I changed the code of the function dealing with disconnected graphs for the spring layout (`spring_layout_fast_split`) so that it can work with any layout function.
The new function dealing with disconnected graphs and arbitrary layout functions is `layout_split`.
The `layout_planar` function now calls it when the graph is not connected.



---

archive/issue_comments_414650.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-04-19T08:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414650",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_414651.json:
```json
{
    "body": "There are still some issues with my code. Working on it.",
    "created_at": "2020-04-19T08:49:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414651",
    "user": "https://github.com/jfraymond"
}
```

There are still some issues with my code. Working on it.



---

archive/issue_comments_414652.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-19T10:27:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414652",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414653.json:
```json
{
    "body": "It should be good now. I also fixed the following bug of `layout_planar`:\n\n```\nH = graphs.LadderGraph(4)\nem = {0:[1,4], 4:[0,5], 1:[5,2,0], 5:[4,6,1], 2:[1,3,6], 6:[7,5,2], 3:[7,2], 7:[3,6]}\nH.layout_planar(on_embedding=em)\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-1-fa5d8c0766a4> in <module>()\n      1 H = graphs.LadderGraph(Integer(4))\n      2 em = {Integer(0):[Integer(1),Integer(4)], Integer(4):[Integer(0),Integer(5)], Integer(1):[Integer(5),Integer(2),Integer(0)], Integer(5):[Integer(4),Integer(6),Integer(1)], Integer(2):[Integer(1),Integer(3),Integer(6)], Integer(6):[Integer(7),Integer(5),Integer(2)], Integer(3):[Integer(7),Integer(2)], Integer(7):[Integer(3),Integer(6)]}\n----> 3 H.layout_planar(on_embedding=em)\n\n/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\nAttributeError: 'Graph' object has no attribute '_embedding'\n```\n",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414653",
    "user": "https://github.com/jfraymond"
}
```

It should be good now. I also fixed the following bug of `layout_planar`:

```
H = graphs.LadderGraph(4)
em = {0:[1,4], 4:[0,5], 1:[5,2,0], 5:[4,6,1], 2:[1,3,6], 6:[7,5,2], 3:[7,2], 7:[3,6]}
H.layout_planar(on_embedding=em)
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-1-fa5d8c0766a4> in <module>()
      1 H = graphs.LadderGraph(Integer(4))
      2 em = {Integer(0):[Integer(1),Integer(4)], Integer(4):[Integer(0),Integer(5)], Integer(1):[Integer(5),Integer(2),Integer(0)], Integer(5):[Integer(4),Integer(6),Integer(1)], Integer(2):[Integer(1),Integer(3),Integer(6)], Integer(6):[Integer(7),Integer(5),Integer(2)], Integer(3):[Integer(7),Integer(2)], Integer(7):[Integer(3),Integer(6)]}
----> 3 H.layout_planar(on_embedding=em)

/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

AttributeError: 'Graph' object has no attribute '_embedding'
```




---

archive/issue_comments_414654.json:
```json
{
    "body": "Changing keywords from \"layout planar embedding connected triangulate\" to \"layout planar embedding spring connected triangulate\".",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414654",
    "user": "https://github.com/jfraymond"
}
```

Changing keywords from "layout planar embedding connected triangulate" to "layout planar embedding spring connected triangulate".



---

archive/issue_comments_414655.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-04-19T10:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414655",
    "user": "https://github.com/jfraymond"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_414656.json:
```json
{
    "body": "I have 3 failing doctests\n\n```\nsage -t src/sage/graphs/schnyder.py\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 73, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: _triangulate() only knows how to handle connected graphs\nGot:\n    {0: [0, 0], 1: [0, 1]}\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 78, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    ValueError: a Graph with less than 3 vertices doesn't have any triangulation\nGot:\n    {0: [0, 0], 1: [0, 1]}\n**********************************************************************\nFile \"src/sage/graphs/schnyder.py\", line 83, in sage.graphs.schnyder._triangulate\nFailed example:\n    g.layout_planar()\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: _triangulate() only knows how to handle connected graphs\nGot:\n    {0: [0.5773502691896258, 0],\n     1: [1.1547005383792517, 0],\n     2: [1.7320508075688776, 0]}\n```\n",
    "created_at": "2020-04-19T12:27:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414656",
    "user": "https://github.com/dcoudert"
}
```

I have 3 failing doctests

```
sage -t src/sage/graphs/schnyder.py
**********************************************************************
File "src/sage/graphs/schnyder.py", line 73, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: _triangulate() only knows how to handle connected graphs
Got:
    {0: [0, 0], 1: [0, 1]}
**********************************************************************
File "src/sage/graphs/schnyder.py", line 78, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    ValueError: a Graph with less than 3 vertices doesn't have any triangulation
Got:
    {0: [0, 0], 1: [0, 1]}
**********************************************************************
File "src/sage/graphs/schnyder.py", line 83, in sage.graphs.schnyder._triangulate
Failed example:
    g.layout_planar()
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: _triangulate() only knows how to handle connected graphs
Got:
    {0: [0.5773502691896258, 0],
     1: [1.1547005383792517, 0],
     2: [1.7320508075688776, 0]}
```




---

archive/issue_comments_414657.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-19T13:41:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414657",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414658.json:
```json
{
    "body": "My bad, I only ran tests for `generic_graph.py`.\nTests now pass on the whole `graphs` folder.",
    "created_at": "2020-04-19T13:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414658",
    "user": "https://github.com/jfraymond"
}
```

My bad, I only ran tests for `generic_graph.py`.
Tests now pass on the whole `graphs` folder.



---

archive/issue_comments_414659.json:
```json
{
    "body": "The patchbot complains because you must add at least one doctest in `spring_layout_fast_split`.",
    "created_at": "2020-04-19T17:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414659",
    "user": "https://github.com/dcoudert"
}
```

The patchbot complains because you must add at least one doctest in `spring_layout_fast_split`.



---

archive/issue_comments_414660.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-20T08:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414660",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414661.json:
```json
{
    "body": "I added the missing test and also fixed the error message when one asks for a planar layout of a non-planar graph. Previously:\n\n```\nsage: G = graphs.PetersenGraph()\nsage: G.layout_planar()\n---------------------------------------------------------------------------\nAttributeError                            Traceback (most recent call last)\n<ipython-input-2-33ae44b2d717> in <module>()\n----> 1 G.layout_planar()\n\n/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)\n   5355                                  ''.format(external_face, self))\n   5356 \n-> 5357         _triangulate(G, G._embedding)\n   5358 \n   5359         # Optional error-checking\n\nAttributeError: 'Graph' object has no attribute '_embedding'\n```\n\nNow it raises a `ValueError`.",
    "created_at": "2020-04-20T08:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414661",
    "user": "https://github.com/jfraymond"
}
```

I added the missing test and also fixed the error message when one asks for a planar layout of a non-planar graph. Previously:

```
sage: G = graphs.PetersenGraph()
sage: G.layout_planar()
---------------------------------------------------------------------------
AttributeError                            Traceback (most recent call last)
<ipython-input-2-33ae44b2d717> in <module>()
----> 1 G.layout_planar()

/home/jf/recherche/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in layout_planar(self, set_embedding, on_embedding, external_face, test, circular, **options)
   5355                                  ''.format(external_face, self))
   5356 
-> 5357         _triangulate(G, G._embedding)
   5358 
   5359         # Optional error-checking

AttributeError: 'Graph' object has no attribute '_embedding'
```

Now it raises a `ValueError`.



---

archive/issue_comments_414662.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-04-20T09:03:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414662",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_414663.json:
```json
{
    "body": "I did a small pep8 commit.\n\nFor me this patch is good.",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414663",
    "user": "https://github.com/dcoudert"
}
```

I did a small pep8 commit.

For me this patch is good.



---

archive/issue_comments_414664.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-04-20T09:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414664",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_414665.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-04-20T09:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414665",
    "user": "https://github.com/jfraymond"
}
```

Thanks!



---

archive/issue_comments_414666.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-04-23T22:32:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/29285",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/29285#issuecomment-414666",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
