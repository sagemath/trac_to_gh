# Issue 13276: source sage-env in spkg/install

Issue created by migration from https://trac.sagemath.org/ticket/13448

Original creator: ohanar

Original creation time: 2012-09-12 00:27:11

Assignee: jason

CC:  jdemeyer burcin fbissey dimpase chapoton

Currently sage environmental variables are set in both `sage-env`, and a subset are set in `spkg/install`. This should be refactored. Also, since `sage-spkg` is now always called from within the sage environment (as it should be), so it is no longer necessary to source `sage-env`.


---

Comment by ohanar created at 2012-09-12 00:32:27

Changing status from new to needs_review.


---

Comment by ohanar created at 2012-09-12 00:32:27

The dependency is only because I don't want to rebase #13123 on this.


---

Comment by ohanar created at 2012-09-12 03:45:35

apply to root repo


---

Attachment

This is going to break badly because `sage-env` is sourced only once (in this case, at the very beginning of the installation) but it needs to be re-sourced at various times during the installation because of environment variables which are conditionally set.  This can be seen during upgrading for example, where `sage-env` is sourced by `sage --upgrade`, requiring various ugly work-arounds.  To support upgrading, `spkg/install` needs to keep working with an old `sage-env`.

I agree there is a little bit of duplication between `spkg/install` and `sage-env` but I don't see a clean way to fix this.  I'm open for suggestions though...

I propose to postpone this ticket, perhaps at a later time refactoring will be easier.


---

Comment by ohanar created at 2012-09-12 07:41:08

Hmm, you are right. I'll see if I can't come up with a clean way around that, but for now we should postpone this (not really sure the best way to mark that on trac though...)


---

Comment by jdemeyer created at 2012-09-12 07:47:05

Replying to [comment:3 ohanar]:
> not really sure the best way to mark that on trac though...
Like this?


---

Comment by jdemeyer created at 2012-09-21 14:46:11

Changing status from needs_review to needs_work.


---

Comment by kini created at 2013-02-01 06:43:03

Typo on line 95 of `sage-spkg`.


---

Comment by mkoeppe created at 2020-08-17 16:38:58

Outdated spkg or build system ticket, should be closed


---

Comment by mkoeppe created at 2020-08-17 16:38:58

Changing status from needs_work to needs_review.


---

Comment by chapoton created at 2020-12-19 20:52:31

Resolution: invalid
