# Issue 12744: Dedekind-MacNeil completion of finite posets

Issue created by migration from https://trac.sagemath.org/ticket/12916

Original creator: nthiery

Original creation time: 2012-05-06 18:05:41

Assignee: sage-combinat

CC:  sage-combinat

The title says it all.

See also: http://en.wikipedia.org/wiki/Dedekind%E2%80%93MacNeille_completion


---

Comment by chapoton created at 2012-09-05 08:49:21

I have made a small patch, in the sage-combinat queue, just using the naive algorithm and therefore not very efficient. Is this useful ? Should I put it here ?


---

Comment by nthiery created at 2012-09-05 10:29:53

Replying to [comment:1 chapoton]:
> I have made a small patch, in the sage-combinat queue, just using the naive algorithm and therefore not very efficient. Is this useful ? Should I put it here ?

Yes; I would even tend to get it into Sage as a provocation: any expert reading the code will think "yikes, *I* can do sooo much better". And will do it :-)


---

Comment by chapoton created at 2012-09-06 08:01:39

Changing priority from major to minor.


---

Attachment

a naive implementation


---

Comment by chapoton created at 2014-01-05 10:44:48

New commits:


---

Comment by chapoton created at 2014-11-23 20:07:47

Changing keywords from "" to "poset, lattice".


---

Comment by chapoton created at 2014-11-28 20:36:24

Changing status from new to needs_review.


---

Comment by ncohen created at 2015-01-17 04:30:41

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2015-01-17 04:30:41

> Yes; I would even tend to get it into Sage as a provocation: any expert reading the code will think "yikes, *I* can do sooo much better". And will do it :-)

I am precisely the kind of guy who thought that when reading the code, and I don't appreciate at all to see that you consider it a game to make us rewrite other people's hasty code, just because we do not stand such waste of computation. My time is not cheaper than anybody else's.

About this patch:

- The name of the methods that you define is not very informative: `set_of_upper_bounds/set_of_lower_bounds` feels like you will get all `y` greater than a given `x`. It is more 'lower_bounds_of_set', but even then it feels a bit awkward. Is there a word in order theory to mean "all elements smaller than x" ? I can't even find a function that would return that for such a vertex `x`

- Computation of the set of cuts: look at the section entitled `Constructing the set of cuts` in the Wikipedia page that you provided. They say that it is equivalent to list all antichains of the Poset, and for that there is a `.antichains_iterator` function. (I wonder how it compares with http://www.sagemath.org/doc/reference/graphs/sage/graphs/independent_sets.html, but that's another subject)

Nathann


---

Comment by git created at 2015-01-17 15:04:00

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-01-17 15:05:59

Hello Nathann,

thanks for the input.

Here is a proposal for another algorithm, using maximal cliques of the incomparability graph of an auxiliary poset. Needs polishing. I do not know if this is faster than before, hopefully yes.


---

Comment by git created at 2015-01-17 21:00:35

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-01-17 21:03:59

Ok, needs review again, I think, but I have not done any timings.


---

Comment by chapoton created at 2015-01-17 21:03:59

Changing status from needs_info to needs_review.


---

Comment by ncohen created at 2015-01-17 23:51:04

Wow! Excellent, a quite clean result `:-)`

So, about this. I have a couple of comments:

- For very bad reasons, the output of `cliques_maximal` is... sorted. Which is a pure waste. If you want to avoid that you can call `IndependentSets` directly.

http://www.sagemath.org/doc/reference/graphs/sage/graphs/independent_sets.html

- The good side-effect of that is that you do not have to call 'incomparability_graph`, which would do some useless computations in your case (your poset has height two, so its 'incomparability graph' is the graph complement of its hasse diagram)

- Alternatively: during the creation of the aux poset, and instead of your double loop on `u/v` with a test `u<=v`, you can do that: `g = Graph(((u,0),(v,1)) for u,v in self.cover_relations_iterator())` and then call `IndependentSet(complement=True,maximal=True)` when you compute the longest antichains. Advantages:

    1) no double-loop enumerating many pairs in vain
    2) the complement is a graph complement (and `IndependentSet` computes this complement as a dense matrix, which is also totally faster).

- The auxiliary poset that you define has no reason to be a poset. I wouldn't care in general, but one of the problems with posets is that they are cached globally, and that every time you create one it will be cached/compared with posets that have been created in the past. Waste of time.

- About 'Set'. Well. I just never use them whenever I can avoid it


```
sage: e=[1,2,3]
sage: %timeit Set(e)
10000 loops, best of 3: 26.5 Âµs per loop
sage: %timeit set(e)
1000000 loops, best of 3: 226 ns per loop
sage: %timeit frozenset(e)
1000000 loops, best of 3: 222 ns per loop
```


  Here I do not know, as it is not for internal use only. Do what you think is best.

> Ok, needs review again, I think, but I have not done any timings.

About the timings: I do not have any doubt that this algorithm is infintely faster than the previous one. It does what it should, without waste. The only possible waste of computations in your arlgorithm can be in:

- The call to `cliques_maximal` (and I don't mean the sorting problem)

- The construction of `Lattice` (MUCH slower than building a poset, because the creation of a lattice triggers the computation of the join/meet matrix, which is very wastefully implemented.

Your implementation, however, is both short and clean. Just good work.

Nathann


---

Comment by git created at 2015-01-18 10:15:39

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2015-01-18 10:19:13

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2015-01-18 10:20:35

Ok, thanks. Here is a better version, I hope. Seems to be faster indeed.

No longer uses Poset, Set or incomparability.

Now uses Graph and IndependentSets


---

Comment by ncohen created at 2015-01-18 11:33:28

Yo !

> Ok, thanks. Here is a better version, I hope. Seems to be faster indeed.
> 
> No longer uses Poset, Set or incomparability.
> 
> Now uses Graph and IndependentSets

Passes tests, does the job, good to go!

Nathann


---

Comment by ncohen created at 2015-01-18 11:33:28

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2015-01-24 13:18:45

Resolution: fixed
