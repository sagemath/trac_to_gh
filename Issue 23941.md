# Issue 23941: Make arith versions of functions default, dispatching to symbolic

Issue created by migration from https://trac.sagemath.org/ticket/24178

Original creator: rws

Original creation time: 2017-11-09 09:17:51

CC:  jdemeyer vdelecroix

Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.

The logical solution would be for all cases to
 - make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten
 - dispatch calls to the arith version with symbolic arguments to the symbolic function version
 - copy some symbolic documentation to arith because that docstring will be shown now


---

Comment by jdemeyer created at 2017-11-09 09:33:32

Why should there even be two versions of every function in the first place? Shouldn't we be able to support all use cases in one function?


---

Comment by rws created at 2017-11-09 10:13:24

I wanted to have the code completely in `functions` but #14723 had its problems. See also #17489.


---

Comment by rws created at 2017-11-10 06:38:49

I could also naively ask, if everything coerces into SR why can't symbolic functions by default coerce every argument?


---

Comment by rws created at 2017-11-10 06:44:00

I mean you implemented the symbolic function machinery, and it's fine if you step back and say, let others go ahead now. But you could at least review attempts to fix your design decisions.


---

Comment by rws created at 2017-11-10 07:01:54

Alternatively, if NOT everything coerces into SR then the symbolic `binomial` interface is more restricted than the arith `binomial` interface, and thus the arith version should be default, calling the symbolic version.


---

Comment by rws created at 2018-03-04 14:12:24

See also #19461#comment:9


---

Comment by git created at 2018-03-15 16:01:53

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2018-03-15 16:13:36

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2018-03-15 16:14:41

This should resolve #17489 and #22314 in one go.

Doctests pass in arith and all the  symbolics and function directories but let's see.

Remaining issues like merging of documentation and deprecation of the obscure `binomial._binomial_sym`, `binomial._eval_`, `binomial._evalf_` is stuff for other tickets.

Please review.


---

Comment by rws created at 2018-03-15 16:14:41

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2018-03-15 17:52:44

Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.


---

Comment by rws created at 2018-03-15 18:37:46

Not changing the arith/ versions means writing a global interface function elsewhere. I'm fine with that.


---

Comment by chapoton created at 2018-03-15 19:27:14

Replying to [comment:13 vdelecroix]:
> Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.

I agree with Vincent. Keep the fast functions as they are now.


---

Comment by rws created at 2018-03-16 07:21:57

Nothing wrong with a fast arithmetic function version taking integer arguments, for special needs (and that's why they needed to be imported for some time now). Note that `arith.misc.binomial` does a lot of dispatching attempts and parent queries that do not match what you just argued.

Because the global entry functions in `functions.other` restrict the argument type, an unrestricted version is needed. Like as in `log` this can be put right next to the function class as a Python function. This would then carry a documentation overview.


---

Comment by rws created at 2018-03-16 07:36:11

The original issue won't be fixed.


---

Comment by rws created at 2018-03-16 07:36:11

Changing status from needs_review to positive_review.


---

Comment by vdelecroix created at 2018-05-18 17:16:26

Resolution: wontfix


---

Comment by vdelecroix created at 2018-05-18 17:16:26

closing positively reviewed duplicates
