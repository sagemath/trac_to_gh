# Issue 23941: Make arith versions of functions default, dispatching to symbolic

archive/issues_023941.json:
```json
{
    "body": "CC:  jdemeyer vdelecroix\n\nOf many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.\n\nThe logical solution would be for all cases to\n- make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten\n- dispatch calls to the arith version with symbolic arguments to the symbolic function version\n- copy some symbolic documentation to arith because that docstring will be shown now\n\nIssue created by migration from https://trac.sagemath.org/ticket/24178\n\n",
    "created_at": "2017-11-09T09:17:51Z",
    "labels": [
        "basic arithmetic",
        "major",
        "bug"
    ],
    "title": "Make arith versions of functions default, dispatching to symbolic",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/23941",
    "user": "rws"
}
```
CC:  jdemeyer vdelecroix

Of many functions there are two versions with the same name---in `sage/arith` and in `sage/functions`, examples are `binomial` and `factorial`. On startup the latter versions overwrite the former because of order of import. That creates problems both with documentation, different interface, and different behavior expected. For example in #14723 the problem of `binomial(Qp(5)(8),2)` could not be resolved with the `sage/functions` version (because there the arguments have restrictions), although the `sage/arith` version would have worked perfectly. OTOH the arith version can not handle `binomial(x,y)` but the symbolic function version can.

The logical solution would be for all cases to
- make the arith version the default by removing the alias in `sage/function`; the arith version will no longer be overwritten
- dispatch calls to the arith version with symbolic arguments to the symbolic function version
- copy some symbolic documentation to arith because that docstring will be shown now

Issue created by migration from https://trac.sagemath.org/ticket/24178





---

archive/issue_comments_335477.json:
```json
{
    "body": "Why should there even be two versions of every function in the first place? Shouldn't we be able to support all use cases in one function?",
    "created_at": "2017-11-09T09:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335477",
    "user": "jdemeyer"
}
```

Why should there even be two versions of every function in the first place? Shouldn't we be able to support all use cases in one function?



---

archive/issue_comments_335478.json:
```json
{
    "body": "I wanted to have the code completely in `functions` but #14723 had its problems. See also #17489.",
    "created_at": "2017-11-09T10:13:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335478",
    "user": "rws"
}
```

I wanted to have the code completely in `functions` but #14723 had its problems. See also #17489.



---

archive/issue_comments_335479.json:
```json
{
    "body": "I could also naively ask, if everything coerces into SR why can't symbolic functions by default coerce every argument?",
    "created_at": "2017-11-10T06:38:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335479",
    "user": "rws"
}
```

I could also naively ask, if everything coerces into SR why can't symbolic functions by default coerce every argument?



---

archive/issue_comments_335480.json:
```json
{
    "body": "I mean you implemented the symbolic function machinery, and it's fine if you step back and say, let others go ahead now. But you could at least review attempts to fix your design decisions.",
    "created_at": "2017-11-10T06:44:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335480",
    "user": "rws"
}
```

I mean you implemented the symbolic function machinery, and it's fine if you step back and say, let others go ahead now. But you could at least review attempts to fix your design decisions.



---

archive/issue_comments_335481.json:
```json
{
    "body": "Alternatively, if NOT everything coerces into SR then the symbolic `binomial` interface is more restricted than the arith `binomial` interface, and thus the arith version should be default, calling the symbolic version.",
    "created_at": "2017-11-10T07:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335481",
    "user": "rws"
}
```

Alternatively, if NOT everything coerces into SR then the symbolic `binomial` interface is more restricted than the arith `binomial` interface, and thus the arith version should be default, calling the symbolic version.



---

archive/issue_comments_335482.json:
```json
{
    "body": "See also #19461#comment:9",
    "created_at": "2018-03-04T14:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335482",
    "user": "rws"
}
```

See also #19461#comment:9



---

archive/issue_comments_335483.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-15T16:01:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335483",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335484.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2018-03-15T16:13:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335484",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_335485.json:
```json
{
    "body": "This should resolve #17489 and #22314 in one go.\n\nDoctests pass in arith and all the  symbolics and function directories but let's see.\n\nRemaining issues like merging of documentation and deprecation of the obscure `binomial._binomial_sym`, `binomial._eval_`, `binomial._evalf_` is stuff for other tickets.\n\nPlease review.",
    "created_at": "2018-03-15T16:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335485",
    "user": "rws"
}
```

This should resolve #17489 and #22314 in one go.

Doctests pass in arith and all the  symbolics and function directories but let's see.

Remaining issues like merging of documentation and deprecation of the obscure `binomial._binomial_sym`, `binomial._eval_`, `binomial._evalf_` is stuff for other tickets.

Please review.



---

archive/issue_comments_335486.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2018-03-15T16:14:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335486",
    "user": "rws"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_335487.json:
```json
{
    "body": "Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.",
    "created_at": "2018-03-15T17:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335487",
    "user": "vdelecroix"
}
```

Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.



---

archive/issue_comments_335488.json:
```json
{
    "body": "Not changing the arith/ versions means writing a global interface function elsewhere. I'm fine with that.",
    "created_at": "2018-03-15T18:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335488",
    "user": "rws"
}
```

Not changing the arith/ versions means writing a global interface function elsewhere. I'm fine with that.



---

archive/issue_comments_335489.json:
```json
{
    "body": "Replying to [comment:13 vdelecroix]:\n> Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.\n\nI agree with Vincent. Keep the fast functions as they are now.",
    "created_at": "2018-03-15T19:27:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335489",
    "user": "chapoton"
}
```

Replying to [comment:13 vdelecroix]:
> Please don't do this. The point of having the functions the way they are in `arith` is because it is fast. Having each time an extra import, try/except, etc is a pain.

I agree with Vincent. Keep the fast functions as they are now.



---

archive/issue_comments_335490.json:
```json
{
    "body": "Nothing wrong with a fast arithmetic function version taking integer arguments, for special needs (and that's why they needed to be imported for some time now). Note that `arith.misc.binomial` does a lot of dispatching attempts and parent queries that do not match what you just argued.\n\nBecause the global entry functions in `functions.other` restrict the argument type, an unrestricted version is needed. Like as in `log` this can be put right next to the function class as a Python function. This would then carry a documentation overview.",
    "created_at": "2018-03-16T07:21:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335490",
    "user": "rws"
}
```

Nothing wrong with a fast arithmetic function version taking integer arguments, for special needs (and that's why they needed to be imported for some time now). Note that `arith.misc.binomial` does a lot of dispatching attempts and parent queries that do not match what you just argued.

Because the global entry functions in `functions.other` restrict the argument type, an unrestricted version is needed. Like as in `log` this can be put right next to the function class as a Python function. This would then carry a documentation overview.



---

archive/issue_comments_335491.json:
```json
{
    "body": "The original issue won't be fixed.",
    "created_at": "2018-03-16T07:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335491",
    "user": "rws"
}
```

The original issue won't be fixed.



---

archive/issue_comments_335492.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2018-03-16T07:36:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335492",
    "user": "rws"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_335493.json:
```json
{
    "body": "Resolution: wontfix",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335493",
    "user": "vdelecroix"
}
```

Resolution: wontfix



---

archive/issue_comments_335494.json:
```json
{
    "body": "closing positively reviewed duplicates",
    "created_at": "2018-05-18T17:16:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/23941",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/23941#issuecomment-335494",
    "user": "vdelecroix"
}
```

closing positively reviewed duplicates
