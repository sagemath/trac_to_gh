# Issue 21529: py3-compatible way to sort monomials

Issue created by migration from Trac.

Original creator: chapoton

Original creation time: 2016-10-25 14:08:35

CC:  jdemeyer tscrim aapitzsch

currently using a cmp, we need to switch to sorting using a key

may not be entirely obvious


---

Comment by chapoton created at 2016-10-25 14:09:30

New commits:


---

Comment by git created at 2016-10-26 19:08:37

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-27 20:01:38

I now get the following surprising behaviour:

```
sage: T.<a,b> = PowerSeriesRing(ZZ,2)
sage: f = a + b + a*b + T.O(3)
sage: f
a + b + a*b + O(a, b)^3
sage: f.change_ring(QQ)
a + b + a*b + O(a, b)^3
sage: f.change_ring(RR)
a*b + b + a + O(a, b)^3
```

Does anybody have any idea why ?


---

Comment by git created at 2016-10-27 20:02:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-30 15:13:47

This does not come from the change_ring:

```
sage: T.<a,b> = PowerSeriesRing(RDF,2)
sage: f = a + b + a*b + T.O(3)
sage: f
a*b + b + a + O(a, b)^3
```



---

Comment by git created at 2016-10-30 17:13:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-30 17:20:50

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-30 20:08:47

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2016-10-31 08:12:10

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-10-31 13:02:51

Changing status from new to needs_review.


---

Comment by chapoton created at 2016-10-31 13:02:51

green bot !


---

Comment by tscrim created at 2016-10-31 13:48:09

For all of the `compare` methods, do we want to deprecate them?


---

Comment by chapoton created at 2016-10-31 14:52:47

two possibilities: remove them all, or deprecate them all. After this ticket, they will no longer be used anywhere in sage.

I would rather choose removal, but I know that this breaks the rules.


---

Comment by git created at 2016-11-06 08:12:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by chapoton created at 2016-11-06 08:13:38

I have introduced the proper deprecations. This may affect a few doctests.


---

Comment by tscrim created at 2016-11-06 14:17:17

Sorry, I lost track of this, I had meant to respond. However, I agree that we probably should deprecate them since they are publically reachable. Thanks.


---

Comment by tscrim created at 2016-11-06 14:17:17

Changing status from needs_review to positive_review.


---

Comment by chapoton created at 2016-11-07 19:48:31

Changing status from positive_review to needs_work.


---

Comment by chapoton created at 2016-11-07 19:48:31

one failing doctest


---

Comment by git created at 2016-11-07 20:03:38

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by tscrim created at 2016-11-07 22:05:07

Changing status from needs_work to positive_review.


---

Comment by vbraun created at 2016-11-07 23:26:49


```
sage -t --long src/sage/rings/polynomial/term_order.py
**********************************************************************
File "src/sage/rings/polynomial/term_order.py", line 1542, in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex
Failed example:
    f = a + c^4; f.lm() # indirect doctest
Expected:
    c^4
Got:
    doctest:warning
      File "/home/sage/patchbot/sage/src/bin/sage-runtests", line 89, in <module>
        err = DC.run()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1130, in run
        self.run_doctests()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 854, in run_doctests
        self.dispatcher.dispatch()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1700, in dispatch
        self.parallel_dispatch()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1590, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1866, in start
        super(DocTestWorker, self).start()
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py", line 258, in _bootstrap
        self.run()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1839, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2132, in __call__
        runner.run(test)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 636, in run
        return self._run(test, compileflags, out)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex[1]>", line 1, in <module>
        f = a + c**Integer(4); f.lm() # indirect doctest
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_element.py", line 1387, in lm
        f = self._MPolynomial_element__element.lcmt( R.term_order().greater_tuple )
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py", line 1685, in greater_tuple_block
        r = getattr(block,"compare_tuples_" + block.name())(f[n:n+len(block)],g[n:n+len(block)])
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py", line 982, in compare_tuples_degrevlex
        deprecation(21766, 'sorting of polynomials now uses sortkey instead')
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 141, in warning
        warn(message, warning_class, stacklevel)
    :
    DeprecationWarning: sorting of polynomials now uses sortkey instead
    See http://trac.sagemath.org/21766 for details.
    c^4
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex
    [308 tests, 1 failure, 0.68 s]
```



---

Comment by tscrim created at 2016-11-08 02:56:23

Frédéric took care of this on the last commit.


---

Comment by vbraun created at 2016-11-09 18:16:15

Resolution: fixed


---

Comment by chapoton created at 2017-12-20 14:28:55

followup in #24409
