# Issue 21529: py3-compatible way to sort monomials

archive/issues_021529.json:
```json
{
    "body": "CC:  @jdemeyer @tscrim @a-andre\n\ncurrently using a cmp, we need to switch to sorting using a key\n\nmay not be entirely obvious\n\nIssue created by migration from https://trac.sagemath.org/ticket/21766\n\n",
    "created_at": "2016-10-25T14:08:35Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-7.5",
    "title": "py3-compatible way to sort monomials",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/21529",
    "user": "https://github.com/fchapoton"
}
```
CC:  @jdemeyer @tscrim @a-andre

currently using a cmp, we need to switch to sorting using a key

may not be entirely obvious

Issue created by migration from https://trac.sagemath.org/ticket/21766





---

archive/issue_comments_298405.json:
```json
{
    "body": "New commits:",
    "created_at": "2016-10-25T14:09:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298405",
    "user": "https://github.com/fchapoton"
}
```

New commits:



---

archive/issue_comments_298406.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-26T19:08:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298406",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298407.json:
```json
{
    "body": "I now get the following surprising behaviour:\n\n```\nsage: T.<a,b> = PowerSeriesRing(ZZ,2)\nsage: f = a + b + a*b + T.O(3)\nsage: f\na + b + a*b + O(a, b)^3\nsage: f.change_ring(QQ)\na + b + a*b + O(a, b)^3\nsage: f.change_ring(RR)\na*b + b + a + O(a, b)^3\n```\n\nDoes anybody have any idea why ?",
    "created_at": "2016-10-27T20:01:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298407",
    "user": "https://github.com/fchapoton"
}
```

I now get the following surprising behaviour:

```
sage: T.<a,b> = PowerSeriesRing(ZZ,2)
sage: f = a + b + a*b + T.O(3)
sage: f
a + b + a*b + O(a, b)^3
sage: f.change_ring(QQ)
a + b + a*b + O(a, b)^3
sage: f.change_ring(RR)
a*b + b + a + O(a, b)^3
```

Does anybody have any idea why ?



---

archive/issue_comments_298408.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-27T20:02:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298409.json:
```json
{
    "body": "This does not come from the change_ring:\n\n```\nsage: T.<a,b> = PowerSeriesRing(RDF,2)\nsage: f = a + b + a*b + T.O(3)\nsage: f\na*b + b + a + O(a, b)^3\n```\n",
    "created_at": "2016-10-30T15:13:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298409",
    "user": "https://github.com/fchapoton"
}
```

This does not come from the change_ring:

```
sage: T.<a,b> = PowerSeriesRing(RDF,2)
sage: f = a + b + a*b + T.O(3)
sage: f
a*b + b + a + O(a, b)^3
```




---

archive/issue_comments_298410.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-30T17:13:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298411.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-30T17:20:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298412.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-30T20:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298412",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298413.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-10-31T08:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298413",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298414.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2016-10-31T13:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298414",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_298415.json:
```json
{
    "body": "green bot !",
    "created_at": "2016-10-31T13:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298415",
    "user": "https://github.com/fchapoton"
}
```

green bot !



---

archive/issue_comments_298416.json:
```json
{
    "body": "For all of the `compare` methods, do we want to deprecate them?",
    "created_at": "2016-10-31T13:48:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298416",
    "user": "https://github.com/tscrim"
}
```

For all of the `compare` methods, do we want to deprecate them?



---

archive/issue_comments_298417.json:
```json
{
    "body": "two possibilities: remove them all, or deprecate them all. After this ticket, they will no longer be used anywhere in sage.\n\nI would rather choose removal, but I know that this breaks the rules.",
    "created_at": "2016-10-31T14:52:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298417",
    "user": "https://github.com/fchapoton"
}
```

two possibilities: remove them all, or deprecate them all. After this ticket, they will no longer be used anywhere in sage.

I would rather choose removal, but I know that this breaks the rules.



---

archive/issue_comments_298418.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-06T08:12:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298418",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298419.json:
```json
{
    "body": "I have introduced the proper deprecations. This may affect a few doctests.",
    "created_at": "2016-11-06T08:13:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298419",
    "user": "https://github.com/fchapoton"
}
```

I have introduced the proper deprecations. This may affect a few doctests.



---

archive/issue_comments_298420.json:
```json
{
    "body": "Sorry, I lost track of this, I had meant to respond. However, I agree that we probably should deprecate them since they are publically reachable. Thanks.",
    "created_at": "2016-11-06T14:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298420",
    "user": "https://github.com/tscrim"
}
```

Sorry, I lost track of this, I had meant to respond. However, I agree that we probably should deprecate them since they are publically reachable. Thanks.



---

archive/issue_comments_298421.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-11-06T14:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298421",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_298422.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2016-11-07T19:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298422",
    "user": "https://github.com/fchapoton"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_298423.json:
```json
{
    "body": "one failing doctest",
    "created_at": "2016-11-07T19:48:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298423",
    "user": "https://github.com/fchapoton"
}
```

one failing doctest



---

archive/issue_comments_298424.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2016-11-07T20:03:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298424",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_298425.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2016-11-07T22:05:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298425",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_298426.json:
```json
{
    "body": "\n```\nsage -t --long src/sage/rings/polynomial/term_order.py\n**********************************************************************\nFile \"src/sage/rings/polynomial/term_order.py\", line 1542, in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex\nFailed example:\n    f = a + c^4; f.lm() # indirect doctest\nExpected:\n    c^4\nGot:\n    doctest:warning\n      File \"/home/sage/patchbot/sage/src/bin/sage-runtests\", line 89, in <module>\n        err = DC.run()\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 1130, in run\n        self.run_doctests()\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py\", line 854, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1700, in dispatch\n        self.parallel_dispatch()\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1590, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1866, in start\n        super(DocTestWorker, self).start()\n      File \"/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py\", line 130, in start\n        self._popen = Popen(self)\n      File \"/home/sage/patchbot/sage/local/lib/python/multiprocessing/forking.py\", line 126, in __init__\n        code = process_obj._bootstrap()\n      File \"/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py\", line 258, in _bootstrap\n        self.run()\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 1839, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 2132, in __call__\n        runner.run(test)\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 636, in run\n        return self._run(test, compileflags, out)\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 498, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py\", line 861, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex[1]>\", line 1, in <module>\n        f = a + c**Integer(4); f.lm() # indirect doctest\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_element.py\", line 1387, in lm\n        f = self._MPolynomial_element__element.lcmt( R.term_order().greater_tuple )\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py\", line 1685, in greater_tuple_block\n        r = getattr(block,\"compare_tuples_\" + block.name())(f[n:n+len(block)],g[n:n+len(block)])\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py\", line 982, in compare_tuples_degrevlex\n        deprecation(21766, 'sorting of polynomials now uses sortkey instead')\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py\", line 100, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py\", line 141, in warning\n        warn(message, warning_class, stacklevel)\n    :\n    DeprecationWarning: sorting of polynomials now uses sortkey instead\n    See http://trac.sagemath.org/21766 for details.\n    c^4\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex\n    [308 tests, 1 failure, 0.68 s]\n```\n",
    "created_at": "2016-11-07T23:26:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298426",
    "user": "https://github.com/vbraun"
}
```


```
sage -t --long src/sage/rings/polynomial/term_order.py
**********************************************************************
File "src/sage/rings/polynomial/term_order.py", line 1542, in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex
Failed example:
    f = a + c^4; f.lm() # indirect doctest
Expected:
    c^4
Got:
    doctest:warning
      File "/home/sage/patchbot/sage/src/bin/sage-runtests", line 89, in <module>
        err = DC.run()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 1130, in run
        self.run_doctests()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/control.py", line 854, in run_doctests
        self.dispatcher.dispatch()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1700, in dispatch
        self.parallel_dispatch()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1590, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1866, in start
        super(DocTestWorker, self).start()
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py", line 130, in start
        self._popen = Popen(self)
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/forking.py", line 126, in __init__
        code = process_obj._bootstrap()
      File "/home/sage/patchbot/sage/local/lib/python/multiprocessing/process.py", line 258, in _bootstrap
        self.run()
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 1839, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 2132, in __call__
        runner.run(test)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 636, in run
        return self._run(test, compileflags, out)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 498, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/doctest/forker.py", line 861, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex[1]>", line 1, in <module>
        f = a + c**Integer(4); f.lm() # indirect doctest
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/multi_polynomial_element.py", line 1387, in lm
        f = self._MPolynomial_element__element.lcmt( R.term_order().greater_tuple )
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py", line 1685, in greater_tuple_block
        r = getattr(block,"compare_tuples_" + block.name())(f[n:n+len(block)],g[n:n+len(block)])
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/rings/polynomial/term_order.py", line 982, in compare_tuples_degrevlex
        deprecation(21766, 'sorting of polynomials now uses sortkey instead')
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/sage/patchbot/sage/local/lib/python2.7/site-packages/sage/misc/superseded.py", line 141, in warning
        warn(message, warning_class, stacklevel)
    :
    DeprecationWarning: sorting of polynomials now uses sortkey instead
    See http://trac.sagemath.org/21766 for details.
    c^4
**********************************************************************
1 item had failures:
   1 of   4 in sage.rings.polynomial.term_order.TermOrder.greater_tuple_neglex
    [308 tests, 1 failure, 0.68 s]
```




---

archive/issue_comments_298427.json:
```json
{
    "body": "Fr\u00e9d\u00e9ric took care of this on the last commit.",
    "created_at": "2016-11-08T02:56:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298427",
    "user": "https://github.com/tscrim"
}
```

Frédéric took care of this on the last commit.



---

archive/issue_comments_298428.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-11-09T18:16:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298428",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_020343.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-11-09T18:16:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/21529#event-20343"
}
```



---

archive/issue_comments_298429.json:
```json
{
    "body": "followup in #24409",
    "created_at": "2017-12-20T14:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/21529",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/21529#issuecomment-298429",
    "user": "https://github.com/fchapoton"
}
```

followup in #24409
