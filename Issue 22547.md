# Issue 22547: on clang libgap needs -fPIC

archive/issues_022547.json:
```json
{
    "body": "CC:  fbissey\n\nBuilding libgap with clang on Linux and FreeBSD does not work due to a misconfiguration--- the `-fPIC` flag is not added.\n\nSpecifically, it turns out this bit\n\n```\nCPPFLAGS=\"$CPPFLAGS\"' -DSYS_DEFAULT_PATHS=\\\"'\"$SAGE_LOCAL/gap/latest\"'\\\"'\n```\n\nabout `SYS_DEFAULT_PATHS` is breaking the detection of `-fPIC -DPIC` by `autoconf`, so everything is compiled without `-fPIC` and the linking of the shared object fails.\n\n\nSee #12426 and #22679 for details.\n\nIssue created by migration from https://trac.sagemath.org/ticket/22784\n\n",
    "created_at": "2017-04-08T20:11:37Z",
    "labels": [
        "porting",
        "major",
        "bug"
    ],
    "title": "on clang libgap needs -fPIC",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/22547",
    "user": "dimpase"
}
```
CC:  fbissey

Building libgap with clang on Linux and FreeBSD does not work due to a misconfiguration--- the `-fPIC` flag is not added.

Specifically, it turns out this bit

```
CPPFLAGS="$CPPFLAGS"' -DSYS_DEFAULT_PATHS=\"'"$SAGE_LOCAL/gap/latest"'\"'
```

about `SYS_DEFAULT_PATHS` is breaking the detection of `-fPIC -DPIC` by `autoconf`, so everything is compiled without `-fPIC` and the linking of the shared object fails.


See #12426 and #22679 for details.

Issue created by migration from https://trac.sagemath.org/ticket/22784





---

archive/issue_comments_314281.json:
```json
{
    "body": "That's just weird, I just started to work on this, launched a build and bang there is a ticket for me :)",
    "created_at": "2017-04-08T20:13:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314281",
    "user": "fbissey"
}
```

That's just weird, I just started to work on this, launched a build and bang there is a ticket for me :)



---

archive/issue_comments_314282.json:
```json
{
    "body": "And having the definition just in `spkg-check` just works. I need to put things in order and write meaningful comments in the right spots.\n\n```\n[libgap-4.8.6] Successfully installed libgap-4.8.6\n[libgap-4.8.6] Running the test suite for libgap-4.8.6...\n[libgap-4.8.6] Making check in src\n[libgap-4.8.6] make[3]: Nothing to be done for `check'.\n[libgap-4.8.6] Making check in test\n[libgap-4.8.6] make  test shell error_handler\n[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\\\"/Users/fbissey/build/sage-clang/local/gap/latest\\\" -I/Users/fbissey/build/sage-clang/local/include  -MT test-test.o -MD -MP -MF .deps/test-test.Tpo -c -o test-test.o `test -f 'test.c' || echo './'`test.c\n[libgap-4.8.6] mv -f .deps/test-test.Tpo .deps/test-test.Po\n[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o test test-test.o ../src/libgap.la \n[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/test test-test.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm\n[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\\\"/Users/fbissey/build/sage-clang/local/gap/latest\\\" -I/Users/fbissey/build/sage-clang/local/include  -MT shell-shell.o -MD -MP -MF .deps/shell-shell.Tpo -c -o shell-shell.o `test -f 'shell.c' || echo './'`shell.c\n[libgap-4.8.6] mv -f .deps/shell-shell.Tpo .deps/shell-shell.Po\n[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o shell shell-shell.o ../src/libgap.la \n[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/shell shell-shell.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm\n[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\\\"/Users/fbissey/build/sage-clang/local/gap/latest\\\" -I/Users/fbissey/build/sage-clang/local/include  -MT error_handler-error_handler.o -MD -MP -MF .deps/error_handler-error_handler.Tpo -c -o error_handler-error_handler.o `test -f 'error_handler.c' || echo './'`error_handler.c\n[libgap-4.8.6] mv -f .deps/error_handler-error_handler.Tpo .deps/error_handler-error_handler.Po\n[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o error_handler error_handler-error_handler.o ../src/libgap.la \n[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/error_handler error_handler-error_handler.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm\n[libgap-4.8.6] make  check-TESTS\n[libgap-4.8.6] PASS: test\n[libgap-4.8.6] PASS: shell\n[libgap-4.8.6] PASS: error_handler\n[libgap-4.8.6] ============================================================================\n[libgap-4.8.6] Testsuite summary for libGAP 4.8.6\n[libgap-4.8.6] ============================================================================\n[libgap-4.8.6] # TOTAL: 3\n[libgap-4.8.6] # PASS:  3\n[libgap-4.8.6] # SKIP:  0\n[libgap-4.8.6] # XFAIL: 0\n[libgap-4.8.6] # FAIL:  0\n[libgap-4.8.6] # XPASS: 0\n[libgap-4.8.6] # ERROR: 0\n[libgap-4.8.6] ============================================================================\n```\n",
    "created_at": "2017-04-08T20:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314282",
    "user": "fbissey"
}
```

And having the definition just in `spkg-check` just works. I need to put things in order and write meaningful comments in the right spots.

```
[libgap-4.8.6] Successfully installed libgap-4.8.6
[libgap-4.8.6] Running the test suite for libgap-4.8.6...
[libgap-4.8.6] Making check in src
[libgap-4.8.6] make[3]: Nothing to be done for `check'.
[libgap-4.8.6] Making check in test
[libgap-4.8.6] make  test shell error_handler
[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\"/Users/fbissey/build/sage-clang/local/gap/latest\" -I/Users/fbissey/build/sage-clang/local/include  -MT test-test.o -MD -MP -MF .deps/test-test.Tpo -c -o test-test.o `test -f 'test.c' || echo './'`test.c
[libgap-4.8.6] mv -f .deps/test-test.Tpo .deps/test-test.Po
[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o test test-test.o ../src/libgap.la 
[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/test test-test.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm
[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\"/Users/fbissey/build/sage-clang/local/gap/latest\" -I/Users/fbissey/build/sage-clang/local/include  -MT shell-shell.o -MD -MP -MF .deps/shell-shell.Tpo -c -o shell-shell.o `test -f 'shell.c' || echo './'`shell.c
[libgap-4.8.6] mv -f .deps/shell-shell.Tpo .deps/shell-shell.Po
[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o shell shell-shell.o ../src/libgap.la 
[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/shell shell-shell.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm
[libgap-4.8.6] clang -DHAVE_CONFIG_H -I.. -I..   -DSYS_DEFAULT_PATHS=\"/Users/fbissey/build/sage-clang/local/gap/latest\" -I/Users/fbissey/build/sage-clang/local/include  -MT error_handler-error_handler.o -MD -MP -MF .deps/error_handler-error_handler.Tpo -c -o error_handler-error_handler.o `test -f 'error_handler.c' || echo './'`error_handler.c
[libgap-4.8.6] mv -f .deps/error_handler-error_handler.Tpo .deps/error_handler-error_handler.Po
[libgap-4.8.6] /bin/sh ../libtool  --tag=CC   --mode=link clang -I/Users/fbissey/build/sage-clang/local/include  -lgmp -lm -L/Users/fbissey/build/sage-clang/local/lib -Wl,-rpath,/Users/fbissey/build/sage-clang/local/lib  -o error_handler error_handler-error_handler.o ../src/libgap.la 
[libgap-4.8.6] libtool: link: clang -I/Users/fbissey/build/sage-clang/local/include -Wl,-rpath -Wl,/Users/fbissey/build/sage-clang/local/lib -o .libs/error_handler error_handler-error_handler.o  -L/Users/fbissey/build/sage-clang/local/lib ../src/.libs/libgap.dylib -lgmp -lm
[libgap-4.8.6] make  check-TESTS
[libgap-4.8.6] PASS: test
[libgap-4.8.6] PASS: shell
[libgap-4.8.6] PASS: error_handler
[libgap-4.8.6] ============================================================================
[libgap-4.8.6] Testsuite summary for libGAP 4.8.6
[libgap-4.8.6] ============================================================================
[libgap-4.8.6] # TOTAL: 3
[libgap-4.8.6] # PASS:  3
[libgap-4.8.6] # SKIP:  0
[libgap-4.8.6] # XFAIL: 0
[libgap-4.8.6] # FAIL:  0
[libgap-4.8.6] # XPASS: 0
[libgap-4.8.6] # ERROR: 0
[libgap-4.8.6] ============================================================================
```




---

archive/issue_comments_314283.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2017-04-08T20:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314283",
    "user": "fbissey"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_314284.json:
```json
{
    "body": "Ready for review.\n----\nNew commits:",
    "created_at": "2017-04-08T20:31:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314284",
    "user": "fbissey"
}
```

Ready for review.
----
New commits:



---

archive/issue_comments_314285.json:
```json
{
    "body": "Looks good, works on FreeBSD.",
    "created_at": "2017-04-08T21:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314285",
    "user": "dimpase"
}
```

Looks good, works on FreeBSD.



---

archive/issue_comments_314286.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2017-04-08T21:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314286",
    "user": "dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_314287.json:
```json
{
    "body": "Just to make sure, you have run it with `SAGE_CHECK=yes`?",
    "created_at": "2017-04-08T22:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314287",
    "user": "fbissey"
}
```

Just to make sure, you have run it with `SAGE_CHECK=yes`?



---

archive/issue_comments_314288.json:
```json
{
    "body": "OK revised the description. Now it has more details than the previously quoted tickets.",
    "created_at": "2017-04-08T22:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314288",
    "user": "fbissey"
}
```

OK revised the description. Now it has more details than the previously quoted tickets.



---

archive/issue_comments_314289.json:
```json
{
    "body": "Replying to [comment:5 fbissey]:\n> Just to make sure, you have run it with `SAGE_CHECK=yes`?\nwith, and without, as well. All good.",
    "created_at": "2017-04-08T22:31:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314289",
    "user": "dimpase"
}
```

Replying to [comment:5 fbissey]:
> Just to make sure, you have run it with `SAGE_CHECK=yes`?
with, and without, as well. All good.



---

archive/issue_comments_314290.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2017-04-10T22:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/22547",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/22547#issuecomment-314290",
    "user": "vbraun"
}
```

Resolution: fixed
