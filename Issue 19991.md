# Issue 19991: Spectral radius of graphs

Issue created by migration from https://trac.sagemath.org/ticket/20228

Original creator: vdelecroix

Original creation time: 2016-03-17 23:00:57

There are no current way to compute the spectral radius of a graph (the Perron-Frobenius eigenvalue of its adjacency matrix). We provide a method `spectral_radius` that provides an interval of floating approximations.

It is much faster than previously available methods (where the exact methods are unusable because of characteristic polynomial computation)

```
sage: G = digraphs.RandomDirectedGNM(10,40)
sage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))
100 loops, best of 3: 6.23 ms per loop
sage: %timeit G.spectral_radius()
1000 loops, best of 3: 178 Âµs per loop
```

And for a larger graph

```
sage: G = digraphs.RandomDirectedGNM(400, 6000)
sage: %timeit max(G.adjacency_matrix().charpoly().roots(AA, multiplicities=False))
1 loop, best of 3: 4.63 s per loop
sage: %timeit G.spectral_radius()
10 loops, best of 3: 13 ms per loop
```

The new method `spectral_radius` can be used for much larger graph as soon as the spectral graph is large enough to ensure the convergence.


---

Comment by vdelecroix created at 2016-03-17 23:01:33

New commits:


---

Comment by vdelecroix created at 2016-03-17 23:01:33

Changing status from new to needs_review.


---

Comment by maurimo created at 2016-03-21 14:38:44

Is there a reason for not using Sage's interval arithmetic?
http://doc.sagemath.org/html/en/reference/rings_numerical/sage/rings/real_mpfi.html
Sage's interval library is already taking care of lowlevel floating point rounding problems, and could remove complexity from the function.
Apart from this everything looks fine.


---

Comment by maurimo created at 2016-03-21 14:38:44

Changing keywords from "" to "days71".


---

Comment by maurimo created at 2016-03-21 14:38:44

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2016-03-21 15:23:10

Hello Maurizio,

Thanks for having a look!

Interval arithmetic does not use machine floating point but [mpfr](http://www.mpfr.org/). It would be much slower than the version I wrote. This would only be a constant time slower which on my computer seems to be a factor `x8`. The intended application of this method is for huge sparse graphs (let say with `~1000000` vertices) and a `x8` speedup is not negligible. Similarly, I could have used ball arithmetic [arb](http://fredrikj.net/arb/) which is also shipped with Sage (and should be faster than interval arithmetic).

Moreover, it is a certain amount of work to write `matrix/vector` code using either `mpir` or `arb`. Using `mpir` or `arb` would also decrease readability since multiplying numbers with `mpfr` is done via `mpfr_mul(x, a, b, MPFR_RNDN)` which is much less readable than `x = a*b`. Though the approach using either mpir or arb would have the advantage of making available higher precision. This would indeed be interesting for small graphs.

On the other hand, the function I made is written in C. It is not reasonable to use the Cython wrapper we have in Sage as allocating/deallocating million of Python classes is expensive.

The only thing that can easily be done would be to return an element in `RIF` instead of a tuple of Python float.

What I wrote is not the "best and fastest algorithm" to get the Perron-Frobenius eigenvalue. For example, it suffers from slow convergence in absence of spectral gap. But it was very helpful to me and might as well be helpful for others. I consider than having an arbitrary precision version using `mpfr`, `mpir` or `arb` would be indeed good for another ticket. It will need some care because you want to increase slowly the precision (it makes no sense to use the full precision on the first iterations). Moreover, it is not immediate to determine what is the precision needed for the computation to obtain a given precision for the answer.

I need to fix a mistake (the condition in the loop should be `(e_max - e_min) > e_max * c_prec` instead of `e_max * (e_max - e_min) > c_prec`). I would also like to move the `sage_free` inside the `finally` block (to avoid unfreed memory). I am waiting for your comments before submitting the commit.


---

Comment by maurimo created at 2016-03-21 15:35:26

Changing status from needs_info to needs_work.


---

Comment by maurimo created at 2016-03-21 15:35:26

Hi Vincent,
Sure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.


---

Comment by vdelecroix created at 2016-03-21 15:38:43

Replying to [comment:5 maurimo]:
> Hi Vincent,
> Sure, yours is a really good reason. When you fix the mistakes you are talking about you have my approval for the patch.

Nope. The mistakes have to be fixed. It was about the rest. For example, I am not sure whether it makes more sense to return a pair of `float` or an element of `RIF` (the standard field for interval arithmetic).


---

Comment by git created at 2016-03-21 15:50:49

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2016-03-21 15:51:11

Changing status from needs_work to needs_review.


---

Comment by maurimo created at 2016-03-21 17:20:53

Well,
In my opinion a pair of float is fine, if you are not using intervals internally we can avoid an unnecessary dependency, a user can easily create an interval from the float pair if necessary.
Waiting for your last word, and I will accept your patch.


---

Comment by vdelecroix created at 2016-03-21 17:40:29

I have nothing to add. Thanks.


---

Comment by vdelecroix created at 2016-03-21 17:43:11

There is a conflict with #20210. I need to rebase this ticket over it.


---

Comment by vdelecroix created at 2016-03-21 17:43:11

Changing status from needs_review to needs_work.


---

Comment by git created at 2016-03-21 18:53:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by vdelecroix created at 2016-03-21 18:53:58

Changing status from needs_work to needs_review.


---

Comment by maurimo created at 2016-03-22 14:15:14

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2016-03-23 12:46:46

Resolution: fixed
