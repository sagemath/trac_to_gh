# Issue 16227: method to list multiplicative cosets of finite field

Issue created by migration from Trac.

Original creator: vdelecroix

Original creation time: 2014-06-09 22:06:05

CC:  ncohen

In order to implement difference families (see #16461), I need a method to list multiplicative cosets of a finite field. Here it is.


---

Comment by vdelecroix created at 2014-06-09 22:07:39

Changing status from new to needs_review.


---

Comment by vdelecroix created at 2014-06-09 22:07:39

New commits:


---

Comment by vdelecroix created at 2014-06-09 22:08:00

Oups... wait a minute!


---

Comment by git created at 2014-06-09 22:09:21

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by git created at 2014-06-11 00:03:43

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-06-11 07:52:13

For some reason the function does not appear in the doc `-_-`


---

Comment by ncohen created at 2014-06-11 08:17:25

Changing status from needs_review to needs_info.


---

Comment by ncohen created at 2014-06-11 08:17:25

Hello Vincent !

There is a small commit on public/16464 for typos.

I've got a question on the documentation, however : you say at the beginnig that "the orbits of the group action of `R^*` on `R` are called the cyclotomic cosets". From which it follows that the only two cyclotomic cosets of a finite Field are `R^*` and 0, doesn't it ?

I mean : your function takes `q` as an argument, though your definition of what a cyclotomic coset is does not involve `q` in any way. Sooooo I don't get it : shouldn't they be called "cyclotomic cosets with respect to q" or something ?

Nathann


---

Comment by ncohen created at 2014-06-11 08:23:41

About this part of the code 


```
+    try:
+        return DuadicCodeEvenPair(F,Q,N)
+    except TypeError:
+        raise TypeError("No quadratic residue code exists for these parameters.")
```


Is there any reason why your replaced the `if not(is_a_splitting(Q,N,n))` by this try/catch ? What worries me is that it could catch `TypeErrors` raised in `DuadicCodeEvenPair` that are real bugs and not created by this `if not(is_a_splitting(Q,N,n))`.

Nathann


---

Comment by vdelecroix created at 2014-06-11 09:35:08

Changing status from needs_info to needs_review.


---

Comment by vdelecroix created at 2014-06-11 09:35:08

Replying to [comment:9 ncohen]:
> About this part of the code 
> 
> {{{
> +    try:
> +        return DuadicCodeEvenPair(F,Q,N)
> +    except TypeError:
> +        raise TypeError("No quadratic residue code exists for these parameters.")
> }}}
> 
> Is there any reason why your replaced the `if not(is_a_splitting(Q,N,n))` by this try/catch ? What worries me is that it could catch `TypeErrors` raised in `DuadicCodeEvenPair` that are real bugs and not created by this `if not(is_a_splitting(Q,N,n))`.

Ok. I modified the function... the errors are clearer and there is no try/except anymore.
----
New commits:


---

Comment by git created at 2014-06-11 09:45:05

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-06-11 10:13:50

A new commit, with two questions :

1)


```
+    if n <= 2 or not n.is_prime():
+        raise ValueError("the argument n must be an odd prime")
```


Why don't you test that `n` is odd ?

2) Why would this be allowed ? It really does NOT have the same behaviour.


```
-    n = max(S1+S2)+1
-    if not(is_a_splitting(S1,S2,n)):
+    n = len(S1) + len(S2) + 1
+    if not is_a_splitting(S1,S2,n):
```



Nathann


---

Comment by git created at 2014-06-11 10:14:23

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by ncohen created at 2014-06-11 10:14:33

Changing status from needs_review to needs_info.


---

Comment by vdelecroix created at 2014-06-11 10:25:43

Replying to [comment:12 ncohen]:
> A new commit, with two questions :
> 
> 1)
> 
> {{{
> +    if n <= 2 or not n.is_prime():
> +        raise ValueError("the argument n must be an odd prime")
> }}}
> 
> Why don't you test that `n` is odd ?

Hum. If n is prime and not 2 it is necessarily odd.

> 2) Why would this be allowed ? It really does NOT have the same behaviour.
> 
> {{{
> -    n = max(S1+S2)+1
> -    if not(is_a_splitting(S1,S2,n)):
> +    n = len(S1) + len(S2) + 1
> +    if not is_a_splitting(S1,S2,n):
> }}}

It does. `is_a_splitting(S1,S2,n)` answers `True` if the input is a partition `(S1,S2)` of `{1,...,n-1}` (+ a condition on the partition). So I just changed the code to avoid the concatenation and the max.

Do you agree?


---

Comment by vdelecroix created at 2014-06-11 10:36:11

Before the end, I would also like to change `len(S1.union(S2)) != n-1` in `is_a_splitting` by `S1.difference(S2)`. Makes more sense.


---

Comment by ncohen created at 2014-06-11 10:37:13

> Do you agree?

Turns out that I am an idiot.

Nathann


---

Comment by ncohen created at 2014-06-11 10:40:06

1> Before the end, I would also like to change `len(S1.union(S2)) != n-1` in `is_a_splitting` by `S1.difference(S2)`. Makes more sense.

Or `len(S1 & S2)`.

Nathann


---

Comment by vdelecroix created at 2014-06-11 10:41:37

Replying to [comment:17 ncohen]:
> > Do you agree?
> 
> Turns out that I am an idiot.

Nope. This is very cool

```
-        if GCD(b,n) == 1 and all(b*x in S2 for x in S1)  and all(b*x in S1 for x in S2):
+        if GCD(b,n) == 1 and all(b*x in S2 for x in S1):
```



---

Comment by vdelecroix created at 2014-06-11 10:46:17

Replying to [comment:18 ncohen]:
> 1> Before the end, I would also like to change `len(S1.union(S2)) != n-1` in `is_a_splitting` by `S1.difference(S2)`. Makes more sense.
> 
> Or `len(S1 & S2)`.

or `S1 & S2`. It is faster to call `__nonzero__` rather than `__len__`.


---

Comment by ncohen created at 2014-06-11 10:51:16

> or `S1 & S2`. It is faster to call `__nonzero__` rather than `__len__`.

Is it ? Either way, add a commit !

Nathann


---

Comment by git created at 2014-06-11 10:51:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-06-11 10:54:55

Looks like it is

```
sage: S1=set(range(10))
sage: S2=set(range(10,20))
sage: timeit("if S1&S2: pass",number=1000000)
1000000 loops, best of 3: 446 ns per loop
sage: timeit("if len(S1&S2): pass",number=1000000)
1000000 loops, best of 3: 517 ns per loop
```

50ns... it will save a lot of time!


---

Comment by ncohen created at 2014-06-11 10:58:50

> 50ns... it will save a lot of time!

Indeed. I have been living as a fool.

Nathann


---

Comment by ncohen created at 2014-06-11 11:06:03

Changing status from needs_info to positive_review.


---

Comment by ncohen created at 2014-06-11 11:06:03

Well, then ...

Nathann


---

Comment by vdelecroix created at 2014-06-11 11:09:12

Cool. Thanks for the review.

(Note: in the meantime I discovered that Python set have a nice method `.is_disjoint()`...)


---

Comment by ncohen created at 2014-06-11 11:09:59

Add it, and set the ticket back to its current state.

Nathann


---

Comment by git created at 2014-06-11 11:15:44

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:


---

Comment by git created at 2014-06-11 11:15:44

Changing status from positive_review to needs_review.


---

Comment by vdelecroix created at 2014-06-11 11:15:59

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-14 14:22:15


```
sage -t src/sage/categories/category.py
**********************************************************************
File "src/sage/categories/category.py", line 1594, in sage.categories.category.Category._with_axiom_as_tuple
Failed example:
    Rings().Division()._with_axiom_as_tuple('Finite')
Expected:
    (Category of division rings,
     Category of finite monoids,
     Category of commutative magmas)
Got:
    (Category of division rings, Category of finite rings, Category of commutative magmas)
```

and related failures everywhere


---

Comment by vbraun created at 2014-06-14 14:22:15

Changing status from positive_review to needs_work.


---

Comment by ncohen created at 2014-06-14 14:24:46

`O_o`

I have no idea how it could be caused by this patch. All it does is add a function and fix some doc `O_o`

Nathann


---

Comment by vdelecroix created at 2014-06-14 14:26:13

Nope. I added a (nested) class `Finite` in `sage.categories.rings.Rings`... so it is likely that I would have to run all tests in `sage.categories` and see..


---

Comment by git created at 2014-06-14 16:18:16

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-06-14 16:18:24

Hi Nathann,

Because of this error, I notice that in Sage rings are not necessarily commutative. It would hence be better have `cyclotomic_cosets` only at the level of commutative rings... (you do not want it for the set of `2x2` matrices over `GF(3)`).

Please review it again (it is only a cut and paste).

Vincent
----
New commits:


---

Comment by vdelecroix created at 2014-06-14 18:18:19

Changing status from needs_work to needs_review.


---

Comment by ncohen created at 2014-06-14 21:26:52


```
sage -t --long rings/finite_rings/integer_mod_ring.py  # 2 doctests failed
sage -t --long misc/c3_controlled.pyx  # 2 doctests failed
sage -t --long rings/ring.pyx  # 1 doctest failed
```


Nathann


---

Comment by ncohen created at 2014-06-14 21:26:52

Changing status from needs_review to needs_work.


---

Comment by git created at 2014-06-14 21:35:26

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by vdelecroix created at 2014-06-14 21:37:22

Changing status from needs_work to needs_review.


---

Comment by vdelecroix created at 2014-06-14 21:37:22

Hi Nathann,

Thank you for running the long tests! I asked at my lab and will have a machine dedicated to Sage tests from tuesday... will be much better.

Vincent


---

Comment by ncohen created at 2014-06-15 11:01:30

Changing status from needs_review to positive_review.


---

Comment by vbraun created at 2014-06-18 12:00:31

Resolution: fixed
