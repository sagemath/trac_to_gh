# Issue 14672: Update NTL to 6.0.0 and track all files

Issue created by migration from Trac.

Original creator: vbraun

Original creation time: 2013-07-10 13:53:38

Assignee: jdemeyer

CC:  leif jpflori

New upstream version. Also add a spkg-src to generate the stub autoconf files and track all files.


---

Comment by leif created at 2013-07-10 14:30:21

... and keep the `$MAKE` patches in mind (don't recall the ticket number right now), in case they're still necessary.


---

Comment by vbraun created at 2013-07-10 14:48:51

If you mean #14692: I won't included anything from that ticket as long as it is not finished.


---

Comment by leif created at 2013-07-10 15:02:17

Replying to [comment:3 vbraun]:
> If you mean #14692: I won't included anything from that ticket as long as it is not finished.

Yes, that's what I meant.

It _is_ finished, you just have to include the (`$MAKE`-related) patches.

I rebased Jean-Pierre's spkg at #2114 on mine, but then Jeroen felt he had to make trivial changes to that again, so that I would now again have to _rebase mine_ on that of #2114, but that doesn't make sense if you're going to create a 6.0.0 anyway.


---

Comment by jpflori created at 2013-07-10 15:29:35

Yes please include #14692, there was just a trivial change to .hgignore to do and hg addremove but I completely forgot...


---

Comment by jpflori created at 2013-07-10 15:31:43

If Shoup has some interest on updating NTL again, we should definitely forward him our patches.


---

Attachment

Initial patch


---

Comment by vbraun created at 2013-07-10 15:40:11

Please somebody go ahead and forward our patches...


---

Comment by jpflori created at 2013-07-10 15:41:17

Ok, I'll take care of forwarding the patches.


---

Comment by jpflori created at 2013-07-10 15:53:17

Groumpf, you just prevented me from posting that:

Please don't produce any spkg yet if not already done.
Before forwarding the patches I have to check they still apply onto 6.0.0, so I can draft an initial spkg on top of the one from #14692 and then you can fix whatever you want on top of it to ease the git transition and so on.


So I'll just check your spkg.


---

Comment by vbraun created at 2013-07-10 16:48:07

Singular doesn't build with NTL-6.0.0.

In the interest of getting this git-ready let's wait with the version bump.


---

Comment by vbraun created at 2013-07-10 19:00:22

For the record, this is not fixed in Singular-3.1.6 (#14333), but is fixed in the upstream trunk https://groups.google.com/d/msg/libsingular-devel/aiMvEnN8qyg/cIFUsOXxK_MJ


---

Comment by jpflori created at 2013-07-11 14:15:55

Replying to [comment:8 jpflori]:
> Ok, I'll take care of forwarding the patches.
Done and taken into account by Shoup.
It's on his todo list.
Great news.


---

Comment by jpflori created at 2013-07-15 12:47:06

Replying to [comment:14 jpflori]:
> Replying to [comment:8 jpflori]:
> > Ok, I'll take care of forwarding the patches.
> Done and taken into account by Shoup.
> It's on his todo list.
> Great news.
For future reference:
http://shoup.net/pipermail/ntl_shoup.net/2013-July/000041.html

Note that Victor's answer is not appearing there.


---

Comment by jpflori created at 2013-12-31 13:26:54

Singular update is positively reviewed.
I simply gitified everything and had to add a definition in the Singular patch for NTL 6.0.0 compat.
Let's get this in, I agree with Volker previous changes.
The only point left is quickly check that I did not screwed up the singular patch modif; and fix all the horrible segfaults.
----
New commits:


---

Comment by jpflori created at 2013-12-31 13:26:54

Changing status from new to needs_review.


---

Comment by git created at 2013-12-31 13:27:46

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2013-12-31 13:34:56

Changing status from needs_review to needs_work.


---

Comment by jpflori created at 2013-12-31 14:29:01

It seems we now have double frees.
As a first guess, I'd say that with the previous hacks we explicitely destroyed the hacked C++ objects, and we still do, but Cython might as well now it's aware that these are C++ object, and so boom.


---

Comment by git created at 2013-12-31 15:01:19

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by jpflori created at 2013-12-31 15:01:53

All tests should pass now.


---

Comment by jpflori created at 2013-12-31 15:01:53

Changing status from needs_work to needs_review.


---

Comment by fbissey created at 2013-12-31 18:31:58

Just to be clear. You git branch has both #14333 and this ticket. Which now that I wrote it, seem totally normal. With git, branch depending from another ticket will include change from the depending ticket.


---

Comment by jpflori created at 2014-01-03 13:07:09

I don't really know what should happen here.
For sure #14333 is a dependency.
But I forgot the # in the dependencies field so maybe that's what confused the git plugin.


---

Comment by fbissey created at 2014-01-04 01:07:31

OK so I will try to do some testing of this. Apart from singular the following packages have a dependency to ntl:
 * flint
 * eclib
 * linbox
 * "sage-clib" and sage itself.

So my plan is to start from 6.1.beta2 add #14333, this ticket the flint upgrade and then rebuild the rest.


---

Comment by jpflori created at 2014-02-17 15:50:04

Replying to [comment:25 fbissey]:
> OK so I will try to do some testing of this. Apart from singular the following packages have a dependency to ntl:
>  * flint
>  * eclib
>  * linbox
>  * "sage-clib" and sage itself.
> 
> So my plan is to start from 6.1.beta2 add #14333, this ticket the flint upgrade and then rebuild the rest.
Any result on that? :)


---

Comment by fbissey created at 2014-02-17 18:23:43

I dropped the ball because of other stuff. It will be easier to start from 6.2.beta2 since singular has been merged.


---

Comment by fbissey created at 2014-02-18 00:22:45

Well so far it is extremely painful and not going very far. Switching branch with sage --dev checkout brought me in a state where I ended downloading older versions of sage's dependencies.
I have a thing about complaining about documentation, I'll certainly try to write some stuff down if I ever figure out things.


---

Comment by fbissey created at 2014-02-18 00:24:56

Oh and the tarball cannot be found for good measure.


---

Comment by jpflori created at 2014-02-18 07:54:12

Typo indeed.


---

Comment by fbissey created at 2014-02-18 09:11:11

Replying to [comment:31 jpflori]:
> Typo indeed.

Can't believe I didn't notice that.


---

Comment by fbissey created at 2014-02-18 22:22:12

Can you rebase the branch on 6.2.beta2? I have done:

 * ./sage -dev checkout --ticket 14876
 * downloaded ntl-6.0.0.tar.bz2 to upstream
 * tried to rebuild flint...


```
cat build/pkgs/flint/package-version.txt 
2.3.p1
```

So that branch is still on the old versions of flint, singular and eclib. I need to be able to rebuild them to fully test the ticket.


---

Comment by git created at 2014-02-18 22:24:07

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by fbissey created at 2014-02-18 22:26:16

Do you know how I should checkout the changes? ./sage -dev checkout --ticket 14876 still leaves me with flint 2.3.p1.


---

Comment by jpflori created at 2014-02-18 22:31:03

I'd say

```
git fetch --all
git checkout -b test_ntl trac/u/jpflori/ticket/14876
```

Of course, you need to be tracking everything from the track git branch for that to work.
I don't remmeber the syntac, but something like

```
git fetch trac u/jpflori/ticket/14876
git checkout -b test_ntl trac/u/jpflori/ticket/14876
```

might do the trick if you don't.

I don't know how to do that with the dev scripts, sorry :(


---

Comment by fbissey created at 2014-02-19 01:02:20

Forget about the dev scripts for now.

```
git fetch --all
git checkout u/jpflori/ticket/14876
```

worked. pity I didn't think of switching to a test branch earlier.
So far I did ./sage -f flint,eclib,singular,linbox and ./sage -b successfully.
Running ./sage -tp 12 --all --long now.


---

Comment by fbissey created at 2014-02-19 01:21:11

Changing status from needs_review to positive_review.


---

Comment by fbissey created at 2014-02-19 01:21:11


```
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 1234.6 seconds
    cpu time: 12669.7 seconds
    cumulative wall time: 13905.8 seconds
```

Yes!


---

Comment by fbissey created at 2014-02-19 20:40:14

I just had a thought. Will the dependency of ntl need an artificial bump to be rebuilt or is the upgrade system able to cope with that?


---

Comment by vbraun created at 2014-02-20 11:23:14

Dependents of NTL will be rebuilt automatically.

I tried upgrading and it didn't produce a working Sage, but complete rebuild does. Possibly because wrong header files are used at one point, one of the limitations of our build system.


---

Comment by vbraun created at 2014-02-20 23:17:08

Resolution: fixed


---

Comment by jpflori created at 2014-03-14 10:59:20

For those interested, 6.1 has been released: #15938 (nothing to see there yet).
