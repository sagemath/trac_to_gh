# Issue 30083: Parallelizable Manifold not covered by one Chart and default_frame

Issue created by migration from https://trac.sagemath.org/ticket/30320

Original creator: @mjungmath

Original creation time: 2020-08-09 10:43:21

CC:  egourgoulhon tscrim


```
sage: M = Manifold(3, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V')
sage: c_xyz.<x,y,z> = U.chart(); c_uvt.<u,v,t> = V.chart()
sage: M.default_frame()
Coordinate frame (U, (d/dx,d/dy,d/dz))
sage: e = M.vector_frame('e'); e
Vector frame (M, (e_0,e_1,e_2))
sage: M.default_frame()
Coordinate frame (U, (d/dx,d/dy,d/dz))
sage: M.set_default_frame(c_xyz.frame())
Traceback (most recent call last):
...
ValueError: the frame domain must coincide with the 3-dimensional differentiable manifold M
```


In case of `M=SU(2)=S^3` this can happen: it cannot be covered by one chart but is parallelizable.

However, due to the error message, the method `default_frame` is obviously intended to return the default frame which covers `M` if possible. This is not given in the above example.


---

Comment by @mjungmath created at 2020-08-09 11:48:08

I see two options here:

1. One allows also frames defined on subsets for `set_default_frame`, even in the parallelizable case.
2. One overwrites the default frame for the first frame which covers `M` in case it haven't covered `M` before.


---

Comment by @mjungmath created at 2020-08-09 11:54:46

I think, both options are reasonable. The first is, of course, more comprehensible to user.

I don't see a third choice. If you have any ideas, I'd welcome them.


---

Comment by egourgoulhon created at 2020-08-09 13:09:35

Thanks for handling this. In all the sage/manifolds settings, the "default frame" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. 

In `DifferentiableManifold.set_default_frame()`, there is

```
        if frame._domain is not self:
            if self.is_manifestly_parallelizable():
                raise ValueError("the frame domain must coincide with " +
                                 "the {}".format(self))
```

which triggers the error reported in the ticket description. Maybe we can simply remove this...


---

Comment by @mjungmath created at 2020-08-09 13:16:52

Replying to [comment:3 egourgoulhon]:
> Thanks for handling this. In all the sage/manifolds settings, the "default frame" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. 
> 
> In `DifferentiableManifold.set_default_frame()`, there is
> {{{
>         if frame._domain is not self:
>             if self.is_manifestly_parallelizable():
>                 raise ValueError("the frame domain must coincide with " +
>                                  "the {}".format(self))
> }}}
> which triggers the error reported in the ticket description. Maybe we can simply remove this... 

This is exactly what I meant by "The first [option] is [...] more comprehensible to user.". Thanks for pointing this out in such detail.

Vector bundles currently use option 1 as well, btw.

Then, I will take care of removing the corresponding error messages and adapt the documentation if necessary. This is good, because #30178 can then be kept.


---

Comment by @mjungmath created at 2020-08-09 13:23:52

New commits:


---

Comment by @mjungmath created at 2020-08-09 13:23:52

Changing status from new to needs_review.


---

Comment by @mjungmath created at 2020-08-09 13:26:24

Similarly for charts, btw, though more unlikely. I've removed that error message, too. Agreed?


---

Comment by @mjungmath created at 2020-09-10 14:07:45

Is that good or some more work needed here?


---

Comment by egourgoulhon created at 2020-09-11 07:26:11

Changing status from needs_review to positive_review.


---

Comment by egourgoulhon created at 2020-09-11 07:26:11

Replying to [comment:9 gh-mjungmath]:
> Is that good or some more work needed here?
Yes it's good. Sorry for the delay.

PS: I've added the ticket to #30235, where it was missing.


---

Comment by egourgoulhon created at 2020-09-11 08:02:00

Replying to [comment:10 egourgoulhon]:
> 
> PS: I've added the ticket to #30235, where it was missing. 

Btw, don't hesitate to add relevant tickets there.


---

Comment by @mjungmath created at 2020-09-11 08:50:45

Replying to [comment:11 egourgoulhon]:
> Replying to [comment:10 egourgoulhon]:
> > 
> > PS: I've added the ticket to #30235, where it was missing. 
> 
> Btw, don't hesitate to add relevant tickets there.

Okay, sure. :)

Besides, you meant the metaticket #30525, right?


---

Comment by egourgoulhon created at 2020-09-11 08:56:53

Replying to [comment:12 gh-mjungmath]:
> Besides, you meant the metaticket #30525, right?
Yes.


---

Comment by vbraun created at 2020-09-15 21:58:30

Resolution: fixed
