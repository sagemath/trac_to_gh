# Issue 11896: Numerator for symbolic expression should'nt use maxima

Issue created by migration from Trac.

Original creator: hivert

Original creation time: 2011-11-21 22:50:11

Assignee: burcin

Keywords: numerator, denominator

The code for numerator is currently

```python
def numerator(self):
        """
        Returns the numerator of this symbolic expression.  If the
[...]
        """
        return self.parent()(self._maxima_().num())
```

Using Pynac should be much faster.


---

Comment by hivert created at 2011-11-22 00:04:03

Changing assignee from burcin to hivert.


---

Comment by hivert created at 2011-11-22 00:04:03

Ginac's behavior is not the same has Maxima: given `1 + 1/(x + 1)`

 - Maxima returns `1 + 1/(x + 1)` as numerator and `1` as denominator;

 - Ginac returns `x + 2` as numerator and `x + 1` as denominator.

I think both are useful. My patch keeps the current behavior. Is this what we want ?

Florent


---

Comment by hivert created at 2011-11-22 00:05:04

Changing status from new to needs_review.


---

Comment by burcin created at 2011-11-22 21:57:11

Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.

Thank you for working on this.


---

Attachment


---

Comment by hivert created at 2011-11-22 22:05:22

Replying to [comment:3 burcin]:
> Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.

Done !


---

Comment by hivert created at 2011-11-22 22:17:27

I got a all test passed on my laptop except a timeout in `sage/schemes/elliptic_curves/ell_rational_field.py` however relaunching a non parallel test on this single file gives:

```
sage -t  "sage/schemes/elliptic_curves/ell_rational_field.py"
         [89.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 89.8 seconds
```



---

Attachment

Declaring `py_pow` as an `int` caused problems with attachment:trac_12068-numer_denom_ginac-fh.patch. `py_object_from_numeric()` returns a `PyObject`. Assigning the return value to an `int` worked because Cython was creating a temporary `PyObject` and trying to convert that to an `int`. This failed if the exponent was not an integer.

attachment:trac_12068-denominator.patch fixes this problem and handles expressions which contain only a `power`.

Florent can you review my patch?

Apply attachment:trac_12068-numer_denom_ginac-fh.patch, attachment:trac_12068-denominator.patch


---

Comment by hivert created at 2011-11-24 10:20:16

Replying to [comment:6 burcin]:
> Florent can you review my patch?

Thanks for fixing my mistake. Unfortunately, because I choose to duplicate the code to speedup `numerator_denominator`, I also duplicate the mistake. You corrected only one. I'll upload a patch fixing everything.


---

Attachment


---

Attachment

Hi Burcin,

The uploaded patch should fix everything.  attachment:trac_12068-numer_denom_fix-fh.patch
contains my modifications on top of yours and attachment:trac_12068-numer_denom_ginac-folded-fh.patch contains everything folded.

Your turn to review ;-)


---

Comment by burcin created at 2011-11-24 11:13:49

It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.


---

Comment by burcin created at 2011-11-24 11:13:49

Changing status from needs_review to positive_review.


---

Comment by hivert created at 2011-11-24 15:46:56

Changing status from positive_review to needs_work.


---

Comment by hivert created at 2011-11-24 15:46:56

Bi Burcin,

Replying to [comment:9 burcin]:
> It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.

The following diff

```diff
diff --git a/sage/symbolic/expression.pyx b/sage/symbolic/expression.pyx
--- a/sage/symbolic/expression.pyx
+++ b/sage/symbolic/expression.pyx
`@``@` -1867,7 +1867,7 `@``@` cdef class Expression(CommutativeRingEle
         assured that if True or False is returned (and proof is False) then 
         the answer is correct. 
 
-        INPUT::
+        INPUT:
         
            ntests -- (default 20) the number of iterations to run
            domain -- (optional) the domain from which to draw the random values
```

broke the doc. So I had to fix my patch. Doing so I discovered a few more typos and fixed them once for all. In the process I ended up folding the patch for #12072.  

So please re review. Sorry for the double review.

Florent


---

Attachment


---

Comment by hivert created at 2011-11-24 15:54:50

Changing status from needs_work to needs_review.


---

Comment by hivert created at 2011-11-24 15:54:50

Please re-review. Compared to my previous patch, I

 - wrapped normal;
 - removed the unused `py_pow` declaration;
 - fixed a bunch of doc typos.

Again sorry for the extra work,

Florent


---

Comment by kcrisman created at 2012-01-27 04:27:12

The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  

The only problem I spied is in the last hunk:

```
         - ``self`` -- the symbolic expression converting from 
         - ``target`` -- (default None) the symbolic expression
```

is too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.

In fact, I'm attaching a reviewer patch to fix this.

I wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.


---

Comment by kcrisman created at 2012-01-27 04:27:12

Changing status from needs_review to positive_review.


---

Attachment

reviewer patch


---

Comment by kcrisman created at 2012-01-27 04:28:24

*Apply* [attachment:trac_12068-numer_denom_normal-ginac-fh.patch] and [attachment:trac_12068-reviewer.patch].


---

Comment by hivert created at 2012-01-27 08:01:34

Hi Karl-Dieter,

Replying to [comment:12 kcrisman]:
> The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  

Thanks !

> The only problem I spied is in the last hunk:
  {{{
           - ``self`` -- the symbolic expression converting from 
           - ``target`` -- (default None) the symbolic expression
  }}}
> is too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.

> In fact, I'm attaching a reviewer patch to fix this.

Should't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.

> I wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.

In every CAS I used, I've always been confused by simplify, normal, combine... I guess Sage isn't an exception.


---

Comment by kcrisman created at 2012-01-27 15:40:35

> > In fact, I'm attaching a reviewer patch to fix this.
> 
> Should't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.

No, reviewers are usually allowed to make VERY trivial changes, esp. to fix doc, without 'formal' other review, otherwise we would take even longer to review things than normal.  Naturally, anyone could decide that "reviewer patch X needs review" if they felt it was nontrivial.


---

Comment by jdemeyer created at 2012-02-02 12:53:25

Resolution: fixed
