# Issue 11896: Numerator for symbolic expression should'nt use maxima

archive/issues_011896.json:
```json
{
    "body": "Assignee: @burcin\n\nKeywords: numerator, denominator\n\nThe code for numerator is currently\n\n```python\ndef numerator(self):\n        \"\"\"\n        Returns the numerator of this symbolic expression.  If the\n[...]\n        \"\"\"\n        return self.parent()(self._maxima_().num())\n```\n\nUsing Pynac should be much faster.\n\nIssue created by migration from https://trac.sagemath.org/ticket/12068\n\n",
    "created_at": "2011-11-21T22:50:11Z",
    "labels": [
        "component: symbolics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-5.0",
    "title": "Numerator for symbolic expression should'nt use maxima",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/11896",
    "user": "https://github.com/hivert"
}
```
Assignee: @burcin

Keywords: numerator, denominator

The code for numerator is currently

```python
def numerator(self):
        """
        Returns the numerator of this symbolic expression.  If the
[...]
        """
        return self.parent()(self._maxima_().num())
```

Using Pynac should be much faster.

Issue created by migration from https://trac.sagemath.org/ticket/12068





---

archive/issue_comments_136079.json:
```json
{
    "body": "Changing assignee from @burcin to @hivert.",
    "created_at": "2011-11-22T00:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136079",
    "user": "https://github.com/hivert"
}
```

Changing assignee from @burcin to @hivert.



---

archive/issue_comments_136080.json:
```json
{
    "body": "Ginac's behavior is not the same has Maxima: given `1 + 1/(x + 1)`\n\n- Maxima returns `1 + 1/(x + 1)` as numerator and `1` as denominator;\n\n- Ginac returns `x + 2` as numerator and `x + 1` as denominator.\n\nI think both are useful. My patch keeps the current behavior. Is this what we want ?\n\nFlorent",
    "created_at": "2011-11-22T00:04:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136080",
    "user": "https://github.com/hivert"
}
```

Ginac's behavior is not the same has Maxima: given `1 + 1/(x + 1)`

- Maxima returns `1 + 1/(x + 1)` as numerator and `1` as denominator;

- Ginac returns `x + 2` as numerator and `x + 1` as denominator.

I think both are useful. My patch keeps the current behavior. Is this what we want ?

Florent



---

archive/issue_comments_136081.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2011-11-22T00:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136081",
    "user": "https://github.com/hivert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_136082.json:
```json
{
    "body": "Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.\n\nThank you for working on this.",
    "created_at": "2011-11-22T21:57:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136082",
    "user": "https://github.com/burcin"
}
```

Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.

Thank you for working on this.



---

archive/issue_comments_136083.json:
```json
{
    "body": "Attachment [trac_12068-numer_denom_ginac-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_ginac-fh.patch) by @hivert created at 2011-11-22 22:03:45",
    "created_at": "2011-11-22T22:03:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136083",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_12068-numer_denom_ginac-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_ginac-fh.patch) by @hivert created at 2011-11-22 22:03:45



---

archive/issue_comments_136084.json:
```json
{
    "body": "Replying to [comment:3 burcin]:\n> Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.\n\nDone !",
    "created_at": "2011-11-22T22:05:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136084",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:3 burcin]:
> Looks good to me. It would be better to use `elif` in line 6480 and 6481. Otherwise, positive review once the tests pass.

Done !



---

archive/issue_comments_136085.json:
```json
{
    "body": "I got a all test passed on my laptop except a timeout in `sage/schemes/elliptic_curves/ell_rational_field.py` however relaunching a non parallel test on this single file gives:\n\n```\nsage -t  \"sage/schemes/elliptic_curves/ell_rational_field.py\"\n         [89.8 s]\n \n----------------------------------------------------------------------\nAll tests passed!\nTotal time for all tests: 89.8 seconds\n```\n",
    "created_at": "2011-11-22T22:17:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136085",
    "user": "https://github.com/hivert"
}
```

I got a all test passed on my laptop except a timeout in `sage/schemes/elliptic_curves/ell_rational_field.py` however relaunching a non parallel test on this single file gives:

```
sage -t  "sage/schemes/elliptic_curves/ell_rational_field.py"
         [89.8 s]
 
----------------------------------------------------------------------
All tests passed!
Total time for all tests: 89.8 seconds
```




---

archive/issue_comments_136086.json:
```json
{
    "body": "Attachment [trac_12068-denominator.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-denominator.patch) by @burcin created at 2011-11-23 14:34:37\n\nDeclaring `py_pow` as an `int` caused problems with attachment:trac_12068-numer_denom_ginac-fh.patch. `py_object_from_numeric()` returns a `PyObject`. Assigning the return value to an `int` worked because Cython was creating a temporary `PyObject` and trying to convert that to an `int`. This failed if the exponent was not an integer.\n\nattachment:trac_12068-denominator.patch fixes this problem and handles expressions which contain only a `power`.\n\nFlorent can you review my patch?\n\nApply attachment:trac_12068-numer_denom_ginac-fh.patch, attachment:trac_12068-denominator.patch",
    "created_at": "2011-11-23T14:34:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136086",
    "user": "https://github.com/burcin"
}
```

Attachment [trac_12068-denominator.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-denominator.patch) by @burcin created at 2011-11-23 14:34:37

Declaring `py_pow` as an `int` caused problems with attachment:trac_12068-numer_denom_ginac-fh.patch. `py_object_from_numeric()` returns a `PyObject`. Assigning the return value to an `int` worked because Cython was creating a temporary `PyObject` and trying to convert that to an `int`. This failed if the exponent was not an integer.

attachment:trac_12068-denominator.patch fixes this problem and handles expressions which contain only a `power`.

Florent can you review my patch?

Apply attachment:trac_12068-numer_denom_ginac-fh.patch, attachment:trac_12068-denominator.patch



---

archive/issue_comments_136087.json:
```json
{
    "body": "Replying to [comment:6 burcin]:\n> Florent can you review my patch?\n\nThanks for fixing my mistake. Unfortunately, because I choose to duplicate the code to speedup `numerator_denominator`, I also duplicate the mistake. You corrected only one. I'll upload a patch fixing everything.",
    "created_at": "2011-11-24T10:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136087",
    "user": "https://github.com/hivert"
}
```

Replying to [comment:6 burcin]:
> Florent can you review my patch?

Thanks for fixing my mistake. Unfortunately, because I choose to duplicate the code to speedup `numerator_denominator`, I also duplicate the mistake. You corrected only one. I'll upload a patch fixing everything.



---

archive/issue_comments_136088.json:
```json
{
    "body": "Attachment [trac_12068-numer_denom_fix-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_fix-fh.patch) by @hivert created at 2011-11-24 10:34:58",
    "created_at": "2011-11-24T10:34:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136088",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_12068-numer_denom_fix-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_fix-fh.patch) by @hivert created at 2011-11-24 10:34:58



---

archive/issue_comments_136089.json:
```json
{
    "body": "Attachment [trac_12068-numer_denom_ginac-folded-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_ginac-folded-fh.patch) by @hivert created at 2011-11-24 10:37:39\n\nHi Burcin,\n\nThe uploaded patch should fix everything.  attachment:trac_12068-numer_denom_fix-fh.patch\ncontains my modifications on top of yours and attachment:trac_12068-numer_denom_ginac-folded-fh.patch contains everything folded.\n\nYour turn to review ;-)",
    "created_at": "2011-11-24T10:37:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136089",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_12068-numer_denom_ginac-folded-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_ginac-folded-fh.patch) by @hivert created at 2011-11-24 10:37:39

Hi Burcin,

The uploaded patch should fix everything.  attachment:trac_12068-numer_denom_fix-fh.patch
contains my modifications on top of yours and attachment:trac_12068-numer_denom_ginac-folded-fh.patch contains everything folded.

Your turn to review ;-)



---

archive/issue_comments_136090.json:
```json
{
    "body": "It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.",
    "created_at": "2011-11-24T11:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136090",
    "user": "https://github.com/burcin"
}
```

It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.



---

archive/issue_comments_136091.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2011-11-24T11:13:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136091",
    "user": "https://github.com/burcin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136092.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2011-11-24T15:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136092",
    "user": "https://github.com/hivert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_136093.json:
```json
{
    "body": "Bi Burcin,\n\nReplying to [comment:9 burcin]:\n> It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.\n\nThe following diff\n\n```diff\ndiff --git a/sage/symbolic/expression.pyx b/sage/symbolic/expression.pyx\n--- a/sage/symbolic/expression.pyx\n+++ b/sage/symbolic/expression.pyx\n@@ -1867,7 +1867,7 @@ cdef class Expression(CommutativeRingEle\n         assured that if True or False is returned (and proof is False) then \n         the answer is correct. \n \n-        INPUT::\n+        INPUT:\n         \n            ntests -- (default 20) the number of iterations to run\n            domain -- (optional) the domain from which to draw the random values\n```\n\nbroke the doc. So I had to fix my patch. Doing so I discovered a few more typos and fixed them once for all. In the process I ended up folding the patch for #12072.  \n\nSo please re review. Sorry for the double review.\n\nFlorent",
    "created_at": "2011-11-24T15:46:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136093",
    "user": "https://github.com/hivert"
}
```

Bi Burcin,

Replying to [comment:9 burcin]:
> It all looks good. The declaration `cdef int py_pow` is redundant in `numerator_denominator()`, but I'll switch to positive review anyway.

The following diff

```diff
diff --git a/sage/symbolic/expression.pyx b/sage/symbolic/expression.pyx
--- a/sage/symbolic/expression.pyx
+++ b/sage/symbolic/expression.pyx
@@ -1867,7 +1867,7 @@ cdef class Expression(CommutativeRingEle
         assured that if True or False is returned (and proof is False) then 
         the answer is correct. 
 
-        INPUT::
+        INPUT:
         
            ntests -- (default 20) the number of iterations to run
            domain -- (optional) the domain from which to draw the random values
```

broke the doc. So I had to fix my patch. Doing so I discovered a few more typos and fixed them once for all. In the process I ended up folding the patch for #12072.  

So please re review. Sorry for the double review.

Florent



---

archive/issue_comments_136094.json:
```json
{
    "body": "Attachment [trac_12068-numer_denom_normal-ginac-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_normal-ginac-fh.patch) by @hivert created at 2011-11-24 15:52:38",
    "created_at": "2011-11-24T15:52:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136094",
    "user": "https://github.com/hivert"
}
```

Attachment [trac_12068-numer_denom_normal-ginac-fh.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-numer_denom_normal-ginac-fh.patch) by @hivert created at 2011-11-24 15:52:38



---

archive/issue_comments_136095.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2011-11-24T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136095",
    "user": "https://github.com/hivert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_136096.json:
```json
{
    "body": "Please re-review. Compared to my previous patch, I\n\n- wrapped normal;\n- removed the unused `py_pow` declaration;\n- fixed a bunch of doc typos.\n\nAgain sorry for the extra work,\n\nFlorent",
    "created_at": "2011-11-24T15:54:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136096",
    "user": "https://github.com/hivert"
}
```

Please re-review. Compared to my previous patch, I

- wrapped normal;
- removed the unused `py_pow` declaration;
- fixed a bunch of doc typos.

Again sorry for the extra work,

Florent



---

archive/issue_comments_136097.json:
```json
{
    "body": "The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  \n\nThe only problem I spied is in the last hunk:\n\n```\n         - ``self`` -- the symbolic expression converting from \n         - ``target`` -- (default None) the symbolic expression\n```\n\nis too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.\n\nIn fact, I'm attaching a reviewer patch to fix this.\n\nI wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.",
    "created_at": "2012-01-27T04:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136097",
    "user": "https://github.com/kcrisman"
}
```

The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  

The only problem I spied is in the last hunk:

```
         - ``self`` -- the symbolic expression converting from 
         - ``target`` -- (default None) the symbolic expression
```

is too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.

In fact, I'm attaching a reviewer patch to fix this.

I wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.



---

archive/issue_comments_136098.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2012-01-27T04:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136098",
    "user": "https://github.com/kcrisman"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_136099.json:
```json
{
    "body": "Attachment [trac_12068-reviewer.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-reviewer.patch) by @kcrisman created at 2012-01-27 04:27:37\n\nreviewer patch",
    "created_at": "2012-01-27T04:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136099",
    "user": "https://github.com/kcrisman"
}
```

Attachment [trac_12068-reviewer.patch](tarball://root/attachments/some-uuid/ticket12068/trac_12068-reviewer.patch) by @kcrisman created at 2012-01-27 04:27:37

reviewer patch



---

archive/issue_comments_136100.json:
```json
{
    "body": "**Apply** [attachment:trac_12068-numer_denom_normal-ginac-fh.patch] and [attachment:trac_12068-reviewer.patch].",
    "created_at": "2012-01-27T04:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136100",
    "user": "https://github.com/kcrisman"
}
```

**Apply** [attachment:trac_12068-numer_denom_normal-ginac-fh.patch] and [attachment:trac_12068-reviewer.patch].



---

archive/issue_comments_136101.json:
```json
{
    "body": "Hi Karl-Dieter,\n\nReplying to [comment:12 kcrisman]:\n> The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  \n\nThanks !\n\n> The only problem I spied is in the last hunk:\n  {{{\n- ``self`` -- the symbolic expression converting from \n- ``target`` -- (default None) the symbolic expression\n  }}}\n> is too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.\n\n> In fact, I'm attaching a reviewer patch to fix this.\n\nShould't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.\n\n> I wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.\n\nIn every CAS I used, I've always been confused by simplify, normal, combine... I guess Sage isn't an exception.",
    "created_at": "2012-01-27T08:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136101",
    "user": "https://github.com/hivert"
}
```

Hi Karl-Dieter,

Replying to [comment:12 kcrisman]:
> The changes to the previous patch seem fine, docs are good, tests pass.  In fact, it's a very nice patch.  

Thanks !

> The only problem I spied is in the last hunk:
  {{{
- ``self`` -- the symbolic expression converting from 
- ``target`` -- (default None) the symbolic expression
  }}}
> is too far indented.  If you're going to fix all of this stuff, you might as well make these at the same indentation level as INPUT, such as in the second-to-last hunk.

> In fact, I'm attaching a reviewer patch to fix this.

Should't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.

> I wonder if there is a more 'obvious' name for `normalize` that could be an alias... anyway, not for this ticket.  Assuming that Burcin has no objections, positive review other than this.

In every CAS I used, I've always been confused by simplify, normal, combine... I guess Sage isn't an exception.



---

archive/issue_comments_136102.json:
```json
{
    "body": "> > In fact, I'm attaching a reviewer patch to fix this.\n> \n> Should't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.\n\nNo, reviewers are usually allowed to make VERY trivial changes, esp. to fix doc, without 'formal' other review, otherwise we would take even longer to review things than normal.  Naturally, anyone could decide that \"reviewer patch X needs review\" if they felt it was nontrivial.",
    "created_at": "2012-01-27T15:40:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136102",
    "user": "https://github.com/kcrisman"
}
```

> > In fact, I'm attaching a reviewer patch to fix this.
> 
> Should't someone review your trivial reviewer patch before putting positive review ? Anyway, It is an obvious patch and I did review it. So I confirm your positive review.

No, reviewers are usually allowed to make VERY trivial changes, esp. to fix doc, without 'formal' other review, otherwise we would take even longer to review things than normal.  Naturally, anyone could decide that "reviewer patch X needs review" if they felt it was nontrivial.



---

archive/issue_events_011951.json:
```json
{
    "actor": "https://github.com/jdemeyer",
    "created_at": "2012-02-02T12:53:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/11896#event-11951"
}
```



---

archive/issue_comments_136103.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2012-02-02T12:53:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/11896",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/11896#issuecomment-136103",
    "user": "https://github.com/jdemeyer"
}
```

Resolution: fixed
