# Issue 16755: Direct Fixdoctests

archive/issues_016755.json:
```json
{
    "body": "\n\nIssue created by migration from https://trac.sagemath.org/ticket/16992\n\n",
    "created_at": "2014-09-16T11:33:55Z",
    "labels": [
        "PLEASE CHANGE",
        "major"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Direct Fixdoctests",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16755",
    "user": "@vbraun"
}
```


Issue created by migration from https://trac.sagemath.org/ticket/16992





---

archive/issue_comments_221458.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221458",
    "user": "@vbraun"
}
```

New commits:



---

archive/issue_comments_221459.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to scripts.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221459",
    "user": "@vbraun"
}
```

Changing component from PLEASE CHANGE to scripts.



---

archive/issue_comments_221460.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221460",
    "user": "@vbraun"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_221461.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2014-09-16T13:10:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221461",
    "user": "@vbraun"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_221462.json:
```json
{
    "body": "I would replace `sage -git` by `git` since this is supposed to be run from a Sage shell anyway.",
    "created_at": "2014-09-16T13:22:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221462",
    "user": "@jdemeyer"
}
```

I would replace `sage -git` by `git` since this is supposed to be run from a Sage shell anyway.



---

archive/issue_comments_221463.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2014-09-16T13:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221463",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_221464.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2014-09-16T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221464",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_221465.json:
```json
{
    "body": "You also need to fix the documentation (output of `./sage --advanced`)",
    "created_at": "2014-09-16T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221465",
    "user": "@jdemeyer"
}
```

You also need to fix the documentation (output of `./sage --advanced`)



---

archive/issue_comments_221466.json:
```json
{
    "body": "And could you please add a `\\n` to the output file, because otherwise you always get\n\n```diff\ndiff --git a/src/sage/rings/integer.pyx b/src/sage/rings/integer.pyx\nindex c85ba09..59cb6c1 100644\n--- a/src/sage/rings/integer.pyx\n+++ b/src/sage/rings/integer.pyx\n@@ -6515,4 +6515,4 @@ cdef double mpz_get_d_nearest(mpz_t x) except? -648555075988944.5:\n     cdef double d = <double>q64\n     if resultsign < 0:\n         d = -d\n-    return ldexp(d, shift)\n+    return ldexp(d, shift)\n\\ No newline at end of file\n```\n\n(I know you didn't introduce this bug, but it's such a trivial fix...)",
    "created_at": "2014-09-16T16:51:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221466",
    "user": "@jdemeyer"
}
```

And could you please add a `\n` to the output file, because otherwise you always get

```diff
diff --git a/src/sage/rings/integer.pyx b/src/sage/rings/integer.pyx
index c85ba09..59cb6c1 100644
--- a/src/sage/rings/integer.pyx
+++ b/src/sage/rings/integer.pyx
@@ -6515,4 +6515,4 @@ cdef double mpz_get_d_nearest(mpz_t x) except? -648555075988944.5:
     cdef double d = <double>q64
     if resultsign < 0:
         d = -d
-    return ldexp(d, shift)
+    return ldexp(d, shift)
\ No newline at end of file
```

(I know you didn't introduce this bug, but it's such a trivial fix...)



---

archive/issue_comments_221467.json:
```json
{
    "body": "Shouldn't\n\n```\nif relative.startswith('.'):\n```\n\nbe\n\n```\nif relative.startswith('..'):\n```\n\n(although it seems that `relpath` strips `./`)",
    "created_at": "2014-09-16T16:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221467",
    "user": "@jdemeyer"
}
```

Shouldn't

```
if relative.startswith('.'):
```

be

```
if relative.startswith('..'):
```

(although it seems that `relpath` strips `./`)



---

archive/issue_comments_221468.json:
```json
{
    "body": "There is of course a large margin for improvement in the `sage-fixdoctests` script (ideally, it should be integrated within the doctesting framework), but if you make the small changes I mentioned, I'm happy with this ticket.",
    "created_at": "2014-09-16T17:02:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221468",
    "user": "@jdemeyer"
}
```

There is of course a large margin for improvement in the `sage-fixdoctests` script (ideally, it should be integrated within the doctesting framework), but if you make the small changes I mentioned, I'm happy with this ticket.



---

archive/issue_comments_221469.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2014-09-16T18:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221469",
    "user": "@vbraun"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_221470.json:
```json
{
    "body": "done",
    "created_at": "2014-09-16T18:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221470",
    "user": "@vbraun"
}
```

done



---

archive/issue_comments_221471.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-09-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221471",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_221472.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-09-16T18:33:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221472",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_221473.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-16T19:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221473",
    "user": "@jdemeyer"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221474.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2014-09-18T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221474",
    "user": "git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_221475.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2014-09-18T14:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221475",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_221476.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2014-09-18T14:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221476",
    "user": "@vbraun"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_221477.json:
```json
{
    "body": "Forgot the cmdline test...",
    "created_at": "2014-09-18T14:36:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221477",
    "user": "@vbraun"
}
```

Forgot the cmdline test...



---

archive/issue_comments_221478.json:
```json
{
    "body": "Any reason you write\n\n```\nwith open(test_file, 'r') as f:\n    fixed_test = f.read()\n```\n\ninstead of\n\n```\n    fixed_test = open(test_file).read()\n```\n",
    "created_at": "2014-09-18T16:35:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221478",
    "user": "@jdemeyer"
}
```

Any reason you write

```
with open(test_file, 'r') as f:
    fixed_test = f.read()
```

instead of

```
    fixed_test = open(test_file).read()
```




---

archive/issue_comments_221479.json:
```json
{
    "body": "I don't really care either way much, but to me the first version makes it clearer how long the file is actually open for.",
    "created_at": "2014-09-18T16:37:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221479",
    "user": "@vbraun"
}
```

I don't really care either way much, but to me the first version makes it clearer how long the file is actually open for.



---

archive/issue_comments_221480.json:
```json
{
    "body": "lgtm (I was going to set positive_review but apparently you already did that :-p)",
    "created_at": "2014-09-18T19:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221480",
    "user": "@jdemeyer"
}
```

lgtm (I was going to set positive_review but apparently you already did that :-p)



---

archive/issue_comments_221481.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2014-09-19T15:08:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16755",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16755#issuecomment-221481",
    "user": "@vbraun"
}
```

Resolution: fixed
