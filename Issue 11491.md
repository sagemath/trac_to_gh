# Issue 11491: singular files not world-readable

Issue created by migration from https://trac.sagemath.org/ticket/11663

Original creator: jdemeyer

Original creation time: 2011-08-08 13:50:10

Assignee: tbd

Similar to #11660, the singular files are not world-readable.


---

Comment by leif created at 2011-08-08 13:59:47

Note that there's already a p10 (#11550), and trivial outstanding changes to that (#11645).


---

Comment by jdemeyer created at 2011-08-08 16:07:32

Changing status from new to needs_review.


---

Comment by leif created at 2011-08-08 20:42:32

Which (of the installed) files were affected?

I only noticed

```
local/share/singular/singular.hlp
local/share/singular/singular.idx
```

(and `local/share/singular/help.cnf`, which currently unintentionally doesn't get installed, cf. #11519 and #5994).

Also, all (header) files in `local/include/singular` are executable. :)


---

Comment by leif created at 2011-08-08 20:52:19

Note that (almost*) all files are installed with some `install` script or program (not consistently making use of `-m ...` though as far as I can see), so changing file permissions in `src/` isn't really appropriate or may not be sufficient.

----
*There are actually a few (at least one) instances where `cp` is used.


---

Comment by leif created at 2011-08-08 21:01:21

Replying to [comment:5 leif]:
> I only noticed

```
local/share/singular/singular.hlp
local/share/singular/singular.idx
```

> (and `local/share/singular/help.cnf`, which currently unintentionally doesn't get installed, cf. #11519 and #5994).

These two files are actually *copied* by `spkg-install`:

```sh

install_docs()
{
    cp $SHARED/singular.hlp $SAGE_LOCAL/share/singular/
    if [ $? -ne 0 ]; then
        echo "Error installing documentation while copying singular.hlp"
        exit 1
    fi
    cp $SHARED/singular.idx $SAGE_LOCAL/share/singular/
    if [ $? -ne 0 ]; then
        echo "Error installing documentation while copying singular.idx"
        exit 1
    fi
}
```

So it's not really an upstream issue.


---

Comment by leif created at 2011-08-08 21:02:46

P.S.: The created Singular scripts in `local/bin/` use `$*` instead of `"$`@`"`.


---

Comment by leif created at 2011-08-08 21:46:41

This doesn't work (i.e., doesn't solve the issue), since `cp` is required (by POSIX) to respect the `umask` unless `-p` is used (which we don't, see above).

Also, `janet.{cc,h}` are still executable in the upstream sources, and at least for me all headers still get installed with `-rwxr-xr-x`.

While you're at it (`spkg-install`), I think you should also add copying the `help.cnf` file (which is as noted missing in our "manual" installations).


---

Comment by leif created at 2011-08-08 21:46:41

Changing status from needs_review to needs_work.


---

Comment by leif created at 2011-08-08 21:49:09

Replying to [comment:9 leif]:
> While you're at it (`spkg-install`), I think you should also add copying the `help.cnf` file (which is as noted missing in our "manual" installations).

Please also quote some environment variables (at least there, in `install_docs()`).


---

Comment by leif created at 2011-08-08 21:53:50

Instead of using `cp -p`, you could of course also `chmod` them afterwards, or simply change the `umask` before copying.

In principle, we could (or should?) set the `umask` in `sage-spkg`.


---

Comment by leif created at 2011-08-08 22:20:50

Actually, the problem with `singular.{hlp,idx}` is not my `umask`, but that the files already existed (and don't get deleted prior to reinstallation), so their permissions didn't get changed.

Anyway, using `cp -p` would solve this.


---

Comment by jdemeyer created at 2011-08-09 08:05:12

Changing status from needs_work to needs_review.


---

Comment by jdemeyer created at 2011-08-09 08:05:12

Replying to [comment:7 leif]:
> These two files are actually *copied* by `spkg-install`:

It is an upstream issue because the files have permission 0600 in the source tree, so they are copied to permission 0600 (both with and without -p).

The installation of the headers as executable files is an upstream problem.  I have not really pinned it down, but the Singular install scripts are full of `chmod`s.

Anyway, I have a new spkg up at [http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p11.spkg](http://boxen.math.washington.edu/home/jdemeyer/spkg/singular-3-1-1-4.p11.spkg) using `cp -p` for the help files and removing an existing `chmod` hack.  I also made some file non-executable.

I do not want to make further changes here which are unrelated to the ticket.  I agree with some of the points you make, but not for this ticket.


---

Comment by SimonKing created at 2011-08-09 12:05:16

Hi Jeroen and Leif,

as far as I know, only a small change would be needed in the Singular spkg in order to fix #11645. Could that perhaps be included into your singular-3-1-1-4.p11.spkg as well?


---

Comment by jdemeyer created at 2011-08-09 12:12:44

Replying to [comment:15 SimonKing]:
> as far as I know, only a small change would be needed in the Singular spkg in order to fix #11645. Could that perhaps be included into your singular-3-1-1-4.p11.spkg as well?

I would yes but only if it does not further delay the 4.7.1 release.  I see no patch for #11645, do you have one?


---

Comment by leif created at 2011-08-09 12:36:21

Replying to [comment:16 jdemeyer]:
> Replying to [comment:15 SimonKing]:
> > as far as I know, only a small change would be needed in the Singular spkg in order to fix #11645. Could that perhaps be included into your singular-3-1-1-4.p11.spkg as well?
> 
> I would yes but only if it does not further delay the 4.7.1 release.  I see no patch for #11645, do you have one?

I've posted the patch upstream ("plain" context diff):

http://www.singular.uni-kl.de:8002/trac/raw-attachment/ticket/352/singular-trac_352-install_gftables_one_by_one.patch


---

Comment by leif created at 2011-08-09 12:45:58

Replying to [comment:17 leif]:
> I've posted the patch upstream ("plain" context diff):
> 
> http://www.singular.uni-kl.de:8002/trac/raw-attachment/ticket/352/singular-trac_352-install_gftables_one_by_one.patch

It's now also over there: [attachment:ticket:11645:trac_11645-install_gftables_one_by_one.patch]


---

Comment by leif created at 2011-08-09 13:01:21

Replying to [comment:17 leif]:
> Replying to [comment:16 jdemeyer]:
> > Replying to [comment:15 SimonKing]:
> > > as far as I know, only a small change would be needed in the Singular spkg in order to fix #11645. Could that perhaps be included into your singular-3-1-1-4.p11.spkg as well?
> > 
> > I would yes but only if it does not further delay the 4.7.1 release.  I see no patch for #11645, do you have one?
> 
> I've posted the patch upstream ("plain" context diff)...

However, I can also quickly provide a new Singular spkg based on Karl-Dieter's (p12 then), based on yours, meanwhile p11. :)

Note also http://trac.sagemath.org/sage_trac/ticket/11645#comment:16; we already patch `src/Singular/Makefile.in`.


---

Comment by leif created at 2011-08-09 13:58:08

Replying to [comment:19 leif]:
> Replying to [comment:17 leif]:
> > I've posted the patch upstream ("plain" context diff)...
> 
> Note also http://trac.sagemath.org/sage_trac/ticket/11645#comment:16; we already patch `src/Singular/Makefile.in`.

FWIW, I've attached replacement files for `patches/Singular-Makefile.in` and `patches/Singular-Makefile.in.patch` to #11645, i.e. a cumulative patch to `src/Singular/Makefile.in` and the corresponding pre-patched file (which currently gets copied over into the upstream source tree).

Otherwise *positive review* for the _current_ p11, as it now fixes the permissions issue (i.e., files not readable by "others"), though I think we should fix this in a more general way. (We'll have to check and probably change the upstream sources again on any upstream upgrade.)

Revert the status to "needs review" in case you want to fix #11645 _here_, too (by simply replacing the two files in `patches/` as mentioned above, and of course updating `SPKG.txt`.)


---

Comment by leif created at 2011-08-09 13:58:08

Changing status from needs_review to positive_review.


---

Comment by kcrisman created at 2011-08-09 14:33:04

I hate to spoil this party, but where was the p10?  Even `SPKG.txt` doesn't mention one.  

Not sure if this means 'needs work', but at least 'needs info'!


---

Comment by kcrisman created at 2011-08-09 14:33:04

Changing status from positive_review to needs_info.


---

Comment by jdemeyer created at 2011-08-09 17:00:40

Replying to [comment:21 kcrisman]:
> I hate to spoil this party, but where was the p10?

Sorry, I deleted it (before realizing that somebody might still be interested in it).


---

Comment by jdemeyer created at 2011-08-09 17:17:29

Changing status from needs_info to needs_review.


---

Comment by jdemeyer created at 2011-08-09 17:19:14

Changing status from needs_review to positive_review.


---

Comment by jdemeyer created at 2011-08-09 17:19:14

I believe kcrisman's comment should not affect the positive review...


---

Comment by jdemeyer created at 2011-08-09 17:20:55

I have posted a p12 at ticket #11645.


---

Comment by kcrisman created at 2011-08-09 17:59:48

Replying to [comment:24 jdemeyer]:
> I believe kcrisman's comment should not affect the positive review...
Okay, then I'll try to make a p13 for #11550.   _Please_ someone just give #11645 a positive review and not 'needs work', it is much more tedious for me to update spkgs than for the more technically astute, I'm afraid :(


---

Comment by kcrisman created at 2011-08-09 18:42:32

Followup p13 (based on #11645) at #11550.


---

Comment by jdemeyer created at 2011-08-10 08:57:53

Resolution: fixed
