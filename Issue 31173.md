# Issue 31173: fix symmetric_form for type B and F

Issue created by migration from https://trac.sagemath.org/ticket/31410

Original creator: mantepse

Original creation time: 2021-02-17 09:41:54

CC:  tscrim

Currently, we have

```
def s1(ct):
   L = RootSystem(ct).weight_space()
   P = L.positive_roots()
   rho = L.rho()
   return [beta.symmetric_form(rho) for beta in P]

def s2(ct):
   R = RootSystem(ct).root_space()
   P = R.positive_roots()
   rho = 1/2*sum(P)
   return [beta.symmetric_form(rho) for beta in P]

sage: cartan_types = sage.databases.findstat._finite_irreducible_cartan_types_by_rank
sage: [(ct, s1(ct), s2(ct)) for n in range(1,9) for ct in cartan_types(n) if s1(ct) != s2(ct)]
[['B', 2], ['B', 3], ['B', 4], ['F', 4], ['B', 5], ['B', 6], ['B', 7], ['B', 8]]
```


Specifically, for these it seems that I have to multiply everything by 2 if I am computing in the weight lattice.

```
sage: ct = CartanType(["B", 2]); [2*x for x in s1(ct)] == s2(ct)  
True
sage: ct = CartanType(["F", 4]); [2*x for x in s1(ct)] == s2(ct)
True
```


As Travis points out:

The issue comes from the diagonalization:

```
sage: cm = CartanMatrix(['B',3])                                                                                  
sage: cm.is_symmetrizable(True)                                                                                   
[1, 1, 1/2]
sage: CartanMatrix(['F',4]).is_symmetrizable(True)                                                                
[1, 1, 1/2, 1/2]
```

The diagonal matrix is built from the integer valued version. This accounts for the factor of 2. So in `_symmetric_form_matrix`, the `cm.symmetrizer()` should be used instead of `cm.is_symmetrizable(True)` (or copy the scalar factor from the `symmetrizer()` implementation).


---

Comment by mantepse created at 2021-02-17 10:55:32

New commits:


---

Comment by mantepse created at 2021-02-17 10:55:32

Changing status from new to needs_review.


---

Comment by tscrim created at 2021-02-17 15:08:24

Thank you for the fix. Please revert this change as it is not Sage's convention for the documentation:

```diff
-            r"""
-            Return the symmetric form of ``self`` with ``la``.
+            r"""Return the symmetric form of ``self`` with ``la``.
```

Once that is done, you can set a positive review on my behalf.


---

Comment by git created at 2021-02-17 15:17:02

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by mantepse created at 2021-02-17 15:20:43

Thank you!

Final question: should we provide `rho` also for the root space (the precise interaction between root space and weight space is unclear to me).


---

Comment by mantepse created at 2021-02-17 15:20:43

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2021-02-17 22:36:11

Replying to [comment:5 mantepse]:
> Final question: should we provide `rho` also for the root space

hmm...I am not sure. I am leaning towards no because it is something special for finite type and it would make a difference between the root lattice and root space. Although that is not a very strong opinion.

> (the precise interaction between root space and weight space is unclear to me). 

The Cartan matrix defines the coercion `root -> weight`.


---

Comment by vbraun created at 2021-03-09 00:01:19

Resolution: fixed
