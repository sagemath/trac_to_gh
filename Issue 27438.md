# Issue 27438: py3 fixes in rings/polynomial/polynomial_element.pyx

archive/issues_027438.json:
```json
{
    "body": "Mark some `long(...)` tests as `# py2`, and also deprecate the `__long__` method.\n\nIssue created by migration from https://trac.sagemath.org/ticket/27675\n\n",
    "created_at": "2019-04-16T00:06:14Z",
    "labels": [
        "python3",
        "major",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-8.8",
    "title": "py3 fixes in rings/polynomial/polynomial_element.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/27438",
    "user": "@jhpalmieri"
}
```
Mark some `long(...)` tests as `# py2`, and also deprecate the `__long__` method.

Issue created by migration from https://trac.sagemath.org/ticket/27675





---

archive/issue_comments_386795.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2019-04-16T00:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386795",
    "user": "@jhpalmieri"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_386796.json:
```json
{
    "body": "New commits:",
    "created_at": "2019-04-16T00:07:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386796",
    "user": "@jhpalmieri"
}
```

New commits:



---

archive/issue_comments_386797.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2019-04-16T05:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386797",
    "user": "@fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_386798.json:
```json
{
    "body": "failing doctests, see patchbot",
    "created_at": "2019-04-16T05:59:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386798",
    "user": "@fchapoton"
}
```

failing doctests, see patchbot



---

archive/issue_comments_386799.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2019-04-16T14:43:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386799",
    "user": "git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_386800.json:
```json
{
    "body": "This should fix the doctests. A question about Python 3, though: in an interactive session, I see this:\n\n```\nsage: R.<x> = PolynomialRing(QQ)\nsage: S.<a> = R.quotient(x^3-2)\nsage: long(S(10))\n---------------------------------------------------------------------------\nNameError                                 Traceback (most recent call last)\n<ipython-input-4-be7f7f725292> in <module>()\n----> 1 long(S(Integer(10)))\n\nNameError: name 'long' is not defined\n```\n\nBut this (from `polynomial_quotient_ring_element.py`) passes doctests with Python 3:\n\n```\n            sage: R.<x> = PolynomialRing(QQ)\n            sage: S.<a> = R.quotient(x^3-2)\n            sage: long(S(10))\n            10L\n```\n\nIn this ticket I've decided to mark that test as `# py2`, but it doesn't seem to be necessary, and I don't understand why. Any explanations? (I've confirmed that the test is actually being run.)",
    "created_at": "2019-04-16T14:48:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386800",
    "user": "@jhpalmieri"
}
```

This should fix the doctests. A question about Python 3, though: in an interactive session, I see this:

```
sage: R.<x> = PolynomialRing(QQ)
sage: S.<a> = R.quotient(x^3-2)
sage: long(S(10))
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-4-be7f7f725292> in <module>()
----> 1 long(S(Integer(10)))

NameError: name 'long' is not defined
```

But this (from `polynomial_quotient_ring_element.py`) passes doctests with Python 3:

```
            sage: R.<x> = PolynomialRing(QQ)
            sage: S.<a> = R.quotient(x^3-2)
            sage: long(S(10))
            10L
```

In this ticket I've decided to mark that test as `# py2`, but it doesn't seem to be necessary, and I don't understand why. Any explanations? (I've confirmed that the test is actually being run.)



---

archive/issue_comments_386801.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2019-04-16T14:49:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386801",
    "user": "@jhpalmieri"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_386802.json:
```json
{
    "body": "Here's the answer to my question: in `doctest/forker.py`, we have\n\n```\n    if six.PY2:\n        extra_globals = {}\n    else:\n        extra_globals = {'long': int}\n    \"\"\"\n    Extra objects to place in the global namespace in which tests are run.\n    Normally this should be empty but there are special cases where it may\n    be useful.\n\n    In particular, on Python 3 add ``long`` as an alias for ``int`` so that\n    tests that use the ``long`` built-in (of which there are many) still pass.\n    We do this so that the test suite can run on Python 3 while Python 2 is\n    still the default.\n    \"\"\"\n```\n\nI think we should clean this up: Sage's actual behavior should not differ that much from doctest behavior. (Not on this ticket, obviously.)",
    "created_at": "2019-04-16T15:31:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386802",
    "user": "@jhpalmieri"
}
```

Here's the answer to my question: in `doctest/forker.py`, we have

```
    if six.PY2:
        extra_globals = {}
    else:
        extra_globals = {'long': int}
    """
    Extra objects to place in the global namespace in which tests are run.
    Normally this should be empty but there are special cases where it may
    be useful.

    In particular, on Python 3 add ``long`` as an alias for ``int`` so that
    tests that use the ``long`` built-in (of which there are many) still pass.
    We do this so that the test suite can run on Python 3 while Python 2 is
    still the default.
    """
```

I think we should clean this up: Sage's actual behavior should not differ that much from doctest behavior. (Not on this ticket, obviously.)



---

archive/issue_comments_386803.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2019-04-17T00:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386803",
    "user": "@tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_386804.json:
```json
{
    "body": "LGTM.",
    "created_at": "2019-04-17T00:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386804",
    "user": "@tscrim"
}
```

LGTM.



---

archive/issue_comments_386805.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2019-04-18T19:56:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/27438",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/27438#issuecomment-386805",
    "user": "@vbraun"
}
```

Resolution: fixed
