# Issue 27438: py3 fixes in rings/polynomial/polynomial_element.pyx

Issue created by migration from https://trac.sagemath.org/ticket/27675

Original creator: jhpalmieri

Original creation time: 2019-04-16 00:06:14

Mark some `long(...)` tests as `# py2`, and also deprecate the `__long__` method.


---

Comment by jhpalmieri created at 2019-04-16 00:07:17

Changing status from new to needs_review.


---

Comment by jhpalmieri created at 2019-04-16 00:07:17

New commits:


---

Comment by chapoton created at 2019-04-16 05:59:14

Changing status from needs_review to needs_work.


---

Comment by chapoton created at 2019-04-16 05:59:14

failing doctests, see patchbot


---

Comment by git created at 2019-04-16 14:43:33

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by jhpalmieri created at 2019-04-16 14:48:33

This should fix the doctests. A question about Python 3, though: in an interactive session, I see this:

```
sage: R.<x> = PolynomialRing(QQ)
sage: S.<a> = R.quotient(x^3-2)
sage: long(S(10))
---------------------------------------------------------------------------
NameError                                 Traceback (most recent call last)
<ipython-input-4-be7f7f725292> in <module>()
----> 1 long(S(Integer(10)))

NameError: name 'long' is not defined
```

But this (from `polynomial_quotient_ring_element.py`) passes doctests with Python 3:

```
            sage: R.<x> = PolynomialRing(QQ)
            sage: S.<a> = R.quotient(x^3-2)
            sage: long(S(10))
            10L
```

In this ticket I've decided to mark that test as `# py2`, but it doesn't seem to be necessary, and I don't understand why. Any explanations? (I've confirmed that the test is actually being run.)


---

Comment by jhpalmieri created at 2019-04-16 14:49:03

Changing status from needs_work to needs_review.


---

Comment by jhpalmieri created at 2019-04-16 15:31:56

Here's the answer to my question: in `doctest/forker.py`, we have

```
    if six.PY2:
        extra_globals = {}
    else:
        extra_globals = {'long': int}
    """
    Extra objects to place in the global namespace in which tests are run.
    Normally this should be empty but there are special cases where it may
    be useful.

    In particular, on Python 3 add ``long`` as an alias for ``int`` so that
    tests that use the ``long`` built-in (of which there are many) still pass.
    We do this so that the test suite can run on Python 3 while Python 2 is
    still the default.
    """
```

I think we should clean this up: Sage's actual behavior should not differ that much from doctest behavior. (Not on this ticket, obviously.)


---

Comment by tscrim created at 2019-04-17 00:24:56

Changing status from needs_review to positive_review.


---

Comment by tscrim created at 2019-04-17 00:24:56

LGTM.


---

Comment by vbraun created at 2019-04-18 19:56:31

Resolution: fixed
