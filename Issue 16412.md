# Issue 16412: Make `quo_rem` give answers more often

archive/issues_016412.json:
```json
{
    "body": "Keywords: quo_rem\n\nIn generic implementations of `f.quo_rem(g)`, an exception\n\n```python\nArithmeticError: Nonunit leading coefficient\n```\nis raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. \n\nThe change I propose is to try to compute the Euclidean division, and raise an exception\n\n```python\nArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)\n```\nwhen the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). \n\n**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/16649\n\n",
    "closed_at": "2016-04-17T22:48:15Z",
    "created_at": "2014-07-12T15:20:55Z",
    "labels": [
        "component: basic arithmetic",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-6.4",
    "title": "Make `quo_rem` give answers more often",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/16412",
    "user": "https://github.com/bgrenet"
}
```
Keywords: quo_rem

In generic implementations of `f.quo_rem(g)`, an exception

```python
ArithmeticError: Nonunit leading coefficient
```
is raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. 

The change I propose is to try to compute the Euclidean division, and raise an exception

```python
ArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)
```
when the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). 

**Note on the controverse.** There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.


Issue created by migration from https://trac.sagemath.org/ticket/16649





---

archive/issue_comments_215318.json:
```json
{
    "body": "My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):\n\n- Remove the test\n  {{{#!python\n          if not other.leading_coefficient().is_unit():\n              raise ArithmeticError(\"Nonunit leading coefficient\")\n  }}}\n  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.\n\n- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:\n  {{{#!python\n              try:\n                  q = R(x[n+k-1]/y[n-1])\n              except TypeError:\n                  raise ArithmeticError(\"Division not exact (consider coercing to polynomial over the fraction field first\")\n  }}}\n\nDoes the change make sense?",
    "created_at": "2014-07-12T15:52:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215318",
    "user": "https://github.com/bgrenet"
}
```

My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):

- Remove the test
  {{{#!python
          if not other.leading_coefficient().is_unit():
              raise ArithmeticError("Nonunit leading coefficient")
  }}}
  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.

- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:
  {{{#!python
              try:
                  q = R(x[n+k-1]/y[n-1])
              except TypeError:
                  raise ArithmeticError("Division not exact (consider coercing to polynomial over the fraction field first")
  }}}

Does the change make sense?



---

archive/issue_comments_215319.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215319",
    "user": "https://github.com/bgrenet"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_215320.json:
```json
{
    "body": "New commits:",
    "created_at": "2014-07-13T18:16:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215320",
    "user": "https://github.com/bgrenet"
}
```

New commits:



---

archive/issue_events_048822.json:
```json
{
    "actor": "https://trac.sagemath.org/admin/accounts/users/vbraun_spam",
    "created_at": "2014-08-10T16:51:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "milestone": "sage-6.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16412#event-48822"
}
```



---

archive/issue_comments_215321.json:
```json
{
    "body": "needs rebase, does not apply",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215321",
    "user": "https://github.com/fchapoton"
}
```

needs rebase, does not apply



---

archive/issue_comments_215322.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2015-08-05T18:40:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215322",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_215323.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2015-08-06T13:21:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_215324.json:
```json
{
    "body": "I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~\n\n[EDIT] see comment:9",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215324",
    "user": "https://github.com/bgrenet"
}
```

I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~

[EDIT] see comment:9



---

archive/issue_comments_215325.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2015-08-06T13:24:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215325",
    "user": "https://github.com/bgrenet"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_215326.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-07T15:57:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215327.json:
```json
{
    "body": "Ignore the previous comment, my mistake! Should now be OK...",
    "created_at": "2015-08-07T15:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215327",
    "user": "https://github.com/bgrenet"
}
```

Ignore the previous comment, my mistake! Should now be OK...



---

archive/issue_comments_215328.json:
```json
{
    "body": "two many colons after TESTS in\n\n```\n+        TESTS::\n+\n+        The following shows that :trac:`16649` is indeed fixed. ::\n```",
    "created_at": "2015-08-07T16:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215328",
    "user": "https://github.com/fchapoton"
}
```

two many colons after TESTS in

```
+        TESTS::
+
+        The following shows that :trac:`16649` is indeed fixed. ::
```



---

archive/issue_comments_215329.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2015-08-07T16:25:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_215330.json:
```json
{
    "body": "I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215330",
    "user": "https://github.com/rwst"
}
```

I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.



---

archive/issue_comments_215331.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2016-04-17T08:17:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215331",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_215332.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2016-04-17T08:17:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215332",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_215333.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215333",
    "user": "https://github.com/rwst"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_215334.json:
```json
{
    "body": "OK, I tested myself and it passes.",
    "created_at": "2016-04-17T13:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215334",
    "user": "https://github.com/rwst"
}
```

OK, I tested myself and it passes.



---

archive/issue_events_048823.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2016-04-17T22:48:15Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/16412#event-48823"
}
```



---

archive/issue_comments_215335.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2016-04-17T22:48:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/16412",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/16412#issuecomment-215335",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
