# Issue 16412: Make `quo_rem` give answers more often

Issue created by migration from Trac.

Original creator: bruno

Original creation time: 2014-07-12 15:20:55

Keywords: quo_rem

In generic implementations of `f.quo_rem(g)`, an exception

```python
ArithmeticError: Nonunit leading coefficient
```

is raised as soon as the leading coefficient of `g` is not invertible. This was introduced by ticket #11593, and I mimicked the behavior in #16544. 

The change I propose is to try to compute the Euclidean division, and raise an exception

```python
ArithmeticError: division not exact (consider coercing to polynomials over the fraction field first)
```

when the computation is not possible. Then, `quo_rem` would produce less exceptions, and in particular give an answer each time the answer is not controversial (see below). 

*Note on the controverse.* There is a debate to know whether one should raise an exception when the division is not exact (as it is done for dense integer polynomials with the `NTL` implementation), or if one should silently return a result that has a mathematical meaning though it is not a Euclidean division (as it is done with the `flint` implementation). See #16276 as well as https://groups.google.com/d/msg/sage-devel/UVrx5CG4qA0/WUz2RItJtF8J for this debate. My proposition is to already implement a more capable algorithm, and not to wait for the debate to be closed.



---

Comment by bruno created at 2014-07-12 15:52:57

My proposition is as follows (say for the method `quo_rem` of the `class Polynomial_generic_dense`):

- Remove the test
  {{{#!python
          if not other.leading_coefficient().is_unit():
              raise ArithmeticError("Nonunit leading coefficient")
  }}}
  on lines 7484-7485 of `sage/rings/polynomial/polynomial_element.pyx`.

- Change the line 7999 (`q = x[n+k-1]/y[n-1]`) by the following:
  {{{#!python
              try:
                  q = R(x[n+k-1]/y[n-1])
              except TypeError:
                  raise ArithmeticError("Division not exact (consider coercing to polynomial over the fraction field first")
  }}}

Does the change make sense?


---

Comment by bruno created at 2014-07-13 18:16:54

Changing status from new to needs_review.


---

Comment by bruno created at 2014-07-13 18:16:54

New commits:


---

Comment by chapoton created at 2015-08-05 18:40:04

needs rebase, does not apply


---

Comment by chapoton created at 2015-08-05 18:40:04

Changing status from needs_review to needs_work.


---

Comment by git created at 2015-08-06 13:21:47

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:


---

Comment by bruno created at 2015-08-06 13:24:07

I did the rebase. Since it is my first time doing such a thing, I hope I did it the right way, ~~though it is probably not the case: When I make tests, such as `sage -btp 8 src/sage/rings/polynomial/`, I get quite a lot of failures, due to the deprecation of `zero_element`. I do not know why... and I suspect that it is not a great idea to replace all this `zero_element` by `zero` myself in this ticket, since it was done by ticket #17694. I do not know why these changes are not taken into account.~~

[EDIT] see comment:9


---

Comment by bruno created at 2015-08-06 13:24:07

Changing status from needs_work to needs_review.


---

Comment by git created at 2015-08-07 15:57:44

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by bruno created at 2015-08-07 15:58:17

Ignore the previous comment, my mistake! Should now be OK...


---

Comment by chapoton created at 2015-08-07 16:08:27

two many colons after TESTS in

```
+        TESTS::
+
+        The following shows that :trac:`16649` is indeed fixed. ::
```



---

Comment by git created at 2015-08-07 16:25:25

Branch pushed to git repo; I updated commit sha1. New commits:


---

Comment by rws created at 2016-04-17 08:17:25

I think this looks good. I'm just toggling needs work/review to give the patchbot another chance because the last run seemed wrong. If it passes without errors you can set positive.


---

Comment by rws created at 2016-04-17 08:17:25

Changing status from needs_review to needs_work.


---

Comment by rws created at 2016-04-17 08:17:40

Changing status from needs_work to needs_review.


---

Comment by rws created at 2016-04-17 13:06:56

Changing status from needs_review to positive_review.


---

Comment by rws created at 2016-04-17 13:06:56

OK, I tested myself and it passes.


---

Comment by vbraun created at 2016-04-17 22:48:15

Resolution: fixed
