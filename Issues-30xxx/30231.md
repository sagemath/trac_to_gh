# Issue 30231: Fix gp2c spkg-configure

archive/issues_029994.json:
```json
{
    "body": "https://groups.google.com/d/msg/sage-devel/rZpwyAT2EZU/jiNWFinQBgAJ\n\nBroken in b5d16d9927a (#29491)\n\nCC:  @dimpase @orlitzky @slel\n\nKeywords: pari, gp2c, pari.cfg\n\nBranch/Commit: 252633cc3653f975a527dae9bd173df528530f9d\n\nReviewer: Samuel Leli\u00e8vre, Matthias Koeppe\n\nAuthor: Michael Orlitzky\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30231\n\n",
    "closed_at": "2020-08-07T19:07:43Z",
    "created_at": "2020-07-27T06:05:30Z",
    "labels": [
        "component: build: configure",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Fix gp2c spkg-configure",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30231",
    "user": "https://github.com/mkoeppe"
}
```
https://groups.google.com/d/msg/sage-devel/rZpwyAT2EZU/jiNWFinQBgAJ

Broken in b5d16d9927a (#29491)

CC:  @dimpase @orlitzky @slel

Keywords: pari, gp2c, pari.cfg

Branch/Commit: 252633cc3653f975a527dae9bd173df528530f9d

Reviewer: Samuel Lelièvre, Matthias Koeppe

Author: Michael Orlitzky

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30231





---

archive/issue_comments_594619.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mjo/ticket/30231\"",
    "created_at": "2020-07-28T16:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594619",
    "user": "https://github.com/orlitzky"
}
```

Changing branch from "" to "u/mjo/ticket/30231"



---

archive/issue_comments_594620.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-28T16:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594620",
    "user": "https://github.com/orlitzky"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_594621.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Orlitzky\"",
    "created_at": "2020-07-28T16:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594621",
    "user": "https://github.com/orlitzky"
}
```

Changing author from "" to "Michael Orlitzky"



---

archive/issue_comments_594622.json:
```json
{
    "body": "Changing commit from \"\" to \"8f1b8bd60b0796d47b38ce781b56deb309d0f2f7\"",
    "created_at": "2020-07-28T16:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594622",
    "user": "https://github.com/orlitzky"
}
```

Changing commit from "" to "8f1b8bd60b0796d47b38ce781b56deb309d0f2f7"



---

archive/issue_comments_594623.json:
```json
{
    "body": "<a id='comment:1'></a>I need to think about this a little harder, but this new spkg-configure seems to do the trick. The basic problem is that the check phase itself can be skipped with `--with-system-gp2c=no`, but the location of pari.cfg is needed regardless. Therefore we can't do any calculation that affects discovery of pari.cfg in the check phase. The new version does it all in pre/post-check instead.\n\n---\nNew commits:",
    "created_at": "2020-07-28T16:45:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594623",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:1'></a>I need to think about this a little harder, but this new spkg-configure seems to do the trick. The basic problem is that the check phase itself can be skipped with `--with-system-gp2c=no`, but the location of pari.cfg is needed regardless. Therefore we can't do any calculation that affects discovery of pari.cfg in the check phase. The new version does it all in pre/post-check instead.

---
New commits:



---

archive/issue_comments_594624.json:
```json
{
    "body": "Changing commit from \"8f1b8bd60b0796d47b38ce781b56deb309d0f2f7\" to \"252633cc3653f975a527dae9bd173df528530f9d\"",
    "created_at": "2020-07-28T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594624",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "8f1b8bd60b0796d47b38ce781b56deb309d0f2f7" to "252633cc3653f975a527dae9bd173df528530f9d"



---

archive/issue_comments_594625.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-07-28T16:47:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594625",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_594626.json:
```json
{
    "body": "<a id='comment:3'></a>`SAGE_SPKG_DEPCHECK` was never meant to be called in pre-post/check (certainly never tested to do this, I think).\nNot sure whether this will work, without testing all the corner cases.",
    "created_at": "2020-07-29T09:25:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594626",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>`SAGE_SPKG_DEPCHECK` was never meant to be called in pre-post/check (certainly never tested to do this, I think).
Not sure whether this will work, without testing all the corner cases.



---

archive/issue_comments_594627.json:
```json
{
    "body": "<a id='comment:4'></a>Please run it on [GitHub](GitHub) CI and post the link...",
    "created_at": "2020-07-29T17:32:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594627",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Please run it on [GitHub](GitHub) CI and post the link...



---

archive/issue_comments_594628.json:
```json
{
    "body": "<a id='comment:5'></a>Lacking m4 skills to do a full review, but this\nsolves the problem I reported on sage-devel for me.",
    "created_at": "2020-07-30T00:53:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594628",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>Lacking m4 skills to do a full review, but this
solves the problem I reported on sage-devel for me.



---

archive/issue_comments_594629.json:
```json
{
    "body": "<a id='comment:6'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/188912339",
    "created_at": "2020-07-30T17:25:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594629",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Tests run at https://github.com/mkoeppe/sage/actions/runs/188912339



---

archive/issue_comments_594630.json:
```json
{
    "body": "<a id='comment:7'></a>The run hasn't quite completed yet, but it's looking fine (as expected)",
    "created_at": "2020-07-31T00:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>The run hasn't quite completed yet, but it's looking fine (as expected)



---

archive/issue_comments_594631.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-31T00:33:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594631",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_594632.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Samuel Leli\u00e8vre, Matthias Koeppe\"",
    "created_at": "2020-07-31T00:34:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594632",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Samuel Lelièvre, Matthias Koeppe"



---

archive/issue_comments_594633.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-07-31T00:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594633",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_594634.json:
```json
{
    "body": "<a id='comment:10'></a>Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.",
    "created_at": "2020-07-31T00:53:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594634",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:10'></a>Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.



---

archive/issue_comments_594635.json:
```json
{
    "body": "Changing keywords from \"\" to \"pari, gp2c, pari.cfg\".",
    "created_at": "2020-07-31T01:09:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594635",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "pari, gp2c, pari.cfg".



---

archive/issue_comments_594636.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 mjo]:\n> Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.\n\n\nI discussed this with upstream. The response was that it is left to pari/gp users to place it anywhere they want, full stop.",
    "created_at": "2020-07-31T10:08:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594636",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Replying to [comment:10 mjo]:
> Someday pari should be able to tell us where it put that stupid file, but until then, I can't think of a better way to do it than this.


I discussed this with upstream. The response was that it is left to pari/gp users to place it anywhere they want, full stop.



---

archive/issue_events_078118.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:07:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30231#event-78118"
}
```



---

archive/issue_comments_594637.json:
```json
{
    "body": "Changing branch from \"u/mjo/ticket/30231\" to \"252633cc3653f975a527dae9bd173df528530f9d\"",
    "created_at": "2020-08-07T19:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594637",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mjo/ticket/30231" to "252633cc3653f975a527dae9bd173df528530f9d"



---

archive/issue_comments_594638.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-07T19:07:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30231",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30231#issuecomment-594638",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
