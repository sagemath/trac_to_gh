# Issue 30753: Further improvements in method subgraph

archive/issues_030516.json:
```json
{
    "assignees": [],
    "body": "We add a fast method `subgraph_given_vertices` to `CGraphBackend`. This method allows fast subgraph creation including copying.\nAlso improvements in `subgraph` with a case forgotten in #30510.\n\nBefore #30665:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                            \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n280 \u00b5s \u00b1 465 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                          \n30.3 ms \u00b1 72.8 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n                                                                                                                                                                              \nsage: G = G.copy(immutable=True)  # static sparse                                                                                                                                   \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n553 \u00b5s \u00b1 373 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy(immutable=False)                                                                                                                                           \n31.6 ms \u00b1 91.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n                                                                                                                                                                               \nsage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                               \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n54.2 ms \u00b1 54.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                          \n527 ms \u00b1 663 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nWith #30665 and #30769:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                   \nsage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n257 \u00b5s \u00b1 356 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n26.4 ms \u00b1 146 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n                                                                                                                                                                                                                                                                                                                                                                     \nsage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n521 \u00b5s \u00b1 308 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  \n28.3 ms \u00b1 95.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                      \nsage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n51.6 ms \u00b1 64.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n429 ms \u00b1 1.23 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```\n\nWith this ticket:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                                     \nsage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n80.9 \u00b5s \u00b1 19.1 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n15.4 ms \u00b1 10.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n\nsage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                                           \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n327 \u00b5s \u00b1 1.04 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  \n20.3 ms \u00b1 23 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                             \nsage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n1.03 ms \u00b1 10.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n269 ms \u00b1 3.08 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nDepends on #30665\nDepends on #30769\n\nCC:  @kliem\n\nBranch/Commit: **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**\n\nReviewer: **David Coudert**\n\nAuthor: **David Coudert, Jonathan Kliem**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30753_\n\n",
    "closed_at": "2020-11-07T16:23:58Z",
    "created_at": "2020-10-11T12:25:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Further improvements in method subgraph",
    "type": "issue",
    "updated_at": "2020-11-07T16:23:58Z",
    "url": "https://github.com/sagemath/sage/issues/30753",
    "user": "https://github.com/dcoudert"
}
```
We add a fast method `subgraph_given_vertices` to `CGraphBackend`. This method allows fast subgraph creation including copying.
Also improvements in `subgraph` with a case forgotten in #30510.

Before #30665:

```
sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                            
sage: V = list(G)                                                                                                                                                                   
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
280 µs ± 465 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy()                                                                                                                                                          
30.3 ms ± 72.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
                                                                                                                                                                              
sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                   
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
553 µs ± 373 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy(immutable=False)                                                                                                                                           
31.6 ms ± 91.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
                                                                                                                                                                               
sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                               
sage: V = list(G)                                                                                                                                                                   
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
54.2 ms ± 54.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.copy()                                                                                                                                                          
527 ms ± 663 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

With #30665 and #30769:

```
sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                   
sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
257 µs ± 356 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
26.4 ms ± 146 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
                                                                                                                                                                                                                                                                                                                                                                     
sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
521 µs ± 308 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  
28.3 ms ± 95.2 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                      
sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
51.6 ms ± 64.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
429 ms ± 1.23 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```

With this ticket:

```
sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                                     
sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
80.9 µs ± 19.1 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
15.4 ms ± 10.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                                           
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
327 µs ± 1.04 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  
20.3 ms ± 23 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                             
sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
1.03 ms ± 10.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
269 ms ± 3.08 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

Depends on #30665
Depends on #30769

CC:  @kliem

Branch/Commit: **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**

Reviewer: **David Coudert**

Author: **David Coudert, Jonathan Kliem**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/30753_





---

archive/issue_events_426287.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-11T12:25:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426287"
}
```



---

archive/issue_events_426288.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-11T12:25:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "eeeeee",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426288"
}
```



---

archive/issue_events_426289.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-11T12:25:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426289"
}
```



---

archive/issue_events_426290.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-11T12:25:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426290"
}
```



---

archive/issue_comments_491531.json:
```json
{
    "body": "Branch: **[public/graphs/30753_subgraph](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph)**",
    "created_at": "2020-10-11T12:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491531",
    "user": "https://github.com/dcoudert"
}
```

Branch: **[public/graphs/30753_subgraph](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph)**



---

archive/issue_comments_491532.json:
```json
{
    "body": "Commit: **[`9495c5b`](https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8)**",
    "created_at": "2020-10-11T12:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491532",
    "user": "https://github.com/dcoudert"
}
```

Commit: **[`9495c5b`](https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8)**



---

archive/issue_comments_491533.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI'm not sure if the threshold for selecting default algorithm is still best possible. At least, we have improved both algorithms.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8\"><code>9495c5b</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr></table>\n",
    "created_at": "2020-10-11T12:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491533",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:1" align="right">comment:1</div>

I'm not sure if the threshold for selecting default algorithm is still best possible. At least, we have improved both algorithms.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8"><code>9495c5b</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr></table>




---

archive/issue_events_426291.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-11T12:29:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426291"
}
```



---

archive/issue_comments_491534.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nCurrently, the default algorithm is `'delete'` if the number of vertices of the subgraph is at least 5% of the number of vertices of the graph. But following tests suggest that `'add'` is faster when the number of vertices of the subgraph is up to 90%... so we should change the threshold to e.g. 90%. Do you agree ?\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)\nsage: V = list(G)\nsage: %timeit H = G.subgraph(V[:50], algorithm=None)   # use add\n219 \u00b5s \u00b1 7.56 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.subgraph(V[:50], algorithm='add')\n213 \u00b5s \u00b1 10.9 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.subgraph(V[:50], algorithm='delete')\n62.3 ms \u00b1 1.64 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: %timeit H = G.subgraph(V[:500], algorithm=None)  # use add\n1.85 ms \u00b1 35.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.subgraph(V[:500], algorithm='add')\n1.99 ms \u00b1 70.7 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit H = G.subgraph(V[:500], algorithm='delete')\n64 ms \u00b1 1.14 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n\nsage: %timeit H = G.subgraph(V[:5000], algorithm=None)  # use delete but add is faster here\n53 ms \u00b1 1.1 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.subgraph(V[:5000], algorithm='add')\n23.7 ms \u00b1 229 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.subgraph(V[:5000], algorithm='delete')\n52.3 ms \u00b1 636 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\n```\nsage: G = graphs.CompleteGraph(1000)                                                                                                \nsage: V = list(G)                                                                                                                   \nsage: %timeit H = G.subgraph(V[:50], algorithm=None)  # use 'add'\n17.9 ms \u00b1 408 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit H = G.subgraph(V[:50], algorithm='add')\n19.5 ms \u00b1 441 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit H = G.subgraph(V[:50], algorithm='delete')\n962 ms \u00b1 14.9 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n\nsage: %timeit H = G.subgraph(V[:100], algorithm=None)  # use 'delete' but 'add' is faster\n962 ms \u00b1 20.5 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:100], algorithm='add')\n38 ms \u00b1 828 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.subgraph(V[:100], algorithm='delete')\n959 ms \u00b1 18.3 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n\nsage: %timeit H = G.subgraph(V[:500], algorithm=None)  # use 'delete' but 'add' is faster\n949 ms \u00b1 18.1 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:500], algorithm='add')\n283 ms \u00b1 15.3 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:100], algorithm='delete')\n982 ms \u00b1 32.2 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n\nsage: %timeit H = G.subgraph(V[:800], algorithm=None)  # use 'delete' but 'add' is faster\n918 ms \u00b1 35.2 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:800], algorithm='add')\n643 ms \u00b1 19.4 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:800], algorithm='delete')\n909 ms \u00b1 35.6 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n\nsage: %timeit H = G.subgraph(V[:900], algorithm=None)  # use 'delete' but 'add' is faster\n862 ms \u00b1 19.1 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %timeit H = G.subgraph(V[:900], algorithm='add')\n735 ms \u00b1 16.7 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```",
    "created_at": "2020-10-11T12:57:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491534",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

Currently, the default algorithm is `'delete'` if the number of vertices of the subgraph is at least 5% of the number of vertices of the graph. But following tests suggest that `'add'` is faster when the number of vertices of the subgraph is up to 90%... so we should change the threshold to e.g. 90%. Do you agree ?

```
sage: G = graphs.Grid2dGraph(100, 100)
sage: V = list(G)
sage: %timeit H = G.subgraph(V[:50], algorithm=None)   # use add
219 µs ± 7.56 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.subgraph(V[:50], algorithm='add')
213 µs ± 10.9 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.subgraph(V[:50], algorithm='delete')
62.3 ms ± 1.64 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: %timeit H = G.subgraph(V[:500], algorithm=None)  # use add
1.85 ms ± 35.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.subgraph(V[:500], algorithm='add')
1.99 ms ± 70.7 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit H = G.subgraph(V[:500], algorithm='delete')
64 ms ± 1.14 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)

sage: %timeit H = G.subgraph(V[:5000], algorithm=None)  # use delete but add is faster here
53 ms ± 1.1 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.subgraph(V[:5000], algorithm='add')
23.7 ms ± 229 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.subgraph(V[:5000], algorithm='delete')
52.3 ms ± 636 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

```
sage: G = graphs.CompleteGraph(1000)                                                                                                
sage: V = list(G)                                                                                                                   
sage: %timeit H = G.subgraph(V[:50], algorithm=None)  # use 'add'
17.9 ms ± 408 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit H = G.subgraph(V[:50], algorithm='add')
19.5 ms ± 441 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit H = G.subgraph(V[:50], algorithm='delete')
962 ms ± 14.9 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

sage: %timeit H = G.subgraph(V[:100], algorithm=None)  # use 'delete' but 'add' is faster
962 ms ± 20.5 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:100], algorithm='add')
38 ms ± 828 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.subgraph(V[:100], algorithm='delete')
959 ms ± 18.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

sage: %timeit H = G.subgraph(V[:500], algorithm=None)  # use 'delete' but 'add' is faster
949 ms ± 18.1 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:500], algorithm='add')
283 ms ± 15.3 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:100], algorithm='delete')
982 ms ± 32.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

sage: %timeit H = G.subgraph(V[:800], algorithm=None)  # use 'delete' but 'add' is faster
918 ms ± 35.2 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:800], algorithm='add')
643 ms ± 19.4 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:800], algorithm='delete')
909 ms ± 35.6 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)

sage: %timeit H = G.subgraph(V[:900], algorithm=None)  # use 'delete' but 'add' is faster
862 ms ± 19.1 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %timeit H = G.subgraph(V[:900], algorithm='add')
735 ms ± 16.7 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```



---

archive/issue_comments_491535.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea\"><code>c211ff8</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr></table>\n",
    "created_at": "2020-10-11T16:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491535",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea"><code>c211ff8</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr></table>




---

archive/issue_comments_491536.json:
```json
{
    "body": "Changed commit from **[`9495c5b`](https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8)** to **[`c211ff8`](https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea)**",
    "created_at": "2020-10-11T16:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491536",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9495c5b`](https://github.com/sagemath/sagetrac-mirror/commit/9495c5b111fb3df9b33f2f955ccbbfd44963f9f8)** to **[`c211ff8`](https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea)**



---

archive/issue_comments_491537.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nI change the threshold for default algorithm to use use `'delete'` when the subgraph has at least 90% of the vertices and `'add'` otherwise. It seems faster this way. I updated some doctests (mostly changes in orderings).",
    "created_at": "2020-10-11T16:48:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491537",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

I change the threshold for default algorithm to use use `'delete'` when the subgraph has at least 90% of the vertices and `'add'` otherwise. It seems faster this way. I updated some doctests (mostly changes in orderings).



---

archive/issue_comments_491538.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe example in this ticket might imply, that #30665 should be put back onto needs work.\n\nI see a huge slowdown.",
    "created_at": "2020-10-12T06:41:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491538",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">comment:6</div>

The example in this ticket might imply, that #30665 should be put back onto needs work.

I see a huge slowdown.



---

archive/issue_comments_491539.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOK, so may be we should wait for the finalization of #30665 before changing the threshold.",
    "created_at": "2020-10-12T07:07:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491539",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

OK, so may be we should wait for the finalization of #30665 before changing the threshold.



---

archive/issue_comments_491540.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI think I'm done with #30665.\n\nHowever, I could open another ticket and implement a subgraph iterator in the backend:\nGiven a list of vertices, iterate over all edges in the induced subgraph. This should be much faster.",
    "created_at": "2020-10-12T07:50:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491540",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

I think I'm done with #30665.

However, I could open another ticket and implement a subgraph iterator in the backend:
Given a list of vertices, iterate over all edges in the induced subgraph. This should be much faster.



---

archive/issue_comments_491541.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nWe can give it a try, at least for simple cases.\nYou can either do it here (the branch is public) or in a separate ticket but it might be harder to ensure that all changes are consistent (i.e., improve the situation).",
    "created_at": "2020-10-12T08:57:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491541",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:9" align="right">comment:9</div>

We can give it a try, at least for simple cases.
You can either do it here (the branch is public) or in a separate ticket but it might be harder to ensure that all changes are consistent (i.e., improve the situation).



---

archive/issue_comments_491542.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI would say, it is definitely worth it. But I have only a draft now with some todos.\n\nIn particular, this should speedup the copy method:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                                                                                                                                                                                                                     \nsage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \nsage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n31.1 ms \u00b1 183 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit H = G.subgraph(V[:10000], algorithm='add')                                                                                                                                                                                                                                                                                                                   \n16.6 ms \u00b1 15.7 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```",
    "created_at": "2020-10-12T15:06:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491542",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">comment:10</div>

I would say, it is definitely worth it. But I have only a draft now with some todos.

In particular, this should speedup the copy method:

```
sage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                                                                                                                                                                                                                     
sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
31.1 ms ± 183 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit H = G.subgraph(V[:10000], algorithm='add')                                                                                                                                                                                                                                                                                                                   
16.6 ms ± 15.7 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```



---

archive/issue_comments_491543.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nBtw, `subgraph_by_deleting` should only be used in place or if the backend has an optimized copy method (which appears to be not the case yet).\n\nNot sure about the special subgraphs yet, which are not obtained by just reducing the number of vertices.",
    "created_at": "2020-10-12T15:11:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491543",
    "user": "https://github.com/kliem"
}
```

<div id="comment:11" align="right">comment:11</div>

Btw, `subgraph_by_deleting` should only be used in place or if the backend has an optimized copy method (which appears to be not the case yet).

Not sure about the special subgraphs yet, which are not obtained by just reducing the number of vertices.



---

archive/issue_comments_491544.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f7b30df7304b43e22dcda24f8b4e1d6b2468659\"><code>5f7b30d</code></a></td><td><code>reviewers suggestion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/002ec5d147b2539f14ad00621eed4d8a8812dae2\"><code>002ec5d</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5deaa25b900ff90d287bada4a4cd014c6b70c7bf\"><code>5deaa25</code></a></td><td><code>fix wrong usage and document it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7c27ebfe76a59b609a35f0830c54b9fbd762ef1\"><code>d7c27eb</code></a></td><td><code>make iterator saver</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86b0ba6b515dd5dd9f882817b38ecc0e8d9fc0dc\"><code>86b0ba6</code></a></td><td><code>expose `sort_vertices`</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8\"><code>737e0f8</code></a></td><td><code>lookup in bitset is much faster</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec\"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7\"><code>957b4cc</code></a></td><td><code>check if vertices are empty</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8dbef677066db38cbc07c83ed402cbf12ca9d9c6\"><code>8dbef67</code></a></td><td><code>Merge branch 'u/gh-kliem/graphs_improve_edge_iterator' of git://trac.sagemath.org/sage into public/graphs/30753_subgraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead\"><code>adb2d57</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr></table>\n",
    "created_at": "2020-10-12T15:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491544",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f7b30df7304b43e22dcda24f8b4e1d6b2468659"><code>5f7b30d</code></a></td><td><code>reviewers suggestion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/002ec5d147b2539f14ad00621eed4d8a8812dae2"><code>002ec5d</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5deaa25b900ff90d287bada4a4cd014c6b70c7bf"><code>5deaa25</code></a></td><td><code>fix wrong usage and document it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7c27ebfe76a59b609a35f0830c54b9fbd762ef1"><code>d7c27eb</code></a></td><td><code>make iterator saver</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86b0ba6b515dd5dd9f882817b38ecc0e8d9fc0dc"><code>86b0ba6</code></a></td><td><code>expose `sort_vertices`</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8"><code>737e0f8</code></a></td><td><code>lookup in bitset is much faster</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7"><code>957b4cc</code></a></td><td><code>check if vertices are empty</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8dbef677066db38cbc07c83ed402cbf12ca9d9c6"><code>8dbef67</code></a></td><td><code>Merge branch 'u/gh-kliem/graphs_improve_edge_iterator' of git://trac.sagemath.org/sage into public/graphs/30753_subgraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead"><code>adb2d57</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr></table>




---

archive/issue_comments_491545.json:
```json
{
    "body": "Changed commit from **[`c211ff8`](https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea)** to **[`adb2d57`](https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead)**",
    "created_at": "2020-10-12T15:13:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491545",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c211ff8`](https://github.com/sagemath/sagetrac-mirror/commit/c211ff85508ac09c27285aa84c99b98d63e7f4ea)** to **[`adb2d57`](https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead)**



---

archive/issue_comments_491546.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f\"><code>3a42e25</code></a></td><td><code>check for bitset capacity</code></td></tr></table>\n",
    "created_at": "2020-10-12T15:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491546",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f"><code>3a42e25</code></a></td><td><code>check for bitset capacity</code></td></tr></table>




---

archive/issue_comments_491547.json:
```json
{
    "body": "Changed commit from **[`adb2d57`](https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead)** to **[`3a42e25`](https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f)**",
    "created_at": "2020-10-12T15:15:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491547",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`adb2d57`](https://github.com/sagemath/sagetrac-mirror/commit/adb2d57c09b4ea0e9abc706c37a831d909203ead)** to **[`3a42e25`](https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f)**



---

archive/issue_events_426292.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T15:24:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426292"
}
```



---

archive/issue_events_426293.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T15:24:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426293"
}
```



---

archive/issue_comments_491548.json:
```json
{
    "body": "Changed author from **David Coudert** to **David Coudert, Jonathan Kliem**",
    "created_at": "2020-10-12T15:24:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491548",
    "user": "https://github.com/kliem"
}
```

Changed author from **David Coudert** to **David Coudert, Jonathan Kliem**



---

archive/issue_comments_491549.json:
```json
{
    "body": "Dependencies: **#30665**",
    "created_at": "2020-10-12T15:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491549",
    "user": "https://github.com/kliem"
}
```

Dependencies: **#30665**



---

archive/issue_comments_491550.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nI'm not sure about this last commit as it has a different number than in #30665. Is it normal ?",
    "created_at": "2020-10-12T22:11:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491550",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

I'm not sure about this last commit as it has a different number than in #30665. Is it normal ?



---

archive/issue_comments_491551.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThis usually happens to me when cherry picking. I can rebase at some point on #30665.",
    "created_at": "2020-10-13T05:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491551",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

This usually happens to me when cherry picking. I can rebase at some point on #30665.



---

archive/issue_comments_491552.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf\"><code>b7d739f</code></a></td><td><code>check for bitset capacity</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee0487071b78193f0a6adbced0203cb98e9d51aa\"><code>ee04870</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0a3b0aa751ecf7f48ad076792a6ab82b52c22e9\"><code>c0a3b0a</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba\"><code>0372941</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr></table>\n",
    "created_at": "2020-10-13T06:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491552",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf"><code>b7d739f</code></a></td><td><code>check for bitset capacity</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee0487071b78193f0a6adbced0203cb98e9d51aa"><code>ee04870</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0a3b0aa751ecf7f48ad076792a6ab82b52c22e9"><code>c0a3b0a</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba"><code>0372941</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr></table>




---

archive/issue_comments_491553.json:
```json
{
    "body": "Changed commit from **[`3a42e25`](https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f)** to **[`0372941`](https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba)**",
    "created_at": "2020-10-13T06:54:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491553",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3a42e25`](https://github.com/sagemath/sagetrac-mirror/commit/3a42e25f9b335edbe748daef3d5d924d3d5b775f)** to **[`0372941`](https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba)**



---

archive/issue_comments_491554.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\n- may be the method `obtain_subgraph` could be renamed like `subgraph_given_vertices` or something more explicit with respect what it actually do.\n- there is a line `cdef CGraph` to remove\n- instead of `max(b_vertices_2)`, why not using the size or capacity of bitset `active_vertices` ? or may be the size of `b_vertices` ?\n- Somehow, before starting to add vertices to `other`, we should call `realloc` with appropriate size, thus avoiding multiple calls.\n- I have no clue how to deal with multiple edges here.\n\n- Concerning methods `add` and `delete`, I fully agree that now `delete` should be used only when `inplace is True or algorithm == 'delete'`. The  `add` method is now way faster and should be the default one, without threshold.",
    "created_at": "2020-10-13T11:29:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491554",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:19" align="right">comment:19</div>

- may be the method `obtain_subgraph` could be renamed like `subgraph_given_vertices` or something more explicit with respect what it actually do.
- there is a line `cdef CGraph` to remove
- instead of `max(b_vertices_2)`, why not using the size or capacity of bitset `active_vertices` ? or may be the size of `b_vertices` ?
- Somehow, before starting to add vertices to `other`, we should call `realloc` with appropriate size, thus avoiding multiple calls.
- I have no clue how to deal with multiple edges here.

- Concerning methods `add` and `delete`, I fully agree that now `delete` should be used only when `inplace is True or algorithm == 'delete'`. The  `add` method is now way faster and should be the default one, without threshold.



---

archive/issue_comments_491555.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI'll keep that in mind.\n\nConcerning the multiedges, unfortunately I shbould clean up dense and sparse graphs backend a bit first. Otherwise, I think it is not a problem.\n\nIf ``self`` is mutliedge, it will simply try to make ``other`` multiedge. If other is dense, this will raise an error.\n\nIf I do things right, optimizing `is_subgraph` afterwards should be easy. In particual this can be used to check equality fast.",
    "created_at": "2020-10-13T11:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491555",
    "user": "https://github.com/kliem"
}
```

<div id="comment:20" align="right">comment:20</div>

I'll keep that in mind.

Concerning the multiedges, unfortunately I shbould clean up dense and sparse graphs backend a bit first. Otherwise, I think it is not a problem.

If ``self`` is mutliedge, it will simply try to make ``other`` multiedge. If other is dense, this will raise an error.

If I do things right, optimizing `is_subgraph` afterwards should be easy. In particual this can be used to check equality fast.



---

archive/issue_comments_491556.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nSo may be for the moment, we can use the new method for graphs without multiple edges only and let other cases in the todo list (i.e., raise `NotImplementedError` if called on a graph with multiple edges).\n\nIt's cool if we can also optimize other methods. The work you have already done for iterating edges plus these optimizations of the subgraph method makes significant speed ups for the entire graph module :))",
    "created_at": "2020-10-13T12:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491556",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:21" align="right">comment:21</div>

So may be for the moment, we can use the new method for graphs without multiple edges only and let other cases in the todo list (i.e., raise `NotImplementedError` if called on a graph with multiple edges).

It's cool if we can also optimize other methods. The work you have already done for iterating edges plus these optimizations of the subgraph method makes significant speed ups for the entire graph module :))



---

archive/issue_comments_491557.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe current method does not even work for labeled graphs.\n\nGive me a day or so and I'll see if I can figure things out.",
    "created_at": "2020-10-13T13:53:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491557",
    "user": "https://github.com/kliem"
}
```

<div id="comment:22" align="right">comment:22</div>

The current method does not even work for labeled graphs.

Give me a day or so and I'll see if I can figure things out.



---

archive/issue_comments_491558.json:
```json
{
    "body": "Changed commit from **[`0372941`](https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba)** to **[`75b7de5`](https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4)**",
    "created_at": "2020-10-14T14:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491558",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`0372941`](https://github.com/sagemath/sagetrac-mirror/commit/0372941f0f4e62077b5957322d4ae56427dc06ba)** to **[`75b7de5`](https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4)**



---

archive/issue_comments_491559.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThis is basically working.\n\nWhat is missing:\n\n- Documentation.\n- Cleanup.\n- Exposure in `__init__` of `DiGraph` and `Graph` to speed up e.g. copy.\n- (Maybe) Heuristics when to delete instead of add:\n  As long as there are no improved copying methods, I changed the deletion subgraph to first obtain the subgraph induced by the given vertices instead of making a copy. Depending on the input of `edges` and `edge_property`, this might be better than adding, but maybe in not so many cases. And in those cases it might be more natural to obtain a subgraph first and then delete edges.\n \n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c71a05eb8c373750f9a4f9a6e38078a42ab3f9e0\"><code>c71a05e</code></a></td><td><code>fix doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a1e14451218d160d147532c01e510d674b19cec2\"><code>a1e1445</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19f3d6222ff51485fe0c884037c3a5764103e5a9\"><code>19f3d62</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3306bc931b2f2e32533ed0a26b1bfc26089d2673\"><code>3306bc9</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae9204be105fcd2d1725a7ab33ea02e422418741\"><code>ae9204b</code></a></td><td><code>reviewers comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd5a20637c0a2b390e273620633b15f58c2b6bca\"><code>fd5a206</code></a></td><td><code>deal with labels and multiple edges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bafda55fc1d99c7eed1cd3364dc47af77395854f\"><code>bafda55</code></a></td><td><code>avoid bitset must not be empty</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/853802a330bb71081775413316edea987293dc00\"><code>853802a</code></a></td><td><code>implement subgraph_given_vertices for static sparse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/159869f823e0cc66b8409d83a38b5db9beede32d\"><code>159869f</code></a></td><td><code>use cases for subgraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4\"><code>75b7de5</code></a></td><td><code>allow deleting of multiedges and loops</code></td></tr></table>\n",
    "created_at": "2020-10-14T14:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491559",
    "user": "https://github.com/kliem"
}
```

<div id="comment:23" align="right">comment:23</div>

This is basically working.

What is missing:

- Documentation.
- Cleanup.
- Exposure in `__init__` of `DiGraph` and `Graph` to speed up e.g. copy.
- (Maybe) Heuristics when to delete instead of add:
  As long as there are no improved copying methods, I changed the deletion subgraph to first obtain the subgraph induced by the given vertices instead of making a copy. Depending on the input of `edges` and `edge_property`, this might be better than adding, but maybe in not so many cases. And in those cases it might be more natural to obtain a subgraph first and then delete edges.
 
---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c71a05eb8c373750f9a4f9a6e38078a42ab3f9e0"><code>c71a05e</code></a></td><td><code>fix doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a1e14451218d160d147532c01e510d674b19cec2"><code>a1e1445</code></a></td><td><code>trac #30753: improve _subgraph_by_adding</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19f3d6222ff51485fe0c884037c3a5764103e5a9"><code>19f3d62</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3306bc931b2f2e32533ed0a26b1bfc26089d2673"><code>3306bc9</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae9204be105fcd2d1725a7ab33ea02e422418741"><code>ae9204b</code></a></td><td><code>reviewers comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd5a20637c0a2b390e273620633b15f58c2b6bca"><code>fd5a206</code></a></td><td><code>deal with labels and multiple edges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bafda55fc1d99c7eed1cd3364dc47af77395854f"><code>bafda55</code></a></td><td><code>avoid bitset must not be empty</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/853802a330bb71081775413316edea987293dc00"><code>853802a</code></a></td><td><code>implement subgraph_given_vertices for static sparse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/159869f823e0cc66b8409d83a38b5db9beede32d"><code>159869f</code></a></td><td><code>use cases for subgraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4"><code>75b7de5</code></a></td><td><code>allow deleting of multiedges and loops</code></td></tr></table>




---

archive/issue_comments_491560.json:
```json
{
    "body": "Changed branch from **[public/graphs/30753_subgraph](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph)** to **[public/graphs/30753_subgraph_new](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph_new)**",
    "created_at": "2020-10-14T14:45:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491560",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[public/graphs/30753_subgraph](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph)** to **[public/graphs/30753_subgraph_new](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph_new)**



---

archive/issue_comments_491561.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis is really nice and I observe some speed up at least when doctesting the graph module :))",
    "created_at": "2020-10-14T16:39:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491561",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:24" align="right">comment:24</div>

This is really nice and I observe some speed up at least when doctesting the graph module :))



---

archive/issue_comments_491562.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a000ef486de1a5991b04713000e4bca6cfa53b8\"><code>1a000ef</code></a></td><td><code>fix mistakes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1\"><code>cbda82c</code></a></td><td><code>expose subgraph method to initialization/copying</code></td></tr></table>\n",
    "created_at": "2020-10-14T19:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491562",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a000ef486de1a5991b04713000e4bca6cfa53b8"><code>1a000ef</code></a></td><td><code>fix mistakes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1"><code>cbda82c</code></a></td><td><code>expose subgraph method to initialization/copying</code></td></tr></table>




---

archive/issue_comments_491563.json:
```json
{
    "body": "Changed commit from **[`75b7de5`](https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4)** to **[`cbda82c`](https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1)**",
    "created_at": "2020-10-14T19:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491563",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`75b7de5`](https://github.com/sagemath/sagetrac-mirror/commit/75b7de5acbbc1be7772b99ae0b8efeaee0d59ba4)** to **[`cbda82c`](https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1)**



---

archive/issue_comments_491564.json:
```json
{
    "body": "Changed dependencies from **#30665** to **#30665, #30769**",
    "created_at": "2020-10-14T19:40:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491564",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30665** to **#30665, #30769**



---

archive/issue_comments_491565.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a8ec0029a2b5cd9ea99af9b5f64c5d0972bd98d\"><code>1a8ec00</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/29b485b35fbab3b284afc0388c9f8c6db39ecad6\"><code>29b485b</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f25e3880a7c55fa79bd3d4eb9b5cc5b0994a673\"><code>2f25e38</code></a></td><td><code>reviewers comments</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4f2473fc48c292e520c9042f410488980c73a22\"><code>f4f2473</code></a></td><td><code>deal with labels and multiple edges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd624f2340dc1423dd8bffa0dedf73c94647df1d\"><code>fd624f2</code></a></td><td><code>avoid bitset must not be empty</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4bc40b962f9115d5be8822c6f3567a34751e323\"><code>f4bc40b</code></a></td><td><code>implement subgraph_given_vertices for static sparse</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05c3f721a08cb78c50ed63b3948e3bfb21af0f14\"><code>05c3f72</code></a></td><td><code>use cases for subgraph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a4326ed46a3ab67c34239be11ff7d5af36a130d\"><code>7a4326e</code></a></td><td><code>allow deleting of multiedges and loops</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb960227ff03485c114543a6df65dd930ce4f35d\"><code>fb96022</code></a></td><td><code>fix mistakes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770\"><code>776e38f</code></a></td><td><code>expose subgraph method to initialization/copying</code></td></tr></table>\n",
    "created_at": "2020-10-14T19:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491565",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a8ec0029a2b5cd9ea99af9b5f64c5d0972bd98d"><code>1a8ec00</code></a></td><td><code>trac #30753: change threshold for default algorithm</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/29b485b35fbab3b284afc0388c9f8c6db39ecad6"><code>29b485b</code></a></td><td><code>first step towards subgraph_by_adding in backend</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f25e3880a7c55fa79bd3d4eb9b5cc5b0994a673"><code>2f25e38</code></a></td><td><code>reviewers comments</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4f2473fc48c292e520c9042f410488980c73a22"><code>f4f2473</code></a></td><td><code>deal with labels and multiple edges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd624f2340dc1423dd8bffa0dedf73c94647df1d"><code>fd624f2</code></a></td><td><code>avoid bitset must not be empty</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4bc40b962f9115d5be8822c6f3567a34751e323"><code>f4bc40b</code></a></td><td><code>implement subgraph_given_vertices for static sparse</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05c3f721a08cb78c50ed63b3948e3bfb21af0f14"><code>05c3f72</code></a></td><td><code>use cases for subgraph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a4326ed46a3ab67c34239be11ff7d5af36a130d"><code>7a4326e</code></a></td><td><code>allow deleting of multiedges and loops</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb960227ff03485c114543a6df65dd930ce4f35d"><code>fb96022</code></a></td><td><code>fix mistakes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770"><code>776e38f</code></a></td><td><code>expose subgraph method to initialization/copying</code></td></tr></table>




---

archive/issue_comments_491566.json:
```json
{
    "body": "Changed commit from **[`cbda82c`](https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1)** to **[`776e38f`](https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770)**",
    "created_at": "2020-10-14T19:44:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491566",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cbda82c`](https://github.com/sagemath/sagetrac-mirror/commit/cbda82c0f6674c1248338cb177273b8a24435af1)** to **[`776e38f`](https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770)**



---

archive/issue_comments_491567.json:
```json
{
    "body": "Changed commit from **[`776e38f`](https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770)** to **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**",
    "created_at": "2020-10-15T09:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491567",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`776e38f`](https://github.com/sagemath/sagetrac-mirror/commit/776e38f30e301f4bef172ff752633412f641e770)** to **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**



---

archive/issue_comments_491568.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c6e1d5360c91822c9d5317f3d017581123d7851\"><code>7c6e1d5</code></a></td><td><code>clean up</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271\"><code>40bacf0</code></a></td><td><code>documentation</code></td></tr></table>\n",
    "created_at": "2020-10-15T09:09:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491568",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c6e1d5360c91822c9d5317f3d017581123d7851"><code>7c6e1d5</code></a></td><td><code>clean up</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271"><code>40bacf0</code></a></td><td><code>documentation</code></td></tr></table>




---

archive/issue_events_426294.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-15T09:10:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426294"
}
```



---

archive/issue_events_426295.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-15T09:10:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426295"
}
```



---

archive/issue_comments_491569.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,74 @@\n-Extra speedup improvements in `subgraph` with a case forgotten in #30510. We also improve the logic in the selection of the default algorithm.\n+We add a fast method `subgraph_given_vertices` to `CGraphBackend`. This method allows fast subgraph creation including copying.\n+Also improvements in `subgraph` with a case forgotten in #30510.\n+\n+Before #30665:\n+\n+```\n+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                            \n+sage: V = list(G)                                                                                                                                                                   \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n+280 \u00b5s \u00b1 465 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                          \n+30.3 ms \u00b1 72.8 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+                                                                                                                                                                              \n+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                   \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n+553 \u00b5s \u00b1 373 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy(immutable=False)                                                                                                                                           \n+31.6 ms \u00b1 91.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+                                                                                                                                                                               \n+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                               \n+sage: V = list(G)                                                                                                                                                                   \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               \n+54.2 ms \u00b1 54.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                          \n+527 ms \u00b1 663 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n+```\n+\n+With #30665 and #30769:\n+\n+```\n+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                   \n+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+257 \u00b5s \u00b1 356 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n+26.4 ms \u00b1 146 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+                                                                                                                                                                                                                                                                                                                                                                     \n+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                          \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+521 \u00b5s \u00b1 308 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  \n+28.3 ms \u00b1 95.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+\n+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                      \n+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+51.6 ms \u00b1 64.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n+429 ms \u00b1 1.23 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n+```\n+\n+With this ticket:\n+\n+```\n+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                                     \n+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+80.9 \u00b5s \u00b1 19.1 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n+15.4 ms \u00b1 10.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n+\n+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                                           \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+327 \u00b5s \u00b1 1.04 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  \n+20.3 ms \u00b1 23 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+\n+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                             \n+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          \n+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      \n+1.03 ms \u00b1 10.6 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 \n+269 ms \u00b1 3.08 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n+```\n``````\n",
    "created_at": "2020-10-15T09:24:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491569",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,74 @@
-Extra speedup improvements in `subgraph` with a case forgotten in #30510. We also improve the logic in the selection of the default algorithm.
+We add a fast method `subgraph_given_vertices` to `CGraphBackend`. This method allows fast subgraph creation including copying.
+Also improvements in `subgraph` with a case forgotten in #30510.
+
+Before #30665:
+
+```
+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                            
+sage: V = list(G)                                                                                                                                                                   
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
+280 µs ± 465 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                          
+30.3 ms ± 72.8 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+                                                                                                                                                                              
+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                   
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
+553 µs ± 373 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy(immutable=False)                                                                                                                                           
+31.6 ms ± 91.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+                                                                                                                                                                               
+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                               
+sage: V = list(G)                                                                                                                                                                   
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                               
+54.2 ms ± 54.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                          
+527 ms ± 663 µs per loop (mean ± std. dev. of 7 runs, 1 loop each)
+```
+
+With #30665 and #30769:
+
+```
+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                   
+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+257 µs ± 356 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
+26.4 ms ± 146 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+                                                                                                                                                                                                                                                                                                                                                                     
+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                          
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+521 µs ± 308 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  
+28.3 ms ± 95.2 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+
+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                      
+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+51.6 ms ± 64.6 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
+429 ms ± 1.23 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
+```
+
+With this ticket:
+
+```
+sage: G = graphs.Grid2dGraph(100, 100)  # dynamic sparse                                                                                                                                                                                                                                                                                                                                     
+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+80.9 µs ± 19.1 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
+15.4 ms ± 10.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
+
+sage: G = G.copy(immutable=True)  # static sparse                                                                                                                                                                                                                                                                                                                                           
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+327 µs ± 1.04 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy(immutable=False)                                                                                                                                                                                                                                                                                                                                  
+20.3 ms ± 23 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
+
+sage: G = graphs.CompleteGraph(1000)  # dynamic dense                                                                                                                                                                                                                                                                                                                             
+sage: V = list(G)                                                                                                                                                                                                                                                                                                                                                          
+sage: %timeit H = G.subgraph(V[:50], algorithm='add')                                                                                                                                                                                                                                                                                                                      
+1.03 ms ± 10.6 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit H = G.copy()                                                                                                                                                                                                                                                                                                                                                 
+269 ms ± 3.08 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
+```
``````




---

archive/issue_events_426296.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-15T09:38:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426296"
}
```



---

archive/issue_events_426297.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-15T09:38:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426297"
}
```



---

archive/issue_comments_491570.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2020-10-15T09:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491570",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_491571.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nIt's not easy to review the changes done in this ticket as it depends on two other big tickets.\nNonetheless, so far all my tests are successful and show serious speed up with respect previous design. Method subgraph was a bottleneck in several of my own code.",
    "created_at": "2020-10-15T09:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491571",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:31" align="right">comment:31</div>

It's not easy to review the changes done in this ticket as it depends on two other big tickets.
Nonetheless, so far all my tests are successful and show serious speed up with respect previous design. Method subgraph was a bottleneck in several of my own code.



---

archive/issue_comments_491572.json:
```json
{
    "body": "Changed branch from **[public/graphs/30753_subgraph_new](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph_new)** to **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**",
    "created_at": "2020-11-07T16:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30753#issuecomment-491572",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/30753_subgraph_new](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30753_subgraph_new)** to **[`40bacf0`](https://github.com/sagemath/sagetrac-mirror/commit/40bacf03c0633affd490bac998856618879ba271)**



---

archive/issue_events_426298.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426298"
}
```



---

archive/issue_events_426299.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fec8cd23b10f90366be90d26b22c197fc14563bd",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-11-07T16:23:58Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30753",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30753#event-426299"
}
```
