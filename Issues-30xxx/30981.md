# Issue 30981: Annular Khovanov Homology of Braids

archive/issues_030744.json:
```json
{
    "body": "Implents annular Khovanov homology for braids.\n\n```\nsage: B = BraidGroup(2)\nsage: b = B([1,1,1])\nsage: b.annular_khovanov_homology()\n{(9, 0): {3: Z},\n (7, 0): {2: 0, 3: C2},\n (1, -2): {0: Z},\n (3, 0): {0: Z, 1: 0, 2: 0, 3: 0},\n (5, 0): {1: Z, 2: Z, 3: 0},\n (5, 2): {0: Z}}\nsage: annular_khovanov_homology(poincare_polynomial=True)\na^2*q^5 + q^9*t^3 + q^5*t^2 + q^5*t + q^3 + a^-2*q\n```\n\nIt is computed very similarly as the implementation of Khovanov homology for links.\n\n\nCC:  @miguelmarco\n\nKeywords: knot, annular Khovanov, braid group\n\nBranch/Commit: 776c9fc9b434c07b762ef55609721c42f9f9572a\n\nReviewer: Travis Scrimshaw, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Joel Schmitz\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30981\n\n",
    "closed_at": "2021-08-29T09:37:48Z",
    "created_at": "2020-11-30T09:09:13Z",
    "labels": [
        "component: algebraic topology"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Annular Khovanov Homology of Braids",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30981",
    "user": "https://github.com/Jaulers"
}
```
Implents annular Khovanov homology for braids.

```
sage: B = BraidGroup(2)
sage: b = B([1,1,1])
sage: b.annular_khovanov_homology()
{(9, 0): {3: Z},
 (7, 0): {2: 0, 3: C2},
 (1, -2): {0: Z},
 (3, 0): {0: Z, 1: 0, 2: 0, 3: 0},
 (5, 0): {1: Z, 2: Z, 3: 0},
 (5, 2): {0: Z}}
sage: annular_khovanov_homology(poincare_polynomial=True)
a^2*q^5 + q^9*t^3 + q^5*t^2 + q^5*t + q^3 + a^-2*q
```

It is computed very similarly as the implementation of Khovanov homology for links.


CC:  @miguelmarco

Keywords: knot, annular Khovanov, braid group

Branch/Commit: 776c9fc9b434c07b762ef55609721c42f9f9572a

Reviewer: Travis Scrimshaw, Frédéric Chapoton

Author: Joel Schmitz

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30981





---

archive/issue_comments_468844.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-30T09:11:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468845.json:
```json
{
    "body": "<a id='comment:2'></a>This is my first contribution.\n\nI added the ability to output the poincare\u00e9 polynomial of the homology since the dictionary is often quite hard to read and it makes for a more compact output. However I'm not sure if this is the ideal place to implement it, maybe some more general solution for homologies would be better...\n\nI'm also not sure where to put the additional needed imports for the needed modules. Should they be put at the front of the file or into each function, I've seen both in this file.",
    "created_at": "2020-11-30T09:17:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468845",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:2'></a>This is my first contribution.

I added the ability to output the poincareé polynomial of the homology since the dictionary is often quite hard to read and it makes for a more compact output. However I'm not sure if this is the ideal place to implement it, maybe some more general solution for homologies would be better...

I'm also not sure where to put the additional needed imports for the needed modules. Should they be put at the front of the file or into each function, I've seen both in this file.



---

archive/issue_comments_468846.json:
```json
{
    "body": "<a id='comment:3'></a>just a few trivial comments:\n\n`.. NOTE::` should be in capital letters\n\n`... == None` should be `... is None`\n\nwhen iterating over dicts, you can remove the `.keys()` as this gives the same thing\n\nadd a reference to an article for the definition\n\ndo not insert too many empty lines",
    "created_at": "2020-11-30T09:24:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468846",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>just a few trivial comments:

`.. NOTE::` should be in capital letters

`... == None` should be `... is None`

when iterating over dicts, you can remove the `.keys()` as this gives the same thing

add a reference to an article for the definition

do not insert too many empty lines



---

archive/issue_comments_468847.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-30T09:59:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468848.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-30T10:12:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_468849.json:
```json
{
    "body": "<a id='comment:6'></a>annular_khovanov_homology has no doctests. every function should have doctests",
    "created_at": "2020-11-30T10:37:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468849",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:6'></a>annular_khovanov_homology has no doctests. every function should have doctests



---

archive/issue_comments_468850.json:
```json
{
    "body": "<a id='comment:7'></a>do not use `IntegerRing()`, but rather ZZ",
    "created_at": "2020-11-30T10:38:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468850",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:7'></a>do not use `IntegerRing()`, but rather ZZ



---

archive/issue_comments_468851.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-30T16:06:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468852.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 chapoton]:\n> do not use `IntegerRing()`, but rather ZZ\n\n\nI've used `IntegerRing()` since this was used everywhere else in `braids.py`. (i.e. in `burau_matrix()`, `alexenader_polynomial()` etc.)\n\nI thought using ZZ just for this method would be a bit inconsistent.",
    "created_at": "2020-11-30T16:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468852",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:9'></a>Replying to [comment:7 chapoton]:
> do not use `IntegerRing()`, but rather ZZ


I've used `IntegerRing()` since this was used everywhere else in `braids.py`. (i.e. in `burau_matrix()`, `alexenader_polynomial()` etc.)

I thought using ZZ just for this method would be a bit inconsistent.



---

archive/issue_comments_468853.json:
```json
{
    "body": "<a id='comment:10'></a>ok, right",
    "created_at": "2020-11-30T17:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468853",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:10'></a>ok, right



---

archive/issue_comments_468854.json:
```json
{
    "body": "<a id='comment:11'></a>patchbot says : \n\n```\nsrc/sage/groups/braid.py:1213:9 local variable 'ncross' is assigned to but never used\n```",
    "created_at": "2020-12-01T13:22:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468854",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>patchbot says : 

```
src/sage/groups/braid.py:1213:9 local variable 'ncross' is assigned to but never used
```



---

archive/issue_comments_468855.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-02T13:37:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468856.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-02T13:51:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468856",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468857.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-06T18:31:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468857",
    "user": "https://github.com/Jaulers"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_468858.json:
```json
{
    "body": "<a id='comment:15'></a>After working with this a bit, I realized it is a bit impractical to only have a method for directly getting the homology group, as this gives little insight into the structure. It would probably be better to only have a method of returning the annular khovanov chain complex and then leave it up to the user to calculate homology. The the user can have access to all options in calculating homology.\n\nI'll start working on that.",
    "created_at": "2021-01-09T11:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468858",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:15'></a>After working with this a bit, I realized it is a bit impractical to only have a method for directly getting the homology group, as this gives little insight into the structure. It would probably be better to only have a method of returning the annular khovanov chain complex and then leave it up to the user to calculate homology. The the user can have access to all options in calculating homology.

I'll start working on that.



---

archive/issue_comments_468859.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-01-09T11:32:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468859",
    "user": "https://github.com/Jaulers"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_468860.json:
```json
{
    "body": "<a id='comment:16'></a>I would recommend having both, a method for the chain complex and a shortcut method for the homology.",
    "created_at": "2021-01-11T23:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468860",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>I would recommend having both, a method for the chain complex and a shortcut method for the homology.



---

archive/issue_comments_468861.json:
```json
{
    "body": "<a id='comment:17'></a>Are you sure this is needed? Because computing homology from the complex would be as easy as just \n\n```\nb.annular_khovanov_complex(ZZ,(qgrad,agrad)).homology()\n```\n\nPlus, using the homology method directly, the user can access all the parameters of the homology method directly, without needing to pass it through some wrapper function.",
    "created_at": "2021-01-12T15:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468861",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:17'></a>Are you sure this is needed? Because computing homology from the complex would be as easy as just 

```
b.annular_khovanov_complex(ZZ,(qgrad,agrad)).homology()
```

Plus, using the homology method directly, the user can access all the parameters of the homology method directly, without needing to pass it through some wrapper function.



---

archive/issue_comments_468862.json:
```json
{
    "body": "<a id='comment:18'></a>It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.",
    "created_at": "2021-01-13T00:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468862",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:18'></a>It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.



---

archive/issue_comments_468863.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-13T11:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468864.json:
```json
{
    "body": "<a id='comment:20'></a>I've left in `annular_khovanov_homology()` now. You're right it is often handy to have that shortcut.\n\nHowever I removed the poincar\u00e9e polynomial option, I really don't think this is the right place to implement it.\n\nReplying to [comment:18 tscrim]:\n> It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.\n\n\nWhat do you mean by tailoring the `homology` interface?",
    "created_at": "2021-01-13T11:25:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468864",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:20'></a>I've left in `annular_khovanov_homology()` now. You're right it is often handy to have that shortcut.

However I removed the poincarée polynomial option, I really don't think this is the right place to implement it.

Replying to [comment:18 tscrim]:
> It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.


What do you mean by tailoring the `homology` interface?



---

archive/issue_comments_468865.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:20 gh-Jaulers]:\n> Replying to [comment:18 tscrim]:\n> > It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.\n\n> \n> What do you mean by tailoring the `homology` interface?\n\n\nEssentially what you said above with having an option to compute the Poincar\u00e9 polynomial. You can change the options and how those are handled to give a more specific experience specific to the case of links/knots.",
    "created_at": "2021-01-14T05:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468865",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>Replying to [comment:20 gh-Jaulers]:
> Replying to [comment:18 tscrim]:
> > It is not needed, but it is useful to a more casual user. You can also modify the `homology` interface to be more tailored to the computation at hand.

> 
> What do you mean by tailoring the `homology` interface?


Essentially what you said above with having an option to compute the Poincaré polynomial. You can change the options and how those are handled to give a more specific experience specific to the case of links/knots.



---

archive/issue_comments_468866.json:
```json
{
    "body": "<a id='comment:22'></a>Do you think it would be useful to have the option for the Poincar\u00e9 polynomial?",
    "created_at": "2021-01-18T09:26:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468866",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:22'></a>Do you think it would be useful to have the option for the Poincaré polynomial?



---

archive/issue_comments_468867.json:
```json
{
    "body": "<a id='comment:23'></a>I am not such an expert in knot theory, so I cannot really say. Although from a more na\u00efve separation-of-concerns viewpoint, that would be better as a separate method as it is not the actual homology.",
    "created_at": "2021-01-18T09:31:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468867",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:23'></a>I am not such an expert in knot theory, so I cannot really say. Although from a more naïve separation-of-concerns viewpoint, that would be better as a separate method as it is not the actual homology.



---

archive/issue_comments_468868.json:
```json
{
    "body": "<a id='comment:24'></a>I personally used it mainly since it gave a nicer overview over the homology, but as I said, I also think it would be a weird place to implement it directly into the `annular_khovanov_homology()` method.\n\nI also wouldn't implement some poincar\u00e9e polynomial method, since that would only work for the format returned by this method. I think if the user desires such output, it is reasonably easy to write a function that does this.",
    "created_at": "2021-01-18T09:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468868",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:24'></a>I personally used it mainly since it gave a nicer overview over the homology, but as I said, I also think it would be a weird place to implement it directly into the `annular_khovanov_homology()` method.

I also wouldn't implement some poincarée polynomial method, since that would only work for the format returned by this method. I think if the user desires such output, it is reasonably easy to write a function that does this.



---

archive/issue_comments_468869.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-18T09:47:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468869",
    "user": "https://github.com/Jaulers"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_468870.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:24 gh-Jaulers]:\n> I also wouldn't implement some poincar\u00e9e polynomial method, since that would only work for the format returned by this method. I think if the user desires such output, it is reasonably easy to write a function that does this.\n\n\nI don't understand what you mean by this. It would be perfectly fine for it to take the specific output of `annular_khovanov_homology()` or output it in a similar way. Anyways, if you don't think such an additional method is useful, then you don't have to implement it.\n\nWith the new commit, the patchbot is reporting the following doctest failures:\n\n```\nsage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed\n```",
    "created_at": "2021-01-18T09:59:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468870",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:26'></a>Replying to [comment:24 gh-Jaulers]:
> I also wouldn't implement some poincarée polynomial method, since that would only work for the format returned by this method. I think if the user desires such output, it is reasonably easy to write a function that does this.


I don't understand what you mean by this. It would be perfectly fine for it to take the specific output of `annular_khovanov_homology()` or output it in a similar way. Anyways, if you don't think such an additional method is useful, then you don't have to implement it.

With the new commit, the patchbot is reporting the following doctest failures:

```
sage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed
```



---

archive/issue_comments_468871.json:
```json
{
    "body": "<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-18T11:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468871",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468872.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 tscrim]:\n> With the new commit, the patchbot is reporting the following doctest failures:\n> \n> ```\n> sage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed\n> ```\n\n\nOh yes, thank you. Once again the dictionary was out of order. Is there any simple way to get sage to print the dictionary in the right order, so one can write the doctests easier? For now I've always used `dict(sorted(d.items()))` but that doesn't work for nested dictionaries...",
    "created_at": "2021-01-18T11:07:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468872",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:28'></a>Replying to [comment:26 tscrim]:
> With the new commit, the patchbot is reporting the following doctest failures:
> 
> ```
> sage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed
> ```


Oh yes, thank you. Once again the dictionary was out of order. Is there any simple way to get sage to print the dictionary in the right order, so one can write the doctests easier? For now I've always used `dict(sorted(d.items()))` but that doesn't work for nested dictionaries...



---

archive/issue_comments_468873.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 gh-Jaulers]:\n> Replying to [comment:26 tscrim]:\n> > With the new commit, the patchbot is reporting the following doctest failures:\n> > \n> > ```\n> > sage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed\n> > ```\n\n> \n> Oh yes, thank you. Once again the dictionary was out of order. Is there any simple way to get sage to print the dictionary in the right order, so one can write the doctests easier? For now I've always used `dict(sorted(d.items()))` but that doesn't work for nested dictionaries...\n\n\nThe output of dictionaries when run in Sage's doctests are sorted (by the keys IIRC), precisely to ensure consistency in the doctests. So when running something with things like a `dict`,  I just use `sage -t` and copy that output.\n\nAlthough for this case, since you have `dict` of `dict`, you will likely have to manually convert it to the list of items and sort the items.\n\nAlso, typo `mad` -> `made`:\n\n```\nA tuple with the type of smoothing mad at each crossing.\n```\n\n```diff\n-        \"\"\"r\n+        r\"\"\"\n         Return the annular Khovanov homology of a closure of a braid.\n \n         INPUT:\n \n-        - ``qagrad`` -- tuple of quantum and annular grading for which to\n-          compute the homology. If this is ``None`` (default), then\n-          compute for all gradings.\n+        - ``qagrad`` -- (optional) tuple of quantum and annular grading\n+          for which to compute the homology\n \n-        - ``ring`` -- (default: ``ZZ``) the coefficient ring.\n+        - ``ring`` -- (default: ``ZZ``) the coefficient ring\n \n         OUTPUT:\n \n         If ``qagrad`` is ``None``, return a dictionary of homogies in all\n         gradings indexed by grading. If qagrad is specified, return homology\n         of that grading.\n \n         .. NOTE::\n+\n             This is a simple wrapper around :meth:`annular_khovanov_complex`\n             to compute homology from it.\n```",
    "created_at": "2021-01-19T00:02:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468873",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>Replying to [comment:28 gh-Jaulers]:
> Replying to [comment:26 tscrim]:
> > With the new commit, the patchbot is reporting the following doctest failures:
> > 
> > ```
> > sage -t --long --random-seed=0 src/sage/groups/braid.py  # 3 doctests failed
> > ```

> 
> Oh yes, thank you. Once again the dictionary was out of order. Is there any simple way to get sage to print the dictionary in the right order, so one can write the doctests easier? For now I've always used `dict(sorted(d.items()))` but that doesn't work for nested dictionaries...


The output of dictionaries when run in Sage's doctests are sorted (by the keys IIRC), precisely to ensure consistency in the doctests. So when running something with things like a `dict`,  I just use `sage -t` and copy that output.

Although for this case, since you have `dict` of `dict`, you will likely have to manually convert it to the list of items and sort the items.

Also, typo `mad` -> `made`:

```
A tuple with the type of smoothing mad at each crossing.
```

```diff
-        """r
+        r"""
         Return the annular Khovanov homology of a closure of a braid.
 
         INPUT:
 
-        - ``qagrad`` -- tuple of quantum and annular grading for which to
-          compute the homology. If this is ``None`` (default), then
-          compute for all gradings.
+        - ``qagrad`` -- (optional) tuple of quantum and annular grading
+          for which to compute the homology
 
-        - ``ring`` -- (default: ``ZZ``) the coefficient ring.
+        - ``ring`` -- (default: ``ZZ``) the coefficient ring
 
         OUTPUT:
 
         If ``qagrad`` is ``None``, return a dictionary of homogies in all
         gradings indexed by grading. If qagrad is specified, return homology
         of that grading.
 
         .. NOTE::
+
             This is a simple wrapper around :meth:`annular_khovanov_complex`
             to compute homology from it.
```



---

archive/issue_comments_468874.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-19T10:13:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468874",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_468875.json:
```json
{
    "body": "<a id='comment:31'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468875",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080890.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30981#event-80890"
}
```



---

archive/issue_comments_468876.json:
```json
{
    "body": "Changing keywords from \"\" to \"knot, annular Khovanov, braid group\".",
    "created_at": "2021-07-07T22:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468876",
    "user": "https://github.com/tscrim"
}
```

Changing keywords from "" to "knot, annular Khovanov, braid group".



---

archive/issue_comments_468877.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-07-07T22:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468877",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_468878.json:
```json
{
    "body": "<a id='comment:32'></a>Sorry for letting this drop off my radar. Thank you for the changes.",
    "created_at": "2021-07-07T22:20:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468878",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:32'></a>Sorry for letting this drop off my radar. Thank you for the changes.



---

archive/issue_comments_468879.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-07-18T13:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468879",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_468880.json:
```json
{
    "body": "<a id='comment:33'></a>On 32-bit:\n\n```\nFile \"src/sage/groups/braid.py\", line 1027, in sage.groups.braid.Braid._enhanced_states\nFailed example:\n    b._enhanced_states()\nExpected:\n    {(0,\n      -2): {0: [((0, 0),\n        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)},\n        set())]},\n     (2,\n      0): {0: [((0, 0),\n        {(frozenset({(0, 3), (1, 3)}), 1)},\n        {(frozenset({(0, 1), (1, 1)}), 1)}),\n       ((0, 0),\n        {(frozenset({(0, 1), (1, 1)}), 1)},\n        {(frozenset({(0, 3), (1, 3)}), 1)})], 1: [((1, 0),\n        {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)},\n        set()),\n       ((0, 1),\n        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)},\n        set())], 2: [((1, 1), {(frozenset({(0, 2), (1, 0)}), 0),\n         (frozenset({(0, 0), (1, 2)}), 0)}, set())]},\n     (4,\n      0): {1: [((1, 0), set(), {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)}),\n       ((0, 1),\n        set(),\n        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)})], 2: [((1,\n         1), {(frozenset({(0, 2), (1, 0)}), 0)}, {(frozenset({(0, 0), (1, 2)}),\n          0)}),\n       ((1, 1),\n        {(frozenset({(0, 0), (1, 2)}), 0)},\n        {(frozenset({(0, 2), (1, 0)}), 0)})]},\n     (4,\n      2): {0: [((0, 0),\n        set(),\n        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)})]},\n     (6,\n      0): {2: [((1, 1),\n        set(),\n        {(frozenset({(0, 2), (1, 0)}), 0), (frozenset({(0, 0), (1, 2)}), 0)})]}}\nGot:\n    {(0,\n      -2): {0: [((0, 0),\n        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)},\n        set())]},\n     (2,\n      0): {0: [((0, 0),\n        {(frozenset({(0, 3), (1, 3)}), 1)},\n        {(frozenset({(0, 1), (1, 1)}), 1)}),\n       ((0, 0),\n        {(frozenset({(0, 1), (1, 1)}), 1)},\n        {(frozenset({(0, 3), (1, 3)}), 1)})], 1: [((1, 0),\n        {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)},\n        set()),\n       ((0, 1),\n        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)},\n        set())], 2: [((1, 1), {(frozenset({(0, 0), (1, 2)}), 0),\n         (frozenset({(0, 2), (1, 0)}), 0)}, set())]},\n     (4,\n      0): {1: [((1, 0), set(), {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)}),\n       ((0, 1),\n        set(),\n        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)})], 2: [((1,\n         1), {(frozenset({(0, 2), (1, 0)}), 0)}, {(frozenset({(0, 0), (1, 2)}),\n          0)}),\n       ((1, 1),\n        {(frozenset({(0, 0), (1, 2)}), 0)},\n        {(frozenset({(0, 2), (1, 0)}), 0)})]},\n     (4,\n      2): {0: [((0, 0),\n        set(),\n        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)})]},\n     (6,\n      0): {2: [((1, 1),\n        set(),\n        {(frozenset({(0, 0), (1, 2)}), 0), (frozenset({(0, 2), (1, 0)}), 0)})]}}\n**********************************************************************\n1 item had failures:\n   1 of   4 in sage.groups.braid.Braid._enhanced_states\n    [350 tests, 1 failure, 2.23 s]\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/groups/braid.py  # 1 doctest failed\n----------------------------------------------------------------------\n```",
    "created_at": "2021-07-18T13:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468880",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:33'></a>On 32-bit:

```
File "src/sage/groups/braid.py", line 1027, in sage.groups.braid.Braid._enhanced_states
Failed example:
    b._enhanced_states()
Expected:
    {(0,
      -2): {0: [((0, 0),
        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)},
        set())]},
     (2,
      0): {0: [((0, 0),
        {(frozenset({(0, 3), (1, 3)}), 1)},
        {(frozenset({(0, 1), (1, 1)}), 1)}),
       ((0, 0),
        {(frozenset({(0, 1), (1, 1)}), 1)},
        {(frozenset({(0, 3), (1, 3)}), 1)})], 1: [((1, 0),
        {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)},
        set()),
       ((0, 1),
        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)},
        set())], 2: [((1, 1), {(frozenset({(0, 2), (1, 0)}), 0),
         (frozenset({(0, 0), (1, 2)}), 0)}, set())]},
     (4,
      0): {1: [((1, 0), set(), {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)}),
       ((0, 1),
        set(),
        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)})], 2: [((1,
         1), {(frozenset({(0, 2), (1, 0)}), 0)}, {(frozenset({(0, 0), (1, 2)}),
          0)}),
       ((1, 1),
        {(frozenset({(0, 0), (1, 2)}), 0)},
        {(frozenset({(0, 2), (1, 0)}), 0)})]},
     (4,
      2): {0: [((0, 0),
        set(),
        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)})]},
     (6,
      0): {2: [((1, 1),
        set(),
        {(frozenset({(0, 2), (1, 0)}), 0), (frozenset({(0, 0), (1, 2)}), 0)})]}}
Got:
    {(0,
      -2): {0: [((0, 0),
        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)},
        set())]},
     (2,
      0): {0: [((0, 0),
        {(frozenset({(0, 3), (1, 3)}), 1)},
        {(frozenset({(0, 1), (1, 1)}), 1)}),
       ((0, 0),
        {(frozenset({(0, 1), (1, 1)}), 1)},
        {(frozenset({(0, 3), (1, 3)}), 1)})], 1: [((1, 0),
        {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)},
        set()),
       ((0, 1),
        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)},
        set())], 2: [((1, 1), {(frozenset({(0, 0), (1, 2)}), 0),
         (frozenset({(0, 2), (1, 0)}), 0)}, set())]},
     (4,
      0): {1: [((1, 0), set(), {(frozenset({(0, 0), (0, 2), (1, 1), (1, 3)}), 0)}),
       ((0, 1),
        set(),
        {(frozenset({(0, 1), (0, 3), (1, 0), (1, 2)}), 0)})], 2: [((1,
         1), {(frozenset({(0, 2), (1, 0)}), 0)}, {(frozenset({(0, 0), (1, 2)}),
          0)}),
       ((1, 1),
        {(frozenset({(0, 0), (1, 2)}), 0)},
        {(frozenset({(0, 2), (1, 0)}), 0)})]},
     (4,
      2): {0: [((0, 0),
        set(),
        {(frozenset({(0, 1), (1, 1)}), 1), (frozenset({(0, 3), (1, 3)}), 1)})]},
     (6,
      0): {2: [((1, 1),
        set(),
        {(frozenset({(0, 0), (1, 2)}), 0), (frozenset({(0, 2), (1, 0)}), 0)})]}}
**********************************************************************
1 item had failures:
   1 of   4 in sage.groups.braid.Braid._enhanced_states
    [350 tests, 1 failure, 2.23 s]
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/groups/braid.py  # 1 doctest failed
----------------------------------------------------------------------
```



---

archive/issue_comments_468881.json:
```json
{
    "body": "<a id='comment:34'></a>Replying to [comment:33 vbraun]:\n> On 32-bit:\n> \n> ```\n> [...]\n> Expected:\n> [...]\n>         {(frozenset({(0, 2), (1, 0)}), 0), (frozenset({(0, 0), (1, 2)}), 0)})]}}\n> Got:\n> [...]\n>         {(frozenset({(0, 0), (1, 2)}), 0), (frozenset({(0, 2), (1, 0)}), 0)})]}}\n> **********************************************************************\n> [...]\n> ```\n\n\nMhm, it seems the 32-bit version likes to choose a different ordering for the sets. Is there some difference in the versions how the ordering is chosen?",
    "created_at": "2021-07-22T11:32:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468881",
    "user": "https://github.com/Jaulers"
}
```

<a id='comment:34'></a>Replying to [comment:33 vbraun]:
> On 32-bit:
> 
> ```
> [...]
> Expected:
> [...]
>         {(frozenset({(0, 2), (1, 0)}), 0), (frozenset({(0, 0), (1, 2)}), 0)})]}}
> Got:
> [...]
>         {(frozenset({(0, 0), (1, 2)}), 0), (frozenset({(0, 2), (1, 0)}), 0)})]}}
> **********************************************************************
> [...]
> ```


Mhm, it seems the 32-bit version likes to choose a different ordering for the sets. Is there some difference in the versions how the ordering is chosen?



---

archive/issue_comments_468882.json:
```json
{
    "body": "<a id='comment:35'></a>Here is a version of that test that just sorts all of the output.\n\n---\nNew commits:",
    "created_at": "2021-07-23T01:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468882",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:35'></a>Here is a version of that test that just sorts all of the output.

---
New commits:



---

archive/issue_comments_468883.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-07-23T01:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468883",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_080891.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30981#event-80891"
}
```



---

archive/issue_events_080892.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:07:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30981#event-80892"
}
```



---

archive/issue_comments_468884.json:
```json
{
    "body": "<a id='comment:37'></a>Green patchbot. Can someone quickly check my last changes? They are just a trivial ordering update and the only thing we need to go back to a positive review.",
    "created_at": "2021-08-15T00:35:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468884",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:37'></a>Green patchbot. Can someone quickly check my last changes? They are just a trivial ordering update and the only thing we need to go back to a positive review.



---

archive/issue_comments_468885.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-08-18T18:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468885",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_468886.json:
```json
{
    "body": "<a id='comment:38'></a>ok, let it be",
    "created_at": "2021-08-18T18:28:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468886",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:38'></a>ok, let it be



---

archive/issue_comments_468887.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-08-29T09:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30981#issuecomment-468887",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080893.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-08-29T09:37:48Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30981",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30981#event-80893"
}
```
