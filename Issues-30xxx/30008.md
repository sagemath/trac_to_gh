# Issue 30008: After #30053, sphinx 3.1.2 does not build on ubuntu-{trusty,xenial,bionic}, debian-jessie, centos-7 (again)

archive/issues_029771.json:
```json
{
    "assignees": [],
    "body": "`sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.\n\nAfter #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.\n\nThis is a blocker ticket for Sage 9.2 because it is a severe regression in platform support compared to Sage 9.1.\n\nOriginally reported on this ticket:\n\n```\n/sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8): No such file or directory\n/sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)\nFound local metadata for sphinx-3.0.4.p0\nbash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)\nAttempting to download package Sphinx-3.0.4.tar.gz from mirrors\nhttp://mirrors.xmission.com/sage/spkg/upstream/sphinx/Sphinx-3.0.4.tar.gz\n[......................................................................]\nsphinx-3.0.4.p0\n====================================================\nSetting up build directory for sphinx-3.0.4.p0\nbash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)\nTraceback (most recent call last):\n  File \"/sage/build/bin/sage-uncompress-spkg\", line 23, in <module>\n    run()\n  File \"/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py\", line 72, in run\n    unpack_archive(archive, dirname)\n  File \"/sage/build/bin/../sage_bootstrap/uncompress/action.py\", line 68, in unpack_archive\n    archive.extractall(members=archive.names)\n  File \"/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py\", line 96, in extractall\n    **kwargs)\n  File \"/usr/lib64/python3.6/tarfile.py\", line 2010, in extractall\n    numeric_owner=numeric_owner)\n  File \"/usr/lib64/python3.6/tarfile.py\", line 2052, in extract\n    numeric_owner=numeric_owner)\n  File \"/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py\", line 122, in _extract_member\n    **kwargs)\n  File \"/usr/lib64/python3.6/tarfile.py\", line 2122, in _extract_member\n    self.makefile(tarinfo, targetpath)\n  File \"/usr/lib64/python3.6/tarfile.py\", line 2163, in makefile\n    with bltn_open(targetpath, \"wb\") as target:\nUnicodeEncodeError: 'ascii' codec can't encode character '\\xe4' in position 45: ordinal not in range(128)\n************************************************************************\nError: failed to extract /sage/upstream/Sphinx-3.0.4.tar.gz\n************************************************************************\nPlease email sage-devel (http://groups.google.com/group/sage-devel)\nexplaining the problem and including the log file\n  /sage/logs/pkgs/sphinx-3.0.4.p0.log\nDescribe your computer, operating system, etc.\n************************************************************************\n```\n\nSee e.g. https://github.com/sagemath/sage/runs/811777719?check_suite_focus=true\n\nBut now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).\n\nWe fix this problem by making locale fixes in the `sage-system-python` script. See e.g. https://github.com/mkoeppe/sage/runs/1142310012 for a run with the present ticket.\n\n\n\n\nDepends on #30053\n\nCC:  @vbraun @dimpase @orlitzky @jhpalmieri @seblabbe\n\nBranch/Commit: **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**\n\nReviewer: **Jonathan Kliem, S\u00e9bastien Labb\u00e9**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30008_\n\n",
    "closed_at": "2020-09-27T09:10:05Z",
    "created_at": "2020-06-28T12:44:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "After #30053, sphinx 3.1.2 does not build on ubuntu-{trusty,xenial,bionic}, debian-jessie, centos-7 (again)",
    "type": "issue",
    "updated_at": "2020-09-27T09:10:05Z",
    "url": "https://github.com/sagemath/sage/issues/30008",
    "user": "https://github.com/kliem"
}
```
`sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.

After #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.

This is a blocker ticket for Sage 9.2 because it is a severe regression in platform support compared to Sage 9.1.

Originally reported on this ticket:

```
/sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8): No such file or directory
/sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
Found local metadata for sphinx-3.0.4.p0
bash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
Attempting to download package Sphinx-3.0.4.tar.gz from mirrors
http://mirrors.xmission.com/sage/spkg/upstream/sphinx/Sphinx-3.0.4.tar.gz
[......................................................................]
sphinx-3.0.4.p0
====================================================
Setting up build directory for sphinx-3.0.4.p0
bash: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8)
Traceback (most recent call last):
  File "/sage/build/bin/sage-uncompress-spkg", line 23, in <module>
    run()
  File "/sage/build/bin/../sage_bootstrap/uncompress/cmdline.py", line 72, in run
    unpack_archive(archive, dirname)
  File "/sage/build/bin/../sage_bootstrap/uncompress/action.py", line 68, in unpack_archive
    archive.extractall(members=archive.names)
  File "/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 96, in extractall
    **kwargs)
  File "/usr/lib64/python3.6/tarfile.py", line 2010, in extractall
    numeric_owner=numeric_owner)
  File "/usr/lib64/python3.6/tarfile.py", line 2052, in extract
    numeric_owner=numeric_owner)
  File "/sage/build/bin/../sage_bootstrap/uncompress/tar_file.py", line 122, in _extract_member
    **kwargs)
  File "/usr/lib64/python3.6/tarfile.py", line 2122, in _extract_member
    self.makefile(tarinfo, targetpath)
  File "/usr/lib64/python3.6/tarfile.py", line 2163, in makefile
    with bltn_open(targetpath, "wb") as target:
UnicodeEncodeError: 'ascii' codec can't encode character '\xe4' in position 45: ordinal not in range(128)
************************************************************************
Error: failed to extract /sage/upstream/Sphinx-3.0.4.tar.gz
************************************************************************
Please email sage-devel (http://groups.google.com/group/sage-devel)
explaining the problem and including the log file
  /sage/logs/pkgs/sphinx-3.0.4.p0.log
Describe your computer, operating system, etc.
************************************************************************
```

See e.g. https://github.com/sagemath/sage/runs/811777719?check_suite_focus=true

But now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).

We fix this problem by making locale fixes in the `sage-system-python` script. See e.g. https://github.com/mkoeppe/sage/runs/1142310012 for a run with the present ticket.




Depends on #30053

CC:  @vbraun @dimpase @orlitzky @jhpalmieri @seblabbe

Branch/Commit: **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**

Reviewer: **Jonathan Kliem, Sébastien Labbé**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/30008_





---

archive/issue_events_394937.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-28T12:44:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394937"
}
```



---

archive/issue_events_394938.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-28T12:44:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394938"
}
```



---

archive/issue_events_394939.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-28T12:44:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394939"
}
```



---

archive/issue_events_394940.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-06-28T12:44:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394940"
}
```



---

archive/issue_comments_477822.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">Comment 1</div>\n\nThat's a very strange error",
    "created_at": "2020-06-28T15:48:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477822",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">Comment 1</div>

That's a very strange error



---

archive/issue_comments_477823.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nhttps://bugs.python.org/issue17153",
    "created_at": "2020-06-28T15:50:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477823",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">Comment 2</div>

https://bugs.python.org/issue17153



---

archive/issue_comments_477824.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nPerhaps #30001 happens to fix it?",
    "created_at": "2020-06-29T19:30:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477824",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4" align="right">Comment 4</div>

Perhaps #30001 happens to fix it?



---

archive/issue_comments_477825.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nTesting here:\n\nhttps://github.com/kliem/sage/pull/17/checks",
    "created_at": "2020-06-29T19:36:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477825",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">Comment 5</div>

Testing here:

https://github.com/kliem/sage/pull/17/checks



---

archive/issue_comments_477826.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nNo, doesn't help. At least not as it is now.",
    "created_at": "2020-06-30T05:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477826",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">Comment 6</div>

No, doesn't help. At least not as it is now.



---

archive/issue_comments_477827.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nAccording to this\n\nhttps://www.noreplied.com/how-to-fixed-cannot-change-locale-utf-8-error-in-centos-7/\n\none should add `LC_CTYPE=\"en_US.UTF-8\"` to `/etc/environment`. Very unsatisfying fix for someone without root privileges.\n\nThis appears to be a bug with centos 7, which is merely exposed now.",
    "created_at": "2020-06-30T19:23:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477827",
    "user": "https://github.com/kliem"
}
```

<div id="comment:7" align="right">Comment 7</div>

According to this

https://www.noreplied.com/how-to-fixed-cannot-change-locale-utf-8-error-in-centos-7/

one should add `LC_CTYPE="en_US.UTF-8"` to `/etc/environment`. Very unsatisfying fix for someone without root privileges.

This appears to be a bug with centos 7, which is merely exposed now.



---

archive/issue_comments_477828.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nJust exporting this environment variable setting in `build/bin/sage-spkg` should be enough. No need for a systemwide setting",
    "created_at": "2020-06-30T19:36:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477828",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">Comment 8</div>

Just exporting this environment variable setting in `build/bin/sage-spkg` should be enough. No need for a systemwide setting



---

archive/issue_comments_477829.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nOk. Testing this now. https://github.com/kliem/sage/pull/19/checks",
    "created_at": "2020-07-01T15:40:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477829",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">Comment 9</div>

Ok. Testing this now. https://github.com/kliem/sage/pull/19/checks



---

archive/issue_comments_477830.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\napparently should be fixed by #30053",
    "created_at": "2020-07-05T15:20:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477830",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">Comment 10</div>

apparently should be fixed by #30053



---

archive/issue_events_394941.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-23T20:31:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394941"
}
```



---

archive/issue_events_394942.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-23T20:31:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394942"
}
```



---

archive/issue_events_394943.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-23T20:31:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "a6a6a6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394943"
}
```



---

archive/issue_events_394944.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-07-23T20:31:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394944"
}
```



---

archive/issue_comments_477831.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nIt appears that things fixed itself: https://github.com/sagemath/sage/actions/runs/166309975",
    "created_at": "2020-07-23T20:31:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477831",
    "user": "https://github.com/kliem"
}
```

<div id="comment:11" align="right">Comment 11</div>

It appears that things fixed itself: https://github.com/sagemath/sage/actions/runs/166309975



---

archive/issue_comments_477832.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nIn any case, let's take care of all locale issues in #30053.",
    "created_at": "2020-07-23T22:36:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477832",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">Comment 12</div>

In any case, let's take care of all locale issues in #30053.



---

archive/issue_events_394945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-23T22:36:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394945"
}
```



---

archive/issue_events_394946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-23T22:36:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394946"
}
```



---

archive/issue_comments_477833.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-07-24T04:49:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477833",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_477834.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nAlso the upgrade to Sphinx 3.1.2 is complete at #30001 and was merged in Sage 9.2.beta5.",
    "created_at": "2020-07-26T17:42:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477834",
    "user": "https://github.com/slel"
}
```

<div id="comment:14" align="right">Comment 14</div>

Also the upgrade to Sphinx 3.1.2 is complete at #30001 and was merged in Sage 9.2.beta5.



---

archive/issue_events_394947.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-01T23:03:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394947"
}
```



---

archive/issue_events_394948.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-01T23:03:31Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394948"
}
```



---

archive/issue_events_394949.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-01T23:03:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394949"
}
```



---

archive/issue_events_394950.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T04:42:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/duplicate",
    "label_color": "a6a6a6",
    "label_name": "duplicate",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394950"
}
```



---

archive/issue_events_394951.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T04:42:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394951"
}
```



---

archive/issue_comments_477835.json:
```json
{
    "body": "Dependencies: **#30053**",
    "created_at": "2020-09-21T04:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477835",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30053**



---

archive/issue_events_394952.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T04:49:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "title_is": "After #30053, sphinx 3.1.2 does not build on ubuntu-trusty, centos-7 (again)",
    "title_was": "sphinx 3.0.4 does not build on centos 7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394952"
}
```



---

archive/issue_comments_477836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,8 @@\n+`sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.\n+\n+After #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.\n+\n+Originally reported on this ticket:\n \n ```\n /sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8): No such file or directory\n@@ -42,3 +47,11 @@\n ```\n \n See e.g. https://github.com/sagemath/sage/runs/811777719?check_suite_focus=true\n+\n+But now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).\n+\n+We fix this problem by making locale fixes in the `sage-system-python` script.\n+\n+\n+\n+\n``````\n",
    "created_at": "2020-09-21T04:49:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477836",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,8 @@
+`sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.
+
+After #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.
+
+Originally reported on this ticket:
 
 ```
 /sage/build/bin/sage-spkg: line 73: warning: setlocale: LC_ALL: cannot change locale (C.UTF-8): No such file or directory
@@ -42,3 +47,11 @@
 ```
 
 See e.g. https://github.com/sagemath/sage/runs/811777719?check_suite_focus=true
+
+But now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).
+
+We fix this problem by making locale fixes in the `sage-system-python` script.
+
+
+
+
``````




---

archive/issue_events_394953.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T04:53:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "title_is": "After #30053, sphinx 3.1.2 does not build on ubuntu-{trusty,xenial,bionic}, debian-jessie, centos-7 (again)",
    "title_was": "After #30053, sphinx 3.1.2 does not build on ubuntu-trusty, centos-7 (again)",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394953"
}
```



---

archive/issue_comments_477837.json:
```json
{
    "body": "Branch: **[u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_)**",
    "created_at": "2020-09-21T05:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477837",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_)**



---

archive/issue_comments_477838.json:
```json
{
    "body": "Commit: **[9403629](https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2)**",
    "created_at": "2020-09-21T05:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477838",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[9403629](https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2)**



---

archive/issue_comments_477839.json:
```json
{
    "body": "Changed reviewer from **Matthias Koeppe** to **https://github.com/mkoeppe/sage/actions/runs/264540655**",
    "created_at": "2020-09-21T05:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477839",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Matthias Koeppe** to **https://github.com/mkoeppe/sage/actions/runs/264540655**



---

archive/issue_comments_477840.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-09-21T05:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477840",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_477841.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2\">9403629</a></td><td><code>build/bin/sage-system-python: Work around LC_ALL=C</code></td></tr></table>\n",
    "created_at": "2020-09-21T05:38:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477841",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2">9403629</a></td><td><code>build/bin/sage-system-python: Work around LC_ALL=C</code></td></tr></table>




---

archive/issue_comments_477842.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nOn Ubuntu 18.04 + beta12 + #30053 (+ #30606, the other branch I am working on now), I do not confirm this issue for building sphinx: `sage -f sphinx` works correctly. version 3.1.2.p0 to be more precise.",
    "created_at": "2020-09-21T09:26:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477842",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:21" align="right">Comment 21</div>

On Ubuntu 18.04 + beta12 + #30053 (+ #30606, the other branch I am working on now), I do not confirm this issue for building sphinx: `sage -f sphinx` works correctly. version 3.1.2.p0 to be more precise.



---

archive/issue_comments_477843.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nthe error in the ticket description comes from Python 3.6. Is this outdated, in view of #30053, as the locale is staying `C` locale?\n\nWhat is the commit in [comment:20](#comment%3A20) doing? I am lost.",
    "created_at": "2020-09-21T12:44:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477843",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">Comment 22</div>

the error in the ticket description comes from Python 3.6. Is this outdated, in view of #30053, as the locale is staying `C` locale?

What is the commit in [comment:20](#comment%3A20) doing? I am lost.



---

archive/issue_comments_477844.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@dimpase](#comment%3A22):\n> the error in the ticket description comes from Python 3.6. Is this outdated, in view of #30053, as the locale is staying `C` locale?\n\n`build/bin/sage-system-python` finds the Python that we use for downloading and unpacking packages. \n\nIt is unrelated to the python that we try to find in `build/pkgs/python3/spkg-configure.m4` (which rejects Python 3.6 after #30053).\n\n`build/bin/sage-system-python` can use any of the Pythons listed in `build/tox.ini`. In particular, it can be an early 3.x series Python. For these, `LC_ALL=C` disables UTF-8 operation, which causes the errors described on this ticket. \n\nLook at the GH Actions links in the ticket description to see it in action.",
    "created_at": "2020-09-21T15:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477844",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@dimpase](#comment%3A22):
> the error in the ticket description comes from Python 3.6. Is this outdated, in view of #30053, as the locale is staying `C` locale?

`build/bin/sage-system-python` finds the Python that we use for downloading and unpacking packages. 

It is unrelated to the python that we try to find in `build/pkgs/python3/spkg-configure.m4` (which rejects Python 3.6 after #30053).

`build/bin/sage-system-python` can use any of the Pythons listed in `build/tox.ini`. In particular, it can be an early 3.x series Python. For these, `LC_ALL=C` disables UTF-8 operation, which causes the errors described on this ticket. 

Look at the GH Actions links in the ticket description to see it in action.



---

archive/issue_comments_477845.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -50,8 +50,7 @@\n \n But now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).\n \n-We fix this problem by making locale fixes in the `sage-system-python` script.\n+We fix this problem by making locale fixes in the `sage-system-python` script. See e.g. https://github.com/mkoeppe/sage/runs/1142310012 for a run with the present ticket.\n \n \n \n-\n``````\n",
    "created_at": "2020-09-21T15:10:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477845",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -50,8 +50,7 @@
 
 But now (https://github.com/mkoeppe/sage/runs/1141520147) we see it for `ubuntu-trusty-minimal` (where `sage-system-python` is python 3.4).
 
-We fix this problem by making locale fixes in the `sage-system-python` script.
+We fix this problem by making locale fixes in the `sage-system-python` script. See e.g. https://github.com/mkoeppe/sage/runs/1142310012 for a run with the present ticket.
 
 
 
-
``````




---

archive/issue_events_394954.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T17:00:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394954"
}
```



---

archive/issue_comments_477846.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReady for review",
    "created_at": "2020-09-21T17:00:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477846",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">Comment 25</div>

Ready for review



---

archive/issue_comments_477847.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@seblabbe](#comment%3A21):\n> On Ubuntu 18.04 + beta12 + #30053 (+ #30606, the other branch I am working on now), I do not confirm this issue for building sphinx: `sage -f sphinx` works correctly. version 3.1.2.p0 to be more precise.\n\nYou probably have a better version of python in the front of the path than what is the default on Ubuntu 18.04. You can check this with `build/bin/sage-system-python --version`.",
    "created_at": "2020-09-21T17:46:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477847",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@seblabbe](#comment%3A21):
> On Ubuntu 18.04 + beta12 + #30053 (+ #30606, the other branch I am working on now), I do not confirm this issue for building sphinx: `sage -f sphinx` works correctly. version 3.1.2.p0 to be more precise.

You probably have a better version of python in the front of the path than what is the default on Ubuntu 18.04. You can check this with `build/bin/sage-system-python --version`.



---

archive/issue_comments_477848.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nWhy again are we trying to extract a tarball with python?\n\nThe problem here isn't really the `C` locale, it's that Sphinx ships files with non-ascii characters in them...\n\n```\n$ ls tests/roots/test-images/ | tail -n 1\n-rw-r--r-- 1 mjo mjo  65K 2020-08-13 11:46 testim\u00e4ge.png\n```\n\nand we don't specify an encoding, which ultimately leaves it up to the locale.\n\nIgnoring the fact that reimplementing this is absurd, we should be able to set the filename encoding to utf8 here without touching the locale at all.",
    "created_at": "2020-09-21T18:57:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477848",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:27" align="right">Comment 27</div>

Why again are we trying to extract a tarball with python?

The problem here isn't really the `C` locale, it's that Sphinx ships files with non-ascii characters in them...

```
$ ls tests/roots/test-images/ | tail -n 1
-rw-r--r-- 1 mjo mjo  65K 2020-08-13 11:46 testimäge.png
```

and we don't specify an encoding, which ultimately leaves it up to the locale.

Ignoring the fact that reimplementing this is absurd, we should be able to set the filename encoding to utf8 here without touching the locale at all.



---

archive/issue_comments_477849.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@orlitzky](#comment%3A27):\n> Why again are we trying to extract a tarball with python?\n\nThis question is not within the scope of this ticket",
    "created_at": "2020-09-21T19:26:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477849",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@orlitzky](#comment%3A27):
> Why again are we trying to extract a tarball with python?

This question is not within the scope of this ticket



---

archive/issue_comments_477850.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nReplying to [@orlitzky](#comment%3A27):\n> The problem here isn't really the `C` locale\n\nYes, it is specifically the problem with setting the `C` locale explicitly. This is explained well in https://www.python.org/dev/peps/pep-0538/",
    "created_at": "2020-09-21T19:31:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477850",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">Comment 29</div>

Replying to [@orlitzky](#comment%3A27):
> The problem here isn't really the `C` locale

Yes, it is specifically the problem with setting the `C` locale explicitly. This is explained well in https://www.python.org/dev/peps/pep-0538/



---

archive/issue_comments_477851.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nReplying to [@orlitzky](#comment%3A27):\n> we should be able to set the filename encoding to utf8 here without touching the locale at all.\n\nWe are using the `tarfile` module as supplied by the system python.",
    "created_at": "2020-09-21T19:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477851",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">Comment 30</div>

Replying to [@orlitzky](#comment%3A27):
> we should be able to set the filename encoding to utf8 here without touching the locale at all.

We are using the `tarfile` module as supplied by the system python.



---

archive/issue_comments_477852.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/264540655** to **https://github.com/mkoeppe/sage/actions/runs/264540655, ...**",
    "created_at": "2020-09-21T19:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477852",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/264540655** to **https://github.com/mkoeppe/sage/actions/runs/264540655, ...**



---

archive/issue_comments_477853.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n `sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.\n \n After #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.\n+\n+This is a blocker ticket for Sage 9.2 because it is a severe regression in platform support compared to Sage 9.1.\n \n Originally reported on this ticket:\n \n``````\n",
    "created_at": "2020-09-21T19:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477853",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 `sage-system-python` is the Python that we use to download and unpack upstream archives.  We allow a very wide range of Python versions.
 
 After #30053 undid the change in #29033, we are again running into locale / encoding problems with early (pre-3.7) versions of Python used as `sage-system-python`.
+
+This is a blocker ticket for Sage 9.2 because it is a severe regression in platform support compared to Sage 9.1.
 
 Originally reported on this ticket:
 
``````




---

archive/issue_comments_477854.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nI'm not willing to install a version of python from 2014 to test it, but setting `tarfile.ENCODING = 'utf-8'` probably solves this in a much better way, since we know what the encoding is.",
    "created_at": "2020-09-21T19:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477854",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:33" align="right">Comment 33</div>

I'm not willing to install a version of python from 2014 to test it, but setting `tarfile.ENCODING = 'utf-8'` probably solves this in a much better way, since we know what the encoding is.



---

archive/issue_comments_477855.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">Comment 34</div>\n\nReplying to [@orlitzky](#comment%3A33):\n> I'm not willing to install a version of python from 2014 to test it\n\nYou don't have to. We have the GH Actions to test it. The link with the runs and results is in the \"Reviewer field\".",
    "created_at": "2020-09-21T20:03:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477855",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">Comment 34</div>

Replying to [@orlitzky](#comment%3A33):
> I'm not willing to install a version of python from 2014 to test it

You don't have to. We have the GH Actions to test it. The link with the runs and results is in the "Reviewer field".



---

archive/issue_comments_477856.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nReplying to [@orlitzky](#comment%3A33):\n> setting `tarfile.ENCODING = 'utf-8'` probably solves this in a much better way, since we know what the encoding is.\n\nNo, that is absolutely not the correct fix because the default (obtained using `sys.getfilesystemencoding()` or `sys.getdefaultencoding()`) is correct. See https://docs.python.org/2.6/library/tarfile.html#tar-unicode (Python 2.6 is the earliest version that we support for `sage-system-python`).\n\nThe specific problem is that if someone puts a `LC_ALL=C`, the default encodings are set to ASCII. This is what causes the breakage, and this is what the current ticket fixes.\n\nNeeds review.",
    "created_at": "2020-09-21T20:08:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477856",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">Comment 35</div>

Replying to [@orlitzky](#comment%3A33):
> setting `tarfile.ENCODING = 'utf-8'` probably solves this in a much better way, since we know what the encoding is.

No, that is absolutely not the correct fix because the default (obtained using `sys.getfilesystemencoding()` or `sys.getdefaultencoding()`) is correct. See https://docs.python.org/2.6/library/tarfile.html#tar-unicode (Python 2.6 is the earliest version that we support for `sage-system-python`).

The specific problem is that if someone puts a `LC_ALL=C`, the default encodings are set to ASCII. This is what causes the breakage, and this is what the current ticket fixes.

Needs review.



---

archive/issue_comments_477857.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">Comment 36</div>\n\nSetting the locale to `C` causes the default guess to be wrong, but we *know* the correct encoding. And the `utf-8` encoding is available \"everywhere,\" unlike the locales that we're guessing at in your branch. Finally, changing the system locale to affect one tarfile is like setting your house on fire to stop the faucet from leaking.",
    "created_at": "2020-09-21T20:19:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477857",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:36" align="right">Comment 36</div>

Setting the locale to `C` causes the default guess to be wrong, but we *know* the correct encoding. And the `utf-8` encoding is available "everywhere," unlike the locales that we're guessing at in your branch. Finally, changing the system locale to affect one tarfile is like setting your house on fire to stop the faucet from leaking.



---

archive/issue_comments_477858.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">Comment 37</div>\n\nReplying to [@orlitzky](#comment%3A36):\n> Finally, changing the system locale to affect one tarfile is like [...]\n\nIt is very localized, and it undoes the damage done by #30053's `sage-spkg` doing exactly what you seem to be criticizing here - namely setting the system locale for all its subprocesses.",
    "created_at": "2020-09-21T20:48:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477858",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">Comment 37</div>

Replying to [@orlitzky](#comment%3A36):
> Finally, changing the system locale to affect one tarfile is like [...]

It is very localized, and it undoes the damage done by #30053's `sage-spkg` doing exactly what you seem to be criticizing here - namely setting the system locale for all its subprocesses.



---

archive/issue_comments_477859.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nReplying to [@orlitzky](#comment%3A36):\n> we *know* the correct encoding. \n\nThis is of course a good point. We can just decide that our tarballs have utf-8 pathnames.  I will test the approach with setting `tarfile.ENCODING`.\n\nNevertheless, removing the `C` locale setting in `sage-system-python` would still be good because there could be other parts that are affected by this unsuitable setting.",
    "created_at": "2020-09-21T20:59:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477859",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:38" align="right">Comment 38</div>

Replying to [@orlitzky](#comment%3A36):
> we *know* the correct encoding. 

This is of course a good point. We can just decide that our tarballs have utf-8 pathnames.  I will test the approach with setting `tarfile.ENCODING`.

Nevertheless, removing the `C` locale setting in `sage-system-python` would still be good because there could be other parts that are affected by this unsuitable setting.



---

archive/issue_events_394955.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T20:59:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394955"
}
```



---

archive/issue_events_394956.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T20:59:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394956"
}
```



---

archive/issue_comments_477860.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nAnd #30053 just put things back the way they were before we tried to switch to `C.UTF-8`. We need to set *some* locale, because otherwise the behavior of standard utilities in spkg-install and spkg-check scripts is unknowable. For example, this branch can choose the `en_US.utf8` locale. How do grep ranges work there? According to https://www.gnu.org/software/grep/manual/html_node/Character-Classes-and-Bracket-Expressions.html,\n\n> In the default C locale, the sorting sequence is the native character order; for example, \u2018[a-d]\u2019 is equivalent to \u2018[abcd]\u2019. In other locales, the sorting sequence is not specified, and \u2018[a-d]\u2019 might be equivalent to \u2018[abcd]\u2019 or to \u2018[aBbCcDd]\u2019, or it might fail to match any character, or the set of characters that it matches might even be erratic. To obtain the traditional interpretation of bracket expressions, you can use the \u2018C\u2019 locale by setting the LC_ALL environment variable to the value \u2018C\u2019.\n\nMucking with this is bad luck.",
    "created_at": "2020-09-21T21:05:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477860",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:40" align="right">Comment 40</div>

And #30053 just put things back the way they were before we tried to switch to `C.UTF-8`. We need to set *some* locale, because otherwise the behavior of standard utilities in spkg-install and spkg-check scripts is unknowable. For example, this branch can choose the `en_US.utf8` locale. How do grep ranges work there? According to https://www.gnu.org/software/grep/manual/html_node/Character-Classes-and-Bracket-Expressions.html,

> In the default C locale, the sorting sequence is the native character order; for example, ‘[a-d]’ is equivalent to ‘[abcd]’. In other locales, the sorting sequence is not specified, and ‘[a-d]’ might be equivalent to ‘[abcd]’ or to ‘[aBbCcDd]’, or it might fail to match any character, or the set of characters that it matches might even be erratic. To obtain the traditional interpretation of bracket expressions, you can use the ‘C’ locale by setting the LC_ALL environment variable to the value ‘C’.

Mucking with this is bad luck.



---

archive/issue_comments_477861.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nReplying to [@orlitzky](#comment%3A40):\n> And #30053 just put things back the way they were before we tried to switch to `C.UTF-8`.\n\nYes, it was a good change for that ticket, which is why I agreed with the change there.\n\nBut it affects the Pythons that run below it.\n(1) the `sage-system-python` - which the present ticket addresses\n(2) the python3 from which we build our venv -- which is yet to be addressed in #30576 if we want to support python 3.6.",
    "created_at": "2020-09-21T21:20:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477861",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:41" align="right">Comment 41</div>

Replying to [@orlitzky](#comment%3A40):
> And #30053 just put things back the way they were before we tried to switch to `C.UTF-8`.

Yes, it was a good change for that ticket, which is why I agreed with the change there.

But it affects the Pythons that run below it.
(1) the `sage-system-python` - which the present ticket addresses
(2) the python3 from which we build our venv -- which is yet to be addressed in #30576 if we want to support python 3.6.



---

archive/issue_comments_477862.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3\">ff0dbc6</a></td><td><code>build/sage_bootstrap/uncompress/tar_file.py: Fix encoding to utf-8</code></td></tr></table>\n",
    "created_at": "2020-09-21T21:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477862",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42" align="right">Comment 42</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3">ff0dbc6</a></td><td><code>build/sage_bootstrap/uncompress/tar_file.py: Fix encoding to utf-8</code></td></tr></table>




---

archive/issue_comments_477863.json:
```json
{
    "body": "Changed commit from **[9403629](https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2)** to **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**",
    "created_at": "2020-09-21T21:28:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477863",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9403629](https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2)** to **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**



---

archive/issue_events_394957.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T21:41:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394957"
}
```



---

archive/issue_events_394958.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T21:41:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394958"
}
```



---

archive/issue_comments_477864.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/264540655, ...** to **https://github.com/mkoeppe/sage/actions/runs/265853210, ...**",
    "created_at": "2020-09-21T21:41:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477864",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/264540655, ...** to **https://github.com/mkoeppe/sage/actions/runs/265853210, ...**



---

archive/issue_comments_477865.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/265853210, ...** to **https://github.com/mkoeppe/sage/actions/runs/265872338, ...**",
    "created_at": "2020-09-21T21:55:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477865",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/265853210, ...** to **https://github.com/mkoeppe/sage/actions/runs/265872338, ...**



---

archive/issue_comments_477866.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nNeeds review.",
    "created_at": "2020-09-22T13:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477866",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:45" align="right">Comment 45</div>

Needs review.



---

archive/issue_comments_477867.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nReplying to [@mkoeppe](#comment%3A26):\n> You probably have a better version of python in the front of the path than what is the default on Ubuntu 18.04. You can check this with `build/bin/sage-system-python --version`.\n\nI have:\n\n```\n$ build/bin/sage-system-python --version\nPython 2.7.17\n```\n\nI don't know how to properly review this ticket. With ubuntu-bionic 18.04, I do not have problem. So what I can do is to check that with the branch, I still don't have a problem. Should I do some kind of make distclean? For now, I just pulled that branch on top of freshly built beta13, and I am currently running make ptestlong. Will report later.",
    "created_at": "2020-09-22T20:05:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477867",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:46" align="right">Comment 46</div>

Replying to [@mkoeppe](#comment%3A26):
> You probably have a better version of python in the front of the path than what is the default on Ubuntu 18.04. You can check this with `build/bin/sage-system-python --version`.

I have:

```
$ build/bin/sage-system-python --version
Python 2.7.17
```

I don't know how to properly review this ticket. With ubuntu-bionic 18.04, I do not have problem. So what I can do is to check that with the branch, I still don't have a problem. Should I do some kind of make distclean? For now, I just pulled that branch on top of freshly built beta13, and I am currently running make ptestlong. Will report later.



---

archive/issue_comments_477868.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nThe tests have already run on GH Actions. It is not necessary to run them again to review this ticket.",
    "created_at": "2020-09-22T20:18:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477868",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">Comment 47</div>

The tests have already run on GH Actions. It is not necessary to run them again to review this ticket.



---

archive/issue_comments_477869.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nThe problem shows on machines where sage-system-python is python 3.x with x < 7.\n\nIt's probably not a good idea to try to uninstall python2 to review this ticket, but you could try to shadow it",
    "created_at": "2020-09-22T20:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477869",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">Comment 48</div>

The problem shows on machines where sage-system-python is python 3.x with x < 7.

It's probably not a good idea to try to uninstall python2 to review this ticket, but you could try to shadow it



---

archive/issue_comments_477870.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nReplying to [@mkoeppe](#comment%3A48):\n> you could try to shadow it \n\ntell me how to shadow, I will try that tomorrow. How can I make `sage-system-python` to use:\n\n```\n$ which python3.6\n/usr/bin/python3.6\n```\n?",
    "created_at": "2020-09-22T20:58:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477870",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:49" align="right">Comment 49</div>

Replying to [@mkoeppe](#comment%3A48):
> you could try to shadow it 

tell me how to shadow, I will try that tomorrow. How can I make `sage-system-python` to use:

```
$ which python3.6
/usr/bin/python3.6
```
?



---

archive/issue_comments_477871.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">Comment 50</div>\n\n\n```\nmkdir /somewhere && ln -s /usr/bin/python3.6 /somewhere/python \nexport PATH=/somewhere:$PATH\n```",
    "created_at": "2020-09-22T22:36:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477871",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">Comment 50</div>


```
mkdir /somewhere && ln -s /usr/bin/python3.6 /somewhere/python 
export PATH=/somewhere:$PATH
```



---

archive/issue_comments_477872.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">Comment 51</div>\n\nDoesn't the tarball commit alone fix issue without the locale voodoo?",
    "created_at": "2020-09-23T01:07:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477872",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:51" align="right">Comment 51</div>

Doesn't the tarball commit alone fix issue without the locale voodoo?



---

archive/issue_comments_477873.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">Comment 52</div>\n\nIt does fix the issue, but it is best not to pass a locale to python 3.6 that we know to break things.",
    "created_at": "2020-09-23T01:09:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477873",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:52" align="right">Comment 52</div>

It does fix the issue, but it is best not to pass a locale to python 3.6 that we know to break things.



---

archive/issue_events_394959.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-23T06:34:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394959"
}
```



---

archive/issue_events_394960.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-23T06:34:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394960"
}
```



---

archive/issue_comments_477874.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">Comment 53</div>\n\nSeems to work fine and looks good to me.",
    "created_at": "2020-09-23T06:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477874",
    "user": "https://github.com/kliem"
}
```

<div id="comment:53" align="right">Comment 53</div>

Seems to work fine and looks good to me.



---

archive/issue_comments_477875.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/265872338, ...** to **Jonathan Kliem**",
    "created_at": "2020-09-23T06:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477875",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/265872338, ...** to **Jonathan Kliem**



---

archive/issue_comments_477876.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nReplying to [@mkoeppe](#comment%3A50):\n> \n> ```\n> mkdir /somewhere && ln -s /usr/bin/python3.6 /somewhere/python \n> export PATH=/somewhere:$PATH\n> ```\n> \n\nIndeed, the above shadowing method works:\n\n```\n$ build/bin/sage-system-python --version\nPython 3.6.9\n```\nI can now reproduce the issue with Ubuntu 18.04 + 9.2.beta13 and I confirm that the current branch fixes it.",
    "created_at": "2020-09-23T10:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477876",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:54" align="right">Comment 54</div>

Replying to [@mkoeppe](#comment%3A50):
> 
> ```
> mkdir /somewhere && ln -s /usr/bin/python3.6 /somewhere/python 
> export PATH=/somewhere:$PATH
> ```
> 

Indeed, the above shadowing method works:

```
$ build/bin/sage-system-python --version
Python 3.6.9
```
I can now reproduce the issue with Ubuntu 18.04 + 9.2.beta13 and I confirm that the current branch fixes it.



---

archive/issue_comments_477877.json:
```json
{
    "body": "Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-09-23T10:03:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477877",
    "user": "https://github.com/seblabbe"
}
```

Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Sébastien Labbé**



---

archive/issue_comments_477878.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">Comment 55</div>\n\nThanks everyone!",
    "created_at": "2020-09-23T11:57:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477878",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">Comment 55</div>

Thanks everyone!



---

archive/issue_comments_477879.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_)** to **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**",
    "created_at": "2020-09-27T09:10:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30008#issuecomment-477879",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_)** to **[ff0dbc6](https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3)**



---

archive/issue_events_394961.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-27T09:10:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394961"
}
```



---

archive/issue_events_394962.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "af71febd648d698376ede3da75a6e417665da3dd",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-09-27T09:10:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30008",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30008#event-394962"
}
```
