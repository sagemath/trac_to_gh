# Issue 30167: Allow Coxeter groups implemented with coxeter3 to respect the relabelling of a CartanType

archive/issues_029930.json:
```json
{
    "body": "Currently, one cannot use a relabeled Coxeter group with `implementation=coxeter3`. e.g., this fails:\n\n```python\nctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\nW = CoxeterGroup(ctype, implementation='coxeter3')\n```\n\nand even if it didn't fail, the relabelling would not be respected.\nThis addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.\n\nNew (passing) tests have been added, and all tests in src/sage/libs/coxeter3 pass.\n\nKeywords: coxeter, coxeter3, relabel, CoxeterGroup\n\nBranch/Commit: 71616861aeb78bb6eb9f10796f9f1732e7b6036f\n\nReviewer: Travis Scrimshaw\n\nAuthor: Chase Meadors\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30167\n\n",
    "closed_at": "2020-08-07T19:05:28Z",
    "created_at": "2020-07-18T10:50:47Z",
    "labels": [
        "component: combinatorics",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Allow Coxeter groups implemented with coxeter3 to respect the relabelling of a CartanType",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30167",
    "user": "https://github.com/cemulate"
}
```
Currently, one cannot use a relabeled Coxeter group with `implementation=coxeter3`. e.g., this fails:

```python
ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
W = CoxeterGroup(ctype, implementation='coxeter3')
```

and even if it didn't fail, the relabelling would not be respected.
This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.

New (passing) tests have been added, and all tests in src/sage/libs/coxeter3 pass.

Keywords: coxeter, coxeter3, relabel, CoxeterGroup

Branch/Commit: 71616861aeb78bb6eb9f10796f9f1732e7b6036f

Reviewer: Travis Scrimshaw

Author: Chase Meadors

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30167





---

archive/issue_comments_453223.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Currently, one cannot use a relabeled Coxeter group with \\`implementation=coxeter3\\`. e.g., this fails:\n \n+\\`\\`\\`\n+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\n+W = CoxeterGroup(ctype, implementation='coxeter3')\n+\\`\\`\\`\n+\n+and even if it didn't fail, the relabelling would not be respected.\n+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-18T11:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453223",
    "user": "https://github.com/cemulate"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Currently, one cannot use a relabeled Coxeter group with \`implementation=coxeter3\`. e.g., this fails:
 
+\`\`\`
+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
+W = CoxeterGroup(ctype, implementation='coxeter3')
+\`\`\`
+
+and even if it didn't fail, the relabelling would not be respected.
+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.
 
 Comment: 1
 
```




---

archive/issue_comments_453224.json:
```json
{
    "body": "Changing keywords from \"\" to \"coxeter, coxeter3, relabel, CoxeterGroup\".",
    "created_at": "2020-07-18T11:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453224",
    "user": "https://github.com/cemulate"
}
```

Changing keywords from "" to "coxeter, coxeter3, relabel, CoxeterGroup".



---

archive/issue_comments_453225.json:
```json
{
    "body": "Changing priority from major to minor.",
    "created_at": "2020-07-18T11:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453225",
    "user": "https://github.com/cemulate"
}
```

Changing priority from major to minor.



---

archive/issue_comments_453226.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to enhancement.",
    "created_at": "2020-07-18T11:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453226",
    "user": "https://github.com/cemulate"
}
```

Changing type from PLEASE CHANGE to enhancement.



---

archive/issue_comments_453227.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to combinatorics.",
    "created_at": "2020-07-18T11:00:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453227",
    "user": "https://github.com/cemulate"
}
```

Changing component from PLEASE CHANGE to combinatorics.



---

archive/issue_comments_453228.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+Currently, one cannot use a relabeled Coxeter group with \\`implementation=coxeter3\\`. e.g., this fails:\n \n+\\`\\`\\`python\n+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\n+W = CoxeterGroup(ctype, implementation='coxeter3')\n+\\`\\`\\`\n+\n+and even if it didn't fail, the relabelling would not be respected.\n+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-18T11:01:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453228",
    "user": "https://github.com/cemulate"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+Currently, one cannot use a relabeled Coxeter group with \`implementation=coxeter3\`. e.g., this fails:
 
+\`\`\`python
+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
+W = CoxeterGroup(ctype, implementation='coxeter3')
+\`\`\`
+
+and even if it didn't fail, the relabelling would not be respected.
+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.
 
 Comment: 1
 
```




---

archive/issue_comments_453229.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Currently, one cannot use a relabeled Coxeter group with \\`implementation=coxeter3\\`. e.g., this fails:\n \n+\\`\\`\\`python\n+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\n+W = CoxeterGroup(ctype, implementation='coxeter3')\n+\\`\\`\\`\n+\n+and even if it didn't fail, the relabelling would not be respected.\n+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.\n+\n+Upon adding tests I noticed that there are quite a lot of failing tests in these files; however, the two new examples/tests I added do indeed pass.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-18T11:04:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453229",
    "user": "https://github.com/cemulate"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Currently, one cannot use a relabeled Coxeter group with \`implementation=coxeter3\`. e.g., this fails:
 
+\`\`\`python
+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
+W = CoxeterGroup(ctype, implementation='coxeter3')
+\`\`\`
+
+and even if it didn't fail, the relabelling would not be respected.
+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.
+
+Upon adding tests I noticed that there are quite a lot of failing tests in these files; however, the two new examples/tests I added do indeed pass.
 
 Comment: 1
 
```




---

archive/issue_comments_453230.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-18T11:05:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453230",
    "user": "https://github.com/cemulate"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_453231.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-18T13:49:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453231",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453232.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-27T19:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453232",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453233.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+Currently, one cannot use a relabeled Coxeter group with \\`implementation=coxeter3\\`. e.g., this fails:\n \n+\\`\\`\\`python\n+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\n+W = CoxeterGroup(ctype, implementation='coxeter3')\n+\\`\\`\\`\n+\n+and even if it didn't fail, the relabelling would not be respected.\n+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.\n+\n+New (passing) tests have been added, and all tests in src/sage/libs/coxeter3 pass.\n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-27T19:58:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453233",
    "user": "https://github.com/cemulate"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,14 @@
+Currently, one cannot use a relabeled Coxeter group with \`implementation=coxeter3\`. e.g., this fails:
 
+\`\`\`python
+ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
+W = CoxeterGroup(ctype, implementation='coxeter3')
+\`\`\`
+
+and even if it didn't fail, the relabelling would not be respected.
+This addition allows a coxeter3-implemented group to initialize successfully and respect the relabelling if one is present.
+
+New (passing) tests have been added, and all tests in src/sage/libs/coxeter3 pass.
 
 Comment: 1
 
```




---

archive/issue_comments_453234.json:
```json
{
    "body": "<a id='comment:9'></a>This will now allow twisted affine types as being valid input, which I am not sure we want.\n\nThese changes also need to be done:\n\n```\n-        Successfully initializes from a relabeled Cartan type ::\n+        Successfully initializes from a relabeled Cartan type::\n \n             sage: ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})\n-            sage: W = CoxGroup(ctype)\n-            sage: CoxeterMatrix(W.coxeter_matrix(), ctype.index_set()) == CoxeterMatrix(ctype)\n+            sage: W = CoxGroup(ctype)  # optional - coxeter3\n+            sage: CoxeterMatrix(W.coxeter_matrix(), ctype.index_set()) == CoxeterMatrix(ctype)  # optional - coxeter3\n             True\n```\nand\n\n```diff\n-            sage: CoxeterGroup(CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1}))\n+            sage: CoxeterGroup(CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1}))  # optional - coxeter3\n             Coxeter group of type ['B', 3] relabelled by {1: 3, 2: 2, 3: 1} implemented by Coxeter3\n```\n\nOther than those things, this looks good.",
    "created_at": "2020-07-28T04:50:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453234",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:9'></a>This will now allow twisted affine types as being valid input, which I am not sure we want.

These changes also need to be done:

```
-        Successfully initializes from a relabeled Cartan type ::
+        Successfully initializes from a relabeled Cartan type::
 
             sage: ctype = CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1})
-            sage: W = CoxGroup(ctype)
-            sage: CoxeterMatrix(W.coxeter_matrix(), ctype.index_set()) == CoxeterMatrix(ctype)
+            sage: W = CoxGroup(ctype)  # optional - coxeter3
+            sage: CoxeterMatrix(W.coxeter_matrix(), ctype.index_set()) == CoxeterMatrix(ctype)  # optional - coxeter3
             True
```
and

```diff
-            sage: CoxeterGroup(CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1}))
+            sage: CoxeterGroup(CartanType(['B', 3]).relabel({1: 3, 2: 2, 3: 1}))  # optional - coxeter3
             Coxeter group of type ['B', 3] relabelled by {1: 3, 2: 2, 3: 1} implemented by Coxeter3
```

Other than those things, this looks good.



---

archive/issue_comments_453235.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-28T05:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453235",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453236.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks, it seems there is `.is_untwisted_affine()` to detect that case, but some CartanTypes fail to have that method. Nevertheless, good to be explicit about disallowing it, since that's what was done before.\n\nIn the course of working with coxeter3 groups, I've discovered a few other minor bugs that come from discrepancies in the indexing of the CoxeterMatrix, that prevent coxeter3-implemented Coxeter groups from being used in certain contexts. I'll see about cleaning those up in another ticket.\n\nThanks for the comments!",
    "created_at": "2020-07-28T06:04:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453236",
    "user": "https://github.com/cemulate"
}
```

<a id='comment:11'></a>Thanks, it seems there is `.is_untwisted_affine()` to detect that case, but some CartanTypes fail to have that method. Nevertheless, good to be explicit about disallowing it, since that's what was done before.

In the course of working with coxeter3 groups, I've discovered a few other minor bugs that come from discrepancies in the indexing of the CoxeterMatrix, that prevent coxeter3-implemented Coxeter groups from being used in certain contexts. I'll see about cleaning those up in another ticket.

Thanks for the comments!



---

archive/issue_comments_453237.json:
```json
{
    "body": "<a id='comment:12'></a>You are still missing one of the doctests to mark as `# optional`. Also there should not be a bare `except:`; instead use `except AttributeError:`. Also, we follow the Python convention for error messages:\n\n```diff\n-raise NotImplementedError('Twisted affine groups are not supported in coxeter3.')\n+raise NotImplementedError('twisted affine groups are not supported in coxeter3')\n```\nAlthough in some ways twisted types only make sense for root systems and Lie algebras...but a `NotImplementedError` is (still) reasonable here.",
    "created_at": "2020-07-28T06:12:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453237",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:12'></a>You are still missing one of the doctests to mark as `# optional`. Also there should not be a bare `except:`; instead use `except AttributeError:`. Also, we follow the Python convention for error messages:

```diff
-raise NotImplementedError('Twisted affine groups are not supported in coxeter3.')
+raise NotImplementedError('twisted affine groups are not supported in coxeter3')
```
Although in some ways twisted types only make sense for root systems and Lie algebras...but a `NotImplementedError` is (still) reasonable here.



---

archive/issue_comments_453238.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-28T06:22:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453238",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453239.json:
```json
{
    "body": "<a id='comment:14'></a>Done! I'll keep that convention in mind.",
    "created_at": "2020-07-28T06:25:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453239",
    "user": "https://github.com/cemulate"
}
```

<a id='comment:14'></a>Done! I'll keep that convention in mind.



---

archive/issue_comments_453240.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-28T06:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453240",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453241.json:
```json
{
    "body": "<a id='comment:15'></a>Then let it be so.",
    "created_at": "2020-07-28T06:44:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453241",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'></a>Then let it be so.



---

archive/issue_comments_453242.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-07T19:05:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30167#issuecomment-453242",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_077803.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:05:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30167",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30167#event-77803"
}
```
