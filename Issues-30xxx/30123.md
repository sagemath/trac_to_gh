# Issue 30123: Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage

archive/issues_029886.json:
```json
{
    "assignees": [],
    "body": "As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:\n\n- https://pypi.org/project/jupyter-threejs-sage/#description\n- https://github.com/sagemath/threejs-sage/pull/1\n\nThis allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n\nsee also:\n\n- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n- #30296 System package information and `spkg-configure` for `mathjax`\n\nUser reports:\n- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n\nDepends on #30972\n\nCC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel\n\nKeywords: **sd111**\n\nBranch/Commit: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage) @ [`74ade58`](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **user interface**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30123_\n\n",
    "created_at": "2020-07-12T18:52:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/30123",
    "user": "https://github.com/mkoeppe"
}
```
As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:

- https://pypi.org/project/jupyter-threejs-sage/#description
- https://github.com/sagemath/threejs-sage/pull/1

This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.

see also:

- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
- #30296 System package information and `spkg-configure` for `mathjax`

User reports:
- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ

Depends on #30972

CC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel

Keywords: **sd111**

Branch/Commit: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage) @ [`74ade58`](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**

Author: **Matthias Koeppe**

Component: **user interface**

_Issue created by migration from https://trac.sagemath.org/ticket/30123_





---

archive/issue_events_411735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411735"
}
```



---

archive/issue_events_411736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20user%20interface",
    "label_color": "0000b0",
    "label_name": "c: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411736"
}
```



---

archive/issue_events_411737.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411737"
}
```



---

archive/issue_events_411738.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411738"
}
```



---

archive/issue_events_411739.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:57:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411739"
}
```



---

archive/issue_events_411740.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:57:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411740"
}
```



---

archive/issue_comments_476894.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nMy guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. \n\nThe code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.\n\nThis should be investigated by someone who knows about the notebook.",
    "created_at": "2020-07-13T00:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476894",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

My guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. 

The code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.

This should be investigated by someone who knows about the notebook.



---

archive/issue_comments_476895.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nAccording to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`\n\nIndeed...\n\nThat is neverthelass a bug that should be fixed.",
    "created_at": "2020-07-14T15:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476895",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:3" align="right">comment:3</div>

According to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`

Indeed...

That is neverthelass a bug that should be fixed.



---

archive/issue_comments_476896.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nNote that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)",
    "created_at": "2020-07-16T03:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476896",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)



---

archive/issue_comments_476897.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jhpalmieri](#comment%3A5):\n> Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\nLet's fix that in #30153.",
    "created_at": "2020-07-16T04:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476897",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jhpalmieri](#comment%3A5):
> Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

Let's fix that in #30153.



---

archive/issue_comments_476898.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mkoeppe](#comment%3A6):\n> Replying to [@jhpalmieri](#comment%3A5):\n> > Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\n> Let's fix that in #30153.\n\nAs of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.",
    "created_at": "2020-08-03T13:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476898",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mkoeppe](#comment%3A6):
> Replying to [@jhpalmieri](#comment%3A5):
> > Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

> Let's fix that in #30153.

As of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.



---

archive/issue_comments_476899.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nFWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:\n\n```\nlrwxrwxrwx 1 eric eric   19 ao\u00fbt   3 15:12 jsmol -> /doesnotexist/jsmol\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 mathjax -> /doesnotexist/mathjax\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 threejs -> /doesnotexist/threejs\n```\nThe `doesnotexist` directory does not look good...\nChanging manually the symbolic links to\n\n```\nlrwxrwxrwx 1 eric eric   46 ao\u00fbt   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/\n```\nfixes the Jupyter notebook issue reported in this ticket.",
    "created_at": "2020-08-03T15:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476899",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:8" align="right">comment:8</div>

FWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:

```
lrwxrwxrwx 1 eric eric   19 août   3 15:12 jsmol -> /doesnotexist/jsmol
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   21 août   3 15:12 mathjax -> /doesnotexist/mathjax
lrwxrwxrwx 1 eric eric   21 août   3 15:12 threejs -> /doesnotexist/threejs
```
The `doesnotexist` directory does not look good...
Changing manually the symbolic links to

```
lrwxrwxrwx 1 eric eric   46 août   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   48 août   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/
lrwxrwxrwx 1 eric eric   48 août   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/
```
fixes the Jupyter notebook issue reported in this ticket.



---

archive/issue_comments_476900.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks for investigating this. \n\nThis is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.\n\nThe links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. \n\nThe correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.",
    "created_at": "2020-08-03T18:16:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476900",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks for investigating this. 

This is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.

The links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. 

The correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.



---

archive/issue_comments_476901.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nIn fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?",
    "created_at": "2020-08-03T18:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476901",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

In fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?



---

archive/issue_comments_476902.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n \n-reported to have been broken by #29411\n+broken by #29411\n \n \n``````\n",
    "created_at": "2020-08-03T18:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476902",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 
-reported to have been broken by #29411
+broken by #29411
 
 
``````




---

archive/issue_events_411741.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-03T18:22:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "spkg-configure.m4 for jsmol, mathjax, threejs to fix broken Jupyter notebook",
    "title_was": "Jupyter notebook broken in 9.2.beta4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411741"
}
```



---

archive/issue_comments_476903.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nHoping that someone who knows about these javascript things will work on this ticket.",
    "created_at": "2020-08-03T18:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476903",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Hoping that someone who knows about these javascript things will work on this ticket.



---

archive/issue_comments_476904.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nfor some reason `./sage -i mathjax` rebuilds `sagelib`.",
    "created_at": "2020-08-03T18:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476904",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">comment:12</div>

for some reason `./sage -i mathjax` rebuilds `sagelib`.



---

archive/issue_comments_476905.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?",
    "created_at": "2020-08-03T23:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476905",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:13" align="right">comment:13</div>

I think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?



---

archive/issue_comments_476906.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nAs you can see in comment 8, it is called but the paths are configured wrong.",
    "created_at": "2020-08-03T23:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476906",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

As you can see in comment 8, it is called but the paths are configured wrong.



---

archive/issue_comments_476907.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nSo the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\nAs for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.",
    "created_at": "2020-08-04T01:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476907",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:15" align="right">comment:15</div>

So the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.

As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.



---

archive/issue_comments_476908.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@paulmasson](#comment%3A15):\n> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\nThe mangling happens during install, not during testing.\n\n> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\nThat's an important bit of information.\n\n> That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\nYou package it where?",
    "created_at": "2020-08-04T02:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476908",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@paulmasson](#comment%3A15):
> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.

The mangling happens during install, not during testing.

> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

That's an important bit of information.

> That's why I continue to extract the core of the library and package it here separately from the upstream repository.

You package it where?



---

archive/issue_comments_476909.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> Replying to [@paulmasson](#comment%3A15):\n> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\n> \n> You package it where?\n\nIf you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.\n\nVolker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?",
    "created_at": "2020-08-04T02:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476909",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment%3A16):
> Replying to [@paulmasson](#comment%3A15):
> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.

> 
> You package it where?

If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.

Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?



---

archive/issue_comments_476910.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@paulmasson](#comment%3A17):\n> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> \n> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\nThanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n\nSince the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1",
    "created_at": "2020-08-04T02:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476910",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@paulmasson](#comment%3A17):
> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> 
> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?

Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?

Since the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1



---

archive/issue_comments_476911.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> Replying to [@paulmasson](#comment%3A15):\n> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\nOK, but is it possible to reliably test for presence of a specific version in the system? \n\nDo you know how distribution packagers handle this? (Debian, Gentoo, ...)",
    "created_at": "2020-08-04T02:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476911",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mkoeppe](#comment%3A16):
> Replying to [@paulmasson](#comment%3A15):
> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

OK, but is it possible to reliably test for presence of a specific version in the system? 

Do you know how distribution packagers handle this? (Debian, Gentoo, ...)



---

archive/issue_comments_476912.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mkoeppe](#comment%3A18):\n> Replying to [@paulmasson](#comment%3A17):\n> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> > \n> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\n> \n> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n\nThat's precisely what I used for the last update.",
    "created_at": "2020-08-04T20:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476912",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mkoeppe](#comment%3A18):
> Replying to [@paulmasson](#comment%3A17):
> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> > 
> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?

> 
> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?

That's precisely what I used for the last update.



---

archive/issue_comments_476913.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mkoeppe](#comment%3A19):\n> Replying to [@mkoeppe](#comment%3A16):\n> > Replying to [@paulmasson](#comment%3A15):\n> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\n> \n> OK, but is it possible to reliably test for presence of a specific version in the system? \n> \n> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)\n> \n\nYou can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\nOn a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?",
    "created_at": "2020-08-04T20:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476913",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mkoeppe](#comment%3A19):
> Replying to [@mkoeppe](#comment%3A16):
> > Replying to [@paulmasson](#comment%3A15):
> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

> 
> OK, but is it possible to reliably test for presence of a specific version in the system? 
> 
> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)
> 

You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?



---

archive/issue_comments_476914.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@paulmasson](#comment%3A22):\n> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\nThanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\nand then picks specific versions of remote URLs.\n\nWhen you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?\n\nThe `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.",
    "created_at": "2020-08-04T20:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476914",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@paulmasson](#comment%3A22):
> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
and then picks specific versions of remote URLs.

When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?

The `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.



---

archive/issue_comments_476915.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThe standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).",
    "created_at": "2020-08-04T20:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476915",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).



---

archive/issue_comments_476916.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@mkoeppe](#comment%3A24):\n> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\nIn many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\nThe only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.",
    "created_at": "2020-08-04T21:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476916",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@mkoeppe](#comment%3A24):
> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).

In many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.

The only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.



---

archive/issue_comments_476917.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment%3A23):\n> Replying to [@paulmasson](#comment%3A22):\n> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> \n> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> and then picks specific versions of remote URLs.\n> \n> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\nI only change threejs.",
    "created_at": "2020-08-04T21:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476917",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment%3A23):
> Replying to [@paulmasson](#comment%3A22):
> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> 
> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> and then picks specific versions of remote URLs.
> 
> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

I only change threejs.



---

archive/issue_comments_476918.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@paulmasson](#comment%3A26):\n> Replying to [@mkoeppe](#comment%3A23):\n> > Replying to [@paulmasson](#comment%3A22):\n> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > \n> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > and then picks specific versions of remote URLs.\n> > \n> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> I only change threejs.\n\nOK. To summarize, `THREEJS_DIR` is used at least twice:\n(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\nDo both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\n \nAlso, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\nIs https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?",
    "created_at": "2020-08-04T21:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476918",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@paulmasson](#comment%3A26):
> Replying to [@mkoeppe](#comment%3A23):
> > Replying to [@paulmasson](#comment%3A22):
> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > 
> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > and then picks specific versions of remote URLs.
> > 
> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> I only change threejs.

OK. To summarize, `THREEJS_DIR` is used at least twice:
(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

 
Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?



---

archive/issue_comments_476919.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@kiwifb](#comment%3A25):\n> Replying to [@mkoeppe](#comment%3A24):\n> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\n> \n> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\nIn gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?",
    "created_at": "2020-08-04T21:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476919",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@kiwifb](#comment%3A25):
> Replying to [@mkoeppe](#comment%3A24):
> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).

> 
> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.

In gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?



---

archive/issue_comments_476920.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@mkoeppe](#comment%3A27):\n> Replying to [@paulmasson](#comment%3A26):\n> > Replying to [@mkoeppe](#comment%3A23):\n> > > Replying to [@paulmasson](#comment%3A22):\n> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > > \n> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > > and then picks specific versions of remote URLs.\n> > > \n> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> > I only change threejs.\n\n> \n> OK. To summarize, `THREEJS_DIR` is used at least twice:\n> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\n> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\nSince there is only one Three.js template, they must both point to the same version.  \n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n> \n\npythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.",
    "created_at": "2020-08-04T21:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476920",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@mkoeppe](#comment%3A27):
> Replying to [@paulmasson](#comment%3A26):
> > Replying to [@mkoeppe](#comment%3A23):
> > > Replying to [@paulmasson](#comment%3A22):
> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > > 
> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > > and then picks specific versions of remote URLs.
> > > 
> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> > I only change threejs.

> 
> OK. To summarize, `THREEJS_DIR` is used at least twice:
> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

Since there is only one Three.js template, they must both point to the same version.  
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?
> 

pythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.



---

archive/issue_comments_476921.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIn Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  \n\nThis bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.\n\nIt is quite an achievement that we have come down to these three little things, it used to be much more complex.",
    "created_at": "2020-08-04T21:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476921",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

In Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  

This bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.

It is quite an achievement that we have come down to these three little things, it used to be much more complex.



---

archive/issue_comments_476922.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAnd I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).",
    "created_at": "2020-08-04T21:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476922",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">comment:31</div>

And I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).



---

archive/issue_comments_476923.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@paulmasson](#comment%3A29):\n> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.\n\nYes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)\n\nhttps://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html\n\nI'll be happy to help with the packaging.\n\n\nThis would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.",
    "created_at": "2020-08-04T22:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476923",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@paulmasson](#comment%3A29):
> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.

Yes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)

https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html

I'll be happy to help with the packaging.


This would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.



---

archive/issue_comments_476924.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nThe package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter",
    "created_at": "2020-08-05T01:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476924",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">comment:33</div>

The package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter



---

archive/issue_comments_476925.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n broken by #29411\n \n-\n+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n``````\n",
    "created_at": "2020-08-05T17:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476925",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 broken by #29411
 
-
+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
``````




---

archive/issue_comments_476926.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nWhat's the situation with `jsmol`?",
    "created_at": "2020-08-05T18:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476926",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

What's the situation with `jsmol`?



---

archive/issue_comments_476927.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,7 @@\n \n broken by #29411\n \n-see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+see also:\n+\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and `spkg-configure` for `mathjax`\n``````\n",
    "created_at": "2020-08-05T20:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476927",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,7 @@
 
 broken by #29411
 
-see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+see also:
+
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and `spkg-configure` for `mathjax`
``````




---

archive/issue_events_411742.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-05T20:31:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package jupyter-threejs-minimal",
    "title_was": "spkg-configure.m4 for jsmol, mathjax, threejs to fix broken Jupyter notebook",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411742"
}
```



---

archive/issue_comments_476928.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nSince the repackage still needs to ship with Sage to make the viewer function, this isn\u2019t going to solve the notebook problem.",
    "created_at": "2020-08-05T23:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476928",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:38" align="right">comment:38</div>

Since the repackage still needs to ship with Sage to make the viewer function, this isn’t going to solve the notebook problem.



---

archive/issue_comments_476929.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nBy itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.",
    "created_at": "2020-08-06T00:02:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476929",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

By itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.



---

archive/issue_events_411743.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-06T01:00:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411743"
}
```



---

archive/issue_events_411744.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-06T01:00:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411744"
}
```



---

archive/issue_comments_476930.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nI'll fix the notebook in #30298, but this ticket here remains relevant.",
    "created_at": "2020-08-06T01:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476930",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

I'll fix the notebook in #30298, but this ticket here remains relevant.



---

archive/issue_comments_476931.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ\n\n---\n.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... \n\nFortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:\n\n`c.NotebookApp.extra_static_paths = [\"/path/to/extra/static/files\"]`\n\nI guess that with some changes mainly replacing \"/nbextensions\" to \"/static\",  sage 3d and interact outputs all would work fine.\n \n....",
    "created_at": "2020-08-06T08:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476931",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:41" align="right">comment:41</div>

I don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ

---
.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... 

Fortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:

`c.NotebookApp.extra_static_paths = ["/path/to/extra/static/files"]`

I guess that with some changes mainly replacing "/nbextensions" to "/static",  sage 3d and interact outputs all would work fine.
 
....



---

archive/issue_comments_476932.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nBut would that work for users who want to run Sage as a remote kernel?",
    "created_at": "2020-08-06T11:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476932",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

But would that work for users who want to run Sage as a remote kernel?



---

archive/issue_comments_476933.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@mkoeppe](#comment%3A42):\n> But would that work for users who want to run Sage as a remote kernel?\n\nI have no precise idea about \"Sage remote kernel\". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.",
    "created_at": "2020-08-07T01:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476933",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@mkoeppe](#comment%3A42):
> But would that work for users who want to run Sage as a remote kernel?

I have no precise idea about "Sage remote kernel". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.



---

archive/issue_comments_476934.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThe thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n\n```\n$ jupyter nbextension list\nKnown nbextensions:\n  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n    notebook section\n      jupyter-js-widgets/extension  enabled \n      - Validating: OK\n```\nIt does not have such a facility for random static files.",
    "created_at": "2020-08-07T02:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476934",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:

```
$ jupyter nbextension list
Known nbextensions:
  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
    notebook section
      jupyter-js-widgets/extension  enabled 
      - Validating: OK
```
It does not have such a facility for random static files.



---

archive/issue_comments_476935.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@mkoeppe](#comment%3A44):\n> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n> \n> ```\n> $ jupyter nbextension list\n> Known nbextensions:\n>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n>     notebook section\n>       jupyter-js-widgets/extension  enabled \n>       - Validating: OK\n> ```\n> It does not have such a facility for random static files.\n\nDo you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.",
    "created_at": "2020-08-07T02:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476935",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@mkoeppe](#comment%3A44):
> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:
> 
> ```
> $ jupyter nbextension list
> Known nbextensions:
>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
>     notebook section
>       jupyter-js-widgets/extension  enabled 
>       - Validating: OK
> ```
> It does not have such a facility for random static files.

Do you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.



---

archive/issue_comments_476936.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nThat's right, they are not properly installed as nbextensions. My point is that they should.",
    "created_at": "2020-08-07T03:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476936",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

That's right, they are not properly installed as nbextensions. My point is that they should.



---

archive/issue_comments_476937.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nReplying to [@mkoeppe](#comment%3A46):\n> That's right, they are not properly installed as nbextensions. My point is that they should.\n\nand my point is that they should not :-) but I am not sure...",
    "created_at": "2020-08-07T07:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476937",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:47" align="right">comment:47</div>

Replying to [@mkoeppe](#comment%3A46):
> That's right, they are not properly installed as nbextensions. My point is that they should.

and my point is that they should not :-) but I am not sure...



---

archive/issue_comments_476938.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@mkoeppe](#comment%3A35):\n> What's the situation with `jsmol`?\n\nI have opened #30315 for jsmol",
    "created_at": "2020-08-07T18:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476938",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@mkoeppe](#comment%3A35):
> What's the situation with `jsmol`?

I have opened #30315 for jsmol



---

archive/issue_comments_476939.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nhttps://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need",
    "created_at": "2020-08-09T03:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476939",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

https://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need



---

archive/issue_events_411745.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-15T14:30:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-minimal",
    "title_was": "Repackage Sage's cropped threejs as a pip-installable package jupyter-threejs-minimal",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411745"
}
```



---

archive/issue_events_411746.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T17:02:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411746"
}
```



---

archive/issue_events_411747.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T17:02:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411747"
}
```



---

archive/issue_events_411748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-28T04:01:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage",
    "title_was": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-minimal",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411748"
}
```



---

archive/issue_comments_476940.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,9 @@\n-https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.\n \n-broken by #29411\n+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n \n see also:\n \n+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n - #30296 System package information and `spkg-configure` for `mathjax`\n``````\n",
    "created_at": "2020-11-28T04:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476940",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,9 @@
-https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.
 
-broken by #29411
+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
 
 see also:
 
+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
 - #30296 System package information and `spkg-configure` for `mathjax`
``````




---

archive/issue_comments_476941.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nThis is now \nhttps://github.com/sagemath/threejs-sage/pull/1/files",
    "created_at": "2020-11-29T02:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476941",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

This is now 
https://github.com/sagemath/threejs-sage/pull/1/files



---

archive/issue_comments_476942.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-11-29T02:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476942",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_476943.json:
```json
{
    "body": "Dependencies: **#30972**",
    "created_at": "2020-11-29T02:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476943",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30972**



---

archive/issue_comments_476944.json:
```json
{
    "body": "Branch: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage)**",
    "created_at": "2020-11-29T03:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476944",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage)**



---

archive/issue_events_411749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T03:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411749"
}
```



---

archive/issue_comments_476945.json:
```json
{
    "body": "Commit: **[`500de1a`](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)**",
    "created_at": "2020-11-29T03:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476945",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`500de1a`](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)**



---

archive/issue_comments_476946.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b\"><code>5e1ca4e</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66\"><code>938bff4</code></a></td><td><code>Read required threejs version from ext_data</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab\"><code>f847738</code></a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6\"><code>d13177d</code></a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2\"><code>47e795b</code></a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f74a7d8a4ea72b6744b68cd51e024ed378f314ae\"><code>f74a7d8</code></a></td><td><code>Merge branch 't/30972/versioned_installation_of_threejs' into t/30123/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11693bebfd408452e72b4c61327ee43654cc1300\"><code>11693be</code></a></td><td><code>build/pkgs/threejs: Switch to pip-installable package jupyter-threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7faf40dc3cfea55c5543a175f351a671278e3b6a\"><code>7faf40d</code></a></td><td><code>build/pkgs/sage_conf: No longer define THREEJS_DIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08dbf216c480bf29d035bd8f13a5d07cfd07167\"><code>d08dbf2</code></a></td><td><code>sage.env: Get THREEJS_DIR from jupyter_threejs_sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd\"><code>500de1a</code></a></td><td><code>sage.repl.ipython_kernel.install: No longer symlink THREEJS_DIR into nbextensions</code></td></tr></table>\n",
    "created_at": "2020-11-29T03:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476946",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b"><code>5e1ca4e</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66"><code>938bff4</code></a></td><td><code>Read required threejs version from ext_data</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab"><code>f847738</code></a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6"><code>d13177d</code></a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2"><code>47e795b</code></a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f74a7d8a4ea72b6744b68cd51e024ed378f314ae"><code>f74a7d8</code></a></td><td><code>Merge branch 't/30972/versioned_installation_of_threejs' into t/30123/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11693bebfd408452e72b4c61327ee43654cc1300"><code>11693be</code></a></td><td><code>build/pkgs/threejs: Switch to pip-installable package jupyter-threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7faf40dc3cfea55c5543a175f351a671278e3b6a"><code>7faf40d</code></a></td><td><code>build/pkgs/sage_conf: No longer define THREEJS_DIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08dbf216c480bf29d035bd8f13a5d07cfd07167"><code>d08dbf2</code></a></td><td><code>sage.env: Get THREEJS_DIR from jupyter_threejs_sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd"><code>500de1a</code></a></td><td><code>sage.repl.ipython_kernel.install: No longer symlink THREEJS_DIR into nbextensions</code></td></tr></table>




---

archive/issue_comments_476947.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n-As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:\n+\n+- https://pypi.org/project/jupyter-threejs-sage/#description\n+- https://github.com/sagemath/threejs-sage/pull/1\n \n This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n \n``````\n",
    "created_at": "2020-11-29T03:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476947",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
-As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:
+
+- https://pypi.org/project/jupyter-threejs-sage/#description
+- https://github.com/sagemath/threejs-sage/pull/1
 
 This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
 
``````




---

archive/issue_comments_476948.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b\"><code>74ade58</code></a></td><td><code>build/pkgs/threejs/install-requires.txt: New</code></td></tr></table>\n",
    "created_at": "2020-11-29T03:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476948",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b"><code>74ade58</code></a></td><td><code>build/pkgs/threejs/install-requires.txt: New</code></td></tr></table>




---

archive/issue_comments_476949.json:
```json
{
    "body": "Changed commit from **[`500de1a`](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)** to **[`74ade58`](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**",
    "created_at": "2020-11-29T03:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476949",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`500de1a`](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)** to **[`74ade58`](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**



---

archive/issue_comments_476950.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nInput from downstream packagers would be very welcome",
    "created_at": "2020-11-29T20:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476950",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">comment:60</div>

Input from downstream packagers would be very welcome



---

archive/issue_comments_476951.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nCan we avoid the `b1` stuff in the future? What is it even indicating.",
    "created_at": "2020-11-29T21:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476951",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:61" align="right">comment:61</div>

Can we avoid the `b1` stuff in the future? What is it even indicating.



---

archive/issue_comments_476952.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nSo it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.\n\nThe branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)",
    "created_at": "2020-11-29T21:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476952",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">comment:62</div>

So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.

The branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)



---

archive/issue_comments_476953.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nReplying to [@kiwifb](#comment%3A61):\n> Can we avoid the `b1` stuff in the future? What is it even indicating.\n\nThat's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers",
    "created_at": "2020-11-29T21:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476953",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">comment:63</div>

Replying to [@kiwifb](#comment%3A61):
> Can we avoid the `b1` stuff in the future? What is it even indicating.

That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers



---

archive/issue_comments_476954.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nReplying to [@kiwifb](#comment%3A62):\n> So it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. \n\nThat's right, same behavior as `widgetsnbextension`",
    "created_at": "2020-11-29T21:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476954",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

Replying to [@kiwifb](#comment%3A62):
> So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. 

That's right, same behavior as `widgetsnbextension`



---

archive/issue_comments_476955.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> Replying to [@kiwifb](#comment%3A61):\n> > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\nCan't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).",
    "created_at": "2020-11-29T21:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476955",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:65" align="right">comment:65</div>

Replying to [@mkoeppe](#comment%3A63):
> Replying to [@kiwifb](#comment%3A61):
> > Can we avoid the `b1` stuff in the future? What is it even indicating.

> That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).



---

archive/issue_comments_476956.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nReplying to [@mkoeppe](#comment%3A60):\n> Input from downstream packagers would be very welcome\n\nTested with the Arch package, everything works. +1 from me.",
    "created_at": "2020-11-29T21:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476956",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:66" align="right">comment:66</div>

Replying to [@mkoeppe](#comment%3A60):
> Input from downstream packagers would be very welcome

Tested with the Arch package, everything works. +1 from me.



---

archive/issue_comments_476957.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nReplying to [@kiwifb](#comment%3A65):\n> Replying to [@mkoeppe](#comment%3A63):\n> > Replying to [@kiwifb](#comment%3A61):\n> > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\n> \n> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\nHopefully we can quickly proceed to an actual release so that this problem will go away.",
    "created_at": "2020-11-29T22:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476957",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

Replying to [@kiwifb](#comment%3A65):
> Replying to [@mkoeppe](#comment%3A63):
> > Replying to [@kiwifb](#comment%3A61):
> > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

> 
> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 

Hopefully we can quickly proceed to an actual release so that this problem will go away.



---

archive/issue_comments_476958.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nReplying to [@mkoeppe](#comment%3A67):\n> Replying to [@kiwifb](#comment%3A65):\n> > Replying to [@mkoeppe](#comment%3A63):\n> > > Replying to [@kiwifb](#comment%3A61):\n> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\n> > \n> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\n> \n> Hopefully we can quickly proceed to an actual release so that this problem will go away.\n> \n\nThat's just venting. I can, and did, work around that.",
    "created_at": "2020-11-29T22:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476958",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:68" align="right">comment:68</div>

Replying to [@mkoeppe](#comment%3A67):
> Replying to [@kiwifb](#comment%3A65):
> > Replying to [@mkoeppe](#comment%3A63):
> > > Replying to [@kiwifb](#comment%3A61):
> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

> > 
> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 

> 
> Hopefully we can quickly proceed to an actual release so that this problem will go away.
> 

That's just venting. I can, and did, work around that.



---

archive/issue_comments_476959.json:
```json
{
    "body": "Changed keywords from none to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476959",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **sd111**



---

archive/issue_comments_476960.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476960",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">comment:69</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_events_411750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411750"
}
```



---

archive/issue_events_411751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411751"
}
```



---

archive/issue_comments_476961.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,6 @@\n - https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n - #30296 System package information and `spkg-configure` for `mathjax`\n+\n+User reports:\n+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n``````\n",
    "created_at": "2021-06-19T19:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476961",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,6 @@
 - https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
 - #30296 System package information and `spkg-configure` for `mathjax`
+
+User reports:
+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ
``````




---

archive/issue_events_411752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-19T19:53:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411752"
}
```



---

archive/issue_events_411753.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-19T19:53:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411753"
}
```



---

archive/issue_comments_476962.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">comment:72</div>\n\nplease rebase",
    "created_at": "2021-06-21T15:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476962",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">comment:72</div>

please rebase



---

archive/issue_comments_476963.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">comment:73</div>\n\nReplying to [@mkoeppe](#comment%3A27):\n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n\nAs it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3",
    "created_at": "2021-06-22T01:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476963",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">comment:73</div>

Replying to [@mkoeppe](#comment%3A27):
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?

As it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3



---

archive/issue_events_411754.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-22T01:12:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411754"
}
```



---

archive/issue_events_411755.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-22T01:12:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411755"
}
```



---

archive/issue_comments_476964.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">comment:75</div>\n\nOpened #32070 (Add package pythreejs 2.3.0).",
    "created_at": "2021-06-27T21:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476964",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:75" align="right">comment:75</div>

Opened #32070 (Add package pythreejs 2.3.0).



---

archive/issue_comments_476965.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-476965",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_411756.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411756"
}
```



---

archive/issue_events_411757.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411757"
}
```



---

archive/issue_events_411758.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411758"
}
```



---

archive/issue_events_411759.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411759"
}
```



---

archive/issue_events_411760.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411760"
}
```



---

archive/issue_events_411761.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411761"
}
```



---

archive/issue_events_411762.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411762"
}
```



---

archive/issue_events_411763.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411763"
}
```



---

archive/issue_events_411764.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411764"
}
```



---

archive/issue_events_411765.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-411765"
}
```
