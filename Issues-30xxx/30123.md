# Issue 30123: Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage

archive/issues_029886.json:
```json
{
    "body": "As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:\n\n- https://pypi.org/project/jupyter-threejs-sage/#description\n- https://github.com/sagemath/threejs-sage/pull/1\n\nThis allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n\nsee also:\n\n- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n- #30296 System package information and `spkg-configure` for `mathjax`\n\nUser reports:\n- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n\nCC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel\n\nKeywords: sd111\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage\n\nStatus: needs_work\n\nDependencies: #30972\n\nCommit: 74ade58efbe5f07f683e622928c45d2c12bda87b\n\nIssue created by migration from https://trac.sagemath.org/ticket/30123\n\n",
    "created_at": "2020-07-12T18:52:02Z",
    "labels": [
        "component: user interface",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30123",
    "user": "https://github.com/mkoeppe"
}
```
As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:

- https://pypi.org/project/jupyter-threejs-sage/#description
- https://github.com/sagemath/threejs-sage/pull/1

This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.

see also:

- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
- #30296 System package information and `spkg-configure` for `mathjax`

User reports:
- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ

CC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel

Keywords: sd111

Author: Matthias Koeppe

Branch: u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage

Status: needs_work

Dependencies: #30972

Commit: 74ade58efbe5f07f683e622928c45d2c12bda87b

Issue created by migration from https://trac.sagemath.org/ticket/30123





---

archive/issue_comments_452587.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2020-07-12T18:57:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452587",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_452588.json:
```json
{
    "body": "<a id='comment:2'></a>My guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. \n\nThe code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.\n\nThis should be investigated by someone who knows about the notebook.",
    "created_at": "2020-07-13T00:22:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452588",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>My guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. 

The code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.

This should be investigated by someone who knows about the notebook.



---

archive/issue_comments_452589.json:
```json
{
    "body": "<a id='comment:3'></a>According to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`\n\nIndeed...\n\nThat is neverthelass a bug that should be fixed.",
    "created_at": "2020-07-14T15:16:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452589",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<a id='comment:3'></a>According to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`

Indeed...

That is neverthelass a bug that should be fixed.



---

archive/issue_comments_452590.json:
```json
{
    "body": "<a id='comment:5'></a>Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)",
    "created_at": "2020-07-16T03:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452590",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)



---

archive/issue_comments_452591.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:5 jhpalmieri]:\n> Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\nLet's fix that in #30153.",
    "created_at": "2020-07-16T04:48:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452591",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Replying to [comment:5 jhpalmieri]:
> Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

Let's fix that in #30153.



---

archive/issue_comments_452592.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:6 mkoeppe]:\n> Replying to [comment:5 jhpalmieri]:\n> > Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\n> Let's fix that in #30153.\n\nAs of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.",
    "created_at": "2020-08-03T13:23:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452592",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>Replying to [comment:6 mkoeppe]:
> Replying to [comment:5 jhpalmieri]:
> > Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

> Let's fix that in #30153.

As of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.



---

archive/issue_comments_452593.json:
```json
{
    "body": "<a id='comment:8'></a>FWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:\n\n```\nlrwxrwxrwx 1 eric eric   19 ao\u00fbt   3 15:12 jsmol -> /doesnotexist/jsmol\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 mathjax -> /doesnotexist/mathjax\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 threejs -> /doesnotexist/threejs\n```\nThe `doesnotexist` directory does not look good...\nChanging manually the symbolic links to\n\n```\nlrwxrwxrwx 1 eric eric   46 ao\u00fbt   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/\n```\nfixes the Jupyter notebook issue reported in this ticket.",
    "created_at": "2020-08-03T15:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452593",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:8'></a>FWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:

```
lrwxrwxrwx 1 eric eric   19 août   3 15:12 jsmol -> /doesnotexist/jsmol
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   21 août   3 15:12 mathjax -> /doesnotexist/mathjax
lrwxrwxrwx 1 eric eric   21 août   3 15:12 threejs -> /doesnotexist/threejs
```
The `doesnotexist` directory does not look good...
Changing manually the symbolic links to

```
lrwxrwxrwx 1 eric eric   46 août   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   48 août   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/
lrwxrwxrwx 1 eric eric   48 août   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/
```
fixes the Jupyter notebook issue reported in this ticket.



---

archive/issue_comments_452594.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for investigating this. \n\nThis is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.\n\nThe links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. \n\nThe correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.",
    "created_at": "2020-08-03T18:16:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452594",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Thanks for investigating this. 

This is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.

The links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. 

The correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.



---

archive/issue_comments_452595.json:
```json
{
    "body": "<a id='comment:10'></a>In fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?",
    "created_at": "2020-08-03T18:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452595",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>In fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?



---

archive/issue_comments_452596.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n \n-reported to have been broken by #29411\n+broken by #29411\n+\n+\n \n Priority: major\n \n```\n",
    "created_at": "2020-08-03T18:22:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452596",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,6 +1,8 @@
 https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 
-reported to have been broken by #29411
+broken by #29411
+
+
 
 Priority: major
 
```




---

archive/issue_comments_452597.json:
```json
{
    "body": "<a id='comment:11'></a>Hoping that someone who knows about these javascript things will work on this ticket.",
    "created_at": "2020-08-03T18:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452597",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Hoping that someone who knows about these javascript things will work on this ticket.



---

archive/issue_comments_452598.json:
```json
{
    "body": "<a id='comment:12'></a>for some reason `./sage -i mathjax` rebuilds `sagelib`.",
    "created_at": "2020-08-03T18:52:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452598",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>for some reason `./sage -i mathjax` rebuilds `sagelib`.



---

archive/issue_comments_452599.json:
```json
{
    "body": "<a id='comment:13'></a>I think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?",
    "created_at": "2020-08-03T23:40:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452599",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:13'></a>I think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?



---

archive/issue_comments_452600.json:
```json
{
    "body": "<a id='comment:14'></a>As you can see in comment 8, it is called but the paths are configured wrong.",
    "created_at": "2020-08-03T23:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452600",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>As you can see in comment 8, it is called but the paths are configured wrong.



---

archive/issue_comments_452601.json:
```json
{
    "body": "<a id='comment:15'></a>So the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\nAs for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.",
    "created_at": "2020-08-04T01:33:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452601",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:15'></a>So the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.

As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.



---

archive/issue_comments_452602.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 paulmasson]:\n> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\n\nThe mangling happens during install, not during testing.\n\n> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\n\nThat's an important bit of information.\n\n> That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\n\nYou package it where?",
    "created_at": "2020-08-04T02:14:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452602",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:15 paulmasson]:
> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.


The mangling happens during install, not during testing.

> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 


That's an important bit of information.

> That's why I continue to extract the core of the library and package it here separately from the upstream repository.


You package it where?



---

archive/issue_comments_452603.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:16 mkoeppe]:\n> Replying to [comment:15 paulmasson]:\n> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\n> \n> You package it where?\n\nIf you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.\n\nVolker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?",
    "created_at": "2020-08-04T02:38:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452603",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:17'></a>Replying to [comment:16 mkoeppe]:
> Replying to [comment:15 paulmasson]:
> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.

> 
> You package it where?

If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.

Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?



---

archive/issue_comments_452604.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:17 paulmasson]:\n> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> \n> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\n\nThanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n\nSince the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1",
    "created_at": "2020-08-04T02:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452604",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Replying to [comment:17 paulmasson]:
> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> 
> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?


Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?

Since the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1



---

archive/issue_comments_452605.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:16 mkoeppe]:\n> Replying to [comment:15 paulmasson]:\n> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\n\nOK, but is it possible to reliably test for presence of a specific version in the system? \n\nDo you know how distribution packagers handle this? (Debian, Gentoo, ...)",
    "created_at": "2020-08-04T02:54:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452605",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Replying to [comment:16 mkoeppe]:
> Replying to [comment:15 paulmasson]:
> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 


OK, but is it possible to reliably test for presence of a specific version in the system? 

Do you know how distribution packagers handle this? (Debian, Gentoo, ...)



---

archive/issue_comments_452606.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:18 mkoeppe]:\n> Replying to [comment:17 paulmasson]:\n> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> > \n> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\n> \n> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n  \nThat's precisely what I used for the last update.",
    "created_at": "2020-08-04T20:05:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452606",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:21'></a>Replying to [comment:18 mkoeppe]:
> Replying to [comment:17 paulmasson]:
> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> > 
> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?

> 
> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?
  
That's precisely what I used for the last update.



---

archive/issue_comments_452607.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:19 mkoeppe]:\n> Replying to [comment:16 mkoeppe]:\n> > Replying to [comment:15 paulmasson]:\n> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\n> \n> OK, but is it possible to reliably test for presence of a specific version in the system? \n> \n> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)\n> \n\nYou can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\nOn a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?",
    "created_at": "2020-08-04T20:10:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452607",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:22'></a>Replying to [comment:19 mkoeppe]:
> Replying to [comment:16 mkoeppe]:
> > Replying to [comment:15 paulmasson]:
> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

> 
> OK, but is it possible to reliably test for presence of a specific version in the system? 
> 
> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)
> 

You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?



---

archive/issue_comments_452608.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:22 paulmasson]:\n> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n\nThanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\nand then picks specific versions of remote URLs.\n\nWhen you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?\n\n\nThe `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.",
    "created_at": "2020-08-04T20:21:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452608",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Replying to [comment:22 paulmasson]:
> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.


Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
and then picks specific versions of remote URLs.

When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?


The `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.



---

archive/issue_comments_452609.json:
```json
{
    "body": "<a id='comment:24'></a>The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).",
    "created_at": "2020-08-04T20:34:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452609",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).



---

archive/issue_comments_452610.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:\n> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\n\nIn many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\nThe only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.",
    "created_at": "2020-08-04T21:00:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452610",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:25'></a>Replying to [comment:24 mkoeppe]:
> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).


In many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.

The only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.



---

archive/issue_comments_452611.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:23 mkoeppe]:\n> Replying to [comment:22 paulmasson]:\n> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> \n> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> and then picks specific versions of remote URLs.\n> \n> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\nI only change threejs.",
    "created_at": "2020-08-04T21:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452611",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:26'></a>Replying to [comment:23 mkoeppe]:
> Replying to [comment:22 paulmasson]:
> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> 
> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> and then picks specific versions of remote URLs.
> 
> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

I only change threejs.



---

archive/issue_comments_452612.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 paulmasson]:\n> Replying to [comment:23 mkoeppe]:\n> > Replying to [comment:22 paulmasson]:\n> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > \n> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > and then picks specific versions of remote URLs.\n> > \n> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> I only change threejs.\n\nOK. To summarize, `THREEJS_DIR` is used at least twice:\n(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\nDo both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\n \nAlso, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\nIs https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?",
    "created_at": "2020-08-04T21:31:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452612",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:26 paulmasson]:
> Replying to [comment:23 mkoeppe]:
> > Replying to [comment:22 paulmasson]:
> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > 
> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > and then picks specific versions of remote URLs.
> > 
> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> I only change threejs.

OK. To summarize, `THREEJS_DIR` is used at least twice:
(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

 
Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?



---

archive/issue_comments_452613.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:25 fbissey]:\n> Replying to [comment:24 mkoeppe]:\n> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\n> \n> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\n\nIn gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?",
    "created_at": "2020-08-04T21:36:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452613",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Replying to [comment:25 fbissey]:
> Replying to [comment:24 mkoeppe]:
> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).

> 
> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.


In gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?



---

archive/issue_comments_452614.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:27 mkoeppe]:\n> Replying to [comment:26 paulmasson]:\n> > Replying to [comment:23 mkoeppe]:\n> > > Replying to [comment:22 paulmasson]:\n> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > > \n> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > > and then picks specific versions of remote URLs.\n> > > \n> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> > I only change threejs.\n> \n> OK. To summarize, `THREEJS_DIR` is used at least twice:\n> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\n> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\nSince there is only one Three.js template, they must both point to the same version.  \n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n> \n\npythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.",
    "created_at": "2020-08-04T21:48:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452614",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:29'></a>Replying to [comment:27 mkoeppe]:
> Replying to [comment:26 paulmasson]:
> > Replying to [comment:23 mkoeppe]:
> > > Replying to [comment:22 paulmasson]:
> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > > 
> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > > and then picks specific versions of remote URLs.
> > > 
> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> > I only change threejs.
> 
> OK. To summarize, `THREEJS_DIR` is used at least twice:
> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

Since there is only one Three.js template, they must both point to the same version.  
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?
> 

pythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.



---

archive/issue_comments_452615.json:
```json
{
    "body": "<a id='comment:30'></a>In Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  \n\nThis bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.\n\nIt is quite an achievement that we have come down to these three little things, it used to be much more complex.",
    "created_at": "2020-08-04T21:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452615",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:30'></a>In Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  

This bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.

It is quite an achievement that we have come down to these three little things, it used to be much more complex.



---

archive/issue_comments_452616.json:
```json
{
    "body": "<a id='comment:31'></a>And I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).",
    "created_at": "2020-08-04T21:57:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452616",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:31'></a>And I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).



---

archive/issue_comments_452617.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:29 paulmasson]:\n> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.\n\n\nYes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)\n\nhttps://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html\n\nI'll be happy to help with the packaging.\n\n\nThis would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.",
    "created_at": "2020-08-04T22:30:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452617",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Replying to [comment:29 paulmasson]:
> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.


Yes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)

https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html

I'll be happy to help with the packaging.


This would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.



---

archive/issue_comments_452618.json:
```json
{
    "body": "<a id='comment:33'></a>The package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter",
    "created_at": "2020-08-05T01:15:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452618",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>The package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter



---

archive/issue_comments_452619.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,8 @@\n+https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n \n+broken by #29411\n+\n+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n \n Priority: major\n \n```\n",
    "created_at": "2020-08-05T17:35:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452619",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,8 @@
+https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 
+broken by #29411
+
+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
 
 Priority: major
 
```




---

archive/issue_comments_452620.json:
```json
{
    "body": "<a id='comment:35'></a>What's the situation with `jsmol`?",
    "created_at": "2020-08-05T18:10:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>What's the situation with `jsmol`?



---

archive/issue_comments_452621.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n \n+broken by #29411\n+\n+see also:\n+\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and \\`spkg-configure\\` for \\`mathjax\\`\n \n Priority: major\n \n```\n",
    "created_at": "2020-08-05T20:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452621",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,11 @@
+https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 
+broken by #29411
+
+see also:
+
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and \`spkg-configure\` for \`mathjax\`
 
 Priority: major
 
```




---

archive/issue_comments_452622.json:
```json
{
    "body": "<a id='comment:38'></a>Since the repackage still needs to ship with Sage to make the viewer function, this isn\u2019t going to solve the notebook problem.",
    "created_at": "2020-08-05T23:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452622",
    "user": "https://github.com/paulmasson"
}
```

<a id='comment:38'></a>Since the repackage still needs to ship with Sage to make the viewer function, this isn’t going to solve the notebook problem.



---

archive/issue_comments_452623.json:
```json
{
    "body": "<a id='comment:39'></a>By itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.",
    "created_at": "2020-08-06T00:02:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452623",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>By itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.



---

archive/issue_comments_452624.json:
```json
{
    "body": "<a id='comment:40'></a>I'll fix the notebook in #30298, but this ticket here remains relevant.",
    "created_at": "2020-08-06T01:00:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452624",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>I'll fix the notebook in #30298, but this ticket here remains relevant.



---

archive/issue_comments_452625.json:
```json
{
    "body": "<a id='comment:41'></a>I don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ\n\n---\n.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... \n\nFortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:\n\n`c.NotebookApp.extra_static_paths = [\"/path/to/extra/static/files\"]`\n\nI guess that with some changes mainly replacing \"/nbextensions\" to \"/static\",  sage 3d and interact outputs all would work fine.\n \n....",
    "created_at": "2020-08-06T08:41:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452625",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:41'></a>I don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ

---
.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... 

Fortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:

`c.NotebookApp.extra_static_paths = ["/path/to/extra/static/files"]`

I guess that with some changes mainly replacing "/nbextensions" to "/static",  sage 3d and interact outputs all would work fine.
 
....



---

archive/issue_comments_452626.json:
```json
{
    "body": "<a id='comment:42'></a>But would that work for users who want to run Sage as a remote kernel?",
    "created_at": "2020-08-06T11:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452626",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>But would that work for users who want to run Sage as a remote kernel?



---

archive/issue_comments_452627.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:42 mkoeppe]:\n> But would that work for users who want to run Sage as a remote kernel?\n\n\nI have no precise idea about \"Sage remote kernel\". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.",
    "created_at": "2020-08-07T01:43:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452627",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:43'></a>Replying to [comment:42 mkoeppe]:
> But would that work for users who want to run Sage as a remote kernel?


I have no precise idea about "Sage remote kernel". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.



---

archive/issue_comments_452628.json:
```json
{
    "body": "<a id='comment:44'></a>The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n\n```\n$ jupyter nbextension list\nKnown nbextensions:\n  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n    notebook section\n      jupyter-js-widgets/extension  enabled \n      - Validating: OK\n```\nIt does not have such a facility for random static files.",
    "created_at": "2020-08-07T02:06:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452628",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:

```
$ jupyter nbextension list
Known nbextensions:
  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
    notebook section
      jupyter-js-widgets/extension  enabled 
      - Validating: OK
```
It does not have such a facility for random static files.



---

archive/issue_comments_452629.json:
```json
{
    "body": "<a id='comment:45'></a>Replying to [comment:44 mkoeppe]:\n> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n> \n> ```\n> $ jupyter nbextension list\n> Known nbextensions:\n>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n>     notebook section\n>       jupyter-js-widgets/extension  enabled \n>       - Validating: OK\n> ```\n> It does not have such a facility for random static files.\n\n\nDo you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.",
    "created_at": "2020-08-07T02:31:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452629",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:45'></a>Replying to [comment:44 mkoeppe]:
> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:
> 
> ```
> $ jupyter nbextension list
> Known nbextensions:
>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
>     notebook section
>       jupyter-js-widgets/extension  enabled 
>       - Validating: OK
> ```
> It does not have such a facility for random static files.


Do you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.



---

archive/issue_comments_452630.json:
```json
{
    "body": "<a id='comment:46'></a>That's right, they are not properly installed as nbextensions. My point is that they should.",
    "created_at": "2020-08-07T03:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452630",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>That's right, they are not properly installed as nbextensions. My point is that they should.



---

archive/issue_comments_452631.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:46 mkoeppe]:\n> That's right, they are not properly installed as nbextensions. My point is that they should.\n\n\nand my point is that they should not :-) but I am not sure...",
    "created_at": "2020-08-07T07:51:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452631",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:47'></a>Replying to [comment:46 mkoeppe]:
> That's right, they are not properly installed as nbextensions. My point is that they should.


and my point is that they should not :-) but I am not sure...



---

archive/issue_comments_452632.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:35 mkoeppe]:\n> What's the situation with `jsmol`?\n\n\nI have opened #30315 for jsmol",
    "created_at": "2020-08-07T18:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452632",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Replying to [comment:35 mkoeppe]:
> What's the situation with `jsmol`?


I have opened #30315 for jsmol



---

archive/issue_comments_452633.json:
```json
{
    "body": "<a id='comment:49'></a>https://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need",
    "created_at": "2020-08-09T03:36:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452633",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>https://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need



---

archive/issue_events_077616.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T17:02:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77616"
}
```



---

archive/issue_comments_452634.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \\`threejs-sage\\` offline script available to a Jupyter notebook.\n \n+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n+\n+see also:\n+\n+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and \\`spkg-configure\\` for \\`mathjax\\`\n \n Priority: major\n \n```\n",
    "created_at": "2020-11-28T04:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452634",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,12 @@
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \`threejs-sage\` offline script available to a Jupyter notebook.
 
+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
+
+see also:
+
+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and \`spkg-configure\` for \`mathjax\`
 
 Priority: major
 
```




---

archive/issue_comments_452635.json:
```json
{
    "body": "<a id='comment:54'></a>This is now \nhttps://github.com/sagemath/threejs-sage/pull/1/files",
    "created_at": "2020-11-29T02:52:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452635",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>This is now 
https://github.com/sagemath/threejs-sage/pull/1/files



---

archive/issue_comments_452636.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-29T03:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452636",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_452637.json:
```json
{
    "body": "<a id='comment:57'></a>Last 10 new commits:",
    "created_at": "2020-11-29T03:47:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452637",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:57'></a>Last 10 new commits:



---

archive/issue_comments_452638.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,15 @@\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \\`threejs-sage\\` offline script available to a Jupyter notebook:\n \n+- https://pypi.org/project/jupyter-threejs-sage/#description\n+- https://github.com/sagemath/threejs-sage/pull/1\n+\n+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n+\n+see also:\n+\n+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and \\`spkg-configure\\` for \\`mathjax\\`\n \n Priority: major\n \n```\n",
    "created_at": "2020-11-29T03:49:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452638",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,15 @@
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \`threejs-sage\` offline script available to a Jupyter notebook:
 
+- https://pypi.org/project/jupyter-threejs-sage/#description
+- https://github.com/sagemath/threejs-sage/pull/1
+
+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
+
+see also:
+
+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and \`spkg-configure\` for \`mathjax\`
 
 Priority: major
 
```




---

archive/issue_comments_452639.json:
```json
{
    "body": "<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-29T03:55:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452639",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:59'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_452640.json:
```json
{
    "body": "<a id='comment:60'></a>Input from downstream packagers would be very welcome",
    "created_at": "2020-11-29T20:10:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452640",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Input from downstream packagers would be very welcome



---

archive/issue_comments_452641.json:
```json
{
    "body": "<a id='comment:61'></a>Can we avoid the `b1` stuff in the future? What is it even indicating.",
    "created_at": "2020-11-29T21:25:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452641",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:61'></a>Can we avoid the `b1` stuff in the future? What is it even indicating.



---

archive/issue_comments_452642.json:
```json
{
    "body": "<a id='comment:62'></a>So it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.\n\nThe branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)",
    "created_at": "2020-11-29T21:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452642",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:62'></a>So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.

The branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)



---

archive/issue_comments_452643.json:
```json
{
    "body": "<a id='comment:63'></a>Replying to [comment:61 fbissey]:\n> Can we avoid the `b1` stuff in the future? What is it even indicating.\n\nThat's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers",
    "created_at": "2020-11-29T21:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452643",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:63'></a>Replying to [comment:61 fbissey]:
> Can we avoid the `b1` stuff in the future? What is it even indicating.

That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers



---

archive/issue_comments_452644.json:
```json
{
    "body": "<a id='comment:64'></a>Replying to [comment:62 fbissey]:\n> So it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. \n\nThat's right, same behavior as `widgetsnbextension`",
    "created_at": "2020-11-29T21:38:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452644",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:64'></a>Replying to [comment:62 fbissey]:
> So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. 

That's right, same behavior as `widgetsnbextension`



---

archive/issue_comments_452645.json:
```json
{
    "body": "<a id='comment:65'></a>Replying to [comment:63 mkoeppe]:\n> Replying to [comment:61 fbissey]:\n> > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\nCan't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).",
    "created_at": "2020-11-29T21:46:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452645",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:65'></a>Replying to [comment:63 mkoeppe]:
> Replying to [comment:61 fbissey]:
> > Can we avoid the `b1` stuff in the future? What is it even indicating.

> That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).



---

archive/issue_comments_452646.json:
```json
{
    "body": "<a id='comment:66'></a>Replying to [comment:60 mkoeppe]:\n> Input from downstream packagers would be very welcome\n\n\nTested with the Arch package, everything works. +1 from me.",
    "created_at": "2020-11-29T21:55:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452646",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:66'></a>Replying to [comment:60 mkoeppe]:
> Input from downstream packagers would be very welcome


Tested with the Arch package, everything works. +1 from me.



---

archive/issue_comments_452647.json:
```json
{
    "body": "<a id='comment:67'></a>Replying to [comment:65 fbissey]:\n> Replying to [comment:63 mkoeppe]:\n> > Replying to [comment:61 fbissey]:\n> > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n> \n> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\n\nHopefully we can quickly proceed to an actual release so that this problem will go away.",
    "created_at": "2020-11-29T22:12:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452647",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:67'></a>Replying to [comment:65 fbissey]:
> Replying to [comment:63 mkoeppe]:
> > Replying to [comment:61 fbissey]:
> > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers
> 
> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 


Hopefully we can quickly proceed to an actual release so that this problem will go away.



---

archive/issue_comments_452648.json:
```json
{
    "body": "<a id='comment:68'></a>Replying to [comment:67 mkoeppe]:\n> Replying to [comment:65 fbissey]:\n> > Replying to [comment:63 mkoeppe]:\n> > > Replying to [comment:61 fbissey]:\n> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n> > \n> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\n> \n> Hopefully we can quickly proceed to an actual release so that this problem will go away.\n> \n\n\nThat's just venting. I can, and did, work around that.",
    "created_at": "2020-11-29T22:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452648",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:68'></a>Replying to [comment:67 mkoeppe]:
> Replying to [comment:65 fbissey]:
> > Replying to [comment:63 mkoeppe]:
> > > Replying to [comment:61 fbissey]:
> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers
> > 
> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 

> 
> Hopefully we can quickly proceed to an actual release so that this problem will go away.
> 


That's just venting. I can, and did, work around that.



---

archive/issue_comments_452649.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452649",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_452650.json:
```json
{
    "body": "<a id='comment:69'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452650",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_events_077617.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77617"
}
```



---

archive/issue_events_077618.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77618"
}
```



---

archive/issue_comments_452651.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,18 @@\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \\`threejs-sage\\` offline script available to a Jupyter notebook:\n \n+- https://pypi.org/project/jupyter-threejs-sage/#description\n+- https://github.com/sagemath/threejs-sage/pull/1\n+\n+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n+\n+see also:\n+\n+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and \\`spkg-configure\\` for \\`mathjax\\`\n+\n+User reports:\n+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n \n Priority: major\n \n```\n",
    "created_at": "2021-06-19T19:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452651",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,18 @@
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the \`threejs-sage\` offline script available to a Jupyter notebook:
 
+- https://pypi.org/project/jupyter-threejs-sage/#description
+- https://github.com/sagemath/threejs-sage/pull/1
+
+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
+
+see also:
+
+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and \`spkg-configure\` for \`mathjax\`
+
+User reports:
+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ
 
 Priority: major
 
```




---

archive/issue_comments_452652.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-06-19T19:53:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452652",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_452653.json:
```json
{
    "body": "<a id='comment:72'></a>please rebase",
    "created_at": "2021-06-21T15:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452653",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:72'></a>please rebase



---

archive/issue_comments_452654.json:
```json
{
    "body": "<a id='comment:73'></a>Replying to [comment:27 mkoeppe]:\n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n\n\nAs it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3",
    "created_at": "2021-06-22T01:12:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452654",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:73'></a>Replying to [comment:27 mkoeppe]:
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?


As it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3



---

archive/issue_comments_452655.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-06-22T01:12:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452655",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_452656.json:
```json
{
    "body": "<a id='comment:75'></a>Opened #32070 (Add package pythreejs 2.3.0).",
    "created_at": "2021-06-27T21:32:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452656",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>Opened #32070 (Add package pythreejs 2.3.0).



---

archive/issue_comments_452657.json:
```json
{
    "body": "<a id='comment:76'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30123#issuecomment-452657",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_077619.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77619"
}
```



---

archive/issue_events_077620.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77620"
}
```



---

archive/issue_events_077621.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77621"
}
```



---

archive/issue_events_077622.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77622"
}
```



---

archive/issue_events_077623.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77623"
}
```



---

archive/issue_events_077624.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77624"
}
```



---

archive/issue_events_077625.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77625"
}
```



---

archive/issue_events_077626.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30123",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30123#event-77626"
}
```
