# Issue 30123: Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage

archive/issues_029886.json:
```json
{
    "assignees": [],
    "body": "As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:\n\n- https://pypi.org/project/jupyter-threejs-sage/#description\n- https://github.com/sagemath/threejs-sage/pull/1\n\nThis allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n\nsee also:\n\n- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n- #30296 System package information and `spkg-configure` for `mathjax`\n\nUser reports:\n- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n\nDepends on #30972\n\nCC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel\n\nKeywords: **sd111**\n\nBranch/Commit: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage) @ [74ade58](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30123_\n\n",
    "created_at": "2020-07-12T18:52:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
        "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20work"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/30123",
    "user": "https://github.com/mkoeppe"
}
```
As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:

- https://pypi.org/project/jupyter-threejs-sage/#description
- https://github.com/sagemath/threejs-sage/pull/1

This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.

see also:

- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
- #30296 System package information and `spkg-configure` for `mathjax`

User reports:
- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ

Depends on #30972

CC:  @dimpase @kliem @paulmasson @jcamp0x2a @nbruin @slel @mjungmath @orlitzky @kiwifb @antonio-rojas @mwageringel

Keywords: **sd111**

Branch/Commit: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage) @ [74ade58](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/30123_





---

archive/issue_events_396568.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396568"
}
```



---

archive/issue_events_396569.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20user%20interface",
    "label_color": "000080",
    "label_name": "component: user interface",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396569"
}
```



---

archive/issue_events_396570.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396570"
}
```



---

archive/issue_events_396571.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:52:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396571"
}
```



---

archive/issue_events_396572.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:57:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396572"
}
```



---

archive/issue_events_396573.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:57:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396573"
}
```



---

archive/issue_comments_479947.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">Comment 2</div>\n\nMy guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. \n\nThe code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.\n\nThis should be investigated by someone who knows about the notebook.",
    "created_at": "2020-07-13T00:22:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479947",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">Comment 2</div>

My guess is that the new install script `build/pkgs/sagelib/spkg-install` poisons environment variables too aggressively. 

The code that installs the Jupyter kernel has moved recently to `src/sage_setup/command/sage_install.py`.

This should be investigated by someone who knows about the notebook.



---

archive/issue_comments_479948.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nAccording to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`\n\nIndeed...\n\nThat is neverthelass a bug that should be fixed.",
    "created_at": "2020-07-14T15:16:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479948",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:3" align="right">Comment 3</div>

According to [Dima Pasechnik](https://groups.google.com/d/msg/sage-release/YbmWbOStP_4/osMbpWxPBwAJ), this can be fixed by `sage -b`

Indeed...

That is neverthelass a bug that should be fixed.



---

archive/issue_comments_479949.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nNote that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)",
    "created_at": "2020-07-16T03:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479949",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">Comment 5</div>

Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)



---

archive/issue_comments_479950.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nReplying to [@jhpalmieri](#comment%3A5):\n> Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\nLet's fix that in #30153.",
    "created_at": "2020-07-16T04:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479950",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

Replying to [@jhpalmieri](#comment%3A5):
> Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

Let's fix that in #30153.



---

archive/issue_comments_479951.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nReplying to [@mkoeppe](#comment%3A6):\n> Replying to [@jhpalmieri](#comment%3A5):\n> > Note that `sage -b` doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\n> Let's fix that in #30153.\n\nAs of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.",
    "created_at": "2020-08-03T13:23:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479951",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:7" align="right">Comment 7</div>

Replying to [@mkoeppe](#comment%3A6):
> Replying to [@jhpalmieri](#comment%3A5):
> > Note that `sage -b` doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)

> Let's fix that in #30153.

As of Sage 9.2.beta7 (which includes #30153), `sage -b` does no longer work to fix the Jupyter issue.



---

archive/issue_comments_479952.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nFWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:\n\n```\nlrwxrwxrwx 1 eric eric   19 ao\u00fbt   3 15:12 jsmol -> /doesnotexist/jsmol\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 mathjax -> /doesnotexist/mathjax\nlrwxrwxrwx 1 eric eric   21 ao\u00fbt   3 15:12 threejs -> /doesnotexist/threejs\n```\nThe `doesnotexist` directory does not look good...\nChanging manually the symbolic links to\n\n```\nlrwxrwxrwx 1 eric eric   46 ao\u00fbt   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/\ndrwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/\nlrwxrwxrwx 1 eric eric   48 ao\u00fbt   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/\n```\nfixes the Jupyter notebook issue reported in this ticket.",
    "created_at": "2020-08-03T15:47:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479952",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:8" align="right">Comment 8</div>

FWIW, here is the content of `SAGE_ROOT/local/share/jupyter/nbextensions` with Sage 9.2.beta7:

```
lrwxrwxrwx 1 eric eric   19 août   3 15:12 jsmol -> /doesnotexist/jsmol
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   21 août   3 15:12 mathjax -> /doesnotexist/mathjax
lrwxrwxrwx 1 eric eric   21 août   3 15:12 threejs -> /doesnotexist/threejs
```
The `doesnotexist` directory does not look good...
Changing manually the symbolic links to

```
lrwxrwxrwx 1 eric eric   46 août   3 17:40 jsmol -> /home/eric/sage/9.2.develop/local/share/jsmol/
drwxr-xr-x 2 eric eric 4096 mai   30 17:52 jupyter-js-widgets
lrwxrwxrwx 1 eric eric   48 août   3 17:40 mathjax -> /home/eric/sage/9.2.develop/local/share/mathjax/
lrwxrwxrwx 1 eric eric   48 août   3 17:40 threejs -> /home/eric/sage/9.2.develop/local/share/threejs/
```
fixes the Jupyter notebook issue reported in this ticket.



---

archive/issue_comments_479953.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nThanks for investigating this. \n\nThis is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.\n\nThe links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. \n\nThe correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.",
    "created_at": "2020-08-03T18:16:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479953",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">Comment 9</div>

Thanks for investigating this. 

This is, as I thought, due to the poisoning of environment variables in the script `build/pkgs/sagelib/spkg-install`.

The links that created here seem to assume that `jsmol`, `mathjax`, and `threejs` are installed in `SAGE_LOCAL`. 

The correct fix is to create `spkg-configure.m4` scripts for these packages so that equivalent system packages can be used -- and to use specific directory variables for determining the targets for these symlinks.



---

archive/issue_comments_479954.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nIn fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?",
    "created_at": "2020-08-03T18:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479954",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">Comment 10</div>

In fact, it seems strange that the sagelib installation script would even install these links. Shouldn't the install script of `mathjax` install its symlink?



---

archive/issue_comments_479955.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n \n-reported to have been broken by #29411\n+broken by #29411\n \n \n``````\n",
    "created_at": "2020-08-03T18:22:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479955",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 
-reported to have been broken by #29411
+broken by #29411
 
 
``````




---

archive/issue_events_396574.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-03T18:22:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "spkg-configure.m4 for jsmol, mathjax, threejs to fix broken Jupyter notebook",
    "title_was": "Jupyter notebook broken in 9.2.beta4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396574"
}
```



---

archive/issue_comments_479956.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nHoping that someone who knows about these javascript things will work on this ticket.",
    "created_at": "2020-08-03T18:23:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479956",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">Comment 11</div>

Hoping that someone who knows about these javascript things will work on this ticket.



---

archive/issue_comments_479957.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nfor some reason `./sage -i mathjax` rebuilds `sagelib`.",
    "created_at": "2020-08-03T18:52:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479957",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:12" align="right">Comment 12</div>

for some reason `./sage -i mathjax` rebuilds `sagelib`.



---

archive/issue_comments_479958.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nI think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?",
    "created_at": "2020-08-03T23:40:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479958",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:13" align="right">Comment 13</div>

I think this ticket is moving in the wrong direction. The issue is not with the installation of JavaScript packages, it is that they all expect a link to `nbextensions` to exist. There is an entire [install](https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py) file for Jupyter that sets up the environment for JavaScript packages by a call to its `update` method. Is this method no longer being called after installing the notebook?



---

archive/issue_comments_479959.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nAs you can see in comment 8, it is called but the paths are configured wrong.",
    "created_at": "2020-08-03T23:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479959",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">Comment 14</div>

As you can see in comment 8, it is called but the paths are configured wrong.



---

archive/issue_comments_479960.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nSo the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\nAs for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.",
    "created_at": "2020-08-04T01:33:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479960",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:15" align="right">Comment 15</div>

So the notebook doesn't work because of an explicit mangling of environment variables. Why can't you just unmangle the appropriate directory so that notebook setup works? Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.

As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. That's why I continue to extract the core of the library and package it here separately from the upstream repository.



---

archive/issue_comments_479961.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@paulmasson](#comment%3A15):\n> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.\n\nThe mangling happens during install, not during testing.\n\n> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\nThat's an important bit of information.\n\n> That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\nYou package it where?",
    "created_at": "2020-08-04T02:14:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479961",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@paulmasson](#comment%3A15):
> Oddly enough all of the tests in `src/sage/repl/ipython_kernel/install.py` pass despite the mangling.

The mangling happens during install, not during testing.

> As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

That's an important bit of information.

> That's why I continue to extract the core of the library and package it here separately from the upstream repository.

You package it where?



---

archive/issue_comments_479962.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> Replying to [@paulmasson](#comment%3A15):\n> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.\n\n> \n> You package it where?\n\nIf you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.\n\nVolker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?",
    "created_at": "2020-08-04T02:38:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479962",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:17" align="right">Comment 17</div>

Replying to [@mkoeppe](#comment%3A16):
> Replying to [@paulmasson](#comment%3A15):
> > That's why I continue to extract the core of the library and package it here separately from the upstream repository.

> 
> You package it where?

If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. I've been doing that since I started the viewer, at first just to avoid downloading the full library. There is however a change coming in the new year, in which one of the two critical files we use will officially be removed from the library. That will necessitate either continuing the current process or modifying a local copy of the full library, a process over which we would not be guaranteed control.

Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?



---

archive/issue_comments_479963.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nReplying to [@paulmasson](#comment%3A17):\n> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> \n> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\nThanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n\nSince the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1",
    "created_at": "2020-08-04T02:53:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479963",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">Comment 18</div>

Replying to [@paulmasson](#comment%3A17):
> If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> 
> Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?

Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?

Since the 9.1 cycle we have a better mechanism for tickets that upgrade spkgs. See https://wiki.sagemath.org/ReleaseTours/sage-9.1#For_developers-1



---

archive/issue_comments_479964.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> Replying to [@paulmasson](#comment%3A15):\n> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\nOK, but is it possible to reliably test for presence of a specific version in the system? \n\nDo you know how distribution packagers handle this? (Debian, Gentoo, ...)",
    "created_at": "2020-08-04T02:54:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479964",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@mkoeppe](#comment%3A16):
> Replying to [@paulmasson](#comment%3A15):
> > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

OK, but is it possible to reliably test for presence of a specific version in the system? 

Do you know how distribution packagers handle this? (Debian, Gentoo, ...)



---

archive/issue_comments_479965.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nReplying to [@mkoeppe](#comment%3A18):\n> Replying to [@paulmasson](#comment%3A17):\n> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]\n> > \n> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?\n\n> \n> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?\n\nThat's precisely what I used for the last update.",
    "created_at": "2020-08-04T20:05:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479965",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:21" align="right">Comment 21</div>

Replying to [@mkoeppe](#comment%3A18):
> Replying to [@paulmasson](#comment%3A17):
> > If you look at the upgrade tickets, like #29809, I always attach a zip file containing a small portion of the full library. [...]
> > 
> > Volker has been moving my zip files to the mirrors manually. Do you know if that is also the process for libraries with upstream links?

> 
> Thanks. I am looking at `build/pkgs/threejs`. Is the `spkg-src` script current? Is this what you actually use to generate archives?

That's precisely what I used for the last update.



---

archive/issue_comments_479966.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">Comment 22</div>\n\nReplying to [@mkoeppe](#comment%3A19):\n> Replying to [@mkoeppe](#comment%3A16):\n> > Replying to [@paulmasson](#comment%3A15):\n> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. \n\n> \n> OK, but is it possible to reliably test for presence of a specific version in the system? \n> \n> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)\n> \n\nYou can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\nOn a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?",
    "created_at": "2020-08-04T20:10:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479966",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:22" align="right">Comment 22</div>

Replying to [@mkoeppe](#comment%3A19):
> Replying to [@mkoeppe](#comment%3A16):
> > Replying to [@paulmasson](#comment%3A15):
> > > As for using a system Three.js I would definitely advise against that. Mr.doob very often makes changes that are NOT backward compatible. The template that renders Three.js is version dependent: you can't just switch to a newer version and expect it to work. 

> 
> OK, but is it possible to reliably test for presence of a specific version in the system? 
> 
> Do you know how distribution packagers handle this? (Debian, Gentoo, ...)
> 

You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?



---

archive/issue_comments_479967.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">Comment 23</div>\n\nReplying to [@paulmasson](#comment%3A22):\n> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\nThanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\nand then picks specific versions of remote URLs.\n\nWhen you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?\n\nThe `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.",
    "created_at": "2020-08-04T20:21:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479967",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">Comment 23</div>

Replying to [@paulmasson](#comment%3A22):
> You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
and then picks specific versions of remote URLs.

When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> On a more general note, what if a user installs a newer package of any sort that creates conflicts with Sage? Do you then force installation of the version needed by Sage?

The `spkg-configure` mechanism of the Sage distribution inspects installed system packages.  We either test for particular features of a library/program, or for a range of versions. For example, currently we accept python3 version 3.6.x and 3.7.x but nothing older nor newer.  Whenever a package is found to be installed but not suitable, the Sage distribution installs its own copy.



---

archive/issue_comments_479968.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nThe standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).",
    "created_at": "2020-08-04T20:34:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479968",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">Comment 24</div>

The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).



---

archive/issue_comments_479969.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">Comment 25</div>\n\nReplying to [@mkoeppe](#comment%3A24):\n> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\nIn many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\nThe only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.",
    "created_at": "2020-08-04T21:00:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479969",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:25" align="right">Comment 25</div>

Replying to [@mkoeppe](#comment%3A24):
> The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).

In many ways `jupyter nbextension` is for personal install - which I guess is OK for vanilla sage. But I don't really know if it is designed well enough to be handled properly by a bona fide package management system.

The only real example I have on top of my head is `widgetsnbextension` and it uses regular distutils to install the extension.



---

archive/issue_comments_479970.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">Comment 26</div>\n\nReplying to [@mkoeppe](#comment%3A23):\n> Replying to [@paulmasson](#comment%3A22):\n> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> \n> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> and then picks specific versions of remote URLs.\n> \n> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\nI only change threejs.",
    "created_at": "2020-08-04T21:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479970",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:26" align="right">Comment 26</div>

Replying to [@mkoeppe](#comment%3A23):
> Replying to [@paulmasson](#comment%3A22):
> > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> 
> Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> and then picks specific versions of remote URLs.
> 
> When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

I only change threejs.



---

archive/issue_comments_479971.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">Comment 27</div>\n\nReplying to [@paulmasson](#comment%3A26):\n> Replying to [@mkoeppe](#comment%3A23):\n> > Replying to [@paulmasson](#comment%3A22):\n> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > \n> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > and then picks specific versions of remote URLs.\n> > \n> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> I only change threejs.\n\nOK. To summarize, `THREEJS_DIR` is used at least twice:\n(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\nDo both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\n \nAlso, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\nIs https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?",
    "created_at": "2020-08-04T21:31:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479971",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">Comment 27</div>

Replying to [@paulmasson](#comment%3A26):
> Replying to [@mkoeppe](#comment%3A23):
> > Replying to [@paulmasson](#comment%3A22):
> > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > 
> > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > and then picks specific versions of remote URLs.
> > 
> > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> I only change threejs.

OK. To summarize, `THREEJS_DIR` is used at least twice:
(1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
(2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

 
Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?



---

archive/issue_comments_479972.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">Comment 28</div>\n\nReplying to [@kiwifb](#comment%3A25):\n> Replying to [@mkoeppe](#comment%3A24):\n> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).\n\n> \n> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.\n\nIn gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?",
    "created_at": "2020-08-04T21:36:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479972",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">Comment 28</div>

Replying to [@kiwifb](#comment%3A25):
> Replying to [@mkoeppe](#comment%3A24):
> > The standard way to install notebook extensions seems to be using `jupyter nbextension`. I think we may want to use this (instead of the custom code in `sage.repl.ipython_kernel.install`).

> 
> [...] I don't really know if it is designed well enough to be handled properly by a bona fide package management system.

In gentoo, are you able to use the `sage.repl.ipython_kernel.install` during packaging, or are you using a custom script for this?



---

archive/issue_comments_479973.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">Comment 29</div>\n\nReplying to [@mkoeppe](#comment%3A27):\n> Replying to [@paulmasson](#comment%3A26):\n> > Replying to [@mkoeppe](#comment%3A23):\n> > > Replying to [@paulmasson](#comment%3A22):\n> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.\n\n> > > \n> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)\n> > > and then picks specific versions of remote URLs.\n> > > \n> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? \n\n> > I only change threejs.\n\n> \n> OK. To summarize, `THREEJS_DIR` is used at least twice:\n> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.\n> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.\n> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?\n\nSince there is only one Three.js template, they must both point to the same version.  \n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n> \n\npythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.",
    "created_at": "2020-08-04T21:48:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479973",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:29" align="right">Comment 29</div>

Replying to [@mkoeppe](#comment%3A27):
> Replying to [@paulmasson](#comment%3A26):
> > Replying to [@mkoeppe](#comment%3A23):
> > > Replying to [@paulmasson](#comment%3A22):
> > > > You can search for  a REVISION string as is done [here](https://github.com/sagemath/sage/blob/develop/src/sage/repl/rich_output/display_manager.py#L750). This code was written to ditch `installed_packages` to help package managers.

> > > 
> > > Thanks. So this looks at a local installation (located via the `THREEJS_DIR` variable)
> > > and then picks specific versions of remote URLs.
> > > 
> > > When you make updates, do you make simultaneous changes to both sagelib and to the threejs spkg? 

> > I only change threejs.

> 
> OK. To summarize, `THREEJS_DIR` is used at least twice:
> (1) during installation of sagelib, to determine symlinks that will be placed in the `nbextensions` folder.
> (2) during runtime of sagelib, to determine the threejs version to get certain remote URLs right.
> Do both of them have to point to the same installation (same version) for things to work, or are they two separate, independent uses?

Since there is only one Three.js template, they must both point to the same version.  
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?
> 

pythreejs is just a port of Three.js to python, so not relevant: one needs to get the actual JavaScript files. I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.



---

archive/issue_comments_479974.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">Comment 30</div>\n\nIn Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  \n\nThis bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.\n\nIt is quite an achievement that we have come down to these three little things, it used to be much more complex.",
    "created_at": "2020-08-04T21:55:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479974",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">Comment 30</div>

In Gentoo I disable `instance._symlink_resources()` in the `update` method (this is all in `sage/repl/ipython_kernel/install.py` so it is not run. I do these manually from the ebuild.  

This bit only creates links to three things, two icons and the documentation. I mainly do them manually because I want relative links instead of absolute links and it is quite possible that at the time it is normally executed things would end up pointing to the wrong places - which would be the real killer out of the two.

It is quite an achievement that we have come down to these three little things, it used to be much more complex.



---

archive/issue_comments_479975.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">Comment 31</div>\n\nAnd I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).",
    "created_at": "2020-08-04T21:57:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479975",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:31" align="right">Comment 31</div>

And I should add those three links are going in the sage kernel location not in `nbextensions`. The nbextensions are put in the exact right place (absolute links but we can't always have everything).



---

archive/issue_comments_479976.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">Comment 32</div>\n\nReplying to [@paulmasson](#comment%3A29):\n> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.\n\nYes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)\n\nhttps://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html\n\nI'll be happy to help with the packaging.\n\n\nThis would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.",
    "created_at": "2020-08-04T22:30:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479976",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">Comment 32</div>

Replying to [@paulmasson](#comment%3A29):
> I don't know much about pip, but if you just mean taking my small portion of the Three.js library and delivering it some way other than through Sage, then that is certainly possible.

Yes, that's what I mean. Basically making it available on https://pypi.org/ so that users can install it with `pip`. (The Sage distribution would still ship a copy of it.)

https://jupyter-notebook.readthedocs.io/en/stable/examples/Notebook/Distributing%20Jupyter%20Extensions%20as%20Python%20Packages.html

I'll be happy to help with the packaging.


This would be a good step in the direction of plugging Sage (which is installed into its own venv) into a system Jupyter installation.



---

archive/issue_comments_479977.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">Comment 33</div>\n\nThe package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter",
    "created_at": "2020-08-05T01:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479977",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:33" align="right">Comment 33</div>

The package could be called `jupyter-threejs-minimal` or something like this. See https://pypi.org/search/?q=jupyter



---

archive/issue_comments_479978.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n broken by #29411\n \n-\n+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n``````\n",
    "created_at": "2020-08-05T17:35:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479978",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 broken by #29411
 
-
+see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
``````




---

archive/issue_comments_479979.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">Comment 35</div>\n\nWhat's the situation with `jsmol`?",
    "created_at": "2020-08-05T18:10:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479979",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">Comment 35</div>

What's the situation with `jsmol`?



---

archive/issue_comments_479980.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,7 @@\n \n broken by #29411\n \n-see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+see also:\n+\n+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n+- #30296 System package information and `spkg-configure` for `mathjax`\n``````\n",
    "created_at": "2020-08-05T20:30:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479980",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,7 @@
 
 broken by #29411
 
-see also https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+see also:
+
+-  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
+- #30296 System package information and `spkg-configure` for `mathjax`
``````




---

archive/issue_events_396575.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-05T20:31:52Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package jupyter-threejs-minimal",
    "title_was": "spkg-configure.m4 for jsmol, mathjax, threejs to fix broken Jupyter notebook",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396575"
}
```



---

archive/issue_comments_479981.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">Comment 38</div>\n\nSince the repackage still needs to ship with Sage to make the viewer function, this isn\u2019t going to solve the notebook problem.",
    "created_at": "2020-08-05T23:55:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479981",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:38" align="right">Comment 38</div>

Since the repackage still needs to ship with Sage to make the viewer function, this isn’t going to solve the notebook problem.



---

archive/issue_comments_479982.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">Comment 39</div>\n\nBy itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.",
    "created_at": "2020-08-06T00:02:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479982",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">Comment 39</div>

By itself, no, but it's part of the solution. I cc'd you on #30124, which is another part of the puzzle.



---

archive/issue_events_396576.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-06T01:00:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396576"
}
```



---

archive/issue_events_396577.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-06T01:00:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396577"
}
```



---

archive/issue_comments_479983.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">Comment 40</div>\n\nI'll fix the notebook in #30298, but this ticket here remains relevant.",
    "created_at": "2020-08-06T01:00:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479983",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">Comment 40</div>

I'll fix the notebook in #30298, but this ticket here remains relevant.



---

archive/issue_comments_479984.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">Comment 41</div>\n\nI don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ\n\n---\n.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... \n\nFortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:\n\n`c.NotebookApp.extra_static_paths = [\"/path/to/extra/static/files\"]`\n\nI guess that with some changes mainly replacing \"/nbextensions\" to \"/static\",  sage 3d and interact outputs all would work fine.\n \n....",
    "created_at": "2020-08-06T08:41:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479984",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:41" align="right">Comment 41</div>

I don't really understand the discussion here. But I remember the comment I made before in a sage-devel thread: https://groups.google.com/g/sage-devel/c/RGwGeJ5Tlso/m/EjRmq6gfAQAJ

---
.... One cause of constant confusion was that these jsmol, threejs, mathjax are served at /nbextensions. These are not proper nbextensions in Jupyter notebook ecosystem, but just static files. I suppose the proper place to serve them is /static, like /static/jsmol, .... 

Fortunately we can use a Jupyter notebook option to serve /static from arbitrary directory that contains jsmol, threejs, and mathjax:

`c.NotebookApp.extra_static_paths = ["/path/to/extra/static/files"]`

I guess that with some changes mainly replacing "/nbextensions" to "/static",  sage 3d and interact outputs all would work fine.
 
....



---

archive/issue_comments_479985.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">Comment 42</div>\n\nBut would that work for users who want to run Sage as a remote kernel?",
    "created_at": "2020-08-06T11:23:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479985",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">Comment 42</div>

But would that work for users who want to run Sage as a remote kernel?



---

archive/issue_comments_479986.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">Comment 43</div>\n\nReplying to [@mkoeppe](#comment%3A42):\n> But would that work for users who want to run Sage as a remote kernel?\n\nI have no precise idea about \"Sage remote kernel\". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.",
    "created_at": "2020-08-07T01:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479986",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:43" align="right">Comment 43</div>

Replying to [@mkoeppe](#comment%3A42):
> But would that work for users who want to run Sage as a remote kernel?

I have no precise idea about "Sage remote kernel". I just might say that the static files(jsmol, threejs, mathjax) should be served at the right url (`/static`) by the Jupyter front end server.



---

archive/issue_comments_479987.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">Comment 44</div>\n\nThe thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n\n```\n$ jupyter nbextension list\nKnown nbextensions:\n  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n    notebook section\n      jupyter-js-widgets/extension  enabled \n      - Validating: OK\n```\nIt does not have such a facility for random static files.",
    "created_at": "2020-08-07T02:06:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479987",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">Comment 44</div>

The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:

```
$ jupyter nbextension list
Known nbextensions:
  config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
    notebook section
      jupyter-js-widgets/extension  enabled 
      - Validating: OK
```
It does not have such a facility for random static files.



---

archive/issue_comments_479988.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">Comment 45</div>\n\nReplying to [@mkoeppe](#comment%3A44):\n> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:\n> \n> ```\n> $ jupyter nbextension list\n> Known nbextensions:\n>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig\n>     notebook section\n>       jupyter-js-widgets/extension  enabled \n>       - Validating: OK\n> ```\n> It does not have such a facility for random static files.\n\nDo you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.",
    "created_at": "2020-08-07T02:31:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479988",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:45" align="right">Comment 45</div>

Replying to [@mkoeppe](#comment%3A44):
> The thing is that Jupyter has a clean mechanism to install and inspect `nbextension`s:
> 
> ```
> $ jupyter nbextension list
> Known nbextensions:
>   config dir: /Users/mkoeppe/s/sage/sage-rebasing/local/etc/jupyter/nbconfig
>     notebook section
>       jupyter-js-widgets/extension  enabled 
>       - Validating: OK
> ```
> It does not have such a facility for random static files.

Do you have jsmol, theejs, mathjax in the list above? I guess not. It seems that jsmol, theejs, mathjax are not (and should not be) installed as proper nbextensions, but they reside in `/nbextensions` folder (by the symlinks) just to be served as static files for Sage graphics.



---

archive/issue_comments_479989.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">Comment 46</div>\n\nThat's right, they are not properly installed as nbextensions. My point is that they should.",
    "created_at": "2020-08-07T03:41:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479989",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">Comment 46</div>

That's right, they are not properly installed as nbextensions. My point is that they should.



---

archive/issue_comments_479990.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">Comment 47</div>\n\nReplying to [@mkoeppe](#comment%3A46):\n> That's right, they are not properly installed as nbextensions. My point is that they should.\n\nand my point is that they should not :-) but I am not sure...",
    "created_at": "2020-08-07T07:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479990",
    "user": "https://github.com/kwankyu"
}
```

<div id="comment:47" align="right">Comment 47</div>

Replying to [@mkoeppe](#comment%3A46):
> That's right, they are not properly installed as nbextensions. My point is that they should.

and my point is that they should not :-) but I am not sure...



---

archive/issue_comments_479991.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">Comment 48</div>\n\nReplying to [@mkoeppe](#comment%3A35):\n> What's the situation with `jsmol`?\n\nI have opened #30315 for jsmol",
    "created_at": "2020-08-07T18:58:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479991",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:48" align="right">Comment 48</div>

Replying to [@mkoeppe](#comment%3A35):
> What's the situation with `jsmol`?

I have opened #30315 for jsmol



---

archive/issue_comments_479992.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">Comment 49</div>\n\nhttps://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need",
    "created_at": "2020-08-09T03:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479992",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">Comment 49</div>

https://github.com/jupyter-widgets/widget-ts-cookiecutter could be used for creating the package, but it has more complexity than what we need



---

archive/issue_events_396578.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-15T14:30:40Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-minimal",
    "title_was": "Repackage Sage's cropped threejs as a pip-installable package jupyter-threejs-minimal",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396578"
}
```



---

archive/issue_events_396579.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T17:02:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396579"
}
```



---

archive/issue_events_396580.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T17:02:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396580"
}
```



---

archive/issue_events_396581.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-28T04:01:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "title_is": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-sage",
    "title_was": "Repackage Sage's cropped threejs as a pip-installable package (nbextension) jupyter-threejs-minimal",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396581"
}
```



---

archive/issue_comments_479993.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,8 +1,9 @@\n-https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.\n \n-broken by #29411\n+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n \n see also:\n \n+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n - #30296 System package information and `spkg-configure` for `mathjax`\n``````\n",
    "created_at": "2020-11-28T04:08:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479993",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,8 +1,9 @@
-https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.
 
-broken by #29411
+This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
 
 see also:
 
+- https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
 - #30296 System package information and `spkg-configure` for `mathjax`
``````




---

archive/issue_comments_479994.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">Comment 54</div>\n\nThis is now \nhttps://github.com/sagemath/threejs-sage/pull/1/files",
    "created_at": "2020-11-29T02:52:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479994",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">Comment 54</div>

This is now 
https://github.com/sagemath/threejs-sage/pull/1/files



---

archive/issue_comments_479995.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-11-29T02:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479995",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_479996.json:
```json
{
    "body": "Dependencies: **#30972**",
    "created_at": "2020-11-29T02:54:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479996",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30972**



---

archive/issue_comments_479997.json:
```json
{
    "body": "Branch: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage)**",
    "created_at": "2020-11-29T03:47:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479997",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage)**



---

archive/issue_events_396582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T03:47:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396582"
}
```



---

archive/issue_comments_479998.json:
```json
{
    "body": "Commit: **[500de1a](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)**",
    "created_at": "2020-11-29T03:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479998",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[500de1a](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)**



---

archive/issue_comments_479999.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">Comment 57</div>\n\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b\">5e1ca4e</a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66\">938bff4</a></td><td><code>Read required threejs version from ext_data</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab\">f847738</a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6\">d13177d</a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2\">47e795b</a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f74a7d8a4ea72b6744b68cd51e024ed378f314ae\">f74a7d8</a></td><td><code>Merge branch 't/30972/versioned_installation_of_threejs' into t/30123/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11693bebfd408452e72b4c61327ee43654cc1300\">11693be</a></td><td><code>build/pkgs/threejs: Switch to pip-installable package jupyter-threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7faf40dc3cfea55c5543a175f351a671278e3b6a\">7faf40d</a></td><td><code>build/pkgs/sage_conf: No longer define THREEJS_DIR</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d08dbf216c480bf29d035bd8f13a5d07cfd07167\">d08dbf2</a></td><td><code>sage.env: Get THREEJS_DIR from jupyter_threejs_sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd\">500de1a</a></td><td><code>sage.repl.ipython_kernel.install: No longer symlink THREEJS_DIR into nbextensions</code></td></tr></table>\n",
    "created_at": "2020-11-29T03:47:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-479999",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">Comment 57</div>

Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b">5e1ca4e</a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66">938bff4</a></td><td><code>Read required threejs version from ext_data</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab">f847738</a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6">d13177d</a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2">47e795b</a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f74a7d8a4ea72b6744b68cd51e024ed378f314ae">f74a7d8</a></td><td><code>Merge branch 't/30972/versioned_installation_of_threejs' into t/30123/repackage_sage_s_cropped_threejs_as_a_pip_installable_package__nbextension__jupyter_threejs_sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11693bebfd408452e72b4c61327ee43654cc1300">11693be</a></td><td><code>build/pkgs/threejs: Switch to pip-installable package jupyter-threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7faf40dc3cfea55c5543a175f351a671278e3b6a">7faf40d</a></td><td><code>build/pkgs/sage_conf: No longer define THREEJS_DIR</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d08dbf216c480bf29d035bd8f13a5d07cfd07167">d08dbf2</a></td><td><code>sage.env: Get THREEJS_DIR from jupyter_threejs_sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd">500de1a</a></td><td><code>sage.repl.ipython_kernel.install: No longer symlink THREEJS_DIR into nbextensions</code></td></tr></table>




---

archive/issue_comments_480000.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n-As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.\n+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:\n+\n+- https://pypi.org/project/jupyter-threejs-sage/#description\n+- https://github.com/sagemath/threejs-sage/pull/1\n \n This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.\n \n``````\n",
    "created_at": "2020-11-29T03:49:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480000",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
-As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook.
+As a follow-up to #30972, we provide a pip-installable package (nbextension) that makes (all supported versions of) the `threejs-sage` offline script available to a Jupyter notebook:
+
+- https://pypi.org/project/jupyter-threejs-sage/#description
+- https://github.com/sagemath/threejs-sage/pull/1
 
 This allows users to set up a system Jupyter notebook in which Sage is fully functional (including offline 3d graphics), without having to manually create symlinks from a Sage installation to the system's nbextensions directory.
 
``````




---

archive/issue_comments_480001.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">Comment 59</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b\">74ade58</a></td><td><code>build/pkgs/threejs/install-requires.txt: New</code></td></tr></table>\n",
    "created_at": "2020-11-29T03:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480001",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59" align="right">Comment 59</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b">74ade58</a></td><td><code>build/pkgs/threejs/install-requires.txt: New</code></td></tr></table>




---

archive/issue_comments_480002.json:
```json
{
    "body": "Changed commit from **[500de1a](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)** to **[74ade58](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**",
    "created_at": "2020-11-29T03:55:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480002",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[500de1a](https://github.com/sagemath/sagetrac-mirror/commit/500de1a67c7c7f3fc9464113d1ba43fbb2d976cd)** to **[74ade58](https://github.com/sagemath/sagetrac-mirror/commit/74ade58efbe5f07f683e622928c45d2c12bda87b)**



---

archive/issue_comments_480003.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">Comment 60</div>\n\nInput from downstream packagers would be very welcome",
    "created_at": "2020-11-29T20:10:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480003",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:60" align="right">Comment 60</div>

Input from downstream packagers would be very welcome



---

archive/issue_comments_480004.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">Comment 61</div>\n\nCan we avoid the `b1` stuff in the future? What is it even indicating.",
    "created_at": "2020-11-29T21:25:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480004",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:61" align="right">Comment 61</div>

Can we avoid the `b1` stuff in the future? What is it even indicating.



---

archive/issue_comments_480005.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">Comment 62</div>\n\nSo it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.\n\nThe branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)",
    "created_at": "2020-11-29T21:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480005",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:62" align="right">Comment 62</div>

So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. Seems to behave decently at install.

The branch otherwise look sane but I haven't fully tested it. I just focused on looking at the new packaging. If 'b1' was for after 'b', using 'c' would have been ok :)



---

archive/issue_comments_480006.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">Comment 63</div>\n\nReplying to [@kiwifb](#comment%3A61):\n> Can we avoid the `b1` stuff in the future? What is it even indicating.\n\nThat's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers",
    "created_at": "2020-11-29T21:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480006",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:63" align="right">Comment 63</div>

Replying to [@kiwifb](#comment%3A61):
> Can we avoid the `b1` stuff in the future? What is it even indicating.

That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers



---

archive/issue_comments_480007.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">Comment 64</div>\n\nReplying to [@kiwifb](#comment%3A62):\n> So it puts a copy in `site-package` that is \"importable\" and a copy in `share/jupyter/nbextensions`. \n\nThat's right, same behavior as `widgetsnbextension`",
    "created_at": "2020-11-29T21:38:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480007",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">Comment 64</div>

Replying to [@kiwifb](#comment%3A62):
> So it puts a copy in `site-package` that is "importable" and a copy in `share/jupyter/nbextensions`. 

That's right, same behavior as `widgetsnbextension`



---

archive/issue_comments_480008.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">Comment 65</div>\n\nReplying to [@mkoeppe](#comment%3A63):\n> Replying to [@kiwifb](#comment%3A61):\n> > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\nCan't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).",
    "created_at": "2020-11-29T21:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480008",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:65" align="right">Comment 65</div>

Replying to [@mkoeppe](#comment%3A63):
> Replying to [@kiwifb](#comment%3A61):
> > Can we avoid the `b1` stuff in the future? What is it even indicating.

> That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid).



---

archive/issue_comments_480009.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">Comment 66</div>\n\nReplying to [@mkoeppe](#comment%3A60):\n> Input from downstream packagers would be very welcome\n\nTested with the Arch package, everything works. +1 from me.",
    "created_at": "2020-11-29T21:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480009",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:66" align="right">Comment 66</div>

Replying to [@mkoeppe](#comment%3A60):
> Input from downstream packagers would be very welcome

Tested with the Arch package, everything works. +1 from me.



---

archive/issue_comments_480010.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">Comment 67</div>\n\nReplying to [@kiwifb](#comment%3A65):\n> Replying to [@mkoeppe](#comment%3A63):\n> > Replying to [@kiwifb](#comment%3A61):\n> > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\n> \n> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\nHopefully we can quickly proceed to an actual release so that this problem will go away.",
    "created_at": "2020-11-29T22:12:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480010",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">Comment 67</div>

Replying to [@kiwifb](#comment%3A65):
> Replying to [@mkoeppe](#comment%3A63):
> > Replying to [@kiwifb](#comment%3A61):
> > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

> 
> Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 

Hopefully we can quickly proceed to an actual release so that this problem will go away.



---

archive/issue_comments_480011.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">Comment 68</div>\n\nReplying to [@mkoeppe](#comment%3A67):\n> Replying to [@kiwifb](#comment%3A65):\n> > Replying to [@mkoeppe](#comment%3A63):\n> > > Replying to [@kiwifb](#comment%3A61):\n> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.\n\n> > > That's \"beta\" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers\n\n> > \n> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). \n\n> \n> Hopefully we can quickly proceed to an actual release so that this problem will go away.\n> \n\nThat's just venting. I can, and did, work around that.",
    "created_at": "2020-11-29T22:14:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480011",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:68" align="right">Comment 68</div>

Replying to [@mkoeppe](#comment%3A67):
> Replying to [@kiwifb](#comment%3A65):
> > Replying to [@mkoeppe](#comment%3A63):
> > > Replying to [@kiwifb](#comment%3A61):
> > > > Can we avoid the `b1` stuff in the future? What is it even indicating.

> > > That's "beta" 1 (because some metadata may need polishing). This is just the standard Python normalization of version numbers

> > 
> > Can't quite believe how that little bit just destroy the ebuild file format. Just 'b' would pass, but 'b1' with a meaning of 'beta 1', I technically should transform that into `_beta1` and then retransform it inside the ebuild. If it is standard python versioning someone needs to do something Gentoo side to allow those names (other than argue that they are wrong or stupid). 

> 
> Hopefully we can quickly proceed to an actual release so that this problem will go away.
> 

That's just venting. I can, and did, work around that.



---

archive/issue_comments_480012.json:
```json
{
    "body": "Changed keywords from **** to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480012",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from **** to **sd111**



---

archive/issue_comments_480013.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">Comment 69</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480013",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:69" align="right">Comment 69</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_events_396583.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396583"
}
```



---

archive/issue_events_396584.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396584"
}
```



---

archive/issue_comments_480014.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,3 +10,6 @@\n - https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ\n -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ\n - #30296 System package information and `spkg-configure` for `mathjax`\n+\n+User reports:\n+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ\n``````\n",
    "created_at": "2021-06-19T19:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480014",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,3 +10,6 @@
 - https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/wvhk-VtKBgAJ
 -  https://groups.google.com/d/msg/sage-support/Jaiqx-KTwM0/BVxEp1gxAwAJ
 - #30296 System package information and `spkg-configure` for `mathjax`
+
+User reports:
+- https://groups.google.com/g/sage-support/c/732Dcc7gcvI/m/XzbR_y6wBwAJ
``````




---

archive/issue_events_396585.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-19T19:53:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396585"
}
```



---

archive/issue_events_396586.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-19T19:53:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396586"
}
```



---

archive/issue_comments_480015.json:
```json
{
    "body": "<div id=\"comment:72\" align=\"right\">Comment 72</div>\n\nplease rebase",
    "created_at": "2021-06-21T15:34:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480015",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:72" align="right">Comment 72</div>

please rebase



---

archive/issue_comments_480016.json:
```json
{
    "body": "<div id=\"comment:73\" align=\"right\">Comment 73</div>\n\nReplying to [@mkoeppe](#comment%3A27):\n> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?\n> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?\n\nAs it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3",
    "created_at": "2021-06-22T01:12:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480016",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:73" align="right">Comment 73</div>

Replying to [@mkoeppe](#comment%3A27):
> Also, suppose we develop a way so that users can install sagelib using `pip`, instead of going through the sage distribution. Would it make sense to provide a copy of whatever parts of threejs that sagelib needs as a pip-installable Python package?
> Is https://github.com/jupyter-widgets/pythreejs of any relevance in this direction?

As it turns out, it is very relevant; and it would probably be best to redo the Python packaging (`jupyter-threejs-sage`) as a fork of `pythreejs`. They already have support for JupyterLab 3



---

archive/issue_events_396587.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-22T01:12:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396587"
}
```



---

archive/issue_events_396588.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-22T01:12:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396588"
}
```



---

archive/issue_comments_480017.json:
```json
{
    "body": "<div id=\"comment:75\" align=\"right\">Comment 75</div>\n\nOpened #32070 (Add package pythreejs 2.3.0).",
    "created_at": "2021-06-27T21:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480017",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:75" align="right">Comment 75</div>

Opened #32070 (Add package pythreejs 2.3.0).



---

archive/issue_comments_480018.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">Comment 76</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30123#issuecomment-480018",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">Comment 76</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_396589.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396589"
}
```



---

archive/issue_events_396590.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396590"
}
```



---

archive/issue_events_396591.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396591"
}
```



---

archive/issue_events_396592.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396592"
}
```



---

archive/issue_events_396593.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396593"
}
```



---

archive/issue_events_396594.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396594"
}
```



---

archive/issue_events_396595.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396595"
}
```



---

archive/issue_events_396596.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396596"
}
```



---

archive/issue_events_396597.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396597"
}
```



---

archive/issue_events_396598.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30123",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30123#event-396598"
}
```
