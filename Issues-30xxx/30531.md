# Issue 30531: Polyhedron_normaliz._triangulate_normaliz should not use NmzResult directly

archive/issues_030294.json:
```json
{
    "body": "`_triangulate_normaliz` calls `._cone_generators`, which calls `NmzResult` directly instead of going through `._nmz_result`.\n\nThis relies on the persistence of the rational and number field handlers in `PyNormaliz`, which is subject to change in future `PyNormaliz` versions.\n\n\n\nCC:  winfried @jplab @kliem\n\nBranch/Commit: [8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30531\n\n",
    "closed_at": "2020-09-23T21:28:02Z",
    "created_at": "2020-09-08T16:26:16Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Polyhedron_normaliz._triangulate_normaliz should not use NmzResult directly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30531",
    "user": "https://github.com/mkoeppe"
}
```
`_triangulate_normaliz` calls `._cone_generators`, which calls `NmzResult` directly instead of going through `._nmz_result`.

This relies on the persistence of the rational and number field handlers in `PyNormaliz`, which is subject to change in future `PyNormaliz` versions.



CC:  winfried @jplab @kliem

Branch/Commit: [8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30531





---

archive/issue_events_089400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-08T18:09:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30531#event-89400"
}
```



---

archive/issue_comments_603992.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis has nothing to do with the future. It is already a bug.\n\n```\nsage: P = polytopes.cube(backend='normaliz')*AA(2).sqrt()                                                                                                                                                                                                                    \nsage: P._triangulate_normaliz()                                                                                                                                                                                                                                              \n---------------------------------------------------------------------------\nNormalizInterfaceError                    Traceback (most recent call last)\n<ipython-input-7-ce2270188ea9> in <module>\n----> 1 P._triangulate_normaliz()\n\n/srv/public/kliem/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py in _triangulate_normaliz(self)\n   1583         data.pop('inhom_equations', None)\n   1584         data.pop('inhom_inequalities', None)\n-> 1585         cone = self._make_normaliz_cone(data)\n   1586 \n   1587         nmz_triangulation = self._nmz_result(cone, \"Triangulation\")\n\n/srv/public/kliem/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py in _make_normaliz_cone(data, verbose)\n   1110         if verbose:\n   1111             print(\"# Calling PyNormaliz.NmzCone(**{})\".format(data))\n-> 1112         cone = PyNormaliz.NmzCone(**data)\n   1113         assert cone, \"NmzCone(**{}) did not return a cone\".format(data)\n   1114         return cone\n\nNormalizInterfaceError: When parsing vertices: coefficient in matrix must be PyFloat, PyInt, PyLong, Sequence, must be able to be converted to a valid gmp input string\n```",
    "created_at": "2020-09-10T19:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603992",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
This has nothing to do with the future. It is already a bug.

```
sage: P = polytopes.cube(backend='normaliz')*AA(2).sqrt()                                                                                                                                                                                                                    
sage: P._triangulate_normaliz()                                                                                                                                                                                                                                              
---------------------------------------------------------------------------
NormalizInterfaceError                    Traceback (most recent call last)
<ipython-input-7-ce2270188ea9> in <module>
----> 1 P._triangulate_normaliz()

/srv/public/kliem/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py in _triangulate_normaliz(self)
   1583         data.pop('inhom_equations', None)
   1584         data.pop('inhom_inequalities', None)
-> 1585         cone = self._make_normaliz_cone(data)
   1586 
   1587         nmz_triangulation = self._nmz_result(cone, "Triangulation")

/srv/public/kliem/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py in _make_normaliz_cone(data, verbose)
   1110         if verbose:
   1111             print("# Calling PyNormaliz.NmzCone(**{})".format(data))
-> 1112         cone = PyNormaliz.NmzCone(**data)
   1113         assert cone, "NmzCone(**{}) did not return a cone".format(data)
   1114         return cone

NormalizInterfaceError: When parsing vertices: coefficient in matrix must be PyFloat, PyInt, PyLong, Sequence, must be able to be converted to a valid gmp input string
```



---

archive/issue_comments_603993.json:
```json
{
    "body": "<a id='comment:3'></a>\nI guess normaliz can handle this by now:\n\n```\nsage: P._nmz_result(P._normaliz_cone, \"Triangulation\")                                                                                                                                                                                                                       \n[[[0, 1, 2, 4], 16*a],\n [[1, 2, 4, 3], 16*a],\n [[1, 3, 4, 5], 16*a],\n [[3, 5, 6, 7], 16*a],\n [[6, 2, 4, 3], 16*a],\n [[6, 3, 4, 5], 16*a]]\n```\n\nThis is exactly what we want.",
    "created_at": "2020-09-10T19:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603993",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
I guess normaliz can handle this by now:

```
sage: P._nmz_result(P._normaliz_cone, "Triangulation")                                                                                                                                                                                                                       
[[[0, 1, 2, 4], 16*a],
 [[1, 2, 4, 3], 16*a],
 [[1, 3, 4, 5], 16*a],
 [[3, 5, 6, 7], 16*a],
 [[6, 2, 4, 3], 16*a],
 [[6, 3, 4, 5], 16*a]]
```

This is exactly what we want.



---

archive/issue_events_089401.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-10T19:54:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30531#event-89401"
}
```



---

archive/issue_events_089402.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-10T19:54:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30531#event-89402"
}
```



---

archive/issue_comments_603994.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-11T08:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603994",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_603995.json:
```json
{
    "body": "Branch: [u/gh-kliem/fix_normaliz_triangulation](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_normaliz_triangulation)",
    "created_at": "2020-09-11T08:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603995",
    "user": "https://github.com/kliem"
}
```

Branch: [u/gh-kliem/fix_normaliz_triangulation](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_normaliz_triangulation)



---

archive/issue_comments_603996.json:
```json
{
    "body": "Commit: [bb90807ff268df14926e58a4741b49a66599eaac](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)",
    "created_at": "2020-09-11T08:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603996",
    "user": "https://github.com/kliem"
}
```

Commit: [bb90807ff268df14926e58a4741b49a66599eaac](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)



---

archive/issue_comments_603997.json:
```json
{
    "body": "<a id='comment:6'></a>\nNew commits:\n|                                                                                                                                          |                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[71f169f](https://github.com/sagemath/sagetrac-mirror/commit/71f169f8b8d4ce64d47e276502af2ae68e9cc59b)|`fix normaliz triangulation`|\n|[bb90807](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)|`documentation`|",
    "created_at": "2020-09-11T08:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603997",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
New commits:
|                                                                                                                                          |                            |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[71f169f](https://github.com/sagemath/sagetrac-mirror/commit/71f169f8b8d4ce64d47e276502af2ae68e9cc59b)|`fix normaliz triangulation`|
|[bb90807](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)|`documentation`|



---

archive/issue_comments_603998.json:
```json
{
    "body": "Author: Jonathan Kliem",
    "created_at": "2020-09-11T08:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603998",
    "user": "https://github.com/kliem"
}
```

Author: Jonathan Kliem



---

archive/issue_comments_603999.json:
```json
{
    "body": "Changing commit from \"[bb90807ff268df14926e58a4741b49a66599eaac](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)\" to \"[10b5312e1f9780b6b0e5021323b7058f028f644a](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)\"",
    "created_at": "2020-09-11T08:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-603999",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[bb90807ff268df14926e58a4741b49a66599eaac](https://github.com/sagemath/sagetrac-mirror/commit/bb90807ff268df14926e58a4741b49a66599eaac)" to "[10b5312e1f9780b6b0e5021323b7058f028f644a](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)"



---

archive/issue_comments_604000.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------|\n|[10b5312](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)|`typo`|",
    "created_at": "2020-09-11T08:49:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604000",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |      |
|-------------------------------------------------------------------------------------------------------------------------------------------|------|
|[10b5312](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)|`typo`|



---

archive/issue_comments_604001.json:
```json
{
    "body": "<a id='comment:8'></a>\nIs `homogenous` correct in any context?\n\n`git grep homogenous` reveals quite something. Could be on the list of common typos that are discovered by this `tox` testing framework (and should of course be a typo ticket before that, but is annoying as one needs to deprecate at least one function).",
    "created_at": "2020-09-11T08:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604001",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
Is `homogenous` correct in any context?

`git grep homogenous` reveals quite something. Could be on the list of common typos that are discovered by this `tox` testing framework (and should of course be a typo ticket before that, but is annoying as one needs to deprecate at least one function).



---

archive/issue_comments_604002.json:
```json
{
    "body": "<a id='comment:9'></a>\nI think the correct spelling is \"homogeneous\".\n\nIf there is any problem on the Normaliz/PyNormaliz side, let me know.",
    "created_at": "2020-09-11T09:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604002",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:9'></a>
I think the correct spelling is "homogeneous".

If there is any problem on the Normaliz/PyNormaliz side, let me know.



---

archive/issue_comments_604003.json:
```json
{
    "body": "<a id='comment:10'></a>\n`Normaliz` works all right.\n\nIs there a way to ignore the dehomogenization for `Triangulation` of non-compact polyhedra? I currently recreate the cone from precomputed data without specifying the dehomogenization to achieve this.",
    "created_at": "2020-09-11T09:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604003",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
`Normaliz` works all right.

Is there a way to ignore the dehomogenization for `Triangulation` of non-compact polyhedra? I currently recreate the cone from precomputed data without specifying the dehomogenization to achieve this.



---

archive/issue_comments_604004.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think you want to get a triangulation (of the homogenization) even if the input defines an unbounded polyhedron. At present forbidden. It would be no real problem to do do this computation, but it requires a change in the source code of Normaliz. I keep it in mind.",
    "created_at": "2020-09-11T12:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604004",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:11'></a>
I think you want to get a triangulation (of the homogenization) even if the input defines an unbounded polyhedron. At present forbidden. It would be no real problem to do do this computation, but it requires a change in the source code of Normaliz. I keep it in mind.



---

archive/issue_comments_604005.json:
```json
{
    "body": "<a id='comment:12'></a>\nIs this ready for review? The method `_cone_generators` of the ticket description is unchanged",
    "created_at": "2020-09-11T15:08:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604005",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Is this ready for review? The method `_cone_generators` of the ticket description is unchanged



---

archive/issue_comments_604006.json:
```json
{
    "body": "<a id='comment:13'></a>\nI guess the static method `_cone_generators` can just be removed. What do you think about it? It's not just anywhere else as much as I can see.\n\nThe correct way to do it anyway is by `self._nmz_result(self._normaliz_cone, \"Generators\")`. I wasn't sure about how to resolve this issue for a static method.",
    "created_at": "2020-09-11T18:20:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604006",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>
I guess the static method `_cone_generators` can just be removed. What do you think about it? It's not just anywhere else as much as I can see.

The correct way to do it anyway is by `self._nmz_result(self._normaliz_cone, "Generators")`. I wasn't sure about how to resolve this issue for a static method.



---

archive/issue_comments_604007.json:
```json
{
    "body": "<a id='comment:14'></a>\nIf it's not used any more, yes, please remove it",
    "created_at": "2020-09-11T18:21:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604007",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
If it's not used any more, yes, please remove it



---

archive/issue_comments_604008.json:
```json
{
    "body": "<a id='comment:15'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[b45d775](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)|`remove unused private method that incorrectly uses the API`|",
    "created_at": "2020-09-11T18:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604008",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[b45d775](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)|`remove unused private method that incorrectly uses the API`|



---

archive/issue_comments_604009.json:
```json
{
    "body": "Changing commit from \"[10b5312e1f9780b6b0e5021323b7058f028f644a](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)\" to \"[b45d775016f2d6f20dc89f93b077de164a39966a](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)\"",
    "created_at": "2020-09-11T18:39:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604009",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[10b5312e1f9780b6b0e5021323b7058f028f644a](https://github.com/sagemath/sagetrac-mirror/commit/10b5312e1f9780b6b0e5021323b7058f028f644a)" to "[b45d775016f2d6f20dc89f93b077de164a39966a](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)"



---

archive/issue_comments_604010.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-11T23:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604010",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_604011.json:
```json
{
    "body": "Reviewer: Matthias Koeppe",
    "created_at": "2020-09-11T23:20:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604011",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: Matthias Koeppe



---

archive/issue_comments_604012.json:
```json
{
    "body": "<a id='comment:17'></a>\nI have changed the Normaliz code so that triangulations can be computed for arbitrary input (just pushed to GitHub/master; will be part of version 3.8.9). It is clear that this notion must be interpreted with care if the input defines an unbounded polyhedron. A corresponding remark has been added to Normaliz.pdf (p. 121 in the current version).\n\nI am not sure whether the computation in which the triangulations come up, are genuinely inhomogeneous, or the inhomogeneity is due to the implementation of the Sage polyhedron class. As mentioned earlier, it would be really good if the Sage cone class could use Normaliz as a backend.",
    "created_at": "2020-09-12T10:14:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604012",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:17'></a>
I have changed the Normaliz code so that triangulations can be computed for arbitrary input (just pushed to GitHub/master; will be part of version 3.8.9). It is clear that this notion must be interpreted with care if the input defines an unbounded polyhedron. A corresponding remark has been added to Normaliz.pdf (p. 121 in the current version).

I am not sure whether the computation in which the triangulations come up, are genuinely inhomogeneous, or the inhomogeneity is due to the implementation of the Sage polyhedron class. As mentioned earlier, it would be really good if the Sage cone class could use Normaliz as a backend.



---

archive/issue_comments_604013.json:
```json
{
    "body": "<a id='comment:18'></a>\nIMPORTANT: Triangulations are defined with respect to an ordered set of generators. The only reliable interactive way to connect the triangulation with the generators is to ask for them AFTER the computation of the triangulation since this computation may have changed the order (or even the set). Normaliz knows this problem and therefore stores the generators after the computation of the triangulation for future reference. So with disciplined use there is no problem.\n\nBut often  generators are already defined before the computation of the triangulation, and if users ask for them too early, chaos can ensue. For this reason I will introduce the matrix TriangulationGenerators that stores the ordered set of generators used in building the triangulation. The name should help to avoid confusion.",
    "created_at": "2020-09-13T11:41:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604013",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:18'></a>
IMPORTANT: Triangulations are defined with respect to an ordered set of generators. The only reliable interactive way to connect the triangulation with the generators is to ask for them AFTER the computation of the triangulation since this computation may have changed the order (or even the set). Normaliz knows this problem and therefore stores the generators after the computation of the triangulation for future reference. So with disciplined use there is no problem.

But often  generators are already defined before the computation of the triangulation, and if users ask for them too early, chaos can ensue. For this reason I will introduce the matrix TriangulationGenerators that stores the ordered set of generators used in building the triangulation. The name should help to avoid confusion.



---

archive/issue_comments_604014.json:
```json
{
    "body": "<a id='comment:19'></a>\nI've opened #30569 for the update to the upcoming version and left a note there regarding the triangulations",
    "created_at": "2020-09-13T15:53:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
I've opened #30569 for the update to the upcoming version and left a note there regarding the triangulations



---

archive/issue_comments_604015.json:
```json
{
    "body": "<a id='comment:20'></a>\nReplying to [Winfried](#comment%3A18):\n> IMPORTANT: Triangulations are defined with respect to an ordered set of generators. The only reliable interactive way to connect the triangulation with the generators is to ask for them AFTER the computation of the triangulation since this computation may have changed the order (or even the set). Normaliz knows this problem and therefore stores the generators after the computation of the triangulation for future reference. So with disciplined use there is no problem.\n> \n> But often  generators are already defined before the computation of the triangulation, and if users ask for them too early, chaos can ensue. For this reason I will introduce the matrix TriangulationGenerators that stores the ordered set of generators used in building the triangulation. The name should help to avoid confusion.\n> \n\n\nFrom my point of view, this means that this ticket should go back to needs work.",
    "created_at": "2020-09-13T16:45:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604015",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
Replying to [Winfried](#comment%3A18):
> IMPORTANT: Triangulations are defined with respect to an ordered set of generators. The only reliable interactive way to connect the triangulation with the generators is to ask for them AFTER the computation of the triangulation since this computation may have changed the order (or even the set). Normaliz knows this problem and therefore stores the generators after the computation of the triangulation for future reference. So with disciplined use there is no problem.
> 
> But often  generators are already defined before the computation of the triangulation, and if users ask for them too early, chaos can ensue. For this reason I will introduce the matrix TriangulationGenerators that stores the ordered set of generators used in building the triangulation. The name should help to avoid confusion.
> 


From my point of view, this means that this ticket should go back to needs work.



---

archive/issue_comments_604016.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-09-13T16:47:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604016",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_604017.json:
```json
{
    "body": "<a id='comment:22'></a>\n`@`Winfried: Could you maybe provide an example where the order changes or point me towards such a direction. (EDIT: If you know something, if the next point applies, don't worry about it.)\n\nOr is it just in principal a wrong assumption for the API to make and this could go wrong at some point?\n\nIf I initialize with precomputed data and random order of vertices, calling `Triangulation` doesn't change the order (at least for the examples I tried).",
    "created_at": "2020-09-13T17:03:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604017",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>
`@`Winfried: Could you maybe provide an example where the order changes or point me towards such a direction. (EDIT: If you know something, if the next point applies, don't worry about it.)

Or is it just in principal a wrong assumption for the API to make and this could go wrong at some point?

If I initialize with precomputed data and random order of vertices, calling `Triangulation` doesn't change the order (at least for the examples I tried).



---

archive/issue_comments_604018.json:
```json
{
    "body": "<a id='comment:23'></a>\nLook at\n\n\n```\n>>> import PyNormaliz\n>>> from PyNormaliz import *\n>>> vert = [[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]\n>>> C= Cone(vertices = vert)\n>>> C.Generators()\n[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]\n>>> C.Triangulation()\n[[[0, 1, 2], 1], [[0, 1, 3], 1], [[0, 2, 4], 1], [[0, 3, 4], 1], [[1, 2, 5], 1], [[1, 3, 6], 1], [[2, 4, 7], 1], [[3, 4, 8], 1]]\n>>> C.Generators()\n[[2, 0, 0, -2, 1], [2, -1, 0, -2, 1], [2, 0, -1, -2, 1], [2, 0, 1, -2, 1], [2, 1, 0, -2, 1], [2, -1, -1, -2, 1], [2, -1, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 1, -2, 1]]\n>>>\n```\n\nI would not bet that this impossible with precomputed generators. I stumbled on this problem when the last Travis run of PyNormaliz failed because the triangulation had changed relative to the reference. In the Normaliz workflow the triangulation can be computed at two places, and this place has changed with the last commit in order to make triangulations available also for unbounded polyhedra.\n\nIf the triangulation is computed together with the Ehrhart series (==> old place), then we get a different result:\n\n\n```\n>>> D= Cone(vertices = vert)\n>>> D.Compute(\"EhrhartSeries\", \"Triangulation\")\nTrue\n>>> D.Generators()\n[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]\n>>> D.Triangulation()\n[[[0, 1, 3], 1], [[1, 2, 3], 1], [[2, 3, 4], 1], [[2, 4, 5], 1], [[3, 4, 6], 1], [[4, 5, 6], 1], [[5, 6, 7], 1], [[5, 7, 8], 1]]\n>>> D.Generators()\n[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]\n>>>\n```\n\nIn this case the order has not changed. Both results are correct --- triangulations are not uniquely determined and there is no canonical order of the generators. The next days I will try to find out what is really going on. Nevertheless I think it is really better to introduce TriangulationGenereors that are not defined before the triangulation has been computed.",
    "created_at": "2020-09-13T17:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604018",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:23'></a>
Look at


```
>>> import PyNormaliz
>>> from PyNormaliz import *
>>> vert = [[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]
>>> C= Cone(vertices = vert)
>>> C.Generators()
[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]
>>> C.Triangulation()
[[[0, 1, 2], 1], [[0, 1, 3], 1], [[0, 2, 4], 1], [[0, 3, 4], 1], [[1, 2, 5], 1], [[1, 3, 6], 1], [[2, 4, 7], 1], [[3, 4, 8], 1]]
>>> C.Generators()
[[2, 0, 0, -2, 1], [2, -1, 0, -2, 1], [2, 0, -1, -2, 1], [2, 0, 1, -2, 1], [2, 1, 0, -2, 1], [2, -1, -1, -2, 1], [2, -1, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 1, -2, 1]]
>>>
```

I would not bet that this impossible with precomputed generators. I stumbled on this problem when the last Travis run of PyNormaliz failed because the triangulation had changed relative to the reference. In the Normaliz workflow the triangulation can be computed at two places, and this place has changed with the last commit in order to make triangulations available also for unbounded polyhedra.

If the triangulation is computed together with the Ehrhart series (==> old place), then we get a different result:


```
>>> D= Cone(vertices = vert)
>>> D.Compute("EhrhartSeries", "Triangulation")
True
>>> D.Generators()
[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]
>>> D.Triangulation()
[[[0, 1, 3], 1], [[1, 2, 3], 1], [[2, 3, 4], 1], [[2, 4, 5], 1], [[3, 4, 6], 1], [[4, 5, 6], 1], [[5, 6, 7], 1], [[5, 7, 8], 1]]
>>> D.Generators()
[[2, -1, -1, -2, 1], [2, -1, 0, -2, 1], [2, -1, 1, -2, 1], [2, 0, -1, -2, 1], [2, 0, 0, -2, 1], [2, 0, 1, -2, 1], [2, 1, -1, -2, 1], [2, 1, 0, -2, 1], [2, 1, 1, -2, 1]]
>>>
```

In this case the order has not changed. Both results are correct --- triangulations are not uniquely determined and there is no canonical order of the generators. The next days I will try to find out what is really going on. Nevertheless I think it is really better to introduce TriangulationGenereors that are not defined before the triangulation has been computed.



---

archive/issue_comments_604019.json:
```json
{
    "body": "<a id='comment:24'></a>\nThanks. You were faster than me. I just wanted to post that I stumped upon this while trying to get a doctest for algebraic polyhedra (that finding the correct indices also works for them).\n\nThe current branch produces:\n\n```\nsage: C1 = Polyhedron(rays=[[0,0,1],[1,0,AA(2).sqrt()],[0,1,1],[1,1,1]], backend='normaliz')                                                                                        \nsage: C1.triangulate(engine='normaliz')                                                                                                                                             \n(<0,1,2>, <0,2,3>)\nsage: list(a.ambient_Vrepresentation() for a in C1.face_generator())                                                                                                                \n[(A vertex at (0, 0, 0),\n  A ray in the direction (0, 0, 1),\n  A ray in the direction (0, 1, 1),\n  A ray in the direction (0.7071067811865475?, 0, 1),\n  A ray in the direction (1, 1, 1)),\n (),\n (A vertex at (0, 0, 0),\n  A ray in the direction (0, 0, 1),\n  A ray in the direction (0, 1, 1)),\n (A vertex at (0, 0, 0),\n  A ray in the direction (0, 0, 1),\n  A ray in the direction (0.7071067811865475?, 0, 1)),\n (A vertex at (0, 0, 0),\n  A ray in the direction (0, 1, 1),\n  A ray in the direction (1, 1, 1)),\n (A vertex at (0, 0, 0),\n  A ray in the direction (0.7071067811865475?, 0, 1),\n  A ray in the direction (1, 1, 1)),\n (A vertex at (0, 0, 0), A ray in the direction (0, 0, 1)),\n (A vertex at (0, 0, 0), A ray in the direction (0, 1, 1)),\n (A vertex at (0, 0, 0),),\n (A vertex at (0, 0, 0), A ray in the direction (0.7071067811865475?, 0, 1)),\n (A vertex at (0, 0, 0), A ray in the direction (1, 1, 1))]\nsage: C1.rays()                                                                                                                                                                     \n(A ray in the direction (0, 0, 1),\n A ray in the direction (0, 1, 1),\n A ray in the direction (0.7071067811865475?, 0, 1),\n A ray in the direction (1, 1, 1))\n```\n\nThis is wrong (this is why I printed all the extra stuff).\n\nChecking the indices I get: `(<0,1,3>, <0,2,3>)`.\n\nSo accidentally I stumbled upon an example myself.",
    "created_at": "2020-09-13T18:03:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604019",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>
Thanks. You were faster than me. I just wanted to post that I stumped upon this while trying to get a doctest for algebraic polyhedra (that finding the correct indices also works for them).

The current branch produces:

```
sage: C1 = Polyhedron(rays=[[0,0,1],[1,0,AA(2).sqrt()],[0,1,1],[1,1,1]], backend='normaliz')                                                                                        
sage: C1.triangulate(engine='normaliz')                                                                                                                                             
(<0,1,2>, <0,2,3>)
sage: list(a.ambient_Vrepresentation() for a in C1.face_generator())                                                                                                                
[(A vertex at (0, 0, 0),
  A ray in the direction (0, 0, 1),
  A ray in the direction (0, 1, 1),
  A ray in the direction (0.7071067811865475?, 0, 1),
  A ray in the direction (1, 1, 1)),
 (),
 (A vertex at (0, 0, 0),
  A ray in the direction (0, 0, 1),
  A ray in the direction (0, 1, 1)),
 (A vertex at (0, 0, 0),
  A ray in the direction (0, 0, 1),
  A ray in the direction (0.7071067811865475?, 0, 1)),
 (A vertex at (0, 0, 0),
  A ray in the direction (0, 1, 1),
  A ray in the direction (1, 1, 1)),
 (A vertex at (0, 0, 0),
  A ray in the direction (0.7071067811865475?, 0, 1),
  A ray in the direction (1, 1, 1)),
 (A vertex at (0, 0, 0), A ray in the direction (0, 0, 1)),
 (A vertex at (0, 0, 0), A ray in the direction (0, 1, 1)),
 (A vertex at (0, 0, 0),),
 (A vertex at (0, 0, 0), A ray in the direction (0.7071067811865475?, 0, 1)),
 (A vertex at (0, 0, 0), A ray in the direction (1, 1, 1))]
sage: C1.rays()                                                                                                                                                                     
(A ray in the direction (0, 0, 1),
 A ray in the direction (0, 1, 1),
 A ray in the direction (0.7071067811865475?, 0, 1),
 A ray in the direction (1, 1, 1))
```

This is wrong (this is why I printed all the extra stuff).

Checking the indices I get: `(<0,1,3>, <0,2,3>)`.

So accidentally I stumbled upon an example myself.



---

archive/issue_comments_604020.json:
```json
{
    "body": "Changing commit from \"[b45d775016f2d6f20dc89f93b077de164a39966a](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)\" to \"[63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)\"",
    "created_at": "2020-09-13T18:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[b45d775016f2d6f20dc89f93b077de164a39966a](https://github.com/sagemath/sagetrac-mirror/commit/b45d775016f2d6f20dc89f93b077de164a39966a)" to "[63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)"



---

archive/issue_comments_604021.json:
```json
{
    "body": "<a id='comment:25'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                   |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|\n|[63f1b79](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)|`account for maybe changed order of the generators`|",
    "created_at": "2020-09-13T18:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                   |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------|
|[63f1b79](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)|`account for maybe changed order of the generators`|



---

archive/issue_comments_604022.json:
```json
{
    "body": "<a id='comment:26'></a>\nIt's not pretty, but it seems to work.",
    "created_at": "2020-09-13T18:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604022",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>
It's not pretty, but it seems to work.



---

archive/issue_comments_604023.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-13T18:06:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604023",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_604024.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-13T19:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604024",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_604025.json:
```json
{
    "body": "<a id='comment:27'></a>\nMy guess is that this workaround might fail if this not full dimensional.\n\nBut I think this is good enough as a hot fix for Sage 9.2 while we wait for the new Normaliz.",
    "created_at": "2020-09-13T19:18:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
My guess is that this workaround might fail if this not full dimensional.

But I think this is good enough as a hot fix for Sage 9.2 while we wait for the new Normaliz.



---

archive/issue_comments_604026.json:
```json
{
    "body": "<a id='comment:28'></a>\nTo day I have changed the master branch of Normliz as follows:\n\n-- Generators are no longer accessible from the outside\n\n-- they are replaced by TriangulationGenerators\n\n-- TriangulationGeneretors are set immediately after a triangulation has been computed\n\nIt is possible to compute several triangulations successively, for example an ordinary one first and then a unimodular one. I think it is clear that one must pull the TriangulationGenerators again after the second computation.\n\nOne could go a step further by bundling the Triangulation and the TriangulationGenerators so that they are returned together. If you think this is necessary, please let me know.\n\nPyNormaliz has not yet been updated. I think only changes in the tests are necessary.",
    "created_at": "2020-09-14T14:05:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604026",
    "user": "https://trac.sagemath.org/admin/accounts/users/Winfried"
}
```

<a id='comment:28'></a>
To day I have changed the master branch of Normliz as follows:

-- Generators are no longer accessible from the outside

-- they are replaced by TriangulationGenerators

-- TriangulationGeneretors are set immediately after a triangulation has been computed

It is possible to compute several triangulations successively, for example an ordinary one first and then a unimodular one. I think it is clear that one must pull the TriangulationGenerators again after the second computation.

One could go a step further by bundling the Triangulation and the TriangulationGenerators so that they are returned together. If you think this is necessary, please let me know.

PyNormaliz has not yet been updated. I think only changes in the tests are necessary.



---

archive/issue_comments_604027.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-09-15T22:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604027",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_604028.json:
```json
{
    "body": "<a id='comment:29'></a>\n\n```\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_normaliz.py\", line 1574, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz\nFailed example:\n    C1 = Polyhedron(rays=[[0,0,1],[1,0,AA(2).sqrt()],[0,1,1],[1,1,1]], backend='normaliz')\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz[0]>\", line 1, in <module>\n        C1 = Polyhedron(rays=[[Integer(0),Integer(0),Integer(1)],[Integer(1),Integer(0),AA(Integer(2)).sqrt()],[Integer(0),Integer(1),Integer(1)],[Integer(1),Integer(1),Integer(1)]], backend='normaliz')\n      File \"sage/misc/lazy_import.pyx\", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3736)\n        return self.get_object()(*args, **kwds)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/constructor.py\", line 662, in Polyhedron\n        return parent(Vrep, Hrep, convert=convert, verbose=verbose)\n      File \"sage/structure/parent.pyx\", line 902, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9364)\n        return mor._call_with_args(x, args, kwds)\n      File \"sage/structure/coerce_maps.pyx\", line 180, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (build/cythonized/sage/structure/coerce_maps.c:5154)\n        raise\n      File \"sage/structure/coerce_maps.pyx\", line 175, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (build/cythonized/sage/structure/coerce_maps.c:5042)\n        return C._element_constructor(x, *args, **kwds)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/parent.py\", line 598, in _element_constructor_\n        return self.element_class(self, Vrep, Hrep, **kwds)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py\", line 238, in __init__\n        Polyhedron_base.__init__(self, parent, Vrep, Hrep, **kwds)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py\", line 249, in __init__\n        self._init_from_Vrepresentation(vertices, rays, lines, **kwds)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py\", line 565, in _init_from_Vrepresentation\n        self._init_from_normaliz_data(data, normaliz_field=normaliz_field, verbose=verbose)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py\", line 387, in _init_from_normaliz_data\n        cone = self._cone_from_normaliz_data(data, verbose)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py\", line 419, in _cone_from_normaliz_data\n        PythonModule(\"PyNormaliz\", spkg=\"pynormaliz\").require()\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/features/__init__.py\", line 191, in require\n        raise FeatureNotPresentError(self, presence.reason, presence.resolution)\n    sage.features.FeatureNotPresentError: PyNormaliz is not available.\n    Failed to import `PyNormaliz`.\n    To install PyNormaliz you can try to run 'sage -i pynormaliz'.\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/backend_normaliz.py\", line 1575, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz\nFailed example:\n    C1._triangulate_normaliz()\nException raised:\n    Traceback (most recent call last):\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz[1]>\", line 1, in <module>\n        C1._triangulate_normaliz()\n    NameError: name 'C1' is not defined\n**********************************************************************\n```",
    "created_at": "2020-09-15T22:54:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604028",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:29'></a>

```
**********************************************************************
File "src/sage/geometry/polyhedron/backend_normaliz.py", line 1574, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz
Failed example:
    C1 = Polyhedron(rays=[[0,0,1],[1,0,AA(2).sqrt()],[0,1,1],[1,1,1]], backend='normaliz')
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz[0]>", line 1, in <module>
        C1 = Polyhedron(rays=[[Integer(0),Integer(0),Integer(1)],[Integer(1),Integer(0),AA(Integer(2)).sqrt()],[Integer(0),Integer(1),Integer(1)],[Integer(1),Integer(1),Integer(1)]], backend='normaliz')
      File "sage/misc/lazy_import.pyx", line 353, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:3736)
        return self.get_object()(*args, **kwds)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/constructor.py", line 662, in Polyhedron
        return parent(Vrep, Hrep, convert=convert, verbose=verbose)
      File "sage/structure/parent.pyx", line 902, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9364)
        return mor._call_with_args(x, args, kwds)
      File "sage/structure/coerce_maps.pyx", line 180, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (build/cythonized/sage/structure/coerce_maps.c:5154)
        raise
      File "sage/structure/coerce_maps.pyx", line 175, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_with_args (build/cythonized/sage/structure/coerce_maps.c:5042)
        return C._element_constructor(x, *args, **kwds)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/parent.py", line 598, in _element_constructor_
        return self.element_class(self, Vrep, Hrep, **kwds)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py", line 238, in __init__
        Polyhedron_base.__init__(self, parent, Vrep, Hrep, **kwds)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/base.py", line 249, in __init__
        self._init_from_Vrepresentation(vertices, rays, lines, **kwds)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py", line 565, in _init_from_Vrepresentation
        self._init_from_normaliz_data(data, normaliz_field=normaliz_field, verbose=verbose)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py", line 387, in _init_from_normaliz_data
        cone = self._cone_from_normaliz_data(data, verbose)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/backend_normaliz.py", line 419, in _cone_from_normaliz_data
        PythonModule("PyNormaliz", spkg="pynormaliz").require()
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/features/__init__.py", line 191, in require
        raise FeatureNotPresentError(self, presence.reason, presence.resolution)
    sage.features.FeatureNotPresentError: PyNormaliz is not available.
    Failed to import `PyNormaliz`.
    To install PyNormaliz you can try to run 'sage -i pynormaliz'.
**********************************************************************
File "src/sage/geometry/polyhedron/backend_normaliz.py", line 1575, in sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz
Failed example:
    C1._triangulate_normaliz()
Exception raised:
    Traceback (most recent call last):
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/release/Sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.geometry.polyhedron.backend_normaliz.Polyhedron_normaliz._triangulate_normaliz[1]>", line 1, in <module>
        C1._triangulate_normaliz()
    NameError: name 'C1' is not defined
**********************************************************************
```



---

archive/issue_comments_604029.json:
```json
{
    "body": "Changing commit from \"[63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)\" to \"[8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)\"",
    "created_at": "2020-09-16T03:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5](https://github.com/sagemath/sagetrac-mirror/commit/63f1b79d8eafab0dc88902a310f8d7a16ef6b6e5)" to "[8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)"



---

archive/issue_comments_604030.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|\n|[8d934b2](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)|`optional flag`|",
    "created_at": "2020-09-16T03:35:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |               |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------|
|[8d934b2](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)|`optional flag`|



---

archive/issue_comments_604031.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-16T03:36:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604031",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_604032.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-16T03:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604032",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_604033.json:
```json
{
    "body": "<a id='comment:33'></a>\nThanks.",
    "created_at": "2020-09-16T03:42:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604033",
    "user": "https://github.com/kliem"
}
```

<a id='comment:33'></a>
Thanks.



---

archive/issue_events_089403.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-23T21:28:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30531#event-89403"
}
```



---

archive/issue_comments_604034.json:
```json
{
    "body": "Changing branch from \"[u/gh-kliem/fix_normaliz_triangulation](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_normaliz_triangulation)\" to \"[8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)\"",
    "created_at": "2020-09-23T21:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604034",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/gh-kliem/fix_normaliz_triangulation](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/fix_normaliz_triangulation)" to "[8d934b248b5db0d1a2b69fbeccee91919f01a02e](https://github.com/sagemath/sagetrac-mirror/commit/8d934b248b5db0d1a2b69fbeccee91919f01a02e)"



---

archive/issue_comments_604035.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-23T21:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30531",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30531#issuecomment-604035",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
