# Issue 30681: Fast Pfaffian using Faddeev-LeVerrier

archive/issues_030444.json:
```json
{
    "assignees": [],
    "body": "At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.\n\nAccording to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.\n\nCC:  @tscrim @mkoeppe @fchapoton @videlec\n\nKeywords: **pfaffian**\n\nBranch/Commit: **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Michael Jung**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30681_\n\n",
    "closed_at": "2020-10-31T18:07:07Z",
    "created_at": "2020-09-28T14:52:45Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fast Pfaffian using Faddeev-LeVerrier",
    "type": "issue",
    "updated_at": "2020-10-31T18:07:07Z",
    "url": "https://github.com/sagemath/sage/issues/30681",
    "user": "https://github.com/mjungmath"
}
```
At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.

According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.

CC:  @tscrim @mkoeppe @fchapoton @videlec

Keywords: **pfaffian**

Branch/Commit: **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**

Reviewer: **Travis Scrimshaw**

Author: **Michael Jung**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/30681_





---

archive/issue_events_425124.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T14:52:45Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425124"
}
```



---

archive/issue_events_425125.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T14:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425125"
}
```



---

archive/issue_events_425126.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T14:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425126"
}
```



---

archive/issue_events_425127.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T14:52:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425127"
}
```



---

archive/issue_comments_490013.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.\n \n-According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(n^4). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.\n+According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.\n \n I suppose there is no way to check the torsion of rings in Sage right now. Hence, I would suggest to restrict the algorithm to integral domains of characteristic zero by performing the computation in the fraction field if necessary and then converting the result back. But I am not certain whether division by integers always turns out working as intended in the fraction field.\n``````\n",
    "created_at": "2020-09-28T14:55:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490013",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.
 
-According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(n^4). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.
+According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.
 
 I suppose there is no way to check the torsion of rings in Sage right now. Hence, I would suggest to restrict the algorithm to integral domains of characteristic zero by performing the computation in the fraction field if necessary and then converting the result back. But I am not certain whether division by integers always turns out working as intended in the fraction field.
``````




---

archive/issue_comments_490014.json:
```json
{
    "body": "Branch: **[u/gh-mjungmath/baer_faddeev_leverrier](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/baer_faddeev_leverrier)**",
    "created_at": "2020-09-28T15:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490014",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[u/gh-mjungmath/baer_faddeev_leverrier](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/baer_faddeev_leverrier)**



---

archive/issue_events_425128.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T15:05:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425128"
}
```



---

archive/issue_comments_490015.json:
```json
{
    "body": "Commit: **[`468f238`](https://github.com/sagemath/sagetrac-mirror/commit/468f23815ade42a2192b0a9cd378de8fdc594dcd)**",
    "created_at": "2020-09-28T15:05:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490015",
    "user": "https://github.com/mjungmath"
}
```

Commit: **[`468f238`](https://github.com/sagemath/sagetrac-mirror/commit/468f23815ade42a2192b0a9cd378de8fdc594dcd)**



---

archive/issue_comments_490016.json:
```json
{
    "body": "Changed commit from **[`468f238`](https://github.com/sagemath/sagetrac-mirror/commit/468f23815ade42a2192b0a9cd378de8fdc594dcd)** to **[`185e915`](https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599)**",
    "created_at": "2020-09-28T15:06:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490016",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`468f238`](https://github.com/sagemath/sagetrac-mirror/commit/468f23815ade42a2192b0a9cd378de8fdc594dcd)** to **[`185e915`](https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599)**



---

archive/issue_comments_490017.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599\"><code>185e915</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>\n",
    "created_at": "2020-09-28T15:06:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490017",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599"><code>185e915</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>




---

archive/issue_events_425129.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T21:25:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425129"
}
```



---

archive/issue_events_425130.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-28T21:25:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425130"
}
```



---

archive/issue_comments_490018.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,3 @@\n At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.\n \n According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.\n-\n-I suppose there is no way to check the torsion of rings in Sage right now. Hence, I would suggest to restrict the algorithm to integral domains of characteristic zero by performing the computation in the fraction field if necessary and then converting the result back. But I am not certain whether division by integers always turns out working as intended in the fraction field.\n``````\n",
    "created_at": "2020-09-28T21:36:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490018",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,3 @@
 At the current stage, the Pfaffian is computed using the definition by perfect matchings. This is tremendously demanding.
 
 According to https://arxiv.org/abs/2008.04247, there is an algorithm similar to the Faddeev-LeVerrier algorithm for the determinant running in at most O(pow(n,4)). Furthermore, it is easy to implement. This algorithm works for any torsion-free ring.
-
-I suppose there is no way to check the torsion of rings in Sage right now. Hence, I would suggest to restrict the algorithm to integral domains of characteristic zero by performing the computation in the fraction field if necessary and then converting the result back. But I am not certain whether division by integers always turns out working as intended in the fraction field.
``````




---

archive/issue_comments_490019.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nWhat do you need info on? The determinant version? I think that would be better as a separate ticket.\n\nI don't see the point in nailing `IntegralDomains()` in memory here. This function should not be called with the kind of frequency that would mandate that.\n\nWhen the result is not a field, how does other such algorithms work in Sage? Do they convert the result back to the original ring? I feel like if I use a matrix over `ZZ`, I would expect a result in `ZZ`.\n\nI would fully Cythonize `_pf_bfl` and write it as\n\n```python\n    cdef _pf_bfl(self):\n        cdef Py_ssize_t n = self._ncols\n        cdef Py_ssize_t q = n // 2\n        cdef Py_ssize_t i, k\n\n        # apply J:\n        cdef Matrix A = <Matrix> copy(self)\n        for i in range(0, n, 2):\n            A.swap_columns_c(i, i+1)  # Avoid some checks\n            # A.set_col_to_multiple_of_col(i+1, i+1, -1)\n            for k in range(n):\n                A.set_unsafe(k, i+1, -A.get_unsage(k, i+1))\n\n        cdef Matrix M = <Matrix> copy(A)\n\n        # Baer-Faddeev-Leverrier algorithm:\n        for k in range(1, q):\n            c = -M.trace() / (2*k)\n            # M = A * (M + c*1)\n            # Add c along the diagonal\n            for i in range(n):\n                M.set_unsafe(i, i, M.get_unsafe(i, i) + c)\n            M = A * M\n        c = -M.trace() / (2*q)\n        return (-1)**q * c\n```\nIt would be really good if there was an in place version of `M = A * M`, but alas, I don't think there is. So we will have to have that temporary object. `:/`",
    "created_at": "2020-09-28T22:45:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490019",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:8" align="right">comment:8</div>

What do you need info on? The determinant version? I think that would be better as a separate ticket.

I don't see the point in nailing `IntegralDomains()` in memory here. This function should not be called with the kind of frequency that would mandate that.

When the result is not a field, how does other such algorithms work in Sage? Do they convert the result back to the original ring? I feel like if I use a matrix over `ZZ`, I would expect a result in `ZZ`.

I would fully Cythonize `_pf_bfl` and write it as

```python
    cdef _pf_bfl(self):
        cdef Py_ssize_t n = self._ncols
        cdef Py_ssize_t q = n // 2
        cdef Py_ssize_t i, k

        # apply J:
        cdef Matrix A = <Matrix> copy(self)
        for i in range(0, n, 2):
            A.swap_columns_c(i, i+1)  # Avoid some checks
            # A.set_col_to_multiple_of_col(i+1, i+1, -1)
            for k in range(n):
                A.set_unsafe(k, i+1, -A.get_unsage(k, i+1))

        cdef Matrix M = <Matrix> copy(A)

        # Baer-Faddeev-Leverrier algorithm:
        for k in range(1, q):
            c = -M.trace() / (2*k)
            # M = A * (M + c*1)
            # Add c along the diagonal
            for i in range(n):
                M.set_unsafe(i, i, M.get_unsafe(i, i) + c)
            M = A * M
        c = -M.trace() / (2*q)
        return (-1)**q * c
```
It would be really good if there was an in place version of `M = A * M`, but alas, I don't think there is. So we will have to have that temporary object. `:/`



---

archive/issue_comments_490020.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThank you for the feedback. This Cython version is already much better.\n\nOne question that occurred to me is whether the division by integers always works in the (fraction) field. It should, but I am not sure whether Sage always converts the integers mathematically correct.\n\nSecondly, the algorithm should work for `QQ` algebras as well. I would guess, you can even assume an algebra over an integral domain of characteristic zero. Can you confirm that? But even if that works, it also depends on the answer of my first question.\n\nObviously, each ring constitutes an algebra over itself. But apparently, Sage doesn't recognize that. So, if the answer to all my above questions is \"yes\", how can we establish a general check for the matrix's base ring being an algebra over an integral domain with characteristic zero? And how would a conversion look like?",
    "created_at": "2020-09-29T08:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490020",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:9" align="right">comment:9</div>

Thank you for the feedback. This Cython version is already much better.

One question that occurred to me is whether the division by integers always works in the (fraction) field. It should, but I am not sure whether Sage always converts the integers mathematically correct.

Secondly, the algorithm should work for `QQ` algebras as well. I would guess, you can even assume an algebra over an integral domain of characteristic zero. Can you confirm that? But even if that works, it also depends on the answer of my first question.

Obviously, each ring constitutes an algebra over itself. But apparently, Sage doesn't recognize that. So, if the answer to all my above questions is "yes", how can we establish a general check for the matrix's base ring being an algebra over an integral domain with characteristic zero? And how would a conversion look like?



---

archive/issue_comments_490021.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@tscrim](#comment:8):\n> When the result is not a field, how does other such algorithms work in Sage? Do they convert the result back to the original ring? I feel like if I use a matrix over `ZZ`, I would expect a result in `ZZ`.\n\nYes, it should. At least for `ZZ`, the current version does the job, in particular:\n\n```diff\n+                if R in _Fields:\n+                    pf = self._pf_bfl()\n+                else:\n+                    F = R.fraction_field()\n+                    pf = self._coerce_element(self.change_ring(F)._pf_bfl())\n```\n\nBut I am not sure whether this setup always works out.",
    "created_at": "2020-09-29T08:23:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490021",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@tscrim](#comment:8):
> When the result is not a field, how does other such algorithms work in Sage? Do they convert the result back to the original ring? I feel like if I use a matrix over `ZZ`, I would expect a result in `ZZ`.

Yes, it should. At least for `ZZ`, the current version does the job, in particular:

```diff
+                if R in _Fields:
+                    pf = self._pf_bfl()
+                else:
+                    F = R.fraction_field()
+                    pf = self._coerce_element(self.change_ring(F)._pf_bfl())
```

But I am not sure whether this setup always works out.



---

archive/issue_comments_490022.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThe `_pf_bfl` method is invoked from a regular Python function. I am not a Cython expert, but shouldn't that be a `cpdef` function then?\n\nOr do you suggest to rewrite `pfaffian` as well into Cython code?",
    "created_at": "2020-09-29T10:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490022",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">comment:11</div>

The `_pf_bfl` method is invoked from a regular Python function. I am not a Cython expert, but shouldn't that be a `cpdef` function then?

Or do you suggest to rewrite `pfaffian` as well into Cython code?



---

archive/issue_comments_490023.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@mjungmath](#comment:11):\n> The `_pf_bfl` method is invoked from a regular Python function. I am not a Cython expert, but shouldn't that be a `cpdef` function then?\n\nNo, because it is called within Cython code. You might need to change\n\n```diff\n-self.change_ring(F)._pf_bfl()\n+(<Matrix> self.change_ring(F))._pf_bfl()\n```\nin the appropriate place so Cython knows the method exists.\n\n> Or do you suggest to rewrite `pfaffian` as well into Cython code?\n\nNo, that isn't worth it I think because the heavy lifting is done in the `_pf_bfl` method, which the end user will not see. (Although that is not to say that you shouldn't put some typing on things where appropriate.)",
    "created_at": "2020-09-29T12:26:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490023",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@mjungmath](#comment:11):
> The `_pf_bfl` method is invoked from a regular Python function. I am not a Cython expert, but shouldn't that be a `cpdef` function then?

No, because it is called within Cython code. You might need to change

```diff
-self.change_ring(F)._pf_bfl()
+(<Matrix> self.change_ring(F))._pf_bfl()
```
in the appropriate place so Cython knows the method exists.

> Or do you suggest to rewrite `pfaffian` as well into Cython code?

No, that isn't worth it I think because the heavy lifting is done in the `_pf_bfl` method, which the end user will not see. (Although that is not to say that you shouldn't put some typing on things where appropriate.)



---

archive/issue_comments_490024.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mjungmath](#comment:9):\n> One question that occurred to me is whether the division by integers always works in the (fraction) field. It should, but I am not sure whether Sage always converts the integers mathematically correct.\n\nWhen one of them is a Sage integer/rational/etc., then yes. If they are Python `int`s then they are handled like Python `int`s IIRC (although possibly like C `int`s). However, in response to your more general question, I believe the answer is yes.\n\n> Secondly, the algorithm should work for `QQ` algebras as well. I would guess, you can even assume an algebra over an integral domain of characteristic zero. Can you confirm that? But even if that works, it also depends on the answer of my first question.\n\nI am not sure what you are asking me here. I think the answer is yes, probably, but I am not sure.\n\n> Obviously, each ring constitutes an algebra over itself. But apparently, Sage doesn't recognize that. So, if the answer to all my above questions is \"yes\", how can we establish a general check for the matrix's base ring being an algebra over an integral domain with characteristic zero? And how would a conversion look like?\n\nWell, one option is to just try and and let it fail if it does something invalid. It just needs to be documented with what it is guaranteed to work for.",
    "created_at": "2020-09-29T12:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490024",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mjungmath](#comment:9):
> One question that occurred to me is whether the division by integers always works in the (fraction) field. It should, but I am not sure whether Sage always converts the integers mathematically correct.

When one of them is a Sage integer/rational/etc., then yes. If they are Python `int`s then they are handled like Python `int`s IIRC (although possibly like C `int`s). However, in response to your more general question, I believe the answer is yes.

> Secondly, the algorithm should work for `QQ` algebras as well. I would guess, you can even assume an algebra over an integral domain of characteristic zero. Can you confirm that? But even if that works, it also depends on the answer of my first question.

I am not sure what you are asking me here. I think the answer is yes, probably, but I am not sure.

> Obviously, each ring constitutes an algebra over itself. But apparently, Sage doesn't recognize that. So, if the answer to all my above questions is "yes", how can we establish a general check for the matrix's base ring being an algebra over an integral domain with characteristic zero? And how would a conversion look like?

Well, one option is to just try and and let it fail if it does something invalid. It just needs to be documented with what it is guaranteed to work for.



---

archive/issue_comments_490025.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266\"><code>d41151f</code></a></td><td><code>Trac #30681: first try BFL algorithm + Cythonized</code></td></tr></table>\n",
    "created_at": "2020-09-29T18:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490025",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266"><code>d41151f</code></a></td><td><code>Trac #30681: first try BFL algorithm + Cythonized</code></td></tr></table>




---

archive/issue_comments_490026.json:
```json
{
    "body": "Changed commit from **[`185e915`](https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599)** to **[`d41151f`](https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266)**",
    "created_at": "2020-09-29T18:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490026",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`185e915`](https://github.com/sagemath/sagetrac-mirror/commit/185e9158e3ff09c3944ed47e26a1ef05054c1599)** to **[`d41151f`](https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266)**



---

archive/issue_comments_490027.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nYou mean like that?",
    "created_at": "2020-09-29T18:43:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490027",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:15" align="right">comment:15</div>

You mean like that?



---

archive/issue_events_425131.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-29T18:43:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425131"
}
```



---

archive/issue_events_425132.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-09-29T18:43:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425132"
}
```



---

archive/issue_comments_490028.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324\"><code>7a6b9b1</code></a></td><td><code>Trac #30681: verbose if BFL fails + doc improved + import reverted</code></td></tr></table>\n",
    "created_at": "2020-09-29T21:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490028",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324"><code>7a6b9b1</code></a></td><td><code>Trac #30681: verbose if BFL fails + doc improved + import reverted</code></td></tr></table>




---

archive/issue_comments_490029.json:
```json
{
    "body": "Changed commit from **[`d41151f`](https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266)** to **[`7a6b9b1`](https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324)**",
    "created_at": "2020-09-29T21:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490029",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d41151f`](https://github.com/sagemath/sagetrac-mirror/commit/d41151f55294854879964cfb5b8f03eff4ed4266)** to **[`7a6b9b1`](https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324)**



---

archive/issue_comments_490030.json:
```json
{
    "body": "<div id=\"comment:17\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a\"><code>dc44a5a</code></a></td><td><code>Trac #30681: doc improved</code></td></tr></table>\n",
    "created_at": "2020-09-29T21:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490030",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:17"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a"><code>dc44a5a</code></a></td><td><code>Trac #30681: doc improved</code></td></tr></table>




---

archive/issue_comments_490031.json:
```json
{
    "body": "Changed commit from **[`7a6b9b1`](https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324)** to **[`dc44a5a`](https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a)**",
    "created_at": "2020-09-29T21:58:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490031",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7a6b9b1`](https://github.com/sagemath/sagetrac-mirror/commit/7a6b9b1af3c55b2a43794415f4beb99e1197a324)** to **[`dc44a5a`](https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a)**



---

archive/issue_comments_490032.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThe `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash). The other option would be doing `//` division, which then might return wrong results if the conditions set in the `.. WARNING::` are not satisfied.",
    "created_at": "2020-09-29T22:46:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490032",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:18" align="right">comment:18</div>

The `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash). The other option would be doing `//` division, which then might return wrong results if the conditions set in the `.. WARNING::` are not satisfied.



---

archive/issue_comments_490033.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@tscrim](#comment:18):\n> The `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash).\n\nThat was more or less my first thought, too. But think about examples like polynomial rings over `ZZ` where the element can be coerced into an element of `QQ[x]`. In that case, the fraction field setup is not necessary. In fact, if you already start with an `QQ` algebra that even has no fraction field implemented, the conversion to a fraction field will fail even though the algorithm would work. Thus, I would avoid going into the fraction field prior because it is not always the suitable choice.\n\nDo you have an example where no conversion would cause a crash?",
    "created_at": "2020-09-30T01:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490033",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@tscrim](#comment:18):
> The `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash).

That was more or less my first thought, too. But think about examples like polynomial rings over `ZZ` where the element can be coerced into an element of `QQ[x]`. In that case, the fraction field setup is not necessary. In fact, if you already start with an `QQ` algebra that even has no fraction field implemented, the conversion to a fraction field will fail even though the algorithm would work. Thus, I would avoid going into the fraction field prior because it is not always the suitable choice.

Do you have an example where no conversion would cause a crash?



---

archive/issue_comments_490034.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@mjungmath](#comment:19):\n> Replying to [@tscrim](#comment:18):\n> > The `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash).\n\n> \n> That was more or less my first thought, too. But think about examples like polynomial rings over `ZZ` where the element can be coerced into an element of `QQ[x]`. In that case, the fraction field setup is not necessary. In fact, if you already start with an `QQ` algebra that even has no fraction field implemented, the conversion to a fraction field will fail even though the algorithm would work. Thus, I would avoid going into the fraction field prior because it is not always the suitable choice.\n\nDivision could be a subtle thing in Sage whether it computes the pushout first or the fraction field first. This might warrant some testing.\n\n> Do you have an example where no conversion would cause a crash? \n\nSince it doesn't change the type of the matrix, the entries might be expected to be `Integer` but instead be set to `Rational`. The type mismatch would then lead to a crash.",
    "created_at": "2020-09-30T04:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490034",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@mjungmath](#comment:19):
> Replying to [@tscrim](#comment:18):
> > The `/` division will almost always convert to the fraction field, so there is no point in not first converting the initial matrix (in fact, this might even cause a crash).

> 
> That was more or less my first thought, too. But think about examples like polynomial rings over `ZZ` where the element can be coerced into an element of `QQ[x]`. In that case, the fraction field setup is not necessary. In fact, if you already start with an `QQ` algebra that even has no fraction field implemented, the conversion to a fraction field will fail even though the algorithm would work. Thus, I would avoid going into the fraction field prior because it is not always the suitable choice.

Division could be a subtle thing in Sage whether it computes the pushout first or the fraction field first. This might warrant some testing.

> Do you have an example where no conversion would cause a crash? 

Since it doesn't change the type of the matrix, the entries might be expected to be `Integer` but instead be set to `Rational`. The type mismatch would then lead to a crash.



---

archive/issue_comments_490035.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOkay, what do you suggest? Something like that perhaps? \n\n```python\ntry:\n    elt = R.zero() / 1 # try division by integers\n    F = elt.parent() # get parent\n    R(elt) # try conversion back\n    temp = <Matrix> self.change_ring(F)\n    ... \n```\n\nIf that succeeds, the matrix should be applicable for the BFL algorithm.",
    "created_at": "2020-09-30T07:47:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490035",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:21" align="right">comment:21</div>

Okay, what do you suggest? Something like that perhaps? 

```python
try:
    elt = R.zero() / 1 # try division by integers
    F = elt.parent() # get parent
    R(elt) # try conversion back
    temp = <Matrix> self.change_ring(F)
    ... 
```

If that succeeds, the matrix should be applicable for the BFL algorithm.



---

archive/issue_comments_490036.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nDifferent approach: the paper explains that you can simply go into the rationalization. Is Sage capable of that? I didn't find anything useful so far, but maybe I haven't looked closely enough.",
    "created_at": "2020-09-30T10:57:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490036",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:22" align="right">comment:22</div>

Different approach: the paper explains that you can simply go into the rationalization. Is Sage capable of that? I didn't find anything useful so far, but maybe I haven't looked closely enough.



---

archive/issue_comments_490037.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nI am not quite sure what you mean by the rationalization. I am guessing you don't mean the fraction field.\n\nActually, one thing you could do is\n\n```python\n        # Baer-Faddeev-Leverrier algorithm:\n        R = self._parent._base\n        for k in range(1, q):\n            c = R(-M.trace() / (2*k))\n            # add c along the diagonal\n            for i in range(n):\n                M.set_unsafe(i ,i, M.get_unsafe(i, i) + c)\n            M = A * M\n        c = R(-M.trace() / (2*q))\n        return (-1)**q * c\n```\nIt will be slightly slower for matrices over fields, but my guess is it wouldn't even be significant except in some possibly some really small examples. For non-fields, it would guarantee every element belongs to `R` after every division. However, this would then fail for Pfaffians over, e.g., `ZZ` because an intermediate computation needed to be in `QQ`.\n\nI think the best approach is probably converting the matrix to the fraction field, then coercing the result back to `R`.",
    "created_at": "2020-09-30T22:56:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490037",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

I am not quite sure what you mean by the rationalization. I am guessing you don't mean the fraction field.

Actually, one thing you could do is

```python
        # Baer-Faddeev-Leverrier algorithm:
        R = self._parent._base
        for k in range(1, q):
            c = R(-M.trace() / (2*k))
            # add c along the diagonal
            for i in range(n):
                M.set_unsafe(i ,i, M.get_unsafe(i, i) + c)
            M = A * M
        c = R(-M.trace() / (2*q))
        return (-1)**q * c
```
It will be slightly slower for matrices over fields, but my guess is it wouldn't even be significant except in some possibly some really small examples. For non-fields, it would guarantee every element belongs to `R` after every division. However, this would then fail for Pfaffians over, e.g., `ZZ` because an intermediate computation needed to be in `QQ`.

I think the best approach is probably converting the matrix to the fraction field, then coercing the result back to `R`.



---

archive/issue_comments_490038.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@tscrim](#comment:23):\n> I am not quite sure what you mean by the rationalization. I am guessing you don't mean the fraction field.\n\nAh, perhaps you mean extension of scalars to be a `QQ`-algebra. If this is the case, then Sage doesn't have this feature yet. You can change rings to be over `QQ`, but that won't work for algebras over, e.g., `ZZ['t']`. Well, I guess perhaps you could keep doing this until the base ring is itself:\n\n```\nsage: ZZ.base_ring()                                                                                                  \nInteger Ring\n```\nand then build new rings back. Although that feels a bit overkill right now as we can just go to the fraction field for this time with perhaps a `TODO` note.",
    "created_at": "2020-09-30T23:13:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490038",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@tscrim](#comment:23):
> I am not quite sure what you mean by the rationalization. I am guessing you don't mean the fraction field.

Ah, perhaps you mean extension of scalars to be a `QQ`-algebra. If this is the case, then Sage doesn't have this feature yet. You can change rings to be over `QQ`, but that won't work for algebras over, e.g., `ZZ['t']`. Well, I guess perhaps you could keep doing this until the base ring is itself:

```
sage: ZZ.base_ring()                                                                                                  
Integer Ring
```
and then build new rings back. Although that feels a bit overkill right now as we can just go to the fraction field for this time with perhaps a `TODO` note.



---

archive/issue_comments_490039.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nFraction fields and TODO, check. But what about `QQ` algebras in particular? This would be very beneficial for e.g. mixed forms.\n\nBesides, what do you think about my proposal in comment 21?",
    "created_at": "2020-10-01T07:01:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490039",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:25" align="right">comment:25</div>

Fraction fields and TODO, check. But what about `QQ` algebras in particular? This would be very beneficial for e.g. mixed forms.

Besides, what do you think about my proposal in comment 21?



---

archive/issue_comments_490040.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nMy first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach. Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing\n\n```python\ntry:\n    F = parent(R.one() / 2)\n    R(F.one())  # trivial check that we can go back\n    temp = <Matrix> self.change_ring(F)\n    ...\n```\nsince that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).",
    "created_at": "2020-10-01T07:49:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490040",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:26" align="right">comment:26</div>

My first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach. Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing

```python
try:
    F = parent(R.one() / 2)
    R(F.one())  # trivial check that we can go back
    temp = <Matrix> self.change_ring(F)
    ...
```
since that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).



---

archive/issue_comments_490041.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@tscrim](#comment:26):\n> My first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach.\n\nWhy do you think this is not a good approach?\n\nWhat about:\n\n```python\nF = R.base_ring()\nif QQ.is_subring(F):\n    pf = self._pf_bfl()\n```\n\nThis should work always.\n\n> Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing\n> \n> ```python\n> try:\n>     F = parent(R.one() / 2)\n>     R(F.one())  # trivial check that we can go back\n>     temp = <Matrix> self.change_ring(F)\n>     ...\n> ```\n> since that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).\n\nI have a bad feeling about this approach. There is still plenty of room what can go wrong here, isn't it? I peeked a bit into the matrix code; take a closer look at `with_added_multiple_of_row` in `matrix0.pyx`, there you want to multiply a row by an integer. Perhaps this is something we can adapt:\n\n```python\nF = Sequence([R.one()] + [1/(2*j) for j in range(1, k//2 + 1)]).universe()\nif F in Rings():\n    temp = <Matrix> self.change_ring(F)\n    pf = R(temp._pf_bfl())\n```\n\nI am not completely sure how and whether this works.",
    "created_at": "2020-10-01T08:32:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490041",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@tscrim](#comment:26):
> My first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach.

Why do you think this is not a good approach?

What about:

```python
F = R.base_ring()
if QQ.is_subring(F):
    pf = self._pf_bfl()
```

This should work always.

> Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing
> 
> ```python
> try:
>     F = parent(R.one() / 2)
>     R(F.one())  # trivial check that we can go back
>     temp = <Matrix> self.change_ring(F)
>     ...
> ```
> since that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).

I have a bad feeling about this approach. There is still plenty of room what can go wrong here, isn't it? I peeked a bit into the matrix code; take a closer look at `with_added_multiple_of_row` in `matrix0.pyx`, there you want to multiply a row by an integer. Perhaps this is something we can adapt:

```python
F = Sequence([R.one()] + [1/(2*j) for j in range(1, k//2 + 1)]).universe()
if F in Rings():
    temp = <Matrix> self.change_ring(F)
    pf = R(temp._pf_bfl())
```

I am not completely sure how and whether this works.



---

archive/issue_comments_490042.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@mjungmath](#comment:27):\n> Replying to [@tscrim](#comment:26):\n> > My first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach.\n\n> \n> Why do you think this is not a good approach?\n\nBecause you could have something over `ZZ['q'].fraction_field()`, or worse over `QQ.category()` (this was done to minimize the number of categories constructed when varying over prime fields).\n\n> What about:\n> \n> ```python\n> F = R.base_ring()\n> if QQ.is_subring(F):\n>     pf = self._pf_bfl()\n> ```\n> \n> This should work always.\n\nI am not entirely sure how much I trust that. It is more robust than I expected (I actually expected `QQ.is_subring(ZZ['t'].fraction_field())` to fail). From this check, I am comfortable enough to use this.\n\n> > Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing\n> > \n> > ```python\n> > try:\n> >     F = parent(R.one() / 2)\n> >     R(F.one())  # trivial check that we can go back\n> >     temp = <Matrix> self.change_ring(F)\n> >     ...\n> > ```\n> > since that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).\n\n> \n> I have a bad feeling about this approach. There is still plenty of room what can go wrong here, isn't it?\n\nIt would fail later on, but that is okay.\n\n> I peeked a bit into the matrix code; take a closer look at `with_added_multiple_of_row` in `matrix0.pyx`, there you want to multiply a row by an integer. Perhaps this is something we can adapt:\n> \n> ```python\n> F = Sequence([R.one()] + [1/(2*j) for j in range(1, k//2 + 1)]).universe()\n> temp = <Matrix> self.change_ring(F)\n> pf = R(temp._pf_bfl())\n> ```\n\nThere shouldn't be any difference between dividing by 2 or 4 or 6 (unless working over `GF(3)`, but like I said above, this would fail later on, which is okay with me). Perhaps the `QQ.is_subring()` approach is best. At a certain point, we might be putting too much thought into this.",
    "created_at": "2020-10-01T08:51:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490042",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@mjungmath](#comment:27):
> Replying to [@tscrim](#comment:26):
> > My first thought for `QQ` algebras would be to test the category, but then I am not so convinced this is a good approach.

> 
> Why do you think this is not a good approach?

Because you could have something over `ZZ['q'].fraction_field()`, or worse over `QQ.category()` (this was done to minimize the number of categories constructed when varying over prime fields).

> What about:
> 
> ```python
> F = R.base_ring()
> if QQ.is_subring(F):
>     pf = self._pf_bfl()
> ```
> 
> This should work always.

I am not entirely sure how much I trust that. It is more robust than I expected (I actually expected `QQ.is_subring(ZZ['t'].fraction_field())` to fail). From this check, I am comfortable enough to use this.

> > Your idea in [comment:21](#comment:21) should work unless an implementation does something very special for zero. I think you are better off doing
> > 
> > ```python
> > try:
> >     F = parent(R.one() / 2)
> >     R(F.one())  # trivial check that we can go back
> >     temp = <Matrix> self.change_ring(F)
> >     ...
> > ```
> > since that way it checks something non-trivial and that division is something that will actually be performed (so it will more quickly fail if you are working over `GF(2)`).

> 
> I have a bad feeling about this approach. There is still plenty of room what can go wrong here, isn't it?

It would fail later on, but that is okay.

> I peeked a bit into the matrix code; take a closer look at `with_added_multiple_of_row` in `matrix0.pyx`, there you want to multiply a row by an integer. Perhaps this is something we can adapt:
> 
> ```python
> F = Sequence([R.one()] + [1/(2*j) for j in range(1, k//2 + 1)]).universe()
> temp = <Matrix> self.change_ring(F)
> pf = R(temp._pf_bfl())
> ```

There shouldn't be any difference between dividing by 2 or 4 or 6 (unless working over `GF(3)`, but like I said above, this would fail later on, which is okay with me). Perhaps the `QQ.is_subring()` approach is best. At a certain point, we might be putting too much thought into this.



---

archive/issue_comments_490043.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@tscrim](#comment:28):\n> There shouldn't be any difference between dividing by 2 or 4 or 6 (unless working over `GF(3)`, but like I said above, this would fail later on, which is okay with me). Perhaps the `QQ.is_subring()` approach is best. At a certain point, we might be putting too much thought into this.\n\nExactly. The algorithm should also work if the ring's characteristic is bigger than the matrix dimension. This is also guaranteed by this approach. But perhaps you are right, we are putting too much thought into this.\n\nI think, this might be good:\n\n```python\nif R in IntegralDomains():\n    F = R.fraction_field()\n    temp = <Matrix> self.change_ring(F)\nelse:\n    F = R.base_ring()\n    temp = <Matrix> copy(self)\nif QQ.is_subring(F):\n    pf = R(temp._pf_bfl())\n```\n\nThis checks already make sure that the characteristic is zero even without using `characteristic` (which is good because the mixed form algebra for example does not have this method). Moreover, this guarantees the integer division to work.",
    "created_at": "2020-10-01T09:04:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490043",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@tscrim](#comment:28):
> There shouldn't be any difference between dividing by 2 or 4 or 6 (unless working over `GF(3)`, but like I said above, this would fail later on, which is okay with me). Perhaps the `QQ.is_subring()` approach is best. At a certain point, we might be putting too much thought into this.

Exactly. The algorithm should also work if the ring's characteristic is bigger than the matrix dimension. This is also guaranteed by this approach. But perhaps you are right, we are putting too much thought into this.

I think, this might be good:

```python
if R in IntegralDomains():
    F = R.fraction_field()
    temp = <Matrix> self.change_ring(F)
else:
    F = R.base_ring()
    temp = <Matrix> copy(self)
if QQ.is_subring(F):
    pf = R(temp._pf_bfl())
```

This checks already make sure that the characteristic is zero even without using `characteristic` (which is good because the mixed form algebra for example does not have this method). Moreover, this guarantees the integer division to work.



---

archive/issue_comments_490044.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e\"><code>81a1234</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>\n",
    "created_at": "2020-10-01T12:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490044",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e"><code>81a1234</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>




---

archive/issue_comments_490045.json:
```json
{
    "body": "Changed commit from **[`dc44a5a`](https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a)** to **[`81a1234`](https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e)**",
    "created_at": "2020-10-01T12:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490045",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dc44a5a`](https://github.com/sagemath/sagetrac-mirror/commit/dc44a5adf4a96c3fe53b1a1816b8668003a6bb3a)** to **[`81a1234`](https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e)**



---

archive/issue_comments_490046.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nCheck this out. This should be fine. The `QQ` sub-ring check is good enough to guarantee a working algorithm. And the number of applicable rings is reasonable. Ready for (final) review.",
    "created_at": "2020-10-01T12:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490046",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:31" align="right">comment:31</div>

Check this out. This should be fine. The `QQ` sub-ring check is good enough to guarantee a working algorithm. And the number of applicable rings is reasonable. Ready for (final) review.



---

archive/issue_comments_490047.json:
```json
{
    "body": "Changed commit from **[`81a1234`](https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e)** to **[`e1cc07a`](https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10)**",
    "created_at": "2020-10-01T12:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490047",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`81a1234`](https://github.com/sagemath/sagetrac-mirror/commit/81a12346099c1a1d1bdf1970b0dd522a6e7cb05e)** to **[`e1cc07a`](https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10)**



---

archive/issue_comments_490048.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10\"><code>e1cc07a</code></a></td><td><code>Trac #30681: improved doc</code></td></tr></table>\n",
    "created_at": "2020-10-01T12:30:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490048",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10"><code>e1cc07a</code></a></td><td><code>Trac #30681: improved doc</code></td></tr></table>




---

archive/issue_comments_490049.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9\"><code>ced33c9</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>\n",
    "created_at": "2020-10-01T17:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490049",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9"><code>ced33c9</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>




---

archive/issue_comments_490050.json:
```json
{
    "body": "Changed commit from **[`e1cc07a`](https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10)** to **[`ced33c9`](https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9)**",
    "created_at": "2020-10-01T17:34:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490050",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e1cc07a`](https://github.com/sagemath/sagetrac-mirror/commit/e1cc07a62988aef49eaffa7d6dad261b263fdb10)** to **[`ced33c9`](https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9)**



---

archive/issue_comments_490051.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nSquashed to one commit. The changes were negligible.",
    "created_at": "2020-10-01T17:38:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490051",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:34" align="right">comment:34</div>

Squashed to one commit. The changes were negligible.



---

archive/issue_events_425133.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-01T21:58:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425133"
}
```



---

archive/issue_events_425134.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-01T21:58:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425134"
}
```



---

archive/issue_comments_490052.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0\"><code>a8cceac</code></a></td><td><code>Trac #30681: base_ring check not enough for fraction fields, ZZ[x] as test added</code></td></tr></table>\n",
    "created_at": "2020-10-01T22:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490052",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0"><code>a8cceac</code></a></td><td><code>Trac #30681: base_ring check not enough for fraction fields, ZZ[x] as test added</code></td></tr></table>




---

archive/issue_comments_490053.json:
```json
{
    "body": "Changed commit from **[`ced33c9`](https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9)** to **[`a8cceac`](https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0)**",
    "created_at": "2020-10-01T22:10:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490053",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ced33c9`](https://github.com/sagemath/sagetrac-mirror/commit/ced33c96adcd60d9bbbfe899368e8bb5da297db9)** to **[`a8cceac`](https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0)**



---

archive/issue_events_425135.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-01T22:11:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425135"
}
```



---

archive/issue_events_425136.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-01T22:11:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425136"
}
```



---

archive/issue_comments_490054.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86\"><code>061df41</code></a></td><td><code>Trac #30681: base_ring check not robust</code></td></tr></table>\n",
    "created_at": "2020-10-01T22:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490054",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86"><code>061df41</code></a></td><td><code>Trac #30681: base_ring check not robust</code></td></tr></table>




---

archive/issue_comments_490055.json:
```json
{
    "body": "Changed commit from **[`a8cceac`](https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0)** to **[`061df41`](https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86)**",
    "created_at": "2020-10-01T22:22:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490055",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a8cceac`](https://github.com/sagemath/sagetrac-mirror/commit/a8cceac6028f2f71d136505ca0521bff59bf87e0)** to **[`061df41`](https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86)**



---

archive/issue_comments_490056.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nTurns out that `is_subring` is indeed **very** robust. Works for algebras such as mixed forms and scalar fields, too. Using `base_ring` was not a good idea, fails for e.g. fraction fields.\n\nSorry for the mess. I hope that should be it. If I should add any more tests/examples, let me know.",
    "created_at": "2020-10-01T22:28:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490056",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:39" align="right">comment:39</div>

Turns out that `is_subring` is indeed **very** robust. Works for algebras such as mixed forms and scalar fields, too. Using `base_ring` was not a good idea, fails for e.g. fraction fields.

Sorry for the mess. I hope that should be it. If I should add any more tests/examples, let me know.



---

archive/issue_comments_490057.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nMinor details:\n\n```diff\n-        Computes the Pfaffian of ``self`` using the Baer-Faddeev-LeVerrier\n-        algorithm. This method assumes that the base ring is an `\\QQ`-algebra.\n+        Computes the Pfaffian of ``self`` using the Baer-Faddeev-LeVerrier\n+        algorithm.\n+\n+        .. WARNING::\n+\n+            This method assumes that the base ring is an `\\QQ`-algebra.\n```\nAlso `Computes` -> `Compute` for `_pf_perfect_matchings` and bad comma spacing:\n\n```diff\n-M.set_unsafe(i ,i, M.get_unsafe(i, i) + c)\n+M.set_unsafe(i, i, M.get_unsafe(i, i) + c)\n```\n\nI would also put the `bfl` method as the first choice in the doc since it is the \"default\" choice.",
    "created_at": "2020-10-01T23:32:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490057",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:40" align="right">comment:40</div>

Minor details:

```diff
-        Computes the Pfaffian of ``self`` using the Baer-Faddeev-LeVerrier
-        algorithm. This method assumes that the base ring is an `\QQ`-algebra.
+        Computes the Pfaffian of ``self`` using the Baer-Faddeev-LeVerrier
+        algorithm.
+
+        .. WARNING::
+
+            This method assumes that the base ring is an `\QQ`-algebra.
```
Also `Computes` -> `Compute` for `_pf_perfect_matchings` and bad comma spacing:

```diff
-M.set_unsafe(i ,i, M.get_unsafe(i, i) + c)
+M.set_unsafe(i, i, M.get_unsafe(i, i) + c)
```

I would also put the `bfl` method as the first choice in the doc since it is the "default" choice.



---

archive/issue_comments_490058.json:
```json
{
    "body": "Changed commit from **[`061df41`](https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86)** to **[`6247a75`](https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814)**",
    "created_at": "2020-10-02T07:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490058",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`061df41`](https://github.com/sagemath/sagetrac-mirror/commit/061df4147ff2504d797f6dd6bef90c4183078b86)** to **[`6247a75`](https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814)**



---

archive/issue_comments_490059.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814\"><code>6247a75</code></a></td><td><code>Trac #30681: minor details</code></td></tr></table>\n",
    "created_at": "2020-10-02T07:25:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490059",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814"><code>6247a75</code></a></td><td><code>Trac #30681: minor details</code></td></tr></table>




---

archive/issue_comments_490060.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nDone. Thank you. :)",
    "created_at": "2020-10-02T07:25:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490060",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:42" align="right">comment:42</div>

Done. Thank you. :)



---

archive/issue_comments_490061.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-10-02T07:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490061",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_425137.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-10-02T07:37:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425137"
}
```



---

archive/issue_events_425138.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-10-02T07:37:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425138"
}
```



---

archive/issue_comments_490062.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThank you.",
    "created_at": "2020-10-02T07:37:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490062",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

Thank you.



---

archive/issue_comments_490063.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nThank *you* for the review. :)",
    "created_at": "2020-10-02T11:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490063",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:44" align="right">comment:44</div>

Thank *you* for the review. :)



---

archive/issue_comments_490064.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1\"><code>d28f8f8</code></a></td><td><code>Trac #30681: authorship and date added</code></td></tr></table>\n",
    "created_at": "2020-10-02T11:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490064",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1"><code>d28f8f8</code></a></td><td><code>Trac #30681: authorship and date added</code></td></tr></table>




---

archive/issue_events_425139.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-02T11:31:56Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425139"
}
```



---

archive/issue_events_425140.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-02T11:31:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425140"
}
```



---

archive/issue_comments_490065.json:
```json
{
    "body": "Changed commit from **[`6247a75`](https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814)** to **[`d28f8f8`](https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1)**",
    "created_at": "2020-10-02T11:31:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490065",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6247a75`](https://github.com/sagemath/sagetrac-mirror/commit/6247a7527d8428f6914c723ff9e57f6908818814)** to **[`d28f8f8`](https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1)**



---

archive/issue_comments_490066.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ffff7172371a0800d198710d04a5b9164020095\"><code>3ffff71</code></a></td><td><code># Das ist eine Kombination aus 3 Commits.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1\"><code>7211239</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>\n",
    "created_at": "2020-10-02T11:38:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490066",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ffff7172371a0800d198710d04a5b9164020095"><code>3ffff71</code></a></td><td><code># Das ist eine Kombination aus 3 Commits.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1"><code>7211239</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>




---

archive/issue_comments_490067.json:
```json
{
    "body": "Changed commit from **[`d28f8f8`](https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1)** to **[`7211239`](https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1)**",
    "created_at": "2020-10-02T11:38:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490067",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d28f8f8`](https://github.com/sagemath/sagetrac-mirror/commit/d28f8f8bfa237b43c3b08695b498e4daa5e312c1)** to **[`7211239`](https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1)**



---

archive/issue_comments_490068.json:
```json
{
    "body": "Changed commit from **[`7211239`](https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1)** to **[`5bb2792`](https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33)**",
    "created_at": "2020-10-02T11:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490068",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7211239`](https://github.com/sagemath/sagetrac-mirror/commit/7211239193f0bc03a32c2d29d5d2878de380c7c1)** to **[`5bb2792`](https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33)**



---

archive/issue_comments_490069.json:
```json
{
    "body": "<div id=\"comment:47\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33\"><code>5bb2792</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>\n",
    "created_at": "2020-10-02T11:41:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490069",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:47"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33"><code>5bb2792</code></a></td><td><code>Trac #30681: fast pfaffian</code></td></tr></table>




---

archive/issue_events_425141.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-02T11:43:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425141"
}
```



---

archive/issue_events_425142.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-02T11:43:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425142"
}
```



---

archive/issue_comments_490070.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nAdded authorship and date and screwed up the merge.",
    "created_at": "2020-10-02T11:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490070",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:48" align="right">comment:48</div>

Added authorship and date and screwed up the merge.



---

archive/issue_events_425143.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-03T21:16:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425143"
}
```



---

archive/issue_events_425144.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-03T21:16:44Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425144"
}
```



---

archive/issue_comments_490071.json:
```json
{
    "body": "<div id=\"comment:49\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945\"><code>b3b2a83</code></a></td><td><code>Trac #30681: cache functionality ensured</code></td></tr></table>\n",
    "created_at": "2020-10-03T21:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490071",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:49"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945"><code>b3b2a83</code></a></td><td><code>Trac #30681: cache functionality ensured</code></td></tr></table>




---

archive/issue_comments_490072.json:
```json
{
    "body": "Changed commit from **[`5bb2792`](https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33)** to **[`b3b2a83`](https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945)**",
    "created_at": "2020-10-03T21:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490072",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5bb2792`](https://github.com/sagemath/sagetrac-mirror/commit/5bb279286d8ad62e1804a39bb17ad475d1b71d33)** to **[`b3b2a83`](https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945)**



---

archive/issue_comments_490073.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI just noticed that I forgot to fetch the cached result. Commit is pushed.",
    "created_at": "2020-10-03T21:19:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490073",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:50" align="right">comment:50</div>

I just noticed that I forgot to fetch the cached result. Commit is pushed.



---

archive/issue_comments_490074.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nYes, that is good to use, although I think the cache check should be first. Once that is moved, you can set a positive review on my behalf.",
    "created_at": "2020-10-04T02:22:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490074",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:51" align="right">comment:51</div>

Yes, that is good to use, although I think the cache check should be first. Once that is moved, you can set a positive review on my behalf.



---

archive/issue_comments_490075.json:
```json
{
    "body": "Changed commit from **[`b3b2a83`](https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945)** to **[`1fc9e3b`](https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b)**",
    "created_at": "2020-10-04T08:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490075",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b3b2a83`](https://github.com/sagemath/sagetrac-mirror/commit/b3b2a83fa2cbb217c3aa09585c66aad2a8809945)** to **[`1fc9e3b`](https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b)**



---

archive/issue_comments_490076.json:
```json
{
    "body": "<div id=\"comment:52\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b\"><code>1fc9e3b</code></a></td><td><code>Trac #30681: fetch cached result first</code></td></tr></table>\n",
    "created_at": "2020-10-04T08:35:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490076",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:52"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b"><code>1fc9e3b</code></a></td><td><code>Trac #30681: fetch cached result first</code></td></tr></table>




---

archive/issue_events_425145.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-04T08:49:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425145"
}
```



---

archive/issue_events_425146.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-04T08:49:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425146"
}
```



---

archive/issue_comments_490077.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nThanks.",
    "created_at": "2020-10-04T08:49:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490077",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:53" align="right">comment:53</div>

Thanks.



---

archive/issue_comments_490078.json:
```json
{
    "body": "<div id=\"comment:54\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68\"><code>35ca1bd</code></a></td><td><code>Trac #30681: tautological test replaced due to caching</code></td></tr></table>\n",
    "created_at": "2020-10-04T12:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490078",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:54"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68"><code>35ca1bd</code></a></td><td><code>Trac #30681: tautological test replaced due to caching</code></td></tr></table>




---

archive/issue_events_425147.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-04T12:01:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425147"
}
```



---

archive/issue_events_425148.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-04T12:01:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425148"
}
```



---

archive/issue_comments_490079.json:
```json
{
    "body": "Changed commit from **[`1fc9e3b`](https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b)** to **[`35ca1bd`](https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68)**",
    "created_at": "2020-10-04T12:01:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490079",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1fc9e3b`](https://github.com/sagemath/sagetrac-mirror/commit/1fc9e3b543916d5a4360b3ed3b0d22e6fbd0b63b)** to **[`35ca1bd`](https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68)**



---

archive/issue_comments_490080.json:
```json
{
    "body": "<div id=\"comment:55\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838\"><code>a3ed6c3</code></a></td><td><code>Trac 30681: comment removed</code></td></tr></table>\n",
    "created_at": "2020-10-04T12:03:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490080",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:55"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838"><code>a3ed6c3</code></a></td><td><code>Trac 30681: comment removed</code></td></tr></table>




---

archive/issue_comments_490081.json:
```json
{
    "body": "Changed commit from **[`35ca1bd`](https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68)** to **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**",
    "created_at": "2020-10-04T12:03:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490081",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`35ca1bd`](https://github.com/sagemath/sagetrac-mirror/commit/35ca1bd77a9d74aa2bf5efc37efb5a5ac1996e68)** to **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**



---

archive/issue_events_425149.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-04T12:08:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425149"
}
```



---

archive/issue_events_425150.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-10-04T12:08:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425150"
}
```



---

archive/issue_events_425151.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425151"
}
```



---

archive/issue_events_425152.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425152"
}
```



---

archive/issue_comments_490082.json:
```json
{
    "body": "Changed branch from **[u/gh-mjungmath/baer_faddeev_leverrier](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/baer_faddeev_leverrier)** to **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**",
    "created_at": "2020-10-31T18:07:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30681#issuecomment-490082",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-mjungmath/baer_faddeev_leverrier](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/baer_faddeev_leverrier)** to **[`a3ed6c3`](https://github.com/sagemath/sagetrac-mirror/commit/a3ed6c3132c760ca967a55f4f10a925f8be06838)**



---

archive/issue_events_425153.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:07:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425153"
}
```



---

archive/issue_events_425154.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1b34ae5370515ee624202b2ad20c04cfac16385f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-10-31T18:07:07Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30681",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30681#event-425154"
}
```
