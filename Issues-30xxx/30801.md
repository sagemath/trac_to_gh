# Issue 30801: Upgrade: pari 2.13

archive/issues_030564.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nThis is to upgrade to PARI 2.13.x. https://repology.org/project/pari/versions\n\nThis new PARI release brings a lot of bug fixes,\nnew functionality, and speedups.\n\n- [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n\nChanges in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n\n```\n 34- bnfissunit is obsolete, use bnfisunit\n 35- bnfsunit is mostly obsolete, use bnfunits\n 36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used\n     to be a t_INTMOD)\n 1- Removed member functions .futu and .tufu [deprecated since 2.2], used in simon two descent scripts.\n 56- zetamultall: add flag\n```\n\nLast upgrade:\n\n- #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)\n\nFollow-up ticket: #31754\n\nUpstream: **Fixed upstream, but not in a stable release.**\n\nCC:  @dimpase @orlitzky @mkoeppe @slel @antonio-rojas @kiwifb @videlec @tobihan @collares @isuruf @dkwo @xcaruso @loefflerd @kliem\n\nComponent: **packages: standard**\n\nKeywords: **upgrade, pari**\n\nAuthor: **Vincent Delecroix, Antonio Rojas, Gonzalo Tornar\u00eda**\n\nBranch: **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**\n\nReviewer: **Dima Pasechnik, David Loeffler**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30801_\n\n",
    "closed_at": "2021-06-20T08:14:52Z",
    "created_at": "2020-10-20T12:53:48Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Upgrade: pari 2.13",
    "type": "issue",
    "updated_at": "2021-07-02T06:09:57Z",
    "url": "https://github.com/sagemath/sage/issues/30801",
    "user": "https://github.com/slel"
}
```
<div id="comment:0"></div>

This is to upgrade to PARI 2.13.x. https://repology.org/project/pari/versions

This new PARI release brings a lot of bug fixes,
new functionality, and speedups.

- [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)

Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code

```
 34- bnfissunit is obsolete, use bnfisunit
 35- bnfsunit is mostly obsolete, use bnfunits
 36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used
     to be a t_INTMOD)
 1- Removed member functions .futu and .tufu [deprecated since 2.2], used in simon two descent scripts.
 56- zetamultall: add flag
```

Last upgrade:

- #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)

Follow-up ticket: #31754

Upstream: **Fixed upstream, but not in a stable release.**

CC:  @dimpase @orlitzky @mkoeppe @slel @antonio-rojas @kiwifb @videlec @tobihan @collares @isuruf @dkwo @xcaruso @loefflerd @kliem

Component: **packages: standard**

Keywords: **upgrade, pari**

Author: **Vincent Delecroix, Antonio Rojas, Gonzalo Tornar√≠a**

Branch: **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**

Reviewer: **Dima Pasechnik, David Loeffler**

_Issue created by migration from https://trac.sagemath.org/ticket/30801_





---

archive/issue_events_421713.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-20T12:53:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421713"
}
```



---

archive/issue_events_421714.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-20T12:53:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20standard",
    "label_color": "0000b0",
    "label_name": "c: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421714"
}
```



---

archive/issue_events_421715.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-20T12:53:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421715"
}
```



---

archive/issue_events_421716.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-10-20T12:53:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421716"
}
```



---

archive/issue_comments_492602.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThis needs first a new cypari release including https://github.com/sagemath/cypari2/commit/1a4be24489c2e457727d76bf6dd71daa5c45aee4, otherwise it crashes immediately. After that, things don't look good:\n\n```\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/quadratic_forms/genera/genus.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/libs/pari/tests.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/libs/pari/__init__.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/structure/factorization.py  # 4 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/matrix/matrix2.pyx  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/coding/linear_code.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/arith/misc.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/fqf_orthogonal.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/abelian_gps/abelian_group.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/torsion_quadratic_module.py  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_module.py  # 30 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_morphism.py  # 5 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_element.py  # 8 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/parigp.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/books/judson-abstract-algebra/galois-sage.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/integer.pyx  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/complex_number.pyx  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/qqbar.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/polynomial_element.pyx  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_element.py  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/plural.pyx  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/function_field/function_field.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/residue_field.pyx  # 7 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/finite_field_constructor.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/integer_mod_ring.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/maps.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_rel.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/unit_group.py  # 17 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/S_unit_solver.py  # 8 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_element.pyx  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_ideal_rel.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/order.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_ideal.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/class_group.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gal_reps.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/height.py  # 6 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_torsion.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/period_lattice.py  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gp_simon.py  # 4 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/heegner.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/homset.py  # 3 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/points.py  # 9 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/chow_group.py  # 4 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/plane_conics/con_rational_function_field.py  # Timed out\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/geometry/cone.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/multiple_zeta.py  # 403 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/local_comp/smoothchar.py  # 2 doctests failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/local_comp/liftings.py  # 1 doctest failed\nsage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/modsym/p1list_nf.py  # 1 doctest failed\n```",
    "created_at": "2020-10-20T21:09:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492602",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:2" align="right">comment:2</div>

This needs first a new cypari release including https://github.com/sagemath/cypari2/commit/1a4be24489c2e457727d76bf6dd71daa5c45aee4, otherwise it crashes immediately. After that, things don't look good:

```
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/quadratic_forms/genera/genus.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/libs/pari/tests.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/libs/pari/__init__.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/structure/factorization.py  # 4 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/matrix/matrix2.pyx  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/coding/linear_code.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/arith/misc.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/fqf_orthogonal.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/abelian_gps/abelian_group.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/torsion_quadratic_module.py  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_module.py  # 30 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_morphism.py  # 5 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modules/fg_pid/fgp_element.py  # 8 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/parigp.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/books/judson-abstract-algebra/galois-sage.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/integer.pyx  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/complex_number.pyx  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/qqbar.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/polynomial_element.pyx  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_element.py  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/multi_polynomial_ideal.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/plural.pyx  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/function_field/function_field.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/residue_field.pyx  # 7 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/finite_field_constructor.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/finite_rings/integer_mod_ring.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/maps.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_rel.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/unit_group.py  # 17 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/S_unit_solver.py  # 8 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_element.pyx  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_ideal_rel.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/order.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field_ideal.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/rings/number_field/class_group.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gal_reps.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/height.py  # 6 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_number_field.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_torsion.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/period_lattice.py  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gp_simon.py  # 4 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_rational_field.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/ell_curve_isogeny.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/heegner.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/elliptic_curves/isogeny_small_degree.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/homset.py  # 3 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/points.py  # 9 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/toric/chow_group.py  # 4 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/schemes/plane_conics/con_rational_function_field.py  # Timed out
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/geometry/cone.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/multiple_zeta.py  # 403 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/local_comp/smoothchar.py  # 2 doctests failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/local_comp/liftings.py  # 1 doctest failed
sage -t --long --random-seed=0 /usr/lib/python3.8/site-packages/sage/modular/modsym/p1list_nf.py  # 1 doctest failed
```



---

archive/issue_comments_492603.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThe timeouts are hangs when calling nffactor. A minimal test case:\n\n```\nsage: K=NumberField(x^12 + 5, 't')\nsage: P.<x>=K[]\nsage: f=x^2 - 1\nsage: f.factor()\n```\n\nI've bisected it to upstream commit [1], but running the same code directly in gp works fine.\n\n[1] https://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=473226c477c674838de87f4aaa67939eaa2fb034",
    "created_at": "2020-10-23T18:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492603",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:3" align="right">comment:3</div>

The timeouts are hangs when calling nffactor. A minimal test case:

```
sage: K=NumberField(x^12 + 5, 't')
sage: P.<x>=K[]
sage: f=x^2 - 1
sage: f.factor()
```

I've bisected it to upstream commit [1], but running the same code directly in gp works fine.

[1] https://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=473226c477c674838de87f4aaa67939eaa2fb034



---

archive/issue_comments_492604.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nSo, the actual issue seems to be:\n\n```\nsage: pari(\"default\")\n...\n  primelimit = 0\n```\nIf I set primelimit to 0 in gp I can reproduce the hangs. Reported to cypari https://github.com/sagemath/cypari2/issues/96",
    "created_at": "2020-10-25T08:24:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492604",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:5" align="right">comment:5</div>

So, the actual issue seems to be:

```
sage: pari("default")
...
  primelimit = 0
```
If I set primelimit to 0 in gp I can reproduce the hangs. Reported to cypari https://github.com/sagemath/cypari2/issues/96



---

archive/issue_comments_492605.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAnother issue is the return of:\n\n\n```\n$ echo \"bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)\" | gp -qf\n```\n\n\nreturns:\n\n```\n[0, 2, 0]~\n```\n\n\nbut configure expects `[This is the Trac macro *0, 2, Mod* that was inherited from the migration called with arguments (0, 2))](https://trac.sagemath.org/wiki/WikiMacros#0, 2, Mod-macro)~`\n(from build/pkgs/pari/spkg-configure.m4)",
    "created_at": "2020-10-27T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492605",
    "user": "https://github.com/thierry-FreeBSD"
}
```

<div id="comment:6" align="right">comment:6</div>

Another issue is the return of:


```
$ echo "bnf = bnfinit(y^4-y-1); bnfisunit(bnf,-y^3+2*y^2-1)" | gp -qf
```


returns:

```
[0, 2, 0]~
```


but configure expects `[This is the Trac macro *0, 2, Mod* that was inherited from the migration called with arguments (0, 2))](https://trac.sagemath.org/wiki/WikiMacros#0, 2, Mod-macro)~`
(from build/pkgs/pari/spkg-configure.m4)



---

archive/issue_comments_492606.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nok, they changed the output format.\nThis is certainly easy to take care of.",
    "created_at": "2020-10-28T18:12:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492606",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

ok, they changed the output format.
This is certainly easy to take care of.



---

archive/issue_comments_492607.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n \n - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n \n+Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99\n+\n Last upgrade:\n \n - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)\n``````\n",
    "created_at": "2020-10-30T07:57:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492607",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 
 - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)
 
+Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99
+
 Last upgrade:
 
 - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)
``````




---

archive/issue_comments_492608.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,6 +7,15 @@\n \n Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99\n \n+Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n+\n+```\n+ 34- bnfissunit is obsolete, use bnfisunit\n+ 35- bnfsunit is mostly obsolete, use bnfunits\n+ 36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used\n+     to be a t_INTMOD)\n+```\n+\n Last upgrade:\n \n - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)\n``````\n",
    "created_at": "2020-11-01T12:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492608",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,6 +7,15 @@
 
 Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99
 
+Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code
+
+```
+ 34- bnfissunit is obsolete, use bnfisunit
+ 35- bnfsunit is mostly obsolete, use bnfunits
+ 36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used
+     to be a t_INTMOD)
+```
+
 Last upgrade:
 
 - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)
``````




---

archive/issue_comments_492609.json:
```json
{
    "body": "Author: **Vincent Delecroix**",
    "created_at": "2020-11-01T17:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492609",
    "user": "https://github.com/videlec"
}
```

Author: **Vincent Delecroix**



---

archive/issue_comments_492610.json:
```json
{
    "body": "Commit: **[`390d870`](https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c)**",
    "created_at": "2020-11-01T17:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492610",
    "user": "https://github.com/videlec"
}
```

Commit: **[`390d870`](https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c)**



---

archive/issue_comments_492611.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3df29d3415f46e8cb1326860934292d846f705b4\"><code>3df29d3</code></a></td><td><code>upgrade to pari 2.13.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e16c581f77ea2e473dcf0a7a804c34ea1b7c59df\"><code>e16c581</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68214e4937de578d7d1591d5f1d90989f9d8885b\"><code>68214e4</code></a></td><td><code>adapt libs/pari to 2.13.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec9fbb53e9ad339a09fe6637d9fcc8abc211a24e\"><code>ec9fbb5</code></a></td><td><code>doctests in libs/pari</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3af9483546b5e516d140165228531b25b480d9b9\"><code>3af9483</code></a></td><td><code>fix some doctests and discard .pari_nf() in number_field.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ace43954eb56fb5590fa9147858465c35f2774d5\"><code>ace4395</code></a></td><td><code>doctests in unit_group.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5358fc220e51ac911b5eee5ca45c4fa47b5df025\"><code>5358fc2</code></a></td><td><code>poldegree is now a GEN</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c\"><code>390d870</code></a></td><td><code>fix cygwin patch</code></td></tr></table>\n",
    "created_at": "2020-11-01T17:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492611",
    "user": "https://github.com/videlec"
}
```

<div id="comment:11"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3df29d3415f46e8cb1326860934292d846f705b4"><code>3df29d3</code></a></td><td><code>upgrade to pari 2.13.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e16c581f77ea2e473dcf0a7a804c34ea1b7c59df"><code>e16c581</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68214e4937de578d7d1591d5f1d90989f9d8885b"><code>68214e4</code></a></td><td><code>adapt libs/pari to 2.13.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec9fbb53e9ad339a09fe6637d9fcc8abc211a24e"><code>ec9fbb5</code></a></td><td><code>doctests in libs/pari</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3af9483546b5e516d140165228531b25b480d9b9"><code>3af9483</code></a></td><td><code>fix some doctests and discard .pari_nf() in number_field.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ace43954eb56fb5590fa9147858465c35f2774d5"><code>ace4395</code></a></td><td><code>doctests in unit_group.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5358fc220e51ac911b5eee5ca45c4fa47b5df025"><code>5358fc2</code></a></td><td><code>poldegree is now a GEN</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c"><code>390d870</code></a></td><td><code>fix cygwin patch</code></td></tr></table>




---

archive/issue_comments_492612.json:
```json
{
    "body": "Branch: **[u/vdelecroix/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/pari-2.13.0-cypari-2.1.2)**",
    "created_at": "2020-11-01T17:26:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492612",
    "user": "https://github.com/videlec"
}
```

Branch: **[u/vdelecroix/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/pari-2.13.0-cypari-2.1.2)**



---

archive/issue_comments_492613.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,11 @@\n-This is to upgrade to PARI 2.13.0, the new stable version of PARI.\n+This is to upgrade to PARI 2.13.0 and cypari to 2.1.2.\n \n This new PARI release brings a lot of bug fixes,\n new functionality, and speedups.\n \n - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n \n-Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99\n+cypari2 merge request in progress https://github.com/sagemath/cypari2/pull/99\n \n Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n \n``````\n",
    "created_at": "2020-11-01T17:28:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492613",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,11 @@
-This is to upgrade to PARI 2.13.0, the new stable version of PARI.
+This is to upgrade to PARI 2.13.0 and cypari to 2.1.2.
 
 This new PARI release brings a lot of bug fixes,
 new functionality, and speedups.
 
 - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)
 
-Needs an upgrade of cypari2: https://github.com/sagemath/cypari2/pull/99
+cypari2 merge request in progress https://github.com/sagemath/cypari2/pull/99
 
 Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code
 
``````




---

archive/issue_comments_492614.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nMany test failures are caused by pari having changed the normal Smith form algorithm, which now gives different transition matrices. Most of them are still correct, but it also has some unfortunate side effects:\n\n```\nsage: V=ZZ^2\nsage: W=span([[1,0],[0,6]],ZZ)\nsage: M=V/W\nsage: a=M[1]; a\n(1)\nsage: a.lift()\n(0, -1)\n```",
    "created_at": "2020-11-01T17:34:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492614",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:13" align="right">comment:13</div>

Many test failures are caused by pari having changed the normal Smith form algorithm, which now gives different transition matrices. Most of them are still correct, but it also has some unfortunate side effects:

```
sage: V=ZZ^2
sage: W=span([[1,0],[0,6]],ZZ)
sage: M=V/W
sage: a=M[1]; a
(1)
sage: a.lift()
(0, -1)
```



---

archive/issue_comments_492615.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,8 @@\n  35- bnfsunit is mostly obsolete, use bnfunits\n  36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used\n      to be a t_INTMOD)\n+ 1- Removed member functions .futu and .tufu [deprecated since 2.2], used in simon two descent scripts.\n+ 56- zetamultall: add flag\n ```\n \n Last upgrade:\n``````\n",
    "created_at": "2020-11-01T17:43:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492615",
    "user": "https://github.com/antonio-rojas"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,8 @@
  35- bnfsunit is mostly obsolete, use bnfunits
  36- bnfisunit and bnfissunit: torsion unit exponent is now a t_INT (used
      to be a t_INTMOD)
+ 1- Removed member functions .futu and .tufu [deprecated since 2.2], used in simon two descent scripts.
+ 56- zetamultall: add flag
 ```
 
 Last upgrade:
``````




---

archive/issue_comments_492616.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nOn Tuesday (November 3) from *14h to 17h* (UTC+2) there is a virtual PARI/GP workshop. I intend to discuss with Bill the cypari2 release and the adaptation in [SageMath](../wiki/SageMath). Anybody interested is more than welcome. Just send me a private e-mail so that I can forward the announcement.",
    "created_at": "2020-11-01T17:47:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492616",
    "user": "https://github.com/videlec"
}
```

<div id="comment:15" align="right">comment:15</div>

On Tuesday (November 3) from *14h to 17h* (UTC+2) there is a virtual PARI/GP workshop. I intend to discuss with Bill the cypari2 release and the adaptation in [SageMath](../wiki/SageMath). Anybody interested is more than welcome. Just send me a private e-mail so that I can forward the announcement.



---

archive/issue_comments_492617.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe update to cypari 2.1.2b causes some additional issues (not present in 2.1.1, both tested with pari 2.13)\n\n```\nFile \"/usr/lib/python3.8/site-packages/sage/rings/rational.pyx\", line 1450, in sage.rings.rational.Rational.is_norm\nFailed example:\n    7.is_norm(K)\nExpected:\n    Traceback (most recent call last):\n    ...\n    NotImplementedError: is_norm is not implemented unconditionally for norms from non-Galois number fields\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.rational.Rational.is_norm[13]>\", line 1, in <module>\n        Integer(7).is_norm(K)\n      File \"sage/rings/integer.pyx\", line 5443, in sage.rings.integer.Integer.is_norm (build/cythonized/sage/rings/integer.c:34562)\n        return QQ(self).is_norm(K, element=element, proof=proof)\n      File \"sage/rings/rational.pyx\", line 1464, in sage.rings.rational.Rational.is_norm (build/cythonized/sage/rings/rational.c:13741)\n        return self.is_norm(L, element=True, proof=proof)[0]\n      File \"sage/rings/rational.pyx\", line 1484, in sage.rings.rational.Rational.is_norm (build/cythonized/sage/rings/rational.c:14464)\n        M = L.galois_closure('a')\n      File \"/usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py\", line 8606, in galois_closure\n        L, self_into_L = self._galois_closure_and_embedding(names)\n      File \"/usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py\", line 8541, in _galois_closure_and_embedding\n        L, self_into_L = self.defining_polynomial().change_ring(self).splitting_field(names, map=True, degree_multiple=deg)\n      File \"sage/rings/polynomial/polynomial_element.pyx\", line 4635, in sage.rings.polynomial.polynomial_element.Polynomial.splitting_field (build/cythonized/sage/rings/polynomial/polynomial_element.c:39244)\n        return splitting_field(f, name, map, **kwds)\n      File \"/usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py\", line 454, in splitting_field\n        rel_degree_divisor = rel_degree_divisor.lcm(q.poldegree())\n      File \"sage/structure/element.pyx\", line 3917, in sage.structure.element.PrincipalIdealDomainElement.lcm (build/cythonized/sage/structure/element.c:24871)\n        return coercion_model.bin_op(self, right, lcm)\n      File \"sage/structure/coerce.pyx\", line 1248, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11304)\n        raise bin_op_exception(op, x, y)\n    TypeError: unsupported operand parent(s) for lcm: 'Integer Ring' and '<class 'cypari2.gen.Gen'>'\n```",
    "created_at": "2020-11-02T08:41:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492617",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:16" align="right">comment:16</div>

The update to cypari 2.1.2b causes some additional issues (not present in 2.1.1, both tested with pari 2.13)

```
File "/usr/lib/python3.8/site-packages/sage/rings/rational.pyx", line 1450, in sage.rings.rational.Rational.is_norm
Failed example:
    7.is_norm(K)
Expected:
    Traceback (most recent call last):
    ...
    NotImplementedError: is_norm is not implemented unconditionally for norms from non-Galois number fields
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.rational.Rational.is_norm[13]>", line 1, in <module>
        Integer(7).is_norm(K)
      File "sage/rings/integer.pyx", line 5443, in sage.rings.integer.Integer.is_norm (build/cythonized/sage/rings/integer.c:34562)
        return QQ(self).is_norm(K, element=element, proof=proof)
      File "sage/rings/rational.pyx", line 1464, in sage.rings.rational.Rational.is_norm (build/cythonized/sage/rings/rational.c:13741)
        return self.is_norm(L, element=True, proof=proof)[0]
      File "sage/rings/rational.pyx", line 1484, in sage.rings.rational.Rational.is_norm (build/cythonized/sage/rings/rational.c:14464)
        M = L.galois_closure('a')
      File "/usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py", line 8606, in galois_closure
        L, self_into_L = self._galois_closure_and_embedding(names)
      File "/usr/lib/python3.8/site-packages/sage/rings/number_field/number_field.py", line 8541, in _galois_closure_and_embedding
        L, self_into_L = self.defining_polynomial().change_ring(self).splitting_field(names, map=True, degree_multiple=deg)
      File "sage/rings/polynomial/polynomial_element.pyx", line 4635, in sage.rings.polynomial.polynomial_element.Polynomial.splitting_field (build/cythonized/sage/rings/polynomial/polynomial_element.c:39244)
        return splitting_field(f, name, map, **kwds)
      File "/usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py", line 454, in splitting_field
        rel_degree_divisor = rel_degree_divisor.lcm(q.poldegree())
      File "sage/structure/element.pyx", line 3917, in sage.structure.element.PrincipalIdealDomainElement.lcm (build/cythonized/sage/structure/element.c:24871)
        return coercion_model.bin_op(self, right, lcm)
      File "sage/structure/coerce.pyx", line 1248, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11304)
        raise bin_op_exception(op, x, y)
    TypeError: unsupported operand parent(s) for lcm: 'Integer Ring' and '<class 'cypari2.gen.Gen'>'
```



---

archive/issue_comments_492618.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nThis is the problematic line\n\n```\n      File \"/usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py\", line 454, in splitting_field\n        rel_degree_divisor = rel_degree_divisor.lcm(q.poldegree())\n```\n`poldgree` used to return an Python integer. But now that it is auto-generated in cypari it returns a `Gen` which is not accepted by `lcm`\n\n```\nsage: 4.lcm(pari(5))\nTraceback (most recent call last):\n...\nTypeError: unsupported operand parent(s) for lcm: 'Integer Ring' and '<class 'cypari2.gen.Gen'>'\n```\nSome of these poldegree are \"corrected\" in [commit 5358fc2](https://github.com/sagemath/sagetrac-mirror/commit/5358fc220e51ac911b5eee5ca45c4fa47b5df025).\n\nI see several solutions\n- manually add a `q.poldegree().sage()` to all the problematic calls\n- make sage gcd/lcm accepts pari integers\n- undo the change in cypari2 that makes poldgree returns a Gen\n- in cypari2, return a Pyton integer instead of a Pari integer when natural (ie something that can be used as an index: poldegree, length of vectors, ...)",
    "created_at": "2020-11-02T08:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492618",
    "user": "https://github.com/videlec"
}
```

<div id="comment:17" align="right">comment:17</div>

This is the problematic line

```
      File "/usr/lib/python3.8/site-packages/sage/rings/number_field/splitting_field.py", line 454, in splitting_field
        rel_degree_divisor = rel_degree_divisor.lcm(q.poldegree())
```
`poldgree` used to return an Python integer. But now that it is auto-generated in cypari it returns a `Gen` which is not accepted by `lcm`

```
sage: 4.lcm(pari(5))
Traceback (most recent call last):
...
TypeError: unsupported operand parent(s) for lcm: 'Integer Ring' and '<class 'cypari2.gen.Gen'>'
```
Some of these poldegree are "corrected" in [commit 5358fc2](https://github.com/sagemath/sagetrac-mirror/commit/5358fc220e51ac911b5eee5ca45c4fa47b5df025).

I see several solutions
- manually add a `q.poldegree().sage()` to all the problematic calls
- make sage gcd/lcm accepts pari integers
- undo the change in cypari2 that makes poldgree returns a Gen
- in cypari2, return a Pyton integer instead of a Pari integer when natural (ie something that can be used as an index: poldegree, length of vectors, ...)



---

archive/issue_comments_492619.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nTo my mind, fixing Sage `gcd/lcm` makes more sense.",
    "created_at": "2020-11-02T08:50:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492619",
    "user": "https://github.com/videlec"
}
```

<div id="comment:18" align="right">comment:18</div>

To my mind, fixing Sage `gcd/lcm` makes more sense.



---

archive/issue_comments_492620.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nRelated: the functions `gcd/lcm` are not commutative\n\n```\nsage: type(lcm(2, pari(3)))\n<class 'sage.rings.integer.Integer'>\nsage: type(lcm(pari(3), 2))\n<class 'cypari2.gen.Gen'>\n```",
    "created_at": "2020-11-02T08:51:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492620",
    "user": "https://github.com/videlec"
}
```

<div id="comment:19" align="right">comment:19</div>

Related: the functions `gcd/lcm` are not commutative

```
sage: type(lcm(2, pari(3)))
<class 'sage.rings.integer.Integer'>
sage: type(lcm(pari(3), 2))
<class 'cypari2.gen.Gen'>
```



---

archive/issue_comments_492621.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nSee #30849",
    "created_at": "2020-11-02T08:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492621",
    "user": "https://github.com/videlec"
}
```

<div id="comment:20" align="right">comment:20</div>

See #30849



---

archive/issue_comments_492622.json:
```json
{
    "body": "Dependencies: **#30849**",
    "created_at": "2020-11-02T08:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492622",
    "user": "https://github.com/videlec"
}
```

Dependencies: **#30849**



---

archive/issue_comments_492623.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75c1516f0abb9e6f8c335e38e4031f6ef674ed30\"><code>75c1516</code></a></td><td><code>make gcd/lcm of Integer works with gmpy2/pari types</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c675b40b2ea50d7b615132e6e6f805eb9191c04\"><code>8c675b4</code></a></td><td><code>upgrade to pari 2.13.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2833d068dd5d3eb768e2eddb84b3d19960f30188\"><code>2833d06</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/886e9d2c58077103bd97959ca76e95a5b447d1d7\"><code>886e9d2</code></a></td><td><code>adapt libs/pari to 2.13.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d93c350acf22b492b9835dcb74fe7eab190b8004\"><code>d93c350</code></a></td><td><code>doctests in libs/pari</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7fed64c55b4c776abfd81814a001fa42d317d81\"><code>b7fed64</code></a></td><td><code>fix some doctests and discard .pari_nf() in number_field.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4afd2acdea931f29c4e0ab3a0db1aa76ab8bb50\"><code>b4afd2a</code></a></td><td><code>doctests in unit_group.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35\"><code>7679cfa</code></a></td><td><code>fix cygwin patch</code></td></tr></table>\n",
    "created_at": "2020-11-02T10:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492623",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75c1516f0abb9e6f8c335e38e4031f6ef674ed30"><code>75c1516</code></a></td><td><code>make gcd/lcm of Integer works with gmpy2/pari types</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c675b40b2ea50d7b615132e6e6f805eb9191c04"><code>8c675b4</code></a></td><td><code>upgrade to pari 2.13.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2833d068dd5d3eb768e2eddb84b3d19960f30188"><code>2833d06</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/886e9d2c58077103bd97959ca76e95a5b447d1d7"><code>886e9d2</code></a></td><td><code>adapt libs/pari to 2.13.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d93c350acf22b492b9835dcb74fe7eab190b8004"><code>d93c350</code></a></td><td><code>doctests in libs/pari</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7fed64c55b4c776abfd81814a001fa42d317d81"><code>b7fed64</code></a></td><td><code>fix some doctests and discard .pari_nf() in number_field.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4afd2acdea931f29c4e0ab3a0db1aa76ab8bb50"><code>b4afd2a</code></a></td><td><code>doctests in unit_group.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35"><code>7679cfa</code></a></td><td><code>fix cygwin patch</code></td></tr></table>




---

archive/issue_comments_492624.json:
```json
{
    "body": "Changed commit from **[`390d870`](https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c)** to **[`7679cfa`](https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35)**",
    "created_at": "2020-11-02T10:15:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492624",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`390d870`](https://github.com/sagemath/sagetrac-mirror/commit/390d8709cda46fe6e0b77c60c333b1d66d00439c)** to **[`7679cfa`](https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35)**



---

archive/issue_comments_492625.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n(Rebased on top of #30849 dropping modification to gcd/lcm when poldegree is involved)",
    "created_at": "2020-11-02T10:16:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492625",
    "user": "https://github.com/videlec"
}
```

<div id="comment:22" align="right">comment:22</div>

(Rebased on top of #30849 dropping modification to gcd/lcm when poldegree is involved)



---

archive/issue_comments_492626.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f\"><code>e04727d</code></a></td><td><code>fix argument order in rnfisnorm call</code></td></tr></table>\n",
    "created_at": "2020-11-02T11:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492626",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f"><code>e04727d</code></a></td><td><code>fix argument order in rnfisnorm call</code></td></tr></table>




---

archive/issue_comments_492627.json:
```json
{
    "body": "Changed commit from **[`7679cfa`](https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35)** to **[`e04727d`](https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f)**",
    "created_at": "2020-11-02T11:16:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492627",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7679cfa`](https://github.com/sagemath/sagetrac-mirror/commit/7679cfa77b6a393bc7898865d43c3fb42a71cc35)** to **[`e04727d`](https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f)**



---

archive/issue_comments_492628.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e\"><code>92ad1bb</code></a></td><td><code>fix call to zetamultall</code></td></tr></table>\n",
    "created_at": "2020-11-02T12:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492628",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e"><code>92ad1bb</code></a></td><td><code>fix call to zetamultall</code></td></tr></table>




---

archive/issue_comments_492629.json:
```json
{
    "body": "Changed commit from **[`e04727d`](https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f)** to **[`92ad1bb`](https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e)**",
    "created_at": "2020-11-02T12:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492629",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e04727d`](https://github.com/sagemath/sagetrac-mirror/commit/e04727dcfc5bcc30601554480e247aee7fe7531f)** to **[`92ad1bb`](https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e)**



---

archive/issue_comments_492630.json:
```json
{
    "body": "Changed commit from **[`92ad1bb`](https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e)** to **[`1ce6c22`](https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689)**",
    "created_at": "2020-11-02T12:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492630",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`92ad1bb`](https://github.com/sagemath/sagetrac-mirror/commit/92ad1bbc57038f2b4f31b54b4af3aec05f95d21e)** to **[`1ce6c22`](https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689)**



---

archive/issue_comments_492631.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689\"><code>1ce6c22</code></a></td><td><code>fix invalid t_INT + t_INFINITY operation in multi_polynomial_ring.py</code></td></tr></table>\n",
    "created_at": "2020-11-02T12:57:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492631",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689"><code>1ce6c22</code></a></td><td><code>fix invalid t_INT + t_INFINITY operation in multi_polynomial_ring.py</code></td></tr></table>




---

archive/issue_comments_492632.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nFor Simon's scripts, this works for me:\n\n```\ndiff --git a/src/sage/ext_data/pari/simon/ell.gp b/src/sage/ext_data/pari/simon/ell.gp\nindex 74f0786646..21cff9cbb3 100644\n--- a/src/sage/ext_data/pari/simon/ell.gp\n+++ b/src/sage/ext_data/pari/simon/ell.gp\n@@ -1038,7 +1038,7 @@ if( DEBUGLEVEL_ell >= 1, print(\" trivial points on E(K) = \");\n   KS2gen = KS2gen[1];\n   for( i = 1, #KS2gen,\n     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));\n-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);\n+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);\n if( DEBUGLEVEL_ell >= 2,\n   print(\"  #K(b,2)gen          = \",#KS2gen);\n   print(\"  K(b,2)gen = \",KS2gen));\n@@ -1072,7 +1072,7 @@ if( DEBUGLEVEL_ell >= 1,\n   KS2gen = KS2gen[1];\n   for( i = 1, #KS2gen,\n     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));\n-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);\n+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);\n if( DEBUGLEVEL_ell >= 2,\n   print(\"  #K(a^2-4b,2)gen     = \",#KS2gen);\n   print(\"  K(a^2-4b,2)gen     = \",KS2gen));\n@@ -1244,11 +1244,11 @@ if( DEBUGLEVEL_ell >= 4, print(\"    bbbnf.clgp = \",bbbnf.clgp));\n   SL1 = idealmul(bbbnf,SL0,rnfeltup(rrrnf,bleg));\n   SL = idealfactor(bbbnf,SL1)[,1]~;\n   sunL = bnfsunit(bbbnf,SL);\n-  fondsunL = concat(bbbnf.futu,vector(#sunL[1],i,nfbasistoalg(bbbnf,sunL[1][i])));\n+  fondsunL = concat(concat(bbbnf.fu, bbbnf.tu[2]),vector(#sunL[1],i,nfbasistoalg(bbbnf,sunL[1][i])));\n   normfondsunL = vector(#fondsunL, i, norm(rnfeltabstorel(rrrnf,fondsunL[i])));\n   SK = idealfactor(bnf,idealnorm(bbbnf,SL1))[,1]~;\n   sunK = bnfsunit(bnf,SK);\n-  fondsunK = concat(bnf.futu,vector(#sunK[1],i,nfbasistoalg(bnf,sunK[1][i])));\n+  fondsunK = concat(concat(bnf.fu, bnf.tu[2]),vector(#sunK[1],i,nfbasistoalg(bnf,sunK[1][i])));\n   vecbleg = bnfissunit(bnf,sunK,bleg);\n   matnorm = matrix(#fondsunK,#normfondsunL,i,j,0);\n   for( i = 1, #normfondsunL,\n@@ -1345,7 +1345,7 @@ if( DEBUGLEVEL_ell >= 4, print(\"on factorise bb = \",bb));\n       sun = bnfsunit(bnf,idealfactor(bnf,bb)[,1]~);\n       fact = lift(bnfissunit(bnf,sun,bb));\n if( DEBUGLEVEL_ell >= 4, print(\"fact = \",fact));\n-      suni = concat(bnf.futu,vector(#sun[1],i,nfbasistoalg(bnf,sun[1][i])));\n+      suni = concat(concat(bnf.fu, bnf.tu[2]),vector(#sun[1],i,nfbasistoalg(bnf,sun[1][i])));\n       for( i = 1, #suni,\n         if( (f = fact[i]>>1), \n           test =0;\n@@ -1554,7 +1554,7 @@ if( DEBUGLEVEL_ell >= 3, print(\"    KS2gen = \",KS2gen[1]));\n \n   LS2gen = LS2gen[1];\n   LS2 = vector(#LS2gen,i,lift(nfbasistoalg(Lrnf,LS2gen[i])));\n-  LS2 = concat(lift(Lrnf.futu),LS2);\n+  LS2 = concat(lift(concat(Lrnf.fu, Lrnf.tu[2])),LS2);\n \n   LS2 = subst(LS2,'x,ttheta);\n   LS2 = LS2*Mod(1,polrel);\n@@ -1992,7 +1992,7 @@ if( DEBUGLEVEL_ell >= 2, print(\"  Algorithm of complete 2-descent\"));\n   KS2gen = KS2gen[1];\n   for( i = 1, #KS2gen,\n     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));\n-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);\n+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);\n if( DEBUGLEVEL_ell >= 2,\n   print(\"  #K(S,2)gen = \",#KS2gen);\n   print(\"   K(S,2)gen = \",KS2gen)\ndiff --git a/src/sage/ext_data/pari/simon/ellQ.gp b/src/sage/ext_data/pari/simon/ellQ.gp\nindex aede9fc941..27cc124372 100644\n--- a/src/sage/ext_data/pari/simon/ellQ.gp\n+++ b/src/sage/ext_data/pari/simon/ellQ.gp\n@@ -1162,7 +1162,7 @@ if( DEBUGLEVEL_ell >= 4, print(\"    kerval = \",kerval));\n       LS2gen[j]^kerval[j,i]));\n \n \\\\ Add the units\n-  LS2gen = concat(Mod(bnf[8][5],bnf.pol),LS2gen); \\\\ LS2gen = concat(bnf.fu,LS2gen);\n+  LS2gen = concat(bnf.fu,LS2gen); \\\\ LS2gen = concat(bnf.fu,LS2gen);\n \\\\ Add also the torsion unit if its order is divisible by p.\n   if( bnf[8][4][1]%p == 0, \\\\ if( bnf.tu[1]%p == 0,\n     LS2gen = concat( [Mod(bnf[8][4][2],bnf.pol)], LS2gen)); \\\\ LS2gen = concat( [Mod(bnf.tu[2],bnf.pol)], LS2gen));\n```",
    "created_at": "2020-11-03T08:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492632",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:26" align="right">comment:26</div>

For Simon's scripts, this works for me:

```
diff --git a/src/sage/ext_data/pari/simon/ell.gp b/src/sage/ext_data/pari/simon/ell.gp
index 74f0786646..21cff9cbb3 100644
--- a/src/sage/ext_data/pari/simon/ell.gp
+++ b/src/sage/ext_data/pari/simon/ell.gp
@@ -1038,7 +1038,7 @@ if( DEBUGLEVEL_ell >= 1, print(" trivial points on E(K) = ");
   KS2gen = KS2gen[1];
   for( i = 1, #KS2gen,
     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));
-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);
+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);
 if( DEBUGLEVEL_ell >= 2,
   print("  #K(b,2)gen          = ",#KS2gen);
   print("  K(b,2)gen = ",KS2gen));
@@ -1072,7 +1072,7 @@ if( DEBUGLEVEL_ell >= 1,
   KS2gen = KS2gen[1];
   for( i = 1, #KS2gen,
     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));
-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);
+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);
 if( DEBUGLEVEL_ell >= 2,
   print("  #K(a^2-4b,2)gen     = ",#KS2gen);
   print("  K(a^2-4b,2)gen     = ",KS2gen));
@@ -1244,11 +1244,11 @@ if( DEBUGLEVEL_ell >= 4, print("    bbbnf.clgp = ",bbbnf.clgp));
   SL1 = idealmul(bbbnf,SL0,rnfeltup(rrrnf,bleg));
   SL = idealfactor(bbbnf,SL1)[,1]~;
   sunL = bnfsunit(bbbnf,SL);
-  fondsunL = concat(bbbnf.futu,vector(#sunL[1],i,nfbasistoalg(bbbnf,sunL[1][i])));
+  fondsunL = concat(concat(bbbnf.fu, bbbnf.tu[2]),vector(#sunL[1],i,nfbasistoalg(bbbnf,sunL[1][i])));
   normfondsunL = vector(#fondsunL, i, norm(rnfeltabstorel(rrrnf,fondsunL[i])));
   SK = idealfactor(bnf,idealnorm(bbbnf,SL1))[,1]~;
   sunK = bnfsunit(bnf,SK);
-  fondsunK = concat(bnf.futu,vector(#sunK[1],i,nfbasistoalg(bnf,sunK[1][i])));
+  fondsunK = concat(concat(bnf.fu, bnf.tu[2]),vector(#sunK[1],i,nfbasistoalg(bnf,sunK[1][i])));
   vecbleg = bnfissunit(bnf,sunK,bleg);
   matnorm = matrix(#fondsunK,#normfondsunL,i,j,0);
   for( i = 1, #normfondsunL,
@@ -1345,7 +1345,7 @@ if( DEBUGLEVEL_ell >= 4, print("on factorise bb = ",bb));
       sun = bnfsunit(bnf,idealfactor(bnf,bb)[,1]~);
       fact = lift(bnfissunit(bnf,sun,bb));
 if( DEBUGLEVEL_ell >= 4, print("fact = ",fact));
-      suni = concat(bnf.futu,vector(#sun[1],i,nfbasistoalg(bnf,sun[1][i])));
+      suni = concat(concat(bnf.fu, bnf.tu[2]),vector(#sun[1],i,nfbasistoalg(bnf,sun[1][i])));
       for( i = 1, #suni,
         if( (f = fact[i]>>1), 
           test =0;
@@ -1554,7 +1554,7 @@ if( DEBUGLEVEL_ell >= 3, print("    KS2gen = ",KS2gen[1]));
 
   LS2gen = LS2gen[1];
   LS2 = vector(#LS2gen,i,lift(nfbasistoalg(Lrnf,LS2gen[i])));
-  LS2 = concat(lift(Lrnf.futu),LS2);
+  LS2 = concat(lift(concat(Lrnf.fu, Lrnf.tu[2])),LS2);
 
   LS2 = subst(LS2,'x,ttheta);
   LS2 = LS2*Mod(1,polrel);
@@ -1992,7 +1992,7 @@ if( DEBUGLEVEL_ell >= 2, print("  Algorithm of complete 2-descent"));
   KS2gen = KS2gen[1];
   for( i = 1, #KS2gen,
     KS2gen[i] = nfbasistoalg(bnf, KS2gen[i]));
-  KS2gen = concat(Mod(lift(bnf.tufu),bnf.pol),KS2gen);
+  KS2gen = concat(Mod(lift(concat(bnf.tu[2], bnf.fu)),bnf.pol),KS2gen);
 if( DEBUGLEVEL_ell >= 2,
   print("  #K(S,2)gen = ",#KS2gen);
   print("   K(S,2)gen = ",KS2gen)
diff --git a/src/sage/ext_data/pari/simon/ellQ.gp b/src/sage/ext_data/pari/simon/ellQ.gp
index aede9fc941..27cc124372 100644
--- a/src/sage/ext_data/pari/simon/ellQ.gp
+++ b/src/sage/ext_data/pari/simon/ellQ.gp
@@ -1162,7 +1162,7 @@ if( DEBUGLEVEL_ell >= 4, print("    kerval = ",kerval));
       LS2gen[j]^kerval[j,i]));
 
 \\ Add the units
-  LS2gen = concat(Mod(bnf[8][5],bnf.pol),LS2gen); \\ LS2gen = concat(bnf.fu,LS2gen);
+  LS2gen = concat(bnf.fu,LS2gen); \\ LS2gen = concat(bnf.fu,LS2gen);
 \\ Add also the torsion unit if its order is divisible by p.
   if( bnf[8][4][1]%p == 0, \\ if( bnf.tu[1]%p == 0,
     LS2gen = concat( [Mod(bnf[8][4][2],bnf.pol)], LS2gen)); \\ LS2gen = concat( [Mod(bnf.tu[2],bnf.pol)], LS2gen));
```



---

archive/issue_comments_492633.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875\"><code>264775b</code></a></td><td><code>Fix Denis Simon GP script (following A. Rojas)</code></td></tr></table>\n",
    "created_at": "2020-11-03T08:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492633",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875"><code>264775b</code></a></td><td><code>Fix Denis Simon GP script (following A. Rojas)</code></td></tr></table>




---

archive/issue_comments_492634.json:
```json
{
    "body": "Changed commit from **[`1ce6c22`](https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689)** to **[`264775b`](https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875)**",
    "created_at": "2020-11-03T08:09:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492634",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1ce6c22`](https://github.com/sagemath/sagetrac-mirror/commit/1ce6c2271115018f2eeeb1d487a2cb131bc46689)** to **[`264775b`](https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875)**



---

archive/issue_comments_492635.json:
```json
{
    "body": "<div id=\"comment:28\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae\"><code>165c470</code></a></td><td><code>fix units in number fields</code></td></tr></table>\n",
    "created_at": "2020-11-05T08:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492635",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:28"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae"><code>165c470</code></a></td><td><code>fix units in number fields</code></td></tr></table>




---

archive/issue_comments_492636.json:
```json
{
    "body": "Changed commit from **[`264775b`](https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875)** to **[`165c470`](https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae)**",
    "created_at": "2020-11-05T08:35:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492636",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`264775b`](https://github.com/sagemath/sagetrac-mirror/commit/264775b12d89cade4180370aae3e3cbf0da5f875)** to **[`165c470`](https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae)**



---

archive/issue_comments_492637.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nI think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs\n\n```\nsage: p = next_prime(10^40); q = next_prime(10^41)\nsage: K.<a> = NumberField(x^2 - p*q, maximize_at_primes=[p])\nsage: K.pari_nf()\n```\n(see doctest line 4134 in `sage/rings/number_field/number_field.py`)\n\nNB: In `unit_group.py` I am using methods `bnf_get_fu` and `bnf_get_tu` from `cypari2` that are not yet in `2.1.2b1`.",
    "created_at": "2020-11-05T08:41:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492637",
    "user": "https://github.com/videlec"
}
```

<div id="comment:29" align="right">comment:29</div>

I think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs

```
sage: p = next_prime(10^40); q = next_prime(10^41)
sage: K.<a> = NumberField(x^2 - p*q, maximize_at_primes=[p])
sage: K.pari_nf()
```
(see doctest line 4134 in `sage/rings/number_field/number_field.py`)

NB: In `unit_group.py` I am using methods `bnf_get_fu` and `bnf_get_tu` from `cypari2` that are not yet in `2.1.2b1`.



---

archive/issue_comments_492638.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@videlec](#comment%3A29):\n> I think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs\n\nIt doesn't really hang, it's just factoring the discriminant. See https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2257",
    "created_at": "2020-11-05T09:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492638",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@videlec](#comment%3A29):
> I think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs

It doesn't really hang, it's just factoring the discriminant. See https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2257



---

archive/issue_comments_492639.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nAny reason you're including the deprecation warnings for `Strchr` and `besseln` instead of replacing the functions themselves (with `strchr` and `bessely`)? Do we want to keep compatibility with older pari?",
    "created_at": "2020-11-05T09:05:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492639",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:31" align="right">comment:31</div>

Any reason you're including the deprecation warnings for `Strchr` and `besseln` instead of replacing the functions themselves (with `strchr` and `bessely`)? Do we want to keep compatibility with older pari?



---

archive/issue_comments_492640.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nNo. Let me change that.",
    "created_at": "2020-11-05T09:06:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492640",
    "user": "https://github.com/videlec"
}
```

<div id="comment:32" align="right">comment:32</div>

No. Let me change that.



---

archive/issue_comments_492641.json:
```json
{
    "body": "Changed commit from **[`165c470`](https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae)** to **[`db1f7a4`](https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89)**",
    "created_at": "2020-11-05T09:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492641",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`165c470`](https://github.com/sagemath/sagetrac-mirror/commit/165c470d30641da4d37e7042886c8bf70e1d40ae)** to **[`db1f7a4`](https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89)**



---

archive/issue_comments_492642.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8879b2c4cbe3f6879b64f6dc03edcb3699ac9b37\"><code>8879b2c</code></a></td><td><code>Strchr -> strchr and .besseln -> bessely</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f63e719c3074335c1fa491fd84bdddd43fe8908d\"><code>f63e719</code></a></td><td><code>add primes to pari when maximize_at_primes is provided</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7eac5c9977bde70ce3311e1b3dc9d62a242a8996\"><code>7eac5c9</code></a></td><td><code>use bnf_get_fu instead of bnfunit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89\"><code>db1f7a4</code></a></td><td><code>be more precise in documentation</code></td></tr></table>\n",
    "created_at": "2020-11-05T09:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492642",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8879b2c4cbe3f6879b64f6dc03edcb3699ac9b37"><code>8879b2c</code></a></td><td><code>Strchr -> strchr and .besseln -> bessely</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f63e719c3074335c1fa491fd84bdddd43fe8908d"><code>f63e719</code></a></td><td><code>add primes to pari when maximize_at_primes is provided</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7eac5c9977bde70ce3311e1b3dc9d62a242a8996"><code>7eac5c9</code></a></td><td><code>use bnf_get_fu instead of bnfunit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89"><code>db1f7a4</code></a></td><td><code>be more precise in documentation</code></td></tr></table>




---

archive/issue_comments_492643.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@antonio-rojas](#comment%3A30):\n> Replying to [@videlec](#comment%3A29):\n> > I think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs\n> \n> \n> It doesn't really hang, it's just factoring the discriminant. See https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2257\n\nIn [f63e719I](https://github.com/sagemath/sagetrac-mirror/commit/f63e719c3074335c1fa491fd84bdddd43fe8908d) I tweaked the `pari_nf` to add primes to pari in this situation so that discriminant factorizes. The doctests pass now.",
    "created_at": "2020-11-05T09:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492643",
    "user": "https://github.com/videlec"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@antonio-rojas](#comment%3A30):
> Replying to [@videlec](#comment%3A29):
> > I think all necessary adaptations in Sage code (not doctests) are done. The only remaining trouble is the following computation that now hangs
> 
> 
> It doesn't really hang, it's just factoring the discriminant. See https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2257

In [f63e719I](https://github.com/sagemath/sagetrac-mirror/commit/f63e719c3074335c1fa491fd84bdddd43fe8908d) I tweaked the `pari_nf` to add primes to pari in this situation so that discriminant factorizes. The doctests pass now.



---

archive/issue_comments_492644.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI'm also experiencing a hang in `sage/tests/parigp.py`, at\n\n```\nsage: pari('K = bnfinit(y^4-52*y^2+26,1); pol = rnfkummer(bnrinit(K,3,1),Mat(5)); L = rnfinit(K, pol); polredabs(polredbest(L.polabs))')  # long time\n```\n\nRunning the same code in gp gives a stack overflow\n\n```\n? pol = rnfkummer(bnrinit(K,3,1),Mat(5))\n  ***   at top-level: pol=rnfkummer(bnrinit(K,3,1),Mat(5))\n  ***                     ^--------------------------------\n  *** rnfkummer: the PARI stack overflows !\n  current stack size: 8000000 (7.629 Mbytes)\n  [hint] set 'parisizemax' to a nonzero value in your GPRC\n```",
    "created_at": "2020-11-05T10:20:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492644",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:35" align="right">comment:35</div>

I'm also experiencing a hang in `sage/tests/parigp.py`, at

```
sage: pari('K = bnfinit(y^4-52*y^2+26,1); pol = rnfkummer(bnrinit(K,3,1),Mat(5)); L = rnfinit(K, pol); polredabs(polredbest(L.polabs))')  # long time
```

Running the same code in gp gives a stack overflow

```
? pol = rnfkummer(bnrinit(K,3,1),Mat(5))
  ***   at top-level: pol=rnfkummer(bnrinit(K,3,1),Mat(5))
  ***                     ^--------------------------------
  *** rnfkummer: the PARI stack overflows !
  current stack size: 8000000 (7.629 Mbytes)
  [hint] set 'parisizemax' to a nonzero value in your GPRC
```



---

archive/issue_comments_492645.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nPARI doc says: `rnfkummer` is deprecated use `bnrclassfield`",
    "created_at": "2020-11-05T10:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492645",
    "user": "https://github.com/videlec"
}
```

<div id="comment:36" align="right">comment:36</div>

PARI doc says: `rnfkummer` is deprecated use `bnrclassfield`



---

archive/issue_comments_492646.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nIn GP, did you do add the relevant primes first?\n\n```\n? addprimes([31438243, 238576291, 18775387483, 24217212463267, 1427657500359111961, 135564809928627323997297867381959])\n```",
    "created_at": "2020-11-05T10:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492646",
    "user": "https://github.com/videlec"
}
```

<div id="comment:37" align="right">comment:37</div>

In GP, did you do add the relevant primes first?

```
? addprimes([31438243, 238576291, 18775387483, 24217212463267, 1427657500359111961, 135564809928627323997297867381959])
```



---

archive/issue_comments_492647.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@videlec](#comment%3A37):\n> In GP, did you do add the relevant primes first?\n> \n> ```\n> ? addprimes([31438243, 238576291, 18775387483, 24217212463267, 1427657500359111961, 135564809928627323997297867381959])\n> ```\n\nyes",
    "created_at": "2020-11-05T10:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492647",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@videlec](#comment%3A37):
> In GP, did you do add the relevant primes first?
> 
> ```
> ? addprimes([31438243, 238576291, 18775387483, 24217212463267, 1427657500359111961, 135564809928627323997297867381959])
> ```

yes



---

archive/issue_comments_492648.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n \n - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n \n-cypari2 merge request in progress https://github.com/sagemath/cypari2/pull/99\n+- [cypari2 2.1.2](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)\n \n Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n \n``````\n",
    "created_at": "2020-11-07T07:51:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492648",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 
 - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)
 
-cypari2 merge request in progress https://github.com/sagemath/cypari2/pull/99
+- [cypari2 2.1.2](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)
 
 Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code
 
``````




---

archive/issue_comments_492649.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n \n - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n \n-- [cypari2 2.1.2](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)\n+- [cypari2 2.1.2 on PyPI](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)\n \n Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n \n``````\n",
    "created_at": "2020-11-07T07:52:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492649",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 
 - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)
 
-- [cypari2 2.1.2](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)
+- [cypari2 2.1.2 on PyPI](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)
 
 Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code
 
``````




---

archive/issue_comments_492650.json:
```json
{
    "body": "Changed commit from **[`db1f7a4`](https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89)** to **[`4e43afd`](https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9)**",
    "created_at": "2020-11-07T07:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492650",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`db1f7a4`](https://github.com/sagemath/sagetrac-mirror/commit/db1f7a448fe2ddea0d839aa2354a8d03b0384f89)** to **[`4e43afd`](https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9)**



---

archive/issue_comments_492651.json:
```json
{
    "body": "<div id=\"comment:41\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9\"><code>4e43afd</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr></table>\n",
    "created_at": "2020-11-07T07:53:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492651",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:41"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9"><code>4e43afd</code></a></td><td><code>upgrade cypari2 to 2.1.2b1</code></td></tr></table>




---

archive/issue_comments_492652.json:
```json
{
    "body": "Changed commit from **[`4e43afd`](https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9)** to **[`b53bb87`](https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582)**",
    "created_at": "2020-11-07T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492652",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4e43afd`](https://github.com/sagemath/sagetrac-mirror/commit/4e43afdc511baf5b7880f8eae41bc56c9ca33bc9)** to **[`b53bb87`](https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582)**



---

archive/issue_comments_492653.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582\"><code>b53bb87</code></a></td><td><code>upgrade cypari2 to 2.1.2</code></td></tr></table>\n",
    "created_at": "2020-11-07T07:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492653",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582"><code>b53bb87</code></a></td><td><code>upgrade cypari2 to 2.1.2</code></td></tr></table>




---

archive/issue_comments_492654.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nRemaining elementary doctest failures\n\n```\nsage -t --random-seed=0 schemes/elliptic_curves/ell_rational_field.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/elliptic_curves/ell_number_field.py  # 3 doctests failed\nsage -t --random-seed=0 doctest/sources.py  # 1 doctest failed\nsage -t --random-seed=0 misc/sagedoc.py  # 4 doctests failed\nsage -t --random-seed=0 rings/number_field/number_field.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/elliptic_curves/isogeny_small_degree.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed\nsage -t --random-seed=0 modules/torsion_quadratic_module.py  # 3 doctests failed\nsage -t --random-seed=0 arith/misc.py  # 2 doctests failed\nsage -t --random-seed=0 groups/fqf_orthogonal.py  # 2 doctests failed\nsage -t --random-seed=0 quadratic_forms/genera/genus.py  # 2 doctests failed\nsage -t --random-seed=0 doctest/forker.py  # 1 doctest failed\nsage -t --random-seed=0 rings/polynomial/polynomial_element.pyx  # 1 doctest failed\nsage -t --random-seed=0 schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed\nsage -t --random-seed=0 schemes/toric/chow_group.py  # 3 doctests failed\nsage -t --random-seed=0 rings/finite_rings/finite_field_constructor.py  # 2 doctests failed\nsage -t --random-seed=0 rings/number_field/number_field_ideal.py  # 4 doctests failed\nsage -t --random-seed=0 schemes/elliptic_curves/ell_generic.py  # 1 doctest failed\nsage -t --random-seed=0 modular/local_comp/smoothchar.py  # 2 doctests failed\nsage -t --random-seed=0 rings/finite_rings/residue_field.pyx  # 7 doctests failed\nsage -t --random-seed=0 rings/number_field/number_field_rel.py  # 2 doctests failed\nsage -t --random-seed=0 modules/fg_pid/fgp_module.py  # 33 doctests failed\nsage -t --random-seed=0 rings/number_field/order.py  # 1 doctest failed\nsage -t --random-seed=0 rings/finite_rings/integer_mod_ring.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/elliptic_curves/period_lattice.py  # 1 doctest failed\nsage -t --random-seed=0 modular/modsym/p1list_nf.py  # 1 doctest failed\nsage -t --random-seed=0 rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed\nsage -t --random-seed=0 groups/abelian_gps/abelian_group.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/toric/points.py  # 9 doctests failed\nsage -t --random-seed=0 libs/pari/tests.py  # 2 doctests failed\nsage -t --random-seed=0 rings/number_field/number_field_ideal_rel.py  # 1 doctest failed\nsage -t --random-seed=0 rings/number_field/S_unit_solver.py  # 8 doctests failed\nsage -t --random-seed=0 modular/local_comp/liftings.py  # 1 doctest failed\nsage -t --random-seed=0 schemes/toric/homset.py  # 3 doctests failed\nsage -t --random-seed=0 all.py  # 1 doctest failed\nsage -t --random-seed=0 lfunctions/pari.py  # 1 doctest failed\nsage -t --random-seed=0 rings/number_field/unit_group.py  # 10 doctests failed\nsage -t --random-seed=0 tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed\nsage -t --random-seed=0 rings/number_field/class_group.py  # 2 doctests failed\nsage -t --random-seed=0 modules/fg_pid/fgp_morphism.py  # 5 doctests failed\nsage -t --random-seed=0 structure/factorization.py  # 4 doctests failed\nsage -t --random-seed=0 tests/books/judson-abstract-algebra/galois-sage.py  # 1 doctest failed\nsage -t --random-seed=0 modules/free_module_morphism.py  # 3 doctests failed\nsage -t --random-seed=0 groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed\nsage -t --random-seed=0 modules/fg_pid/fgp_element.py  # 8 doctests failed\nsage -t --random-seed=0 libs/pari/__init__.py  # 1 doctest failed\nsage -t --random-seed=0 docs/conf.py  # 1 doctest failed\nsage -t --random-seed=0 matrix/matrix1.pyx  # 1 doctest failed\nsage -t --random-seed=0 rings/number_field/number_field_element.pyx  # 3 doctests failed\nsage -t --random-seed=0 rings/integer.pyx  # 1 doctest failed\n```",
    "created_at": "2020-11-07T09:05:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492654",
    "user": "https://github.com/videlec"
}
```

<div id="comment:43" align="right">comment:43</div>

Remaining elementary doctest failures

```
sage -t --random-seed=0 schemes/elliptic_curves/ell_rational_field.py  # 1 doctest failed
sage -t --random-seed=0 schemes/elliptic_curves/ell_number_field.py  # 3 doctests failed
sage -t --random-seed=0 doctest/sources.py  # 1 doctest failed
sage -t --random-seed=0 misc/sagedoc.py  # 4 doctests failed
sage -t --random-seed=0 rings/number_field/number_field.py  # 1 doctest failed
sage -t --random-seed=0 schemes/elliptic_curves/isogeny_small_degree.py  # 1 doctest failed
sage -t --random-seed=0 schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed
sage -t --random-seed=0 modules/torsion_quadratic_module.py  # 3 doctests failed
sage -t --random-seed=0 arith/misc.py  # 2 doctests failed
sage -t --random-seed=0 groups/fqf_orthogonal.py  # 2 doctests failed
sage -t --random-seed=0 quadratic_forms/genera/genus.py  # 2 doctests failed
sage -t --random-seed=0 doctest/forker.py  # 1 doctest failed
sage -t --random-seed=0 rings/polynomial/polynomial_element.pyx  # 1 doctest failed
sage -t --random-seed=0 schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed
sage -t --random-seed=0 schemes/toric/chow_group.py  # 3 doctests failed
sage -t --random-seed=0 rings/finite_rings/finite_field_constructor.py  # 2 doctests failed
sage -t --random-seed=0 rings/number_field/number_field_ideal.py  # 4 doctests failed
sage -t --random-seed=0 schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
sage -t --random-seed=0 modular/local_comp/smoothchar.py  # 2 doctests failed
sage -t --random-seed=0 rings/finite_rings/residue_field.pyx  # 7 doctests failed
sage -t --random-seed=0 rings/number_field/number_field_rel.py  # 2 doctests failed
sage -t --random-seed=0 modules/fg_pid/fgp_module.py  # 33 doctests failed
sage -t --random-seed=0 rings/number_field/order.py  # 1 doctest failed
sage -t --random-seed=0 rings/finite_rings/integer_mod_ring.py  # 1 doctest failed
sage -t --random-seed=0 schemes/elliptic_curves/period_lattice.py  # 1 doctest failed
sage -t --random-seed=0 modular/modsym/p1list_nf.py  # 1 doctest failed
sage -t --random-seed=0 rings/polynomial/polynomial_quotient_ring.py  # 1 doctest failed
sage -t --random-seed=0 groups/abelian_gps/abelian_group.py  # 1 doctest failed
sage -t --random-seed=0 schemes/toric/points.py  # 9 doctests failed
sage -t --random-seed=0 libs/pari/tests.py  # 2 doctests failed
sage -t --random-seed=0 rings/number_field/number_field_ideal_rel.py  # 1 doctest failed
sage -t --random-seed=0 rings/number_field/S_unit_solver.py  # 8 doctests failed
sage -t --random-seed=0 modular/local_comp/liftings.py  # 1 doctest failed
sage -t --random-seed=0 schemes/toric/homset.py  # 3 doctests failed
sage -t --random-seed=0 all.py  # 1 doctest failed
sage -t --random-seed=0 lfunctions/pari.py  # 1 doctest failed
sage -t --random-seed=0 rings/number_field/unit_group.py  # 10 doctests failed
sage -t --random-seed=0 tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed
sage -t --random-seed=0 rings/number_field/class_group.py  # 2 doctests failed
sage -t --random-seed=0 modules/fg_pid/fgp_morphism.py  # 5 doctests failed
sage -t --random-seed=0 structure/factorization.py  # 4 doctests failed
sage -t --random-seed=0 tests/books/judson-abstract-algebra/galois-sage.py  # 1 doctest failed
sage -t --random-seed=0 modules/free_module_morphism.py  # 3 doctests failed
sage -t --random-seed=0 groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed
sage -t --random-seed=0 modules/fg_pid/fgp_element.py  # 8 doctests failed
sage -t --random-seed=0 libs/pari/__init__.py  # 1 doctest failed
sage -t --random-seed=0 docs/conf.py  # 1 doctest failed
sage -t --random-seed=0 matrix/matrix1.pyx  # 1 doctest failed
sage -t --random-seed=0 rings/number_field/number_field_element.pyx  # 3 doctests failed
sage -t --random-seed=0 rings/integer.pyx  # 1 doctest failed
```



---

archive/issue_comments_492655.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nUsing sage 9.2 with the patch from this ticket, when spkg-configure is checking whether the pari 2.13 Debian package is usable, the check\n\n```\nchecking whether bnfisunit bug of pari 2.11.3 is fixed...\n```\n\nnow returns no. The check passed with Debian's pari 2.11.4.",
    "created_at": "2020-11-13T10:48:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492655",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:44" align="right">comment:44</div>

Using sage 9.2 with the patch from this ticket, when spkg-configure is checking whether the pari 2.13 Debian package is usable, the check

```
checking whether bnfisunit bug of pari 2.11.3 is fixed...
```

now returns no. The check passed with Debian's pari 2.11.4.



---

archive/issue_comments_492656.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@tobihan](#comment%3A44):\n> Using sage 9.2 with the patch from this ticket, when spkg-configure is checking whether the pari 2.13 Debian package is usable, the check\n> \n> ```\n> checking whether bnfisunit bug of pari 2.11.3 is fixed...\n> ```\n> \n> now returns no. The check passed with Debian's pari 2.11.4.\n\nyes, this the question of correct output format, which changed, see\n[#30801 comment:6](https://github.com/sagemath/sage/issues/30801#comment:6)\n\nI've opened #30906 to fix this (the plan is to allow both formats, old and new)",
    "created_at": "2020-11-13T11:38:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492656",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@tobihan](#comment%3A44):
> Using sage 9.2 with the patch from this ticket, when spkg-configure is checking whether the pari 2.13 Debian package is usable, the check
> 
> ```
> checking whether bnfisunit bug of pari 2.11.3 is fixed...
> ```
> 
> now returns no. The check passed with Debian's pari 2.11.4.

yes, this the question of correct output format, which changed, see
[#30801 comment:6](https://github.com/sagemath/sage/issues/30801#comment:6)

I've opened #30906 to fix this (the plan is to allow both formats, old and new)



---

archive/issue_comments_492657.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nI see, thanks.",
    "created_at": "2020-11-13T11:41:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492657",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:46" align="right">comment:46</div>

I see, thanks.



---

archive/issue_comments_492658.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\n`build/pkgs/cypari/checksums.ini` needs `upstream_url`.\nAlso, perhaps the spkg should be renamed to `cypari2`?",
    "created_at": "2020-11-15T04:08:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492658",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

`build/pkgs/cypari/checksums.ini` needs `upstream_url`.
Also, perhaps the spkg should be renamed to `cypari2`?



---

archive/issue_events_421717.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-15T04:09:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "title_is": "Upgrade: pari 2.13, cypari2 2.1.2",
    "title_was": "Upgrade: pari 2.13",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421717"
}
```



---

archive/issue_comments_492659.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@antonio-rojas](#comment%3A35):\n> I'm also experiencing a hang in `sage/tests/parigp.py`, at\n> \n> ```\n> sage: pari('K = bnfinit(y^4-52*y^2+26,1); pol = rnfkummer(bnrinit(K,3,1),Mat(5)); L = rnfinit(K, pol); polredabs(polredbest(L.polabs))')  # long time\n> ```\n> \n> Running the same code in gp gives a stack overflow\n> \n> ```\n> ? pol = rnfkummer(bnrinit(K,3,1),Mat(5))\n>   ***   at top-level: pol=rnfkummer(bnrinit(K,3,1),Mat(5))\n>   ***                     ^--------------------------------\n>   *** rnfkummer: the PARI stack overflows !\n>   current stack size: 8000000 (7.629 Mbytes)\n>   [hint] set 'parisizemax' to a nonzero value in your GPRC\n> ```\n\nAfter setting parisizemax to 32000000, the rnfinit(K, pol) also seems to hang directly in gp.",
    "created_at": "2020-11-16T00:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492659",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@antonio-rojas](#comment%3A35):
> I'm also experiencing a hang in `sage/tests/parigp.py`, at
> 
> ```
> sage: pari('K = bnfinit(y^4-52*y^2+26,1); pol = rnfkummer(bnrinit(K,3,1),Mat(5)); L = rnfinit(K, pol); polredabs(polredbest(L.polabs))')  # long time
> ```
> 
> Running the same code in gp gives a stack overflow
> 
> ```
> ? pol = rnfkummer(bnrinit(K,3,1),Mat(5))
>   ***   at top-level: pol=rnfkummer(bnrinit(K,3,1),Mat(5))
>   ***                     ^--------------------------------
>   *** rnfkummer: the PARI stack overflows !
>   current stack size: 8000000 (7.629 Mbytes)
>   [hint] set 'parisizemax' to a nonzero value in your GPRC
> ```

After setting parisizemax to 32000000, the rnfinit(K, pol) also seems to hang directly in gp.



---

archive/issue_comments_492660.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nHere is the upstream bug report for the timeout, with an answer from Bill Allombert:\nhttps://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2259",
    "created_at": "2020-11-16T12:34:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492660",
    "user": "https://github.com/tobihan"
}
```

<div id="comment:50" align="right">comment:50</div>

Here is the upstream bug report for the timeout, with an answer from Bill Allombert:
https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2259



---

archive/issue_comments_492661.json:
```json
{
    "body": "Changed dependencies from **#30849** to **#30849, #31029**",
    "created_at": "2020-12-08T09:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492661",
    "user": "https://github.com/videlec"
}
```

Changed dependencies from **#30849** to **#30849, #31029**



---

archive/issue_events_421718.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2020-12-08T09:59:28Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "title_is": "Upgrade: pari 2.13",
    "title_was": "Upgrade: pari 2.13, cypari2 2.1.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421718"
}
```



---

archive/issue_comments_492662.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,9 @@\n-This is to upgrade to PARI 2.13.0 and cypari to 2.1.2.\n+This is to upgrade to PARI 2.13.0\n \n This new PARI release brings a lot of bug fixes,\n new functionality, and speedups.\n \n - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)\n-\n-- [cypari2 2.1.2 on PyPI](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)\n \n Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code\n \n``````\n",
    "created_at": "2020-12-08T09:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492662",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,9 @@
-This is to upgrade to PARI 2.13.0 and cypari to 2.1.2.
+This is to upgrade to PARI 2.13.0
 
 This new PARI release brings a lot of bug fixes,
 new functionality, and speedups.
 
 - [pari-2.13 release announcement](http://pari.math.u-bordeaux.fr/archives/pari-announce-20/msg00006.html)
-
-- [cypari2 2.1.2 on PyPI](https://files.pythonhosted.org/packages/22/d9/4374baf5749257362f6d163096f9f5a3fa2a6f231edbe0d61c7bdf281d6e/cypari2-2.1.2.tar.gz)
 
 Changes in the PARI library that needs adaptation in [SageMath](../wiki/SageMath) code
 
``````




---

archive/issue_comments_492663.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI decided to split cypari2 upgrade which is ready to go #31029.",
    "created_at": "2020-12-08T09:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492663",
    "user": "https://github.com/videlec"
}
```

<div id="comment:51" align="right">comment:51</div>

I decided to split cypari2 upgrade which is ready to go #31029.



---

archive/issue_comments_492664.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI don't know if it can be useful, but archlinux has a patch called `sagemath-pari-2.13.patch` here: https://aur.archlinux.org/cgit/aur.git/tree/?h=sagemath-git and debian too here: https://sources.debian.org/patches/sagemath/9.2-2/ (links from #31016)",
    "created_at": "2020-12-09T07:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492664",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:52" align="right">comment:52</div>

I don't know if it can be useful, but archlinux has a patch called `sagemath-pari-2.13.patch` here: https://aur.archlinux.org/cgit/aur.git/tree/?h=sagemath-git and debian too here: https://sources.debian.org/patches/sagemath/9.2-2/ (links from #31016)



---

archive/issue_comments_492665.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@seblabbe](#comment%3A52):\n> I don't know if it can be useful, but archlinux has a patch called `sagemath-pari-2.13.patch` here: https://aur.archlinux.org/cgit/aur.git/tree/?h=sagemath-git and debian too here: https://sources.debian.org/patches/sagemath/9.2-2/ (links from #31016)\n\nThe Arch one is essentially this branch plus some trivial test output fixes to account for the new Smith normal form output. The main remaining blocker is [comment:13](#comment%3A13) - adapt the free abelian group quotient construction to the Smith normal form changes. Does anybody know where the quotient map is defined?",
    "created_at": "2020-12-09T10:05:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492665",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@seblabbe](#comment%3A52):
> I don't know if it can be useful, but archlinux has a patch called `sagemath-pari-2.13.patch` here: https://aur.archlinux.org/cgit/aur.git/tree/?h=sagemath-git and debian too here: https://sources.debian.org/patches/sagemath/9.2-2/ (links from #31016)

The Arch one is essentially this branch plus some trivial test output fixes to account for the new Smith normal form output. The main remaining blocker is [comment:13](#comment%3A13) - adapt the free abelian group quotient construction to the Smith normal form changes. Does anybody know where the quotient map is defined?



---

archive/issue_comments_492666.json:
```json
{
    "body": "Changed dependencies from **#30849, #31029** to none",
    "created_at": "2021-01-17T19:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492666",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30849, #31029** to none



---

archive/issue_comments_492667.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nNeeds rebase",
    "created_at": "2021-01-17T19:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492667",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Needs rebase



---

archive/issue_comments_492668.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nAny progress here?",
    "created_at": "2021-03-01T00:03:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492668",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Any progress here?



---

archive/issue_comments_492669.json:
```json
{
    "body": "Changed branch from **[u/vdelecroix/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/pari-2.13.0-cypari-2.1.2)** to **[u/arojas/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/pari-2.13.0-cypari-2.1.2)**",
    "created_at": "2021-03-01T11:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492669",
    "user": "https://github.com/antonio-rojas"
}
```

Changed branch from **[u/vdelecroix/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/vdelecroix/pari-2.13.0-cypari-2.1.2)** to **[u/arojas/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/pari-2.13.0-cypari-2.1.2)**



---

archive/issue_comments_492670.json:
```json
{
    "body": "<div id=\"comment:57\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617\"><code>604dfe4</code></a></td><td><code>Update pari to 2.13.1</code></td></tr></table>\n",
    "created_at": "2021-03-01T11:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492670",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:57"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617"><code>604dfe4</code></a></td><td><code>Update pari to 2.13.1</code></td></tr></table>




---

archive/issue_comments_492671.json:
```json
{
    "body": "Changed commit from **[`b53bb87`](https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582)** to **[`604dfe4`](https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617)**",
    "created_at": "2021-03-01T11:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492671",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b53bb87`](https://github.com/sagemath/sagetrac-mirror/commit/b53bb878ff6cd78dd6e7c2344c994792087fc582)** to **[`604dfe4`](https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617)**



---

archive/issue_comments_492672.json:
```json
{
    "body": "<div id=\"comment:58\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813\"><code>574f98d</code></a></td><td><code>Fix merge</code></td></tr></table>\n",
    "created_at": "2021-03-01T17:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492672",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:58"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813"><code>574f98d</code></a></td><td><code>Fix merge</code></td></tr></table>




---

archive/issue_comments_492673.json:
```json
{
    "body": "Changed commit from **[`604dfe4`](https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617)** to **[`574f98d`](https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813)**",
    "created_at": "2021-03-01T17:11:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492673",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`604dfe4`](https://github.com/sagemath/sagetrac-mirror/commit/604dfe41ef8c5065eb90f1e3beb83ae9bbc15617)** to **[`574f98d`](https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813)**



---

archive/issue_comments_492674.json:
```json
{
    "body": "<div id=\"comment:59\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b148fa480060296c09ffcb35fcba08a0ba07cbc\"><code>3b148fa</code></a></td><td><code>Update doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e\"><code>b6c0c9a</code></a></td><td><code>Fix doctest failures caused by different choices of generators</code></td></tr></table>\n",
    "created_at": "2021-03-01T19:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492674",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:59"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b148fa480060296c09ffcb35fcba08a0ba07cbc"><code>3b148fa</code></a></td><td><code>Update doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e"><code>b6c0c9a</code></a></td><td><code>Fix doctest failures caused by different choices of generators</code></td></tr></table>




---

archive/issue_comments_492675.json:
```json
{
    "body": "Changed commit from **[`574f98d`](https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813)** to **[`b6c0c9a`](https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e)**",
    "created_at": "2021-03-01T19:12:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492675",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`574f98d`](https://github.com/sagemath/sagetrac-mirror/commit/574f98d5e069db4875b1b12851ed6b3b64b41813)** to **[`b6c0c9a`](https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e)**



---

archive/issue_comments_492676.json:
```json
{
    "body": "<div id=\"comment:60\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392\"><code>e99a203</code></a></td><td><code>Fix more tests</code></td></tr></table>\n",
    "created_at": "2021-03-01T19:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492676",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:60"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392"><code>e99a203</code></a></td><td><code>Fix more tests</code></td></tr></table>




---

archive/issue_comments_492677.json:
```json
{
    "body": "Changed commit from **[`b6c0c9a`](https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e)** to **[`e99a203`](https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392)**",
    "created_at": "2021-03-01T19:31:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492677",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6c0c9a`](https://github.com/sagemath/sagetrac-mirror/commit/b6c0c9a2c64ade403c829383e249694d6a5aa99e)** to **[`e99a203`](https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392)**



---

archive/issue_comments_492678.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nCan you merge https://github.com/sagemath/sagetrac-mirror/commit/ad702bf59ea7372ce12c37f53a18662cd9baee0b so that system pari-2.13 is accepted?",
    "created_at": "2021-03-08T18:50:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492678",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:61" align="right">comment:61</div>

Can you merge https://github.com/sagemath/sagetrac-mirror/commit/ad702bf59ea7372ce12c37f53a18662cd9baee0b so that system pari-2.13 is accepted?



---

archive/issue_comments_492679.json:
```json
{
    "body": "<div id=\"comment:62\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19\"><code>f79004d</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr></table>\n",
    "created_at": "2021-03-08T19:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492679",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:62"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19"><code>f79004d</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr></table>




---

archive/issue_comments_492680.json:
```json
{
    "body": "Changed commit from **[`e99a203`](https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392)** to **[`f79004d`](https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19)**",
    "created_at": "2021-03-08T19:05:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492680",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e99a203`](https://github.com/sagemath/sagetrac-mirror/commit/e99a2034a92ac4f399500db73fc2ca357401e392)** to **[`f79004d`](https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19)**



---

archive/issue_comments_492681.json:
```json
{
    "body": "<div id=\"comment:63\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6\"><code>4d92bca</code></a></td><td><code>do the bnfisunit check in Pari, not rely on output</code></td></tr></table>\n",
    "created_at": "2021-03-08T19:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492681",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:63"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6"><code>4d92bca</code></a></td><td><code>do the bnfisunit check in Pari, not rely on output</code></td></tr></table>




---

archive/issue_comments_492682.json:
```json
{
    "body": "Changed commit from **[`f79004d`](https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19)** to **[`4d92bca`](https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6)**",
    "created_at": "2021-03-08T19:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492682",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f79004d`](https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19)** to **[`4d92bca`](https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6)**



---

archive/issue_comments_492683.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nThanks. This is what I got with e99a203 using system pari-2.13.1 (voidlinux).\n\n```\n----------------------------------------------------------------------\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # 3 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/doc/en/thematic_tutorials/sandpile.rst  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/quadratic_forms/genera/genus.py  # 2 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/chow_group.py  # 3 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modular/local_comp/smoothchar.py  # 2 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/nf_galois_groups.rst  # 5 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modular/modsym/p1list_nf.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modules/torsion_quadratic_module.py  # 3 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/groups/fqf_orthogonal.py  # 2 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/period_lattice.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_module.py  # 30 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/points.py  # 9 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/groups/abelian_gps/abelian_group.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/libs/pari/tests.py  # 2 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/homset.py  # 3 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modular/local_comp/liftings.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/structure/factorization.py  # 4 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_morphism.py  # 5 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/tests/books/judson-abstract-algebra/galois-sage.py  # 1 doctest failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_element.py  # 8 doctests failed\nsage -t --warn-long 31.3 --random-seed=0 src/sage/libs/pari/__init__.py  # 1 doctest failed\n----------------------------------------------------------------------\n```\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19\"><code>f79004d</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6\"><code>4d92bca</code></a></td><td><code>do the bnfisunit check in Pari, not rely on output</code></td></tr></table>\n",
    "created_at": "2021-03-08T21:03:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492683",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:64" align="right">comment:64</div>

Thanks. This is what I got with e99a203 using system pari-2.13.1 (voidlinux).

```
----------------------------------------------------------------------
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # 3 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_rational_field.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/isogeny_small_degree.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/doc/en/thematic_tutorials/sandpile.rst  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/quadratic_forms/genera/genus.py  # 2 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/chow_group.py  # 3 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_generic.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modular/local_comp/smoothchar.py  # 2 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/doc/en/thematic_tutorials/explicit_methods_in_number_theory/nf_galois_groups.rst  # 5 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modular/modsym/p1list_nf.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modules/torsion_quadratic_module.py  # 3 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/groups/fqf_orthogonal.py  # 2 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/period_lattice.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/elliptic_curves/ell_finite_field.py  # 3 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_module.py  # 30 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/points.py  # 9 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/groups/abelian_gps/abelian_group.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/libs/pari/tests.py  # 2 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/schemes/toric/homset.py  # 3 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modular/local_comp/liftings.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/structure/factorization.py  # 4 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/tests/books/computational-mathematics-with-sagemath/linalg_doctest.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_morphism.py  # 5 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/tests/books/judson-abstract-algebra/galois-sage.py  # 1 doctest failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/groups/additive_abelian/additive_abelian_group.py  # 10 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/modules/fg_pid/fgp_element.py  # 8 doctests failed
sage -t --warn-long 31.3 --random-seed=0 src/sage/libs/pari/__init__.py  # 1 doctest failed
----------------------------------------------------------------------
```

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f79004d37b0d3852a429c1b4915a1635c1740f19"><code>f79004d</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6"><code>4d92bca</code></a></td><td><code>do the bnfisunit check in Pari, not rely on output</code></td></tr></table>




---

archive/issue_comments_492684.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nYes, this still needs a lot of work. In particular, someone needs to look into [comment:13](#comment%3A13)",
    "created_at": "2021-03-08T21:17:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492684",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:65" align="right">comment:65</div>

Yes, this still needs a lot of work. In particular, someone needs to look into [comment:13](#comment%3A13)



---

archive/issue_comments_492685.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nRegarding [comment:13](#comment%3A13), it seems to me an issue migth be that smith_form() is not \"idempotent\" and maybe abelian groups expect it to be, as in:\n- if X is already in smith form, then the output is (X, id, id)\nThis seems to be true in pari (both 2.11 and 2.13) and it seems to be true in sage using pari 2.11 but 'not' using pari 2.13.\n\nSage with pari 2.11:\n\n```\nsage: Matrix([[1,0],[0,6]]).smith_form()                                                                                                                                      \n(\n[1 0]  [1 0]  [1 0]\n[0 6], [0 1], [0 1]\n)\n```\n\nSage with pari 2.13:\n\n```\nsage: Matrix([[1,0],[0,6]]).smith_form()                                                                                                                                      \n(\n[1 0]  [ 1  1]  [ 1  6]\n[0 6], [ 0 -1], [ 0 -1]\n)\n```\n\nThe mismatch is that the smith form in sage is the reverse of the smith form in pari, and the way this is fixed is not \"stable\". It just happened to work with pari-2.11 by chance.\n\nIf this is the case, then a fix might be to reverse the matrix before passing it to pari, etc.\nIn fact, doing that fixes the issue in [comment:13](#comment%3A13), and it also fixes 9 out of 10 test failures in src/sage/groups/additive_abelian/additive_abelian_group.py. It doesn't seem to fix anything in src/sage/modules/fg_pid/fgp_element.py, or anything else, though.\n\nI didn't really look into additive abelian group, so I might be wrong.\n\nThe patch I'm trying is this:\n\n```\n--- a/src/sage/matrix/matrix_integer_dense.pyx\n+++ b/src/sage/matrix/matrix_integer_dense.pyx\n@@ -2444,7 +2444,8 @@ cdef class Matrix_integer_dense(Matrix_dense):\n \n            :meth:`elementary_divisors`\n         \"\"\"\n-        v = self.__pari__().matsnf(1).sage()\n+        X = self.matrix_space()([self[i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])\n+        v = X.__pari__().matsnf(1).sage()\n         # need to reverse order of rows of U, columns of V, and both of D.\n         D = self.matrix_space()([v[2][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])\n \n@@ -2460,13 +2461,13 @@ cdef class Matrix_integer_dense(Matrix_dense):\n             # silly special cases for matrices with 0 columns (PARI has a unique empty matrix)\n             U = self.matrix_space(ncols = self._nrows)(1)\n         else:\n-            U = self.matrix_space(ncols = self._nrows)([v[0][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._nrows)])\n+            U = self.matrix_space(ncols = self._nrows)([v[0][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._nrows-1,-1,-1)])\n \n         if self._nrows == 0:\n             # silly special cases for matrices with 0 rows (PARI has a unique empty matrix)\n             V = self.matrix_space(nrows = self._ncols)(1)\n         else:\n-            V = self.matrix_space(nrows = self._ncols)([v[1][i,j] for i in xrange(self._ncols) for j in xrange(self._ncols-1,-1,-1)])\n+            V = self.matrix_space(nrows = self._ncols)([v[1][i,j] for i in xrange(self._ncols-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])\n \n         return D, U, V\n \n```",
    "created_at": "2021-03-09T01:14:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492685",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:66" align="right">comment:66</div>

Regarding [comment:13](#comment%3A13), it seems to me an issue migth be that smith_form() is not "idempotent" and maybe abelian groups expect it to be, as in:
- if X is already in smith form, then the output is (X, id, id)
This seems to be true in pari (both 2.11 and 2.13) and it seems to be true in sage using pari 2.11 but 'not' using pari 2.13.

Sage with pari 2.11:

```
sage: Matrix([[1,0],[0,6]]).smith_form()                                                                                                                                      
(
[1 0]  [1 0]  [1 0]
[0 6], [0 1], [0 1]
)
```

Sage with pari 2.13:

```
sage: Matrix([[1,0],[0,6]]).smith_form()                                                                                                                                      
(
[1 0]  [ 1  1]  [ 1  6]
[0 6], [ 0 -1], [ 0 -1]
)
```

The mismatch is that the smith form in sage is the reverse of the smith form in pari, and the way this is fixed is not "stable". It just happened to work with pari-2.11 by chance.

If this is the case, then a fix might be to reverse the matrix before passing it to pari, etc.
In fact, doing that fixes the issue in [comment:13](#comment%3A13), and it also fixes 9 out of 10 test failures in src/sage/groups/additive_abelian/additive_abelian_group.py. It doesn't seem to fix anything in src/sage/modules/fg_pid/fgp_element.py, or anything else, though.

I didn't really look into additive abelian group, so I might be wrong.

The patch I'm trying is this:

```
--- a/src/sage/matrix/matrix_integer_dense.pyx
+++ b/src/sage/matrix/matrix_integer_dense.pyx
@@ -2444,7 +2444,8 @@ cdef class Matrix_integer_dense(Matrix_dense):
 
            :meth:`elementary_divisors`
         """
-        v = self.__pari__().matsnf(1).sage()
+        X = self.matrix_space()([self[i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])
+        v = X.__pari__().matsnf(1).sage()
         # need to reverse order of rows of U, columns of V, and both of D.
         D = self.matrix_space()([v[2][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])
 
@@ -2460,13 +2461,13 @@ cdef class Matrix_integer_dense(Matrix_dense):
             # silly special cases for matrices with 0 columns (PARI has a unique empty matrix)
             U = self.matrix_space(ncols = self._nrows)(1)
         else:
-            U = self.matrix_space(ncols = self._nrows)([v[0][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._nrows)])
+            U = self.matrix_space(ncols = self._nrows)([v[0][i,j] for i in xrange(self._nrows-1,-1,-1) for j in xrange(self._nrows-1,-1,-1)])
 
         if self._nrows == 0:
             # silly special cases for matrices with 0 rows (PARI has a unique empty matrix)
             V = self.matrix_space(nrows = self._ncols)(1)
         else:
-            V = self.matrix_space(nrows = self._ncols)([v[1][i,j] for i in xrange(self._ncols) for j in xrange(self._ncols-1,-1,-1)])
+            V = self.matrix_space(nrows = self._ncols)([v[1][i,j] for i in xrange(self._ncols-1,-1,-1) for j in xrange(self._ncols-1,-1,-1)])
 
         return D, U, V
 
```



---

archive/issue_comments_492686.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nThe patch in the last comment should be in branch [u/tornaria/pari-snf](https://github.com/sagemath/sagetrac-mirror/commit/u/tornaria/pari-snf), commit [f893a25](https://github.com/sagemath/sagetrac-mirror/commit/f893a259238ecc11924d8c577dac161646243e00).",
    "created_at": "2021-03-09T01:29:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492686",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:67" align="right">comment:67</div>

The patch in the last comment should be in branch [u/tornaria/pari-snf](https://github.com/sagemath/sagetrac-mirror/commit/u/tornaria/pari-snf), commit [f893a25](https://github.com/sagemath/sagetrac-mirror/commit/f893a259238ecc11924d8c577dac161646243e00).



---

archive/issue_comments_492687.json:
```json
{
    "body": "Changed commit from **[`4d92bca`](https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6)** to **[`9c8e76e`](https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f)**",
    "created_at": "2021-03-09T18:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492687",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4d92bca`](https://github.com/sagemath/sagetrac-mirror/commit/4d92bcae4f91005a1cd85a3509eaf6a159cdabe6)** to **[`9c8e76e`](https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f)**



---

archive/issue_comments_492688.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f\"><code>9c8e76e</code></a></td><td><code>try to make smith_form() 'idempotent'</code></td></tr></table>\n",
    "created_at": "2021-03-09T18:01:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492688",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f"><code>9c8e76e</code></a></td><td><code>try to make smith_form() 'idempotent'</code></td></tr></table>




---

archive/issue_comments_492689.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nReplying to [@tornaria](#comment%3A67):\n> The patch in the last comment should be in branch [u/tornaria/pari-snf](https://github.com/sagemath/sagetrac-mirror/commit/u/tornaria/pari-snf), commit [f893a25](https://github.com/sagemath/sagetrac-mirror/commit/f893a259238ecc11924d8c577dac161646243e00).\n> \n\nThanks, this looks reasonable and fixes the weirdnesses in abelian group quotients. Unfortunately it introduces a bunch of new test failures due the change of transition matrices, but those seem easy to deal with.",
    "created_at": "2021-03-09T18:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492689",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:69" align="right">comment:69</div>

Replying to [@tornaria](#comment%3A67):
> The patch in the last comment should be in branch [u/tornaria/pari-snf](https://github.com/sagemath/sagetrac-mirror/commit/u/tornaria/pari-snf), commit [f893a25](https://github.com/sagemath/sagetrac-mirror/commit/f893a259238ecc11924d8c577dac161646243e00).
> 

Thanks, this looks reasonable and fixes the weirdnesses in abelian group quotients. Unfortunately it introduces a bunch of new test failures due the change of transition matrices, but those seem easy to deal with.



---

archive/issue_comments_492690.json:
```json
{
    "body": "Changed author from **Vincent Delecroix** to **Vincent Delecroix, Antonio Rojas, Gonzalo Tornar\u00eda**",
    "created_at": "2021-03-09T18:03:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492690",
    "user": "https://github.com/antonio-rojas"
}
```

Changed author from **Vincent Delecroix** to **Vincent Delecroix, Antonio Rojas, Gonzalo Tornar√≠a**



---

archive/issue_comments_492691.json:
```json
{
    "body": "Changed commit from **[`9c8e76e`](https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f)** to **[`b2eac8c`](https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4)**",
    "created_at": "2021-03-09T19:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492691",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c8e76e`](https://github.com/sagemath/sagetrac-mirror/commit/9c8e76e055939be74aadeb49a4d9ed47a00ade1f)** to **[`b2eac8c`](https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4)**



---

archive/issue_comments_492692.json:
```json
{
    "body": "<div id=\"comment:70\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4\"><code>b2eac8c</code></a></td><td><code>Update some tests for new Smith form transition matrices</code></td></tr></table>\n",
    "created_at": "2021-03-09T19:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492692",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:70"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4"><code>b2eac8c</code></a></td><td><code>Update some tests for new Smith form transition matrices</code></td></tr></table>




---

archive/issue_comments_492693.json:
```json
{
    "body": "<div id=\"comment:71\" align=\"right\">comment:71</div>\n\nIt probably needs more work. In particular I think there may still be bad cases, so let's think a bit more about this.\n\nMy current thinking (after glancing at `smith_form_gens()` in `fgp_module.py`) that maybe something stronger is required, namely:\n\n- if `X` in HNF, the corresponding `U` is a permutation matrix and `U.V` is upper triangular with 1s in the diagonal or something like that\n\n\nOTOH I do wonder if this is really a strong requirement for correctness or just tradition.\n\nI mean: what exactly is wrong with the answer in [comment:13](#comment%3A13)? I mean: `(0,-1)` is indeed a generator of V/W. Granted we were expecting `(0,1)` but the answer is still correct, isn't it?\n\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4\"><code>b2eac8c</code></a></td><td><code>Update some tests for new Smith form transition matrices</code></td></tr></table>\n",
    "created_at": "2021-03-09T19:07:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492693",
    "user": "https://github.com/tornaria"
}
```

<div id="comment:71" align="right">comment:71</div>

It probably needs more work. In particular I think there may still be bad cases, so let's think a bit more about this.

My current thinking (after glancing at `smith_form_gens()` in `fgp_module.py`) that maybe something stronger is required, namely:

- if `X` in HNF, the corresponding `U` is a permutation matrix and `U.V` is upper triangular with 1s in the diagonal or something like that


OTOH I do wonder if this is really a strong requirement for correctness or just tradition.

I mean: what exactly is wrong with the answer in [comment:13](#comment%3A13)? I mean: `(0,-1)` is indeed a generator of V/W. Granted we were expecting `(0,1)` but the answer is still correct, isn't it?


---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4"><code>b2eac8c</code></a></td><td><code>Update some tests for new Smith form transition matrices</code></td></tr></table>




---

archive/issue_comments_492694.json:
```json
{
    "body": "Changed commit from **[`b2eac8c`](https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4)** to **[`52d48d5`](https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2)**",
    "created_at": "2021-03-13T20:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492694",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b2eac8c`](https://github.com/sagemath/sagetrac-mirror/commit/b2eac8c9b53d3f9fd5fa6c0da46a14be35dc4bb4)** to **[`52d48d5`](https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2)**



---

archive/issue_comments_492695.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6cc043fa3e8b51ca11c68fb13f4bd71c3fbb027b\"><code>6cc043f</code></a></td><td><code>Update some tests for different ideal and unit group generators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2\"><code>52d48d5</code></a></td><td><code>Fix some tests in sage.schemes.elliptic_curves</code></td></tr></table>\n",
    "created_at": "2021-03-13T20:23:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492695",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6cc043fa3e8b51ca11c68fb13f4bd71c3fbb027b"><code>6cc043f</code></a></td><td><code>Update some tests for different ideal and unit group generators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2"><code>52d48d5</code></a></td><td><code>Fix some tests in sage.schemes.elliptic_curves</code></td></tr></table>




---

archive/issue_comments_492696.json:
```json
{
    "body": "Changed commit from **[`52d48d5`](https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2)** to **[`bb3f783`](https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5)**",
    "created_at": "2021-03-17T20:02:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492696",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`52d48d5`](https://github.com/sagemath/sagetrac-mirror/commit/52d48d5105dad1b24c332db0ee73be01538c57c2)** to **[`bb3f783`](https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5)**



---

archive/issue_comments_492697.json:
```json
{
    "body": "<div id=\"comment:74\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10806839230fc2e32a18c9b187f596f3265a100a\"><code>1080683</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5\"><code>bb3f783</code></a></td><td><code>Fix a few more tests</code></td></tr></table>\n",
    "created_at": "2021-03-17T20:02:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492697",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:74"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10806839230fc2e32a18c9b187f596f3265a100a"><code>1080683</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5"><code>bb3f783</code></a></td><td><code>Fix a few more tests</code></td></tr></table>




---

archive/issue_comments_492698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-This is to upgrade to PARI 2.13.0\n+This is to upgrade to PARI 2.13.x. https://repology.org/project/pari/versions\n \n This new PARI release brings a lot of bug fixes,\n new functionality, and speedups.\n``````\n",
    "created_at": "2021-03-17T20:09:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492698",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-This is to upgrade to PARI 2.13.0
+This is to upgrade to PARI 2.13.x. https://repology.org/project/pari/versions
 
 This new PARI release brings a lot of bug fixes,
 new functionality, and speedups.
``````




---

archive/issue_comments_492699.json:
```json
{
    "body": "<div id=\"comment:76\" align=\"right\">comment:76</div>\n\nIs the plan to drop support for system PARI < 2.13.1? Then `spkg-configure.m4` will need changing",
    "created_at": "2021-03-17T20:11:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492699",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:76" align="right">comment:76</div>

Is the plan to drop support for system PARI < 2.13.1? Then `spkg-configure.m4` will need changing



---

archive/issue_comments_492700.json:
```json
{
    "body": "<div id=\"comment:77\" align=\"right\">comment:77</div>\n\nI think it's OK to drop older PARIs. Several Linux distros (Debian, Gentoo, arch (I guess)) and Homebrew already carry PARI 2.13. \n\nIt seems that only Conda is behind. Isuru, is Conda's PARI update in the works?",
    "created_at": "2021-03-19T10:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492700",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:77" align="right">comment:77</div>

I think it's OK to drop older PARIs. Several Linux distros (Debian, Gentoo, arch (I guess)) and Homebrew already carry PARI 2.13. 

It seems that only Conda is behind. Isuru, is Conda's PARI update in the works?



---

archive/issue_comments_492701.json:
```json
{
    "body": "<div id=\"comment:78\" align=\"right\">comment:78</div>\n\nDo you know whether the error `isirreducible: symbol not found` that I get in #31392 is related to this ticket?",
    "created_at": "2021-03-19T12:12:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492701",
    "user": "https://github.com/dkwo"
}
```

<div id="comment:78" align="right">comment:78</div>

Do you know whether the error `isirreducible: symbol not found` that I get in #31392 is related to this ticket?



---

archive/issue_comments_492702.json:
```json
{
    "body": "<div id=\"comment:80\" align=\"right\">comment:80</div>\n\nReplying to [@dkwo](#comment%3A78):\n> Do you know whether the error `isirreducible: symbol not found` that I get in #31392 is related to this ticket?\n\nMost probably (there you build Sage 9.2 with system's Pari 2.13, if I am not mistaken). Try to apply the branch from here and see if it helps.",
    "created_at": "2021-03-19T12:56:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492702",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:80" align="right">comment:80</div>

Replying to [@dkwo](#comment%3A78):
> Do you know whether the error `isirreducible: symbol not found` that I get in #31392 is related to this ticket?

Most probably (there you build Sage 9.2 with system's Pari 2.13, if I am not mistaken). Try to apply the branch from here and see if it helps.



---

archive/issue_comments_492703.json:
```json
{
    "body": "<div id=\"comment:81\" align=\"right\">comment:81</div>\n\nReplying to [@dimpase](#comment%3A77):\n> It seems that only Conda is behind. Isuru, is Conda's PARI update in the works?\n\nI don't have plans yet, but a PR is always welcome.",
    "created_at": "2021-03-19T15:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492703",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:81" align="right">comment:81</div>

Replying to [@dimpase](#comment%3A77):
> It seems that only Conda is behind. Isuru, is Conda's PARI update in the works?

I don't have plans yet, but a PR is always welcome.



---

archive/issue_comments_492704.json:
```json
{
    "body": "Changed commit from **[`bb3f783`](https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5)** to **[`a476ca3`](https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76)**",
    "created_at": "2021-03-19T20:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492704",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bb3f783`](https://github.com/sagemath/sagetrac-mirror/commit/bb3f783b30a02fb09113950d12b7cb73df4311d5)** to **[`a476ca3`](https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76)**



---

archive/issue_comments_492705.json:
```json
{
    "body": "<div id=\"comment:82\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d66a90523f5aaaff7d559d21497872b2eb866178\"><code>d66a905</code></a></td><td><code>Fix some more tests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55afe2e7590b822b2d901a7fe08040d4aa9196fb\"><code>55afe2e</code></a></td><td><code>Fix timeout in sage/tests/parigp.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76\"><code>a476ca3</code></a></td><td><code>Fix some tests in sage.schemes.toric</code></td></tr></table>\n",
    "created_at": "2021-03-19T20:03:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492705",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:82"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d66a90523f5aaaff7d559d21497872b2eb866178"><code>d66a905</code></a></td><td><code>Fix some more tests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55afe2e7590b822b2d901a7fe08040d4aa9196fb"><code>55afe2e</code></a></td><td><code>Fix timeout in sage/tests/parigp.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76"><code>a476ca3</code></a></td><td><code>Fix some tests in sage.schemes.toric</code></td></tr></table>




---

archive/issue_comments_492706.json:
```json
{
    "body": "<div id=\"comment:83\" align=\"right\">comment:83</div>\n\nReplying to [@tornaria](#comment%3A71):\n> It probably needs more work. In particular I think there may still be bad cases, so let's think a bit more about this.\n> \n> My current thinking (after glancing at `smith_form_gens()` in `fgp_module.py`) that maybe something stronger is required, namely:\n> \n> - if `X` in HNF, the corresponding `U` is a permutation matrix and `U.V` is upper triangular with 1s in the diagonal or something like that\n> \n> \n> OTOH I do wonder if this is really a strong requirement for correctness or just tradition.\n> \n> I mean: what exactly is wrong with the answer in [comment:13](#comment%3A13)? I mean: `(0,-1)` is indeed a generator of V/W. Granted we were expecting `(0,1)` but the answer is still correct, isn't it?\n> \n\nSo, how do we proceed? Sure, both answers are mathematically correct, strictly speaking. But the fact that things like this now give the \"natural\" answer makes me think that your change is an overall improvement:\n\n```\nsage: V = ZZ^3; W = V.span([2*V.0, 2*V.1, 2*V.2])                                                                                                         \nsage: Q = V/W                                                                                                                                             \nsage: Q.gens()                                                                                                                                            \n((1, 0, 0), (0, 1, 0), (0, 0, 1))\nsage: [x.lift() for x in Q.gens()]                                                                                                                        \n[(1, 0, 0), (0, 1, 0), (0, 0, 1)]\n```\n\nBefore:\n\n```\nsage: [x.lift() for x in Q.gens()]                                                                                                                        \n[(0, 0, 1), (0, 1, 0), (1, 0, 0)]\n```",
    "created_at": "2021-03-20T12:03:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492706",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:83" align="right">comment:83</div>

Replying to [@tornaria](#comment%3A71):
> It probably needs more work. In particular I think there may still be bad cases, so let's think a bit more about this.
> 
> My current thinking (after glancing at `smith_form_gens()` in `fgp_module.py`) that maybe something stronger is required, namely:
> 
> - if `X` in HNF, the corresponding `U` is a permutation matrix and `U.V` is upper triangular with 1s in the diagonal or something like that
> 
> 
> OTOH I do wonder if this is really a strong requirement for correctness or just tradition.
> 
> I mean: what exactly is wrong with the answer in [comment:13](#comment%3A13)? I mean: `(0,-1)` is indeed a generator of V/W. Granted we were expecting `(0,1)` but the answer is still correct, isn't it?
> 

So, how do we proceed? Sure, both answers are mathematically correct, strictly speaking. But the fact that things like this now give the "natural" answer makes me think that your change is an overall improvement:

```
sage: V = ZZ^3; W = V.span([2*V.0, 2*V.1, 2*V.2])                                                                                                         
sage: Q = V/W                                                                                                                                             
sage: Q.gens()                                                                                                                                            
((1, 0, 0), (0, 1, 0), (0, 0, 1))
sage: [x.lift() for x in Q.gens()]                                                                                                                        
[(1, 0, 0), (0, 1, 0), (0, 0, 1)]
```

Before:

```
sage: [x.lift() for x in Q.gens()]                                                                                                                        
[(0, 0, 1), (0, 1, 0), (1, 0, 0)]
```



---

archive/issue_comments_492707.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\n\n```\nsage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed\nsage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed\n```\n\nThese fail because pari throws multiple `precision too low for generators, not given.` warnings. Is this something we should care about, or should we just filter them out?",
    "created_at": "2021-03-20T12:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492707",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:84" align="right">comment:84</div>


```
sage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed
```

These fail because pari throws multiple `precision too low for generators, not given.` warnings. Is this something we should care about, or should we just filter them out?



---

archive/issue_comments_492708.json:
```json
{
    "body": "<div id=\"comment:85\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/614463165bc3d28e099537dd7cf7ab0af31bf3e7\"><code>6144631</code></a></td><td><code>Fix doctests in sage.modular for new basis choices</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98\"><code>273b2b2</code></a></td><td><code>Fix some tests in sage/schemes/elliptic_curves</code></td></tr></table>\n",
    "created_at": "2021-03-20T12:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492708",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:85"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/614463165bc3d28e099537dd7cf7ab0af31bf3e7"><code>6144631</code></a></td><td><code>Fix doctests in sage.modular for new basis choices</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98"><code>273b2b2</code></a></td><td><code>Fix some tests in sage/schemes/elliptic_curves</code></td></tr></table>




---

archive/issue_comments_492709.json:
```json
{
    "body": "Changed commit from **[`a476ca3`](https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76)** to **[`273b2b2`](https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98)**",
    "created_at": "2021-03-20T12:55:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492709",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a476ca3`](https://github.com/sagemath/sagetrac-mirror/commit/a476ca3f24fea5afaef64a1f6225719050b79d76)** to **[`273b2b2`](https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98)**



---

archive/issue_comments_492710.json:
```json
{
    "body": "<div id=\"comment:86\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e3be5e5d1c47658dcd41a7e3585a9b4d092b3acf\"><code>e3be5e5</code></a></td><td><code>Update tests for new precision() function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9\"><code>c3f2aad</code></a></td><td><code>Update tests for updated quadhilbert() output in pari</code></td></tr></table>\n",
    "created_at": "2021-03-20T18:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492710",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:86"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e3be5e5d1c47658dcd41a7e3585a9b4d092b3acf"><code>e3be5e5</code></a></td><td><code>Update tests for new precision() function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9"><code>c3f2aad</code></a></td><td><code>Update tests for updated quadhilbert() output in pari</code></td></tr></table>




---

archive/issue_comments_492711.json:
```json
{
    "body": "Changed commit from **[`273b2b2`](https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98)** to **[`c3f2aad`](https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9)**",
    "created_at": "2021-03-20T18:50:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492711",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`273b2b2`](https://github.com/sagemath/sagetrac-mirror/commit/273b2b2868c0cd7163b6676d2b769c582bbd3f98)** to **[`c3f2aad`](https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9)**



---

archive/issue_comments_492712.json:
```json
{
    "body": "<div id=\"comment:87\" align=\"right\">comment:87</div>\n\nwhat is the status here? still \"needs work\"?",
    "created_at": "2021-03-24T13:58:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492712",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:87" align="right">comment:87</div>

what is the status here? still "needs work"?



---

archive/issue_comments_492713.json:
```json
{
    "body": "<div id=\"comment:88\" align=\"right\">comment:88</div>\n\nReplying to [@dimpase](#comment%3A87):\n> what is the status here? still \"needs work\"?\n\nyes (a lot)",
    "created_at": "2021-03-24T14:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492713",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:88" align="right">comment:88</div>

Replying to [@dimpase](#comment%3A87):
> what is the status here? still "needs work"?

yes (a lot)



---

archive/issue_events_421719.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T17:26:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421719"
}
```



---

archive/issue_events_421720.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T17:26:37Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421720"
}
```



---

archive/issue_comments_492714.json:
```json
{
    "body": "Changed commit from **[`c3f2aad`](https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9)** to **[`756781e`](https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd)**",
    "created_at": "2021-03-27T19:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492714",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c3f2aad`](https://github.com/sagemath/sagetrac-mirror/commit/c3f2aad8fe17d92629994a395e9982b95aaff1e9)** to **[`756781e`](https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd)**



---

archive/issue_comments_492715.json:
```json
{
    "body": "<div id=\"comment:90\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/46864450d83a79fdbf777eacf7b956047202053a\"><code>4686445</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec66c3c0c839b07523daf9b472acdc72d3a7acf7\"><code>ec66c3c</code></a></td><td><code>Change example to one where the is actually no coercion map</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7843d805dd56e5f1ed54eb3fbbf51c33534393\"><code>7c7843d</code></a></td><td><code>Fix tests in sage.geometry for new lattice generators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3dc3251626e71237c2d2bda6ff54d4310639356e\"><code>3dc3251</code></a></td><td><code>Fix tests in sage.schemes.toric for new lattice generators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/530914d0f848e6e894361d13a9919f40523f34c4\"><code>530914d</code></a></td><td><code>Fix one test in judson-abstract-algebra</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd\"><code>756781e</code></a></td><td><code>Fix tests in homology for different choice of generators</code></td></tr></table>\n",
    "created_at": "2021-03-27T19:07:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492715",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/46864450d83a79fdbf777eacf7b956047202053a"><code>4686445</code></a></td><td><code>Merge branch 'develop' of git://git.sagemath.org/sage into t/30801/pari-2.13.0-cypari-2.1.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec66c3c0c839b07523daf9b472acdc72d3a7acf7"><code>ec66c3c</code></a></td><td><code>Change example to one where the is actually no coercion map</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7843d805dd56e5f1ed54eb3fbbf51c33534393"><code>7c7843d</code></a></td><td><code>Fix tests in sage.geometry for new lattice generators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3dc3251626e71237c2d2bda6ff54d4310639356e"><code>3dc3251</code></a></td><td><code>Fix tests in sage.schemes.toric for new lattice generators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/530914d0f848e6e894361d13a9919f40523f34c4"><code>530914d</code></a></td><td><code>Fix one test in judson-abstract-algebra</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd"><code>756781e</code></a></td><td><code>Fix tests in homology for different choice of generators</code></td></tr></table>




---

archive/issue_comments_492716.json:
```json
{
    "body": "<div id=\"comment:91\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9fb51c33d009aefb673dac596c0eb9c1f65d90e\"><code>a9fb51c</code></a></td><td><code>Update tests in modules.fg_pid for new Smith normal form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0\"><code>d7cf527</code></a></td><td><code>Fix tests in torsion quadratic modules for new Smith normal form</code></td></tr></table>\n",
    "created_at": "2021-03-27T21:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492716",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:91"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9fb51c33d009aefb673dac596c0eb9c1f65d90e"><code>a9fb51c</code></a></td><td><code>Update tests in modules.fg_pid for new Smith normal form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0"><code>d7cf527</code></a></td><td><code>Fix tests in torsion quadratic modules for new Smith normal form</code></td></tr></table>




---

archive/issue_comments_492717.json:
```json
{
    "body": "Changed commit from **[`756781e`](https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd)** to **[`d7cf527`](https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0)**",
    "created_at": "2021-03-27T21:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492717",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`756781e`](https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd)** to **[`d7cf527`](https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0)**



---

archive/issue_comments_492718.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nRemaining issues:\n\n```\nsage -t --long --random-seed=0 src/sage/sandpiles/sandpile.py  # 5 doctests failed\nsage -t --long --random-seed=0 src/doc/en/thematic_tutorials/sandpile.rst  # 5 doctests failed\n```\nThese are probably OK, but someone who understands sandpiles should look at them to make sure.\n\n```\nsage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed\nsage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed\n```\nSee [comment:84](#comment%3A84)\n\n```\nsage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # 5 doctests failed\n```\n`simon_two_descent` gives some different answers, someone should check if they're correct.\n\n```\nsage -t --long --random-seed=0 src/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed\n```\nstack overflow: `cypari2.handle_error.PariError: the PARI stack overflows (current size: 8000000; maximum size: 865075200)`\n\n```\nsage -t --long --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed\n```\nThis one looks fishy: a relative discriminant gives a mathematically different answer now.",
    "created_at": "2021-03-27T21:51:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492718",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:92" align="right">comment:92</div>

Remaining issues:

```
sage -t --long --random-seed=0 src/sage/sandpiles/sandpile.py  # 5 doctests failed
sage -t --long --random-seed=0 src/doc/en/thematic_tutorials/sandpile.rst  # 5 doctests failed
```
These are probably OK, but someone who understands sandpiles should look at them to make sure.

```
sage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/gal_reps_number_field.py  # 1 doctest failed
sage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/kraus.py  # 1 doctest failed
```
See [comment:84](#comment%3A84)

```
sage -t --long --random-seed=0 src/sage/schemes/elliptic_curves/ell_number_field.py  # 5 doctests failed
```
`simon_two_descent` gives some different answers, someone should check if they're correct.

```
sage -t --long --random-seed=0 src/sage/rings/number_field/number_field_ideal.py  # 1 doctest failed
```
stack overflow: `cypari2.handle_error.PariError: the PARI stack overflows (current size: 8000000; maximum size: 865075200)`

```
sage -t --long --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed
```
This one looks fishy: a relative discriminant gives a mathematically different answer now.



---

archive/issue_comments_492719.json:
```json
{
    "body": "Upstream: **Reported upstream. No feedback yet.**",
    "created_at": "2021-03-28T10:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492719",
    "user": "https://github.com/antonio-rojas"
}
```

Upstream: **Reported upstream. No feedback yet.**



---

archive/issue_comments_492720.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nReplying to [@antonio-rojas](#comment%3A92):\n> \n> ```\n> sage -t --long --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed\n> ```\n> This one looks fishy: a relative discriminant gives a mathematically different answer now.\n\n\nThe new answer seems wrong, I've reported it upstream\n\nhttps://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2284",
    "created_at": "2021-03-28T10:26:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492720",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:93" align="right">comment:93</div>

Replying to [@antonio-rojas](#comment%3A92):
> 
> ```
> sage -t --long --random-seed=0 src/sage/rings/number_field/number_field_rel.py  # 1 doctest failed
> ```
> This one looks fishy: a relative discriminant gives a mathematically different answer now.


The new answer seems wrong, I've reported it upstream

https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2284



---

archive/issue_comments_492721.json:
```json
{
    "body": "<div id=\"comment:94\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854\"><code>b21951e</code></a></td><td><code>Backport rnfdisc fix</code></td></tr></table>\n",
    "created_at": "2021-03-28T12:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492721",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:94"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854"><code>b21951e</code></a></td><td><code>Backport rnfdisc fix</code></td></tr></table>




---

archive/issue_comments_492722.json:
```json
{
    "body": "Changed commit from **[`d7cf527`](https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0)** to **[`b21951e`](https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854)**",
    "created_at": "2021-03-28T12:36:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492722",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d7cf527`](https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0)** to **[`b21951e`](https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854)**



---

archive/issue_comments_492723.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nAnd fixed",
    "created_at": "2021-03-28T12:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492723",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:95" align="right">comment:95</div>

And fixed



---

archive/issue_comments_492724.json:
```json
{
    "body": "Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**",
    "created_at": "2021-03-28T12:36:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492724",
    "user": "https://github.com/antonio-rojas"
}
```

Changed upstream from **Reported upstream. No feedback yet.** to **Fixed upstream, but not in a stable release.**



---

archive/issue_comments_492725.json:
```json
{
    "body": "<div id=\"comment:96\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaa1e38a0d0d59ca6c8e94daf3fe2bf3681ebd2a\"><code>eaa1e38</code></a></td><td><code>A few more test fixes in schemes.toric</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df8c4d02c2d66ac394e60dd2afeee0607bed24c2\"><code>df8c4d0</code></a></td><td><code>One trivial fix in schemes.elliptic_curves</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042\"><code>b11ff20</code></a></td><td><code>Elliptic curve group generators can be different on each run, mark tests as random</code></td></tr></table>\n",
    "created_at": "2021-03-30T18:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492725",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:96"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaa1e38a0d0d59ca6c8e94daf3fe2bf3681ebd2a"><code>eaa1e38</code></a></td><td><code>A few more test fixes in schemes.toric</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df8c4d02c2d66ac394e60dd2afeee0607bed24c2"><code>df8c4d0</code></a></td><td><code>One trivial fix in schemes.elliptic_curves</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042"><code>b11ff20</code></a></td><td><code>Elliptic curve group generators can be different on each run, mark tests as random</code></td></tr></table>




---

archive/issue_comments_492726.json:
```json
{
    "body": "Changed commit from **[`b21951e`](https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854)** to **[`b11ff20`](https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042)**",
    "created_at": "2021-03-30T18:00:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492726",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b21951e`](https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854)** to **[`b11ff20`](https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042)**



---

archive/issue_comments_492727.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nHow did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.\n\n```diff\n--- a/src/sage/schemes/elliptic_curves/ell_finite_field.py\n+++ b/src/sage/schemes/elliptic_curves/ell_finite_field.py\n@@ -785,11 +785,13 @@ class EllipticCurve_finite_field(EllipticCurve_field, HyperellipticCurve_finite_\n             sage: len(E.gens())\n             2\n             sage: E.cardinality()\n-            867361737988403547207212930746733987710588\n-            sage: E.gens()[0].order()\n-            433680868994201773603606465373366993855294\n-            sage: E.gens()[1].order()\n-            433680868994201773603606465373366993855294\n+            867361737988403547206134229616487867594472\n+            sage: a = E.gens()[0].order(); a # random\n+            433680868994201773603067114808243933797236\n+            sage: b = E.gens()[1].order(); b # random\n+            30977204928157269543076222486303138128374\n+            sage: lcm(a,b)\n+            433680868994201773603067114808243933797236\n         \"\"\"\n         G = self.__pari__().ellgroup(flag=1)\n         return tuple(self.point(list(pt)) for pt in G[2])\n}}}}",
    "created_at": "2021-04-02T19:19:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492727",
    "user": "https://github.com/videlec"
}
```

<div id="comment:97" align="right">comment:97</div>

How did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.

```diff
--- a/src/sage/schemes/elliptic_curves/ell_finite_field.py
+++ b/src/sage/schemes/elliptic_curves/ell_finite_field.py
@@ -785,11 +785,13 @@ class EllipticCurve_finite_field(EllipticCurve_field, HyperellipticCurve_finite_
             sage: len(E.gens())
             2
             sage: E.cardinality()
-            867361737988403547207212930746733987710588
-            sage: E.gens()[0].order()
-            433680868994201773603606465373366993855294
-            sage: E.gens()[1].order()
-            433680868994201773603606465373366993855294
+            867361737988403547206134229616487867594472
+            sage: a = E.gens()[0].order(); a # random
+            433680868994201773603067114808243933797236
+            sage: b = E.gens()[1].order(); b # random
+            30977204928157269543076222486303138128374
+            sage: lcm(a,b)
+            433680868994201773603067114808243933797236
         """
         G = self.__pari__().ellgroup(flag=1)
         return tuple(self.point(list(pt)) for pt in G[2])
}}}}



---

archive/issue_comments_492728.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nReplying to [@videlec](#comment%3A97):\n> How did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.\n\nBecause the default generators for finite fields have changed between 2.11 and 2.13. So, in `k.<a> = GF(5^60)`, 'a' is a different element now. See also the related changes in `finite_field_constructor.py`",
    "created_at": "2021-04-02T19:26:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492728",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:98" align="right">comment:98</div>

Replying to [@videlec](#comment%3A97):
> How did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.

Because the default generators for finite fields have changed between 2.11 and 2.13. So, in `k.<a> = GF(5^60)`, 'a' is a different element now. See also the related changes in `finite_field_constructor.py`



---

archive/issue_comments_492729.json:
```json
{
    "body": "<div id=\"comment:99\" align=\"right\">comment:99</div>\n\nI will have a look at the sandpile.",
    "created_at": "2021-04-02T19:28:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492729",
    "user": "https://github.com/videlec"
}
```

<div id="comment:99" align="right">comment:99</div>

I will have a look at the sandpile.



---

archive/issue_comments_492730.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nReplying to [@antonio-rojas](#comment%3A98):\n> Replying to [@videlec](#comment%3A97):\n> > How did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.\n> \n> \n> Because the default generators for finite fields have changed between 2.11 and 2.13. So, in `k.<a> = GF(5^60)`, 'a' is a different element now. See also the related changes in `finite_field_constructor.py`\n\nJust to double check:\n\nWith 2.11\n\n```\nsage: k.<a> = GF(5^60)\nsage: a.minpoly()\nx^60 + 2*x^59 + x^58 + 3*x^57 + 2*x^56 + x^55 + 2*x^54 + 4*x^53 + 4*x^52 + 4*x^51 + 2*x^50 + x^49 + 4*x^47 + 3*x^45 + 3*x^44 + 3*x^43 + 2*x^42 + 2*x^40 + 3*x^38 + 4*x^37 + 4*x^35 + x^34 + 3*x^33 + 4*x^32 + 3*x^31 + 2*x^30 + 4*x^29 + 3*x^28 + 2*x^27 + 3*x^25 + 4*x^24 + 4*x^23 + 3*x^21 + 4*x^20 + 2*x^19 + 4*x^18 + 4*x^17 + 4*x^16 + 3*x^15 + x^14 + 4*x^13 + 2*x^11 + x^10 + x^8 + 3*x^7 + 4*x^5 + 3*x^4 + 4*x^3 + 3*x^2 + 3\nsage: E = EllipticCurve([a, a])\nsage: E.cardinality()\n867361737988403547207212930746733987710588\n```\n\nWith 2.13:\n\n```\nsage: k.<a> = GF(5^60)\nsage: a.minpoly()\nx^60 + 3*x^56 + 3*x^55 + x^52 + 2*x^51 + 3*x^50 + x^45 + x^41 + x^37 + 3*x^36 + 3*x^35 + x^33 + 4*x^32 + 3*x^31 + 2*x^30 + x^29 + 3*x^28 + 4*x^27 + 2*x^26 + 4*x^21 + 4*x^20 + 4*x^17 + 4*x^16 + 2*x^15 + 4*x^13 + x^11 + 4*x^10 + 4*x^9 + 2*x^8 + 2*x^5 + 2*x^3 + 4*x^2 + 2*x + 4\nsage: E = EllipticCurve([a, a])\nsage: E.cardinality()\n867361737988403547206134229616487867594472\nsage: k.<b> = GF(5^60, modulus=x^60 + 2*x^59 + x^58 + 3*x^57 + 2*x^56 + x^55 + 2*x^54 + 4*x^53 + 4*x^52 + 4*x^51 + 2*x^50 + x^49 + 4*x^47 + 3*x^45 + 3*x^4\n....: 4 + 3*x^43 + 2*x^42 + 2*x^40 + 3*x^38 + 4*x^37 + 4*x^35 + x^34 + 3*x^33 + 4*x^32 + 3*x^31 + 2*x^30 + 4*x^29 + 3*x^28 + 2*x^27 + 3*x^25 + 4*x^24 + 4*\n....: x^23 + 3*x^21 + 4*x^20 + 2*x^19 + 4*x^18 + 4*x^17 + 4*x^16 + 3*x^15 + x^14 + 4*x^13 + 2*x^11 + x^10 + x^8 + 3*x^7 + 4*x^5 + 3*x^4 + 4*x^3 + 3*x^2 + \n....: 3)\nsage: E2=EllipticCurve([b,b])\nsage: E2.cardinality()\n867361737988403547207212930746733987710588\n```\nso it's all good.",
    "created_at": "2021-04-02T19:52:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492730",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:100" align="right">comment:100</div>

Replying to [@antonio-rojas](#comment%3A98):
> Replying to [@videlec](#comment%3A97):
> > How did it happen that the cardinality of the elliptic curve changed? Not by much but still... at most one of the proposed result is correct.
> 
> 
> Because the default generators for finite fields have changed between 2.11 and 2.13. So, in `k.<a> = GF(5^60)`, 'a' is a different element now. See also the related changes in `finite_field_constructor.py`

Just to double check:

With 2.11

```
sage: k.<a> = GF(5^60)
sage: a.minpoly()
x^60 + 2*x^59 + x^58 + 3*x^57 + 2*x^56 + x^55 + 2*x^54 + 4*x^53 + 4*x^52 + 4*x^51 + 2*x^50 + x^49 + 4*x^47 + 3*x^45 + 3*x^44 + 3*x^43 + 2*x^42 + 2*x^40 + 3*x^38 + 4*x^37 + 4*x^35 + x^34 + 3*x^33 + 4*x^32 + 3*x^31 + 2*x^30 + 4*x^29 + 3*x^28 + 2*x^27 + 3*x^25 + 4*x^24 + 4*x^23 + 3*x^21 + 4*x^20 + 2*x^19 + 4*x^18 + 4*x^17 + 4*x^16 + 3*x^15 + x^14 + 4*x^13 + 2*x^11 + x^10 + x^8 + 3*x^7 + 4*x^5 + 3*x^4 + 4*x^3 + 3*x^2 + 3
sage: E = EllipticCurve([a, a])
sage: E.cardinality()
867361737988403547207212930746733987710588
```

With 2.13:

```
sage: k.<a> = GF(5^60)
sage: a.minpoly()
x^60 + 3*x^56 + 3*x^55 + x^52 + 2*x^51 + 3*x^50 + x^45 + x^41 + x^37 + 3*x^36 + 3*x^35 + x^33 + 4*x^32 + 3*x^31 + 2*x^30 + x^29 + 3*x^28 + 4*x^27 + 2*x^26 + 4*x^21 + 4*x^20 + 4*x^17 + 4*x^16 + 2*x^15 + 4*x^13 + x^11 + 4*x^10 + 4*x^9 + 2*x^8 + 2*x^5 + 2*x^3 + 4*x^2 + 2*x + 4
sage: E = EllipticCurve([a, a])
sage: E.cardinality()
867361737988403547206134229616487867594472
sage: k.<b> = GF(5^60, modulus=x^60 + 2*x^59 + x^58 + 3*x^57 + 2*x^56 + x^55 + 2*x^54 + 4*x^53 + 4*x^52 + 4*x^51 + 2*x^50 + x^49 + 4*x^47 + 3*x^45 + 3*x^4
....: 4 + 3*x^43 + 2*x^42 + 2*x^40 + 3*x^38 + 4*x^37 + 4*x^35 + x^34 + 3*x^33 + 4*x^32 + 3*x^31 + 2*x^30 + 4*x^29 + 3*x^28 + 2*x^27 + 3*x^25 + 4*x^24 + 4*
....: x^23 + 3*x^21 + 4*x^20 + 2*x^19 + 4*x^18 + 4*x^17 + 4*x^16 + 3*x^15 + x^14 + 4*x^13 + 2*x^11 + x^10 + x^8 + 3*x^7 + 4*x^5 + 3*x^4 + 4*x^3 + 3*x^2 + 
....: 3)
sage: E2=EllipticCurve([b,b])
sage: E2.cardinality()
867361737988403547207212930746733987710588
```
so it's all good.



---

archive/issue_comments_492731.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\n:)",
    "created_at": "2021-04-02T19:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492731",
    "user": "https://github.com/videlec"
}
```

<div id="comment:101" align="right">comment:101</div>

:)



---

archive/issue_comments_492732.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nNothing to worry about in sandpile. All come from the change in Smith form and are valid answers.",
    "created_at": "2021-04-02T20:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492732",
    "user": "https://github.com/videlec"
}
```

<div id="comment:102" align="right">comment:102</div>

Nothing to worry about in sandpile. All come from the change in Smith form and are valid answers.



---

archive/issue_comments_492733.json:
```json
{
    "body": "Changed commit from **[`b11ff20`](https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042)** to **[`4f53a36`](https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e)**",
    "created_at": "2021-04-03T17:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492733",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b11ff20`](https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042)** to **[`4f53a36`](https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e)**



---

archive/issue_comments_492734.json:
```json
{
    "body": "<div id=\"comment:103\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e\"><code>4f53a36</code></a></td><td><code>Update sandpiles tests for new Smith form</code></td></tr></table>\n",
    "created_at": "2021-04-03T17:09:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492734",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:103"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e"><code>4f53a36</code></a></td><td><code>Update sandpiles tests for new Smith form</code></td></tr></table>




---

archive/issue_comments_492735.json:
```json
{
    "body": "<div id=\"comment:104\" align=\"right\">comment:104</div>\n\nThe `precision too low` in [comment:84] comes from\n\n```\nsage: from sage.schemes.elliptic_curves.gal_reps_number_field import deg_one_primes_iter\nsage: K.<a> = NumberField(x^2 - x + 112941801)\nsage: P = deg_one_primes_iter(K, principal_only=True)\nsage: _ = [next(P) for _ in range(3)]\n  ***   Warning: precision too low for generators, not given.\n  ***   Warning: precision too low for generators, not given.\n  ***   Warning: precision too low for generators, not given.\n  ***   Warning: precision too low for generators, not given.\n```",
    "created_at": "2021-04-21T06:38:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492735",
    "user": "https://github.com/videlec"
}
```

<div id="comment:104" align="right">comment:104</div>

The `precision too low` in [comment:84] comes from

```
sage: from sage.schemes.elliptic_curves.gal_reps_number_field import deg_one_primes_iter
sage: K.<a> = NumberField(x^2 - x + 112941801)
sage: P = deg_one_primes_iter(K, principal_only=True)
sage: _ = [next(P) for _ in range(3)]
  ***   Warning: precision too low for generators, not given.
  ***   Warning: precision too low for generators, not given.
  ***   Warning: precision too low for generators, not given.
  ***   Warning: precision too low for generators, not given.
```



---

archive/issue_comments_492736.json:
```json
{
    "body": "<div id=\"comment:105\" align=\"right\">comment:105</div>\n\nActully, no need for elliptic curve to trigger the warning\n\n```\nsage: K.<a> = NumberField(x^2 - x + 112941801)\nsage: I = K.ideal((112941823, a + 49942513))\nsage: I.is_principal()\n  ***   Warning: precision too low for generators, not given.\nFalse\n```\n(this is called in `deg_one_primes_iter` at line 803)\n\nThe above ultimately calls PARI/GP with\n\n```\nsage: bnf = K.pari_bnf()\nsage: hnf = I.pari_hnf()\nsage: bnf.bnfisprincipal(hnf, 1)\n  ***   Warning: precision too low for generators, not given.\n[[5665]~, []~]\n```\n\nAnd this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have\n\n```\nbnf.bnfisprincipal(hnf, 1)\n[[5665]~, [1005680112856001610090073934296316829467138866361766894525257437882253430879942065774355907438675356488324134889474584998905311415284353681043276105133423115318683310543272073477637300589338960081968708361807703046979508313368984026176585841244175713647681497236281752376606509937398970801793267104940057403236112391113303692273201879958967939674488863025182696946519634023730942473349983082215000407834010466580069375608789784758048104152978461419834803278904319596087872341193829514778888063778316177866395087779299764551322641650792423027180726365995085392258048238098639878001287457838906927025559523280511549386087090336592473896760739042298071391160432291174394824137946860118124404282979229184143719453742756269143097680009342314611948051930283376153131414706670056829331624943848792303898466070751623601801796312310892281516309119701337857274762757320078343943248940019654812535379459245841424571927506504714401584829273515275425263244136314100811717437028483821355172088608914231765343018676088429468602974870678332388362740795503483323546438590543834668601752766799279426809571588639840863182899151994294685170648109254538841007733841265757195339003000012740105833998913751748156278542317450865032226724534159549322507469897715570883846178284884934925927139411108181347492998550960796623038937957015115688920912058287132670816712787077722652142302022813561941270738322779237721182895820974361805531160340984165267884067984384934507471250082396847833818524050466962904745938171905956284686780241294207373575898758348602786420282414104418636033478629514453673727120417545486979349262724942498729615663533408933098472716462610746223340873224916356325049798415709852815179098082945068594726886769245691259236979553269715128964045161931272306583456510695445900210536294492420223945603966435638006097208106702624401128710741275008267785262364203915818653235371290410536706152509400193957786742250154595545629477334640639594843037280585496354412724040607706629548975485280239036672861403792257228273873223951366142131173208977036220063177945056305141723694419208202343495006886847255872360159457890094343404042121364030561355625107989431761677290762878761997805075720739609638293524879891418269558304984789737584642947688856075183040681127570913020836885548135902486022233122268518989917470477171463376207094489443300112083453671975520085981493122180011312717181508397266867443252468650087342491075278577219226483838834975922132435587687556334826969872403765974819119977356548475185141243447860028723934682964287752517823689498457113990739904389583066723293899687467098816867112903821484911791259602500118863723872580834212360274028751115910560284913196192572816918735831007543242727648234580661154261962178769898852141312976299160312006502841696191208025270422489394839650712002785292486960561705299241475775109545547817251668908605704108623609404929381572764215067827488035601722812024134189333895361036686155143470926041441422203185178683221543807531938314899725661504990537887938732251404985938041908193221724324794921781136390123869936226543519311489427540392248343667865593895153766932118235657601052305049272679149137935156623459052384644720342362619275137186290731483488444286389304271148816561733875957377593878312080879984923339287624638790229257972115601321914687187199777361516950494803326116009120509888689926688364677417293793966320775758584809271424360951590676965260954521735044247986018801311108069585561143045069036786312483681260909625432603456526446195112551447608340931959081805965503826397916563831134064470426073588909204625989884612026636269631215105938606528702826734757923982551326485015821546479886614211824267993197710265817389575724543479040788007689943671675047485899341798381799840297618920999806359257046091539158825239171382675316036787306863061087840377357239319898790867517267398778711399174086070859714153327908060380687112/15423787731598121784065181479851317095207965562744556951707615327319988174036900996596787851948102162487535818533246167408447397419284484962946343461932033151014987391818944468080419685988864089974219387374007662090557424422006655336216069435379908000252606721025845935267976159557298178922550487009997527879021269617041774920220964072886295088171880156639876949162194703408177549668332199744187466447813223174472717318384086294240294157543468652016206900519356895158706609190599420181623703486286482521072509532465042319426574643862112732814130061599984365389558490188838773162462651442384961798679610173832674655481574138416535083108050578888973213643445741144149495998169162177225073633210231935418464188261091635402084694759226846304163564397221923885069149960719552734337534114425497804201197146847638901747707144721006983429414898366581039987575516241530461997779437385212642295272483016600460552013332471354322105454747556599800164269728220545584715014879149173700602874605477747964274313916325623253519475913239766035219024045504100513780608732659125134344932814912834698269008084090017279295501852966639433334759085957736584349193299457808760025568726815347265156551997288569855520303083184580727093894206286099137444945253451384172170466112908530803958111097158459503468307451437534445133828888053117285991114033865881137411631835485708185248281679456128881401285564257032504189755725286118402351081317171302436222963916021942398932998857105632612418083654361791817954860417505656364464737860211461429324793494988542438129691273953575854400504405887003002082269313053108684985717274205390809192507223358732261077862527662595468692374702296371975940389359897955820467848264446200797116128658577897255361319125542970727979855299539164774736086342352390472332507124438834338187016413675061887871814555398868333435648711782210171158225697540592179316421357559768754046034560557045147158235469854157988886367295602929376013177169182332473063499496895922329510277364867631515203675503190910661772221158177549639625649093571783636989177154003958257267668260730805197733266709688283450995507923855449160848180441674759974202869687531620064611579801463991337558463643743997267135164234077639052966893238542545548750208212696980293483570717002942340339245397518062128505031494706881569437150040534163842562199131899755456505291752475319505037337714271025136002335192913569940956616169163902567800862024890258150353687883247496151620518758662190976990502427960537248635880282596773227140004292177736957176659160452235030295947942744100500254526493298850043601884234253104837163107628291336853849047349032922715961917418118153997126635661942563766184588457645980308034118788430236317091146609444645125885711112540315091390839292719192995927368217307862766487885884952909747229870463017592863289829170532967404520292121820993254273738890627629459722817897215980320122687403165592871004471038211167521547160486399318758271075144315508301920241394650251902061241787021841817326916417378824310961111757983639607837257509009072952188013741423402177546450623584713467936575516761749606129388853998090896099212762293594464289360758732029903043915542708445230346027591599147100251921863870112777155957711817988808198453771165908839240992119035489368255918464986846384897011045868602012809996701911417125497056612699480011029608303241300120573759919940809625031873997617290638206296876336664521749895994133364527996577259871662621348658003854081116617611523334893799895233315454117878627482715865092777403404290000039905748517139258316452750658333207122746504771475606862464541352233614692387919693313237801391454030184297215851376265590972276932615740994094543032570059914732358087315969509129131465213226337964364991060099390886823404506850632009502355939964365256980689737950555014650360875455621433531197686163996566785513792245023457838396912973254127473243910510573654688099195417343494453770602616193642848137384426169124577035126898650245026236066602939323948634836356704127035766759571373358679773372404475881623110732324054456140506141191811012149002547655229014812462255230135303720711836610126764747857578908314055890267904362154746880790791774593266985409206605469722072489612121470126191161170640137585344788894564385119276745912123555335802678514136687343422978694283526627243455011455093587990305315015794682183783903880302546533554335993322381960581092777146074262180395132207046858557700961280700201084502268413345545221557273152816254355176262742794802475764425737698580710739268628087195538972090318590912938020293852841408652229509844483656138375482948708242772482936665361990110583293262860768893793590172955556511058219658424203481764415924430012043594138005655933182334690019308210425377503727370100872617821601523164268595360660443304798383312297467650776852900112461563735643755909352585538493331481767789166091729453434978046334774247140179202927879199746225254274607506472866113793064345650274075194361194504227747371277617862767557668883880677397101655447974832622218039910391889660315183407560256559581823634686348751999970073338507159538586301746001898994233008724667075468873273429268909954946108472374015002132536966251343158102124440238347206518714347415616357288411158160813885068471448626549535529940737633555166867630276885014395911997648232176044478964205117102414922032065314960549290892077998179541417540291306137128346483175222986932978104286191392167137119056222817931540779913757159699677813708254999512499231303766256633170063282119793861096738828373012184921029465293667029308508857426112584333691741309463516608659736052588112677813543610866157072931265964949327385236209264935350001674757717532833782002008099641314548159468639777158514375801335086321588366628463233073085745744392982060077685319129024219154322573134525849980307737233121167335938628182347209217167257690130545125177873969108518551500995065686858185161519541397222934215544055392555177918529058302177084272491874075954479001465247841514195711761279015092461944770884666266943387468709452105804512201307050102059977841379810443691433051355935697950008342419711170303212511921090976858539118036164631025794898740862743011347633954749555625930473280961552555892377165479621241294839943992032801765507163708685747594848559555727439321273459887604115005341562064199786868571436158926411091472850719249117346546428550026090179384039612628802000610957776293412806618447051914767328893645889410257440364847398021323417813048815233364264704273114718271213520425340337069939876396133983864910147574811777818543655683927575470210079211268820856825639726836979792442447758820728867752361336008456238733666620390993350011824106274337041010679117648752791899869905198820670841771634746344788226807975414277232582151381553005526999373425378324517629421191169842538888155843366625374977129118657562608640832873287338553118786063859419439411462334285128905401552149497810650502735025427299551648144515157989172135679890354595771284131765172232889815864166054850412626480063621939725689936866067157580937044264830849522499516758430087713373429359189895069344766454187296118356652885297735547623443969837999386635109225628187815161497757080986429707705353219928565814662445205762922278917733114362603000541525110244727231616586879079658566405651276697894764234864067938500629562180085344452250106691572409406213072787048805913717109483763718856416913613012912470747632930718980052943756681766116792390349123276672023134828456060499646759933837264765656665596793330816685754103523308815555759665179511327163232285351996699699106863804633863524215279181005741744549306142485407499635207079986089109016524801564602163033986003363161616947551666459438302810674680053735915568635864006123325422535582785394986216592023329686223387365143, 80424414550646364071109413951047320548154724203692500102475964387152343735641955784748411247651791176225695132224501545830655292135351971248388164806308678489271313208673123149238617684205510067472873708708483823065195928585185648791603337039693017693486866125305984139436780928201920611463146920235561398002070224455183901721242650641177500019940806555610990907391822148892007049211319215495906436957606086125307785048118904799833786217368765724665678554101127485210401534445690306996616174545614076586094966258159679745118019220140115744652845218295837382867761138288409776383179585311827387445647338646805169652951119331493582422078526886894128599184974560242366515022171590686902473697233196797944475259058639778693166998923852909777132281665895399358776875234767137523959116595394308077153814711457093749656392193417265063364965333812703551207285083280756261764490953658945584325994516603427977110921650282238227257470153097990914229184083901901982724200800503611983577076526201217189432402688528089891378733592482177343767937677247399457485920975348061621977092999746535686758153425684676668259602753933634715803656277530589863060704342530564598719230638873653686786414955896322303376523061138894646105112943519443671859198816340598881690177758116581556429391931665294816807746500710413244921980760611251491553793888165001492165751540776225622801827638445075682057633889388301297265501704185423645901990910210801486179437831955356267663425311218493520756785259263203713453680163730064600912795788449394635676375721676048771986933389056386796312182892604103410019443042697908355325711801958646674952662128584387098996836292125611626372703986542930508710626471280499507014528354954848914796541777197938611708770915539296664904665044113593147207425231221112425309981190025635812046819915842604972600232502808914299802384397159301990409524126425347635590083353741458937327495404417020380441064365822826273561624208518035359749923593064851368841657912495054172023620903390834252569111873909957574204610904772251677622139737984654424657068605015847311934418911856641140432075855834511260018099715277396427903552075951626852693462074284175653131779541688496384571778652807326845464118195746102804268461777360351306772152021471784506507319736804220662526887565551058168012792652509842056790640954122939876970752988169817651033778764949620315241243314479956742969189135101963641187466734432347780364855216638013470784967435974681028092790311402177665237695821379246728951843415834902614931124860672143148717148526022586488021581461784461336032624243273814257434017810755360044702330597371456403824227161101442131231744253034892467972132649415605601673192023483395081342369752185008081115239666327009462376094472816592692539530899042557145340903398573562268497002949848267741141447119509197909912576437634009706432164020263232320876980120502517199066383470516756823139498324150396385879218790329382427067419359993727617945463698360039605777660585670770078655930977907651587050396042759224406618013258910982169771955461839612415237408978481404186490294047631083557192178973371031103764454876477336071248813527093035819650799905098374703780458879414309264999204021172480163195228510828630921369111155828207883643918569091526307054804267380299993417830166471691160528127969340142505679581805445667946924676591605909584461111115238038985017530634945670189726542180631513464043869965268412793391361182154982878554215607971566272512959835768632115951775492653917164292515967255941162972157441390277695353975991128891020834954034076285000697717265364379515802935964394330065554556407534442672392874973649265676435341099097627811910958024024211733583256194016703868231653619105438392223351899675954867203907924007640153606170556519540171057468097409787451905933867798282836537136835120330461390973442293633912548399707042995856102644430120454632706749426409766313204453/15423787731598121784065181479851317095207965562744556951707615327319988174036900996596787851948102162487535818533246167408447397419284484962946343461932033151014987391818944468080419685988864089974219387374007662090557424422006655336216069435379908000252606721025845935267976159557298178922550487009997527879021269617041774920220964072886295088171880156639876949162194703408177549668332199744187466447813223174472717318384086294240294157543468652016206900519356895158706609190599420181623703486286482521072509532465042319426574643862112732814130061599984365389558490188838773162462651442384961798679610173832674655481574138416535083108050578888973213643445741144149495998169162177225073633210231935418464188261091635402084694759226846304163564397221923885069149960719552734337534114425497804201197146847638901747707144721006983429414898366581039987575516241530461997779437385212642295272483016600460552013332471354322105454747556599800164269728220545584715014879149173700602874605477747964274313916325623253519475913239766035219024045504100513780608732659125134344932814912834698269008084090017279295501852966639433334759085957736584349193299457808760025568726815347265156551997288569855520303083184580727093894206286099137444945253451384172170466112908530803958111097158459503468307451437534445133828888053117285991114033865881137411631835485708185248281679456128881401285564257032504189755725286118402351081317171302436222963916021942398932998857105632612418083654361791817954860417505656364464737860211461429324793494988542438129691273953575854400504405887003002082269313053108684985717274205390809192507223358732261077862527662595468692374702296371975940389359897955820467848264446200797116128658577897255361319125542970727979855299539164774736086342352390472332507124438834338187016413675061887871814555398868333435648711782210171158225697540592179316421357559768754046034560557045147158235469854157988886367295602929376013177169182332473063499496895922329510277364867631515203675503190910661772221158177549639625649093571783636989177154003958257267668260730805197733266709688283450995507923855449160848180441674759974202869687531620064611579801463991337558463643743997267135164234077639052966893238542545548750208212696980293483570717002942340339245397518062128505031494706881569437150040534163842562199131899755456505291752475319505037337714271025136002335192913569940956616169163902567800862024890258150353687883247496151620518758662190976990502427960537248635880282596773227140004292177736957176659160452235030295947942744100500254526493298850043601884234253104837163107628291336853849047349032922715961917418118153997126635661942563766184588457645980308034118788430236317091146609444645125885711112540315091390839292719192995927368217307862766487885884952909747229870463017592863289829170532967404520292121820993254273738890627629459722817897215980320122687403165592871004471038211167521547160486399318758271075144315508301920241394650251902061241787021841817326916417378824310961111757983639607837257509009072952188013741423402177546450623584713467936575516761749606129388853998090896099212762293594464289360758732029903043915542708445230346027591599147100251921863870112777155957711817988808198453771165908839240992119035489368255918464986846384897011045868602012809996701911417125497056612699480011029608303241300120573759919940809625031873997617290638206296876336664521749895994133364527996577259871662621348658003854081116617611523334893799895233315454117878627482715865092777403404290000039905748517139258316452750658333207122746504771475606862464541352233614692387919693313237801391454030184297215851376265590972276932615740994094543032570059914732358087315969509129131465213226337964364991060099390886823404506850632009502355939964365256980689737950555014650360875455621433531197686163996566785513792245023457838396912973254127473243910510573654688099195417343494453770602616193642848137384426169124577035126898650245026236066602939323948634836356704127035766759571373358679773372404475881623110732324054456140506141191811012149002547655229014812462255230135303720711836610126764747857578908314055890267904362154746880790791774593266985409206605469722072489612121470126191161170640137585344788894564385119276745912123555335802678514136687343422978694283526627243455011455093587990305315015794682183783903880302546533554335993322381960581092777146074262180395132207046858557700961280700201084502268413345545221557273152816254355176262742794802475764425737698580710739268628087195538972090318590912938020293852841408652229509844483656138375482948708242772482936665361990110583293262860768893793590172955556511058219658424203481764415924430012043594138005655933182334690019308210425377503727370100872617821601523164268595360660443304798383312297467650776852900112461563735643755909352585538493331481767789166091729453434978046334774247140179202927879199746225254274607506472866113793064345650274075194361194504227747371277617862767557668883880677397101655447974832622218039910391889660315183407560256559581823634686348751999970073338507159538586301746001898994233008724667075468873273429268909954946108472374015002132536966251343158102124440238347206518714347415616357288411158160813885068471448626549535529940737633555166867630276885014395911997648232176044478964205117102414922032065314960549290892077998179541417540291306137128346483175222986932978104286191392167137119056222817931540779913757159699677813708254999512499231303766256633170063282119793861096738828373012184921029465293667029308508857426112584333691741309463516608659736052588112677813543610866157072931265964949327385236209264935350001674757717532833782002008099641314548159468639777158514375801335086321588366628463233073085745744392982060077685319129024219154322573134525849980307737233121167335938628182347209217167257690130545125177873969108518551500995065686858185161519541397222934215544055392555177918529058302177084272491874075954479001465247841514195711761279015092461944770884666266943387468709452105804512201307050102059977841379810443691433051355935697950008342419711170303212511921090976858539118036164631025794898740862743011347633954749555625930473280961552555892377165479621241294839943992032801765507163708685747594848559555727439321273459887604115005341562064199786868571436158926411091472850719249117346546428550026090179384039612628802000610957776293412806618447051914767328893645889410257440364847398021323417813048815233364264704273114718271213520425340337069939876396133983864910147574811777818543655683927575470210079211268820856825639726836979792442447758820728867752361336008456238733666620390993350011824106274337041010679117648752791899869905198820670841771634746344788226807975414277232582151381553005526999373425378324517629421191169842538888155843366625374977129118657562608640832873287338553118786063859419439411462334285128905401552149497810650502735025427299551648144515157989172135679890354595771284131765172232889815864166054850412626480063621939725689936866067157580937044264830849522499516758430087713373429359189895069344766454187296118356652885297735547623443969837999386635109225628187815161497757080986429707705353219928565814662445205762922278917733114362603000541525110244727231616586879079658566405651276697894764234864067938500629562180085344452250106691572409406213072787048805913717109483763718856416913613012912470747632930718980052943756681766116792390349123276672023134828456060499646759933837264765656665596793330816685754103523308815555759665179511327163232285351996699699106863804633863524215279181005741744549306142485407499635207079986089109016524801564602163033986003363161616947551666459438302810674680053735915568635864006123325422535582785394986216592023329686223387365143]~]\n```",
    "created_at": "2021-04-21T06:44:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492736",
    "user": "https://github.com/videlec"
}
```

<div id="comment:105" align="right">comment:105</div>

Actully, no need for elliptic curve to trigger the warning

```
sage: K.<a> = NumberField(x^2 - x + 112941801)
sage: I = K.ideal((112941823, a + 49942513))
sage: I.is_principal()
  ***   Warning: precision too low for generators, not given.
False
```
(this is called in `deg_one_primes_iter` at line 803)

The above ultimately calls PARI/GP with

```
sage: bnf = K.pari_bnf()
sage: hnf = I.pari_hnf()
sage: bnf.bnfisprincipal(hnf, 1)
  ***   Warning: precision too low for generators, not given.
[[5665]~, []~]
```

And this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have

```
bnf.bnfisprincipal(hnf, 1)
[[5665]~, [1005680112856001610090073934296316829467138866361766894525257437882253430879942065774355907438675356488324134889474584998905311415284353681043276105133423115318683310543272073477637300589338960081968708361807703046979508313368984026176585841244175713647681497236281752376606509937398970801793267104940057403236112391113303692273201879958967939674488863025182696946519634023730942473349983082215000407834010466580069375608789784758048104152978461419834803278904319596087872341193829514778888063778316177866395087779299764551322641650792423027180726365995085392258048238098639878001287457838906927025559523280511549386087090336592473896760739042298071391160432291174394824137946860118124404282979229184143719453742756269143097680009342314611948051930283376153131414706670056829331624943848792303898466070751623601801796312310892281516309119701337857274762757320078343943248940019654812535379459245841424571927506504714401584829273515275425263244136314100811717437028483821355172088608914231765343018676088429468602974870678332388362740795503483323546438590543834668601752766799279426809571588639840863182899151994294685170648109254538841007733841265757195339003000012740105833998913751748156278542317450865032226724534159549322507469897715570883846178284884934925927139411108181347492998550960796623038937957015115688920912058287132670816712787077722652142302022813561941270738322779237721182895820974361805531160340984165267884067984384934507471250082396847833818524050466962904745938171905956284686780241294207373575898758348602786420282414104418636033478629514453673727120417545486979349262724942498729615663533408933098472716462610746223340873224916356325049798415709852815179098082945068594726886769245691259236979553269715128964045161931272306583456510695445900210536294492420223945603966435638006097208106702624401128710741275008267785262364203915818653235371290410536706152509400193957786742250154595545629477334640639594843037280585496354412724040607706629548975485280239036672861403792257228273873223951366142131173208977036220063177945056305141723694419208202343495006886847255872360159457890094343404042121364030561355625107989431761677290762878761997805075720739609638293524879891418269558304984789737584642947688856075183040681127570913020836885548135902486022233122268518989917470477171463376207094489443300112083453671975520085981493122180011312717181508397266867443252468650087342491075278577219226483838834975922132435587687556334826969872403765974819119977356548475185141243447860028723934682964287752517823689498457113990739904389583066723293899687467098816867112903821484911791259602500118863723872580834212360274028751115910560284913196192572816918735831007543242727648234580661154261962178769898852141312976299160312006502841696191208025270422489394839650712002785292486960561705299241475775109545547817251668908605704108623609404929381572764215067827488035601722812024134189333895361036686155143470926041441422203185178683221543807531938314899725661504990537887938732251404985938041908193221724324794921781136390123869936226543519311489427540392248343667865593895153766932118235657601052305049272679149137935156623459052384644720342362619275137186290731483488444286389304271148816561733875957377593878312080879984923339287624638790229257972115601321914687187199777361516950494803326116009120509888689926688364677417293793966320775758584809271424360951590676965260954521735044247986018801311108069585561143045069036786312483681260909625432603456526446195112551447608340931959081805965503826397916563831134064470426073588909204625989884612026636269631215105938606528702826734757923982551326485015821546479886614211824267993197710265817389575724543479040788007689943671675047485899341798381799840297618920999806359257046091539158825239171382675316036787306863061087840377357239319898790867517267398778711399174086070859714153327908060380687112/15423787731598121784065181479851317095207965562744556951707615327319988174036900996596787851948102162487535818533246167408447397419284484962946343461932033151014987391818944468080419685988864089974219387374007662090557424422006655336216069435379908000252606721025845935267976159557298178922550487009997527879021269617041774920220964072886295088171880156639876949162194703408177549668332199744187466447813223174472717318384086294240294157543468652016206900519356895158706609190599420181623703486286482521072509532465042319426574643862112732814130061599984365389558490188838773162462651442384961798679610173832674655481574138416535083108050578888973213643445741144149495998169162177225073633210231935418464188261091635402084694759226846304163564397221923885069149960719552734337534114425497804201197146847638901747707144721006983429414898366581039987575516241530461997779437385212642295272483016600460552013332471354322105454747556599800164269728220545584715014879149173700602874605477747964274313916325623253519475913239766035219024045504100513780608732659125134344932814912834698269008084090017279295501852966639433334759085957736584349193299457808760025568726815347265156551997288569855520303083184580727093894206286099137444945253451384172170466112908530803958111097158459503468307451437534445133828888053117285991114033865881137411631835485708185248281679456128881401285564257032504189755725286118402351081317171302436222963916021942398932998857105632612418083654361791817954860417505656364464737860211461429324793494988542438129691273953575854400504405887003002082269313053108684985717274205390809192507223358732261077862527662595468692374702296371975940389359897955820467848264446200797116128658577897255361319125542970727979855299539164774736086342352390472332507124438834338187016413675061887871814555398868333435648711782210171158225697540592179316421357559768754046034560557045147158235469854157988886367295602929376013177169182332473063499496895922329510277364867631515203675503190910661772221158177549639625649093571783636989177154003958257267668260730805197733266709688283450995507923855449160848180441674759974202869687531620064611579801463991337558463643743997267135164234077639052966893238542545548750208212696980293483570717002942340339245397518062128505031494706881569437150040534163842562199131899755456505291752475319505037337714271025136002335192913569940956616169163902567800862024890258150353687883247496151620518758662190976990502427960537248635880282596773227140004292177736957176659160452235030295947942744100500254526493298850043601884234253104837163107628291336853849047349032922715961917418118153997126635661942563766184588457645980308034118788430236317091146609444645125885711112540315091390839292719192995927368217307862766487885884952909747229870463017592863289829170532967404520292121820993254273738890627629459722817897215980320122687403165592871004471038211167521547160486399318758271075144315508301920241394650251902061241787021841817326916417378824310961111757983639607837257509009072952188013741423402177546450623584713467936575516761749606129388853998090896099212762293594464289360758732029903043915542708445230346027591599147100251921863870112777155957711817988808198453771165908839240992119035489368255918464986846384897011045868602012809996701911417125497056612699480011029608303241300120573759919940809625031873997617290638206296876336664521749895994133364527996577259871662621348658003854081116617611523334893799895233315454117878627482715865092777403404290000039905748517139258316452750658333207122746504771475606862464541352233614692387919693313237801391454030184297215851376265590972276932615740994094543032570059914732358087315969509129131465213226337964364991060099390886823404506850632009502355939964365256980689737950555014650360875455621433531197686163996566785513792245023457838396912973254127473243910510573654688099195417343494453770602616193642848137384426169124577035126898650245026236066602939323948634836356704127035766759571373358679773372404475881623110732324054456140506141191811012149002547655229014812462255230135303720711836610126764747857578908314055890267904362154746880790791774593266985409206605469722072489612121470126191161170640137585344788894564385119276745912123555335802678514136687343422978694283526627243455011455093587990305315015794682183783903880302546533554335993322381960581092777146074262180395132207046858557700961280700201084502268413345545221557273152816254355176262742794802475764425737698580710739268628087195538972090318590912938020293852841408652229509844483656138375482948708242772482936665361990110583293262860768893793590172955556511058219658424203481764415924430012043594138005655933182334690019308210425377503727370100872617821601523164268595360660443304798383312297467650776852900112461563735643755909352585538493331481767789166091729453434978046334774247140179202927879199746225254274607506472866113793064345650274075194361194504227747371277617862767557668883880677397101655447974832622218039910391889660315183407560256559581823634686348751999970073338507159538586301746001898994233008724667075468873273429268909954946108472374015002132536966251343158102124440238347206518714347415616357288411158160813885068471448626549535529940737633555166867630276885014395911997648232176044478964205117102414922032065314960549290892077998179541417540291306137128346483175222986932978104286191392167137119056222817931540779913757159699677813708254999512499231303766256633170063282119793861096738828373012184921029465293667029308508857426112584333691741309463516608659736052588112677813543610866157072931265964949327385236209264935350001674757717532833782002008099641314548159468639777158514375801335086321588366628463233073085745744392982060077685319129024219154322573134525849980307737233121167335938628182347209217167257690130545125177873969108518551500995065686858185161519541397222934215544055392555177918529058302177084272491874075954479001465247841514195711761279015092461944770884666266943387468709452105804512201307050102059977841379810443691433051355935697950008342419711170303212511921090976858539118036164631025794898740862743011347633954749555625930473280961552555892377165479621241294839943992032801765507163708685747594848559555727439321273459887604115005341562064199786868571436158926411091472850719249117346546428550026090179384039612628802000610957776293412806618447051914767328893645889410257440364847398021323417813048815233364264704273114718271213520425340337069939876396133983864910147574811777818543655683927575470210079211268820856825639726836979792442447758820728867752361336008456238733666620390993350011824106274337041010679117648752791899869905198820670841771634746344788226807975414277232582151381553005526999373425378324517629421191169842538888155843366625374977129118657562608640832873287338553118786063859419439411462334285128905401552149497810650502735025427299551648144515157989172135679890354595771284131765172232889815864166054850412626480063621939725689936866067157580937044264830849522499516758430087713373429359189895069344766454187296118356652885297735547623443969837999386635109225628187815161497757080986429707705353219928565814662445205762922278917733114362603000541525110244727231616586879079658566405651276697894764234864067938500629562180085344452250106691572409406213072787048805913717109483763718856416913613012912470747632930718980052943756681766116792390349123276672023134828456060499646759933837264765656665596793330816685754103523308815555759665179511327163232285351996699699106863804633863524215279181005741744549306142485407499635207079986089109016524801564602163033986003363161616947551666459438302810674680053735915568635864006123325422535582785394986216592023329686223387365143, 80424414550646364071109413951047320548154724203692500102475964387152343735641955784748411247651791176225695132224501545830655292135351971248388164806308678489271313208673123149238617684205510067472873708708483823065195928585185648791603337039693017693486866125305984139436780928201920611463146920235561398002070224455183901721242650641177500019940806555610990907391822148892007049211319215495906436957606086125307785048118904799833786217368765724665678554101127485210401534445690306996616174545614076586094966258159679745118019220140115744652845218295837382867761138288409776383179585311827387445647338646805169652951119331493582422078526886894128599184974560242366515022171590686902473697233196797944475259058639778693166998923852909777132281665895399358776875234767137523959116595394308077153814711457093749656392193417265063364965333812703551207285083280756261764490953658945584325994516603427977110921650282238227257470153097990914229184083901901982724200800503611983577076526201217189432402688528089891378733592482177343767937677247399457485920975348061621977092999746535686758153425684676668259602753933634715803656277530589863060704342530564598719230638873653686786414955896322303376523061138894646105112943519443671859198816340598881690177758116581556429391931665294816807746500710413244921980760611251491553793888165001492165751540776225622801827638445075682057633889388301297265501704185423645901990910210801486179437831955356267663425311218493520756785259263203713453680163730064600912795788449394635676375721676048771986933389056386796312182892604103410019443042697908355325711801958646674952662128584387098996836292125611626372703986542930508710626471280499507014528354954848914796541777197938611708770915539296664904665044113593147207425231221112425309981190025635812046819915842604972600232502808914299802384397159301990409524126425347635590083353741458937327495404417020380441064365822826273561624208518035359749923593064851368841657912495054172023620903390834252569111873909957574204610904772251677622139737984654424657068605015847311934418911856641140432075855834511260018099715277396427903552075951626852693462074284175653131779541688496384571778652807326845464118195746102804268461777360351306772152021471784506507319736804220662526887565551058168012792652509842056790640954122939876970752988169817651033778764949620315241243314479956742969189135101963641187466734432347780364855216638013470784967435974681028092790311402177665237695821379246728951843415834902614931124860672143148717148526022586488021581461784461336032624243273814257434017810755360044702330597371456403824227161101442131231744253034892467972132649415605601673192023483395081342369752185008081115239666327009462376094472816592692539530899042557145340903398573562268497002949848267741141447119509197909912576437634009706432164020263232320876980120502517199066383470516756823139498324150396385879218790329382427067419359993727617945463698360039605777660585670770078655930977907651587050396042759224406618013258910982169771955461839612415237408978481404186490294047631083557192178973371031103764454876477336071248813527093035819650799905098374703780458879414309264999204021172480163195228510828630921369111155828207883643918569091526307054804267380299993417830166471691160528127969340142505679581805445667946924676591605909584461111115238038985017530634945670189726542180631513464043869965268412793391361182154982878554215607971566272512959835768632115951775492653917164292515967255941162972157441390277695353975991128891020834954034076285000697717265364379515802935964394330065554556407534442672392874973649265676435341099097627811910958024024211733583256194016703868231653619105438392223351899675954867203907924007640153606170556519540171057468097409787451905933867798282836537136835120330461390973442293633912548399707042995856102644430120454632706749426409766313204453/15423787731598121784065181479851317095207965562744556951707615327319988174036900996596787851948102162487535818533246167408447397419284484962946343461932033151014987391818944468080419685988864089974219387374007662090557424422006655336216069435379908000252606721025845935267976159557298178922550487009997527879021269617041774920220964072886295088171880156639876949162194703408177549668332199744187466447813223174472717318384086294240294157543468652016206900519356895158706609190599420181623703486286482521072509532465042319426574643862112732814130061599984365389558490188838773162462651442384961798679610173832674655481574138416535083108050578888973213643445741144149495998169162177225073633210231935418464188261091635402084694759226846304163564397221923885069149960719552734337534114425497804201197146847638901747707144721006983429414898366581039987575516241530461997779437385212642295272483016600460552013332471354322105454747556599800164269728220545584715014879149173700602874605477747964274313916325623253519475913239766035219024045504100513780608732659125134344932814912834698269008084090017279295501852966639433334759085957736584349193299457808760025568726815347265156551997288569855520303083184580727093894206286099137444945253451384172170466112908530803958111097158459503468307451437534445133828888053117285991114033865881137411631835485708185248281679456128881401285564257032504189755725286118402351081317171302436222963916021942398932998857105632612418083654361791817954860417505656364464737860211461429324793494988542438129691273953575854400504405887003002082269313053108684985717274205390809192507223358732261077862527662595468692374702296371975940389359897955820467848264446200797116128658577897255361319125542970727979855299539164774736086342352390472332507124438834338187016413675061887871814555398868333435648711782210171158225697540592179316421357559768754046034560557045147158235469854157988886367295602929376013177169182332473063499496895922329510277364867631515203675503190910661772221158177549639625649093571783636989177154003958257267668260730805197733266709688283450995507923855449160848180441674759974202869687531620064611579801463991337558463643743997267135164234077639052966893238542545548750208212696980293483570717002942340339245397518062128505031494706881569437150040534163842562199131899755456505291752475319505037337714271025136002335192913569940956616169163902567800862024890258150353687883247496151620518758662190976990502427960537248635880282596773227140004292177736957176659160452235030295947942744100500254526493298850043601884234253104837163107628291336853849047349032922715961917418118153997126635661942563766184588457645980308034118788430236317091146609444645125885711112540315091390839292719192995927368217307862766487885884952909747229870463017592863289829170532967404520292121820993254273738890627629459722817897215980320122687403165592871004471038211167521547160486399318758271075144315508301920241394650251902061241787021841817326916417378824310961111757983639607837257509009072952188013741423402177546450623584713467936575516761749606129388853998090896099212762293594464289360758732029903043915542708445230346027591599147100251921863870112777155957711817988808198453771165908839240992119035489368255918464986846384897011045868602012809996701911417125497056612699480011029608303241300120573759919940809625031873997617290638206296876336664521749895994133364527996577259871662621348658003854081116617611523334893799895233315454117878627482715865092777403404290000039905748517139258316452750658333207122746504771475606862464541352233614692387919693313237801391454030184297215851376265590972276932615740994094543032570059914732358087315969509129131465213226337964364991060099390886823404506850632009502355939964365256980689737950555014650360875455621433531197686163996566785513792245023457838396912973254127473243910510573654688099195417343494453770602616193642848137384426169124577035126898650245026236066602939323948634836356704127035766759571373358679773372404475881623110732324054456140506141191811012149002547655229014812462255230135303720711836610126764747857578908314055890267904362154746880790791774593266985409206605469722072489612121470126191161170640137585344788894564385119276745912123555335802678514136687343422978694283526627243455011455093587990305315015794682183783903880302546533554335993322381960581092777146074262180395132207046858557700961280700201084502268413345545221557273152816254355176262742794802475764425737698580710739268628087195538972090318590912938020293852841408652229509844483656138375482948708242772482936665361990110583293262860768893793590172955556511058219658424203481764415924430012043594138005655933182334690019308210425377503727370100872617821601523164268595360660443304798383312297467650776852900112461563735643755909352585538493331481767789166091729453434978046334774247140179202927879199746225254274607506472866113793064345650274075194361194504227747371277617862767557668883880677397101655447974832622218039910391889660315183407560256559581823634686348751999970073338507159538586301746001898994233008724667075468873273429268909954946108472374015002132536966251343158102124440238347206518714347415616357288411158160813885068471448626549535529940737633555166867630276885014395911997648232176044478964205117102414922032065314960549290892077998179541417540291306137128346483175222986932978104286191392167137119056222817931540779913757159699677813708254999512499231303766256633170063282119793861096738828373012184921029465293667029308508857426112584333691741309463516608659736052588112677813543610866157072931265964949327385236209264935350001674757717532833782002008099641314548159468639777158514375801335086321588366628463233073085745744392982060077685319129024219154322573134525849980307737233121167335938628182347209217167257690130545125177873969108518551500995065686858185161519541397222934215544055392555177918529058302177084272491874075954479001465247841514195711761279015092461944770884666266943387468709452105804512201307050102059977841379810443691433051355935697950008342419711170303212511921090976858539118036164631025794898740862743011347633954749555625930473280961552555892377165479621241294839943992032801765507163708685747594848559555727439321273459887604115005341562064199786868571436158926411091472850719249117346546428550026090179384039612628802000610957776293412806618447051914767328893645889410257440364847398021323417813048815233364264704273114718271213520425340337069939876396133983864910147574811777818543655683927575470210079211268820856825639726836979792442447758820728867752361336008456238733666620390993350011824106274337041010679117648752791899869905198820670841771634746344788226807975414277232582151381553005526999373425378324517629421191169842538888155843366625374977129118657562608640832873287338553118786063859419439411462334285128905401552149497810650502735025427299551648144515157989172135679890354595771284131765172232889815864166054850412626480063621939725689936866067157580937044264830849522499516758430087713373429359189895069344766454187296118356652885297735547623443969837999386635109225628187815161497757080986429707705353219928565814662445205762922278917733114362603000541525110244727231616586879079658566405651276697894764234864067938500629562180085344452250106691572409406213072787048805913717109483763718856416913613012912470747632930718980052943756681766116792390349123276672023134828456060499646759933837264765656665596793330816685754103523308815555759665179511327163232285351996699699106863804633863524215279181005741744549306142485407499635207079986089109016524801564602163033986003363161616947551666459438302810674680053735915568635864006123325422535582785394986216592023329686223387365143]~]
```



---

archive/issue_comments_492737.json:
```json
{
    "body": "<div id=\"comment:106\" align=\"right\">comment:106</div>\n\nReplying to [@videlec](#comment%3A105):\n\n> And this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have\n\nDo we actually need the generator here? From `number_field_ideal.py`:\n\n```\n        # Call bnfisprincipal().\n        # If gens_needed, use flag=3 which will insist on computing\n        # the generator.  Otherwise, use flag=1, where the generator\n        # may or may not be computed.\n        v = bnf.bnfisprincipal(self.pari_hnf(), 3 if gens_needed else 1)\n```\nSo it looks like sage is trying to find a generator even if it is not requested. According to the `bnfisprincipal` docs, this makes the computation unnecessarily complex:\n\n```\n   * 1: If set, outputs [e,t] as explained above, otherwise returns\n     only e, which is much easier to compute.\n```\nShould we change this to use the flag 0 when a generator is not needed?",
    "created_at": "2021-04-21T09:18:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492737",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:106" align="right">comment:106</div>

Replying to [@videlec](#comment%3A105):

> And this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have

Do we actually need the generator here? From `number_field_ideal.py`:

```
        # Call bnfisprincipal().
        # If gens_needed, use flag=3 which will insist on computing
        # the generator.  Otherwise, use flag=1, where the generator
        # may or may not be computed.
        v = bnf.bnfisprincipal(self.pari_hnf(), 3 if gens_needed else 1)
```
So it looks like sage is trying to find a generator even if it is not requested. According to the `bnfisprincipal` docs, this makes the computation unnecessarily complex:

```
   * 1: If set, outputs [e,t] as explained above, otherwise returns
     only e, which is much easier to compute.
```
Should we change this to use the flag 0 when a generator is not needed?



---

archive/issue_comments_492738.json:
```json
{
    "body": "Changed branch from **[u/arojas/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/pari-2.13.0-cypari-2.1.2)** to **[public/30801](https://github.com/sagemath/sagetrac-mirror/tree/public/30801)**",
    "created_at": "2021-04-21T15:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492738",
    "user": "https://github.com/videlec"
}
```

Changed branch from **[u/arojas/pari-2.13.0-cypari-2.1.2](https://github.com/sagemath/sagetrac-mirror/tree/u/arojas/pari-2.13.0-cypari-2.1.2)** to **[public/30801](https://github.com/sagemath/sagetrac-mirror/tree/public/30801)**



---

archive/issue_comments_492739.json:
```json
{
    "body": "Changed commit from **[`4f53a36`](https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e)** to none",
    "created_at": "2021-04-21T15:47:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492739",
    "user": "https://github.com/videlec"
}
```

Changed commit from **[`4f53a36`](https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e)** to none



---

archive/issue_comments_492740.json:
```json
{
    "body": "<div id=\"comment:108\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd\"><code>756781e</code></a></td><td><code>Fix tests in homology for different choice of generators</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9fb51c33d009aefb673dac596c0eb9c1f65d90e\"><code>a9fb51c</code></a></td><td><code>Update tests in modules.fg_pid for new Smith normal form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0\"><code>d7cf527</code></a></td><td><code>Fix tests in torsion quadratic modules for new Smith normal form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854\"><code>b21951e</code></a></td><td><code>Backport rnfdisc fix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eaa1e38a0d0d59ca6c8e94daf3fe2bf3681ebd2a\"><code>eaa1e38</code></a></td><td><code>A few more test fixes in schemes.toric</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df8c4d02c2d66ac394e60dd2afeee0607bed24c2\"><code>df8c4d0</code></a></td><td><code>One trivial fix in schemes.elliptic_curves</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042\"><code>b11ff20</code></a></td><td><code>Elliptic curve group generators can be different on each run, mark tests as random</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e\"><code>4f53a36</code></a></td><td><code>Update sandpiles tests for new Smith form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/521d582ea1b9fb752400be7779fa60023022990e\"><code>521d582</code></a></td><td><code>Merge branch 'develop' into pari-2.13.0-arojas</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0\"><code>58b84fd</code></a></td><td><code>fix a call to bnfisprincipal</code></td></tr></table>\n",
    "created_at": "2021-04-21T15:48:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492740",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:108"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/756781e58cdc0b8d64b1c4c129100dfe544261fd"><code>756781e</code></a></td><td><code>Fix tests in homology for different choice of generators</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9fb51c33d009aefb673dac596c0eb9c1f65d90e"><code>a9fb51c</code></a></td><td><code>Update tests in modules.fg_pid for new Smith normal form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7cf52798714865e75537bd080345b62ca9d78b0"><code>d7cf527</code></a></td><td><code>Fix tests in torsion quadratic modules for new Smith normal form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b21951e876b318dcdf3fff1467f37136e9dbc854"><code>b21951e</code></a></td><td><code>Backport rnfdisc fix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eaa1e38a0d0d59ca6c8e94daf3fe2bf3681ebd2a"><code>eaa1e38</code></a></td><td><code>A few more test fixes in schemes.toric</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df8c4d02c2d66ac394e60dd2afeee0607bed24c2"><code>df8c4d0</code></a></td><td><code>One trivial fix in schemes.elliptic_curves</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b11ff20d03e21a98e0122f9d0adfe4dd72c0e042"><code>b11ff20</code></a></td><td><code>Elliptic curve group generators can be different on each run, mark tests as random</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f53a36c00471a21fc465fb0d798c9e6f6b3c49e"><code>4f53a36</code></a></td><td><code>Update sandpiles tests for new Smith form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/521d582ea1b9fb752400be7779fa60023022990e"><code>521d582</code></a></td><td><code>Merge branch 'develop' into pari-2.13.0-arojas</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0"><code>58b84fd</code></a></td><td><code>fix a call to bnfisprincipal</code></td></tr></table>




---

archive/issue_comments_492741.json:
```json
{
    "body": "Commit: **[`58b84fd`](https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0)**",
    "created_at": "2021-04-21T15:48:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492741",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`58b84fd`](https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0)**



---

archive/issue_comments_492742.json:
```json
{
    "body": "<div id=\"comment:109\" align=\"right\">comment:109</div>\n\nReplying to [@antonio-rojas](#comment%3A106):\n> Replying to [@videlec](#comment%3A105):\n> \n> > And this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have\n> \n> \n> Do we actually need the generator here? From `number_field_ideal.py`:\n> \n> ```\n>         # Call bnfisprincipal().\n>         # If gens_needed, use flag=3 which will insist on computing\n>         # the generator.  Otherwise, use flag=1, where the generator\n>         # may or may not be computed.\n>         v = bnf.bnfisprincipal(self.pari_hnf(), 3 if gens_needed else 1)\n> ```\n> So it looks like sage is trying to find a generator even if it is not requested. According to the `bnfisprincipal` docs, this makes the computation unnecessarily complex:\n> \n> ```\n>    * 1: If set, outputs [e,t] as explained above, otherwise returns\n>      only e, which is much easier to compute.\n> ```\n> Should we change this to use the flag 0 when a generator is not needed?\n\nGood suggestion. Done in `58b84fd`.",
    "created_at": "2021-04-21T15:49:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492742",
    "user": "https://github.com/videlec"
}
```

<div id="comment:109" align="right">comment:109</div>

Replying to [@antonio-rojas](#comment%3A106):
> Replying to [@videlec](#comment%3A105):
> 
> > And this is very bad: pari does not return the generator (the second item in the last output is empty). In the current sage version we have
> 
> 
> Do we actually need the generator here? From `number_field_ideal.py`:
> 
> ```
>         # Call bnfisprincipal().
>         # If gens_needed, use flag=3 which will insist on computing
>         # the generator.  Otherwise, use flag=1, where the generator
>         # may or may not be computed.
>         v = bnf.bnfisprincipal(self.pari_hnf(), 3 if gens_needed else 1)
> ```
> So it looks like sage is trying to find a generator even if it is not requested. According to the `bnfisprincipal` docs, this makes the computation unnecessarily complex:
> 
> ```
>    * 1: If set, outputs [e,t] as explained above, otherwise returns
>      only e, which is much easier to compute.
> ```
> Should we change this to use the flag 0 when a generator is not needed?

Good suggestion. Done in `58b84fd`.



---

archive/issue_comments_492743.json:
```json
{
    "body": "<div id=\"comment:110\" align=\"right\">comment:110</div>\n\nhmm. After this change, the following test in `schemes/elliptic_curves/isogeny_small_degree.py` hangs\n\n```\nTrying (line 1555):    Psi2(71)  # long time (1 second)\nExpecting:\n    -2209380711722505179506258739515288584116147237393815266468076436521/71*u^210 + ... - 14790739586438315394567393301990769678157425619440464678252277649/71\n```",
    "created_at": "2021-04-21T15:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492743",
    "user": "https://github.com/videlec"
}
```

<div id="comment:110" align="right">comment:110</div>

hmm. After this change, the following test in `schemes/elliptic_curves/isogeny_small_degree.py` hangs

```
Trying (line 1555):    Psi2(71)  # long time (1 second)
Expecting:
    -2209380711722505179506258739515288584116147237393815266468076436521/71*u^210 + ... - 14790739586438315394567393301990769678157425619440464678252277649/71
```



---

archive/issue_comments_492744.json:
```json
{
    "body": "<div id=\"comment:111\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab\"><code>0381253</code></a></td><td><code>tweak bnfisprincipal</code></td></tr></table>\n",
    "created_at": "2021-04-21T16:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:111"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab"><code>0381253</code></a></td><td><code>tweak bnfisprincipal</code></td></tr></table>




---

archive/issue_comments_492745.json:
```json
{
    "body": "Changed commit from **[`58b84fd`](https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0)** to **[`0381253`](https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab)**",
    "created_at": "2021-04-21T16:13:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492745",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`58b84fd`](https://github.com/sagemath/sagetrac-mirror/commit/58b84fd3966c54575df4b0269ff7f99a9bb2aac0)** to **[`0381253`](https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab)**



---

archive/issue_comments_492746.json:
```json
{
    "body": "<div id=\"comment:112\" align=\"right\">comment:112</div>\n\nHaha: calling the compact form and expanding it works :) It is worth a report to PARI/GP.",
    "created_at": "2021-04-21T16:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492746",
    "user": "https://github.com/videlec"
}
```

<div id="comment:112" align="right">comment:112</div>

Haha: calling the compact form and expanding it works :) It is worth a report to PARI/GP.



---

archive/issue_comments_492747.json:
```json
{
    "body": "<div id=\"comment:113\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c\"><code>7e98037</code></a></td><td><code>clarify comment</code></td></tr></table>\n",
    "created_at": "2021-04-21T16:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492747",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:113"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c"><code>7e98037</code></a></td><td><code>clarify comment</code></td></tr></table>




---

archive/issue_comments_492748.json:
```json
{
    "body": "Changed commit from **[`0381253`](https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab)** to **[`7e98037`](https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c)**",
    "created_at": "2021-04-21T16:15:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492748",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0381253`](https://github.com/sagemath/sagetrac-mirror/commit/03812531824656bac3aae2b846584f2bc5d43dab)** to **[`7e98037`](https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c)**



---

archive/issue_comments_492749.json:
```json
{
    "body": "<div id=\"comment:114\" align=\"right\">comment:114</div>\n\nGreat, only the Simon 2-descent breaks doctest now. I suggest that we leave it aside and triggers a warning anytime it is called. At the same time I would send a message on sage-devel/sage-nt so that interested people if any can fix it.",
    "created_at": "2021-04-21T16:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492749",
    "user": "https://github.com/videlec"
}
```

<div id="comment:114" align="right">comment:114</div>

Great, only the Simon 2-descent breaks doctest now. I suggest that we leave it aside and triggers a warning anytime it is called. At the same time I would send a message on sage-devel/sage-nt so that interested people if any can fix it.



---

archive/issue_comments_492750.json:
```json
{
    "body": "<div id=\"comment:115\" align=\"right\">comment:115</div>\n\nActually, the changes are clear regressions, but given the specification of `simon_two_descent` the output is correct in all cases.",
    "created_at": "2021-04-21T16:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492750",
    "user": "https://github.com/videlec"
}
```

<div id="comment:115" align="right">comment:115</div>

Actually, the changes are clear regressions, but given the specification of `simon_two_descent` the output is correct in all cases.



---

archive/issue_comments_492751.json:
```json
{
    "body": "Changed commit from **[`7e98037`](https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c)** to **[`86980a3`](https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e)**",
    "created_at": "2021-04-21T16:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492751",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7e98037`](https://github.com/sagemath/sagetrac-mirror/commit/7e98037245a9b3fd1cc8fbb5fd62af33f6637a1c)** to **[`86980a3`](https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e)**



---

archive/issue_comments_492752.json:
```json
{
    "body": "<div id=\"comment:116\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e\"><code>86980a3</code></a></td><td><code>fix output of simon_two_descent</code></td></tr></table>\n",
    "created_at": "2021-04-21T16:29:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492752",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:116"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e"><code>86980a3</code></a></td><td><code>fix output of simon_two_descent</code></td></tr></table>




---

archive/issue_events_421721.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-21T16:30:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421721"
}
```



---

archive/issue_comments_492753.json:
```json
{
    "body": "<div id=\"comment:118\" align=\"right\">comment:118</div>\n\nThere's still one simon-two-descent related failure in `schemes/elliptic_curves/ell_number_field.py` - I guess you didn't run --long tests?\n\n```\nFile \"/usr/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_number_field.py\", line 270, in sage.schemes.elliptic_curves.ell_number_field.EllipticCurve_number_field.?\nFailed example:\n    E.simon_two_descent()  # long time (4s on sage.math, 2013)\nExpected:\n    (3,\n     3,\n     [(0 : 0 : 1),\n      (-1/2*zeta43_0^2 - 1/2*zeta43_0 + 7 : -3/2*zeta43_0^2 - 5/2*zeta43_0 + 18 : 1)...)\nGot:\n    (3,\n     3,\n     [(5/8*zeta43_0^2 + 17/8*zeta43_0 - 9/4 : -27/16*zeta43_0^2 - 103/16*zeta43_0 + 39/8 : 1),\n      (0 : 0 : 1)])\n```\n\nAlso, `spkg-configure.m4` needs updating as per [comment:76](#comment%3A76) to reject pari <2.13. Do we want to also add a check for the `rnfdisc` fix?",
    "created_at": "2021-04-21T17:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492753",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:118" align="right">comment:118</div>

There's still one simon-two-descent related failure in `schemes/elliptic_curves/ell_number_field.py` - I guess you didn't run --long tests?

```
File "/usr/lib/python3.9/site-packages/sage/schemes/elliptic_curves/ell_number_field.py", line 270, in sage.schemes.elliptic_curves.ell_number_field.EllipticCurve_number_field.?
Failed example:
    E.simon_two_descent()  # long time (4s on sage.math, 2013)
Expected:
    (3,
     3,
     [(0 : 0 : 1),
      (-1/2*zeta43_0^2 - 1/2*zeta43_0 + 7 : -3/2*zeta43_0^2 - 5/2*zeta43_0 + 18 : 1)...)
Got:
    (3,
     3,
     [(5/8*zeta43_0^2 + 17/8*zeta43_0 - 9/4 : -27/16*zeta43_0^2 - 103/16*zeta43_0 + 39/8 : 1),
      (0 : 0 : 1)])
```

Also, `spkg-configure.m4` needs updating as per [comment:76](#comment%3A76) to reject pari <2.13. Do we want to also add a check for the `rnfdisc` fix?



---

archive/issue_events_421722.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-04-21T17:50:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421722"
}
```



---

archive/issue_events_421723.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-04-21T17:50:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421723"
}
```



---

archive/issue_comments_492754.json:
```json
{
    "body": "<div id=\"comment:119\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab\"><code>860a1ea</code></a></td><td><code>one long doctest</code></td></tr></table>\n",
    "created_at": "2021-04-21T17:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492754",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:119"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab"><code>860a1ea</code></a></td><td><code>one long doctest</code></td></tr></table>




---

archive/issue_comments_492755.json:
```json
{
    "body": "Changed commit from **[`86980a3`](https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e)** to **[`860a1ea`](https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab)**",
    "created_at": "2021-04-21T17:59:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492755",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`86980a3`](https://github.com/sagemath/sagetrac-mirror/commit/86980a3b67a7e871e11135d65bc648f7b77a961e)** to **[`860a1ea`](https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab)**



---

archive/issue_comments_492756.json:
```json
{
    "body": "<div id=\"comment:120\" align=\"right\">comment:120</div>\n\nI will fix `spkg-configure.m4` and add check for `rnfdisc`.",
    "created_at": "2021-04-21T18:00:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492756",
    "user": "https://github.com/videlec"
}
```

<div id="comment:120" align="right">comment:120</div>

I will fix `spkg-configure.m4` and add check for `rnfdisc`.



---

archive/issue_comments_492757.json:
```json
{
    "body": "<div id=\"comment:121\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91\"><code>558b5e8</code></a></td><td><code>rewrite spkg-configure.m4</code></td></tr></table>\n",
    "created_at": "2021-04-21T18:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492757",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:121"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91"><code>558b5e8</code></a></td><td><code>rewrite spkg-configure.m4</code></td></tr></table>




---

archive/issue_comments_492758.json:
```json
{
    "body": "Changed commit from **[`860a1ea`](https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab)** to **[`558b5e8`](https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91)**",
    "created_at": "2021-04-21T18:15:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492758",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`860a1ea`](https://github.com/sagemath/sagetrac-mirror/commit/860a1ea4f719ebac4141d635b4a9331dd96806ab)** to **[`558b5e8`](https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91)**



---

archive/issue_events_421724.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-21T18:15:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421724"
}
```



---

archive/issue_events_421725.json:
```json
{
    "actor": "https://github.com/videlec",
    "created_at": "2021-04-21T18:15:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421725"
}
```



---

archive/issue_comments_492759.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,3 +19,5 @@\n Last upgrade:\n \n - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)\n+\n+Follow-up ticket: #31754\n``````\n",
    "created_at": "2021-04-29T11:46:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492759",
    "user": "https://github.com/videlec"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,3 +19,5 @@
 Last upgrade:
 
 - #29313 (Upgrade: pari 2.11.4), merged in Sage 9.2.beta7 (released 2020-08-03)
+
+Follow-up ticket: #31754
``````




---

archive/issue_comments_492760.json:
```json
{
    "body": "<div id=\"comment:124\" align=\"right\">comment:124</div>\n\nI'm getting \n\n```\nsage -t --random-seed=0 src/sage/rings/number_field/number_field_rel.py\n**********************************************************************\nFile \"src/sage/rings/number_field/number_field_rel.py\", line 2251, in sage.rings.number_field.number_field_rel.NumberField_relative.relative_discriminant\nFailed example:\n    K.relative_discriminant() == F.ideal(4*b)\nExpected:\n    True\nGot:\n    False\n```\nnot 100% sure it's related to this ticket, though.",
    "created_at": "2021-05-11T22:52:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492760",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:124" align="right">comment:124</div>

I'm getting 

```
sage -t --random-seed=0 src/sage/rings/number_field/number_field_rel.py
**********************************************************************
File "src/sage/rings/number_field/number_field_rel.py", line 2251, in sage.rings.number_field.number_field_rel.NumberField_relative.relative_discriminant
Failed example:
    K.relative_discriminant() == F.ideal(4*b)
Expected:
    True
Got:
    False
```
not 100% sure it's related to this ticket, though.



---

archive/issue_comments_492761.json:
```json
{
    "body": "<div id=\"comment:125\" align=\"right\">comment:125</div>\n\nThis ticket adds a Pari patch in build/pkgs/pari to fix https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2284, which causes the failure above.",
    "created_at": "2021-05-11T22:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492761",
    "user": "https://github.com/collares"
}
```

<div id="comment:125" align="right">comment:125</div>

This ticket adds a Pari patch in build/pkgs/pari to fix https://pari.math.u-bordeaux.fr/cgi-bin/bugreport.cgi?bug=2284, which causes the failure above.



---

archive/issue_comments_492762.json:
```json
{
    "body": "<div id=\"comment:126\" align=\"right\">comment:126</div>\n\nAh, OK, this explains - I'm trying this with 2.13.1 from Gentoo. So this means it's not detected by spkg-configure,m4, this bug.",
    "created_at": "2021-05-11T22:58:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492762",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:126" align="right">comment:126</div>

Ah, OK, this explains - I'm trying this with 2.13.1 from Gentoo. So this means it's not detected by spkg-configure,m4, this bug.



---

archive/issue_comments_492763.json:
```json
{
    "body": "<div id=\"comment:127\" align=\"right\">comment:127</div>\n\nadd a test for the latest patch in spkg-configure",
    "created_at": "2021-05-11T22:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492763",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:127" align="right">comment:127</div>

add a test for the latest patch in spkg-configure



---

archive/issue_events_421726.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:59:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421726"
}
```



---

archive/issue_events_421727.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-11T22:59:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421727"
}
```



---

archive/issue_comments_492764.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2021-05-11T22:59:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492764",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_comments_492765.json:
```json
{
    "body": "Changed commit from **[`558b5e8`](https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91)** to **[`f014e79`](https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff)**",
    "created_at": "2021-05-12T06:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492765",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`558b5e8`](https://github.com/sagemath/sagetrac-mirror/commit/558b5e820c169b616477f8a2e0eac47f07e41b91)** to **[`f014e79`](https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff)**



---

archive/issue_comments_492766.json:
```json
{
    "body": "<div id=\"comment:128\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b0814bdcf6eb6715317b2be2fb4ceafe9cff2eed\"><code>b0814bd</code></a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into t/30801/public/30801</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff\"><code>f014e79</code></a></td><td><code>Install pari spkg if test for rnfdisc bug fix fails</code></td></tr></table>\n",
    "created_at": "2021-05-12T06:12:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492766",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:128"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b0814bdcf6eb6715317b2be2fb4ceafe9cff2eed"><code>b0814bd</code></a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into t/30801/public/30801</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff"><code>f014e79</code></a></td><td><code>Install pari spkg if test for rnfdisc bug fix fails</code></td></tr></table>




---

archive/issue_events_421728.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-05-12T06:13:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421728"
}
```



---

archive/issue_events_421729.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-05-12T06:13:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421729"
}
```



---

archive/issue_events_421730.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T08:43:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421730"
}
```



---

archive/issue_events_421731.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T08:43:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421731"
}
```



---

archive/issue_comments_492767.json:
```json
{
    "body": "<div id=\"comment:130\" align=\"right\">comment:130</div>\n\nlgtm.\n\nFrancois, by the way, could you add the latest patch (`build/pkgs/pari/patches/pari-rnfdisc.patch`), not in 2.13.1, to Gentoo's pari?",
    "created_at": "2021-05-12T08:43:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492767",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:130" align="right">comment:130</div>

lgtm.

Francois, by the way, could you add the latest patch (`build/pkgs/pari/patches/pari-rnfdisc.patch`), not in 2.13.1, to Gentoo's pari?



---

archive/issue_comments_492768.json:
```json
{
    "body": "<div id=\"comment:131\" align=\"right\">comment:131</div>\n\nReplying to [@dimpase](#comment%3A130):\n> lgtm.\n> \n> Francois, by the way, could you add the latest patch (`build/pkgs/pari/patches/pari-rnfdisc.patch`), not in 2.13.1, to Gentoo's pari?\n\nThat would be @orlitzky's job :) but I guess I can make a PR for it.",
    "created_at": "2021-05-12T08:45:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492768",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:131" align="right">comment:131</div>

Replying to [@dimpase](#comment%3A130):
> lgtm.
> 
> Francois, by the way, could you add the latest patch (`build/pkgs/pari/patches/pari-rnfdisc.patch`), not in 2.13.1, to Gentoo's pari?

That would be @orlitzky's job :) but I guess I can make a PR for it.



---

archive/issue_comments_492769.json:
```json
{
    "body": "<div id=\"comment:132\" align=\"right\">comment:132</div>\n\nThe current patch is missing the changes to the test cases:\n\nhttps://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=3edb98db78dd49bb8b4137b46781a7cd570c2556\n\nWon't that affect `SAGE_CHECK=y`?\n\nI am also required to complain about copy/pasting a test into spkg-configure.m4 that will reject pari-2.13.1 for having this one particular bug but not any of the other 47 bugs that have been fixed since: https://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=CHANGES\n\nThe cost/benefit of using the system package jumps when you go from zero custom patches to one. We should allow people to proceed with the upstream version if that's what they have installed.\n\n(Having completed my rant, I will still add this to the Gentoo package)",
    "created_at": "2021-05-12T12:50:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492769",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:132" align="right">comment:132</div>

The current patch is missing the changes to the test cases:

https://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=commitdiff;h=3edb98db78dd49bb8b4137b46781a7cd570c2556

Won't that affect `SAGE_CHECK=y`?

I am also required to complain about copy/pasting a test into spkg-configure.m4 that will reject pari-2.13.1 for having this one particular bug but not any of the other 47 bugs that have been fixed since: https://pari.math.u-bordeaux.fr/cgi-bin/gitweb.cgi?p=pari.git;a=blob;f=CHANGES

The cost/benefit of using the system package jumps when you go from zero custom patches to one. We should allow people to proceed with the upstream version if that's what they have installed.

(Having completed my rant, I will still add this to the Gentoo package)



---

archive/issue_comments_492770.json:
```json
{
    "body": "<div id=\"comment:133\" align=\"right\">comment:133</div>\n\n2.13 broke a test in Sage, and it was not fixed in 2.13.1, but only later. No changes in Sage needed.\n\nYes, this points at poor quality of Pari's own testsuite. \n\nyou can force Sage to use system version via a configure option.",
    "created_at": "2021-05-12T13:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492770",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:133" align="right">comment:133</div>

2.13 broke a test in Sage, and it was not fixed in 2.13.1, but only later. No changes in Sage needed.

Yes, this points at poor quality of Pari's own testsuite. 

you can force Sage to use system version via a configure option.



---

archive/issue_comments_492771.json:
```json
{
    "body": "<div id=\"comment:134\" align=\"right\">comment:134</div>\n\ngood point about SAGE_CHECK.",
    "created_at": "2021-05-12T13:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492771",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:134" align="right">comment:134</div>

good point about SAGE_CHECK.



---

archive/issue_events_421732.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T13:30:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421732"
}
```



---

archive/issue_events_421733.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T13:30:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421733"
}
```



---

archive/issue_comments_492772.json:
```json
{
    "body": "<div id=\"comment:136\" align=\"right\">comment:136</div>\n\nand of course the full patch does not apply cleanly to 2.13.1, grrr...",
    "created_at": "2021-05-12T14:35:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492772",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:136" align="right">comment:136</div>

and of course the full patch does not apply cleanly to 2.13.1, grrr...



---

archive/issue_comments_492773.json:
```json
{
    "body": "<div id=\"comment:137\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3\"><code>10a4531</code></a></td><td><code>Fix pari test suite after the rnfdisc fix</code></td></tr></table>\n",
    "created_at": "2021-05-12T19:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492773",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:137"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3"><code>10a4531</code></a></td><td><code>Fix pari test suite after the rnfdisc fix</code></td></tr></table>




---

archive/issue_comments_492774.json:
```json
{
    "body": "Changed commit from **[`f014e79`](https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff)** to **[`10a4531`](https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3)**",
    "created_at": "2021-05-12T19:55:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492774",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f014e79`](https://github.com/sagemath/sagetrac-mirror/commit/f014e79c131285fb6ea74c9b721998ed7bfe8bff)** to **[`10a4531`](https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3)**



---

archive/issue_events_421734.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-05-12T19:57:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421734"
}
```



---

archive/issue_events_421735.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-05-12T19:57:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421735"
}
```



---

archive/issue_comments_492775.json:
```json
{
    "body": "<div id=\"comment:139\" align=\"right\">comment:139</div>\n\nI think src/test/in/rnf needs to be added to the PARI patch too (like in https://github.com/NixOS/nixpkgs/blob/fb58ee7fd4baa7d49bdb8de8662d6ad20bf3bd19/pkgs/applications/science/math/pari/rnfdisc.patch).",
    "created_at": "2021-05-12T21:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492775",
    "user": "https://github.com/collares"
}
```

<div id="comment:139" align="right">comment:139</div>

I think src/test/in/rnf needs to be added to the PARI patch too (like in https://github.com/NixOS/nixpkgs/blob/fb58ee7fd4baa7d49bdb8de8662d6ad20bf3bd19/pkgs/applications/science/math/pari/rnfdisc.patch).



---

archive/issue_comments_492776.json:
```json
{
    "body": "<div id=\"comment:140\" align=\"right\">comment:140</div>\n\nAh, nevermind, I see you did remove the new test's output. My bad.",
    "created_at": "2021-05-12T21:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492776",
    "user": "https://github.com/collares"
}
```

<div id="comment:140" align="right">comment:140</div>

Ah, nevermind, I see you did remove the new test's output. My bad.



---

archive/issue_comments_492777.json:
```json
{
    "body": "<div id=\"comment:141\" align=\"right\">comment:141</div>\n\nok, this works for me.",
    "created_at": "2021-05-12T22:27:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492777",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:141" align="right">comment:141</div>

ok, this works for me.



---

archive/issue_events_421736.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T22:27:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421736"
}
```



---

archive/issue_events_421737.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-12T22:27:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421737"
}
```



---

archive/issue_comments_492778.json:
```json
{
    "body": "<div id=\"comment:142\" align=\"right\">comment:142</div>\n\nOn 32-bit:\n\n```\n**********************************************************************\nFile \"src/sage/libs/pari/__init__.py\", line 165, in sage.libs.pari\nFailed example:\n    eta1.sage()\nExpected:\n    3.6054636014326520859158205642077267748\nGot:\n    3.605463601432652085915820564\n**********************************************************************\nFile \"src/sage/libs/pari/__init__.py\", line 168, in sage.libs.pari\nFailed example:\n    eta1.sage()\nExpected:\n    3.605463601432652085915820564207726774810268996598024745444380641429820491740\nGot:\n    3.60546360143265208591582056420772677481026899659802474544\n**********************************************************************\n1 item had failures:\n   2 of  41 in sage.libs.pari\n    [40 tests, 2 failures, 0.02 s]\n**********************************************************************\nFile \"src/sage/libs/pari/tests.py\", line 1764, in sage.libs.pari.tests\nFailed example:\n    eta1.sage()\nExpected:\n    3.6054636014326520859158205642077267748\nGot:\n    3.605463601432652085915820564\n**********************************************************************\nFile \"src/sage/libs/pari/tests.py\", line 1767, in sage.libs.pari.tests\nFailed example:\n    eta1.sage()\nExpected:\n    3.605463601432652085915820564207726774810268996598024745444380641429820491740\nGot:\n    3.60546360143265208591582056420772677481026899659802474544\n**********************************************************************\n1 item had failures:\n   2 of 869 in sage.libs.pari.tests\n    [868 tests, 2 failures, 1.54 s]\n**********************************************************************\n```\nand\n\n```\n**********************************************************************\nFile \"src/sage/rings/padics/relaxed_template.pxi\", line 2640, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__\nFailed example:\n    a[:30]\nExpected:\n    ...?343214211432220241412003314311\nGot:\n    ...?311111122142113024041330312403\n**********************************************************************\nFile \"src/sage/rings/padics/relaxed_template.pxi\", line 2642, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__\nFailed example:\n    b[:30]\nExpected:\n    ...?343214211432220241412003314311\nGot:\n    ...?311111122142113024041330312403\n**********************************************************************\n```",
    "created_at": "2021-05-24T22:36:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492778",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:142" align="right">comment:142</div>

On 32-bit:

```
**********************************************************************
File "src/sage/libs/pari/__init__.py", line 165, in sage.libs.pari
Failed example:
    eta1.sage()
Expected:
    3.6054636014326520859158205642077267748
Got:
    3.605463601432652085915820564
**********************************************************************
File "src/sage/libs/pari/__init__.py", line 168, in sage.libs.pari
Failed example:
    eta1.sage()
Expected:
    3.605463601432652085915820564207726774810268996598024745444380641429820491740
Got:
    3.60546360143265208591582056420772677481026899659802474544
**********************************************************************
1 item had failures:
   2 of  41 in sage.libs.pari
    [40 tests, 2 failures, 0.02 s]
**********************************************************************
File "src/sage/libs/pari/tests.py", line 1764, in sage.libs.pari.tests
Failed example:
    eta1.sage()
Expected:
    3.6054636014326520859158205642077267748
Got:
    3.605463601432652085915820564
**********************************************************************
File "src/sage/libs/pari/tests.py", line 1767, in sage.libs.pari.tests
Failed example:
    eta1.sage()
Expected:
    3.605463601432652085915820564207726774810268996598024745444380641429820491740
Got:
    3.60546360143265208591582056420772677481026899659802474544
**********************************************************************
1 item had failures:
   2 of 869 in sage.libs.pari.tests
    [868 tests, 2 failures, 1.54 s]
**********************************************************************
```
and

```
**********************************************************************
File "src/sage/rings/padics/relaxed_template.pxi", line 2640, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__
Failed example:
    a[:30]
Expected:
    ...?343214211432220241412003314311
Got:
    ...?311111122142113024041330312403
**********************************************************************
File "src/sage/rings/padics/relaxed_template.pxi", line 2642, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__
Failed example:
    b[:30]
Expected:
    ...?343214211432220241412003314311
Got:
    ...?311111122142113024041330312403
**********************************************************************
```



---

archive/issue_events_421738.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-24T22:36:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421738"
}
```



---

archive/issue_events_421739.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-24T22:36:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421739"
}
```



---

archive/issue_comments_492779.json:
```json
{
    "body": "<div id=\"comment:144\" align=\"right\">comment:144</div>\n\ntests in `src/sage/rings/padics/relaxed_template.pxi` were added by @xcaruso very recently.\nPerhaps he can comment whether this is a bug.\n\nthe other 32-bit errors are obviously just numerical noise, I'll fix these.",
    "created_at": "2021-05-27T11:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492779",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:144" align="right">comment:144</div>

tests in `src/sage/rings/padics/relaxed_template.pxi` were added by @xcaruso very recently.
Perhaps he can comment whether this is a bug.

the other 32-bit errors are obviously just numerical noise, I'll fix these.



---

archive/issue_comments_492780.json:
```json
{
    "body": "Changed commit from **[`10a4531`](https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3)** to **[`0bba178`](https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a)**",
    "created_at": "2021-05-27T11:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492780",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`10a4531`](https://github.com/sagemath/sagetrac-mirror/commit/10a4531721d2700fd717e2b3a1364508ffd971c3)** to **[`0bba178`](https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a)**



---

archive/issue_comments_492781.json:
```json
{
    "body": "<div id=\"comment:145\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fb5a9a4adbceabf85d761405af03773cd7e95cba\"><code>fb5a9a4</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into public/30801</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a\"><code>0bba178</code></a></td><td><code>fix some 32 vs 64 bit discrepancies in tests</code></td></tr></table>\n",
    "created_at": "2021-05-27T11:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492781",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:145"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fb5a9a4adbceabf85d761405af03773cd7e95cba"><code>fb5a9a4</code></a></td><td><code>Merge remote-tracking branch 'trac/develop' into public/30801</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a"><code>0bba178</code></a></td><td><code>fix some 32 vs 64 bit discrepancies in tests</code></td></tr></table>




---

archive/issue_comments_492782.json:
```json
{
    "body": "<div id=\"comment:146\" align=\"right\">comment:146</div>\n\nReplying to [@vbraun](#comment%3A142):\n> On 32-bit:\n> \n> ```\n> **********************************************************************\n> File \"src/sage/rings/padics/relaxed_template.pxi\", line 2640, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__\n> Failed example:\n>     a[:30]\n> Expected:\n>     ...?343214211432220241412003314311\n> Got:\n>     ...?311111122142113024041330312403\n> **********************************************************************\n> File \"src/sage/rings/padics/relaxed_template.pxi\", line 2642, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__\n> Failed example:\n>     b[:30]\n> Expected:\n>     ...?343214211432220241412003314311\n> Got:\n>     ...?311111122142113024041330312403\n> **********************************************************************\n> ```\n\nPrinting a random element in a doctest is usually not what is intended to be tested. As explained in the documentation the above code is supposed to test whether `a[:30]` and `b[:30]` are equal.",
    "created_at": "2021-05-27T11:58:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492782",
    "user": "https://github.com/videlec"
}
```

<div id="comment:146" align="right">comment:146</div>

Replying to [@vbraun](#comment%3A142):
> On 32-bit:
> 
> ```
> **********************************************************************
> File "src/sage/rings/padics/relaxed_template.pxi", line 2640, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__
> Failed example:
>     a[:30]
> Expected:
>     ...?343214211432220241412003314311
> Got:
>     ...?311111122142113024041330312403
> **********************************************************************
> File "src/sage/rings/padics/relaxed_template.pxi", line 2642, in sage.rings.padics.relaxed_template.RelaxedElement_random.__reduce__
> Failed example:
>     b[:30]
> Expected:
>     ...?343214211432220241412003314311
> Got:
>     ...?311111122142113024041330312403
> **********************************************************************
> ```

Printing a random element in a doctest is usually not what is intended to be tested. As explained in the documentation the above code is supposed to test whether `a[:30]` and `b[:30]` are equal.



---

archive/issue_comments_492783.json:
```json
{
    "body": "<div id=\"comment:147\" align=\"right\">comment:147</div>\n\nMoreover, few lines above in the code, the tests involve a `# random` tag...",
    "created_at": "2021-05-27T11:59:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492783",
    "user": "https://github.com/videlec"
}
```

<div id="comment:147" align="right">comment:147</div>

Moreover, few lines above in the code, the tests involve a `# random` tag...



---

archive/issue_comments_492784.json:
```json
{
    "body": "<div id=\"comment:148\" align=\"right\">comment:148</div>\n\nOops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.",
    "created_at": "2021-05-27T12:44:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492784",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:148" align="right">comment:148</div>

Oops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.



---

archive/issue_comments_492785.json:
```json
{
    "body": "Changed commit from **[`0bba178`](https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a)** to **[`32b52cc`](https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84)**",
    "created_at": "2021-05-27T12:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492785",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0bba178`](https://github.com/sagemath/sagetrac-mirror/commit/0bba178a95a4452e33981b966a7a88d1f3f4a92a)** to **[`32b52cc`](https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84)**



---

archive/issue_comments_492786.json:
```json
{
    "body": "<div id=\"comment:149\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84\"><code>32b52cc</code></a></td><td><code>add tag #random</code></td></tr></table>\n",
    "created_at": "2021-05-27T12:47:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492786",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:149"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84"><code>32b52cc</code></a></td><td><code>add tag #random</code></td></tr></table>




---

archive/issue_comments_492787.json:
```json
{
    "body": "<div id=\"comment:150\" align=\"right\">comment:150</div>\n\nReplying to [@xcaruso](#comment%3A148):\n> Oops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.\n\nhmm, so somehow 32-bit vs 64-bit rngs now behave differently? \n\nIt passed before on with whatever value you put in, as it's pseudo-random, and as long as you didn't change the rng seed, it should be the same.",
    "created_at": "2021-05-27T13:41:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492787",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:150" align="right">comment:150</div>

Replying to [@xcaruso](#comment%3A148):
> Oops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.

hmm, so somehow 32-bit vs 64-bit rngs now behave differently? 

It passed before on with whatever value you put in, as it's pseudo-random, and as long as you didn't change the rng seed, it should be the same.



---

archive/issue_comments_492788.json:
```json
{
    "body": "<div id=\"comment:151\" align=\"right\">comment:151</div>\n\nIMHO the difference in RNG values on different platforms here may be ignored.",
    "created_at": "2021-05-27T13:41:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492788",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:151" align="right">comment:151</div>

IMHO the difference in RNG values on different platforms here may be ignored.



---

archive/issue_events_421740.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-27T13:41:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421740"
}
```



---

archive/issue_events_421741.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-05-27T13:41:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421741"
}
```



---

archive/issue_comments_492789.json:
```json
{
    "body": "<div id=\"comment:152\" align=\"right\">comment:152</div>\n\nReplying to [@xcaruso](#comment%3A148):\n> Oops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.\n\nDon't you want to actually compare the values of `a[:30]` and `b[:30]`? Adding the `# random` tag actually makes the test pass in any scenario.",
    "created_at": "2021-05-27T13:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492789",
    "user": "https://github.com/videlec"
}
```

<div id="comment:152" align="right">comment:152</div>

Replying to [@xcaruso](#comment%3A148):
> Oops sorry, a tag `#random` was missing; it's actually weird that this test used to pass earlier.

Don't you want to actually compare the values of `a[:30]` and `b[:30]`? Adding the `# random` tag actually makes the test pass in any scenario.



---

archive/issue_comments_492790.json:
```json
{
    "body": "<div id=\"comment:153\" align=\"right\">comment:153</div>\n\nWell, the test `a == b` below does this checking (precisely, equality is checked at the default halting precision of the parent, which is 40 in the example).",
    "created_at": "2021-05-27T14:07:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492790",
    "user": "https://github.com/xcaruso"
}
```

<div id="comment:153" align="right">comment:153</div>

Well, the test `a == b` below does this checking (precisely, equality is checked at the default halting precision of the parent, which is 40 in the example).



---

archive/issue_events_421742.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-06-07T17:48:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421742"
}
```



---

archive/issue_events_421743.json:
```json
{
    "actor": "https://github.com/antonio-rojas",
    "created_at": "2021-06-07T17:48:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421743"
}
```



---

archive/issue_comments_492791.json:
```json
{
    "body": "<div id=\"comment:154\" align=\"right\">comment:154</div>\n\nMany new test failures (and a merge conflict) caused by #26635\n\n\n```\nsage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py  # 7 doctests failed\nsage -t --long --random-seed=0 src/sage/modular/local_comp/smoothchar.py  # 11 doctests failed\n```",
    "created_at": "2021-06-07T17:48:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492791",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:154" align="right">comment:154</div>

Many new test failures (and a merge conflict) caused by #26635


```
sage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py  # 7 doctests failed
sage -t --long --random-seed=0 src/sage/modular/local_comp/smoothchar.py  # 11 doctests failed
```



---

archive/issue_comments_492792.json:
```json
{
    "body": "<div id=\"comment:155\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bf5a59af8d83c36e65c3a9451d6ada6b0d572446\"><code>bf5a59a</code></a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into t/30801/public/30801</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321\"><code>316d62f</code></a></td><td><code>Merge branch 'public/30801' of git://trac.sagemath.org/sage into t/30801/public/30801</code></td></tr></table>\n",
    "created_at": "2021-06-07T18:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492792",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:155"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bf5a59af8d83c36e65c3a9451d6ada6b0d572446"><code>bf5a59a</code></a></td><td><code>Merge branch 'develop' of https://github.com/sagemath/sage into t/30801/public/30801</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321"><code>316d62f</code></a></td><td><code>Merge branch 'public/30801' of git://trac.sagemath.org/sage into t/30801/public/30801</code></td></tr></table>




---

archive/issue_comments_492793.json:
```json
{
    "body": "Changed commit from **[`32b52cc`](https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84)** to **[`316d62f`](https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321)**",
    "created_at": "2021-06-07T18:45:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492793",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`32b52cc`](https://github.com/sagemath/sagetrac-mirror/commit/32b52cc022fbc68463bb0206c8e1fe1e181bec84)** to **[`316d62f`](https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321)**



---

archive/issue_comments_492794.json:
```json
{
    "body": "<div id=\"comment:156\" align=\"right\">comment:156</div>\n\nIt's not hard to fix the tests to pass on pari 2.13, but it's much harder to make them also work for 2.11 (do we need ther latter?)\nHere is the diff for the most affected file (only the 1st test is made version-free)\n\n```diff\ndiff --git a/src/sage/modular/local_comp/smoothchar.py b/src/sage/modular/local_comp/smoothchar.py\nindex e54d5ad1d4..92135f7f71 100644\n--- a/src/sage/modular/local_comp/smoothchar.py\n+++ b/src/sage/modular/local_comp/smoothchar.py\n@@ -1131,9 +1131,8 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):\n             sage: from sage.modular.local_comp.smoothchar import SmoothCharacterGroupRamifiedQuadratic\n             sage: G = SmoothCharacterGroupRamifiedQuadratic(3, 1, QQ)\n             sage: s = G.number_field().gen()\n-            sage: G.discrete_log(4, 3 + 2*s)\n-            [1, 2, 2, 1]\n-            sage: gs = G.unit_gens(4); gs[0] * gs[1]^2 * gs[2]^2 * gs[3] - (3 + 2*s) in G.ideal(4)\n+            sage: dl = G.discrete_log(4, 3 + 2*s)\n+            sage: gs = G.unit_gens(4); gs[0]^dl[0] * gs[1]^dl[1] * gs[2]^dl[2] * gs[3]^dl[3] - (3 + 2*s) in G.ideal(4)\n             True\n \n         An example with a custom generating set::\n@@ -1191,11 +1190,11 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):\n             sage: from sage.modular.local_comp.smoothchar import SmoothCharacterGroupUnramifiedQuadratic\n             sage: G = SmoothCharacterGroupUnramifiedQuadratic(7,QQ)\n             sage: G.quotient_gens(1)\n-            [s]\n+            [2*s - 2]\n             sage: G.quotient_gens(2)\n-            [23*s - 16]\n+            [15*s + 21]\n             sage: G.quotient_gens(3)\n-            [-124*s - 2]\n+            [-75*s + 33]\n \n         A ramified case::\n \n@@ -1208,11 +1207,11 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):\n \n             sage: G = SmoothCharacterGroupUnramifiedQuadratic(2,QQ)\n             sage: G.quotient_gens(1)\n-            [s]\n+            [s + 1]\n             sage: G.quotient_gens(2)\n-            [-s + 1]\n+            [-s + 2]\n             sage: G.quotient_gens(3)\n-            [7*s + 5, -s + 3]\n+            [-17*s - 14, 3*s - 2]\n         \"\"\"\n \n         # silly special case\n@@ -1327,18 +1326,18 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):\n             sage: G.extend_character(3, chi, [1])\n             Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 0, mapping 5 |--> 7\n             sage: K.<z> = CyclotomicField(6); G.base_extend(K).extend_character(1, chi, [z])\n-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> z, 5 |--> 7\n+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -z + 1, 5 |--> 7\n \n         We extend the nontrivial quadratic character::\n \n             sage: chi = SmoothCharacterGroupQp(5, QQ).character(1, [-1, 7])\n             sage: K.<z> = CyclotomicField(24); G.base_extend(K).extend_character(1, chi, [z^6])\n-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> z^6, 5 |--> 7\n+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -z^6, 5 |--> 7\n \n         Extensions of higher level::\n \n             sage: K.<z> = CyclotomicField(20); rho = G.base_extend(K).extend_character(2, chi, [z]); rho\n-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 2, mapping 11*s - 10 |--> -z^5, 6 |--> 1, 5*s + 1 |--> z^4, 5 |--> 7\n+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 2, mapping 11*s - 10 |--> z^5, 6 |--> 1, 5*s + 1 |--> z^4, 5 |--> 7\n             sage: rho(3)\n             -1\n \n```",
    "created_at": "2021-06-07T20:40:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492794",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:156" align="right">comment:156</div>

It's not hard to fix the tests to pass on pari 2.13, but it's much harder to make them also work for 2.11 (do we need ther latter?)
Here is the diff for the most affected file (only the 1st test is made version-free)

```diff
diff --git a/src/sage/modular/local_comp/smoothchar.py b/src/sage/modular/local_comp/smoothchar.py
index e54d5ad1d4..92135f7f71 100644
--- a/src/sage/modular/local_comp/smoothchar.py
+++ b/src/sage/modular/local_comp/smoothchar.py
@@ -1131,9 +1131,8 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):
             sage: from sage.modular.local_comp.smoothchar import SmoothCharacterGroupRamifiedQuadratic
             sage: G = SmoothCharacterGroupRamifiedQuadratic(3, 1, QQ)
             sage: s = G.number_field().gen()
-            sage: G.discrete_log(4, 3 + 2*s)
-            [1, 2, 2, 1]
-            sage: gs = G.unit_gens(4); gs[0] * gs[1]^2 * gs[2]^2 * gs[3] - (3 + 2*s) in G.ideal(4)
+            sage: dl = G.discrete_log(4, 3 + 2*s)
+            sage: gs = G.unit_gens(4); gs[0]^dl[0] * gs[1]^dl[1] * gs[2]^dl[2] * gs[3]^dl[3] - (3 + 2*s) in G.ideal(4)
             True
 
         An example with a custom generating set::
@@ -1191,11 +1190,11 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):
             sage: from sage.modular.local_comp.smoothchar import SmoothCharacterGroupUnramifiedQuadratic
             sage: G = SmoothCharacterGroupUnramifiedQuadratic(7,QQ)
             sage: G.quotient_gens(1)
-            [s]
+            [2*s - 2]
             sage: G.quotient_gens(2)
-            [23*s - 16]
+            [15*s + 21]
             sage: G.quotient_gens(3)
-            [-124*s - 2]
+            [-75*s + 33]
 
         A ramified case::
 
@@ -1208,11 +1207,11 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):
 
             sage: G = SmoothCharacterGroupUnramifiedQuadratic(2,QQ)
             sage: G.quotient_gens(1)
-            [s]
+            [s + 1]
             sage: G.quotient_gens(2)
-            [-s + 1]
+            [-s + 2]
             sage: G.quotient_gens(3)
-            [7*s + 5, -s + 3]
+            [-17*s - 14, 3*s - 2]
         """
 
         # silly special case
@@ -1327,18 +1326,18 @@ class SmoothCharacterGroupQuadratic(SmoothCharacterGroupGeneric):
             sage: G.extend_character(3, chi, [1])
             Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 0, mapping 5 |--> 7
             sage: K.<z> = CyclotomicField(6); G.base_extend(K).extend_character(1, chi, [z])
-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> z, 5 |--> 7
+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -z + 1, 5 |--> 7
 
         We extend the nontrivial quadratic character::
 
             sage: chi = SmoothCharacterGroupQp(5, QQ).character(1, [-1, 7])
             sage: K.<z> = CyclotomicField(24); G.base_extend(K).extend_character(1, chi, [z^6])
-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> z^6, 5 |--> 7
+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -z^6, 5 |--> 7
 
         Extensions of higher level::
 
             sage: K.<z> = CyclotomicField(20); rho = G.base_extend(K).extend_character(2, chi, [z]); rho
-            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 2, mapping 11*s - 10 |--> -z^5, 6 |--> 1, 5*s + 1 |--> z^4, 5 |--> 7
+            Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 2, mapping 11*s - 10 |--> z^5, 6 |--> 1, 5*s + 1 |--> z^4, 5 |--> 7
             sage: rho(3)
             -1
 
```



---

archive/issue_comments_492795.json:
```json
{
    "body": "<div id=\"comment:157\" align=\"right\">comment:157</div>\n\nThere are also failures in `src/sage/modular/local_comp/local_comp.py`, the 1st two trivial (different ordering of a list), but the following two look rather suspect to me:\n\n```\nFile \"src/sage/modular/local_comp/local_comp.py\", line 656, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    Pi.characters()\nExpected:\n    [\n    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> d, 5 |--> 5,\n    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -d - 1/3*j0^3, 5 |--> 5\n    ]\nGot:\n    [\n    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,\n    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5\n    ]\n**********************************************************************\nFile \"src/sage/modular/local_comp/local_comp.py\", line 661, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    Pi.characters()[0].base_ring()\nExpected:\n    Number Field in d with defining polynomial x^2 + 1/3*j0^3*x - 1/3*j0^2 over its base field\nGot:\n    Number Field in d with defining polynomial x^2 - j0*x + 1/3*j0^2 over its base field\n```\n\nDavid, can you have a look?",
    "created_at": "2021-06-07T20:55:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492795",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:157" align="right">comment:157</div>

There are also failures in `src/sage/modular/local_comp/local_comp.py`, the 1st two trivial (different ordering of a list), but the following two look rather suspect to me:

```
File "src/sage/modular/local_comp/local_comp.py", line 656, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    Pi.characters()
Expected:
    [
    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> d, 5 |--> 5,
    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -d - 1/3*j0^3, 5 |--> 5
    ]
Got:
    [
    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,
    Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5
    ]
**********************************************************************
File "src/sage/modular/local_comp/local_comp.py", line 661, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    Pi.characters()[0].base_ring()
Expected:
    Number Field in d with defining polynomial x^2 + 1/3*j0^3*x - 1/3*j0^2 over its base field
Got:
    Number Field in d with defining polynomial x^2 - j0*x + 1/3*j0^2 over its base field
```

David, can you have a look?



---

archive/issue_comments_492796.json:
```json
{
    "body": "<div id=\"comment:158\" align=\"right\">comment:158</div>\n\nLooks harmless to me. I gather from the discussions above that the default generators for multiplicative groups of non-prime finite fields have been changed, and that would inevitably lead to changes in the output of these doctests (without affecting the mathematical validity of the calculations).",
    "created_at": "2021-06-08T08:01:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492796",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:158" align="right">comment:158</div>

Looks harmless to me. I gather from the discussions above that the default generators for multiplicative groups of non-prime finite fields have been changed, and that would inevitably lead to changes in the output of these doctests (without affecting the mathematical validity of the calculations).



---

archive/issue_comments_492797.json:
```json
{
    "body": "<div id=\"comment:159\" align=\"right\">comment:159</div>\n\nReplying to [@loefflerd](#comment%3A158):\n> Looks harmless to me. I gather from the discussions above that the default generators for multiplicative groups of non-prime finite fields have been changed, and that would inevitably lead to changes in the output of these doctests (without affecting the mathematical validity of the calculations).\n\nright under these two tests one has\n\n```\n        .. warning::\n\n            The above output isn't actually the same as in Example 2 of\n            [LW2012]_, due to an error in the published paper (correction\n            pending) -- the published paper has the inverses of the above\n            characters.\n```\n\nI didn't look at the paper cited there - but presumably you know what's going on.\nAnd I imagine it won't be \"the inverses of the above characters\" any more.",
    "created_at": "2021-06-08T08:09:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492797",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:159" align="right">comment:159</div>

Replying to [@loefflerd](#comment%3A158):
> Looks harmless to me. I gather from the discussions above that the default generators for multiplicative groups of non-prime finite fields have been changed, and that would inevitably lead to changes in the output of these doctests (without affecting the mathematical validity of the calculations).

right under these two tests one has

```
        .. warning::

            The above output isn't actually the same as in Example 2 of
            [LW2012]_, due to an error in the published paper (correction
            pending) -- the published paper has the inverses of the above
            characters.
```

I didn't look at the paper cited there - but presumably you know what's going on.
And I imagine it won't be "the inverses of the above characters" any more.



---

archive/issue_comments_492798.json:
```json
{
    "body": "<div id=\"comment:160\" align=\"right\">comment:160</div>\n\nThe characters returned by the doctest are the same characters as they were before -- just notated differently. So the warning is no more or less problematic than it was before.",
    "created_at": "2021-06-08T08:24:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492798",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:160" align="right">comment:160</div>

The characters returned by the doctest are the same characters as they were before -- just notated differently. So the warning is no more or less problematic than it was before.



---

archive/issue_comments_492799.json:
```json
{
    "body": "<div id=\"comment:161\" align=\"right\">comment:161</div>\n\nOK, thanks, we'll be able to proceed then.",
    "created_at": "2021-06-08T08:40:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492799",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:161" align="right">comment:161</div>

OK, thanks, we'll be able to proceed then.



---

archive/issue_comments_492800.json:
```json
{
    "body": "<div id=\"comment:162\" align=\"right\">comment:162</div>\n\nas we bump the Pari version to 2.13+, we should remove tests for bugs fixed earlier.",
    "created_at": "2021-06-08T08:51:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492800",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:162" align="right">comment:162</div>

as we bump the Pari version to 2.13+, we should remove tests for bugs fixed earlier.



---

archive/issue_comments_492801.json:
```json
{
    "body": "<div id=\"comment:163\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da4004587235416144bc6bded1c6e87f166f766e\"><code>da40045</code></a></td><td><code>doctest fixes for #26635 on Pari 2.13</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/73591c04d30aced76cf4216b87234f65b89279bb\"><code>73591c0</code></a></td><td><code>do not test for bugs fixed in pari 2.13+</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1\"><code>4a9c3b6</code></a></td><td><code>remove space between 2 and >> in script</code></td></tr></table>\n",
    "created_at": "2021-06-08T10:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492801",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:163"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da4004587235416144bc6bded1c6e87f166f766e"><code>da40045</code></a></td><td><code>doctest fixes for #26635 on Pari 2.13</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/73591c04d30aced76cf4216b87234f65b89279bb"><code>73591c0</code></a></td><td><code>do not test for bugs fixed in pari 2.13+</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1"><code>4a9c3b6</code></a></td><td><code>remove space between 2 and >> in script</code></td></tr></table>




---

archive/issue_comments_492802.json:
```json
{
    "body": "Changed commit from **[`316d62f`](https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321)** to **[`4a9c3b6`](https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1)**",
    "created_at": "2021-06-08T10:55:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492802",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`316d62f`](https://github.com/sagemath/sagetrac-mirror/commit/316d62f945e2a301008a67d22c41cbfc61186321)** to **[`4a9c3b6`](https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1)**



---

archive/issue_events_421744.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-08T10:56:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421744"
}
```



---

archive/issue_events_421745.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-08T10:56:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421745"
}
```



---

archive/issue_comments_492803.json:
```json
{
    "body": "<div id=\"comment:164\" align=\"right\">comment:164</div>\n\nall fixed, please review",
    "created_at": "2021-06-08T10:56:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492803",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:164" align="right">comment:164</div>

all fixed, please review



---

archive/issue_comments_492804.json:
```json
{
    "body": "<div id=\"comment:165\" align=\"right\">comment:165</div>\n\nIn case anybody cares: I did some digging about the doctests in the local-components code. It turns out this is not actually because of the changes to PARI's bnfisunit etc; rather, it is caused by the change to Smith normal form algorithms, which are used to find a generator of some quotient of abelian groups. \n\nThe test case in `local_comp.py` line 656, from Dima's comment above, depends on the following computation:\n\n```\nsage: A = ZZ^2                                                                  \nsage: R = [A([6, 0]), A([0,1])]                                               \nsage: [x.lift() for x in (A/R).gens()]                                          \n```\nThe output in Sage 9.4.beta1 is `[(1, 0)]`. With the new Pari SPKG from this ticket, the output changes to `[(-1, 0)]`, which is equally valid. Using this, the code gives output which is mathematically equivalent to the previous output, but using a different choice of generator of the coefficient field. \n\n(One could rewrite the doctest in a more robust way using embeddings into QQbar; but that would make the doctest less readable as an example so I don't advocate doing that, unless it becomes a recurring problem.)",
    "created_at": "2021-06-08T12:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492804",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:165" align="right">comment:165</div>

In case anybody cares: I did some digging about the doctests in the local-components code. It turns out this is not actually because of the changes to PARI's bnfisunit etc; rather, it is caused by the change to Smith normal form algorithms, which are used to find a generator of some quotient of abelian groups. 

The test case in `local_comp.py` line 656, from Dima's comment above, depends on the following computation:

```
sage: A = ZZ^2                                                                  
sage: R = [A([6, 0]), A([0,1])]                                               
sage: [x.lift() for x in (A/R).gens()]                                          
```
The output in Sage 9.4.beta1 is `[(1, 0)]`. With the new Pari SPKG from this ticket, the output changes to `[(-1, 0)]`, which is equally valid. Using this, the code gives output which is mathematically equivalent to the previous output, but using a different choice of generator of the coefficient field. 

(One could rewrite the doctest in a more robust way using embeddings into QQbar; but that would make the doctest less readable as an example so I don't advocate doing that, unless it becomes a recurring problem.)



---

archive/issue_comments_492805.json:
```json
{
    "body": "<div id=\"comment:166\" align=\"right\">comment:166</div>\n\nI'm still seeing 3 failures\n\n```\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py\", line 669, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    LocalComponent(f, 3).characters()  # long time (12s on sage.math, 2012)\nExpected:\n    [\n    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> 2*d + j0, 4 |--> 1, 3*s + 1 |--> j0*d + 1, 3 |--> 1,\n    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> -2*d - j0, 4 |--> 1, 3*s + 1 |--> -j0*d - 2, 3 |--> 1\n    ]\nGot:\n    [\n    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> -2*d + j0, 4 |--> 1, 3*s + 1 |--> -j0*d + 1, 3 |--> 1,\n    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> 2*d - j0, 4 |--> 1, 3*s + 1 |--> j0*d - 2, 3 |--> 1\n    ]\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py\", line 698, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    Newforms(DirichletGroup(64, QQ).1, 2, names='a')[0].local_component(2).characters() # long time, random\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters[14]>\", line 1, in <module>\n        Newforms(DirichletGroup(Integer(64), QQ).gen(1), Integer(2), names='a')[Integer(0)].local_component(Integer(2)).characters() # long time, random\n      File \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py\", line 757, in characters\n        pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ]\n    IndexError: list index out of range\n**********************************************************************\nFile \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py\", line 703, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    Newform('243a',names='a').local_component(3).characters() # long time\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters[15]>\", line 1, in <module>\n        Newform('243a',names='a').local_component(Integer(3)).characters() # long time\n      File \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py\", line 893, in characters\n        ti = (~T.rho(x.matrix().list())).trace() * p**ZZ((k-2+self.twist_factor())/2)\n      File \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/type_space.py\", line 674, in rho\n        g = [ZZ(_) for _ in g]\n      File \"/usr/lib/python3.9/site-packages/sage/modular/local_comp/type_space.py\", line 674, in <listcomp>\n        g = [ZZ(_) for _ in g]\n      File \"sage/structure/parent.pyx\", line 898, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9341)\n        return mor._call_(x)\n      File \"sage/rings/rational.pyx\", line 4164, in sage.rings.rational.Q_to_Z._call_ (build/cythonized/sage/rings/rational.cpp:32503)\n        raise TypeError(\"no conversion of this rational to integer\")\n    TypeError: no conversion of this rational to integer\n**********************************************************************\n```",
    "created_at": "2021-06-08T16:15:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492805",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:166" align="right">comment:166</div>

I'm still seeing 3 failures

```
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py", line 669, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    LocalComponent(f, 3).characters()  # long time (12s on sage.math, 2012)
Expected:
    [
    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> 2*d + j0, 4 |--> 1, 3*s + 1 |--> j0*d + 1, 3 |--> 1,
    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> -2*d - j0, 4 |--> 1, 3*s + 1 |--> -j0*d - 2, 3 |--> 1
    ]
Got:
    [
    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> -2*d + j0, 4 |--> 1, 3*s + 1 |--> -j0*d + 1, 3 |--> 1,
    Character of unramified extension Q_3(s)* (s^2 + 2*s + 2 = 0), of level 2, mapping -2*s |--> 2*d - j0, 4 |--> 1, 3*s + 1 |--> j0*d - 2, 3 |--> 1
    ]
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py", line 698, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    Newforms(DirichletGroup(64, QQ).1, 2, names='a')[0].local_component(2).characters() # long time, random
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters[14]>", line 1, in <module>
        Newforms(DirichletGroup(Integer(64), QQ).gen(1), Integer(2), names='a')[Integer(0)].local_component(Integer(2)).characters() # long time, random
      File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py", line 757, in characters
        pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ]
    IndexError: list index out of range
**********************************************************************
File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py", line 703, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    Newform('243a',names='a').local_component(3).characters() # long time
Exception raised:
    Traceback (most recent call last):
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters[15]>", line 1, in <module>
        Newform('243a',names='a').local_component(Integer(3)).characters() # long time
      File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py", line 893, in characters
        ti = (~T.rho(x.matrix().list())).trace() * p**ZZ((k-2+self.twist_factor())/2)
      File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/type_space.py", line 674, in rho
        g = [ZZ(_) for _ in g]
      File "/usr/lib/python3.9/site-packages/sage/modular/local_comp/type_space.py", line 674, in <listcomp>
        g = [ZZ(_) for _ in g]
      File "sage/structure/parent.pyx", line 898, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9341)
        return mor._call_(x)
      File "sage/rings/rational.pyx", line 4164, in sage.rings.rational.Q_to_Z._call_ (build/cythonized/sage/rings/rational.cpp:32503)
        raise TypeError("no conversion of this rational to integer")
    TypeError: no conversion of this rational to integer
**********************************************************************
```



---

archive/issue_events_421746.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-08T17:24:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421746"
}
```



---

archive/issue_events_421747.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-08T17:24:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421747"
}
```



---

archive/issue_comments_492806.json:
```json
{
    "body": "<div id=\"comment:167\" align=\"right\">comment:167</div>\n\nOops, forgot long tests.\nThe 1st failure is trivial to fix, but the other 2 look like  genuine bugs, which David hopefully knows how to fix.\n\nSpecifically, in the 1st case, line 698, I debugged a bit, and got the following:\n\n```python\n            gvals = [x[0] for x in theta_poly.roots(G.base_ring())]\n            print(\"gvals=\",gvals, \"\\n\", theta_poly, \"\\n\", theta_poly.roots(G.base_ring()), \"\\n\")\n            print(gvals[0]**2,\"\\n\")\n            if len(gs) == 1:\n                # This is always the case if p != 2\n                chi1, chi2 = [G.extend_character(n, self.central_character(), [x]) for x in gvals]\n            else:\n                # 2-adic cases, conductor >= 64. Here life is complicated\n                # because the quotient (O_K* / p^n)^* / (image of Z_2^*) is not\n                # cyclic.\n                g0 = gs[0]\n                try:\n                    G._reduce_Qp(1, g0)\n                    raise ZeroDivisionError\n                except ValueError:\n                    pass\n\n                tr = (~T.rho(g0.matrix().list())).trace()\n                X = polygen(G.base_ring())\n                theta_poly = X**2 - (-1)**n*tr*X + self.central_character()(g0.norm())\n                verbose(\"theta_poly for %s is %s\" % (g0, theta_poly), level=1)\n                if theta_poly.is_irreducible():\n                    F = theta_poly.base_ring().extension(theta_poly, \"e\")\n                    G = G.base_extend(F)\n                g0vals = [y[0] for y in theta_poly.roots(G.base_ring())]\n                print(g0vals, \" \", gvals, \"\\n\", theta_poly, \"\\n\", theta_poly.roots(G.base_ring()), \"\\n\")\n                pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ] # - ERROR\n                pairB = [ [g0vals[0], gvals[1]], [g0vals[1], gvals[0]] ]\n\n```\nwhich I ran as\n\n```\nsage: nn=Newforms(DirichletGroup(64, QQ).1, 2, names='a')[0]; nn                                                                                                                                                                                                                              \nq - a0*q^3 + O(q^6)\nsage: s=nn.local_component(2)                                                                                                                                                                                                                                                                 \nsage: s.characters()                                                                                                                                                                                                                                                                          \ngvals= [1/2*a0] \n x^2 - a0*x - 1 \n [(1/2*a0, 2)] \n\n-1 \n\n[1/2*a0, -1/2*a0]   [1/2*a0] \n x^2 + 1 \n [(1/2*a0, 1), (-1/2*a0, 1)] \n\n---------------------------------------------------------------------------\nIndexError                                Traceback (most recent call last)\n<ipython-input-3-ec8072600e6c> in <module>\n----> 1 s.characters()\n\n~/sage/local/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py in characters(self)\n    755                 g0vals = [y[0] for y in theta_poly.roots(G.base_ring())]\n    756                 print(g0vals, \" \", gvals, \"\\n\", theta_poly, \"\\n\", theta_poly.roots(G.base_ring()), \"\\n\")\n--> 757                 pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ]\n    758                 pairB = [ [g0vals[0], gvals[1]], [g0vals[1], gvals[0]] ]\n    759 \n\nIndexError: list index out of range\n```\n\nThat is, `theta_poly` has a double root, something that is not guarded against in any way.\n \nDavid, your turn. If this is not a Pari bug I'd rather have this dealt with on a follow-up ticket.",
    "created_at": "2021-06-08T17:24:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492806",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:167" align="right">comment:167</div>

Oops, forgot long tests.
The 1st failure is trivial to fix, but the other 2 look like  genuine bugs, which David hopefully knows how to fix.

Specifically, in the 1st case, line 698, I debugged a bit, and got the following:

```python
            gvals = [x[0] for x in theta_poly.roots(G.base_ring())]
            print("gvals=",gvals, "\n", theta_poly, "\n", theta_poly.roots(G.base_ring()), "\n")
            print(gvals[0]**2,"\n")
            if len(gs) == 1:
                # This is always the case if p != 2
                chi1, chi2 = [G.extend_character(n, self.central_character(), [x]) for x in gvals]
            else:
                # 2-adic cases, conductor >= 64. Here life is complicated
                # because the quotient (O_K* / p^n)^* / (image of Z_2^*) is not
                # cyclic.
                g0 = gs[0]
                try:
                    G._reduce_Qp(1, g0)
                    raise ZeroDivisionError
                except ValueError:
                    pass

                tr = (~T.rho(g0.matrix().list())).trace()
                X = polygen(G.base_ring())
                theta_poly = X**2 - (-1)**n*tr*X + self.central_character()(g0.norm())
                verbose("theta_poly for %s is %s" % (g0, theta_poly), level=1)
                if theta_poly.is_irreducible():
                    F = theta_poly.base_ring().extension(theta_poly, "e")
                    G = G.base_extend(F)
                g0vals = [y[0] for y in theta_poly.roots(G.base_ring())]
                print(g0vals, " ", gvals, "\n", theta_poly, "\n", theta_poly.roots(G.base_ring()), "\n")
                pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ] # - ERROR
                pairB = [ [g0vals[0], gvals[1]], [g0vals[1], gvals[0]] ]

```
which I ran as

```
sage: nn=Newforms(DirichletGroup(64, QQ).1, 2, names='a')[0]; nn                                                                                                                                                                                                                              
q - a0*q^3 + O(q^6)
sage: s=nn.local_component(2)                                                                                                                                                                                                                                                                 
sage: s.characters()                                                                                                                                                                                                                                                                          
gvals= [1/2*a0] 
 x^2 - a0*x - 1 
 [(1/2*a0, 2)] 

-1 

[1/2*a0, -1/2*a0]   [1/2*a0] 
 x^2 + 1 
 [(1/2*a0, 1), (-1/2*a0, 1)] 

---------------------------------------------------------------------------
IndexError                                Traceback (most recent call last)
<ipython-input-3-ec8072600e6c> in <module>
----> 1 s.characters()

~/sage/local/lib/python3.9/site-packages/sage/modular/local_comp/local_comp.py in characters(self)
    755                 g0vals = [y[0] for y in theta_poly.roots(G.base_ring())]
    756                 print(g0vals, " ", gvals, "\n", theta_poly, "\n", theta_poly.roots(G.base_ring()), "\n")
--> 757                 pairA = [ [g0vals[0], gvals[0]], [g0vals[1], gvals[1]] ]
    758                 pairB = [ [g0vals[0], gvals[1]], [g0vals[1], gvals[0]] ]
    759 

IndexError: list index out of range
```

That is, `theta_poly` has a double root, something that is not guarded against in any way.
 
David, your turn. If this is not a Pari bug I'd rather have this dealt with on a follow-up ticket.



---

archive/issue_comments_492807.json:
```json
{
    "body": "<div id=\"comment:168\" align=\"right\">comment:168</div>\n\nI'll do some digging and see whether this is Pari's fault, or a bug in the local components code. Quite likely it's the latter -- the `ZeroDivisionError` lines look rather fishy.",
    "created_at": "2021-06-09T08:16:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492807",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:168" align="right">comment:168</div>

I'll do some digging and see whether this is Pari's fault, or a bug in the local components code. Quite likely it's the latter -- the `ZeroDivisionError` lines look rather fishy.



---

archive/issue_comments_492808.json:
```json
{
    "body": "Changed commit from **[`4a9c3b6`](https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1)** to **[`d50e7e9`](https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a)**",
    "created_at": "2021-06-09T11:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492808",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4a9c3b6`](https://github.com/sagemath/sagetrac-mirror/commit/4a9c3b68b2f82681b15b85987a7bee432b70b1e1)** to **[`d50e7e9`](https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a)**



---

archive/issue_comments_492809.json:
```json
{
    "body": "<div id=\"comment:169\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a\"><code>d50e7e9</code></a></td><td><code>Fix local-component bug revealed by pari upgrade</code></td></tr></table>\n",
    "created_at": "2021-06-09T11:01:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492809",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:169"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a"><code>d50e7e9</code></a></td><td><code>Fix local-component bug revealed by pari upgrade</code></td></tr></table>




---

archive/issue_comments_492810.json:
```json
{
    "body": "<div id=\"comment:170\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63\"><code>bb0245a</code></a></td><td><code>fix unhandled case in local_comp</code></td></tr></table>\n",
    "created_at": "2021-06-09T11:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492810",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:170"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63"><code>bb0245a</code></a></td><td><code>fix unhandled case in local_comp</code></td></tr></table>




---

archive/issue_comments_492811.json:
```json
{
    "body": "Changed commit from **[`d50e7e9`](https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a)** to **[`bb0245a`](https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63)**",
    "created_at": "2021-06-09T11:06:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492811",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d50e7e9`](https://github.com/sagemath/sagetrac-mirror/commit/d50e7e95475c7ac5f00da65816ddfedc4d7d5b5a)** to **[`bb0245a`](https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63)**



---

archive/issue_comments_492812.json:
```json
{
    "body": "<div id=\"comment:171\" align=\"right\">comment:171</div>\n\nHere's a small fix which sorts out the case when theta_poly has a repeated root.\n\nUnfortunately, in the process of fixing this I spotted another bug elsewhere. Consider the code\n\n```\nK.<a> = NumberField(x^2 + x + 1)\nlist(K.ideal(8).invertible_residues())[:5]\nlist(K.ideal(16).invertible_residues())[:5]\n```\nIn vanilla 9.4.beta1, both commands return lists of algebraic integers. With the new pari spkg, the first one returns a list of non-integral elements (contradicting the docstring of invertible_residues which says that the results must be in the ring of integers); and the second one **crashes** with an \"Unhandled SIGABRT\"!",
    "created_at": "2021-06-09T11:13:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492812",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:171" align="right">comment:171</div>

Here's a small fix which sorts out the case when theta_poly has a repeated root.

Unfortunately, in the process of fixing this I spotted another bug elsewhere. Consider the code

```
K.<a> = NumberField(x^2 + x + 1)
list(K.ideal(8).invertible_residues())[:5]
list(K.ideal(16).invertible_residues())[:5]
```
In vanilla 9.4.beta1, both commands return lists of algebraic integers. With the new pari spkg, the first one returns a list of non-integral elements (contradicting the docstring of invertible_residues which says that the results must be in the ring of integers); and the second one **crashes** with an "Unhandled SIGABRT"!



---

archive/issue_comments_492813.json:
```json
{
    "body": "<div id=\"comment:172\" align=\"right\">comment:172</div>\n\nI don't get a crash:\n\n```\nsage: K.<a> = NumberField(x^2 + x + 1) \n....: list(K.ideal(8).invertible_residues())[:5] \n....: list(K.ideal(16).invertible_residues())[:5]                                                                                                                                                           \n[1, 1/9*a + 2/9, 1/27*a + 1/27, 2/243*a + 1/243, 1/729*a]\n[1,\n 5/91*a + 11/91,\n 85/8281*a + 96/8281,\n 990/753571*a + 631/753571,\n 9095/68574961*a + 1991/68574961]\n```\n\nbut indeed it is a bug, again, not sure in Pari or in Sage.\nCan you repeat this computations in \"pure\" Pari/GP to check?",
    "created_at": "2021-06-09T11:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492813",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:172" align="right">comment:172</div>

I don't get a crash:

```
sage: K.<a> = NumberField(x^2 + x + 1) 
....: list(K.ideal(8).invertible_residues())[:5] 
....: list(K.ideal(16).invertible_residues())[:5]                                                                                                                                                           
[1, 1/9*a + 2/9, 1/27*a + 1/27, 2/243*a + 1/243, 1/729*a]
[1,
 5/91*a + 11/91,
 85/8281*a + 96/8281,
 990/753571*a + 631/753571,
 9095/68574961*a + 1991/68574961]
```

but indeed it is a bug, again, not sure in Pari or in Sage.
Can you repeat this computations in "pure" Pari/GP to check?



---

archive/issue_comments_492814.json:
```json
{
    "body": "<div id=\"comment:173\" align=\"right\">comment:173</div>\n\nAs to the crash, it's hard to say what's wrong, maybe you build Pari/GP in an unusual way, such as using MPIR (one should not)?",
    "created_at": "2021-06-09T12:00:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492814",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:173" align="right">comment:173</div>

As to the crash, it's hard to say what's wrong, maybe you build Pari/GP in an unusual way, such as using MPIR (one should not)?



---

archive/issue_comments_492815.json:
```json
{
    "body": "<div id=\"comment:174\" align=\"right\">comment:174</div>\n\nI didn't do anything \"unusual\" as far as I'm aware. I'm not using MPIR but the configure script is picking up my system-wide GMP library. I'm trying a rebuild forcing sage to build its own GMP (but that requires rebuilding about 50% of Sage so it will take a while).\n\n(By the way: if MPIR is deprecated, why is it supported by the configure script?)\n\nAs for your previous comment: I don't think this command has an exact equivalent in \"pure\" Pari. It looks like the problem is (once again) caused by changes to Smith normal form algorithms.",
    "created_at": "2021-06-09T12:25:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492815",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:174" align="right">comment:174</div>

I didn't do anything "unusual" as far as I'm aware. I'm not using MPIR but the configure script is picking up my system-wide GMP library. I'm trying a rebuild forcing sage to build its own GMP (but that requires rebuilding about 50% of Sage so it will take a while).

(By the way: if MPIR is deprecated, why is it supported by the configure script?)

As for your previous comment: I don't think this command has an exact equivalent in "pure" Pari. It looks like the problem is (once again) caused by changes to Smith normal form algorithms.



---

archive/issue_comments_492816.json:
```json
{
    "body": "<div id=\"comment:175\" align=\"right\">comment:175</div>\n\nAs I suspected, the change to the output of \"invertible_residues\" is a consequence of the fact that\n\n``` \nsage: diagonal_matrix([12,2,2]).smith_form()\n# with old Pari\n(\n[ 2  0  0]  [0 0 1]  [0 0 1]\n[ 0  2  0]  [0 1 0]  [0 1 0]\n[ 0  0 12], [1 0 0], [1 0 0]\n)\n# with new Pari\n(\n[ 2  0  0]  [ 1  0  1]  [ 0  0 -1]\n[ 0  2  0]  [ 0  1  0]  [ 0  1  0]\n[ 0  0 12], [-1  0  0], [ 1  0  6]\n)\n```\nThis doesn't explain the crash though; still waiting for the build to complete.",
    "created_at": "2021-06-09T12:43:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492816",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:175" align="right">comment:175</div>

As I suspected, the change to the output of "invertible_residues" is a consequence of the fact that

``` 
sage: diagonal_matrix([12,2,2]).smith_form()
# with old Pari
(
[ 2  0  0]  [0 0 1]  [0 0 1]
[ 0  2  0]  [0 1 0]  [0 1 0]
[ 0  0 12], [1 0 0], [1 0 0]
)
# with new Pari
(
[ 2  0  0]  [ 1  0  1]  [ 0  0 -1]
[ 0  2  0]  [ 0  1  0]  [ 0  1  0]
[ 0  0 12], [-1  0  0], [ 1  0  6]
)
```
This doesn't explain the crash though; still waiting for the build to complete.



---

archive/issue_comments_492817.json:
```json
{
    "body": "<div id=\"comment:176\" align=\"right\">comment:176</div>\n\nI now tested for  crash on macOS 11.4 and on Fedora 32 Linux, no crash. Will do one more different system, just in case.",
    "created_at": "2021-06-09T12:59:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492817",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:176" align="right">comment:176</div>

I now tested for  crash on macOS 11.4 and on Fedora 32 Linux, no crash. Will do one more different system, just in case.



---

archive/issue_comments_492818.json:
```json
{
    "body": "<div id=\"comment:177\" align=\"right\">comment:177</div>\n\nwith your latest patches I still get reported in [comment:166](#comment%3A166)\n\n```\nFile \"src/sage/modular/local_comp/local_comp.py\", line 704, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters\nFailed example:\n    Newform('243a',names='a').local_component(3).characters() # long time\n...\n```",
    "created_at": "2021-06-09T13:02:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492818",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:177" align="right">comment:177</div>

with your latest patches I still get reported in [comment:166](#comment%3A166)

```
File "src/sage/modular/local_comp/local_comp.py", line 704, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters
Failed example:
    Newform('243a',names='a').local_component(3).characters() # long time
...
```



---

archive/issue_comments_492819.json:
```json
{
    "body": "<div id=\"comment:178\" align=\"right\">comment:178</div>\n\nSo the Smith form stays the same, but the pivots it uses are now different, right?\nWith just positively reviewed Singular update (not merged yet) and the branch on this ticket, I see\n\n```\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1274, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\nFailed example:\n    Q.coordinate_vector(Q.0 - Q.1)\nExpected:\n    (1, -1)\nGot:\n    (1, 47)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1294, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\nFailed example:\n    Q.coordinate_vector(x)\nExpected:\n    (0, -1)\nGot:\n    (0, 11)\n```\n\nProbably the same story?",
    "created_at": "2021-06-09T13:12:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492819",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:178" align="right">comment:178</div>

So the Smith form stays the same, but the pivots it uses are now different, right?
With just positively reviewed Singular update (not merged yet) and the branch on this ticket, I see

```
File "src/sage/modules/fg_pid/fgp_module.py", line 1274, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
Failed example:
    Q.coordinate_vector(Q.0 - Q.1)
Expected:
    (1, -1)
Got:
    (1, 47)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1294, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
Failed example:
    Q.coordinate_vector(x)
Expected:
    (0, -1)
Got:
    (0, 11)
```

Probably the same story?



---

archive/issue_comments_492820.json:
```json
{
    "body": "<div id=\"comment:179\" align=\"right\">comment:179</div>\n\nalso on Gentoo Linux I don't get a crash as reported in [comment:171](#comment%3A171) - so I am inclined to see it as a one-time irreproducible non-bug.",
    "created_at": "2021-06-09T14:53:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492820",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:179" align="right">comment:179</div>

also on Gentoo Linux I don't get a crash as reported in [comment:171](#comment%3A171) - so I am inclined to see it as a one-time irreproducible non-bug.



---

archive/issue_comments_492821.json:
```json
{
    "body": "<div id=\"comment:180\" align=\"right\">comment:180</div>\n\nThe problem in [comment:177](#comment%3A177) is a knock-on effect of the invertible_residues bug. This can be fixed by changing the line\n\n``` \nnew_basis = [prod([g[j]**V[i, j] for j in range(n)]) for i in range(n)]\n```\nto \n\n``` \nnew_basis = [prod([g[j]**(V[i, j] % invs[j]) for j in range(n)]) for i in range(n)]\n```\nin the code for `invertible_residues_mod`, line 2777 of number_field_ideal.py. However, I cannot test this myself, since every time I run the code (with or without this fix), it crashes. I've spent most of the afternoon repeatedly recompiling Sage with different config options trying to get rid of this \"one-time bug\" and it still crashes every single time.\n\n(More specifically: if I let Sage's \"configure\" pick up the system gmp libraries, then it builds, but I see the crash. If I tell Sage to build its own gmp, then it fails to compile giac. This is in Ubuntu 20 LTS, which is hardly an obscure operating system, surely?)",
    "created_at": "2021-06-09T15:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492821",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:180" align="right">comment:180</div>

The problem in [comment:177](#comment%3A177) is a knock-on effect of the invertible_residues bug. This can be fixed by changing the line

``` 
new_basis = [prod([g[j]**V[i, j] for j in range(n)]) for i in range(n)]
```
to 

``` 
new_basis = [prod([g[j]**(V[i, j] % invs[j]) for j in range(n)]) for i in range(n)]
```
in the code for `invertible_residues_mod`, line 2777 of number_field_ideal.py. However, I cannot test this myself, since every time I run the code (with or without this fix), it crashes. I've spent most of the afternoon repeatedly recompiling Sage with different config options trying to get rid of this "one-time bug" and it still crashes every single time.

(More specifically: if I let Sage's "configure" pick up the system gmp libraries, then it builds, but I see the crash. If I tell Sage to build its own gmp, then it fails to compile giac. This is in Ubuntu 20 LTS, which is hardly an obscure operating system, surely?)



---

archive/issue_comments_492822.json:
```json
{
    "body": "<div id=\"comment:181\" align=\"right\">comment:181</div>\n\noh dear. Is the system up to date? What is the version of gcc?\nAre you a lucky user of tigerlake CPU? (If yes, please see https://groups.google.com/g/sage-devel/c/XHzqSPyuYec/m/Iv5v5g6OCgAJ - update to gcc 10)",
    "created_at": "2021-06-09T16:05:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492822",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:181" align="right">comment:181</div>

oh dear. Is the system up to date? What is the version of gcc?
Are you a lucky user of tigerlake CPU? (If yes, please see https://groups.google.com/g/sage-devel/c/XHzqSPyuYec/m/Iv5v5g6OCgAJ - update to gcc 10)



---

archive/issue_comments_492823.json:
```json
{
    "body": "<div id=\"comment:182\" align=\"right\">comment:182</div>\n\nin any event, please post the top-level config.log and more info on the crash(es), a backtrace, preferably. Does it happen in Pari?",
    "created_at": "2021-06-09T16:17:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492823",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:182" align="right">comment:182</div>

in any event, please post the top-level config.log and more info on the crash(es), a backtrace, preferably. Does it happen in Pari?



---

archive/issue_comments_492824.json:
```json
{
    "body": "<div id=\"comment:183\" align=\"right\">comment:183</div>\n\nIt's not a tigerlake cpu (not that new). GCC version is 9.3.0. The operating system is Ubuntu 20.04 LTS, currently the most recent Ubuntu long-term-support version.\n\nHere's the config.log file:\n\nhttps://pastebin.com/3Kc7RNP0\n\nHere's the traceback:\n\nhttps://pastebin.com/bcW8GHVg",
    "created_at": "2021-06-09T16:36:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492824",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:183" align="right">comment:183</div>

It's not a tigerlake cpu (not that new). GCC version is 9.3.0. The operating system is Ubuntu 20.04 LTS, currently the most recent Ubuntu long-term-support version.

Here's the config.log file:

https://pastebin.com/3Kc7RNP0

Here's the traceback:

https://pastebin.com/bcW8GHVg



---

archive/issue_comments_492825.json:
```json
{
    "body": "<div id=\"comment:184\" align=\"right\">comment:184</div>\n\nYou are apparently mixing two or more GMP versions, one in `/usr/local`, as seen in traceback\n\n```\n#13 0x00007f5ab24cd10b in __gmpq_div () from /usr/local/lib/libgmp.so.23\n```\nanother in `/usr/`, as seen in config.log (`//usr/include/x86_64-linux-gnu/gmp.h`)\n\nI'd suggest getting rid of whatever is in `/usr/local`, and stick to the system version.\n(And perhaps do `make distclean`, to make sure it's all back to normal)",
    "created_at": "2021-06-09T17:05:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492825",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:184" align="right">comment:184</div>

You are apparently mixing two or more GMP versions, one in `/usr/local`, as seen in traceback

```
#13 0x00007f5ab24cd10b in __gmpq_div () from /usr/local/lib/libgmp.so.23
```
another in `/usr/`, as seen in config.log (`//usr/include/x86_64-linux-gnu/gmp.h`)

I'd suggest getting rid of whatever is in `/usr/local`, and stick to the system version.
(And perhaps do `make distclean`, to make sure it's all back to normal)



---

archive/issue_comments_492826.json:
```json
{
    "body": "<div id=\"comment:185\" align=\"right\">comment:185</div>\n\nI can confirm that the fix in [comment:180](#comment%3A180) does the job, great! I'll add it and the rest of fixes, should be ready to go then, hopefully.",
    "created_at": "2021-06-09T18:22:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492826",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:185" align="right">comment:185</div>

I can confirm that the fix in [comment:180](#comment%3A180) does the job, great! I'll add it and the rest of fixes, should be ready to go then, hopefully.



---

archive/issue_comments_492827.json:
```json
{
    "body": "Changed commit from **[`bb0245a`](https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63)** to **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**",
    "created_at": "2021-06-09T18:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492827",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bb0245a`](https://github.com/sagemath/sagetrac-mirror/commit/bb0245abf74aba706583c94724d7a3e5b06e2b63)** to **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**



---

archive/issue_comments_492828.json:
```json
{
    "body": "<div id=\"comment:186\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7\"><code>c78b147</code></a></td><td><code>fix pari 2.13-related issue of different Smith form</code></td></tr></table>\n",
    "created_at": "2021-06-09T18:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492828",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:186"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7"><code>c78b147</code></a></td><td><code>fix pari 2.13-related issue of different Smith form</code></td></tr></table>




---

archive/issue_comments_492829.json:
```json
{
    "body": "<div id=\"comment:187\" align=\"right\">comment:187</div>\n\nback to needs review!",
    "created_at": "2021-06-09T18:58:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492829",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:187" align="right">comment:187</div>

back to needs review!



---

archive/issue_events_421748.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-09T18:58:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421748"
}
```



---

archive/issue_events_421749.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-09T18:58:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421749"
}
```



---

archive/issue_comments_492830.json:
```json
{
    "body": "<div id=\"comment:188\" align=\"right\">comment:188</div>\n\nConfirming this branch eliminates the error I was seeing in PARI/GP's qfminim(), due to a bug in PARI/GP that's since been corrected in that libraries source code. My elliptic curve code is now running properly again.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7\"><code>c78b147</code></a></td><td><code>fix pari 2.13-related issue of different Smith form</code></td></tr></table>\n",
    "created_at": "2021-06-09T19:11:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492830",
    "user": "https://github.com/octonion"
}
```

<div id="comment:188" align="right">comment:188</div>

Confirming this branch eliminates the error I was seeing in PARI/GP's qfminim(), due to a bug in PARI/GP that's since been corrected in that libraries source code. My elliptic curve code is now running properly again.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7"><code>c78b147</code></a></td><td><code>fix pari 2.13-related issue of different Smith form</code></td></tr></table>




---

archive/issue_comments_492831.json:
```json
{
    "body": "<div id=\"comment:189\" align=\"right\">comment:189</div>\n\nThis had a positive review before the issues with local components came up, and I'm confident those are fixed, so I think we can reinstate the positive review.",
    "created_at": "2021-06-10T12:57:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492831",
    "user": "https://github.com/loefflerd"
}
```

<div id="comment:189" align="right">comment:189</div>

This had a positive review before the issues with local components came up, and I'm confident those are fixed, so I think we can reinstate the positive review.



---

archive/issue_events_421750.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2021-06-10T12:57:45Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421750"
}
```



---

archive/issue_events_421751.json:
```json
{
    "actor": "https://github.com/loefflerd",
    "created_at": "2021-06-10T12:57:45Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421751"
}
```



---

archive/issue_comments_492832.json:
```json
{
    "body": "Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, David Loeffler**",
    "created_at": "2021-06-10T19:43:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492832",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **Dima Pasechnik** to **Dima Pasechnik, David Loeffler**



---

archive/issue_events_421752.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-20T08:14:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421752"
}
```



---

archive/issue_events_421753.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "ab69ab331300c71696227da1d2306bfd8041f25a",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-20T08:14:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30801#event-421753"
}
```



---

archive/issue_comments_492833.json:
```json
{
    "body": "Changed branch from **[public/30801](https://github.com/sagemath/sagetrac-mirror/tree/public/30801)** to **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**",
    "created_at": "2021-06-20T08:14:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492833",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/30801](https://github.com/sagemath/sagetrac-mirror/tree/public/30801)** to **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)**



---

archive/issue_comments_492834.json:
```json
{
    "body": "Changed commit from **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)** to none",
    "created_at": "2021-06-23T06:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492834",
    "user": "https://github.com/fchapoton"
}
```

Changed commit from **[`c78b147`](https://github.com/sagemath/sagetrac-mirror/commit/c78b1470fccd915e2fa93f95f2fefba6220fb1f7)** to none



---

archive/issue_comments_492835.json:
```json
{
    "body": "<div id=\"comment:192\" align=\"right\">comment:192</div>\n\nWith 9.4.b3 and pari 2.13, my patchbot petitbonum has now two errors in src/sage/modules/fg_pid/fgp_module.py\n\nhttps://patchbot.sagemath.org/ticket/0/",
    "created_at": "2021-06-23T06:41:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492835",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:192" align="right">comment:192</div>

With 9.4.b3 and pari 2.13, my patchbot petitbonum has now two errors in src/sage/modules/fg_pid/fgp_module.py

https://patchbot.sagemath.org/ticket/0/



---

archive/issue_comments_492836.json:
```json
{
    "body": "<div id=\"comment:193\" align=\"right\">comment:193</div>\n\nReplying to [@fchapoton](#comment%3A192):\n> With 9.4.b3 and pari 2.13, my patchbot petitbonum has now two errors in src/sage/modules/fg_pid/fgp_module.py\n> \n> https://patchbot.sagemath.org/ticket/0/\n\nis it the same as in [comment:178](#comment%3A178) ?\nI tried reproducing this, but failed.",
    "created_at": "2021-06-23T08:19:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492836",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:193" align="right">comment:193</div>

Replying to [@fchapoton](#comment%3A192):
> With 9.4.b3 and pari 2.13, my patchbot petitbonum has now two errors in src/sage/modules/fg_pid/fgp_module.py
> 
> https://patchbot.sagemath.org/ticket/0/

is it the same as in [comment:178](#comment%3A178) ?
I tried reproducing this, but failed.



---

archive/issue_comments_492837.json:
```json
{
    "body": "<div id=\"comment:194\" align=\"right\">comment:194</div>\n\nyes, exactly the same as [comment:178](#comment%3A178), see\n\nhttps://patchbot.sagemath.org/log/0/Linux/83-Ubuntu_SMP_Sat_May_8_02:35:39_UTC_2021/x86_64/5.4.0-74-generic/petitbonum/2021-06-22%2019:14:45?short",
    "created_at": "2021-06-23T09:45:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492837",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:194" align="right">comment:194</div>

yes, exactly the same as [comment:178](#comment%3A178), see

https://patchbot.sagemath.org/log/0/Linux/83-Ubuntu_SMP_Sat_May_8_02:35:39_UTC_2021/x86_64/5.4.0-74-generic/petitbonum/2021-06-22%2019:14:45?short



---

archive/issue_comments_492838.json:
```json
{
    "body": "<div id=\"comment:195\" align=\"right\">comment:195</div>\n\nRight, I see, it actually depends upon the random seed.\nE.g. on Fedora 32 with gcc 10.3 and non-0 seed I get\n\n```\n$ ./sage -t --long --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py\nRunning doctests with ID 2021-06-23-14-11-38-7a14ecbb.\nGit branch: HEAD\nUsing --optional=build,dochtml,fedora,gap_packages,libsemigroups,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1274, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\nFailed example:\n    Q.coordinate_vector(Q.0 - Q.1)\nExpected:\n    (1, -1)\nGot:\n    (1, 47)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1294, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\nFailed example:\n    Q.coordinate_vector(x)\nExpected:\n    (0, -1)\nGot:\n    (0, 11)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1701, in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element\nFailed example:\n    Q.random_element()\nExpected:\n    (1, 5)\nGot:\n    (3, 8)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1923, in sage.modules.fg_pid.fgp_module.random_fgp_module\nFailed example:\n    fgp.random_fgp_module(4)\nExpected:\n    Finitely generated module V/W over Integer Ring with invariants (4)\nGot:\n    Finitely generated module V/W over Integer Ring with invariants (0)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1951, in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0\nFailed example:\n    fgp.random_fgp_morphism_0(4)\nExpected:\n    Morphism from module over Integer Ring with invariants (4,) to module with invariants (4,) that sends the generators to [(0)]\nGot:\n    Morphism from module over Integer Ring with invariants (0,) to module with invariants (0,) that sends the generators to [(1)]\n**********************************************************************\n4 items had failures:\n   2 of  23 in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector\n   1 of   4 in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element\n   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_module\n   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0\n    [397 tests, 5 failures, 1.93 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py  # 5 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 2.0 seconds\n```\non the same machine, but with Sage built using clang 10, with 0 random seed these tests pass.\nWith random seed as above I get\n\n```\n$ ./sage -t --long --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py\nRunning doctests with ID 2021-06-23-14-10-28-0b9d083c.\nGit branch: HEAD\nUsing --optional=build,dochtml,fedora,gap_packages,libsemigroups,pip,sage,sage_spkg\nDoctesting 1 file.\nsage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1701, in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element\nFailed example:\n    Q.random_element()\nExpected:\n    (1, 5)\nGot:\n    (3, 8)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1923, in sage.modules.fg_pid.fgp_module.random_fgp_module\nFailed example:\n    fgp.random_fgp_module(4)\nExpected:\n    Finitely generated module V/W over Integer Ring with invariants (4)\nGot:\n    Finitely generated module V/W over Integer Ring with invariants (0)\n**********************************************************************\nFile \"src/sage/modules/fg_pid/fgp_module.py\", line 1951, in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0\nFailed example:\n    fgp.random_fgp_morphism_0(4)\nExpected:\n    Morphism from module over Integer Ring with invariants (4,) to module with invariants (4,) that sends the generators to [(0)]\nGot:\n    Morphism from module over Integer Ring with invariants (0,) to module with invariants (0,) that sends the generators to [(1)]\n**********************************************************************\n3 items had failures:\n   1 of   4 in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element\n   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_module\n   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0\n    [397 tests, 3 failures, 2.21 s]\n----------------------------------------------------------------------\nsage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py  # 3 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 2.3 seconds\n```\n\nI suppose this should become part of #29935",
    "created_at": "2021-06-23T13:24:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492838",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:195" align="right">comment:195</div>

Right, I see, it actually depends upon the random seed.
E.g. on Fedora 32 with gcc 10.3 and non-0 seed I get

```
$ ./sage -t --long --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py
Running doctests with ID 2021-06-23-14-11-38-7a14ecbb.
Git branch: HEAD
Using --optional=build,dochtml,fedora,gap_packages,libsemigroups,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1274, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
Failed example:
    Q.coordinate_vector(Q.0 - Q.1)
Expected:
    (1, -1)
Got:
    (1, 47)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1294, in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
Failed example:
    Q.coordinate_vector(x)
Expected:
    (0, -1)
Got:
    (0, 11)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1701, in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element
Failed example:
    Q.random_element()
Expected:
    (1, 5)
Got:
    (3, 8)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1923, in sage.modules.fg_pid.fgp_module.random_fgp_module
Failed example:
    fgp.random_fgp_module(4)
Expected:
    Finitely generated module V/W over Integer Ring with invariants (4)
Got:
    Finitely generated module V/W over Integer Ring with invariants (0)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1951, in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0
Failed example:
    fgp.random_fgp_morphism_0(4)
Expected:
    Morphism from module over Integer Ring with invariants (4,) to module with invariants (4,) that sends the generators to [(0)]
Got:
    Morphism from module over Integer Ring with invariants (0,) to module with invariants (0,) that sends the generators to [(1)]
**********************************************************************
4 items had failures:
   2 of  23 in sage.modules.fg_pid.fgp_module.FGP_Module_class.coordinate_vector
   1 of   4 in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element
   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_module
   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0
    [397 tests, 5 failures, 1.93 s]
----------------------------------------------------------------------
sage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 2.0 seconds
```
on the same machine, but with Sage built using clang 10, with 0 random seed these tests pass.
With random seed as above I get

```
$ ./sage -t --long --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py
Running doctests with ID 2021-06-23-14-10-28-0b9d083c.
Git branch: HEAD
Using --optional=build,dochtml,fedora,gap_packages,libsemigroups,pip,sage,sage_spkg
Doctesting 1 file.
sage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1701, in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element
Failed example:
    Q.random_element()
Expected:
    (1, 5)
Got:
    (3, 8)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1923, in sage.modules.fg_pid.fgp_module.random_fgp_module
Failed example:
    fgp.random_fgp_module(4)
Expected:
    Finitely generated module V/W over Integer Ring with invariants (4)
Got:
    Finitely generated module V/W over Integer Ring with invariants (0)
**********************************************************************
File "src/sage/modules/fg_pid/fgp_module.py", line 1951, in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0
Failed example:
    fgp.random_fgp_morphism_0(4)
Expected:
    Morphism from module over Integer Ring with invariants (4,) to module with invariants (4,) that sends the generators to [(0)]
Got:
    Morphism from module over Integer Ring with invariants (0,) to module with invariants (0,) that sends the generators to [(1)]
**********************************************************************
3 items had failures:
   1 of   4 in sage.modules.fg_pid.fgp_module.FGP_Module_class.random_element
   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_module
   1 of   3 in sage.modules.fg_pid.fgp_module.random_fgp_morphism_0
    [397 tests, 3 failures, 2.21 s]
----------------------------------------------------------------------
sage -t --long --warn-long 53.3 --random-seed=423333338768755345354 src/sage/modules/fg_pid/fgp_module.py  # 3 doctests failed
----------------------------------------------------------------------
Total time for all tests: 2.3 seconds
```

I suppose this should become part of #29935



---

archive/issue_comments_492839.json:
```json
{
    "body": "<div id=\"comment:196\" align=\"right\">comment:196</div>\n\nI believe this will be fixed with #29978.",
    "created_at": "2021-06-23T14:41:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492839",
    "user": "https://github.com/kliem"
}
```

<div id="comment:196" align="right">comment:196</div>

I believe this will be fixed with #29978.



---

archive/issue_comments_492840.json:
```json
{
    "body": "<div id=\"comment:197\" align=\"right\">comment:197</div>\n\nNo, #29978 does not fix the problem.",
    "created_at": "2021-06-23T15:21:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492840",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:197" align="right">comment:197</div>

No, #29978 does not fix the problem.



---

archive/issue_comments_492841.json:
```json
{
    "body": "<div id=\"comment:198\" align=\"right\">comment:198</div>\n\nI see. I got confused.\n\nSo there is actually 2 failing doctests in lines 1274 and lines 1294 that should be fixed.",
    "created_at": "2021-06-23T18:06:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492841",
    "user": "https://github.com/kliem"
}
```

<div id="comment:198" align="right">comment:198</div>

I see. I got confused.

So there is actually 2 failing doctests in lines 1274 and lines 1294 that should be fixed.



---

archive/issue_comments_492842.json:
```json
{
    "body": "<div id=\"comment:199\" align=\"right\">comment:199</div>\n\nReplying to [@kliem](#comment%3A198):\n> I see. I got confused.\n> \n> So there is actually 2 failing doctests in lines 1274 and lines 1294 that should be fixed.\n\n#29978 fixes the clang setup from [comment:195](#comment%3A195) fully, but the gcc (gcc version 10.3.1 20210422 (Red Hat 10.3.1-1))\nsetup still exhibits 2 failures (irrespectively of the random seed).\n\nMaybe it's a gcc 10 bug? Or we have randomness in various Sage packages not fully under control, otherwise this discrepancy looks strange.",
    "created_at": "2021-06-23T19:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492842",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:199" align="right">comment:199</div>

Replying to [@kliem](#comment%3A198):
> I see. I got confused.
> 
> So there is actually 2 failing doctests in lines 1274 and lines 1294 that should be fixed.

#29978 fixes the clang setup from [comment:195](#comment%3A195) fully, but the gcc (gcc version 10.3.1 20210422 (Red Hat 10.3.1-1))
setup still exhibits 2 failures (irrespectively of the random seed).

Maybe it's a gcc 10 bug? Or we have randomness in various Sage packages not fully under control, otherwise this discrepancy looks strange.



---

archive/issue_comments_492843.json:
```json
{
    "body": "<div id=\"comment:200\" align=\"right\">comment:200</div>\n\nI think the fix is quite trivial. Apparently with `reduce=False` things really are random. There is already one test in line 1`288 that is marked as random because of this. So yes, this could be done in a follow up of #29978.",
    "created_at": "2021-06-23T20:17:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492843",
    "user": "https://github.com/kliem"
}
```

<div id="comment:200" align="right">comment:200</div>

I think the fix is quite trivial. Apparently with `reduce=False` things really are random. There is already one test in line 1`288 that is marked as random because of this. So yes, this could be done in a follow up of #29978.



---

archive/issue_comments_492844.json:
```json
{
    "body": "<div id=\"comment:201\" align=\"right\">comment:201</div>\n\nSee #32048 for a possible fix.",
    "created_at": "2021-06-24T08:07:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492844",
    "user": "https://github.com/kliem"
}
```

<div id="comment:201" align="right">comment:201</div>

See #32048 for a possible fix.



---

archive/issue_comments_492845.json:
```json
{
    "body": "<div id=\"comment:202\" align=\"right\">comment:202</div>\n\nThe problem above and another error not reported before, are responsible for \"my\" patchbot panke to be dead for now, I just found out.\n\n```\nsage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py                                                                                                                                                                                                       \n**********************************************************************                                                                                                                                                                                                         \nFile \"src/sage/modular/local_comp/local_comp.py\", line 653, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters                                                                                                                                            \nFailed example:                                                                                                                                                                                                                                                                \n    set(Pi.characters())                                                                                                                                                                                                                                                       \nExpected:                                                                                                                                                                                                                                                                      \n    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,                                                                                                                                                \n     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}                                                                                                                                                          \nGot:                                                                                                                                                                                                                                                                           \n    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,                                                                                                                                                          \n     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}  \n```\n\nI don't know why you introduced set in a doctest. It's not stable.\n\nIn #29977 I try to fix it by just outputing `Pi.characters()`. I don't know if that is stable either.",
    "created_at": "2021-07-01T18:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492845",
    "user": "https://github.com/kliem"
}
```

<div id="comment:202" align="right">comment:202</div>

The problem above and another error not reported before, are responsible for "my" patchbot panke to be dead for now, I just found out.

```
sage -t --long --random-seed=0 src/sage/modular/local_comp/local_comp.py                                                                                                                                                                                                       
**********************************************************************                                                                                                                                                                                                         
File "src/sage/modular/local_comp/local_comp.py", line 653, in sage.modular.local_comp.local_comp.PrimitiveSupercuspidal.characters                                                                                                                                            
Failed example:                                                                                                                                                                                                                                                                
    set(Pi.characters())                                                                                                                                                                                                                                                       
Expected:                                                                                                                                                                                                                                                                      
    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,                                                                                                                                                
     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}                                                                                                                                                          
Got:                                                                                                                                                                                                                                                                           
    {Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,                                                                                                                                                          
     Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}  
```

I don't know why you introduced set in a doctest. It's not stable.

In #29977 I try to fix it by just outputing `Pi.characters()`. I don't know if that is stable either.



---

archive/issue_comments_492846.json:
```json
{
    "body": "<div id=\"comment:203\" align=\"right\">comment:203</div>\n\nthe Python's insane treatment of sets makes me mentally unstable, this is for sure.\nIs there any f*cking way in this cr*p of a language to output anything at all in a unique order?",
    "created_at": "2021-07-01T20:22:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492846",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:203" align="right">comment:203</div>

the Python's insane treatment of sets makes me mentally unstable, this is for sure.
Is there any f*cking way in this cr*p of a language to output anything at all in a unique order?



---

archive/issue_comments_492847.json:
```json
{
    "body": "<div id=\"comment:204\" align=\"right\">comment:204</div>\n\nsorry for screaming...",
    "created_at": "2021-07-01T20:23:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492847",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:204" align="right">comment:204</div>

sorry for screaming...



---

archive/issue_comments_492848.json:
```json
{
    "body": "<div id=\"comment:205\" align=\"right\">comment:205</div>\n\nPerhaps `sorted` could sort this out?\n\n```\nsage: chars = sorted(Pi.characters())\nsage: chars\n```\nHow about using `sorted` for all occurrences\nof `Pi.characters()` in that file?",
    "created_at": "2021-07-01T21:27:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492848",
    "user": "https://github.com/slel"
}
```

<div id="comment:205" align="right">comment:205</div>

Perhaps `sorted` could sort this out?

```
sage: chars = sorted(Pi.characters())
sage: chars
```
How about using `sorted` for all occurrences
of `Pi.characters()` in that file?



---

archive/issue_comments_492849.json:
```json
{
    "body": "<div id=\"comment:206\" align=\"right\">comment:206</div>\n\nDoctests try to sort dictionaries and sets uniquely. However it fails here.\n\nThis is really strange.\n\nIt apparently depends on the compiler(?):\n\n```\nsage: from IPython.lib.pretty import pprint \nsage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]\nsage: Pi = LocalComponent(f, 5)                                                                                                       \nsage: pprint(set(Pi.characters()))                                                                                                    \n{Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,\n Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}\n```\n\non Debian buster with pari 2.13.1 installed and gcc 8.3.\n\n```\nsage: from IPython.lib.pretty import pprint \nsage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]\nsage: Pi = LocalComponent(f, 5)                                                                                                       \nsage: pprint(set(Pi.characters()))  \n{Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,\n Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}\n```\n\non Ubuntu focal with pari 2.13.1 installed and gcc 9.3.0.\n\nThe problems is that the output is not sortable:\n\n```\nsage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]\nsage: Pi = LocalComponent(f, 5)        \nsage: a = list(Pi.characters())\nsage: b = [a[1], a[0]]\nsage: sorted(a) == sorted(b)\nFalse\nsage: a                                                                                                                             \n[Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,\n Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5]\nsage: b                                                                                                                               \n[Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,\n Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5]\n```\n\nHence ipythons pretty printer fails https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py.",
    "created_at": "2021-07-02T05:52:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492849",
    "user": "https://github.com/kliem"
}
```

<div id="comment:206" align="right">comment:206</div>

Doctests try to sort dictionaries and sets uniquely. However it fails here.

This is really strange.

It apparently depends on the compiler(?):

```
sage: from IPython.lib.pretty import pprint 
sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]
sage: Pi = LocalComponent(f, 5)                                                                                                       
sage: pprint(set(Pi.characters()))                                                                                                    
{Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,
 Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5}
```

on Debian buster with pari 2.13.1 installed and gcc 8.3.

```
sage: from IPython.lib.pretty import pprint 
sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]
sage: Pi = LocalComponent(f, 5)                                                                                                       
sage: pprint(set(Pi.characters()))  
{Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,
 Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5}
```

on Ubuntu focal with pari 2.13.1 installed and gcc 9.3.0.

The problems is that the output is not sortable:

```
sage: f = Newforms(GammaH(25, [6]), 3, names='j')[0]
sage: Pi = LocalComponent(f, 5)        
sage: a = list(Pi.characters())
sage: b = [a[1], a[0]]
sage: sorted(a) == sorted(b)
False
sage: a                                                                                                                             
[Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5,
 Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5]
sage: b                                                                                                                               
[Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> -1/3*j0^2*d, 5 |--> 5,
 Character of unramified extension Q_5(s)* (s^2 + 4*s + 2 = 0), of level 1, mapping s |--> 1/3*j0^2*d - 1/3*j0^3, 5 |--> 5]
```

Hence ipythons pretty printer fails https://github.com/ipython/ipython/blob/master/IPython/lib/pretty.py.



---

archive/issue_comments_492850.json:
```json
{
    "body": "<div id=\"comment:207\" align=\"right\">comment:207</div>\n\nLet's move the discussion to #29977.",
    "created_at": "2021-07-02T06:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30801",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30801#issuecomment-492850",
    "user": "https://github.com/slel"
}
```

<div id="comment:207" align="right">comment:207</div>

Let's move the discussion to #29977.
