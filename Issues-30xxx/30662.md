# Issue 30662: Update conda package information, and fix building Sage on conda

archive/issues_030425.json:
```json
{
    "body": "1) `build/pkgs/conda.txt` still has `\"python<3.8\"`\n\n2) Some trouble involving libpng as reported in https://groups.google.com/d/msg/sage-devel/LMFRiG9Y0ZM/1FIyE5P4CAAJ\n\n\n\nCC:  @dimpase @isuruf\n\nBranch/Commit: 335bfa14fc9a50e2a152b674083e7e70b5ed31ab\n\nReviewer: Dima Pasechnik, Isuru Fernando\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30662\n\n",
    "closed_at": "2020-09-30T22:30:25Z",
    "created_at": "2020-09-25T14:36:40Z",
    "labels": [
        "component: porting",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Update conda package information, and fix building Sage on conda",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30662",
    "user": "https://github.com/mkoeppe"
}
```
1) `build/pkgs/conda.txt` still has `"python<3.8"`

2) Some trouble involving libpng as reported in https://groups.google.com/d/msg/sage-devel/LMFRiG9Y0ZM/1FIyE5P4CAAJ



CC:  @dimpase @isuruf

Branch/Commit: 335bfa14fc9a50e2a152b674083e7e70b5ed31ab

Reviewer: Dima Pasechnik, Isuru Fernando

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30662





---

archive/issue_comments_433486.json:
```json
{
    "body": "<a id='comment:1'></a>yes, I'm currently trying to reproduce this, and ran so far into a similar error.\nI am not sure whether there  always was the recommendation to use Conda's compilers, \nc-compiler, cxx-compiler, and fortran-compiler.\n\nWhat I see atm is\n\n```\nlibtool: compile:  /home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc -DPACKAGE_NAME=\\\"libhomfly\\\" -DPACKAGE_TARNAME=\\\"libhomfly\\\" -DPACKAGE_VERSION=\\\"1.02r6\\\" \"-DPACKAGE_STRING=\\\"libhomfly 1.02r6\\\"\" -DPACKAGE_BUGREPORT=\\\"mmarco@unizar.es\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"libhomfly\\\" -DVERSION=\\\"1.02r6\\\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\\\".libs/\\\" -I. -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/scratch2/dimpase/miniconda3/include -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/scratch2/dimpase/miniconda3/include -c control.c  -fPIC -DPIC -o .libs/control.o\nbound.c:10:10: fatal error: gc.h: No such file or directory\n #include <gc.h>\n          ^~~~~~\n``` \nin\n\n```\nSetting up build directory for libhomfly-1.02r6\nFinished extraction\nNo patch files found in ../patches\n****************************************************\nHost system:\nLinux clpc171.cs.ox.ac.uk 5.2.18-200.fc30.x86_64 #1 SMP Tue Oct 1 13:14:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n****************************************************\nC compiler: /home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc\nC compiler version:\nReading specs from /home/scratch2/dimpase/miniconda3/bin/../lib/gcc/x86_64-conda-linux-gnu/7.5.0/specs\nCOLLECT_GCC=/home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc\nCOLLECT_LTO_WRAPPER=/home/scratch2/dimpase/miniconda3/bin/../libexec/gcc/x86_64-conda-linux-gnu/7.5.0/lto-wrapper\nTarget: x86_64-conda-linux-gnu\nConfigured with: /home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/src/gcc/configure --build=x86_64-build_pc-linux-gnu --host=x86_64-build_pc-linux-gnu --target=x86_64-conda-linux-gnu --prefix=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built --with-sysroot=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built/x86_64-conda-linux-gnu/sysroot --enable-languages=c,c++,fortran,objc,obj-c++ --with-pkgversion='crosstool-NG 1.24.0.131_87df0e6_dirty' --enable-__cxa_atexit --disable-libmudflap --enable-libgomp --disable-libssp --enable-libquadmath --enable-libquadmath-support --enable-libsanitizer --enable-libmpx --with-gmp=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-mpfr=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-mpc=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-isl=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --enable-lto --enable-threads=posix --enable-target-optspace --enable-plugin --enable-gold --disable-nls --disable-multilib --with-local-prefix=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built/x86_64-conda-linux-gnu/sysroot --enable-long-long --enable-default-pie\nThread model: posix\ngcc version 7.5.0 (crosstool-NG 1.24.0.131_87df0e6_dirty) \n...\n```\n\nyes, this one is probably fixable by installing conda gc package (if there is one) - but the question is why the compiler does not want to see anything in /usr/include?\n\n(here Sage is configured to use system gc package)",
    "created_at": "2020-09-25T15:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433486",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>yes, I'm currently trying to reproduce this, and ran so far into a similar error.
I am not sure whether there  always was the recommendation to use Conda's compilers, 
c-compiler, cxx-compiler, and fortran-compiler.

What I see atm is

```
libtool: compile:  /home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc -DPACKAGE_NAME=\"libhomfly\" -DPACKAGE_TARNAME=\"libhomfly\" -DPACKAGE_VERSION=\"1.02r6\" "-DPACKAGE_STRING=\"libhomfly 1.02r6\"" -DPACKAGE_BUGREPORT=\"mmarco@unizar.es\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libhomfly\" -DVERSION=\"1.02r6\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I. -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/scratch2/dimpase/miniconda3/include -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/scratch2/dimpase/miniconda3/include -c control.c  -fPIC -DPIC -o .libs/control.o
bound.c:10:10: fatal error: gc.h: No such file or directory
 #include <gc.h>
          ^~~~~~
``` 
in

```
Setting up build directory for libhomfly-1.02r6
Finished extraction
No patch files found in ../patches
****************************************************
Host system:
Linux clpc171.cs.ox.ac.uk 5.2.18-200.fc30.x86_64 #1 SMP Tue Oct 1 13:14:07 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux
****************************************************
C compiler: /home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc
C compiler version:
Reading specs from /home/scratch2/dimpase/miniconda3/bin/../lib/gcc/x86_64-conda-linux-gnu/7.5.0/specs
COLLECT_GCC=/home/scratch2/dimpase/miniconda3/bin/x86_64-conda-linux-gnu-cc
COLLECT_LTO_WRAPPER=/home/scratch2/dimpase/miniconda3/bin/../libexec/gcc/x86_64-conda-linux-gnu/7.5.0/lto-wrapper
Target: x86_64-conda-linux-gnu
Configured with: /home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/src/gcc/configure --build=x86_64-build_pc-linux-gnu --host=x86_64-build_pc-linux-gnu --target=x86_64-conda-linux-gnu --prefix=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built --with-sysroot=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built/x86_64-conda-linux-gnu/sysroot --enable-languages=c,c++,fortran,objc,obj-c++ --with-pkgversion='crosstool-NG 1.24.0.131_87df0e6_dirty' --enable-__cxa_atexit --disable-libmudflap --enable-libgomp --disable-libssp --enable-libquadmath --enable-libquadmath-support --enable-libsanitizer --enable-libmpx --with-gmp=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-mpfr=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-mpc=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --with-isl=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/.build/x86_64-conda-linux-gnu/buildtools --enable-lto --enable-threads=posix --enable-target-optspace --enable-plugin --enable-gold --disable-nls --disable-multilib --with-local-prefix=/home/conda/feedstock_root/build_artifacts/ctng-compilers_1598124794965/work/gcc_built/x86_64-conda-linux-gnu/sysroot --enable-long-long --enable-default-pie
Thread model: posix
gcc version 7.5.0 (crosstool-NG 1.24.0.131_87df0e6_dirty) 
...
```

yes, this one is probably fixable by installing conda gc package (if there is one) - but the question is why the compiler does not want to see anything in /usr/include?

(here Sage is configured to use system gc package)



---

archive/issue_comments_433487.json:
```json
{
    "body": "<a id='comment:2'></a>> but the question is why the compiler does not want to see anything in /usr/include? \n\n\nThis is intentional with the compilers shipped by conda. Mixing system packages and conda packages almost always breaks stuff. (For eg: the pillow issue `@`mkoeppe had). You need to add `-I/usr/include` for the compiler to find it.\n\n> (here Sage is configured to use system gc package)\n\n\nHow did sage find the system gc package if the compiler doesn't? Does sage by default look in `/usr/include`?",
    "created_at": "2020-09-25T15:18:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433487",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:2'></a>> but the question is why the compiler does not want to see anything in /usr/include? 


This is intentional with the compilers shipped by conda. Mixing system packages and conda packages almost always breaks stuff. (For eg: the pillow issue `@`mkoeppe had). You need to add `-I/usr/include` for the compiler to find it.

> (here Sage is configured to use system gc package)


How did sage find the system gc package if the compiler doesn't? Does sage by default look in `/usr/include`?



---

archive/issue_comments_433488.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:2 isuruf]:\n> > but the question is why the compiler does not want to see anything in /usr/include? \n\n> \n> This is intentional with the compilers shipped by conda. Mixing system packages and conda packages almost always breaks stuff. (For eg: the pillow issue `@`mkoeppe had). You need to add `-I/usr/include` for the compiler to find it.\n> \n> > (here Sage is configured to use system gc package)\n\n> \n> How did sage find the system gc package if the compiler doesn't? Does sage by default look in `/usr/include`?\n\n\nit's done by calling autoconf macro `PKG_CHECK_MODULES`, which basically calls pkg-config and checks the version. Discovering that `gc.h` is not easy, as `$pkg-config -cflags bdw-gc`\ndoes not return anything. (Arguably it is a `bdw-gc` bug, but it does not make it easier).",
    "created_at": "2020-09-25T15:37:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433488",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:3'></a>Replying to [comment:2 isuruf]:
> > but the question is why the compiler does not want to see anything in /usr/include? 

> 
> This is intentional with the compilers shipped by conda. Mixing system packages and conda packages almost always breaks stuff. (For eg: the pillow issue `@`mkoeppe had). You need to add `-I/usr/include` for the compiler to find it.
> 
> > (here Sage is configured to use system gc package)

> 
> How did sage find the system gc package if the compiler doesn't? Does sage by default look in `/usr/include`?


it's done by calling autoconf macro `PKG_CHECK_MODULES`, which basically calls pkg-config and checks the version. Discovering that `gc.h` is not easy, as `$pkg-config -cflags bdw-gc`
does not return anything. (Arguably it is a `bdw-gc` bug, but it does not make it easier).



---

archive/issue_comments_433489.json:
```json
{
    "body": "<a id='comment:4'></a>one can do something like\n\n```\n$ pkg-config --variable=includedir bdw-gc\n/usr/include\n```\nor from the autoconf is would be `PKG_CHECK_VAR([GCINCLUDEDIR],[bdw-gc], [includedir])`",
    "created_at": "2020-09-25T15:59:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433489",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>one can do something like

```
$ pkg-config --variable=includedir bdw-gc
/usr/include
```
or from the autoconf is would be `PKG_CHECK_VAR([GCINCLUDEDIR],[bdw-gc], [includedir])`



---

archive/issue_comments_433490.json:
```json
{
    "body": "<a id='comment:5'></a>another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig\n\nthis is something that leads to a problem in buidling linbox, if fflas-ffpack is installed in conda\n\nSomething in `build/pkgs/pkgconf/spkg-configure.m4` should be fixed. It has\n\n```\n       AC_SUBST(SAGE_PKG_CONFIG_PATH, ['$SAGE_LOCAL/lib/pkgconfig'])\n```\nso the list should be extended with `<conda-root>/lib/pkgconfig`. So this leads the questions:\n\n1. how to find out in autoconf that we're on Conda\n2. how to find <conda-root>",
    "created_at": "2020-09-25T16:39:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433490",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig

this is something that leads to a problem in buidling linbox, if fflas-ffpack is installed in conda

Something in `build/pkgs/pkgconf/spkg-configure.m4` should be fixed. It has

```
       AC_SUBST(SAGE_PKG_CONFIG_PATH, ['$SAGE_LOCAL/lib/pkgconfig'])
```
so the list should be extended with `<conda-root>/lib/pkgconfig`. So this leads the questions:

1. how to find out in autoconf that we're on Conda
2. how to find <conda-root>



---

archive/issue_comments_433491.json:
```json
{
    "body": "<a id='comment:6'></a>Replying to [comment:4 dimpase]:\n> one can do something like\n> \n> ```\n> $ pkg-config --variable=includedir bdw-gc\n> /usr/include\n> ```\n> or from the autoconf is would be `PKG_CHECK_VAR([GCINCLUDEDIR],[bdw-gc], [includedir])`\n> \n\nthere is even a gh issue for this: https://github.com/miguelmarco/libhomfly/issues/10",
    "created_at": "2020-09-25T16:42:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433491",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:6'></a>Replying to [comment:4 dimpase]:
> one can do something like
> 
> ```
> $ pkg-config --variable=includedir bdw-gc
> /usr/include
> ```
> or from the autoconf is would be `PKG_CHECK_VAR([GCINCLUDEDIR],[bdw-gc], [includedir])`
> 

there is even a gh issue for this: https://github.com/miguelmarco/libhomfly/issues/10



---

archive/issue_comments_433492.json:
```json
{
    "body": "Changing priority from major to blocker.",
    "created_at": "2020-09-25T17:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433492",
    "user": "https://github.com/dimpase"
}
```

Changing priority from major to blocker.



---

archive/issue_comments_433493.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:5 dimpase]:\n> another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig\n\n\nWhich pkg-config is that?",
    "created_at": "2020-09-25T17:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433493",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [comment:5 dimpase]:
> another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig


Which pkg-config is that?



---

archive/issue_comments_433494.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 mkoeppe]:\n> Replying to [comment:5 dimpase]:\n> > another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig\n\n> \n> Which pkg-config is that?\n\n\nthe system's one. Perhaps installing conda's pkg-config (if it has one) is an easier way out.\n\nOne more thing: \nthere is a similar to libgc problem with libgd, which is used only in sagelib.\n(headers and the dylib are not found at /usr/ by conda's compiler and linker)",
    "created_at": "2020-09-25T17:54:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433494",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>Replying to [comment:8 mkoeppe]:
> Replying to [comment:5 dimpase]:
> > another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig

> 
> Which pkg-config is that?


the system's one. Perhaps installing conda's pkg-config (if it has one) is an easier way out.

One more thing: 
there is a similar to libgc problem with libgd, which is used only in sagelib.
(headers and the dylib are not found at /usr/ by conda's compiler and linker)



---

archive/issue_comments_433495.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 dimpase]:\n> Replying to [comment:8 mkoeppe]:\n> > Replying to [comment:5 dimpase]:\n> > > another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig\n\n> > \n> > Which pkg-config is that?\n\n> \n> the system's one. Perhaps installing conda's pkg-config (if it has one) is an easier way out.\n\n\nYes, it is already listed in `build/pkgs/conda-bootstrap.txt`. Probably should add somewhere else too.",
    "created_at": "2020-09-25T17:58:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433495",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:9 dimpase]:
> Replying to [comment:8 mkoeppe]:
> > Replying to [comment:5 dimpase]:
> > > another sort of trouble is coming from pkg-config not looking in <conda-root>/lib/pkgconfig

> > 
> > Which pkg-config is that?

> 
> the system's one. Perhaps installing conda's pkg-config (if it has one) is an easier way out.


Yes, it is already listed in `build/pkgs/conda-bootstrap.txt`. Probably should add somewhere else too.



---

archive/issue_comments_433496.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:5 dimpase]:\n> 1. how to find out in autoconf that we're on Conda\n> 2. how to find <conda-root>\n\n\nBasically, don't.",
    "created_at": "2020-09-25T17:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433496",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:5 dimpase]:
> 1. how to find out in autoconf that we're on Conda
> 2. how to find <conda-root>


Basically, don't.



---

archive/issue_comments_433497.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T18:00:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433497",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433498.json:
```json
{
    "body": "<a id='comment:14'></a>We could also extend `m4/sage_check_conda_compilers.m4` to make it a hard error if conda's pkg-config is not installed.",
    "created_at": "2020-09-25T18:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433498",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>We could also extend `m4/sage_check_conda_compilers.m4` to make it a hard error if conda's pkg-config is not installed.



---

archive/issue_comments_433499.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T18:39:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433499",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433500.json:
```json
{
    "body": "<a id='comment:17'></a>configure doesn't work:\n\n```\n...\nchecking whether a conda environment is active... yes\nconfigure: error: A conda environment (base) is active, but\nthe pkg-config command is not provided by the conda environment,\nwhich indicates that the conda environment is missing\nthe following conda packages required for building Sage:\n     pkg-config\nFor building Sage, either:\n- activate a conda environment that has these packages, using:\n    conda activate ENVIRONMENT\n- or install these conda packages, using\n    conda install  pkg-config\n- or deactivate conda by\n    conda deactivate\n  (this command may need to be repeated).\n(base) clpc171[/home/scratch2/dimpase/miniconda3/sage]$ \n(base) clpc171[/home/scratch2/dimpase/miniconda3/sage]$ which pkg-config\npkg-config is /home/scratch2/dimpase/miniconda3/bin/pkg-config\n```",
    "created_at": "2020-09-25T18:59:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433500",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>configure doesn't work:

```
...
checking whether a conda environment is active... yes
configure: error: A conda environment (base) is active, but
the pkg-config command is not provided by the conda environment,
which indicates that the conda environment is missing
the following conda packages required for building Sage:
     pkg-config
For building Sage, either:
- activate a conda environment that has these packages, using:
    conda activate ENVIRONMENT
- or install these conda packages, using
    conda install  pkg-config
- or deactivate conda by
    conda deactivate
  (this command may need to be repeated).
(base) clpc171[/home/scratch2/dimpase/miniconda3/sage]$ 
(base) clpc171[/home/scratch2/dimpase/miniconda3/sage]$ which pkg-config
pkg-config is /home/scratch2/dimpase/miniconda3/bin/pkg-config
```



---

archive/issue_comments_433501.json:
```json
{
    "body": "<a id='comment:18'></a>maybe because conda installs a script pkg-config and a binary pkg-config.bin (at least on Linux this is the case)",
    "created_at": "2020-09-25T19:05:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433501",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>maybe because conda installs a script pkg-config and a binary pkg-config.bin (at least on Linux this is the case)



---

archive/issue_comments_433502.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T19:45:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433502",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433503.json:
```json
{
    "body": "<a id='comment:20'></a>Here's a better version (only tested on macOS)",
    "created_at": "2020-09-25T19:45:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433503",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Here's a better version (only tested on macOS)



---

archive/issue_comments_433504.json:
```json
{
    "body": "<a id='comment:21'></a>OK, this works, but how about adding `pkg-config` to `build/pkgs/conda.txt`, in order to make sure it's not missing?",
    "created_at": "2020-09-25T20:34:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433504",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>OK, this works, but how about adding `pkg-config` to `build/pkgs/conda.txt`, in order to make sure it's not missing?



---

archive/issue_comments_433505.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T20:48:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433505",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_433506.json:
```json
{
    "body": "<a id='comment:23'></a>Good idea, done.",
    "created_at": "2020-09-25T20:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433506",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>Good idea, done.



---

archive/issue_comments_433507.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-25T21:00:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433507",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_433508.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T21:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433508",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433509.json:
```json
{
    "body": "<a id='comment:25'></a>lgtm",
    "created_at": "2020-09-25T21:03:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433509",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:25'></a>lgtm



---

archive/issue_comments_433510.json:
```json
{
    "body": "<a id='comment:26'></a>Thanks!",
    "created_at": "2020-09-25T21:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433510",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Thanks!



---

archive/issue_comments_433511.json:
```json
{
    "body": "<a id='comment:27'></a>Btw, we need to add `bdw-gc` to `build/pkgs/gc/distros/conda.txt`",
    "created_at": "2020-09-25T21:07:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433511",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:27'></a>Btw, we need to add `bdw-gc` to `build/pkgs/gc/distros/conda.txt`



---

archive/issue_comments_433512.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-09-25T21:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433512",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_433513.json:
```json
{
    "body": "<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-09-25T21:09:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433513",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_433514.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T21:10:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433514",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433515.json:
```json
{
    "body": "<a id='comment:30'></a>I'm getting \n\n```\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG libatomic_ops...\nchecking for atomic_ops >= 7.6.2... no\nconfigure: no suitable system package found for SPKG libatomic_ops\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG gc...\nchecking whether any of libatomic_ops is installed as or will be installed as SPKG... yes; install gc as well\nconfigure: no suitable system package found for SPKG gc\n-----------------------------------------------------------------------------\n```",
    "created_at": "2020-09-25T21:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433515",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>I'm getting 

```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG libatomic_ops...
checking for atomic_ops >= 7.6.2... no
configure: no suitable system package found for SPKG libatomic_ops
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG gc...
checking whether any of libatomic_ops is installed as or will be installed as SPKG... yes; install gc as well
configure: no suitable system package found for SPKG gc
-----------------------------------------------------------------------------
```



---

archive/issue_comments_433516.json:
```json
{
    "body": "<a id='comment:31'></a>(previously discussed in #28991)",
    "created_at": "2020-09-25T21:39:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433516",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>(previously discussed in #28991)



---

archive/issue_comments_433517.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-09-25T21:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433517",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_433518.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-09-25T21:49:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433518",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_433519.json:
```json
{
    "body": "<a id='comment:33'></a>Trying now with this change.",
    "created_at": "2020-09-25T21:49:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433519",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Trying now with this change.



---

archive/issue_comments_433520.json:
```json
{
    "body": "<a id='comment:34'></a>\n```\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG libatomic_ops...\nchecking for atomic_ops >= 7.6.2... yes\nconfigure: will use system package and not install SPKG libatomic_ops\n-----------------------------------------------------------------------------\nChecking whether SageMath should install SPKG gc...\nchecking whether any of libatomic_ops is installed as or will be installed as SPKG... no\nchecking for bdw-gc-threaded >= 7.6.4... no\nchecking for bdw-gc >= 7.6.4... yes\nconfigure: will use system package and not install SPKG gc\n```",
    "created_at": "2020-09-25T21:50:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433520",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
```
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG libatomic_ops...
checking for atomic_ops >= 7.6.2... yes
configure: will use system package and not install SPKG libatomic_ops
-----------------------------------------------------------------------------
Checking whether SageMath should install SPKG gc...
checking whether any of libatomic_ops is installed as or will be installed as SPKG... no
checking for bdw-gc-threaded >= 7.6.4... no
checking for bdw-gc >= 7.6.4... yes
configure: will use system package and not install SPKG gc
```



---

archive/issue_comments_433521.json:
```json
{
    "body": "<a id='comment:35'></a>`tox -e docker-conda-forge-standard` builds without problem now.",
    "created_at": "2020-09-25T22:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433521",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>`tox -e docker-conda-forge-standard` builds without problem now.



---

archive/issue_comments_433522.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T22:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433522",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_433523.json:
```json
{
    "body": "<a id='comment:36'></a>Thanks",
    "created_at": "2020-09-25T22:49:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433523",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:36'></a>Thanks



---

archive/issue_comments_433524.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-30T22:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30662#issuecomment-433524",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079771.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-30T22:30:25Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30662",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30662#event-79771"
}
```
