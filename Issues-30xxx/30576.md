# Issue 30576: Python 3.6: Fix locale/encoding issues in docbuild, then re-enable Python 3.6

archive/issues_030339.json:
```json
{
    "assignees": [],
    "body": "Follow-up from #15791, #29033, #30053, the latter of which disabled use of system Python 3.6.\n\nWith Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):\n\n```\n  [dochtml]   UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2661: ordinal not in range(128)\n  [dochtml] Full log file: logs/dochtml.log\nMakefile:1876: recipe for target 'doc-html' failed\n```\n\nThis is coming from #30002 \"force C locale in docbuild and remove some obsolete stuff\", which added this:\n\n```\nbuild/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings\n```\nIn the present ticket, we rework the fix in #30002 so that it works with Python 3.6 too (in which setting the \"C\" locale sabotages UTF-8 operation.)\n\n\n\nSupporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n\nFor the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  \n(#30008 is a dependency of this ticket merely for the convenience of testing.)\n\n---\n\nReferences:\n- https://www.python.org/dev/peps/pep-0538/ \"Coercing the legacy C locale to a UTF-8 based locale\"\n- https://www.python.org/dev/peps/pep-0540/ \"Add a new UTF-8 mode\"\n- https://bugzilla.redhat.com/attachment.cgi?id=1233034&action=diff\n\n\n\nDepends on #30008\n\nCC:  @antonio-rojas @dimpase @slel @orlitzky @kiwifb @embray @fchapoton\n\nBranch/Commit: **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30576_\n\n",
    "closed_at": "2020-09-27T09:10:02Z",
    "created_at": "2020-09-15T15:18:32Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Python 3.6: Fix locale/encoding issues in docbuild, then re-enable Python 3.6",
    "type": "issue",
    "updated_at": "2020-09-27T09:10:02Z",
    "url": "https://github.com/sagemath/sage/issues/30576",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #15791, #29033, #30053, the latter of which disabled use of system Python 3.6.

With Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):

```
  [dochtml]   UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2661: ordinal not in range(128)
  [dochtml] Full log file: logs/dochtml.log
Makefile:1876: recipe for target 'doc-html' failed
```

This is coming from #30002 "force C locale in docbuild and remove some obsolete stuff", which added this:

```
build/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings
```
In the present ticket, we rework the fix in #30002 so that it works with Python 3.6 too (in which setting the "C" locale sabotages UTF-8 operation.)



Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.

For the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  
(#30008 is a dependency of this ticket merely for the convenience of testing.)

---

References:
- https://www.python.org/dev/peps/pep-0538/ "Coercing the legacy C locale to a UTF-8 based locale"
- https://www.python.org/dev/peps/pep-0540/ "Add a new UTF-8 mode"
- https://bugzilla.redhat.com/attachment.cgi?id=1233034&action=diff



Depends on #30008

CC:  @antonio-rojas @dimpase @slel @orlitzky @kiwifb @embray @fchapoton

Branch/Commit: **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**

Reviewer: **Sébastien Labbé**

Author: **Matthias Koeppe**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/30576_





---

archive/issue_events_421536.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T15:18:32Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421536"
}
```



---

archive/issue_events_421537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T15:18:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "000080",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421537"
}
```



---

archive/issue_events_421538.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T15:18:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421538"
}
```



---

archive/issue_events_421539.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T15:18:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421539"
}
```



---

archive/issue_comments_487824.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nPosting my branch containing few changes that need to be done in order to build doc with ubuntu 18.04 bionic and python 3.6.\n\nThe changes are not sufficient. Other similar issues arise when sphinx is running...\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c\">e09d256</a></td><td><code>setting few utf-8 encodings</code></td></tr></table>\n",
    "created_at": "2020-09-15T15:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487824",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:1" align="right">comment:1</div>

Posting my branch containing few changes that need to be done in order to build doc with ubuntu 18.04 bionic and python 3.6.

The changes are not sufficient. Other similar issues arise when sphinx is running...

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c">e09d256</a></td><td><code>setting few utf-8 encodings</code></td></tr></table>




---

archive/issue_comments_487825.json:
```json
{
    "body": "Branch: **[public/30576](https://github.com/sagemath/sagetrac-mirror/tree/public/30576)**",
    "created_at": "2020-09-15T15:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487825",
    "user": "https://github.com/seblabbe"
}
```

Branch: **[public/30576](https://github.com/sagemath/sagetrac-mirror/tree/public/30576)**



---

archive/issue_comments_487826.json:
```json
{
    "body": "Commit: **[e09d256](https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c)**",
    "created_at": "2020-09-15T15:33:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487826",
    "user": "https://github.com/seblabbe"
}
```

Commit: **[e09d256](https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c)**



---

archive/issue_comments_487827.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nTwo comments here:\n\n- fixing the issues in the posted branch took a while because there are many `try - except` clauses in the doc-building which eat up all of the useful tracebacks.\n- I think the remaining issues are just WARNINGS that breaks the docbuild because we decided at some point in the past to consider WARNINGS as errors (which is fine). I base this observation on some hacky modifications I did in the `src/sage_setup/docbuild/sphinxbuild.py`. To confirm this, do you know if there is a way to build sage documentation by considering warnings just as warnings?",
    "created_at": "2020-09-16T08:44:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487827",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:2" align="right">comment:2</div>

Two comments here:

- fixing the issues in the posted branch took a while because there are many `try - except` clauses in the doc-building which eat up all of the useful tracebacks.
- I think the remaining issues are just WARNINGS that breaks the docbuild because we decided at some point in the past to consider WARNINGS as errors (which is fine). I base this observation on some hacky modifications I did in the `src/sage_setup/docbuild/sphinxbuild.py`. To confirm this, do you know if there is a way to build sage documentation by considering warnings just as warnings?



---

archive/issue_comments_487828.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nWarnings one keeps getting are errors in processing function arguments, i.e. in introspecting Python code. Ignoring them would give you a broken doc.\n\n```\nerror while formatting arguments for sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr.complete_primary_decomposition: 'ascii' codec can't decode byte 0xc2 in position 4774: ordinal not in range(128)\n```\n\nI think the problems come from a new(ish) sphinx which is run as a backend for our custom docbuilder, and anyway the move from Python 3.6 to 3.7 was somewhat big as far as utf-8 support is concerned.\n\nI really think that fully supporting 3.6 is hard, and we have better things to do. Python has solved this problem by moving to 3.7, let's not reinvent the wheel here.",
    "created_at": "2020-09-16T09:46:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487828",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:3" align="right">comment:3</div>

Warnings one keeps getting are errors in processing function arguments, i.e. in introspecting Python code. Ignoring them would give you a broken doc.

```
error while formatting arguments for sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr.complete_primary_decomposition: 'ascii' codec can't decode byte 0xc2 in position 4774: ordinal not in range(128)
```

I think the problems come from a new(ish) sphinx which is run as a backend for our custom docbuilder, and anyway the move from Python 3.6 to 3.7 was somewhat big as far as utf-8 support is concerned.

I really think that fully supporting 3.6 is hard, and we have better things to do. Python has solved this problem by moving to 3.7, let's not reinvent the wheel here.



---

archive/issue_events_421540.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-16T17:21:16Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "title_is": "Python 3.6: Fix locale/encoding issues, then re-enable Python 3.6",
    "title_was": "Python 3.6: Fix locale/encoding issues",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421540"
}
```



---

archive/issue_comments_487829.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-Follow-up from #29033, #30053.\n+Follow-up from #29033, #30053, the latter of which disabled use of system Python 3.6.\n \n-And a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):\n+With Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):\n \n ```\n   [dochtml]   UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2661: ordinal not in range(128)\n@@ -8,4 +8,10 @@\n Makefile:1876: recipe for target 'doc-html' failed\n ```\n \n+Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.\n \n+\n+Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n+\n+\n+\n``````\n",
    "created_at": "2020-09-16T17:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487829",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-Follow-up from #29033, #30053.
+Follow-up from #29033, #30053, the latter of which disabled use of system Python 3.6.
 
-And a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):
+With Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):
 
 ```
   [dochtml]   UnicodeDecodeError: 'ascii' codec can't decode byte 0xe2 in position 2661: ordinal not in range(128)
@@ -8,4 +8,10 @@
 Makefile:1876: recipe for target 'doc-html' failed
 ```
 
+Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.
 
+
+Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.
+
+
+
``````




---

archive/issue_comments_487830.json:
```json
{
    "body": "Work Issues: **rebase on #30053, revert commit be47518**",
    "created_at": "2020-09-16T17:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487830",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **rebase on #30053, revert commit be47518**



---

archive/issue_comments_487831.json:
```json
{
    "body": "Changed commit from **[e09d256](https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c)** to **[9943f25](https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f)**",
    "created_at": "2020-09-16T23:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487831",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[e09d256](https://github.com/sagemath/sagetrac-mirror/commit/e09d2561e5d5436717927a1e71e0551657c5164c)** to **[9943f25](https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f)**



---

archive/issue_comments_487832.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5f6663372fab14c6a386004a925de59be216f31\">e5f6663</a></td><td><code>only use locale C.UTF-8 if available, else C</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff6f4a68d4f396cb5f10e9918e5942113f739aa1\">ff6f4a6</a></td><td><code>assume Python 3.7 or better</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64c3a8a6c99e916b68dfec6a2cd1346b023916e9\">64c3a8a</a></td><td><code>only test python3, to be 3.7 or 3.8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be47518c1019d37e11bbac9a3268d69b196691c8\">be47518</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af0a9565e3f17b997aaaaef92e96448b4600998f\">af0a956</a></td><td><code>Merge branch 't/30053/build/careful_with_C_UTF8' into t/30576/public/30576</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8adc3602e96af62522614ff4f4631f69f53a7b79\">8adc360</a></td><td><code>Revert \"build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/161765b572d656d107b839e03ad51f474e42d76f\">161765b</a></td><td><code>Revert \"only test python3, to be 3.7 or 3.8\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c75a21b67a4634ccbc79159d8296c561e26e1eb3\">c75a21b</a></td><td><code>setting few utf-8 encodings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f\">9943f25</a></td><td><code>Revert \"assume Python 3.7 or better\"</code></td></tr></table>\n",
    "created_at": "2020-09-16T23:48:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487832",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:5"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5f6663372fab14c6a386004a925de59be216f31">e5f6663</a></td><td><code>only use locale C.UTF-8 if available, else C</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff6f4a68d4f396cb5f10e9918e5942113f739aa1">ff6f4a6</a></td><td><code>assume Python 3.7 or better</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64c3a8a6c99e916b68dfec6a2cd1346b023916e9">64c3a8a</a></td><td><code>only test python3, to be 3.7 or 3.8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be47518c1019d37e11bbac9a3268d69b196691c8">be47518</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af0a9565e3f17b997aaaaef92e96448b4600998f">af0a956</a></td><td><code>Merge branch 't/30053/build/careful_with_C_UTF8' into t/30576/public/30576</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8adc3602e96af62522614ff4f4631f69f53a7b79">8adc360</a></td><td><code>Revert "build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/161765b572d656d107b839e03ad51f474e42d76f">161765b</a></td><td><code>Revert "only test python3, to be 3.7 or 3.8"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c75a21b67a4634ccbc79159d8296c561e26e1eb3">c75a21b</a></td><td><code>setting few utf-8 encodings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f">9943f25</a></td><td><code>Revert "assume Python 3.7 or better"</code></td></tr></table>




---

archive/issue_comments_487833.json:
```json
{
    "body": "Dependencies: **#30053**",
    "created_at": "2020-09-16T23:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487833",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30053**



---

archive/issue_comments_487834.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,5 +13,10 @@\n \n Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n \n+---\n+\n+References:\n+- https://www.python.org/dev/peps/pep-0538/ \"Coercing the legacy C locale to a UTF-8 based locale\"\n \n \n+\n``````\n",
    "created_at": "2020-09-16T23:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487834",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,5 +13,10 @@
 
 Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.
 
+---
+
+References:
+- https://www.python.org/dev/peps/pep-0538/ "Coercing the legacy C locale to a UTF-8 based locale"
 
 
+
``````




---

archive/issue_comments_487835.json:
```json
{
    "body": "Changed work issues from **rebase on #30053, revert commit be47518** to none",
    "created_at": "2020-09-16T23:49:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487835",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **rebase on #30053, revert commit be47518** to none



---

archive/issue_comments_487836.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -17,6 +17,7 @@\n \n References:\n - https://www.python.org/dev/peps/pep-0538/ \"Coercing the legacy C locale to a UTF-8 based locale\"\n+- https://www.python.org/dev/peps/pep-0540/ \"Add a new UTF-8 mode\"\n \n \n \n``````\n",
    "created_at": "2020-09-17T00:01:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487836",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -17,6 +17,7 @@
 
 References:
 - https://www.python.org/dev/peps/pep-0538/ "Coercing the legacy C locale to a UTF-8 based locale"
+- https://www.python.org/dev/peps/pep-0540/ "Add a new UTF-8 mode"
 
 
 
``````




---

archive/issue_comments_487837.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,6 @@\n References:\n - https://www.python.org/dev/peps/pep-0538/ \"Coercing the legacy C locale to a UTF-8 based locale\"\n - https://www.python.org/dev/peps/pep-0540/ \"Add a new UTF-8 mode\"\n+- https://bugzilla.redhat.com/attachment.cgi?id=1233034&action=diff\n \n \n-\n``````\n",
    "created_at": "2020-09-17T00:25:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487837",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,6 @@
 References:
 - https://www.python.org/dev/peps/pep-0538/ "Coercing the legacy C locale to a UTF-8 based locale"
 - https://www.python.org/dev/peps/pep-0540/ "Add a new UTF-8 mode"
+- https://bugzilla.redhat.com/attachment.cgi?id=1233034&action=diff
 
 
-
``````




---

archive/issue_comments_487838.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,21 @@\n \n Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.\n \n+There are a few places that explicitly set locale variables (`LANG` and `LC_*`):\n+\n+```\n+build/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings\n+build/bin/sage-spkg: export LC_ALL=C;\n+build/pkgs/gap/spkg-check.in:export LC_CTYPE=en_US.UTF-8\n+build/pkgs/pari/spkg-install.in:LANG=C\n+build/tox.ini:    LC_ALL = C\n+docker/Dockerfile:ENV LC_ALL C.UTF-8\n+src/sage/docs/conf.py:locale.setlocale(locale.LC_NUMERIC, 'C')\n+src/sage/interfaces/gap.py:            sage: gap = Gap(env={'LC_CTYPE': 'en_US.UTF-8'})\n+src/sage/interfaces/jmoldata.py:            env['LC_ALL'] = 'C'\n+```\n+\n+\n \n Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n \n``````\n",
    "created_at": "2020-09-17T00:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487838",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,21 @@
 
 Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.
 
+There are a few places that explicitly set locale variables (`LANG` and `LC_*`):
+
+```
+build/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings
+build/bin/sage-spkg: export LC_ALL=C;
+build/pkgs/gap/spkg-check.in:export LC_CTYPE=en_US.UTF-8
+build/pkgs/pari/spkg-install.in:LANG=C
+build/tox.ini:    LC_ALL = C
+docker/Dockerfile:ENV LC_ALL C.UTF-8
+src/sage/docs/conf.py:locale.setlocale(locale.LC_NUMERIC, 'C')
+src/sage/interfaces/gap.py:            sage: gap = Gap(env={'LC_CTYPE': 'en_US.UTF-8'})
+src/sage/interfaces/jmoldata.py:            env['LC_ALL'] = 'C'
+```
+
+
 
 Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.
 
``````




---

archive/issue_comments_487839.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-Follow-up from #29033, #30053, the latter of which disabled use of system Python 3.6.\n+Follow-up from #15791, #29033, #30053, the latter of which disabled use of system Python 3.6.\n \n With Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):\n \n``````\n",
    "created_at": "2020-09-17T00:34:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487839",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-Follow-up from #29033, #30053, the latter of which disabled use of system Python 3.6.
+Follow-up from #15791, #29033, #30053, the latter of which disabled use of system Python 3.6.
 
 With Python 3.6, there is a failure building the documentation on `ubuntu-bionic-standard` (using `/usr/bin/python3.6`, https://github.com/mkoeppe/sage/runs/1106251169):
 
``````




---

archive/issue_comments_487840.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@dimpase](#comment:3):\n> Warnings one keeps getting are errors in processing function arguments, i.e. in introspecting Python code. Ignoring them would give you a broken doc.\n> \n> ```\n> error while formatting arguments for sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr.complete_primary_decomposition: 'ascii' codec can't decode byte 0xc2 in position 4774: ordinal not in range(128)\n> ```\n\nThere are 2 things I don't understand here:\n\n- 4774 is an integer which is larger then the length of the string of the doc of `complete_primary_decomposition` method\n\n```\nsage: len(sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular\n....: _repr.complete_primary_decomposition.__doc__)                             \n3284\n```\n\n- when I look at the html documentation of that method (after building the doc while ignoring the warnings with some hacky changes in `sphinxbuild.py`), I see no problem",
    "created_at": "2020-09-17T07:05:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487840",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@dimpase](#comment:3):
> Warnings one keeps getting are errors in processing function arguments, i.e. in introspecting Python code. Ignoring them would give you a broken doc.
> 
> ```
> error while formatting arguments for sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular_repr.complete_primary_decomposition: 'ascii' codec can't decode byte 0xc2 in position 4774: ordinal not in range(128)
> ```

There are 2 things I don't understand here:

- 4774 is an integer which is larger then the length of the string of the doc of `complete_primary_decomposition` method

```
sage: len(sage.rings.polynomial.multi_polynomial_ideal.MPolynomialIdeal_singular
....: _repr.complete_primary_decomposition.__doc__)                             
3284
```

- when I look at the html documentation of that method (after building the doc while ignoring the warnings with some hacky changes in `sphinxbuild.py`), I see no problem



---

archive/issue_comments_487841.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n> - when I look at the html documentation of that method (after building the doc while ignoring the warnings with some hacky changes in `sphinxbuild.py`), I see no problem\n\nWith the current branch with no hacky changes, I can build the documentation with the flag `--keep-going`:\n\n```\nMAKE='make -j8' make build\nMAKE='make -j8' ./sage --docbuild --no-pdf-links --keep-going all html\n```\n\nI am now trying to see what is wrong with the output doc...",
    "created_at": "2020-09-17T08:30:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487841",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:12" align="right">comment:12</div>

> - when I look at the html documentation of that method (after building the doc while ignoring the warnings with some hacky changes in `sphinxbuild.py`), I see no problem

With the current branch with no hacky changes, I can build the documentation with the flag `--keep-going`:

```
MAKE='make -j8' make build
MAKE='make -j8' ./sage --docbuild --no-pdf-links --keep-going all html
```

I am now trying to see what is wrong with the output doc...



---

archive/issue_comments_487842.json:
```json
{
    "body": "Attachment: **[error.log](https://github.com/sagemath/sage/files/ticket30576/error.log)**",
    "created_at": "2020-09-17T14:44:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487842",
    "user": "https://github.com/seblabbe"
}
```

Attachment: **[error.log](https://github.com/sagemath/sage/files/ticket30576/error.log)**



---

archive/issue_comments_487843.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nthe command\n\n```\nMAKE='make -j8' build/bin/sage-logger -p './sage --docbuild --no-pdf-links --keep-going all html ' logs/dochtml-keepgoing.log\ncd logs\ngrep error dochtml-keepgoing.log > error.log\n```\ngives relatively few errors (see 112 lines error.log attached). Very often it is the same error, for example, 60 of them are related to crystals code either `can't decode byte 0xe2 in position 6257` or `can't decode byte 0xc3 in position 3272` or `can't decode byte 0xcc in position 7825`.\n\nI still do no know to which doc string these positions are refering to.",
    "created_at": "2020-09-17T14:49:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487843",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:13" align="right">comment:13</div>

the command

```
MAKE='make -j8' build/bin/sage-logger -p './sage --docbuild --no-pdf-links --keep-going all html ' logs/dochtml-keepgoing.log
cd logs
grep error dochtml-keepgoing.log > error.log
```
gives relatively few errors (see 112 lines error.log attached). Very often it is the same error, for example, 60 of them are related to crystals code either `can't decode byte 0xe2 in position 6257` or `can't decode byte 0xc3 in position 3272` or `can't decode byte 0xcc in position 7825`.

I still do no know to which doc string these positions are refering to.



---

archive/issue_comments_487844.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHint:\n\n```\n$ python3 -q\n>>> b'\\xe2'.decode('latin1')\n'\u00e2'\n>>> b'\\xc3'.decode('latin1')\n'\u00c3'\n>>> b'\\xcc'.decode('latin1')\n'\u00cc'\n>>>\n```",
    "created_at": "2020-09-17T15:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487844",
    "user": "https://github.com/slel"
}
```

<div id="comment:14" align="right">comment:14</div>

Hint:

```
$ python3 -q
>>> b'\xe2'.decode('latin1')
'â'
>>> b'\xc3'.decode('latin1')
'Ã'
>>> b'\xcc'.decode('latin1')
'Ì'
>>>
```



---

archive/issue_comments_487845.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nBut these symbols do not occur in the crystals code:\n\n```\n$ cd SAGE_ROOT\n$ git grep \u00c3 *.py *pyx\n$ git grep \u00e2 *.py *pyx\nsrc/sage/combinat/ncsf_qsym/tutorial.py:MacMahon, Knuth, Kreweras, Gl\u00e2nffrwd Thomas, Stanley. In 1984, Gessel\n$ git grep \u00cc *.py *pyx\n```",
    "created_at": "2020-09-17T15:32:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487845",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:15" align="right">comment:15</div>

But these symbols do not occur in the crystals code:

```
$ cd SAGE_ROOT
$ git grep Ã *.py *pyx
$ git grep â *.py *pyx
src/sage/combinat/ncsf_qsym/tutorial.py:MacMahon, Knuth, Kreweras, Glânffrwd Thomas, Stanley. In 1984, Gessel
$ git grep Ì *.py *pyx
```



---

archive/issue_events_421541.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-22T23:36:27Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "title_is": "Python 3.6: Fix locale/encoding issues in docbuild, then re-enable Python 3.6",
    "title_was": "Python 3.6: Fix locale/encoding issues, then re-enable Python 3.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421541"
}
```



---

archive/issue_comments_487846.json:
```json
{
    "body": "Changed dependencies from **#30053** to none",
    "created_at": "2020-09-22T23:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487846",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30053** to none



---

archive/issue_comments_487847.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,25 +8,18 @@\n Makefile:1876: recipe for target 'doc-html' failed\n ```\n \n-Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.\n-\n-There are a few places that explicitly set locale variables (`LANG` and `LC_*`):\n+This is coming from #30002 \"force C locale in docbuild and remove some obsolete stuff\", which added this:\n \n ```\n build/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings\n-build/bin/sage-spkg: export LC_ALL=C;\n-build/pkgs/gap/spkg-check.in:export LC_CTYPE=en_US.UTF-8\n-build/pkgs/pari/spkg-install.in:LANG=C\n-build/tox.ini:    LC_ALL = C\n-docker/Dockerfile:ENV LC_ALL C.UTF-8\n-src/sage/docs/conf.py:locale.setlocale(locale.LC_NUMERIC, 'C')\n-src/sage/interfaces/gap.py:            sage: gap = Gap(env={'LC_CTYPE': 'en_US.UTF-8'})\n-src/sage/interfaces/jmoldata.py:            env['LC_ALL'] = 'C'\n ```\n+In the present ticket, we rework the fix in #30002 so that it works with Python 3.6 too (in which setting the \"C\" locale sabotages UTF-8 operation.)\n \n \n \n Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n+\n+For the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  \n \n ---\n \n``````\n",
    "created_at": "2020-09-22T23:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487847",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,25 +8,18 @@
 Makefile:1876: recipe for target 'doc-html' failed
 ```
 
-Also, there are failures in package installs that #29033 tried to work around. More complete fixes are discussed but not implemented in #30053.
-
-There are a few places that explicitly set locale variables (`LANG` and `LC_*`):
+This is coming from #30002 "force C locale in docbuild and remove some obsolete stuff", which added this:
 
 ```
 build/bin/sage-site:    export LANG=C # to ensure it is possible to scrape out non-EN locale warnings
-build/bin/sage-spkg: export LC_ALL=C;
-build/pkgs/gap/spkg-check.in:export LC_CTYPE=en_US.UTF-8
-build/pkgs/pari/spkg-install.in:LANG=C
-build/tox.ini:    LC_ALL = C
-docker/Dockerfile:ENV LC_ALL C.UTF-8
-src/sage/docs/conf.py:locale.setlocale(locale.LC_NUMERIC, 'C')
-src/sage/interfaces/gap.py:            sage: gap = Gap(env={'LC_CTYPE': 'en_US.UTF-8'})
-src/sage/interfaces/jmoldata.py:            env['LC_ALL'] = 'C'
 ```
+In the present ticket, we rework the fix in #30002 so that it works with Python 3.6 too (in which setting the "C" locale sabotages UTF-8 operation.)
 
 
 
 Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.
+
+For the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  
 
 ---
 
``````




---

archive/issue_events_421542.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-22T23:41:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421542"
}
```



---

archive/issue_events_421543.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-22T23:41:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421543"
}
```



---

archive/issue_comments_487848.json:
```json
{
    "body": "Dependencies: **#30008**",
    "created_at": "2020-09-22T23:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487848",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30008**



---

archive/issue_comments_487849.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,6 +20,7 @@\n Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.\n \n For the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  \n+(#30008 is a dependency of this ticket merely for the convenience of testing.)\n \n ---\n \n``````\n",
    "created_at": "2020-09-22T23:50:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487849",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,6 +20,7 @@
 Supporting Python 3.6 allows Sage to use the system Python on some older Linux distributions that are still in widespread use in scientific computing, including centos-8 and fedora-{26,27,28} (although Python 3.7.x packages are also available for these). See #29033 for more details.
 
 For the unrelated failures in the Sphinx package installation that #29033 tried to work around, see #30008.  
+(#30008 is a dependency of this ticket merely for the convenience of testing.)
 
 ---
 
``````




---

archive/issue_comments_487850.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/49aa061ad6390da770c566c642dad2982d99d29f\">49aa061</a></td><td><code>Revert \"build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a8b77cd3fdbb96ed85cb34367e59967d9031f612\">a8b77cd</a></td><td><code>Revert \"only test python3, to be 3.7 or 3.8\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2\">9403629</a></td><td><code>build/bin/sage-system-python: Work around LC_ALL=C</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3\">ff0dbc6</a></td><td><code>build/sage_bootstrap/uncompress/tar_file.py: Fix encoding to utf-8</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f05a110c45fcc5ad4d745adc1a2197f320050fb5\">f05a110</a></td><td><code>Merge branch 't/30008/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_' into t/30576/public/30576</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5\">945c8c5</a></td><td><code>build/bin/sage-site (--docbuild): Set an English locale suuch as C.utf-8, but not the C locale, to ensure correct operation on Python 3.6</code></td></tr></table>\n",
    "created_at": "2020-09-22T23:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487850",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/49aa061ad6390da770c566c642dad2982d99d29f">49aa061</a></td><td><code>Revert "build/pkgs/python3/spkg-configure.m4: Use 'python >= 3.7'; keep checking for 'python3.8, python3.7'"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a8b77cd3fdbb96ed85cb34367e59967d9031f612">a8b77cd</a></td><td><code>Revert "only test python3, to be 3.7 or 3.8"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9403629235ffb078c0eda9a46154d882c62760b2">9403629</a></td><td><code>build/bin/sage-system-python: Work around LC_ALL=C</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ff0dbc622b8b3f4ce467a0324c3fdbd134df24e3">ff0dbc6</a></td><td><code>build/sage_bootstrap/uncompress/tar_file.py: Fix encoding to utf-8</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f05a110c45fcc5ad4d745adc1a2197f320050fb5">f05a110</a></td><td><code>Merge branch 't/30008/after__30053__sphinx_3_1_2_does_not_build_on_ubuntu__trusty_xenial_bionic___debian_jessie__centos_7__again_' into t/30576/public/30576</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5">945c8c5</a></td><td><code>build/bin/sage-site (--docbuild): Set an English locale suuch as C.utf-8, but not the C locale, to ensure correct operation on Python 3.6</code></td></tr></table>




---

archive/issue_comments_487851.json:
```json
{
    "body": "Changed commit from **[9943f25](https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f)** to **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**",
    "created_at": "2020-09-22T23:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487851",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9943f25](https://github.com/sagemath/sagetrac-mirror/commit/9943f256d7a34c3eba9d12cde4ddeaf4260f398f)** to **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**



---

archive/issue_events_421544.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T00:18:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421544"
}
```



---

archive/issue_comments_487852.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-09-23T00:18:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487852",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_487853.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/267855732, ...**",
    "created_at": "2020-09-23T00:33:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487853",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/267855732, ...**



---

archive/issue_comments_487854.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nOn Ubuntu 18.04, after uninstalling python3.8 so that python3.6 gets picked up by `./configure`:\n\n```\n## -------------------------------------------------------- ##                        \n## Checking whether SageMath should install SPKG python3... ##                        ## -------------------------------------------------------- ##                        \nconfigure:30688: checking whether any of sqlite libpng bzip2 xz libffi is installed as\n or will be installed as SPKG                                                         \nconfigure:30697: result: no                                                           \nconfigure:30707: checking for python3 >= 3.6, < 3.9 with modules sqlite3, ctypes, math\n, hashlib, crypt, readline, socket, zlib, distutils.core                              \nconfigure:30713: result:                                                              \nconfigure:30728: checking ... whether /usr/bin/python3.6 is good                                                                      \nconfigure:30921: result: yes                                                          \nconfigure:30923: checking for python3 >= 3.6, < 3.9 with modules sqlite3, ctypes, math\n, hashlib, crypt, readline, socket, zlib, distutils.core                              \nconfigure:30982: result: /usr/bin/python3.6                                           \nconfigure:30997: will use system package and not install SPKG python3    \n```\nI confirm that `make doc` now works ok. From me, it is a positive review.\n\nI let someone change the status to positive review if no problem occurs on the github actions side.",
    "created_at": "2020-09-23T10:58:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487854",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:22" align="right">comment:22</div>

On Ubuntu 18.04, after uninstalling python3.8 so that python3.6 gets picked up by `./configure`:

```
## -------------------------------------------------------- ##                        
## Checking whether SageMath should install SPKG python3... ##                        ## -------------------------------------------------------- ##                        
configure:30688: checking whether any of sqlite libpng bzip2 xz libffi is installed as
 or will be installed as SPKG                                                         
configure:30697: result: no                                                           
configure:30707: checking for python3 >= 3.6, < 3.9 with modules sqlite3, ctypes, math
, hashlib, crypt, readline, socket, zlib, distutils.core                              
configure:30713: result:                                                              
configure:30728: checking ... whether /usr/bin/python3.6 is good                                                                      
configure:30921: result: yes                                                          
configure:30923: checking for python3 >= 3.6, < 3.9 with modules sqlite3, ctypes, math
, hashlib, crypt, readline, socket, zlib, distutils.core                              
configure:30982: result: /usr/bin/python3.6                                           
configure:30997: will use system package and not install SPKG python3    
```
I confirm that `make doc` now works ok. From me, it is a positive review.

I let someone change the status to positive review if no problem occurs on the github actions side.



---

archive/issue_comments_487855.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/267855732, ...** to **S\u00e9bastien Labb\u00e9, https://github.com/mkoeppe/sage/actions/runs/267855732, ...**",
    "created_at": "2020-09-23T10:58:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487855",
    "user": "https://github.com/seblabbe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/267855732, ...** to **Sébastien Labbé, https://github.com/mkoeppe/sage/actions/runs/267855732, ...**



---

archive/issue_comments_487856.json:
```json
{
    "body": "Changed reviewer from **S\u00e9bastien Labb\u00e9, https://github.com/mkoeppe/sage/actions/runs/267855732, ...** to **S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-09-23T12:02:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487856",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Sébastien Labbé, https://github.com/mkoeppe/sage/actions/runs/267855732, ...** to **Sébastien Labbé**



---

archive/issue_events_421545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T12:02:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421545"
}
```



---

archive/issue_events_421546.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-23T12:02:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421546"
}
```



---

archive/issue_comments_487857.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThanks for testing!\n\nAlso `ubuntu-bionic-standard` on GH Action is fixed (https://github.com/mkoeppe/sage/runs/1152418788). The failures seen in https://github.com/mkoeppe/sage/actions/runs/267855732 (for example for `ubuntu-bionic-minimal`) come from an unrelated ticket that I merged in the same branch.",
    "created_at": "2020-09-23T12:02:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487857",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Thanks for testing!

Also `ubuntu-bionic-standard` on GH Action is fixed (https://github.com/mkoeppe/sage/runs/1152418788). The failures seen in https://github.com/mkoeppe/sage/actions/runs/267855732 (for example for `ubuntu-bionic-minimal`) come from an unrelated ticket that I merged in the same branch.



---

archive/issue_events_421547.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-27T09:10:02Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421547"
}
```



---

archive/issue_events_421548.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "19be84362c8b7807d920f9b4dac16908692f946e",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-09-27T09:10:02Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30576#event-421548"
}
```



---

archive/issue_comments_487858.json:
```json
{
    "body": "Changed branch from **[public/30576](https://github.com/sagemath/sagetrac-mirror/tree/public/30576)** to **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**",
    "created_at": "2020-09-27T09:10:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30576",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30576#issuecomment-487858",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/30576](https://github.com/sagemath/sagetrac-mirror/tree/public/30576)** to **[945c8c5](https://github.com/sagemath/sagetrac-mirror/commit/945c8c58b23cf7b8e5c15cb69c0ac4dbcd184cb5)**
