# Issue 30556: Meta-ticket: SSL issues

archive/issues_030319.json:
```json
{
    "assignees": [],
    "body": "Building Sage with its own Python 3 can easily produce\na Python 3 missing its `_ssl` module.\n\nPython's `_ssl` module is only built if OpenSSL (with headers)\nis available, either via the system or via the `openssl` spkg.\n\nThe result is reduced functionality:\n\n- it hinders installing pip packages\n- it hinders working with Jupyter\n\n\nSee also:\n\n- many reports on Ask Sage and sage-support\n- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n\nTickets:\n\n- #30557: Add spkg-configure.m4 for openssl\n- #31094 openssl: Make build more robust by clearing some environment variables\n- #30674: Patch tornado so it can be imported in Python without an ssl module\n- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n- #29291: Check for more strictly required extension module \"ssl\" in Python build\n- #24107: Inclusion of OpenSSL, stage 1\n- #32311: Upgrade: OpenSSL 3.0.0.beta2\n- #23893: make openssl a dependency for pip packages\n- #22620: Document that SSL is optional\n- #17690: A SSL section in the \"install from source code\" documentation\n- #30950: sage-download-file: Proper initialization of SSL certificates\n- #32374 Remove pip package `pyopenssl`\n\nReferences:\n- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n\n\nDepends on #30557\nDepends on #30560\nDepends on #30383\n\nCC:  @mwageringel @mkoeppe @slel @williamstein @dimpase\n\nKeywords: **openssl, python**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30556_\n\n",
    "created_at": "2020-09-11T18:11:02Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Meta-ticket: SSL issues",
    "type": "issue",
    "updated_at": "2022-09-19T18:58:47Z",
    "url": "https://github.com/sagemath/sage/issues/30556",
    "user": "https://github.com/slel"
}
```
Building Sage with its own Python 3 can easily produce
a Python 3 missing its `_ssl` module.

Python's `_ssl` module is only built if OpenSSL (with headers)
is available, either via the system or via the `openssl` spkg.

The result is reduced functionality:

- it hinders installing pip packages
- it hinders working with Jupyter


See also:

- many reports on Ask Sage and sage-support
- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)

Tickets:

- #30557: Add spkg-configure.m4 for openssl
- #31094 openssl: Make build more robust by clearing some environment variables
- #30674: Patch tornado so it can be imported in Python without an ssl module
- #29555: Upgrade: OpenSSL 3.0, make it a standard package
- #29291: Check for more strictly required extension module "ssl" in Python build
- #24107: Inclusion of OpenSSL, stage 1
- #32311: Upgrade: OpenSSL 3.0.0.beta2
- #23893: make openssl a dependency for pip packages
- #22620: Document that SSL is optional
- #17690: A SSL section in the "install from source code" documentation
- #30950: sage-download-file: Proper initialization of SSL certificates
- #32374 Remove pip package `pyopenssl`

References:
- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer


Depends on #30557
Depends on #30560
Depends on #30383

CC:  @mwageringel @mkoeppe @slel @williamstein @dimpase

Keywords: **openssl, python**

_Issue created by migration from https://trac.sagemath.org/ticket/30556_





---

archive/issue_events_402996.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-11T18:11:02Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-402996"
}
```



---

archive/issue_events_402997.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-11T18:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20packages%3A%20standard",
    "label_color": "000080",
    "label_name": "component: packages: standard",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-402997"
}
```



---

archive/issue_events_402998.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-11T18:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-402998"
}
```



---

archive/issue_events_402999.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-11T18:11:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-402999"
}
```



---

archive/issue_comments_490446.json:
```json
{
    "body": "Dependencies: **#30557**",
    "created_at": "2020-09-11T18:22:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490446",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30557**



---

archive/issue_comments_490447.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,3 +7,5 @@\n \n - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n \n+See also:\n+- #29291 Check for more strictly required extension module \"ssl\" in Python build\n``````\n",
    "created_at": "2020-09-11T18:54:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490447",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,3 +7,5 @@
 
 - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
 
+See also:
+- #29291 Check for more strictly required extension module "ssl" in Python build
``````




---

archive/issue_comments_490448.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,4 +8,12 @@\n - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n \n See also:\n-- #29291 Check for more strictly required extension module \"ssl\" in Python build\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+\n``````\n",
    "created_at": "2020-09-11T19:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490448",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,4 +8,12 @@
 - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
 
 See also:
-- #29291 Check for more strictly required extension module "ssl" in Python build
+
+- #30557: Add spkg-configure.m4 for openssl
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+
``````




---

archive/issue_comments_490449.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nMany builds of the python3 spkg without its `_ssl` module\nlikely result from an oversight.\n\nCould there be a `configure` flag to explicitly require\nbuilding python3 without its `_ssl` module?\n\nWithout that flag, consider openssl a dependency of python3,\nand let the build fail if it's not there.",
    "created_at": "2020-09-11T19:10:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490449",
    "user": "https://github.com/slel"
}
```

<div id="comment:3" align="right">Comment 3</div>

Many builds of the python3 spkg without its `_ssl` module
likely result from an oversight.

Could there be a `configure` flag to explicitly require
building python3 without its `_ssl` module?

Without that flag, consider openssl a dependency of python3,
and let the build fail if it's not there.



---

archive/issue_events_403000.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-11T19:10:29Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "title_is": "Build Python's ssl module or protest loudly",
    "title_was": "Build Python's ssl module",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403000"
}
```



---

archive/issue_comments_490450.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,19 @@\n-When building Python 3.8.5, Sage does not build its\n-ssl module even if OpenSSL is available system-wide.\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n \n-This differs from what happened with Python 3.7.\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n \n-Reported on sage-release:\n+The result is reduced functionality:\n \n-- [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n \n See also:\n \n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n - #30557: Add spkg-configure.m4 for openssl\n - #29555: Upgrade: OpenSSL 3.0, make it a standard package\n - #29291: Check for more strictly required extension module \"ssl\" in Python build\n``````\n",
    "created_at": "2020-09-11T19:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490450",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,19 @@
-When building Python 3.8.5, Sage does not build its
-ssl module even if OpenSSL is available system-wide.
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
 
-This differs from what happened with Python 3.7.
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
 
-Reported on sage-release:
+The result is reduced functionality:
 
-- [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
 
 See also:
 
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
 - #30557: Add spkg-configure.m4 for openssl
 - #29555: Upgrade: OpenSSL 3.0, make it a standard package
 - #29291: Check for more strictly required extension module "ssl" in Python build
``````




---

archive/issue_comments_490451.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">Comment 4</div>\n\nEven when configuring with `--enable-openssl`,\nI think `openssl` may be built after `python3`.\n\nSo currently one really has to separate into two steps:\n\n```\n$ make openssl\n$ make\n```\n\nor later have to repair with\n\n```\n$ sage -i openssl\n$ sage -f python3\n```",
    "created_at": "2020-09-11T19:23:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490451",
    "user": "https://github.com/slel"
}
```

<div id="comment:4" align="right">Comment 4</div>

Even when configuring with `--enable-openssl`,
I think `openssl` may be built after `python3`.

So currently one really has to separate into two steps:

```
$ make openssl
$ make
```

or later have to repair with

```
$ sage -i openssl
$ sage -f python3
```



---

archive/issue_comments_490452.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\nReplying to [@slel](#comment%3A4):\n> Even when configuring with `--enable-openssl`,\n> I think `openssl` may be built after `python3`.\n\nYes, this is a problem. We do not have a mechanism to order \"optional dependencies\".",
    "created_at": "2020-09-11T19:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490452",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">Comment 5</div>

Replying to [@slel](#comment%3A4):
> Even when configuring with `--enable-openssl`,
> I think `openssl` may be built after `python3`.

Yes, this is a problem. We do not have a mechanism to order "optional dependencies".



---

archive/issue_comments_490453.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">Comment 6</div>\n\nSee #21700 - Packages with \"optional\" dependencies (a package manager's suggested/recommended packages)",
    "created_at": "2020-09-11T19:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490453",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">Comment 6</div>

See #21700 - Packages with "optional" dependencies (a package manager's suggested/recommended packages)



---

archive/issue_comments_490454.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nWe could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.",
    "created_at": "2020-09-11T19:33:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490454",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">Comment 7</div>

We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.



---

archive/issue_comments_490455.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nReplying to [@mkoeppe](#comment%3A7):\n> We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.\n\nThis is now #30560",
    "created_at": "2020-09-11T21:47:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490455",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">Comment 8</div>

Replying to [@mkoeppe](#comment%3A7):
> We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.

This is now #30560



---

archive/issue_comments_490456.json:
```json
{
    "body": "Changed dependencies from **#30557** to **#30557, #30560**",
    "created_at": "2020-09-13T19:36:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490456",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30557** to **#30557, #30560**



---

archive/issue_comments_490457.json:
```json
{
    "body": "Changed dependencies from **#30557, #30560** to **#30557, #30560, #30383**",
    "created_at": "2020-09-13T19:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490457",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30557, #30560** to **#30557, #30560, #30383**



---

archive/issue_comments_490458.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nIf we are building `python3` and `openssl` is not available as a system package and not enabled, then we should disable the packages that depend on openssl -- Jupyter notebook (and dependencies) and all `source=pip` packages. The latter are already optional packages by definition. But we would need give the Jupyter notebook packages a new package type: `optional-enabled-by-default` (#30383).",
    "created_at": "2020-09-13T19:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490458",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">Comment 10</div>

If we are building `python3` and `openssl` is not available as a system package and not enabled, then we should disable the packages that depend on openssl -- Jupyter notebook (and dependencies) and all `source=pip` packages. The latter are already optional packages by definition. But we would need give the Jupyter notebook packages a new package type: `optional-enabled-by-default` (#30383).



---

archive/issue_comments_490459.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nReplying to [@slel](#comment%3A3):\n> Could there be a `configure` flag to explicitly require\n> building python3 without its `_ssl` module?\n\nThis would effectively make openssl a standard package. I don't think we should do that because of license reasons. Warnings about the disabled features are better.",
    "created_at": "2020-09-13T19:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490459",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">Comment 11</div>

Replying to [@slel](#comment%3A3):
> Could there be a `configure` flag to explicitly require
> building python3 without its `_ssl` module?

This would effectively make openssl a standard package. I don't think we should do that because of license reasons. Warnings about the disabled features are better.



---

archive/issue_comments_490460.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI would like to mention that the SSL requirement for Jupyter seems to be a recent change \u2013 presumably the upgrade of tornado or other Jupyter packages in 9.2.beta9. This was not clear to me and part of why I was confused on the mailing list. I was actually using the Python 3 SPKG without SSL all along and until now I have not experienced any problem with this. In particular, this is not related to the Python 3.8 upgrade as I had assumed at first.",
    "created_at": "2020-09-19T08:32:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490460",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:12" align="right">Comment 12</div>

I would like to mention that the SSL requirement for Jupyter seems to be a recent change – presumably the upgrade of tornado or other Jupyter packages in 9.2.beta9. This was not clear to me and part of why I was confused on the mailing list. I was actually using the Python 3 SPKG without SSL all along and until now I have not experienced any problem with this. In particular, this is not related to the Python 3.8 upgrade as I had assumed at first.



---

archive/issue_comments_490461.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nThis might be worth investigating more.",
    "created_at": "2020-09-19T13:14:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490461",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">Comment 13</div>

This might be worth investigating more.



---

archive/issue_comments_490462.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">Comment 14</div>\n\nReplying to [@mkoeppe](#comment%3A13):\n> This might be worth investigating more.\n\nAs suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).",
    "created_at": "2020-09-27T10:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490462",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:14" align="right">Comment 14</div>

Replying to [@mkoeppe](#comment%3A13):
> This might be worth investigating more.

As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).



---

archive/issue_comments_490463.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nReplying to [@mwageringel](#comment%3A14):\n> Replying to [@mkoeppe](#comment%3A13):\n> > This might be worth investigating more.\n\n> \n> As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).\n\nLooks like this would be easy to patch out.",
    "created_at": "2020-09-27T18:45:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490463",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">Comment 15</div>

Replying to [@mwageringel](#comment%3A14):
> Replying to [@mkoeppe](#comment%3A13):
> > This might be worth investigating more.

> 
> As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).

Looks like this would be easy to patch out.



---

archive/issue_comments_490464.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nThis is now #30674",
    "created_at": "2020-09-27T21:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490464",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">Comment 16</div>

This is now #30674



---

archive/issue_comments_490465.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,6 +15,7 @@\n - many reports on Ask Sage and sage-support\n - [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n - #30557: Add spkg-configure.m4 for openssl\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n - #29555: Upgrade: OpenSSL 3.0, make it a standard package\n - #29291: Check for more strictly required extension module \"ssl\" in Python build\n - #24107: Inclusion of OpenSSL, stage 1\n``````\n",
    "created_at": "2020-09-27T21:49:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490465",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,6 +15,7 @@
 - many reports on Ask Sage and sage-support
 - [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
 - #30557: Add spkg-configure.m4 for openssl
+- #30674: Patch tornado so it can be imported in Python without an ssl module
 - #29555: Upgrade: OpenSSL 3.0, make it a standard package
 - #29291: Check for more strictly required extension module "ssl" in Python build
 - #24107: Inclusion of OpenSSL, stage 1
``````




---

archive/issue_events_403001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T17:31:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403001"
}
```



---

archive/issue_events_403002.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T17:31:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403002"
}
```



---

archive/issue_comments_490466.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBuilding a Python without ssl module is happening on `ubuntu-trusty` (https://github.com/sagemath/sage/runs/1553902103) in 9.3.beta4\n\nOur configure finds system openssl; system python3 is too old, so python 3.8 is built from source; but apparently it fails to build the ssl module. (This should be investigated!)\n\nThe symptom is that `pytest` (a pip package that is a check-only dependency of some standard package) fails to install:\n\n```\n[pytest] installing. Log file: /sage/logs/pkgs/pytest.log\n  [pytest] error installing, exit status 1. End of log file:\n  [pytest]   WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\n  [pytest]   WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\")': /simple/pytest/\n```\nIt is likely that this problem has actually been around for a while and was only masked by the faulty SAGE_CHECK logic fixed in #31020.",
    "created_at": "2020-12-15T04:28:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490466",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">Comment 18</div>

Building a Python without ssl module is happening on `ubuntu-trusty` (https://github.com/sagemath/sage/runs/1553902103) in 9.3.beta4

Our configure finds system openssl; system python3 is too old, so python 3.8 is built from source; but apparently it fails to build the ssl module. (This should be investigated!)

The symptom is that `pytest` (a pip package that is a check-only dependency of some standard package) fails to install:

```
[pytest] installing. Log file: /sage/logs/pkgs/pytest.log
  [pytest] error installing, exit status 1. End of log file:
  [pytest]   WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.
  [pytest]   WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError("Can't connect to HTTPS URL because the SSL module is not available.")': /simple/pytest/
```
It is likely that this problem has actually been around for a while and was only masked by the faulty SAGE_CHECK logic fixed in #31020.



---

archive/issue_comments_490467.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nSame in `ubuntu-xenial-standard`.\n\nAlso in various `-minimal` builds, of course, where the SSL headers are not available. For example `ubuntu-hirsute-minimal` (https://github.com/sagemath/sage/runs/1553902375)",
    "created_at": "2020-12-15T04:38:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490467",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">Comment 19</div>

Same in `ubuntu-xenial-standard`.

Also in various `-minimal` builds, of course, where the SSL headers are not available. For example `ubuntu-hirsute-minimal` (https://github.com/sagemath/sage/runs/1553902375)



---

archive/issue_comments_490468.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\n#31062 \"tox / GH Actions: Disable testsuites of packages depending on pip packages (pytest, ...) if there is no ssl\" proposes a workaround",
    "created_at": "2020-12-16T19:59:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490468",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">Comment 20</div>

#31062 "tox / GH Actions: Disable testsuites of packages depending on pip packages (pytest, ...) if there is no ssl" proposes a workaround



---

archive/issue_events_403003.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-18T21:41:37Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "title_is": "Meta-ticket: SSL issues",
    "title_was": "Build Python's ssl module or protest loudly",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403003"
}
```



---

archive/issue_comments_490469.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,9 @@\n \n - many reports on Ask Sage and sage-support\n - [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n - #30557: Add spkg-configure.m4 for openssl\n - #30674: Patch tornado so it can be imported in Python without an ssl module\n - #29555: Upgrade: OpenSSL 3.0, make it a standard package\n@@ -22,4 +25,5 @@\n - #23893: make openssl a dependency for pip packages\n - #22620: Document that SSL is optional\n - #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n \n``````\n",
    "created_at": "2020-12-18T21:41:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490469",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,9 @@
 
 - many reports on Ask Sage and sage-support
 - [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
 - #30557: Add spkg-configure.m4 for openssl
 - #30674: Patch tornado so it can be imported in Python without an ssl module
 - #29555: Upgrade: OpenSSL 3.0, make it a standard package
@@ -22,4 +25,5 @@
 - #23893: make openssl a dependency for pip packages
 - #22620: Document that SSL is optional
 - #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
 
``````




---

archive/issue_comments_490470.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,7 @@\n Tickets:\n \n - #30557: Add spkg-configure.m4 for openssl\n+- #31094 openssl: Make build more robust by clearing some environment variables\n - #30674: Patch tornado so it can be imported in Python without an ssl module\n - #29555: Upgrade: OpenSSL 3.0, make it a standard package\n - #29291: Check for more strictly required extension module \"ssl\" in Python build\n``````\n",
    "created_at": "2020-12-22T07:09:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490470",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,7 @@
 Tickets:
 
 - #30557: Add spkg-configure.m4 for openssl
+- #31094 openssl: Make build more robust by clearing some environment variables
 - #30674: Patch tornado so it can be imported in Python without an ssl module
 - #29555: Upgrade: OpenSSL 3.0, make it a standard package
 - #29291: Check for more strictly required extension module "ssl" in Python build
``````




---

archive/issue_comments_490471.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -28,3 +28,6 @@\n - #17690: A SSL section in the \"install from source code\" documentation\n - #30950: sage-download-file: Proper initialization of SSL certificates\n \n+References:\n+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n+\n``````\n",
    "created_at": "2021-01-31T05:26:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490471",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -28,3 +28,6 @@
 - #17690: A SSL section in the "install from source code" documentation
 - #30950: sage-download-file: Proper initialization of SSL certificates
 
+References:
+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer
+
``````




---

archive/issue_events_403004.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "label": "https://github.com/sagemath/sage/labels/p2%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403004"
}
```



---

archive/issue_events_403005.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403005"
}
```



---

archive/issue_comments_490472.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">Comment 24</div>\n\nMoving it to 9.4; we seem to have an OK solution for now",
    "created_at": "2021-03-26T21:01:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490472",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">Comment 24</div>

Moving it to 9.4; we seem to have an OK solution for now



---

archive/issue_events_403006.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403006"
}
```



---

archive/issue_events_403007.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403007"
}
```



---

archive/issue_events_403008.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403008"
}
```



---

archive/issue_events_403009.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403009"
}
```



---

archive/issue_comments_490473.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,6 +27,7 @@\n - #22620: Document that SSL is optional\n - #17690: A SSL section in the \"install from source code\" documentation\n - #30950: sage-download-file: Proper initialization of SSL certificates\n+- #32374 Remove pip package `pyopenssl`\n \n References:\n - https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n``````\n",
    "created_at": "2021-08-13T02:14:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490473",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,6 +27,7 @@
 - #22620: Document that SSL is optional
 - #17690: A SSL section in the "install from source code" documentation
 - #30950: sage-download-file: Proper initialization of SSL certificates
+- #32374 Remove pip package `pyopenssl`
 
 References:
 - https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer
``````




---

archive/issue_comments_490474.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -23,6 +23,7 @@\n - #29555: Upgrade: OpenSSL 3.0, make it a standard package\n - #29291: Check for more strictly required extension module \"ssl\" in Python build\n - #24107: Inclusion of OpenSSL, stage 1\n+- #32311: Upgrade: OpenSSL 3.0.0.beta2\n - #23893: make openssl a dependency for pip packages\n - #22620: Document that SSL is optional\n - #17690: A SSL section in the \"install from source code\" documentation\n``````\n",
    "created_at": "2021-08-13T02:15:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30556#issuecomment-490474",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -23,6 +23,7 @@
 - #29555: Upgrade: OpenSSL 3.0, make it a standard package
 - #29291: Check for more strictly required extension module "ssl" in Python build
 - #24107: Inclusion of OpenSSL, stage 1
+- #32311: Upgrade: OpenSSL 3.0.0.beta2
 - #23893: make openssl a dependency for pip packages
 - #22620: Document that SSL is optional
 - #17690: A SSL section in the "install from source code" documentation
``````




---

archive/issue_events_403010.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T23:22:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403010"
}
```



---

archive/issue_events_403011.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T23:22:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403011"
}
```



---

archive/issue_events_403012.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403012"
}
```



---

archive/issue_events_403013.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403013"
}
```



---

archive/issue_events_403014.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403014"
}
```



---

archive/issue_events_403015.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30556",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30556#event-403015"
}
```
