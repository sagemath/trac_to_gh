# Issue 30556: Meta-ticket: SSL issues

archive/issues_030319.json:
```json
{
    "body": "Building Sage with its own Python 3 can easily produce\na Python 3 missing its `_ssl` module.\n\nPython's `_ssl` module is only built if OpenSSL (with headers)\nis available, either via the system or via the `openssl` spkg.\n\nThe result is reduced functionality:\n\n- it hinders installing pip packages\n- it hinders working with Jupyter\n\n\nSee also:\n\n- many reports on Ask Sage and sage-support\n- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n\nTickets:\n\n- #30557: Add spkg-configure.m4 for openssl\n- #31094 openssl: Make build more robust by clearing some environment variables\n- #30674: Patch tornado so it can be imported in Python without an ssl module\n- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n- #29291: Check for more strictly required extension module \"ssl\" in Python build\n- #24107: Inclusion of OpenSSL, stage 1\n- #32311: Upgrade: OpenSSL 3.0.0.beta2\n- #23893: make openssl a dependency for pip packages\n- #22620: Document that SSL is optional\n- #17690: A SSL section in the \"install from source code\" documentation\n- #30950: sage-download-file: Proper initialization of SSL certificates\n- #32374 Remove pip package `pyopenssl`\n\nReferences:\n- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n\n\nCC:  @mwageringel @mkoeppe @slel @williamstein @dimpase\n\nKeywords: openssl, python\n\nStatus: new\n\nDependencies: #30557, #30560, #30383\n\nIssue created by migration from https://trac.sagemath.org/ticket/30556\n\n",
    "created_at": "2020-09-11T18:11:02Z",
    "labels": [
        "component: packages: standard",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: SSL issues",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30556",
    "user": "https://github.com/slel"
}
```
Building Sage with its own Python 3 can easily produce
a Python 3 missing its `_ssl` module.

Python's `_ssl` module is only built if OpenSSL (with headers)
is available, either via the system or via the `openssl` spkg.

The result is reduced functionality:

- it hinders installing pip packages
- it hinders working with Jupyter


See also:

- many reports on Ask Sage and sage-support
- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)

Tickets:

- #30557: Add spkg-configure.m4 for openssl
- #31094 openssl: Make build more robust by clearing some environment variables
- #30674: Patch tornado so it can be imported in Python without an ssl module
- #29555: Upgrade: OpenSSL 3.0, make it a standard package
- #29291: Check for more strictly required extension module "ssl" in Python build
- #24107: Inclusion of OpenSSL, stage 1
- #32311: Upgrade: OpenSSL 3.0.0.beta2
- #23893: make openssl a dependency for pip packages
- #22620: Document that SSL is optional
- #17690: A SSL section in the "install from source code" documentation
- #30950: sage-download-file: Proper initialization of SSL certificates
- #32374 Remove pip package `pyopenssl`

References:
- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer


CC:  @mwageringel @mkoeppe @slel @williamstein @dimpase

Keywords: openssl, python

Status: new

Dependencies: #30557, #30560, #30383

Issue created by migration from https://trac.sagemath.org/ticket/30556





---

archive/issue_comments_461291.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -6,6 +6,9 @@\n Reported on sage-release:\n \n - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+See also:\n+- #29291 Check for more strictly required extension module \"ssl\" in Python build\n \n Comment: 1\n \n```\n",
    "created_at": "2020-09-11T18:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461291",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -6,6 +6,9 @@
 Reported on sage-release:
 
 - [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+See also:
+- #29291 Check for more strictly required extension module "ssl" in Python build
 
 Comment: 1
 
```




---

archive/issue_comments_461292.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,21 @@\n+When building Python 3.8.5, Sage does not build its\n+ssl module even if OpenSSL is available system-wide.\n+\n+This differs from what happened with Python 3.7.\n+\n+Reported on sage-release:\n+\n+- [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+See also:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-11T19:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461292",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,21 @@
+When building Python 3.8.5, Sage does not build its
+ssl module even if OpenSSL is available system-wide.
+
+This differs from what happened with Python 3.7.
+
+Reported on sage-release:
+
+- [initial report on sage-release](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+See also:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
 
 
 Comment: 1
```




---

archive/issue_comments_461293.json:
```json
{
    "body": "<a id='comment:3'></a>Many builds of the python3 spkg without its `_ssl` module\nlikely result from an oversight.\n\nCould there be a `configure` flag to explicitly require\nbuilding python3 without its `_ssl` module?\n\nWithout that flag, consider openssl a dependency of python3,\nand let the build fail if it's not there.",
    "created_at": "2020-09-11T19:10:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461293",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>Many builds of the python3 spkg without its `_ssl` module
likely result from an oversight.

Could there be a `configure` flag to explicitly require
building python3 without its `_ssl` module?

Without that flag, consider openssl a dependency of python3,
and let the build fail if it's not there.



---

archive/issue_comments_461294.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,26 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+- #30557: Add spkg-configure.m4 for openssl\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-11T19:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461294",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,26 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+- #30557: Add spkg-configure.m4 for openssl
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
 
 
 Comment: 1
```




---

archive/issue_comments_461295.json:
```json
{
    "body": "<a id='comment:4'></a>Even when configuring with `--enable-openssl`,\nI think `openssl` may be built after `python3`.\n\nSo currently one really has to separate into two steps:\n\n```\n$ make openssl\n$ make\n```\n\nor later have to repair with\n\n```\n$ sage -i openssl\n$ sage -f python3\n```",
    "created_at": "2020-09-11T19:23:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461295",
    "user": "https://github.com/slel"
}
```

<a id='comment:4'></a>Even when configuring with `--enable-openssl`,
I think `openssl` may be built after `python3`.

So currently one really has to separate into two steps:

```
$ make openssl
$ make
```

or later have to repair with

```
$ sage -i openssl
$ sage -f python3
```



---

archive/issue_comments_461296.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 slelievre]:\n> Even when configuring with `--enable-openssl`,\n> I think `openssl` may be built after `python3`.\n\n\nYes, this is a problem. We do not have a mechanism to order \"optional dependencies\".",
    "created_at": "2020-09-11T19:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461296",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Replying to [comment:4 slelievre]:
> Even when configuring with `--enable-openssl`,
> I think `openssl` may be built after `python3`.


Yes, this is a problem. We do not have a mechanism to order "optional dependencies".



---

archive/issue_comments_461297.json:
```json
{
    "body": "<a id='comment:6'></a>See #21700 - Packages with \"optional\" dependencies (a package manager's suggested/recommended packages)",
    "created_at": "2020-09-11T19:31:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461297",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>See #21700 - Packages with "optional" dependencies (a package manager's suggested/recommended packages)



---

archive/issue_comments_461298.json:
```json
{
    "body": "<a id='comment:7'></a>We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.",
    "created_at": "2020-09-11T19:33:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461298",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.



---

archive/issue_comments_461299.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:\n> We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.\n\nThis is now #30560",
    "created_at": "2020-09-11T21:47:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461299",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:
> We could add `openssl` to TOOLCHAIN_DEPS as a workaround. Then it would be built at the very beginning.

This is now #30560



---

archive/issue_comments_461300.json:
```json
{
    "body": "<a id='comment:10'></a>If we are building `python3` and `openssl` is not available as a system package and not enabled, then we should disable the packages that depend on openssl -- Jupyter notebook (and dependencies) and all `source=pip` packages. The latter are already optional packages by definition. But we would need give the Jupyter notebook packages a new package type: `optional-enabled-by-default` (#30383).",
    "created_at": "2020-09-13T19:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461300",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>If we are building `python3` and `openssl` is not available as a system package and not enabled, then we should disable the packages that depend on openssl -- Jupyter notebook (and dependencies) and all `source=pip` packages. The latter are already optional packages by definition. But we would need give the Jupyter notebook packages a new package type: `optional-enabled-by-default` (#30383).



---

archive/issue_comments_461301.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:3 slelievre]:\n> Could there be a `configure` flag to explicitly require\n> building python3 without its `_ssl` module?\n\n\nThis would effectively make openssl a standard package. I don't think we should do that because of license reasons. Warnings about the disabled features are better.",
    "created_at": "2020-09-13T19:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461301",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:3 slelievre]:
> Could there be a `configure` flag to explicitly require
> building python3 without its `_ssl` module?


This would effectively make openssl a standard package. I don't think we should do that because of license reasons. Warnings about the disabled features are better.



---

archive/issue_comments_461302.json:
```json
{
    "body": "<a id='comment:12'></a>I would like to mention that the SSL requirement for Jupyter seems to be a recent change \u2013 presumably the upgrade of tornado or other Jupyter packages in 9.2.beta9. This was not clear to me and part of why I was confused on the mailing list. I was actually using the Python 3 SPKG without SSL all along and until now I have not experienced any problem with this. In particular, this is not related to the Python 3.8 upgrade as I had assumed at first.",
    "created_at": "2020-09-19T08:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461302",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:12'></a>I would like to mention that the SSL requirement for Jupyter seems to be a recent change – presumably the upgrade of tornado or other Jupyter packages in 9.2.beta9. This was not clear to me and part of why I was confused on the mailing list. I was actually using the Python 3 SPKG without SSL all along and until now I have not experienced any problem with this. In particular, this is not related to the Python 3.8 upgrade as I had assumed at first.



---

archive/issue_comments_461303.json:
```json
{
    "body": "<a id='comment:13'></a>This might be worth investigating more.",
    "created_at": "2020-09-19T13:14:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461303",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>This might be worth investigating more.



---

archive/issue_comments_461304.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:\n> This might be worth investigating more.\n\n\nAs suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).",
    "created_at": "2020-09-27T10:58:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461304",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:14'></a>Replying to [comment:13 mkoeppe]:
> This might be worth investigating more.


As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).



---

archive/issue_comments_461305.json:
```json
{
    "body": "<a id='comment:15'></a>Replying to [comment:14 gh-mwageringel]:\n> Replying to [comment:13 mkoeppe]:\n> > This might be worth investigating more.\n\n> \n> As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).\n\n\nLooks like this would be easy to patch out.",
    "created_at": "2020-09-27T18:45:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461305",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Replying to [comment:14 gh-mwageringel]:
> Replying to [comment:13 mkoeppe]:
> > This might be worth investigating more.

> 
> As suspected, this is a consequence of the Jupyter upgrades in #26919, merged in 9.2.beta9. The dependency on `ssl` in `tornado/httpserver.py` was added in [this commit](https://github.com/tornadoweb/tornado/commit/1b51b7dea0217927dbc52339f6db3b1233d7c539).


Looks like this would be easy to patch out.



---

archive/issue_comments_461306.json:
```json
{
    "body": "<a id='comment:16'></a>This is now #30674",
    "created_at": "2020-09-27T21:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461306",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>This is now #30674



---

archive/issue_comments_461307.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,27 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+- #30557: Add spkg-configure.m4 for openssl\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-27T21:49:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461307",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,27 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+- #30557: Add spkg-configure.m4 for openssl
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
 
 
 Comment: 1
```




---

archive/issue_events_079413.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-08T17:31:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79413"
}
```



---

archive/issue_comments_461308.json:
```json
{
    "body": "<a id='comment:18'></a>Building a Python without ssl module is happening on `ubuntu-trusty` (https://github.com/sagemath/sage/runs/1553902103) in 9.3.beta4\n\nOur configure finds system openssl; system python3 is too old, so python 3.8 is built from source; but apparently it fails to build the ssl module. (This should be investigated!)\n\nThe symptom is that `pytest` (a pip package that is a check-only dependency of some standard package) fails to install:\n\n```\n[pytest] installing. Log file: /sage/logs/pkgs/pytest.log\n  [pytest] error installing, exit status 1. End of log file:\n  [pytest]   WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.\n  [pytest]   WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError(\"Can't connect to HTTPS URL because the SSL module is not available.\")': /simple/pytest/\n```\nIt is likely that this problem has actually been around for a while and was only masked by the faulty SAGE_CHECK logic fixed in #31020.",
    "created_at": "2020-12-15T04:28:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461308",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>Building a Python without ssl module is happening on `ubuntu-trusty` (https://github.com/sagemath/sage/runs/1553902103) in 9.3.beta4

Our configure finds system openssl; system python3 is too old, so python 3.8 is built from source; but apparently it fails to build the ssl module. (This should be investigated!)

The symptom is that `pytest` (a pip package that is a check-only dependency of some standard package) fails to install:

```
[pytest] installing. Log file: /sage/logs/pkgs/pytest.log
  [pytest] error installing, exit status 1. End of log file:
  [pytest]   WARNING: pip is configured with locations that require TLS/SSL, however the ssl module in Python is not available.
  [pytest]   WARNING: Retrying (Retry(total=4, connect=None, read=None, redirect=None, status=None)) after connection broken by 'SSLError("Can't connect to HTTPS URL because the SSL module is not available.")': /simple/pytest/
```
It is likely that this problem has actually been around for a while and was only masked by the faulty SAGE_CHECK logic fixed in #31020.



---

archive/issue_comments_461309.json:
```json
{
    "body": "<a id='comment:19'></a>Same in `ubuntu-xenial-standard`.\n\nAlso in various `-minimal` builds, of course, where the SSL headers are not available. For example `ubuntu-hirsute-minimal` (https://github.com/sagemath/sage/runs/1553902375)",
    "created_at": "2020-12-15T04:38:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461309",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Same in `ubuntu-xenial-standard`.

Also in various `-minimal` builds, of course, where the SSL headers are not available. For example `ubuntu-hirsute-minimal` (https://github.com/sagemath/sage/runs/1553902375)



---

archive/issue_comments_461310.json:
```json
{
    "body": "<a id='comment:20'></a>#31062 \"tox / GH Actions: Disable testsuites of packages depending on pip packages (pytest, ...) if there is no ssl\" proposes a workaround",
    "created_at": "2020-12-16T19:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461310",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>#31062 "tox / GH Actions: Disable testsuites of packages depending on pip packages (pytest, ...) if there is no ssl" proposes a workaround



---

archive/issue_comments_461311.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,31 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n \n \n Comment: 1\n```\n",
    "created_at": "2020-12-18T21:41:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461311",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,31 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
 
 
 Comment: 1
```




---

archive/issue_comments_461312.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,32 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #31094 openssl: Make build more robust by clearing some environment variables\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n \n \n Comment: 1\n```\n",
    "created_at": "2020-12-22T07:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461312",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,32 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #31094 openssl: Make build more robust by clearing some environment variables
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
 
 
 Comment: 1
```




---

archive/issue_comments_461313.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,35 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #31094 openssl: Make build more robust by clearing some environment variables\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n+\n+References:\n+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n \n \n Comment: 1\n```\n",
    "created_at": "2021-01-31T05:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461313",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,35 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #31094 openssl: Make build more robust by clearing some environment variables
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
+
+References:
+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer
 
 
 Comment: 1
```




---

archive/issue_comments_461314.json:
```json
{
    "body": "<a id='comment:24'></a>Moving it to 9.4; we seem to have an OK solution for now",
    "created_at": "2021-03-26T21:01:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461314",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Moving it to 9.4; we seem to have an OK solution for now



---

archive/issue_events_079414.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79414"
}
```



---

archive/issue_events_079415.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-26T21:01:57Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79415"
}
```



---

archive/issue_events_079416.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79416"
}
```



---

archive/issue_events_079417.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79417"
}
```



---

archive/issue_comments_461315.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,36 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #31094 openssl: Make build more robust by clearing some environment variables\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n+- #32374 Remove pip package `pyopenssl`\n+\n+References:\n+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n \n \n Comment: 1\n```\n",
    "created_at": "2021-08-13T02:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461315",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,36 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #31094 openssl: Make build more robust by clearing some environment variables
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
+- #32374 Remove pip package `pyopenssl`
+
+References:
+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer
 
 
 Comment: 1
```




---

archive/issue_comments_461316.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,37 @@\n+Building Sage with its own Python 3 can easily produce\n+a Python 3 missing its `_ssl` module.\n+\n+Python's `_ssl` module is only built if OpenSSL (with headers)\n+is available, either via the system or via the `openssl` spkg.\n+\n+The result is reduced functionality:\n+\n+- it hinders installing pip packages\n+- it hinders working with Jupyter\n+\n+\n+See also:\n+\n+- many reports on Ask Sage and sage-support\n+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)\n+\n+Tickets:\n+\n+- #30557: Add spkg-configure.m4 for openssl\n+- #31094 openssl: Make build more robust by clearing some environment variables\n+- #30674: Patch tornado so it can be imported in Python without an ssl module\n+- #29555: Upgrade: OpenSSL 3.0, make it a standard package\n+- #29291: Check for more strictly required extension module \"ssl\" in Python build\n+- #24107: Inclusion of OpenSSL, stage 1\n+- #32311: Upgrade: OpenSSL 3.0.0.beta2\n+- #23893: make openssl a dependency for pip packages\n+- #22620: Document that SSL is optional\n+- #17690: A SSL section in the \"install from source code\" documentation\n+- #30950: sage-download-file: Proper initialization of SSL certificates\n+- #32374 Remove pip package `pyopenssl`\n+\n+References:\n+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer\n \n \n Comment: 1\n```\n",
    "created_at": "2021-08-13T02:15:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30556#issuecomment-461316",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,37 @@
+Building Sage with its own Python 3 can easily produce
+a Python 3 missing its `_ssl` module.
+
+Python's `_ssl` module is only built if OpenSSL (with headers)
+is available, either via the system or via the `openssl` spkg.
+
+The result is reduced functionality:
+
+- it hinders installing pip packages
+- it hinders working with Jupyter
+
+
+See also:
+
+- many reports on Ask Sage and sage-support
+- [sage-release: cannot start Jupyter due to missing _ssl module](https://groups.google.com/d/msg/sage-release/hobZzw74Rv0/pkiQFTg9AQAJ)
+
+Tickets:
+
+- #30557: Add spkg-configure.m4 for openssl
+- #31094 openssl: Make build more robust by clearing some environment variables
+- #30674: Patch tornado so it can be imported in Python without an ssl module
+- #29555: Upgrade: OpenSSL 3.0, make it a standard package
+- #29291: Check for more strictly required extension module "ssl" in Python build
+- #24107: Inclusion of OpenSSL, stage 1
+- #32311: Upgrade: OpenSSL 3.0.0.beta2
+- #23893: make openssl a dependency for pip packages
+- #22620: Document that SSL is optional
+- #17690: A SSL section in the "install from source code" documentation
+- #30950: sage-download-file: Proper initialization of SSL certificates
+- #32374 Remove pip package `pyopenssl`
+
+References:
+- https://www.python.org/dev/peps/pep-0644/ - Require OpenSSL 1.1 or newer
 
 
 Comment: 1
```




---

archive/issue_events_079418.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T23:22:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79418"
}
```



---

archive/issue_events_079419.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-10T23:22:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79419"
}
```



---

archive/issue_events_079420.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79420"
}
```



---

archive/issue_events_079421.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79421"
}
```



---

archive/issue_events_079422.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79422"
}
```



---

archive/issue_events_079423.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30556",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30556#event-79423"
}
```
