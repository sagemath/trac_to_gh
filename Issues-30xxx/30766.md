# Issue 30766: Experimental support for Python 3.10 in Sage 9.5

archive/issues_030529.json:
```json
{
    "body": "This is to support Python 3.10, which was released on 2021-10-04.\nhttps://docs.python.org/3.10/whatsnew/changelog.html#changelog\n\nThanks to the following tickets, Sage is mostly ready for \nPython 3.10 in addition to 3.9, 3.8, 3.7.\n\n- needs Cython 0.29.23 (#31445)\n- #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n- #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n- #32815 `numpy`\n- #32837 `cffi`: Update to 1.15.0\n- #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)\n- #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3\n- #31295 Meta-ticket: Replace imports from deprecated `distutils`\n- #32930 IPython/Jupyter upgrade for python 3.10 support\n- #33013 Fix tests with Python 3.10\n\nIn this ticket, we enable use of system Python 3.10 but issue a warning regarding its experimental status for Sage. \n\nThe ticket does not include the upgrade of the `python3` SPKG to Python 3.10.  Many systems already ship Python 3.10.  To test, thanks to https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages, a full rebuild of the Sage distribution is not necessary - only the Python packages will be  built from scratch in a separate venv.\n\nRelated:\n\n- [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)\n- [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)\n- #30767: Upgrade to Python 3.10\n- #30184: Support Python 3.9\n- #30384: Adopt the \u201ctime window-based\u201d policy for support of Python versions from NEP 29\n\n\n**CC:**  @mkoeppe @slel @kiwifb @tornaria @antonio-rojas\n\n**Keywords:** upgrade, python\n\n**Branch:** [df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)\n\n**Reviewer:** Antonio Rojas, Matthias Koeppe\n\n**Author:** Matthias Koeppe, Gonzalo Tornar\u00eda\n\n**Dependencies:** #33013, #32930, #33040\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30766\n\n",
    "closed_at": "2022-01-01T00:23:38Z",
    "created_at": "2020-10-13T21:33:40Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Experimental support for Python 3.10 in Sage 9.5",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30766",
    "user": "https://github.com/slel"
}
```
This is to support Python 3.10, which was released on 2021-10-04.
https://docs.python.org/3.10/whatsnew/changelog.html#changelog

Thanks to the following tickets, Sage is mostly ready for 
Python 3.10 in addition to 3.9, 3.8, 3.7.

- needs Cython 0.29.23 (#31445)
- #31855 Patch/upgrade `gmpy2` to add python 3.10 support
- #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
- #32815 `numpy`
- #32837 `cffi`: Update to 1.15.0
- #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)
- #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3
- #31295 Meta-ticket: Replace imports from deprecated `distutils`
- #32930 IPython/Jupyter upgrade for python 3.10 support
- #33013 Fix tests with Python 3.10

In this ticket, we enable use of system Python 3.10 but issue a warning regarding its experimental status for Sage. 

The ticket does not include the upgrade of the `python3` SPKG to Python 3.10.  Many systems already ship Python 3.10.  To test, thanks to https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages, a full rebuild of the Sage distribution is not necessary - only the Python packages will be  built from scratch in a separate venv.

Related:

- [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)
- [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)
- #30767: Upgrade to Python 3.10
- #30184: Support Python 3.9
- #30384: Adopt the “time window-based” policy for support of Python versions from NEP 29


**CC:**  @mkoeppe @slel @kiwifb @tornaria @antonio-rojas

**Keywords:** upgrade, python

**Branch:** [df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)

**Reviewer:** Antonio Rojas, Matthias Koeppe

**Author:** Matthias Koeppe, Gonzalo Tornaría

**Dependencies:** #33013, #32930, #33040

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/30766





---

archive/issue_comments_609797.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"upgrade, python\".",
    "created_at": "2020-10-13T21:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609797",
    "user": "https://github.com/slel"
}
```

**Changing keywords** from "" to "upgrade, python".



---

archive/issue_comments_609798.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,15 @@\n+This is to support Python 3.10.\n+Python 3.10.0 expected release: 2021-10-04.\n \n+This ticket is for the patches necessary to support\n+Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n+\n+It does not include the actual upgrade to Python 3.10.\n+To test, see #30767.\n+\n+Related:\n+\n+- [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)\n+- #30184: Support Python 3.9\n+- #30384: Adopt the \u201ctime window-based\u201d policy for support of Python versions from NEP 29\n+\n``````\n",
    "created_at": "2020-10-13T21:44:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609798",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,15 @@
+This is to support Python 3.10.
+Python 3.10.0 expected release: 2021-10-04.
 
+This ticket is for the patches necessary to support
+Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
+
+It does not include the actual upgrade to Python 3.10.
+To test, see #30767.
+
+Related:
+
+- [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)
+- #30184: Support Python 3.9
+- #30384: Adopt the “time window-based” policy for support of Python versions from NEP 29
+
``````




---

archive/issue_comments_609799.json:
```json
{
    "body": "**Dependencies:** #30768",
    "created_at": "2020-10-15T11:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609799",
    "user": "https://github.com/slel"
}
```

**Dependencies:** #30768



---

archive/issue_comments_609800.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,8 @@\n Related:\n \n - [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)\n+- [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)\n+- #30767: Test ticket: Python 3.10 development releases\n - #30184: Support Python 3.9\n - #30384: Adopt the \u201ctime window-based\u201d policy for support of Python versions from NEP 29\n \n``````\n",
    "created_at": "2020-10-15T11:19:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609800",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,8 @@
 Related:
 
 - [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)
+- [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)
+- #30767: Test ticket: Python 3.10 development releases
 - #30184: Support Python 3.9
 - #30384: Adopt the “time window-based” policy for support of Python versions from NEP 29
 
``````




---

archive/issue_comments_609801.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,6 +3,8 @@\n \n This ticket is for the patches necessary to support\n Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n+\n+- needs Cython 0.29.23 (#31445)\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-04-14T18:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609801",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,6 +3,8 @@
 
 This ticket is for the patches necessary to support
 Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
+
+- needs Cython 0.29.23 (#31445)
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609802.json:
```json
{
    "body": "**Changing dependencies** from \"#30768\" to \"#30768, #31445\".",
    "created_at": "2021-04-14T18:29:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609802",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768" to "#30768, #31445".



---

archive/issue_events_090379.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-14T18:29:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30766#event-90379"
}
```



---

archive/issue_comments_609803.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,6 +5,7 @@\n Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n \n - needs Cython 0.29.23 (#31445)\n+- `gmpy2` fails to build with Python 3.10: error: \u2018_PyHASH_NAN\u2019 undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-24T23:36:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609803",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,6 +5,7 @@
 Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
 
 - needs Cython 0.29.23 (#31445)
+- `gmpy2` fails to build with Python 3.10: error: ‘_PyHASH_NAN’ undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609804.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/support_python_3_10)",
    "created_at": "2021-05-24T23:46:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609804",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/support_python_3_10)



---

archive/issue_comments_609805.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n \n - needs Cython 0.29.23 (#31445)\n-- `gmpy2` fails to build with Python 3.10: error: \u2018_PyHASH_NAN\u2019 undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010\n+- `gmpy2` fails to build with Python 3.10: error: \u2018_PyHASH_NAN\u2019 undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010 ... patches at https://copr-dist-git.fedorainfracloud.org/cgit/@python/python3.10/python-gmpy2.git/tree/\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-24T23:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609805",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
 
 - needs Cython 0.29.23 (#31445)
-- `gmpy2` fails to build with Python 3.10: error: ‘_PyHASH_NAN’ undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010
+- `gmpy2` fails to build with Python 3.10: error: ‘_PyHASH_NAN’ undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010 ... patches at https://copr-dist-git.fedorainfracloud.org/cgit/@python/python3.10/python-gmpy2.git/tree/
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609806.json:
```json
{
    "body": "<a id='comment:8'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ca849f433a51778f0cc8cc707f85b4334f7cf4b\">6ca849f</a></td><td><code>build/pkgs/cython: Update to 0.29.23</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f\">4e4fd58</a></td><td><code>Merge #31445</code></td></tr></table>\n",
    "created_at": "2021-05-24T23:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609806",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ca849f433a51778f0cc8cc707f85b4334f7cf4b">6ca849f</a></td><td><code>build/pkgs/cython: Update to 0.29.23</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f">4e4fd58</a></td><td><code>Merge #31445</code></td></tr></table>




---

archive/issue_comments_609807.json:
```json
{
    "body": "**Commit:** [4e4fd585db7743016d6ecc1f80c54b240969d07f](https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f)",
    "created_at": "2021-05-24T23:56:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609807",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [4e4fd585db7743016d6ecc1f80c54b240969d07f](https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f)



---

archive/issue_comments_609808.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n \n - needs Cython 0.29.23 (#31445)\n-- `gmpy2` fails to build with Python 3.10: error: \u2018_PyHASH_NAN\u2019 undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010 ... patches at https://copr-dist-git.fedorainfracloud.org/cgit/@python/python3.10/python-gmpy2.git/tree/\n+- #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-24T23:58:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609808",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
 
 - needs Cython 0.29.23 (#31445)
-- `gmpy2` fails to build with Python 3.10: error: ‘_PyHASH_NAN’ undeclared - https://bugzilla.redhat.com/show_bug.cgi?id=1959010 ... patches at https://copr-dist-git.fedorainfracloud.org/cgit/@python/python3.10/python-gmpy2.git/tree/
+- #31855 Patch/upgrade `gmpy2` to add python 3.10 support
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609809.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445\" to \"#30768, #31445, #31855\".",
    "created_at": "2021-05-25T00:03:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609809",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445" to "#30768, #31445, #31855".



---

archive/issue_comments_609810.json:
```json
{
    "body": "**Changing commit** from \"[4e4fd585db7743016d6ecc1f80c54b240969d07f](https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f)\" to \"[2d7d71503a827e76f2cace350fea6dd03ec4f852](https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852)\".",
    "created_at": "2021-05-25T00:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609810",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4e4fd585db7743016d6ecc1f80c54b240969d07f](https://github.com/sagemath/sagetrac-mirror/commit/4e4fd585db7743016d6ecc1f80c54b240969d07f)" to "[2d7d71503a827e76f2cace350fea6dd03ec4f852](https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852)".



---

archive/issue_comments_609811.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8cd9ece1cb6942ee612bf7aff9cfad41d0946c2e\">8cd9ece</a></td><td><code>build/pkgs/gmpy2/patches: Add patches from Fedora @python/python3.10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852\">2d7d715</a></td><td><code>Merge #31855</code></td></tr></table>\n",
    "created_at": "2021-05-25T00:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609811",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8cd9ece1cb6942ee612bf7aff9cfad41d0946c2e">8cd9ece</a></td><td><code>build/pkgs/gmpy2/patches: Add patches from Fedora @python/python3.10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852">2d7d715</a></td><td><code>Merge #31855</code></td></tr></table>




---

archive/issue_comments_609812.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773\">3321a59</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr></table>\n",
    "created_at": "2021-05-25T00:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609812",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773">3321a59</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr></table>




---

archive/issue_comments_609813.json:
```json
{
    "body": "**Changing commit** from \"[2d7d71503a827e76f2cace350fea6dd03ec4f852](https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852)\" to \"[3321a593e3416b37d318df85f9e2f9ec42766773](https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773)\".",
    "created_at": "2021-05-25T00:06:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609813",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2d7d71503a827e76f2cace350fea6dd03ec4f852](https://github.com/sagemath/sagetrac-mirror/commit/2d7d71503a827e76f2cace350fea6dd03ec4f852)" to "[3321a593e3416b37d318df85f9e2f9ec42766773](https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773)".



---

archive/issue_comments_609814.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n \n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n+- pyzmq-19.0.2 `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99`\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-25T00:08:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609814",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
+- pyzmq-19.0.2 `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99`
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609815.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n \n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n-- pyzmq-19.0.2 `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99`\n+- #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-25T00:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609815",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
-- pyzmq-19.0.2 `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99`
+- #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609816.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445, #31855\" to \"#30768, #31445, #31855, #31856\".",
    "created_at": "2021-05-25T00:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609816",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445, #31855" to "#30768, #31445, #31855, #31856".



---

archive/issue_comments_609817.json:
```json
{
    "body": "**Changing commit** from \"[3321a593e3416b37d318df85f9e2f9ec42766773](https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773)\" to \"[65355f936278914e8e36c14c11eec499e382b8f1](https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1)\".",
    "created_at": "2021-05-25T00:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3321a593e3416b37d318df85f9e2f9ec42766773](https://github.com/sagemath/sagetrac-mirror/commit/3321a593e3416b37d318df85f9e2f9ec42766773)" to "[65355f936278914e8e36c14c11eec499e382b8f1](https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1)".



---

archive/issue_comments_609818.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a7d94055fd5c61d9453d848a28218dea1effe71\">2a7d940</a></td><td><code>build/pkgs/pyzmq: Update to 22.0.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1\">65355f9</a></td><td><code>Merge #31856</code></td></tr></table>\n",
    "created_at": "2021-05-25T00:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609818",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a7d94055fd5c61d9453d848a28218dea1effe71">2a7d940</a></td><td><code>build/pkgs/pyzmq: Update to 22.0.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1">65355f9</a></td><td><code>Merge #31856</code></td></tr></table>




---

archive/issue_comments_609819.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445, #31855, #31856\" to \"#30768, #31445, #31855, #31856, #31008\".",
    "created_at": "2021-05-25T00:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609819",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445, #31855, #31856" to "#30768, #31445, #31855, #31856, #31008".



---

archive/issue_comments_609820.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,8 @@\n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n - #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n+- `babel`\n+- `numpy`\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-05-25T00:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609820",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,8 @@
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
 - #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
+- `babel`
+- `numpy`
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609821.json:
```json
{
    "body": "**Changing commit** from \"[65355f936278914e8e36c14c11eec499e382b8f1](https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1)\" to \"[a661b6af08beb316810667a982969b6832196736](https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736)\".",
    "created_at": "2021-05-25T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[65355f936278914e8e36c14c11eec499e382b8f1](https://github.com/sagemath/sagetrac-mirror/commit/65355f936278914e8e36c14c11eec499e382b8f1)" to "[a661b6af08beb316810667a982969b6832196736](https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736)".



---

archive/issue_comments_609822.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7207221ddc3da17663be31d51530b774a164373\">f720722</a></td><td><code>build/pkgs/sagelib/src/tox.ini: Add factor nobuildisolation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c451b310026a0b6c973dd0b22efa2cbe784e6c98\">c451b31</a></td><td><code>src/setup.cfg.m4 (install_requires): Add sage_conf</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/67002239dc377d82717c09a7c5c048a7161b51be\">6700223</a></td><td><code>Merge tag '9.3.rc0' into t/30913/sagelib__add_setup_cfg__install_requires_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/04da2c6eb85566de6d49bf19803a061f4843c662\">04da2c6</a></td><td><code>build/pkgs/ipywidgets: Patch out declaring install-requires of nbformat and jupyterlab-widgets</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/815c9446187ff6ee41ad6ab7a1a7b182ad2cd300\">815c944</a></td><td><code>Merge #30913</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b06731c29501c81a35bba514ce11a957174732f0\">b06731c</a></td><td><code>Remove Python 3.6 support from metadata and documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/57338c1cc0a835b9ac7fb027ffa99bb5f77a45fc\">57338c1</a></td><td><code>Update numpy to 1.20.2, scipy to 1.6.2, networkx to 2.5.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ac49be02c68f399b1e38912fe3ff1c5c437b7aa3\">ac49be0</a></td><td><code>build/pkgs/numpy: Update to 1.20.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02f68482174d6a4b49d0a8cd1e3575ee3c007fc5\">02f6848</a></td><td><code>build/pkgs/scipy: Update to 1.6.3</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736\">a661b6a</a></td><td><code>Merge #31008</code></td></tr></table>\n",
    "created_at": "2021-05-25T00:29:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609822",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7207221ddc3da17663be31d51530b774a164373">f720722</a></td><td><code>build/pkgs/sagelib/src/tox.ini: Add factor nobuildisolation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c451b310026a0b6c973dd0b22efa2cbe784e6c98">c451b31</a></td><td><code>src/setup.cfg.m4 (install_requires): Add sage_conf</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/67002239dc377d82717c09a7c5c048a7161b51be">6700223</a></td><td><code>Merge tag '9.3.rc0' into t/30913/sagelib__add_setup_cfg__install_requires_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/04da2c6eb85566de6d49bf19803a061f4843c662">04da2c6</a></td><td><code>build/pkgs/ipywidgets: Patch out declaring install-requires of nbformat and jupyterlab-widgets</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/815c9446187ff6ee41ad6ab7a1a7b182ad2cd300">815c944</a></td><td><code>Merge #30913</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b06731c29501c81a35bba514ce11a957174732f0">b06731c</a></td><td><code>Remove Python 3.6 support from metadata and documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/57338c1cc0a835b9ac7fb027ffa99bb5f77a45fc">57338c1</a></td><td><code>Update numpy to 1.20.2, scipy to 1.6.2, networkx to 2.5.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ac49be02c68f399b1e38912fe3ff1c5c437b7aa3">ac49be0</a></td><td><code>build/pkgs/numpy: Update to 1.20.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02f68482174d6a4b49d0a8cd1e3575ee3c007fc5">02f6848</a></td><td><code>build/pkgs/scipy: Update to 1.6.3</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736">a661b6a</a></td><td><code>Merge #31008</code></td></tr></table>




---

archive/issue_comments_609823.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,8 +6,7 @@\n \n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n-- #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n-- `babel`\n+- #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n - `numpy`\n \n It does not include the actual upgrade to Python 3.10.\n``````\n",
    "created_at": "2021-05-25T00:46:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609823",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,8 +6,7 @@
 
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
-- #31856 Upgrade pyzmq to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
-- `babel`
+- #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
 - `numpy`
 
 It does not include the actual upgrade to Python 3.10.
``````




---

archive/issue_comments_609824.json:
```json
{
    "body": "**Changing commit** from \"[a661b6af08beb316810667a982969b6832196736](https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736)\" to \"[13121d7bd0cf191f61df589f3ff5715083094274](https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274)\".",
    "created_at": "2021-05-25T00:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609824",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a661b6af08beb316810667a982969b6832196736](https://github.com/sagemath/sagetrac-mirror/commit/a661b6af08beb316810667a982969b6832196736)" to "[13121d7bd0cf191f61df589f3ff5715083094274](https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274)".



---

archive/issue_comments_609825.json:
```json
{
    "body": "<a id='comment:19'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a64d920fe40843d8d48c5c4fa3b931dedf692c48\">a64d920</a></td><td><code>build/pkgs/babel: Update to 2.9.1, add upstream_url</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274\">13121d7</a></td><td><code>Merge #31856</code></td></tr></table>\n",
    "created_at": "2021-05-25T00:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609825",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a64d920fe40843d8d48c5c4fa3b931dedf692c48">a64d920</a></td><td><code>build/pkgs/babel: Update to 2.9.1, add upstream_url</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274">13121d7</a></td><td><code>Merge #31856</code></td></tr></table>




---

archive/issue_comments_609826.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,7 +2,7 @@\n Python 3.10.0 expected release: 2021-10-04.\n \n This ticket is for the patches necessary to support\n-Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.\n+Python 3.10 in addition to 3.9, 3.8, 3.7.\n \n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n``````\n",
    "created_at": "2021-08-09T20:08:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609826",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,7 +2,7 @@
 Python 3.10.0 expected release: 2021-10-04.
 
 This ticket is for the patches necessary to support
-Python 3.10 in addition to 3.9, 3.8, 3.7, 3.6.
+Python 3.10 in addition to 3.9, 3.8, 3.7.
 
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
``````




---

archive/issue_events_090380.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-11T21:20:26Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30766#event-90380"
}
```



---

archive/issue_events_090381.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-11T21:20:26Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30766#event-90381"
}
```



---

archive/issue_comments_609827.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n This is to support Python 3.10.\n-Python 3.10.0 expected release: 2021-10-04.\n+- Python 3.10.0rc1 released 2021-08-11.\n+- Python 3.10.0 expected release: 2021-10-04.\n \n This ticket is for the patches necessary to support\n Python 3.10 in addition to 3.9, 3.8, 3.7.\n``````\n",
    "created_at": "2021-08-12T02:38:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609827",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 This is to support Python 3.10.
-Python 3.10.0 expected release: 2021-10-04.
+- Python 3.10.0rc1 released 2021-08-11.
+- Python 3.10.0 expected release: 2021-10-04.
 
 This ticket is for the patches necessary to support
 Python 3.10 in addition to 3.9, 3.8, 3.7.
``````




---

archive/issue_comments_609828.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445, #31855, #31856, #31008\" to \"#30768, #31445, #31855\".",
    "created_at": "2021-08-12T02:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609828",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445, #31855, #31856, #31008" to "#30768, #31445, #31855".



---

archive/issue_comments_609829.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445, #31855\" to \"#30768, #31445, #31855, #32105\".",
    "created_at": "2021-08-25T19:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609829",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445, #31855" to "#30768, #31445, #31855, #32105".



---

archive/issue_comments_609830.json:
```json
{
    "body": "**Changing dependencies** from \"#30768, #31445, #31855, #32105\" to \"#32488, #30768, #31445, #31855, #32105\".",
    "created_at": "2021-09-15T23:56:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609830",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30768, #31445, #31855, #32105" to "#32488, #30768, #31445, #31855, #32105".



---

archive/issue_comments_609831.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31445, #31855, #32105\" to \"#32488, #30768, #31855, #32105\".",
    "created_at": "2021-09-15T23:57:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609831",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31445, #31855, #32105" to "#32488, #30768, #31855, #32105".



---

archive/issue_comments_609832.json:
```json
{
    "body": "<a id='comment:27'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bab5de79c1d6928279ff80085c5b11599661812c\">bab5de7</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/033366cd1f61bb303a7e9e29ab1512005a75930c\">033366c</a></td><td><code>build/pkgs/numpy: Update to 1.21.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6a3a39e1581af8183c13066d3a0bce5579b464c\">c6a3a39</a></td><td><code>build/pkgs/numpy: Update to 1.21.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d0ca161f17a8a4345c0147f5637057f4755629a8\">d0ca161</a></td><td><code>Merge #32488</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eced0de44c04143b791e925576a881b2ed7bd99c\">eced0de</a></td><td><code>Merge #32372</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edc435e122cd35abc280faad1ba0dca1fd107105\">edc435e</a></td><td><code>re-activate abc warnings</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f0cd750a8a6cbe5464a8670fd62e2e9af4d2db33\">f0cd750</a></td><td><code>Merge #30768</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/41f7f4ef9b3d4353fb4ca700d1f12e1bff919265\">41f7f4e</a></td><td><code>build/pkgs/gmpy2: Update to 2.1.0rc1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93\">731ccf1</a></td><td><code>Merge #31855</code></td></tr></table>\n",
    "created_at": "2021-09-15T23:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:27'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bab5de79c1d6928279ff80085c5b11599661812c">bab5de7</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/033366cd1f61bb303a7e9e29ab1512005a75930c">033366c</a></td><td><code>build/pkgs/numpy: Update to 1.21.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6a3a39e1581af8183c13066d3a0bce5579b464c">c6a3a39</a></td><td><code>build/pkgs/numpy: Update to 1.21.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d0ca161f17a8a4345c0147f5637057f4755629a8">d0ca161</a></td><td><code>Merge #32488</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eced0de44c04143b791e925576a881b2ed7bd99c">eced0de</a></td><td><code>Merge #32372</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edc435e122cd35abc280faad1ba0dca1fd107105">edc435e</a></td><td><code>re-activate abc warnings</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f0cd750a8a6cbe5464a8670fd62e2e9af4d2db33">f0cd750</a></td><td><code>Merge #30768</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/41f7f4ef9b3d4353fb4ca700d1f12e1bff919265">41f7f4e</a></td><td><code>build/pkgs/gmpy2: Update to 2.1.0rc1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93">731ccf1</a></td><td><code>Merge #31855</code></td></tr></table>




---

archive/issue_comments_609833.json:
```json
{
    "body": "**Changing commit** from \"[13121d7bd0cf191f61df589f3ff5715083094274](https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274)\" to \"[731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93](https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93)\".",
    "created_at": "2021-09-15T23:59:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[13121d7bd0cf191f61df589f3ff5715083094274](https://github.com/sagemath/sagetrac-mirror/commit/13121d7bd0cf191f61df589f3ff5715083094274)" to "[731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93](https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93)".



---

archive/issue_comments_609834.json:
```json
{
    "body": "**Changing commit** from \"[731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93](https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93)\" to \"[2749e672aafed52b4c4e83266c96145ae915d397](https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397)\".",
    "created_at": "2021-09-16T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609834",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93](https://github.com/sagemath/sagetrac-mirror/commit/731ccf174a7e3fd44aa145b1d03b4af2f2e4cc93)" to "[2749e672aafed52b4c4e83266c96145ae915d397](https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397)".



---

archive/issue_comments_609835.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397\">2749e67</a></td><td><code>pkgs/sage-setup/setup.cfg: Allow Python 3.10</code></td></tr></table>\n",
    "created_at": "2021-09-16T00:51:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609835",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397">2749e67</a></td><td><code>pkgs/sage-setup/setup.cfg: Allow Python 3.10</code></td></tr></table>




---

archive/issue_comments_609836.json:
```json
{
    "body": "<a id='comment:29'></a>\n\n```\n  [scipy-1.6.3]   ERROR: Package 'scipy' requires a different Python: 3.10.0 not in '<3.10,>=3.7'\n```",
    "created_at": "2021-09-16T00:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609836",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>

```
  [scipy-1.6.3]   ERROR: Package 'scipy' requires a different Python: 3.10.0 not in '<3.10,>=3.7'
```



---

archive/issue_comments_609837.json:
```json
{
    "body": "<a id='comment:30'></a>\n\n```\n  [pplpy-0.8.6]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/var/tmp/sage/build/pplpy-0.8.6/inst to /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1\n  [pplpy-0.8.6]   Running post-install script for pplpy-0.8.6.\n  [pplpy-0.8.6]   Traceback (most recent call last):\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/bin/sphinx-build\", line 5, in <module>\n  [pplpy-0.8.6]       from sphinx.cmd.build import main\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/cmd/build.py\", line 25, in <module>\n  [pplpy-0.8.6]       from sphinx.application import Sphinx\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/application.py\", line 31, in <module>\n  [pplpy-0.8.6]       from sphinx.config import Config\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/config.py\", line 21, in <module>\n  [pplpy-0.8.6]       from sphinx.util import logging\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/util/__init__.py\", line 41, in <module>\n  [pplpy-0.8.6]       from sphinx.util.typing import PathMatcher\n  [pplpy-0.8.6]     File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/util/typing.py\", line 37, in <module>\n  [pplpy-0.8.6]       from types import Union as types_Union\n  [pplpy-0.8.6]   ImportError: cannot import name 'Union' from 'types' (/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/types.py)\n  [pplpy-0.8.6]   make[5]: *** [html] Error 1\n  [pplpy-0.8.6]   cp: build/html/*: No such file or directory\n```",
    "created_at": "2021-09-16T00:53:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609837",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>

```
  [pplpy-0.8.6]   Copying package files from temporary location /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/var/tmp/sage/build/pplpy-0.8.6/inst to /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1
  [pplpy-0.8.6]   Running post-install script for pplpy-0.8.6.
  [pplpy-0.8.6]   Traceback (most recent call last):
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/bin/sphinx-build", line 5, in <module>
  [pplpy-0.8.6]       from sphinx.cmd.build import main
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/cmd/build.py", line 25, in <module>
  [pplpy-0.8.6]       from sphinx.application import Sphinx
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/application.py", line 31, in <module>
  [pplpy-0.8.6]       from sphinx.config import Config
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/config.py", line 21, in <module>
  [pplpy-0.8.6]       from sphinx.util import logging
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/util/__init__.py", line 41, in <module>
  [pplpy-0.8.6]       from sphinx.util.typing import PathMatcher
  [pplpy-0.8.6]     File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sphinx/util/typing.py", line 37, in <module>
  [pplpy-0.8.6]       from types import Union as types_Union
  [pplpy-0.8.6]   ImportError: cannot import name 'Union' from 'types' (/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/types.py)
  [pplpy-0.8.6]   make[5]: *** [html] Error 1
  [pplpy-0.8.6]   cp: build/html/*: No such file or directory
```



---

archive/issue_comments_609838.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32105\" to \"#32488, #30768, #31855, #32105, #32518\".",
    "created_at": "2021-09-16T01:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609838",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32105" to "#32488, #30768, #31855, #32105, #32518".



---

archive/issue_comments_609839.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [mkoeppe](#comment%3A29):\n> \n> ```\n>   [scipy-1.6.3]   ERROR: Package 'scipy' requires a different Python: 3.10.0 not in '<3.10,>=3.7'\n> ```\n\nIt does not look like a 1.6.4 is in preparation (https://github.com/scipy/scipy/commits/maintenance/1.6.x)... so I guess we'll have to do the update to 1.7.x in #32105",
    "created_at": "2021-09-16T01:15:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609839",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Replying to [mkoeppe](#comment%3A29):
> 
> ```
>   [scipy-1.6.3]   ERROR: Package 'scipy' requires a different Python: 3.10.0 not in '<3.10,>=3.7'
> ```

It does not look like a 1.6.4 is in preparation (https://github.com/scipy/scipy/commits/maintenance/1.6.x)... so I guess we'll have to do the update to 1.7.x in #32105



---

archive/issue_comments_609840.json:
```json
{
    "body": "<a id='comment:33'></a>\nWorkaround for the `scipy` install problem: `--ignore-requires-python` (new commits in #32492)",
    "created_at": "2021-09-16T01:44:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609840",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Workaround for the `scipy` install problem: `--ignore-requires-python` (new commits in #32492)



---

archive/issue_comments_609841.json:
```json
{
    "body": "<a id='comment:34'></a>\nReplying to [mkoeppe](#comment%3A30):\n> \n> ```\n>   [pplpy-0.8.6]       from types import Union as types_Union\n>   [pplpy-0.8.6]   ImportError: cannot import name 'Union' from 'types' (/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/types.py)\n>   [pplpy-0.8.6]   make[5]: *** [html] Error 1\n>   [pplpy-0.8.6]   cp: build/html/*: No such file or directory\n> ```\n\nFixed by the sphinx upgrade in #32518",
    "created_at": "2021-09-16T01:45:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609841",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
Replying to [mkoeppe](#comment%3A30):
> 
> ```
>   [pplpy-0.8.6]       from types import Union as types_Union
>   [pplpy-0.8.6]   ImportError: cannot import name 'Union' from 'types' (/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/types.py)
>   [pplpy-0.8.6]   make[5]: *** [html] Error 1
>   [pplpy-0.8.6]   cp: build/html/*: No such file or directory
> ```

Fixed by the sphinx upgrade in #32518



---

archive/issue_comments_609842.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32105, #32518\" to \"#32488, #30768, #31855, #32492, #32518\".",
    "created_at": "2021-09-16T01:47:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609842",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32105, #32518" to "#32488, #30768, #31855, #32492, #32518".



---

archive/issue_comments_609843.json:
```json
{
    "body": "<a id='comment:36'></a>\n`cvxopt` build fails, needs https://github.com/cvxopt/cvxopt/pull/190",
    "created_at": "2021-09-16T01:52:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609843",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
`cvxopt` build fails, needs https://github.com/cvxopt/cvxopt/pull/190



---

archive/issue_comments_609844.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32492, #32518\" to \"#32488, #30768, #31855, #32492, #32518, #32519\".",
    "created_at": "2021-09-16T02:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609844",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32492, #32518" to "#32488, #30768, #31855, #32492, #32518, #32519".



---

archive/issue_comments_609845.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [mkoeppe](#comment%3A36):\n> `cvxopt` build fails, needs https://github.com/cvxopt/cvxopt/pull/190\n\nThat's #32519",
    "created_at": "2021-09-16T02:00:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609845",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Replying to [mkoeppe](#comment%3A36):
> `cvxopt` build fails, needs https://github.com/cvxopt/cvxopt/pull/190

That's #32519



---

archive/issue_comments_609846.json:
```json
{
    "body": "**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/1239984523",
    "created_at": "2021-09-16T02:27:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609846",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** https://github.com/mkoeppe/sage/actions/runs/1239984523



---

archive/issue_comments_609847.json:
```json
{
    "body": "<a id='comment:40'></a>\nTests (via #30767) run at https://github.com/mkoeppe/sage/actions/runs/1239984523 -- all `-minimal` builds will use python 3.10.0rc1",
    "created_at": "2021-09-16T02:29:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Tests (via #30767) run at https://github.com/mkoeppe/sage/actions/runs/1239984523 -- all `-minimal` builds will use python 3.10.0rc1



---

archive/issue_comments_609848.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32492, #32518, #32519\" to \"#32488, #30768, #31855, #32492, #32518, #32519, #32520\".",
    "created_at": "2021-09-16T02:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609848",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32492, #32518, #32519" to "#32488, #30768, #31855, #32492, #32518, #32519, #32520".



---

archive/issue_comments_609849.json:
```json
{
    "body": "<a id='comment:42'></a>\n`distutils` deprecation -> #32565:\n\n```\nsage -t --long --random-seed=0 src/sage/plot/plot.py\n**********************************************************************\nFile \"src/sage/plot/plot.py\", line 513, in sage.plot.plot\nFailed example:\n    os.system(\"sage -c \\\"if 'matplotlib' in sys.modules: sys.exit(1)\\\"\") # long time\nExpected:\n    0\nGot:\n    /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/features/__init__.py:55: DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives\n      from distutils.errors import CCompilerError\n    0\n```",
    "created_at": "2021-09-16T03:34:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609849",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
`distutils` deprecation -> #32565:

```
sage -t --long --random-seed=0 src/sage/plot/plot.py
**********************************************************************
File "src/sage/plot/plot.py", line 513, in sage.plot.plot
Failed example:
    os.system("sage -c \"if 'matplotlib' in sys.modules: sys.exit(1)\"") # long time
Expected:
    0
Got:
    /Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/features/__init__.py:55: DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives
      from distutils.errors import CCompilerError
    0
```



---

archive/issue_comments_609850.json:
```json
{
    "body": "<a id='comment:43'></a>\nMany failures from improved error messages -> #32520\n\n```\nsage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py\n**********************************************************************\nFile \"src/sage/geometry/polyhedron/base.py\", line 214, in sage.geometry.polyhedron.base.Polyhedron_base.__init__\nFailed example:\n    p = Polyhedron_field(parent, Vrep, 'nonsense',  # py3\n                         Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')\nExpected:\n    Traceback (most recent call last):\n    ...\n    TypeError: _init_Hrepresentation() takes 3 positional arguments but 9 were given\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n...\n    TypeError: Polyhedron_field._init_Hrepresentation() takes 3 positional arguments but 9 were given\n**********************************************************************\n```",
    "created_at": "2021-09-16T03:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609850",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Many failures from improved error messages -> #32520

```
sage -t --long --random-seed=0 src/sage/geometry/polyhedron/base.py
**********************************************************************
File "src/sage/geometry/polyhedron/base.py", line 214, in sage.geometry.polyhedron.base.Polyhedron_base.__init__
Failed example:
    p = Polyhedron_field(parent, Vrep, 'nonsense',  # py3
                         Vrep_minimal=True, Hrep_minimal=True, pref_rep='Vrep')
Expected:
    Traceback (most recent call last):
    ...
    TypeError: _init_Hrepresentation() takes 3 positional arguments but 9 were given
Got:
    <BLANKLINE>
    Traceback (most recent call last):
...
    TypeError: Polyhedron_field._init_Hrepresentation() takes 3 positional arguments but 9 were given
**********************************************************************
```



---

archive/issue_comments_609851.json:
```json
{
    "body": "<a id='comment:44'></a>\nStricter parser:\n\n```\nsage -t --long --random-seed=0 src/sage/schemes/riemann_surfaces/riemann_surface.py\n**********************************************************************\nFile \"src/sage/schemes/riemann_surfaces/riemann_surface.py\", line 1393, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurface.make_zw_interpolator\nFailed example:\n    all(f(*g(i*0.1)).abs() < 1e-13for i in range(10))\nExpected:\n    True\nGot:\n    DeprecationWarning: invalid decimal literal\n    True\n```",
    "created_at": "2021-09-16T03:40:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Stricter parser:

```
sage -t --long --random-seed=0 src/sage/schemes/riemann_surfaces/riemann_surface.py
**********************************************************************
File "src/sage/schemes/riemann_surfaces/riemann_surface.py", line 1393, in sage.schemes.riemann_surfaces.riemann_surface.RiemannSurface.make_zw_interpolator
Failed example:
    all(f(*g(i*0.1)).abs() < 1e-13for i in range(10))
Expected:
    True
Got:
    DeprecationWarning: invalid decimal literal
    True
```



---

archive/issue_comments_609852.json:
```json
{
    "body": "<a id='comment:45'></a>\nSage numbers no longer accepted:\n\n```\nsage -t --long --random-seed=0 src/sage/tests/cmdline.py\n**********************************************************************\nFile \"src/sage/tests/cmdline.py\", line 104, in sage.tests.cmdline.test_executable\nFailed example:\n    (out, err, ret) = test_executable([\"sleep\", \"1\"], timeout=0.1)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: timeout in test_executable()\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py\", line 704, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1098, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.cmdline.test_executable[5]>\", line 1, in <module>\n        (out, err, ret) = test_executable([\"sleep\", \"1\"], timeout=RealNumber('0.1'))\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/tests/cmdline.py\", line 769, in test_executable\n        rlist = select.select(rfd, [], [], timeout)[0]\n    TypeError: timeout must be a float or None\n```\n\n```\nsage -t --long --random-seed=0 src/sage_docbuild/utils.py\n**********************************************************************\nFile \"src/sage_docbuild/utils.py\", line 91, in sage_docbuild.utils\nFailed example:\n    build_many(target, range(8), processes=8)\nExpected:\n    Traceback (most recent call last):\n    ...\n    ZeroDivisionError: rational division by zero\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py\", line 704, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1098, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.utils[6]>\", line 1, in <module>\n        build_many(target, range(Integer(8)), processes=Integer(8))\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage_docbuild/utils.py\", line 289, in build_many\n        raise worker_exc.original_exception\n    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer\n```",
    "created_at": "2021-09-16T03:40:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609852",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Sage numbers no longer accepted:

```
sage -t --long --random-seed=0 src/sage/tests/cmdline.py
**********************************************************************
File "src/sage/tests/cmdline.py", line 104, in sage.tests.cmdline.test_executable
Failed example:
    (out, err, ret) = test_executable(["sleep", "1"], timeout=0.1)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: timeout in test_executable()
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py", line 704, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py", line 1098, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.cmdline.test_executable[5]>", line 1, in <module>
        (out, err, ret) = test_executable(["sleep", "1"], timeout=RealNumber('0.1'))
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/tests/cmdline.py", line 769, in test_executable
        rlist = select.select(rfd, [], [], timeout)[0]
    TypeError: timeout must be a float or None
```

```
sage -t --long --random-seed=0 src/sage_docbuild/utils.py
**********************************************************************
File "src/sage_docbuild/utils.py", line 91, in sage_docbuild.utils
Failed example:
    build_many(target, range(8), processes=8)
Expected:
    Traceback (most recent call last):
    ...
    ZeroDivisionError: rational division by zero
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py", line 704, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage/doctest/forker.py", line 1098, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.utils[6]>", line 1, in <module>
        build_many(target, range(Integer(8)), processes=Integer(8))
      File "/Users/mkoeppe/s/sage/sage-rebasing/local/var/lib/sage/venv-python3.10.0rc1/lib/python3.10/site-packages/sage_docbuild/utils.py", line 289, in build_many
        raise worker_exc.original_exception
    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer
```



---

archive/issue_comments_609853.json:
```json
{
    "body": "<a id='comment:46'></a>\ninspect:\n\n```\nsage -t --long --random-seed=0 src/sage/misc/sageinspect.py\n**********************************************************************\nFile \"src/sage/misc/sageinspect.py\", line 1561, in sage.misc.sageinspect.sage_getargspec\nFailed example:\n    shell.run_cell('f??')\nExpected:\n    ...the source code string...\nGot:\n    ---------------------------------------------------------------------------\n    OSError                                   Traceback (most recent call last)\n```",
    "created_at": "2021-09-16T03:45:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>
inspect:

```
sage -t --long --random-seed=0 src/sage/misc/sageinspect.py
**********************************************************************
File "src/sage/misc/sageinspect.py", line 1561, in sage.misc.sageinspect.sage_getargspec
Failed example:
    shell.run_cell('f??')
Expected:
    ...the source code string...
Got:
    ---------------------------------------------------------------------------
    OSError                                   Traceback (most recent call last)
```



---

archive/issue_comments_609854.json:
```json
{
    "body": "<a id='comment:47'></a>\n\n```\nsage -t --long --random-seed=0 src/sage/categories/loop_crystals.py\n**********************************************************************\nFile \"src/sage/categories/loop_crystals.py\", line 115, in sage.categories.loop_crystals.LoopCrystals.ParentMethods.digraph\nFailed example:\n    G.latex_options()  # optional - dot2tex\nExpected:\n    LaTeX options for Digraph on 29 vertices:\n    {...'edge_options': <function ... at ...>...}\nGot:\n    LaTeX options for Digraph on 29 vertices: {}\n```",
    "created_at": "2021-09-16T03:45:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609854",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>

```
sage -t --long --random-seed=0 src/sage/categories/loop_crystals.py
**********************************************************************
File "src/sage/categories/loop_crystals.py", line 115, in sage.categories.loop_crystals.LoopCrystals.ParentMethods.digraph
Failed example:
    G.latex_options()  # optional - dot2tex
Expected:
    LaTeX options for Digraph on 29 vertices:
    {...'edge_options': <function ... at ...>...}
Got:
    LaTeX options for Digraph on 29 vertices: {}
```



---

archive/issue_comments_609855.json:
```json
{
    "body": "<a id='comment:48'></a>\n\n```\nsage -t --long --random-seed=0 src/sage/cpython/atexit.pyx\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 61, in sage.cpython.atexit\nFailed example:\n    with restore_atexit(clear=True):\n        atexit._run_exitfuncs()  # Should be none registered\n        atexit.register(handler, 1, 2, c=3)\n        with restore_atexit():\n            atexit._run_exitfuncs()  # Run just registered handler\n        atexit._run_exitfuncs()  # Handler should be run again\nExpected:\n    <function handler at 0x...>\n    ((1, 2), {'c': 3})\n    ((1, 2), {'c': 3})\nGot:\n    <function handler at 0x357023a30>\n    ((1, 2), {'c': 3})\n```",
    "created_at": "2021-09-16T05:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>

```
sage -t --long --random-seed=0 src/sage/cpython/atexit.pyx
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 61, in sage.cpython.atexit
Failed example:
    with restore_atexit(clear=True):
        atexit._run_exitfuncs()  # Should be none registered
        atexit.register(handler, 1, 2, c=3)
        with restore_atexit():
            atexit._run_exitfuncs()  # Run just registered handler
        atexit._run_exitfuncs()  # Handler should be run again
Expected:
    <function handler at 0x...>
    ((1, 2), {'c': 3})
    ((1, 2), {'c': 3})
Got:
    <function handler at 0x357023a30>
    ((1, 2), {'c': 3})
```



---

archive/issue_comments_609856.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32492, #32518, #32519, #32520\" to \"#32488, #30768, #31855, #32492, #32518, #32519, #32520, #32565\".",
    "created_at": "2021-09-25T21:07:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609856",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32492, #32518, #32519, #32520" to "#32488, #30768, #31855, #32492, #32518, #32519, #32520, #32565".



---

archive/issue_comments_609857.json:
```json
{
    "body": "**Changing commit** from \"[2749e672aafed52b4c4e83266c96145ae915d397](https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397)\" to \"[ab265626cec055eda65b0f79f215bae8c8119ac3](https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3)\".",
    "created_at": "2021-09-28T19:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2749e672aafed52b4c4e83266c96145ae915d397](https://github.com/sagemath/sagetrac-mirror/commit/2749e672aafed52b4c4e83266c96145ae915d397)" to "[ab265626cec055eda65b0f79f215bae8c8119ac3](https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3)".



---

archive/issue_comments_609858.json:
```json
{
    "body": "<a id='comment:50'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3\">ab26562</a></td><td><code>Merge tag '9.5.beta2' into t/30766/support_python_3_10</code></td></tr></table>\n",
    "created_at": "2021-09-28T19:15:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3">ab26562</a></td><td><code>Merge tag '9.5.beta2' into t/30766/support_python_3_10</code></td></tr></table>




---

archive/issue_comments_609859.json:
```json
{
    "body": "**Changing dependencies** from \"#32488, #30768, #31855, #32492, #32518, #32519, #32520, #32565\" to \"#31855, #32519, #32520, #32565\".",
    "created_at": "2021-09-28T19:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609859",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#32488, #30768, #31855, #32492, #32518, #32519, #32520, #32565" to "#31855, #32519, #32520, #32565".



---

archive/issue_comments_609860.json:
```json
{
    "body": "**Changing commit** from \"[ab265626cec055eda65b0f79f215bae8c8119ac3](https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3)\" to \"[bc2b01d13eaa6f2a4904732d81b440e9aa1f9201](https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201)\".",
    "created_at": "2021-09-28T19:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[ab265626cec055eda65b0f79f215bae8c8119ac3](https://github.com/sagemath/sagetrac-mirror/commit/ab265626cec055eda65b0f79f215bae8c8119ac3)" to "[bc2b01d13eaa6f2a4904732d81b440e9aa1f9201](https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201)".



---

archive/issue_comments_609861.json:
```json
{
    "body": "<a id='comment:52'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/964bf649e5436fc3a8ff78ae8c21dcba3ae18c27\">964bf64</a></td><td><code>git grep -l 'TypeError: .*() takes' | xargs sed -i.bak 's/TypeError: \\(.*\\)() takes/TypeError: ...\\1() takes/'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/247a077ccf2f50276fac1550d7579cc1742e50d8\">247a077</a></td><td><code>git grep -l 'TypeError: .*() got an unexpected' | xargs sed -i.bak 's/TypeError: \\(.*\\)() got an unexpected/TypeError: ...\\1() got an unexpected/'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82d9329a46c216015058fb115a9cbe8593528dda\">82d9329</a></td><td><code>git grep -l 'TypeError: .*() missing' | xargs sed -i.bak 's/TypeError: \\(.*\\)() missing/TypeError: ...\\1() missing/'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e80b828810b1f4a9ffc97444939bec63a57b0575\">e80b828</a></td><td><code>git grep -l 'TypeError: float() argument must be.*' | xargs sed -i.bak 's/TypeError: float() argument must be.*/TypeError: float() argument must be a string or a... number.../'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98a1cee6371a648d4497907da168d2823ab0564f\">98a1cee</a></td><td><code>git grep -l 'AttributeError: can.* set attribute.*' | xargs sed -i.bak 's/AttributeError: can.* set attribute.*/AttributeError: can...t set attribute.../'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/851114196ee741768ae0ffeb05ab6f451481a3ab\">8511141</a></td><td><code>git grep -l 'SyntaxError: invalid.*' | xargs sed -i.bak 's/SyntaxError: invalid.*/SyntaxError: invalid .../'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/65c586b0c2632ec8e35b29dba5488ea0db7e957d\">65c586b</a></td><td><code>Fix 2 more doctests to accept exception messages reworded in python 3.10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/288bc84a6e1580ed554f54679c3c930dcb09f767\">288bc84</a></td><td><code>Merge branch 'public/32521' of git://trac.sagemath.org/sage into t/32520/fix_doctests_to_accept_exception_messages_reworded_in_python_3_10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/68d07f8ddf10132f116c2679264636675beda02c\">68d07f8</a></td><td><code>Merge tag '9.5.beta2' into t/32520/fix_doctests_to_accept_exception_messages_reworded_in_python_3_10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201\">bc2b01d</a></td><td><code>Merge #32520</code></td></tr></table>\n",
    "created_at": "2021-09-28T19:26:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/964bf649e5436fc3a8ff78ae8c21dcba3ae18c27">964bf64</a></td><td><code>git grep -l 'TypeError: .*() takes' | xargs sed -i.bak 's/TypeError: \(.*\)() takes/TypeError: ...\1() takes/'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/247a077ccf2f50276fac1550d7579cc1742e50d8">247a077</a></td><td><code>git grep -l 'TypeError: .*() got an unexpected' | xargs sed -i.bak 's/TypeError: \(.*\)() got an unexpected/TypeError: ...\1() got an unexpected/'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82d9329a46c216015058fb115a9cbe8593528dda">82d9329</a></td><td><code>git grep -l 'TypeError: .*() missing' | xargs sed -i.bak 's/TypeError: \(.*\)() missing/TypeError: ...\1() missing/'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e80b828810b1f4a9ffc97444939bec63a57b0575">e80b828</a></td><td><code>git grep -l 'TypeError: float() argument must be.*' | xargs sed -i.bak 's/TypeError: float() argument must be.*/TypeError: float() argument must be a string or a... number.../'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98a1cee6371a648d4497907da168d2823ab0564f">98a1cee</a></td><td><code>git grep -l 'AttributeError: can.* set attribute.*' | xargs sed -i.bak 's/AttributeError: can.* set attribute.*/AttributeError: can...t set attribute.../'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/851114196ee741768ae0ffeb05ab6f451481a3ab">8511141</a></td><td><code>git grep -l 'SyntaxError: invalid.*' | xargs sed -i.bak 's/SyntaxError: invalid.*/SyntaxError: invalid .../'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/65c586b0c2632ec8e35b29dba5488ea0db7e957d">65c586b</a></td><td><code>Fix 2 more doctests to accept exception messages reworded in python 3.10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/288bc84a6e1580ed554f54679c3c930dcb09f767">288bc84</a></td><td><code>Merge branch 'public/32521' of git://trac.sagemath.org/sage into t/32520/fix_doctests_to_accept_exception_messages_reworded_in_python_3_10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/68d07f8ddf10132f116c2679264636675beda02c">68d07f8</a></td><td><code>Merge tag '9.5.beta2' into t/32520/fix_doctests_to_accept_exception_messages_reworded_in_python_3_10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201">bc2b01d</a></td><td><code>Merge #32520</code></td></tr></table>




---

archive/issue_comments_609862.json:
```json
{
    "body": "**Changing commit** from \"[bc2b01d13eaa6f2a4904732d81b440e9aa1f9201](https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201)\" to \"[c73bc9735dc93e981836e626ff865cb98b364740](https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740)\".",
    "created_at": "2021-09-28T19:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[bc2b01d13eaa6f2a4904732d81b440e9aa1f9201](https://github.com/sagemath/sagetrac-mirror/commit/bc2b01d13eaa6f2a4904732d81b440e9aa1f9201)" to "[c73bc9735dc93e981836e626ff865cb98b364740](https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740)".



---

archive/issue_comments_609863.json:
```json
{
    "body": "<a id='comment:53'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/20e60f26d38ced0005472e45661b968a8ab53c91\">20e60f2</a></td><td><code>sage.features.Executable: Remove use of distutils</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8c763f4505701d48ee512f5a2e53e29096eeecce\">8c763f4</a></td><td><code>sage.features.CCompilerError: Move global import from distutils.errors into method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/30ea064fb58ee114360d6060183ba2802325a1a1\">30ea064</a></td><td><code>Merge #32565</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/380b63a4257b8fdc9723c70a03677280d1fe0aca\">380b63a</a></td><td><code>build/pkgs/cvxopt: Update to 1.2.7 for Python 3.10 compatibility</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740\">c73bc97</a></td><td><code>Merge #32519</code></td></tr></table>\n",
    "created_at": "2021-09-28T19:27:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:53'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/20e60f26d38ced0005472e45661b968a8ab53c91">20e60f2</a></td><td><code>sage.features.Executable: Remove use of distutils</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8c763f4505701d48ee512f5a2e53e29096eeecce">8c763f4</a></td><td><code>sage.features.CCompilerError: Move global import from distutils.errors into method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/30ea064fb58ee114360d6060183ba2802325a1a1">30ea064</a></td><td><code>Merge #32565</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/380b63a4257b8fdc9723c70a03677280d1fe0aca">380b63a</a></td><td><code>build/pkgs/cvxopt: Update to 1.2.7 for Python 3.10 compatibility</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740">c73bc97</a></td><td><code>Merge #32519</code></td></tr></table>




---

archive/issue_comments_609864.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n-This is to support Python 3.10.\n-- Python 3.10.0rc1 released 2021-08-11.\n-- Python 3.10.0 expected release: 2021-10-04.\n+This is to support Python 3.10, which was released on 2021-10-04.\n+https://docs.python.org/3.10/whatsnew/changelog.html#changelog\n \n This ticket is for the patches necessary to support\n Python 3.10 in addition to 3.9, 3.8, 3.7.\n``````\n",
    "created_at": "2021-10-05T05:36:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609864",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
-This is to support Python 3.10.
-- Python 3.10.0rc1 released 2021-08-11.
-- Python 3.10.0 expected release: 2021-10-04.
+This is to support Python 3.10, which was released on 2021-10-04.
+https://docs.python.org/3.10/whatsnew/changelog.html#changelog
 
 This ticket is for the patches necessary to support
 Python 3.10 in addition to 3.9, 3.8, 3.7.
``````




---

archive/issue_comments_609865.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,7 +7,8 @@\n - needs Cython 0.29.23 (#31445)\n - #31855 Patch/upgrade `gmpy2` to add python 3.10 support\n - #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n-- `numpy`\n+- #32815 `numpy`\n+- #32837 `cffi`: Update to 1.15.0\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-11-08T05:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609865",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,7 +7,8 @@
 - needs Cython 0.29.23 (#31445)
 - #31855 Patch/upgrade `gmpy2` to add python 3.10 support
 - #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
-- `numpy`
+- #32815 `numpy`
+- #32837 `cffi`: Update to 1.15.0
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609866.json:
```json
{
    "body": "<a id='comment:58'></a>\nI'm testing c73bc97 using system python 3.10 (void linux).\n\nCompilation succeeds. Then running `./sage` gives:\n\n```\n/opt/sage/sage-git/local/lib/python3.10/site-packages/prompt_toolkit/application/application.py:882: DeprecationWarning: There is no current event loop\n  loop = get_event_loop()\nsage: ...\n```\nRunning `./sage -tp 8 --all` gives:\n- lots of crashes apparently related to cysignals; stack trace starts with\n\n```\n/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7e30)[0x7f2c06dbae30]\n/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7ee9)[0x7f2c06dbaee9]\n/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0xafd5)[0x7f2c06dbdfd5]\n/usr/lib/libc.so.6(+0x3d000)[0x7f2c07fcb000]\n/opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5131)[0x7f2c073e1131]\n/opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5932)[0x7f2c073e1932]\n/usr/lib/libpython3.10.so.1.0(+0xec50e)[0x7f2c0824050e]\n/usr/lib/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x47d8)[0x7f2c081bdd68]\n...\n```\n- more deprecation warnings\n\n```\n/opt/sage/sage-git/local/bin/cysignals-CSI:44: DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives\n```\n\nAll I'm doing is, starting with a clean copy of c73bc97\n\n```\n$ ./bootstrap\n$ ./configure\n$ make build -j12\n$ ./sage -tp 8 --all\n```\n\nI have logs, let me know if you need more info.\n\nMy goal is packaging sage for void linux, but it's already migrated to python 3.10 so this is a blocker.",
    "created_at": "2021-11-09T13:09:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609866",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:58'></a>
I'm testing c73bc97 using system python 3.10 (void linux).

Compilation succeeds. Then running `./sage` gives:

```
/opt/sage/sage-git/local/lib/python3.10/site-packages/prompt_toolkit/application/application.py:882: DeprecationWarning: There is no current event loop
  loop = get_event_loop()
sage: ...
```
Running `./sage -tp 8 --all` gives:
- lots of crashes apparently related to cysignals; stack trace starts with

```
/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7e30)[0x7f2c06dbae30]
/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7ee9)[0x7f2c06dbaee9]
/opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0xafd5)[0x7f2c06dbdfd5]
/usr/lib/libc.so.6(+0x3d000)[0x7f2c07fcb000]
/opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5131)[0x7f2c073e1131]
/opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5932)[0x7f2c073e1932]
/usr/lib/libpython3.10.so.1.0(+0xec50e)[0x7f2c0824050e]
/usr/lib/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x47d8)[0x7f2c081bdd68]
...
```
- more deprecation warnings

```
/opt/sage/sage-git/local/bin/cysignals-CSI:44: DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives
```

All I'm doing is, starting with a clean copy of c73bc97

```
$ ./bootstrap
$ ./configure
$ make build -j12
$ ./sage -tp 8 --all
```

I have logs, let me know if you need more info.

My goal is packaging sage for void linux, but it's already migrated to python 3.10 so this is a blocker.



---

archive/issue_comments_609867.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,7 @@\n - #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 \n - #32815 `numpy`\n - #32837 `cffi`: Update to 1.15.0\n+- #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-11-10T22:14:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609867",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,7 @@
 - #31856 Upgrade `pyzmq`, `babel` - to fix `error: implicit declaration of function 'PyObject_AsWriteBuffer' is invalid in C99` with pyzmq-19.0.2 
 - #32815 `numpy`
 - #32837 `cffi`: Update to 1.15.0
+- #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609868.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n - #32815 `numpy`\n - #32837 `cffi`: Update to 1.15.0\n - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)\n+- #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-11-10T22:58:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609868",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 - #32815 `numpy`
 - #32837 `cffi`: Update to 1.15.0
 - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)
+- #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609869.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -11,6 +11,7 @@\n - #32837 `cffi`: Update to 1.15.0\n - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)\n - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3\n+- #31295 Meta-ticket: Replace imports from deprecated `distutils`\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-11-13T20:11:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609869",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -11,6 +11,7 @@
 - #32837 `cffi`: Update to 1.15.0
 - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)
 - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3
+- #31295 Meta-ticket: Replace imports from deprecated `distutils`
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609870.json:
```json
{
    "body": "<a id='comment:62'></a>\nAfter updating the last cysignals (unreleased 1.11.0, needed for Fedora 35) I put below the failed tests. I get some errors as in previous posts (I needed to restart several times due to many cysignal crashes); by the way `make ptestlong` produced many such crashes while `sage -t -a -p8` worked better. \n\nThe prompt_toolkit warning disappears with the 3.0.22 version.\n\n\n```\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/log.py  # 3 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/other.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/interfaces/fricas.py  # 110 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/misc/sageinspect.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/integration/external.py  # 13 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/integration/integral.py  # 3 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/tests/cmdline.py  # Timed out\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/calculus/calculus.py  # 6 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/calculus/desolvers.py  # 13 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/combinat/posets/posets.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/rings/real_mpfr.pyx  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/gamma.py  # 4 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/matrix/matrix1.pyx  # 4 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/error.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/plot/colors.py  # 5 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/geometry/hyperbolic_space/hyperbolic_model.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/expression_conversions.py  # 16 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/generalized.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/schemes/elliptic_curves/lseries_ell.py  # 2 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/lfunctions/pari.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/structure/unique_representation.py  # 1 doctest failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage_docbuild/utils.py  # 2 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/libs/giac/__init__.py  # 7 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/lfunctions/lcalc.py  # 2 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/callable.py  # 5 doctests failed\nsage -t --random-seed=186690325287508787735378550154836726084 src/sage/cpython/atexit.pyx  # 6 doctests failed\n```",
    "created_at": "2021-11-24T22:57:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609870",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:62'></a>
After updating the last cysignals (unreleased 1.11.0, needed for Fedora 35) I put below the failed tests. I get some errors as in previous posts (I needed to restart several times due to many cysignal crashes); by the way `make ptestlong` produced many such crashes while `sage -t -a -p8` worked better. 

The prompt_toolkit warning disappears with the 3.0.22 version.


```
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/log.py  # 3 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/other.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/interfaces/fricas.py  # 110 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/misc/sageinspect.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/schemes/riemann_surfaces/riemann_surface.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/integration/external.py  # 13 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/integration/integral.py  # 3 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/tests/cmdline.py  # Timed out
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/calculus/calculus.py  # 6 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/calculus/desolvers.py  # 13 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/combinat/posets/posets.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/rings/real_mpfr.pyx  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/gamma.py  # 4 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/matrix/matrix1.pyx  # 4 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/error.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/plot/colors.py  # 5 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/geometry/hyperbolic_space/hyperbolic_model.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/expression_conversions.py  # 16 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/functions/generalized.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/schemes/elliptic_curves/lseries_ell.py  # 2 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/lfunctions/pari.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/structure/unique_representation.py  # 1 doctest failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage_docbuild/utils.py  # 2 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/libs/giac/__init__.py  # 7 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/lfunctions/lcalc.py  # 2 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/symbolic/callable.py  # 5 doctests failed
sage -t --random-seed=186690325287508787735378550154836726084 src/sage/cpython/atexit.pyx  # 6 doctests failed
```



---

archive/issue_comments_609871.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,6 +12,7 @@\n - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)\n - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3\n - #31295 Meta-ticket: Replace imports from deprecated `distutils`\n+- #32930 IPython/Jupyter upgrade for python 3.10 support\n \n It does not include the actual upgrade to Python 3.10.\n To test, see #30767.\n``````\n",
    "created_at": "2021-11-25T03:08:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609871",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,6 +12,7 @@
 - #32852 Update `traitlets` to 5.1.1 (for python 3.9.8, 3.10)
 - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3
 - #31295 Meta-ticket: Replace imports from deprecated `distutils`
+- #32930 IPython/Jupyter upgrade for python 3.10 support
 
 It does not include the actual upgrade to Python 3.10.
 To test, see #30767.
``````




---

archive/issue_comments_609872.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [tornaria](#comment%3A58):\n> Running `./sage -tp 8 --all` gives:\n> - lots of crashes apparently related to cysignals; stack trace starts with\n> \n> ```\n> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7e30)[0x7f2c06dbae30]\n> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7ee9)[0x7f2c06dbaee9]\n> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0xafd5)[0x7f2c06dbdfd5]\n> /usr/lib/libc.so.6(+0x3d000)[0x7f2c07fcb000]\n> /opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5131)[0x7f2c073e1131]\n> /opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5932)[0x7f2c073e1932]\n> /usr/lib/libpython3.10.so.1.0(+0xec50e)[0x7f2c0824050e]\n> /usr/lib/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x47d8)[0x7f2c081bdd68]\n> ...\n> ```\n\n\nJust updated to 3.10 and am also seeing this when running doctests, but not 100% of the times. Any idea where this comes from?",
    "created_at": "2021-12-10T19:13:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609872",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:64'></a>
Replying to [tornaria](#comment%3A58):
> Running `./sage -tp 8 --all` gives:
> - lots of crashes apparently related to cysignals; stack trace starts with
> 
> ```
> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7e30)[0x7f2c06dbae30]
> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0x7ee9)[0x7f2c06dbaee9]
> /opt/sage/sage-git/local/lib/python3.10/site-packages/cysignals/signals.cpython-310-x86_64-linux-gnu.so(+0xafd5)[0x7f2c06dbdfd5]
> /usr/lib/libc.so.6(+0x3d000)[0x7f2c07fcb000]
> /opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5131)[0x7f2c073e1131]
> /opt/sage/sage-git/local/lib/python3.10/site-packages/sage/cpython/atexit.cpython-310-x86_64-linux-gnu.so(+0x5932)[0x7f2c073e1932]
> /usr/lib/libpython3.10.so.1.0(+0xec50e)[0x7f2c0824050e]
> /usr/lib/libpython3.10.so.1.0(_PyEval_EvalFrameDefault+0x47d8)[0x7f2c081bdd68]
> ...
> ```


Just updated to 3.10 and am also seeing this when running doctests, but not 100% of the times. Any idea where this comes from?



---

archive/issue_comments_609873.json:
```json
{
    "body": "<a id='comment:65'></a>\nThe crash is happening in the `__Pyx_INCREF` call here\n\n```\n    /* \"sage/cpython/atexit.pyx\":188\n *         else:\n *             kwargs = {}\n *         exithandlers.append((<object>callback.func,             # <<<<<<<<<<<<<<\n *                                 <object>callback.args,\n *                                 kwargs))\n */\n    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 188, __pyx_L1_error)\n    __Pyx_GOTREF(__pyx_t_1);\n    __Pyx_INCREF(((PyObject *)__pyx_v_callback.func));\n    __Pyx_GIVEREF(((PyObject *)__pyx_v_callback.func));\n    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_callback.func));\n```",
    "created_at": "2021-12-10T20:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609873",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:65'></a>
The crash is happening in the `__Pyx_INCREF` call here

```
    /* "sage/cpython/atexit.pyx":188
 *         else:
 *             kwargs = {}
 *         exithandlers.append((<object>callback.func,             # <<<<<<<<<<<<<<
 *                                 <object>callback.args,
 *                                 kwargs))
 */
    __pyx_t_1 = PyTuple_New(3); if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 188, __pyx_L1_error)
    __Pyx_GOTREF(__pyx_t_1);
    __Pyx_INCREF(((PyObject *)__pyx_v_callback.func));
    __Pyx_GIVEREF(((PyObject *)__pyx_v_callback.func));
    PyTuple_SET_ITEM(__pyx_t_1, 0, ((PyObject *)__pyx_v_callback.func));
```



---

archive/issue_comments_609874.json:
```json
{
    "body": "<a id='comment:66'></a>\nUpdate: the segfault seems to happen when running tests iff there is another sage-runtests process running. After interrupting the doctests, the `sage-runtests` process takes a long time to get cleaned up, and if you try to run tests again in the meantime you will get the segfault.",
    "created_at": "2021-12-11T09:57:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609874",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:66'></a>
Update: the segfault seems to happen when running tests iff there is another sage-runtests process running. After interrupting the doctests, the `sage-runtests` process takes a long time to get cleaned up, and if you try to run tests again in the meantime you will get the segfault.



---

archive/issue_comments_609875.json:
```json
{
    "body": "<a id='comment:67'></a>\nAfter #33013, the only remaining issues in `sagelib` are\n\n```\nsage -t --long /usr/lib/python3.10/site-packages/sage/tests/cmdline.py  # 3 doctests failed\nsage -t --long /usr/lib/python3.10/site-packages/sage/doctest/test.py  # 16 doctests failed\n```\nwhich are caused by the spawned `sage-runtests` child processes segfaulting as mentioned above, and\n\n```\nsage -t --long /usr/lib/python3.10/site-packages/sage/cpython/atexit.pyx  # 6 doctests failed\n```\nwhich are likely related.",
    "created_at": "2021-12-12T09:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609875",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:67'></a>
After #33013, the only remaining issues in `sagelib` are

```
sage -t --long /usr/lib/python3.10/site-packages/sage/tests/cmdline.py  # 3 doctests failed
sage -t --long /usr/lib/python3.10/site-packages/sage/doctest/test.py  # 16 doctests failed
```
which are caused by the spawned `sage-runtests` child processes segfaulting as mentioned above, and

```
sage -t --long /usr/lib/python3.10/site-packages/sage/cpython/atexit.pyx  # 6 doctests failed
```
which are likely related.



---

archive/issue_comments_609876.json:
```json
{
    "body": "**Changing dependencies** from \"#31855, #32519, #32520, #32565\" to \"#31855, #32519, #32520, #32565, #33013\".",
    "created_at": "2021-12-12T09:13:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609876",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing dependencies** from "#31855, #32519, #32520, #32565" to "#31855, #32519, #32520, #32565, #33013".



---

archive/issue_comments_609877.json:
```json
{
    "body": "<a id='comment:68'></a>\nIndeed, running tests in parallel breaks badly but running them *not* in parallel goes very far.\n\nThis is what I got with `./sage -t --all`:\n\n```\n----------------------------------------------------------------------\nsage -t --random-seed=231622868948624456778064911551695162592 src/sage/tests/cmdline.py  # 5 doctests failed\nsage -t --random-seed=231622868948624456778064911551695162592 src/sage/quivers/algebra_elements.pxi  # 1 doctest failed\nsage -t --random-seed=231622868948624456778064911551695162592 src/sage/cpython/atexit.pyx  # 6 doctests failed\nsage -t --random-seed=231622868948624456778064911551695162592 src/sage/interfaces/sage0.py  # 1 doctest failed\nsage -t --random-seed=231622868948624456778064911551695162592 src/sage_docbuild/utils.py  # 2 doctests failed\n----------------------------------------------------------------------\n```\n\nMaybe I missed some patch, e.g a few failures are distutils deprecation warnings in `.../venv-python3.10/lib/python3.10/site-packages/matplotlib/__init__.py:88`.\n\nWhat I used is beta8 + #30766 + #33013. What did I miss?\n\n\nMaybe someone can rebase on top of beta8 so we all work on top of a common point?\n\n---\n\nAs for the failure: it seems the atexit module internals have changed in python3.10, a quick look seems to suggest that per-module state was changed to per-thread state; `sage.cpython.atexit` is probably doing something wrong which manifests when there is more than one thread.\n\nOn the positive side, now the structs and some functions are declared in (internal) headers so it might be possible to implement this in a more robust way (formerly everything was in a C file and it seems `sage.python.atexit` copied a bunch of stuff which now may be incorrect).\n\nWhat are the chances that sagemath 9.5 can support system python 3.10? I've been working to get sagemath into voidlinux but they won't accept a vendored python.",
    "created_at": "2021-12-14T13:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609877",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:68'></a>
Indeed, running tests in parallel breaks badly but running them *not* in parallel goes very far.

This is what I got with `./sage -t --all`:

```
----------------------------------------------------------------------
sage -t --random-seed=231622868948624456778064911551695162592 src/sage/tests/cmdline.py  # 5 doctests failed
sage -t --random-seed=231622868948624456778064911551695162592 src/sage/quivers/algebra_elements.pxi  # 1 doctest failed
sage -t --random-seed=231622868948624456778064911551695162592 src/sage/cpython/atexit.pyx  # 6 doctests failed
sage -t --random-seed=231622868948624456778064911551695162592 src/sage/interfaces/sage0.py  # 1 doctest failed
sage -t --random-seed=231622868948624456778064911551695162592 src/sage_docbuild/utils.py  # 2 doctests failed
----------------------------------------------------------------------
```

Maybe I missed some patch, e.g a few failures are distutils deprecation warnings in `.../venv-python3.10/lib/python3.10/site-packages/matplotlib/__init__.py:88`.

What I used is beta8 + #30766 + #33013. What did I miss?


Maybe someone can rebase on top of beta8 so we all work on top of a common point?

---

As for the failure: it seems the atexit module internals have changed in python3.10, a quick look seems to suggest that per-module state was changed to per-thread state; `sage.cpython.atexit` is probably doing something wrong which manifests when there is more than one thread.

On the positive side, now the structs and some functions are declared in (internal) headers so it might be possible to implement this in a more robust way (formerly everything was in a C file and it seems `sage.python.atexit` copied a bunch of stuff which now may be incorrect).

What are the chances that sagemath 9.5 can support system python 3.10? I've been working to get sagemath into voidlinux but they won't accept a vendored python.



---

archive/issue_comments_609878.json:
```json
{
    "body": "<a id='comment:69'></a>\nI would suggest that we defer full support for Python 3.10 to Sage 9.6\nbut already accept system Python 3.10 with a warning",
    "created_at": "2021-12-17T17:12:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609878",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
I would suggest that we defer full support for Python 3.10 to Sage 9.6
but already accept system Python 3.10 with a warning



---

archive/issue_events_090382.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "rename": {
        "from": "Support Python 3.10",
        "to": "Experimental support for Python 3.10 in Sage 9.5"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30766#event-90382"
}
```



---

archive/issue_comments_609879.json:
```json
{
    "body": "<a id='comment:70'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e65ae6ca71fbe284affeb4ed88e63acc97a3fe0a\">e65ae6c</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59173d01b4ed85077a847d2643c80bb3499c926a\">59173d0</a></td><td><code>pkgs/sage-setup/setup.cfg: Allow Python 3.10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c902b7bc44c1b2116416962ec1194b8e59f11f06\">c902b7b</a></td><td><code>src/setup.cfg.m4: Allow Python 3.10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38\">cb30552</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Warn on system python 3.10.x</code></td></tr></table>\n",
    "created_at": "2021-12-17T17:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609879",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:70'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e65ae6ca71fbe284affeb4ed88e63acc97a3fe0a">e65ae6c</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Accept system python 3.10.x</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59173d01b4ed85077a847d2643c80bb3499c926a">59173d0</a></td><td><code>pkgs/sage-setup/setup.cfg: Allow Python 3.10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c902b7bc44c1b2116416962ec1194b8e59f11f06">c902b7b</a></td><td><code>src/setup.cfg.m4: Allow Python 3.10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38">cb30552</a></td><td><code>build/pkgs/python3/spkg-configure.m4: Warn on system python 3.10.x</code></td></tr></table>




---

archive/issue_comments_609880.json:
```json
{
    "body": "**Changing commit** from \"[c73bc9735dc93e981836e626ff865cb98b364740](https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740)\" to \"[cb305525af1f872d00bb63387f7c68b88fb70a38](https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38)\".",
    "created_at": "2021-12-17T17:38:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c73bc9735dc93e981836e626ff865cb98b364740](https://github.com/sagemath/sagetrac-mirror/commit/c73bc9735dc93e981836e626ff865cb98b364740)" to "[cb305525af1f872d00bb63387f7c68b88fb70a38](https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38)".



---

archive/issue_comments_609881.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-12-17T17:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609881",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_609882.json:
```json
{
    "body": "**Changing reviewer** from \"https://github.com/mkoeppe/sage/actions/runs/1239984523\" to \"\".",
    "created_at": "2021-12-17T17:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609882",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "https://github.com/mkoeppe/sage/actions/runs/1239984523" to "".



---

archive/issue_comments_609883.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-12-17T17:39:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609883",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_609884.json:
```json
{
    "body": "**Changing dependencies** from \"#31855, #32519, #32520, #32565, #33013\" to \"#33013, #32930\".",
    "created_at": "2021-12-17T17:41:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609884",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31855, #32519, #32520, #32565, #33013" to "#33013, #32930".



---

archive/issue_comments_609885.json:
```json
{
    "body": "<a id='comment:73'></a>\n**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e144e95b13005cfb2cd7e3a3b7abd70d0a902c7\">5e144e9</a></td><td><code>build/pkgs/jedi: Update to 0.18.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6347f984a697b3aecfe0ed6d2f7363c9dc3b5b65\">6347f98</a></td><td><code>build/pkgs/prompt_toolkit: Update to 3.0.22</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28e535d3a1dd6b67e740b1900c4fad36cccd1121\">28e535d</a></td><td><code>build/pkgs/widgetsnbextension: Update to 3.5.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63078ac3e486d986d43e78f76a2037455147b8da\">63078ac</a></td><td><code>build/pkgs/terminado: Update to 0.12.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22de5dc202d63cbcef3a752a6c68e7d99332d705\">22de5dc</a></td><td><code>build/pkgs/notebook: Update to 6.4.6</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a0fe18ba460d87e0bd46ada9f4246baa49c7c251\">a0fe18b</a></td><td><code>build/pkgs/nbclient: Update to 0.5.4</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ef3fc7f3a0877ee92dd1bf6e8d6e8c84db9f6050\">ef3fc7f</a></td><td><code>build/pkgs/jupyter_client: Update to 7.1.0</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a593bc993aa860f847b803a3d41fe7c2d5d99780\">a593bc9</a></td><td><code>build/pkgs/jupyter_core: Update to 4.9.1</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66c16b14f9081c6d62f5d105cfe76b470074c187\">66c16b1</a></td><td><code>build/pkgs/importlib_metadata: Update to 4.8.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119\">02aa94c</a></td><td><code>Merge #32930</code></td></tr></table>\n",
    "created_at": "2021-12-17T17:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609885",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:73'></a>
**Branch pushed to git repo; I updated commit sha1.** **Last 10 new commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e144e95b13005cfb2cd7e3a3b7abd70d0a902c7">5e144e9</a></td><td><code>build/pkgs/jedi: Update to 0.18.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6347f984a697b3aecfe0ed6d2f7363c9dc3b5b65">6347f98</a></td><td><code>build/pkgs/prompt_toolkit: Update to 3.0.22</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28e535d3a1dd6b67e740b1900c4fad36cccd1121">28e535d</a></td><td><code>build/pkgs/widgetsnbextension: Update to 3.5.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63078ac3e486d986d43e78f76a2037455147b8da">63078ac</a></td><td><code>build/pkgs/terminado: Update to 0.12.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22de5dc202d63cbcef3a752a6c68e7d99332d705">22de5dc</a></td><td><code>build/pkgs/notebook: Update to 6.4.6</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a0fe18ba460d87e0bd46ada9f4246baa49c7c251">a0fe18b</a></td><td><code>build/pkgs/nbclient: Update to 0.5.4</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ef3fc7f3a0877ee92dd1bf6e8d6e8c84db9f6050">ef3fc7f</a></td><td><code>build/pkgs/jupyter_client: Update to 7.1.0</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a593bc993aa860f847b803a3d41fe7c2d5d99780">a593bc9</a></td><td><code>build/pkgs/jupyter_core: Update to 4.9.1</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66c16b14f9081c6d62f5d105cfe76b470074c187">66c16b1</a></td><td><code>build/pkgs/importlib_metadata: Update to 4.8.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119">02aa94c</a></td><td><code>Merge #32930</code></td></tr></table>




---

archive/issue_comments_609886.json:
```json
{
    "body": "**Changing commit** from \"[cb305525af1f872d00bb63387f7c68b88fb70a38](https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38)\" to \"[02aa94c2af2b4c50f85d8b4395807430383fb119](https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119)\".",
    "created_at": "2021-12-17T17:42:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cb305525af1f872d00bb63387f7c68b88fb70a38](https://github.com/sagemath/sagetrac-mirror/commit/cb305525af1f872d00bb63387f7c68b88fb70a38)" to "[02aa94c2af2b4c50f85d8b4395807430383fb119](https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119)".



---

archive/issue_comments_609887.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,7 @@\n This is to support Python 3.10, which was released on 2021-10-04.\n https://docs.python.org/3.10/whatsnew/changelog.html#changelog\n \n-This ticket is for the patches necessary to support\n+Thanks to the following tickets, Sage is mostly ready for \n Python 3.10 in addition to 3.9, 3.8, 3.7.\n \n - needs Cython 0.29.23 (#31445)\n@@ -13,15 +13,17 @@\n - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3\n - #31295 Meta-ticket: Replace imports from deprecated `distutils`\n - #32930 IPython/Jupyter upgrade for python 3.10 support\n+- #33013 Fix tests with Python 3.10\n \n-It does not include the actual upgrade to Python 3.10.\n-To test, see #30767.\n+In this ticket, we enable use of system Python 3.10 but issue a warning regarding its experimental status for Sage. \n+\n+The ticket does not include the upgrade of the `python3` SPKG to Python 3.10.  Many systems already ship Python 3.10.  To test, thanks to https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages, a full rebuild of the Sage distribution is not necessary - only the Python packages will be  built from scratch in a separate venv.\n \n Related:\n \n - [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)\n - [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)\n-- #30767: Test ticket: Python 3.10 development releases\n+- #30767: Upgrade to Python 3.10\n - #30184: Support Python 3.9\n - #30384: Adopt the \u201ctime window-based\u201d policy for support of Python versions from NEP 29\n \n``````\n",
    "created_at": "2021-12-17T18:01:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609887",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,7 @@
 This is to support Python 3.10, which was released on 2021-10-04.
 https://docs.python.org/3.10/whatsnew/changelog.html#changelog
 
-This ticket is for the patches necessary to support
+Thanks to the following tickets, Sage is mostly ready for 
 Python 3.10 in addition to 3.9, 3.8, 3.7.
 
 - needs Cython 0.29.23 (#31445)
@@ -13,15 +13,17 @@
 - #32671 Update `pip` to 21.3.1, `distlib` to 0.3.3
 - #31295 Meta-ticket: Replace imports from deprecated `distutils`
 - #32930 IPython/Jupyter upgrade for python 3.10 support
+- #33013 Fix tests with Python 3.10
 
-It does not include the actual upgrade to Python 3.10.
-To test, see #30767.
+In this ticket, we enable use of system Python 3.10 but issue a warning regarding its experimental status for Sage. 
+
+The ticket does not include the upgrade of the `python3` SPKG to Python 3.10.  Many systems already ship Python 3.10.  To test, thanks to https://wiki.sagemath.org/ReleaseTours/sage-9.5#Separate_virtual_environment_for_Python_packages, a full rebuild of the Sage distribution is not necessary - only the Python packages will be  built from scratch in a separate venv.
 
 Related:
 
 - [PEP 619 -- Python 3.10 Release Schedule](https://www.python.org/dev/peps/pep-0619/)
 - [What's new in Python 3.10](https://docs.python.org/3.10/whatsnew/3.10.html)
-- #30767: Test ticket: Python 3.10 development releases
+- #30767: Upgrade to Python 3.10
 - #30184: Support Python 3.9
 - #30384: Adopt the “time window-based” policy for support of Python versions from NEP 29
 
``````




---

archive/issue_comments_609888.json:
```json
{
    "body": "<a id='comment:75'></a>\nReplying to [tornaria](#comment%3A68):\n> Maybe someone can rebase [...] so we all work on top of a common point?\n\n\nDone",
    "created_at": "2021-12-17T22:27:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609888",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:75'></a>
Replying to [tornaria](#comment%3A68):
> Maybe someone can rebase [...] so we all work on top of a common point?


Done



---

archive/issue_comments_609889.json:
```json
{
    "body": "<a id='comment:76'></a>\nReplying to [tornaria](#comment%3A68):\n> As for the failure: it seems the atexit module internals have changed in python3.10, a quick look seems to suggest that per-module state was changed to per-thread state; `sage.cpython.atexit` is probably doing something wrong which manifests when there is more than one thread.\n\n\nThere is an unreleased change related to `atexit` mentioned in https://docs.python.org/3.10/whatsnew/changelog.html#core-and-builtins",
    "created_at": "2021-12-17T22:28:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609889",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:76'></a>
Replying to [tornaria](#comment%3A68):
> As for the failure: it seems the atexit module internals have changed in python3.10, a quick look seems to suggest that per-module state was changed to per-thread state; `sage.cpython.atexit` is probably doing something wrong which manifests when there is more than one thread.


There is an unreleased change related to `atexit` mentioned in https://docs.python.org/3.10/whatsnew/changelog.html#core-and-builtins



---

archive/issue_comments_609890.json:
```json
{
    "body": "<a id='comment:77'></a>\nI've put this change as a patch on #30767. It looks like it fixes the crashes in `make ptest`",
    "created_at": "2021-12-18T00:35:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609890",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:77'></a>
I've put this change as a patch on #30767. It looks like it fixes the crashes in `make ptest`



---

archive/issue_comments_609891.json:
```json
{
    "body": "<a id='comment:78'></a>\nHowever, I get these failures:\n\n```\nsage -t --random-seed=335595092046712014150830110238612394725 src/sage/cpython/atexit.pyx\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 61, in sage.cpython.atexit\nFailed example:\n    with restore_atexit(clear=True):\n        atexit._run_exitfuncs()  # Should be none registered\n        atexit.register(handler, 1, 2, c=3)\n        with restore_atexit():\n            atexit._run_exitfuncs()  # Run just registered handler\n        atexit._run_exitfuncs()  # Handler should be run again\nExpected:\n    <function handler at 0x...>\n    ((1, 2), {'c': 3})\n    ((1, 2), {'c': 3})\nGot:\n    <function handler at 0x1727cc940>\n    ((1, 2), {'c': 3})\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 77, in sage.cpython.atexit\nFailed example:\n    with restore_atexit(clear=False, run=True):\n        # original handlers are run when exiting the context\n        pass\nExpected:\n    ((4, 5), {'d': 6})\n    ((1, 2), {'c': 3})\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 85, in sage.cpython.atexit\nFailed example:\n    atexit._run_exitfuncs()\nExpected:\n    ((4, 5), {'d': 6})\n    ((1, 2), {'c': 3})\nGot:\n    <BLANKLINE>\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 97, in sage.cpython.atexit\nFailed example:\n    print(\"Initial exit handlers:\\n{}\".format(_get_exithandlers()))\nExpected:\n    Initial exit handlers:\n    [(<function handler at 0x...>, (1, 2), {'c': 3}),\n     (<function handler at 0x...>, (4, 5), {'d': 6})]\nGot:\n    Initial exit handlers:\n    []\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 104, in sage.cpython.atexit\nFailed example:\n    print(\"After restore_atexit:\\n{}\".format(_get_exithandlers()))\nExpected:\n    After restore_atexit:\n    [(<function handler at 0x...>, (1, 2), {'c': 3}),\n     (<function handler at 0x...>, (4, 5), {'d': 6})]\nGot:\n    After restore_atexit:\n    []\n**********************************************************************\nFile \"src/sage/cpython/atexit.pyx\", line 114, in sage.cpython.atexit\nFailed example:\n    print(\"After restore_atexit with clear=True:\\n{}\".format(\n          _get_exithandlers()))\nExpected:\n    After restore_atexit with clear=True:\n    [(<function handler at 0x...>, (1, 2), {'c': 3}),\n     (<function handler at 0x...>, (4, 5), {'d': 6})]\nGot:\n    After restore_atexit with clear=True:\n    []\n**********************************************************************\n1 item had failures:\n   6 of  20 in sage.cpython.atexit\n    [19 tests, 6 failures, 0.03 s]\n```",
    "created_at": "2021-12-18T01:12:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609891",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:78'></a>
However, I get these failures:

```
sage -t --random-seed=335595092046712014150830110238612394725 src/sage/cpython/atexit.pyx
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 61, in sage.cpython.atexit
Failed example:
    with restore_atexit(clear=True):
        atexit._run_exitfuncs()  # Should be none registered
        atexit.register(handler, 1, 2, c=3)
        with restore_atexit():
            atexit._run_exitfuncs()  # Run just registered handler
        atexit._run_exitfuncs()  # Handler should be run again
Expected:
    <function handler at 0x...>
    ((1, 2), {'c': 3})
    ((1, 2), {'c': 3})
Got:
    <function handler at 0x1727cc940>
    ((1, 2), {'c': 3})
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 77, in sage.cpython.atexit
Failed example:
    with restore_atexit(clear=False, run=True):
        # original handlers are run when exiting the context
        pass
Expected:
    ((4, 5), {'d': 6})
    ((1, 2), {'c': 3})
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 85, in sage.cpython.atexit
Failed example:
    atexit._run_exitfuncs()
Expected:
    ((4, 5), {'d': 6})
    ((1, 2), {'c': 3})
Got:
    <BLANKLINE>
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 97, in sage.cpython.atexit
Failed example:
    print("Initial exit handlers:\n{}".format(_get_exithandlers()))
Expected:
    Initial exit handlers:
    [(<function handler at 0x...>, (1, 2), {'c': 3}),
     (<function handler at 0x...>, (4, 5), {'d': 6})]
Got:
    Initial exit handlers:
    []
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 104, in sage.cpython.atexit
Failed example:
    print("After restore_atexit:\n{}".format(_get_exithandlers()))
Expected:
    After restore_atexit:
    [(<function handler at 0x...>, (1, 2), {'c': 3}),
     (<function handler at 0x...>, (4, 5), {'d': 6})]
Got:
    After restore_atexit:
    []
**********************************************************************
File "src/sage/cpython/atexit.pyx", line 114, in sage.cpython.atexit
Failed example:
    print("After restore_atexit with clear=True:\n{}".format(
          _get_exithandlers()))
Expected:
    After restore_atexit with clear=True:
    [(<function handler at 0x...>, (1, 2), {'c': 3}),
     (<function handler at 0x...>, (4, 5), {'d': 6})]
Got:
    After restore_atexit with clear=True:
    []
**********************************************************************
1 item had failures:
   6 of  20 in sage.cpython.atexit
    [19 tests, 6 failures, 0.03 s]
```



---

archive/issue_comments_609892.json:
```json
{
    "body": "<a id='comment:80'></a>\nThe python patch also fixes the crashes for me. Besides those six failures in `sage.cpython.atexit`, I'm also getting\n\n```\n**********************************************************************\nFile \"/usr/lib/python3.10/site-packages/sage/doctest/test.py\", line 509, in sage.doctest.test\nFailed example:\n    os.path.isfile(F)  # long time\nExpected:\n    False\nGot:\n    True\n**********************************************************************\n```\n\nLooks like `atexit` integration is totally broken, but it shouldn't affect normal Sage usage.",
    "created_at": "2021-12-18T18:39:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609892",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:80'></a>
The python patch also fixes the crashes for me. Besides those six failures in `sage.cpython.atexit`, I'm also getting

```
**********************************************************************
File "/usr/lib/python3.10/site-packages/sage/doctest/test.py", line 509, in sage.doctest.test
Failed example:
    os.path.isfile(F)  # long time
Expected:
    False
Got:
    True
**********************************************************************
```

Looks like `atexit` integration is totally broken, but it shouldn't affect normal Sage usage.



---

archive/issue_comments_609893.json:
```json
{
    "body": "<a id='comment:81'></a>\nI think we should just disable all of `sage.cpython.atexit` on Python 3.10 for Sage 9.5",
    "created_at": "2021-12-18T18:42:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609893",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:81'></a>
I think we should just disable all of `sage.cpython.atexit` on Python 3.10 for Sage 9.5



---

archive/issue_comments_609894.json:
```json
{
    "body": "<a id='comment:82'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0\">b5c7399</a></td><td><code>sage.cpython.atexit: Disable for Python >= 3.10.0</code></td></tr></table>\n",
    "created_at": "2021-12-18T21:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0">b5c7399</a></td><td><code>sage.cpython.atexit: Disable for Python >= 3.10.0</code></td></tr></table>




---

archive/issue_comments_609895.json:
```json
{
    "body": "**Changing commit** from \"[02aa94c2af2b4c50f85d8b4395807430383fb119](https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119)\" to \"[b5c73996062c71a9326aafddaf465f6a56b40fe0](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0)\".",
    "created_at": "2021-12-18T21:35:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609895",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[02aa94c2af2b4c50f85d8b4395807430383fb119](https://github.com/sagemath/sagetrac-mirror/commit/02aa94c2af2b4c50f85d8b4395807430383fb119)" to "[b5c73996062c71a9326aafddaf465f6a56b40fe0](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0)".



---

archive/issue_comments_609896.json:
```json
{
    "body": "<a id='comment:83'></a>\nThis fixes the segfaults for me with (unpatched) Python 3.10 from homebrew.\n\nIt looks like doctest timeouts are not correctly reported with this change on Python 3.10\n\n```\nsage -t --random-seed=15134756989416810321066706961638592844 src/sage/manifolds/differentiable/integrated_curve.py\n    Error in doctesting framework (no result returned)\n```\n\nBut I think this is good enough for Sage 9.5.",
    "created_at": "2021-12-18T21:40:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:83'></a>
This fixes the segfaults for me with (unpatched) Python 3.10 from homebrew.

It looks like doctest timeouts are not correctly reported with this change on Python 3.10

```
sage -t --random-seed=15134756989416810321066706961638592844 src/sage/manifolds/differentiable/integrated_curve.py
    Error in doctesting framework (no result returned)
```

But I think this is good enough for Sage 9.5.



---

archive/issue_comments_609897.json:
```json
{
    "body": "<a id='comment:84'></a>\n[atexit.pyx commit](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0) fixes the segfaults for [tox-docker-gentoo-python3.10-standard](https://github.com/sheerluck/sage/actions/runs/1597115166)",
    "created_at": "2021-12-19T06:11:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609897",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:84'></a>
[atexit.pyx commit](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0) fixes the segfaults for [tox-docker-gentoo-python3.10-standard](https://github.com/sheerluck/sage/actions/runs/1597115166)



---

archive/issue_comments_609898.json:
```json
{
    "body": "<a id='comment:85'></a>\nThanks for testing!",
    "created_at": "2021-12-19T06:17:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:85'></a>
Thanks for testing!



---

archive/issue_comments_609899.json:
```json
{
    "body": "<a id='comment:86'></a>\nThe `atexit` patch is causing many test failures in `sage.tests.cmdline` and `sage.doctest.test` for me, with either patched or unpatched python. If you're using patched python (or the upcoming 3.10.2), it makes things notably worse. \n\nWhat about just disallowing system 3.10.0 and 3.10.1?",
    "created_at": "2021-12-19T09:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609899",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:86'></a>
The `atexit` patch is causing many test failures in `sage.tests.cmdline` and `sage.doctest.test` for me, with either patched or unpatched python. If you're using patched python (or the upcoming 3.10.2), it makes things notably worse. 

What about just disallowing system 3.10.0 and 3.10.1?



---

archive/issue_comments_609900.json:
```json
{
    "body": "<a id='comment:87'></a>\nActually it is not just those two modules: doctesting is completely broken with the patch. These are the first few lines of `sage -t -l /usr/lib/python3.10/site-packages/sage`\n\n```\ntoo many failed tests, not using stored timings\nRunning doctests with ID 2021-12-19-10-34-37-4bb8d646.\nUsing --optional=cvxopt,dochtml,pip,rpy2,sage,sage.geometry.polyhedron,sage.rings.real_double\nDoctesting 3480 files.\nsage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/all.py\n    Error in doctesting framework (no result returned)\n**********************************************************************\nTests run before error:\nsage: import gc ## line 13 ##\nsage: import inspect ## line 14 ##\nsage: from sage import * ## line 15 ##\nsage: frames = [x for x in gc.get_objects() if inspect.isframe(x)] ## line 16 ##\nsage: allowed = [\n    'IPython', 'prompt_toolkit', 'jedi',     # sage dependencies\n    'threading', 'multiprocessing',  # doctest dependencies\n    '__main__', 'sage.doctest',      # doctesting\n    'signal', 'enum', 'types'        # may appear in Python 3\n] ## line 21 ##\nsage: def is_not_allowed(frame):\n    module = inspect.getmodule(frame)\n    if module is None: return False\n    return not any(module.__name__.startswith(name) for name in allowed) ## line 27 ##\nsage: [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)] ## line 31 ##\n[]\nsage: type(interacts) ## line 36 ##\n<class 'sage.misc.lazy_import.LazyImport'>\nsage: interacts ## line 38 ##\n<module 'sage.interacts.all' from '/usr/lib/python3.10/site-packages/sage/interacts/all.py'>\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 40 ##\n0\nsage: 'log' in sage_globals() ## line 315 ##\nTrue\nsage: 'MatrixSpace' in sage_globals() ## line 317 ##\nTrue\nsage: 'Permutations' in sage_globals() ## line 319 ##\nTrue\nsage: 'TheWholeUniverse' in sage_globals() ## line 321 ##\nFalse\nsage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 323 ##\n0\n\n**********************************************************************\nsage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/all_cmdline.py\n    Error in doctesting framework (no result returned)\n**********************************************************************\nTests run before error:\n\n**********************************************************************\nsage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/version.py\n    Error in doctesting framework (no result returned)\n**********************************************************************\nTests run before error:\n\n**********************************************************************\nsage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/env.py\n    Error in doctesting framework (no result returned)\n**********************************************************************\nTests run before error:\n```",
    "created_at": "2021-12-19T09:37:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609900",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:87'></a>
Actually it is not just those two modules: doctesting is completely broken with the patch. These are the first few lines of `sage -t -l /usr/lib/python3.10/site-packages/sage`

```
too many failed tests, not using stored timings
Running doctests with ID 2021-12-19-10-34-37-4bb8d646.
Using --optional=cvxopt,dochtml,pip,rpy2,sage,sage.geometry.polyhedron,sage.rings.real_double
Doctesting 3480 files.
sage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/all.py
    Error in doctesting framework (no result returned)
**********************************************************************
Tests run before error:
sage: import gc ## line 13 ##
sage: import inspect ## line 14 ##
sage: from sage import * ## line 15 ##
sage: frames = [x for x in gc.get_objects() if inspect.isframe(x)] ## line 16 ##
sage: allowed = [
    'IPython', 'prompt_toolkit', 'jedi',     # sage dependencies
    'threading', 'multiprocessing',  # doctest dependencies
    '__main__', 'sage.doctest',      # doctesting
    'signal', 'enum', 'types'        # may appear in Python 3
] ## line 21 ##
sage: def is_not_allowed(frame):
    module = inspect.getmodule(frame)
    if module is None: return False
    return not any(module.__name__.startswith(name) for name in allowed) ## line 27 ##
sage: [inspect.getmodule(f).__name__ for f in frames if is_not_allowed(f)] ## line 31 ##
[]
sage: type(interacts) ## line 36 ##
<class 'sage.misc.lazy_import.LazyImport'>
sage: interacts ## line 38 ##
<module 'sage.interacts.all' from '/usr/lib/python3.10/site-packages/sage/interacts/all.py'>
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 40 ##
0
sage: 'log' in sage_globals() ## line 315 ##
True
sage: 'MatrixSpace' in sage_globals() ## line 317 ##
True
sage: 'Permutations' in sage_globals() ## line 319 ##
True
sage: 'TheWholeUniverse' in sage_globals() ## line 321 ##
False
sage: sig_on_count() # check sig_on/off pairings (virtual doctest) ## line 323 ##
0

**********************************************************************
sage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/all_cmdline.py
    Error in doctesting framework (no result returned)
**********************************************************************
Tests run before error:

**********************************************************************
sage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/version.py
    Error in doctesting framework (no result returned)
**********************************************************************
Tests run before error:

**********************************************************************
sage -t --long --random-seed=323685807291696861763886820074125782219 /usr/lib/python3.10/site-packages/sage/env.py
    Error in doctesting framework (no result returned)
**********************************************************************
Tests run before error:
```



---

archive/issue_comments_609901.json:
```json
{
    "body": "<a id='comment:88'></a>\nSame here: the atexit patch causes a lot of doctest failures, either when running tests in parallel or serially.\n\nJust removing that last commit makes things way better, I can now run tests in parallel with only\n\n```\n----------------------------------------------------------------------\nsage -t --random-seed=184890811937734492121783958395067560107 src/sage/cpython/atexit.pyx  # 6 doctests failed\nsage -t --random-seed=184890811937734492121783958395067560107 src/sage_docbuild/utils.py  # 2 doctests failed\nsage -t --random-seed=184890811937734492121783958395067560107 src/sage/tests/cmdline.py  # 7 doctests failed\n----------------------------------------------------------------------\n```\n(I used had trouble all over the place when running tests in parallel, the difference may be due to merging #32930 which I wasn't applying before).\n\nTo be precise I'm using beta8 + #30766 (02aa94c) + #33020 (715277c) + #33040 (d865a54).",
    "created_at": "2021-12-19T17:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609901",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:88'></a>
Same here: the atexit patch causes a lot of doctest failures, either when running tests in parallel or serially.

Just removing that last commit makes things way better, I can now run tests in parallel with only

```
----------------------------------------------------------------------
sage -t --random-seed=184890811937734492121783958395067560107 src/sage/cpython/atexit.pyx  # 6 doctests failed
sage -t --random-seed=184890811937734492121783958395067560107 src/sage_docbuild/utils.py  # 2 doctests failed
sage -t --random-seed=184890811937734492121783958395067560107 src/sage/tests/cmdline.py  # 7 doctests failed
----------------------------------------------------------------------
```
(I used had trouble all over the place when running tests in parallel, the difference may be due to merging #32930 which I wasn't applying before).

To be precise I'm using beta8 + #30766 (02aa94c) + #33020 (715277c) + #33040 (d865a54).



---

archive/issue_comments_609902.json:
```json
{
    "body": "<a id='comment:89'></a>\nSame thing with Fedora 35",
    "created_at": "2021-12-19T17:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609902",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:89'></a>
Same thing with Fedora 35



---

archive/issue_comments_609903.json:
```json
{
    "body": "**Changing commit** from \"[b5c73996062c71a9326aafddaf465f6a56b40fe0](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0)\" to \"[4fd1553ff523688bbfe7b309bb6b9d7f51a2f597](https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597)\".",
    "created_at": "2021-12-19T19:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b5c73996062c71a9326aafddaf465f6a56b40fe0](https://github.com/sagemath/sagetrac-mirror/commit/b5c73996062c71a9326aafddaf465f6a56b40fe0)" to "[4fd1553ff523688bbfe7b309bb6b9d7f51a2f597](https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597)".



---

archive/issue_comments_609904.json:
```json
{
    "body": "<a id='comment:90'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597\">4fd1553</a></td><td><code>sage.cpython.atexit: Work around segfaults in Python 3.10.0, 3.10.1</code></td></tr></table>\n",
    "created_at": "2021-12-19T19:23:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:90'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597">4fd1553</a></td><td><code>sage.cpython.atexit: Work around segfaults in Python 3.10.0, 3.10.1</code></td></tr></table>




---

archive/issue_comments_609905.json:
```json
{
    "body": "<a id='comment:91'></a>\nHere's a better version, please test",
    "created_at": "2021-12-19T19:23:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609905",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:91'></a>
Here's a better version, please test



---

archive/issue_comments_609906.json:
```json
{
    "body": "<a id='comment:92'></a>\nReplying to [mkoeppe](#comment%3A91):\n> Here's a better version, please test\n\n\nRunning a second `sage-runtests` instance while there is another one running still segfaults. In particular, all tests that spawn a `sage-runtests` subprocess in `sage.doctest.test` segfault. This is with unpatched Python 3.10.1",
    "created_at": "2021-12-19T21:04:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609906",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:92'></a>
Replying to [mkoeppe](#comment%3A91):
> Here's a better version, please test


Running a second `sage-runtests` instance while there is another one running still segfaults. In particular, all tests that spawn a `sage-runtests` subprocess in `sage.doctest.test` segfault. This is with unpatched Python 3.10.1



---

archive/issue_comments_609907.json:
```json
{
    "body": "<a id='comment:93'></a>\nAlso, I noticed that `sage -t -a` still segfaults with a patched Python (regardless of whether the `atexit` patch is applied or not)",
    "created_at": "2021-12-19T21:09:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609907",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:93'></a>
Also, I noticed that `sage -t -a` still segfaults with a patched Python (regardless of whether the `atexit` patch is applied or not)



---

archive/issue_comments_609908.json:
```json
{
    "body": "<a id='comment:94'></a>\nFor me only one failed test (system giac 1.7.0.13):\n\n```\nRunning doctests with ID 2021-12-19-22-38-22-94239956.\nGit branch: t/30766/support_python_3_10\nUsing --optional=build,dochtml,fedora,pip,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg\nDoctesting 1 file.\nsage -t --warn-long 41.6 --random-seed=81937132960239439330694293571411830858 src/sage/libs/giac/__init__.py\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 18, in sage.libs.giac\nFailed example:\n    B = gb_giac(I.gens()) # random\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac[3]>\", line 1, in <module>\n        B = gb_giac(I.gens()) # random\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 118, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 353, in groebner_basis\n        gb_giac = F.gbasis(list(var_names), giac_order)\n      File \"sage/libs/giac/auto-methods.pxi\", line 6442, in sage.libs.giac.giac.GiacMethods_base.gbasis (build/cythonized/sage/libs/giac/giac.cpp:56012)\n        return GiacMethods['gbasis'](self,*args)\n      File \"sage/libs/giac/giac.pyx\", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)\n        sig_on()\n    RuntimeError: Aborted\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 19, in sage.libs.giac\nFailed example:\n    B\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac[4]>\", line 1, in <module>\n        B\n    NameError: name 'B' is not defined\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 175, in sage.libs.giac.?\nFailed example:\n    B=gb_giac(I.gens());B\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac.?[3]>\", line 1, in <module>\n        B=gb_giac(I.gens());B\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 118, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 353, in groebner_basis\n        gb_giac = F.gbasis(list(var_names), giac_order)\n      File \"sage/libs/giac/auto-methods.pxi\", line 6442, in sage.libs.giac.giac.GiacMethods_base.gbasis (build/cythonized/sage/libs/giac/giac.cpp:56012)\n        return GiacMethods['gbasis'](self,*args)\n      File \"sage/libs/giac/giac.pyx\", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)\n        sig_on()\n    RuntimeError: Aborted\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 179, in sage.libs.giac.?\nFailed example:\n    B.is_groebner()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac.?[4]>\", line 1, in <module>\n        B.is_groebner()\n    NameError: name 'B' is not defined\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 186, in sage.libs.giac.?\nFailed example:\n    B = gb_giac(I.gens(), elim_variables=[P.gen(0), P.gen(2)])\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac.?[7]>\", line 1, in <module>\n        B = gb_giac(I.gens(), elim_variables=[P.gen(Integer(0)), P.gen(Integer(2))])\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 118, in wrapper\n        return func(*args, **kwds)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py\", line 356, in groebner_basis\n        gb_giac = F.eliminate(list(elim_variables), 'gbasis')\n      File \"sage/libs/giac/auto-methods.pxi\", line 4884, in sage.libs.giac.giac.GiacMethods_base.eliminate (build/cythonized/sage/libs/giac/giac.cpp:45540)\n        return GiacMethods['eliminate'](self,*args)\n      File \"sage/libs/giac/giac.pyx\", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)\n        sig_on()\n    RuntimeError: Aborted\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 189, in sage.libs.giac.?\nFailed example:\n    B.is_groebner()\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac.?[8]>\", line 1, in <module>\n        B.is_groebner()\n    NameError: name 'B' is not defined\n**********************************************************************\nFile \"src/sage/libs/giac/__init__.py\", line 191, in sage.libs.giac.?\nFailed example:\n    B.ideal() == I.elimination_ideal([P.gen(0), P.gen(2)])\nException raised:\n    Traceback (most recent call last):\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.libs.giac.?[9]>\", line 1, in <module>\n        B.ideal() == I.elimination_ideal([P.gen(Integer(0)), P.gen(Integer(2))])\n    NameError: name 'B' is not defined\n**********************************************************************\n2 items had failures:\n   2 of   6 in sage.libs.giac\n   5 of  33 in sage.libs.giac.?\n    [56 tests, 7 failures, 0.41 s]\n----------------------------------------------------------------------\nsage -t --warn-long 41.6 --random-seed=81937132960239439330694293571411830858 src/sage/libs/giac/__init__.py  # 7 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 0.4 seconds\n    cpu time: 0.3 seconds\n    cumulative wall time: 0.4 seconds\nPytest is not installed, skip checking tests that rely on it.\n```",
    "created_at": "2021-12-19T21:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609908",
    "user": "https://github.com/enriqueartal"
}
```

<a id='comment:94'></a>
For me only one failed test (system giac 1.7.0.13):

```
Running doctests with ID 2021-12-19-22-38-22-94239956.
Git branch: t/30766/support_python_3_10
Using --optional=build,dochtml,fedora,pip,sage,sage.geometry.polyhedron,sage.rings.real_double,sage_spkg
Doctesting 1 file.
sage -t --warn-long 41.6 --random-seed=81937132960239439330694293571411830858 src/sage/libs/giac/__init__.py
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 18, in sage.libs.giac
Failed example:
    B = gb_giac(I.gens()) # random
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac[3]>", line 1, in <module>
        B = gb_giac(I.gens()) # random
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 118, in wrapper
        return func(*args, **kwds)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 353, in groebner_basis
        gb_giac = F.gbasis(list(var_names), giac_order)
      File "sage/libs/giac/auto-methods.pxi", line 6442, in sage.libs.giac.giac.GiacMethods_base.gbasis (build/cythonized/sage/libs/giac/giac.cpp:56012)
        return GiacMethods['gbasis'](self,*args)
      File "sage/libs/giac/giac.pyx", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)
        sig_on()
    RuntimeError: Aborted
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 19, in sage.libs.giac
Failed example:
    B
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac[4]>", line 1, in <module>
        B
    NameError: name 'B' is not defined
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 175, in sage.libs.giac.?
Failed example:
    B=gb_giac(I.gens());B
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac.?[3]>", line 1, in <module>
        B=gb_giac(I.gens());B
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 118, in wrapper
        return func(*args, **kwds)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 353, in groebner_basis
        gb_giac = F.gbasis(list(var_names), giac_order)
      File "sage/libs/giac/auto-methods.pxi", line 6442, in sage.libs.giac.giac.GiacMethods_base.gbasis (build/cythonized/sage/libs/giac/giac.cpp:56012)
        return GiacMethods['gbasis'](self,*args)
      File "sage/libs/giac/giac.pyx", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)
        sig_on()
    RuntimeError: Aborted
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 179, in sage.libs.giac.?
Failed example:
    B.is_groebner()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac.?[4]>", line 1, in <module>
        B.is_groebner()
    NameError: name 'B' is not defined
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 186, in sage.libs.giac.?
Failed example:
    B = gb_giac(I.gens(), elim_variables=[P.gen(0), P.gen(2)])
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac.?[7]>", line 1, in <module>
        B = gb_giac(I.gens(), elim_variables=[P.gen(Integer(0)), P.gen(Integer(2))])
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 118, in wrapper
        return func(*args, **kwds)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/libs/giac/__init__.py", line 356, in groebner_basis
        gb_giac = F.eliminate(list(elim_variables), 'gbasis')
      File "sage/libs/giac/auto-methods.pxi", line 4884, in sage.libs.giac.giac.GiacMethods_base.eliminate (build/cythonized/sage/libs/giac/giac.cpp:45540)
        return GiacMethods['eliminate'](self,*args)
      File "sage/libs/giac/giac.pyx", line 2102, in sage.libs.giac.giac.GiacFunction.__call__ (build/cythonized/sage/libs/giac/giac.cpp:153070)
        sig_on()
    RuntimeError: Aborted
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 189, in sage.libs.giac.?
Failed example:
    B.is_groebner()
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac.?[8]>", line 1, in <module>
        B.is_groebner()
    NameError: name 'B' is not defined
**********************************************************************
File "src/sage/libs/giac/__init__.py", line 191, in sage.libs.giac.?
Failed example:
    B.ideal() == I.elimination_ideal([P.gen(0), P.gen(2)])
Exception raised:
    Traceback (most recent call last):
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/local/sagedev/local/var/lib/sage/venv-python3.9.7/lib/python3.9/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.libs.giac.?[9]>", line 1, in <module>
        B.ideal() == I.elimination_ideal([P.gen(Integer(0)), P.gen(Integer(2))])
    NameError: name 'B' is not defined
**********************************************************************
2 items had failures:
   2 of   6 in sage.libs.giac
   5 of  33 in sage.libs.giac.?
    [56 tests, 7 failures, 0.41 s]
----------------------------------------------------------------------
sage -t --warn-long 41.6 --random-seed=81937132960239439330694293571411830858 src/sage/libs/giac/__init__.py  # 7 doctests failed
----------------------------------------------------------------------
Total time for all tests: 0.4 seconds
    cpu time: 0.3 seconds
    cumulative wall time: 0.4 seconds
Pytest is not installed, skip checking tests that rely on it.
```



---

archive/issue_comments_609909.json:
```json
{
    "body": "**Changing commit** from \"[4fd1553ff523688bbfe7b309bb6b9d7f51a2f597](https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597)\" to \"[249357dd30c54162e4b9204d6113c70b310a5087](https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087)\".",
    "created_at": "2021-12-19T22:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609909",
    "user": "https://github.com/tornaria"
}
```

**Changing commit** from "[4fd1553ff523688bbfe7b309bb6b9d7f51a2f597](https://github.com/sagemath/sagetrac-mirror/commit/4fd1553ff523688bbfe7b309bb6b9d7f51a2f597)" to "[249357dd30c54162e4b9204d6113c70b310a5087](https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087)".



---

archive/issue_comments_609910.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/support_python_3_10)\" to \"[u/tornaria/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/support_python_3_10)\".",
    "created_at": "2021-12-19T22:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609910",
    "user": "https://github.com/tornaria"
}
```

**Changing branch** from "[u/mkoeppe/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/support_python_3_10)" to "[u/tornaria/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/support_python_3_10)".



---

archive/issue_comments_609911.json:
```json
{
    "body": "<a id='comment:95'></a>\nI change the workarounds by an attempt at a \"proper\" fix.\n\nWith this all the doctests in `src/sage/cpython/atexit.pyx` pass, both with bundled python 3.9.7 and with my system python 3.10.\n\nI'm still to run the whole testsuite; I am still getting failures in `src/sage_docbuild/utils.py` but I think they are due to the deprecation warnings caused by matplotlib and should go away when I apply #33040 which I forgot to do.\n\nShould #33040 be merged into this ticket as a dependency? Am I the only one having problems caused by old matplotlib?\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087\">249357d</a></td><td><code>sage.cpython.atexit: fix for python 3.10 (#30766)</code></td></tr></table>\n",
    "created_at": "2021-12-19T22:10:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609911",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:95'></a>
I change the workarounds by an attempt at a "proper" fix.

With this all the doctests in `src/sage/cpython/atexit.pyx` pass, both with bundled python 3.9.7 and with my system python 3.10.

I'm still to run the whole testsuite; I am still getting failures in `src/sage_docbuild/utils.py` but I think they are due to the deprecation warnings caused by matplotlib and should go away when I apply #33040 which I forgot to do.

Should #33040 be merged into this ticket as a dependency? Am I the only one having problems caused by old matplotlib?

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087">249357d</a></td><td><code>sage.cpython.atexit: fix for python 3.10 (#30766)</code></td></tr></table>




---

archive/issue_comments_609912.json:
```json
{
    "body": "<a id='comment:96'></a>\nNotes on the implementation:\n\nEverything is in the `cdef extern from *` block where I moved the definition of `struct atexit_callback` and a new function `_atexit_callbacks()`.\n\nThe C implementation for python 3.9 is short and should be equivalent to what was before. The implementation for 3.10 is even shorter since structs are now defined in (internal) python headers.\n\nThe argument to `_atexit_callbacks()` should be the atexit module as in the body of `_get_exithandlers()`. This is not necessary for python 3.10 but it seemed simpler to have the same declaration for both cases so there are no conditionals outside the `cdef extern from *` block.",
    "created_at": "2021-12-19T22:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609912",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:96'></a>
Notes on the implementation:

Everything is in the `cdef extern from *` block where I moved the definition of `struct atexit_callback` and a new function `_atexit_callbacks()`.

The C implementation for python 3.9 is short and should be equivalent to what was before. The implementation for 3.10 is even shorter since structs are now defined in (internal) python headers.

The argument to `_atexit_callbacks()` should be the atexit module as in the body of `_get_exithandlers()`. This is not necessary for python 3.10 but it seemed simpler to have the same declaration for both cases so there are no conditionals outside the `cdef extern from *` block.



---

archive/issue_comments_609913.json:
```json
{
    "body": "**Changing dependencies** from \"#33013, #32930\" to \"#33013, #32930, #33040\".",
    "created_at": "2021-12-19T22:25:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609913",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#33013, #32930" to "#33013, #32930, #33040".



---

archive/issue_comments_609914.json:
```json
{
    "body": "<a id='comment:98'></a>\nLooks good to me but it needs to be tested also on Python < 3.10",
    "created_at": "2021-12-19T22:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'></a>
Looks good to me but it needs to be tested also on Python < 3.10



---

archive/issue_comments_609915.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, Gonzalo Tornar\u00eda\".",
    "created_at": "2021-12-19T22:27:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609915",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, Gonzalo Tornaría".



---

archive/issue_comments_609916.json:
```json
{
    "body": "<a id='comment:100'></a>\nReplying to [mkoeppe](#comment%3A98):\n> Looks good to me but it needs to be tested also on Python < 3.10\n\n\nAbsolutely! I did one test by passing `--without-system-python3` to configure but more testing would be desirable.\n\nAlthough I think the changes should really be nil for python < 3.10; would it be useful for review if I split the patch in two parts where the first part just refactors the existing code and the second part adds the new code for python 3.10? With some luck the first part visibly does nothing, and the second part will only add code conditional to python >= 3.10.",
    "created_at": "2021-12-19T23:01:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609916",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:100'></a>
Replying to [mkoeppe](#comment%3A98):
> Looks good to me but it needs to be tested also on Python < 3.10


Absolutely! I did one test by passing `--without-system-python3` to configure but more testing would be desirable.

Although I think the changes should really be nil for python < 3.10; would it be useful for review if I split the patch in two parts where the first part just refactors the existing code and the second part adds the new code for python 3.10? With some luck the first part visibly does nothing, and the second part will only add code conditional to python >= 3.10.



---

archive/issue_comments_609917.json:
```json
{
    "body": "<a id='comment:101'></a>\nReplying to [tornaria](#comment%3A100):\n> would it be useful for review if I split the patch in two parts where the first part just refactors the existing code and the second part adds the new code for python 3.10?\n\n\nNo, it's fine as is",
    "created_at": "2021-12-19T23:03:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609917",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:101'></a>
Replying to [tornaria](#comment%3A100):
> would it be useful for review if I split the patch in two parts where the first part just refactors the existing code and the second part adds the new code for python 3.10?


No, it's fine as is



---

archive/issue_comments_609918.json:
```json
{
    "body": "<a id='comment:2'></a>\nMy full clean build with python 3.10 finished with the following doctest failure:\n\n```\nsage -t --random-seed=262548395979960264449538514011341238171 src/sage_docbuild/utils.py\n**********************************************************************\nFile \"src/sage_docbuild/utils.py\", line 91, in sage_docbuild.utils\nFailed example:\n    build_many(target, range(8), processes=8)\nExpected:\n    Traceback (most recent call last):\n    ...\n    ZeroDivisionError: rational division by zero\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.utils[6]>\", line 1, in <module>\n        build_many(target, range(Integer(8)), processes=Integer(8))\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_docbuild/utils.py\", line 289, in build_many\n        raise worker_exc.original_exception\n    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer\n**********************************************************************\nFile \"src/sage_docbuild/utils.py\", line 110, in sage_docbuild.utils\nFailed example:\n    build_many(target, range(8), processes=8)\nExpected:\n    Traceback (most recent call last):\n    ...\n    WorkerDiedException: worker for 4 died with non-zero exit code -9\nGot:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage_docbuild.utils[8]>\", line 1, in <module>\n        build_many(target, range(Integer(8)), processes=Integer(8))\n      File \"/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_docbuild/utils.py\", line 289, in build_many\n        raise worker_exc.original_exception\n    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer\n**********************************************************************\n1 item had failures:\n   2 of  10 in sage_docbuild.utils\n    [9 tests, 2 failures, 1.43 s]\n```",
    "created_at": "2021-12-19T23:04:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609918",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:2'></a>
My full clean build with python 3.10 finished with the following doctest failure:

```
sage -t --random-seed=262548395979960264449538514011341238171 src/sage_docbuild/utils.py
**********************************************************************
File "src/sage_docbuild/utils.py", line 91, in sage_docbuild.utils
Failed example:
    build_many(target, range(8), processes=8)
Expected:
    Traceback (most recent call last):
    ...
    ZeroDivisionError: rational division by zero
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.utils[6]>", line 1, in <module>
        build_many(target, range(Integer(8)), processes=Integer(8))
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_docbuild/utils.py", line 289, in build_many
        raise worker_exc.original_exception
    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer
**********************************************************************
File "src/sage_docbuild/utils.py", line 110, in sage_docbuild.utils
Failed example:
    build_many(target, range(8), processes=8)
Expected:
    Traceback (most recent call last):
    ...
    WorkerDiedException: worker for 4 died with non-zero exit code -9
Got:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage_docbuild.utils[8]>", line 1, in <module>
        build_many(target, range(Integer(8)), processes=Integer(8))
      File "/usr/lib/sage-9.5.beta8/local/var/lib/sage/venv-python3.10/lib/python3.10/site-packages/sage_docbuild/utils.py", line 289, in build_many
        raise worker_exc.original_exception
    TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer
**********************************************************************
1 item had failures:
   2 of  10 in sage_docbuild.utils
    [9 tests, 2 failures, 1.43 s]
```



---

archive/issue_comments_609919.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796\">df9f1d4</a></td><td><code>Pass float(0.5) to time.sleep</code></td></tr></table>\n",
    "created_at": "2021-12-20T01:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609919",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796">df9f1d4</a></td><td><code>Pass float(0.5) to time.sleep</code></td></tr></table>




---

archive/issue_comments_609920.json:
```json
{
    "body": "**Changing commit** from \"[249357dd30c54162e4b9204d6113c70b310a5087](https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087)\" to \"[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)\".",
    "created_at": "2021-12-20T01:38:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609920",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[249357dd30c54162e4b9204d6113c70b310a5087](https://github.com/sagemath/sagetrac-mirror/commit/249357dd30c54162e4b9204d6113c70b310a5087)" to "[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)".



---

archive/issue_comments_609921.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis seems to be the root cause:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta8, Release Date: 2021-12-12               \u2502\n\u2502 Using Python 3.10.1. Type \"help()\" for help.                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: import time\nsage: time.sleep(0.5)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-2-b448069dbb3c> in <module>\n----> 1 time.sleep(RealNumber('0.5'))\n\nTypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer\n```\n\nNow the same thing `--without-system-python`:\n\n```\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.5.beta8, Release Date: 2021-12-12               \u2502\n\u2502 Using Python 3.9.7. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\u250f\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2513\n\u2503 Warning: this is a prerelease version, and it may be unstable.     \u2503\n\u2517\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u2501\u251b\nsage: import time\nsage: time.sleep(0.5)\n<ipython-input-2-b448069dbb3c>:1: DeprecationWarning: an integer is required (got type sage.rings.real_mpfr.RealLiteral).  Implicit conversion to integers using __int__ is deprecated, and may be removed in a future version of Python.\n  time.sleep(RealNumber('0.5'))\n```",
    "created_at": "2021-12-20T01:38:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609921",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:4'></a>
This seems to be the root cause:

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta8, Release Date: 2021-12-12               │
│ Using Python 3.10.1. Type "help()" for help.                       │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: import time
sage: time.sleep(0.5)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-2-b448069dbb3c> in <module>
----> 1 time.sleep(RealNumber('0.5'))

TypeError: 'sage.rings.real_mpfr.RealLiteral' object cannot be interpreted as an integer
```

Now the same thing `--without-system-python`:

```
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.5.beta8, Release Date: 2021-12-12               │
│ Using Python 3.9.7. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Warning: this is a prerelease version, and it may be unstable.     ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
sage: import time
sage: time.sleep(0.5)
<ipython-input-2-b448069dbb3c>:1: DeprecationWarning: an integer is required (got type sage.rings.real_mpfr.RealLiteral).  Implicit conversion to integers using __int__ is deprecated, and may be removed in a future version of Python.
  time.sleep(RealNumber('0.5'))
```



---

archive/issue_comments_609922.json:
```json
{
    "body": "<a id='comment:5'></a>\nEverything passes now for me using system python 3.10.1 on void linux:\n\n```\n$ ./sage -tp 36 --optional sage,optional,build --all\n...\n----------------------------------------------------------------------\nAll tests passed!\n----------------------------------------------------------------------\nTotal time for all tests: 236.9 seconds\n    cpu time: 7024.5 seconds\n    cumulative wall time: 6565.8 seconds\n```",
    "created_at": "2021-12-20T01:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609922",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:5'></a>
Everything passes now for me using system python 3.10.1 on void linux:

```
$ ./sage -tp 36 --optional sage,optional,build --all
...
----------------------------------------------------------------------
All tests passed!
----------------------------------------------------------------------
Total time for all tests: 236.9 seconds
    cpu time: 7024.5 seconds
    cumulative wall time: 6565.8 seconds
```



---

archive/issue_comments_609923.json:
```json
{
    "body": "**Reviewer:** ..., Matthias Koeppe",
    "created_at": "2021-12-20T02:44:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609923",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** ..., Matthias Koeppe



---

archive/issue_comments_609924.json:
```json
{
    "body": "<a id='comment:7'></a>\nAll tests passing here too, thanks!",
    "created_at": "2021-12-20T15:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609924",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:7'></a>
All tests passing here too, thanks!



---

archive/issue_comments_609925.json:
```json
{
    "body": "**Changing reviewer** from \"..., Matthias Koeppe\" to \"Antonio Rojas, Matthias Koeppe\".",
    "created_at": "2021-12-20T15:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609925",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing reviewer** from "..., Matthias Koeppe" to "Antonio Rojas, Matthias Koeppe".



---

archive/issue_comments_609926.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-12-20T15:41:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609926",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_609927.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks!",
    "created_at": "2021-12-20T19:57:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Thanks!



---

archive/issue_comments_609928.json:
```json
{
    "body": "<a id='comment:9'></a>\nThe dependency #33040 needs review so that we can get this ticket merged.",
    "created_at": "2021-12-20T19:57:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609928",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
The dependency #33040 needs review so that we can get this ticket merged.



---

archive/issue_events_090383.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-01-01T00:23:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30766#event-90383"
}
```



---

archive/issue_comments_609929.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2022-01-01T00:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609929",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_609930.json:
```json
{
    "body": "**Changing branch** from \"[u/tornaria/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/support_python_3_10)\" to \"[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)\".",
    "created_at": "2022-01-01T00:23:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609930",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/tornaria/support_python_3_10](https://github.com/sagemath/sagetrac-mirror/tree/u/tornaria/support_python_3_10)" to "[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)".



---

archive/issue_comments_609931.json:
```json
{
    "body": "**Changing commit** from \"[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)\" to \"\".",
    "created_at": "2022-01-09T13:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609931",
    "user": "https://github.com/antonio-rojas"
}
```

**Changing commit** from "[df9f1d4ced4264f65ab704f725f6f5879b012796](https://github.com/sagemath/sagetrac-mirror/commit/df9f1d4ced4264f65ab704f725f6f5879b012796)" to "".



---

archive/issue_comments_609932.json:
```json
{
    "body": "<a id='comment:1'></a>\nSomething regressed in 9.5.rc0 which is causing distutils deprecation warnings\n\n```\nFile \"/usr/lib/python3.10/site-packages/sage/env.py\", line 359, in sage.env.sage_include_directories\nFailed example:\n    sage.env.sage_include_directories()\nExpected:\n    ['.../include/python...',\n    '.../python.../numpy/core/include']\nGot:\n    doctest:warning\n      File \"/usr/bin/sage-runtests\", line 155, in <module>\n        err = DC.run()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/control.py\", line 1256, in run\n        self.run_doctests()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/control.py\", line 957, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2004, in dispatch\n        self.parallel_dispatch()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1899, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2173, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.10/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.10/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/popen_fork.py\", line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib/python3.10/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2145, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2475, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2527, in _run\n        result = runner.run(test)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 861, in run\n        return self._run(test, compileflags, out)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.env.sage_include_directories[1]>\", line 1, in <module>\n        sage.env.sage_include_directories()\n      File \"/usr/lib/python3.10/site-packages/sage/env.py\", line 375, in sage_include_directories\n        import distutils.sysconfig\n      File \"<frozen importlib._bootstrap>\", line 1027, in _find_and_load\n      File \"<frozen importlib._bootstrap>\", line 992, in _find_and_load_unlocked\n      File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\n      File \"<frozen importlib._bootstrap>\", line 1027, in _find_and_load\n      File \"<frozen importlib._bootstrap>\", line 1006, in _find_and_load_unlocked\n      File \"<frozen importlib._bootstrap>\", line 688, in _load_unlocked\n      File \"<frozen importlib._bootstrap_external>\", line 883, in exec_module\n      File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\n      File \"/usr/lib/python3.10/distutils/__init__.py\", line 19, in <module>\n        warnings.warn(_DEPRECATION_MESSAGE,\n      File \"/usr/lib/python3.10/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives\n    doctest:warning\n      File \"/usr/bin/sage-runtests\", line 155, in <module>\n        err = DC.run()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/control.py\", line 1256, in run\n        self.run_doctests()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/control.py\", line 957, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2004, in dispatch\n        self.parallel_dispatch()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1899, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2173, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.10/multiprocessing/process.py\", line 121, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.10/multiprocessing/context.py\", line 224, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/popen_fork.py\", line 19, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.10/multiprocessing/popen_fork.py\", line 71, in _launch\n        code = process_obj._bootstrap(parent_sentinel=child_r)\n      File \"/usr/lib/python3.10/multiprocessing/process.py\", line 315, in _bootstrap\n        self.run()\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2145, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2475, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 2527, in _run\n        result = runner.run(test)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 861, in run\n        return self._run(test, compileflags, out)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 694, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/usr/lib/python3.10/site-packages/sage/doctest/forker.py\", line 1088, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.env.sage_include_directories[1]>\", line 1, in <module>\n        sage.env.sage_include_directories()\n      File \"/usr/lib/python3.10/site-packages/sage/env.py\", line 375, in sage_include_directories\n        import distutils.sysconfig\n      File \"<frozen importlib._bootstrap>\", line 1027, in _find_and_load\n      File \"<frozen importlib._bootstrap>\", line 1006, in _find_and_load_unlocked\n      File \"<frozen importlib._bootstrap>\", line 688, in _load_unlocked\n      File \"<frozen importlib._bootstrap_external>\", line 883, in exec_module\n      File \"<frozen importlib._bootstrap>\", line 241, in _call_with_frames_removed\n      File \"/usr/lib/python3.10/distutils/sysconfig.py\", line 58, in <module>\n        warnings.warn(\n      File \"/usr/lib/python3.10/warnings.py\", line 109, in _showwarnmsg\n        sw(msg.message, msg.category, msg.filename, msg.lineno,\n    :\n    DeprecationWarning: The distutils.sysconfig module is deprecated, use sysconfig instead\n    ['/usr/lib/python3.10/site-packages',\n     '/usr/include/python3.10',\n     '/usr/lib/python3.10/site-packages/numpy/core/include']\n**********************************************************************\n```\nThese didn't happen with 9.5.beta9 + this branch.",
    "created_at": "2022-01-09T13:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609932",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:1'></a>
Something regressed in 9.5.rc0 which is causing distutils deprecation warnings

```
File "/usr/lib/python3.10/site-packages/sage/env.py", line 359, in sage.env.sage_include_directories
Failed example:
    sage.env.sage_include_directories()
Expected:
    ['.../include/python...',
    '.../python.../numpy/core/include']
Got:
    doctest:warning
      File "/usr/bin/sage-runtests", line 155, in <module>
        err = DC.run()
      File "/usr/lib/python3.10/site-packages/sage/doctest/control.py", line 1256, in run
        self.run_doctests()
      File "/usr/lib/python3.10/site-packages/sage/doctest/control.py", line 957, in run_doctests
        self.dispatcher.dispatch()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2004, in dispatch
        self.parallel_dispatch()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1899, in parallel_dispatch
        w.start()  # This might take some time
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2173, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.10/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.10/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.10/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.10/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.10/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2145, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2475, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2527, in _run
        result = runner.run(test)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 861, in run
        return self._run(test, compileflags, out)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.env.sage_include_directories[1]>", line 1, in <module>
        sage.env.sage_include_directories()
      File "/usr/lib/python3.10/site-packages/sage/env.py", line 375, in sage_include_directories
        import distutils.sysconfig
      File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
      File "<frozen importlib._bootstrap>", line 992, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
      File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
      File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 883, in exec_module
      File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
      File "/usr/lib/python3.10/distutils/__init__.py", line 19, in <module>
        warnings.warn(_DEPRECATION_MESSAGE,
      File "/usr/lib/python3.10/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: The distutils package is deprecated and slated for removal in Python 3.12. Use setuptools or check PEP 632 for potential alternatives
    doctest:warning
      File "/usr/bin/sage-runtests", line 155, in <module>
        err = DC.run()
      File "/usr/lib/python3.10/site-packages/sage/doctest/control.py", line 1256, in run
        self.run_doctests()
      File "/usr/lib/python3.10/site-packages/sage/doctest/control.py", line 957, in run_doctests
        self.dispatcher.dispatch()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2004, in dispatch
        self.parallel_dispatch()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1899, in parallel_dispatch
        w.start()  # This might take some time
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2173, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.10/multiprocessing/process.py", line 121, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.10/multiprocessing/context.py", line 224, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.10/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.10/multiprocessing/popen_fork.py", line 19, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.10/multiprocessing/popen_fork.py", line 71, in _launch
        code = process_obj._bootstrap(parent_sentinel=child_r)
      File "/usr/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
        self.run()
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2145, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2475, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 2527, in _run
        result = runner.run(test)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 861, in run
        return self._run(test, compileflags, out)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 694, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/usr/lib/python3.10/site-packages/sage/doctest/forker.py", line 1088, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.env.sage_include_directories[1]>", line 1, in <module>
        sage.env.sage_include_directories()
      File "/usr/lib/python3.10/site-packages/sage/env.py", line 375, in sage_include_directories
        import distutils.sysconfig
      File "<frozen importlib._bootstrap>", line 1027, in _find_and_load
      File "<frozen importlib._bootstrap>", line 1006, in _find_and_load_unlocked
      File "<frozen importlib._bootstrap>", line 688, in _load_unlocked
      File "<frozen importlib._bootstrap_external>", line 883, in exec_module
      File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
      File "/usr/lib/python3.10/distutils/sysconfig.py", line 58, in <module>
        warnings.warn(
      File "/usr/lib/python3.10/warnings.py", line 109, in _showwarnmsg
        sw(msg.message, msg.category, msg.filename, msg.lineno,
    :
    DeprecationWarning: The distutils.sysconfig module is deprecated, use sysconfig instead
    ['/usr/lib/python3.10/site-packages',
     '/usr/include/python3.10',
     '/usr/lib/python3.10/site-packages/numpy/core/include']
**********************************************************************
```
These didn't happen with 9.5.beta9 + this branch.



---

archive/issue_comments_609933.json:
```json
{
    "body": "<a id='comment:112'></a>\nReplying to [arojas](#comment%3A111):\n> Something regressed in 9.5.rc0 which is causing distutils deprecation warnings\n\n\nThis comes from #32938, in particular form the removal of\n\n```\nfrom Cython.Build.Dependencies import strip_string_literals as cython_strip_string_literals\n```\nfrom `sage.doctest.parsing`. That import used to throw a `distutils` deprecation warning that for some reason was ignored during doctesting, and now that it's gone the warning is printed when doctesting any module that calls `distutils.sysconfig`.",
    "created_at": "2022-01-09T15:25:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609933",
    "user": "https://github.com/antonio-rojas"
}
```

<a id='comment:112'></a>
Replying to [arojas](#comment%3A111):
> Something regressed in 9.5.rc0 which is causing distutils deprecation warnings


This comes from #32938, in particular form the removal of

```
from Cython.Build.Dependencies import strip_string_literals as cython_strip_string_literals
```
from `sage.doctest.parsing`. That import used to throw a `distutils` deprecation warning that for some reason was ignored during doctesting, and now that it's gone the warning is printed when doctesting any module that calls `distutils.sysconfig`.



---

archive/issue_comments_609934.json:
```json
{
    "body": "<a id='comment:3'></a>\nadding `internet` to `--optional=` shows that all `context=SSLContext()` [should be replaced with](https://docs.python.org/3/library/ssl.html#ssl.create_default_context) `context=ssl.create_default_context()`",
    "created_at": "2022-01-09T16:05:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609934",
    "user": "https://github.com/sheerluck"
}
```

<a id='comment:3'></a>
adding `internet` to `--optional=` shows that all `context=SSLContext()` [should be replaced with](https://docs.python.org/3/library/ssl.html#ssl.create_default_context) `context=ssl.create_default_context()`



---

archive/issue_comments_609935.json:
```json
{
    "body": "<a id='comment:4'></a>\nThese three seem to fix all the warnings for me (numpy 1.22 from system via #29665)\n\n```\n--- a/src/sage/all.py\t2022-01-09 15:34:29.833828362 -0300\n+++ b/src/sage/all.py\t2022-01-09 15:39:40.150091390 -0300\n@@ -96,6 +96,15 @@\n warnings.filterwarnings('ignore', category=DeprecationWarning,\n                         module='pythran')\n \n+warnings.filterwarnings('ignore', category=DeprecationWarning,\n+\t\t\tmodule='numpy', message='.*distutils.*')\n+\n+warnings.filterwarnings('ignore', category=DeprecationWarning,\n+\t\t\tmodule='sage.env', message='.*distutils.*')\n+\n+warnings.filterwarnings('ignore', category=DeprecationWarning,\n+\t\t\tmodule='sage.features', message='.*distutils.*')\n+\n ################ end setup warnings ###############################\n \n \n```\n\nEdit: fixed paths in the patch.",
    "created_at": "2022-01-09T18:46:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609935",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:4'></a>
These three seem to fix all the warnings for me (numpy 1.22 from system via #29665)

```
--- a/src/sage/all.py	2022-01-09 15:34:29.833828362 -0300
+++ b/src/sage/all.py	2022-01-09 15:39:40.150091390 -0300
@@ -96,6 +96,15 @@
 warnings.filterwarnings('ignore', category=DeprecationWarning,
                         module='pythran')
 
+warnings.filterwarnings('ignore', category=DeprecationWarning,
+			module='numpy', message='.*distutils.*')
+
+warnings.filterwarnings('ignore', category=DeprecationWarning,
+			module='sage.env', message='.*distutils.*')
+
+warnings.filterwarnings('ignore', category=DeprecationWarning,
+			module='sage.features', message='.*distutils.*')
+
 ################ end setup warnings ###############################
 
 
```

Edit: fixed paths in the patch.



---

archive/issue_comments_609936.json:
```json
{
    "body": "<a id='comment:5'></a>\nPlease see and review #33135.",
    "created_at": "2022-01-09T19:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30766",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30766#issuecomment-609936",
    "user": "https://github.com/tornaria"
}
```

<a id='comment:5'></a>
Please see and review #33135.
