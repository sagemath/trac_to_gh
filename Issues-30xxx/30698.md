# Issue 30698: Add Gauss-Legendre integrator to documentation

archive/issues_030461.json:
```json
{
    "body": "A method for Gauss-Legendre integration of fast-callable\npolynomials was added in #23140.\n\nIt lives in `src/sage/numerical/gauss_legendre.pyx`.\n\nThis ticket is to make it appear in the documentation.\n\nIdeally add examples and do a bit of pep8 formatting.\n\nRelated:\n\n- [Ask Sage question 44545: Gauss-Legendre quadrature](https://ask.sagemath.org/question/44545)\n\nCC:  @slel\n\nKeywords: gauss_legendre\n\nReviewer: Samuel Leli\u00e8vre, Nils Bruin\n\nAuthor: Linden Disney-Hogg\n\nBranch: e74a32b3a68b78bde03c6e15608436dee3012bd0\n\nCommit: e74a32b3a68b78bde03c6e15608436dee3012bd0\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30698\n\n",
    "closed_at": "2021-06-29T23:08:54Z",
    "created_at": "2020-10-02T12:32:43Z",
    "labels": [
        "component: numerical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Add Gauss-Legendre integrator to documentation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30698",
    "user": "https://github.com/slel"
}
```
A method for Gauss-Legendre integration of fast-callable
polynomials was added in #23140.

It lives in `src/sage/numerical/gauss_legendre.pyx`.

This ticket is to make it appear in the documentation.

Ideally add examples and do a bit of pep8 formatting.

Related:

- [Ask Sage question 44545: Gauss-Legendre quadrature](https://ask.sagemath.org/question/44545)

CC:  @slel

Keywords: gauss_legendre

Reviewer: Samuel Leli√®vre, Nils Bruin

Author: Linden Disney-Hogg

Branch: e74a32b3a68b78bde03c6e15608436dee3012bd0

Commit: e74a32b3a68b78bde03c6e15608436dee3012bd0

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30698





---

archive/issue_events_079940.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30698#event-79940"
}
```



---

archive/issue_comments_434267.json:
```json
{
    "body": "<a id='comment:3'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434267",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_079941.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30698#event-79941"
}
```



---

archive/issue_events_079942.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30698#event-79942"
}
```



---

archive/issue_comments_434268.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-17T16:25:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434268",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434269.json:
```json
{
    "body": "<a id='comment:6'></a>Looks good! Some comments based on an initial reading of the code:\n- I don't think \"REC\" algorithm is universally accepted terminology. If you want to call it that, I think it needs a literature reference with it. This could be something like:\n\n```\nCompute the integration nodes and weights for the Gauss-Legendre quadrature scheme.\n\nWe use the recurrence relations for Legendre polynomials to compute their values. This is a version of the algorithm that in [Neurohr ...] is called the REC algorithm.\n\nNOTE:\n\nIt may be worth testing if using the Arb algorithm for finding the nodes and weights in `arb/acb_calc/integrate_gl_auto_deg.c` has better performance.\n```\n- Concerning `range` in cython code: See [Cython doc](https://cython.readthedocs.io/en/latest/src/userguide/pyrex_differences.html#automatic-range-conversion). This gets compiled to an actual c-for loop (it's important here that cython has type-information on what `len` returns (an actual c-integer-type) so that it can provide the loop with sufficient type hints so that the C compiler can actually compile it.\nThe fact that xrange still works indicates that in these situations, cython considers range and xrange as synonyms and that this behaviour has been maintained (at least with the settings that sage uses for its cython library). Moving to `range` if you're touching the code anyway makes sense.",
    "created_at": "2021-06-18T15:45:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434269",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:6'></a>Looks good! Some comments based on an initial reading of the code:
- I don't think "REC" algorithm is universally accepted terminology. If you want to call it that, I think it needs a literature reference with it. This could be something like:

```
Compute the integration nodes and weights for the Gauss-Legendre quadrature scheme.

We use the recurrence relations for Legendre polynomials to compute their values. This is a version of the algorithm that in [Neurohr ...] is called the REC algorithm.

NOTE:

It may be worth testing if using the Arb algorithm for finding the nodes and weights in `arb/acb_calc/integrate_gl_auto_deg.c` has better performance.
```
- Concerning `range` in cython code: See [Cython doc](https://cython.readthedocs.io/en/latest/src/userguide/pyrex_differences.html#automatic-range-conversion). This gets compiled to an actual c-for loop (it's important here that cython has type-information on what `len` returns (an actual c-integer-type) so that it can provide the loop with sufficient type hints so that the C compiler can actually compile it.
The fact that xrange still works indicates that in these situations, cython considers range and xrange as synonyms and that this behaviour has been maintained (at least with the settings that sage uses for its cython library). Moving to `range` if you're touching the code anyway makes sense.



---

archive/issue_comments_434270.json:
```json
{
    "body": "<a id='comment:7'></a>Remember to set the ticket to \"needs review\" when ready for review.\n\nSome comments on the branch you pushed, in addition to those by `@`nbruin.\n\n**Split into two tickets?**\n\nI like your proposed change to `integrate_vector`\nallowing to specify a number of nodes instead of \nspecifying `epsilon`, but for clarity I would\nseparate that change out to a different ticket,\nand stick to documentation and reformatting here.\n\nNow some comments on the changes in the existing branch.\n\n**Addition to the documentation**\n\nWell done adding a line to `src/doc/en/reference/numerical/index.rst`\nto make Gauss-Legendre integration appear in the documentation.\n\n**Reformatting**\n\nGood job on the reformatting overall.\n\nGood call adding a double-colon changing `NOTE:` into `NOTE::`,\nand indenting its content.\n\nTo finish up, I think it needs to become `.. NOTE::`.\n\nSome ways I would push the reformatting a bit further:\n\n```diff\n-        sage: L1 = nodes(24,53)\n+        sage: L1 = nodes(24, 53)\n-        sage: P = RR['x'](sage.functions.orthogonal_polys.legendre_P(24,x))\n+        sage: P = RR['x'](sage.functions.orthogonal_polys.legendre_P(24, x))\n         sage: Pdif = P.diff()\n-        sage: L2 = [((r+1)/2,1/(1-r^2)/Pdif(r)^2) for r,_ in RR['x'](P).roots()]\n+        sage: L2 = [((r + 1)/2, 1/(1 - r^2)/Pdif(r)^2)\n+        ....:       for r, _ in RR['x'](P).roots()]\n-        sage: all((a[0]-b[0]).abs() < 10^-15 and (a[1]-b[1]).abs() < 10^-9 for a,b in zip(L1,L2))\n+        sage: all((a[0] - b[0]).abs() < 1e-15 and (a[1] - b[1]).abs() < 1e-9\n+        ....:     for a, b in zip(L1, L2))\n         True\n```\n\n```diff\n         sage: prec = 200\n         sage: K = RealField(prec)\n-        sage: V = VectorSpace(K,2)\n+        sage: V = VectorSpace(K, 2)\n-        sage: epsilon = K(2^(-prec+4))\n+        sage: epsilon = K(2^(-prec + 4))\n-        sage: f = lambda t:V((1+t^2,1/(1+t^2)))\n+        sage: f = lambda t: V((1 + t^2, 1/(1 + t^2)))\n-        sage: I = integrate_vector(f, prec, epsilon)\n+        sage: I = integrate_vector(f, prec, epsilon=epsilon)\n-        sage: J = V((4/3, pi/4))\n+        sage: J = V((4/3, pi/4))\n-        sage: max(c.abs() for c in (I-J)) < epsilon\n+        sage: max(c.abs() for c in I - J) < epsilon\n```\n\n```diff\n         sage: prec = 200\n         sage: Kreal = RealField(prec)\n         sage: K = ComplexField(prec)\n-        sage: V = VectorSpace(K,2)\n+        sage: V = VectorSpace(K, 2)\n-        sage: epsilon = Kreal(2^(-prec+4))\n+        sage: epsilon = Kreal(2^(-prec + 4))\n-        sage: f = lambda t: V((t,K(exp(2*pi*t*K.0))))\n+        sage: f = lambda t: V((t, K(exp(2*pi*t*K.0))))\n-        sage: I = integrate_vector(f, prec, epsilon)\n+        sage: I = integrate_vector(f, prec, epsilon=epsilon)\n-        sage: J = V((1/2,0))\n+        sage: J = V((1/2, 0))\n-        sage: max(c.abs() for c in (I-J)) < epsilon\n+        sage: max(c.abs() for c in I - J) < epsilon\n```\n\n```diff\n-        for i in range(1,len(nodelist)):\n+        for i in range(1, len(nodelist)):\n```\n\n**Changes to `integrate_vector`**\n\nPerhaps the new `N=None` keyword should come after\nthe existing `N=None` keyword.\n\nOtherwise, this line, which appears twice in the doctests:\n\n```\n        sage: I = integrate_vector(f, prec, epsilon)\n```\nis really executing\n\n```diff\n        sage: I = integrate_vector(f, prec, N=epsilon)\n```\nwhich is likely not intended, and this change\nmight similarly break existing user code.\n\nIn any case, the examples should be explicit about\nwhich keyword is passed, using one of:\n\n```\n        sage: I = integrate_vector(f, prec, epsilon=epsilon)\n        sage: I = integrate_vector(f, prec, N=N)\n```\nand possibly new examples should be added using\n\n```\n        sage: I = integrate_vector(f, prec, epsilon=epsilon, N=N)\n        sage: I = integrate_vector(f, prec, N=N, epsilon=epsilon)\n```\nto illustrate that specifying `N` overrides specifying `epsilon`.\n\nThere is a typo \"specificed\" for \"specified\" in the new line\ndescribing ``N``. Suggested change:\n\n```diff\n-     - ``N`` -- integer. Number of nodes to use. If specificed, the target error ``epsilon`` is ignored. \n+     - ``N`` -- integer. Number of nodes to use.\n+       If specified, the target error ``epsilon`` is ignored. \n```",
    "created_at": "2021-06-19T12:39:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434270",
    "user": "https://github.com/slel"
}
```

<a id='comment:7'></a>Remember to set the ticket to "needs review" when ready for review.

Some comments on the branch you pushed, in addition to those by `@`nbruin.

**Split into two tickets?**

I like your proposed change to `integrate_vector`
allowing to specify a number of nodes instead of 
specifying `epsilon`, but for clarity I would
separate that change out to a different ticket,
and stick to documentation and reformatting here.

Now some comments on the changes in the existing branch.

**Addition to the documentation**

Well done adding a line to `src/doc/en/reference/numerical/index.rst`
to make Gauss-Legendre integration appear in the documentation.

**Reformatting**

Good job on the reformatting overall.

Good call adding a double-colon changing `NOTE:` into `NOTE::`,
and indenting its content.

To finish up, I think it needs to become `.. NOTE::`.

Some ways I would push the reformatting a bit further:

```diff
-        sage: L1 = nodes(24,53)
+        sage: L1 = nodes(24, 53)
-        sage: P = RR['x'](sage.functions.orthogonal_polys.legendre_P(24,x))
+        sage: P = RR['x'](sage.functions.orthogonal_polys.legendre_P(24, x))
         sage: Pdif = P.diff()
-        sage: L2 = [((r+1)/2,1/(1-r^2)/Pdif(r)^2) for r,_ in RR['x'](P).roots()]
+        sage: L2 = [((r + 1)/2, 1/(1 - r^2)/Pdif(r)^2)
+        ....:       for r, _ in RR['x'](P).roots()]
-        sage: all((a[0]-b[0]).abs() < 10^-15 and (a[1]-b[1]).abs() < 10^-9 for a,b in zip(L1,L2))
+        sage: all((a[0] - b[0]).abs() < 1e-15 and (a[1] - b[1]).abs() < 1e-9
+        ....:     for a, b in zip(L1, L2))
         True
```

```diff
         sage: prec = 200
         sage: K = RealField(prec)
-        sage: V = VectorSpace(K,2)
+        sage: V = VectorSpace(K, 2)
-        sage: epsilon = K(2^(-prec+4))
+        sage: epsilon = K(2^(-prec + 4))
-        sage: f = lambda t:V((1+t^2,1/(1+t^2)))
+        sage: f = lambda t: V((1 + t^2, 1/(1 + t^2)))
-        sage: I = integrate_vector(f, prec, epsilon)
+        sage: I = integrate_vector(f, prec, epsilon=epsilon)
-        sage: J = V((4/3, pi/4))
+        sage: J = V((4/3, pi/4))
-        sage: max(c.abs() for c in (I-J)) < epsilon
+        sage: max(c.abs() for c in I - J) < epsilon
```

```diff
         sage: prec = 200
         sage: Kreal = RealField(prec)
         sage: K = ComplexField(prec)
-        sage: V = VectorSpace(K,2)
+        sage: V = VectorSpace(K, 2)
-        sage: epsilon = Kreal(2^(-prec+4))
+        sage: epsilon = Kreal(2^(-prec + 4))
-        sage: f = lambda t: V((t,K(exp(2*pi*t*K.0))))
+        sage: f = lambda t: V((t, K(exp(2*pi*t*K.0))))
-        sage: I = integrate_vector(f, prec, epsilon)
+        sage: I = integrate_vector(f, prec, epsilon=epsilon)
-        sage: J = V((1/2,0))
+        sage: J = V((1/2, 0))
-        sage: max(c.abs() for c in (I-J)) < epsilon
+        sage: max(c.abs() for c in I - J) < epsilon
```

```diff
-        for i in range(1,len(nodelist)):
+        for i in range(1, len(nodelist)):
```

**Changes to `integrate_vector`**

Perhaps the new `N=None` keyword should come after
the existing `N=None` keyword.

Otherwise, this line, which appears twice in the doctests:

```
        sage: I = integrate_vector(f, prec, epsilon)
```
is really executing

```diff
        sage: I = integrate_vector(f, prec, N=epsilon)
```
which is likely not intended, and this change
might similarly break existing user code.

In any case, the examples should be explicit about
which keyword is passed, using one of:

```
        sage: I = integrate_vector(f, prec, epsilon=epsilon)
        sage: I = integrate_vector(f, prec, N=N)
```
and possibly new examples should be added using

```
        sage: I = integrate_vector(f, prec, epsilon=epsilon, N=N)
        sage: I = integrate_vector(f, prec, N=N, epsilon=epsilon)
```
to illustrate that specifying `N` overrides specifying `epsilon`.

There is a typo "specificed" for "specified" in the new line
describing ``N``. Suggested change:

```diff
-     - ``N`` -- integer. Number of nodes to use. If specificed, the target error ``epsilon`` is ignored. 
+     - ``N`` -- integer. Number of nodes to use.
+       If specified, the target error ``epsilon`` is ignored. 
```



---

archive/issue_comments_434271.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 slelievre]:\n> Perhaps the new `N=None` keyword should come after\n> the existing `N=None` keyword.\n\n\nafter the existing `epsilon=None` keyword, is probably what you meant. Good point! It actually suggests that override is not safe, since it's too easy to mix the two parameters up. So probably a ValueError (or something like that) should be raised if both N and epsilon have a non-None value. It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.\n\nWhat this is actually indicative of is that the API of the routine is getting crowded and that there really are two routines here: one that integrates with a give number of nodes and one that uses heuristic error estimation to try and get a result within a given accuracy. The second routine may call the first for code reuse, but inlining the code would be acceptable for performance reasons.\n\nSo ... splitting is the way to go! It also leads to the fastest code because you select the branch by the name of the routine you call (and with cython that means the choice can be locked in compile-time!) rather than by the type of parameters that are passed in (which need runtime testing to determine in python and cython)",
    "created_at": "2021-06-20T00:44:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434271",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:8'></a>Replying to [comment:7 slelievre]:
> Perhaps the new `N=None` keyword should come after
> the existing `N=None` keyword.


after the existing `epsilon=None` keyword, is probably what you meant. Good point! It actually suggests that override is not safe, since it's too easy to mix the two parameters up. So probably a ValueError (or something like that) should be raised if both N and epsilon have a non-None value. It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.

What this is actually indicative of is that the API of the routine is getting crowded and that there really are two routines here: one that integrates with a give number of nodes and one that uses heuristic error estimation to try and get a result within a given accuracy. The second routine may call the first for code reuse, but inlining the code would be acceptable for performance reasons.

So ... splitting is the way to go! It also leads to the fastest code because you select the branch by the name of the routine you call (and with cython that means the choice can be locked in compile-time!) rather than by the type of parameters that are passed in (which need runtime testing to determine in python and cython)



---

archive/issue_comments_434272.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:8 nbruin]:\n> It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.\n\n\nThis could also be solved by using [keyword-only arguments](https://www.python.org/dev/peps/pep-3102/). In order to maintain backward compatibility, it could be implemented like this:\n\n```python\ndef integrate_vector(f, prec, epsilon_deprecated=None, *, epsilon=None, N=None):\n    if epsilon_deprecated is not None:\n        from sage.misc.superseded import deprecation\n        deprecation(30698, \"positional argument epsilon should be passed as keyword argument\")\n        if epsilon is None:\n            epsilon = epsilon_deprecated\n        else:\n            raise ValueError(\"...\")\n```",
    "created_at": "2021-06-20T18:41:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434272",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:9'></a>Replying to [comment:8 nbruin]:
> It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.


This could also be solved by using [keyword-only arguments](https://www.python.org/dev/peps/pep-3102/). In order to maintain backward compatibility, it could be implemented like this:

```python
def integrate_vector(f, prec, epsilon_deprecated=None, *, epsilon=None, N=None):
    if epsilon_deprecated is not None:
        from sage.misc.superseded import deprecation
        deprecation(30698, "positional argument epsilon should be passed as keyword argument")
        if epsilon is None:
            epsilon = epsilon_deprecated
        else:
            raise ValueError("...")
```



---

archive/issue_comments_434273.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:7 slelievre]:\n\nThanks for all the comments, will get cracking on them! \n \n> **Split into two tickets?**\n> \n> I like your proposed change to `integrate_vector`\n> allowing to specify a number of nodes instead of \n> specifying `epsilon`, but for clarity I would\n> separate that change out to a different ticket,\n> and stick to documentation and reformatting here.\n> \n\n\nI have opened a new ticket #32014 for the changes to integrate_vector itself.",
    "created_at": "2021-06-20T20:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434273",
    "user": "https://github.com/DisneyHogg"
}
```

<a id='comment:10'></a>Replying to [comment:7 slelievre]:

Thanks for all the comments, will get cracking on them! 
 
> **Split into two tickets?**
> 
> I like your proposed change to `integrate_vector`
> allowing to specify a number of nodes instead of 
> specifying `epsilon`, but for clarity I would
> separate that change out to a different ticket,
> and stick to documentation and reformatting here.
> 


I have opened a new ticket #32014 for the changes to integrate_vector itself.



---

archive/issue_comments_434274.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 gh-mwageringel]:\n> Replying to [comment:8 nbruin]:\n> > It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.\n\n> \n> This could also be solved by using [keyword-only arguments](https://www.python.org/dev/peps/pep-3102/). In order to maintain backward compatibility, it could be implemented like this:\n> \n> \n> ```python\n> def integrate_vector(f, prec, epsilon_deprecated=None, *, epsilon=None, N=None):\n>     if epsilon_deprecated is not None:\n>         from sage.misc.superseded import deprecation\n>         deprecation(30698, \"positional argument epsilon should be passed as keyword argument\")\n>         if epsilon is None:\n>             epsilon = epsilon_deprecated\n>         else:\n>             raise ValueError(\"...\")\n> ```\n\nIt doesn't remove the [Code smell of boolean parameters](https://medium.com/`@`amlcurran/clean-code-the-curse-of-a-boolean-parameter-c237a830b7a3), and these code-path-determining signatures have a similar smell. There is also the complexity: testing the function arguments is forcing us an extra runtime branch that is almost always resolvable at compile-time (because the branch is determined by essentially the call signature that is used, and writing code where the call signature is only determined at runtime is, while possible in python, difficult to do and, thankfully, rare). So distinguishing between the two uses with different callables is in this case definitely the right design. These routines are in fact used in rather tight loops. While in most applications any call overhead will be dwarfed by the required evaluations, it's near a point where you might not want to introduce extra overhead unnecessarily. I suspect the contribution will be very small, though, so the main argument here is really just clean code design.\n\n(it's also an internal routine; at least it was up to this ticket, so deprecation wouldn't be necessary. I think in this case there's a cleaner solution that doesn't require API changes to existing routines at all! -- for those reading this and not familiar with the term \"bikeshedding\": this is a prime example of it, and it illustrates the limited productivity that ensues from it)",
    "created_at": "2021-06-20T21:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434274",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:11'></a>Replying to [comment:9 gh-mwageringel]:
> Replying to [comment:8 nbruin]:
> > It would still not guard against accidental mix-ups due to positional parameters being confused with keyword parameters.

> 
> This could also be solved by using [keyword-only arguments](https://www.python.org/dev/peps/pep-3102/). In order to maintain backward compatibility, it could be implemented like this:
> 
> 
> ```python
> def integrate_vector(f, prec, epsilon_deprecated=None, *, epsilon=None, N=None):
>     if epsilon_deprecated is not None:
>         from sage.misc.superseded import deprecation
>         deprecation(30698, "positional argument epsilon should be passed as keyword argument")
>         if epsilon is None:
>             epsilon = epsilon_deprecated
>         else:
>             raise ValueError("...")
> ```

It doesn't remove the [Code smell of boolean parameters](https://medium.com/`@`amlcurran/clean-code-the-curse-of-a-boolean-parameter-c237a830b7a3), and these code-path-determining signatures have a similar smell. There is also the complexity: testing the function arguments is forcing us an extra runtime branch that is almost always resolvable at compile-time (because the branch is determined by essentially the call signature that is used, and writing code where the call signature is only determined at runtime is, while possible in python, difficult to do and, thankfully, rare). So distinguishing between the two uses with different callables is in this case definitely the right design. These routines are in fact used in rather tight loops. While in most applications any call overhead will be dwarfed by the required evaluations, it's near a point where you might not want to introduce extra overhead unnecessarily. I suspect the contribution will be very small, though, so the main argument here is really just clean code design.

(it's also an internal routine; at least it was up to this ticket, so deprecation wouldn't be necessary. I think in this case there's a cleaner solution that doesn't require API changes to existing routines at all! -- for those reading this and not familiar with the term "bikeshedding": this is a prime example of it, and it illustrates the limited productivity that ensues from it)



---

archive/issue_comments_434275.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T12:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434276.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T13:38:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434276",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434277.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-21T13:52:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434277",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434278.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-22T14:33:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434278",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434279.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-06-22T14:34:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434279",
    "user": "https://github.com/DisneyHogg"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_434280.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-06-23T22:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434280",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_434281.json:
```json
{
    "body": "<a id='comment:17'></a>Looks good to me; checked the resulting HTML typesetting as well.",
    "created_at": "2021-06-23T22:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434281",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:17'></a>Looks good to me; checked the resulting HTML typesetting as well.



---

archive/issue_comments_434282.json:
```json
{
    "body": "<a id='comment:18'></a>Missing continuation prompts:\n\n```diff\n         sage: L2 = [((r + 1)/2, 1/(1 - r^2)/Pdif(r)^2)\n-                    for r, _ in RR['x'](P).roots()]\n+        ....:       for r, _ in RR['x'](P).roots()]\n         sage: all((a[0] - b[0]).abs() < 1e-15 and (a[1] - b[1]).abs() < 1e-9\n-                  for a, b in zip(L1, L2))\n+        ....:     for a, b in zip(L1, L2))\n```\nIf you fix that, set back to positive review on my behalf.",
    "created_at": "2021-06-27T22:41:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434282",
    "user": "https://github.com/slel"
}
```

<a id='comment:18'></a>Missing continuation prompts:

```diff
         sage: L2 = [((r + 1)/2, 1/(1 - r^2)/Pdif(r)^2)
-                    for r, _ in RR['x'](P).roots()]
+        ....:       for r, _ in RR['x'](P).roots()]
         sage: all((a[0] - b[0]).abs() < 1e-15 and (a[1] - b[1]).abs() < 1e-9
-                  for a, b in zip(L1, L2))
+        ....:     for a, b in zip(L1, L2))
```
If you fix that, set back to positive review on my behalf.



---

archive/issue_comments_434283.json:
```json
{
    "body": "<a id='comment:19'></a>Author name is missing",
    "created_at": "2021-06-27T22:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434283",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:19'></a>Author name is missing



---

archive/issue_comments_434284.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-27T22:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434284",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_434285.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-06-27T23:33:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434285",
    "user": "https://github.com/slel"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_434286.json:
```json
{
    "body": "<a id='comment:21'></a>Thanks, Samuel.\n\nThe continuation prompts indeed should be fixed. I'm setting the ticket back to \"needs work\" because it does, and otherwise it might get missed.\n\nOnce Linden has added continuation prompts to those two lines, he can set it back to \"positive\"; or alert me to do that.",
    "created_at": "2021-06-28T06:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434286",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:21'></a>Thanks, Samuel.

The continuation prompts indeed should be fixed. I'm setting the ticket back to "needs work" because it does, and otherwise it might get missed.

Once Linden has added continuation prompts to those two lines, he can set it back to "positive"; or alert me to do that.



---

archive/issue_comments_434287.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2021-06-28T06:54:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434287",
    "user": "https://github.com/nbruin"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_434288.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-06-28T09:44:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434288",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_434289.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2021-06-28T15:31:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434289",
    "user": "https://github.com/nbruin"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_434290.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-06-29T23:08:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30698#issuecomment-434290",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079943.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T23:08:54Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30698",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30698#event-79943"
}
```
