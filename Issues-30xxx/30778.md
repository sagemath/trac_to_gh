# Issue 30778: sage.doctest.control: Exclude doctests in files via file directives ''# sage.doctest: optional - xyz'

archive/issues_030541.json:
```json
{
    "body": "When a file is marked `# sage.doctest: optional - xyz`, we omit it from doctesting unless `--optional=xyz` is given.\n\nThis will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)\n\nWe do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.\n\nPrevious related proposals/discussions: #3260, #20427\n\nAlso related: #30746\n\n\n**CC:**  @simon-king-jena @kiwifb @roed314 @saraedum @nthiery @videlec\n\n**Keywords:** sd111\n\n**Branch/Commit:** [5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)\n\n**Reviewer:** John Palmieri, Matthias Koeppe\n\n**Author:** Matthias Koeppe, John Palmieri\n\nIssue created by migration from https://trac.sagemath.org/ticket/30778\n\n",
    "closed_at": "2021-10-10T10:17:16Z",
    "created_at": "2020-10-16T20:58:54Z",
    "labels": [
        "component: doctest framework",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.5",
    "title": "sage.doctest.control: Exclude doctests in files via file directives ''# sage.doctest: optional - xyz'",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/30778",
    "user": "https://github.com/mkoeppe"
}
```
When a file is marked `# sage.doctest: optional - xyz`, we omit it from doctesting unless `--optional=xyz` is given.

This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)

We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.

Previous related proposals/discussions: #3260, #20427

Also related: #30746


**CC:**  @simon-king-jena @kiwifb @roed314 @saraedum @nthiery @videlec

**Keywords:** sd111

**Branch/Commit:** [5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)

**Reviewer:** John Palmieri, Matthias Koeppe

**Author:** Matthias Koeppe, John Palmieri

Issue created by migration from https://trac.sagemath.org/ticket/30778





---

archive/issue_events_275935.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-16T22:00:48Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275935"
}
```



---

archive/issue_events_275936.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-16T22:00:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275936"
}
```



---

archive/issue_comments_494918.json:
```json
{
    "body": "<a id='comment:2'></a>\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_494919.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494919",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "" to "sd111".



---

archive/issue_events_275937.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-12T19:01:39Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275937"
}
```



---

archive/issue_events_275938.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-12T19:01:39Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275938"
}
```



---

archive/issue_comments_494920.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n-When a file is marked `sage_setup: distribution = ...` (#29705), we omit it from doctesting.\n+When a file is marked `sage_setup: distribution = ...` (#29705) and this distribution is not installed, we omit it from doctesting.\n \n+This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)\n \n``````\n",
    "created_at": "2021-02-12T19:01:39Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494920",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
-When a file is marked `sage_setup: distribution = ...` (#29705), we omit it from doctesting.
+When a file is marked `sage_setup: distribution = ...` (#29705) and this distribution is not installed, we omit it from doctesting.
 
+This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)
 
``````




---

archive/issue_comments_494921.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,3 +2,4 @@\n \n This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)\n \n+We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.\n``````\n",
    "created_at": "2021-02-13T03:58:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494921",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,3 +2,4 @@
 
 This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)
 
+We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.
``````




---

archive/issue_comments_494922.json:
```json
{
    "body": "<a id='comment:6'></a>\nWe could also parse a directive \"# doctest: optional - ...\" in the file header",
    "created_at": "2021-02-17T21:37:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
We could also parse a directive "# doctest: optional - ..." in the file header



---

archive/issue_comments_494923.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)",
    "created_at": "2021-02-18T00:25:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494923",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)



---

archive/issue_comments_494924.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mkoeppe](#comment%3A6):\n> We could also parse a directive \"# doctest: optional - ...\" in the file header\n\n\nThis has been discussed in the past and rejected, on the grounds that the directive is hidden when people look at the reference manual or just do `x.method?`, so they may expect those tests to work all the time. For any of these proposed directives, the corresponding page in the reference manual should have a clear warning. I don't know what to do about the help string for each relevant method/function/class. It's overkill to modify the help string based on such a directive, right?",
    "created_at": "2021-02-18T00:26:08Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494924",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
Replying to [mkoeppe](#comment%3A6):
> We could also parse a directive "# doctest: optional - ..." in the file header


This has been discussed in the past and rejected, on the grounds that the directive is hidden when people look at the reference manual or just do `x.method?`, so they may expect those tests to work all the time. For any of these proposed directives, the corresponding page in the reference manual should have a clear warning. I don't know what to do about the help string for each relevant method/function/class. It's overkill to modify the help string based on such a directive, right?



---

archive/issue_comments_494925.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\" to \"\".",
    "created_at": "2021-02-18T00:26:08Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494925",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)" to "".



---

archive/issue_comments_494926.json:
```json
{
    "body": "<a id='comment:9'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a\">b92e036</a></td><td><code>sage.doctest: Handle file directives '# sage.doctest: optional - xyz'</code></td></tr></table>\n",
    "created_at": "2021-02-18T00:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494926",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a">b92e036</a></td><td><code>sage.doctest: Handle file directives '# sage.doctest: optional - xyz'</code></td></tr></table>




---

archive/issue_comments_494927.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)",
    "created_at": "2021-02-18T00:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494927",
    "user": "https://github.com/jhpalmieri"
}
```

**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)



---

archive/issue_comments_494928.json:
```json
{
    "body": "**Commit:** [b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)",
    "created_at": "2021-02-18T00:26:31Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494928",
    "user": "https://github.com/jhpalmieri"
}
```

**Commit:** [b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)



---

archive/issue_comments_494929.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-When a file is marked `sage_setup: distribution = ...` (#29705) and this distribution is not installed, we omit it from doctesting.\n+When a file is marked `# sage.doctest: optional - xyz`, we omit it from doctesting unless `--optional=xyz` is given.\n \n This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)\n \n``````\n",
    "created_at": "2021-02-18T00:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494929",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-When a file is marked `sage_setup: distribution = ...` (#29705) and this distribution is not installed, we omit it from doctesting.
+When a file is marked `# sage.doctest: optional - xyz`, we omit it from doctesting unless `--optional=xyz` is given.
 
 This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)
 
``````




---

archive/issue_comments_494930.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\" to \"\".",
    "created_at": "2021-02-18T00:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494930",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)" to "".



---

archive/issue_events_275939.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-18T00:27:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "rename": {
        "from": "sage.doctest.control: Exclude doctests in files from non-installed distributions",
        "to": "sage.doctest.control: Exclude doctests in files via file directives ''# sage.doctest: optional - xyz'"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275939"
}
```



---

archive/issue_comments_494931.json:
```json
{
    "body": "**Changing commit** from \"[b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)\" to \"\".",
    "created_at": "2021-02-18T00:27:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494931",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)" to "".



---

archive/issue_comments_494932.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)",
    "created_at": "2021-02-18T00:27:37Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494932",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)



---

archive/issue_comments_494933.json:
```json
{
    "body": "**Commit:** [b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)",
    "created_at": "2021-02-18T00:28:47Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494933",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)



---

archive/issue_comments_494934.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [jhpalmieri](#comment%3A8):\n> Replying to [mkoeppe](#comment%3A6):\n> > We could also parse a directive \"# doctest: optional - ...\" in the file header\n\n> \n> This has been discussed in the past and rejected\n\n\nI was trying to find the ticket with this discussion but did not succeed\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a\">b92e036</a></td><td><code>sage.doctest: Handle file directives '# sage.doctest: optional - xyz'</code></td></tr></table>\n",
    "created_at": "2021-02-18T00:28:47Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494934",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [jhpalmieri](#comment%3A8):
> Replying to [mkoeppe](#comment%3A6):
> > We could also parse a directive "# doctest: optional - ..." in the file header

> 
> This has been discussed in the past and rejected


I was trying to find the ticket with this discussion but did not succeed

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a">b92e036</a></td><td><code>sage.doctest: Handle file directives '# sage.doctest: optional - xyz'</code></td></tr></table>




---

archive/issue_comments_494935.json:
```json
{
    "body": "<a id='comment:13'></a>\nThere is certainly an open question here. I don't think it's only a matter of marking up the doctests with \"optional\" tags. With modularization going forward, we need to find a way to inform the user that some Python module is provided by a particular distribution package. I think this information should be attached to the module name instead of cluttering the doctests.",
    "created_at": "2021-02-18T00:37:17Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494935",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
There is certainly an open question here. I don't think it's only a matter of marking up the doctests with "optional" tags. With modularization going forward, we need to find a way to inform the user that some Python module is provided by a particular distribution package. I think this information should be attached to the module name instead of cluttering the doctests.



---

archive/issue_comments_494936.json:
```json
{
    "body": "<a id='comment:14'></a>\nUntil we have a more systematic solution for this, I would just suggest that we add an admonition to the module documentation that says something like: \"The classes in this module require the optional package `rpy2` to be installed\"",
    "created_at": "2021-02-18T00:59:17Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494936",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Until we have a more systematic solution for this, I would just suggest that we add an admonition to the module documentation that says something like: "The classes in this module require the optional package `rpy2` to be installed"



---

archive/issue_comments_494937.json:
```json
{
    "body": "<a id='comment:15'></a>\nOK, found some previous discussion: #3260, #20427",
    "created_at": "2021-02-18T01:02:20Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494937",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
OK, found some previous discussion: #3260, #20427



---

archive/issue_comments_494938.json:
```json
{
    "body": "**Changing dependencies** from \"#30746\" to \"#30746, #3260, #20427\".",
    "created_at": "2021-02-18T01:07:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494938",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30746" to "#30746, #3260, #20427".



---

archive/issue_comments_494939.json:
```json
{
    "body": "<a id='comment:16'></a>\nLooks like this topic is showing up every 4-6 years.\n\nWhat has changed now is that modularization (#29705) would introduce LOTS of new optional tags if we don't find a systematic solution.",
    "created_at": "2021-02-18T01:07:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494939",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Looks like this topic is showing up every 4-6 years.

What has changed now is that modularization (#29705) would introduce LOTS of new optional tags if we don't find a systematic solution.



---

archive/issue_comments_494940.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,3 +3,5 @@\n This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)\n \n We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.\n+\n+Previous related proposals/discussions: \n``````\n",
    "created_at": "2021-02-18T01:07:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494940",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,3 +3,5 @@
 This will save us from having to add lots of `# optional - ...` tags to files in the course of modularization (#29705)
 
 We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.
+
+Previous related proposals/discussions: 
``````




---

archive/issue_comments_494941.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,4 +4,7 @@\n \n We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.\n \n-Previous related proposals/discussions: \n+Previous related proposals/discussions: #3260, #20427\n+\n+Also related: #30746\n+\n``````\n",
    "created_at": "2021-02-18T01:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494941",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,4 +4,7 @@
 
 We do this by extending `sage.doctest.control.skipfile`, which already parses files for `# nodoctest` file directives.
 
-Previous related proposals/discussions: 
+Previous related proposals/discussions: #3260, #20427
+
+Also related: #30746
+
``````




---

archive/issue_events_275940.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-18T01:08:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275940"
}
```



---

archive/issue_comments_494942.json:
```json
{
    "body": "**Changing dependencies** from \"#30746, #3260, #20427\" to \"\".",
    "created_at": "2021-02-18T01:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494942",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30746, #3260, #20427" to "".



---

archive/issue_comments_494943.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2021-02-18T01:08:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494943",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_494944.json:
```json
{
    "body": "<a id='comment:19'></a>\nHow about a change like this?\n\n```diff\ndiff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py\nindex 6e75131fb3..0b10e19552 100644\n--- a/src/sage/doctest/control.py\n+++ b/src/sage/doctest/control.py\n@@ -216,6 +216,10 @@ def skipfile(filename, tested_optional_tags=False):\n     - ``tested_optional_tags`` - a list or tuple or set of optional tags to test,\n       or ``False`` (no optional test) or ``True`` (all optional tests)\n \n+    If ``filename`` contains a line of the form ``\"# sage.doctest:\n+    optional - xyz\")``, then this will return ``False`` if \"xyz\" is in\n+    ``tested_optional_tags``. Otherwise, it returns the matching line.\n+\n     EXAMPLES::\n \n         sage: from sage.doctest.control import skipfile\n@@ -231,9 +235,11 @@ def skipfile(filename, tested_optional_tags=False):\n         sage: with open(filename, \"w\") as f:\n         ....:     _ = f.write(\"# sage.doctest: optional - xyz\")\n         sage: skipfile(filename, False)\n+        '# sage.doctest: optional - xyz'\n+        sage: bool(skipfile(filename, False))\n         True\n         sage: skipfile(filename, ['abc'])\n-        True\n+        '# sage.doctest: optional - xyz'\n         sage: skipfile(filename, ['abc', 'xyz'])\n         False\n         sage: skipfile(filename, True)\n@@ -252,11 +258,11 @@ def skipfile(filename, tested_optional_tags=False):\n                 m = optionalfiledirective_regex.match(line)\n                 if m:\n                     if tested_optional_tags is False:\n-                        return True\n+                        return m.group(0)\n                     optional_tags = parse_optional_tags('#' + m.group(2))\n                     extra = optional_tags - set(tested_optional_tags)\n                     if extra:\n-                        return True\n+                        return m.group(0)\n             line_count += 1\n             if line_count >= 10:\n                 break\ndiff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py\nindex a37edbbffc..670a4aa4e6 100644\n--- a/src/sage/misc/sageinspect.py\n+++ b/src/sage/misc/sageinspect.py\n@@ -2031,6 +2031,15 @@ def sage_getdoc(obj, obj_name='', embedded_override=False):\n         return ''\n     r = sage_getdoc_original(obj)\n     s = sage.misc.sagedoc.format(r, embedded=(embedded_override or EMBEDDED_MODE))\n+    f = sage_getfile(obj)\n+    if f:\n+        from sage.doctest.control import skipfile\n+        skip = skipfile(f)\n+        if skip:\n+            warn = \"\"\"WARNING: the enclosing module is marked '{}',\n+so doctests may not pass.\"\"\".format(skip)\n+            s = warn + \"\\n\\n\" + s\n+        pass\n \n     # Fix object naming\n     if obj_name != '':\n```\nThen the help message printed by `obj?` will include a warning if the file is tagged to be skipped. Is it okay if `skipfile` returns a string instead of just `True`?",
    "created_at": "2021-02-19T00:30:18Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494944",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:19'></a>
How about a change like this?

```diff
diff --git a/src/sage/doctest/control.py b/src/sage/doctest/control.py
index 6e75131fb3..0b10e19552 100644
--- a/src/sage/doctest/control.py
+++ b/src/sage/doctest/control.py
@@ -216,6 +216,10 @@ def skipfile(filename, tested_optional_tags=False):
     - ``tested_optional_tags`` - a list or tuple or set of optional tags to test,
       or ``False`` (no optional test) or ``True`` (all optional tests)
 
+    If ``filename`` contains a line of the form ``"# sage.doctest:
+    optional - xyz")``, then this will return ``False`` if "xyz" is in
+    ``tested_optional_tags``. Otherwise, it returns the matching line.
+
     EXAMPLES::
 
         sage: from sage.doctest.control import skipfile
@@ -231,9 +235,11 @@ def skipfile(filename, tested_optional_tags=False):
         sage: with open(filename, "w") as f:
         ....:     _ = f.write("# sage.doctest: optional - xyz")
         sage: skipfile(filename, False)
+        '# sage.doctest: optional - xyz'
+        sage: bool(skipfile(filename, False))
         True
         sage: skipfile(filename, ['abc'])
-        True
+        '# sage.doctest: optional - xyz'
         sage: skipfile(filename, ['abc', 'xyz'])
         False
         sage: skipfile(filename, True)
@@ -252,11 +258,11 @@ def skipfile(filename, tested_optional_tags=False):
                 m = optionalfiledirective_regex.match(line)
                 if m:
                     if tested_optional_tags is False:
-                        return True
+                        return m.group(0)
                     optional_tags = parse_optional_tags('#' + m.group(2))
                     extra = optional_tags - set(tested_optional_tags)
                     if extra:
-                        return True
+                        return m.group(0)
             line_count += 1
             if line_count >= 10:
                 break
diff --git a/src/sage/misc/sageinspect.py b/src/sage/misc/sageinspect.py
index a37edbbffc..670a4aa4e6 100644
--- a/src/sage/misc/sageinspect.py
+++ b/src/sage/misc/sageinspect.py
@@ -2031,6 +2031,15 @@ def sage_getdoc(obj, obj_name='', embedded_override=False):
         return ''
     r = sage_getdoc_original(obj)
     s = sage.misc.sagedoc.format(r, embedded=(embedded_override or EMBEDDED_MODE))
+    f = sage_getfile(obj)
+    if f:
+        from sage.doctest.control import skipfile
+        skip = skipfile(f)
+        if skip:
+            warn = """WARNING: the enclosing module is marked '{}',
+so doctests may not pass.""".format(skip)
+            s = warn + "\n\n" + s
+        pass
 
     # Fix object naming
     if obj_name != '':
```
Then the help message printed by `obj?` will include a warning if the file is tagged to be skipped. Is it okay if `skipfile` returns a string instead of just `True`?



---

archive/issue_comments_494945.json:
```json
{
    "body": "<a id='comment:20'></a>\nI like this idea. How about using `m.group(2)` instead? I don't think the reader needs to know about the syntax of the `# sage.doctest:` directive",
    "created_at": "2021-02-19T01:05:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494945",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
I like this idea. How about using `m.group(2)` instead? I don't think the reader needs to know about the syntax of the `# sage.doctest:` directive



---

archive/issue_comments_494946.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\" to \"[u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\".",
    "created_at": "2021-02-19T04:06:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494946",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)" to "[u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)".



---

archive/issue_comments_494947.json:
```json
{
    "body": "<a id='comment:22'></a>\nHow about this? I also added a bit to the developer's guide.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983\">07818e6</a></td><td><code>trac 30778: when a module is labeled \"optional - xyz\",</code></td></tr></table>\n",
    "created_at": "2021-02-19T04:06:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494947",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:22'></a>
How about this? I also added a bit to the developer's guide.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983">07818e6</a></td><td><code>trac 30778: when a module is labeled "optional - xyz",</code></td></tr></table>




---

archive/issue_comments_494948.json:
```json
{
    "body": "**Changing commit** from \"[b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)\" to \"[07818e626a8a69bee77668969840c98d61f9a983](https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983)\".",
    "created_at": "2021-02-19T04:06:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494948",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a](https://github.com/sagemath/sagetrac-mirror/commit/b92e036d7d6ea6a9e5a8ffd93cdd2804d0f0315a)" to "[07818e626a8a69bee77668969840c98d61f9a983](https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983)".



---

archive/issue_comments_494949.json:
```json
{
    "body": "<a id='comment:23'></a>\nAre there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.\n\nThere are also a couple test failures reported by the patchbot.",
    "created_at": "2021-03-04T19:19:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494949",
    "user": "https://github.com/roed314"
}
```

<a id='comment:23'></a>
Are there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.

There are also a couple test failures reported by the patchbot.



---

archive/issue_comments_494950.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [roed](#comment%3A23):\n> Are there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.\n\n\nIt makes sense for optional extension modules, such as sage.matrix.matrix_gfpn_dense (but I don't know if there are others). Indeed the doctests are one reason why my optional package p_group_cohomology is not part of the sage library, although is is mostly written in Python and Cython and would thus fit well into the Sage library (but should still be an optional package).",
    "created_at": "2021-03-04T20:02:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494950",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:24'></a>
Replying to [roed](#comment%3A23):
> Are there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.


It makes sense for optional extension modules, such as sage.matrix.matrix_gfpn_dense (but I don't know if there are others). Indeed the doctests are one reason why my optional package p_group_cohomology is not part of the sage library, although is is mostly written in Python and Cython and would thus fit well into the Sage library (but should still be an optional package).



---

archive/issue_comments_494951.json:
```json
{
    "body": "<a id='comment:25'></a>\nYes, so let's do #30787...",
    "created_at": "2021-03-04T20:07:19Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494951",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Yes, so let's do #30787...



---

archive/issue_comments_494952.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [roed](#comment%3A23):\n> Are there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.\n\n\nIndeed it would be best to test this on files that are in tree but could be made \"optional\" via the same mechanism that we already use for extensions modules depending on optional packages. Candidates are:\n- modules depending on `giac`\n- modules depending on `brial`\n- modules depending on `ntl`\n- more - see #30666\n\nSince this will require modification of `setup.py`, it's best to do this on top of #31377, #30912",
    "created_at": "2021-03-04T22:34:06Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494952",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Replying to [roed](#comment%3A23):
> Are there any files in the Sage library now that we want to use this feature on?  I think having some examples (in this ticket or a followup) would be good.


Indeed it would be best to test this on files that are in tree but could be made "optional" via the same mechanism that we already use for extensions modules depending on optional packages. Candidates are:
- modules depending on `giac`
- modules depending on `brial`
- modules depending on `ntl`
- more - see #30666

Since this will require modification of `setup.py`, it's best to do this on top of #31377, #30912



---

archive/issue_comments_494953.json:
```json
{
    "body": "**Dependencies:** #31377, #30912, #31377, #30912",
    "created_at": "2021-03-04T22:34:06Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494953",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #31377, #30912, #31377, #30912



---

archive/issue_comments_494954.json:
```json
{
    "body": "**Changing dependencies** from \"#31377, #30912, #31377, #30912\" to \"#31377, #30912\".",
    "created_at": "2021-03-04T22:34:58Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494954",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31377, #30912, #31377, #30912" to "#31377, #30912".



---

archive/issue_comments_494955.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, John Palmieri\".",
    "created_at": "2021-03-04T22:46:14Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494955",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, John Palmieri".



---

archive/issue_events_275941.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-04T22:46:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275941"
}
```



---

archive/issue_events_275942.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-04T22:46:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275942"
}
```



---

archive/issue_comments_494956.json:
```json
{
    "body": "<a id='comment:30'></a>\n... and on top of #30383 because we need to make it possible to use `configure --disable-...` for at least one standard package.",
    "created_at": "2021-03-06T00:32:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494956",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
... and on top of #30383 because we need to make it possible to use `configure --disable-...` for at least one standard package.



---

archive/issue_comments_494957.json:
```json
{
    "body": "**Changing dependencies** from \"#31377, #30912\" to \"#31377, #30912, #30383\".",
    "created_at": "2021-03-06T00:32:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494957",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31377, #30912" to "#31377, #30912, #30383".



---

archive/issue_events_275943.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275943"
}
```



---

archive/issue_events_275944.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275944"
}
```



---

archive/issue_comments_494958.json:
```json
{
    "body": "<a id='comment:31'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494958",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_494959.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f35123cdf0fe7fac80b786af4f660433d5164ed2\">f35123c</a></td><td><code>Merge branch 'develop' into t/30778/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962\">94727df</a></td><td><code>trac 30778: patch sageinspect to not print warning when skipfile returns True.</code></td></tr></table>\n",
    "created_at": "2021-10-01T18:36:42Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494959",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f35123cdf0fe7fac80b786af4f660433d5164ed2">f35123c</a></td><td><code>Merge branch 'develop' into t/30778/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962">94727df</a></td><td><code>trac 30778: patch sageinspect to not print warning when skipfile returns True.</code></td></tr></table>




---

archive/issue_comments_494960.json:
```json
{
    "body": "**Changing commit** from \"[07818e626a8a69bee77668969840c98d61f9a983](https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983)\" to \"[94727df4dbfa1e03c09e89cb87c2433232318962](https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962)\".",
    "created_at": "2021-10-01T18:36:42Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494960",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[07818e626a8a69bee77668969840c98d61f9a983](https://github.com/sagemath/sagetrac-mirror/commit/07818e626a8a69bee77668969840c98d61f9a983)" to "[94727df4dbfa1e03c09e89cb87c2433232318962](https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962)".



---

archive/issue_comments_494961.json:
```json
{
    "body": "<a id='comment:33'></a>\nThis could still use some examples, as mentioned in [comment:23](#comment%3A23) and [comment:26](#comment%3A26).",
    "created_at": "2021-10-01T18:37:55Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494961",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>
This could still use some examples, as mentioned in [comment:23](#comment%3A23) and [comment:26](#comment%3A26).



---

archive/issue_comments_494962.json:
```json
{
    "body": "**Changing dependencies** from \"#31377, #30912, #30383\" to \"\".",
    "created_at": "2021-10-01T19:33:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494962",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#31377, #30912, #30383" to "".



---

archive/issue_comments_494963.json:
```json
{
    "body": "<a id='comment:35'></a>\nAs an example, we could apply it to `src/sage/matrix/matrix_gfpn_dense.pyx` and remove the line-by-line annotations \"# optional: meataxe\".\n\nHowever, as `git grep 'sage:' src/sage/matrix/matrix_gfpn_dense.pyx` shows, there are some doctest lines that are not marked optional. Not sure if they have any value by themselves.",
    "created_at": "2021-10-01T19:39:38Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494963",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
As an example, we could apply it to `src/sage/matrix/matrix_gfpn_dense.pyx` and remove the line-by-line annotations "# optional: meataxe".

However, as `git grep 'sage:' src/sage/matrix/matrix_gfpn_dense.pyx` shows, there are some doctest lines that are not marked optional. Not sure if they have any value by themselves.



---

archive/issue_comments_494964.json:
```json
{
    "body": "<a id='comment:36'></a>\n@simon-king-jena: would you object if we skipped all tests in `src/sage/matrix/matrix_gfpn_dense.pyx` unless `meataxe` is installed? I've skimmed through and don't see anything that (I hope) isn't tested elsewhere for other matrix implementations, but you know this file pretty well.",
    "created_at": "2021-10-01T22:31:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494964",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:36'></a>
@simon-king-jena: would you object if we skipped all tests in `src/sage/matrix/matrix_gfpn_dense.pyx` unless `meataxe` is installed? I've skimmed through and don't see anything that (I hope) isn't tested elsewhere for other matrix implementations, but you know this file pretty well.



---

archive/issue_comments_494965.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [jhpalmieri](#comment%3A36):\n> @simon-king-jena: would you object if we skipped all tests in `src/sage/matrix/matrix_gfpn_dense.pyx` unless `meataxe` is installed? I've skimmed through and don't see anything that (I hope) isn't tested elsewhere for other matrix implementations, but you know this file pretty well.\n\n\nI did not intend to create new tests for other matrix implementations. So, I wouldn't object to make all the module's tests optional. In fact, this is what I asked for since I first created the module.",
    "created_at": "2021-10-02T06:13:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494965",
    "user": "https://github.com/simon-king-jena"
}
```

<a id='comment:37'></a>
Replying to [jhpalmieri](#comment%3A36):
> @simon-king-jena: would you object if we skipped all tests in `src/sage/matrix/matrix_gfpn_dense.pyx` unless `meataxe` is installed? I've skimmed through and don't see anything that (I hope) isn't tested elsewhere for other matrix implementations, but you know this file pretty well.


I did not intend to create new tests for other matrix implementations. So, I wouldn't object to make all the module's tests optional. In fact, this is what I asked for since I first created the module.



---

archive/issue_comments_494966.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\" to \"[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\".",
    "created_at": "2021-10-02T15:48:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494966",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)" to "[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)".



---

archive/issue_comments_494967.json:
```json
{
    "body": "**Changing commit** from \"[94727df4dbfa1e03c09e89cb87c2433232318962](https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962)\" to \"[1276609634a35c5d4b0131661791f4d47f1914cf](https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf)\".",
    "created_at": "2021-10-02T15:49:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494967",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[94727df4dbfa1e03c09e89cb87c2433232318962](https://github.com/sagemath/sagetrac-mirror/commit/94727df4dbfa1e03c09e89cb87c2433232318962)" to "[1276609634a35c5d4b0131661791f4d47f1914cf](https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf)".



---

archive/issue_events_275945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-02T15:49:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275945"
}
```



---

archive/issue_events_275946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-02T15:49:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275946"
}
```



---

archive/issue_comments_494968.json:
```json
{
    "body": "<a id='comment:39'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf\">1276609</a></td><td><code>src/sage/matrix/matrix_gfpn_dense.pyx: Use # sage.doctest: optional - meataxe</code></td></tr></table>\n",
    "created_at": "2021-10-02T15:49:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494968",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf">1276609</a></td><td><code>src/sage/matrix/matrix_gfpn_dense.pyx: Use # sage.doctest: optional - meataxe</code></td></tr></table>




---

archive/issue_comments_494969.json:
```json
{
    "body": "<a id='comment:40'></a>\n(untested)",
    "created_at": "2021-10-02T16:29:19Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494969",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
(untested)



---

archive/issue_comments_494970.json:
```json
{
    "body": "<a id='comment:41'></a>\nThis is working for me the way that I think it should: commands like `make ptestlong` or `./sage -tp src/sage/matrix/` ignore `matrix_gfpn_dense.pyx`, but if you specify the file explicitly (or let the shell specify it with `./sage -tp src/sage/matrix/matrix_g*`), then it gets tested, and of course many tests fail. I think that's the right behavior.",
    "created_at": "2021-10-02T22:09:36Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494970",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:41'></a>
This is working for me the way that I think it should: commands like `make ptestlong` or `./sage -tp src/sage/matrix/` ignore `matrix_gfpn_dense.pyx`, but if you specify the file explicitly (or let the shell specify it with `./sage -tp src/sage/matrix/matrix_g*`), then it gets tested, and of course many tests fail. I think that's the right behavior.



---

archive/issue_comments_494971.json:
```json
{
    "body": "<a id='comment:42'></a>\nRemains to put something in the documentation of `matrix_gfpn_dense.pyx`, as discussed in [comment:8](#comment%3A8), [comment:13](#comment%3A13), [comment:14](#comment%3A14)",
    "created_at": "2021-10-02T22:17:31Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494971",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Remains to put something in the documentation of `matrix_gfpn_dense.pyx`, as discussed in [comment:8](#comment%3A8), [comment:13](#comment%3A13), [comment:14](#comment%3A14)



---

archive/issue_comments_494972.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [mkoeppe](#comment%3A42):\n> Remains to put something in the documentation of `matrix_gfpn_dense.pyx`, as discussed in [comment:8](#comment%3A8), [comment:13](#comment%3A13), [comment:14](#comment%3A14)\n\n\nThis is easy enough to do manually. It would be nice to autodetect the line `# sage.doctest: optional - meataxe`, but do we want to do that here or a follow-up ticket?",
    "created_at": "2021-10-03T19:41:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494972",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:43'></a>
Replying to [mkoeppe](#comment%3A42):
> Remains to put something in the documentation of `matrix_gfpn_dense.pyx`, as discussed in [comment:8](#comment%3A8), [comment:13](#comment%3A13), [comment:14](#comment%3A14)


This is easy enough to do manually. It would be nice to autodetect the line `# sage.doctest: optional - meataxe`, but do we want to do that here or a follow-up ticket?



---

archive/issue_comments_494973.json:
```json
{
    "body": "<a id='comment:44'></a>\nLet's do this manually for this ticket first",
    "created_at": "2021-10-03T20:27:17Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494973",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Let's do this manually for this ticket first



---

archive/issue_comments_494974.json:
```json
{
    "body": "<a id='comment:45'></a>\nIn #32614 I now define some new optional tags, in particular a tag `sage.matrix.matrix_gfpn_dense`. So if we depend on that ticket, we could now write `# sage.doctest: optional - sage.matrix.matrix_gfpn_dense`; and in the module documentation we could refer to the class providing the feature (`sage__matrix__matrix_gfpn_dense`)",
    "created_at": "2021-10-03T23:42:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494974",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
In #32614 I now define some new optional tags, in particular a tag `sage.matrix.matrix_gfpn_dense`. So if we depend on that ticket, we could now write `# sage.doctest: optional - sage.matrix.matrix_gfpn_dense`; and in the module documentation we could refer to the class providing the feature (`sage__matrix__matrix_gfpn_dense`)



---

archive/issue_comments_494975.json:
```json
{
    "body": "**Changing commit** from \"[1276609634a35c5d4b0131661791f4d47f1914cf](https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf)\" to \"[5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)\".",
    "created_at": "2021-10-06T04:17:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494975",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[1276609634a35c5d4b0131661791f4d47f1914cf](https://github.com/sagemath/sagetrac-mirror/commit/1276609634a35c5d4b0131661791f4d47f1914cf)" to "[5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)".



---

archive/issue_comments_494976.json:
```json
{
    "body": "<a id='comment:46'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc\">5cc1288</a></td><td><code>src/sage/matrix/matrix_gfpn_dense.pyx: Add reference to meataxe spkg</code></td></tr></table>\n",
    "created_at": "2021-10-06T04:17:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494976",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:46'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc">5cc1288</a></td><td><code>src/sage/matrix/matrix_gfpn_dense.pyx: Add reference to meataxe spkg</code></td></tr></table>




---

archive/issue_comments_494977.json:
```json
{
    "body": "<a id='comment:47'></a>\nI've kept it simple and just added a note in the docstring.\n\nBut do we actually build HTML documentation for optional compiled modules at all?",
    "created_at": "2021-10-06T04:18:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494977",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
I've kept it simple and just added a note in the docstring.

But do we actually build HTML documentation for optional compiled modules at all?



---

archive/issue_comments_494978.json:
```json
{
    "body": "<a id='comment:48'></a>\nI'm happy with your changes on the ticket: positive review for those parts.",
    "created_at": "2021-10-07T18:22:39Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494978",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:48'></a>
I'm happy with your changes on the ticket: positive review for those parts.



---

archive/issue_comments_494979.json:
```json
{
    "body": "**Reviewer:** John Palmieri, ...",
    "created_at": "2021-10-07T18:22:39Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494979",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri, ...



---

archive/issue_events_275947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-07T18:23:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275947"
}
```



---

archive/issue_events_275948.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-07T18:23:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275948"
}
```



---

archive/issue_comments_494980.json:
```json
{
    "body": "<a id='comment:49'></a>\nThanks!",
    "created_at": "2021-10-07T18:23:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494980",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
Thanks!



---

archive/issue_comments_494981.json:
```json
{
    "body": "**Changing reviewer** from \"John Palmieri, ...\" to \"John Palmieri, Matthias Koeppe\".",
    "created_at": "2021-10-07T18:23:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494981",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "John Palmieri, ..." to "John Palmieri, Matthias Koeppe".



---

archive/issue_events_275949.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-10T10:17:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275949"
}
```



---

archive/issue_events_275950.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-10T10:17:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30778#event-275950"
}
```



---

archive/issue_comments_494982.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)\" to \"[5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)\".",
    "created_at": "2021-10-10T10:17:16Z",
    "issue": "https://github.com/sagemath/sage/issues/30778",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30778#issuecomment-494982",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_doctest_control__exclude_doctests_in_files_from_non_installed_distributions)" to "[5cc1288bec7a4c165723f8fd20d14843547faccc](https://github.com/sagemath/sagetrac-mirror/commit/5cc1288bec7a4c165723f8fd20d14843547faccc)".
