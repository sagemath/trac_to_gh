# Issue 30622: build/bin/sage-spkg: Handle an optional argument to set the installation tree (default SAGE_LOCAL)

archive/issues_030385.json:
```json
{
    "assignees": [],
    "body": "<div id=\"comment:0\"></div>\n\nWe handle a new optional argument to `sage-spkg`, which sets the installation tree - the new variable `SAGE_INST_LOCAL` (default:  `$SAGE_LOCAL`) for the package installation scripts.  (The script `sage-spkg-uninstall` already accepts this optional argument.)\n\nWe also move the definition of `SAGE_SPKG_INST` and `SAGE_SPKG_WHEELS` out of `build/bin/install` into `sage-spkg` (and into `Makefile.in` for script packages). This is so that they can depend on `SAGE_INST_LOCAL`.\n\nThus, the installation location of the installation records now depends on the installation tree - it is `$SAGE_INST_LOCAL/var/lib/sage/{installed,scripts,wheels}`.\n\nThis is preparation for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.\n\n\n\nCC:  @jhpalmieri @orlitzky @kliem\n\nComponent: **build**\n\nKeywords: **sd111**\n\nAuthor: **Matthias Koeppe**\n\nBranch: **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**\n\nReviewer: **Jonathan Kliem**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30622_\n\n",
    "closed_at": "2021-01-03T12:15:39Z",
    "created_at": "2020-09-21T03:19:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "build/bin/sage-spkg: Handle an optional argument to set the installation tree (default SAGE_LOCAL)",
    "type": "issue",
    "updated_at": "2021-01-19T08:27:39Z",
    "url": "https://github.com/sagemath/sage/issues/30622",
    "user": "https://github.com/mkoeppe"
}
```
<div id="comment:0"></div>

We handle a new optional argument to `sage-spkg`, which sets the installation tree - the new variable `SAGE_INST_LOCAL` (default:  `$SAGE_LOCAL`) for the package installation scripts.  (The script `sage-spkg-uninstall` already accepts this optional argument.)

We also move the definition of `SAGE_SPKG_INST` and `SAGE_SPKG_WHEELS` out of `build/bin/install` into `sage-spkg` (and into `Makefile.in` for script packages). This is so that they can depend on `SAGE_INST_LOCAL`.

Thus, the installation location of the installation records now depends on the installation tree - it is `$SAGE_INST_LOCAL/var/lib/sage/{installed,scripts,wheels}`.

This is preparation for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.



CC:  @jhpalmieri @orlitzky @kliem

Component: **build**

Keywords: **sd111**

Author: **Matthias Koeppe**

Branch: **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**

Reviewer: **Jonathan Kliem**

_Issue created by migration from https://trac.sagemath.org/ticket/30622_





---

archive/issue_events_419036.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T03:19:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419036"
}
```



---

archive/issue_events_419037.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T03:19:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419037"
}
```



---

archive/issue_events_419038.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T03:19:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419038"
}
```



---

archive/issue_events_419039.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T03:19:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419039"
}
```



---

archive/issue_events_419040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-21T04:27:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "title_is": "build/bin/sage-spkg: Allow overriding SAGE_LOCAL by SAGE_INST_LOCAL",
    "title_was": "build/bin/sage-spkg: Allow overriding SAGE_LOCAL by SAGE_SPKG_PREFIX",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419040"
}
```



---

archive/issue_comments_488601.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n This is for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.\n \n-`Makefile` would set `SAGE_SPKG_PREFIX=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.\n+`Makefile` would set `SAGE_INST_LOCAL=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.\n \n \n \n``````\n",
    "created_at": "2020-09-21T04:27:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488601",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 This is for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.
 
-`Makefile` would set `SAGE_SPKG_PREFIX=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.
+`Makefile` would set `SAGE_INST_LOCAL=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.
 
 
 
``````




---

archive/issue_comments_488602.json:
```json
{
    "body": "Dependencies: **#29500**",
    "created_at": "2020-09-21T06:10:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488602",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#29500**



---

archive/issue_comments_488603.json:
```json
{
    "body": "Branch: **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)**",
    "created_at": "2020-09-21T06:17:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488603",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)**



---

archive/issue_comments_488604.json:
```json
{
    "body": "Commit: **[`8fc7f9c`](https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9)**",
    "created_at": "2020-09-24T02:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488604",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`8fc7f9c`](https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9)**



---

archive/issue_comments_488605.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8\"><code>f2e7075</code></a></td><td><code>Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9\"><code>8fc7f9c</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>\n",
    "created_at": "2020-09-24T02:31:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488605",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2e707561ab3044221b57151ae4cc67d502fe9f8"><code>f2e7075</code></a></td><td><code>Merge tag '9.2.beta13' into t/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9"><code>8fc7f9c</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>




---

archive/issue_comments_488606.json:
```json
{
    "body": "Changed dependencies from **#29500** to **#29500, #29386**",
    "created_at": "2020-09-24T05:11:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488606",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29500** to **#29500, #29386**



---

archive/issue_comments_488607.json:
```json
{
    "body": "Changed dependencies from **#29500, #29386** to **#29500, #29386, #30657**",
    "created_at": "2020-09-24T22:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488607",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29500, #29386** to **#29500, #29386, #30657**



---

archive/issue_comments_488608.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0f1b7aab59ff88cbb2995287ce6c2de1a12473fc\"><code>0f1b7aa</code></a></td><td><code>build/make/install: Do not set SAGE_SPKG_INST here; set it in build/make/Makefile.in</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1baf8eae8a49e394c33c0b1c3633ab1755db86a5\"><code>1baf8ea</code></a></td><td><code>WIP</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135\"><code>bd0fd2f</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e20f230c0ac0b24c14b04b180217db68a2b7278\"><code>2e20f23</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/be2417cd48549b2c1a9fa29bcd362b08c2a6fda7\"><code>be2417c</code></a></td><td><code>Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ee7ee29ea4686a968846df1621f52adcd8f4173\"><code>8ee7ee2</code></a></td><td><code>build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3\"><code>a713c39</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>\n",
    "created_at": "2020-10-05T01:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488608",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0f1b7aab59ff88cbb2995287ce6c2de1a12473fc"><code>0f1b7aa</code></a></td><td><code>build/make/install: Do not set SAGE_SPKG_INST here; set it in build/make/Makefile.in</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1baf8eae8a49e394c33c0b1c3633ab1755db86a5"><code>1baf8ea</code></a></td><td><code>WIP</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd0fd2f3142b08a906ebdbe3e2f37be6bec5f135"><code>bd0fd2f</code></a></td><td><code>Merge branch 't/29500/install_all_python_packages_via_pip_wheel__create_pep_503_simple_repository_for_wheels' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e20f230c0ac0b24c14b04b180217db68a2b7278"><code>2e20f23</code></a></td><td><code>build/bin/sage-spkg: Move SAGE_SPKG_{INST,SCRIPTS,WHEELS} setting here from build/bin/install, make them relative to SAGE_INST_LOCAL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/be2417cd48549b2c1a9fa29bcd362b08c2a6fda7"><code>be2417c</code></a></td><td><code>Merge tag '9.2.beta14' into t/30657/fix_up__sage__p_</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ee7ee29ea4686a968846df1621f52adcd8f4173"><code>8ee7ee2</code></a></td><td><code>build/make/install: Set SAGE_SPKG_WHEELS also here so that script packages still work</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3"><code>a713c39</code></a></td><td><code>Merge branch 't/30657/fix_up__sage__p_' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>




---

archive/issue_comments_488609.json:
```json
{
    "body": "Changed commit from **[`8fc7f9c`](https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9)** to **[`a713c39`](https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3)**",
    "created_at": "2020-10-05T01:08:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488609",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8fc7f9c`](https://github.com/sagemath/sagetrac-mirror/commit/8fc7f9ca20d6665425d0332070c6e7e3dc3968c9)** to **[`a713c39`](https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3)**



---

archive/issue_comments_488610.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-10-05T02:33:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488610",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_488611.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ef2508a1db39fbbf85e774e4544619494483dc7\"><code>8ef2508</code></a></td><td><code>Merge tag '9.3.beta2' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb\"><code>333c5b5</code></a></td><td><code>build/bin/sage-spkg: Accept installation tree as an optional argument, like sage-spkg-uninstall</code></td></tr></table>\n",
    "created_at": "2020-11-30T03:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488611",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ef2508a1db39fbbf85e774e4544619494483dc7"><code>8ef2508</code></a></td><td><code>Merge tag '9.3.beta2' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb"><code>333c5b5</code></a></td><td><code>build/bin/sage-spkg: Accept installation tree as an optional argument, like sage-spkg-uninstall</code></td></tr></table>




---

archive/issue_comments_488612.json:
```json
{
    "body": "Changed commit from **[`a713c39`](https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3)** to **[`333c5b5`](https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb)**",
    "created_at": "2020-11-30T03:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488612",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a713c39`](https://github.com/sagemath/sagetrac-mirror/commit/a713c390686ce8da37f0c0268059d3b522c0d0d3)** to **[`333c5b5`](https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb)**



---

archive/issue_comments_488613.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,9 @@\n-This is for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.\n+We handle a new optional argument to `sage-spkg`, which sets the installation tree - the new variable `SAGE_INST_LOCAL` (default:  `$SAGE_LOCAL`) for the package installation scripts.  (The script `sage-spkg-uninstall` already accepts this optional argument.)\n \n-`Makefile` would set `SAGE_INST_LOCAL=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.\n+We also move the definition of `SAGE_SPKG_INST` and `SAGE_SPKG_WHEELS` out of `build/bin/install` into `sage-spkg` (and into `Makefile.in` for script packages). This is so that they can depend on `SAGE_INST_LOCAL`.\n+\n+Thus, the installation location of the installation records now depends on the installation tree - it is `$SAGE_INST_LOCAL/var/lib/sage/{installed,scripts,wheels}`.\n+\n+This is preparation for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.\n \n \n-\n``````\n",
    "created_at": "2020-11-30T03:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488613",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,9 @@
-This is for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.
+We handle a new optional argument to `sage-spkg`, which sets the installation tree - the new variable `SAGE_INST_LOCAL` (default:  `$SAGE_LOCAL`) for the package installation scripts.  (The script `sage-spkg-uninstall` already accepts this optional argument.)
 
-`Makefile` would set `SAGE_INST_LOCAL=$SAGE_VENV` for these packages.  This will in particular set the installation location of installation records to `$SAGE_VENV/var/lib/sage/{installed,scripts,wheels}`.
+We also move the definition of `SAGE_SPKG_INST` and `SAGE_SPKG_WHEELS` out of `build/bin/install` into `sage-spkg` (and into `Makefile.in` for script packages). This is so that they can depend on `SAGE_INST_LOCAL`.
+
+Thus, the installation location of the installation records now depends on the installation tree - it is `$SAGE_INST_LOCAL/var/lib/sage/{installed,scripts,wheels}`.
+
+This is preparation for #29013 - which proposes to install Python packages in `$SAGE_VENV` instead of `$SAGE_LOCAL`.
 
 
-
``````




---

archive/issue_comments_488614.json:
```json
{
    "body": "Changed dependencies from **#29500, #29386, #30657** to none",
    "created_at": "2020-11-30T03:08:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488614",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29500, #29386, #30657** to none



---

archive/issue_events_419041.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T03:08:54Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "title_is": "build/bin/sage-spkg: Handle an optional argument to set the installation tree (default SAGE_LOCAL)",
    "title_was": "build/bin/sage-spkg: Allow overriding SAGE_LOCAL by SAGE_INST_LOCAL",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419041"
}
```



---

archive/issue_comments_488615.json:
```json
{
    "body": "Changed commit from **[`333c5b5`](https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb)** to **[`dbbd614`](https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14)**",
    "created_at": "2020-11-30T03:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488615",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`333c5b5`](https://github.com/sagemath/sagetrac-mirror/commit/333c5b5668b7290f074bcf65fc421a58a3cd74eb)** to **[`dbbd614`](https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14)**



---

archive/issue_comments_488616.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14\"><code>dbbd614</code></a></td><td><code>build/bin/sage-spkg: From bash -x back to bash</code></td></tr></table>\n",
    "created_at": "2020-11-30T03:09:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488616",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14"><code>dbbd614</code></a></td><td><code>build/bin/sage-spkg: From bash -x back to bash</code></td></tr></table>




---

archive/issue_events_419042.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T03:15:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419042"
}
```



---

archive/issue_events_419043.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T03:55:27Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419043"
}
```



---

archive/issue_events_419044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T03:55:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419044"
}
```



---

archive/issue_comments_488617.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c\"><code>cb15169</code></a></td><td><code>Makefile, build/make/Makefile.in: Fix 'make list'</code></td></tr></table>\n",
    "created_at": "2020-11-30T04:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488617",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c"><code>cb15169</code></a></td><td><code>Makefile, build/make/Makefile.in: Fix 'make list'</code></td></tr></table>




---

archive/issue_comments_488618.json:
```json
{
    "body": "Changed commit from **[`dbbd614`](https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14)** to **[`cb15169`](https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c)**",
    "created_at": "2020-11-30T04:49:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488618",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dbbd614`](https://github.com/sagemath/sagetrac-mirror/commit/dbbd614955b84bb7379f5222b3717051abc8ab14)** to **[`cb15169`](https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c)**



---

archive/issue_events_419045.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T04:50:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419045"
}
```



---

archive/issue_events_419046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T04:50:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419046"
}
```



---

archive/issue_comments_488619.json:
```json
{
    "body": "Reviewer: **https://github.com/kliem/sage/pull/29/checks**",
    "created_at": "2020-12-04T08:14:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488619",
    "user": "https://github.com/kliem"
}
```

Reviewer: **https://github.com/kliem/sage/pull/29/checks**



---

archive/issue_comments_488620.json:
```json
{
    "body": "Changed keywords from none to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488620",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **sd111**



---

archive/issue_comments_488621.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488621",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_events_419047.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-07T07:10:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419047"
}
```



---

archive/issue_events_419048.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-07T07:10:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419048"
}
```



---

archive/issue_comments_488622.json:
```json
{
    "body": "Changed reviewer from **https://github.com/kliem/sage/pull/29/checks** to **Jonathan Kliem**",
    "created_at": "2020-12-07T07:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488622",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/kliem/sage/pull/29/checks** to **Jonathan Kliem**



---

archive/issue_comments_488623.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nLGTM.",
    "created_at": "2020-12-07T07:10:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488623",
    "user": "https://github.com/kliem"
}
```

<div id="comment:19" align="right">comment:19</div>

LGTM.



---

archive/issue_comments_488624.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThank you!",
    "created_at": "2020-12-07T07:16:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488624",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Thank you!



---

archive/issue_events_419049.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T00:45:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419049"
}
```



---

archive/issue_events_419050.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T00:45:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419050"
}
```



---

archive/issue_comments_488625.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nMerge conflict",
    "created_at": "2020-12-13T00:45:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488625",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:21" align="right">comment:21</div>

Merge conflict



---

archive/issue_comments_488626.json:
```json
{
    "body": "Work Issues: **merge #30375**",
    "created_at": "2020-12-13T01:23:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488626",
    "user": "https://github.com/mkoeppe"
}
```

Work Issues: **merge #30375**



---

archive/issue_comments_488627.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747\"><code>9c5e8a2</code></a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc\"><code>4b8933b</code></a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694\"><code>071b8cc</code></a></td><td><code>Revert \"add references to `bin/sage-build-env` and `bin/sage-build-env-config`\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6\"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91\"><code>aa7ecd6</code></a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e\"><code>94326db</code></a></td><td><code>better solution for dealing with -ffree-form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4\"><code>87dae61</code></a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb\"><code>7577dd4</code></a></td><td><code>added quotes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7\"><code>3bb3099</code></a></td><td><code>prepare preciouos variables</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c\"><code>9c9b3bf</code></a></td><td><code>Merge commit '3bb309944b7e8542b2ac88ed3c9d9a60e68644d7' of git://trac.sagemath.org/sage into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>\n",
    "created_at": "2020-12-13T21:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488627",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747"><code>9c5e8a2</code></a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc"><code>4b8933b</code></a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694"><code>071b8cc</code></a></td><td><code>Revert "add references to `bin/sage-build-env` and `bin/sage-build-env-config`"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91"><code>aa7ecd6</code></a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e"><code>94326db</code></a></td><td><code>better solution for dealing with -ffree-form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4"><code>87dae61</code></a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb"><code>7577dd4</code></a></td><td><code>added quotes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7"><code>3bb3099</code></a></td><td><code>prepare preciouos variables</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c"><code>9c9b3bf</code></a></td><td><code>Merge commit '3bb309944b7e8542b2ac88ed3c9d9a60e68644d7' of git://trac.sagemath.org/sage into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr></table>




---

archive/issue_comments_488628.json:
```json
{
    "body": "Changed commit from **[`cb15169`](https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c)** to **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)**",
    "created_at": "2020-12-13T21:52:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488628",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cb15169`](https://github.com/sagemath/sagetrac-mirror/commit/cb151691167c0317214ddc4657ea5efc2691776c)** to **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)**



---

archive/issue_comments_488629.json:
```json
{
    "body": "Dependencies: **#30375**",
    "created_at": "2020-12-13T22:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488629",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30375**



---

archive/issue_comments_488630.json:
```json
{
    "body": "Changed work issues from **merge #30375** to none",
    "created_at": "2020-12-13T22:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488630",
    "user": "https://github.com/mkoeppe"
}
```

Changed work issues from **merge #30375** to none



---

archive/issue_comments_488631.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nMerged #30375",
    "created_at": "2020-12-13T22:01:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488631",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Merged #30375



---

archive/issue_events_419051.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-13T22:01:25Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419051"
}
```



---

archive/issue_events_419052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-13T22:01:25Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419052"
}
```



---

archive/issue_comments_488632.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)** to **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)**",
    "created_at": "2020-12-21T23:35:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488632",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)** to **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)**



---

archive/issue_events_419053.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-21T23:35:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419053"
}
```



---

archive/issue_events_419054.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-21T23:35:28Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419054"
}
```



---

archive/issue_comments_488633.json:
```json
{
    "body": "Changed branch from **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)** to **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)**",
    "created_at": "2020-12-27T23:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488633",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)** to **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)**



---

archive/issue_comments_488634.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nBreaks making source tarballs:\n\n```\nSage version 9.3.beta5, release date 2020-12-27\nCloning into '/home/release/Sage/tmp/sage-9.3.beta5'...\ndone.\nEnumerating objects: 737573, done.\nCounting objects: 100% (737573/737573), done.\nDelta compression using up to 16 threads\nCompressing objects: 100% (702757/702757), done.\nWriting objects: 100% (737573/737573), done.\nTotal 737573 (delta 588187), reused 141018 (delta 0), pack-reused 0\nChecking connectivity: 737573, done.\nFinished cloning Sage sources\nMakefile:22: *** This Makefile needs to be invoked by build/make/install.  Stop.\nTraceback (most recent call last):\n  File \"/home/release/opt/bin/git-releasemgr\", line 16, in <module>\n    cmdline.launch()\n  File \"/home/release/opt/git-trac-command/git_trac/releasemgr/cmdline.py\", line 166, in launch\n    app.release(args.version, check=args.check)\n  File \"/home/release/opt/git-trac-command/git_trac/releasemgr/app.py\", line 315, in release\n    create_tarball()\n  File \"/home/release/opt/git-trac-command/git_trac/releasemgr/make_release.py\", line 15, in create_tarball\n    check_call(['sage', '-sdist'])\n  File \"/home/release/opt/conda/lib/python2.7/subprocess.py\", line 190, in check_call\n    raise CalledProcessError(retcode, cmd)\nsubprocess.CalledProcessError: Command '['sage', '-sdist']' returned non-zero exit status 2\n```",
    "created_at": "2020-12-27T23:56:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488634",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:26" align="right">comment:26</div>

Breaks making source tarballs:

```
Sage version 9.3.beta5, release date 2020-12-27
Cloning into '/home/release/Sage/tmp/sage-9.3.beta5'...
done.
Enumerating objects: 737573, done.
Counting objects: 100% (737573/737573), done.
Delta compression using up to 16 threads
Compressing objects: 100% (702757/702757), done.
Writing objects: 100% (737573/737573), done.
Total 737573 (delta 588187), reused 141018 (delta 0), pack-reused 0
Checking connectivity: 737573, done.
Finished cloning Sage sources
Makefile:22: *** This Makefile needs to be invoked by build/make/install.  Stop.
Traceback (most recent call last):
  File "/home/release/opt/bin/git-releasemgr", line 16, in <module>
    cmdline.launch()
  File "/home/release/opt/git-trac-command/git_trac/releasemgr/cmdline.py", line 166, in launch
    app.release(args.version, check=args.check)
  File "/home/release/opt/git-trac-command/git_trac/releasemgr/app.py", line 315, in release
    create_tarball()
  File "/home/release/opt/git-trac-command/git_trac/releasemgr/make_release.py", line 15, in create_tarball
    check_call(['sage', '-sdist'])
  File "/home/release/opt/conda/lib/python2.7/subprocess.py", line 190, in check_call
    raise CalledProcessError(retcode, cmd)
subprocess.CalledProcessError: Command '['sage', '-sdist']' returned non-zero exit status 2
```



---

archive/issue_events_419055.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T23:56:09Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419055"
}
```



---

archive/issue_comments_488635.json:
```json
{
    "body": "<div id=\"comment:27\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36e8f7d02778f3d767bfb3a74980bc4ff979e65c\"><code>36e8f7d</code></a></td><td><code>Merge tag '9.3.beta5' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc\"><code>062ef92</code></a></td><td><code>build/make/Makefile.in: Fix up 'make dist'</code></td></tr></table>\n",
    "created_at": "2020-12-28T04:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488635",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:27"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36e8f7d02778f3d767bfb3a74980bc4ff979e65c"><code>36e8f7d</code></a></td><td><code>Merge tag '9.3.beta5' into t/30622/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc"><code>062ef92</code></a></td><td><code>build/make/Makefile.in: Fix up 'make dist'</code></td></tr></table>




---

archive/issue_comments_488636.json:
```json
{
    "body": "Changed commit from **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)** to **[`062ef92`](https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc)**",
    "created_at": "2020-12-28T04:31:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488636",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c9b3bf`](https://github.com/sagemath/sagetrac-mirror/commit/9c9b3bf8a52544285935dac66e0589769bac363c)** to **[`062ef92`](https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc)**



---

archive/issue_events_419056.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-28T04:32:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419056"
}
```



---

archive/issue_comments_488637.json:
```json
{
    "body": "Changed dependencies from **#30375** to none",
    "created_at": "2020-12-28T04:36:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488637",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30375** to none



---

archive/issue_comments_488638.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThere is two small things that could be fixed along the way:\n- `make dist` does not appear in `make --help`.\n- `local/bin/sage-sdist` claims it should be called by `spkg/bin/sage`, but it is really run by `local/bin/sage`.\n\nThe error message `This Makefile needs to be invoked by build/make/install` seems strange, as there is at least one other legal way to call the Makefile, as we discovered here. If it is not included in the message, I think the comment should be more verbose.",
    "created_at": "2020-12-28T07:07:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488638",
    "user": "https://github.com/kliem"
}
```

<div id="comment:30" align="right">comment:30</div>

There is two small things that could be fixed along the way:
- `make dist` does not appear in `make --help`.
- `local/bin/sage-sdist` claims it should be called by `spkg/bin/sage`, but it is really run by `local/bin/sage`.

The error message `This Makefile needs to be invoked by build/make/install` seems strange, as there is at least one other legal way to call the Makefile, as we discovered here. If it is not included in the message, I think the comment should be more verbose.



---

archive/issue_comments_488639.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab\"><code>6eb8f26</code></a></td><td><code>build/bin/sage-sdist: Update file comment</code></td></tr></table>\n",
    "created_at": "2020-12-28T18:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488639",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab"><code>6eb8f26</code></a></td><td><code>build/bin/sage-sdist: Update file comment</code></td></tr></table>




---

archive/issue_comments_488640.json:
```json
{
    "body": "Changed commit from **[`062ef92`](https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc)** to **[`6eb8f26`](https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab)**",
    "created_at": "2020-12-28T18:19:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488640",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`062ef92`](https://github.com/sagemath/sagetrac-mirror/commit/062ef926118ea779aec0af92530079f140f276bc)** to **[`6eb8f26`](https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab)**



---

archive/issue_comments_488641.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@kliem](#comment%3A30):\n> There is two small things that could be fixed along the way:\n> - `make dist` does not appear in `make --help`.\n\nMy version of `make` here on macOS does not list any targets on `make --help`. In any case, beyond the scope of the ticket.\n\n> - `local/bin/sage-sdist` claims it should be called by `spkg/bin/sage`, but it is really run by `local/bin/sage`.\n\nUpdated.",
    "created_at": "2020-12-28T18:21:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488641",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@kliem](#comment%3A30):
> There is two small things that could be fixed along the way:
> - `make dist` does not appear in `make --help`.

My version of `make` here on macOS does not list any targets on `make --help`. In any case, beyond the scope of the ticket.

> - `local/bin/sage-sdist` claims it should be called by `spkg/bin/sage`, but it is really run by `local/bin/sage`.

Updated.



---

archive/issue_comments_488642.json:
```json
{
    "body": "Changed commit from **[`6eb8f26`](https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab)** to **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**",
    "created_at": "2020-12-28T18:22:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488642",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6eb8f26`](https://github.com/sagemath/sagetrac-mirror/commit/6eb8f26b9edfa806c8b5e2453d6b6f6e0f54b5ab)** to **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**



---

archive/issue_comments_488643.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94\"><code>7ea44f7</code></a></td><td><code>build/make/Makefile.in: Expand comment</code></td></tr></table>\n",
    "created_at": "2020-12-28T18:22:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488643",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94"><code>7ea44f7</code></a></td><td><code>build/make/Makefile.in: Expand comment</code></td></tr></table>




---

archive/issue_comments_488644.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nBack to positive review.",
    "created_at": "2020-12-29T08:48:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488644",
    "user": "https://github.com/kliem"
}
```

<div id="comment:34" align="right">comment:34</div>

Back to positive review.



---

archive/issue_events_419057.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-29T08:48:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419057"
}
```



---

archive/issue_events_419058.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-29T08:48:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419058"
}
```



---

archive/issue_comments_488645.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThanks.",
    "created_at": "2020-12-29T18:21:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488645",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Thanks.



---

archive/issue_comments_488646.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)** to **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**",
    "created_at": "2021-01-03T12:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488646",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_spkg__allow_overriding_sage_local_by_sage_spkg_prefix)** to **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)**



---

archive/issue_events_419059.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419059"
}
```



---

archive/issue_events_419060.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "14c8043459b189ad2b18e8006743a8063a8502ad",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-03T12:15:39Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30622#event-419060"
}
```



---

archive/issue_comments_488647.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nApparently we broke `sage -b` with this ticket.",
    "created_at": "2021-01-19T08:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488647",
    "user": "https://github.com/kliem"
}
```

<div id="comment:37" align="right">comment:37</div>

Apparently we broke `sage -b` with this ticket.



---

archive/issue_comments_488648.json:
```json
{
    "body": "Changed commit from **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)** to none",
    "created_at": "2021-01-19T08:27:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30622",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30622#issuecomment-488648",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`7ea44f7`](https://github.com/sagemath/sagetrac-mirror/commit/7ea44f7f8faf65d0061d97b53a53e73151716d94)** to none
