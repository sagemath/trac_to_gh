# Issue 30549: Remove all the bitset access from cython files in combinatorial polyhedron

archive/issues_030312.json:
```json
{
    "assignees": [],
    "body": "This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.\n\nThis ticket is mostly resolved in smaller tickets:\n- #30596: Outsource functions in bitset.pxi that can be optimized by intrinsics \n- #30597: Define a sparse bitset structure \n- #30601: Move bitset.pxi to bitset_base.pxd\n- #30598: Define a new data structure for a combinatorial face \n- #30599: Define a new data structure for a list of combinatorial faces   - \n\nChanges are:\n\n1. Move functions optimizable by intrinsics to a seperate file (`\tsrc/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)\n2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.\n3. Move `bitset.pxi` to `bitset_base.pxd`.\n4. Define a data structure `face_s` that gathers properties of a face and corresponding functions.\n5. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.\n6. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.\n\nThe features of those changes are mainly:\n\n- Less involved signatures of functions.\n- Removing duplications of code.\n- New flavors of the algorithm can be implemented without messing up all the files.\n- We may enrich `face_s` without changing all our code.\n- Intrinsics can easily applied to bitsets in general.\n\nDepends on #30529\n\nCC:  @jplab @LaisRast @tscrim\n\nKeywords: **combinatorial polyhedron, bitsets**\n\nBranch/Commit: **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30549_\n\n",
    "closed_at": "2020-12-13T20:30:42Z",
    "created_at": "2020-09-10T14:58:52Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Remove all the bitset access from cython files in combinatorial polyhedron",
    "type": "issue",
    "updated_at": "2020-12-13T20:30:42Z",
    "url": "https://github.com/sagemath/sage/issues/30549",
    "user": "https://github.com/kliem"
}
```
This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.

This ticket is mostly resolved in smaller tickets:
- #30596: Outsource functions in bitset.pxi that can be optimized by intrinsics 
- #30597: Define a sparse bitset structure 
- #30601: Move bitset.pxi to bitset_base.pxd
- #30598: Define a new data structure for a combinatorial face 
- #30599: Define a new data structure for a list of combinatorial faces   - 

Changes are:

1. Move functions optimizable by intrinsics to a seperate file (`	src/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)
2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.
3. Move `bitset.pxi` to `bitset_base.pxd`.
4. Define a data structure `face_s` that gathers properties of a face and corresponding functions.
5. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.
6. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.

The features of those changes are mainly:

- Less involved signatures of functions.
- Removing duplications of code.
- New flavors of the algorithm can be implemented without messing up all the files.
- We may enrich `face_s` without changing all our code.
- Intrinsics can easily applied to bitsets in general.

Depends on #30529

CC:  @jplab @LaisRast @tscrim

Keywords: **combinatorial polyhedron, bitsets**

Branch/Commit: **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**

Reviewer: **Travis Scrimshaw**

Author: **Jonathan Kliem**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/30549_





---

archive/issue_events_418033.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-10T14:58:52Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418033"
}
```



---

archive/issue_events_418034.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-10T14:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418034"
}
```



---

archive/issue_events_418035.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-10T14:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418035"
}
```



---

archive/issue_events_418036.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-10T14:58:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418036"
}
```



---

archive/issue_comments_487252.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIt's a patch bomb, I know. If anyone knows a reasonable way around it, I'll do it.\n\nCurrently, this is working again and I'm happy. And it's so much easier to do some something from then on.\n\nMost of the changes in the cython files are trivial (took me a while to figure out everything though).\n\nThe current branch is a bit of regression with non-simple-non-simplicial polyhedra. It can take much longer. One thing is the unnecessary union of coatoms. Also the branch prediction seems to be bad, because one could know much earlier that the coatom check is useless. I'll think about a solution that works well.\n\nWe waste a bit of memory by also allocating enough space for the coatoms in each case, but I wouldn't worry about it for now. In a worst case scenario this needs twice as much memory and much less in many scenarios that have less equal number of vertices/facets. Memory was never an issue for me, it was always time.",
    "created_at": "2020-09-10T19:31:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487252",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1" align="right">comment:1</div>

It's a patch bomb, I know. If anyone knows a reasonable way around it, I'll do it.

Currently, this is working again and I'm happy. And it's so much easier to do some something from then on.

Most of the changes in the cython files are trivial (took me a while to figure out everything though).

The current branch is a bit of regression with non-simple-non-simplicial polyhedra. It can take much longer. One thing is the unnecessary union of coatoms. Also the branch prediction seems to be bad, because one could know much earlier that the coatom check is useless. I'll think about a solution that works well.

We waste a bit of memory by also allocating enough space for the coatoms in each case, but I wouldn't worry about it for now. In a worst case scenario this needs twice as much memory and much less in many scenarios that have less equal number of vertices/facets. Memory was never an issue for me, it was always time.



---

archive/issue_comments_487253.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7fee539f4e2fe95cf84a30cf93cce3582684bcc\"><code>b7fee53</code></a></td><td><code>factor out the algorithm variant with templates</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fd5edeb91e42438ecf3be7b4faf55d72407e91c6\"><code>fd5edeb</code></a></td><td><code>one more inline</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4c2cc9f447ee7fbca0dccd09b4f8414d709fbbaf\"><code>4c2cc9f</code></a></td><td><code>always compile all dependend files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2\"><code>349e105</code></a></td><td><code>documentation</code></td></tr></table>\n",
    "created_at": "2020-09-11T14:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487253",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7fee539f4e2fe95cf84a30cf93cce3582684bcc"><code>b7fee53</code></a></td><td><code>factor out the algorithm variant with templates</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fd5edeb91e42438ecf3be7b4faf55d72407e91c6"><code>fd5edeb</code></a></td><td><code>one more inline</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4c2cc9f447ee7fbca0dccd09b4f8414d709fbbaf"><code>4c2cc9f</code></a></td><td><code>always compile all dependend files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2"><code>349e105</code></a></td><td><code>documentation</code></td></tr></table>




---

archive/issue_comments_487254.json:
```json
{
    "body": "Changed commit from **[`1e4596e`](https://github.com/sagemath/sagetrac-mirror/commit/1e4596efe1690719b824fcf5ed26aa7f7d9bac7a)** to **[`349e105`](https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2)**",
    "created_at": "2020-09-11T14:21:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487254",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1e4596e`](https://github.com/sagemath/sagetrac-mirror/commit/1e4596efe1690719b824fcf5ed26aa7f7d9bac7a)** to **[`349e105`](https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2)**



---

archive/issue_events_418037.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-11T14:53:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418037"
}
```



---

archive/issue_comments_487255.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm happy with the ticket as it is.\n\nUsing templates for the two algorithmic variants, the branch prediction has improved significantly. For extreme cases (see below), things got a bit slower. I don't know why.\n\nIn a future ticket one can spare allocating the memory for the coatoms in case we are not using the simple/simplicial algorithm. It doesn't seem to make a difference in runtime.\n\nThis is an example of slight slowdown:\n\n```\nsage: P = polytopes.permutahedron(6)                                                                                                                                  \nsage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                \nsage: R = P.join(Q)                                                                                                                                                   \nsage: C = CombinatorialPolyhedron(R)                                                                                                                                  \nsage: %time _ = C.f_vector()                                                                                                                                              \nCPU times: user 1min 12s, sys: 28.8 ms, total: 1min 12s\nWall time: 1min 12s\n```\nThis is 10 seconds faster on #30040.\n\nI could also play around with constants etc.\n\nThis could also all be because the compiler ignores my `inline` instructions in places.\n\nAnyway, I can live with the slight slowdown for now, because the structure is so much better for further improvements.\n\nAny suggestions on how to improve things are welcome.",
    "created_at": "2020-09-11T14:53:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487255",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm happy with the ticket as it is.

Using templates for the two algorithmic variants, the branch prediction has improved significantly. For extreme cases (see below), things got a bit slower. I don't know why.

In a future ticket one can spare allocating the memory for the coatoms in case we are not using the simple/simplicial algorithm. It doesn't seem to make a difference in runtime.

This is an example of slight slowdown:

```
sage: P = polytopes.permutahedron(6)                                                                                                                                  
sage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                
sage: R = P.join(Q)                                                                                                                                                   
sage: C = CombinatorialPolyhedron(R)                                                                                                                                  
sage: %time _ = C.f_vector()                                                                                                                                              
CPU times: user 1min 12s, sys: 28.8 ms, total: 1min 12s
Wall time: 1min 12s
```
This is 10 seconds faster on #30040.

I could also play around with constants etc.

This could also all be because the compiler ignores my `inline` instructions in places.

Anyway, I can live with the slight slowdown for now, because the structure is so much better for further improvements.

Any suggestions on how to improve things are welcome.



---

archive/issue_comments_487256.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nhttps://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html\n\nIf this is better, I could move almost everything back to cython again.\n\nThe only thing that really needs to be in C/C++ are those 4 functions that I want to optimize with intrinsics later on (there are going to be a few more, but they are all tiny).\nTo my knowledge you cannot do something like\n\n```\n#if __AVX__\ndef foo(): return 1\n#elif __SSE4_1__\ndef foo(): return 2\n#else\ndef foo(): return 3\n#endif\n```\nin cython.\n\nHowever I don't know how the performance is, when you include critical `C/C++` function via `cdef extern from` that will be called a huge number of times.",
    "created_at": "2020-09-11T15:26:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487256",
    "user": "https://github.com/kliem"
}
```

<div id="comment:4" align="right">comment:4</div>

https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html

If this is better, I could move almost everything back to cython again.

The only thing that really needs to be in C/C++ are those 4 functions that I want to optimize with intrinsics later on (there are going to be a few more, but they are all tiny).
To my knowledge you cannot do something like

```
#if __AVX__
def foo(): return 1
#elif __SSE4_1__
def foo(): return 2
#else
def foo(): return 3
#endif
```
in cython.

However I don't know how the performance is, when you include critical `C/C++` function via `cdef extern from` that will be called a huge number of times.



---

archive/issue_events_418038.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-11T18:22:28Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418038"
}
```



---

archive/issue_events_418039.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-11T18:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418039"
}
```



---

archive/issue_comments_487257.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAlso I'm happy with it now, the current status would force to move quite a lot of `bitsets` to C++. If I want to do it (which I'm not sure of yet) I would need to ask other people about it.\n\nSo for now this is a design proposal.",
    "created_at": "2020-09-11T18:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487257",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">comment:5</div>

Also I'm happy with it now, the current status would force to move quite a lot of `bitsets` to C++. If I want to do it (which I'm not sure of yet) I would need to ask other people about it.

So for now this is a design proposal.



---

archive/issue_comments_487258.json:
```json
{
    "body": "Changed commit from **[`349e105`](https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2)** to **[`74230a1`](https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db)**",
    "created_at": "2020-09-16T09:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487258",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`349e105`](https://github.com/sagemath/sagetrac-mirror/commit/349e10564a54037efbd4e81bc592cd2d9dc3cbd2)** to **[`74230a1`](https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db)**



---

archive/issue_comments_487259.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/face_structure)** to **[u/gh-kliem/use_face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/use_face_structure)**",
    "created_at": "2020-09-16T09:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487259",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/gh-kliem/face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/face_structure)** to **[u/gh-kliem/use_face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/use_face_structure)**



---

archive/issue_comments_487260.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI like it much better now.\n\nTimings with this ticket (branch `u/gh-kliem/use_face_structure`):\n\n(Note that I didn't apply new tricks to the algorithm. Only the data structure has changed.)\n\n```\nsage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                            \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 648 ms, sys: 15 \u00b5s, total: 648 ms\nWall time: 648 ms\n\nsage: P = polytopes.associahedron(['A',10], backend='normaliz')                                                                                                                     \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 1.97 s, sys: 0 ns, total: 1.97 s\nWall time: 1.97 s\n\nsage: P = polytopes.permutahedron(7)                                                                                                                                                \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                               \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 242 ms, sys: 0 ns, total: 242 ms\nWall time: 241 ms\n\nsage: P = polytopes.hypercube(12)                                                                                                                                                   \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                               \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 430 ms, sys: 0 ns, total: 430 ms\nWall time: 429 ms\n\nsage: P = polytopes.permutahedron(6)                                                                                                                                                \nsage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                              \nsage: R = P.join(Q)                                                                                                                                                                 \nsage: C = CombinatorialPolyhedron(R)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 1min 11s, sys: 31.8 ms, total: 1min 11s\nWall time: 1min 11s\n```\n\nTimings on #30040:\n\n```\nsage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                            \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 680 ms, sys: 0 ns, total: 680 ms\nWall time: 679 ms\n\nsage: P = polytopes.associahedron(['A',10], backend='normaliz')                                                                                                                     \nsage: C = CombinatorialPolyhedron(P)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 2.2 s, sys: 45 \u00b5s, total: 2.2 s\nWall time: 2.2 s\n\nsage: P = polytopes.permutahedron(7)                                                                                                                                                \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                               \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 240 ms, sys: 0 ns, total: 240 ms\nWall time: 239 ms\n\nsage: P = polytopes.hypercube(12)                                                                                                                                                   \nsage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       \nsage: C = CombinatorialPolyhedron(P1)                                                                                                                                               \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 414 ms, sys: 0 ns, total: 414 ms\nWall time: 413 ms\n\nsage: P = polytopes.permutahedron(6)                                                                                                                                                \nsage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                              \nsage: R = P.join(Q)                                                                                                                                                                 \nsage: C = CombinatorialPolyhedron(R)                                                                                                                                                \nsage: %time _ = C.f_vector()                                                                                                                                                        \nCPU times: user 1min 4s, sys: 51.6 ms, total: 1min 4s\nWall time: 1min 4s\n```\n\nSo I would say that there is no performance-wise reason to reject the changes.\n\nThe branch indicates a bit, how this could be split into seperate tickets that are doable to review.\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bb49546888d249249e42f3e864a78c9d2ab3145d\"><code>bb49546</code></a></td><td><code>face_list_t</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bc8f985b8385149cf41750f55bd6474e3d68a1ba\"><code>bc8f985</code></a></td><td><code>add find and sort</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/43ee71d72948185db5e41f4b0cc49462f562a1c0\"><code>43ee71d</code></a></td><td><code>fixes to list_of_faces.pxi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/31544ff63606a218fdc588ddc8534ec43bcdb9fe\"><code>31544ff</code></a></td><td><code>merge u/gh-kliem/no_more_basic_access</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d42e5abafa8d2fb4cc32f72c1c1d06cf2de0b327\"><code>d42e5ab</code></a></td><td><code>remove new declarations for now</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a32286a203e22f6d04c449301d3370560ee0291\"><code>7a32286</code></a></td><td><code>removed deprecated functions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af27e0256bc049fe6046df6fc2a69789c8b00ddf\"><code>af27e02</code></a></td><td><code>remove doctests that rely on implementation details</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fe30622e43c5aa2cb72cc9236fe041c781e78311\"><code>fe30622</code></a></td><td><code>Merge branch 'u/gh-kliem/prepare_conversions_for_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df3a2546a090c4b7b2a6d4e5ca610122e5ec4a53\"><code>df3a254</code></a></td><td><code>delete old files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db\"><code>74230a1</code></a></td><td><code>use face_list_t and face_t for combinatorial polyhedron</code></td></tr></table>\n",
    "created_at": "2020-09-16T09:24:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487260",
    "user": "https://github.com/kliem"
}
```

<div id="comment:6" align="right">comment:6</div>

I like it much better now.

Timings with this ticket (branch `u/gh-kliem/use_face_structure`):

(Note that I didn't apply new tricks to the algorithm. Only the data structure has changed.)

```
sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                            
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 648 ms, sys: 15 µs, total: 648 ms
Wall time: 648 ms

sage: P = polytopes.associahedron(['A',10], backend='normaliz')                                                                                                                     
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 1.97 s, sys: 0 ns, total: 1.97 s
Wall time: 1.97 s

sage: P = polytopes.permutahedron(7)                                                                                                                                                
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                               
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 242 ms, sys: 0 ns, total: 242 ms
Wall time: 241 ms

sage: P = polytopes.hypercube(12)                                                                                                                                                   
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                               
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 430 ms, sys: 0 ns, total: 430 ms
Wall time: 429 ms

sage: P = polytopes.permutahedron(6)                                                                                                                                                
sage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                              
sage: R = P.join(Q)                                                                                                                                                                 
sage: C = CombinatorialPolyhedron(R)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 1min 11s, sys: 31.8 ms, total: 1min 11s
Wall time: 1min 11s
```

Timings on #30040:

```
sage: P = polytopes.permutahedron(8, backend='normaliz')                                                                                                                            
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 680 ms, sys: 0 ns, total: 680 ms
Wall time: 679 ms

sage: P = polytopes.associahedron(['A',10], backend='normaliz')                                                                                                                     
sage: C = CombinatorialPolyhedron(P)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 2.2 s, sys: 45 µs, total: 2.2 s
Wall time: 2.2 s

sage: P = polytopes.permutahedron(7)                                                                                                                                                
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                               
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 240 ms, sys: 0 ns, total: 240 ms
Wall time: 239 ms

sage: P = polytopes.hypercube(12)                                                                                                                                                   
sage: P1 = P.stack(next(P.face_generator(1)))                                                                                                                                       
sage: C = CombinatorialPolyhedron(P1)                                                                                                                                               
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 414 ms, sys: 0 ns, total: 414 ms
Wall time: 413 ms

sage: P = polytopes.permutahedron(6)                                                                                                                                                
sage: Q = P.base_extend(QQ).polar(in_affine_span=True)                                                                                                                              
sage: R = P.join(Q)                                                                                                                                                                 
sage: C = CombinatorialPolyhedron(R)                                                                                                                                                
sage: %time _ = C.f_vector()                                                                                                                                                        
CPU times: user 1min 4s, sys: 51.6 ms, total: 1min 4s
Wall time: 1min 4s
```

So I would say that there is no performance-wise reason to reject the changes.

The branch indicates a bit, how this could be split into seperate tickets that are doable to review.

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bb49546888d249249e42f3e864a78c9d2ab3145d"><code>bb49546</code></a></td><td><code>face_list_t</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bc8f985b8385149cf41750f55bd6474e3d68a1ba"><code>bc8f985</code></a></td><td><code>add find and sort</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/43ee71d72948185db5e41f4b0cc49462f562a1c0"><code>43ee71d</code></a></td><td><code>fixes to list_of_faces.pxi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/31544ff63606a218fdc588ddc8534ec43bcdb9fe"><code>31544ff</code></a></td><td><code>merge u/gh-kliem/no_more_basic_access</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d42e5abafa8d2fb4cc32f72c1c1d06cf2de0b327"><code>d42e5ab</code></a></td><td><code>remove new declarations for now</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a32286a203e22f6d04c449301d3370560ee0291"><code>7a32286</code></a></td><td><code>removed deprecated functions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af27e0256bc049fe6046df6fc2a69789c8b00ddf"><code>af27e02</code></a></td><td><code>remove doctests that rely on implementation details</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fe30622e43c5aa2cb72cc9236fe041c781e78311"><code>fe30622</code></a></td><td><code>Merge branch 'u/gh-kliem/prepare_conversions_for_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df3a2546a090c4b7b2a6d4e5ca610122e5ec4a53"><code>df3a254</code></a></td><td><code>delete old files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db"><code>74230a1</code></a></td><td><code>use face_list_t and face_t for combinatorial polyhedron</code></td></tr></table>




---

archive/issue_comments_487261.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,13 +1,23 @@\n-This ticket removes all the top level bitset access. The algorithm is cleanly separated from the data structure now.\n+This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.\n \n-There is a new file `bitsets.cpp` (already introduced in #30528). This file should eventually be merged with `data_structures/bitsets.pxd` (and now one can see that such a thing is possible).\n+This ticket should eventually be resolved in many smaller tickets.\n \n-There is a file `face.cpp` that grabs what seems to be useful to define a face.\n+Changes are:\n \n-There is `face_list.cpp`. Here a list of faces is defined as a structure and some common methods that make sense for lists of faces are defined (such as intersect a face with a list of other faces and `get_next_level`).\n+1. Move functions optimizable by intrinsics to a seperate file (`\tsrc/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)\n \n-There are two new structures: `face_list_struct` and `face_struct`. `face_list_struct` is more or less public. `face_struct` is pretty much private. Only the provided functions should be used with it.\n+2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.\n \n-The signatures of functions/methods became a lot easier. Cython files do not have to worry about alignment or `face_length` etc. Memory allocation is still done by `MemoryAllocator`. The low level file iteratively requests all the memory to define a face.\n+3. Define a data structure `face_s` that gathers properties of a face and corresponding functions.\n \n-With this ticket, one can easily adapt the data structure for combinatorial faces to almost anything one likes. Hopefully without changing the cython files.\n+4. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.\n+\n+5. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.\n+\n+The features of those changes are mainly:\n+\n+- Less involved signatures of functions.\n+- Removing duplications of code.\n+- New flavors of the algorithm can be implemented without messing up all the files.\n+- We may enrich `face_s` without changing all our code.\n+- Intrinsics can easily applied to bitsets in general.\n``````\n",
    "created_at": "2020-09-16T09:43:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487261",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,13 +1,23 @@
-This ticket removes all the top level bitset access. The algorithm is cleanly separated from the data structure now.
+This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.
 
-There is a new file `bitsets.cpp` (already introduced in #30528). This file should eventually be merged with `data_structures/bitsets.pxd` (and now one can see that such a thing is possible).
+This ticket should eventually be resolved in many smaller tickets.
 
-There is a file `face.cpp` that grabs what seems to be useful to define a face.
+Changes are:
 
-There is `face_list.cpp`. Here a list of faces is defined as a structure and some common methods that make sense for lists of faces are defined (such as intersect a face with a list of other faces and `get_next_level`).
+1. Move functions optimizable by intrinsics to a seperate file (`	src/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)
 
-There are two new structures: `face_list_struct` and `face_struct`. `face_list_struct` is more or less public. `face_struct` is pretty much private. Only the provided functions should be used with it.
+2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.
 
-The signatures of functions/methods became a lot easier. Cython files do not have to worry about alignment or `face_length` etc. Memory allocation is still done by `MemoryAllocator`. The low level file iteratively requests all the memory to define a face.
+3. Define a data structure `face_s` that gathers properties of a face and corresponding functions.
 
-With this ticket, one can easily adapt the data structure for combinatorial faces to almost anything one likes. Hopefully without changing the cython files.
+4. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.
+
+5. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.
+
+The features of those changes are mainly:
+
+- Less involved signatures of functions.
+- Removing duplications of code.
+- New flavors of the algorithm can be implemented without messing up all the files.
+- We may enrich `face_s` without changing all our code.
+- Intrinsics can easily applied to bitsets in general.
``````




---

archive/issue_comments_487262.json:
```json
{
    "body": "Changed dependencies from **#30528, #30529** to **#30528, #30529, #30572**",
    "created_at": "2020-09-16T09:54:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487262",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30528, #30529** to **#30528, #30529, #30572**



---

archive/issue_comments_487263.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI posted on sage devel on whether the proposed design is acceptable:\nhttps://groups.google.com/g/sage-devel/c/jD9BY5Ozlko",
    "created_at": "2020-09-16T10:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487263",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">comment:9</div>

I posted on sage devel on whether the proposed design is acceptable:
https://groups.google.com/g/sage-devel/c/jD9BY5Ozlko



---

archive/issue_comments_487264.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nI am essentially happy with this ticket, but I want to wait and see what happens with the design discussion before going forward.",
    "created_at": "2020-09-17T00:07:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487264",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:10" align="right">comment:10</div>

I am essentially happy with this ticket, but I want to wait and see what happens with the design discussion before going forward.



---

archive/issue_comments_487265.json:
```json
{
    "body": "Changed dependencies from **#30528, #30529, #30572** to **#30528, #30529, #30572, #30571**",
    "created_at": "2020-09-18T14:02:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487265",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30528, #30529, #30572** to **#30528, #30529, #30572, #30571**



---

archive/issue_comments_487266.json:
```json
{
    "body": "Changed dependencies from **#30528, #30529, #30572, #30571** to **#30528, #30529, #30571, #30599**",
    "created_at": "2020-09-18T14:09:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487266",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30528, #30529, #30572, #30571** to **#30528, #30529, #30571, #30599**



---

archive/issue_comments_487267.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,18 +1,20 @@\n This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.\n \n-This ticket should eventually be resolved in many smaller tickets.\n+This ticket is mostly resolved in smaller tickets:\n+- #30596: Outsource functions in bitset.pxi that can be optimized by intrinsics \n+- #30597: Define a sparse bitset structure \n+- #30601: Move bitset.pxi to bitset_base.pxd\n+- #30598: Define a new data structure for a combinatorial face \n+- #30599: Define a new data structure for a list of combinatorial faces   - \n \n Changes are:\n \n 1. Move functions optimizable by intrinsics to a seperate file (`\tsrc/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)\n-\n 2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.\n-\n-3. Define a data structure `face_s` that gathers properties of a face and corresponding functions.\n-\n-4. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.\n-\n-5. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.\n+3. Move `bitset.pxi` to `bitset_base.pxd`.\n+4. Define a data structure `face_s` that gathers properties of a face and corresponding functions.\n+5. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.\n+6. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.\n \n The features of those changes are mainly:\n \n``````\n",
    "created_at": "2020-09-18T16:23:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487267",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,18 +1,20 @@
 This goal of this ticket is to use `data_structures/biteset.pxi` for the bitset stuff in combinatorial polyhedron and cleanly seperate algorithm and data structure.
 
-This ticket should eventually be resolved in many smaller tickets.
+This ticket is mostly resolved in smaller tickets:
+- #30596: Outsource functions in bitset.pxi that can be optimized by intrinsics 
+- #30597: Define a sparse bitset structure 
+- #30601: Move bitset.pxi to bitset_base.pxd
+- #30598: Define a new data structure for a combinatorial face 
+- #30599: Define a new data structure for a list of combinatorial faces   - 
 
 Changes are:
 
 1. Move functions optimizable by intrinsics to a seperate file (`	src/sage/data_structures/bitset_intrinsics.h`). (See #27103 and #27122.)
-
 2. Allow most functions in `bitset.pxi` for fuzed types [fuzed types](https://cython.readthedocs.io/en/latest/src/userguide/fusedtypes.html,), such that an (yet to be enriched) bitset data structure specialized for combinatorial faces can use it.
-
-3. Define a data structure `face_s` that gathers properties of a face and corresponding functions.
-
-4. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.
-
-5. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.
+3. Move `bitset.pxi` to `bitset_base.pxd`.
+4. Define a data structure `face_s` that gathers properties of a face and corresponding functions.
+5. Define a data structure `face_list_s` that gathers properties of a list of faces and corresponding functions.
+6. The two flavors of the algorithm (simple and standard) are set up as templates by abusing fuzed types. This makes the code much easier to read. Only the changes will be seperated in the code while the compiler compiles two seperate branches for both flavors.
 
 The features of those changes are mainly:
 
``````




---

archive/issue_comments_487268.json:
```json
{
    "body": "Changed commit from **[`74230a1`](https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db)** to **[`f3e851f`](https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69)**",
    "created_at": "2020-09-18T16:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487268",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`74230a1`](https://github.com/sagemath/sagetrac-mirror/commit/74230a1b34757c60169a4af481f75a1dcc6e24db)** to **[`f3e851f`](https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69)**



---

archive/issue_comments_487269.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02eabff1b64b472c22dd23260bc21f4609b564cb\"><code>02eabff</code></a></td><td><code>add find and sort</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50317b0d2989ff06947b9436e08c4683ed896ff2\"><code>50317b0</code></a></td><td><code>fixes to list_of_faces.pxi</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/32cf17eed6197179af2a61a70577dafcbfb810ac\"><code>32cf17e</code></a></td><td><code>remove pxi file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c81f43879c59c6da2ebc3627a5e2c3b66c3aca8b\"><code>c81f438</code></a></td><td><code>move not inlined functions to pyx file</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0a3df96ac267f0432726fb1c43a3896a7bc7f8a5\"><code>0a3df96</code></a></td><td><code>Merge branch 'u/gh-kliem/no_more_basic_access' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5b216140cd930e824ba5629e15475c443a9d7d6f\"><code>5b21614</code></a></td><td><code>use reference so simplify code</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/85708b0d0dd41d793afe9195f7a206feddf48cbd\"><code>85708b0</code></a></td><td><code>Merge branch 'u/gh-kliem/simplify_face_struct_pointer' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f758050e77d611ff4879ca72e5d1031faa0c39a\"><code>2f75805</code></a></td><td><code>Merge branch 'u/gh-kliem/prepare_conversions_for_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/605fc6b5f0a3da9f5db169a09b0be71ea72b300a\"><code>605fc6b</code></a></td><td><code>delete old files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69\"><code>f3e851f</code></a></td><td><code>use face_list_t and face_t for combinatorial polyhedron</code></td></tr></table>\n",
    "created_at": "2020-09-18T16:24:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487269",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02eabff1b64b472c22dd23260bc21f4609b564cb"><code>02eabff</code></a></td><td><code>add find and sort</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50317b0d2989ff06947b9436e08c4683ed896ff2"><code>50317b0</code></a></td><td><code>fixes to list_of_faces.pxi</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/32cf17eed6197179af2a61a70577dafcbfb810ac"><code>32cf17e</code></a></td><td><code>remove pxi file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c81f43879c59c6da2ebc3627a5e2c3b66c3aca8b"><code>c81f438</code></a></td><td><code>move not inlined functions to pyx file</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0a3df96ac267f0432726fb1c43a3896a7bc7f8a5"><code>0a3df96</code></a></td><td><code>Merge branch 'u/gh-kliem/no_more_basic_access' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5b216140cd930e824ba5629e15475c443a9d7d6f"><code>5b21614</code></a></td><td><code>use reference so simplify code</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/85708b0d0dd41d793afe9195f7a206feddf48cbd"><code>85708b0</code></a></td><td><code>Merge branch 'u/gh-kliem/simplify_face_struct_pointer' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f758050e77d611ff4879ca72e5d1031faa0c39a"><code>2f75805</code></a></td><td><code>Merge branch 'u/gh-kliem/prepare_conversions_for_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/605fc6b5f0a3da9f5db169a09b0be71ea72b300a"><code>605fc6b</code></a></td><td><code>delete old files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69"><code>f3e851f</code></a></td><td><code>use face_list_t and face_t for combinatorial polyhedron</code></td></tr></table>




---

archive/issue_events_418040.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-18T16:25:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418040"
}
```



---

archive/issue_events_418041.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-18T16:25:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418041"
}
```



---

archive/issue_comments_487270.json:
```json
{
    "body": "Changed commit from **[`f3e851f`](https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69)** to **[`298c2f7`](https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced)**",
    "created_at": "2020-10-26T07:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487270",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f3e851f`](https://github.com/sagemath/sagetrac-mirror/commit/f3e851f25544e39e8c1be91e169049f14f435c69)** to **[`298c2f7`](https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced)**



---

archive/issue_comments_487271.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a40b9ae38b4f7bb76121ec294f8479fed7b8cde\"><code>7a40b9a</code></a></td><td><code>redundant exit; removed semicolon</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/28bfa02c6ef5ade2bcc079b9d93055278d97b310\"><code>28bfa02</code></a></td><td><code>Merge branch 'u/gh-kliem/data_structure_for_face_list' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced\"><code>298c2f7</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure</code></td></tr></table>\n",
    "created_at": "2020-10-26T07:32:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487271",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a40b9ae38b4f7bb76121ec294f8479fed7b8cde"><code>7a40b9a</code></a></td><td><code>redundant exit; removed semicolon</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/28bfa02c6ef5ade2bcc079b9d93055278d97b310"><code>28bfa02</code></a></td><td><code>Merge branch 'u/gh-kliem/data_structure_for_face_list' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced"><code>298c2f7</code></a></td><td><code>Merge branch 'develop' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure</code></td></tr></table>




---

archive/issue_comments_487272.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nRed branch.\n\nI'll fix it, once all the dependencies are in.",
    "created_at": "2020-11-11T09:48:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487272",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

Red branch.

I'll fix it, once all the dependencies are in.



---

archive/issue_events_418042.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-11T09:48:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418042"
}
```



---

archive/issue_events_418043.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-11T09:48:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418043"
}
```



---

archive/issue_comments_487273.json:
```json
{
    "body": "Changed dependencies from **#30528, #30529, #30571, #30599** to **#30529, #30599**",
    "created_at": "2020-11-27T08:07:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487273",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30528, #30529, #30571, #30599** to **#30529, #30599**



---

archive/issue_comments_487274.json:
```json
{
    "body": "Changed dependencies from **#30529, #30599** to **#30529**",
    "created_at": "2020-11-27T08:07:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487274",
    "user": "https://github.com/kliem"
}
```

Changed dependencies from **#30529, #30599** to **#30529**



---

archive/issue_comments_487275.json:
```json
{
    "body": "Changed commit from **[`298c2f7`](https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced)** to **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**",
    "created_at": "2020-11-27T08:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487275",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`298c2f7`](https://github.com/sagemath/sagetrac-mirror/commit/298c2f7e48e4a86024d0f006585445726e8f5ced)** to **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**



---

archive/issue_comments_487276.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc\"><code>82a747d</code></a></td><td><code>Merge branch 'u/gh-kliem/use_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_new</code></td></tr></table>\n",
    "created_at": "2020-11-27T08:37:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487276",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc"><code>82a747d</code></a></td><td><code>Merge branch 'u/gh-kliem/use_face_structure' of git://trac.sagemath.org/sage into u/gh-kliem/use_face_structure_new</code></td></tr></table>




---

archive/issue_comments_487277.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nOk, this is back on needs review. Almost all dependencies are gone now.",
    "created_at": "2020-11-27T08:42:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487277",
    "user": "https://github.com/kliem"
}
```

<div id="comment:21" align="right">comment:21</div>

Ok, this is back on needs review. Almost all dependencies are gone now.



---

archive/issue_events_418044.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-27T08:42:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418044"
}
```



---

archive/issue_events_418045.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-27T08:42:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418045"
}
```



---

archive/issue_comments_487278.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\n`# The universe.` <-- Great comment.\n\nLGTM. Hopefully this won't have any issues with other systems that some of the other tickets had.",
    "created_at": "2020-12-07T23:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487278",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

`# The universe.` <-- Great comment.

LGTM. Hopefully this won't have any issues with other systems that some of the other tickets had.



---

archive/issue_events_418046.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-12-07T23:16:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418046"
}
```



---

archive/issue_events_418047.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-12-07T23:16:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418047"
}
```



---

archive/issue_comments_487279.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-12-07T23:16:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487279",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_comments_487280.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThank you.\n\nYes, I think it is way more stable, as it just exposes bitsets, which has been working for a while now.\n\nI just didn't think, the intermediate solutions to the end.",
    "created_at": "2020-12-08T07:06:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487280",
    "user": "https://github.com/kliem"
}
```

<div id="comment:23" align="right">comment:23</div>

Thank you.

Yes, I think it is way more stable, as it just exposes bitsets, which has been working for a while now.

I just didn't think, the intermediate solutions to the end.



---

archive/issue_events_418048.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:30:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418048"
}
```



---

archive/issue_events_418049.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "0f32a15ce1dfe12dfddac961453549be4b4f1d54",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-13T20:30:42Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30549#event-418049"
}
```



---

archive/issue_comments_487281.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/use_face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/use_face_structure)** to **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**",
    "created_at": "2020-12-13T20:30:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30549",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30549#issuecomment-487281",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/use_face_structure](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/use_face_structure)** to **[`82a747d`](https://github.com/sagemath/sagetrac-mirror/commit/82a747d6fabf5cf8d366851d2dfbcbf7cd57eabc)**
