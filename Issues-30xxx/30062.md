# Issue 30062: Rename MetricSpaces parent method metric to metric_function, add EuclideanSpace to category of metric spaces

archive/issues_029825.json:
```json
{
    "body": "```\nsage: from sage.categories.metric_spaces import MetricSpaces\nsage: QQ in MetricSpaces()\nTrue\nsage: RR in MetricSpaces()\nTrue\nsage: ZZ in MetricSpaces()\nTrue\nsage: AA in MetricSpaces()\nFalse\nsage: QuadraticField(5) in MetricSpaces()\nFalse\nsage: M = Matrix(QQ,[[2,1,0],[1,2,1],[0,1,2]])\nsage: V = VectorSpace(QQ,3,inner_product_matrix=M)\nsage: V in MetricSpaces()\nFalse\nsage: E = EuclideanSpace(3)\nsage: E in MetricSpaces()\nFalse\n```\n\nOn this ticket, we add (from #30061#comment:44) `EuclideanSpace` (implementing the distance function by means of the Cartesian chart) to the category.\n\nTo do this, we rename the `MetricSpaces` parent method `metric` to `metric_function`.\n\nThe other examples from above will be taken care of in #30092 (which adds inner product spaces) and #30219 (real embedded number fields).\n\n\n\n\nCC:  @tscrim @egourgoulhon\n\nBranch/Commit: d785c0d05c92d9ea96cdaa63df9f52824fa03ce3\n\nReviewer: Matthias Koeppe, Travis Scrimshaw\n\nAuthor: Eric Gourgoulhon, Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30062\n\n",
    "closed_at": "2020-08-02T08:20:40Z",
    "created_at": "2020-07-04T06:35:06Z",
    "labels": [
        "component: categories"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Rename MetricSpaces parent method metric to metric_function, add EuclideanSpace to category of metric spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30062",
    "user": "https://github.com/mkoeppe"
}
```
```
sage: from sage.categories.metric_spaces import MetricSpaces
sage: QQ in MetricSpaces()
True
sage: RR in MetricSpaces()
True
sage: ZZ in MetricSpaces()
True
sage: AA in MetricSpaces()
False
sage: QuadraticField(5) in MetricSpaces()
False
sage: M = Matrix(QQ,[[2,1,0],[1,2,1],[0,1,2]])
sage: V = VectorSpace(QQ,3,inner_product_matrix=M)
sage: V in MetricSpaces()
False
sage: E = EuclideanSpace(3)
sage: E in MetricSpaces()
False
```

On this ticket, we add (from #30061#comment:44) `EuclideanSpace` (implementing the distance function by means of the Cartesian chart) to the category.

To do this, we rename the `MetricSpaces` parent method `metric` to `metric_function`.

The other examples from above will be taken care of in #30092 (which adds inner product spaces) and #30219 (real embedded number fields).




CC:  @tscrim @egourgoulhon

Branch/Commit: d785c0d05c92d9ea96cdaa63df9f52824fa03ce3

Reviewer: Matthias Koeppe, Travis Scrimshaw

Author: Eric Gourgoulhon, Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30062





---

archive/issue_comments_423171.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2020-07-11T15:57:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423171",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_423172.json:
```json
{
    "body": "<a id='comment:4'></a>The above commit is a first attempt to add `EuclideanSpace` to the category of metric spaces. It endows the class `EuclideanSpace` with the method `dist()`, which computes the Euclidean distance between two points. However, `TestSuite(E).run()` fails with `_test_metric` because of the name clash between \n- the method `metric()` of `EuclideanSpace`, which is inheritated from `PseudoRiemannianManifold` and which returns the metric tensor (first fundamental form)\n- the method `metric()` of `ParentMethods` in `MetricSpaces`, which is supposed to be the distance function.\n\nIt seems difficult to change the name of `PseudoRiemannianManifold.metric()`, even with a proper deprecation notice, because it is heavily used and it is the natural name in the context of differential geometry. On the other side, could the parent method `metric()` of `MetricSpaces` be changed to something else? e.g. `distance_function`? Also, it seems quite redundant with the other parent method `dist()`. Indeed, by default, the parent method `metric()` is defined as \n\n```\n        def metric(self):\n            return lambda a,b: a.dist(b)\n```\nwith `a.dist(b)` being `self.parent().dist(self, b)`, so at the end of the day, if `M` is a metric space, `M.metric()(a,b)` ends to `M.dist(a,b)`.",
    "created_at": "2020-07-11T16:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423172",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>The above commit is a first attempt to add `EuclideanSpace` to the category of metric spaces. It endows the class `EuclideanSpace` with the method `dist()`, which computes the Euclidean distance between two points. However, `TestSuite(E).run()` fails with `_test_metric` because of the name clash between 
- the method `metric()` of `EuclideanSpace`, which is inheritated from `PseudoRiemannianManifold` and which returns the metric tensor (first fundamental form)
- the method `metric()` of `ParentMethods` in `MetricSpaces`, which is supposed to be the distance function.

It seems difficult to change the name of `PseudoRiemannianManifold.metric()`, even with a proper deprecation notice, because it is heavily used and it is the natural name in the context of differential geometry. On the other side, could the parent method `metric()` of `MetricSpaces` be changed to something else? e.g. `distance_function`? Also, it seems quite redundant with the other parent method `dist()`. Indeed, by default, the parent method `metric()` is defined as 

```
        def metric(self):
            return lambda a,b: a.dist(b)
```
with `a.dist(b)` being `self.parent().dist(self, b)`, so at the end of the day, if `M` is a metric space, `M.metric()(a,b)` ends to `M.dist(a,b)`.



---

archive/issue_comments_423173.json:
```json
{
    "body": "<a id='comment:5'></a>Another remark about `MetricSpaces`: it defines an element method `abs()`, which returns the distance to the zero element. For `EuclideanSpace`, the zero element could be defined as the element of Cartesian coordinates `(0,0,...,0)`, but in general, metric spaces (which are not necessarily algebraic structures) do not have any natural \"zero\" element, do they?",
    "created_at": "2020-07-11T16:28:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423173",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>Another remark about `MetricSpaces`: it defines an element method `abs()`, which returns the distance to the zero element. For `EuclideanSpace`, the zero element could be defined as the element of Cartesian coordinates `(0,0,...,0)`, but in general, metric spaces (which are not necessarily algebraic structures) do not have any natural "zero" element, do they?



---

archive/issue_comments_423174.json:
```json
{
    "body": "<a id='comment:6'></a>Regarding the addition of Riemannian manifolds beyond `EuclideanSpace` to the category `MetricSpaces`, this seems computationaly difficult. It is true that any connected Riemannian manifold can be turned into a metric space by defining the distance function as the infinimum of the lengths of the paths connecting two points, but the latter is not computable in practice.",
    "created_at": "2020-07-11T16:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423174",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>Regarding the addition of Riemannian manifolds beyond `EuclideanSpace` to the category `MetricSpaces`, this seems computationaly difficult. It is true that any connected Riemannian manifold can be turned into a metric space by defining the distance function as the infinimum of the lengths of the paths connecting two points, but the latter is not computable in practice.



---

archive/issue_comments_423175.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 egourgoulhon]:\n> The above commit is a first attempt to add `EuclideanSpace` to the category of metric spaces. It endows the class `EuclideanSpace` with the method `dist()`, which computes the Euclidean distance between two points.\n\n\nGreat!\n\n> However, `TestSuite(E).run()` fails with `_test_metric` because of the name clash between \n> - the method `metric()` of `EuclideanSpace`, which is inheritated from `PseudoRiemannianManifold` and which returns the metric tensor (first fundamental form)\n> - the method `metric()` of `ParentMethods` in `MetricSpaces`, which is supposed to be the distance function.\n> \n> It seems difficult to change the name of `PseudoRiemannianManifold.metric()`, even with a proper deprecation notice, because it is heavily used and it is the natural name in the context of differential geometry.\n\n\nI agree.\n\n> On the other side, could the parent method `metric()` of `MetricSpaces` be changed to something else?\n\n\nOverall, this category seems not very well developed, and I would be surprised if it was used much in user code. I think it will be safe to make changes to it (with deprecation).\n\n> e.g. `distance_function`? \n\n\nSounds good to me. But perhaps we can just deprecate the parent method `metric` altogether until a clear need for it arises?",
    "created_at": "2020-07-11T17:54:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423175",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Replying to [comment:4 egourgoulhon]:
> The above commit is a first attempt to add `EuclideanSpace` to the category of metric spaces. It endows the class `EuclideanSpace` with the method `dist()`, which computes the Euclidean distance between two points.


Great!

> However, `TestSuite(E).run()` fails with `_test_metric` because of the name clash between 
> - the method `metric()` of `EuclideanSpace`, which is inheritated from `PseudoRiemannianManifold` and which returns the metric tensor (first fundamental form)
> - the method `metric()` of `ParentMethods` in `MetricSpaces`, which is supposed to be the distance function.
> 
> It seems difficult to change the name of `PseudoRiemannianManifold.metric()`, even with a proper deprecation notice, because it is heavily used and it is the natural name in the context of differential geometry.


I agree.

> On the other side, could the parent method `metric()` of `MetricSpaces` be changed to something else?


Overall, this category seems not very well developed, and I would be surprised if it was used much in user code. I think it will be safe to make changes to it (with deprecation).

> e.g. `distance_function`? 


Sounds good to me. But perhaps we can just deprecate the parent method `metric` altogether until a clear need for it arises?



---

archive/issue_comments_423176.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:5 egourgoulhon]:\n> Another remark about `MetricSpaces`: it defines an element method `abs()`, which returns the distance to the zero element. For `EuclideanSpace`, the zero element could be defined as the element of Cartesian coordinates `(0,0,...,0)`, but in general, metric spaces (which are not necessarily algebraic structures) do not have any natural \"zero\" element, do they? \n\n\nI would propose to deprecate this element method, exactly for this reason. Probably when the category was written, the author was thinking of normed spaces; but these should become a separate category.",
    "created_at": "2020-07-11T17:56:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423176",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [comment:5 egourgoulhon]:
> Another remark about `MetricSpaces`: it defines an element method `abs()`, which returns the distance to the zero element. For `EuclideanSpace`, the zero element could be defined as the element of Cartesian coordinates `(0,0,...,0)`, but in general, metric spaces (which are not necessarily algebraic structures) do not have any natural "zero" element, do they? 


I would propose to deprecate this element method, exactly for this reason. Probably when the category was written, the author was thinking of normed spaces; but these should become a separate category.



---

archive/issue_comments_423177.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:6 egourgoulhon]:\n> Regarding the addition of Riemannian manifolds beyond `EuclideanSpace` to the category `MetricSpaces`, this seems computationaly difficult. It is true that any connected Riemannian manifold can be turned into a metric space by defining the distance function as the infinimum of the lengths of the paths connecting two points, but the latter is not computable in practice. \n\n\nGood point about the needed hypothesis of connectedness. That alone is already a good enough reason not to add Riemannian manifolds to the category. So we can ignore the more subtle question whether it makes sense to add it to the category but have the `dist` method raise `NotImplementedError` for nontrivial inputs.",
    "created_at": "2020-07-11T18:01:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423177",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Replying to [comment:6 egourgoulhon]:
> Regarding the addition of Riemannian manifolds beyond `EuclideanSpace` to the category `MetricSpaces`, this seems computationaly difficult. It is true that any connected Riemannian manifold can be turned into a metric space by defining the distance function as the infinimum of the lengths of the paths connecting two points, but the latter is not computable in practice. 


Good point about the needed hypothesis of connectedness. That alone is already a good enough reason not to add Riemannian manifolds to the category. So we can ignore the more subtle question whether it makes sense to add it to the category but have the `dist` method raise `NotImplementedError` for nontrivial inputs.



---

archive/issue_comments_423178.json:
```json
{
    "body": "<a id='comment:10'></a>Indeed, I was conflating metric spaces and normed spaces, which should be separated into 2 separate categories (with normed spaces being a subcategory of metric spaces of course).\n\nJust to note: We do have an axiom for connected and the category `Manifolds().Connected()`.\n\nI am -1 for removing the element and parent methods `dist` and the `metric` method. `a.dist(b)` is natural and easier to work with when you don't want to explicitly specify the parent of `a` (and `b`). It is also more conceptual when you don't want to care about the exact metric as long as there is some metric. Similarly, when you want to specify which metric (space) you want to use `M.dist(a,b)` or `M.metric()(a,b)` becomes the more natural choice. Additionally, sometimes you want to explicitly work or pass the metric, so `M.metric()` is something useful too. There should not be any conflict here and having extra (natural) methods doesn't hurt anything.\n\nI would also be wary of saying there is no need just because something is not used in the Sage code: It could be used in a user's code and it feels natural from a teaching perspective. Additionally, me being the (dumb) non-geometer that I am, I would expect asking for the `metric()` of a metric space to return the metric function `d: X x X -> R`.\n\nAs Eric said in comment:4, the real issue is the name conflict. From some wikipedia searching, what is currently called a metric in the manifolds code is really a (very common) shorthand name for \"metric tensor,\" whereas \"metric\" is the standard name for the function that defines a metric space. Of course, the metric tensor allows one to define a metric as Eric said, and it is clear from the context of the different fields what one means. Unfortunately there is not a good way to resolve this other than possibly replacing `metric` with `metric_tensor` in the manifolds code. However, I think it is reasonable to not put the connected Riemannian manifolds in the `MetricSpaces` category because of the computational infeasibility of the metric function.",
    "created_at": "2020-07-12T03:27:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423178",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:10'></a>Indeed, I was conflating metric spaces and normed spaces, which should be separated into 2 separate categories (with normed spaces being a subcategory of metric spaces of course).

Just to note: We do have an axiom for connected and the category `Manifolds().Connected()`.

I am -1 for removing the element and parent methods `dist` and the `metric` method. `a.dist(b)` is natural and easier to work with when you don't want to explicitly specify the parent of `a` (and `b`). It is also more conceptual when you don't want to care about the exact metric as long as there is some metric. Similarly, when you want to specify which metric (space) you want to use `M.dist(a,b)` or `M.metric()(a,b)` becomes the more natural choice. Additionally, sometimes you want to explicitly work or pass the metric, so `M.metric()` is something useful too. There should not be any conflict here and having extra (natural) methods doesn't hurt anything.

I would also be wary of saying there is no need just because something is not used in the Sage code: It could be used in a user's code and it feels natural from a teaching perspective. Additionally, me being the (dumb) non-geometer that I am, I would expect asking for the `metric()` of a metric space to return the metric function `d: X x X -> R`.

As Eric said in comment:4, the real issue is the name conflict. From some wikipedia searching, what is currently called a metric in the manifolds code is really a (very common) shorthand name for "metric tensor," whereas "metric" is the standard name for the function that defines a metric space. Of course, the metric tensor allows one to define a metric as Eric said, and it is clear from the context of the different fields what one means. Unfortunately there is not a good way to resolve this other than possibly replacing `metric` with `metric_tensor` in the manifolds code. However, I think it is reasonable to not put the connected Riemannian manifolds in the `MetricSpaces` category because of the computational infeasibility of the metric function.



---

archive/issue_comments_423179.json:
```json
{
    "body": "<a id='comment:11'></a>Just a quick note:\n\nReplying to [comment:10 tscrim]:\n> I am -1 for removing the element and parent methods `dist` and the `metric` method. `a.dist(b)` is natural and easier to work with when you don't want to explicitly specify the parent of `a` (and `b`). \n\n\nThere is no problem with the element method `dist`. The only problem is the clash of the parent method `metric`.",
    "created_at": "2020-07-12T05:07:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423179",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Just a quick note:

Replying to [comment:10 tscrim]:
> I am -1 for removing the element and parent methods `dist` and the `metric` method. `a.dist(b)` is natural and easier to work with when you don't want to explicitly specify the parent of `a` (and `b`). 


There is no problem with the element method `dist`. The only problem is the clash of the parent method `metric`.



---

archive/issue_comments_423180.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 tscrim]:\n> \n> I would also be wary of saying there is no need just because something is not used in the Sage code: It could be used in a user's code and it feels natural from a teaching perspective. Additionally, me being the (dumb) non-geometer that I am, I would expect asking for the `metric()` of a metric space to return the metric function `d: X x X -> R`.\n> \n\n\nI agree this quite natural.\n\n> As Eric said in comment:4, the real issue is the name conflict. From some wikipedia searching, what is currently called a metric in the manifolds code is really a (very common) shorthand name for \"metric tensor,\" whereas \"metric\" is the standard name for the function that defines a metric space. Of course, the metric tensor allows one to define a metric as Eric said, and it is clear from the context of the different fields what one means. \n\n\nIndeed, both usages of *metric* are natural in their respective contexts. \n\n>Unfortunately there is not a good way to resolve this other than possibly replacing `metric` with `metric_tensor` in the manifolds code. \n\n\nAnother option is to replace `metric` by `metric_function` in `MetricSpaces`. I would favor that one. From a teaching perspective, it is as easy to discover by TAB completion as `metric` (contrary to `distance_function`, which I proposed in comment:4). Moreover, the `MetricSpaces`'s `metric()` is much less used in Sage's code than the manifold one: `grep -r \"\\.metric()\"` in `src/sage` returns 5 lines for metric spaces, versus 127 lines for manifolds. \n\n>However, I think it is reasonable to not put the connected Riemannian manifolds in the `MetricSpaces` category because of the computational infeasibility of the metric function.\n\n\nI agree, but this does not solve the clash issue for `EuclideanSpace`, since the latter is considered as a Riemannian manifold (with a flat metric tensor).",
    "created_at": "2020-07-12T12:50:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423180",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:12'></a>Replying to [comment:10 tscrim]:
> 
> I would also be wary of saying there is no need just because something is not used in the Sage code: It could be used in a user's code and it feels natural from a teaching perspective. Additionally, me being the (dumb) non-geometer that I am, I would expect asking for the `metric()` of a metric space to return the metric function `d: X x X -> R`.
> 


I agree this quite natural.

> As Eric said in comment:4, the real issue is the name conflict. From some wikipedia searching, what is currently called a metric in the manifolds code is really a (very common) shorthand name for "metric tensor," whereas "metric" is the standard name for the function that defines a metric space. Of course, the metric tensor allows one to define a metric as Eric said, and it is clear from the context of the different fields what one means. 


Indeed, both usages of *metric* are natural in their respective contexts. 

>Unfortunately there is not a good way to resolve this other than possibly replacing `metric` with `metric_tensor` in the manifolds code. 


Another option is to replace `metric` by `metric_function` in `MetricSpaces`. I would favor that one. From a teaching perspective, it is as easy to discover by TAB completion as `metric` (contrary to `distance_function`, which I proposed in comment:4). Moreover, the `MetricSpaces`'s `metric()` is much less used in Sage's code than the manifold one: `grep -r "\.metric()"` in `src/sage` returns 5 lines for metric spaces, versus 127 lines for manifolds. 

>However, I think it is reasonable to not put the connected Riemannian manifolds in the `MetricSpaces` category because of the computational infeasibility of the metric function.


I agree, but this does not solve the clash issue for `EuclideanSpace`, since the latter is considered as a Riemannian manifold (with a flat metric tensor).



---

archive/issue_comments_423181.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 egourgoulhon]:\n> Another option is to replace `metric` by `metric_function` in `MetricSpaces`. I would favor that one. From a teaching perspective, it is as easy to discover by TAB completion as `metric` (contrary to `distance_function`, which I proposed in comment:4). Moreover, the `MetricSpaces`'s `metric()` is much less used in Sage's code than the manifold one: `grep -r \"\\.metric()\"` in `src/sage` returns 5 lines for metric spaces, versus 127 lines for manifolds. \n\n\n+1 on `metric_function` (with deprecation for `metric`) in `MetricSpaces`. I think this is a good compromise.",
    "created_at": "2020-07-12T17:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423181",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Replying to [comment:12 egourgoulhon]:
> Another option is to replace `metric` by `metric_function` in `MetricSpaces`. I would favor that one. From a teaching perspective, it is as easy to discover by TAB completion as `metric` (contrary to `distance_function`, which I proposed in comment:4). Moreover, the `MetricSpaces`'s `metric()` is much less used in Sage's code than the manifold one: `grep -r "\.metric()"` in `src/sage` returns 5 lines for metric spaces, versus 127 lines for manifolds. 


+1 on `metric_function` (with deprecation for `metric`) in `MetricSpaces`. I think this is a good compromise.



---

archive/issue_comments_423182.json:
```json
{
    "body": "<a id='comment:14'></a>I agree that renaming `metric()` -> `metric_function()` and using that internally is good. However, I might also advocate for doing `metric()` -> `metric_tensor()` in the manifold code as it is basically just one sed command, as well as providing `metric()` as a shorthand.\n\nThe slightly trickier question would be should we allow `MetricSpaces` to have `metric()` be a shorthand whose semantics could change?",
    "created_at": "2020-07-12T23:20:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423182",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:14'></a>I agree that renaming `metric()` -> `metric_function()` and using that internally is good. However, I might also advocate for doing `metric()` -> `metric_tensor()` in the manifold code as it is basically just one sed command, as well as providing `metric()` as a shorthand.

The slightly trickier question would be should we allow `MetricSpaces` to have `metric()` be a shorthand whose semantics could change?



---

archive/issue_comments_423183.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-17T07:19:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423183",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423184.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:10 tscrim]:\n> Indeed, I was conflating metric spaces and normed spaces, which should be separated into 2 separate categories (with normed spaces being a subcategory of metric spaces of course).\n\n\nLet's fix this in #30092.",
    "created_at": "2020-07-17T19:24:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423184",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:10 tscrim]:
> Indeed, I was conflating metric spaces and normed spaces, which should be separated into 2 separate categories (with normed spaces being a subcategory of metric spaces of course).


Let's fix this in #30092.



---

archive/issue_comments_423185.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-25T21:23:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423185",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_423186.json:
```json
{
    "body": "<a id='comment:19'></a>While I am not fully convinced that we should not have an ambiguous `metric` method, it is not a strong enough opinion to warrant asking for further discussion. So if a patchbot comes back (morally) green, then positive review.",
    "created_at": "2020-07-25T22:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423186",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>While I am not fully convinced that we should not have an ambiguous `metric` method, it is not a strong enough opinion to warrant asking for further discussion. So if a patchbot comes back (morally) green, then positive review.



---

archive/issue_comments_423187.json:
```json
{
    "body": "<a id='comment:20'></a>Some test failures that look like this\n\n```\nsage -t --long src/sage/rings/padics/padic_base_leaves.py\n**********************************************************************\nFile \"src/sage/rings/padics/padic_base_leaves.py\", line 237, in sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative.__init__\nFailed example:\n    R._test_metric(elements = [R.random_element() for i in range(2^3)]) # long time\nException raised:\n    Traceback (most recent call last):\n      File \"sage/structure/category_object.pyx\", line 838, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:6954)\n        return self.__cached_methods[name]\n    KeyError: '_test_metric'\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 707, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1131, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative.__init__[5]>\", line 1, in <module>\n        R._test_metric(elements = [R.random_element() for i in range(Integer(2)**Integer(3))]) # long time\n      File \"sage/structure/category_object.pyx\", line 832, in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6876)\n        return self.getattr_from_category(name)\n      File \"sage/structure/category_object.pyx\", line 847, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7039)\n        attr = getattr_from_other_class(self, cls, name)\n      File \"sage/cpython/getattr.pyx\", line 389, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2548)\n        raise AttributeError(dummy_error_message)\n    AttributeError: 'pAdicRingCappedRelative_with_category' object has no attribute '_test_metric'\n**********************************************************************\n```\n... and some others",
    "created_at": "2020-07-26T00:17:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423187",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>Some test failures that look like this

```
sage -t --long src/sage/rings/padics/padic_base_leaves.py
**********************************************************************
File "src/sage/rings/padics/padic_base_leaves.py", line 237, in sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative.__init__
Failed example:
    R._test_metric(elements = [R.random_element() for i in range(2^3)]) # long time
Exception raised:
    Traceback (most recent call last):
      File "sage/structure/category_object.pyx", line 838, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:6954)
        return self.__cached_methods[name]
    KeyError: '_test_metric'

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 707, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1131, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.rings.padics.padic_base_leaves.pAdicRingCappedRelative.__init__[5]>", line 1, in <module>
        R._test_metric(elements = [R.random_element() for i in range(Integer(2)**Integer(3))]) # long time
      File "sage/structure/category_object.pyx", line 832, in sage.structure.category_object.CategoryObject.__getattr__ (build/cythonized/sage/structure/category_object.c:6876)
        return self.getattr_from_category(name)
      File "sage/structure/category_object.pyx", line 847, in sage.structure.category_object.CategoryObject.getattr_from_category (build/cythonized/sage/structure/category_object.c:7039)
        attr = getattr_from_other_class(self, cls, name)
      File "sage/cpython/getattr.pyx", line 389, in sage.cpython.getattr.getattr_from_other_class (build/cythonized/sage/cpython/getattr.c:2548)
        raise AttributeError(dummy_error_message)
    AttributeError: 'pAdicRingCappedRelative_with_category' object has no attribute '_test_metric'
**********************************************************************
```
... and some others



---

archive/issue_comments_423188.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-26T00:17:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423188",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_423189.json:
```json
{
    "body": "<a id='comment:22'></a>\n```\nsage -t --long src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst\n**********************************************************************\nFile \"src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst\", line 31, in doc.en.thematic_tutorials.vector_calculus.vector_calc_advanced\nFailed example:\n    E.category()\nExpected:\n    Category of smooth manifolds over Real Field with 53 bits of precision\nGot:\n    Join of Category of differentiable manifolds over Real Field with 53 bits of precision and Category of metric spaces\n```\nIs the change from \"smooth\" to \"differentiable\" expected here?",
    "created_at": "2020-07-26T00:29:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423189",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>
```
sage -t --long src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst
**********************************************************************
File "src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst", line 31, in doc.en.thematic_tutorials.vector_calculus.vector_calc_advanced
Failed example:
    E.category()
Expected:
    Category of smooth manifolds over Real Field with 53 bits of precision
Got:
    Join of Category of differentiable manifolds over Real Field with 53 bits of precision and Category of metric spaces
```
Is the change from "smooth" to "differentiable" expected here?



---

archive/issue_comments_423190.json:
```json
{
    "body": "Changing status from needs_work to needs_info.",
    "created_at": "2020-07-26T00:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423190",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_info.



---

archive/issue_comments_423191.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-26T00:30:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423191",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423192.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-26T00:33:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423192",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423193.json:
```json
{
    "body": "Changing status from needs_info to needs_review.",
    "created_at": "2020-07-26T00:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423193",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_info to needs_review.



---

archive/issue_comments_423194.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:22 mkoeppe]:\n> {{{\n> sage -t --long src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst\n> **********************************************************************\n> File \"src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst\", line 31, in doc.en.thematic_tutorials.vector_calculus.vector_calc_advanced\n> Failed example:\n>     E.category()\n> Expected:\n>     Category of smooth manifolds over Real Field with 53 bits of precision\n> Got:\n>     Join of Category of differentiable manifolds over Real Field with 53 bits of precision and Category of metric spaces\n> }}}\n> Is the change from \"smooth\" to \"differentiable\" expected here?\n\n\n\nYou explicitly changed the default category to only be differentiable rather than smooth:\n\n```diff\n+        if category is None:\n+            category = Manifolds(RR).Differentiable() & MetricSpaces()\n```\nSee `sage.manifolds.differentiable.manifold.DifferentiableManifold.__init__`. So I think you need to change\n\n```diff\n-            category = Manifolds(RR).Differentiable() & MetricSpaces()\n+            category = Manifolds(RR).Smooth() & MetricSpaces()\n```",
    "created_at": "2020-07-26T02:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423194",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:27'></a>Replying to [comment:22 mkoeppe]:
> {{{
> sage -t --long src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst
> **********************************************************************
> File "src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst", line 31, in doc.en.thematic_tutorials.vector_calculus.vector_calc_advanced
> Failed example:
>     E.category()
> Expected:
>     Category of smooth manifolds over Real Field with 53 bits of precision
> Got:
>     Join of Category of differentiable manifolds over Real Field with 53 bits of precision and Category of metric spaces
> }}}
> Is the change from "smooth" to "differentiable" expected here?



You explicitly changed the default category to only be differentiable rather than smooth:

```diff
+        if category is None:
+            category = Manifolds(RR).Differentiable() & MetricSpaces()
```
See `sage.manifolds.differentiable.manifold.DifferentiableManifold.__init__`. So I think you need to change

```diff
-            category = Manifolds(RR).Differentiable() & MetricSpaces()
+            category = Manifolds(RR).Smooth() & MetricSpaces()
```



---

archive/issue_comments_423195.json:
```json
{
    "body": "<a id='comment:28'></a>Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional",
    "created_at": "2020-07-26T02:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423195",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional



---

archive/issue_comments_423196.json:
```json
{
    "body": "<a id='comment:29'></a>Replying to [comment:28 mkoeppe]:\n> Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional\n\n\nAh, sorry, I thought it was on one of your commits.",
    "created_at": "2020-07-26T04:42:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423196",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:29'></a>Replying to [comment:28 mkoeppe]:
> Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional


Ah, sorry, I thought it was on one of your commits.



---

archive/issue_comments_423197.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:28 mkoeppe]:\n> Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional\n\nSorry it is a mistake from my side; of course, for Euclidean spaces, the category shall be `Manifolds(RR).Smooth()`.",
    "created_at": "2020-07-26T12:42:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423197",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:30'></a>Replying to [comment:28 mkoeppe]:
> Eric's commit 1f4f9422 did this, so I guess my question is to him whether this change was intentional

Sorry it is a mistake from my side; of course, for Euclidean spaces, the category shall be `Manifolds(RR).Smooth()`.



---

archive/issue_comments_423198.json:
```json
{
    "body": "<a id='comment:31'></a>Since we are on it, we could also add that the Euclidean space is in the category of complete metric spaces:\n\n```\n    category = Manifolds(RR).Smooth() & MetricSpaces().Complete()\n```\nwith hopefully some day `RR` replaced by a better representation of the real field, as proposed in #24456.",
    "created_at": "2020-07-26T12:48:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423198",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:31'></a>Since we are on it, we could also add that the Euclidean space is in the category of complete metric spaces:

```
    category = Manifolds(RR).Smooth() & MetricSpaces().Complete()
```
with hopefully some day `RR` replaced by a better representation of the real field, as proposed in #24456.



---

archive/issue_comments_423199.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 egourgoulhon]:\n> Since we are on it, we could also add that the Euclidean space is in the category of complete metric spaces:\n> \n> ```\n>     category = Manifolds(RR).Smooth() & MetricSpaces().Complete()\n> ```\n> with hopefully some day `RR` replaced by a better representation of the real field, as proposed in #24456.\n\n\nI'll add a commit implementing this soon (EDIT: this is the commit in comment:33).",
    "created_at": "2020-07-26T13:54:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423199",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:32'></a>Replying to [comment:31 egourgoulhon]:
> Since we are on it, we could also add that the Euclidean space is in the category of complete metric spaces:
> 
> ```
>     category = Manifolds(RR).Smooth() & MetricSpaces().Complete()
> ```
> with hopefully some day `RR` replaced by a better representation of the real field, as proposed in #24456.


I'll add a commit implementing this soon (EDIT: this is the commit in comment:33).



---

archive/issue_comments_423200.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-26T14:10:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423200",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_423201.json:
```json
{
    "body": "<a id='comment:35'></a>Looks great to me, thanks very much.\n\nPatchbot is green too. (There is one patchbot that is not feeling well, unrelated to this ticket.)",
    "created_at": "2020-07-26T17:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423201",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Looks great to me, thanks very much.

Patchbot is green too. (There is one patchbot that is not feeling well, unrelated to this ticket.)



---

archive/issue_comments_423202.json:
```json
{
    "body": "<a id='comment:36'></a>Thank you.",
    "created_at": "2020-07-27T03:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423202",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:36'></a>Thank you.



---

archive/issue_comments_423203.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-27T03:39:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423203",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_077335.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-02T08:20:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30062#event-77335"
}
```



---

archive/issue_comments_423204.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-02T08:20:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30062",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30062#issuecomment-423204",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
