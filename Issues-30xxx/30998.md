# Issue 30998: Compute the treelength of graphs

archive/issues_030761.json:
```json
{
    "body": "We add a method to compute the treelength of a graph. This measure of tree-likeness express how the metric structure of a graph is close to a tree metric.\n\nSome implementation choices:\n- Check if the input graph is chordal (treelength 1)\n- Use decomposition by clique minimal separators as preprocessing, and so compute only the treelength of the atoms of the graph.\n- Use isomorphisms between atoms to avoid computing the treelength of isomorphic atoms.\n- Implement a specific class to compute the treelength of an atom (which is working for all graphs but without pre-processing)\n- The main algorithm is an adaptation of algorithm `'sage'` for treewidth.\n\nReviewer: Travis Scrimshaw\n\nAuthor: David Coudert\n\nBranch: 26079ff80d81d7b42bd9a3dad9adc21882c22c79\n\nDependencies: #30993\n\nCommit: 26079ff80d81d7b42bd9a3dad9adc21882c22c79\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30998\n\n",
    "closed_at": "2021-10-10T10:17:09Z",
    "created_at": "2020-12-03T19:20:19Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Compute the treelength of graphs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30998",
    "user": "https://github.com/dcoudert"
}
```
We add a method to compute the treelength of a graph. This measure of tree-likeness express how the metric structure of a graph is close to a tree metric.

Some implementation choices:
- Check if the input graph is chordal (treelength 1)
- Use decomposition by clique minimal separators as preprocessing, and so compute only the treelength of the atoms of the graph.
- Use isomorphisms between atoms to avoid computing the treelength of isomorphic atoms.
- Implement a specific class to compute the treelength of an atom (which is working for all graphs but without pre-processing)
- The main algorithm is an adaptation of algorithm `'sage'` for treewidth.

Reviewer: Travis Scrimshaw

Author: David Coudert

Branch: 26079ff80d81d7b42bd9a3dad9adc21882c22c79

Dependencies: #30993

Commit: 26079ff80d81d7b42bd9a3dad9adc21882c22c79

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30998





---

archive/issue_comments_439142.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-12-03T19:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439142",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_439143.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-03T19:21:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439143",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_439144.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-03T21:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439145.json:
```json
{
    "body": "<a id='comment:3'></a>Let's see if the doctest coverage is better this way.",
    "created_at": "2020-12-03T21:20:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439145",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:3'></a>Let's see if the doctest coverage is better this way.



---

archive/issue_comments_439146.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-05T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439146",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439147.json:
```json
{
    "body": "<a id='comment:5'></a>I have simplified some parts of the code.",
    "created_at": "2020-12-05T15:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439147",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:5'></a>I have simplified some parts of the code.



---

archive/issue_comments_439148.json:
```json
{
    "body": "<a id='comment:6'></a>I will rebase this ticket on top of #30993 (and remove dependency on #30986 which has been merged in 9.3.beta3).",
    "created_at": "2020-12-07T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439148",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:6'></a>I will rebase this ticket on top of #30993 (and remove dependency on #30986 which has been merged in 9.3.beta3).



---

archive/issue_comments_439149.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-07T16:37:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439149",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_439150.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-12-07T17:52:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439150",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_439151.json:
```json
{
    "body": "<a id='comment:8'></a>I have rebased this ticket over #30993 (instead of #30986). I hope I did it correctly...",
    "created_at": "2020-12-07T17:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439151",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:8'></a>I have rebased this ticket over #30993 (instead of #30986). I hope I did it correctly...



---

archive/issue_comments_439152.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-07T17:56:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439152",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_events_080945.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-15T22:07:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30998#event-80945"
}
```



---

archive/issue_comments_439153.json:
```json
{
    "body": "<a id='comment:9'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-15T22:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30998#event-80946"
}
```



---

archive/issue_events_080947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30998#event-80947"
}
```



---

archive/issue_comments_439154.json:
```json
{
    "body": "<a id='comment:10'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439154",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_comments_439155.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-09-18T15:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439156.json:
```json
{
    "body": "<a id='comment:12'></a>Fix merge conflict with 9.5.beta1",
    "created_at": "2021-09-18T15:52:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439156",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:12'></a>Fix merge conflict with 9.5.beta1



---

archive/issue_comments_439157.json:
```json
{
    "body": "<a id='comment:13'></a>Some little comments:\n\nI know Matthias would like the `from sage.functions.other import ceil` import to be in the method that uses it to help him with the Sage modularization.\n\nThe text for `OUTPUT:` and `ALGORITHM:` should not be indented.\n\nIn `treelength()` and `_treelength()`, do you want to give some of your variables type information? For example, isn't `cc` a `set`?\n\nShouldn't `__destroy__` be `__dealloc__`?\n\n```diff\n-    TESTS::\n+    TESTS:\n \n     Check that the decomposition by clique separators is valid::\n```",
    "created_at": "2021-10-03T08:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439157",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:13'></a>Some little comments:

I know Matthias would like the `from sage.functions.other import ceil` import to be in the method that uses it to help him with the Sage modularization.

The text for `OUTPUT:` and `ALGORITHM:` should not be indented.

In `treelength()` and `_treelength()`, do you want to give some of your variables type information? For example, isn't `cc` a `set`?

Shouldn't `__destroy__` be `__dealloc__`?

```diff
-    TESTS::
+    TESTS:
 
     Check that the decomposition by clique separators is valid::
```



---

archive/issue_comments_439158.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-03T10:54:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439158",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439159.json:
```json
{
    "body": "<a id='comment:15'></a>I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.\n\nSurprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.",
    "created_at": "2021-10-03T10:56:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439159",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:15'></a>I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.

Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.



---

archive/issue_comments_439160.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 dcoudert]:\n> I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.\n\n\nI meant for Cython, like `cdef list result`.\n\n> Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.\n\n\nThat is quite surprising. Well, let's wait for the patchbot.",
    "created_at": "2021-10-03T11:31:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439160",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:16'></a>Replying to [comment:15 dcoudert]:
> I have implemented your comments, except for typing. I'm not sure how to add types information. It has not yet been done in the graph module.


I meant for Cython, like `cdef list result`.

> Surprisingly, the documentation of `tree_decomposition` was not built. I added it and made a few corrections.


That is quite surprising. Well, let's wait for the patchbot.



---

archive/issue_comments_439161.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-10-03T12:25:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439161",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_439162.json:
```json
{
    "body": "<a id='comment:18'></a>I added a few type informations.\n\nFor the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`.",
    "created_at": "2021-10-03T12:27:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439162",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:18'></a>I added a few type informations.

For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`.



---

archive/issue_comments_439163.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:18 dcoudert]:\n> I added a few type informations.\n\n\nThanks. That should make it run a bit faster (although it probably is at the mirco-optimization level).\n\n> For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`. \n\n\nQuite possibly. Anyways, if the patchbot comes back green, then positive review.",
    "created_at": "2021-10-03T12:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439163",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'></a>Replying to [comment:18 dcoudert]:
> I added a few type informations.


Thanks. That should make it run a bit faster (although it probably is at the mirco-optimization level).

> For the documentation, I suspect that `tree_decomposition` has been inadvertently removed from `src/doc/en/reference/graphs/index.rst`. 


Quite possibly. Anyways, if the patchbot comes back green, then positive review.



---

archive/issue_comments_439164.json:
```json
{
    "body": "<a id='comment:20'></a>A patchbot reports a reduction of the doctest coverage. I don't understand why. All methods (except methods defined inside another method) have either an `EXAMPLES` block or a `TESTS` block or both. Actually, 3 methods have only `TESTS` blocks and the patchbot says that the coverage is 11/14. Should I change these blocks to `EXAMPLES` (or add something) ?",
    "created_at": "2021-10-03T15:32:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439164",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:20'></a>A patchbot reports a reduction of the doctest coverage. I don't understand why. All methods (except methods defined inside another method) have either an `EXAMPLES` block or a `TESTS` block or both. Actually, 3 methods have only `TESTS` blocks and the patchbot says that the coverage is 11/14. Should I change these blocks to `EXAMPLES` (or add something) ?



---

archive/issue_comments_439165.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-03T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439165",
    "user": "https://github.com/tscrim"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_439166.json:
```json
{
    "body": "<a id='comment:21'></a>It is picking up the internal functions:\n\n```\ntravis@apricot:~/sage-build$ ./sage --coverage src/sage/graphs/graph_decompositions/tree_decomposition.pyx \n------------------------------------------------------------------------\nSCORE src/sage/graphs/graph_decompositions/tree_decomposition.pyx: 78.6% (11 of 14)\n\nMissing documentation:\n     * line 1077: def rec(cut, cc)\n     * line 1172: def good_label(x)\n     * line 1175: def good_label(x)\n```\nso it's fine. My guess is this is a bug in the coverage script by not filtering them out properly because they are within a `cdef` function.",
    "created_at": "2021-10-03T23:22:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439166",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:21'></a>It is picking up the internal functions:

```
travis@apricot:~/sage-build$ ./sage --coverage src/sage/graphs/graph_decompositions/tree_decomposition.pyx 
------------------------------------------------------------------------
SCORE src/sage/graphs/graph_decompositions/tree_decomposition.pyx: 78.6% (11 of 14)

Missing documentation:
     * line 1077: def rec(cut, cc)
     * line 1172: def good_label(x)
     * line 1175: def good_label(x)
```
so it's fine. My guess is this is a bug in the coverage script by not filtering them out properly because they are within a `cdef` function.



---

archive/issue_comments_439167.json:
```json
{
    "body": "<a id='comment:22'></a>Thank you for the review !",
    "created_at": "2021-10-04T06:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439167",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:22'></a>Thank you for the review !



---

archive/issue_events_080948.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-10-10T10:17:09Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30998#event-80948"
}
```



---

archive/issue_comments_439168.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-10-10T10:17:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30998",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30998#issuecomment-439168",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
