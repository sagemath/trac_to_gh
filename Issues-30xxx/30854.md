# Issue 30854: the view command silently does nothing in Jupyter notebooks

archive/issues_030617.json:
```json
{
    "body": "CC:  @yuan-zhou\n\n1. Try typing `view(2/3)` in a Jupyter notebook.  \n2. No visible output appears.\n\nI don't think ever worked in Jupyter, but it did in sagenb.  This is one of those things that got forgotten (?) when switching from sagenb to Jupyter.  \n\nUnder the hood what happens looks like this:\n\n```\nsage: sage.misc.latex.EMBEDDED_MODE = True\nsage: view(2/3)\n<html><script type=\"math/tex\">\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\frac{2}{3}</script></html>\n```\n\nI think this <html> thing in the output is something I made up long long ago to signal that the output should be displayed as HTML.  In Jupyter, one instead uses \n\n```\nfrom IPython.core.display import HTML\nHTML(r'<script type=\"math/tex\">\\newcommand{\\Bold}[1]{\\mathbf{#1}}\\frac{2}{3}</script>')\n```\n\nAnd the above does properly show a fraction.\n\nSo a slightly rewrite of view to work with Jupyter (and probably not with sagenb) is the way to go?\n\nIssue created by migration from https://trac.sagemath.org/ticket/30854\n\n",
    "created_at": "2020-11-02T21:56:06Z",
    "labels": [
        "component: notebook",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "the view command silently does nothing in Jupyter notebooks",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30854",
    "user": "https://github.com/williamstein"
}
```
CC:  @yuan-zhou

1. Try typing `view(2/3)` in a Jupyter notebook.  
2. No visible output appears.

I don't think ever worked in Jupyter, but it did in sagenb.  This is one of those things that got forgotten (?) when switching from sagenb to Jupyter.  

Under the hood what happens looks like this:

```
sage: sage.misc.latex.EMBEDDED_MODE = True
sage: view(2/3)
<html><script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}\frac{2}{3}</script></html>
```

I think this <html> thing in the output is something I made up long long ago to signal that the output should be displayed as HTML.  In Jupyter, one instead uses 

```
from IPython.core.display import HTML
HTML(r'<script type="math/tex">\newcommand{\Bold}[1]{\mathbf{#1}}\frac{2}{3}</script>')
```

And the above does properly show a fraction.

So a slightly rewrite of view to work with Jupyter (and probably not with sagenb) is the way to go?

Issue created by migration from https://trac.sagemath.org/ticket/30854





---

archive/issue_comments_437163.json:
```json
{
    "body": "I think #19515 and #26101 are relevant, I've been monkey patching the first one into my notebooks to render tikz diagrams inline, but it seems more is needed for inline math.",
    "created_at": "2020-11-03T06:31:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437163",
    "user": "https://github.com/alexjbest"
}
```

I think #19515 and #26101 are relevant, I've been monkey patching the first one into my notebooks to render tikz diagrams inline, but it seems more is needed for inline math.



---

archive/issue_comments_437164.json:
```json
{
    "body": "Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3",
    "created_at": "2021-02-02T22:55:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437164",
    "user": "https://github.com/yuan-zhou"
}
```

Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3



---

archive/issue_comments_437165.json:
```json
{
    "body": "I think this current behaviour (though it does make a pdf for me too) is non-optimal, Jupyter has the capacity to render TeX using mathjax in a cell. So rather than spawning TeX to make a pdf, pushing the TeX code to Jupyter to render via mathjax or at least copy the rendered tex to an image to be displayed inline should be the goal of this ticket.",
    "created_at": "2021-02-02T23:34:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437165",
    "user": "https://github.com/alexjbest"
}
```

I think this current behaviour (though it does make a pdf for me too) is non-optimal, Jupyter has the capacity to render TeX using mathjax in a cell. So rather than spawning TeX to make a pdf, pushing the TeX code to Jupyter to render via mathjax or at least copy the rendered tex to an image to be displayed inline should be the goal of this ticket.



---

archive/issue_comments_437166.json:
```json
{
    "body": "Replying to [comment:3 yzh]:\n> Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3\n\n\nIt works for me too with Sage 9.3.rc0: `view(2/3)` generates a pdf file, which is automatically opened by the default pdf viewer of my system (evince). This is with Firefox 86.0.1 on Ubuntu 20.04.",
    "created_at": "2021-03-24T20:33:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437166",
    "user": "https://github.com/egourgoulhon"
}
```

Replying to [comment:3 yzh]:
> Typing view(2/3) in a Jupyter notebook works fine for me: it opens a pdf file containing the fraction 2/3


It works for me too with Sage 9.3.rc0: `view(2/3)` generates a pdf file, which is automatically opened by the default pdf viewer of my system (evince). This is with Firefox 86.0.1 on Ubuntu 20.04.



---

archive/issue_comments_437167.json:
```json
{
    "body": "Changing status from new to needs_info.",
    "created_at": "2021-03-24T21:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437167",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_info.



---

archive/issue_comments_437168.json:
```json
{
    "body": "`@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?",
    "created_at": "2021-03-24T21:09:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437168",
    "user": "https://github.com/mkoeppe"
}
```

`@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?



---

archive/issue_comments_437169.json:
```json
{
    "body": "> `@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?\n\n\nCoCalc.com.  There is no X11 server running at all.   I should maybe amend the title of the ticket to say \"the view command silently does nothing in Jupyter notebooks when there is no X11 server\"?",
    "created_at": "2021-03-24T21:17:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437169",
    "user": "https://github.com/williamstein"
}
```

> `@`was Sounds like we need more info about the system on which you observed this behavior. Perhaps a broken pdf viewer?


CoCalc.com.  There is no X11 server running at all.   I should maybe amend the title of the ticket to say "the view command silently does nothing in Jupyter notebooks when there is no X11 server"?



---

archive/issue_comments_437170.json:
```json
{
    "body": "I would be happy with `view(2/3)` showing an error message rather than silently failing, though I don't know if that's even possible (given the asynchronous nature) of this.   \n\nAnyway, it's possible this is a problem for me to deal with on my end.  E.g., I could patch the view command on cocalc.",
    "created_at": "2021-03-24T21:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437170",
    "user": "https://github.com/williamstein"
}
```

I would be happy with `view(2/3)` showing an error message rather than silently failing, though I don't know if that's even possible (given the asynchronous nature) of this.   

Anyway, it's possible this is a problem for me to deal with on my end.  E.g., I could patch the view command on cocalc.



---

archive/issue_comments_437171.json:
```json
{
    "body": "#31536 seems related, I would say that if view fails for any reasons mathjax output should be attempted in the notebook isntead of an error.\n\nThere are other non-silent failures where this would be useful too: running a binder notebook https://mybinder.org/v2/gh/alexjbest/cluster-pictures/master?filepath=notebooks%2Fdemo.ipynb one sees an error that pdftex is not installed when you try view(2/3).",
    "created_at": "2021-03-24T21:40:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437171",
    "user": "https://github.com/alexjbest"
}
```

#31536 seems related, I would say that if view fails for any reasons mathjax output should be attempted in the notebook isntead of an error.

There are other non-silent failures where this would be useful too: running a binder notebook https://mybinder.org/v2/gh/alexjbest/cluster-pictures/master?filepath=notebooks%2Fdemo.ipynb one sees an error that pdftex is not installed when you try view(2/3).



---

archive/issue_comments_437172.json:
```json
{
    "body": "Moving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437172",
    "user": "https://github.com/mkoeppe"
}
```

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_080510.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80510"
}
```



---

archive/issue_events_080511.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80511"
}
```



---

archive/issue_events_080512.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80512"
}
```



---

archive/issue_comments_437173.json:
```json
{
    "body": "Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30854#issuecomment-437173",
    "user": "https://github.com/mkoeppe"
}
```

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_080513.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-12T17:35:59Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80513"
}
```



---

archive/issue_events_080514.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-12T17:35:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80514"
}
```



---

archive/issue_events_080515.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80515"
}
```



---

archive/issue_events_080516.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80516"
}
```



---

archive/issue_events_080517.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80517"
}
```



---

archive/issue_events_080518.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30854",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30854#event-80518"
}
```
