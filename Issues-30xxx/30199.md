# Issue 30199: Prime degree isogeny (di)graphs of elliptic curves

archive/issues_029962.json:
```json
{
    "assignees": [],
    "body": "Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.\n\nThis is functionality similar to the ticket #16942\n\n\nCC:  @defeo @JohnCremona\n\nBranch/Commit: **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**\n\nReviewer: **Luca De Feo**\n\nAuthor: **Marc Newman**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30199_\n\n",
    "closed_at": "2020-12-27T00:23:21Z",
    "created_at": "2020-07-22T15:02:40Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20elliptic%20curves",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Prime degree isogeny (di)graphs of elliptic curves",
    "type": "issue",
    "updated_at": "2020-12-27T00:23:21Z",
    "url": "https://github.com/sagemath/sage/issues/30199",
    "user": "https://github.com/marcbn"
}
```
Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.

This is functionality similar to the ticket #16942


CC:  @defeo @JohnCremona

Branch/Commit: **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**

Reviewer: **Luca De Feo**

Author: **Marc Newman**

_Issue created by migration from https://trac.sagemath.org/ticket/30199_





---

archive/issue_events_397667.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-07-22T15:02:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397667"
}
```



---

archive/issue_events_397668.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-07-22T15:02:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397668"
}
```



---

archive/issue_comments_481486.json:
```json
{
    "body": "Author: **Marc Newman**",
    "created_at": "2020-07-22T15:42:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481486",
    "user": "https://github.com/marcbn"
}
```

Author: **Marc Newman**



---

archive/issue_comments_481487.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,4 @@\n+Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.\n \n+This is functionality similar to the ticket here: #16942\n+\n``````\n",
    "created_at": "2020-07-22T15:42:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481487",
    "user": "https://github.com/marcbn"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,4 @@
+Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.
 
+This is functionality similar to the ticket here: #16942
+
``````




---

archive/issue_events_397669.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-07-22T15:42:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20elliptic%20curves",
    "label_color": "0000ff",
    "label_name": "component: elliptic curves",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397669"
}
```



---

archive/issue_events_397670.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-07-22T15:42:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397670"
}
```



---

archive/issue_comments_481488.json:
```json
{
    "body": "Branch: **[u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves)**",
    "created_at": "2020-07-22T15:43:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481488",
    "user": "https://github.com/marcbn"
}
```

Branch: **[u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves)**



---

archive/issue_comments_481489.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">Comment 3</div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/abc9c6ff5af2f770155a9aada3c1100a8fe01552\">abc9c6f</a></td><td><code>Separate equation string construction from `_repr_` method</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af\">72d8cf3</a></td><td><code>Add prime_isogeny_graph method</code></td></tr></table>\n",
    "created_at": "2020-07-22T16:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481489",
    "user": "https://github.com/defeo"
}
```

<div id="comment:3" align="right">Comment 3</div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/abc9c6ff5af2f770155a9aada3c1100a8fe01552">abc9c6f</a></td><td><code>Separate equation string construction from `_repr_` method</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af">72d8cf3</a></td><td><code>Add prime_isogeny_graph method</code></td></tr></table>




---

archive/issue_comments_481490.json:
```json
{
    "body": "Commit: **[72d8cf3](https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af)**",
    "created_at": "2020-07-22T16:00:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481490",
    "user": "https://github.com/defeo"
}
```

Commit: **[72d8cf3](https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af)**



---

archive/issue_events_397671.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397671"
}
```



---

archive/issue_events_397672.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397672"
}
```



---

archive/issue_comments_481491.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">Comment 5</div>\n\n* the doctest is not correctly formatted, missing `::` at the end of lines preceding doctests blocks\n\n* the changes about `_repr_` of elliptic curves are not useful and could be undone",
    "created_at": "2020-10-18T12:31:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481491",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:5" align="right">Comment 5</div>

* the doctest is not correctly formatted, missing `::` at the end of lines preceding doctests blocks

* the changes about `_repr_` of elliptic curves are not useful and could be undone



---

archive/issue_comments_481492.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.\n \n-This is functionality similar to the ticket here: #16942\n+This is functionality similar to the ticket #16942\n \n``````\n",
    "created_at": "2020-10-18T12:32:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481492",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
 Given an elliptic curve E and a prime l, this code outputs the graph or digraph object representing the l-degree isogeny (di)graph containing E with vertices isomorphism classes of curves labelled by either an equation of a representative curve or the associated j-invariant.
 
-This is functionality similar to the ticket here: #16942
+This is functionality similar to the ticket #16942
 
``````




---

archive/issue_comments_481493.json:
```json
{
    "body": "Changed commit from **[72d8cf3](https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af)** to **[b8e0862](https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce)**",
    "created_at": "2020-10-19T09:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481493",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[72d8cf3](https://github.com/sagemath/sagetrac-mirror/commit/72d8cf3136c47305b466a0a8b620ec10811044af)** to **[b8e0862](https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce)**



---

archive/issue_comments_481494.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">Comment 7</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce\">b8e0862</a></td><td><code>Fix doctest formatting</code></td></tr></table>\n",
    "created_at": "2020-10-19T09:57:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481494",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7" align="right">Comment 7</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce">b8e0862</a></td><td><code>Fix doctest formatting</code></td></tr></table>




---

archive/issue_comments_481495.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">Comment 8</div>\n\nI fixed the doctest formatting.  However, with regards to the `_repr_` changes, the curve equation is needed as a string to label the vertices and it seemed like the best way to get that was to separate that part out from the `_repr_` method instead of--for example--duplicating the code for assembling that equation string or extracting it from the full `_repr_` output.\\\\\n\\\\\nSo instead of pulling the `_equation_string` method out of the `_repr_` method, what would your recommendation for getting that curve equation string be?\\\\\n\\\\\nThanks!",
    "created_at": "2020-10-19T10:06:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481495",
    "user": "https://github.com/marcbn"
}
```

<div id="comment:8" align="right">Comment 8</div>

I fixed the doctest formatting.  However, with regards to the `_repr_` changes, the curve equation is needed as a string to label the vertices and it seemed like the best way to get that was to separate that part out from the `_repr_` method instead of--for example--duplicating the code for assembling that equation string or extracting it from the full `_repr_` output.\\
\\
So instead of pulling the `_equation_string` method out of the `_repr_` method, what would your recommendation for getting that curve equation string be?\\
\\
Thanks!



---

archive/issue_comments_481496.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">Comment 9</div>\n\nHi Marc,\n\nApologies for the dealy. This is excellent quality code, thanks! I'm not sure what chapoton was suggesting to do about `_repr_`, yours looks like the best choice to me (one may take the chance to simplify the printing code, btw, but that's not a necessity).\n\nSome minor remarks:\n\n- You could use `sparse=True`, or even `data_strcture=static_sparse` as parameter for the graph constructor, since users are likely to want to construct large graphs with small degree.\n- The two lines\n\n  ```\n  b = self.ainvs()\n  a = [z._coeff_repr() for z in b]\n  ```\n\n  in `_repr_` seem unncessary now.\n- On my server it takes ~30s to construct a supersingular 2-graph with ~1000 vertices, ~60s for the 3-graph, ~300s for the 5-graph. Maybe you could adjust `curve_max` depending on `l` (e.g., 3-4 increments). Also, the warning message could be more explicit, e.g.: Isogeny graph contains more than x curves.\n- Maybe the name `isogeny_graph_prime_degree` or `isogeny_ell_graph` is more easily discoverable than `prime_isogeny_graph`.\n\nFinally, a question: have you thought about the ordering of the outputs in the doctests? I assume `Graph` prints the vertices in the order they appear in the adjacency matrix, but what about edges? Is the ordering explicitly defined, or is there a risk that the doctests break at some future Sage release?\n\nIf you can solve these points, I'm happy to give positive review.",
    "created_at": "2020-12-09T23:43:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481496",
    "user": "https://github.com/defeo"
}
```

<div id="comment:9" align="right">Comment 9</div>

Hi Marc,

Apologies for the dealy. This is excellent quality code, thanks! I'm not sure what chapoton was suggesting to do about `_repr_`, yours looks like the best choice to me (one may take the chance to simplify the printing code, btw, but that's not a necessity).

Some minor remarks:

- You could use `sparse=True`, or even `data_strcture=static_sparse` as parameter for the graph constructor, since users are likely to want to construct large graphs with small degree.
- The two lines

  ```
  b = self.ainvs()
  a = [z._coeff_repr() for z in b]
  ```

  in `_repr_` seem unncessary now.
- On my server it takes ~30s to construct a supersingular 2-graph with ~1000 vertices, ~60s for the 3-graph, ~300s for the 5-graph. Maybe you could adjust `curve_max` depending on `l` (e.g., 3-4 increments). Also, the warning message could be more explicit, e.g.: Isogeny graph contains more than x curves.
- Maybe the name `isogeny_graph_prime_degree` or `isogeny_ell_graph` is more easily discoverable than `prime_isogeny_graph`.

Finally, a question: have you thought about the ordering of the outputs in the doctests? I assume `Graph` prints the vertices in the order they appear in the adjacency matrix, but what about edges? Is the ordering explicitly defined, or is there a risk that the doctests break at some future Sage release?

If you can solve these points, I'm happy to give positive review.



---

archive/issue_comments_481497.json:
```json
{
    "body": "Changed commit from **[b8e0862](https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce)** to **[fec79b9](https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a)**",
    "created_at": "2020-12-16T11:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481497",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[b8e0862](https://github.com/sagemath/sagetrac-mirror/commit/b8e086208a0ea7a6333096a7711075ecf8df1fce)** to **[fec79b9](https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a)**



---

archive/issue_comments_481498.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">Comment 10</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b249033894f81ddec5aa4f2d0e387062b83794a\">9b24903</a></td><td><code>Removed old lines from `_repr_` function</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa3accb41ccd5b4f50ceb70f54ef7dd103b8c69b\">aa3accb</a></td><td><code>Added different curve_max values given l; changed user warning message</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a\">fec79b9</a></td><td><code>Changed method name</code></td></tr></table>\n",
    "created_at": "2020-12-16T11:22:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481498",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10" align="right">Comment 10</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b249033894f81ddec5aa4f2d0e387062b83794a">9b24903</a></td><td><code>Removed old lines from `_repr_` function</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa3accb41ccd5b4f50ceb70f54ef7dd103b8c69b">aa3accb</a></td><td><code>Added different curve_max values given l; changed user warning message</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a">fec79b9</a></td><td><code>Changed method name</code></td></tr></table>




---

archive/issue_comments_481499.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">Comment 11</div>\n\nHi Luca,\n\nI updated the code as you requested.  A few things:\n- I cleaned up those two lines, used `static_sparse` for the graph, and changed the method name to `isogeny_ell_graph`.\n- For the multiple `curve_max` values: on my laptop, the warning is generally output after ~20 seconds.  However, when `l` is large, the warning will only fire after `E.isogenies_prime_degree(l)` returns which can take a while for big `l` values.\n- It seems like as long as the vertex labels are all comparable (which they are in this case), the edge order will be consistent.\n- However, when labelling the vertices with the curve equation (as opposed to the j-invariant) the ordering of the vertices when generating the graph could matter (since multiple isomorphic curve equations exist).  The vertex and edge order depends on the order of the isogenies returned by `isogenies_prime_degree`, the documentation for which does not explicitly specify an ordering.  So, if that method/algorithm is changed in such a way that the order of the returned isogenies changes, there is the chance that the tests for this will fail if walking the graph in one way results in different (but isomorphic) curve equations than walking it in another way.  Similarly, there is also a risk where some change to `isogenies_prime_degree` causes the method to return isogenies to curves isomorphic to what is currently being returned.  I'm not sure if it is appropriate to complicate the code here in order to prevent possible future test failures caused by changes which may or may not ever occur.  I can think about how to best do this if you think it's worthwhile though.  Let me know.\n\nThanks!",
    "created_at": "2020-12-16T11:24:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481499",
    "user": "https://github.com/marcbn"
}
```

<div id="comment:11" align="right">Comment 11</div>

Hi Luca,

I updated the code as you requested.  A few things:
- I cleaned up those two lines, used `static_sparse` for the graph, and changed the method name to `isogeny_ell_graph`.
- For the multiple `curve_max` values: on my laptop, the warning is generally output after ~20 seconds.  However, when `l` is large, the warning will only fire after `E.isogenies_prime_degree(l)` returns which can take a while for big `l` values.
- It seems like as long as the vertex labels are all comparable (which they are in this case), the edge order will be consistent.
- However, when labelling the vertices with the curve equation (as opposed to the j-invariant) the ordering of the vertices when generating the graph could matter (since multiple isomorphic curve equations exist).  The vertex and edge order depends on the order of the isogenies returned by `isogenies_prime_degree`, the documentation for which does not explicitly specify an ordering.  So, if that method/algorithm is changed in such a way that the order of the returned isogenies changes, there is the chance that the tests for this will fail if walking the graph in one way results in different (but isomorphic) curve equations than walking it in another way.  Similarly, there is also a risk where some change to `isogenies_prime_degree` causes the method to return isogenies to curves isomorphic to what is currently being returned.  I'm not sure if it is appropriate to complicate the code here in order to prevent possible future test failures caused by changes which may or may not ever occur.  I can think about how to best do this if you think it's worthwhile though.  Let me know.

Thanks!



---

archive/issue_comments_481500.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">Comment 12</div>\n\nI am only following this ticket from a distance, but am probably responsible for having written isogenies_prime_degree.  This was done for my own needs, for elliptic curves over number fields, where the prime degrees are never large, and the code is absolutely not intended to be used for large prime degrees -- it will then involve computing and factoring the l-division polynomial, which has degree (l^2-1)/2.  If you need to run it for larger primes then you will want to implement something better.\n\nI see no problem in making a change to the order of the output of this function, other than the usual one -- some doctests will fail.\n\nAlso, it is the case that automorphisms of prime degree, when they exist, will cause some of the isogenies computed by this function to have codomain isomorphic to the domain.  This is entirely correct.  If you don't want them then filter the output of the function, please do not change the function.",
    "created_at": "2020-12-16T11:56:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481500",
    "user": "https://github.com/JohnCremona"
}
```

<div id="comment:12" align="right">Comment 12</div>

I am only following this ticket from a distance, but am probably responsible for having written isogenies_prime_degree.  This was done for my own needs, for elliptic curves over number fields, where the prime degrees are never large, and the code is absolutely not intended to be used for large prime degrees -- it will then involve computing and factoring the l-division polynomial, which has degree (l^2-1)/2.  If you need to run it for larger primes then you will want to implement something better.

I see no problem in making a change to the order of the output of this function, other than the usual one -- some doctests will fail.

Also, it is the case that automorphisms of prime degree, when they exist, will cause some of the isogenies computed by this function to have codomain isomorphic to the domain.  This is entirely correct.  If you don't want them then filter the output of the function, please do not change the function.



---

archive/issue_comments_481501.json:
```json
{
    "body": "Reviewer: **Luca De Feo**",
    "created_at": "2020-12-16T12:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481501",
    "user": "https://github.com/defeo"
}
```

Reviewer: **Luca De Feo**



---

archive/issue_comments_481502.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">Comment 13</div>\n\nHi Marc, thanks for the changes. Regarding the doctesting framework, I don't think you need to account for `isogenies_prime_degree` returning random results:\n\n- The doctesting code of `isogenies_prime_degree` itself would break if it was non-deterministic, so there is an implicit assumption of determinism there.\n- If someone changes the code of `isogenies_prime_degree`, then they will have to update the doctests for that function and this one. I don't think that's asking too much.\n\nWhat would have been unreasonable, is asking someone who changes the code in `sage.graphs` to touch up the doctests here. But if `sage.graphs` respects some ordering, then we have a deal with `sage.graphs`.\n\n`@`John, Marc's code takes properly into account the multiple edges for j=0,1728. And, yes, we shouldn't worry about large l, this code is meant to be called with small l. If someone wants large degree isogeny graphs, that's their problem.\n\nThanks Marc, and thanks John for writing the original `isogenies_prime_degree`. I'm giving positive review (Marc, I just noticed you should have checked \"needs review\" a long time ago).",
    "created_at": "2020-12-16T12:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481502",
    "user": "https://github.com/defeo"
}
```

<div id="comment:13" align="right">Comment 13</div>

Hi Marc, thanks for the changes. Regarding the doctesting framework, I don't think you need to account for `isogenies_prime_degree` returning random results:

- The doctesting code of `isogenies_prime_degree` itself would break if it was non-deterministic, so there is an implicit assumption of determinism there.
- If someone changes the code of `isogenies_prime_degree`, then they will have to update the doctests for that function and this one. I don't think that's asking too much.

What would have been unreasonable, is asking someone who changes the code in `sage.graphs` to touch up the doctests here. But if `sage.graphs` respects some ordering, then we have a deal with `sage.graphs`.

`@`John, Marc's code takes properly into account the multiple edges for j=0,1728. And, yes, we shouldn't worry about large l, this code is meant to be called with small l. If someone wants large degree isogeny graphs, that's their problem.

Thanks Marc, and thanks John for writing the original `isogenies_prime_degree`. I'm giving positive review (Marc, I just noticed you should have checked "needs review" a long time ago).



---

archive/issue_events_397673.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2020-12-16T12:05:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397673"
}
```



---

archive/issue_events_397674.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2020-12-16T12:05:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397674"
}
```



---

archive/issue_events_397675.json:
```json
{
    "actor": "https://github.com/defeo",
    "created_at": "2020-12-16T12:05:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397675"
}
```



---

archive/issue_comments_481503.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">Comment 15</div>\n\nHello,\n\nto avoid some future work to clean the code, I suggest to fix some minor points in the coding style (pep8):\n- no dot at the end of the short sentence\n\n```diff\n-        - ``l`` -- prime degree of isogenies.\n+        - ``l`` -- prime degree of isogenies\n```\n\n- the convention for parameters is like:\n\n```diff\n-        - ``directed`` (default True) -- return a directed graph if ``True``;\n-          otherwise return an undirected graph.  In the undirected case, the\n+        - ``directed`` -- boolean (default: ``True``); whether to return\n+           a directed or an undirected graph. In the undirected case, the\n          in-degrees and out-degrees of the vertices must be balanced and\n          therefore the number of out-edges from the vertices corresponding to\n          j-invariants 0 and 1728 (if they are part of the graph) are reduced\n          to match the number of in-edges.\n```\nIn particular, always use <code>\\`\\`True\\`\\`</code>, <code>\\`\\`False\\`\\`</code>, <code>\\`\\`\\`None\\`\\`</code>\n\n- at least 2 spaces before `#` and one after, for instance\n\n```diff\n-                m = len(E.automorphisms()) / 2 #multiplicity of out-edges\n+                m = len(E.automorphisms()) / 2  # multiplicity of out-edges\n```\n\n\nAnd finally, there is no need for a loop here\n\n```diff\n-                while s in labels: s += \"*\"\n+                s += \"*\" * len(labels)\n```",
    "created_at": "2020-12-16T12:51:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481503",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">Comment 15</div>

Hello,

to avoid some future work to clean the code, I suggest to fix some minor points in the coding style (pep8):
- no dot at the end of the short sentence

```diff
-        - ``l`` -- prime degree of isogenies.
+        - ``l`` -- prime degree of isogenies
```

- the convention for parameters is like:

```diff
-        - ``directed`` (default True) -- return a directed graph if ``True``;
-          otherwise return an undirected graph.  In the undirected case, the
+        - ``directed`` -- boolean (default: ``True``); whether to return
+           a directed or an undirected graph. In the undirected case, the
          in-degrees and out-degrees of the vertices must be balanced and
          therefore the number of out-edges from the vertices corresponding to
          j-invariants 0 and 1728 (if they are part of the graph) are reduced
          to match the number of in-edges.
```
In particular, always use <code>\`\`True\`\`</code>, <code>\`\`False\`\`</code>, <code>\`\`\`None\`\`</code>

- at least 2 spaces before `#` and one after, for instance

```diff
-                m = len(E.automorphisms()) / 2 #multiplicity of out-edges
+                m = len(E.automorphisms()) / 2  # multiplicity of out-edges
```


And finally, there is no need for a loop here

```diff
-                while s in labels: s += "*"
+                s += "*" * len(labels)
```



---

archive/issue_comments_481504.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">Comment 16</div>\n\nReplying to [@dcoudert](#comment%3A15):\n>\n> And finally, there is no need for a loop here\n>\n> ```diff\n> -                while s in labels: s += \"*\"\n> +                s += \"*\" * len(labels)\n> ```\n> \n\nUh? No, that's not equivalent. That's only adding as many `*` as necssary to make a unique label.\n\nArguably, I don't think it's possible to have a j-invariant appear more than twice in any isogeny graph (as usual, one should check for j=0,1728), so\n\n```\n    if s in labels: s += \"*\"\n```\n\nwould likely suffice, however I see no harm in the `while` loop.",
    "created_at": "2020-12-16T13:13:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481504",
    "user": "https://github.com/defeo"
}
```

<div id="comment:16" align="right">Comment 16</div>

Replying to [@dcoudert](#comment%3A15):
>
> And finally, there is no need for a loop here
>
> ```diff
> -                while s in labels: s += "*"
> +                s += "*" * len(labels)
> ```
> 

Uh? No, that's not equivalent. That's only adding as many `*` as necssary to make a unique label.

Arguably, I don't think it's possible to have a j-invariant appear more than twice in any isogeny graph (as usual, one should check for j=0,1728), so

```
    if s in labels: s += "*"
```

would likely suffice, however I see no harm in the `while` loop.



---

archive/issue_comments_481505.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">Comment 17</div>\n\nRight. I confused myself. Sorry.",
    "created_at": "2020-12-16T13:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481505",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:17" align="right">Comment 17</div>

Right. I confused myself. Sorry.



---

archive/issue_comments_481506.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">Comment 18</div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00\">4b59634</a></td><td><code>Cleaned up comments and documentation</code></td></tr></table>\n",
    "created_at": "2020-12-16T15:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481506",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18" align="right">Comment 18</div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00">4b59634</a></td><td><code>Cleaned up comments and documentation</code></td></tr></table>




---

archive/issue_events_397676.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-12-16T15:21:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397676"
}
```



---

archive/issue_events_397677.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-12-16T15:21:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397677"
}
```



---

archive/issue_comments_481507.json:
```json
{
    "body": "Changed commit from **[fec79b9](https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a)** to **[4b59634](https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00)**",
    "created_at": "2020-12-16T15:21:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481507",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[fec79b9](https://github.com/sagemath/sagetrac-mirror/commit/fec79b9f9fa7d940e1665aacc67485d9ba51f16a)** to **[4b59634](https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00)**



---

archive/issue_comments_481508.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">Comment 19</div>\n\nReplying to [@dcoudert](#comment%3A15):\n\n> to avoid some future work to clean the code, I suggest to fix some minor points in the coding style (pep8):\n\nI got this cleaned up as suggested (but left the `while` loop as is).  Let me know if there is any other cleanup necessary.",
    "created_at": "2020-12-16T15:26:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481508",
    "user": "https://github.com/marcbn"
}
```

<div id="comment:19" align="right">Comment 19</div>

Replying to [@dcoudert](#comment%3A15):

> to avoid some future work to clean the code, I suggest to fix some minor points in the coding style (pep8):

I got this cleaned up as suggested (but left the `while` loop as is).  Let me know if there is any other cleanup necessary.



---

archive/issue_comments_481509.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">Comment 20</div>\n\nanother minor one.\n\n```diff\n-                while s in labels: s += \"*\"\n+                while s in labels:\n+                    s += \"*\"\n```",
    "created_at": "2020-12-16T15:31:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481509",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">Comment 20</div>

another minor one.

```diff
-                while s in labels: s += "*"
+                while s in labels:
+                    s += "*"
```



---

archive/issue_comments_481510.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">Comment 21</div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921\">89274a6</a></td><td><code>Added line break to while loop</code></td></tr></table>\n",
    "created_at": "2020-12-16T15:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481510",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21" align="right">Comment 21</div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921">89274a6</a></td><td><code>Added line break to while loop</code></td></tr></table>




---

archive/issue_comments_481511.json:
```json
{
    "body": "Changed commit from **[4b59634](https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00)** to **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**",
    "created_at": "2020-12-16T15:35:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481511",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4b59634](https://github.com/sagemath/sagetrac-mirror/commit/4b59634af076914604064774b8ed1fdc1497df00)** to **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**



---

archive/issue_events_397678.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-12-18T16:04:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397678"
}
```



---

archive/issue_events_397679.json:
```json
{
    "actor": "https://github.com/marcbn",
    "created_at": "2020-12-18T16:04:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397679"
}
```



---

archive/issue_comments_481512.json:
```json
{
    "body": "Changed branch from **[u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves)** to **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**",
    "created_at": "2020-12-27T00:23:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30199#issuecomment-481512",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-marcbn/prime_degree_isogeny__di_graphs_of_elliptic_curves)** to **[89274a6](https://github.com/sagemath/sagetrac-mirror/commit/89274a683e6bd63ec922762f5a6e6cc9c1bbe921)**



---

archive/issue_events_397680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-27T00:23:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397680"
}
```



---

archive/issue_events_397681.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "44b6d7584bd55b3c0c8d58fcd998cb291c4d87b0",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-27T00:23:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30199",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30199#event-397681"
}
```
