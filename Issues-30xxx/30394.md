# Issue 30394: Graphs: add antipodal check and folding of graphs

archive/issues_030157.json:
```json
{
    "assignees": [],
    "body": "Add a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph.\n\nCC:  @dimpase\n\nComponent: **graph theory**\n\nAuthor: **Ivo Maffei**\n\nBranch/Commit: **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**\n\nReviewer: **David Coudert**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30394_\n\n",
    "closed_at": "2020-08-30T08:38:50Z",
    "created_at": "2020-08-19T16:28:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Graphs: add antipodal check and folding of graphs",
    "type": "issue",
    "updated_at": "2020-08-30T08:38:50Z",
    "url": "https://github.com/sagemath/sage/issues/30394",
    "user": "https://github.com/Ivo-Maffei"
}
```
Add a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph.

CC:  @dimpase

Component: **graph theory**

Author: **Ivo Maffei**

Branch/Commit: **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**

Reviewer: **David Coudert**

_Issue created by migration from https://trac.sagemath.org/ticket/30394_





---

archive/issue_events_415805.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-19T16:28:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415805"
}
```



---

archive/issue_events_415806.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-19T16:28:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415806"
}
```



---

archive/issue_events_415807.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-19T16:28:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415807"
}
```



---

archive/issue_events_415808.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-19T16:28:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415808"
}
```



---

archive/issue_comments_483715.json:
```json
{
    "body": "Branch: **[public/graphs/30394](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30394)**",
    "created_at": "2020-08-19T16:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483715",
    "user": "https://github.com/Ivo-Maffei"
}
```

Branch: **[public/graphs/30394](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30394)**



---

archive/issue_comments_483716.json:
```json
{
    "body": "Commit: **[`804c4b1`](https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047)**",
    "created_at": "2020-08-19T16:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483716",
    "user": "https://github.com/Ivo-Maffei"
}
```

Commit: **[`804c4b1`](https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047)**



---

archive/issue_comments_483717.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b94eb15896ac4a44a5d6939637bf1f7bf27c7932\"><code>b94eb15</code></a></td><td><code>added antipodal and folded graph methods; most docstrings done</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047\"><code>804c4b1</code></a></td><td><code>fixed bug; finished docstrings/doctests</code></td></tr></table>\n",
    "created_at": "2020-08-19T16:28:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483717",
    "user": "https://github.com/Ivo-Maffei"
}
```

<div id="comment:1"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b94eb15896ac4a44a5d6939637bf1f7bf27c7932"><code>b94eb15</code></a></td><td><code>added antipodal and folded graph methods; most docstrings done</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047"><code>804c4b1</code></a></td><td><code>fixed bug; finished docstrings/doctests</code></td></tr></table>




---

archive/issue_events_415809.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-19T16:28:57Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415809"
}
```



---

archive/issue_events_415810.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-08-19T17:35:36Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "title_is": "Graphs: add antipodal check and folding of graphs",
    "title_was": "Graphs: added antipodal check and folding of graphs",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415810"
}
```



---

archive/issue_comments_483718.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-Added a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph\n+Add a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph.\n``````\n",
    "created_at": "2020-08-19T17:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483718",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-Added a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph
+Add a method to check whether an undirected graph is antipodal and a method to compute the antipodal folding of an undirected graph.
``````




---

archive/issue_comments_483719.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2020-08-20T08:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483719",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_483720.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\ncheck simple cases: 0 or 1 vertex, not connected\n\nin folded graphs, it would be nice to have a way to check if the input is antipodal, either calling `is_antipodal`, or using appropriate tests during the construction (if any).\n\nConcerning the construction of the antipodal graph, I have an idea of a better/faster solution than what you propose. I will do some tests and come back to you.",
    "created_at": "2020-08-20T08:33:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483720",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

check simple cases: 0 or 1 vertex, not connected

in folded graphs, it would be nice to have a way to check if the input is antipodal, either calling `is_antipodal`, or using appropriate tests during the construction (if any).

Concerning the construction of the antipodal graph, I have an idea of a better/faster solution than what you propose. I will do some tests and come back to you.



---

archive/issue_comments_483721.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nalso, the current construction for antipodal graphs, `G = self.distance_graph(self.diameter())`, contains all the vertices of `G`. Is it correct according the definition of antipodal graphs ?",
    "created_at": "2020-08-20T08:53:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483721",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:4" align="right">comment:4</div>

also, the current construction for antipodal graphs, `G = self.distance_graph(self.diameter())`, contains all the vertices of `G`. Is it correct according the definition of antipodal graphs ?



---

archive/issue_comments_483722.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nThe idea to build the antipodal graph is the following (adding only the vertices involved in an antipodal pair):\n\n```\ndef antipodal_graph(G):\n    \"\"\"\n    Return the antipodal graph of ``G``.\n    \"\"\"\n    ecc = G.eccentricity(algorithm=\"DHV\", with_labels=True)\n    diam = max(ecc.values())\n    # Get the list of antipodal vertices, i.e., with eccentricity = diameter\n    V = [u for u, ecc_u in ecc.items() if ecc_u == diam]\n\n    E = set()\n    for u in V:\n        for v, d in G.breadth_first_search(u, report_distance=True):\n            if d == diam:\n                E.add(frozenset((u, v)))\n\n    name = f\"antipodal graph of {G.name()}\"\n    return Graph([V, E], format='vertices_and_edges', name=name)\n```\nIt is interesting for large graphs (e.g., >= 1000 nodes), and significant speed up can be obtained using Cython.\nAlso, the space complexity is in `O(n)`, while the current method has space complexity in `O(n^2)`.\n\nThe main idea is to:\n- first compute the eccentricity of the vertices. The DHV algorithm is fast in practice and usually compute distances from a few vertices.\n- Then, for each vertex with eccentricity = diameter, we search for the antipodal pairs.\n\nIt can be done quickly on large graphs. But of course it is not interesting for graphs like `JohnsonGraph(10, 5)`.\n\nThis can be done in another ticket. It requires some care to get a fast implementation.",
    "created_at": "2020-08-20T09:21:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483722",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:5" align="right">comment:5</div>

The idea to build the antipodal graph is the following (adding only the vertices involved in an antipodal pair):

```
def antipodal_graph(G):
    """
    Return the antipodal graph of ``G``.
    """
    ecc = G.eccentricity(algorithm="DHV", with_labels=True)
    diam = max(ecc.values())
    # Get the list of antipodal vertices, i.e., with eccentricity = diameter
    V = [u for u, ecc_u in ecc.items() if ecc_u == diam]

    E = set()
    for u in V:
        for v, d in G.breadth_first_search(u, report_distance=True):
            if d == diam:
                E.add(frozenset((u, v)))

    name = f"antipodal graph of {G.name()}"
    return Graph([V, E], format='vertices_and_edges', name=name)
```
It is interesting for large graphs (e.g., >= 1000 nodes), and significant speed up can be obtained using Cython.
Also, the space complexity is in `O(n)`, while the current method has space complexity in `O(n^2)`.

The main idea is to:
- first compute the eccentricity of the vertices. The DHV algorithm is fast in practice and usually compute distances from a few vertices.
- Then, for each vertex with eccentricity = diameter, we search for the antipodal pairs.

It can be done quickly on large graphs. But of course it is not interesting for graphs like `JohnsonGraph(10, 5)`.

This can be done in another ticket. It requires some care to get a fast implementation.



---

archive/issue_comments_483723.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@dcoudert](#comment%3A4):\n> also, the current construction for antipodal graphs, `G = self.distance_graph(self.diameter())`, contains all the vertices of `G`. Is it correct according the definition of antipodal graphs ?\n\nProbably depends on your definition of antipodal graph. The definition I believe to be the most common is:\nGiven a graph G, the antipodal graph of G, denoted by A(G), has the same vertex set of G and two vertices are adjacent if their distance in G is equal to the diameter of G. If G is disconnected we define its diameter to be (plus) infinity.\n\nIf you know any other definition that ends up being more useful in some scenarios, then let me know.\n\nHowever, note that I never call `G = self.distance_graph(self.diameter())` the antipodal graph of `self`, but only the distance-d graph.\n\nThe current implementations are rather slow so if your proposal is actually faster is very appreciated. However, I don't think your proposal computes the same graph as the straightforward `self.distance_graph(self.diameter())` since some vertices can be left out.\n\nI'll fix your review comments, try speed things up and get back to you.",
    "created_at": "2020-08-20T10:11:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483723",
    "user": "https://github.com/Ivo-Maffei"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@dcoudert](#comment%3A4):
> also, the current construction for antipodal graphs, `G = self.distance_graph(self.diameter())`, contains all the vertices of `G`. Is it correct according the definition of antipodal graphs ?

Probably depends on your definition of antipodal graph. The definition I believe to be the most common is:
Given a graph G, the antipodal graph of G, denoted by A(G), has the same vertex set of G and two vertices are adjacent if their distance in G is equal to the diameter of G. If G is disconnected we define its diameter to be (plus) infinity.

If you know any other definition that ends up being more useful in some scenarios, then let me know.

However, note that I never call `G = self.distance_graph(self.diameter())` the antipodal graph of `self`, but only the distance-d graph.

The current implementations are rather slow so if your proposal is actually faster is very appreciated. However, I don't think your proposal computes the same graph as the straightforward `self.distance_graph(self.diameter())` since some vertices can be left out.

I'll fix your review comments, try speed things up and get back to you.



---

archive/issue_comments_483724.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nto get the same vertex set, it suffices to use `Graph([G, E], ...)`.",
    "created_at": "2020-08-20T10:14:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483724",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:7" align="right">comment:7</div>

to get the same vertex set, it suffices to use `Graph([G, E], ...)`.



---

archive/issue_comments_483725.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56\"><code>4b12c23</code></a></td><td><code>added doctests; expanded folded graph to check antipodal; sketch antipodal implementations</code></td></tr></table>\n",
    "created_at": "2020-08-20T12:04:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483725",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56"><code>4b12c23</code></a></td><td><code>added doctests; expanded folded graph to check antipodal; sketch antipodal implementations</code></td></tr></table>




---

archive/issue_comments_483726.json:
```json
{
    "body": "Changed commit from **[`804c4b1`](https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047)** to **[`4b12c23`](https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56)**",
    "created_at": "2020-08-20T12:04:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483726",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`804c4b1`](https://github.com/sagemath/sagetrac-mirror/commit/804c4b17d87e86efbb5cd05b6beb45f63d0b3047)** to **[`4b12c23`](https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56)**



---

archive/issue_comments_483727.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nA few things:\n\nI can't think of any disconnected antipodal graph to check what `folded_graph` would do.\nAt the moment `folded_graph` and `is_antipodal` raise a `ValueError` when the graph is empty as \"its diameter is undefined\".\nI personally don't like this, and I would set `is_antipodal` to True and the `folded_graph` would be empty, but this might be unnatural.\n\nI tried your implementation of `antipodal_graph` in a cython file (sage\\graphs\\generators\\distance_regular.pyx) and it seems very slow (not sure why). So I wrote another `antipodal_graph` method which is pretty straight-forward and tested them a bit on a large graph\n\n```sage\nsage: from sage.graphs.generators.distance_regular import antipodal_graph1, antipodal_graph2                                                                                                                                                  \nsage: G = graphs.JohnsonGraph(14, 7)                                                                                                                                                                                                          \nsage: G                                                                                                                                                                                                                                       \nJohnson graph with parameters 14,7: Graph on 3432 vertices\nsage: %timeit antipodal_graph1(G)                                                                                                                                                                                                             \n29.3 s \u00b1 814 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\nsage: %time antipodal_graph2(G)\n# don't know; stopped after > 3 min\n```\n\nI don't think the filtering `V = [u for u, ecc_u in ecc.items() if ecc_u == diam]` is any good in this scenario as all eccentricities are equal to the diameter 7.\n\nUnless you spot some obvious mistake I did, I think I'll open another ticket to get a fast implementation of `antipodal_graph`.",
    "created_at": "2020-08-20T12:11:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483727",
    "user": "https://github.com/Ivo-Maffei"
}
```

<div id="comment:9" align="right">comment:9</div>

A few things:

I can't think of any disconnected antipodal graph to check what `folded_graph` would do.
At the moment `folded_graph` and `is_antipodal` raise a `ValueError` when the graph is empty as "its diameter is undefined".
I personally don't like this, and I would set `is_antipodal` to True and the `folded_graph` would be empty, but this might be unnatural.

I tried your implementation of `antipodal_graph` in a cython file (sage\graphs\generators\distance_regular.pyx) and it seems very slow (not sure why). So I wrote another `antipodal_graph` method which is pretty straight-forward and tested them a bit on a large graph

```sage
sage: from sage.graphs.generators.distance_regular import antipodal_graph1, antipodal_graph2                                                                                                                                                  
sage: G = graphs.JohnsonGraph(14, 7)                                                                                                                                                                                                          
sage: G                                                                                                                                                                                                                                       
Johnson graph with parameters 14,7: Graph on 3432 vertices
sage: %timeit antipodal_graph1(G)                                                                                                                                                                                                             
29.3 s ± 814 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
sage: %time antipodal_graph2(G)
# don't know; stopped after > 3 min
```

I don't think the filtering `V = [u for u, ecc_u in ecc.items() if ecc_u == diam]` is any good in this scenario as all eccentricities are equal to the diameter 7.

Unless you spot some obvious mistake I did, I think I'll open another ticket to get a fast implementation of `antipodal_graph`.



---

archive/issue_comments_483728.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nYour implementation of `antipodal_graph2` is less efficient than mine. Indeed, you compute BFS from all vertices, while my proposal is to compute BFS only from vertices with eccentricity the diameter.\nOf course, in a graph like the `JohnsonGraph` where all vertices have for eccentricity the diameter, my method will be slower than the basic method. But if you try on a 2D grid graph, the proposed method should be way faster. In such graph, the DHV algorithm will compute all eccentricities with about 8 BFS, and then you have to compute BFS from only 4 vertices to get the result.\nThis is related to a research project I'm currently working on, and that can be used to enumerate (antipodal) pairs quickly and using few memory.\n\n\nA separate ticket is much better. I don't have time yet to work on it and will ask Vipul Gupta to help.\n\nRoughly, to be efficient, it must be implemented using `short_digraph` (see `distances_all_pairs.pyx`), and call low level methods. However, I realize that we have several improvement to do before in `distances_all_pairs.pyx` to avoid extra conversions from one format to the other (not difficult).",
    "created_at": "2020-08-20T13:05:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483728",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:10" align="right">comment:10</div>

Your implementation of `antipodal_graph2` is less efficient than mine. Indeed, you compute BFS from all vertices, while my proposal is to compute BFS only from vertices with eccentricity the diameter.
Of course, in a graph like the `JohnsonGraph` where all vertices have for eccentricity the diameter, my method will be slower than the basic method. But if you try on a 2D grid graph, the proposed method should be way faster. In such graph, the DHV algorithm will compute all eccentricities with about 8 BFS, and then you have to compute BFS from only 4 vertices to get the result.
This is related to a research project I'm currently working on, and that can be used to enumerate (antipodal) pairs quickly and using few memory.


A separate ticket is much better. I don't have time yet to work on it and will ask Vipul Gupta to help.

Roughly, to be efficient, it must be implemented using `short_digraph` (see `distances_all_pairs.pyx`), and call low level methods. However, I realize that we have several improvement to do before in `distances_all_pairs.pyx` to avoid extra conversions from one format to the other (not difficult).



---

archive/issue_comments_483729.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478\"><code>bd6466f</code></a></td><td><code>removed attepmts to antipodal_graph</code></td></tr></table>\n",
    "created_at": "2020-08-20T13:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483729",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478"><code>bd6466f</code></a></td><td><code>removed attepmts to antipodal_graph</code></td></tr></table>




---

archive/issue_comments_483730.json:
```json
{
    "body": "Changed commit from **[`4b12c23`](https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56)** to **[`bd6466f`](https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478)**",
    "created_at": "2020-08-20T13:30:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483730",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4b12c23`](https://github.com/sagemath/sagetrac-mirror/commit/4b12c2346a55a47861af170a3e4c671d2f86ec56)** to **[`bd6466f`](https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478)**



---

archive/issue_comments_483731.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b549b0b206bf2d6824e6b12367a8bb23396a7832\"><code>b549b0b</code></a></td><td><code>added placeholder antipodal_graph method; #30405 should change it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748\"><code>f1f9aa4</code></a></td><td><code>fix docstring</code></td></tr></table>\n",
    "created_at": "2020-08-20T14:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483731",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b549b0b206bf2d6824e6b12367a8bb23396a7832"><code>b549b0b</code></a></td><td><code>added placeholder antipodal_graph method; #30405 should change it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748"><code>f1f9aa4</code></a></td><td><code>fix docstring</code></td></tr></table>




---

archive/issue_comments_483732.json:
```json
{
    "body": "Changed commit from **[`bd6466f`](https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478)** to **[`f1f9aa4`](https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748)**",
    "created_at": "2020-08-20T14:05:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483732",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bd6466f`](https://github.com/sagemath/sagetrac-mirror/commit/bd6466fde848fa807332601a9af359c640997478)** to **[`f1f9aa4`](https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748)**



---

archive/issue_comments_483733.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nlet us limit this ticket to the distance regular case, and deal with a general case on another ticket.",
    "created_at": "2020-08-22T08:22:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483733",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:13" align="right">comment:13</div>

let us limit this ticket to the distance regular case, and deal with a general case on another ticket.



---

archive/issue_comments_483734.json:
```json
{
    "body": "Changed commit from **[`f1f9aa4`](https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748)** to **[`c603942`](https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634)**",
    "created_at": "2020-08-22T10:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483734",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f1f9aa4`](https://github.com/sagemath/sagetrac-mirror/commit/f1f9aa49ab96364cf529e507dfc752431792c748)** to **[`c603942`](https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634)**



---

archive/issue_comments_483735.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634\"><code>c603942</code></a></td><td><code>trac #30394: review commit</code></td></tr></table>\n",
    "created_at": "2020-08-22T10:40:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483735",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634"><code>c603942</code></a></td><td><code>trac #30394: review commit</code></td></tr></table>




---

archive/issue_comments_483736.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI pushed minor corrections. In particular, for the mapping int -> cliques, we can simply use a list.",
    "created_at": "2020-08-22T10:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483736",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

I pushed minor corrections. In particular, for the mapping int -> cliques, we can simply use a list.



---

archive/issue_comments_483737.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nLGTM.",
    "created_at": "2020-08-22T10:43:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483737",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:16" align="right">comment:16</div>

LGTM.



---

archive/issue_events_415811.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-22T10:43:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415811"
}
```



---

archive/issue_events_415812.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-08-22T10:43:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415812"
}
```



---

archive/issue_comments_483738.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nMerge conflict",
    "created_at": "2020-08-23T22:23:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483738",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:17" align="right">comment:17</div>

Merge conflict



---

archive/issue_events_415813.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-23T22:23:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415813"
}
```



---

archive/issue_events_415814.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-23T22:23:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415814"
}
```



---

archive/issue_comments_483739.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d\"><code>9dbb93d</code></a></td><td><code>Merge branch 9.2.beta10 into 30394</code></td></tr></table>\n",
    "created_at": "2020-08-24T09:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483739",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d"><code>9dbb93d</code></a></td><td><code>Merge branch 9.2.beta10 into 30394</code></td></tr></table>




---

archive/issue_comments_483740.json:
```json
{
    "body": "Changed commit from **[`c603942`](https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634)** to **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**",
    "created_at": "2020-08-24T09:42:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483740",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c603942`](https://github.com/sagemath/sagetrac-mirror/commit/c603942d68a7ff97268f0a998cc0ff52b90dc634)** to **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**



---

archive/issue_comments_483741.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nNothing major, just a conflict with #30355",
    "created_at": "2020-08-24T09:44:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483741",
    "user": "https://github.com/Ivo-Maffei"
}
```

<div id="comment:19" align="right">comment:19</div>

Nothing major, just a conflict with #30355



---

archive/issue_events_415815.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-24T09:44:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415815"
}
```



---

archive/issue_events_415816.json:
```json
{
    "actor": "https://github.com/Ivo-Maffei",
    "created_at": "2020-08-24T09:44:08Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415816"
}
```



---

archive/issue_events_415817.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-30T08:38:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415817"
}
```



---

archive/issue_events_415818.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "855b7818ae158afd72050eb372a20583a1c2b717",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-30T08:38:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30394#event-415818"
}
```



---

archive/issue_comments_483742.json:
```json
{
    "body": "Changed branch from **[public/graphs/30394](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30394)** to **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**",
    "created_at": "2020-08-30T08:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30394",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30394#issuecomment-483742",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/graphs/30394](https://github.com/sagemath/sagetrac-mirror/tree/public/graphs/30394)** to **[`9dbb93d`](https://github.com/sagemath/sagetrac-mirror/commit/9dbb93d683410ad205e5f346f4c030928b93666d)**
