# Issue 30216: GH Actions: Test Windows with WSL

archive/issues_029979.json:
```json
{
    "body": "https://groups.google.com/d/msg/sage-devel/vC0ySd4HGeQ/RBA_XrqLBAAJ\n\n\n\nCC:  @dimpase @tobiasdiez @embray\n\nBranch/Commit: e8a984b0982cf277838e57a13681d7122f44ef47\n\nReviewer: Matthias Koeppe\n\nAuthor: Tobias Diez\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30216\n\n",
    "closed_at": "2020-09-15T21:58:38Z",
    "created_at": "2020-07-25T18:13:44Z",
    "labels": [
        "component: porting"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "GH Actions: Test Windows with WSL",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30216",
    "user": "https://github.com/mkoeppe"
}
```
https://groups.google.com/d/msg/sage-devel/vC0ySd4HGeQ/RBA_XrqLBAAJ



CC:  @dimpase @tobiasdiez @embray

Branch/Commit: e8a984b0982cf277838e57a13681d7122f44ef47

Reviewer: Matthias Koeppe

Author: Tobias Diez

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30216





---

archive/issue_comments_594114.json:
```json
{
    "body": "<a id='comment:2'></a>Something like the following?\nhttps://github.com/tobiasdiez/sage/blob/patch-2/.github/workflows/build.yml\n\nThe bootstrap command fails currently, https://github.com/tobiasdiez/sage/runs/1051391795?check_suite_focus=true any idea why?",
    "created_at": "2020-08-31T14:14:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594114",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'></a>Something like the following?
https://github.com/tobiasdiez/sage/blob/patch-2/.github/workflows/build.yml

The bootstrap command fails currently, https://github.com/tobiasdiez/sage/runs/1051391795?check_suite_focus=true any idea why?



---

archive/issue_comments_594115.json:
```json
{
    "body": "<a id='comment:3'></a>Looks like whitespace in PATH and insufficient quoting somewhere",
    "created_at": "2020-08-31T14:16:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594115",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Looks like whitespace in PATH and insufficient quoting somewhere



---

archive/issue_comments_594116.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks `@`mkoeppe, it was indeed missing quotes. After a lot of trial and error, it seems to work now (at least the build runs now for almost 2h already).\n\nLet me know if there is something else to do:\nhttps://github.com/sagemath/sage/pull/97\nIf not then I'll move the PR to trac.",
    "created_at": "2020-09-01T11:51:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594116",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>Thanks `@`mkoeppe, it was indeed missing quotes. After a lot of trial and error, it seems to work now (at least the build runs now for almost 2h already).

Let me know if there is something else to do:
https://github.com/sagemath/sage/pull/97
If not then I'll move the PR to trac.



---

archive/issue_comments_594117.json:
```json
{
    "body": "<a id='comment:6'></a>Please rename `build.yml` to something more specific - perhaps `ci-wsl.yml`\n\nAlso, please replace the hardcoded Ubuntu package lists by using the `debian*.txt` files in `build/pkgs`, following these examples:\n\n```\n$ grep  'PACKAGES=`sed' tox.ini\n    homebrew:      bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/homebrew*.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'\n    homebrew-standard:   bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'\n    homebrew-maximal:    bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'\n    local-conda:   bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/conda*.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'\n    local-conda-standard:  bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/conda.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'\n    local-conda-maximal:   bash -c 'PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/conda.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'\n```",
    "created_at": "2020-09-01T16:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594117",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Please rename `build.yml` to something more specific - perhaps `ci-wsl.yml`

Also, please replace the hardcoded Ubuntu package lists by using the `debian*.txt` files in `build/pkgs`, following these examples:

```
$ grep  'PACKAGES=`sed' tox.ini
    homebrew:      bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/homebrew*.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'
    homebrew-standard:   bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'
    homebrew-maximal:    bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/homebrew.txt`; {env:HOMEBREW}/bin/brew install $PACKAGES; {env:HOMEBREW}/bin/brew upgrade $PACKAGES'
    local-conda:   bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/conda*.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'
    local-conda-standard:  bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/conda.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'
    local-conda-maximal:   bash -c 'PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/conda.txt`; {env:SETENV} && {env:CONDA_PREFIX}/bin/conda install --yes --quiet $PACKAGES'
```



---

archive/issue_comments_594118.json:
```json
{
    "body": "<a id='comment:7'></a>BTW, the build errored with \n\n```\n[ecl-20.4.24.p1] /usr/include/stdio.h:864:11: fatal error: ../ecl/gc/bits/stdio.h: Invalid argument\n```",
    "created_at": "2020-09-01T16:36:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>BTW, the build errored with 

```
[ecl-20.4.24.p1] /usr/include/stdio.h:864:11: fatal error: ../ecl/gc/bits/stdio.h: Invalid argument
```



---

archive/issue_comments_594119.json:
```json
{
    "body": "<a id='comment:8'></a>And you could use the steps starting with \"Build and test with tox\" from the job `local-macos-nohomebrew` defined in `tox.yml`",
    "created_at": "2020-09-01T16:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594119",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>And you could use the steps starting with "Build and test with tox" from the job `local-macos-nohomebrew` defined in `tox.yml`



---

archive/issue_comments_594120.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks for the feedback.\n\nReplying to [comment:6 mkoeppe]:\n> Please rename `build.yml` to something more specific - perhaps `ci-wsl.yml`\n\n\nI was thinking about adding basic builds (and doctests) for ubuntu-latest and macos-latest as well, so that this workflow serves as a basic check that the build works on all os. If this is not intended, I'll rename the file.\n\n\n> Also, please replace the hardcoded Ubuntu package lists by using the `debian*.txt` files in `build/pkgs`, following these examples:\n\n\nDone!\n\n\n> BTW, the build errored with \n\n\nNo idea why. I've read somewhere that there might be a problem parallel make (e.g `make -j8`). I triggered a build now with `j1`, let's see if it works.\n\n> And you could use the steps starting with \"Build and test with tox\" from the job local-macos-nohomebrew defined in tox.yml\n\n\nWhat exactly do you mean? This workflow is about homebrew, and I'm not sure how this translates to WSL.",
    "created_at": "2020-09-02T16:16:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594120",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Thanks for the feedback.

Replying to [comment:6 mkoeppe]:
> Please rename `build.yml` to something more specific - perhaps `ci-wsl.yml`


I was thinking about adding basic builds (and doctests) for ubuntu-latest and macos-latest as well, so that this workflow serves as a basic check that the build works on all os. If this is not intended, I'll rename the file.


> Also, please replace the hardcoded Ubuntu package lists by using the `debian*.txt` files in `build/pkgs`, following these examples:


Done!


> BTW, the build errored with 


No idea why. I've read somewhere that there might be a problem parallel make (e.g `make -j8`). I triggered a build now with `j1`, let's see if it works.

> And you could use the steps starting with "Build and test with tox" from the job local-macos-nohomebrew defined in tox.yml


What exactly do you mean? This workflow is about homebrew, and I'm not sure how this translates to WSL.



---

archive/issue_comments_594121.json:
```json
{
    "body": "<a id='comment:10'></a>These steps: \n\n```\n      - name: Build and test with tox\n        # We use a high parallelization on purpose in order to catch possible parallelization bugs in the build scripts.\n        # For doctesting, we use a lower parallelization to avoid timeouts.\n        run: |\n          MAKE=\"make -j12\" tox -e $TOX_ENV -- SAGE_NUM_THREADS=4 $TARGETS\n```\nSet TOX_ENV to just `local`, and it will take care of bootstrap, configure, make\n\n```\n      - name: Prepare logs artifact\n        run: |\n          mkdir -p \"artifacts/$LOGS_ARTIFACT_NAME\"; cp -r .tox/*/log \"artifacts/$LOGS_ARTIFACT_NAME\"\n        if: always()\n      - uses: actions/upload-artifact@v1\n        with:\n          path: artifacts\n          name: ${{ env.LOGS_ARTIFACT_NAME }}\n        if: always()\n      - name: Print out logs for immediate inspection\n        # and markup the output with GitHub Actions logging commands\n        run: |\n          .github/workflows/scan-logs.sh \"artifacts/$LOGS_ARTIFACT_NAME\"\n        if: always()\n```\nThese steps package up and print logs.",
    "created_at": "2020-09-02T17:58:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594121",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>These steps: 

```
      - name: Build and test with tox
        # We use a high parallelization on purpose in order to catch possible parallelization bugs in the build scripts.
        # For doctesting, we use a lower parallelization to avoid timeouts.
        run: |
          MAKE="make -j12" tox -e $TOX_ENV -- SAGE_NUM_THREADS=4 $TARGETS
```
Set TOX_ENV to just `local`, and it will take care of bootstrap, configure, make

```
      - name: Prepare logs artifact
        run: |
          mkdir -p "artifacts/$LOGS_ARTIFACT_NAME"; cp -r .tox/*/log "artifacts/$LOGS_ARTIFACT_NAME"
        if: always()
      - uses: actions/upload-artifact@v1
        with:
          path: artifacts
          name: ${{ env.LOGS_ARTIFACT_NAME }}
        if: always()
      - name: Print out logs for immediate inspection
        # and markup the output with GitHub Actions logging commands
        run: |
          .github/workflows/scan-logs.sh "artifacts/$LOGS_ARTIFACT_NAME"
        if: always()
```
These steps package up and print logs.



---

archive/issue_comments_594122.json:
```json
{
    "body": "<a id='comment:11'></a>Thanks, that's now implemnted. But how do I now pass `--enable-build-as-root` to configure? Everything in WSL is run as root so this is needed.\n\n\nMoreover, I'm not sure if the the upload of the logs is really necessary as you can already download logs from a github action session by clicking the hamburger menu of the workflow run (e.g on https://github.com/tobiasdiez/sage/runs/1062527848?check_suite_focus=true)",
    "created_at": "2020-09-02T19:24:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594122",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>Thanks, that's now implemnted. But how do I now pass `--enable-build-as-root` to configure? Everything in WSL is run as root so this is needed.


Moreover, I'm not sure if the the upload of the logs is really necessary as you can already download logs from a github action session by clicking the hamburger menu of the workflow run (e.g on https://github.com/tobiasdiez/sage/runs/1062527848?check_suite_focus=true)



---

archive/issue_comments_594123.json:
```json
{
    "body": "<a id='comment:12'></a>Use `EXTRA_CONFIGURE_ARGS`",
    "created_at": "2020-09-02T19:28:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594123",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Use `EXTRA_CONFIGURE_ARGS`



---

archive/issue_comments_594124.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks. I tried it via `export EXTRA_CONFIGURE_ARGS='--enable-build-as-root'` but that doesn't seem to work (still complains that it cannot run as root)",
    "created_at": "2020-09-02T19:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594124",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>Thanks. I tried it via `export EXTRA_CONFIGURE_ARGS='--enable-build-as-root'` but that doesn't seem to work (still complains that it cannot run as root)



---

archive/issue_comments_594125.json:
```json
{
    "body": "<a id='comment:14'></a>I see in the github log: `wsl export EXTRA_CONFIGURE_ARGS='--enable-build-as-root'` - that probably will only set it in a shell and then exit immediately.\n\nTry instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`",
    "created_at": "2020-09-03T03:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594125",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>I see in the github log: `wsl export EXTRA_CONFIGURE_ARGS='--enable-build-as-root'` - that probably will only set it in a shell and then exit immediately.

Try instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`



---

archive/issue_comments_594126.json:
```json
{
    "body": "<a id='comment:15'></a>That sadly also doesn't wored, but I've now found a way using shared env variables between Windows and WSL.\n\nLet's see what kind of build errors we encounter this time ;-).\nThe previous build (https://github.com/tobiasdiez/sage/runs/1062488288?check_suite_focus=true without tox) stopped with\n\n```\n2020-09-02T21:14:28.9292553Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_flint.pxd -> build/lib.linux-x86_64-3.7/sage/rings/polynomial\n2020-09-02T21:14:28.9302991Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_flint.pyx -> build/lib.linux-x86_64-3.7/sage/rings/polynomial\n2020-09-02T21:14:28.9314076Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_ntl.pxd -> build/lib.linux-x86_64-3.7/sage/rings/polynomial\n2020-09-02T21:14:28.9326509Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_ntl.pyx -> build/lib.linux-x86_64-3.7/sage/rings/polynomial\n2020-09-02T21:14:28.9326783Z [sagelib-9.2.beta10] error: could not open './sage/rings/polynomial/polynomial_integer_dense_ntl.pyx': Invalid argument\n```\nAny ideas what the problem is here?\n\nMoreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?\n\n```\nconfigure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\nconfigure:   $ sudo apt-get update \n  $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...\n```",
    "created_at": "2020-09-03T09:33:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594126",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:15'></a>That sadly also doesn't wored, but I've now found a way using shared env variables between Windows and WSL.

Let's see what kind of build errors we encounter this time ;-).
The previous build (https://github.com/tobiasdiez/sage/runs/1062488288?check_suite_focus=true without tox) stopped with

```
2020-09-02T21:14:28.9292553Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_flint.pxd -> build/lib.linux-x86_64-3.7/sage/rings/polynomial
2020-09-02T21:14:28.9302991Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_flint.pyx -> build/lib.linux-x86_64-3.7/sage/rings/polynomial
2020-09-02T21:14:28.9314076Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_ntl.pxd -> build/lib.linux-x86_64-3.7/sage/rings/polynomial
2020-09-02T21:14:28.9326509Z [sagelib-9.2.beta10] copying ./sage/rings/polynomial/polynomial_integer_dense_ntl.pyx -> build/lib.linux-x86_64-3.7/sage/rings/polynomial
2020-09-02T21:14:28.9326783Z [sagelib-9.2.beta10] error: could not open './sage/rings/polynomial/polynomial_integer_dense_ntl.pyx': Invalid argument
```
Any ideas what the problem is here?

Moreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?

```
configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
configure:   $ sudo apt-get update 
  $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...
```



---

archive/issue_comments_594127.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:\n> Try instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`\n\n\nNote - no semicolon. `env VAR1=VALUE1 VAR2=VALUE COMMAND...`",
    "created_at": "2020-09-03T10:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Replying to [comment:14 mkoeppe]:
> Try instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`


Note - no semicolon. `env VAR1=VALUE1 VAR2=VALUE COMMAND...`



---

archive/issue_comments_594128.json:
```json
{
    "body": "<a id='comment:17'></a>Replying to [comment:15 gh-tobiasdiez]:\n> Moreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?\n> \n> ```\n> configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\n> configure:   $ sudo apt-get update \n>   $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...\n> ```\n\n\nTake a look at `tox.ini` and `build/bin/write-dockerfile.sh`. We define and test 3 configurations, `minimal`, `standard` and `maximal`. In the `minimal` configuration, only the packages from `debian.txt` and `debian-bootstrap.txt` are installed. The other two configurations also use packages from `build/pkgs/*/distros/debian.txt`.\n(See https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-docker-based-build-testing-using-tox)",
    "created_at": "2020-09-03T10:37:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594128",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>Replying to [comment:15 gh-tobiasdiez]:
> Moreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?
> 
> ```
> configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
> configure:   $ sudo apt-get update 
>   $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...
> ```


Take a look at `tox.ini` and `build/bin/write-dockerfile.sh`. We define and test 3 configurations, `minimal`, `standard` and `maximal`. In the `minimal` configuration, only the packages from `debian.txt` and `debian-bootstrap.txt` are installed. The other two configurations also use packages from `build/pkgs/*/distros/debian.txt`.
(See https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-docker-based-build-testing-using-tox)



---

archive/issue_comments_594129.json:
```json
{
    "body": "<a id='comment:18'></a>Replying to [comment:16 mkoeppe]:\n> Replying to [comment:14 mkoeppe]:\n> > Try instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`\n\n> \n> Note - no semicolon. `env VAR1=VALUE1 VAR2=VALUE COMMAND...`\n> \n\nThat doesn't work, as wsl only accept one command as an argument. But I think the current solution with the env statement in the action is cleaner anyway.",
    "created_at": "2020-09-03T11:06:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594129",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:18'></a>Replying to [comment:16 mkoeppe]:
> Replying to [comment:14 mkoeppe]:
> > Try instead `wsl env EXTRA_CONFIGURE_ARGS='--enable-build-as-root' tox -e local -- SAGE_NUM_THREADS=4 build`

> 
> Note - no semicolon. `env VAR1=VALUE1 VAR2=VALUE COMMAND...`
> 

That doesn't work, as wsl only accept one command as an argument. But I think the current solution with the env statement in the action is cleaner anyway.



---

archive/issue_comments_594130.json:
```json
{
    "body": "<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:\n> Replying to [comment:15 gh-tobiasdiez]:\n> > Moreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?\n> > \n> > ```\n> > configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:\n> > configure:   $ sudo apt-get update \n> >   $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...\n> > ```\n\n> \n> Take a look at `tox.ini` and `build/bin/write-dockerfile.sh`. We define and test 3 configurations, `minimal`, `standard` and `maximal`. In the `minimal` configuration, only the packages from `debian.txt` and `debian-bootstrap.txt` are installed. The other two configurations also use packages from `build/pkgs/*/distros/debian.txt`.\n> (See https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-docker-based-build-testing-using-tox)\n\n\nOk, but this is not really reusable, right? So I would propose to add the additional dependencies as hard coded in the github action. Improving on this point I would leave for a new PR. Ok?",
    "created_at": "2020-09-03T11:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594130",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:19'></a>Replying to [comment:17 mkoeppe]:
> Replying to [comment:15 gh-tobiasdiez]:
> > Moreover, should the following packages be installed via apt-get as recommended? Should I add them to the debian.txt?
> > 
> > ```
> > configure: hint: installing the following system packages is recommended and may avoid building some of the above SPKGs from source:
> > configure:   $ sudo apt-get update 
> >   $ sudo apt-get install libflint-arb-dev libboost-dev libboost-dev libbrial-dev libbrial-groebner-dev libbz2-dev bzip2 coinor-cbc coinor-libcbc-dev libcdd-dev libcdd-tools cliquer libcliquer-dev cmake curl libcurl4-openssl-dev libec-dev eclib-tools gmp-ecm libecm-dev fflas-ffpack libflint-dev flintqs libfreetype6-dev libgf2x-dev gfan gfortran libgivaro-dev glpk-utils libglpk-dev pari-gp2c libgsl-dev libiml-dev libisl-dev lcalc liblfunction-dev libatomic-ops-dev libbraiding-dev libffi-dev libgd-dev liblrcalc-dev libm4rie-dev libmpc-dev libmpfi-dev libmpfr-dev nauty libncurses5-dev ninja-build libntl-dev libopenblas-dev palp pandoc pari-gp2c libpari-dev pari-doc pari-elldata pari-galdata pari-galpol pari-seadata libpcre3-dev libxml-libxslt-perl libxml-writer-perl libxml2-dev libperl-dev libfile-slurp-perl libjson-perl libsvg-perl libterm-readkey-perl libterm-readline-gnu-perl libmongodb-perl libterm-readline-gnu-perl libplanarity-dev planarity libppl-dev ppl-dev python3.7 libpython3.7-dev python3-distutils r-b...
> > ```

> 
> Take a look at `tox.ini` and `build/bin/write-dockerfile.sh`. We define and test 3 configurations, `minimal`, `standard` and `maximal`. In the `minimal` configuration, only the packages from `debian.txt` and `debian-bootstrap.txt` are installed. The other two configurations also use packages from `build/pkgs/*/distros/debian.txt`.
> (See https://doc.sagemath.org/html/en/developer/portability_testing.html#automatic-docker-based-build-testing-using-tox)


Ok, but this is not really reusable, right? So I would propose to add the additional dependencies as hard coded in the github action. Improving on this point I would leave for a new PR. Ok?



---

archive/issue_comments_594131.json:
```json
{
    "body": "<a id='comment:20'></a>Moreover, the MAKEFLAGS env variable is overwritten by tox -e local. Is this by design, or a bug? As far as I know the solution via alias `make = make -j2` is not recommended because it changes the make command globally (not a concern for the GH workflow, but in general). Since there are anyways problems with running WSL in parallel mode, I leave this also for further work.",
    "created_at": "2020-09-03T11:10:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594131",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>Moreover, the MAKEFLAGS env variable is overwritten by tox -e local. Is this by design, or a bug? As far as I know the solution via alias `make = make -j2` is not recommended because it changes the make command globally (not a concern for the GH workflow, but in general). Since there are anyways problems with running WSL in parallel mode, I leave this also for further work.



---

archive/issue_comments_594132.json:
```json
{
    "body": "<a id='comment:21'></a>A one-line approximation of `standard` and `maximal` is:\n\n```\nPACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/debian.txt`\n```\nPlease don't hard-code package lists.",
    "created_at": "2020-09-03T11:10:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594132",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>A one-line approximation of `standard` and `maximal` is:

```
PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/debian.txt`
```
Please don't hard-code package lists.



---

archive/issue_comments_594133.json:
```json
{
    "body": "<a id='comment:22'></a>Replying to [comment:20 gh-tobiasdiez]:\n> Moreover, the MAKEFLAGS env variable is overwritten by tox -e local. Is this by design, or a bug? As far as I know the solution via alias `make = make -j2` is not recommended because it changes the make command globally (not a concern for the GH workflow, but in general). \n\nThe recommendation in Sage currently is to use the environment setting `MAKE=\"make -j2\"`. `tox` passes on `MAKE` (see `passenv` in tox.ini`)",
    "created_at": "2020-09-03T11:14:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594133",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Replying to [comment:20 gh-tobiasdiez]:
> Moreover, the MAKEFLAGS env variable is overwritten by tox -e local. Is this by design, or a bug? As far as I know the solution via alias `make = make -j2` is not recommended because it changes the make command globally (not a concern for the GH workflow, but in general). 

The recommendation in Sage currently is to use the environment setting `MAKE="make -j2"`. `tox` passes on `MAKE` (see `passenv` in tox.ini`)



---

archive/issue_comments_594134.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:21 mkoeppe]:\n> A one-line approximation of `standard` and `maximal` is:\n> \n> ```\n> PACKAGES=`sed \"s/#.*//;\" build/pkgs/*/distros/debian.txt`\n> ```\n> Please don't hard-code package lists.\n\n\n\nI've now used the powershell version of this. The bootstrap and config works now, but the build fails with\n\n```\n  [scipy-1.5.2]       return self.get_paths(self.section, key)\n  [scipy-1.5.2]     /mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/include/suitesparse/python3.7m is invalid.\n  [scipy-1.5.2]       return self.get_paths(self.section, key)\n  [scipy-1.5.2]     error: Command \"gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fdebug-prefix-map=/build/python3.7-n1NpHY/python3.7-3.7.9=. -fstack-protector-strong -Wformat -Werror=format-security -g -fdebug-prefix-map=/build/python3.7-n1NpHY/python3.7-3.7.9=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -DNO_ATLAS_INFO=1 -DHAVE_CBLAS -I/usr/include/x86_64-linux-gnu/openblas-pthread/ -I/tmp/pip-req-build-kps_f__m/scipy/special -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/usr/include/python3.7m -Iscipy/_lib -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/include -I/usr/include/python3.7m -c scipy/special/cython_special.c -o build/temp.linux-x86_64-3.7/scipy/special/cython_special.o -MMD -MF build/temp.linux-x86_64-3.7/scipy/special/cython_special.o.d\" failed with exit status 1\n  [scipy-1.5.2]     Building wheel for scipy (PEP 517): finished with status 'error'\n  [scipy-1.5.2]     ERROR: Failed building wheel for scipy\n  [scipy-1.5.2]   Failed to build scipy\n  [scipy-1.5.2]   ERROR: Could not build wheels for scipy which use PEP 517 and cannot be installed directly\n  [scipy-1.5.2]   Exception information:\n  [scipy-1.5.2]   Traceback (most recent call last):\n  [scipy-1.5.2]     File \"/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/cli/base_command.py\", line 188, in _main\n  [scipy-1.5.2]       status = self.run(options, args)\n  [scipy-1.5.2]     File \"/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/cli/req_command.py\", line 185, in wrapper\n  [scipy-1.5.2]       return func(self, options, args)\n  [scipy-1.5.2]     File \"/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/commands/install.py\", line 378, in run\n  [scipy-1.5.2]       \", \".join(r.name for r in pep517_build_failures)))\n  [scipy-1.5.2]   pip._internal.exceptions.InstallationError: Could not build wheels for scipy which use PEP 517 and cannot be installed directly\n  [scipy-1.5.2]   Removed build tracker: '/tmp/pip-req-tracker-_k7u0ca_'\n  [scipy-1.5.2]   Error: installing with pip3 failed\n```\nhttps://github.com/tobiasdiez/sage/runs/1067282589?check_suite_focus=true\nAny ideas what causes this?\n\nThe github action workflow is finished from my point of view. Should I convert it to a trac branch, and then leave fixing the build issues for another ticket?",
    "created_at": "2020-09-03T19:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594134",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>Replying to [comment:21 mkoeppe]:
> A one-line approximation of `standard` and `maximal` is:
> 
> ```
> PACKAGES=`sed "s/#.*//;" build/pkgs/*/distros/debian.txt`
> ```
> Please don't hard-code package lists.



I've now used the powershell version of this. The bootstrap and config works now, but the build fails with

```
  [scipy-1.5.2]       return self.get_paths(self.section, key)
  [scipy-1.5.2]     /mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/distutils/system_info.py:838: UserWarning: Specified path /usr/include/suitesparse/python3.7m is invalid.
  [scipy-1.5.2]       return self.get_paths(self.section, key)
  [scipy-1.5.2]     error: Command "gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O2 -Wall -g -fdebug-prefix-map=/build/python3.7-n1NpHY/python3.7-3.7.9=. -fstack-protector-strong -Wformat -Werror=format-security -g -fdebug-prefix-map=/build/python3.7-n1NpHY/python3.7-3.7.9=. -fstack-protector-strong -Wformat -Werror=format-security -Wdate-time -D_FORTIFY_SOURCE=2 -fPIC -DNO_ATLAS_INFO=1 -DHAVE_CBLAS -I/usr/include/x86_64-linux-gnu/openblas-pthread/ -I/tmp/pip-req-build-kps_f__m/scipy/special -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/usr/include/python3.7m -Iscipy/_lib -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/numpy/core/include -I/mnt/d/a/sage/sage/.tox/local/local/include -I/usr/include/python3.7m -c scipy/special/cython_special.c -o build/temp.linux-x86_64-3.7/scipy/special/cython_special.o -MMD -MF build/temp.linux-x86_64-3.7/scipy/special/cython_special.o.d" failed with exit status 1
  [scipy-1.5.2]     Building wheel for scipy (PEP 517): finished with status 'error'
  [scipy-1.5.2]     ERROR: Failed building wheel for scipy
  [scipy-1.5.2]   Failed to build scipy
  [scipy-1.5.2]   ERROR: Could not build wheels for scipy which use PEP 517 and cannot be installed directly
  [scipy-1.5.2]   Exception information:
  [scipy-1.5.2]   Traceback (most recent call last):
  [scipy-1.5.2]     File "/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/cli/base_command.py", line 188, in _main
  [scipy-1.5.2]       status = self.run(options, args)
  [scipy-1.5.2]     File "/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/cli/req_command.py", line 185, in wrapper
  [scipy-1.5.2]       return func(self, options, args)
  [scipy-1.5.2]     File "/mnt/d/a/sage/sage/.tox/local/local/lib/python3.7/site-packages/pip/_internal/commands/install.py", line 378, in run
  [scipy-1.5.2]       ", ".join(r.name for r in pep517_build_failures)))
  [scipy-1.5.2]   pip._internal.exceptions.InstallationError: Could not build wheels for scipy which use PEP 517 and cannot be installed directly
  [scipy-1.5.2]   Removed build tracker: '/tmp/pip-req-tracker-_k7u0ca_'
  [scipy-1.5.2]   Error: installing with pip3 failed
```
https://github.com/tobiasdiez/sage/runs/1067282589?check_suite_focus=true
Any ideas what causes this?

The github action workflow is finished from my point of view. Should I convert it to a trac branch, and then leave fixing the build issues for another ticket?



---

archive/issue_comments_594135.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-04T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594135",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_594136.json:
```json
{
    "body": "Changing commit from \"\" to \"b6147eeaa57db463c7d3765c3d599f1b8516d5e4\"",
    "created_at": "2020-09-04T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594136",
    "user": "https://github.com/tobiasdiez"
}
```

Changing commit from "" to "b6147eeaa57db463c7d3765c3d599f1b8516d5e4"



---

archive/issue_comments_594137.json:
```json
{
    "body": "Changing branch from \"\" to \"public/build/ghWSL\"",
    "created_at": "2020-09-04T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594137",
    "user": "https://github.com/tobiasdiez"
}
```

Changing branch from "" to "public/build/ghWSL"



---

archive/issue_comments_594138.json:
```json
{
    "body": "<a id='comment:24'></a>So this is now ready for review.\n\nSadly it still doesn't build correctly. The current error message is\n\n```\ncd '/mnt/d/a/sage/sage/build/pkgs/sagelib' && . '/mnt/d/a/sage/sage/src/bin/sage-env-config' && . '/mnt/d/a/sage/sage/src/bin/sage-env' && . '/mnt/d/a/sage/sage/build/bin/sage-build-env-config' && sage-logger -p '/mnt/d/a/sage/sage/build/pkgs/sagelib/spkg-install' '/mnt/d/a/sage/sage/logs/pkgs/sagelib-9.2.beta10.log'\n[sagelib-9.2.beta10] installing. Log file: /mnt/d/a/sage/sage/logs/pkgs/sagelib-9.2.beta10.log\n....\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/element.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/element.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/gap_includes.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/libgap.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/util.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   copying ./sage/libs/gap/util.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap\n  [sagelib-9.2.beta10]   creating build/lib.linux-x86_64-3.7/sage/libs/giac\n  [sagelib-9.2.beta10]   copying ./sage/libs/giac/auto-methods.pxi -> build/lib.linux-x86_64-3.7/sage/libs/giac\n  [sagelib-9.2.beta10]   error: can't copy './sage/libs/giac/giac.pxd': doesn't exist or not a regular file\n```\n\nIf somebody can explain to me why these cython files need to be copied to the build folder, I'll have a look a this problem in a follow-up ticket.\n\n\nMoreover, it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.\n\n---\nLast 10 new commits:",
    "created_at": "2020-09-04T12:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594138",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:24'></a>So this is now ready for review.

Sadly it still doesn't build correctly. The current error message is

```
cd '/mnt/d/a/sage/sage/build/pkgs/sagelib' && . '/mnt/d/a/sage/sage/src/bin/sage-env-config' && . '/mnt/d/a/sage/sage/src/bin/sage-env' && . '/mnt/d/a/sage/sage/build/bin/sage-build-env-config' && sage-logger -p '/mnt/d/a/sage/sage/build/pkgs/sagelib/spkg-install' '/mnt/d/a/sage/sage/logs/pkgs/sagelib-9.2.beta10.log'
[sagelib-9.2.beta10] installing. Log file: /mnt/d/a/sage/sage/logs/pkgs/sagelib-9.2.beta10.log
....
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/element.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/element.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/gap_includes.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/libgap.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/util.pxd -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   copying ./sage/libs/gap/util.pyx -> build/lib.linux-x86_64-3.7/sage/libs/gap
  [sagelib-9.2.beta10]   creating build/lib.linux-x86_64-3.7/sage/libs/giac
  [sagelib-9.2.beta10]   copying ./sage/libs/giac/auto-methods.pxi -> build/lib.linux-x86_64-3.7/sage/libs/giac
  [sagelib-9.2.beta10]   error: can't copy './sage/libs/giac/giac.pxd': doesn't exist or not a regular file
```

If somebody can explain to me why these cython files need to be copied to the build folder, I'll have a look a this problem in a follow-up ticket.


Moreover, it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.

---
Last 10 new commits:



---

archive/issue_comments_594139.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-04T14:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594139",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_594140.json:
```json
{
    "body": "<a id='comment:25'></a>Thanks a lot for this contribution.",
    "created_at": "2020-09-04T14:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594140",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Thanks a lot for this contribution.



---

archive/issue_comments_594141.json:
```json
{
    "body": "Changing author from \"\" to \"Tobias Diez\"",
    "created_at": "2020-09-04T14:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594141",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Tobias Diez"



---

archive/issue_events_078051.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-04T14:57:24Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30216#event-78051"
}
```



---

archive/issue_comments_594142.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-04T14:57:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594142",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_594143.json:
```json
{
    "body": "<a id='comment:26'></a>Replying to [comment:24 gh-tobiasdiez]:\n> it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.\n\n\nMy workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.",
    "created_at": "2020-09-04T14:59:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594143",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Replying to [comment:24 gh-tobiasdiez]:
> it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.


My workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.



---

archive/issue_comments_594144.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:\n> Replying to [comment:24 gh-tobiasdiez]:\n> > it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.\n\n> \n> My workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.\n> \n> \n\ngithub Actions on sagemirror are disabled, as it's just a mirror, and not even updated automatically. (I push there once in a while from a private copy of trac git repo, that's how it's supported - ideas how to automate it without running a cron job are welcome).",
    "created_at": "2020-09-04T16:19:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594144",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>Replying to [comment:26 mkoeppe]:
> Replying to [comment:24 gh-tobiasdiez]:
> > it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.

> 
> My workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.
> 
> 

github Actions on sagemirror are disabled, as it's just a mirror, and not even updated automatically. (I push there once in a while from a private copy of trac git repo, that's how it's supported - ideas how to automate it without running a cron job are welcome).



---

archive/issue_comments_594145.json:
```json
{
    "body": "<a id='comment:28'></a>it seems we badly need \nhttps://github.com/marketplace/actions/cancel-all-previous-workflow-runs",
    "created_at": "2020-09-04T16:46:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594145",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:28'></a>it seems we badly need 
https://github.com/marketplace/actions/cancel-all-previous-workflow-runs



---

archive/issue_comments_594146.json:
```json
{
    "body": "<a id='comment:29'></a>That's now #30506",
    "created_at": "2020-09-04T17:40:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594146",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>That's now #30506



---

archive/issue_comments_594147.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:27 dimpase]:\n> Replying to [comment:26 mkoeppe]:\n> > Replying to [comment:24 gh-tobiasdiez]:\n> > > it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.\n\n> > \n> > My workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.\n> > \n> > \n\n> github Actions on sagemirror are disabled, as it's just a mirror, and not even updated automatically. (I push there once in a while from a private copy of trac git repo, that's how it's supported - ideas how to automate it without running a cron job are welcome).\n\n\nI see. Still, I would think it is helpful if the github actions are activated for this repo as well, especially with view towards #30404 and the idea that these github actions serve as a continuous integration check (maybe eventually replacing the patchbot). I think there are also no disadvantages to enabling the github actions there.\n\nConcerning updating the mirror, I guess the easiest solution would be to use a trac plugin such as https://github.com/trac-hacks/trac-github. This has the advantage that one could push to github, and the trac repo is updated as well. However, I think this requires that people primarily push to github, and no longer trac.\nAnother solution would be to add a git post-commit hook to git repo managed by trac, as e.g. here: https://stackoverflow.com/questions/3583061/automatically-mirror-a-git-repository.\nYet another way is to use a scheduled github action that updates the mirror automatically say every 30 min.",
    "created_at": "2020-09-04T17:50:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594147",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:30'></a>Replying to [comment:27 dimpase]:
> Replying to [comment:26 mkoeppe]:
> > Replying to [comment:24 gh-tobiasdiez]:
> > > it would be very helpful for further testing if the github actions could be activated for the sagemirror repo as well. Then I wouldn't need to create a PR at github first, but instead can directly test the action via trac.

> > 
> > My workflow is to keep the branch on trac and just push a temporary tag to my personal github fork of the repository.
> > 
> > 

> github Actions on sagemirror are disabled, as it's just a mirror, and not even updated automatically. (I push there once in a while from a private copy of trac git repo, that's how it's supported - ideas how to automate it without running a cron job are welcome).


I see. Still, I would think it is helpful if the github actions are activated for this repo as well, especially with view towards #30404 and the idea that these github actions serve as a continuous integration check (maybe eventually replacing the patchbot). I think there are also no disadvantages to enabling the github actions there.

Concerning updating the mirror, I guess the easiest solution would be to use a trac plugin such as https://github.com/trac-hacks/trac-github. This has the advantage that one could push to github, and the trac repo is updated as well. However, I think this requires that people primarily push to github, and no longer trac.
Another solution would be to add a git post-commit hook to git repo managed by trac, as e.g. here: https://stackoverflow.com/questions/3583061/automatically-mirror-a-git-repository.
Yet another way is to use a scheduled github action that updates the mirror automatically say every 30 min.



---

archive/issue_comments_594148.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 gh-tobiasdiez]:\n> Another solution would be to add a git post-commit hook to git repo managed by trac, as e.g. here: https://stackoverflow.com/questions/3583061/automatically-mirror-a-git-repository.\n\n\n+1",
    "created_at": "2020-09-04T17:54:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594148",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>Replying to [comment:30 gh-tobiasdiez]:
> Another solution would be to add a git post-commit hook to git repo managed by trac, as e.g. here: https://stackoverflow.com/questions/3583061/automatically-mirror-a-git-repository.


+1



---

archive/issue_comments_594149.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-09-09T23:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594149",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_594150.json:
```json
{
    "body": "<a id='comment:32'></a>merge conflict",
    "created_at": "2020-09-09T23:03:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594150",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:32'></a>merge conflict



---

archive/issue_comments_594151.json:
```json
{
    "body": "<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-09T23:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:33'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_594152.json:
```json
{
    "body": "Changing commit from \"b6147eeaa57db463c7d3765c3d599f1b8516d5e4\" to \"fb583203e0fc8ca21da3afa03dd4685c85762bc5\"",
    "created_at": "2020-09-09T23:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "b6147eeaa57db463c7d3765c3d599f1b8516d5e4" to "fb583203e0fc8ca21da3afa03dd4685c85762bc5"



---

archive/issue_comments_594153.json:
```json
{
    "body": "<a id='comment:34'></a>Rebased (squashed) on 9.2.beta12",
    "created_at": "2020-09-09T23:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>Rebased (squashed) on 9.2.beta12



---

archive/issue_comments_594154.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-09T23:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594154",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_594155.json:
```json
{
    "body": "Changing commit from \"fb583203e0fc8ca21da3afa03dd4685c85762bc5\" to \"e8a984b0982cf277838e57a13681d7122f44ef47\"",
    "created_at": "2020-09-09T23:58:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594155",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "fb583203e0fc8ca21da3afa03dd4685c85762bc5" to "e8a984b0982cf277838e57a13681d7122f44ef47"



---

archive/issue_comments_594156.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-09-09T23:59:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594156",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_594157.json:
```json
{
    "body": "<a id='comment:37'></a>Thanks!",
    "created_at": "2020-09-10T17:30:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594157",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'></a>Thanks!



---

archive/issue_events_078052.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T21:58:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30216#event-78052"
}
```



---

archive/issue_comments_594158.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T21:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594158",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_594159.json:
```json
{
    "body": "Changing branch from \"public/build/ghWSL\" to \"e8a984b0982cf277838e57a13681d7122f44ef47\"",
    "created_at": "2020-09-15T21:58:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30216",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30216#issuecomment-594159",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/build/ghWSL" to "e8a984b0982cf277838e57a13681d7122f44ef47"
