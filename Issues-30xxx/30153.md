# Issue 30153: Repair "sage -b" broken by #29411

archive/issues_029916.json:
```json
{
    "assignees": [],
    "body": "(from jhpalmieri, #30123)\n\nNote that sage -b doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\n\nDepends on #30128\n\nCC:  @jhpalmieri @orlitzky @kliem\n\nBranch: **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**\n\nReviewer: **John Palmieri, Matthias Koeppe**\n\nAuthor: **Matthias Koeppe, John Palmieri, Michael Orlitzky**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30153_\n\n",
    "closed_at": "2020-07-28T22:34:38Z",
    "created_at": "2020-07-16T04:47:30Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build",
        "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Repair \"sage -b\" broken by #29411",
    "type": "issue",
    "updated_at": "2020-08-13T01:11:17Z",
    "url": "https://github.com/sagemath/sage/issues/30153",
    "user": "https://github.com/mkoeppe"
}
```
(from jhpalmieri, #30123)

Note that sage -b doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)


Depends on #30128

CC:  @jhpalmieri @orlitzky @kliem

Branch: **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**

Reviewer: **John Palmieri, Matthias Koeppe**

Author: **Matthias Koeppe, John Palmieri, Michael Orlitzky**

_Issue created by migration from https://trac.sagemath.org/ticket/30153_





---

archive/issue_events_383355.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T04:47:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383355"
}
```



---

archive/issue_events_383356.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T04:47:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build",
    "label_color": "000080",
    "label_name": "component: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383356"
}
```



---

archive/issue_events_383357.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T04:47:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/p1%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383357"
}
```



---

archive/issue_events_383358.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T04:47:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383358"
}
```



---

archive/issue_comments_480481.json:
```json
{
    "body": "Branch: **[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)**",
    "created_at": "2020-07-16T19:30:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480481",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)**



---

archive/issue_comments_480482.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95c0b68f1e7e9cc93e63659dee48497583e1a9da\">95c0b68</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd\">cb4262f</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr></table>\n",
    "created_at": "2020-07-16T19:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480482",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95c0b68f1e7e9cc93e63659dee48497583e1a9da">95c0b68</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd">cb4262f</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr></table>




---

archive/issue_events_383359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-16T19:31:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383359"
}
```



---

archive/issue_comments_480483.json:
```json
{
    "body": "Commit: **[cb4262f](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)**",
    "created_at": "2020-07-16T19:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480483",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[cb4262f](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)**



---

archive/issue_comments_480484.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-16T19:31:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480484",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_480485.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nCan you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?",
    "created_at": "2020-07-16T19:45:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480485",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'>Comment 3:</a>
Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?



---

archive/issue_comments_480486.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\n- If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \\`sagelib-no-deps' is up to date.</code>\n- Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.\n- It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.\n- `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?",
    "created_at": "2020-07-16T20:16:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480486",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'>Comment 4:</a>
- If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \`sagelib-no-deps' is up to date.</code>
- Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.
- It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.
- `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?



---

archive/issue_comments_480487.json:
```json
{
    "body": "<a id='comment:5'>Comment 5:</a>\nReplying to [@orlitzky](#comment%3A3):\n> Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?\n\nSure, will do",
    "created_at": "2020-07-16T20:17:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480487",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'>Comment 5:</a>
Replying to [@orlitzky](#comment%3A3):
> Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?

Sure, will do



---

archive/issue_comments_480488.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nReplying to [@jhpalmieri](#comment%3A4):\n> - `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?\n\nYes... will fix it",
    "created_at": "2020-07-16T20:18:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480488",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Replying to [@jhpalmieri](#comment%3A4):
> - `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?

Yes... will fix it



---

archive/issue_comments_480489.json:
```json
{
    "body": "Changed commit from **[cb4262f](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)** to **[03a2dbe](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)**",
    "created_at": "2020-07-16T20:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480489",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[cb4262f](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)** to **[03a2dbe](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)**



---

archive/issue_comments_480490.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f141c8b40cccae7985eae14e4486fb305cfb123\">2f141c8</a></td><td><code>Trac #30128: always source sage-env-config before sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554282ac3c38667cf0e83488872aa488467de1f2\">554282a</a></td><td><code>Trac #30128: enforce sourcing of sage-env-config before src/bin/sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a91c05926de5ec62d306c6955c989dec02788e4\">7a91c05</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fc909c5143bf2b690ee1d22fd56a3c79db4ec23\">4fc909c</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c\">03a2dbe</a></td><td><code>build/make/Makefile.in: Make SPKG-no-deps targets phony; for script packages, create the correct installation stamp file</code></td></tr></table>\n",
    "created_at": "2020-07-16T20:25:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480490",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:7'>Comment 7:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f141c8b40cccae7985eae14e4486fb305cfb123">2f141c8</a></td><td><code>Trac #30128: always source sage-env-config before sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554282ac3c38667cf0e83488872aa488467de1f2">554282a</a></td><td><code>Trac #30128: enforce sourcing of sage-env-config before src/bin/sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a91c05926de5ec62d306c6955c989dec02788e4">7a91c05</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fc909c5143bf2b690ee1d22fd56a3c79db4ec23">4fc909c</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c">03a2dbe</a></td><td><code>build/make/Makefile.in: Make SPKG-no-deps targets phony; for script packages, create the correct installation stamp file</code></td></tr></table>




---

archive/issue_comments_480491.json:
```json
{
    "body": "Changed commit from **[03a2dbe](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)** to **[62ddd02](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)**",
    "created_at": "2020-07-16T20:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480491",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[03a2dbe](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)** to **[62ddd02](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)**



---

archive/issue_comments_480492.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b\">62ddd02</a></td><td><code>build/make/Makefile.in [SPKG-no-deps]: Do not forget to source sage-env-config</code></td></tr></table>\n",
    "created_at": "2020-07-16T20:26:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480492",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:8'>Comment 8:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b">62ddd02</a></td><td><code>build/make/Makefile.in [SPKG-no-deps]: Do not forget to source sage-env-config</code></td></tr></table>




---

archive/issue_comments_480493.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@jhpalmieri](#comment%3A4):\n> - If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \\`sagelib-no-deps' is up to date.</code>\n> - Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.\n\nThis should be fixed now.\n\n> - It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.\n\nYes, it was convenient to go through the Makefile, and I think this change is good as it improves uniformity.",
    "created_at": "2020-07-16T20:28:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480493",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@jhpalmieri](#comment%3A4):
> - If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \`sagelib-no-deps' is up to date.</code>
> - Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.

This should be fixed now.

> - It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.

Yes, it was convenient to go through the Makefile, and I think this change is good as it improves uniformity.



---

archive/issue_comments_480494.json:
```json
{
    "body": "Dependencies: **#30128**",
    "created_at": "2020-07-16T20:28:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480494",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30128**



---

archive/issue_comments_480495.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nI think this works. The first time I got a file `build/make/sagelib-no-deps`, but maybe I forgot to run `./bootstrap`/`.configure`/etc. It's working now.\n\n- Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.\n\n- For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.\n\nCould we change the build rules so that\n\n```\n$$(INST)/$(1)-$(2)\n```\njust does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.",
    "created_at": "2020-07-16T22:12:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480495",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'>Comment 11:</a>
I think this works. The first time I got a file `build/make/sagelib-no-deps`, but maybe I forgot to run `./bootstrap`/`.configure`/etc. It's working now.

- Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.

- For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.

Could we change the build rules so that

```
$$(INST)/$(1)-$(2)
```
just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.



---

archive/issue_comments_480496.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)** to **[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)**",
    "created_at": "2020-07-16T22:12:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480496",
    "user": "https://github.com/jhpalmieri"
}
```

Changed branch from **[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)** to **[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)**



---

archive/issue_comments_480497.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nBy the way, we should deprecate `sage --ba-force`: #30160.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528\">830843b</a></td><td><code>trac 30153: add, clarify some comments</code></td></tr></table>\n",
    "created_at": "2020-07-16T22:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480497",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'>Comment 13:</a>
By the way, we should deprecate `sage --ba-force`: #30160.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528">830843b</a></td><td><code>trac 30153: add, clarify some comments</code></td></tr></table>




---

archive/issue_comments_480498.json:
```json
{
    "body": "Changed commit from **[62ddd02](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)** to **[830843b](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)**",
    "created_at": "2020-07-16T22:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480498",
    "user": "https://github.com/jhpalmieri"
}
```

Changed commit from **[62ddd02](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)** to **[830843b](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)**



---

archive/issue_comments_480499.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nReplying to [@jhpalmieri](#comment%3A11):\n> - Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.\n\nThanks very much, this is perfect.\n\nRegarding other uses - we could reimplement `sage -p` in terms of this. I just wasn't sure if we want to do this on the same ticket.\n\n> - For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.\n\nThanks for catching this. I think you fixed it already. For deprecating/renaming `-clean` to `-uninstall`, we have #29097. Probably best not to do everything on one ticket.\n\n> Could we change the build rules so that\n> \n> ```\n> $$(INST)/$(1)-$(2)\n> ```\n> just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.\n\nI don't see an elegant way to do this, unfortunately.",
    "created_at": "2020-07-16T22:29:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480499",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'>Comment 14:</a>
Replying to [@jhpalmieri](#comment%3A11):
> - Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.

Thanks very much, this is perfect.

Regarding other uses - we could reimplement `sage -p` in terms of this. I just wasn't sure if we want to do this on the same ticket.

> - For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.

Thanks for catching this. I think you fixed it already. For deprecating/renaming `-clean` to `-uninstall`, we have #29097. Probably best not to do everything on one ticket.

> Could we change the build rules so that
> 
> ```
> $$(INST)/$(1)-$(2)
> ```
> just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.

I don't see an elegant way to do this, unfortunately.



---

archive/issue_comments_480500.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, John Palmieri**",
    "created_at": "2020-07-17T20:44:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480500",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, John Palmieri**



---

archive/issue_comments_480501.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nThis looks okay to me. Positive review on your contributions.",
    "created_at": "2020-07-17T20:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480501",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'>Comment 16:</a>
This looks okay to me. Positive review on your contributions.



---

archive/issue_comments_480502.json:
```json
{
    "body": "Reviewer: **John Palmieri**",
    "created_at": "2020-07-17T20:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480502",
    "user": "https://github.com/jhpalmieri"
}
```

Reviewer: **John Palmieri**



---

archive/issue_events_383360.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-17T21:41:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383360"
}
```



---

archive/issue_events_383361.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-17T21:41:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383361"
}
```



---

archive/issue_comments_480503.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nThanks!",
    "created_at": "2020-07-17T21:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480503",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'>Comment 17:</a>
Thanks!



---

archive/issue_comments_480504.json:
```json
{
    "body": "Changed reviewer from **John Palmieri** to **John Palmieri, Matthias Koeppe**",
    "created_at": "2020-07-17T21:41:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480504",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **John Palmieri** to **John Palmieri, Matthias Koeppe**



---

archive/issue_comments_480505.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nLate to the party, sorry. I think my new commit factors out the no-deps code as requested.\n\nIf I missed something or if you'd rather do it on another ticket, just put the old branch back and mark it as positive review again. Everything is working now.",
    "created_at": "2020-07-17T23:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480505",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'>Comment 18:</a>
Late to the party, sorry. I think my new commit factors out the no-deps code as requested.

If I missed something or if you'd rather do it on another ticket, just put the old branch back and mark it as positive review again. Everything is working now.



---

archive/issue_events_383362.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-07-17T23:30:39Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383362"
}
```



---

archive/issue_events_383363.json:
```json
{
    "actor": "https://github.com/orlitzky",
    "created_at": "2020-07-17T23:30:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383363"
}
```



---

archive/issue_comments_480506.json:
```json
{
    "body": "Changed commit from **[830843b](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)** to **[1a0e5c3](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)**",
    "created_at": "2020-07-17T23:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480506",
    "user": "https://github.com/orlitzky"
}
```

Changed commit from **[830843b](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)** to **[1a0e5c3](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)**



---

archive/issue_comments_480507.json:
```json
{
    "body": "Changed branch from **[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)** to **[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)**",
    "created_at": "2020-07-17T23:30:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480507",
    "user": "https://github.com/orlitzky"
}
```

Changed branch from **[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)** to **[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)**



---

archive/issue_events_383364.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-17T23:34:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383364"
}
```



---

archive/issue_events_383365.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-17T23:34:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383365"
}
```



---

archive/issue_comments_480508.json:
```json
{
    "body": "Changed author from **Matthias Koeppe, John Palmieri** to **Matthias Koeppe, John Palmieri, Michael Orlitzky**",
    "created_at": "2020-07-17T23:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480508",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe, John Palmieri** to **Matthias Koeppe, John Palmieri, Michael Orlitzky**



---

archive/issue_comments_480509.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nThanks.",
    "created_at": "2020-07-17T23:34:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480509",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'>Comment 19:</a>
Thanks.



---

archive/issue_comments_480510.json:
```json
{
    "body": "Changed branch from **[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)** to **[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)**",
    "created_at": "2020-07-25T23:13:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480510",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)** to **[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)**



---

archive/issue_comments_480511.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nMerged 9.2.beta6\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d\">2d95def</a></td><td><code>Merge tag '9.2.beta6' into t/30153/repair__sage__b__broken_by__29411</code></td></tr></table>\n",
    "created_at": "2020-07-25T23:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480511",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Merged 9.2.beta6

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d">2d95def</a></td><td><code>Merge tag '9.2.beta6' into t/30153/repair__sage__b__broken_by__29411</code></td></tr></table>




---

archive/issue_comments_480512.json:
```json
{
    "body": "Changed commit from **[1a0e5c3](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)** to **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**",
    "created_at": "2020-07-25T23:13:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480512",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[1a0e5c3](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)** to **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**



---

archive/issue_comments_480513.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)** to **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**",
    "created_at": "2020-07-28T22:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480513",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)** to **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)**



---

archive/issue_events_383366.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-28T22:34:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383366"
}
```



---

archive/issue_events_383367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "17a83a262ea6f0b98803690db8275758b67eb714",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-07-28T22:34:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30153#event-383367"
}
```



---

archive/issue_comments_480514.json:
```json
{
    "body": "Changed commit from **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)** to none",
    "created_at": "2020-08-13T01:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480514",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[2d95def](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)** to none



---

archive/issue_comments_480515.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nI think the recursive invocation of $(MAKE) leads to builds with extremely high parallel load when `MAKE=\"make -j8\"` as recommended in Sage build documentation. I think this is part of why lately many builds on GH Actions are failing. To be fixed in #30345",
    "created_at": "2020-08-13T01:11:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30153#issuecomment-480515",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>Comment 23:</a>
I think the recursive invocation of $(MAKE) leads to builds with extremely high parallel load when `MAKE="make -j8"` as recommended in Sage build documentation. I think this is part of why lately many builds on GH Actions are failing. To be fixed in #30345
