# Issue 30153: Repair "sage -b" broken by #29411

archive/issues_029916.json:
```json
{
    "body": "(from jhpalmieri, #30123)\n\nNote that sage -b doesn't work any more: it tries to do `cd \"$SAGE_SRC\" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)\n\n\n**CC:**  @jhpalmieri @orlitzky @kliem\n\n**Branch:** [2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)\n\n**Reviewer:** John Palmieri, Matthias Koeppe\n\n**Author:** Matthias Koeppe, John Palmieri, Michael Orlitzky\n\n**Dependencies:** #30128\n\nIssue created by migration from https://trac.sagemath.org/ticket/30153\n\n",
    "closed_at": "2020-07-28T22:34:38Z",
    "created_at": "2020-07-16T04:47:30Z",
    "labels": [
        "component: build",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Repair \"sage -b\" broken by #29411",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30153",
    "user": "https://github.com/mkoeppe"
}
```
(from jhpalmieri, #30123)

Note that sage -b doesn't work any more: it tries to do `cd "$SAGE_SRC" && $MAKE`, but `SAGE_SRC/Makefile.in` was removed in #29411. (If you have done an incremental build, the Makefile is still there.)


**CC:**  @jhpalmieri @orlitzky @kliem

**Branch:** [2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)

**Reviewer:** John Palmieri, Matthias Koeppe

**Author:** Matthias Koeppe, John Palmieri, Michael Orlitzky

**Dependencies:** #30128

Issue created by migration from https://trac.sagemath.org/ticket/30153





---

archive/issue_comments_566399.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)",
    "created_at": "2020-07-16T19:30:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566399",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)



---

archive/issue_comments_566400.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/95c0b68f1e7e9cc93e63659dee48497583e1a9da\">95c0b68</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd\">cb4262f</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr></table>\n",
    "created_at": "2020-07-16T19:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566400",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/95c0b68f1e7e9cc93e63659dee48497583e1a9da">95c0b68</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd">cb4262f</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr></table>




---

archive/issue_comments_566401.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-07-16T19:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566401",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_566402.json:
```json
{
    "body": "**Commit:** [cb4262f5c0ad690a8495af1363574099c56d99cd](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)",
    "created_at": "2020-07-16T19:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566402",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [cb4262f5c0ad690a8495af1363574099c56d99cd](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)



---

archive/issue_comments_566403.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-07-16T19:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566403",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_566404.json:
```json
{
    "body": "<a id='comment:3'></a>\nCan you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?",
    "created_at": "2020-07-16T19:45:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566404",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:3'></a>
Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?



---

archive/issue_comments_566405.json:
```json
{
    "body": "<a id='comment:4'></a>\n- If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \\`sagelib-no-deps' is up to date.</code>\n- Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.\n- It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.\n- `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?",
    "created_at": "2020-07-16T20:16:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566405",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:4'></a>
- If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \`sagelib-no-deps' is up to date.</code>
- Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.
- It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.
- `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?



---

archive/issue_comments_566406.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [mjo](#comment%3A3):\n> Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?\n\nSure, will do",
    "created_at": "2020-07-16T20:17:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566406",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [mjo](#comment%3A3):
> Can you base this on #30128 and then source sage-env-config before sage-env in that new Makefile target?

Sure, will do



---

archive/issue_comments_566407.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> - `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?\n \nYes... will fix it",
    "created_at": "2020-07-16T20:18:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566407",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [jhpalmieri](#comment%3A4):
> - `git status` reports that the empty file `build/make/sagelib-no-deps` is present and untracked. Does `sagelib-no-deps` need to be added as a phony target, or something like that?
 
Yes... will fix it



---

archive/issue_comments_566408.json:
```json
{
    "body": "**Changing commit** from \"[cb4262f5c0ad690a8495af1363574099c56d99cd](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)\" to \"[03a2dbee520f08a0d3aa090239ee2cf04d36334c](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)\".",
    "created_at": "2020-07-16T20:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566408",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[cb4262f5c0ad690a8495af1363574099c56d99cd](https://github.com/sagemath/sagetrac-mirror/commit/cb4262f5c0ad690a8495af1363574099c56d99cd)" to "[03a2dbee520f08a0d3aa090239ee2cf04d36334c](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)".



---

archive/issue_comments_566409.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f141c8b40cccae7985eae14e4486fb305cfb123\">2f141c8</a></td><td><code>Trac #30128: always source sage-env-config before sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/554282ac3c38667cf0e83488872aa488467de1f2\">554282a</a></td><td><code>Trac #30128: enforce sourcing of sage-env-config before src/bin/sage-env.</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a91c05926de5ec62d306c6955c989dec02788e4\">7a91c05</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fc909c5143bf2b690ee1d22fd56a3c79db4ec23\">4fc909c</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c\">03a2dbe</a></td><td><code>build/make/Makefile.in: Make SPKG-no-deps targets phony; for script packages, create the correct installation stamp file</code></td></tr></table>\n",
    "created_at": "2020-07-16T20:25:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566409",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f141c8b40cccae7985eae14e4486fb305cfb123">2f141c8</a></td><td><code>Trac #30128: always source sage-env-config before sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/554282ac3c38667cf0e83488872aa488467de1f2">554282a</a></td><td><code>Trac #30128: enforce sourcing of sage-env-config before src/bin/sage-env.</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a91c05926de5ec62d306c6955c989dec02788e4">7a91c05</a></td><td><code>build/make/Makefile.in: Add target SPKG-no-deps for all SPKGs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fc909c5143bf2b690ee1d22fd56a3c79db4ec23">4fc909c</a></td><td><code>src/bin/sage: Repair ./sage -b etc. by using make sagelib-clean, make sagelib-no-deps</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c">03a2dbe</a></td><td><code>build/make/Makefile.in: Make SPKG-no-deps targets phony; for script packages, create the correct installation stamp file</code></td></tr></table>




---

archive/issue_comments_566410.json:
```json
{
    "body": "**Changing commit** from \"[03a2dbee520f08a0d3aa090239ee2cf04d36334c](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)\" to \"[62ddd0290f29776898dfb6ced584a9ae24f6a69b](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)\".",
    "created_at": "2020-07-16T20:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566410",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[03a2dbee520f08a0d3aa090239ee2cf04d36334c](https://github.com/sagemath/sagetrac-mirror/commit/03a2dbee520f08a0d3aa090239ee2cf04d36334c)" to "[62ddd0290f29776898dfb6ced584a9ae24f6a69b](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)".



---

archive/issue_comments_566411.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b\">62ddd02</a></td><td><code>build/make/Makefile.in [SPKG-no-deps]: Do not forget to source sage-env-config</code></td></tr></table>\n",
    "created_at": "2020-07-16T20:26:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566411",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b">62ddd02</a></td><td><code>build/make/Makefile.in [SPKG-no-deps]: Do not forget to source sage-env-config</code></td></tr></table>




---

archive/issue_comments_566412.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [jhpalmieri](#comment%3A4):\n> - If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \\`sagelib-no-deps' is up to date.</code>\n> - Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.\n\n\nThis should be fixed now.\n\n> - It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.\n\n\nYes, it was convenient to go through the Makefile, and I think this change is good as it improves uniformity.",
    "created_at": "2020-07-16T20:28:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Replying to [jhpalmieri](#comment%3A4):
> - If I touch a `.pyx` file and do `sage -b`, nothing happens: <code>make: \`sagelib-no-deps' is up to date.</code>
> - Same with `sage --ba-force`: nothing happens, even though this is supposed to force rebuilding everything in the Sage library.


This should be fixed now.

> - It looks like the logger is invoked, and it didn't used to be. This might be a good change, not sure, but it is a change.


Yes, it was convenient to go through the Makefile, and I think this change is good as it improves uniformity.



---

archive/issue_comments_566413.json:
```json
{
    "body": "**Dependencies:** #30128",
    "created_at": "2020-07-16T20:28:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566413",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #30128



---

archive/issue_comments_566414.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think this works. The first time I got a file `build/make/sagelib-no-deps`, but maybe I forgot to run `./bootstrap`/`.configure`/etc. It's working now.\n\n- Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.\n\n- For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.\n\nCould we change the build rules so that\n\n```\n$$(INST)/$(1)-$(2)\n```\njust does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.",
    "created_at": "2020-07-16T22:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566414",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>
I think this works. The first time I got a file `build/make/sagelib-no-deps`, but maybe I forgot to run `./bootstrap`/`.configure`/etc. It's working now.

- Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.

- For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.

Could we change the build rules so that

```
$$(INST)/$(1)-$(2)
```
just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.



---

archive/issue_comments_566415.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)\" to \"[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)\".",
    "created_at": "2020-07-16T22:12:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566415",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing branch** from "[u/mkoeppe/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/repair__sage__b__broken_by__29411)" to "[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)".



---

archive/issue_comments_566416.json:
```json
{
    "body": "<a id='comment:13'></a>\nBy the way, we should deprecate `sage --ba-force`: #30160.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528\">830843b</a></td><td><code>trac 30153: add, clarify some comments</code></td></tr></table>\n",
    "created_at": "2020-07-16T22:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566416",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
By the way, we should deprecate `sage --ba-force`: #30160.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528">830843b</a></td><td><code>trac 30153: add, clarify some comments</code></td></tr></table>




---

archive/issue_comments_566417.json:
```json
{
    "body": "**Changing commit** from \"[62ddd0290f29776898dfb6ced584a9ae24f6a69b](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)\" to \"[830843beb72ac0f9841fa32509fda3d744167528](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)\".",
    "created_at": "2020-07-16T22:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566417",
    "user": "https://github.com/jhpalmieri"
}
```

**Changing commit** from "[62ddd0290f29776898dfb6ced584a9ae24f6a69b](https://github.com/sagemath/sagetrac-mirror/commit/62ddd0290f29776898dfb6ced584a9ae24f6a69b)" to "[830843beb72ac0f9841fa32509fda3d744167528](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)".



---

archive/issue_comments_566418.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [jhpalmieri](#comment%3A11):\n> - Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.\n\n\nThanks very much, this is perfect.\n\nRegarding other uses - we could reimplement `sage -p` in terms of this. I just wasn't sure if we want to do this on the same ticket.\n\n> - For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.\n\n\nThanks for catching this. I think you fixed it already. For deprecating/renaming `-clean` to `-uninstall`, we have #29097. Probably best not to do everything on one ticket.\n\n> Could we change the build rules so that\n> \n> ```\n> $$(INST)/$(1)-$(2)\n> ```\n> just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.\n\n\nI don't see an elegant way to do this, unfortunately.",
    "created_at": "2020-07-16T22:29:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566418",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Replying to [jhpalmieri](#comment%3A11):
> - Can we add a comment in `Makefile.in` explaining what `$(1)-no-deps` is and how it should be used? I'm guessing that it tries to build the package but ignores its dependencies. Does that have any uses aside from the Sage library? I've made an attempt.


Thanks very much, this is perfect.

Regarding other uses - we could reimplement `sage -p` in terms of this. I just wasn't sure if we want to do this on the same ticket.

> - For pip packages, you have added `$(1)-clean` a second time to the `.PHONY` list. Should there be a `$(1)-uninstall` target for these? In that case, change one `$(1)-clean` to `$(1)-uninstall`.


Thanks for catching this. I think you fixed it already. For deprecating/renaming `-clean` to `-uninstall`, we have #29097. Probably best not to do everything on one ticket.

> Could we change the build rules so that
> 
> ```
> $$(INST)/$(1)-$(2)
> ```
> just does `$(1)-build-deps` and `$(1)-no-deps`? It would cut out a tiny bit of code duplication. I guess we can't force the dependencies to be built before the package, so maybe not.


I don't see an elegant way to do this, unfortunately.



---

archive/issue_comments_566419.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe\" to \"Matthias Koeppe, John Palmieri\".",
    "created_at": "2020-07-17T20:44:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566419",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe" to "Matthias Koeppe, John Palmieri".



---

archive/issue_comments_566420.json:
```json
{
    "body": "<a id='comment:16'></a>\nThis looks okay to me. Positive review on your contributions.",
    "created_at": "2020-07-17T20:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566420",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:16'></a>
This looks okay to me. Positive review on your contributions.



---

archive/issue_comments_566421.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2020-07-17T20:50:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566421",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_566422.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-07-17T21:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566422",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_566423.json:
```json
{
    "body": "<a id='comment:17'></a>\nThanks!",
    "created_at": "2020-07-17T21:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566423",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Thanks!



---

archive/issue_comments_566424.json:
```json
{
    "body": "**Changing reviewer** from \"John Palmieri\" to \"John Palmieri, Matthias Koeppe\".",
    "created_at": "2020-07-17T21:41:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566424",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "John Palmieri" to "John Palmieri, Matthias Koeppe".



---

archive/issue_comments_566425.json:
```json
{
    "body": "<a id='comment:18'></a>\nLate to the party, sorry. I think my new commit factors out the no-deps code as requested.\n\nIf I missed something or if you'd rather do it on another ticket, just put the old branch back and mark it as positive review again. Everything is working now.",
    "created_at": "2020-07-17T23:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566425",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:18'></a>
Late to the party, sorry. I think my new commit factors out the no-deps code as requested.

If I missed something or if you'd rather do it on another ticket, just put the old branch back and mark it as positive review again. Everything is working now.



---

archive/issue_comments_566426.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2020-07-17T23:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566426",
    "user": "https://github.com/orlitzky"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_566427.json:
```json
{
    "body": "**Changing commit** from \"[830843beb72ac0f9841fa32509fda3d744167528](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)\" to \"[1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)\".",
    "created_at": "2020-07-17T23:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566427",
    "user": "https://github.com/orlitzky"
}
```

**Changing commit** from "[830843beb72ac0f9841fa32509fda3d744167528](https://github.com/sagemath/sagetrac-mirror/commit/830843beb72ac0f9841fa32509fda3d744167528)" to "[1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)".



---

archive/issue_comments_566428.json:
```json
{
    "body": "**Changing branch** from \"[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)\" to \"[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)\".",
    "created_at": "2020-07-17T23:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566428",
    "user": "https://github.com/orlitzky"
}
```

**Changing branch** from "[u/jhpalmieri/repair__sage__b__broken_by__29411](https://github.com/sagemath/sagetrac-mirror/tree/u/jhpalmieri/repair__sage__b__broken_by__29411)" to "[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)".



---

archive/issue_comments_566429.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-07-17T23:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566429",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_566430.json:
```json
{
    "body": "**Changing author** from \"Matthias Koeppe, John Palmieri\" to \"Matthias Koeppe, John Palmieri, Michael Orlitzky\".",
    "created_at": "2020-07-17T23:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566430",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Matthias Koeppe, John Palmieri" to "Matthias Koeppe, John Palmieri, Michael Orlitzky".



---

archive/issue_comments_566431.json:
```json
{
    "body": "<a id='comment:19'></a>\nThanks.",
    "created_at": "2020-07-17T23:34:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566431",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Thanks.



---

archive/issue_comments_566432.json:
```json
{
    "body": "**Changing branch** from \"[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)\" to \"[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)\".",
    "created_at": "2020-07-25T23:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566432",
    "user": "https://github.com/mkoeppe"
}
```

**Changing branch** from "[u/mjo/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mjo/ticket/30153)" to "[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)".



---

archive/issue_comments_566433.json:
```json
{
    "body": "<a id='comment:21'></a>\nMerged 9.2.beta6\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d\">2d95def</a></td><td><code>Merge tag '9.2.beta6' into t/30153/repair__sage__b__broken_by__29411</code></td></tr></table>\n",
    "created_at": "2020-07-25T23:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566433",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Merged 9.2.beta6

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d">2d95def</a></td><td><code>Merge tag '9.2.beta6' into t/30153/repair__sage__b__broken_by__29411</code></td></tr></table>




---

archive/issue_comments_566434.json:
```json
{
    "body": "**Changing commit** from \"[1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)\" to \"[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)\".",
    "created_at": "2020-07-25T23:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566434",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320](https://github.com/sagemath/sagetrac-mirror/commit/1a0e5c3c15a91e32742ca1cfc1ebf7c13b2be320)" to "[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)".



---

archive/issue_comments_566435.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)\" to \"[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)\".",
    "created_at": "2020-07-28T22:34:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566435",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/ticket/30153](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/ticket/30153)" to "[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)".



---

archive/issue_events_087367.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-28T22:34:38Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30153#event-87367"
}
```



---

archive/issue_comments_566436.json:
```json
{
    "body": "**Changing commit** from \"[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)\" to \"\".",
    "created_at": "2020-08-13T01:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566436",
    "user": "https://github.com/mkoeppe"
}
```

**Changing commit** from "[2d95def4348b61e9b4706f940c13e4cbb188654d](https://github.com/sagemath/sagetrac-mirror/commit/2d95def4348b61e9b4706f940c13e4cbb188654d)" to "".



---

archive/issue_comments_566437.json:
```json
{
    "body": "<a id='comment:23'></a>\nI think the recursive invocation of $(MAKE) leads to builds with extremely high parallel load when `MAKE=\"make -j8\"` as recommended in Sage build documentation. I think this is part of why lately many builds on GH Actions are failing. To be fixed in #30345",
    "created_at": "2020-08-13T01:11:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30153",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30153#issuecomment-566437",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'></a>
I think the recursive invocation of $(MAKE) leads to builds with extremely high parallel load when `MAKE="make -j8"` as recommended in Sage build documentation. I think this is part of why lately many builds on GH Actions are failing. To be fixed in #30345
