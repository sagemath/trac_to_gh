# Issue 30035: Invariants of Ternary Cubic Forms do not live in the base ring

archive/issues_029798.json:
```json
{
    "body": "It seems that invariants of ternary cubic forms (and I assume other kinds of forms, but I didn't try) live in the polynomial ring, not in the base ring. Therefore, I get this, which shouldn't happen:\n\n\n```\nR.<a,b,c> = QQ[]\nRR.<x,y,z> = QQ[]\n\nf = 1994893*a^3 + 4498037*a^2*b + 3358044*a*b^2 + 830875*b^3 + 7859654*a^2*c + 11828845*a*b*c + 4420000*b^2*c + 10319781*a*c^2 + 7775375*b*c^2 + 4515625*c^3\nff = x^3 + 11*x^2*y - 14*x*y^2 + y^3 + 11*x^2*z + 135*x*y*z - 160*y^2*z - 14*x*z^2 + 3*y*z^2 + z^3\n\n\nT = invariant_theory.ternary_cubic(f)\nTT = invariant_theory.ternary_cubic(ff)\n\nT.S_invariant(); TT.S_invariant(); T.S_invariant() == TT.S_invariant();  T.S_invariant() == QQ(TT.S_invariant())\n```\n\nproduces outputs of -705911761/1296, -705911761/1296, False, True.\n\n\n**CC:**  @mstreng kohel florian @JRSijsling @jnoordsij\n\n**Keywords:** invariant theory\n\n**Branch/Commit:** [7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)\n\n**Reviewer:** S\u00e9bastien Labb\u00e9\n\n**Author:** Fr\u00e9d\u00e9ric Chapoton\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30035\n\n",
    "closed_at": "2020-08-23T16:28:01Z",
    "created_at": "2020-07-01T01:42:08Z",
    "labels": [
        "component: algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Invariants of Ternary Cubic Forms do not live in the base ring",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30035",
    "user": "https://github.com/davidac897"
}
```
It seems that invariants of ternary cubic forms (and I assume other kinds of forms, but I didn't try) live in the polynomial ring, not in the base ring. Therefore, I get this, which shouldn't happen:


```
R.<a,b,c> = QQ[]
RR.<x,y,z> = QQ[]

f = 1994893*a^3 + 4498037*a^2*b + 3358044*a*b^2 + 830875*b^3 + 7859654*a^2*c + 11828845*a*b*c + 4420000*b^2*c + 10319781*a*c^2 + 7775375*b*c^2 + 4515625*c^3
ff = x^3 + 11*x^2*y - 14*x*y^2 + y^3 + 11*x^2*z + 135*x*y*z - 160*y^2*z - 14*x*z^2 + 3*y*z^2 + z^3


T = invariant_theory.ternary_cubic(f)
TT = invariant_theory.ternary_cubic(ff)

T.S_invariant(); TT.S_invariant(); T.S_invariant() == TT.S_invariant();  T.S_invariant() == QQ(TT.S_invariant())
```

produces outputs of -705911761/1296, -705911761/1296, False, True.


**CC:**  @mstreng kohel florian @JRSijsling @jnoordsij

**Keywords:** invariant theory

**Branch/Commit:** [7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)

**Reviewer:** Sébastien Labbé

**Author:** Frédéric Chapoton

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/30035





---

archive/issue_comments_590921.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe problem comes from `scaled_coeffs`:\n\n```\nsage: [parent(u) for u in T.scaled_coeffs()]\n[Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field]\n```\nand then from `coeffs`\n\n```\nsage: [parent(u) for u in T.coeffs()]\n[Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field,\n Multivariate Polynomial Ring in a, b, c over Rational Field]\n```\nwhich calls\n`_extract_coefficients`",
    "created_at": "2020-07-01T08:52:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590921",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:1'></a>
The problem comes from `scaled_coeffs`:

```
sage: [parent(u) for u in T.scaled_coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```
and then from `coeffs`

```
sage: [parent(u) for u in T.coeffs()]
[Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field,
 Multivariate Polynomial Ring in a, b, c over Rational Field]
```
which calls
`_extract_coefficients`



---

archive/issue_comments_590922.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis seems from deep inside the invariant code. The choice not to separate true variables of the cubic forms and variables for the coefficients seems to be very wrong, and a serious flaw in the design.",
    "created_at": "2020-07-01T09:39:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590922",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:2'></a>
This seems from deep inside the invariant code. The choice not to separate true variables of the cubic forms and variables for the coefficients seems to be very wrong, and a serious flaw in the design.



---

archive/issue_comments_590923.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77\">cfc52e9</a></td><td><code>fix base_ring for some invariants</code></td></tr></table>\n",
    "created_at": "2020-07-01T10:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590923",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77">cfc52e9</a></td><td><code>fix base_ring for some invariants</code></td></tr></table>




---

archive/issue_comments_590924.json:
```json
{
    "body": "**Branch:** [u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)",
    "created_at": "2020-07-01T10:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590924",
    "user": "https://github.com/fchapoton"
}
```


**Branch:** [u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)



---

archive/issue_comments_590925.json:
```json
{
    "body": "**Commit:** [cfc52e9e2f080eb37b7496126ad6b2e8fad88f77](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)",
    "created_at": "2020-07-01T10:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590925",
    "user": "https://github.com/fchapoton"
}
```


**Commit:** [cfc52e9e2f080eb37b7496126ad6b2e8fad88f77](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)



---

archive/issue_comments_590926.json:
```json
{
    "body": "**Changing author** from \"jnoordsij\" to \"Fr\u00e9d\u00e9ric Chapoton\".",
    "created_at": "2020-07-01T10:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590926",
    "user": "https://github.com/fchapoton"
}
```


**Changing author** from "jnoordsij" to "Frédéric Chapoton".



---

archive/issue_comments_590927.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-07-01T10:30:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590927",
    "user": "https://github.com/fchapoton"
}
```


**Changing status** from new to needs_review.



---

archive/issue_comments_590928.json:
```json
{
    "body": "<a id='comment:4'></a>\nThis still needs a doctest.",
    "created_at": "2020-07-01T10:31:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590928",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:4'></a>
This still needs a doctest.



---

archive/issue_comments_590929.json:
```json
{
    "body": "**Changing commit** from \"[cfc52e9e2f080eb37b7496126ad6b2e8fad88f77](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)\" to \"[7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)\".",
    "created_at": "2020-07-01T12:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590929",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


**Changing commit** from "[cfc52e9e2f080eb37b7496126ad6b2e8fad88f77](https://github.com/sagemath/sagetrac-mirror/commit/cfc52e9e2f080eb37b7496126ad6b2e8fad88f77)" to "[7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)".



---

archive/issue_comments_590930.json:
```json
{
    "body": "<a id='comment:5'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729\">7c7fc38</a></td><td><code>trac 30035 add indirect doctest</code></td></tr></table>\n",
    "created_at": "2020-07-01T12:37:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590930",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```


<a id='comment:5'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729">7c7fc38</a></td><td><code>trac 30035 add indirect doctest</code></td></tr></table>




---

archive/issue_comments_590931.json:
```json
{
    "body": "<a id='comment:6'></a>\nnow with doctest",
    "created_at": "2020-07-01T12:37:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590931",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:6'></a>
now with doctest



---

archive/issue_comments_590932.json:
```json
{
    "body": "<a id='comment:7'></a>\ngreen bot, needs review",
    "created_at": "2020-07-01T19:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590932",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:7'></a>
green bot, needs review



---

archive/issue_comments_590933.json:
```json
{
    "body": "<a id='comment:8'></a>\nGREEN BOT, **please review** !",
    "created_at": "2020-08-13T11:07:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590933",
    "user": "https://github.com/fchapoton"
}
```


<a id='comment:8'></a>
GREEN BOT, **please review** !



---

archive/issue_comments_590934.json:
```json
{
    "body": "**Reviewer:** S\u00e9bastien Labb\u00e9",
    "created_at": "2020-08-14T12:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590934",
    "user": "https://github.com/seblabbe"
}
```


**Reviewer:** Sébastien Labbé



---

archive/issue_comments_590935.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-08-14T12:23:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590935",
    "user": "https://github.com/seblabbe"
}
```


**Changing status** from needs_review to positive_review.



---

archive/issue_comments_590936.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2020-08-23T16:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590936",
    "user": "https://github.com/vbraun"
}
```


**Resolution:** fixed



---

archive/issue_events_087119.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-23T16:28:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30035#event-87119"
}
```




---

archive/issue_comments_590937.json:
```json
{
    "body": "**Changing branch** from \"[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)\" to \"[7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)\".",
    "created_at": "2020-08-23T16:28:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30035",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30035#issuecomment-590937",
    "user": "https://github.com/vbraun"
}
```


**Changing branch** from "[u/chapoton/30035](https://github.com/sagemath/sagetrac-mirror/tree/u/chapoton/30035)" to "[7c7fc38d2270fbc90b1015f15244ef4f733a5729](https://github.com/sagemath/sagetrac-mirror/commit/7c7fc38d2270fbc90b1015f15244ef4f733a5729)".
