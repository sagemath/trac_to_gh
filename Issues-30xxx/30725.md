# Issue 30725: macOS: spkg-install scripts that force use of clang conflict with '-march=native'

archive/issues_030488.json:
```json
{
    "assignees": [],
    "body": "Several packages force the use of `clang` because they cannot be built with a real gcc due to the use of Apple language extensions in system header files. \n\nFor these packages, the use of `-march=native` introduced in #27122 causes build errors because `clang` does not understand these flags (even though `/usr/bin/gcc` does).\n\nTickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....\n\n```\n$ git grep MACOSX_VERSION\nbuild/pkgs/curl/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang and --with-darwinssl.\"\nbuild/pkgs/psutil/spkg-install.in:    echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\nbuild/pkgs/python3/spkg-build.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\nbuild/pkgs/r/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n```\n\nTo test:\n\n```\ntox -e local-homebrew-macos-minimal\ntox -e local-homebrew-macos-minimal -- cmake curl gmp\ntox -e local-homebrew-macos-minimal -- ptest\n```\n\nTo test with a real gcc (using a gcc-10 installed from homebrew):\n\n```\ntox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r\n```\n\n\nCC:  @jhpalmieri @dimpase @kliem @zlscherr @kiwifb @seblabbe\n\nBranch/Commit: **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**\n\nReviewer: **Jonathan Kliem, Matthias Koeppe**\n\nAuthor: **Matthias Koeppe, Jonathan Kliem**\n\nComponent: **porting**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30725_\n\n",
    "closed_at": "2021-01-31T20:53:57Z",
    "created_at": "2020-10-05T02:07:31Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting",
        "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "macOS: spkg-install scripts that force use of clang conflict with '-march=native'",
    "type": "issue",
    "updated_at": "2021-01-31T20:53:57Z",
    "url": "https://github.com/sagemath/sage/issues/30725",
    "user": "https://github.com/mkoeppe"
}
```
Several packages force the use of `clang` because they cannot be built with a real gcc due to the use of Apple language extensions in system header files. 

For these packages, the use of `-march=native` introduced in #27122 causes build errors because `clang` does not understand these flags (even though `/usr/bin/gcc` does).

Tickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....

```
$ git grep MACOSX_VERSION
build/pkgs/curl/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang and --with-darwinssl."
build/pkgs/psutil/spkg-install.in:    echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
build/pkgs/python3/spkg-build.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
build/pkgs/r/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
```

To test:

```
tox -e local-homebrew-macos-minimal
tox -e local-homebrew-macos-minimal -- cmake curl gmp
tox -e local-homebrew-macos-minimal -- ptest
```

To test with a real gcc (using a gcc-10 installed from homebrew):

```
tox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r
```


CC:  @jhpalmieri @dimpase @kliem @zlscherr @kiwifb @seblabbe

Branch/Commit: **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**

Reviewer: **Jonathan Kliem, Matthias Koeppe**

Author: **Matthias Koeppe, Jonathan Kliem**

Component: **porting**

_Issue created by migration from https://trac.sagemath.org/ticket/30725_





---

archive/issue_events_425826.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-05T02:07:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425826"
}
```



---

archive/issue_events_425827.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-05T02:07:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting",
    "label_color": "000080",
    "label_name": "c: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425827"
}
```



---

archive/issue_events_425828.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-05T02:07:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425828"
}
```



---

archive/issue_events_425829.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-05T02:07:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425829"
}
```



---

archive/issue_events_425830.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-16T17:59:21Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "title_is": "macOS: spkg-install: Remove outdated \"Building with clang\" code - which conflicts with '-march=native'",
    "title_was": "macOS: spkg-install: Remove outdated \"Building with clang\" branches",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425830"
}
```



---

archive/issue_events_425831.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-16T17:59:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425831"
}
```



---

archive/issue_events_425832.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-16T17:59:21Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/p%3A%201%20%E2%80%93%20blocker",
    "label_color": "ff0000",
    "label_name": "p: 1 \u2013 blocker",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425832"
}
```



---

archive/issue_comments_490713.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage\n \n ```\n $ git grep MACOSX_VERSION\n``````\n",
    "created_at": "2021-01-16T18:01:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490713",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,4 @@
+This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage
 
 ```
 $ git grep MACOSX_VERSION
``````




---

archive/issue_comments_490714.json:
```json
{
    "body": "Dependencies: **#31186**",
    "created_at": "2021-01-16T18:02:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490714",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31186**



---

archive/issue_comments_490715.json:
```json
{
    "body": "Changed dependencies from **#31186** to none",
    "created_at": "2021-01-18T01:15:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490715",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31186** to none



---

archive/issue_comments_490716.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n-This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage\n+This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage.\n+\n+Tickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....\n+\n \n ```\n $ git grep MACOSX_VERSION\n``````\n",
    "created_at": "2021-01-18T01:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490716",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
-This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage
+This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage.
+
+Tickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....
+
 
 ```
 $ git grep MACOSX_VERSION
``````




---

archive/issue_comments_490717.json:
```json
{
    "body": "Branch: **[u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)**",
    "created_at": "2021-01-18T01:43:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490717",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)**



---

archive/issue_comments_490718.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThose bits should have gone when I \"normalised\" clang for building sage on OS X. We were probably planing to remove them at a later stage and forgot.\n\nWell, the opportunity is clearly now.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1cb38cd90280a0d7478d509e07c8ba5024911f30\"><code>1cb38cd</code></a></td><td><code>tox.ini: Add configuration factor gcc_10</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f190f512fe3812815efa3dcd800cd9acc7464e50\"><code>f190f51</code></a></td><td><code>build/pkgs/cmake/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c89bc05604004424610103bd2771a11df463e20\"><code>0c89bc0</code></a></td><td><code>build/pkgs/{gmp,mpir}/spkg-install.in: Do not override compiler set explicitly to clang</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/178a49080389ff8e2538b4ac55bbe90f3b582a64\"><code>178a490</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/13ef68536884cdddea4c617cf55c51ce976bab80\"><code>13ef685</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a5e7db2f496d3b364543b9efbaceac9094fc6ae\"><code>2a5e7db</code></a></td><td><code>build/pkgs/r/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c187d65a6f14f6cadf5c1fa1970d8990ce26a70b\"><code>c187d65</code></a></td><td><code>build/pkgs/psutil/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1\"><code>3fd3388</code></a></td><td><code>build/pkgs/curl/spkg-install.in: Do not explicitly use clang on macos</code></td></tr></table>\n",
    "created_at": "2021-01-18T01:47:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490718",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:8" align="right">comment:8</div>

Those bits should have gone when I "normalised" clang for building sage on OS X. We were probably planing to remove them at a later stage and forgot.

Well, the opportunity is clearly now.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1cb38cd90280a0d7478d509e07c8ba5024911f30"><code>1cb38cd</code></a></td><td><code>tox.ini: Add configuration factor gcc_10</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f190f512fe3812815efa3dcd800cd9acc7464e50"><code>f190f51</code></a></td><td><code>build/pkgs/cmake/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c89bc05604004424610103bd2771a11df463e20"><code>0c89bc0</code></a></td><td><code>build/pkgs/{gmp,mpir}/spkg-install.in: Do not override compiler set explicitly to clang</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/178a49080389ff8e2538b4ac55bbe90f3b582a64"><code>178a490</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/13ef68536884cdddea4c617cf55c51ce976bab80"><code>13ef685</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a5e7db2f496d3b364543b9efbaceac9094fc6ae"><code>2a5e7db</code></a></td><td><code>build/pkgs/r/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c187d65a6f14f6cadf5c1fa1970d8990ce26a70b"><code>c187d65</code></a></td><td><code>build/pkgs/psutil/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1"><code>3fd3388</code></a></td><td><code>build/pkgs/curl/spkg-install.in: Do not explicitly use clang on macos</code></td></tr></table>




---

archive/issue_comments_490719.json:
```json
{
    "body": "Commit: **[`3fd3388`](https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1)**",
    "created_at": "2021-01-18T01:47:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490719",
    "user": "https://github.com/kiwifb"
}
```

Commit: **[`3fd3388`](https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1)**



---

archive/issue_comments_490720.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,3 +18,11 @@\n build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then\n build/pkgs/r/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n ```\n+\n+Configurations to test:\n+\n+```\n+tox -e local-homebrew-macos-minimal-gcc_10\n+tox -e local-homebrew-macos-minimal\n+```\n+\n``````\n",
    "created_at": "2021-01-18T01:49:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490720",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,3 +18,11 @@
 build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then
 build/pkgs/r/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
 ```
+
+Configurations to test:
+
+```
+tox -e local-homebrew-macos-minimal-gcc_10
+tox -e local-homebrew-macos-minimal
+```
+
``````




---

archive/issue_comments_490721.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nAlso several of these packages have been updated since and are able to build with an actual gcc on macOS. We have tickets for some packages where this is still broken: #29613 (givaro)",
    "created_at": "2021-01-18T01:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490721",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Also several of these packages have been updated since and are able to build with an actual gcc on macOS. We have tickets for some packages where this is still broken: #29613 (givaro)



---

archive/issue_comments_490722.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -19,10 +19,11 @@\n build/pkgs/r/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n ```\n \n-Configurations to test:\n+To test:\n \n ```\n-tox -e local-homebrew-macos-minimal-gcc_10\n tox -e local-homebrew-macos-minimal\n+tox -e local-homebrew-macos-minimal -- cmake curl gmp\n+tox -e local-homebrew-macos-minimal -- ptest\n ```\n \n``````\n",
    "created_at": "2021-01-18T03:52:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490722",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -19,10 +19,11 @@
 build/pkgs/r/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
 ```
 
-Configurations to test:
+To test:
 
 ```
-tox -e local-homebrew-macos-minimal-gcc_10
 tox -e local-homebrew-macos-minimal
+tox -e local-homebrew-macos-minimal -- cmake curl gmp
+tox -e local-homebrew-macos-minimal -- ptest
 ```
 
``````




---

archive/issue_comments_490723.json:
```json
{
    "body": "Changed commit from **[`3fd3388`](https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1)** to **[`2a39819`](https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5)**",
    "created_at": "2021-01-18T05:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490723",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3fd3388`](https://github.com/sagemath/sagetrac-mirror/commit/3fd3388757aec91dd5a4b65ccc6e623e55c307c1)** to **[`2a39819`](https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5)**



---

archive/issue_comments_490724.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5bc544c69426400585542c2b209fe797ba5685bf\"><code>5bc544c</code></a></td><td><code>build/pkgs/cmake/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/da4ea53f797235e3be9ba5bc09299606005b9998\"><code>da4ea53</code></a></td><td><code>build/pkgs/{gmp,mpir}/spkg-install.in: Do not override compiler set explicitly to clang</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/05b06b28e4cc661941207a1f587b288a65c67b9c\"><code>05b06b2</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e796b8a43285bf309dacea2cfad443028dd4aab3\"><code>e796b8a</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5895d238471a6b17a752bfed15e3980baac91e46\"><code>5895d23</code></a></td><td><code>build/pkgs/r/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/350bc01fa791f9b07f70546d687ba116e29a1bb9\"><code>350bc01</code></a></td><td><code>build/pkgs/psutil/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5\"><code>2a39819</code></a></td><td><code>build/pkgs/curl/spkg-install.in: Do not explicitly use clang on macos</code></td></tr></table>\n",
    "created_at": "2021-01-18T05:26:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490724",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5bc544c69426400585542c2b209fe797ba5685bf"><code>5bc544c</code></a></td><td><code>build/pkgs/cmake/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/da4ea53f797235e3be9ba5bc09299606005b9998"><code>da4ea53</code></a></td><td><code>build/pkgs/{gmp,mpir}/spkg-install.in: Do not override compiler set explicitly to clang</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/05b06b28e4cc661941207a1f587b288a65c67b9c"><code>05b06b2</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e796b8a43285bf309dacea2cfad443028dd4aab3"><code>e796b8a</code></a></td><td><code>build/pkgs/python3/spkg-build.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5895d238471a6b17a752bfed15e3980baac91e46"><code>5895d23</code></a></td><td><code>build/pkgs/r/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/350bc01fa791f9b07f70546d687ba116e29a1bb9"><code>350bc01</code></a></td><td><code>build/pkgs/psutil/spkg-install.in: Do not explicitly use clang on macos</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5"><code>2a39819</code></a></td><td><code>build/pkgs/curl/spkg-install.in: Do not explicitly use clang on macos</code></td></tr></table>




---

archive/issue_comments_490725.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2021-01-18T05:27:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490725",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_425833.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T05:27:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425833"
}
```



---

archive/issue_comments_490726.json:
```json
{
    "body": "Reviewer: **https://github.com/kliem/sage/pull/34/checks**",
    "created_at": "2021-01-18T06:48:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490726",
    "user": "https://github.com/kliem"
}
```

Reviewer: **https://github.com/kliem/sage/pull/34/checks**



---

archive/issue_comments_490727.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nI have tested the configuration in the ticket description successfully.\n\nBut testing with the `gcc-10` from homebrew, I am still running into issues with macOS header files that are not compatible with gcc.\n\n```\n  [cmake-3.18.2] installing. Log file: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/logs/pkgs/cmake-3.18.2.log\n  [cmake-3.18.2] error installing, exit status 1. End of log file:\n  [cmake-3.18.2]   /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/ImageIO.framework/Headers/CGImageAnimation.h:42:15: error: expected unqualified-id before '^' token\n  [cmake-3.18.2]      42 | typedef void (^CGImageSourceAnimationBlock)(size_t index, CGImageRef image, bool* stop);\n  [cmake-3.18.2]         |               ^\n```",
    "created_at": "2021-01-18T07:01:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490727",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

I have tested the configuration in the ticket description successfully.

But testing with the `gcc-10` from homebrew, I am still running into issues with macOS header files that are not compatible with gcc.

```
  [cmake-3.18.2] installing. Log file: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/logs/pkgs/cmake-3.18.2.log
  [cmake-3.18.2] error installing, exit status 1. End of log file:
  [cmake-3.18.2]   /Library/Developer/CommandLineTools/SDKs/MacOSX10.15.sdk/System/Library/Frameworks/ImageIO.framework/Headers/CGImageAnimation.h:42:15: error: expected unqualified-id before '^' token
  [cmake-3.18.2]      42 | typedef void (^CGImageSourceAnimationBlock)(size_t index, CGImageRef image, bool* stop);
  [cmake-3.18.2]         |               ^
```



---

archive/issue_comments_490728.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nBtw, to prevent breackage because of `-march=native`, one can also `export CFLAGS=CFLAGS_NON_NATIVE` etc. right after setting the compiler to clang.",
    "created_at": "2021-01-18T07:03:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490728",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">comment:16</div>

Btw, to prevent breackage because of `-march=native`, one can also `export CFLAGS=CFLAGS_NON_NATIVE` etc. right after setting the compiler to clang.



---

archive/issue_events_425834.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T07:08:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425834"
}
```



---

archive/issue_events_425835.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T07:08:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425835"
}
```



---

archive/issue_comments_490729.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nYes, if simple fixes such as package upgrades don't fix it, that's what we should do.",
    "created_at": "2021-01-18T07:08:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490729",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Yes, if simple fixes such as package upgrades don't fix it, that's what we should do.



---

archive/issue_comments_490730.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nUpgrade of cmake to 3.19.3 (#31258) does not fix this",
    "created_at": "2021-01-18T07:50:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490730",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Upgrade of cmake to 3.19.3 (#31258) does not fix this



---

archive/issue_comments_490731.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nI don't understand - I presume one still cannot build all of Sage on macOS using \"real\" gcc.\n\nWhy is this a blocker?",
    "created_at": "2021-01-18T16:39:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490731",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

I don't understand - I presume one still cannot build all of Sage on macOS using "real" gcc.

Why is this a blocker?



---

archive/issue_comments_490732.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@dimpase](#comment:19):\n> I don't understand - I presume one still cannot build all of Sage on macOS using \"real\" gcc.\n\nYes, this is what the experiment with `cmake` has just revealed.\n\n> Why is this a blocker?\n\nWhen Apple's compiler is invoked as `clang` instead of `gcc`, it does not understand the same flags. So #27122 leads to build errors.",
    "created_at": "2021-01-18T17:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490732",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@dimpase](#comment:19):
> I don't understand - I presume one still cannot build all of Sage on macOS using "real" gcc.

Yes, this is what the experiment with `cmake` has just revealed.

> Why is this a blocker?

When Apple's compiler is invoked as `clang` instead of `gcc`, it does not understand the same flags. So #27122 leads to build errors.



---

archive/issue_events_425836.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T17:59:50Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "title_is": "macOS: spkg-install scripts that force use of clang conflict with '-march=native'",
    "title_was": "macOS: spkg-install: Remove outdated \"Building with clang\" code - which conflicts with '-march=native'",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425836"
}
```



---

archive/issue_comments_490733.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,21 +1,14 @@\n-This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage.\n+Several packages force the use of `clang` because they cannot be built with a real gcc due to the use of Apple language extensions in system header files. \n+\n+For these packages, the use of `-march=native` introduced in #27122 causes build errors because `clang` does not understand these flags (even though `/usr/bin/gcc` does).\n \n Tickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....\n \n-\n ```\n $ git grep MACOSX_VERSION\n-build/pkgs/curl/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then\n build/pkgs/curl/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang and --with-darwinssl.\"\n-build/pkgs/pari/spkg-install.in:MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`\n-build/pkgs/pari/spkg-install.in:if [ $MACOSX_VERSION -ge 14 ]; then\n-build/pkgs/psutil/spkg-install.in:if [ \"$UNAME\" = \"Darwin\" ] && [ $MACOSX_VERSION -ge 16 ]; then\n build/pkgs/psutil/spkg-install.in:    echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n-build/pkgs/python3/spkg-build.in:    if [ $MACOSX_VERSION -ge 16 ]; then\n build/pkgs/python3/spkg-build.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n-build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 14 ]; then\n-build/pkgs/r/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Configuring R without aqua support.\"\n-build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then\n build/pkgs/r/spkg-install.in:        echo \"OS X 10.$[$MACOSX_VERSION-4] Building with clang.\"\n ```\n \n``````\n",
    "created_at": "2021-01-18T17:59:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490733",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,21 +1,14 @@
-This code in several spkg-install scripts is long outdated. But now, after #27122, it causes breakage.
+Several packages force the use of `clang` because they cannot be built with a real gcc due to the use of Apple language extensions in system header files. 
+
+For these packages, the use of `-march=native` introduced in #27122 causes build errors because `clang` does not understand these flags (even though `/usr/bin/gcc` does).
 
 Tickets where code setting the compiler was explicitly introduced: #22999 (cmake), ....
 
-
 ```
 $ git grep MACOSX_VERSION
-build/pkgs/curl/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then
 build/pkgs/curl/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang and --with-darwinssl."
-build/pkgs/pari/spkg-install.in:MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`
-build/pkgs/pari/spkg-install.in:if [ $MACOSX_VERSION -ge 14 ]; then
-build/pkgs/psutil/spkg-install.in:if [ "$UNAME" = "Darwin" ] && [ $MACOSX_VERSION -ge 16 ]; then
 build/pkgs/psutil/spkg-install.in:    echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
-build/pkgs/python3/spkg-build.in:    if [ $MACOSX_VERSION -ge 16 ]; then
 build/pkgs/python3/spkg-build.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
-build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 14 ]; then
-build/pkgs/r/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Configuring R without aqua support."
-build/pkgs/r/spkg-install.in:    if [ $MACOSX_VERSION -ge 16 ]; then
 build/pkgs/r/spkg-install.in:        echo "OS X 10.$[$MACOSX_VERSION-4] Building with clang."
 ```
 
``````




---

archive/issue_comments_490734.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThe `curl` build also fails:\n\n```\nvtls/darwinssl.c: In function 'show_verbose_server_cert':\nvtls/darwinssl.c:2711:6: error: 'SecTrustEvaluateAsync' undeclared (first use in this function); did you mean 'SecTrustEvaluate'?\n 2711 |   if(SecTrustEvaluateAsync != NULL) {\n      |      ^~~~~~~~~~~~~~~~~~~~~\n      |      SecTrustEvaluate\n```\nAn update to current curl (#31260) does not fix this. Either version works fine with clang.",
    "created_at": "2021-01-18T18:31:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490734",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

The `curl` build also fails:

```
vtls/darwinssl.c: In function 'show_verbose_server_cert':
vtls/darwinssl.c:2711:6: error: 'SecTrustEvaluateAsync' undeclared (first use in this function); did you mean 'SecTrustEvaluate'?
 2711 |   if(SecTrustEvaluateAsync != NULL) {
      |      ^~~~~~~~~~~~~~~~~~~~~
      |      SecTrustEvaluate
```
An update to current curl (#31260) does not fix this. Either version works fine with clang.



---

archive/issue_comments_490735.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,3 +20,9 @@\n tox -e local-homebrew-macos-minimal -- ptest\n ```\n \n+To test with a real gcc:\n+\n+```\n+tox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r\n+```\n+\n``````\n",
    "created_at": "2021-01-18T18:36:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490735",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,3 +20,9 @@
 tox -e local-homebrew-macos-minimal -- ptest
 ```
 
+To test with a real gcc:
+
+```
+tox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r
+```
+
``````




---

archive/issue_comments_490736.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b16a8c4884fd6eb464b94121b29990b0cc4dff8\"><code>1b16a8c</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1\"><code>c6e30ea</code></a></td><td><code>tox.ini: Add configuration factors gcc_10, gcc_11</code></td></tr></table>\n",
    "created_at": "2021-01-18T18:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b16a8c4884fd6eb464b94121b29990b0cc4dff8"><code>1b16a8c</code></a></td><td><code>build/pkgs/pari/spkg-install.in: Do not recompute MACOSX_VERSION</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1"><code>c6e30ea</code></a></td><td><code>tox.ini: Add configuration factors gcc_10, gcc_11</code></td></tr></table>




---

archive/issue_comments_490737.json:
```json
{
    "body": "Changed commit from **[`2a39819`](https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5)** to **[`c6e30ea`](https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1)**",
    "created_at": "2021-01-18T18:37:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490737",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2a39819`](https://github.com/sagemath/sagetrac-mirror/commit/2a3981932d00235d13afc32edf76c1699dbbabc5)** to **[`c6e30ea`](https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1)**



---

archive/issue_comments_490738.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@kliem](#comment:16):\n> Btw, to prevent breackage because of `-march=native`, one can also `export CFLAGS=CFLAGS_NON_NATIVE` etc. right after setting the compiler to clang.\n\nI have backed out the previous attempt and will use this approach now.",
    "created_at": "2021-01-18T18:37:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490738",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@kliem](#comment:16):
> Btw, to prevent breackage because of `-march=native`, one can also `export CFLAGS=CFLAGS_NON_NATIVE` etc. right after setting the compiler to clang.

I have backed out the previous attempt and will use this approach now.



---

archive/issue_comments_490739.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nAre you saying that `CC=clang CXX=clang++ ./configure && make` does not work any more on macOS - or it does, but not setting CC and CXX breaks down? \n\nInvoking Apple's clang as gcc is a kludge that sooner or later should become a problem, are you saying  it already is one?",
    "created_at": "2021-01-18T18:39:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490739",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

Are you saying that `CC=clang CXX=clang++ ./configure && make` does not work any more on macOS - or it does, but not setting CC and CXX breaks down? 

Invoking Apple's clang as gcc is a kludge that sooner or later should become a problem, are you saying  it already is one?



---

archive/issue_comments_490740.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@dimpase](#comment:26):\n> Are you saying that `CC=clang CXX=clang++ ./configure && make` does not work any more on macOS - or it does,\n\nIt does work - in this case, these compilers will be tested for what flags they accept.\n\n> but not setting CC and CXX breaks down? \n\nThat's right. The issue arises from the `spkg-install` scripts changing the compiler to `clang` and continuing to use CFLAGS that have been determined by the configure script for a different compiler (`/usr/bin/gcc`).",
    "created_at": "2021-01-18T18:49:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490740",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@dimpase](#comment:26):
> Are you saying that `CC=clang CXX=clang++ ./configure && make` does not work any more on macOS - or it does,

It does work - in this case, these compilers will be tested for what flags they accept.

> but not setting CC and CXX breaks down? 

That's right. The issue arises from the `spkg-install` scripts changing the compiler to `clang` and continuing to use CFLAGS that have been determined by the configure script for a different compiler (`/usr/bin/gcc`).



---

archive/issue_comments_490741.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOh, so on macOS `/usr/bin/gcc` has become a *different* from `/usr/bin/clang` (or whatever the path is) front-end to \"real\" clang? Thanks, Apple, this is a great help.",
    "created_at": "2021-01-18T19:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490741",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:28" align="right">comment:28</div>

Oh, so on macOS `/usr/bin/gcc` has become a *different* from `/usr/bin/clang` (or whatever the path is) front-end to "real" clang? Thanks, Apple, this is a great help.



---

archive/issue_comments_490742.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nYes, they have different interfaces.",
    "created_at": "2021-01-18T19:08:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490742",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Yes, they have different interfaces.



---

archive/issue_comments_490743.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nIt is more like `/usr/bin/gcc` is a front end that can filter command line options specific to gcc. This is not a new behavior. And this is a problem now that we have committed to some specific gcc options.",
    "created_at": "2021-01-18T19:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490743",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:30" align="right">comment:30</div>

It is more like `/usr/bin/gcc` is a front end that can filter command line options specific to gcc. This is not a new behavior. And this is a problem now that we have committed to some specific gcc options.



---

archive/issue_comments_490744.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d\"><code>9b0eb15</code></a></td><td><code>build/pkgs/{cmake,curl,psutil,python3,r}: If setting CC=clang, also set CFLAGS</code></td></tr></table>\n",
    "created_at": "2021-01-18T19:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490744",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d"><code>9b0eb15</code></a></td><td><code>build/pkgs/{cmake,curl,psutil,python3,r}: If setting CC=clang, also set CFLAGS</code></td></tr></table>




---

archive/issue_comments_490745.json:
```json
{
    "body": "Changed commit from **[`c6e30ea`](https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1)** to **[`9b0eb15`](https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d)**",
    "created_at": "2021-01-18T19:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490745",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c6e30ea`](https://github.com/sagemath/sagetrac-mirror/commit/c6e30eab754c20f53ceef40508a223c590f06cb1)** to **[`9b0eb15`](https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d)**



---

archive/issue_events_425837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T19:29:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425837"
}
```



---

archive/issue_events_425838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T19:29:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425838"
}
```



---

archive/issue_comments_490746.json:
```json
{
    "body": "Changed reviewer from **https://github.com/kliem/sage/pull/34/checks** to none",
    "created_at": "2021-01-18T19:29:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490746",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/kliem/sage/pull/34/checks** to none



---

archive/issue_comments_490747.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -20,7 +20,7 @@\n tox -e local-homebrew-macos-minimal -- ptest\n ```\n \n-To test with a real gcc:\n+To test with a real gcc (using a gcc-10 installed from homebrew):\n \n ```\n tox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r\n``````\n",
    "created_at": "2021-01-18T19:30:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490747",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -20,7 +20,7 @@
 tox -e local-homebrew-macos-minimal -- ptest
 ```
 
-To test with a real gcc:
+To test with a real gcc (using a gcc-10 installed from homebrew):
 
 ```
 tox -e local-direct-gcc_10 -- cmake curl gmp python3 psutil r
``````




---

archive/issue_comments_490748.json:
```json
{
    "body": "Reviewer: **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, ...**",
    "created_at": "2021-01-19T20:40:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490748",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, ...**



---

archive/issue_comments_490749.json:
```json
{
    "body": "Changed commit from **[`9b0eb15`](https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d)** to **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**",
    "created_at": "2021-01-20T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490749",
    "user": "https://github.com/kliem"
}
```

Changed commit from **[`9b0eb15`](https://github.com/sagemath/sagetrac-mirror/commit/9b0eb15897bbde3ad5e440b26d714f637516e91d)** to **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**



---

archive/issue_comments_490750.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)** to **[u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)**",
    "created_at": "2021-01-20T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490750",
    "user": "https://github.com/kliem"
}
```

Changed branch from **[u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)** to **[u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)**



---

archive/issue_comments_490751.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nR does not use `-march=native` anyway.\n`python/spkg-build.in` is set up a bit different. `$CFLAGS` contains other stuff and `$EXTRA_CFLAGS` is contains the old `$CFLAGS`, so we need to set `$EXTRA_CFLAGS`.\n\nAnyway, I think the main problem is that we run `testcfags.sh` before setting the compiler.\nWe might as well run this for `$CFLAGS` as well after possibly changing the compiler.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0\"><code>02c2684</code></a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464\"><code>24b4fcc</code></a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1\"><code>44be967</code></a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed\"><code>f56e65e</code></a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr></table>\n",
    "created_at": "2021-01-20T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490751",
    "user": "https://github.com/kliem"
}
```

<div id="comment:35" align="right">comment:35</div>

R does not use `-march=native` anyway.
`python/spkg-build.in` is set up a bit different. `$CFLAGS` contains other stuff and `$EXTRA_CFLAGS` is contains the old `$CFLAGS`, so we need to set `$EXTRA_CFLAGS`.

Anyway, I think the main problem is that we run `testcfags.sh` before setting the compiler.
We might as well run this for `$CFLAGS` as well after possibly changing the compiler.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02c268457164b76ddd97bece691111725dddf6c0"><code>02c2684</code></a></td><td><code>R is already compiled without -march=native</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24b4fcca7179e0b857d3599d7ccf086e37c1d464"><code>24b4fcc</code></a></td><td><code>set EXTRACFLAGS instead of CFLAGS</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/44be9671b85348db09046fa0c720812bfe7393a1"><code>44be967</code></a></td><td><code>make code a bit more stable against future changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed"><code>f56e65e</code></a></td><td><code>fix CFLAGS for python3/spkg-build.in by running testcflags.sh after determination of the compiler</code></td></tr></table>




---

archive/issue_comments_490752.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, ...** to **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem**",
    "created_at": "2021-01-20T10:16:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490752",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, ...** to **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem**



---

archive/issue_comments_490753.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem** to **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem, https://github.com/kliem/sage/actions/runs/498284561**",
    "created_at": "2021-01-20T10:24:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490753",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem** to **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem, https://github.com/kliem/sage/actions/runs/498284561**



---

archive/issue_comments_490754.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@kliem](#comment:35):\n> R does not use `-march=native` anyway.\n\n... is it ignoring CFLAGS?",
    "created_at": "2021-01-20T20:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490754",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@kliem](#comment:35):
> R does not use `-march=native` anyway.

... is it ignoring CFLAGS?



---

archive/issue_comments_490755.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nNo, it already uses `CFLAGS_NON_NATIVE`.\n\n```\n 10 # #29170: Compilation errors caused by a silently failing configure check\n 11 # \"for type of 'hidden' Fortran character lengths\"\n 12 # on ubuntu-bionic-minimal, ubuntu-eoan/focal-minimal, debian-buster/bullseye/sid-minimal,\n 13 # linuxmint-19.3-minimal, archlinux-latest-minimal\n 14 CFLAGS=\"$CFLAGS_NON_NATIVE -fPIC\"\n 15 FCFLAGS=\"$FCFLAGS_NON_NATIVE -fPIC\"\n```",
    "created_at": "2021-01-20T20:59:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490755",
    "user": "https://github.com/kliem"
}
```

<div id="comment:38" align="right">comment:38</div>

No, it already uses `CFLAGS_NON_NATIVE`.

```
 10 # #29170: Compilation errors caused by a silently failing configure check
 11 # "for type of 'hidden' Fortran character lengths"
 12 # on ubuntu-bionic-minimal, ubuntu-eoan/focal-minimal, debian-buster/bullseye/sid-minimal,
 13 # linuxmint-19.3-minimal, archlinux-latest-minimal
 14 CFLAGS="$CFLAGS_NON_NATIVE -fPIC"
 15 FCFLAGS="$FCFLAGS_NON_NATIVE -fPIC"
```



---

archive/issue_comments_490756.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nAh, OK, thanks",
    "created_at": "2021-01-20T21:00:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490756",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Ah, OK, thanks



---

archive/issue_comments_490757.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nR was one of the things that crashed or didn't build with `-march=native` (don't remember), so I disalbed it in #27122.",
    "created_at": "2021-01-20T21:00:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490757",
    "user": "https://github.com/kliem"
}
```

<div id="comment:40" align="right">comment:40</div>

R was one of the things that crashed or didn't build with `-march=native` (don't remember), so I disalbed it in #27122.



---

archive/issue_comments_490758.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nMy tests finished. Not very sucessfull though. Looks like zlib failed for many mac runs.\n\nAlso ubuntu-bionic-minimal and debian-buster-minimal failed because somehow ssl wasn't available and the pytest failed (or the server did not reply).\n\nAnyway. There are several different ways to fix `python3/spkg-build.in` of course.",
    "created_at": "2021-01-21T07:36:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490758",
    "user": "https://github.com/kliem"
}
```

<div id="comment:41" align="right">comment:41</div>

My tests finished. Not very sucessfull though. Looks like zlib failed for many mac runs.

Also ubuntu-bionic-minimal and debian-buster-minimal failed because somehow ssl wasn't available and the pytest failed (or the server did not reply).

Anyway. There are several different ways to fix `python3/spkg-build.in` of course.



---

archive/issue_comments_490759.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nReplying to [@kliem](#comment:41):\n> My tests finished. Not very sucessfull though. Looks like zlib failed for many mac runs.\n> \n> Also ubuntu-bionic-minimal and debian-buster-minimal failed because somehow ssl wasn't available and the pytest failed (or the server did not reply).\n\nOne needs to merge a few tickets that fix up the GH Actions runs.",
    "created_at": "2021-01-21T22:58:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490759",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Replying to [@kliem](#comment:41):
> My tests finished. Not very sucessfull though. Looks like zlib failed for many mac runs.
> 
> Also ubuntu-bionic-minimal and debian-buster-minimal failed because somehow ssl wasn't available and the pytest failed (or the server did not reply).

One needs to merge a few tickets that fix up the GH Actions runs.



---

archive/issue_comments_490760.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@kliem](#comment:41):\n> There are several different ways to fix `python3/spkg-build.in` of course.\n\nAre you satisfied with the version that you pushed?",
    "created_at": "2021-01-21T22:59:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490760",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@kliem](#comment:41):
> There are several different ways to fix `python3/spkg-build.in` of course.

Are you satisfied with the version that you pushed?



---

archive/issue_comments_490761.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem, https://github.com/kliem/sage/actions/runs/498284561** to **https://github.com/mkoeppe/sage/actions/runs/502363182, Jonathan Kliem**",
    "created_at": "2021-01-21T23:02:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490761",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/496953211, https://github.com/mkoeppe/sage/actions/runs/496953208, Jonathan Kliem, https://github.com/kliem/sage/actions/runs/498284561** to **https://github.com/mkoeppe/sage/actions/runs/502363182, Jonathan Kliem**



---

archive/issue_comments_490762.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@mkoeppe](#comment:43):\n> Replying to [@kliem](#comment:41):\n> > There are several different ways to fix `python3/spkg-build.in` of course.\n\n> \n> Are you satisfied with the version that you pushed?\n\nYes.",
    "created_at": "2021-01-22T06:54:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490762",
    "user": "https://github.com/kliem"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@mkoeppe](#comment:43):
> Replying to [@kliem](#comment:41):
> > There are several different ways to fix `python3/spkg-build.in` of course.

> 
> Are you satisfied with the version that you pushed?

Yes.



---

archive/issue_comments_490763.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nAnd I'm also happy with your changes.\n\nI'm just waiting on an okay, that this fixes things.",
    "created_at": "2021-01-22T06:54:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490763",
    "user": "https://github.com/kliem"
}
```

<div id="comment:46" align="right">comment:46</div>

And I'm also happy with your changes.

I'm just waiting on an okay, that this fixes things.



---

archive/issue_comments_490764.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nIs this supposed to fix issues around using /usr/bin/python3 on Big Sur? With this ticket if I configure with-python=/usr/bin/python3 and then do make Cython I still get\n\n\n```\ngcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64 -O2 -g -march=native -I/Users/zscherr/sage/develop/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c /private/var/folders/5f/z870t4kd5dlctkcrs984nh8r0000gn/T/pip-req-build-rpwm0h2y/Cython/Plex/Scanners.c -o build/temp.macosx-10.14.6-x86_64-3.8/private/var/folders/5f/z870t4kd5dlctkcrs984nh8r0000gn/T/pip-req-build-rpwm0h2y/Cython/Plex/Scanners.o\n  clang: error: the clang compiler does not support '-march=native'\n  error: command 'gcc' failed with exit status 1\n```",
    "created_at": "2021-01-22T22:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490764",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:47" align="right">comment:47</div>

Is this supposed to fix issues around using /usr/bin/python3 on Big Sur? With this ticket if I configure with-python=/usr/bin/python3 and then do make Cython I still get


```
gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -iwithsysroot/System/Library/Frameworks/System.framework/PrivateHeaders -iwithsysroot/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/Headers -arch arm64 -arch x86_64 -O2 -g -march=native -I/Users/zscherr/sage/develop/local/include -I/Applications/Xcode.app/Contents/Developer/Library/Frameworks/Python3.framework/Versions/3.8/include/python3.8 -c /private/var/folders/5f/z870t4kd5dlctkcrs984nh8r0000gn/T/pip-req-build-rpwm0h2y/Cython/Plex/Scanners.c -o build/temp.macosx-10.14.6-x86_64-3.8/private/var/folders/5f/z870t4kd5dlctkcrs984nh8r0000gn/T/pip-req-build-rpwm0h2y/Cython/Plex/Scanners.o
  clang: error: the clang compiler does not support '-march=native'
  error: command 'gcc' failed with exit status 1
```



---

archive/issue_comments_490765.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nDoes it go away, if you additionally pull in #31228?\n\nThis one just disables `-march=native` regardless, if the compiler of system python does not understand it. What might be more clever, is to just disable `-march=native` in the definition of `sdh_pip_install`.",
    "created_at": "2021-01-22T22:20:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490765",
    "user": "https://github.com/kliem"
}
```

<div id="comment:48" align="right">comment:48</div>

Does it go away, if you additionally pull in #31228?

This one just disables `-march=native` regardless, if the compiler of system python does not understand it. What might be more clever, is to just disable `-march=native` in the definition of `sdh_pip_install`.



---

archive/issue_comments_490766.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@zlscherr](#comment:47):\n> Is this supposed to fix issues around using /usr/bin/python3 on Big Sur? \n\nNo, it's only a first step",
    "created_at": "2021-01-22T22:42:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490766",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@zlscherr](#comment:47):
> Is this supposed to fix issues around using /usr/bin/python3 on Big Sur? 

No, it's only a first step



---

archive/issue_comments_490767.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@kliem](#comment:48):\n> Does it go away, if you additionally pull in #31228?\n> \n> This one just disables `-march=native` regardless, if the compiler of system python does not understand it. What might be more clever, is to just disable `-march=native` in the definition of `sdh_pip_install`.\n\nThanks! Yes, with this ticket and #31228 I can get python packages (at least cython) to build again using system python.  I'll continue to check to make sure everything builds.",
    "created_at": "2021-01-22T23:55:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490767",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@kliem](#comment:48):
> Does it go away, if you additionally pull in #31228?
> 
> This one just disables `-march=native` regardless, if the compiler of system python does not understand it. What might be more clever, is to just disable `-march=native` in the definition of `sdh_pip_install`.

Thanks! Yes, with this ticket and #31228 I can get python packages (at least cython) to build again using system python.  I'll continue to check to make sure everything builds.



---

archive/issue_comments_490768.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nI think this is good to go.",
    "created_at": "2021-01-23T10:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490768",
    "user": "https://github.com/kliem"
}
```

<div id="comment:51" align="right">comment:51</div>

I think this is good to go.



---

archive/issue_comments_490769.json:
```json
{
    "body": "Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/502363182, Jonathan Kliem** to **Jonathan Kliem**",
    "created_at": "2021-01-23T10:07:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490769",
    "user": "https://github.com/kliem"
}
```

Changed reviewer from **https://github.com/mkoeppe/sage/actions/runs/502363182, Jonathan Kliem** to **Jonathan Kliem**



---

archive/issue_events_425839.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-23T10:07:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425839"
}
```



---

archive/issue_events_425840.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2021-01-23T10:07:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425840"
}
```



---

archive/issue_comments_490770.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Jonathan Kliem**",
    "created_at": "2021-01-23T17:41:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490770",
    "user": "https://github.com/mkoeppe"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Jonathan Kliem**



---

archive/issue_comments_490771.json:
```json
{
    "body": "Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Matthias Koeppe**",
    "created_at": "2021-01-23T17:41:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490771",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Jonathan Kliem** to **Jonathan Kliem, Matthias Koeppe**



---

archive/issue_events_425841.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-31T20:53:57Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425841"
}
```



---

archive/issue_events_425842.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f0ca7dfb31280c52bba2461297efcb329955c9e9",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-01-31T20:53:57Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30725#event-425842"
}
```



---

archive/issue_comments_490772.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)** to **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**",
    "created_at": "2021-01-31T20:53:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30725",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30725#issuecomment-490772",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/macos__spkg_install__remove_outdated__building_with_clang__code___which_conflicts_with___march_native_)** to **[`f56e65e`](https://github.com/sagemath/sagetrac-mirror/commit/f56e65e25f23e69aee0d37080c046d36d7f349ed)**
