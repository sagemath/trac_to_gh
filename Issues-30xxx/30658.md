# Issue 30658: conda-forge-ubuntu-standard: Pillow fails to install (follow up)

archive/issues_030421.json:
```json
{
    "body": "Follow-up from #30550:  A small fix up for the `setup.py bdist_wheel` for pillow made in #29500, so that the fix for Pillow on conda-forge-ubuntu-standard from #30550 works again.\n\n\n\nCC:  @isuruf @dimpase\n\nBranch/Commit: ff0c97310b273bceef775021704c0e08b48b9117\n\nReviewer: Isuru Fernando\n\nAuthor: Matthias Koeppe\n\nDependencies: #30550, #29500\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30658\n\n",
    "closed_at": "2020-09-30T22:30:05Z",
    "created_at": "2020-09-25T01:59:51Z",
    "labels": [
        "component: packages: standard",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "conda-forge-ubuntu-standard: Pillow fails to install (follow up)",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30658",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #30550:  A small fix up for the `setup.py bdist_wheel` for pillow made in #29500, so that the fix for Pillow on conda-forge-ubuntu-standard from #30550 works again.



CC:  @isuruf @dimpase

Branch/Commit: ff0c97310b273bceef775021704c0e08b48b9117

Reviewer: Isuru Fernando

Author: Matthias Koeppe

Dependencies: #30550, #29500

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30658





---

archive/issue_comments_606397.json:
```json
{
    "body": "<a id='comment:1'></a>Looks like that's not the issue. `build_ext` is first run with the options that we give and then `build_ext` is run again without the options we give. Not sure why it is run twice.",
    "created_at": "2020-09-25T14:30:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606397",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:1'></a>Looks like that's not the issue. `build_ext` is first run with the options that we give and then `build_ext` is run again without the options we give. Not sure why it is run twice.



---

archive/issue_comments_606398.json:
```json
{
    "body": "<a id='comment:2'></a>I started to use `bdist_wheel` (#29500) - perhaps this is not playing well with pillow's `setup.py`",
    "created_at": "2020-09-25T14:43:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606398",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>I started to use `bdist_wheel` (#29500) - perhaps this is not playing well with pillow's `setup.py`



---

archive/issue_comments_606399.json:
```json
{
    "body": "<a id='comment:3'></a>`@`mkoeppe, yes, that's an issue. Options passed to `build_ext` are not used in `bdist_wheel`.",
    "created_at": "2020-09-25T14:49:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606399",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:3'></a>`@`mkoeppe, yes, that's an issue. Options passed to `build_ext` are not used in `bdist_wheel`.



---

archive/issue_comments_606400.json:
```json
{
    "body": "<a id='comment:4'></a>A fix for this would be to move `bdist_wheel` before `build_ext`.\n\n```\npython setup.py bdist_wheel build_ext <options>\n```\ninstead of\n\n```\npython setup.py build_ext <options> bdist_wheel\n```",
    "created_at": "2020-09-25T14:56:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606400",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:4'></a>A fix for this would be to move `bdist_wheel` before `build_ext`.

```
python setup.py bdist_wheel build_ext <options>
```
instead of

```
python setup.py build_ext <options> bdist_wheel
```



---

archive/issue_comments_606401.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks! I'll try this",
    "created_at": "2020-09-25T15:17:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Thanks! I'll try this



---

archive/issue_comments_606402.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#29500\"",
    "created_at": "2020-09-25T15:18:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606402",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#29500"



---

archive/issue_comments_606403.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/conda_forge_ubuntu_standard__pillow_fails_to_install__follow_up_\"",
    "created_at": "2020-09-25T15:27:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606403",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/conda_forge_ubuntu_standard__pillow_fails_to_install__follow_up_"



---

archive/issue_comments_606404.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606404",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_606405.json:
```json
{
    "body": "Changing commit from \"\" to \"ff0c97310b273bceef775021704c0e08b48b9117\"",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606405",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "ff0c97310b273bceef775021704c0e08b48b9117"



---

archive/issue_comments_606406.json:
```json
{
    "body": "<a id='comment:8'></a>Last 10 new commits:",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606406",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Last 10 new commits:



---

archive/issue_comments_606407.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606407",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_606408.json:
```json
{
    "body": "Changing dependencies from \"#29500\" to \"#30550, #29500\"",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606408",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "#29500" to "#30550, #29500"



---

archive/issue_comments_606409.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n-Follow-up from #30550:\n+Follow-up from #30550:  A small fix up for the `setup.py bdist_wheel` for pillow made in #29500, so that the fix for Pillow on conda-forge-ubuntu-standard from #30550 works again.\n \n-  We should disable all of the features in \u200bhttps://github.com/python-pillow/Pillow/blob/master/setup.py#L261-L272 if they are not provided by sage or by a configure check\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-09-25T15:30:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606409",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
-Follow-up from #30550:
+Follow-up from #30550:  A small fix up for the `setup.py bdist_wheel` for pillow made in #29500, so that the fix for Pillow on conda-forge-ubuntu-standard from #30550 works again.
 
-  We should disable all of the features in â€‹https://github.com/python-pillow/Pillow/blob/master/setup.py#L261-L272 if they are not provided by sage or by a configure check
+
 
 Comment: 1
 
``````




---

archive/issue_comments_606410.json:
```json
{
    "body": "<a id='comment:9'></a>you might need to do the same for numpy",
    "created_at": "2020-09-25T15:32:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606410",
    "user": "https://github.com/isuruf"
}
```

<a id='comment:9'></a>you might need to do the same for numpy



---

archive/issue_comments_606411.json:
```json
{
    "body": "<a id='comment:10'></a>For numpy I think the command is OK:\n\n```\nsage-python23 setup.py \\\n        --no-user-cfg \\\n       bdist_wheel \\\n       ${NUMPY_FCONFIG} || sdh_die \"Error building wheel for numpy\"\n```",
    "created_at": "2020-09-25T16:11:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606411",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>For numpy I think the command is OK:

```
sage-python23 setup.py \
        --no-user-cfg \
       bdist_wheel \
       ${NUMPY_FCONFIG} || sdh_die "Error building wheel for numpy"
```



---

archive/issue_comments_606412.json:
```json
{
    "body": "<a id='comment:11'></a>Confirmed that pillow now works:\n\n```\n$  tox -e docker-conda-forge-ubuntu-standard -- pillow\n...\n[pillow-7.2.0] installing. Log file: /sage/logs/pkgs/pillow-7.2.0.log\n  [pillow-7.2.0] successfully installed.\n```",
    "created_at": "2020-09-25T16:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606412",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Confirmed that pillow now works:

```
$  tox -e docker-conda-forge-ubuntu-standard -- pillow
...
[pillow-7.2.0] installing. Log file: /sage/logs/pkgs/pillow-7.2.0.log
  [pillow-7.2.0] successfully installed.
```



---

archive/issue_comments_606413.json:
```json
{
    "body": "<a id='comment:12'></a>Also\n\n```\n[numpy-1.19.1] installing. Log file: /sage/logs/pkgs/numpy-1.19.1.log\n  [numpy-1.19.1] successfully installed.\n```",
    "created_at": "2020-09-25T16:16:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606413",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Also

```
[numpy-1.19.1] installing. Log file: /sage/logs/pkgs/numpy-1.19.1.log
  [numpy-1.19.1] successfully installed.
```



---

archive/issue_comments_606414.json:
```json
{
    "body": "<a id='comment:13'></a>Ready for review",
    "created_at": "2020-09-25T17:52:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606414",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Ready for review



---

archive/issue_comments_606415.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-25T17:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606415",
    "user": "https://github.com/isuruf"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_606416.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Isuru Fernando\"",
    "created_at": "2020-09-25T17:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606416",
    "user": "https://github.com/isuruf"
}
```

Changing reviewer from "" to "Isuru Fernando"



---

archive/issue_comments_606417.json:
```json
{
    "body": "<a id='comment:15'></a>Thanks!",
    "created_at": "2020-09-25T17:55:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606417",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>Thanks!



---

archive/issue_comments_606418.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/conda_forge_ubuntu_standard__pillow_fails_to_install__follow_up_\" to \"ff0c97310b273bceef775021704c0e08b48b9117\"",
    "created_at": "2020-09-30T22:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606418",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/conda_forge_ubuntu_standard__pillow_fails_to_install__follow_up_" to "ff0c97310b273bceef775021704c0e08b48b9117"



---

archive/issue_comments_606419.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-30T22:30:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30658#issuecomment-606419",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079747.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-30T22:30:05Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30658",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30658#event-79747"
}
```
