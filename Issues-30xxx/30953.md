# Issue 30953: Implicit line continuation in callable symbolic expression

archive/issues_030716.json:
```json
{
    "body": "Reported in[comment:19](#comment%3A19):ticket:30928\n\n```python\nsage: f(x) = (x +  \n....:         1)                                                                                    \n  File \"<ipython-input-10-ae23cb631161>\", line 1\n    __tmp__=var(\"x\"); f = symbolic_expression((x + ).function(x)\n                                                   ^\nSyntaxError: invalid syntax\n```\n\n`sage.repl.preparse.preparse_calculus` needs to be modified to accommodate implicit line continuations such as inside parentheses, brackets, and braces.\n\nCC:  @strogdon @egourgoulhon @kliem @slel\n\nKeywords: line continuation symbolic expression preparser parentheses\n\nWork Issues: close #4545?\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/30953\n\n",
    "closed_at": "2021-10-04T23:44:13Z",
    "created_at": "2020-11-23T18:12:17Z",
    "labels": [
        "component: symbolics",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "Implicit line continuation in callable symbolic expression",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30953",
    "user": "https://github.com/jcamp0x2a"
}
```
Reported in[comment:19](#comment%3A19):ticket:30928

```python
sage: f(x) = (x +  
....:         1)                                                                                    
  File "<ipython-input-10-ae23cb631161>", line 1
    __tmp__=var("x"); f = symbolic_expression((x + ).function(x)
                                                   ^
SyntaxError: invalid syntax
```

`sage.repl.preparse.preparse_calculus` needs to be modified to accommodate implicit line continuations such as inside parentheses, brackets, and braces.

CC:  @strogdon @egourgoulhon @kliem @slel

Keywords: line continuation symbolic expression preparser parentheses

Work Issues: close #4545?

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/30953





---

archive/issue_comments_606537.json:
```json
{
    "body": "<a id='comment:3'></a>\nI've just been struck by a silent failure (!) version of this bug. A minimal version is\n\n```\nsage: f(x) = 1/2*(1 + x \n....:             + x^2)                                                                            \nsage: f                                                                                             \nx |--> x^2 + 1/2*x + 1/2\n```\nThis issue is present in Sage 9.1, 9.2 and 9.3.beta3.",
    "created_at": "2020-12-14T20:20:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606537",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>
I've just been struck by a silent failure (!) version of this bug. A minimal version is

```
sage: f(x) = 1/2*(1 + x 
....:             + x^2)                                                                            
sage: f                                                                                             
x |--> x^2 + 1/2*x + 1/2
```
This issue is present in Sage 9.1, 9.2 and 9.3.beta3.



---

archive/issue_comments_606538.json:
```json
{
    "body": "<a id='comment:4'></a>\nBecause this is a silent failure in an elementary operation.",
    "created_at": "2020-12-14T20:22:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606538",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>
Because this is a silent failure in an elementary operation.



---

archive/issue_events_098986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:17:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98986"
}
```



---

archive/issue_events_098987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98987"
}
```



---

archive/issue_events_098988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98988"
}
```



---

archive/issue_comments_606539.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606539",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_606540.json:
```json
{
    "body": "Changing branch from \"\" to \"public/30953\"",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606540",
    "user": "https://github.com/kliem"
}
```

Changing branch from "" to "public/30953"



---

archive/issue_comments_606541.json:
```json
{
    "body": "Changing author from \"\" to \"Jonathan Kliem\"",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606541",
    "user": "https://github.com/kliem"
}
```

Changing author from "" to "Jonathan Kliem"



---

archive/issue_comments_606542.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31951\"",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606542",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "" to "#31951"



---

archive/issue_comments_606543.json:
```json
{
    "body": "<a id='comment:8'></a>\nOnly works in the interactive shell so far and not when parsing `*.sage` files.\n\n---\nNew commits:\n|                                                                                                                                          |                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[d9c4e95](https://github.com/sagemath/sagetrac-mirror/commit/d9c4e95f8db6ad82291717e822ace7cd68971e51)|`fix completeness check for sage special syntax`|\n|[72c89b1](https://github.com/sagemath/sagetrac-mirror/commit/72c89b14e7adf88cc188e43bf9b3899c4996f2b9)|`preparse implicit line continuations correctly in interactive shell`|",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606543",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
Only works in the interactive shell so far and not when parsing `*.sage` files.

---
New commits:
|                                                                                                                                          |                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[d9c4e95](https://github.com/sagemath/sagetrac-mirror/commit/d9c4e95f8db6ad82291717e822ace7cd68971e51)|`fix completeness check for sage special syntax`|
|[72c89b1](https://github.com/sagemath/sagetrac-mirror/commit/72c89b14e7adf88cc188e43bf9b3899c4996f2b9)|`preparse implicit line continuations correctly in interactive shell`|



---

archive/issue_comments_606544.json:
```json
{
    "body": "Changing commit from \"\" to \"72c89b14e7adf88cc188e43bf9b3899c4996f2b9\"",
    "created_at": "2021-09-16T14:49:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606544",
    "user": "https://github.com/kliem"
}
```

Changing commit from "" to "72c89b14e7adf88cc188e43bf9b3899c4996f2b9"



---

archive/issue_comments_606545.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-09-21T15:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606545",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_606546.json:
```json
{
    "body": "<a id='comment:9'></a>\nI'm reworking the entire `preparse` now.\n\nThere is so much basic stuff that is just not working, e.g. line continuation for\n\n```\nsage: def foo():\n....:     a = 2312334432134.factor()\n```",
    "created_at": "2021-09-21T15:30:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606546",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>
I'm reworking the entire `preparse` now.

There is so much basic stuff that is just not working, e.g. line continuation for

```
sage: def foo():
....:     a = 2312334432134.factor()
```



---

archive/issue_comments_606547.json:
```json
{
    "body": "Changing work_issues from \"\" to \"close #4545?\"",
    "created_at": "2021-09-23T04:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606547",
    "user": "https://github.com/kliem"
}
```

Changing work_issues from "" to "close #4545?"



---

archive/issue_comments_606548.json:
```json
{
    "body": "<a id='comment:11'></a>\nIn #31951#comment:42 I suggest a simple fix for #31951 and doing the more elaborate work here.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                                          |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|\n|[9e7c480](https://github.com/sagemath/sagetrac-mirror/commit/9e7c480c43ef491f92d90c4eb2775f98b6045ba8)|`rework Sages input preparse, such that the syntax is valid after applying cleanup and token transformers`|\n|[db167dd](https://github.com/sagemath/sagetrac-mirror/commit/db167ddc3c35b6ddbb61f97c7233c2f6d18d005e)|`correct ticket number`|\n|[9a5362a](https://github.com/sagemath/sagetrac-mirror/commit/9a5362a31c63d53c16cb62c33b990e91308aa114)|`Stylistic fixes`|\n|[b465513](https://github.com/sagemath/sagetrac-mirror/commit/b4655134f36d64649b5b7676add2c986e2a02766)|`Transfer doctests`|\n|[3d86554](https://github.com/sagemath/sagetrac-mirror/commit/3d8655472435a8af62658b884d9599c60037e5f1)|`Revert deprecations`|\n|[fe36d2e](https://github.com/sagemath/sagetrac-mirror/commit/fe36d2eb8473849d87bc1b36e458d05a7db60996)|`Merge branch 'develop' into trac31951`|\n|[5a7b172](https://github.com/sagemath/sagetrac-mirror/commit/5a7b172568acad1f2ea868608139a946df73a65e)|`Remove unnecessary preparse_ipython`|\n|[bc81873](https://github.com/sagemath/sagetrac-mirror/commit/bc8187324de61ff24581d665d4254214133d96f2)|`Fix a doctest failure`|",
    "created_at": "2021-09-27T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606548",
    "user": "https://github.com/kliem"
}
```

<a id='comment:11'></a>
In #31951#comment:42 I suggest a simple fix for #31951 and doing the more elaborate work here.

---
New commits:
|                                                                                                                                          |                                                                                                          |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------|
|[9e7c480](https://github.com/sagemath/sagetrac-mirror/commit/9e7c480c43ef491f92d90c4eb2775f98b6045ba8)|`rework Sages input preparse, such that the syntax is valid after applying cleanup and token transformers`|
|[db167dd](https://github.com/sagemath/sagetrac-mirror/commit/db167ddc3c35b6ddbb61f97c7233c2f6d18d005e)|`correct ticket number`|
|[9a5362a](https://github.com/sagemath/sagetrac-mirror/commit/9a5362a31c63d53c16cb62c33b990e91308aa114)|`Stylistic fixes`|
|[b465513](https://github.com/sagemath/sagetrac-mirror/commit/b4655134f36d64649b5b7676add2c986e2a02766)|`Transfer doctests`|
|[3d86554](https://github.com/sagemath/sagetrac-mirror/commit/3d8655472435a8af62658b884d9599c60037e5f1)|`Revert deprecations`|
|[fe36d2e](https://github.com/sagemath/sagetrac-mirror/commit/fe36d2eb8473849d87bc1b36e458d05a7db60996)|`Merge branch 'develop' into trac31951`|
|[5a7b172](https://github.com/sagemath/sagetrac-mirror/commit/5a7b172568acad1f2ea868608139a946df73a65e)|`Remove unnecessary preparse_ipython`|
|[bc81873](https://github.com/sagemath/sagetrac-mirror/commit/bc8187324de61ff24581d665d4254214133d96f2)|`Fix a doctest failure`|



---

archive/issue_comments_606549.json:
```json
{
    "body": "Changing branch from \"public/30953\" to \"public/31951\"",
    "created_at": "2021-09-27T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606549",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/30953" to "public/31951"



---

archive/issue_comments_606550.json:
```json
{
    "body": "Changing commit from \"72c89b14e7adf88cc188e43bf9b3899c4996f2b9\" to \"bc8187324de61ff24581d665d4254214133d96f2\"",
    "created_at": "2021-09-27T21:51:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606550",
    "user": "https://github.com/kliem"
}
```

Changing commit from "72c89b14e7adf88cc188e43bf9b3899c4996f2b9" to "bc8187324de61ff24581d665d4254214133d96f2"



---

archive/issue_comments_606551.json:
```json
{
    "body": "Changing author from \"Jonathan Kliem\" to \"Jonathan Kliem, Kwankyu Lee\"",
    "created_at": "2021-09-27T21:52:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606551",
    "user": "https://github.com/kliem"
}
```

Changing author from "Jonathan Kliem" to "Jonathan Kliem, Kwankyu Lee"



---

archive/issue_comments_606552.json:
```json
{
    "body": "Changing branch from \"public/31951\" to \"public/30953-new\"",
    "created_at": "2021-09-27T21:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606552",
    "user": "https://github.com/kliem"
}
```

Changing branch from "public/31951" to "public/30953-new"



---

archive/issue_comments_606553.json:
```json
{
    "body": "Changing commit from \"bc8187324de61ff24581d665d4254214133d96f2\" to \"e34168c0d17ee8a340570be2d5fa9c9f5674d071\"",
    "created_at": "2021-09-27T21:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606553",
    "user": "https://github.com/kliem"
}
```

Changing commit from "bc8187324de61ff24581d665d4254214133d96f2" to "e34168c0d17ee8a340570be2d5fa9c9f5674d071"



---

archive/issue_comments_606554.json:
```json
{
    "body": "<a id='comment:13'></a>\nRenamed the branch and added to commits.\n\n---\nNew commits:\n|                                                                                                                                          |                                            |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|\n|[f7dbbcf](https://github.com/sagemath/sagetrac-mirror/commit/f7dbbcfd415a77b3c0d5a8185204c28e1bffe6d8)|`do not deprecate InterfaceShellTransformer`|\n|[e34168c](https://github.com/sagemath/sagetrac-mirror/commit/e34168c0d17ee8a340570be2d5fa9c9f5674d071)|`make doctest stable`|",
    "created_at": "2021-09-27T21:56:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606554",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>
Renamed the branch and added to commits.

---
New commits:
|                                                                                                                                          |                                            |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------|
|[f7dbbcf](https://github.com/sagemath/sagetrac-mirror/commit/f7dbbcfd415a77b3c0d5a8185204c28e1bffe6d8)|`do not deprecate InterfaceShellTransformer`|
|[e34168c](https://github.com/sagemath/sagetrac-mirror/commit/e34168c0d17ee8a340570be2d5fa9c9f5674d071)|`make doctest stable`|



---

archive/issue_comments_606555.json:
```json
{
    "body": "<a id='comment:14'></a>\nFixed in #31951.",
    "created_at": "2021-09-28T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606555",
    "user": "https://github.com/kwankyu"
}
```

<a id='comment:14'></a>
Fixed in #31951.



---

archive/issue_comments_606556.json:
```json
{
    "body": "Changing author from \"Jonathan Kliem, Kwankyu Lee\" to \"\"",
    "created_at": "2021-09-28T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606556",
    "user": "https://github.com/kwankyu"
}
```

Changing author from "Jonathan Kliem, Kwankyu Lee" to ""



---

archive/issue_events_098989.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-09-28T16:19:21Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98989"
}
```



---

archive/issue_events_098990.json:
```json
{
    "actor": "https://github.com/kwankyu",
    "created_at": "2021-09-28T16:19:21Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98990"
}
```



---

archive/issue_comments_606557.json:
```json
{
    "body": "Changing commit from \"e34168c0d17ee8a340570be2d5fa9c9f5674d071\" to \"\"",
    "created_at": "2021-09-28T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606557",
    "user": "https://github.com/kwankyu"
}
```

Changing commit from "e34168c0d17ee8a340570be2d5fa9c9f5674d071" to ""



---

archive/issue_comments_606558.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-09-28T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606558",
    "user": "https://github.com/kwankyu"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_606559.json:
```json
{
    "body": "Changing branch from \"public/30953-new\" to \"\"",
    "created_at": "2021-09-28T16:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606559",
    "user": "https://github.com/kwankyu"
}
```

Changing branch from "public/30953-new" to ""



---

archive/issue_comments_606560.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis is fixed by #31951.",
    "created_at": "2021-10-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606560",
    "user": "https://github.com/kliem"
}
```

<a id='comment:15'></a>
This is fixed by #31951.



---

archive/issue_comments_606561.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-10-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606561",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_606562.json:
```json
{
    "body": "Changing dependencies from \"#31951\" to \"\"",
    "created_at": "2021-10-01T06:31:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606562",
    "user": "https://github.com/kliem"
}
```

Changing dependencies from "#31951" to ""



---

archive/issue_comments_606563.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-10-04T23:44:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30953#issuecomment-606563",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_098991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-10-04T23:44:13Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30953",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30953#event-98991"
}
```
