# Issue 30305: Lifting doesn't work for an augmented valuation over a number field

archive/issues_030068.json:
```json
{
    "body": "The following produces an AssertionError:\n\n```\nsage: R.<T> = QQ[]\nsage: K.<zeta> = NumberField(T^2+T+1)\nsage: R.<x> = K[]\nsage: v0 = GaussValuation(R, valuations.TrivialValuation(K))\nsage: v = v0.augmentation(x^2+x+2, 1)\nsage: v.lift(v.reduce(x))\n```\n\nThe problem only seems to occur for an augmented valuation on a polynomial ring K[x] over a number field. In this case, the residue field often is a relative number field L/K, and for elements of L the method `polynomial()` does not work as expected.   \n\n**CC:**  @saraedum\n\n**Keywords:** valuations\n\n**Branch/Commit:** [36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)\n\n**Reviewer:** Stefan Wewers\n\n**Author:** Julian R\u00fcth\n\nIssue created by migration from https://trac.sagemath.org/ticket/30305\n\n",
    "closed_at": "2020-11-07T16:23:11Z",
    "created_at": "2020-08-06T20:17:03Z",
    "labels": [
        "component: commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Lifting doesn't work for an augmented valuation over a number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30305",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```
The following produces an AssertionError:

```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: v0 = GaussValuation(R, valuations.TrivialValuation(K))
sage: v = v0.augmentation(x^2+x+2, 1)
sage: v.lift(v.reduce(x))
```

The problem only seems to occur for an augmented valuation on a polynomial ring K[x] over a number field. In this case, the residue field often is a relative number field L/K, and for elements of L the method `polynomial()` does not work as expected.   

**CC:**  @saraedum

**Keywords:** valuations

**Branch/Commit:** [36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)

**Reviewer:** Stefan Wewers

**Author:** Julian Rüth

Issue created by migration from https://trac.sagemath.org/ticket/30305





---

archive/issue_comments_570004.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt seems to me that this is caused by a bug in the method `polynomial()` for elements of relative number fields:\n\n```\nsage: R.<T> = QQ[]\nsage: K.<zeta> = NumberField(T^2+T+1)\nsage: R.<x> = K[]\nsage: L.<alpha> = K.extension(x^2+x+2)\nsage: alpha.polynomial()\n1/2*x^3 + 3*x - 1/2\nsage: alpha.polynomial()(L.gen()) == alpha\nFalse\n```",
    "created_at": "2020-08-11T19:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570004",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:1'></a>
It seems to me that this is caused by a bug in the method `polynomial()` for elements of relative number fields:

```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: L.<alpha> = K.extension(x^2+x+2)
sage: alpha.polynomial()
1/2*x^3 + 3*x - 1/2
sage: alpha.polynomial()(L.gen()) == alpha
False
```



---

archive/issue_comments_570005.json:
```json
{
    "body": "**Changing author** from \"Stefan Wewers\" to \"\".",
    "created_at": "2020-08-27T22:52:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570005",
    "user": "https://github.com/saraedum"
}
```

**Changing author** from "Stefan Wewers" to "".



---

archive/issue_comments_570006.json:
```json
{
    "body": "**Branch:** [u/saraedum/30305](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/30305)",
    "created_at": "2020-08-27T23:13:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570006",
    "user": "https://github.com/saraedum"
}
```

**Branch:** [u/saraedum/30305](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/30305)



---

archive/issue_comments_570007.json:
```json
{
    "body": "**Author:** Julian R\u00fcth",
    "created_at": "2020-08-27T23:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570007",
    "user": "https://github.com/saraedum"
}
```

**Author:** Julian Rüth



---

archive/issue_comments_570008.json:
```json
{
    "body": "<a id='comment:4'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8\">a185acc</a></td><td><code>Use list instead of polynomial for relative elements</code></td></tr></table>\n",
    "created_at": "2020-08-27T23:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570008",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8">a185acc</a></td><td><code>Use list instead of polynomial for relative elements</code></td></tr></table>




---

archive/issue_comments_570009.json:
```json
{
    "body": "**Commit:** [a185acc9c95ed466c4e34ea72905249a32781cf8](https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8)",
    "created_at": "2020-08-27T23:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570009",
    "user": "https://github.com/saraedum"
}
```

**Commit:** [a185acc9c95ed466c4e34ea72905249a32781cf8](https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8)



---

archive/issue_comments_570010.json:
```json
{
    "body": "<a id='comment:5'></a>\nI have not run doctests, just tried this by monkey-patching my local [SageMath](SageMath) but this should work. Let's see what the patchbot thinks about this.",
    "created_at": "2020-08-27T23:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570010",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>
I have not run doctests, just tried this by monkey-patching my local [SageMath](SageMath) but this should work. Let's see what the patchbot thinks about this.



---

archive/issue_comments_570011.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-08-27T23:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570011",
    "user": "https://github.com/saraedum"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_570012.json:
```json
{
    "body": "**Changing commit** from \"[a185acc9c95ed466c4e34ea72905249a32781cf8](https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8)\" to \"[9906e830f9911f6c67a5cb90e5393eaec37d6a06](https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06)\".",
    "created_at": "2020-08-28T09:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570012",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a185acc9c95ed466c4e34ea72905249a32781cf8](https://github.com/sagemath/sagetrac-mirror/commit/a185acc9c95ed466c4e34ea72905249a32781cf8)" to "[9906e830f9911f6c67a5cb90e5393eaec37d6a06](https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06)".



---

archive/issue_comments_570013.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06\">9906e83</a></td><td><code>Use list instead of polynomial for relative elements</code></td></tr></table>\n",
    "created_at": "2020-08-28T09:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06">9906e83</a></td><td><code>Use list instead of polynomial for relative elements</code></td></tr></table>




---

archive/issue_comments_570014.json:
```json
{
    "body": "<a id='comment:8'></a>\nIt works. Thanks!",
    "created_at": "2020-08-28T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570014",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:8'></a>
It works. Thanks!



---

archive/issue_comments_570015.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-08-28T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570015",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_570016.json:
```json
{
    "body": "**Reviewer:** Stefan Wewers",
    "created_at": "2020-08-28T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570016",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

**Reviewer:** Stefan Wewers



---

archive/issue_comments_570017.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2020-09-05T09:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570017",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_570018.json:
```json
{
    "body": "<a id='comment:9'></a>\nSee patchbot",
    "created_at": "2020-09-05T09:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570018",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>
See patchbot



---

archive/issue_comments_570019.json:
```json
{
    "body": "**Changing commit** from \"[9906e830f9911f6c67a5cb90e5393eaec37d6a06](https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06)\" to \"[36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)\".",
    "created_at": "2020-09-05T23:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9906e830f9911f6c67a5cb90e5393eaec37d6a06](https://github.com/sagemath/sagetrac-mirror/commit/9906e830f9911f6c67a5cb90e5393eaec37d6a06)" to "[36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)".



---

archive/issue_comments_570020.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f10a0214963a61c4adaadf97bef36abc11b86e0e\">f10a021</a></td><td><code>Merge remote-tracking branch 'origin/develop' into u/saraedum/30305</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218\">36bb950</a></td><td><code>fix failing doctest</code></td></tr></table>\n",
    "created_at": "2020-09-05T23:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f10a0214963a61c4adaadf97bef36abc11b86e0e">f10a021</a></td><td><code>Merge remote-tracking branch 'origin/develop' into u/saraedum/30305</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218">36bb950</a></td><td><code>fix failing doctest</code></td></tr></table>




---

archive/issue_comments_570021.json:
```json
{
    "body": "<a id='comment:11'></a>\nSomething changed with polynomials it seems. Let's try with another example then.",
    "created_at": "2020-09-05T23:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570021",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>
Something changed with polynomials it seems. Let's try with another example then.



---

archive/issue_comments_570022.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-09-05T23:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570022",
    "user": "https://github.com/saraedum"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_570023.json:
```json
{
    "body": "<a id='comment:12'></a>\nswewers, do you want to have another look?",
    "created_at": "2020-09-12T19:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570023",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>
swewers, do you want to have another look?



---

archive/issue_comments_570024.json:
```json
{
    "body": "<a id='comment:13'></a>\nThe changes made to the doctest are fine.\n\nI am not sure what to do about the pyflakes error from the patchbot. This is related to the augmented valuation code.\nI don't even understand what 'import 'islice' from line 1803 shadowed by loop variable' means.",
    "created_at": "2020-09-13T09:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570024",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:13'></a>
The changes made to the doctest are fine.

I am not sure what to do about the pyflakes error from the patchbot. This is related to the augmented valuation code.
I don't even understand what 'import 'islice' from line 1803 shadowed by loop variable' means.



---

archive/issue_comments_570025.json:
```json
{
    "body": "<a id='comment:14'></a>\npatchbot plugins can be ignored if not clear enough",
    "created_at": "2020-09-13T14:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570025",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>
patchbot plugins can be ignored if not clear enough



---

archive/issue_comments_570026.json:
```json
{
    "body": "<a id='comment:15'></a>\nOk, then I give a positive review.",
    "created_at": "2020-09-13T15:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570026",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:15'></a>
Ok, then I give a positive review.



---

archive/issue_comments_570027.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-09-13T15:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570027",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_events_088120.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30305#event-88120"
}
```



---

archive/issue_events_088121.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30305#event-88121"
}
```



---

archive/issue_comments_570028.json:
```json
{
    "body": "**Changing branch** from \"[u/saraedum/30305](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/30305)\" to \"[36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)\".",
    "created_at": "2020-11-07T16:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-570028",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/saraedum/30305](https://github.com/sagemath/sagetrac-mirror/tree/u/saraedum/30305)" to "[36bb950ecb933a11eccd9bc8b4f0b06e88a04218](https://github.com/sagemath/sagetrac-mirror/commit/36bb950ecb933a11eccd9bc8b4f0b06e88a04218)".
