# Issue 30305: Lifting doesn't work for an augmented valuation over a number field

archive/issues_030068.json:
```json
{
    "body": "The following produces an AssertionError:\n\n```\nsage: R.<T> = QQ[]\nsage: K.<zeta> = NumberField(T^2+T+1)\nsage: R.<x> = K[]\nsage: v0 = GaussValuation(R, valuations.TrivialValuation(K))\nsage: v = v0.augmentation(x^2+x+2, 1)\nsage: v.lift(v.reduce(x))\n```\n\nThe problem only seems to occur for an augmented valuation on a polynomial ring K[x] over a number field. In this case, the residue field often is a relative number field L/K, and for elements of L the method `polynomial()` does not work as expected.   \n\nCC:  @saraedum\n\nKeywords: valuations\n\nReviewer: Stefan Wewers\n\nAuthor: Julian R\u00fcth\n\nBranch: 36bb950ecb933a11eccd9bc8b4f0b06e88a04218\n\nCommit: 36bb950ecb933a11eccd9bc8b4f0b06e88a04218\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30305\n\n",
    "closed_at": "2020-11-07T16:23:11Z",
    "created_at": "2020-08-06T20:17:03Z",
    "labels": [
        "component: commutative algebra",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Lifting doesn't work for an augmented valuation over a number field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30305",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```
The following produces an AssertionError:

```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: v0 = GaussValuation(R, valuations.TrivialValuation(K))
sage: v = v0.augmentation(x^2+x+2, 1)
sage: v.lift(v.reduce(x))
```

The problem only seems to occur for an augmented valuation on a polynomial ring K[x] over a number field. In this case, the residue field often is a relative number field L/K, and for elements of L the method `polynomial()` does not work as expected.   

CC:  @saraedum

Keywords: valuations

Reviewer: Stefan Wewers

Author: Julian RÃ¼th

Branch: 36bb950ecb933a11eccd9bc8b4f0b06e88a04218

Commit: 36bb950ecb933a11eccd9bc8b4f0b06e88a04218

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30305





---

archive/issue_comments_426882.json:
```json
{
    "body": "<a id='comment:1'></a>It seems to me that this is caused by a bug in the method `polynomial()` for elements of relative number fields:\n\n```\nsage: R.<T> = QQ[]\nsage: K.<zeta> = NumberField(T^2+T+1)\nsage: R.<x> = K[]\nsage: L.<alpha> = K.extension(x^2+x+2)\nsage: alpha.polynomial()\n1/2*x^3 + 3*x - 1/2\nsage: alpha.polynomial()(L.gen()) == alpha\nFalse\n```",
    "created_at": "2020-08-11T19:59:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426882",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:1'></a>It seems to me that this is caused by a bug in the method `polynomial()` for elements of relative number fields:

```
sage: R.<T> = QQ[]
sage: K.<zeta> = NumberField(T^2+T+1)
sage: R.<x> = K[]
sage: L.<alpha> = K.extension(x^2+x+2)
sage: alpha.polynomial()
1/2*x^3 + 3*x - 1/2
sage: alpha.polynomial()(L.gen()) == alpha
False
```



---

archive/issue_comments_426883.json:
```json
{
    "body": "<a id='comment:4'></a>New commits:",
    "created_at": "2020-08-27T23:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426883",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:4'></a>New commits:



---

archive/issue_comments_426884.json:
```json
{
    "body": "<a id='comment:5'></a>I have not run doctests, just tried this by monkey-patching my local [SageMath](SageMath) but this should work. Let's see what the patchbot thinks about this.",
    "created_at": "2020-08-27T23:16:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426884",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:5'></a>I have not run doctests, just tried this by monkey-patching my local [SageMath](SageMath) but this should work. Let's see what the patchbot thinks about this.



---

archive/issue_comments_426885.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-27T23:16:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426885",
    "user": "https://github.com/saraedum"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_426886.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-08-28T09:05:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_426887.json:
```json
{
    "body": "<a id='comment:8'></a>It works. Thanks!",
    "created_at": "2020-08-28T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426887",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:8'></a>It works. Thanks!



---

archive/issue_comments_426888.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-28T16:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426888",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_426889.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-09-05T09:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426889",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_426890.json:
```json
{
    "body": "<a id='comment:9'></a>See patchbot",
    "created_at": "2020-09-05T09:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426890",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:9'></a>See patchbot



---

archive/issue_comments_426891.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-05T23:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426891",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426892.json:
```json
{
    "body": "<a id='comment:11'></a>Something changed with polynomials it seems. Let's try with another example then.",
    "created_at": "2020-09-05T23:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426892",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:11'></a>Something changed with polynomials it seems. Let's try with another example then.



---

archive/issue_comments_426893.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-09-05T23:38:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426893",
    "user": "https://github.com/saraedum"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_426894.json:
```json
{
    "body": "<a id='comment:12'></a>swewers, do you want to have another look?",
    "created_at": "2020-09-12T19:28:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426894",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:12'></a>swewers, do you want to have another look?



---

archive/issue_comments_426895.json:
```json
{
    "body": "<a id='comment:13'></a>The changes made to the doctest are fine.\n\nI am not sure what to do about the pyflakes error from the patchbot. This is related to the augmented valuation code.\nI don't even understand what 'import 'islice' from line 1803 shadowed by loop variable' means.",
    "created_at": "2020-09-13T09:52:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426895",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:13'></a>The changes made to the doctest are fine.

I am not sure what to do about the pyflakes error from the patchbot. This is related to the augmented valuation code.
I don't even understand what 'import 'islice' from line 1803 shadowed by loop variable' means.



---

archive/issue_comments_426896.json:
```json
{
    "body": "<a id='comment:14'></a>patchbot plugins can be ignored if not clear enough",
    "created_at": "2020-09-13T14:44:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426896",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:14'></a>patchbot plugins can be ignored if not clear enough



---

archive/issue_comments_426897.json:
```json
{
    "body": "<a id='comment:15'></a>Ok, then I give a positive review.",
    "created_at": "2020-09-13T15:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426897",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

<a id='comment:15'></a>Ok, then I give a positive review.



---

archive/issue_comments_426898.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-13T15:18:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426898",
    "user": "https://trac.sagemath.org/admin/accounts/users/swewers"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_078451.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30305#event-78451"
}
```



---

archive/issue_comments_426899.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-07T16:23:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30305#issuecomment-426899",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-07T16:23:11Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30305",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30305#event-78452"
}
```
