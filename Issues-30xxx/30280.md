# Issue 30280: Immutability of Affine Connections

archive/issues_030043.json:
```json
{
    "body": "See #30261.\n\nIn this ticket, we introduce immutability to affine connections. Also, we fix the buggy `hash` function.\n\nBranch/Commit: 28431c0ca5b094e7e269125286ffba7338d43306\n\nReviewer: Matthias Koeppe\n\nAuthor: Michael Jung\n\nDependencies: #30285\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30280\n\n",
    "closed_at": "2020-08-10T18:50:10Z",
    "created_at": "2020-08-03T16:47:39Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Immutability of Affine Connections",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30280",
    "user": "https://github.com/mjungmath"
}
```
See #30261.

In this ticket, we introduce immutability to affine connections. Also, we fix the buggy `hash` function.

Branch/Commit: 28431c0ca5b094e7e269125286ffba7338d43306

Reviewer: Matthias Koeppe

Author: Michael Jung

Dependencies: #30285

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30280





---

archive/issue_comments_455321.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n+See #30261.\n \n+In this ticket, we introduce immutability to affine connections. Also, we fix the buggy `hash` function.\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-08-03T16:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455321",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
+See #30261.
 
+In this ticket, we introduce immutability to affine connections. Also, we fix the buggy `hash` function.
 
 Comment: 1
 
``````




---

archive/issue_comments_455322.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to manifolds.",
    "created_at": "2020-08-03T16:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455322",
    "user": "https://github.com/mjungmath"
}
```

Changing component from PLEASE CHANGE to manifolds.



---

archive/issue_comments_455323.json:
```json
{
    "body": "Changing type from PLEASE CHANGE to defect.",
    "created_at": "2020-08-03T16:58:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455323",
    "user": "https://github.com/mjungmath"
}
```

Changing type from PLEASE CHANGE to defect.



---

archive/issue_comments_455324.json:
```json
{
    "body": "<a id='comment:3'></a>Two things are strange here. First, the test suite starts a pickling test, that didn't happen before. Secondly, for some reason `is_immutable()` does not invoke properly. The doctests fail.\n\nI have uploaded my code. Can someone please take a short look?\n\n---\nNew commits:",
    "created_at": "2020-08-03T18:28:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455324",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:3'></a>Two things are strange here. First, the test suite starts a pickling test, that didn't happen before. Secondly, for some reason `is_immutable()` does not invoke properly. The doctests fail.

I have uploaded my code. Can someone please take a short look?

---
New commits:



---

archive/issue_comments_455325.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-03T22:22:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455325",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455326.json:
```json
{
    "body": "<a id='comment:5'></a>I have no idea what the problem was. Until this is resolved, I propose to remove the inheritance and implement the immutability manually, see last commit.",
    "created_at": "2020-08-03T22:31:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455326",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:5'></a>I have no idea what the problem was. Until this is resolved, I propose to remove the inheritance and implement the immutability manually, see last commit.



---

archive/issue_comments_455327.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-04T07:54:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455327",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_455328.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-04T08:22:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455328",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455329.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-04T15:14:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455329",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455330.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-04T16:59:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455330",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455331.json:
```json
{
    "body": "<a id='comment:12'></a>I think it would be better to rebase it, removing the reverted commit and the reverting commit.",
    "created_at": "2020-08-04T21:50:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455331",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>I think it would be better to rebase it, removing the reverted commit and the reverting commit.



---

archive/issue_comments_455332.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-08-04T22:13:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455332",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_455333.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:12 mkoeppe]:\n> I think it would be better to rebase it, removing the reverted commit and the reverting commit.\n\n\nLike this? I hope everything worked out during the rebase.",
    "created_at": "2020-08-04T22:13:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455333",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:14'></a>Replying to [comment:12 mkoeppe]:
> I think it would be better to rebase it, removing the reverted commit and the reverting commit.


Like this? I hope everything worked out during the rebase.



---

archive/issue_comments_455334.json:
```json
{
    "body": "<a id='comment:15'></a>No, apparently not...I hate rebasing...",
    "created_at": "2020-08-04T22:15:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455334",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:15'></a>No, apparently not...I hate rebasing...



---

archive/issue_comments_455335.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-04T22:18:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455335",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_455336.json:
```json
{
    "body": "<a id='comment:17'></a>Damn it...",
    "created_at": "2020-08-04T22:19:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455336",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:17'></a>Damn it...



---

archive/issue_comments_455337.json:
```json
{
    "body": "<a id='comment:18'></a>Can you fix this? Please? :-/\n\nI don't even know what went wrong during the rebase. The last commit is somehow missing, but it shouldn't.\n\nThen I messed it up by merging that last commit again. That was stupid.",
    "created_at": "2020-08-04T22:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455337",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:18'></a>Can you fix this? Please? :-/

I don't even know what went wrong during the rebase. The last commit is somehow missing, but it shouldn't.

Then I messed it up by merging that last commit again. That was stupid.



---

archive/issue_comments_455338.json:
```json
{
    "body": "<a id='comment:19'></a>Sure, let me take a look",
    "created_at": "2020-08-04T22:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455338",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>Sure, let me take a look



---

archive/issue_comments_455339.json:
```json
{
    "body": "<a id='comment:20'></a>Thank you! :)",
    "created_at": "2020-08-04T23:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455339",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:20'></a>Thank you! :)



---

archive/issue_comments_455340.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-05T00:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455340",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_455341.json:
```json
{
    "body": "<a id='comment:22'></a>New commits:",
    "created_at": "2020-08-05T00:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455341",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>New commits:



---

archive/issue_comments_455342.json:
```json
{
    "body": "<a id='comment:23'></a>Thanks! May I ask how you did it?",
    "created_at": "2020-08-05T05:56:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455342",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:23'></a>Thanks! May I ask how you did it?



---

archive/issue_comments_455343.json:
```json
{
    "body": "<a id='comment:24'></a>I got really weird merge conflicts when trying to do `git rebase -i`, so I just squashed everything on top of #30285 by doing `git trac fetch 30285 && git reset FETCH_HEAD && git commit -a`.",
    "created_at": "2020-08-05T14:19:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455343",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>I got really weird merge conflicts when trying to do `git rebase -i`, so I just squashed everything on top of #30285 by doing `git trac fetch 30285 && git reset FETCH_HEAD && git commit -a`.



---

archive/issue_events_078349.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-10T18:50:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30280#event-78349"
}
```



---

archive/issue_comments_455344.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-10T18:50:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30280",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30280#issuecomment-455344",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
