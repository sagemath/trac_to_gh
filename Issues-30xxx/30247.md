# Issue 30247: memory efficient implementation of Wiener index

archive/issues_030010.json:
```json
{
    "body": "CC:  @vipul79321 @kliem\n\nKeywords: gsoc2020\n\nWe improve the implementation of Wiener index for (weighted) (di)graphs by avoiding to compute and store into memory the full distance matrix. This way we can compute this index for larger graphs.\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30247\n\n",
    "closed_at": "2020-08-20T22:23:10Z",
    "created_at": "2020-07-29T12:48:03Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "memory efficient implementation of Wiener index",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30247",
    "user": "https://github.com/dcoudert"
}
```
CC:  @vipul79321 @kliem

Keywords: gsoc2020

We improve the implementation of Wiener index for (weighted) (di)graphs by avoiding to compute and store into memory the full distance matrix. This way we can compute this index for larger graphs.


Issue created by migration from https://trac.sagemath.org/ticket/30247





---

archive/issue_comments_426117.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-29T13:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426117",
    "user": "https://github.com/dcoudert"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_426118.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-29T13:08:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426118",
    "user": "https://github.com/dcoudert"
}
```

New commits:



---

archive/issue_comments_426119.json:
```json
{
    "body": "Without this patch\n\n```\nsage: G = graphs.Grid2dGraph(10, 10)\nsage: %time G.wiener_index()\nCPU times: user 1.66 ms, sys: 938 \u00b5s, total: 2.6 ms\nWall time: 4.58 ms\n33000\nsage: G = graphs.Grid2dGraph(20, 20)\nsage: %time G.wiener_index()\nCPU times: user 4.4 ms, sys: 162 \u00b5s, total: 4.56 ms\nWall time: 4.59 ms\n1064000\nsage: G = graphs.Grid2dGraph(50, 50)\nsage: %time G.wiener_index()\nCPU times: user 79.4 ms, sys: 8.78 ms, total: 88.2 ms\nWall time: 88.8 ms\n104125000\n```\n\nWith this patch\n\n```\nsage: G = graphs.Grid2dGraph(10, 10)\nsage: %time G.wiener_index()\nCPU times: user 1.12 ms, sys: 497 \u00b5s, total: 1.62 ms\nWall time: 3.28 ms\n33000\nsage: G = graphs.Grid2dGraph(20, 20)\nsage: %time G.wiener_index()\nCPU times: user 4.64 ms, sys: 165 \u00b5s, total: 4.8 ms\nWall time: 4.87 ms\n1064000\nsage: G = graphs.Grid2dGraph(50, 50)\nsage: %time G.wiener_index()\nCPU times: user 62.1 ms, sys: 1.66 ms, total: 63.8 ms\nWall time: 63.4 ms\n104125000\n```",
    "created_at": "2020-07-29T13:12:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426119",
    "user": "https://github.com/dcoudert"
}
```

Without this patch

```
sage: G = graphs.Grid2dGraph(10, 10)
sage: %time G.wiener_index()
CPU times: user 1.66 ms, sys: 938 µs, total: 2.6 ms
Wall time: 4.58 ms
33000
sage: G = graphs.Grid2dGraph(20, 20)
sage: %time G.wiener_index()
CPU times: user 4.4 ms, sys: 162 µs, total: 4.56 ms
Wall time: 4.59 ms
1064000
sage: G = graphs.Grid2dGraph(50, 50)
sage: %time G.wiener_index()
CPU times: user 79.4 ms, sys: 8.78 ms, total: 88.2 ms
Wall time: 88.8 ms
104125000
```

With this patch

```
sage: G = graphs.Grid2dGraph(10, 10)
sage: %time G.wiener_index()
CPU times: user 1.12 ms, sys: 497 µs, total: 1.62 ms
Wall time: 3.28 ms
33000
sage: G = graphs.Grid2dGraph(20, 20)
sage: %time G.wiener_index()
CPU times: user 4.64 ms, sys: 165 µs, total: 4.8 ms
Wall time: 4.87 ms
1064000
sage: G = graphs.Grid2dGraph(50, 50)
sage: %time G.wiener_index()
CPU times: user 62.1 ms, sys: 1.66 ms, total: 63.8 ms
Wall time: 63.4 ms
104125000
```



---

archive/issue_comments_426120.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-29T17:12:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426120",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426121.json:
```json
{
    "body": "I did a small correction for directed graphs in `wiener_index` and `average_distance`, and added a test.\n\nI let the weighted case open.",
    "created_at": "2020-07-29T17:14:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426121",
    "user": "https://github.com/dcoudert"
}
```

I did a small correction for directed graphs in `wiener_index` and `average_distance`, and added a test.

I let the weighted case open.



---

archive/issue_comments_426122.json:
```json
{
    "body": "Replying to [comment:4 dcoudert]:\n> I did a small correction for directed graphs in `wiener_index` and `average_distance`, and added a test.\n> \n> I let the weighted case open.\n\nI can work on implementing the weighted version of `wiener_index` method in `boost_graph.pyx`.",
    "created_at": "2020-07-29T18:00:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426122",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:4 dcoudert]:
> I did a small correction for directed graphs in `wiener_index` and `average_distance`, and added a test.
> 
> I let the weighted case open.

I can work on implementing the weighted version of `wiener_index` method in `boost_graph.pyx`.



---

archive/issue_comments_426123.json:
```json
{
    "body": "Feel free to do it. As you can see, it is interesting as now we can go for larger graphs and consume little memory.",
    "created_at": "2020-07-30T09:31:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426123",
    "user": "https://github.com/dcoudert"
}
```

Feel free to do it. As you can see, it is interesting as now we can go for larger graphs and consume little memory.



---

archive/issue_comments_426124.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-30T18:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426124",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426125.json:
```json
{
    "body": "* I have one question, why bellman-ford is not an option for algorithm in `wiener_index`, `shortest_path_all_pairs` etc.\n\n* Also, due to use of `correct_type` in `shortest_paths`, `johnson_shortest_paths`, `floyd_warshall_shortest_path` in `boost_graph.pyx`. There is non-uniformity in output. For e.g. (20, 20.0 etc). I propose we should open another ticket with the purpose of removing `correct_type` code (as it generally fails, discussed in comment 17 of #30188) and modify affected doc-tests.\n\nBest\n\nVipul",
    "created_at": "2020-07-30T18:29:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426125",
    "user": "https://github.com/vipul79321"
}
```

* I have one question, why bellman-ford is not an option for algorithm in `wiener_index`, `shortest_path_all_pairs` etc.

* Also, due to use of `correct_type` in `shortest_paths`, `johnson_shortest_paths`, `floyd_warshall_shortest_path` in `boost_graph.pyx`. There is non-uniformity in output. For e.g. (20, 20.0 etc). I propose we should open another ticket with the purpose of removing `correct_type` code (as it generally fails, discussed in comment 17 of #30188) and modify affected doc-tests.

Best

Vipul



---

archive/issue_comments_426126.json:
```json
{
    "body": "Changing keywords from \"\" to \"gsoc2020\".",
    "created_at": "2020-07-30T18:30:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426126",
    "user": "https://github.com/vipul79321"
}
```

Changing keywords from "" to "gsoc2020".



---

archive/issue_comments_426127.json:
```json
{
    "body": "Replying to [comment:8 gh-vipul79321]:\n> * I have one question, why bellman-ford is not an option for algorithm in `wiener_index`, `shortest_path_all_pairs` etc.\n\n\nCertainly because the usage of the list of algorithms has not been updated. No specific reason I think.\n \n> * Also, due to use of `correct_type` in `shortest_paths`, `johnson_shortest_paths`, `floyd_warshall_shortest_path` in `boost_graph.pyx`. There is non-uniformity in output. For e.g. (20, 20.0 etc). I propose we should open another ticket with the purpose of removing `correct_type` code (as it generally fails, discussed in comment 17 of #30188) and modify affected doc-tests.\n\n\nAre you sure it's always failing ? The key questions are: \n- are distances computation with boost always done on double ? \n- what's the impact on methods using the results ?\n\nIn general, it's important to be able to return the correct type, but we can also document the fact that some algorithm are able to return only double, double or int, or any type. For instance, using a pure Python code, we should be able to compute distances over rationals and more generally any type supporting addition and with a total ordering of its elements. But using boost, it's not possible.\n\n\n\nCan you update examples in boost and `generic_graph.py` to force using boost on the circuit.",
    "created_at": "2020-07-31T09:29:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426127",
    "user": "https://github.com/dcoudert"
}
```

Replying to [comment:8 gh-vipul79321]:
> * I have one question, why bellman-ford is not an option for algorithm in `wiener_index`, `shortest_path_all_pairs` etc.


Certainly because the usage of the list of algorithms has not been updated. No specific reason I think.
 
> * Also, due to use of `correct_type` in `shortest_paths`, `johnson_shortest_paths`, `floyd_warshall_shortest_path` in `boost_graph.pyx`. There is non-uniformity in output. For e.g. (20, 20.0 etc). I propose we should open another ticket with the purpose of removing `correct_type` code (as it generally fails, discussed in comment 17 of #30188) and modify affected doc-tests.


Are you sure it's always failing ? The key questions are: 
- are distances computation with boost always done on double ? 
- what's the impact on methods using the results ?

In general, it's important to be able to return the correct type, but we can also document the fact that some algorithm are able to return only double, double or int, or any type. For instance, using a pure Python code, we should be able to compute distances over rationals and more generally any type supporting addition and with a total ordering of its elements. But using boost, it's not possible.



Can you update examples in boost and `generic_graph.py` to force using boost on the circuit.



---

archive/issue_comments_426128.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-31T17:55:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426129.json:
```json
{
    "body": "Replying to [comment:10 dcoudert]:\n> Are you sure it's always failing ?\n\nIt fails for this basic scenario when edge weights are both integer and non-integer. See this for instance - \n\n```\nsage: from sage.graphs.base.boost_graph import shortest_paths\nsage: G = Graph([(0,1,2), (1,2,3.3)], weighted=True)\nsage: shortest_paths(G,0)\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-4-ca5ef018db1e> in <module>()\n----> 1 shortest_paths(G,Integer(0))\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths (build/cythonized/sage/graphs/base/boost_graph.cpp:12344)()\n    819 \n    820 \n--> 821 cpdef shortest_paths(g, start, weight_function=None, algorithm=None):\n    822     r\"\"\"\n    823     Compute the shortest paths from ``start`` to all other vertices.\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths (build/cythonized/sage/graphs/base/boost_graph.cpp:12130)()\n   1012         if result.distances[v] != sys.float_info.max:\n   1013             w = int_to_v[v]\n-> 1014             dist[w] = correct_type(result.distances[v])\n   1015             pred[w] = int_to_v[result.predecessors[v]] if result.predecessors[v] != v else None\n   1016     return (dist, pred)\n\n/home/vipul/sage/local/lib/python3.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6091)()\n    684                     mpz_set_pylong(self.value, n)\n    685                 else:\n--> 686                     raise TypeError(\"Cannot convert non-integral float to integer\")\n    687 \n    688             elif isinstance(x, pari_gen):\n\nTypeError: Cannot convert non-integral float to integer\n\n```\n\n---\n\n\n> The key questions are: \n> 1).are distances computation with boost always done on double ? \nYes. See this piece of code in `boost_interface.cpp` - \n\n```\ntypedef struct {\n    std::vector<double> distances; // An array with all distances from the starting vertex\n    std::vector<v_index> predecessors; // For each vertex v, the first vertex in a shortest\n                                  // path from the starting vertex to v.\n} result_distances;\n```\n\n> 2). what's the impact on methods using the results ?\n\n\nSorry, I didnt understand what you mean.\n\n---\n\n> In general, it's important to be able to return the correct type, but we can also document the fact that some algorithm are able to return only double, double or int, or any type. For instance, using a pure Python code, we should be able to compute distances over rationals and more generally any type supporting addition and with a total ordering of its elements. But using boost, it's not possible.\n> \n\nYeah, We can mention that in documentation, because with boost we can only get double values. \n\n\n---\n\nCurrently, I dont have any scenario where `vector[double]` will fails. For e.g., I tried it with non-rational edge weights (pi or e) and it gave ans as double approximation, which is better than nothing. See this, for example\n\n```\nsage: from sage.graphs.base.boost_graph import wiener_index\nsage: G = Graph([(0,1,pi)], weighted=True)\nsage: wiener_index(G)\n3.141592653589793\n```",
    "created_at": "2020-07-31T18:11:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426129",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:10 dcoudert]:
> Are you sure it's always failing ?

It fails for this basic scenario when edge weights are both integer and non-integer. See this for instance - 

```
sage: from sage.graphs.base.boost_graph import shortest_paths
sage: G = Graph([(0,1,2), (1,2,3.3)], weighted=True)
sage: shortest_paths(G,0)
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-4-ca5ef018db1e> in <module>()
----> 1 shortest_paths(G,Integer(0))

/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths (build/cythonized/sage/graphs/base/boost_graph.cpp:12344)()
    819 
    820 
--> 821 cpdef shortest_paths(g, start, weight_function=None, algorithm=None):
    822     r"""
    823     Compute the shortest paths from ``start`` to all other vertices.

/home/vipul/sage/local/lib/python3.7/site-packages/sage/graphs/base/boost_graph.pyx in sage.graphs.base.boost_graph.shortest_paths (build/cythonized/sage/graphs/base/boost_graph.cpp:12130)()
   1012         if result.distances[v] != sys.float_info.max:
   1013             w = int_to_v[v]
-> 1014             dist[w] = correct_type(result.distances[v])
   1015             pred[w] = int_to_v[result.predecessors[v]] if result.predecessors[v] != v else None
   1016     return (dist, pred)

/home/vipul/sage/local/lib/python3.7/site-packages/sage/rings/integer.pyx in sage.rings.integer.Integer.__init__ (build/cythonized/sage/rings/integer.c:6091)()
    684                     mpz_set_pylong(self.value, n)
    685                 else:
--> 686                     raise TypeError("Cannot convert non-integral float to integer")
    687 
    688             elif isinstance(x, pari_gen):

TypeError: Cannot convert non-integral float to integer

```

---


> The key questions are: 
> 1).are distances computation with boost always done on double ? 
Yes. See this piece of code in `boost_interface.cpp` - 

```
typedef struct {
    std::vector<double> distances; // An array with all distances from the starting vertex
    std::vector<v_index> predecessors; // For each vertex v, the first vertex in a shortest
                                  // path from the starting vertex to v.
} result_distances;
```

> 2). what's the impact on methods using the results ?


Sorry, I didnt understand what you mean.

---

> In general, it's important to be able to return the correct type, but we can also document the fact that some algorithm are able to return only double, double or int, or any type. For instance, using a pure Python code, we should be able to compute distances over rationals and more generally any type supporting addition and with a total ordering of its elements. But using boost, it's not possible.
> 

Yeah, We can mention that in documentation, because with boost we can only get double values. 


---

Currently, I dont have any scenario where `vector[double]` will fails. For e.g., I tried it with non-rational edge weights (pi or e) and it gave ans as double approximation, which is better than nothing. See this, for example

```
sage: from sage.graphs.base.boost_graph import wiener_index
sage: G = Graph([(0,1,pi)], weighted=True)
sage: wiener_index(G)
3.141592653589793
```



---

archive/issue_comments_426130.json:
```json
{
    "body": "OK. If we document properly that the returned values with boost are always double, then I'm Ok to remove the correct type stuff.\n\n> > 2). what's the impact on methods using the results ?\n  \n> \n> Sorry, I didnt understand what you mean.\n\n\nDo we have methods calling distance computation with boost and assuming that the returned value is an int ?\nIt may happen with unweighted graphs as we then assume weight 1.\n\n> Currently, I dont have any scenario where `vector[double]` will fails. For e.g., I tried it with non-rational edge weights (pi or e) and it gave ans as double approximation, which is better than nothing. See this, for example\n> \n> \n> ```\n> sage: from sage.graphs.base.boost_graph import wiener_index\n> sage: G = Graph([(0,1,pi)], weighted=True)\n> sage: wiener_index(G)\n> 3.141592653589793\n> ```\n> \n\nIn such case, the weights are converted to double. So a user expecting a results with pi must use another method. For instance:\n\n```\nsage: G = Graph([(0, 1, pi), (1, 2, e), (2, 3, sage: G = Graph([(0, 1, pi), (1, 2, e), (2, 3, sqrt(2))])\nsage: G.edges()\n[(0, 1, pi), (1, 2, e), (2, 3, sqrt(2))]\nsage: sum(G.edge_labels())\npi + sqrt(2) + e\nsage: G.weighted(True)\nsage: G.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall-Python')\n({0: {0: 0, 1: pi, 2: pi + e, 3: pi + sqrt(2) + e},\n  1: {1: 0, 0: pi, 2: e, 3: sqrt(2) + e},\n  2: {2: 0, 1: e, 3: sqrt(2), 0: pi + e},\n  3: {3: 0, 2: sqrt(2), 0: pi + sqrt(2) + e, 1: sqrt(2) + e}},\n {0: {0: None, 1: 0, 2: 1, 3: 2},\n  1: {1: None, 0: 1, 2: 1, 3: 2},\n  2: {2: None, 1: 2, 3: 2, 0: 1},\n  3: {3: None, 2: 3, 0: 1, 1: 2}})\n```\nBut so far we have an error for wiener index:\n\n```\nsage: G.wiener_index(by_weight=True, algorithm='Floyd-Warshall-Python')\n---------------------------------------------------------------------------\nTypeError                                 Traceback (most recent call last)\n<ipython-input-8-e3251b3d7fb4> in <module>()\n----> 1 G.wiener_index(by_weight=True, algorithm='Floyd-Warshall-Python')\n\n/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in wiener_index(self, by_weight, algorithm, weight_function, check_weight)\n  16853             total += sum(u.values())\n  16854 \n> 16855         return total // 2\n  16856 \n  16857     def average_distance(self, by_weight=False, algorithm=None,\n\nTypeError: unsupported operand type(s) for //: 'sage.symbolic.expression.Expression' and 'int'\n```\nso we must change from `//` to `/`",
    "created_at": "2020-08-01T09:14:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426130",
    "user": "https://github.com/dcoudert"
}
```

OK. If we document properly that the returned values with boost are always double, then I'm Ok to remove the correct type stuff.

> > 2). what's the impact on methods using the results ?
  
> 
> Sorry, I didnt understand what you mean.


Do we have methods calling distance computation with boost and assuming that the returned value is an int ?
It may happen with unweighted graphs as we then assume weight 1.

> Currently, I dont have any scenario where `vector[double]` will fails. For e.g., I tried it with non-rational edge weights (pi or e) and it gave ans as double approximation, which is better than nothing. See this, for example
> 
> 
> ```
> sage: from sage.graphs.base.boost_graph import wiener_index
> sage: G = Graph([(0,1,pi)], weighted=True)
> sage: wiener_index(G)
> 3.141592653589793
> ```
> 

In such case, the weights are converted to double. So a user expecting a results with pi must use another method. For instance:

```
sage: G = Graph([(0, 1, pi), (1, 2, e), (2, 3, sage: G = Graph([(0, 1, pi), (1, 2, e), (2, 3, sqrt(2))])
sage: G.edges()
[(0, 1, pi), (1, 2, e), (2, 3, sqrt(2))]
sage: sum(G.edge_labels())
pi + sqrt(2) + e
sage: G.weighted(True)
sage: G.shortest_path_all_pairs(by_weight=True, algorithm='Floyd-Warshall-Python')
({0: {0: 0, 1: pi, 2: pi + e, 3: pi + sqrt(2) + e},
  1: {1: 0, 0: pi, 2: e, 3: sqrt(2) + e},
  2: {2: 0, 1: e, 3: sqrt(2), 0: pi + e},
  3: {3: 0, 2: sqrt(2), 0: pi + sqrt(2) + e, 1: sqrt(2) + e}},
 {0: {0: None, 1: 0, 2: 1, 3: 2},
  1: {1: None, 0: 1, 2: 1, 3: 2},
  2: {2: None, 1: 2, 3: 2, 0: 1},
  3: {3: None, 2: 3, 0: 1, 1: 2}})
```
But so far we have an error for wiener index:

```
sage: G.wiener_index(by_weight=True, algorithm='Floyd-Warshall-Python')
---------------------------------------------------------------------------
TypeError                                 Traceback (most recent call last)
<ipython-input-8-e3251b3d7fb4> in <module>()
----> 1 G.wiener_index(by_weight=True, algorithm='Floyd-Warshall-Python')

/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/graphs/generic_graph.py in wiener_index(self, by_weight, algorithm, weight_function, check_weight)
  16853             total += sum(u.values())
  16854 
> 16855         return total // 2
  16856 
  16857     def average_distance(self, by_weight=False, algorithm=None,

TypeError: unsupported operand type(s) for //: 'sage.symbolic.expression.Expression' and 'int'
```
so we must change from `//` to `/`



---

archive/issue_comments_426131.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-03T16:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426131",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426132.json:
```json
{
    "body": "Replying to [comment:13 dcoudert]:\n> so we must change from `//` to `/`\n\n\nDone. I have tried to add a note in `wiener_index` method to mention that boost algorithms will return double version of wiener_index. Is it sufficient ?\n\nP.S - There is already an example to show this in documentation.",
    "created_at": "2020-08-03T16:57:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426132",
    "user": "https://github.com/vipul79321"
}
```

Replying to [comment:13 dcoudert]:
> so we must change from `//` to `/`


Done. I have tried to add a note in `wiener_index` method to mention that boost algorithms will return double version of wiener_index. Is it sufficient ?

P.S - There is already an example to show this in documentation.



---

archive/issue_comments_426133.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-03T17:46:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426133",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426134.json:
```json
{
    "body": "I rebased on last beta, fixed merge conflicts, and did a minor correction. We are almost done.",
    "created_at": "2020-08-03T17:47:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426134",
    "user": "https://github.com/dcoudert"
}
```

I rebased on last beta, fixed merge conflicts, and did a minor correction. We are almost done.



---

archive/issue_comments_426135.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-07T17:07:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426136.json:
```json
{
    "body": "I slightly changed the documentation to fix issue reported by the patchbot. I removed the alternative definition that we don't use.",
    "created_at": "2020-08-07T17:08:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426136",
    "user": "https://github.com/dcoudert"
}
```

I slightly changed the documentation to fix issue reported by the patchbot. I removed the alternative definition that we don't use.



---

archive/issue_comments_426137.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-08T09:27:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426137",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426138.json:
```json
{
    "body": "In order to fix the doctest errors reported by the patchbot, I improved the handling of returned value. Now we get an integer value whenever possible.",
    "created_at": "2020-08-08T09:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426138",
    "user": "https://github.com/dcoudert"
}
```

In order to fix the doctest errors reported by the patchbot, I improved the handling of returned value. Now we get an integer value whenever possible.



---

archive/issue_comments_426139.json:
```json
{
    "body": "For me this ticket is good to go, but we need an external opinion / reviewer. Thanks.",
    "created_at": "2020-08-12T15:05:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426139",
    "user": "https://github.com/dcoudert"
}
```

For me this ticket is good to go, but we need an external opinion / reviewer. Thanks.



---

archive/issue_comments_426140.json:
```json
{
    "body": "- There are some alignment issues and I would propose something like this:\n\n```diff\n-                       raise RuntimeError(\"Dijkstra algorithm does not \"\n-                                           \"work with negative weights, \"\n-                                           \"use Bellman-Ford instead\")\n+                       raise RuntimeError(\"Dijkstra algorithm does not \"\n+                                          \"work with negative weights, \"\n+                                          \"use Bellman-Ford instead\")\n```\n\n```diff\n                         raise RuntimeError(\"Dijkstra algorithm does not \"\n-                                          \"work with negative weights, \"\n+                                           \"work with negative weights, \"\n                                            \"use Bellman-Ford instead\")\n```\n\n```diff\n             WI = wiener_index(self, algorithm=algorithm,\n+                              weight_function=weight_function,\n+                              check_weight=check_weight)\n-                                weight_function=weight_function,\n-                                check_weight=check_weight)\n```\n\n```diff\n         elif (not self.is_connected()\n-            or (self.is_directed() and not self.is_strongly_connected())):\n+                or (self.is_directed() and not self.is_strongly_connected())):\n             from sage.rings.infinity import Infinity\n```\n\n```diff\n-            distances = self.shortest_path_all_pairs(by_weight=by_weight,\n-                            algorithm=algorithm, weight_function=weight_function,\n-                            check_weight=check_weight)[0]\n+            distances = self.shortest_path_all_pairs(\n+                by_weight=by_weight, algorithm=algorithm,\n+                weight_function=weight_function, check_weight=check_weight)[0]\n```\n\n- It would be nice to doctest the error messages (running Dijkstra with negative weights, Bellman-Ford with negative cycle, unknown algorithm, empty or one element graph).\n\n- Is the Wiener index really undefined for an empty or one element graph. Shouldn't it be rather `0`?\n\n- `if WI in QQ:`. This doesn't appear to be a good check to me:\n\n```\nsage: float(2.sqrt()) in QQ                                                                                                                                                         \nTrue\n```\n  So I think this will always return a rational?\n- It seems like you excluded `Dijkstra_NetworkX` from the party. Does it perform much worse than `Dijkstra_Boost`? It would also be memory efficient, if you skip the part of creating the double dictionary and then summing it up.",
    "created_at": "2020-08-13T07:52:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426140",
    "user": "https://github.com/kliem"
}
```

- There are some alignment issues and I would propose something like this:

```diff
-                       raise RuntimeError("Dijkstra algorithm does not "
-                                           "work with negative weights, "
-                                           "use Bellman-Ford instead")
+                       raise RuntimeError("Dijkstra algorithm does not "
+                                          "work with negative weights, "
+                                          "use Bellman-Ford instead")
```

```diff
                         raise RuntimeError("Dijkstra algorithm does not "
-                                          "work with negative weights, "
+                                           "work with negative weights, "
                                            "use Bellman-Ford instead")
```

```diff
             WI = wiener_index(self, algorithm=algorithm,
+                              weight_function=weight_function,
+                              check_weight=check_weight)
-                                weight_function=weight_function,
-                                check_weight=check_weight)
```

```diff
         elif (not self.is_connected()
-            or (self.is_directed() and not self.is_strongly_connected())):
+                or (self.is_directed() and not self.is_strongly_connected())):
             from sage.rings.infinity import Infinity
```

```diff
-            distances = self.shortest_path_all_pairs(by_weight=by_weight,
-                            algorithm=algorithm, weight_function=weight_function,
-                            check_weight=check_weight)[0]
+            distances = self.shortest_path_all_pairs(
+                by_weight=by_weight, algorithm=algorithm,
+                weight_function=weight_function, check_weight=check_weight)[0]
```

- It would be nice to doctest the error messages (running Dijkstra with negative weights, Bellman-Ford with negative cycle, unknown algorithm, empty or one element graph).

- Is the Wiener index really undefined for an empty or one element graph. Shouldn't it be rather `0`?

- `if WI in QQ:`. This doesn't appear to be a good check to me:

```
sage: float(2.sqrt()) in QQ                                                                                                                                                         
True
```
  So I think this will always return a rational?
- It seems like you excluded `Dijkstra_NetworkX` from the party. Does it perform much worse than `Dijkstra_Boost`? It would also be memory efficient, if you skip the part of creating the double dictionary and then summing it up.



---

archive/issue_comments_426141.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-13T09:53:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426142.json:
```json
{
    "body": "I made the changes except:\n\n- empty or one element graphs, the usual small case issue in graph theory (often not well defined). The previous choice was to let these cases undefined. For one element graphs, we could answer 0, but for the empty graph, it's certainly a user choice. \nI tried with networkx and get:\n\n```\nsage: import networkx                                                                                                                                                             \nsage: G = Graph()                                                                                                                                                                 \nsage: gnx = G.networkx_graph()                                                                                                                                                    \nsage: networkx.wiener_index(gnx)                                                                                                                                                  \n---------------------------------------------------------------------------\nNetworkXPointlessConcept                  Traceback (most recent call last)\n<ipython-input-4-0fae33b2819e> in <module>\n----> 1 networkx.wiener_index(gnx)\n\n~/sage/local/lib/python3.7/site-packages/networkx/algorithms/wiener.py in wiener_index(G, weight)\n     79     is_directed = G.is_directed()\n     80     if (is_directed and not is_strongly_connected(G)) or \\\n---> 81             (not is_directed and not is_connected(G)):\n     82         return float('inf')\n     83     total = sum(chaini(p.values() for v, p in spl(G, weight=weight)))\n\n</Users/dcoudert/sage/local/lib/python3.7/site-packages/decorator.py:decorator-gen-299> in is_connected(G)\n\n~/sage/local/lib/python3.7/site-packages/networkx/utils/decorators.py in _not_implemented_for(not_implement_for_func, *args, **kwargs)\n     80             raise nx.NetworkXNotImplemented(msg)\n     81         else:\n---> 82             return not_implement_for_func(*args, **kwargs)\n     83     return _not_implemented_for\n     84 \n\n~/sage/local/lib/python3.7/site-packages/networkx/algorithms/components/connected.py in is_connected(G)\n    145     if len(G) == 0:\n    146         raise nx.NetworkXPointlessConcept('Connectivity is undefined ',\n--> 147                                           'for the null graph.')\n    148     return sum(1 for node in _plain_bfs(G, arbitrary_element(G))) == len(G)\n    149 \n\nNetworkXPointlessConcept: ('Connectivity is undefined ', 'for the null graph.')\nsage: G = Graph(1)                                                                                                                                                                \nsage: gnx = G.networkx_graph()                                                                                                                                                    \nsage: networkx.wiener_index(gnx)                                                                                                                                                  \n0.0\n```\nDo you think I should do like networkx and return 0 for one element graphs ?\n\n\n- for `if WI in QQ`, I changed to `if WI in ZZ`. Should be better.\n\n- I added `Dijkstra_NetworkX`, but I don't see how a pure Python method could be faster than a C++ one. \n\n  Actually, we have too many methods for computing shortest paths and distances and this is not well documented. Ideally, we should create a specific documentation page describing  the various methods with advantages and limitations.\n\n- for the double dictionary, it's a side effect of the fact that we have too much ways of computing distances. So for some algorithms, it's currently the only way.\n\n  A long term objective is to create a `DistancesView` hiding internal representations, and so avoiding double dictionary. The difficulty is to handle the different types of values (integer, floats, rational, etc.). It could even have a lazy mode to avoid computing distances from a vertex if never asked (again a difficulty: how / when to raise errors like negative weight cycle?).",
    "created_at": "2020-08-13T10:13:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426142",
    "user": "https://github.com/dcoudert"
}
```

I made the changes except:

- empty or one element graphs, the usual small case issue in graph theory (often not well defined). The previous choice was to let these cases undefined. For one element graphs, we could answer 0, but for the empty graph, it's certainly a user choice. 
I tried with networkx and get:

```
sage: import networkx                                                                                                                                                             
sage: G = Graph()                                                                                                                                                                 
sage: gnx = G.networkx_graph()                                                                                                                                                    
sage: networkx.wiener_index(gnx)                                                                                                                                                  
---------------------------------------------------------------------------
NetworkXPointlessConcept                  Traceback (most recent call last)
<ipython-input-4-0fae33b2819e> in <module>
----> 1 networkx.wiener_index(gnx)

~/sage/local/lib/python3.7/site-packages/networkx/algorithms/wiener.py in wiener_index(G, weight)
     79     is_directed = G.is_directed()
     80     if (is_directed and not is_strongly_connected(G)) or \
---> 81             (not is_directed and not is_connected(G)):
     82         return float('inf')
     83     total = sum(chaini(p.values() for v, p in spl(G, weight=weight)))

</Users/dcoudert/sage/local/lib/python3.7/site-packages/decorator.py:decorator-gen-299> in is_connected(G)

~/sage/local/lib/python3.7/site-packages/networkx/utils/decorators.py in _not_implemented_for(not_implement_for_func, *args, **kwargs)
     80             raise nx.NetworkXNotImplemented(msg)
     81         else:
---> 82             return not_implement_for_func(*args, **kwargs)
     83     return _not_implemented_for
     84 

~/sage/local/lib/python3.7/site-packages/networkx/algorithms/components/connected.py in is_connected(G)
    145     if len(G) == 0:
    146         raise nx.NetworkXPointlessConcept('Connectivity is undefined ',
--> 147                                           'for the null graph.')
    148     return sum(1 for node in _plain_bfs(G, arbitrary_element(G))) == len(G)
    149 

NetworkXPointlessConcept: ('Connectivity is undefined ', 'for the null graph.')
sage: G = Graph(1)                                                                                                                                                                
sage: gnx = G.networkx_graph()                                                                                                                                                    
sage: networkx.wiener_index(gnx)                                                                                                                                                  
0.0
```
Do you think I should do like networkx and return 0 for one element graphs ?


- for `if WI in QQ`, I changed to `if WI in ZZ`. Should be better.

- I added `Dijkstra_NetworkX`, but I don't see how a pure Python method could be faster than a C++ one. 

  Actually, we have too many methods for computing shortest paths and distances and this is not well documented. Ideally, we should create a specific documentation page describing  the various methods with advantages and limitations.

- for the double dictionary, it's a side effect of the fact that we have too much ways of computing distances. So for some algorithms, it's currently the only way.

  A long term objective is to create a `DistancesView` hiding internal representations, and so avoiding double dictionary. The difficulty is to handle the different types of values (integer, floats, rational, etc.). It could even have a lazy mode to avoid computing distances from a vertex if never asked (again a difficulty: how / when to raise errors like negative weight cycle?).



---

archive/issue_comments_426143.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-14T14:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426143",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426144.json:
```json
{
    "body": "I let wiener index of empty graph undefined and set the 0 the wiener index of one vertex graphs.",
    "created_at": "2020-08-14T14:08:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426144",
    "user": "https://github.com/dcoudert"
}
```

I let wiener index of empty graph undefined and set the 0 the wiener index of one vertex graphs.



---

archive/issue_comments_426145.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-14T14:17:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426145",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426146.json:
```json
{
    "body": "this last commit fix a new error appearing when using boost 1.7.3 (I have a new laptop with it). With boost 1.7.2, we don't have this error.\n\n```\nFile \"src/sage/graphs/base/boost_graph.pyx\", line 2674, in sage.graphs.base.boost_graph.wiener_index\nFailed example:\n    wiener_index(g, algorithm=\"Dijkstra\", weight_function=weight_of)\nExpected:\n    Traceback (most recent call last):\n    ...\n    RuntimeError: Dijkstra algorithm does not work with negative weights, use Bellman-Ford instead\nGot:\n    libc++abi.dylib: terminating with uncaught exception of type boost::wrapexcept<boost::negative_edge>: The graph may not contain an edge with negative weight.\n    Traceback (most recent call last):\n      File \"sage/graphs/base/boost_graph.pyx\", line 2762, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:28864)\n        sig_on()\n    RuntimeError: Aborted\n    <BLANKLINE>\n    During handling of the above exception, another exception occurred:\n    <BLANKLINE>\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 715, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1139, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.base.boost_graph.wiener_index[13]>\", line 1, in <module>\n        wiener_index(g, algorithm=\"Dijkstra\", weight_function=weight_of)\n      File \"sage/graphs/base/boost_graph.pyx\", line 2604, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:29336)\n        cpdef wiener_index(g, algorithm=None, weight_function=None, check_weight=True):\n      File \"sage/graphs/base/boost_graph.pyx\", line 2770, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:28966)\n        raise RuntimeError(msg)\n    RuntimeError: Aborted\n```",
    "created_at": "2020-08-14T14:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426146",
    "user": "https://github.com/dcoudert"
}
```

this last commit fix a new error appearing when using boost 1.7.3 (I have a new laptop with it). With boost 1.7.2, we don't have this error.

```
File "src/sage/graphs/base/boost_graph.pyx", line 2674, in sage.graphs.base.boost_graph.wiener_index
Failed example:
    wiener_index(g, algorithm="Dijkstra", weight_function=weight_of)
Expected:
    Traceback (most recent call last):
    ...
    RuntimeError: Dijkstra algorithm does not work with negative weights, use Bellman-Ford instead
Got:
    libc++abi.dylib: terminating with uncaught exception of type boost::wrapexcept<boost::negative_edge>: The graph may not contain an edge with negative weight.
    Traceback (most recent call last):
      File "sage/graphs/base/boost_graph.pyx", line 2762, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:28864)
        sig_on()
    RuntimeError: Aborted
    <BLANKLINE>
    During handling of the above exception, another exception occurred:
    <BLANKLINE>
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.base.boost_graph.wiener_index[13]>", line 1, in <module>
        wiener_index(g, algorithm="Dijkstra", weight_function=weight_of)
      File "sage/graphs/base/boost_graph.pyx", line 2604, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:29336)
        cpdef wiener_index(g, algorithm=None, weight_function=None, check_weight=True):
      File "sage/graphs/base/boost_graph.pyx", line 2770, in sage.graphs.base.boost_graph.wiener_index (build/cythonized/sage/graphs/base/boost_graph.cpp:28966)
        raise RuntimeError(msg)
    RuntimeError: Aborted
```



---

archive/issue_comments_426147.json:
```json
{
    "body": "Build error\n\n```\n[sagelib-9.2.beta8] /srv/public/kliem/sage/local/include/boost/mpl/assert.hpp:188:21: warning: unnecessary parentheses in declaration of \u2018assert_arg\u2019 [-Wparentheses]\n[sagelib-9.2.beta8]  failed ************ (Pred::************\n[sagelib-9.2.beta8]                      ^\n[sagelib-9.2.beta8] /srv/public/kliem/sage/local/include/boost/mpl/assert.hpp:193:21: warning: unnecessary parentheses in declaration of \u2018assert_not_arg\u2019 [-Wparentheses]\n[sagelib-9.2.beta8]  failed ************ (boost::mpl::not_<Pred>::************\n[sagelib-9.2.beta8]                      ^\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c: In function \u2018__pyx_f_4sage_6graphs_19distances_all_pairs_diameter_DHV\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:843:40: warning: \u2018__pyx_v_idx\u2019 may be used uninitialized in this function [-Wmaybe-uninitialized]\n[sagelib-9.2.beta8]    #define likely(x)   __builtin_expect(!!(x), 1)\n[sagelib-9.2.beta8]                                         ^\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:16252:8: note: \u2018__pyx_v_idx\u2019 was declared here\n[sagelib-9.2.beta8]  size_t __pyx_v_idx;\n[sagelib-9.2.beta8]         ^~~~~~~~~~~\n[sagelib-9.2.beta8] In file included from build/cythonized/sage/graphs/base/boost_graph.cpp:668:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In member function \u2018result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index)\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:26: error: \u2018wrapexcept\u2019 in namespace \u2018boost\u2019 does not name a template type\n[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {\n[sagelib-9.2.beta8]                           ^~~~~~~~~~\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected \u2018)\u2019 before \u2018<\u2019 token\n[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {\n[sagelib-9.2.beta8]                   ~                 ^\n[sagelib-9.2.beta8]                                     )\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected \u2018{\u2019 before \u2018<\u2019 token\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected primary-expression before \u2018<\u2019 token\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:57: error: expected primary-expression before \u2018>\u2019 token\n[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {\n[sagelib-9.2.beta8]                                                          ^\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:59: error: \u2018e\u2019 was not declared in this scope\n[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {\n[sagelib-9.2.beta8]                                                            ^\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp: In function \u2018PyObject* __pyx_f_4sage_6graphs_4base_11boost_graph_diameter_DHV(PyObject*, int, __pyx_opt_args_4sage_6graphs_4base_11boost_graph_diameter_DHV*)\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:22823:35: warning: comparison of integer expressions of different signedness: \u2018size_t\u2019 {aka \u2018long unsigned int\u2019} and \u2018int\u2019 [-Wsign-compare]\n[sagelib-9.2.beta8]    for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {\n[sagelib-9.2.beta8]                         ~~~~~~~~~~~^~~~~~~~~~~~\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp: In function \u2018PyObject* __pyx_f_4sage_6graphs_4base_11boost_graph_wiener_index(PyObject*, int, __pyx_opt_args_4sage_6graphs_4base_11boost_graph_wiener_index*)\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:28348:35: warning: comparison of integer expressions of different signedness: \u2018v_index\u2019 {aka \u2018int\u2019} and \u2018unsigned int\u2019 [-Wsign-compare]\n[sagelib-9.2.beta8]    for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_17; __pyx_t_14+=1) {\n[sagelib-9.2.beta8]                         ~~~~~~~~~~~^~~~~~~~~~~~\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:29099:46: warning: comparison of integer expressions of different signedness: \u2018v_index\u2019 {aka \u2018int\u2019} and \u2018unsigned int\u2019 [-Wsign-compare]\n[sagelib-9.2.beta8]      for (__pyx_t_35 = __pyx_t_33; __pyx_t_35 < __pyx_t_34; __pyx_t_35+=1) {\n[sagelib-9.2.beta8]                                    ~~~~~~~~~~~^~~~~~~~~~~~\n[sagelib-9.2.beta8] In file included from build/cythonized/sage/graphs/base/boost_graph.cpp:668:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In instantiation of \u2018result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index) [with OutEdgeListS = boost::vecS; VertexListS = boost::vecS; DirectedS = boost::directedS; EdgeListS = boost::vecS; EdgeProperty = boost::property<boost::edge_weight_t, double>; v_index = int]\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:11682:82:   required from here\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:243:12: warning: catching polymorphic type \u2018class boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> >\u2019 by value [-Wcatch-value=]\n[sagelib-9.2.beta8]           } catch (boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> > e) {\n[sagelib-9.2.beta8]             ^~~~~\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In instantiation of \u2018result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index) [with OutEdgeListS = boost::vecS; VertexListS = boost::vecS; DirectedS = boost::undirectedS; EdgeListS = boost::vecS; EdgeProperty = boost::property<boost::edge_weight_t, double>; v_index = int]\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:11746:82:   required from here\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:243:12: warning: catching polymorphic type \u2018class boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> >\u2019 by value [-Wcatch-value=]\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c: In function \u2018__pyx_pw_4sage_6graphs_19distances_all_pairs_9eccentricity\u2019:\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:843:40: warning: \u2018__pyx_v_idx\u2019 may be used uninitialized in this function [-Wmaybe-uninitialized]\n[sagelib-9.2.beta8]    #define likely(x)   __builtin_expect(!!(x), 1)\n[sagelib-9.2.beta8]                                         ^\n[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:12598:8: note: \u2018__pyx_v_idx\u2019 was declared here\n[sagelib-9.2.beta8]  size_t __pyx_v_idx;\n[sagelib-9.2.beta8]         ^~~~~~~~~~~\n[sagelib-9.2.beta8] gcc -pthread -shared -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -L. -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -Wl,-rpath-link,/srv/public/kliem/sage/local/lib -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -march=native -O2 -g build/temp.linux-x86_64-3.7/build/cythonized/sage/graphs/distances_all_pairs.o -L/srv/public/kliem/sage/local/lib -lgmp -lpython3.7m -o build/lib.linux-x86_64-3.7/sage/graphs/distances_all_pairs.cpython-37m-x86_64-linux-gnu.so -lpari\n```",
    "created_at": "2020-08-15T07:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426147",
    "user": "https://github.com/kliem"
}
```

Build error

```
[sagelib-9.2.beta8] /srv/public/kliem/sage/local/include/boost/mpl/assert.hpp:188:21: warning: unnecessary parentheses in declaration of ‘assert_arg’ [-Wparentheses]
[sagelib-9.2.beta8]  failed ************ (Pred::************
[sagelib-9.2.beta8]                      ^
[sagelib-9.2.beta8] /srv/public/kliem/sage/local/include/boost/mpl/assert.hpp:193:21: warning: unnecessary parentheses in declaration of ‘assert_not_arg’ [-Wparentheses]
[sagelib-9.2.beta8]  failed ************ (boost::mpl::not_<Pred>::************
[sagelib-9.2.beta8]                      ^
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c: In function ‘__pyx_f_4sage_6graphs_19distances_all_pairs_diameter_DHV’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:843:40: warning: ‘__pyx_v_idx’ may be used uninitialized in this function [-Wmaybe-uninitialized]
[sagelib-9.2.beta8]    #define likely(x)   __builtin_expect(!!(x), 1)
[sagelib-9.2.beta8]                                         ^
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:16252:8: note: ‘__pyx_v_idx’ was declared here
[sagelib-9.2.beta8]  size_t __pyx_v_idx;
[sagelib-9.2.beta8]         ^~~~~~~~~~~
[sagelib-9.2.beta8] In file included from build/cythonized/sage/graphs/base/boost_graph.cpp:668:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In member function ‘result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index)’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:26: error: ‘wrapexcept’ in namespace ‘boost’ does not name a template type
[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {
[sagelib-9.2.beta8]                           ^~~~~~~~~~
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected ‘)’ before ‘<’ token
[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {
[sagelib-9.2.beta8]                   ~                 ^
[sagelib-9.2.beta8]                                     )
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected ‘{’ before ‘<’ token
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:36: error: expected primary-expression before ‘<’ token
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:57: error: expected primary-expression before ‘>’ token
[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {
[sagelib-9.2.beta8]                                                          ^
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:245:59: error: ‘e’ was not declared in this scope
[sagelib-9.2.beta8]           } catch (boost::wrapexcept<boost::negative_edge> e) {
[sagelib-9.2.beta8]                                                            ^
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp: In function ‘PyObject* __pyx_f_4sage_6graphs_4base_11boost_graph_diameter_DHV(PyObject*, int, __pyx_opt_args_4sage_6graphs_4base_11boost_graph_diameter_DHV*)’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:22823:35: warning: comparison of integer expressions of different signedness: ‘size_t’ {aka ‘long unsigned int’} and ‘int’ [-Wsign-compare]
[sagelib-9.2.beta8]    for (__pyx_t_16 = 0; __pyx_t_16 < __pyx_t_15; __pyx_t_16+=1) {
[sagelib-9.2.beta8]                         ~~~~~~~~~~~^~~~~~~~~~~~
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp: In function ‘PyObject* __pyx_f_4sage_6graphs_4base_11boost_graph_wiener_index(PyObject*, int, __pyx_opt_args_4sage_6graphs_4base_11boost_graph_wiener_index*)’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:28348:35: warning: comparison of integer expressions of different signedness: ‘v_index’ {aka ‘int’} and ‘unsigned int’ [-Wsign-compare]
[sagelib-9.2.beta8]    for (__pyx_t_14 = 0; __pyx_t_14 < __pyx_t_17; __pyx_t_14+=1) {
[sagelib-9.2.beta8]                         ~~~~~~~~~~~^~~~~~~~~~~~
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:29099:46: warning: comparison of integer expressions of different signedness: ‘v_index’ {aka ‘int’} and ‘unsigned int’ [-Wsign-compare]
[sagelib-9.2.beta8]      for (__pyx_t_35 = __pyx_t_33; __pyx_t_35 < __pyx_t_34; __pyx_t_35+=1) {
[sagelib-9.2.beta8]                                    ~~~~~~~~~~~^~~~~~~~~~~~
[sagelib-9.2.beta8] In file included from build/cythonized/sage/graphs/base/boost_graph.cpp:668:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In instantiation of ‘result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index) [with OutEdgeListS = boost::vecS; VertexListS = boost::vecS; DirectedS = boost::directedS; EdgeListS = boost::vecS; EdgeProperty = boost::property<boost::edge_weight_t, double>; v_index = int]’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:11682:82:   required from here
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:243:12: warning: catching polymorphic type ‘class boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> >’ by value [-Wcatch-value=]
[sagelib-9.2.beta8]           } catch (boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> > e) {
[sagelib-9.2.beta8]             ^~~~~
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp: In instantiation of ‘result_distances BoostGraph<OutEdgeListS, VertexListS, DirectedS, EdgeListS, EdgeProperty>::dijkstra_shortest_paths(v_index) [with OutEdgeListS = boost::vecS; VertexListS = boost::vecS; DirectedS = boost::undirectedS; EdgeListS = boost::vecS; EdgeProperty = boost::property<boost::edge_weight_t, double>; v_index = int]’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_graph.cpp:11746:82:   required from here
[sagelib-9.2.beta8] build/cythonized/sage/graphs/base/boost_interface.cpp:243:12: warning: catching polymorphic type ‘class boost::exception_detail::clone_impl<boost::exception_detail::error_info_injector<boost::negative_edge> >’ by value [-Wcatch-value=]
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c: In function ‘__pyx_pw_4sage_6graphs_19distances_all_pairs_9eccentricity’:
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:843:40: warning: ‘__pyx_v_idx’ may be used uninitialized in this function [-Wmaybe-uninitialized]
[sagelib-9.2.beta8]    #define likely(x)   __builtin_expect(!!(x), 1)
[sagelib-9.2.beta8]                                         ^
[sagelib-9.2.beta8] build/cythonized/sage/graphs/distances_all_pairs.c:12598:8: note: ‘__pyx_v_idx’ was declared here
[sagelib-9.2.beta8]  size_t __pyx_v_idx;
[sagelib-9.2.beta8]         ^~~~~~~~~~~
[sagelib-9.2.beta8] gcc -pthread -shared -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -L. -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -Wl,-rpath-link,/srv/public/kliem/sage/local/lib -L/srv/public/kliem/sage/local/lib -Wl,-rpath,/srv/public/kliem/sage/local/lib -march=native -O2 -g build/temp.linux-x86_64-3.7/build/cythonized/sage/graphs/distances_all_pairs.o -L/srv/public/kliem/sage/local/lib -lgmp -lpython3.7m -o build/lib.linux-x86_64-3.7/sage/graphs/distances_all_pairs.cpython-37m-x86_64-linux-gnu.so -lpari
```



---

archive/issue_comments_426148.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-15T07:57:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426148",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_426149.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-15T09:26:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426149",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_426150.json:
```json
{
    "body": "This version is much simpler, avoids modifying the boost interface, and I expect more robust.",
    "created_at": "2020-08-15T09:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426150",
    "user": "https://github.com/dcoudert"
}
```

This version is much simpler, avoids modifying the boost interface, and I expect more robust.



---

archive/issue_comments_426151.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-08-15T09:28:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426151",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_426152.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-08-15T09:28:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426152",
    "user": "https://github.com/dcoudert"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_426153.json:
```json
{
    "body": "oups, wrong button ;)",
    "created_at": "2020-08-15T09:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426153",
    "user": "https://github.com/dcoudert"
}
```

oups, wrong button ;)



---

archive/issue_comments_426154.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-15T09:28:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426154",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_426155.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-18T11:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426155",
    "user": "https://github.com/vipul79321"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_426156.json:
```json
{
    "body": "Thanks for making the suggested changes. I didn't get around to finally reviewing it, but I wrote don't anything that somewhat bothered me.",
    "created_at": "2020-08-18T12:11:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426156",
    "user": "https://github.com/kliem"
}
```

Thanks for making the suggested changes. I didn't get around to finally reviewing it, but I wrote don't anything that somewhat bothered me.



---

archive/issue_comments_426157.json:
```json
{
    "body": "Thank you. Do not hesitate to add your name as reviewer.",
    "created_at": "2020-08-18T12:13:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426157",
    "user": "https://github.com/dcoudert"
}
```

Thank you. Do not hesitate to add your name as reviewer.



---

archive/issue_comments_426158.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-20T22:23:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30247#issuecomment-426158",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-20T22:23:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30247",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30247#event-78223"
}
```
