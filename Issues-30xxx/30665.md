# Issue 30665: Optimize edge iterator for graphs

archive/issues_030428.json:
```json
{
    "assignees": [],
    "body": "This ticket reorganizes and improves the iterator over edges in the graph backends.\n\nCurrently, the code is duplicated for dense and sparse graphs. Also the iterator works by creating successive lists of neighbors. Mostly, an iterator should not create lists of things.\n\nIn case of multiple edges, it might be desirable to create lists of all arcs from `u` to `v`. Otherwise we might risk segmentation faults, if messing with the graph while iterating through it.\n\nWe expose an unsorted edge iterator.\n\nBefore:\n\n```\nsage: G = Graph(loops=False, multiedges=False) \n....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                             \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n103 \u00b5s \u00b1 10.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: H = G.copy()\nsage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n268 \u00b5s \u00b1 2.43 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n\nsage: G = Graph(loops=False, multiedges=False, sparse=False) \n....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                           \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n228 \u00b5s \u00b1 40.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: H = G.copy()\nsage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n380 \u00b5s \u00b1 2.07 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n\n\nsage: G = Graph(loops=False, multiedges=True) \n....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n2.22 ms \u00b1 412 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: H = G.copy()\nsage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n2.94 ms \u00b1 51.1 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nAfter:\n\n```\nsage: G = Graph(loops=False, multiedges=False) \n....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n66.2 \u00b5s \u00b1 693 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n50.1 \u00b5s \u00b1 404 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: H = G.copy()                                                    \nsage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n244 \u00b5s \u00b1 13.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n\n\nsage: G = Graph(loops=False, multiedges=False, sparse=False) \n....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n125 \u00b5s \u00b1 597 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n112 \u00b5s \u00b1 1.22 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\nsage: H = G.copy()  \nsage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n318 \u00b5s \u00b1 44.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n\nsage: G = Graph(loops=False, multiedges=True) \n....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) \n....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) \n....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             \nsage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n1.05 ms \u00b1 3.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n1.02 ms \u00b1 40.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: H = G.copy()  \nsage: %timeit H == G                                                                                                                                                                \n2.19 ms \u00b1 28.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nKeywords: **edge iterator, graph**\n\nBranch/Commit: **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**\n\nReviewer: **David Coudert**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **graph theory**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30665_\n\n",
    "closed_at": "2020-10-31T18:07:21Z",
    "created_at": "2020-09-26T07:55:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Optimize edge iterator for graphs",
    "type": "issue",
    "updated_at": "2020-10-31T18:07:21Z",
    "url": "https://github.com/sagemath/sage/issues/30665",
    "user": "https://github.com/kliem"
}
```
This ticket reorganizes and improves the iterator over edges in the graph backends.

Currently, the code is duplicated for dense and sparse graphs. Also the iterator works by creating successive lists of neighbors. Mostly, an iterator should not create lists of things.

In case of multiple edges, it might be desirable to create lists of all arcs from `u` to `v`. Otherwise we might risk segmentation faults, if messing with the graph while iterating through it.

We expose an unsorted edge iterator.

Before:

```
sage: G = Graph(loops=False, multiedges=False) 
....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                             
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
103 µs ± 10.4 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: H = G.copy()
sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
268 µs ± 2.43 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

sage: G = Graph(loops=False, multiedges=False, sparse=False) 
....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                           
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
228 µs ± 40.5 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: H = G.copy()
sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
380 µs ± 2.07 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)


sage: G = Graph(loops=False, multiedges=True) 
....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
2.22 ms ± 412 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: H = G.copy()
sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
2.94 ms ± 51.1 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

After:

```
sage: G = Graph(loops=False, multiedges=False) 
....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
66.2 µs ± 693 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
50.1 µs ± 404 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: H = G.copy()                                                    
sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
244 µs ± 13.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)


sage: G = Graph(loops=False, multiedges=False, sparse=False) 
....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
125 µs ± 597 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
112 µs ± 1.22 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
sage: H = G.copy()  
sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
318 µs ± 44.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)

sage: G = Graph(loops=False, multiedges=True) 
....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) 
....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) 
....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             
sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
1.05 ms ± 3.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
1.02 ms ± 40.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: H = G.copy()  
sage: %timeit H == G                                                                                                                                                                
2.19 ms ± 28.5 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

Keywords: **edge iterator, graph**

Branch/Commit: **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**

Reviewer: **David Coudert**

Author: **Jonathan Kliem**

Component: **graph theory**

_Issue created by migration from https://trac.sagemath.org/ticket/30665_





---

archive/issue_events_422769.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-26T07:55:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422769"
}
```



---

archive/issue_events_422770.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-26T07:55:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graph%20theory",
    "label_color": "0000ff",
    "label_name": "c: graph theory",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422770"
}
```



---

archive/issue_events_422771.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-26T07:55:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422771"
}
```



---

archive/issue_events_422772.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-26T07:55:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422772"
}
```



---

archive/issue_comments_489566.json:
```json
{
    "body": "Branch: **[u/gh-kliem/graphs_improve_edge_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/graphs_improve_edge_iterator)**",
    "created_at": "2020-09-26T09:09:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489566",
    "user": "https://github.com/kliem"
}
```

Branch: **[u/gh-kliem/graphs_improve_edge_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/graphs_improve_edge_iterator)**



---

archive/issue_comments_489567.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8597a071a9db5920a54165f88ac5c600aa7c73c\"><code>b8597a0</code></a></td><td><code>implement next_in_neighbor_unsafe for dense graph and use it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2813ed7e44f0b8817cc66962f34748e288ea2873\"><code>2813ed7</code></a></td><td><code>copyright edit</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d7beaca31e858715e7baaaec44e7ef7a5f76c8e\"><code>7d7beac</code></a></td><td><code>document new methods</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ad9486cde5a4f7da6afe68570ec5dbb8213fdd46\"><code>ad9486c</code></a></td><td><code>fit design of dense grpah to sparse graph</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/45921caaee759728c5854de5f4c2f5f8b42128f7\"><code>45921ca</code></a></td><td><code>implement `out_neighbors_unsafe` and `in_neighbors_unsafe` for CGraphs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e58dfa9649087d2bd78880b347ca6fc02a2f35a0\"><code>e58dfa9</code></a></td><td><code>somehow working version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a140b0836503af1015c0fca1d232cd27e53abafb\"><code>a140b08</code></a></td><td><code>let next_neighbor set the arc</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2e6a311b33a9c7749e51a271630e9d9e67c3a765\"><code>2e6a311</code></a></td><td><code>somehow working version</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1f5a6405a07fba86f22bb435309fb0cea51f6f27\"><code>1f5a640</code></a></td><td><code>fix incorrect doctests; iterator_edges is only supposed to be called in the undirected case</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac\"><code>86fdd80</code></a></td><td><code>clean up</code></td></tr></table>\n",
    "created_at": "2020-09-26T09:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489567",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8597a071a9db5920a54165f88ac5c600aa7c73c"><code>b8597a0</code></a></td><td><code>implement next_in_neighbor_unsafe for dense graph and use it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2813ed7e44f0b8817cc66962f34748e288ea2873"><code>2813ed7</code></a></td><td><code>copyright edit</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d7beaca31e858715e7baaaec44e7ef7a5f76c8e"><code>7d7beac</code></a></td><td><code>document new methods</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ad9486cde5a4f7da6afe68570ec5dbb8213fdd46"><code>ad9486c</code></a></td><td><code>fit design of dense grpah to sparse graph</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/45921caaee759728c5854de5f4c2f5f8b42128f7"><code>45921ca</code></a></td><td><code>implement `out_neighbors_unsafe` and `in_neighbors_unsafe` for CGraphs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e58dfa9649087d2bd78880b347ca6fc02a2f35a0"><code>e58dfa9</code></a></td><td><code>somehow working version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a140b0836503af1015c0fca1d232cd27e53abafb"><code>a140b08</code></a></td><td><code>let next_neighbor set the arc</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2e6a311b33a9c7749e51a271630e9d9e67c3a765"><code>2e6a311</code></a></td><td><code>somehow working version</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1f5a6405a07fba86f22bb435309fb0cea51f6f27"><code>1f5a640</code></a></td><td><code>fix incorrect doctests; iterator_edges is only supposed to be called in the undirected case</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac"><code>86fdd80</code></a></td><td><code>clean up</code></td></tr></table>




---

archive/issue_comments_489568.json:
```json
{
    "body": "Commit: **[`86fdd80`](https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac)**",
    "created_at": "2020-09-26T09:10:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489568",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`86fdd80`](https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac)**



---

archive/issue_comments_489569.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nin method `next_in_neighbor_unsafe` in `dense_graph.pyx`,  instead of `for i in range(u, self.active_vertices.size)`, you could use `bitset_next(self.active_vertices, u)`.",
    "created_at": "2020-09-26T10:49:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489569",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:3" align="right">comment:3</div>

in method `next_in_neighbor_unsafe` in `dense_graph.pyx`,  instead of `for i in range(u, self.active_vertices.size)`, you could use `bitset_next(self.active_vertices, u)`.



---

archive/issue_comments_489570.json:
```json
{
    "body": "Changed commit from **[`86fdd80`](https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac)** to **[`9065935`](https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3)**",
    "created_at": "2020-09-26T13:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489570",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`86fdd80`](https://github.com/sagemath/sagetrac-mirror/commit/86fdd80d12e24f314b9fe291e7a20c033dcff3ac)** to **[`9065935`](https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3)**



---

archive/issue_comments_489571.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3a65a5c3f0302dfe719bcf81e74d71fd2e974497\"><code>3a65a5c</code></a></td><td><code>merge in multiple edges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/66ce9411ad69f8bf0de346f1f953540ff48e367b\"><code>66ce941</code></a></td><td><code>expose unsorted</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3\"><code>9065935</code></a></td><td><code>remove duplications</code></td></tr></table>\n",
    "created_at": "2020-09-26T13:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489571",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3a65a5c3f0302dfe719bcf81e74d71fd2e974497"><code>3a65a5c</code></a></td><td><code>merge in multiple edges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/66ce9411ad69f8bf0de346f1f953540ff48e367b"><code>66ce941</code></a></td><td><code>expose unsorted</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3"><code>9065935</code></a></td><td><code>remove duplications</code></td></tr></table>




---

archive/issue_comments_489572.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@dcoudert](#comment:3):\n> in method `next_in_neighbor_unsafe` in `dense_graph.pyx`,  instead of `for i in range(u, self.active_vertices.size)`, you could use `bitset_next(self.active_vertices, u)`.\n\nI'm not sure I understand.\n\nThere are a bunch of bitsets (a total of `self.active_vertices.size - u`) and I'm trying to figure out, if one of them contains `v`. I don't see, how to apply `bitset_next` in this situation.\n\ndense graphs shouldn't reimplement bitsets for their edges, but that is a different story.",
    "created_at": "2020-09-26T13:44:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489572",
    "user": "https://github.com/kliem"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@dcoudert](#comment:3):
> in method `next_in_neighbor_unsafe` in `dense_graph.pyx`,  instead of `for i in range(u, self.active_vertices.size)`, you could use `bitset_next(self.active_vertices, u)`.

I'm not sure I understand.

There are a bunch of bitsets (a total of `self.active_vertices.size - u`) and I'm trying to figure out, if one of them contains `v`. I don't see, how to apply `bitset_next` in this situation.

dense graphs shouldn't reimplement bitsets for their edges, but that is a different story.



---

archive/issue_comments_489573.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI'm just saying that we can do something like:\n\n```\ncdef size_t i = u\nwhile i != -1:\n    if self.edges[place + i * self.num_longs] & word:\n        return i\n    i = bitset_next(self.active_vertices, i)\nreturn -1\n```\nI don't know if it is faster or not for dense graphs.",
    "created_at": "2020-09-26T13:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489573",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:6" align="right">comment:6</div>

I'm just saying that we can do something like:

```
cdef size_t i = u
while i != -1:
    if self.edges[place + i * self.num_longs] & word:
        return i
    i = bitset_next(self.active_vertices, i)
return -1
```
I don't know if it is faster or not for dense graphs.



---

archive/issue_comments_489574.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nOk. Sure. It is cleaner.",
    "created_at": "2020-09-26T13:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489574",
    "user": "https://github.com/kliem"
}
```

<div id="comment:7" align="right">comment:7</div>

Ok. Sure. It is cleaner.



---

archive/issue_comments_489575.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nBtw, `bitset_next(foo, i)` will give the next element including `i`.\n\nContrary to that `next_in_neighbor_unsafe(v, u, l)` will give the next element not including `u`. The reason for this is that in sparse graphs the arcs are grouped into a couple of trees according to `u & hash_mask`. So it is much easier to obtain the next arc in the same tree. So `next_in_neighbor_unsafe` will sort the `u`s not by total order but different.\n\nI don't want `CGraph` to know how this works, so this way `CGraph` can just trust the specification to figure out, what would be the next neighbor.",
    "created_at": "2020-09-26T14:32:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489575",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

Btw, `bitset_next(foo, i)` will give the next element including `i`.

Contrary to that `next_in_neighbor_unsafe(v, u, l)` will give the next element not including `u`. The reason for this is that in sparse graphs the arcs are grouped into a couple of trees according to `u & hash_mask`. So it is much easier to obtain the next arc in the same tree. So `next_in_neighbor_unsafe` will sort the `u`s not by total order but different.

I don't want `CGraph` to know how this works, so this way `CGraph` can just trust the specification to figure out, what would be the next neighbor.



---

archive/issue_comments_489576.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor now I would leave static sparse as it is and just define `iterator_unsorted_edges = iterator_edges`.\n\nIn order to specify `next_in_neighbor_unsafe` for static sparse efficiently, one should add something like `u_index` to the signature. I don't know if there is much need for it.",
    "created_at": "2020-09-26T14:40:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489576",
    "user": "https://github.com/kliem"
}
```

<div id="comment:9" align="right">comment:9</div>

For now I would leave static sparse as it is and just define `iterator_unsorted_edges = iterator_edges`.

In order to specify `next_in_neighbor_unsafe` for static sparse efficiently, one should add something like `u_index` to the signature. I don't know if there is much need for it.



---

archive/issue_comments_489577.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2de7ce2d89ba7810398b92e1211f6bc72ea9e4f7\"><code>2de7ce2</code></a></td><td><code>switch u and v in place</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd5aa2fa8195f8473e3a4360c57d0ebd94e4cbba\"><code>bd5aa2f</code></a></td><td><code>fix for directed multiedge graphs with labels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aace5f75af9bcf108446a4c86644c37684c9bd5d\"><code>aace5f7</code></a></td><td><code>use unsorted edges to speed up equality check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea\"><code>1a85353</code></a></td><td><code>reviewers suggestion</code></td></tr></table>\n",
    "created_at": "2020-09-26T14:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489577",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2de7ce2d89ba7810398b92e1211f6bc72ea9e4f7"><code>2de7ce2</code></a></td><td><code>switch u and v in place</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd5aa2fa8195f8473e3a4360c57d0ebd94e4cbba"><code>bd5aa2f</code></a></td><td><code>fix for directed multiedge graphs with labels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aace5f75af9bcf108446a4c86644c37684c9bd5d"><code>aace5f7</code></a></td><td><code>use unsorted edges to speed up equality check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea"><code>1a85353</code></a></td><td><code>reviewers suggestion</code></td></tr></table>




---

archive/issue_comments_489578.json:
```json
{
    "body": "Changed commit from **[`9065935`](https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3)** to **[`1a85353`](https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea)**",
    "created_at": "2020-09-26T14:41:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489578",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9065935`](https://github.com/sagemath/sagetrac-mirror/commit/90659358abd6cc5f1fad387cb085a0d5f351c4c3)** to **[`1a85353`](https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea)**



---

archive/issue_comments_489579.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,3 +3,81 @@\n Currently, the code is duplicated for dense and sparse graphs. Also the iterator works by creating successive lists of neighbors. Mostly, an iterator should not create lists of things.\n \n In case of multiple edges, it might be desirable to create lists of all arcs from `u` to `v`. Otherwise we might risk segmentation faults, if messing with the graph while iterating through it.\n+\n+We expose an unsorted edge iterator.\n+\n+Before:\n+\n+```\n+sage: G = Graph(loops=False, multiedges=False) \n+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                             \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+103 \u00b5s \u00b1 10.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: H = G.copy()\n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+268 \u00b5s \u00b1 2.43 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+\n+sage: G = Graph(loops=False, multiedges=False, sparse=False) \n+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                           \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+228 \u00b5s \u00b1 40.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: H = G.copy()\n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+380 \u00b5s \u00b1 2.07 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+\n+\n+sage: G = Graph(loops=False, multiedges=True) \n+....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+2.22 ms \u00b1 412 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n+sage: H = G.copy()\n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+2.94 ms \u00b1 51.1 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n+```\n+\n+After:\n+\n+```\n+sage: G = Graph(loops=False, multiedges=False) \n+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+66.2 \u00b5s \u00b1 693 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+50.1 \u00b5s \u00b1 404 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: H = G.copy()                                                    \n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+244 \u00b5s \u00b1 13.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+\n+\n+sage: G = Graph(loops=False, multiedges=False, sparse=False) \n+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+125 \u00b5s \u00b1 597 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+112 \u00b5s \u00b1 1.22 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n+sage: H = G.copy()  \n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+318 \u00b5s \u00b1 44.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+\n+sage: G = Graph(loops=False, multiedges=True) \n+....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) \n+....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) \n+....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             \n+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n+1.05 ms \u00b1 3.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+1.02 ms \u00b1 40.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n+sage: H = G.copy()  \n+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n+2.81 ms \u00b1 725 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n+```\n``````\n",
    "created_at": "2020-09-26T14:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489579",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,3 +3,81 @@
 Currently, the code is duplicated for dense and sparse graphs. Also the iterator works by creating successive lists of neighbors. Mostly, an iterator should not create lists of things.
 
 In case of multiple edges, it might be desirable to create lists of all arcs from `u` to `v`. Otherwise we might risk segmentation faults, if messing with the graph while iterating through it.
+
+We expose an unsorted edge iterator.
+
+Before:
+
+```
+sage: G = Graph(loops=False, multiedges=False) 
+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                             
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+103 µs ± 10.4 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: H = G.copy()
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+268 µs ± 2.43 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+
+sage: G = Graph(loops=False, multiedges=False, sparse=False) 
+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                           
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+228 µs ± 40.5 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: H = G.copy()
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+380 µs ± 2.07 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+
+
+sage: G = Graph(loops=False, multiedges=True) 
+....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+2.22 ms ± 412 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
+sage: H = G.copy()
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+2.94 ms ± 51.1 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
+```
+
+After:
+
+```
+sage: G = Graph(loops=False, multiedges=False) 
+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+66.2 µs ± 693 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+50.1 µs ± 404 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: H = G.copy()                                                    
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+244 µs ± 13.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+
+
+sage: G = Graph(loops=False, multiedges=False, sparse=False) 
+....: G.add_edges([(i, (i+85)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+125 µs ± 597 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+112 µs ± 1.22 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
+sage: H = G.copy()  
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+318 µs ± 44.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+
+sage: G = Graph(loops=False, multiedges=True) 
+....: G.add_edges([(i, (i+85)%100, j) for j in range(20) for i in range(100)]) 
+....: G.add_edges([(i, (i+37)%100, j) for j in range(20) for i in range(100)]) 
+....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             
+sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
+1.05 ms ± 3.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+1.02 ms ± 40.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
+sage: H = G.copy()  
+sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
+2.81 ms ± 725 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
+```
``````




---

archive/issue_comments_489580.json:
```json
{
    "body": "Changed commit from **[`1a85353`](https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea)** to **[`4920ec8`](https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0)**",
    "created_at": "2020-09-26T15:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489580",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1a85353`](https://github.com/sagemath/sagetrac-mirror/commit/1a85353a799f43804ade03a18afc9603c773abea)** to **[`4920ec8`](https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0)**



---

archive/issue_comments_489581.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0\"><code>4920ec8</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr></table>\n",
    "created_at": "2020-09-26T15:05:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489581",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0"><code>4920ec8</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr></table>




---

archive/issue_comments_489582.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nCode uses an edge iterator to relabel or vertices for example.\n\nI documented that this is somewhat safe. This was one of my problem. In between I had segmentation faults because of this, because I was storing pointers to nodes, which were no longer valid.",
    "created_at": "2020-09-26T15:06:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489582",
    "user": "https://github.com/kliem"
}
```

<div id="comment:13" align="right">comment:13</div>

Code uses an edge iterator to relabel or vertices for example.

I documented that this is somewhat safe. This was one of my problem. In between I had segmentation faults because of this, because I was storing pointers to nodes, which were no longer valid.



---

archive/issue_events_422773.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-09-26T15:11:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422773"
}
```



---

archive/issue_comments_489583.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI pretty much happy with it for now.\n\nI even managed to reduce the overall number of lines in the code while optimizing.\n\nThere are some optimizations that were simply not necessary. The compiler will figure out case distinctions like `label` pretty good itself. If not, it usually doesn't matter for performance. I guess there are some cases, were compilers are pretty bad, but here it works all right and there is no need to duplicate code.",
    "created_at": "2020-09-26T15:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489583",
    "user": "https://github.com/kliem"
}
```

<div id="comment:14" align="right">comment:14</div>

I pretty much happy with it for now.

I even managed to reduce the overall number of lines in the code while optimizing.

There are some optimizations that were simply not necessary. The compiler will figure out case distinctions like `label` pretty good itself. If not, it usually doesn't matter for performance. I guess there are some cases, were compilers are pretty bad, but here it works all right and there is no need to duplicate code.



---

archive/issue_comments_489584.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThis is nice.\n\nYou added `unsorted` to `edge_iterator`. You could also add it to `edges` and to  `EdgesView` in `views.pyx`. We can of course let that for another ticket. We will have to check in many methods if we can benefit from this new parameter or not. Reducing the number of places where we sort is an important objective.",
    "created_at": "2020-09-26T15:48:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489584",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:15" align="right">comment:15</div>

This is nice.

You added `unsorted` to `edge_iterator`. You could also add it to `edges` and to  `EdgesView` in `views.pyx`. We can of course let that for another ticket. We will have to check in many methods if we can benefit from this new parameter or not. Reducing the number of places where we sort is an important objective.



---

archive/issue_comments_489585.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nOnce this is in you may want to check whether this also solves\nother \"edge\"-y tickets:\n\n- https://trac.sagemath.org/query?order=id&desc=1&status=!closed&summary=~edge",
    "created_at": "2020-09-26T16:11:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489585",
    "user": "https://github.com/slel"
}
```

<div id="comment:16" align="right">comment:16</div>

Once this is in you may want to check whether this also solves
other "edge"-y tickets:

- https://trac.sagemath.org/query?order=id&desc=1&status=!closed&summary=~edge



---

archive/issue_comments_489586.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nPatchbot reports doctest failures :\n\nThere is a problem in `src/sage/combinat/cluster_algebra_quiver/mutation_class.py`\naround line 520, where one iterates over edges and modify the edges at the same time (direct access to the backend).",
    "created_at": "2020-09-27T06:53:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489586",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:17" align="right">comment:17</div>

Patchbot reports doctest failures :

There is a problem in `src/sage/combinat/cluster_algebra_quiver/mutation_class.py`
around line 520, where one iterates over edges and modify the edges at the same time (direct access to the backend).



---

archive/issue_comments_489587.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d\"><code>5fc3722</code></a></td><td><code>fix wrong usage and document it</code></td></tr></table>\n",
    "created_at": "2020-09-27T17:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489587",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d"><code>5fc3722</code></a></td><td><code>fix wrong usage and document it</code></td></tr></table>




---

archive/issue_comments_489588.json:
```json
{
    "body": "Changed commit from **[`4920ec8`](https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0)** to **[`5fc3722`](https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d)**",
    "created_at": "2020-09-27T17:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489588",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4920ec8`](https://github.com/sagemath/sagetrac-mirror/commit/4920ec8452527d3cd73048af6a74976575f9c7c0)** to **[`5fc3722`](https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d)**



---

archive/issue_comments_489589.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@fchapoton](#comment:17):\n> Patchbot reports doctest failures :\n> \n> There is a problem in `src/sage/combinat/cluster_algebra_quiver/mutation_class.py`\n> around line 520, where one iterates over edges and modify the edges at the same time (direct access to the backend). \n\nThank you. That was an easy one. I think it is just wrong to modify the vertices and not specify ``vertices``. It is difficult to know, what a user wants at this point.\n\nI fixed it and documented this.\n\nIt is also kind of wrong to modify the edges while iterating, but as long as the vertices are well-defined this works and its the users problem to deal with whether new edges will appear in this run or not (unless you modify the current edge, like relabeling or deleting, then things are well-defined).",
    "created_at": "2020-09-27T17:29:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489589",
    "user": "https://github.com/kliem"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@fchapoton](#comment:17):
> Patchbot reports doctest failures :
> 
> There is a problem in `src/sage/combinat/cluster_algebra_quiver/mutation_class.py`
> around line 520, where one iterates over edges and modify the edges at the same time (direct access to the backend). 

Thank you. That was an easy one. I think it is just wrong to modify the vertices and not specify ``vertices``. It is difficult to know, what a user wants at this point.

I fixed it and documented this.

It is also kind of wrong to modify the edges while iterating, but as long as the vertices are well-defined this works and its the users problem to deal with whether new edges will appear in this run or not (unless you modify the current edge, like relabeling or deleting, then things are well-defined).



---

archive/issue_comments_489590.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nIt is generally unsafe to modify the graph while iterating over the edges.\nSi I'm not sure the proposed modification is sufficient to solve the issue",
    "created_at": "2020-09-28T09:53:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489590",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:20" align="right">comment:20</div>

It is generally unsafe to modify the graph while iterating over the edges.
Si I'm not sure the proposed modification is sufficient to solve the issue



---

archive/issue_comments_489591.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11\"><code>5e91e99</code></a></td><td><code>make iterator saver</code></td></tr></table>\n",
    "created_at": "2020-09-28T10:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489591",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11"><code>5e91e99</code></a></td><td><code>make iterator saver</code></td></tr></table>




---

archive/issue_comments_489592.json:
```json
{
    "body": "Changed commit from **[`5fc3722`](https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d)** to **[`5e91e99`](https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11)**",
    "created_at": "2020-09-28T10:04:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489592",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5fc3722`](https://github.com/sagemath/sagetrac-mirror/commit/5fc372298b06c774a61da17098b335e0eb9a018d)** to **[`5e91e99`](https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11)**



---

archive/issue_comments_489593.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@dcoudert](#comment:20):\n> It is generally unsafe to modify the graph while iterating over the edges.\n> Si I'm not sure the proposed modification is sufficient to solve the issue\n\nI agree that iterating over something while modifying it, is not a good idea usually. It is nice, if you can relabel edges or delete some of them, without getting a complete list.\n\nI added a quick check, that `v_int` is still and active vertex. This indeed was a big issue (potentially segmentation fault), but also the only issue I can think of (which doesn't mean that it is the only one). Here are my thoughts about it:\n\n`next_neighbor_unsafe` will just pick the next neighbor as long as `v_int` is an active vertex. If there are multiple arcs, they will be cached in a list, before yielding anything. This way things should be safe.\n\nHowever, if you delete an edge and then add one, it might happen that the meaning of `v_int` changes. I think, this is the users problem. You shouldn't ask for all edges out of a vertex and then along the way delete it and assume that things are fine.\n\nIf you have multiple arcs and delete them after obtaining the first arc was yield by the iterator, this is the users problem. The other arcs will still be output, but things should be safe as long as you use safe methods.\n\nIf you add/delete/modify edges, things are fine otherwise. However, it might happen that a new edge will be yield by the iterator or not (according to internal order). If you use the edge iterator to relabel edges things are fine, as long as you do not have multiple edges. (Once you have seen an edge `(1,2)`, you know that it will not be output according to internal order again.)",
    "created_at": "2020-09-28T10:21:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489593",
    "user": "https://github.com/kliem"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@dcoudert](#comment:20):
> It is generally unsafe to modify the graph while iterating over the edges.
> Si I'm not sure the proposed modification is sufficient to solve the issue

I agree that iterating over something while modifying it, is not a good idea usually. It is nice, if you can relabel edges or delete some of them, without getting a complete list.

I added a quick check, that `v_int` is still and active vertex. This indeed was a big issue (potentially segmentation fault), but also the only issue I can think of (which doesn't mean that it is the only one). Here are my thoughts about it:

`next_neighbor_unsafe` will just pick the next neighbor as long as `v_int` is an active vertex. If there are multiple arcs, they will be cached in a list, before yielding anything. This way things should be safe.

However, if you delete an edge and then add one, it might happen that the meaning of `v_int` changes. I think, this is the users problem. You shouldn't ask for all edges out of a vertex and then along the way delete it and assume that things are fine.

If you have multiple arcs and delete them after obtaining the first arc was yield by the iterator, this is the users problem. The other arcs will still be output, but things should be safe as long as you use safe methods.

If you add/delete/modify edges, things are fine otherwise. However, it might happen that a new edge will be yield by the iterator or not (according to internal order). If you use the edge iterator to relabel edges things are fine, as long as you do not have multiple edges. (Once you have seen an edge `(1,2)`, you know that it will not be output according to internal order again.)



---

archive/issue_comments_489594.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOK, we can let it like that for the moment. This patch has only exhibit an issue in that code that is now fixed.\nIf something goes wrong, a specific bug will be raised by a user.",
    "created_at": "2020-09-28T14:12:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489594",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:23" align="right">comment:23</div>

OK, we can let it like that for the moment. This patch has only exhibit an issue in that code that is now fixed.
If something goes wrong, a specific bug will be raised by a user.



---

archive/issue_comments_489595.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nI know. It's not like this was very stable before. In my opinion the only difference is, that before the edge iterator cached all arcs from `v`, yield them all and then went on to the next vertex.\n\nNow, we only cache all arcs from `v` to `u`. If there is only one arc, there is nothing to cache.\n\nEither way, you can make the iterator behave strangely, by modifying the graph along the way. It shouldn't crash hard, this I think is important. Also the strange behavior should be somewhat foreseeable: If you add an arc `(1,2)` along the way, it would be strange if `(3,4)` appears twice now. It would be okay, if `(1,2)` pops up again at some point.\nIf you delete an edge, I think it would even be fine, if it still appears in the iterator (even so it doesn't), but all the other edges should be yield correctly regardless.",
    "created_at": "2020-09-28T14:34:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489595",
    "user": "https://github.com/kliem"
}
```

<div id="comment:24" align="right">comment:24</div>

I know. It's not like this was very stable before. In my opinion the only difference is, that before the edge iterator cached all arcs from `v`, yield them all and then went on to the next vertex.

Now, we only cache all arcs from `v` to `u`. If there is only one arc, there is nothing to cache.

Either way, you can make the iterator behave strangely, by modifying the graph along the way. It shouldn't crash hard, this I think is important. Also the strange behavior should be somewhat foreseeable: If you add an arc `(1,2)` along the way, it would be strange if `(3,4)` appears twice now. It would be okay, if `(1,2)` pops up again at some point.
If you delete an edge, I think it would even be fine, if it still appears in the iterator (even so it doesn't), but all the other edges should be yield correctly regardless.



---

archive/issue_comments_489596.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nCan you add the new `unsorted` parameter to `edges` and `EdgesView` ?",
    "created_at": "2020-09-28T14:52:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489596",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:25" align="right">comment:25</div>

Can you add the new `unsorted` parameter to `edges` and `EdgesView` ?



---

archive/issue_comments_489597.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nSure. What about naming it `sorted` instead of unsorted (not in the backend), but for `edges`, `EdgesView`, `edge_iterator`?",
    "created_at": "2020-09-28T14:56:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489597",
    "user": "https://github.com/kliem"
}
```

<div id="comment:26" align="right">comment:26</div>

Sure. What about naming it `sorted` instead of unsorted (not in the backend), but for `edges`, `EdgesView`, `edge_iterator`?



---

archive/issue_comments_489598.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nWell, `edges` and `EgesView` already have parameter `sort` to sort or not the edges. The new parameter must be sufficiently different. I'm not sure of the best choice...",
    "created_at": "2020-09-28T15:05:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489598",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:27" align="right">comment:27</div>

Well, `edges` and `EgesView` already have parameter `sort` to sort or not the edges. The new parameter must be sufficiently different. I'm not sure of the best choice...



---

archive/issue_comments_489599.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nHow about `sort_ends`?",
    "created_at": "2020-09-28T15:07:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489599",
    "user": "https://github.com/kliem"
}
```

<div id="comment:28" align="right">comment:28</div>

How about `sort_ends`?



---

archive/issue_comments_489600.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nBoth `sort_ends` and `sort_vertices` are good to me.",
    "created_at": "2020-09-28T15:09:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489600",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:29" align="right">comment:29</div>

Both `sort_ends` and `sort_vertices` are good to me.



---

archive/issue_comments_489601.json:
```json
{
    "body": "Changed commit from **[`5e91e99`](https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11)** to **[`98269fd`](https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6)**",
    "created_at": "2020-09-28T17:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489601",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5e91e99`](https://github.com/sagemath/sagetrac-mirror/commit/5e91e9976bac1db76f819bca9c3c14f704cdaa11)** to **[`98269fd`](https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6)**



---

archive/issue_comments_489602.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6\"><code>98269fd</code></a></td><td><code>expose `sort_vertices`</code></td></tr></table>\n",
    "created_at": "2020-09-28T17:41:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489602",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6"><code>98269fd</code></a></td><td><code>expose `sort_vertices`</code></td></tr></table>




---

archive/issue_comments_489603.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -50,7 +50,7 @@\n ....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \n sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n 66.2 \u00b5s \u00b1 693 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n 50.1 \u00b5s \u00b1 404 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n sage: H = G.copy()                                                    \n sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n@@ -63,7 +63,7 @@\n ....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   \n sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n 125 \u00b5s \u00b1 597 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n 112 \u00b5s \u00b1 1.22 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n sage: H = G.copy()  \n sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n@@ -75,7 +75,7 @@\n ....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             \n sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              \n 1.05 ms \u00b1 3.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 \n+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n 1.02 ms \u00b1 40.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n sage: H = G.copy()  \n sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n``````\n",
    "created_at": "2020-09-28T17:44:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489603",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -50,7 +50,7 @@
 ....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
 sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
 66.2 µs ± 693 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
 50.1 µs ± 404 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
 sage: H = G.copy()                                                    
 sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
@@ -63,7 +63,7 @@
 ....: G.add_edges([(i, (i+83)%100) for i in range(100)])                                                                                                                                                                                                                                                                                                                   
 sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
 125 µs ± 597 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
 112 µs ± 1.22 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)
 sage: H = G.copy()  
 sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
@@ -75,7 +75,7 @@
 ....: G.add_edges([(i, (i+83)%100, j) for j in range(20) for i in range(100)])                                                                                                                                                                                                                                                                                             
 sage: %timeit edges = list(G.edge_iterator())                                                                                                                                                                                                                                                                                                                              
 1.05 ms ± 3.2 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
-sage: %timeit edges = list(G.edge_iterator(unsorted=True))                                                                                                                                                                                                                                                                                                                 
+sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
 1.02 ms ± 40.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
 sage: H = G.copy()  
 sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
``````




---

archive/issue_comments_489604.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -78,6 +78,6 @@\n sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 \n 1.02 ms \u00b1 40.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n sage: H = G.copy()  \n-sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       \n-2.81 ms \u00b1 725 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n+sage: %timeit H == G                                                                                                                                                                \n+2.19 ms \u00b1 28.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n ```\n``````\n",
    "created_at": "2020-09-28T17:45:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489604",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -78,6 +78,6 @@
 sage: %timeit edges = list(G.edge_iterator(sort_vertices=False))                                                                                                                                                                                                                                                                                                                 
 1.02 ms ± 40.4 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
 sage: H = G.copy()  
-sage: %timeit H == G                                                                                                                                                                                                                                                                                                                                                       
-2.81 ms ± 725 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
+sage: %timeit H == G                                                                                                                                                                
+2.19 ms ± 28.5 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
 ```
``````




---

archive/issue_comments_489605.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nLGTM.\n\nThanks a lot.",
    "created_at": "2020-10-02T15:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489605",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:33" align="right">comment:33</div>

LGTM.

Thanks a lot.



---

archive/issue_events_422774.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-02T15:42:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422774"
}
```



---

archive/issue_events_422775.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-02T15:42:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422775"
}
```



---

archive/issue_comments_489606.json:
```json
{
    "body": "Reviewer: **David Coudert**",
    "created_at": "2020-10-02T15:42:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489606",
    "user": "https://github.com/dcoudert"
}
```

Reviewer: **David Coudert**



---

archive/issue_comments_489607.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nThank you for reviewing.",
    "created_at": "2020-10-02T18:06:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489607",
    "user": "https://github.com/kliem"
}
```

<div id="comment:34" align="right">comment:34</div>

Thank you for reviewing.



---

archive/issue_comments_489608.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nThere is a slowdown in the case that we do not access all vertices:\n\nBefore:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        \n454 \u00b5s \u00b1 266 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n```\nAfter:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        \n2.72 ms \u00b1 1.4 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```",
    "created_at": "2020-10-12T06:49:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489608",
    "user": "https://github.com/kliem"
}
```

<div id="comment:35" align="right">comment:35</div>

There is a slowdown in the case that we do not access all vertices:

Before:

```
sage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              
sage: V = list(G)                                                                                                                                                                   
sage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        
454 µs ± 266 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
```
After:

```
sage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              
sage: V = list(G)                                                                                                                                                                   
sage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        
2.72 ms ± 1.4 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```



---

archive/issue_events_422776.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T06:49:55Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422776"
}
```



---

archive/issue_events_422777.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T06:49:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422777"
}
```



---

archive/issue_comments_489609.json:
```json
{
    "body": "Changed commit from **[`98269fd`](https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6)** to **[`737e0f8`](https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8)**",
    "created_at": "2020-10-12T07:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489609",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`98269fd`](https://github.com/sagemath/sagetrac-mirror/commit/98269fd36424e58ddc76de2a204ad7ae668d6bb6)** to **[`737e0f8`](https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8)**



---

archive/issue_comments_489610.json:
```json
{
    "body": "<div id=\"comment:36\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59fb90645153eed4d1518bee393e56e1cd300973\"><code>59fb906</code></a></td><td><code>remove duplications</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4944027438df442e3c224e827169e9ecd0873bd1\"><code>4944027</code></a></td><td><code>switch u and v in place</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38c6031f821cc03f2af12d28ee4c7af7b418f5b0\"><code>38c6031</code></a></td><td><code>fix for directed multiedge graphs with labels</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dbd17efdd818dd6ff22ee27a5380aeba8051fc6f\"><code>dbd17ef</code></a></td><td><code>use unsorted edges to speed up equality check</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f7b30df7304b43e22dcda24f8b4e1d6b2468659\"><code>5f7b30d</code></a></td><td><code>reviewers suggestion</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/002ec5d147b2539f14ad00621eed4d8a8812dae2\"><code>002ec5d</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5deaa25b900ff90d287bada4a4cd014c6b70c7bf\"><code>5deaa25</code></a></td><td><code>fix wrong usage and document it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d7c27ebfe76a59b609a35f0830c54b9fbd762ef1\"><code>d7c27eb</code></a></td><td><code>make iterator saver</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/86b0ba6b515dd5dd9f882817b38ecc0e8d9fc0dc\"><code>86b0ba6</code></a></td><td><code>expose `sort_vertices`</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8\"><code>737e0f8</code></a></td><td><code>lookup in bitset is much faster</code></td></tr></table>\n",
    "created_at": "2020-10-12T07:40:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489610",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:36"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59fb90645153eed4d1518bee393e56e1cd300973"><code>59fb906</code></a></td><td><code>remove duplications</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4944027438df442e3c224e827169e9ecd0873bd1"><code>4944027</code></a></td><td><code>switch u and v in place</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38c6031f821cc03f2af12d28ee4c7af7b418f5b0"><code>38c6031</code></a></td><td><code>fix for directed multiedge graphs with labels</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dbd17efdd818dd6ff22ee27a5380aeba8051fc6f"><code>dbd17ef</code></a></td><td><code>use unsorted edges to speed up equality check</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f7b30df7304b43e22dcda24f8b4e1d6b2468659"><code>5f7b30d</code></a></td><td><code>reviewers suggestion</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/002ec5d147b2539f14ad00621eed4d8a8812dae2"><code>002ec5d</code></a></td><td><code>document that an iterator can be used to relabel edges</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5deaa25b900ff90d287bada4a4cd014c6b70c7bf"><code>5deaa25</code></a></td><td><code>fix wrong usage and document it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d7c27ebfe76a59b609a35f0830c54b9fbd762ef1"><code>d7c27eb</code></a></td><td><code>make iterator saver</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/86b0ba6b515dd5dd9f882817b38ecc0e8d9fc0dc"><code>86b0ba6</code></a></td><td><code>expose `sort_vertices`</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8"><code>737e0f8</code></a></td><td><code>lookup in bitset is much faster</code></td></tr></table>




---

archive/issue_comments_489611.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nOne simple commit:\n\nBefore this ticket:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        \n449 \u00b5s \u00b1 588 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit list(G.edge_iterator(V[:5000]))                                                                                                                                       \n4.97 ms \u00b1 4.5 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n\nsage: G = graphs.CompleteGraph(1000)                                                                                                                                                \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit list(G.edge_iterator(V[:100]))                                                                                                                                        \n20.1 ms \u00b1 24.2 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit list(G.edge_iterator(V[:800]))                                                                                                                                        \n130 ms \u00b1 1.45 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nWith this ticket:\n\n```\nsage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              \nsage: V = list(G)                                                                                                                                                                   \nsage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        \n377 \u00b5s \u00b1 2.14 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit list(G.edge_iterator(V[:500], sort_vertices=False))                                                                                                                   \n338 \u00b5s \u00b1 2.08 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\nsage: %timeit list(G.edge_iterator(V[:5000]))                                                                                                                                       \n4.3 ms \u00b1 4.44 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit list(G.edge_iterator(V[:5000], sort_vertices=False))                                                                                                                  \n3.85 ms \u00b1 2.35 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n\nsage: G = graphs.CompleteGraph(1000)                                                                                                                                                \nsage: V = list(G)                                                                                                                                                                                                                                                                                                          \nsage: %timeit list(G.edge_iterator(V[:100], sort_vertices=False))                                                                                                                   \n14.8 ms \u00b1 103 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\nsage: %timeit list(G.edge_iterator(V[:800]))                                                                                                                                        \n102 ms \u00b1 67 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit list(G.edge_iterator(V[:800], sort_vertices=False))                                                                                                                   \n92.3 ms \u00b1 1.61 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\nsage: %timeit list(G.edge_iterator())  # note that this is still slower, so we gain something by requesting only some vertices                                                                                                                                     \n110 ms \u00b1 177 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```",
    "created_at": "2020-10-12T07:48:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489611",
    "user": "https://github.com/kliem"
}
```

<div id="comment:37" align="right">comment:37</div>

One simple commit:

Before this ticket:

```
sage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              
sage: V = list(G)                                                                                                                                                                   
sage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        
449 µs ± 588 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit list(G.edge_iterator(V[:5000]))                                                                                                                                       
4.97 ms ± 4.5 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

sage: G = graphs.CompleteGraph(1000)                                                                                                                                                
sage: V = list(G)                                                                                                                                                                   
sage: %timeit list(G.edge_iterator(V[:100]))                                                                                                                                        
20.1 ms ± 24.2 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit list(G.edge_iterator(V[:800]))                                                                                                                                        
130 ms ± 1.45 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

With this ticket:

```
sage: G = graphs.Grid2dGraph(100, 100)                                                                                                                                              
sage: V = list(G)                                                                                                                                                                   
sage: %timeit list(G.edge_iterator(V[:500]))                                                                                                                                        
377 µs ± 2.14 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit list(G.edge_iterator(V[:500], sort_vertices=False))                                                                                                                   
338 µs ± 2.08 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
sage: %timeit list(G.edge_iterator(V[:5000]))                                                                                                                                       
4.3 ms ± 4.44 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit list(G.edge_iterator(V[:5000], sort_vertices=False))                                                                                                                  
3.85 ms ± 2.35 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)

sage: G = graphs.CompleteGraph(1000)                                                                                                                                                
sage: V = list(G)                                                                                                                                                                                                                                                                                                          
sage: %timeit list(G.edge_iterator(V[:100], sort_vertices=False))                                                                                                                   
14.8 ms ± 103 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
sage: %timeit list(G.edge_iterator(V[:800]))                                                                                                                                        
102 ms ± 67 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit list(G.edge_iterator(V[:800], sort_vertices=False))                                                                                                                   
92.3 ms ± 1.61 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
sage: %timeit list(G.edge_iterator())  # note that this is still slower, so we gain something by requesting only some vertices                                                                                                                                     
110 ms ± 177 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```



---

archive/issue_events_422778.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T07:48:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422778"
}
```



---

archive/issue_events_422779.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-12T07:48:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422779"
}
```



---

archive/issue_comments_489612.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nI have numerous failing doctests like:\n\n```\n**********************************************************************\nFile \"src/sage/graphs/independent_sets.pyx\", line 164, in sage.graphs.independent_sets.IndependentSets.__init__\nFailed example:\n    for i in range(5):\n        check_with_subgraph_search(graphs.RandomGNP(11, .3))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.graphs.independent_sets.IndependentSets.__init__[8]>\", line 2, in <module>\n        check_with_subgraph_search(graphs.RandomGNP(Integer(11), RealNumber('.3')))\n      File \"<doctest sage.graphs.independent_sets.IndependentSets.__init__[7]>\", line 3, in check_with_subgraph_search\n        if not all(G.subgraph(l).is_independent_set() for l in IS):\n      File \"<doctest sage.graphs.independent_sets.IndependentSets.__init__[7]>\", line 3, in <genexpr>\n        if not all(G.subgraph(l).is_independent_set() for l in IS):\n      File \"/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py\", line 12589, in subgraph\n        return self._subgraph_by_adding(vertices=vertices, edges=edges,\n      File \"/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py\", line 12724, in _subgraph_by_adding\n        edges_to_keep = [e for e in self.edges(vertices=vertices, sort=False)\n      File \"/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py\", line 12724, in <listcomp>\n        edges_to_keep = [e for e in self.edges(vertices=vertices, sort=False)\n      File \"sage/graphs/views.pyx\", line 438, in __iter__ (build/cythonized/sage/graphs/views.c:3991)\n        yield from self._iter_unsorted(vertices)\n      File \"sage/graphs/views.pyx\", line 410, in _iter_unsorted (build/cythonized/sage/graphs/views.c:3607)\n        yield from self._graph._backend.iterator_edges(vertices, self._labels)\n      File \"sage/graphs/base/c_graph.pyx\", line 3683, in _iterator_edges (build/cythonized/sage/graphs/base/c_graph.cpp:25263)\n        b_vertices = FrozenBitset(foo for foo in b_vertices_2 if foo >= 0)\n      File \"sage/data_structures/bitset.pyx\", line 398, in sage.data_structures.bitset.FrozenBitset.__init__ (build/cythonized/sage/data_structures/bitset.c:2753)\n        raise ValueError(\"Bitsets must not be empty\")\n    ValueError: Bitsets must not be empty\n**********************************************************************\nFile \"src/sage/graphs/views.pyx\", line 209, in sage.graphs.views.EdgesView\nFailed example:\n    E = EdgesView(G, vertices=[0, 3], labels=False, sort=True); E\nExpected:\n    []\nGot:\n    <repr(<sage.graphs.views.EdgesView at 0x15bfdef40>) failed: ValueError: Bitsets must not be empty>\n```",
    "created_at": "2020-10-12T09:03:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489612",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:38" align="right">comment:38</div>

I have numerous failing doctests like:

```
**********************************************************************
File "src/sage/graphs/independent_sets.pyx", line 164, in sage.graphs.independent_sets.IndependentSets.__init__
Failed example:
    for i in range(5):
        check_with_subgraph_search(graphs.RandomGNP(11, .3))
Exception raised:
    Traceback (most recent call last):
      File "/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.graphs.independent_sets.IndependentSets.__init__[8]>", line 2, in <module>
        check_with_subgraph_search(graphs.RandomGNP(Integer(11), RealNumber('.3')))
      File "<doctest sage.graphs.independent_sets.IndependentSets.__init__[7]>", line 3, in check_with_subgraph_search
        if not all(G.subgraph(l).is_independent_set() for l in IS):
      File "<doctest sage.graphs.independent_sets.IndependentSets.__init__[7]>", line 3, in <genexpr>
        if not all(G.subgraph(l).is_independent_set() for l in IS):
      File "/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py", line 12589, in subgraph
        return self._subgraph_by_adding(vertices=vertices, edges=edges,
      File "/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py", line 12724, in _subgraph_by_adding
        edges_to_keep = [e for e in self.edges(vertices=vertices, sort=False)
      File "/Users/dcoudert/sage/local/lib/python3.8/site-packages/sage/graphs/generic_graph.py", line 12724, in <listcomp>
        edges_to_keep = [e for e in self.edges(vertices=vertices, sort=False)
      File "sage/graphs/views.pyx", line 438, in __iter__ (build/cythonized/sage/graphs/views.c:3991)
        yield from self._iter_unsorted(vertices)
      File "sage/graphs/views.pyx", line 410, in _iter_unsorted (build/cythonized/sage/graphs/views.c:3607)
        yield from self._graph._backend.iterator_edges(vertices, self._labels)
      File "sage/graphs/base/c_graph.pyx", line 3683, in _iterator_edges (build/cythonized/sage/graphs/base/c_graph.cpp:25263)
        b_vertices = FrozenBitset(foo for foo in b_vertices_2 if foo >= 0)
      File "sage/data_structures/bitset.pyx", line 398, in sage.data_structures.bitset.FrozenBitset.__init__ (build/cythonized/sage/data_structures/bitset.c:2753)
        raise ValueError("Bitsets must not be empty")
    ValueError: Bitsets must not be empty
**********************************************************************
File "src/sage/graphs/views.pyx", line 209, in sage.graphs.views.EdgesView
Failed example:
    E = EdgesView(G, vertices=[0, 3], labels=False, sort=True); E
Expected:
    []
Got:
    <repr(<sage.graphs.views.EdgesView at 0x15bfdef40>) failed: ValueError: Bitsets must not be empty>
```



---

archive/issue_comments_489613.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec\"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>\n",
    "created_at": "2020-10-12T09:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489613",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>




---

archive/issue_comments_489614.json:
```json
{
    "body": "Changed commit from **[`737e0f8`](https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8)** to **[`07b7a8e`](https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec)**",
    "created_at": "2020-10-12T09:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489614",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`737e0f8`](https://github.com/sagemath/sagetrac-mirror/commit/737e0f8011cb417059d23202abbab9dea41051c8)** to **[`07b7a8e`](https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec)**



---

archive/issue_comments_489615.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nRight.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec\"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec\"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>\n",
    "created_at": "2020-10-12T09:19:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489615",
    "user": "https://github.com/kliem"
}
```

<div id="comment:40" align="right">comment:40</div>

Right.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec"><code>07b7a8e</code></a></td><td><code>bitset must not be empty</code></td></tr></table>




---

archive/issue_comments_489616.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nIt's much better like that.\n\nWe have the case `len(vertices) == 1`. Why not adding the case `not vertices` (empty).",
    "created_at": "2020-10-12T09:34:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489616",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:41" align="right">comment:41</div>

It's much better like that.

We have the case `len(vertices) == 1`. Why not adding the case `not vertices` (empty).



---

archive/issue_comments_489617.json:
```json
{
    "body": "Changed commit from **[`07b7a8e`](https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec)** to **[`957b4cc`](https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7)**",
    "created_at": "2020-10-12T09:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489617",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`07b7a8e`](https://github.com/sagemath/sagetrac-mirror/commit/07b7a8ea5d44447cd8b66d00d7a4485b2dd4b8ec)** to **[`957b4cc`](https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7)**



---

archive/issue_comments_489618.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7\"><code>957b4cc</code></a></td><td><code>check if vertices are empty</code></td></tr></table>\n",
    "created_at": "2020-10-12T09:45:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489618",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7"><code>957b4cc</code></a></td><td><code>check if vertices are empty</code></td></tr></table>




---

archive/issue_comments_489619.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf\"><code>b7d739f</code></a></td><td><code>check for bitset capacity</code></td></tr></table>\n",
    "created_at": "2020-10-12T15:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489619",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:43"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf"><code>b7d739f</code></a></td><td><code>check for bitset capacity</code></td></tr></table>




---

archive/issue_comments_489620.json:
```json
{
    "body": "Changed commit from **[`957b4cc`](https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7)** to **[`b7d739f`](https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf)**",
    "created_at": "2020-10-12T15:23:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489620",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`957b4cc`](https://github.com/sagemath/sagetrac-mirror/commit/957b4cc9eae331af65b64e8e83fa49d35403f4f7)** to **[`b7d739f`](https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf)**



---

archive/issue_comments_489621.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nA bug I noticed while trying to make #30753 work.",
    "created_at": "2020-10-12T15:24:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489621",
    "user": "https://github.com/kliem"
}
```

<div id="comment:44" align="right">comment:44</div>

A bug I noticed while trying to make #30753 work.



---

archive/issue_comments_489622.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nLGTM and better than previous version. Thank you.",
    "created_at": "2020-10-12T22:10:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489622",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:45" align="right">comment:45</div>

LGTM and better than previous version. Thank you.



---

archive/issue_events_422780.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-12T22:10:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422780"
}
```



---

archive/issue_events_422781.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-12T22:10:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422781"
}
```



---

archive/issue_comments_489623.json:
```json
{
    "body": "Changed commit from **[`b7d739f`](https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf)** to **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**",
    "created_at": "2020-10-14T19:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489623",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b7d739f`](https://github.com/sagemath/sagetrac-mirror/commit/b7d739fc55cfedba11be5ab9868312281772a7cf)** to **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**



---

archive/issue_events_422782.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-14T19:29:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422782"
}
```



---

archive/issue_events_422783.json:
```json
{
    "actor": "https://github.com/sagetrac-git",
    "created_at": "2020-10-14T19:29:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422783"
}
```



---

archive/issue_comments_489624.json:
```json
{
    "body": "<div id=\"comment:46\"></div>\n\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920\"><code>8beb573</code></a></td><td><code>bitset capacity is +1 to last index</code></td></tr></table>\n",
    "created_at": "2020-10-14T19:29:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489624",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:46"></div>

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920"><code>8beb573</code></a></td><td><code>bitset capacity is +1 to last index</code></td></tr></table>




---

archive/issue_comments_489625.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nTiny change. Sorry, but it was wrong before.",
    "created_at": "2020-10-14T19:40:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489625",
    "user": "https://github.com/kliem"
}
```

<div id="comment:47" align="right">comment:47</div>

Tiny change. Sorry, but it was wrong before.



---

archive/issue_comments_489626.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nLGTM.",
    "created_at": "2020-10-15T09:19:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489626",
    "user": "https://github.com/dcoudert"
}
```

<div id="comment:48" align="right">comment:48</div>

LGTM.



---

archive/issue_events_422784.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-15T09:19:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422784"
}
```



---

archive/issue_events_422785.json:
```json
{
    "actor": "https://github.com/dcoudert",
    "created_at": "2020-10-15T09:19:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422785"
}
```



---

archive/issue_events_422786.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422786"
}
```



---

archive/issue_events_422787.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422787"
}
```



---

archive/issue_events_422788.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:07:21Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422788"
}
```



---

archive/issue_events_422789.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "fa3b68ef1dd4cdb06ae73447182e6b01514d37a6",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-10-31T18:07:21Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30665#event-422789"
}
```



---

archive/issue_comments_489627.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/graphs_improve_edge_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/graphs_improve_edge_iterator)** to **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**",
    "created_at": "2020-10-31T18:07:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30665",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30665#issuecomment-489627",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/graphs_improve_edge_iterator](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/graphs_improve_edge_iterator)** to **[`8beb573`](https://github.com/sagemath/sagetrac-mirror/commit/8beb57302c92d17f4b703e53a1170aa0acd80920)**
