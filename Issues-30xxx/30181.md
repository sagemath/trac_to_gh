# Issue 30181: Immutable elements of FreeModuleTensor

archive/issues_029944.json:
```json
{
    "assignees": [],
    "body": "Currently, elements of a `FiniteRankFreeModule` and its tensor modules are mutable and therefore cannot be hashed.\n\nIn analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.\n\nIn this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.\n\nThe methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)\n\n\nCC:  @egourgoulhon @tscrim @mjungmath\n\nBranch/Commit: **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **linear algebra**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30181_\n\n",
    "closed_at": "2020-08-07T19:07:30Z",
    "created_at": "2020-07-20T18:44:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Immutable elements of FreeModuleTensor",
    "type": "issue",
    "updated_at": "2020-08-07T19:07:30Z",
    "url": "https://github.com/sagemath/sage/issues/30181",
    "user": "https://github.com/mkoeppe"
}
```
Currently, elements of a `FiniteRankFreeModule` and its tensor modules are mutable and therefore cannot be hashed.

In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.

In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.

The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)


CC:  @egourgoulhon @tscrim @mjungmath

Branch/Commit: **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**

Reviewer: **Travis Scrimshaw**

Author: **Matthias Koeppe**

Component: **linear algebra**

_Issue created by migration from https://trac.sagemath.org/ticket/30181_





---

archive/issue_events_412541.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412541"
}
```



---

archive/issue_events_412542.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412542"
}
```



---

archive/issue_events_412543.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412543"
}
```



---

archive/issue_events_412544.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412544"
}
```



---

archive/issue_comments_477962.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-30T20:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477962",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_477963.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,7 @@\n \n In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.\n \n+In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.\n \n+The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)\n+\n``````\n",
    "created_at": "2020-07-30T20:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477963",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,7 @@
 
 In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.
 
+In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.
 
+The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)
+
``````




---

archive/issue_comments_477964.json:
```json
{
    "body": "Branch: **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)**",
    "created_at": "2020-07-30T20:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477964",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)**



---

archive/issue_comments_477965.json:
```json
{
    "body": "Commit: **[`9df3d22`](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)**",
    "created_at": "2020-07-30T21:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477965",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`9df3d22`](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)**



---

archive/issue_comments_477966.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca\"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr></table>\n",
    "created_at": "2020-07-30T21:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477966",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr></table>




---

archive/issue_comments_477967.json:
```json
{
    "body": "Changed commit from **[`9df3d22`](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)** to **[`4373ea2`](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)**",
    "created_at": "2020-07-30T21:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477967",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9df3d22`](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)** to **[`4373ea2`](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)**



---

archive/issue_comments_477968.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87\"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr></table>\n",
    "created_at": "2020-07-30T21:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477968",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:4"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr></table>




---

archive/issue_events_412545.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-30T21:40:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412545"
}
```



---

archive/issue_comments_477969.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAlthough hashing is one of the motivations for this ticket, it will not be implemented on this ticket. A follow-up ticket will take care of it.",
    "created_at": "2020-07-30T21:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477969",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:6" align="right">comment:6</div>

Although hashing is one of the motivations for this ticket, it will not be implemented on this ticket. A follow-up ticket will take care of it.



---

archive/issue_comments_477970.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nI would also make those methods\n\n```\ncpdef bool is_[im]mutable(self):\n```\n\n\nIn some ways, I think this would be better as a mixin class. Alas, Cython does not have multiple inheritance...",
    "created_at": "2020-07-30T23:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477970",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:7" align="right">comment:7</div>

I would also make those methods

```
cpdef bool is_[im]mutable(self):
```


In some ways, I think this would be better as a mixin class. Alas, Cython does not have multiple inheritance...



---

archive/issue_comments_477971.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nThere is already a mixin class written in Cython, `sage.structure.mutability`, but it cannot be used for exactly this reason.",
    "created_at": "2020-07-30T23:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477971",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

There is already a mixin class written in Cython, `sage.structure.mutability`, but it cannot be used for exactly this reason.



---

archive/issue_comments_477972.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@tscrim](#comment:7):\n> I would also make those methods\n> \n> ```\n> cpdef bool is_[im]mutable(self):\n> ```\n\nYes, I'll make this change",
    "created_at": "2020-07-30T23:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477972",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@tscrim](#comment:7):
> I would also make those methods
> 
> ```
> cpdef bool is_[im]mutable(self):
> ```

Yes, I'll make this change



---

archive/issue_comments_477973.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2\"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr></table>\n",
    "created_at": "2020-07-30T23:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477973",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr></table>




---

archive/issue_comments_477974.json:
```json
{
    "body": "Changed commit from **[`4373ea2`](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)** to **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**",
    "created_at": "2020-07-30T23:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477974",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4373ea2`](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)** to **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**



---

archive/issue_comments_477975.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThank you. LGTM.\n\n(I slightly wonder if a user who really cares about speed should instead be just breaking the encapsulation here...)",
    "created_at": "2020-07-31T04:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477975",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:11" align="right">comment:11</div>

Thank you. LGTM.

(I slightly wonder if a user who really cares about speed should instead be just breaking the encapsulation here...)



---

archive/issue_comments_477976.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-07-31T04:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477976",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_412546.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-31T04:27:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412546"
}
```



---

archive/issue_events_412547.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-31T04:27:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412547"
}
```



---

archive/issue_comments_477977.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nThanks!",
    "created_at": "2020-07-31T05:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477977",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Thanks!



---

archive/issue_comments_477978.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nThank you for this very nice improvement!\n\nWhat about the name of an immutable element? Should that be immutable, too? This is not covered in this modification, but maybe it should?\n\nAs you suggested a systematic solution to #30239, it would be good to add this improvement to all modules in the `manifolds` module and to the scalar field algebra as well. The latter probably needs a new implementation, e.g. `CommutativeAlgebraElementWithMutability`.",
    "created_at": "2020-07-31T05:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477978",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:13" align="right">comment:13</div>

Thank you for this very nice improvement!

What about the name of an immutable element? Should that be immutable, too? This is not covered in this modification, but maybe it should?

As you suggested a systematic solution to #30239, it would be good to add this improvement to all modules in the `manifolds` module and to the scalar field algebra as well. The latter probably needs a new implementation, e.g. `CommutativeAlgebraElementWithMutability`.



---

archive/issue_comments_477979.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nWhat about a slighly more general approach like having a class `ElementWithMutability` and then simply\n\n```python\nclass FreeModuleTensor(ModuleElement, ElementWithMutability) \n```\n\nThis approach can also be applied to other elements. The hashablility can then be implemented via `ElementWithMutability`.\n\nThis has also the great advantage that this can be used for affine connections and bundle connections, too.",
    "created_at": "2020-07-31T06:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477979",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:14" align="right">comment:14</div>

What about a slighly more general approach like having a class `ElementWithMutability` and then simply

```python
class FreeModuleTensor(ModuleElement, ElementWithMutability) 
```

This approach can also be applied to other elements. The hashablility can then be implemented via `ElementWithMutability`.

This has also the great advantage that this can be used for affine connections and bundle connections, too.



---

archive/issue_comments_477980.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n@mjungmath Did you see [comment:8](#comment:8)?",
    "created_at": "2020-07-31T06:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477980",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:15" align="right">comment:15</div>

@mjungmath Did you see [comment:8](#comment:8)?



---

archive/issue_comments_477981.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@tscrim](#comment:15):\n> @mjungmath Did you see [comment:8](#comment:8)?\n\nOh, I see. But is implementing the same code for each kind of element really necessary?",
    "created_at": "2020-07-31T07:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477981",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@tscrim](#comment:15):
> @mjungmath Did you see [comment:8](#comment:8)?

Oh, I see. But is implementing the same code for each kind of element really necessary?



---

archive/issue_comments_477982.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mjungmath](#comment:16):\n> Replying to [@tscrim](#comment:15):\n> > @mjungmath Did you see [comment:8](#comment:8)?\n\n> Oh, I see. But is implementing the same code for each kind of element really necessary? \n\nCython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.",
    "created_at": "2020-07-31T07:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477982",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mjungmath](#comment:16):
> Replying to [@tscrim](#comment:15):
> > @mjungmath Did you see [comment:8](#comment:8)?

> Oh, I see. But is implementing the same code for each kind of element really necessary? 

Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.



---

archive/issue_comments_477983.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tscrim](#comment:17):\n> Replying to [@mjungmath](#comment:16):\n> > Replying to [@tscrim](#comment:15):\n> > > @mjungmath Did you see [comment:8](#comment:8)?\n\n> > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> \n> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\nReasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?\n\nDo you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.",
    "created_at": "2020-07-31T08:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477983",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tscrim](#comment:17):
> Replying to [@mjungmath](#comment:16):
> > Replying to [@tscrim](#comment:15):
> > > @mjungmath Did you see [comment:8](#comment:8)?

> > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> 
> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?

Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.



---

archive/issue_comments_477984.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mjungmath](#comment:18):\n> Replying to [@tscrim](#comment:17):\n> > Replying to [@mjungmath](#comment:16):\n> > > Replying to [@tscrim](#comment:15):\n> > > > @mjungmath Did you see [comment:8](#comment:8)?\n\n> > > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> > \n> > Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\n> \n> Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?\n\nPossibly, but it might suggest that you just need a better mixin class that is perhaps (a subclass of) `sage.structure.mutability`. I am not sure as you know the code better than I do. You can try experimenting and seeing what works best.\n\n> Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.\n\nPart of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.",
    "created_at": "2020-07-31T09:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477984",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mjungmath](#comment:18):
> Replying to [@tscrim](#comment:17):
> > Replying to [@mjungmath](#comment:16):
> > > Replying to [@tscrim](#comment:15):
> > > > @mjungmath Did you see [comment:8](#comment:8)?

> > > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> > 
> > Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

> 
> Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?

Possibly, but it might suggest that you just need a better mixin class that is perhaps (a subclass of) `sage.structure.mutability`. I am not sure as you know the code better than I do. You can try experimenting and seeing what works best.

> Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.

Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.



---

archive/issue_comments_477985.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@tscrim](#comment:19):\n> Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.\n\nThis is exactly the reason why I struggle, too.\n\nHowever, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.\n\nMatthias, what do you say? Would you mind to add this condition here?\n\nAnyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 \"more systematically\", as you said.",
    "created_at": "2020-07-31T10:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477985",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@tscrim](#comment:19):
> Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.

This is exactly the reason why I struggle, too.

However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.

Matthias, what do you say? Would you mind to add this condition here?

Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 "more systematically", as you said.



---

archive/issue_comments_477986.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mjungmath](#comment:20):\n> However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.\n> \n> Matthias, what do you say?\n\nI feel I don't really have a qualified opinion on this because I have not studied how you use these symbolic names in sage-manifolds. \n\nThe vectors from `sage.modules` do not support renaming, so there's no concern regarding compatibility here.\n\n```\nsage: v = vector(QQ, [2, 3, 4])\nsage: v.rename('mangrove')\nNotImplementedError: object does not support renaming: (2, 3, 4)\n```\n\nNeither do elements of `CombinatorialFreeModule`.\n\n> Would you mind to add this condition here?\n\nI would prefer it if this could be done on follow-up tickets to keep this technical ticket small.\n\nThere are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.\n\n> Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 \"more systematically\", as you said.\n\nGreat!",
    "created_at": "2020-07-31T12:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477986",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mjungmath](#comment:20):
> However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.
> 
> Matthias, what do you say?

I feel I don't really have a qualified opinion on this because I have not studied how you use these symbolic names in sage-manifolds. 

The vectors from `sage.modules` do not support renaming, so there's no concern regarding compatibility here.

```
sage: v = vector(QQ, [2, 3, 4])
sage: v.rename('mangrove')
NotImplementedError: object does not support renaming: (2, 3, 4)
```

Neither do elements of `CombinatorialFreeModule`.

> Would you mind to add this condition here?

I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.

There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.

> Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 "more systematically", as you said.

Great!



---

archive/issue_comments_477987.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment:17):\n> Replying to [@mjungmath](#comment:16):\n> > Replying to [@tscrim](#comment:15):\n> > > @mjungmath Did you see [comment:8](#comment:8)?\n\n> > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> \n> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\nActually this is not quite true. One cannot do general mix-in classes with Cython.\nBut the following works:\n\n```\ndiff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\nindex edb52ecd95..83883394f2 100644\n--- a/src/sage/manifolds/scalarfield.py\n+++ b/src/sage/manifolds/scalarfield.py\n@@ -40,12 +40,12 @@ REFERENCES:\n #                  https://www.gnu.org/licenses/\n # *****************************************************************************\n \n-from sage.structure.element import CommutativeAlgebraElement\n+from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability\n from sage.symbolic.expression import Expression\n from sage.manifolds.chart_func import ChartFunction\n \n \n-class ScalarField(CommutativeAlgebraElement):\n+class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n     r\"\"\"\n     Scalar field on a topological manifold.\n \n```\n\nThis works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n```\nsage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2\nsage: U = M.open_subset('U') # complement of the North pole\nsage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\nsage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g\nScalar field g on the Open subset U of the 2-dimensional topological manifold M\nsage: g.set_immutable()\nsage: g.is_immutable()\nTrue\n```",
    "created_at": "2020-07-31T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477987",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment:17):
> Replying to [@mjungmath](#comment:16):
> > Replying to [@tscrim](#comment:15):
> > > @mjungmath Did you see [comment:8](#comment:8)?

> > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> 
> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

Actually this is not quite true. One cannot do general mix-in classes with Cython.
But the following works:

```
diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
index edb52ecd95..83883394f2 100644
--- a/src/sage/manifolds/scalarfield.py
+++ b/src/sage/manifolds/scalarfield.py
@@ -40,12 +40,12 @@ REFERENCES:
 #                  https://www.gnu.org/licenses/
 # *****************************************************************************
 
-from sage.structure.element import CommutativeAlgebraElement
+from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability
 from sage.symbolic.expression import Expression
 from sage.manifolds.chart_func import ChartFunction
 
 
-class ScalarField(CommutativeAlgebraElement):
+class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
     r"""
     Scalar field on a topological manifold.
 
```

This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

```
sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2
sage: U = M.open_subset('U') # complement of the North pole
sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g
Scalar field g on the Open subset U of the 2-dimensional topological manifold M
sage: g.set_immutable()
sage: g.is_immutable()
True
```



---

archive/issue_comments_477988.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mjungmath](#comment:14):\n> What about a slighly more general approach like having a class `ElementWithMutability` \n\nI think I wouldn't like to push the mutability down to the level of `Element`. Mutating components is something that we traditionally do with \"vectors\". Other types of elements are traditionally immutable, and a functional style (creating new objects instead of mutating objects) is preferred.",
    "created_at": "2020-07-31T13:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477988",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mjungmath](#comment:14):
> What about a slighly more general approach like having a class `ElementWithMutability` 

I think I wouldn't like to push the mutability down to the level of `Element`. Mutating components is something that we traditionally do with "vectors". Other types of elements are traditionally immutable, and a functional style (creating new objects instead of mutating objects) is preferred.



---

archive/issue_comments_477989.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mkoeppe](#comment:21):\n> > Would you mind to add this condition here?\n\n> \n> I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.\n\nThis makes sense.\n\n> There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.\n\nThat's right. More importantly, connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\nReplying to [@mkoeppe](#comment:22): \n> Actually this is not quite true. One cannot do general mix-in classes with Cython.\n> But the following works:\n> \n> ```\n> diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> index edb52ecd95..83883394f2 100644\n> --- a/src/sage/manifolds/scalarfield.py\n> +++ b/src/sage/manifolds/scalarfield.py\n> @@ -40,12 +40,12 @@ REFERENCES:\n>  #                  https://www.gnu.org/licenses/\n>  # *****************************************************************************\n>  \n> -from sage.structure.element import CommutativeAlgebraElement\n> +from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability\n>  from sage.symbolic.expression import Expression\n>  from sage.manifolds.chart_func import ChartFunction\n>  \n>  \n> -class ScalarField(CommutativeAlgebraElement):\n> +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n>      r\"\"\"\n>      Scalar field on a topological manifold.\n>  \n> ```\n> \n> This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n> \n> ```\n> sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2\n> sage: U = M.open_subset('U') # complement of the North pole\n> sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\n> sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g\n> Scalar field g on the Open subset U of the 2-dimensional topological manifold M\n> sage: g.set_immutable()\n> sage: g.is_immutable()\n> True\n> ```\n\nDo you think this is a reasonable way to go? I am afraid that potential changes in the intermediated classes might break this whole construct down...",
    "created_at": "2020-07-31T13:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477989",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mkoeppe](#comment:21):
> > Would you mind to add this condition here?

> 
> I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.

This makes sense.

> There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.

That's right. More importantly, connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

Replying to [@mkoeppe](#comment:22): 
> Actually this is not quite true. One cannot do general mix-in classes with Cython.
> But the following works:
> 
> ```
> diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> index edb52ecd95..83883394f2 100644
> --- a/src/sage/manifolds/scalarfield.py
> +++ b/src/sage/manifolds/scalarfield.py
> @@ -40,12 +40,12 @@ REFERENCES:
>  #                  https://www.gnu.org/licenses/
>  # *****************************************************************************
>  
> -from sage.structure.element import CommutativeAlgebraElement
> +from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability
>  from sage.symbolic.expression import Expression
>  from sage.manifolds.chart_func import ChartFunction
>  
>  
> -class ScalarField(CommutativeAlgebraElement):
> +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
>      r"""
>      Scalar field on a topological manifold.
>  
> ```
> 
> This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.
> 
> ```
> sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2
> sage: U = M.open_subset('U') # complement of the North pole
> sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
> sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g
> Scalar field g on the Open subset U of the 2-dimensional topological manifold M
> sage: g.set_immutable()
> sage: g.is_immutable()
> True
> ```

Do you think this is a reasonable way to go? I am afraid that potential changes in the intermediated classes might break this whole construct down...



---

archive/issue_comments_477990.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nReplying to [@mjungmath](#comment:24):\n> connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\nYes, I think this is a defect.\n\n> Replying to [@mkoeppe](#comment:22): \n> > \n> > ```\n> > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> > -class ScalarField(CommutativeAlgebraElement):\n> > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n> > ```\n> > \n> > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n> \n> Do you think this is a reasonable way to go?\n\nYes. But actually - should an `AffineConnection` not be an element of some module too? \n\n> I am afraid that potential changes in the intermediated classes might break this whole construct down...\n\nDon't worry about this. It would be highly controversial to add additional slots to these classes.",
    "created_at": "2020-07-31T13:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477990",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

Replying to [@mjungmath](#comment:24):
> connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

Yes, I think this is a defect.

> Replying to [@mkoeppe](#comment:22): 
> > 
> > ```
> > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> > -class ScalarField(CommutativeAlgebraElement):
> > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
> > ```
> > 
> > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

> 
> Do you think this is a reasonable way to go?

Yes. But actually - should an `AffineConnection` not be an element of some module too? 

> I am afraid that potential changes in the intermediated classes might break this whole construct down...

Don't worry about this. It would be highly controversial to add additional slots to these classes.



---

archive/issue_comments_477991.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@mkoeppe](#comment:25):\n> Replying to [@mjungmath](#comment:24):\n> > connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\n> \n> Yes, I think this is a defect.\n> \n> > Replying to [@mkoeppe](#comment:22): \n> > > \n> > > ```\n> > > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> > > -class ScalarField(CommutativeAlgebraElement):\n> > > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n> > > ```\n> > > \n> > > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n> > \n> > Do you think this is a reasonable way to go?\n\n> \n> Yes. But actually - should an `AffineConnection` not be an element of some module too? \n\nActually, on the second thought, I don't think that connections constitute a vector space. There is no zero element since this would contradict the Leibniz rule. Furthermore, in fact, only convex linear combinations are connections again.\n\nI wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?",
    "created_at": "2020-07-31T14:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477991",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@mkoeppe](#comment:25):
> Replying to [@mjungmath](#comment:24):
> > connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

> 
> Yes, I think this is a defect.
> 
> > Replying to [@mkoeppe](#comment:22): 
> > > 
> > > ```
> > > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> > > -class ScalarField(CommutativeAlgebraElement):
> > > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
> > > ```
> > > 
> > > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

> > 
> > Do you think this is a reasonable way to go?

> 
> Yes. But actually - should an `AffineConnection` not be an element of some module too? 

Actually, on the second thought, I don't think that connections constitute a vector space. There is no zero element since this would contradict the Leibniz rule. Furthermore, in fact, only convex linear combinations are connections again.

I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?



---

archive/issue_comments_477992.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@mjungmath](#comment:26):\n> I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?\n\nHard to know. It was added in #14524. I don't know if it was ever used",
    "created_at": "2020-07-31T18:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477992",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@mjungmath](#comment:26):
> I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?

Hard to know. It was added in #14524. I don't know if it was ever used



---

archive/issue_comments_477993.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThe invokation of `__init__` via `super()` here seems to cause some troubles on the level of manifolds. Anyway, I think the discussion can be closed and should be shifted to #30261. I will add the dependence.",
    "created_at": "2020-07-31T19:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477993",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:28" align="right">comment:28</div>

The invokation of `__init__` via `super()` here seems to cause some troubles on the level of manifolds. Anyway, I think the discussion can be closed and should be shifted to #30261. I will add the dependence.



---

archive/issue_events_412548.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:07:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412548"
}
```



---

archive/issue_events_412549.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "71b530802d28c4a609611d647cb45ff6052396b4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-07T19:07:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-412549"
}
```



---

archive/issue_comments_477994.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)** to **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**",
    "created_at": "2020-08-07T19:07:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-477994",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)** to **[`a2ee8be`](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**
