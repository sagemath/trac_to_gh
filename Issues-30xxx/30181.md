# Issue 30181: Immutable elements of FreeModuleTensor

archive/issues_029944.json:
```json
{
    "assignees": [],
    "body": "Currently, elements of a `FiniteRankFreeModule` and its tensor modules are mutable and therefore cannot be hashed.\n\nIn analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.\n\nIn this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.\n\nThe methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)\n\n\nCC:  @egourgoulhon @tscrim @mjungmath\n\nBranch/Commit: **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**\n\nReviewer: **Travis Scrimshaw**\n\nAuthor: **Matthias Koeppe**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30181_\n\n",
    "closed_at": "2020-08-07T19:07:30Z",
    "created_at": "2020-07-20T18:44:55Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Immutable elements of FreeModuleTensor",
    "type": "issue",
    "updated_at": "2020-08-07T19:07:30Z",
    "url": "https://github.com/sagemath/sage/issues/30181",
    "user": "https://github.com/mkoeppe"
}
```
Currently, elements of a `FiniteRankFreeModule` and its tensor modules are mutable and therefore cannot be hashed.

In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.

In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.

The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)


CC:  @egourgoulhon @tscrim @mjungmath

Branch/Commit: **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**

Reviewer: **Travis Scrimshaw**

Author: **Matthias Koeppe**

_Issue created by migration from https://trac.sagemath.org/ticket/30181_





---

archive/issue_events_383748.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383748"
}
```



---

archive/issue_events_383749.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "component: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383749"
}
```



---

archive/issue_events_383750.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383750"
}
```



---

archive/issue_events_383751.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-20T18:44:55Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383751"
}
```



---

archive/issue_comments_481018.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-30T20:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481018",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_481019.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,7 @@\n \n In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.\n \n+In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.\n \n+The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)\n+\n``````\n",
    "created_at": "2020-07-30T20:02:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481019",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,7 @@
 
 In analogy to `sage.modules.FreeModuleElement` and `sage.matrix.Matrix`, a method `set_immutable()` should be added.
 
+In this ticket, we do this by creating a subclass `ModuleElementWithMutability` of `ModuleElement`.  The existing classes `Vector` (and thus `FreeModuleElement` from `sage.modules`) and `FreeModuleTensor` (from `sage.tensor`) are changed to subclass it.
 
+The methods from `FreeModuleElement` implementing mutability are moved to `ModuleElementWithMutability` and become available for `FreeModuleTensor` in this way. (The class `Vector` also gets them for free.)
+
``````




---

archive/issue_comments_481020.json:
```json
{
    "body": "Branch: **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)**",
    "created_at": "2020-07-30T20:25:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481020",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)**



---

archive/issue_comments_481021.json:
```json
{
    "body": "Commit: **[9df3d22](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)**",
    "created_at": "2020-07-30T21:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481021",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[9df3d22](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)**



---

archive/issue_comments_481022.json:
```json
{
    "body": "<a id='comment:3'>Comment 3:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca\">9df3d22</a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr></table>\n",
    "created_at": "2020-07-30T21:04:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481022",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:3'>Comment 3:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca">9df3d22</a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr></table>




---

archive/issue_comments_481023.json:
```json
{
    "body": "Changed commit from **[9df3d22](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)** to **[4373ea2](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)**",
    "created_at": "2020-07-30T21:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481023",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9df3d22](https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca)** to **[4373ea2](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)**



---

archive/issue_comments_481024.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87\">4373ea2</a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr></table>\n",
    "created_at": "2020-07-30T21:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481024",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:4'>Comment 4:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87">4373ea2</a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr></table>




---

archive/issue_events_383752.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-30T21:40:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383752"
}
```



---

archive/issue_comments_481025.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nAlthough hashing is one of the motivations for this ticket, it will not be implemented on this ticket. A follow-up ticket will take care of it.",
    "created_at": "2020-07-30T21:44:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'>Comment 6:</a>
Although hashing is one of the motivations for this ticket, it will not be implemented on this ticket. A follow-up ticket will take care of it.



---

archive/issue_comments_481026.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI would also make those methods\n\n```\ncpdef bool is_[im]mutable(self):\n```\n\n\nIn some ways, I think this would be better as a mixin class. Alas, Cython does not have multiple inheritance...",
    "created_at": "2020-07-30T23:40:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481026",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'>Comment 7:</a>
I would also make those methods

```
cpdef bool is_[im]mutable(self):
```


In some ways, I think this would be better as a mixin class. Alas, Cython does not have multiple inheritance...



---

archive/issue_comments_481027.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nThere is already a mixin class written in Cython, `sage.structure.mutability`, but it cannot be used for exactly this reason.",
    "created_at": "2020-07-30T23:42:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481027",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
There is already a mixin class written in Cython, `sage.structure.mutability`, but it cannot be used for exactly this reason.



---

archive/issue_comments_481028.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nReplying to [@tscrim](#comment%3A7):\n> I would also make those methods\n> \n> ```\n> cpdef bool is_[im]mutable(self):\n> ```\n\nYes, I'll make this change",
    "created_at": "2020-07-30T23:48:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481028",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Replying to [@tscrim](#comment%3A7):
> I would also make those methods
> 
> ```
> cpdef bool is_[im]mutable(self):
> ```

Yes, I'll make this change



---

archive/issue_comments_481029.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2\">a2ee8be</a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr></table>\n",
    "created_at": "2020-07-30T23:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481029",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2">a2ee8be</a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr></table>




---

archive/issue_comments_481030.json:
```json
{
    "body": "Changed commit from **[4373ea2](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)** to **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**",
    "created_at": "2020-07-30T23:59:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481030",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[4373ea2](https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87)** to **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**



---

archive/issue_comments_481031.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThank you. LGTM.\n\n(I slightly wonder if a user who really cares about speed should instead be just breaking the encapsulation here...)",
    "created_at": "2020-07-31T04:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481031",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'>Comment 11:</a>
Thank you. LGTM.

(I slightly wonder if a user who really cares about speed should instead be just breaking the encapsulation here...)



---

archive/issue_comments_481032.json:
```json
{
    "body": "Reviewer: **Travis Scrimshaw**",
    "created_at": "2020-07-31T04:27:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481032",
    "user": "https://github.com/tscrim"
}
```

Reviewer: **Travis Scrimshaw**



---

archive/issue_events_383753.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-31T04:27:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383753"
}
```



---

archive/issue_events_383754.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-31T04:27:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383754"
}
```



---

archive/issue_comments_481033.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nThanks!",
    "created_at": "2020-07-31T05:08:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481033",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
Thanks!



---

archive/issue_comments_481034.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nThank you for this very nice improvement!\n\nWhat about the name of an immutable element? Should that be immutable, too? This is not covered in this modification, but maybe it should?\n\nAs you suggested a systematic solution to #30239, it would be good to add this improvement to all modules in the `manifolds` module and to the scalar field algebra as well. The latter probably needs a new implementation, e.g. `CommutativeAlgebraElementWithMutability`.",
    "created_at": "2020-07-31T05:52:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481034",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:13'>Comment 13:</a>
Thank you for this very nice improvement!

What about the name of an immutable element? Should that be immutable, too? This is not covered in this modification, but maybe it should?

As you suggested a systematic solution to #30239, it would be good to add this improvement to all modules in the `manifolds` module and to the scalar field algebra as well. The latter probably needs a new implementation, e.g. `CommutativeAlgebraElementWithMutability`.



---

archive/issue_comments_481035.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\nWhat about a slighly more general approach like having a class `ElementWithMutability` and then simply\n\n```python\nclass FreeModuleTensor(ModuleElement, ElementWithMutability) \n```\n\nThis approach can also be applied to other elements. The hashablility can then be implemented via `ElementWithMutability`.\n\nThis has also the great advantage that this can be used for affine connections and bundle connections, too.",
    "created_at": "2020-07-31T06:30:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481035",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:14'>Comment 14:</a>
What about a slighly more general approach like having a class `ElementWithMutability` and then simply

```python
class FreeModuleTensor(ModuleElement, ElementWithMutability) 
```

This approach can also be applied to other elements. The hashablility can then be implemented via `ElementWithMutability`.

This has also the great advantage that this can be used for affine connections and bundle connections, too.



---

archive/issue_comments_481036.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\n`@`gh-mjungmath Did you see [comment:8](#comment%3A8)?",
    "created_at": "2020-07-31T06:54:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481036",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:15'>Comment 15:</a>
`@`gh-mjungmath Did you see [comment:8](#comment%3A8)?



---

archive/issue_comments_481037.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@tscrim](#comment%3A15):\n> `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?\n\nOh, I see. But is implementing the same code for each kind of element really necessary?",
    "created_at": "2020-07-31T07:02:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481037",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@tscrim](#comment%3A15):
> `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?

Oh, I see. But is implementing the same code for each kind of element really necessary?



---

archive/issue_comments_481038.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nReplying to [@mjungmath](#comment%3A16):\n> Replying to [@tscrim](#comment%3A15):\n> > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?\n\n> Oh, I see. But is implementing the same code for each kind of element really necessary? \n\nCython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.",
    "created_at": "2020-07-31T07:50:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481038",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:17'>Comment 17:</a>
Replying to [@mjungmath](#comment%3A16):
> Replying to [@tscrim](#comment%3A15):
> > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?

> Oh, I see. But is implementing the same code for each kind of element really necessary? 

Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.



---

archive/issue_comments_481039.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nReplying to [@tscrim](#comment%3A17):\n> Replying to [@mjungmath](#comment%3A16):\n> > Replying to [@tscrim](#comment%3A15):\n> > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?\n\n> > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> \n> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\nReasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?\n\nDo you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.",
    "created_at": "2020-07-31T08:13:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481039",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:18'>Comment 18:</a>
Replying to [@tscrim](#comment%3A17):
> Replying to [@mjungmath](#comment%3A16):
> > Replying to [@tscrim](#comment%3A15):
> > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?

> > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> 
> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?

Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.



---

archive/issue_comments_481040.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@mjungmath](#comment%3A18):\n> Replying to [@tscrim](#comment%3A17):\n> > Replying to [@mjungmath](#comment%3A16):\n> > > Replying to [@tscrim](#comment%3A15):\n> > > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?\n\n> > > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> > \n> > Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\n> \n> Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?\n\nPossibly, but it might suggest that you just need a better mixin class that is perhaps (a subclass of) `sage.structure.mutability`. I am not sure as you know the code better than I do. You can try experimenting and seeing what works best.\n\n> Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.\n\nPart of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.",
    "created_at": "2020-07-31T09:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481040",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@mjungmath](#comment%3A18):
> Replying to [@tscrim](#comment%3A17):
> > Replying to [@mjungmath](#comment%3A16):
> > > Replying to [@tscrim](#comment%3A15):
> > > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?

> > > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> > 
> > Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

> 
> Reasonable point. Mh, that would mean, we need a seperate solution for scalar fields and connections, right?

Possibly, but it might suggest that you just need a better mixin class that is perhaps (a subclass of) `sage.structure.mutability`. I am not sure as you know the code better than I do. You can try experimenting and seeing what works best.

> Do you have an opinion regarding the behavior of the tensor's names? I think that the names should be fixed as soon as the element is immutable.

Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.



---

archive/issue_comments_481041.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nReplying to [@tscrim](#comment%3A19):\n> Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.\n\nThis is exactly the reason why I struggle, too.\n\nHowever, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.\n\nMatthias, what do you say? Would you mind to add this condition here?\n\nAnyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 \"more systematically\", as you said.",
    "created_at": "2020-07-31T10:24:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481041",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:20'>Comment 20:</a>
Replying to [@tscrim](#comment%3A19):
> Part of me would want it to be mutable because I want to rename things, but the other part says that 0 should not be renamed. I would say because of that, (latex) names should be immutable.

This is exactly the reason why I struggle, too.

However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.

Matthias, what do you say? Would you mind to add this condition here?

Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 "more systematically", as you said.



---

archive/issue_comments_481042.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nReplying to [@mjungmath](#comment%3A20):\n> However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.\n> \n> Matthias, what do you say?\n\nI feel I don't really have a qualified opinion on this because I have not studied how you use these symbolic names in sage-manifolds. \n\nThe vectors from `sage.modules` do not support renaming, so there's no concern regarding compatibility here.\n\n```\nsage: v = vector(QQ, [2, 3, 4])\nsage: v.rename('mangrove')\nNotImplementedError: object does not support renaming: (2, 3, 4)\n```\n\nNeither do elements of `CombinatorialFreeModule`.\n\n> Would you mind to add this condition here?\n\nI would prefer it if this could be done on follow-up tickets to keep this technical ticket small.\n\nThere are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.\n\n> Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 \"more systematically\", as you said.\n\nGreat!",
    "created_at": "2020-07-31T12:45:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481042",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Replying to [@mjungmath](#comment%3A20):
> However, I think, the names should be set fixed when the element is immutable. At least, immutability means exactly this.
> 
> Matthias, what do you say?

I feel I don't really have a qualified opinion on this because I have not studied how you use these symbolic names in sage-manifolds. 

The vectors from `sage.modules` do not support renaming, so there's no concern regarding compatibility here.

```
sage: v = vector(QQ, [2, 3, 4])
sage: v.rename('mangrove')
NotImplementedError: object does not support renaming: (2, 3, 4)
```

Neither do elements of `CombinatorialFreeModule`.

> Would you mind to add this condition here?

I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.

There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.

> Anyway, I would use your code as a template to apply the mutability changes to the `manifolds` module accordingly; also to fix #30239 "more systematically", as you said.

Great!



---

archive/issue_comments_481043.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nReplying to [@tscrim](#comment%3A17):\n> Replying to [@mjungmath](#comment%3A16):\n> > Replying to [@tscrim](#comment%3A15):\n> > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?\n\n> > Oh, I see. But is implementing the same code for each kind of element really necessary? \n\n> \n> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.\n\nActually this is not quite true. One cannot do general mix-in classes with Cython.\nBut the following works:\n\n```\ndiff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\nindex edb52ecd95..83883394f2 100644\n--- a/src/sage/manifolds/scalarfield.py\n+++ b/src/sage/manifolds/scalarfield.py\n@@ -40,12 +40,12 @@ REFERENCES:\n #                  https://www.gnu.org/licenses/\n # *****************************************************************************\n \n-from sage.structure.element import CommutativeAlgebraElement\n+from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability\n from sage.symbolic.expression import Expression\n from sage.manifolds.chart_func import ChartFunction\n \n \n-class ScalarField(CommutativeAlgebraElement):\n+class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n     r\"\"\"\n     Scalar field on a topological manifold.\n \n```\n\nThis works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n```\nsage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2\nsage: U = M.open_subset('U') # complement of the North pole\nsage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\nsage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g\nScalar field g on the Open subset U of the 2-dimensional topological manifold M\nsage: g.set_immutable()\nsage: g.is_immutable()\nTrue\n```",
    "created_at": "2020-07-31T12:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481043",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
Replying to [@tscrim](#comment%3A17):
> Replying to [@mjungmath](#comment%3A16):
> > Replying to [@tscrim](#comment%3A15):
> > > `@`gh-mjungmath Did you see [comment:8](#comment%3A8)?

> > Oh, I see. But is implementing the same code for each kind of element really necessary? 

> 
> Cython does not have multiple inheritance and you want the Sage vectors, which are Cython classes, to have this behavior. Since that structure is already there, the `FreeModuleTensor` should use it.

Actually this is not quite true. One cannot do general mix-in classes with Cython.
But the following works:

```
diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
index edb52ecd95..83883394f2 100644
--- a/src/sage/manifolds/scalarfield.py
+++ b/src/sage/manifolds/scalarfield.py
@@ -40,12 +40,12 @@ REFERENCES:
 #                  https://www.gnu.org/licenses/
 # *****************************************************************************
 
-from sage.structure.element import CommutativeAlgebraElement
+from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability
 from sage.symbolic.expression import Expression
 from sage.manifolds.chart_func import ChartFunction
 
 
-class ScalarField(CommutativeAlgebraElement):
+class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
     r"""
     Scalar field on a topological manifold.
 
```

This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

```
sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2
sage: U = M.open_subset('U') # complement of the North pole
sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g
Scalar field g on the Open subset U of the 2-dimensional topological manifold M
sage: g.set_immutable()
sage: g.is_immutable()
True
```



---

archive/issue_comments_481044.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nReplying to [@mjungmath](#comment%3A14):\n> What about a slighly more general approach like having a class `ElementWithMutability` \n\nI think I wouldn't like to push the mutability down to the level of `Element`. Mutating components is something that we traditionally do with \"vectors\". Other types of elements are traditionally immutable, and a functional style (creating new objects instead of mutating objects) is preferred.",
    "created_at": "2020-07-31T13:11:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481044",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:23'>Comment 23:</a>
Replying to [@mjungmath](#comment%3A14):
> What about a slighly more general approach like having a class `ElementWithMutability` 

I think I wouldn't like to push the mutability down to the level of `Element`. Mutating components is something that we traditionally do with "vectors". Other types of elements are traditionally immutable, and a functional style (creating new objects instead of mutating objects) is preferred.



---

archive/issue_comments_481045.json:
```json
{
    "body": "<a id='comment:24'>Comment 24:</a>\nReplying to [@mkoeppe](#comment%3A21):\n> > Would you mind to add this condition here?\n\n> \n> I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.\n\nThis makes sense.\n\n> There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.\n\nThat's right. More importantly, connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\nReplying to [@mkoeppe](#comment%3A22): \n> Actually this is not quite true. One cannot do general mix-in classes with Cython.\n> But the following works:\n> \n> ```\n> diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> index edb52ecd95..83883394f2 100644\n> --- a/src/sage/manifolds/scalarfield.py\n> +++ b/src/sage/manifolds/scalarfield.py\n> @@ -40,12 +40,12 @@ REFERENCES:\n>  #                  https://www.gnu.org/licenses/\n>  # *****************************************************************************\n>  \n> -from sage.structure.element import CommutativeAlgebraElement\n> +from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability\n>  from sage.symbolic.expression import Expression\n>  from sage.manifolds.chart_func import ChartFunction\n>  \n>  \n> -class ScalarField(CommutativeAlgebraElement):\n> +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n>      r\"\"\"\n>      Scalar field on a topological manifold.\n>  \n> ```\n> \n> This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n> \n> ```\n> sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2\n> sage: U = M.open_subset('U') # complement of the North pole\n> sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole\n> sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g\n> Scalar field g on the Open subset U of the 2-dimensional topological manifold M\n> sage: g.set_immutable()\n> sage: g.is_immutable()\n> True\n> ```\n\nDo you think this is a reasonable way to go? I am afraid that potential changes in the intermediated classes might break this whole construct down...",
    "created_at": "2020-07-31T13:20:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481045",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:24'>Comment 24:</a>
Replying to [@mkoeppe](#comment%3A21):
> > Would you mind to add this condition here?

> 
> I would prefer it if this could be done on follow-up tickets to keep this technical ticket small.

This makes sense.

> There are some more changes that you could consider: `vector` supports an optional argument `immutable`; and hashing of immutable tensors should be implemented.

That's right. More importantly, connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

Replying to [@mkoeppe](#comment%3A22): 
> Actually this is not quite true. One cannot do general mix-in classes with Cython.
> But the following works:
> 
> ```
> diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> index edb52ecd95..83883394f2 100644
> --- a/src/sage/manifolds/scalarfield.py
> +++ b/src/sage/manifolds/scalarfield.py
> @@ -40,12 +40,12 @@ REFERENCES:
>  #                  https://www.gnu.org/licenses/
>  # *****************************************************************************
>  
> -from sage.structure.element import CommutativeAlgebraElement
> +from sage.structure.element import CommutativeAlgebraElement, ModuleElementWithMutability
>  from sage.symbolic.expression import Expression
>  from sage.manifolds.chart_func import ChartFunction
>  
>  
> -class ScalarField(CommutativeAlgebraElement):
> +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
>      r"""
>      Scalar field on a topological manifold.
>  
> ```
> 
> This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.
> 
> ```
> sage: M = Manifold(2, 'M', structure='topological') # the 2-dimensional sphere S^2
> sage: U = M.open_subset('U') # complement of the North pole
> sage: c_xy.<x,y> = U.chart() # stereographic coordinates from the North pole
> sage: g = U.scalar_field(x*y, chart=c_xy, name='g') ; g
> Scalar field g on the Open subset U of the 2-dimensional topological manifold M
> sage: g.set_immutable()
> sage: g.is_immutable()
> True
> ```

Do you think this is a reasonable way to go? I am afraid that potential changes in the intermediated classes might break this whole construct down...



---

archive/issue_comments_481046.json:
```json
{
    "body": "<a id='comment:25'>Comment 25:</a>\nReplying to [@mjungmath](#comment%3A24):\n> connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\nYes, I think this is a defect.\n\n> Replying to [@mkoeppe](#comment%3A22): \n> > \n> > ```\n> > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> > -class ScalarField(CommutativeAlgebraElement):\n> > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n> > ```\n> > \n> > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n> \n> Do you think this is a reasonable way to go?\n\nYes. But actually - should an `AffineConnection` not be an element of some module too? \n\n> I am afraid that potential changes in the intermediated classes might break this whole construct down...\n\nDon't worry about this. It would be highly controversial to add additional slots to these classes.",
    "created_at": "2020-07-31T13:31:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481046",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'>Comment 25:</a>
Replying to [@mjungmath](#comment%3A24):
> connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

Yes, I think this is a defect.

> Replying to [@mkoeppe](#comment%3A22): 
> > 
> > ```
> > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> > -class ScalarField(CommutativeAlgebraElement):
> > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
> > ```
> > 
> > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

> 
> Do you think this is a reasonable way to go?

Yes. But actually - should an `AffineConnection` not be an element of some module too? 

> I am afraid that potential changes in the intermediated classes might break this whole construct down...

Don't worry about this. It would be highly controversial to add additional slots to these classes.



---

archive/issue_comments_481047.json:
```json
{
    "body": "<a id='comment:26'>Comment 26:</a>\nReplying to [@mkoeppe](#comment%3A25):\n> Replying to [@mjungmath](#comment%3A24):\n> > connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.\n\n> \n> Yes, I think this is a defect.\n> \n> > Replying to [@mkoeppe](#comment%3A22): \n> > > \n> > > ```\n> > > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py\n> > > -class ScalarField(CommutativeAlgebraElement):\n> > > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):\n> > > ```\n> > > \n> > > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.\n\n> > \n> > Do you think this is a reasonable way to go?\n\n> \n> Yes. But actually - should an `AffineConnection` not be an element of some module too? \n\nActually, on the second thought, I don't think that connections constitute a vector space. There is no zero element since this would contradict the Leibniz rule. Furthermore, in fact, only convex linear combinations are connections again.\n\nI wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?",
    "created_at": "2020-07-31T14:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481047",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:26'>Comment 26:</a>
Replying to [@mkoeppe](#comment%3A25):
> Replying to [@mjungmath](#comment%3A24):
> > connections already support hashing even though they cannot be considered immutable. Strictly speaking, this is a defect.

> 
> Yes, I think this is a defect.
> 
> > Replying to [@mkoeppe](#comment%3A22): 
> > > 
> > > ```
> > > diff --git a/src/sage/manifolds/scalarfield.py b/src/sage/manifolds/scalarfield.py
> > > -class ScalarField(CommutativeAlgebraElement):
> > > +class ScalarField(CommutativeAlgebraElement, ModuleElementWithMutability):
> > > ```
> > > 
> > > This works because between none of the intermediate classes between `ModuleElement` and `CommutativeAlgebraElement` add slots.

> > 
> > Do you think this is a reasonable way to go?

> 
> Yes. But actually - should an `AffineConnection` not be an element of some module too? 

Actually, on the second thought, I don't think that connections constitute a vector space. There is no zero element since this would contradict the Leibniz rule. Furthermore, in fact, only convex linear combinations are connections again.

I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?



---

archive/issue_comments_481048.json:
```json
{
    "body": "<a id='comment:27'>Comment 27:</a>\nReplying to [@mjungmath](#comment%3A26):\n> I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?\n\nHard to know. It was added in #14524. I don't know if it was ever used",
    "created_at": "2020-07-31T18:38:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481048",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'>Comment 27:</a>
Replying to [@mjungmath](#comment%3A26):
> I wonder why `Mutability` does not inherit from `SageObject`. If it would, one could let connections directly inherit from `Mutability`. Is there a particular reason?

Hard to know. It was added in #14524. I don't know if it was ever used



---

archive/issue_comments_481049.json:
```json
{
    "body": "<a id='comment:28'>Comment 28:</a>\nThe invokation of `__init__` via `super()` here seems to cause some troubles on the level of manifolds. Anyway, I think the discussion can be closed and should be shifted to #30261. I will add the dependence.",
    "created_at": "2020-07-31T19:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481049",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:28'>Comment 28:</a>
The invokation of `__init__` via `super()` here seems to cause some troubles on the level of manifolds. Anyway, I think the discussion can be closed and should be shifted to #30261. I will add the dependence.



---

archive/issue_events_383755.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:07:30Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383755"
}
```



---

archive/issue_events_383756.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "71b530802d28c4a609611d647cb45ff6052396b4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-07T19:07:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30181#event-383756"
}
```



---

archive/issue_comments_481050.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)** to **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**",
    "created_at": "2020-08-07T19:07:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30181",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30181#issuecomment-481050",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/immutable_elements_of_freemoduletensor](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/immutable_elements_of_freemoduletensor)** to **[a2ee8be](https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2)**
