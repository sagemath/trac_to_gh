# Issue 30803: Upgrade pybind11 to 2.6.0 to fix "critical incompatibility with Python 3.9.0"

archive/issues_030566.json:
```json
{
    "body": "(from #30184)\n\nFrom https://pybind11.readthedocs.io/en/latest/\n\n```\nWarning\n\nCombining older versions of pybind11 (< 2.6.0) with the brand-new Python 3.9.0 will trigger undefined behavior that typically manifests as crashes during interpreter shutdown (but could also destroy your data. You have been warned.)\n\nWe recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.\n```\n\nhttps://pypi.org/project/pybind11/#history\n\n`pybind11` is a dependency of `scipy`.\n\n\n\n\nCC:  @dimpase @slel @vbraun\n\nBranch/Commit: 5b7784d91023734e49b2dbe95cac5576b312d119\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30803\n\n",
    "closed_at": "2020-10-31T18:08:14Z",
    "created_at": "2020-10-20T17:49:41Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Upgrade pybind11 to 2.6.0 to fix \"critical incompatibility with Python 3.9.0\"",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30803",
    "user": "https://github.com/mkoeppe"
}
```
(from #30184)

From https://pybind11.readthedocs.io/en/latest/

```
Warning

Combining older versions of pybind11 (< 2.6.0) with the brand-new Python 3.9.0 will trigger undefined behavior that typically manifests as crashes during interpreter shutdown (but could also destroy your data. You have been warned.)

We recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.
```

https://pypi.org/project/pybind11/#history

`pybind11` is a dependency of `scipy`.




CC:  @dimpase @slel @vbraun

Branch/Commit: 5b7784d91023734e49b2dbe95cac5576b312d119

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30803





---

archive/issue_comments_610544.json:
```json
{
    "body": "<a id='comment:1'></a>2.6.0 is not released yet, but there is 2.6.0rc3, released 2020-10-16",
    "created_at": "2020-10-20T17:52:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610544",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>2.6.0 is not released yet, but there is 2.6.0rc3, released 2020-10-16



---

archive/issue_comments_610545.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/upgrade_pybind11\"",
    "created_at": "2020-10-20T17:54:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610545",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/upgrade_pybind11"



---

archive/issue_comments_610546.json:
```json
{
    "body": "Changing commit from \"\" to \"6444d52137861e921ee5a47aa63975c9c7185ba4\"",
    "created_at": "2020-10-20T17:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610546",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "6444d52137861e921ee5a47aa63975c9c7185ba4"



---

archive/issue_comments_610547.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2020-10-20T17:55:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610547",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_610548.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-10-20T17:55:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610548",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_610549.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,11 @@\n We recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.\n ```\n \n+`pybind11` is a dependency of `scipy`.\n+\n+\n+\n+\n Comment: 1\n \n Summary: Upgrade pybind11\n``````\n",
    "created_at": "2020-10-20T17:55:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610549",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,11 @@
 We recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.
 ```
 
+`pybind11` is a dependency of `scipy`.
+
+
+
+
 Comment: 1
 
 Summary: Upgrade pybind11
``````




---

archive/issue_comments_610550.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-20T18:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610550",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_610551.json:
```json
{
    "body": "Changing reviewer from \"\" to \"https://github.com/mkoeppe/sage/actions/runs/318265052\"",
    "created_at": "2020-10-20T18:14:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610551",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "https://github.com/mkoeppe/sage/actions/runs/318265052"



---

archive/issue_comments_610552.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,20 @@\n+(from #30184)\n+\n+From https://pybind11.readthedocs.io/en/latest/\n+\n+```\n+Warning\n+\n+Combining older versions of pybind11 (< 2.6.0) with the brand-new Python 3.9.0 will trigger undefined behavior that typically manifests as crashes during interpreter shutdown (but could also destroy your data. You have been warned.)\n+\n+We recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.\n+```\n+\n+https://pypi.org/project/pybind11/#history\n+\n+`pybind11` is a dependency of `scipy`.\n+\n+\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-10-20T20:08:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610552",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,20 @@
+(from #30184)
+
+From https://pybind11.readthedocs.io/en/latest/
+
+```
+Warning
+
+Combining older versions of pybind11 (< 2.6.0) with the brand-new Python 3.9.0 will trigger undefined behavior that typically manifests as crashes during interpreter shutdown (but could also destroy your data. You have been warned.)
+
+We recommend that you wait for Python 3.9.1 slated for release in December, which will include a fix that resolves this problem. In the meantime, please update to the latest version of pybind11 (2.6.0 or newer), which includes a temporary workaround specifically when Python 3.9.0 is detected at runtime.
+```
+
+https://pypi.org/project/pybind11/#history
+
+`pybind11` is a dependency of `scipy`.
+
+
 
 
 Comment: 1
``````




---

archive/issue_comments_610553.json:
```json
{
    "body": "<a id='comment:9'></a>They have released 2.6.0: https://pypi.org/project/pybind11/2.6.0/",
    "created_at": "2020-10-22T10:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610553",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>They have released 2.6.0: https://pypi.org/project/pybind11/2.6.0/



---

archive/issue_comments_610554.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-22T15:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610554",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_610555.json:
```json
{
    "body": "Changing commit from \"6444d52137861e921ee5a47aa63975c9c7185ba4\" to \"5b7784d91023734e49b2dbe95cac5576b312d119\"",
    "created_at": "2020-10-22T15:23:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610555",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6444d52137861e921ee5a47aa63975c9c7185ba4" to "5b7784d91023734e49b2dbe95cac5576b312d119"



---

archive/issue_comments_610556.json:
```json
{
    "body": "<a id='comment:12'></a>Needs review",
    "created_at": "2020-10-24T15:29:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610556",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Needs review



---

archive/issue_comments_610557.json:
```json
{
    "body": "<a id='comment:13'></a>it's not related to this ticket but I see\n\n```\n2020-10-21T20:11:50.1507150Z Got:\n2020-10-21T20:11:50.1507600Z     ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n2020-10-21T20:11:50.1508320Z     ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n2020-10-21T20:11:50.1509050Z     ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n```\nin https://github.com/mkoeppe/sage/runs/1282662700?check_suite_focus=true",
    "created_at": "2020-10-24T18:47:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610557",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>it's not related to this ticket but I see

```
2020-10-21T20:11:50.1507150Z Got:
2020-10-21T20:11:50.1507600Z     ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.9)
2020-10-21T20:11:50.1508320Z     ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (10.15) than being linked (10.9)
2020-10-21T20:11:50.1509050Z     ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (10.15) than being linked (10.9)
```
in https://github.com/mkoeppe/sage/runs/1282662700?check_suite_focus=true



---

archive/issue_comments_610558.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-24T19:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610558",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_610559.json:
```json
{
    "body": "<a id='comment:14'></a>LGTM, also this: https://github.com/mkoeppe/sage/actions/runs/318265052",
    "created_at": "2020-10-24T19:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610559",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>LGTM, also this: https://github.com/mkoeppe/sage/actions/runs/318265052



---

archive/issue_comments_610560.json:
```json
{
    "body": "Changing reviewer from \"https://github.com/mkoeppe/sage/actions/runs/318265052\" to \"Dima Pasechnik\"",
    "created_at": "2020-10-24T19:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610560",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "https://github.com/mkoeppe/sage/actions/runs/318265052" to "Dima Pasechnik"



---

archive/issue_events_080345.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30803#event-80345"
}
```



---

archive/issue_comments_610561.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/upgrade_pybind11\" to \"5b7784d91023734e49b2dbe95cac5576b312d119\"",
    "created_at": "2020-10-31T18:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610561",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/upgrade_pybind11" to "5b7784d91023734e49b2dbe95cac5576b312d119"



---

archive/issue_comments_610562.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-10-31T18:08:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30803#issuecomment-610562",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080346.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-10-31T18:08:14Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30803",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30803#event-80346"
}
```
