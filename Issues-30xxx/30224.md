# Issue 30224: Fix configure quiet mode as it lets a few things through

archive/issues_029987.json:
```json
{
    "assignees": [],
    "body": "In a fresh git clone of Sage 9.2.beta6, `./configure -q`\nprinted two lines to stdout and one to stderr.\n\n```\n$ ./configure -q\n11.4.3\n1.5.3\n(ignoring conda because no environment is active) $\n```\n\nTo figure out where these come from, I ran `./configure`\nin non-quiet mode, redirecting stdout to a file:\n\n```\n$ ./configure > dot-slash-configure-out.txt\n(ignoring conda because no environment is active) $\n```\nand again, redirecting both stdout and stderr to a file:\n\n```\n$ ./configure > dot-slash-configure-out-err.txt 2>&1\n$\n```\n\nThe corresponding lines when running without `-q` seem to be:\n\n```\n...\nChecking whether SageMath should install SPKG ntl...\n...\nchecking NTL version >= 10.3... 11.4.3\n...\nChecking whether SageMath should install SPKG mpfi...\n...\nchecking MPFI version >= 1.5... 1.5.3\n...\nchecking for the package system in use... (ignoring conda\nbecause no environment is active) homebrew\n...\n```\nThe `(ignoring conda ...)` part seems to go to stderr instead of stdout.\n\nInitial report:\n\n- [sage-devel post, 2020-07-26](https://groups.google.com/d/topic/sage-devel/TRdqXvmDISA/discussion)\n\n\nCC:  @mkoeppe @slel @dimpase @orlitzky\n\nKeywords: **quiet**\n\nBranch/Commit: **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**\n\nReviewer: **Samuel Leli\u00e8vre, Michael Orlitzky**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30224_\n\n",
    "closed_at": "2020-08-07T19:07:26Z",
    "created_at": "2020-07-26T16:29:22Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix configure quiet mode as it lets a few things through",
    "type": "issue",
    "updated_at": "2020-08-07T19:07:26Z",
    "url": "https://github.com/sagemath/sage/issues/30224",
    "user": "https://github.com/slel"
}
```
In a fresh git clone of Sage 9.2.beta6, `./configure -q`
printed two lines to stdout and one to stderr.

```
$ ./configure -q
11.4.3
1.5.3
(ignoring conda because no environment is active) $
```

To figure out where these come from, I ran `./configure`
in non-quiet mode, redirecting stdout to a file:

```
$ ./configure > dot-slash-configure-out.txt
(ignoring conda because no environment is active) $
```
and again, redirecting both stdout and stderr to a file:

```
$ ./configure > dot-slash-configure-out-err.txt 2>&1
$
```

The corresponding lines when running without `-q` seem to be:

```
...
Checking whether SageMath should install SPKG ntl...
...
checking NTL version >= 10.3... 11.4.3
...
Checking whether SageMath should install SPKG mpfi...
...
checking MPFI version >= 1.5... 1.5.3
...
checking for the package system in use... (ignoring conda
because no environment is active) homebrew
...
```
The `(ignoring conda ...)` part seems to go to stderr instead of stdout.

Initial report:

- [sage-devel post, 2020-07-26](https://groups.google.com/d/topic/sage-devel/TRdqXvmDISA/discussion)


CC:  @mkoeppe @slel @dimpase @orlitzky

Keywords: **quiet**

Branch/Commit: **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**

Reviewer: **Samuel Leli√®vre, Michael Orlitzky**

Author: **Matthias Koeppe**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/30224_





---

archive/issue_events_416286.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-26T16:29:22Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416286"
}
```



---

archive/issue_events_416287.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-26T16:29:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416287"
}
```



---

archive/issue_events_416288.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-26T16:29:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416288"
}
```



---

archive/issue_events_416289.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-26T16:29:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416289"
}
```



---

archive/issue_comments_478996.json:
```json
{
    "body": "Branch: **[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)**",
    "created_at": "2020-07-26T16:37:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-478996",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)**



---

archive/issue_comments_478997.json:
```json
{
    "body": "Commit: **[`38e0026`](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)**",
    "created_at": "2020-07-26T17:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-478997",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`38e0026`](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)**



---

archive/issue_comments_478998.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48556673fc8aa4f601c132e7910f95cd3f1e62a1\"><code>4855667</code></a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Send ntl version to config.log</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00\"><code>38e0026</code></a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Remove duplicate messages</code></td></tr></table>\n",
    "created_at": "2020-07-26T17:30:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-478998",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48556673fc8aa4f601c132e7910f95cd3f1e62a1"><code>4855667</code></a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Send ntl version to config.log</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00"><code>38e0026</code></a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Remove duplicate messages</code></td></tr></table>




---

archive/issue_comments_478999.json:
```json
{
    "body": "Changed commit from **[`38e0026`](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)** to **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**",
    "created_at": "2020-07-26T17:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-478999",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`38e0026`](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)** to **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**



---

archive/issue_comments_479000.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4\"><code>425dbfb</code></a></td><td><code>build/pkgs/mpfi/spkg-configure.m4: Send mpfi version to config.log</code></td></tr></table>\n",
    "created_at": "2020-07-26T17:33:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479000",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:3"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4"><code>425dbfb</code></a></td><td><code>build/pkgs/mpfi/spkg-configure.m4: Send mpfi version to config.log</code></td></tr></table>




---

archive/issue_events_416290.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-26T17:40:30Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416290"
}
```



---

archive/issue_comments_479001.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-26T17:40:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479001",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_events_416291.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-29T16:00:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416291"
}
```



---

archive/issue_events_416292.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-29T16:00:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416292"
}
```



---

archive/issue_comments_479002.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nI see no improvement after applying this branch.\n\nThis is on macOS:\n\n```\n$ git checkout develop\n$ make distclean\n$ git trac try 30224\n$ ./configure -q\n11.4.3\n1.5.3\n(ignoring conda because no environment is active) $\n```",
    "created_at": "2020-07-29T16:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479002",
    "user": "https://github.com/slel"
}
```

<div id="comment:6" align="right">comment:6</div>

I see no improvement after applying this branch.

This is on macOS:

```
$ git checkout develop
$ make distclean
$ git trac try 30224
$ ./configure -q
11.4.3
1.5.3
(ignoring conda because no environment is active) $
```



---

archive/issue_comments_479003.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nDid you run `./bootstrap`?",
    "created_at": "2020-07-29T17:20:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479003",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Did you run `./bootstrap`?



---

archive/issue_events_416293.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-29T19:15:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416293"
}
```



---

archive/issue_events_416294.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-07-29T19:15:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416294"
}
```



---

archive/issue_comments_479004.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI did not know to run `./bootstrap` and don't know much about it.\n\nI thought `./bootstrap` was automatically run by `./configure`.\n\nI guess that is what happens on a fresh clone.\n\nNow I realise `make distclean` does not clean all the way to the fresh clone state.\n\nThanks to your hint I now ran the following and quiet mode works!\n\n```\n$ ./bootstrap\nsrc/doc/bootstrap:52: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt\nsrc/doc/bootstrap:59: installing src/doc/en/reference/spkg/*.rst\nsrc/doc/bootstrap:89: installing src/doc/en/reference/repl/options.txt\nbootstrap:69: installing 'config/config.rpath'\nconfigure.ac:314: installing 'config/compile'\nconfigure.ac:89: installing 'config/config.guess'\nconfigure.ac:89: installing 'config/config.sub'\nconfigure.ac:43: installing 'config/install-sh'\nconfigure.ac:43: installing 'config/missing'\n$ ./configure -q\n$\n```\n\nPositive review from me but please anyone more knowledgeable have a look too.",
    "created_at": "2020-07-29T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479004",
    "user": "https://github.com/slel"
}
```

<div id="comment:8" align="right">comment:8</div>

I did not know to run `./bootstrap` and don't know much about it.

I thought `./bootstrap` was automatically run by `./configure`.

I guess that is what happens on a fresh clone.

Now I realise `make distclean` does not clean all the way to the fresh clone state.

Thanks to your hint I now ran the following and quiet mode works!

```
$ ./bootstrap
src/doc/bootstrap:52: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt
src/doc/bootstrap:59: installing src/doc/en/reference/spkg/*.rst
src/doc/bootstrap:89: installing src/doc/en/reference/repl/options.txt
bootstrap:69: installing 'config/config.rpath'
configure.ac:314: installing 'config/compile'
configure.ac:89: installing 'config/config.guess'
configure.ac:89: installing 'config/config.sub'
configure.ac:43: installing 'config/install-sh'
configure.ac:43: installing 'config/missing'
$ ./configure -q
$
```

Positive review from me but please anyone more knowledgeable have a look too.



---

archive/issue_comments_479005.json:
```json
{
    "body": "Reviewer: **Samuel Leli\u00e8vre**",
    "created_at": "2020-07-29T19:15:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479005",
    "user": "https://github.com/slel"
}
```

Reviewer: **Samuel Leli√®vre**



---

archive/issue_comments_479006.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nThanks!",
    "created_at": "2020-07-29T19:39:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479006",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Thanks!



---

archive/issue_comments_479007.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nReplying to [@slel](#comment:8):\n> I thought `./bootstrap` was automatically run by `./configure`.\n\n`configure` does not run it, but `make` runs it when the `configure` script does not exist or is older than its sources files (`configure.ac` and various stuff in `m4`, `build/pkgs`).",
    "created_at": "2020-07-29T19:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479007",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

Replying to [@slel](#comment:8):
> I thought `./bootstrap` was automatically run by `./configure`.

`configure` does not run it, but `make` runs it when the `configure` script does not exist or is older than its sources files (`configure.ac` and various stuff in `m4`, `build/pkgs`).



---

archive/issue_comments_479008.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nTwo comments:\n\n1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\n2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...",
    "created_at": "2020-07-30T23:21:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479008",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:11" align="right">comment:11</div>

Two comments:

1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?

2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...



---

archive/issue_comments_479009.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@orlitzky](#comment:11):\n> 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\nIt ends up in config.log, where I think it is valuable.\n\n> 2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...\n\nIt is crucial to separate the two types of output -- the package system and the information message -- because the package system is also processed by a script. The information message is for humans.",
    "created_at": "2020-07-30T23:51:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479009",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@orlitzky](#comment:11):
> 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?

It ends up in config.log, where I think it is valuable.

> 2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...

It is crucial to separate the two types of output -- the package system and the information message -- because the package system is also processed by a script. The information message is for humans.



---

archive/issue_comments_479010.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mkoeppe](#comment:12):\n> Replying to [@orlitzky](#comment:11):\n> > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\n> \n> It ends up in config.log, where I think it is valuable.\n\nIn that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools, but some day someone may want to redirect stdout/stderr to separate files and it would be nice if stderr didn't contain normal output from the \"checking...\" results.",
    "created_at": "2020-07-31T00:21:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479010",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mkoeppe](#comment:12):
> Replying to [@orlitzky](#comment:11):
> > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?

> 
> It ends up in config.log, where I think it is valuable.

In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools, but some day someone may want to redirect stdout/stderr to separate files and it would be nice if stderr didn't contain normal output from the "checking..." results.



---

archive/issue_comments_479011.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@orlitzky](#comment:13):\n> Replying to [@mkoeppe](#comment:12):\n> > Replying to [@orlitzky](#comment:11):\n> > > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\n> > \n> > It ends up in config.log, where I think it is valuable.\n\n> \n> In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools [...]\n\nYou can learn about them here:\nhttps://www.gnu.org/software/autoconf/manual/autoconf-2.60/html_node/File-Descriptor-Macros.html\n\nI am using it as documented.",
    "created_at": "2020-07-31T00:27:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479011",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@orlitzky](#comment:13):
> Replying to [@mkoeppe](#comment:12):
> > Replying to [@orlitzky](#comment:11):
> > > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?

> > 
> > It ends up in config.log, where I think it is valuable.

> 
> In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools [...]

You can learn about them here:
https://www.gnu.org/software/autoconf/manual/autoconf-2.60/html_node/File-Descriptor-Macros.html

I am using it as documented.



---

archive/issue_comments_479012.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWhat I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the \"checking...\" output, and should ultimately be sent to `AS_MESSAGE_FD`. Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? Or just somewhere else that happens to work out?\n\nWhat I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. I think that will still solve the problem, because that's what you're doing for the conda warning. It's also more explicit and doesn't rely on whatever magic causes `stderr` within `AC_RUN_IFELSE` to get redirected to someplace that winds up in config.log but not the console when `-q` is given.",
    "created_at": "2020-07-31T00:46:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479012",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:15" align="right">comment:15</div>

What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the "checking..." output, and should ultimately be sent to `AS_MESSAGE_FD`. Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? Or just somewhere else that happens to work out?

What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. I think that will still solve the problem, because that's what you're doing for the conda warning. It's also more explicit and doesn't rely on whatever magic causes `stderr` within `AC_RUN_IFELSE` to get redirected to someplace that winds up in config.log but not the console when `-q` is given.



---

archive/issue_comments_479013.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@orlitzky](#comment:15):\n> What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the \"checking...\" output, and should ultimately be sent to `AS_MESSAGE_FD`.\n\nYes, all messages that should be shown to the user need to be sent to `AS_MESSAGE_FD`. That's what all the autoconf macros for printing do.\n\n> Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? \n\n`AC_RUN_IFELSE` redirects stderr to `AS_MESSAGE_LOG_FD`. This is how compiler warnings/errors end up in `config.log`. I have the test program print to stderr for this reason. Neither compilers nor test programs have any business of printing to stdout. `AC_RUN_IFELSE` does not redirect stdout.\n\n> What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. \n\nNo, I want it to go the log, not to the terminal: At the terminal, only \"yes\" or \"no\" is needed. The user will need the detail of what specific version was found (and determined to be insufficient) only for diagnostic purposes; hence, the log. So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.",
    "created_at": "2020-07-31T01:08:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479013",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@orlitzky](#comment:15):
> What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the "checking..." output, and should ultimately be sent to `AS_MESSAGE_FD`.

Yes, all messages that should be shown to the user need to be sent to `AS_MESSAGE_FD`. That's what all the autoconf macros for printing do.

> Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? 

`AC_RUN_IFELSE` redirects stderr to `AS_MESSAGE_LOG_FD`. This is how compiler warnings/errors end up in `config.log`. I have the test program print to stderr for this reason. Neither compilers nor test programs have any business of printing to stdout. `AC_RUN_IFELSE` does not redirect stdout.

> What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. 

No, I want it to go the log, not to the terminal: At the terminal, only "yes" or "no" is needed. The user will need the detail of what specific version was found (and determined to be insufficient) only for diagnostic purposes; hence, the log. So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.



---

archive/issue_comments_479014.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment:16):\n> So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.\n\nI was thinking of\n\n```\nfprintf((FILE*)]]AS_MESSAGE_LOG_FD[[,...\n```\n\nbut now that I've tried it, it was nonsense to begin with. The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line. So everything's fine here.",
    "created_at": "2020-07-31T02:08:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479014",
    "user": "https://github.com/orlitzky"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment:16):
> So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.

I was thinking of

```
fprintf((FILE*)]]AS_MESSAGE_LOG_FD[[,...
```

but now that I've tried it, it was nonsense to begin with. The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line. So everything's fine here.



---

archive/issue_comments_479015.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@orlitzky](#comment:17):\n> The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line.\n\nThat's right.\n\nGlad to clear this up!",
    "created_at": "2020-07-31T02:20:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479015",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@orlitzky](#comment:17):
> The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line.

That's right.

Glad to clear this up!



---

archive/issue_comments_479016.json:
```json
{
    "body": "Changed reviewer from **Samuel Leli\u00e8vre** to **Samuel Leli\u00e8vre, Michael Orlitzky**",
    "created_at": "2020-07-31T02:24:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479016",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Samuel Leli√®vre** to **Samuel Leli√®vre, Michael Orlitzky**



---

archive/issue_comments_479017.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,13 +12,13 @@\n in non-quiet mode, redirecting stdout to a file:\n \n ```\n-$ ./configure > dot-slash-configure-output.txt\n+$ ./configure > dot-slash-configure-out.txt\n (ignoring conda because no environment is active) $\n ```\n and again, redirecting both stdout and stderr to a file:\n \n ```\n-$ ./configure > dot-slash-configure-output.txt\n+$ ./configure > dot-slash-configure-out-err.txt 2>&1\n $\n ```\n \n``````\n",
    "created_at": "2020-08-03T01:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479017",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,13 +12,13 @@
 in non-quiet mode, redirecting stdout to a file:
 
 ```
-$ ./configure > dot-slash-configure-output.txt
+$ ./configure > dot-slash-configure-out.txt
 (ignoring conda because no environment is active) $
 ```
 and again, redirecting both stdout and stderr to a file:
 
 ```
-$ ./configure > dot-slash-configure-output.txt
+$ ./configure > dot-slash-configure-out-err.txt 2>&1
 $
 ```
 
``````




---

archive/issue_comments_479018.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nOn Debian 10 \"buster\" I observed one more such \"leak\" when\n\n```\nchecking whether we have a properly patched Symmetrica version... \n```\nwhich outputs blocks of size 1x1, 2x2, 3x3, 5x5, 7x7 looking like\n\n```\n[1:0:0]\n[1:1:0]\n[1:2:1]\n```\nFix that here or in a follow-up ticket?",
    "created_at": "2020-08-03T01:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479018",
    "user": "https://github.com/slel"
}
```

<div id="comment:20" align="right">comment:20</div>

On Debian 10 "buster" I observed one more such "leak" when

```
checking whether we have a properly patched Symmetrica version... 
```
which outputs blocks of size 1x1, 2x2, 3x3, 5x5, 7x7 looking like

```
[1:0:0]
[1:1:0]
[1:2:1]
```
Fix that here or in a follow-up ticket?



---

archive/issue_comments_479019.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe file `build/pkgs/symmetrica/spkg-configure.m4` is not similar\nenough to the NTL and MPFI ones that I can figure out a fix.\nIn passing, its indentation mixes tabs and spaces.",
    "created_at": "2020-08-03T01:48:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479019",
    "user": "https://github.com/slel"
}
```

<div id="comment:21" align="right">comment:21</div>

The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar
enough to the NTL and MPFI ones that I can figure out a fix.
In passing, its indentation mixes tabs and spaces.



---

archive/issue_comments_479020.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@slel](#comment:21):\n> The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar\n> enough to the NTL and MPFI ones that I can figure out a fix.\n> In passing, its indentation mixes tabs and spaces.\n\nthe output is done by symmetrica's function `println()`. A hopefully suitable replacement is called `fprintln()` - I never tried it, but you're welcome to dig up the docs on it and try.",
    "created_at": "2020-08-03T09:28:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479020",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@slel](#comment:21):
> The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar
> enough to the NTL and MPFI ones that I can figure out a fix.
> In passing, its indentation mixes tabs and spaces.

the output is done by symmetrica's function `println()`. A hopefully suitable replacement is called `fprintln()` - I never tried it, but you're welcome to dig up the docs on it and try.



---

archive/issue_comments_479021.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows\n\n```\n-            [println(b);]\n+            [fprintln(stderr, b);]\n```\ndoes the trick. Should I push a commit here or in a new ticket depending on this one?",
    "created_at": "2020-08-03T14:28:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479021",
    "user": "https://github.com/slel"
}
```

<div id="comment:23" align="right">comment:23</div>

Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows

```
-            [println(b);]
+            [fprintln(stderr, b);]
```
does the trick. Should I push a commit here or in a new ticket depending on this one?



---

archive/issue_comments_479022.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@slel](#comment:23):\n> Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows\n> \n> ```\n> -            [println(b);]\n> +            [fprintln(stderr, b);]\n> ```\n> does the trick. Should I push a commit here or in a new ticket depending on this one?\n\nA new ticket with the branch based on this one is better.",
    "created_at": "2020-08-03T16:14:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479022",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@slel](#comment:23):
> Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows
> 
> ```
> -            [println(b);]
> +            [fprintln(stderr, b);]
> ```
> does the trick. Should I push a commit here or in a new ticket depending on this one?

A new ticket with the branch based on this one is better.



---

archive/issue_comments_479023.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI opened #30282 for `build/pkgs/symmetrica/spkg-configure.m4`.",
    "created_at": "2020-08-03T17:34:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479023",
    "user": "https://github.com/slel"
}
```

<div id="comment:25" align="right">comment:25</div>

I opened #30282 for `build/pkgs/symmetrica/spkg-configure.m4`.



---

archive/issue_events_416295.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:07:26Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416295"
}
```



---

archive/issue_events_416296.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "26f3a5e7b840111ba3410d2e9103268d5af792bc",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-07T19:07:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30224#event-416296"
}
```



---

archive/issue_comments_479024.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)** to **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**",
    "created_at": "2020-08-07T19:07:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30224#issuecomment-479024",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)** to **[`425dbfb`](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)**
