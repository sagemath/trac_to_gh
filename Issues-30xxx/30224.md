# Issue 30224: Fix configure quiet mode as it lets a few things through

archive/issues_029987.json:
```json
{
    "body": "In a fresh git clone of Sage 9.2.beta6, `./configure -q`\nprinted two lines to stdout and one to stderr.\n\n```\n$ ./configure -q\n11.4.3\n1.5.3\n(ignoring conda because no environment is active) $\n```\n\nTo figure out where these come from, I ran `./configure`\nin non-quiet mode, redirecting stdout to a file:\n\n```\n$ ./configure > dot-slash-configure-out.txt\n(ignoring conda because no environment is active) $\n```\nand again, redirecting both stdout and stderr to a file:\n\n```\n$ ./configure > dot-slash-configure-out-err.txt 2>&1\n$\n```\n\nThe corresponding lines when running without `-q` seem to be:\n\n```\n...\nChecking whether SageMath should install SPKG ntl...\n...\nchecking NTL version >= 10.3... 11.4.3\n...\nChecking whether SageMath should install SPKG mpfi...\n...\nchecking MPFI version >= 1.5... 1.5.3\n...\nchecking for the package system in use... (ignoring conda\nbecause no environment is active) homebrew\n...\n```\nThe `(ignoring conda ...)` part seems to go to stderr instead of stdout.\n\nInitial report:\n\n- [sage-devel post, 2020-07-26](https://groups.google.com/d/topic/sage-devel/TRdqXvmDISA/discussion)\n\n\n**CC:**  @mkoeppe @slel @dimpase @orlitzky\n\n**Keywords:** quiet\n\n**Branch/Commit:** [425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)\n\n**Reviewer:** Samuel Leli\u00e8vre, Michael Orlitzky\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/30224\n\n",
    "closed_at": "2020-08-07T19:07:26Z",
    "created_at": "2020-07-26T16:29:22Z",
    "labels": [
        "component: build: configure",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Fix configure quiet mode as it lets a few things through",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30224",
    "user": "https://github.com/slel"
}
```
In a fresh git clone of Sage 9.2.beta6, `./configure -q`
printed two lines to stdout and one to stderr.

```
$ ./configure -q
11.4.3
1.5.3
(ignoring conda because no environment is active) $
```

To figure out where these come from, I ran `./configure`
in non-quiet mode, redirecting stdout to a file:

```
$ ./configure > dot-slash-configure-out.txt
(ignoring conda because no environment is active) $
```
and again, redirecting both stdout and stderr to a file:

```
$ ./configure > dot-slash-configure-out-err.txt 2>&1
$
```

The corresponding lines when running without `-q` seem to be:

```
...
Checking whether SageMath should install SPKG ntl...
...
checking NTL version >= 10.3... 11.4.3
...
Checking whether SageMath should install SPKG mpfi...
...
checking MPFI version >= 1.5... 1.5.3
...
checking for the package system in use... (ignoring conda
because no environment is active) homebrew
...
```
The `(ignoring conda ...)` part seems to go to stderr instead of stdout.

Initial report:

- [sage-devel post, 2020-07-26](https://groups.google.com/d/topic/sage-devel/TRdqXvmDISA/discussion)


**CC:**  @mkoeppe @slel @dimpase @orlitzky

**Keywords:** quiet

**Branch/Commit:** [425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)

**Reviewer:** Samuel Lelièvre, Michael Orlitzky

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/30224





---

archive/issue_comments_567271.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)",
    "created_at": "2020-07-26T16:37:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567271",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)



---

archive/issue_comments_567272.json:
```json
{
    "body": "**Commit:** [38e002623472bb86edf2aeada4c7cd1d27116b00](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)",
    "created_at": "2020-07-26T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567272",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [38e002623472bb86edf2aeada4c7cd1d27116b00](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)



---

archive/issue_comments_567273.json:
```json
{
    "body": "<a id='comment:2'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48556673fc8aa4f601c132e7910f95cd3f1e62a1\">4855667</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Send ntl version to config.log</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00\">38e0026</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Remove duplicate messages</code></td></tr></table>\n",
    "created_at": "2020-07-26T17:30:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567273",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48556673fc8aa4f601c132e7910f95cd3f1e62a1">4855667</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Send ntl version to config.log</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00">38e0026</a></td><td><code>build/pkgs/ntl/spkg-configure.m4: Remove duplicate messages</code></td></tr></table>




---

archive/issue_comments_567274.json:
```json
{
    "body": "**Changing commit** from \"[38e002623472bb86edf2aeada4c7cd1d27116b00](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)\" to \"[425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)\".",
    "created_at": "2020-07-26T17:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567274",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[38e002623472bb86edf2aeada4c7cd1d27116b00](https://github.com/sagemath/sagetrac-mirror/commit/38e002623472bb86edf2aeada4c7cd1d27116b00)" to "[425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)".



---

archive/issue_comments_567275.json:
```json
{
    "body": "<a id='comment:3'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4\">425dbfb</a></td><td><code>build/pkgs/mpfi/spkg-configure.m4: Send mpfi version to config.log</code></td></tr></table>\n",
    "created_at": "2020-07-26T17:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567275",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4">425dbfb</a></td><td><code>build/pkgs/mpfi/spkg-configure.m4: Send mpfi version to config.log</code></td></tr></table>




---

archive/issue_comments_567276.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-07-26T17:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567276",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_567277.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-07-26T17:40:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567277",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_567278.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-07-29T16:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567278",
    "user": "https://github.com/slel"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_567279.json:
```json
{
    "body": "<a id='comment:6'></a>\nI see no improvement after applying this branch.\n\nThis is on macOS:\n\n```\n$ git checkout develop\n$ make distclean\n$ git trac try 30224\n$ ./configure -q\n11.4.3\n1.5.3\n(ignoring conda because no environment is active) $\n```",
    "created_at": "2020-07-29T16:00:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567279",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>
I see no improvement after applying this branch.

This is on macOS:

```
$ git checkout develop
$ make distclean
$ git trac try 30224
$ ./configure -q
11.4.3
1.5.3
(ignoring conda because no environment is active) $
```



---

archive/issue_comments_567280.json:
```json
{
    "body": "<a id='comment:7'></a>\nDid you run `./bootstrap`?",
    "created_at": "2020-07-29T17:20:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567280",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Did you run `./bootstrap`?



---

archive/issue_comments_567281.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2020-07-29T19:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567281",
    "user": "https://github.com/slel"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_567282.json:
```json
{
    "body": "<a id='comment:8'></a>\nI did not know to run `./bootstrap` and don't know much about it.\n\nI thought `./bootstrap` was automatically run by `./configure`.\n\nI guess that is what happens on a fresh clone.\n\nNow I realise `make distclean` does not clean all the way to the fresh clone state.\n\nThanks to your hint I now ran the following and quiet mode works!\n\n```\n$ ./bootstrap\nsrc/doc/bootstrap:52: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt\nsrc/doc/bootstrap:52: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt\nsrc/doc/bootstrap:59: installing src/doc/en/reference/spkg/*.rst\nsrc/doc/bootstrap:89: installing src/doc/en/reference/repl/options.txt\nbootstrap:69: installing 'config/config.rpath'\nconfigure.ac:314: installing 'config/compile'\nconfigure.ac:89: installing 'config/config.guess'\nconfigure.ac:89: installing 'config/config.sub'\nconfigure.ac:43: installing 'config/install-sh'\nconfigure.ac:43: installing 'config/missing'\n$ ./configure -q\n$\n```\n\nPositive review from me but please anyone more knowledgeable have a look too.",
    "created_at": "2020-07-29T19:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567282",
    "user": "https://github.com/slel"
}
```

<a id='comment:8'></a>
I did not know to run `./bootstrap` and don't know much about it.

I thought `./bootstrap` was automatically run by `./configure`.

I guess that is what happens on a fresh clone.

Now I realise `make distclean` does not clean all the way to the fresh clone state.

Thanks to your hint I now ran the following and quiet mode works!

```
$ ./bootstrap
src/doc/bootstrap:52: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt
src/doc/bootstrap:52: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt
src/doc/bootstrap:59: installing src/doc/en/reference/spkg/*.rst
src/doc/bootstrap:89: installing src/doc/en/reference/repl/options.txt
bootstrap:69: installing 'config/config.rpath'
configure.ac:314: installing 'config/compile'
configure.ac:89: installing 'config/config.guess'
configure.ac:89: installing 'config/config.sub'
configure.ac:43: installing 'config/install-sh'
configure.ac:43: installing 'config/missing'
$ ./configure -q
$
```

Positive review from me but please anyone more knowledgeable have a look too.



---

archive/issue_comments_567283.json:
```json
{
    "body": "**Reviewer:** Samuel Leli\u00e8vre",
    "created_at": "2020-07-29T19:15:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567283",
    "user": "https://github.com/slel"
}
```

**Reviewer:** Samuel Lelièvre



---

archive/issue_comments_567284.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks!",
    "created_at": "2020-07-29T19:39:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567284",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Thanks!



---

archive/issue_comments_567285.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [slelievre](#comment%3A8):\n> I thought `./bootstrap` was automatically run by `./configure`.\n\n\n`configure` does not run it, but `make` runs it when the `configure` script does not exist or is older than its sources files (`configure.ac` and various stuff in `m4`, `build/pkgs`).",
    "created_at": "2020-07-29T19:42:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567285",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [slelievre](#comment%3A8):
> I thought `./bootstrap` was automatically run by `./configure`.


`configure` does not run it, but `make` runs it when the `configure` script does not exist or is older than its sources files (`configure.ac` and various stuff in `m4`, `build/pkgs`).



---

archive/issue_comments_567286.json:
```json
{
    "body": "<a id='comment:11'></a>\nTwo comments:\n\n1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\n2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...",
    "created_at": "2020-07-30T23:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567286",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:11'></a>
Two comments:

1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?

2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...



---

archive/issue_comments_567287.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mjo](#comment%3A11):\n> 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n\n\nIt ends up in config.log, where I think it is valuable.\n\n> 2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...\n\n\nIt is crucial to separate the two types of output -- the package system and the information message -- because the package system is also processed by a script. The information message is for humans.",
    "created_at": "2020-07-30T23:51:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567287",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
Replying to [mjo](#comment%3A11):
> 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?


It ends up in config.log, where I think it is valuable.

> 2. The output from sage-guess-package-system doesn't look like an error to me, it's more informational. Maybe it should just be printed to stdout as well? Especially if the solution is going to be to redirect it again...


It is crucial to separate the two types of output -- the package system and the information message -- because the package system is also processed by a script. The information message is for humans.



---

archive/issue_comments_567288.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [mkoeppe](#comment%3A12):\n> Replying to [mjo](#comment%3A11):\n> > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n  \n> \n> It ends up in config.log, where I think it is valuable.\n\n\nIn that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools, but some day someone may want to redirect stdout/stderr to separate files and it would be nice if stderr didn't contain normal output from the \"checking...\" results.",
    "created_at": "2020-07-31T00:21:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567288",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:13'></a>
Replying to [mkoeppe](#comment%3A12):
> Replying to [mjo](#comment%3A11):
> > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?
  
> 
> It ends up in config.log, where I think it is valuable.


In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools, but some day someone may want to redirect stdout/stderr to separate files and it would be nice if stderr didn't contain normal output from the "checking..." results.



---

archive/issue_comments_567289.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [mjo](#comment%3A13):\n> Replying to [mkoeppe](#comment%3A12):\n> > Replying to [mjo](#comment%3A11):\n> > > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?\n  \n> > \n> > It ends up in config.log, where I think it is valuable.\n\n> \n> In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools [...]\n\n\nYou can learn about them here:\nhttps://www.gnu.org/software/autoconf/manual/autoconf-2.60/html_node/File-Descriptor-Macros.html\n\nI am using it as documented.",
    "created_at": "2020-07-31T00:27:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567289",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Replying to [mjo](#comment%3A13):
> Replying to [mkoeppe](#comment%3A12):
> > Replying to [mjo](#comment%3A11):
> > > 1. The MPFI/NTL checks don't need to print anything at all. Could we simply delete the `prinf()` calls there instead of sending them to stderr, since they're not errors?
  
> > 
> > It ends up in config.log, where I think it is valuable.

> 
> In that case, we could send them directly to `AS_MESSAGE_FD` or `AS_MESSAGE_LOG_FD` instead of passing through `stderr`? I'm not 100% sure what goes on with all of the output/error descriptors in autotools [...]


You can learn about them here:
https://www.gnu.org/software/autoconf/manual/autoconf-2.60/html_node/File-Descriptor-Macros.html

I am using it as documented.



---

archive/issue_comments_567290.json:
```json
{
    "body": "<a id='comment:15'></a>\nWhat I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the \"checking...\" output, and should ultimately be sent to `AS_MESSAGE_FD`. Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? Or just somewhere else that happens to work out?\n\nWhat I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. I think that will still solve the problem, because that's what you're doing for the conda warning. It's also more explicit and doesn't rely on whatever magic causes `stderr` within `AC_RUN_IFELSE` to get redirected to someplace that winds up in config.log but not the console when `-q` is given.",
    "created_at": "2020-07-31T00:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567290",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:15'></a>
What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the "checking..." output, and should ultimately be sent to `AS_MESSAGE_FD`. Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? Or just somewhere else that happens to work out?

What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. I think that will still solve the problem, because that's what you're doing for the conda warning. It's also more explicit and doesn't rely on whatever magic causes `stderr` within `AC_RUN_IFELSE` to get redirected to someplace that winds up in config.log but not the console when `-q` is given.



---

archive/issue_comments_567291.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mjo](#comment%3A15):\n> What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the \"checking...\" output, and should ultimately be sent to `AS_MESSAGE_FD`.\n\n\nYes, all messages that should be shown to the user need to be sent to `AS_MESSAGE_FD`. That's what all the autoconf macros for printing do.\n\n> Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? \n\n\n`AC_RUN_IFELSE` redirects stderr to `AS_MESSAGE_LOG_FD`. This is how compiler warnings/errors end up in `config.log`. I have the test program print to stderr for this reason. Neither compilers nor test programs have any business of printing to stdout. `AC_RUN_IFELSE` does not redirect stdout.\n\n> What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. \n\n\nNo, I want it to go the log, not to the terminal: At the terminal, only \"yes\" or \"no\" is needed. The user will need the detail of what specific version was found (and determined to be insufficient) only for diagnostic purposes; hence, the log. So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.",
    "created_at": "2020-07-31T01:08:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567291",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Replying to [mjo](#comment%3A15):
> What I'm unsure of is the bigger picture of what check output gets redirected where. The version number printed by the two test programs is arguably part of the "checking..." output, and should ultimately be sent to `AS_MESSAGE_FD`.


Yes, all messages that should be shown to the user need to be sent to `AS_MESSAGE_FD`. That's what all the autoconf macros for printing do.

> Apparently that doesn't happen right now, otherwise this ticket wouldn't exist, so `stdout` within `AC_RUN_IFELSE` must wind up somewhere other than `AS_MESSAGE_FD`. How printing to `stderr` fixes the issue is what's unclear to me; does `stderr` from within the `AC_RUN_IFELSE` macro get redirected to `AS_MESSAGE_FD`? 


`AC_RUN_IFELSE` redirects stderr to `AS_MESSAGE_LOG_FD`. This is how compiler warnings/errors end up in `config.log`. I have the test program print to stderr for this reason. Neither compilers nor test programs have any business of printing to stdout. `AC_RUN_IFELSE` does not redirect stdout.

> What I was suggesting is that within those two test programs, we use `AS_MESSAGE_FD` instead of the constant `stderr`. 


No, I want it to go the log, not to the terminal: At the terminal, only "yes" or "no" is needed. The user will need the detail of what specific version was found (and determined to be insufficient) only for diagnostic purposes; hence, the log. So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.



---

archive/issue_comments_567292.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [mkoeppe](#comment%3A16):\n> So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.\n\n\nI was thinking of\n\n```\nfprintf((FILE*)]]AS_MESSAGE_LOG_FD[[,...\n```\n\nbut now that I've tried it, it was nonsense to begin with. The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line. So everything's fine here.",
    "created_at": "2020-07-31T02:08:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567292",
    "user": "https://github.com/orlitzky"
}
```

<a id='comment:17'></a>
Replying to [mkoeppe](#comment%3A16):
> So `AS_MESSAGE_LOG_FD`, not `AS_MESSAGE_FD`.


I was thinking of

```
fprintf((FILE*)]]AS_MESSAGE_LOG_FD[[,...
```

but now that I've tried it, it was nonsense to begin with. The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line. So everything's fine here.



---

archive/issue_comments_567293.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [mjo](#comment%3A17):\n> The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line.\n\n\nThat's right.\n\nGlad to clear this up!",
    "created_at": "2020-07-31T02:20:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567293",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [mjo](#comment%3A17):
> The file descriptor from the parent shell is meaningless in the newly-compiled program, and we don't have a way to append `>&AS_MESSAGE_LOG_FD` to the command-line.


That's right.

Glad to clear this up!



---

archive/issue_comments_567294.json:
```json
{
    "body": "**Changing reviewer** from \"Samuel Leli\u00e8vre\" to \"Samuel Leli\u00e8vre, Michael Orlitzky\".",
    "created_at": "2020-07-31T02:24:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567294",
    "user": "https://github.com/mkoeppe"
}
```

**Changing reviewer** from "Samuel Lelièvre" to "Samuel Lelièvre, Michael Orlitzky".



---

archive/issue_comments_567295.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -12,13 +12,13 @@\n in non-quiet mode, redirecting stdout to a file:\n \n ```\n-$ ./configure > dot-slash-configure-output.txt\n+$ ./configure > dot-slash-configure-out.txt\n (ignoring conda because no environment is active) $\n ```\n and again, redirecting both stdout and stderr to a file:\n \n ```\n-$ ./configure > dot-slash-configure-output.txt\n+$ ./configure > dot-slash-configure-out-err.txt 2>&1\n $\n ```\n \n``````\n",
    "created_at": "2020-08-03T01:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567295",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -12,13 +12,13 @@
 in non-quiet mode, redirecting stdout to a file:
 
 ```
-$ ./configure > dot-slash-configure-output.txt
+$ ./configure > dot-slash-configure-out.txt
 (ignoring conda because no environment is active) $
 ```
 and again, redirecting both stdout and stderr to a file:
 
 ```
-$ ./configure > dot-slash-configure-output.txt
+$ ./configure > dot-slash-configure-out-err.txt 2>&1
 $
 ```
 
``````




---

archive/issue_comments_567296.json:
```json
{
    "body": "<a id='comment:20'></a>\nOn Debian 10 \"buster\" I observed one more such \"leak\" when\n\n```\nchecking whether we have a properly patched Symmetrica version... \n```\nwhich outputs blocks of size 1x1, 2x2, 3x3, 5x5, 7x7 looking like\n\n```\n[1:0:0]\n[1:1:0]\n[1:2:1]\n```\nFix that here or in a follow-up ticket?",
    "created_at": "2020-08-03T01:39:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567296",
    "user": "https://github.com/slel"
}
```

<a id='comment:20'></a>
On Debian 10 "buster" I observed one more such "leak" when

```
checking whether we have a properly patched Symmetrica version... 
```
which outputs blocks of size 1x1, 2x2, 3x3, 5x5, 7x7 looking like

```
[1:0:0]
[1:1:0]
[1:2:1]
```
Fix that here or in a follow-up ticket?



---

archive/issue_comments_567297.json:
```json
{
    "body": "<a id='comment:21'></a>\nThe file `build/pkgs/symmetrica/spkg-configure.m4` is not similar\nenough to the NTL and MPFI ones that I can figure out a fix.\nIn passing, its indentation mixes tabs and spaces.",
    "created_at": "2020-08-03T01:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567297",
    "user": "https://github.com/slel"
}
```

<a id='comment:21'></a>
The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar
enough to the NTL and MPFI ones that I can figure out a fix.
In passing, its indentation mixes tabs and spaces.



---

archive/issue_comments_567298.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [slelievre](#comment%3A21):\n> The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar\n> enough to the NTL and MPFI ones that I can figure out a fix.\n> In passing, its indentation mixes tabs and spaces.\n\n\nthe output is done by symmetrica's function `println()`. A hopefully suitable replacement is called `fprintln()` - I never tried it, but you're welcome to dig up the docs on it and try.",
    "created_at": "2020-08-03T09:28:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567298",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
Replying to [slelievre](#comment%3A21):
> The file `build/pkgs/symmetrica/spkg-configure.m4` is not similar
> enough to the NTL and MPFI ones that I can figure out a fix.
> In passing, its indentation mixes tabs and spaces.


the output is done by symmetrica's function `println()`. A hopefully suitable replacement is called `fprintln()` - I never tried it, but you're welcome to dig up the docs on it and try.



---

archive/issue_comments_567299.json:
```json
{
    "body": "<a id='comment:23'></a>\nThanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows\n\n```\n-            [println(b);]\n+            [fprintln(stderr, b);]\n```\ndoes the trick. Should I push a commit here or in a new ticket depending on this one?",
    "created_at": "2020-08-03T14:28:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567299",
    "user": "https://github.com/slel"
}
```

<a id='comment:23'></a>
Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows

```
-            [println(b);]
+            [fprintln(stderr, b);]
```
does the trick. Should I push a commit here or in a new ticket depending on this one?



---

archive/issue_comments_567300.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [slelievre](#comment%3A23):\n> Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows\n> \n> ```\n> -            [println(b);]\n> +            [fprintln(stderr, b);]\n> ```\n> does the trick. Should I push a commit here or in a new ticket depending on this one?\n\n\nA new ticket with the branch based on this one is better.",
    "created_at": "2020-08-03T16:14:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567300",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
Replying to [slelievre](#comment%3A23):
> Thanks Dima, I tried and indeed, on top of previous changes on this ticket, changing line 18 of file `build/pkgs/symmetrica/spkg-configure.m4` as follows
> 
> ```
> -            [println(b);]
> +            [fprintln(stderr, b);]
> ```
> does the trick. Should I push a commit here or in a new ticket depending on this one?


A new ticket with the branch based on this one is better.



---

archive/issue_comments_567301.json:
```json
{
    "body": "<a id='comment:25'></a>\nI opened #30282 for `build/pkgs/symmetrica/spkg-configure.m4`.",
    "created_at": "2020-08-03T17:34:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567301",
    "user": "https://github.com/slel"
}
```

<a id='comment:25'></a>
I opened #30282 for `build/pkgs/symmetrica/spkg-configure.m4`.



---

archive/issue_events_088386.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-07T19:07:26Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30224#event-88386"
}
```



---

archive/issue_comments_567302.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)\" to \"[425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)\".",
    "created_at": "2020-08-07T19:07:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30224",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30224#issuecomment-567302",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/fix_configure_quiet_mode_as_it_lets_a_few_things_through)" to "[425dbfb5b0f87310b5510fbf8788d4046222b7c4](https://github.com/sagemath/sagetrac-mirror/commit/425dbfb5b0f87310b5510fbf8788d4046222b7c4)".
