# Issue 30855: Refactor environment config variables to path

archive/issues_030618.json:
```json
{
    "assignees": [],
    "body": "Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to convert these stringl variables into the proper class (e.g. `Path` or `bool`).\n\nSince now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.\n\n**CC:**  @mkoeppe\n\n**Branch:** [public/refactoring/envVars](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/envVars)\n\n**Commit:** [7a32e5567dfe452d5b08409b5d71c9a859d5363b](https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b)\n\n**Reviewer:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/30855\n\n",
    "closed_at": "2021-08-26T02:08:43Z",
    "created_at": "2020-11-03T10:40:26Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20interfaces%3A%20optional",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Refactor environment config variables to path",
    "type": "issue",
    "updated_at": "2021-08-26T02:08:43Z",
    "url": "https://github.com/sagemath/sage/issues/30855",
    "user": "https://github.com/tobiasdiez"
}
```
Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to convert these stringl variables into the proper class (e.g. `Path` or `bool`).

Since now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.

**CC:**  @mkoeppe

**Branch:** [public/refactoring/envVars](https://github.com/sagemath/sagetrac-mirror/tree/public/refactoring/envVars)

**Commit:** [7a32e5567dfe452d5b08409b5d71c9a859d5363b](https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b)

**Reviewer:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/30855





---

archive/issue_events_276688.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2020-11-03T10:42:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276688"
}
```



---

archive/issue_comments_496869.json:
```json
{
    "body": "<a id='comment:2'></a>\nNote that in `sage.features` we have a rather similar approach to configuration. Can't redo this again in `sage.env`",
    "created_at": "2020-11-03T15:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496869",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Note that in `sage.features` we have a rather similar approach to configuration. Can't redo this again in `sage.env`



---

archive/issue_comments_496870.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks for the pointer to `sage.features`.\nIt seems that `sage.features.databases` is the closest to the refactoring done in this ticket. However, even there `sage.env.CREMONA_MINI_DATA_DIR` is used. I don't see any disadvantages of replacing this string variable with a method returning a `Path` object. In particular, there is no code duplication (although the code in `features.databases` can then easily be streamlined using the pathlib library).\n\nOr are you proposing to replace/encapsulate all variables in `sage.env` in separate features?",
    "created_at": "2020-11-03T16:35:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496870",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'></a>
Thanks for the pointer to `sage.features`.
It seems that `sage.features.databases` is the closest to the refactoring done in this ticket. However, even there `sage.env.CREMONA_MINI_DATA_DIR` is used. I don't see any disadvantages of replacing this string variable with a method returning a `Path` object. In particular, there is no code duplication (although the code in `features.databases` can then easily be streamlined using the pathlib library).

Or are you proposing to replace/encapsulate all variables in `sage.env` in separate features?



---

archive/issue_comments_496871.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [@tobiasdiez](#comment%3A3):\n> Thanks for the pointer to `sage.features`.\n> It seems that `sage.features.databases` is the closest to the refactoring done in this ticket. However, even there `sage.env.CREMONA_MINI_DATA_DIR` is used. \n\nYes, `sage.features.databases` provides an abstraction on top of `sage.env`.\n\nI would not consider it an improvement to put another, intermediate abstraction inside `sage.env`.",
    "created_at": "2020-11-03T16:55:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496871",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Replying to [@tobiasdiez](#comment%3A3):
> Thanks for the pointer to `sage.features`.
> It seems that `sage.features.databases` is the closest to the refactoring done in this ticket. However, even there `sage.env.CREMONA_MINI_DATA_DIR` is used. 

Yes, `sage.features.databases` provides an abstraction on top of `sage.env`.

I would not consider it an improvement to put another, intermediate abstraction inside `sage.env`.



---

archive/issue_comments_496872.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [@tobiasdiez](#comment%3A3):\n> are you proposing to replace/encapsulate all variables in `sage.env` in separate features?\n\nWell, encapsulating these variables is the direction in which the code added to `sage.features` has been going.",
    "created_at": "2020-11-03T16:58:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496872",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [@tobiasdiez](#comment%3A3):
> are you proposing to replace/encapsulate all variables in `sage.env` in separate features?

Well, encapsulating these variables is the direction in which the code added to `sage.features` has been going.



---

archive/issue_comments_496873.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [@mkoeppe](#comment%3A4):\n> I would not consider it an improvement to put another, intermediate abstraction inside `sage.env`. \n> \n\nI think you misunderstood my intention a bit. I didn't add another layer of abstraction, I just changed the interface to the same information. Instead of yielding a string path, it returns now a proper `Path` object. I can also readd the variable `ELLCURVE_DATA_DIR` having type `Path` if you prefer that instead of the getter-method. I just thought that since there is a disk access involved, it might speedup initiation a bit to encapsulate everything in a method. That can easily changed, of course.\n\n\n> Well, encapsulating these variables is the direction in which the code added to `sage.features` has been going. \n> \n\nok, but adding such an abstraction for the ellCurve data directory can be done later (and wasn't my intention).",
    "created_at": "2020-11-03T17:58:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496873",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>
Replying to [@mkoeppe](#comment%3A4):
> I would not consider it an improvement to put another, intermediate abstraction inside `sage.env`. 
> 

I think you misunderstood my intention a bit. I didn't add another layer of abstraction, I just changed the interface to the same information. Instead of yielding a string path, it returns now a proper `Path` object. I can also readd the variable `ELLCURVE_DATA_DIR` having type `Path` if you prefer that instead of the getter-method. I just thought that since there is a disk access involved, it might speedup initiation a bit to encapsulate everything in a method. That can easily changed, of course.


> Well, encapsulating these variables is the direction in which the code added to `sage.features` has been going. 
> 

ok, but adding such an abstraction for the ellCurve data directory can be done later (and wasn't my intention).



---

archive/issue_comments_496874.json:
```json
{
    "body": "<a id='comment:7'></a>\nThe patch is adding file system inspection to `sage.env` - this makes things less uniform.  The other database features are doing this in `sage.features` via `StaticFile`.",
    "created_at": "2020-11-03T18:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496874",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
The patch is adding file system inspection to `sage.env` - this makes things less uniform.  The other database features are doing this in `sage.features` via `StaticFile`.



---

archive/issue_comments_496875.json:
```json
{
    "body": "<a id='comment:8'></a>\nI agree, it's less uniform because of the special handling of paths.\n\nTo make things clear, can we agree that the following is the desired behavior for paths like the ellCurve data directory?\n1. If user sets the path via an env variable, and the path exists, take it.\n2. If not, but `sage.conf` sets a path that exists, take it.\n3. Else, fall back to hard-coded folder relative to `SAGE_SHARE`.\n\nI see the following two approaches:\nOption a) is to have all this logic in `sage.env` (maybe with a light wrapper in `sage.features`) and Option b) is to expose the steps 1 and 2 as methods `get_env_variable` and `get_sage_conf_variable` in `sage.env` and put the file check logic in `sage.features`. I have a light preference for Option a) as this would require the least amount of changes but Option b) also sounds fine with me. Which option do you prefer?",
    "created_at": "2020-11-03T19:22:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496875",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>
I agree, it's less uniform because of the special handling of paths.

To make things clear, can we agree that the following is the desired behavior for paths like the ellCurve data directory?
1. If user sets the path via an env variable, and the path exists, take it.
2. If not, but `sage.conf` sets a path that exists, take it.
3. Else, fall back to hard-coded folder relative to `SAGE_SHARE`.

I see the following two approaches:
Option a) is to have all this logic in `sage.env` (maybe with a light wrapper in `sage.features`) and Option b) is to expose the steps 1 and 2 as methods `get_env_variable` and `get_sage_conf_variable` in `sage.env` and put the file check logic in `sage.features`. I have a light preference for Option a) as this would require the least amount of changes but Option b) also sounds fine with me. Which option do you prefer?



---

archive/issue_comments_496876.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [@tobiasdiez](#comment%3A8):\n> To make things clear, can we agree that the following is the desired behavior for paths like the ellCurve data directory?\n> 1. If user sets the path via an env variable, and the path exists, take it.\n> 2. If not, but `sage.conf` sets a path that exists, take it.\n> 3. Else, fall back to hard-coded folder relative to `SAGE_SHARE`.\n\nThat's different and more complex than the current behavior. Do you need this? Then please clarify the ticket description - it's not just refactoring.",
    "created_at": "2020-11-03T19:29:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496876",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Replying to [@tobiasdiez](#comment%3A8):
> To make things clear, can we agree that the following is the desired behavior for paths like the ellCurve data directory?
> 1. If user sets the path via an env variable, and the path exists, take it.
> 2. If not, but `sage.conf` sets a path that exists, take it.
> 3. Else, fall back to hard-coded folder relative to `SAGE_SHARE`.

That's different and more complex than the current behavior. Do you need this? Then please clarify the ticket description - it's not just refactoring.



---

archive/issue_comments_496877.json:
```json
{
    "body": "<a id='comment:10'></a>\nI don't really need this, but thought it might be helpful / desired. If you don't think it's needed, then I can easily remove this extra logic again.",
    "created_at": "2020-11-03T19:34:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496877",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:10'></a>
I don't really need this, but thought it might be helpful / desired. If you don't think it's needed, then I can easily remove this extra logic again.



---

archive/issue_comments_496878.json:
```json
{
    "body": "<a id='comment:11'></a>\nOn a second thought, I actually need something like this in #30371. Not so much for paths but for package names. In fact the package name check implemented in #30706 has pretty much the same spirit as this the refactoring done in this ticket.",
    "created_at": "2020-11-03T20:12:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496878",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>
On a second thought, I actually need something like this in #30371. Not so much for paths but for package names. In fact the package name check implemented in #30706 has pretty much the same spirit as this the refactoring done in this ticket.



---

archive/issue_comments_496879.json:
```json
{
    "body": "<a id='comment:12'></a>\nIf you need a new behavior for configuration of \"package names\" (not sure what you mean by that), please open a ticket for it. In general, I recommend to keep tickets that implement new features or change behavior separate from tickets that refactor existing code.",
    "created_at": "2020-11-03T23:14:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496879",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
If you need a new behavior for configuration of "package names" (not sure what you mean by that), please open a ticket for it. In general, I recommend to keep tickets that implement new features or change behavior separate from tickets that refactor existing code.



---

archive/issue_comments_496880.json:
```json
{
    "body": "<a id='comment:13'></a>\nWhat I meant was that in #30706 the added method `get_cblas_pc_module_name` has the same structure as `get_ellcurve_data_dir`: it checks the env variables and the `sage.conf` information for the first existing option (using `pkgconfig`).\n\nAnyway, is the filepath handling described above in [#30855 comment:8](https://github.com/sagemath/sage/issues/30855#comment:8) desired or not? I don't really the need this additional logic, but it was easy to implement so I went for it while refactoring. I can easily revert it, just please let me know.",
    "created_at": "2020-11-04T08:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496880",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:13'></a>
What I meant was that in #30706 the added method `get_cblas_pc_module_name` has the same structure as `get_ellcurve_data_dir`: it checks the env variables and the `sage.conf` information for the first existing option (using `pkgconfig`).

Anyway, is the filepath handling described above in [#30855 comment:8](https://github.com/sagemath/sage/issues/30855#comment:8) desired or not? I don't really the need this additional logic, but it was easy to implement so I went for it while refactoring. I can easily revert it, just please let me know.



---

archive/issue_events_276689.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-04T21:53:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276689"
}
```



---

archive/issue_comments_496881.json:
```json
{
    "body": "<a id='comment:15'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784\">5be342e</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/envVars</code></td></tr></table>\n",
    "created_at": "2021-01-25T11:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496881",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784">5be342e</a></td><td><code>Merge branch 'develop' of git://github.com/sagemath/sage into public/refactoring/envVars</code></td></tr></table>




---

archive/issue_comments_496882.json:
```json
{
    "body": "**Changing commit** from \"[eef3168e137e6bd9b2715ec0ea3c51ed56a7588f](https://github.com/sagemath/sagetrac-mirror/commit/eef3168e137e6bd9b2715ec0ea3c51ed56a7588f)\" to \"[5be342e4ee1a820c10fda38026a97f6b83770784](https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784)\".",
    "created_at": "2021-01-25T11:48:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496882",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[eef3168e137e6bd9b2715ec0ea3c51ed56a7588f](https://github.com/sagemath/sagetrac-mirror/commit/eef3168e137e6bd9b2715ec0ea3c51ed56a7588f)" to "[5be342e4ee1a820c10fda38026a97f6b83770784](https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784)".



---

archive/issue_events_276690.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T12:53:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/minor",
    "label_color": "ff0000",
    "label_name": "minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276690"
}
```



---

archive/issue_events_276691.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T12:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276691"
}
```



---

archive/issue_events_276692.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T12:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276692"
}
```



---

archive/issue_events_276693.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T12:53:12Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "rename": {
        "from": "Refactor environment config variables",
        "to": "Refactor environment config variables to path"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276693"
}
```



---

archive/issue_comments_496883.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,9 @@\n Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to wrap these variables with simple getter methods that convert the string into the proper class (e.g. `Path` or `bool`) and do a bit of after-processing (e.g. check that the path exist).\n \n-This idea is illustrated at the example of the `ellCurve` data directory. Refactoring the other config variables will be done in follow-up tickets.\n+This makes it possible to make the variable resolution more robust. In particular the new behavior for paths checks also if the specified path is pointing to a valid and existing path:\n+\n+- If user sets the path via an env variable, and the path exists, take it.\n+- If not, but sage.conf sets a path that exists, take it.\n+- Else, fall back to hard-coded folder.\n+\n+Since now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.\n``````\n",
    "created_at": "2021-01-25T12:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496883",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,9 @@
 Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to wrap these variables with simple getter methods that convert the string into the proper class (e.g. `Path` or `bool`) and do a bit of after-processing (e.g. check that the path exist).
 
-This idea is illustrated at the example of the `ellCurve` data directory. Refactoring the other config variables will be done in follow-up tickets.
+This makes it possible to make the variable resolution more robust. In particular the new behavior for paths checks also if the specified path is pointing to a valid and existing path:
+
+- If user sets the path via an env variable, and the path exists, take it.
+- If not, but sage.conf sets a path that exists, take it.
+- Else, fall back to hard-coded folder.
+
+Since now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.
``````




---

archive/issue_comments_496884.json:
```json
{
    "body": "**Changing commit** from \"[5be342e4ee1a820c10fda38026a97f6b83770784](https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784)\" to \"[265bdd76c85a361cc88118cf7a54a4d7d5cf1f69](https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69)\".",
    "created_at": "2021-01-25T12:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496884",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[5be342e4ee1a820c10fda38026a97f6b83770784](https://github.com/sagemath/sagetrac-mirror/commit/5be342e4ee1a820c10fda38026a97f6b83770784)" to "[265bdd76c85a361cc88118cf7a54a4d7d5cf1f69](https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69)".



---

archive/issue_comments_496885.json:
```json
{
    "body": "<a id='comment:17'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69\">265bdd7</a></td><td><code>Use paths everywhere</code></td></tr></table>\n",
    "created_at": "2021-01-25T12:53:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496885",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:17'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69">265bdd7</a></td><td><code>Use paths everywhere</code></td></tr></table>




---

archive/issue_comments_496886.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e\">df1cdaf</a></td><td><code>Fix elliptic curve database path</code></td></tr></table>\n",
    "created_at": "2021-01-25T13:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496886",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e">df1cdaf</a></td><td><code>Fix elliptic curve database path</code></td></tr></table>




---

archive/issue_comments_496887.json:
```json
{
    "body": "**Changing commit** from \"[265bdd76c85a361cc88118cf7a54a4d7d5cf1f69](https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69)\" to \"[df1cdaf73dec7d4ae8ae1be80163927eb480796e](https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e)\".",
    "created_at": "2021-01-25T13:46:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496887",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[265bdd76c85a361cc88118cf7a54a4d7d5cf1f69](https://github.com/sagemath/sagetrac-mirror/commit/265bdd76c85a361cc88118cf7a54a4d7d5cf1f69)" to "[df1cdaf73dec7d4ae8ae1be80163927eb480796e](https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e)".



---

archive/issue_comments_496888.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@tobiasdiez](#comment%3A13):\n> is the filepath handling described above in [#30855 comment:8](https://github.com/sagemath/sage/issues/30855#comment:8) desired or not? \n\nNo use case motivating this change his been described. So let's please not continue just because the ticket is open.",
    "created_at": "2021-01-25T18:10:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496888",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Replying to [@tobiasdiez](#comment%3A13):
> is the filepath handling described above in [#30855 comment:8](https://github.com/sagemath/sage/issues/30855#comment:8) desired or not? 

No use case motivating this change his been described. So let's please not continue just because the ticket is open.



---

archive/issue_events_276694.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-25T18:10:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276694"
}
```



---

archive/issue_events_276695.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-25T18:10:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276695"
}
```



---

archive/issue_comments_496889.json:
```json
{
    "body": "<a id='comment:20'></a>\nAs I said above, I don't have a strong opinion about what is the correct behavior. I just thought it would be nice if the variables in `sage.env` point to existing paths. Otherwise one has to check every time that the path exists, and the fallbacks are never used in this case.\n\nHowever, if this is not desired, then I can remove this again. It's only removing the exist check here:\n\n```\n+    def converter(value: Optional[str]) -> Optional[Path]:\n+        if value is None:\n+            return None\n+\n+        path = Path(value)\n+        if path.exists():\n+            return path\n+        else:\n+            return None\n```",
    "created_at": "2021-01-25T18:37:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496889",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:20'></a>
As I said above, I don't have a strong opinion about what is the correct behavior. I just thought it would be nice if the variables in `sage.env` point to existing paths. Otherwise one has to check every time that the path exists, and the fallbacks are never used in this case.

However, if this is not desired, then I can remove this again. It's only removing the exist check here:

```
+    def converter(value: Optional[str]) -> Optional[Path]:
+        if value is None:
+            return None
+
+        path = Path(value)
+        if path.exists():
+            return path
+        else:
+            return None
```



---

archive/issue_comments_496890.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [@tobiasdiez](#comment%3A20):\n> As I said above, I don't have a strong opinion about what is the correct behavior. I just thought it would be nice if the variables in `sage.env` point to existing paths. \n\nI disagree. Things like this should really be done in `sage.features`.",
    "created_at": "2021-01-25T18:42:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496890",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Replying to [@tobiasdiez](#comment%3A20):
> As I said above, I don't have a strong opinion about what is the correct behavior. I just thought it would be nice if the variables in `sage.env` point to existing paths. 

I disagree. Things like this should really be done in `sage.features`.



---

archive/issue_comments_496891.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc\">e7fa157</a></td><td><code>Remove path existence check</code></td></tr></table>\n",
    "created_at": "2021-01-25T20:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496891",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc">e7fa157</a></td><td><code>Remove path existence check</code></td></tr></table>




---

archive/issue_comments_496892.json:
```json
{
    "body": "**Changing commit** from \"[df1cdaf73dec7d4ae8ae1be80163927eb480796e](https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e)\" to \"[e7fa1579b6d164c002c402451518a73f0f086fdc](https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc)\".",
    "created_at": "2021-01-25T20:04:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496892",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[df1cdaf73dec7d4ae8ae1be80163927eb480796e](https://github.com/sagemath/sagetrac-mirror/commit/df1cdaf73dec7d4ae8ae1be80163927eb480796e)" to "[e7fa1579b6d164c002c402451518a73f0f086fdc](https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc)".



---

archive/issue_comments_496893.json:
```json
{
    "body": "<a id='comment:23'></a>\nI have a hard time seeing how `SAGE_LOCAL` is a feature, but I've now removed the existence check. So this is really only a refactoring from string-paths to pathlib-paths.",
    "created_at": "2021-01-25T20:05:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496893",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>
I have a hard time seeing how `SAGE_LOCAL` is a feature, but I've now removed the existence check. So this is really only a refactoring from string-paths to pathlib-paths.



---

archive/issue_events_276696.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T20:07:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "008080",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276696"
}
```



---

archive/issue_events_276697.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-25T20:07:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276697"
}
```



---

archive/issue_comments_496894.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,9 +1,3 @@\n-Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to wrap these variables with simple getter methods that convert the string into the proper class (e.g. `Path` or `bool`) and do a bit of after-processing (e.g. check that the path exist).\n-\n-This makes it possible to make the variable resolution more robust. In particular the new behavior for paths checks also if the specified path is pointing to a valid and existing path:\n-\n-- If user sets the path via an env variable, and the path exists, take it.\n-- If not, but sage.conf sets a path that exists, take it.\n-- Else, fall back to hard-coded folder.\n+Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to convert these stringl variables into the proper class (e.g. `Path` or `bool`).\n \n Since now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.\n``````\n",
    "created_at": "2021-01-25T20:07:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496894",
    "user": "https://github.com/tobiasdiez"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,9 +1,3 @@
-Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to wrap these variables with simple getter methods that convert the string into the proper class (e.g. `Path` or `bool`) and do a bit of after-processing (e.g. check that the path exist).
-
-This makes it possible to make the variable resolution more robust. In particular the new behavior for paths checks also if the specified path is pointing to a valid and existing path:
-
-- If user sets the path via an env variable, and the path exists, take it.
-- If not, but sage.conf sets a path that exists, take it.
-- Else, fall back to hard-coded folder.
+Currently, `sage.env` contains a huge list of variables that can be set via env vars or `sage_conf`. These are simple string variables. However, in most cases these variables actually have a different type, e.g. they point to files or are booleans. This ticket proposes to convert these stringl variables into the proper class (e.g. `Path` or `bool`).
 
 Since now all paths in `sage.env` are `pathlib.Path`s, some other files had to be changed since they still assumed to be str. I tried to make the changes as minimal as possible, leaving a deeper refactoring to follow-up tickets.
``````




---

archive/issue_comments_496895.json:
```json
{
    "body": "**Changing commit** from \"[e7fa1579b6d164c002c402451518a73f0f086fdc](https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc)\" to \"[7a32e5567dfe452d5b08409b5d71c9a859d5363b](https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b)\".",
    "created_at": "2021-01-25T20:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496895",
    "user": "https://github.com/sagetrac-git"
}
```

**Changing commit** from "[e7fa1579b6d164c002c402451518a73f0f086fdc](https://github.com/sagemath/sagetrac-mirror/commit/e7fa1579b6d164c002c402451518a73f0f086fdc)" to "[7a32e5567dfe452d5b08409b5d71c9a859d5363b](https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b)".



---

archive/issue_comments_496896.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b\">7a32e55</a></td><td><code>Fix doctests as well</code></td></tr></table>\n",
    "created_at": "2021-01-25T20:10:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496896",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7a32e5567dfe452d5b08409b5d71c9a859d5363b">7a32e55</a></td><td><code>Fix doctests as well</code></td></tr></table>




---

archive/issue_comments_496897.json:
```json
{
    "body": "<a id='comment:26'></a>\n`SAGE_LOCAL` is not a great example - pretty much any use of `SAGE_LOCAL` in `src/sage` needs to be removed anyway.",
    "created_at": "2021-01-25T20:12:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496897",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
`SAGE_LOCAL` is not a great example - pretty much any use of `SAGE_LOCAL` in `src/sage` needs to be removed anyway.



---

archive/issue_comments_496898.json:
```json
{
    "body": "<a id='comment:27'></a>\nFor example this one here:\n\n```\n--- a/src/sage/interfaces/lie.py\n+++ b/src/sage/interfaces/lie.py\n@@ -331,7 +331,7 @@ class LiE(ExtraTabCompletion, Expect):\n                         prompt = '> ',\n \n                         # This is the command that starts up your program\n-                        command = \"bash \"+ SAGE_LOCAL + \"/bin/lie\",\n+                        command = f\"bash { SAGE_LOCAL / 'bin' / 'lie' }\",\n \n                         server=server,\n                         script_subdirectory = script_subdirectory,\n```\nThis would better be rewritten using an `Executable` feature.",
    "created_at": "2021-01-25T20:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
For example this one here:

```
--- a/src/sage/interfaces/lie.py
+++ b/src/sage/interfaces/lie.py
@@ -331,7 +331,7 @@ class LiE(ExtraTabCompletion, Expect):
                         prompt = '> ',
 
                         # This is the command that starts up your program
-                        command = "bash "+ SAGE_LOCAL + "/bin/lie",
+                        command = f"bash { SAGE_LOCAL / 'bin' / 'lie' }",
 
                         server=server,
                         script_subdirectory = script_subdirectory,
```
This would better be rewritten using an `Executable` feature.



---

archive/issue_comments_496899.json:
```json
{
    "body": "<a id='comment:28'></a>\nAlso, as changes like this one indicate:\n\n```\n--- a/src/sage/doctest/sources.py\n+++ b/src/sage/doctest/sources.py\n@@ -87,8 +87,8 @@ def get_basename(path):\n     root = os.path.dirname(path)\n     # If the file is in the sage library, we can use our knowledge of\n     # the directory structure\n-    dev = SAGE_SRC\n-    sp = SAGE_LIB\n+    dev = str(SAGE_SRC)\n+    sp = str(SAGE_LIB)\n     if path.startswith(dev):\n         # there will be a branch name\n         i = path.find(os.path.sep, len(dev))\n```\nThe change of the type of the variables is not backwards-compatible (although in some contexts you can use path like a string). So there is a danger of breaking user code.",
    "created_at": "2021-01-25T20:25:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496899",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
Also, as changes like this one indicate:

```
--- a/src/sage/doctest/sources.py
+++ b/src/sage/doctest/sources.py
@@ -87,8 +87,8 @@ def get_basename(path):
     root = os.path.dirname(path)
     # If the file is in the sage library, we can use our knowledge of
     # the directory structure
-    dev = SAGE_SRC
-    sp = SAGE_LIB
+    dev = str(SAGE_SRC)
+    sp = str(SAGE_LIB)
     if path.startswith(dev):
         # there will be a branch name
         i = path.find(os.path.sep, len(dev))
```
The change of the type of the variables is not backwards-compatible (although in some contexts you can use path like a string). So there is a danger of breaking user code.



---

archive/issue_comments_496900.json:
```json
{
    "body": "<a id='comment:29'></a>\nI agree, that some of the code can be further refactored and e.g. moved to the feature module. However, this only changes the location of code such as `SAGE_LOCAL + \"/bin/lie\"` and thus it is still advantageous to have `SAGE_LOCAL` as path.\n\nWhat do you propose to do about the backward-compatibility? What are sage's conventions concerning breaking changes (especially concerning relatively internal things like sage.env)?",
    "created_at": "2021-01-25T21:01:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496900",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:29'></a>
I agree, that some of the code can be further refactored and e.g. moved to the feature module. However, this only changes the location of code such as `SAGE_LOCAL + "/bin/lie"` and thus it is still advantageous to have `SAGE_LOCAL` as path.

What do you propose to do about the backward-compatibility? What are sage's conventions concerning breaking changes (especially concerning relatively internal things like sage.env)?



---

archive/issue_comments_496901.json:
```json
{
    "body": "<a id='comment:30'></a>\nIt's really very simple:\nWe have a low-level interface (`sage.env`), we have a high-level interface (`sage.features`). It is not a clear improvement to make the existing low-level interface slightly higher-level. Instead, improve code that uses the low-level interface by using the high-level interface instead.",
    "created_at": "2021-01-25T23:06:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496901",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
It's really very simple:
We have a low-level interface (`sage.env`), we have a high-level interface (`sage.features`). It is not a clear improvement to make the existing low-level interface slightly higher-level. Instead, improve code that uses the low-level interface by using the high-level interface instead.



---

archive/issue_comments_496902.json:
```json
{
    "body": "<a id='comment:31'></a>\nThere are over 400 usages of these path variables in sage.env (conservative estimate based on searching for `join(SAGE_`). All of these calls profit from the strengthen of the interface to use pathlib. Even if refactoring to sage.features would remove half of them, that's still a huge number of string -> path conversions that have to be repeatedly done in many places. So why not fix this at the origin?",
    "created_at": "2021-01-25T23:41:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496902",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:31'></a>
There are over 400 usages of these path variables in sage.env (conservative estimate based on searching for `join(SAGE_`). All of these calls profit from the strengthen of the interface to use pathlib. Even if refactoring to sage.features would remove half of them, that's still a huge number of string -> path conversions that have to be repeatedly done in many places. So why not fix this at the origin?



---

archive/issue_comments_496903.json:
```json
{
    "body": "<a id='comment:32'></a>\nReplying to [@tobiasdiez](#comment%3A29):\n> What are sage's conventions concerning breaking changes \n\nWe use the deprecation mechanism if we have to make incompatible changes.\n\nHard to do use deprecation here - which is another reason why this old interface (`sage.env`) is best left alone.",
    "created_at": "2021-01-26T01:24:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Replying to [@tobiasdiez](#comment%3A29):
> What are sage's conventions concerning breaking changes 

We use the deprecation mechanism if we have to make incompatible changes.

Hard to do use deprecation here - which is another reason why this old interface (`sage.env`) is best left alone.



---

archive/issue_comments_496904.json:
```json
{
    "body": "<a id='comment:33'></a>\nReplying to [@mkoeppe](#comment%3A26):\n> `SAGE_LOCAL` is not a great example - pretty much any use of `SAGE_LOCAL` in `src/sage` needs to be removed anyway.\n\nFor reference - #30818",
    "created_at": "2021-01-26T18:44:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496904",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Replying to [@mkoeppe](#comment%3A26):
> `SAGE_LOCAL` is not a great example - pretty much any use of `SAGE_LOCAL` in `src/sage` needs to be removed anyway.

For reference - #30818



---

archive/issue_comments_496905.json:
```json
{
    "body": "<a id='comment:34'></a>\nWhy are you so much against the idea of improving `sage.env`? For me it is sage's interface for configuration (via environment variables or sageconf). So it is natural that many place in sage will access this information. And I don't understand why you don't want to have an universal check for basic consistency (paths specified exist, boolean flags are yes/no etc). Right now these things are checked in various places, leading to code duplication and additional work for maintenance.\n\nFor deprecation, that's possible using a wrapper around `Path` and `str` that prints warning messages if the string-methods are used (similar to https://stackoverflow.com/questions/922550/how-to-mark-a-global-as-deprecated-in-python)",
    "created_at": "2021-01-30T10:38:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496905",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:34'></a>
Why are you so much against the idea of improving `sage.env`? For me it is sage's interface for configuration (via environment variables or sageconf). So it is natural that many place in sage will access this information. And I don't understand why you don't want to have an universal check for basic consistency (paths specified exist, boolean flags are yes/no etc). Right now these things are checked in various places, leading to code duplication and additional work for maintenance.

For deprecation, that's possible using a wrapper around `Path` and `str` that prints warning messages if the string-methods are used (similar to https://stackoverflow.com/questions/922550/how-to-mark-a-global-as-deprecated-in-python)



---

archive/issue_comments_496906.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [@tobiasdiez](#comment%3A34):\n> Why are you so much against the idea of improving `sage.env`? For me it is sage's interface for configuration (via environment variables or sageconf). \n\nSee comment 4. \n`sage.env` is a low-level interface - a thin wrapper around os.environ, combining environment variables and `sage_conf` and simple fallbacks. It maps string keys to strings. \n\nAdding complexity there is not an improvement.\n\n`sage.features` was designed to provide a high-level interface to the system environment of sagelib (#20382).\n\nIt already does what it seems you are trying to introduce in `sage.env`: It is typed and it implements filesystem lookups.",
    "created_at": "2021-01-30T16:40:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496906",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Replying to [@tobiasdiez](#comment%3A34):
> Why are you so much against the idea of improving `sage.env`? For me it is sage's interface for configuration (via environment variables or sageconf). 

See comment 4. 
`sage.env` is a low-level interface - a thin wrapper around os.environ, combining environment variables and `sage_conf` and simple fallbacks. It maps string keys to strings. 

Adding complexity there is not an improvement.

`sage.features` was designed to provide a high-level interface to the system environment of sagelib (#20382).

It already does what it seems you are trying to introduce in `sage.env`: It is typed and it implements filesystem lookups.



---

archive/issue_comments_496907.json:
```json
{
    "body": "<a id='comment:36'></a>\nReplying to [@tobiasdiez](#comment%3A31):\n> There are over 400 usages of these path variables in sage.env (conservative estimate based on searching for `join(SAGE_`). \n\n`git grep 'join(SAGE' src/sage | grep -v 'sage:' ` (ignoring lines that are in doctests!) gives 97 hits, which will need review. That's really just a small remainder of refactoring work that has already been done in the past few years.\n\nFor example, all places using `SAGE_EXTCODE` would be changed by #31306.",
    "created_at": "2021-01-30T18:17:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Replying to [@tobiasdiez](#comment%3A31):
> There are over 400 usages of these path variables in sage.env (conservative estimate based on searching for `join(SAGE_`). 

`git grep 'join(SAGE' src/sage | grep -v 'sage:' ` (ignoring lines that are in doctests!) gives 97 hits, which will need review. That's really just a small remainder of refactoring work that has already been done in the past few years.

For example, all places using `SAGE_EXTCODE` would be changed by #31306.



---

archive/issue_comments_496908.json:
```json
{
    "body": "<a id='comment:37'></a>\nAnd how are the features supposed to locate files in `SAGE_LOCAL`, `SAGE_VENV`, `SAGE_ETC`, `SAGE_LIB`, `SAGE_SHARE` etc? And why is it not helpful for this if these variables are Paths?",
    "created_at": "2021-01-30T18:28:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496908",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'></a>
And how are the features supposed to locate files in `SAGE_LOCAL`, `SAGE_VENV`, `SAGE_ETC`, `SAGE_LIB`, `SAGE_SHARE` etc? And why is it not helpful for this if these variables are Paths?



---

archive/issue_comments_496909.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [@tobiasdiez](#comment%3A37):\n> And how are the features supposed to locate files in `SAGE_LOCAL`, `SAGE_VENV`, `SAGE_ETC`, `SAGE_LIB`, `SAGE_SHARE` etc? \n\n`sage.features.Executable` uses `PATH`. See #31296 for a proposed improvement.\n\n`sage.features.StaticFile` uses a customizable search path, which defaults to `SAGE_SHARE` - this probably needs a better design, as we are moving away from assumptions related to the installation scheme of the Sage distribution.\n\n> And why is it not helpful for this if these variables are Paths?\n\nThat's not how this works. A proposed change needs to be sufficiently motivated - what problem is the ticket trying to solve?  In particular, convincing motivation is necessary when breaking changes to the interface are proposed or the complexity of the code is increased by the change.\n\n`pathlib` is nice, but I don't think there is any sort of consensus in the Python community that it is \"better\" than `os.path`. It's just a matter of preferences.",
    "created_at": "2021-01-30T19:08:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Replying to [@tobiasdiez](#comment%3A37):
> And how are the features supposed to locate files in `SAGE_LOCAL`, `SAGE_VENV`, `SAGE_ETC`, `SAGE_LIB`, `SAGE_SHARE` etc? 

`sage.features.Executable` uses `PATH`. See #31296 for a proposed improvement.

`sage.features.StaticFile` uses a customizable search path, which defaults to `SAGE_SHARE` - this probably needs a better design, as we are moving away from assumptions related to the installation scheme of the Sage distribution.

> And why is it not helpful for this if these variables are Paths?

That's not how this works. A proposed change needs to be sufficiently motivated - what problem is the ticket trying to solve?  In particular, convincing motivation is necessary when breaking changes to the interface are proposed or the complexity of the code is increased by the change.

`pathlib` is nice, but I don't think there is any sort of consensus in the Python community that it is "better" than `os.path`. It's just a matter of preferences.



---

archive/issue_events_276698.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-30T20:01:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20refactoring",
    "label_color": "08517b",
    "label_name": "component: refactoring",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276698"
}
```



---

archive/issue_events_276699.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-30T20:01:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20interfaces%3A%20optional",
    "label_color": "08517b",
    "label_name": "component: interfaces: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276699"
}
```



---

archive/issue_comments_496910.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [@mkoeppe](#comment%3A38):\n> what problem is the ticket trying to solve?\n\nThe idea was to provide basic existence and consistency checks that would apply to all path-based env variables. Since this is apparently not desired, let's close this ticket to not spent more time discussing this.",
    "created_at": "2021-01-30T20:01:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496910",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:39'></a>
Replying to [@mkoeppe](#comment%3A38):
> what problem is the ticket trying to solve?

The idea was to provide basic existence and consistency checks that would apply to all path-based env variables. Since this is apparently not desired, let's close this ticket to not spent more time discussing this.



---

archive/issue_events_276700.json:
```json
{
    "actor": "https://github.com/tobiasdiez",
    "created_at": "2021-01-30T20:01:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276700"
}
```



---

archive/issue_comments_496911.json:
```json
{
    "body": "<a id='comment:40'></a>\nIn any case, the discussion was fruitful as it led to creating tickets #31291, #31292, #31293, #31296, #31306. Any work on these tickets would be very welcome!",
    "created_at": "2021-01-30T20:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
In any case, the discussion was fruitful as it led to creating tickets #31291, #31292, #31293, #31296, #31306. Any work on these tickets would be very welcome!



---

archive/issue_comments_496912.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2021-01-30T20:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496912",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_events_276701.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T20:21:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "008080",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276701"
}
```



---

archive/issue_events_276702.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-30T20:21:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276702"
}
```



---

archive/issue_comments_496913.json:
```json
{
    "body": "**Changing author** from \"Tobias Diez\" to \"\".",
    "created_at": "2021-01-30T20:21:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30855#issuecomment-496913",
    "user": "https://github.com/mkoeppe"
}
```

**Changing author** from "Tobias Diez" to "".



---

archive/issue_events_276703.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:08:43Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "008080",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276703"
}
```



---

archive/issue_events_276704.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-26T02:08:43Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30855",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30855#event-276704"
}
```
