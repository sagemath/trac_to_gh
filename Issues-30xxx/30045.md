# Issue 30045: Bug in Reed-Solomon encoder and error-erasure decoder

archive/issues_029808.json:
```json
{
    "body": "The following two snippets demonstrate two bugs when working with `GeneralizedReedSolomonCode`:\n\n```\nsage: F = GF(59)\nsage: n, k = 40, 12\nsage: C = codes.GeneralizedReedSolomonCode(F.list()[:n], k)\nsage: D = codes.decoders.GRSErrorErasureDecoder(C)\nsage: y = (vector(F, [0, 0, 10, 0, 0, 22, 0, 0, 38, 8, 34, 14, 33, 0, 0, 39, 0, 0, 0, 0, 17, 36, 43, 30, 10, 15, 0, 0, 21, 10, 37, 0, 0, 0, 0, 0, 0, 0, 0, 42]),\nsage:      vector(GF(2), [1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0]))\nsage: D.decode_to_code(y)\n<BOOM>\n```\n\nDecoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):\n\n```\nsage: m = D.decode_to_message(y)\nsage: len(m)\n11\n```\n\n(The bugs were found by introducing random seeding in #29945) \n\n**CC:**  @kliem\n\n**Keywords:** reed-solomon decoding\n\n**Branch/Commit:** [b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)\n\n**Reviewer:** Jonathan Kliem\n\n**Author:** Johan Rosenkilde\n\nIssue created by migration from https://trac.sagemath.org/ticket/30045\n\n",
    "closed_at": "2020-07-12T08:30:34Z",
    "created_at": "2020-07-02T09:04:48Z",
    "labels": [
        "component: coding theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Bug in Reed-Solomon encoder and error-erasure decoder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30045",
    "user": "https://github.com/johanrosenkilde"
}
```
The following two snippets demonstrate two bugs when working with `GeneralizedReedSolomonCode`:

```
sage: F = GF(59)
sage: n, k = 40, 12
sage: C = codes.GeneralizedReedSolomonCode(F.list()[:n], k)
sage: D = codes.decoders.GRSErrorErasureDecoder(C)
sage: y = (vector(F, [0, 0, 10, 0, 0, 22, 0, 0, 38, 8, 34, 14, 33, 0, 0, 39, 0, 0, 0, 0, 17, 36, 43, 30, 10, 15, 0, 0, 21, 10, 37, 0, 0, 0, 0, 0, 0, 0, 0, 42]),
sage:      vector(GF(2), [1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0]))
sage: D.decode_to_code(y)
<BOOM>
```

Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):

```
sage: m = D.decode_to_message(y)
sage: len(m)
11
```

(The bugs were found by introducing random seeding in #29945) 

**CC:**  @kliem

**Keywords:** reed-solomon decoding

**Branch/Commit:** [b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)

**Reviewer:** Jonathan Kliem

**Author:** Johan Rosenkilde

Issue created by migration from https://trac.sagemath.org/ticket/30045





---

archive/issue_comments_563520.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe second error seems to be due to `GeneralizedReedSolomonCode` having a `decode_to_message` implemented, which incorrectly converts between polynomials and vectors. I don't see why it should have this method implemented - it should be provided in the correct way by `AbstractCode`.",
    "created_at": "2020-07-02T09:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563520",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:1'></a>
The second error seems to be due to `GeneralizedReedSolomonCode` having a `decode_to_message` implemented, which incorrectly converts between polynomials and vectors. I don't see why it should have this method implemented - it should be provided in the correct way by `AbstractCode`.



---

archive/issue_comments_563521.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -13,10 +13,10 @@\n \n Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):\n \n-{{{{\n+```\n sage: m = D.decode_to_message(y)\n sage: len(m)\n 11\n-}}}\n+```\n \n (The bugs were found by introducing random seeding in #29945) \n``````\n",
    "created_at": "2020-07-02T09:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563521",
    "user": "https://github.com/johanrosenkilde"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -13,10 +13,10 @@
 
 Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):
 
-{{{{
+```
 sage: m = D.decode_to_message(y)
 sage: len(m)
 11
-}}}
+```
 
 (The bugs were found by introducing random seeding in #29945) 
``````




---

archive/issue_comments_563522.json:
```json
{
    "body": "**Dependencies:** #29945",
    "created_at": "2020-07-06T08:15:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563522",
    "user": "https://github.com/johanrosenkilde"
}
```

**Dependencies:** #29945



---

archive/issue_comments_563523.json:
```json
{
    "body": "**Branch:** [u/jsrn/30045_bugs_in_grs](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/30045_bugs_in_grs)",
    "created_at": "2020-07-06T08:31:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563523",
    "user": "https://github.com/johanrosenkilde"
}
```

**Branch:** [u/jsrn/30045_bugs_in_grs](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/30045_bugs_in_grs)



---

archive/issue_comments_563524.json:
```json
{
    "body": "**Commit:** [18428ede85025230753c72980afc655bad3ae40c](https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c)",
    "created_at": "2020-07-06T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563524",
    "user": "https://github.com/kliem"
}
```

**Commit:** [18428ede85025230753c72980afc655bad3ae40c](https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c)



---

archive/issue_comments_563525.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs posted already on #29945, I would propose to just fix the problem and don't worry about #29945.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c\">18428ed</a></td><td><code>Remove unnecessary decode_to_message in GeneralizedReedSolomonCode</code></td></tr></table>\n",
    "created_at": "2020-07-06T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563525",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>
As posted already on #29945, I would propose to just fix the problem and don't worry about #29945.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c">18428ed</a></td><td><code>Remove unnecessary decode_to_message in GeneralizedReedSolomonCode</code></td></tr></table>




---

archive/issue_comments_563526.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-07-06T08:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563526",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_563527.json:
```json
{
    "body": "<a id='comment:5'></a>\nOK, then this is up for review.",
    "created_at": "2020-07-06T08:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563527",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:5'></a>
OK, then this is up for review.



---

archive/issue_comments_563528.json:
```json
{
    "body": "**Changing dependencies** from \"#29945\" to \"\".",
    "created_at": "2020-07-06T08:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563528",
    "user": "https://github.com/johanrosenkilde"
}
```

**Changing dependencies** from "#29945" to "".



---

archive/issue_comments_563529.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe bug fix should be tested with a doctest yet.",
    "created_at": "2020-07-06T09:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563529",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>
The bug fix should be tested with a doctest yet.



---

archive/issue_comments_563530.json:
```json
{
    "body": "**Changing commit** from \"[18428ede85025230753c72980afc655bad3ae40c](https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c)\" to \"[36cff4accc9c0c8f2d3fd6395f0c790e319d39bb](https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb)\".",
    "created_at": "2020-07-06T09:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563530",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[18428ede85025230753c72980afc655bad3ae40c](https://github.com/sagemath/sagetrac-mirror/commit/18428ede85025230753c72980afc655bad3ae40c)" to "[36cff4accc9c0c8f2d3fd6395f0c790e319d39bb](https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb)".



---

archive/issue_comments_563531.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb\">36cff4a</a></td><td><code>Add doc-test for 30045</code></td></tr></table>\n",
    "created_at": "2020-07-06T09:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563531",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb">36cff4a</a></td><td><code>Add doc-test for 30045</code></td></tr></table>




---

archive/issue_comments_563532.json:
```json
{
    "body": "<a id='comment:8'></a>\nRight you are.",
    "created_at": "2020-07-06T09:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563532",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:8'></a>
Right you are.



---

archive/issue_comments_563533.json:
```json
{
    "body": "<a id='comment:9'></a>\nCan you please add the doctest that was removed with the method somewhere.\n\nAlso\n\n```diff\n-    Test that the bug in #30045 is fixed::\n+    Test that the bug in :trac:`30045` is fixed::\n```",
    "created_at": "2020-07-08T13:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563533",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>
Can you please add the doctest that was removed with the method somewhere.

Also

```diff
-    Test that the bug in #30045 is fixed::
+    Test that the bug in :trac:`30045` is fixed::
```



---

archive/issue_comments_563534.json:
```json
{
    "body": "**Reviewer:** Jonathan Kliem",
    "created_at": "2020-07-08T13:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563534",
    "user": "https://github.com/kliem"
}
```

**Reviewer:** Jonathan Kliem



---

archive/issue_comments_563535.json:
```json
{
    "body": "<a id='comment:10'></a>\nAnd missing author name. Otherwise this looks good.",
    "created_at": "2020-07-10T08:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563535",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
And missing author name. Otherwise this looks good.



---

archive/issue_comments_563536.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0\">f7ae23b</a></td><td><code>Reinstate deleted doctest/example in a meaningful place</code></td></tr></table>\n",
    "created_at": "2020-07-10T08:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563536",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0">f7ae23b</a></td><td><code>Reinstate deleted doctest/example in a meaningful place</code></td></tr></table>




---

archive/issue_comments_563537.json:
```json
{
    "body": "**Changing commit** from \"[36cff4accc9c0c8f2d3fd6395f0c790e319d39bb](https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb)\" to \"[f7ae23b5adb7e56607675d60364005561f2d10e0](https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0)\".",
    "created_at": "2020-07-10T08:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563537",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[36cff4accc9c0c8f2d3fd6395f0c790e319d39bb](https://github.com/sagemath/sagetrac-mirror/commit/36cff4accc9c0c8f2d3fd6395f0c790e319d39bb)" to "[f7ae23b5adb7e56607675d60364005561f2d10e0](https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0)".



---

archive/issue_comments_563538.json:
```json
{
    "body": "**Changing commit** from \"[f7ae23b5adb7e56607675d60364005561f2d10e0](https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0)\" to \"[b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)\".",
    "created_at": "2020-07-10T08:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563538",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[f7ae23b5adb7e56607675d60364005561f2d10e0](https://github.com/sagemath/sagetrac-mirror/commit/f7ae23b5adb7e56607675d60364005561f2d10e0)" to "[b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)".



---

archive/issue_comments_563539.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c\">b1fa133</a></td><td><code>Fix trac ticket link</code></td></tr></table>\n",
    "created_at": "2020-07-10T08:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563539",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c">b1fa133</a></td><td><code>Fix trac ticket link</code></td></tr></table>




---

archive/issue_comments_563540.json:
```json
{
    "body": "**Author:** Johan Rosenkilde",
    "created_at": "2020-07-10T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563540",
    "user": "https://github.com/johanrosenkilde"
}
```

**Author:** Johan Rosenkilde



---

archive/issue_comments_563541.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for the patience! It's been a while since I last fixed something in Sage ;-)",
    "created_at": "2020-07-10T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563541",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:13'></a>
Thanks for the patience! It's been a while since I last fixed something in Sage ;-)



---

archive/issue_comments_563542.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-07-10T10:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563542",
    "user": "https://github.com/kliem"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_563543.json:
```json
{
    "body": "<a id='comment:14'></a>\nLGTM. Thanks for fixing this.",
    "created_at": "2020-07-10T10:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563543",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>
LGTM. Thanks for fixing this.



---

archive/issue_comments_563544.json:
```json
{
    "body": "**Changing branch** from \"[u/jsrn/30045_bugs_in_grs](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/30045_bugs_in_grs)\" to \"[b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)\".",
    "created_at": "2020-07-12T08:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-563544",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/jsrn/30045_bugs_in_grs](https://github.com/sagemath/sagetrac-mirror/tree/u/jsrn/30045_bugs_in_grs)" to "[b1fa1335d8b008f54fe46667c9529abd9c11ab3c](https://github.com/sagemath/sagetrac-mirror/commit/b1fa1335d8b008f54fe46667c9529abd9c11ab3c)".



---

archive/issue_events_087493.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-12T08:30:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30045#event-87493"
}
```
