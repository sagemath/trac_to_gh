# Issue 30045: Bug in Reed-Solomon encoder and error-erasure decoder

archive/issues_029808.json:
```json
{
    "body": "The following two snippets demonstrate two bugs when working with `GeneralizedReedSolomonCode`:\n\n```\nsage: F = GF(59)\nsage: n, k = 40, 12\nsage: C = codes.GeneralizedReedSolomonCode(F.list()[:n], k)\nsage: D = codes.decoders.GRSErrorErasureDecoder(C)\nsage: y = (vector(F, [0, 0, 10, 0, 0, 22, 0, 0, 38, 8, 34, 14, 33, 0, 0, 39, 0, 0, 0, 0, 17, 36, 43, 30, 10, 15, 0, 0, 21, 10, 37, 0, 0, 0, 0, 0, 0, 0, 0, 42]),\nsage:      vector(GF(2), [1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0]))\nsage: D.decode_to_code(y)\n<BOOM>\n```\n\nDecoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):\n\n```\nsage: m = D.decode_to_message(y)\nsage: len(m)\n11\n```\n\n(The bugs were found by introducing random seeding in #29945) \n\nCC:  @kliem\n\nKeywords: reed-solomon decoding\n\nBranch/Commit: b1fa1335d8b008f54fe46667c9529abd9c11ab3c\n\nReviewer: Jonathan Kliem\n\nAuthor: Johan Rosenkilde\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30045\n\n",
    "closed_at": "2020-07-12T08:30:34Z",
    "created_at": "2020-07-02T09:04:48Z",
    "labels": [
        "component: coding theory",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Bug in Reed-Solomon encoder and error-erasure decoder",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30045",
    "user": "https://github.com/johanrosenkilde"
}
```
The following two snippets demonstrate two bugs when working with `GeneralizedReedSolomonCode`:

```
sage: F = GF(59)
sage: n, k = 40, 12
sage: C = codes.GeneralizedReedSolomonCode(F.list()[:n], k)
sage: D = codes.decoders.GRSErrorErasureDecoder(C)
sage: y = (vector(F, [0, 0, 10, 0, 0, 22, 0, 0, 38, 8, 34, 14, 33, 0, 0, 39, 0, 0, 0, 0, 17, 36, 43, 30, 10, 15, 0, 0, 21, 10, 37, 0, 0, 0, 0, 0, 0, 0, 0, 42]),
sage:      vector(GF(2), [1, 1, 0, 1, 1, 0, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0]))
sage: D.decode_to_code(y)
<BOOM>
```

Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):

```
sage: m = D.decode_to_message(y)
sage: len(m)
11
```

(The bugs were found by introducing random seeding in #29945) 

CC:  @kliem

Keywords: reed-solomon decoding

Branch/Commit: b1fa1335d8b008f54fe46667c9529abd9c11ab3c

Reviewer: Jonathan Kliem

Author: Johan Rosenkilde

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30045





---

archive/issue_comments_451367.json:
```json
{
    "body": "<a id='comment:1'></a>The second error seems to be due to `GeneralizedReedSolomonCode` having a `decode_to_message` implemented, which incorrectly converts between polynomials and vectors. I don't see why it should have this method implemented - it should be provided in the correct way by `AbstractCode`.",
    "created_at": "2020-07-02T09:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451367",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:1'></a>The second error seems to be due to `GeneralizedReedSolomonCode` having a `decode_to_message` implemented, which incorrectly converts between polynomials and vectors. I don't see why it should have this method implemented - it should be provided in the correct way by `AbstractCode`.



---

archive/issue_comments_451368.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -14,13 +14,12 @@\n Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):\n \n \\`\\`\\`\n-{\n sage: m = D.decode_to_message(y)\n sage: len(m)\n 11\n \\`\\`\\`\n \n-(The bugs were found by introducing random seeding in #29945)\n+(The bugs were found by introducing random seeding in #29945) \n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-02T09:31:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451368",
    "user": "https://github.com/johanrosenkilde"
}
```

Description changed:
```diff
--- 
+++ 
@@ -14,13 +14,12 @@
 Decoding to message works, but produces a vector of incorrect length (should equal the dimension, i.e. 12):
 
 \`\`\`
-{
 sage: m = D.decode_to_message(y)
 sage: len(m)
 11
 \`\`\`
 
-(The bugs were found by introducing random seeding in #29945)
+(The bugs were found by introducing random seeding in #29945) 
 
 Comment: 1
 
```




---

archive/issue_comments_451369.json:
```json
{
    "body": "<a id='comment:4'></a>As posted already on #29945, I would propose to just fix the problem and don't worry about #29945.\n\n---\nNew commits:",
    "created_at": "2020-07-06T08:43:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451369",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>As posted already on #29945, I would propose to just fix the problem and don't worry about #29945.

---
New commits:



---

archive/issue_comments_451370.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-06T08:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451370",
    "user": "https://github.com/johanrosenkilde"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_451371.json:
```json
{
    "body": "<a id='comment:5'></a>OK, then this is up for review.",
    "created_at": "2020-07-06T08:53:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451371",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:5'></a>OK, then this is up for review.



---

archive/issue_comments_451372.json:
```json
{
    "body": "<a id='comment:6'></a>The bug fix should be tested with a doctest yet.",
    "created_at": "2020-07-06T09:30:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451372",
    "user": "https://github.com/kliem"
}
```

<a id='comment:6'></a>The bug fix should be tested with a doctest yet.



---

archive/issue_comments_451373.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-06T09:54:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451373",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451374.json:
```json
{
    "body": "<a id='comment:8'></a>Right you are.",
    "created_at": "2020-07-06T09:55:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451374",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:8'></a>Right you are.



---

archive/issue_comments_451375.json:
```json
{
    "body": "<a id='comment:9'></a>Can you please add the doctest that was removed with the method somewhere.\n\nAlso\n\n```diff\n-    Test that the bug in #30045 is fixed::\n+    Test that the bug in :trac:`30045` is fixed::\n```",
    "created_at": "2020-07-08T13:39:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451375",
    "user": "https://github.com/kliem"
}
```

<a id='comment:9'></a>Can you please add the doctest that was removed with the method somewhere.

Also

```diff
-    Test that the bug in #30045 is fixed::
+    Test that the bug in :trac:`30045` is fixed::
```



---

archive/issue_comments_451376.json:
```json
{
    "body": "<a id='comment:10'></a>And missing author name. Otherwise this looks good.",
    "created_at": "2020-07-10T08:24:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451376",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>And missing author name. Otherwise this looks good.



---

archive/issue_comments_451377.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-10T08:55:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451378.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-10T08:57:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451378",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_451379.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks for the patience! It's been a while since I last fixed something in Sage ;-)",
    "created_at": "2020-07-10T08:58:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451379",
    "user": "https://github.com/johanrosenkilde"
}
```

<a id='comment:13'></a>Thanks for the patience! It's been a while since I last fixed something in Sage ;-)



---

archive/issue_comments_451380.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-10T10:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451380",
    "user": "https://github.com/kliem"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_451381.json:
```json
{
    "body": "<a id='comment:14'></a>LGTM. Thanks for fixing this.",
    "created_at": "2020-07-10T10:26:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451381",
    "user": "https://github.com/kliem"
}
```

<a id='comment:14'></a>LGTM. Thanks for fixing this.



---

archive/issue_events_077257.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-12T08:30:34Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30045#event-77257"
}
```



---

archive/issue_comments_451382.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-12T08:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30045",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30045#issuecomment-451382",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
