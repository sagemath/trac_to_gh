# Issue 30795: bootstrap-clean must remove src/bin/sage-env-config

archive/issues_030558.json:
```json
{
    "body": "Otherwise on partially configured trees this might be a problem.\nHere is a reproduction of a real bug I hit with a student today\n\n```\ndima@hilbert /mnt/opt/Sage/sage-clang $ echo Foo > src/bin/sage-env-config\ndima@hilbert /mnt/opt/Sage/sage-clang $ make bootstrap-clean \n...\ndima@hilbert /mnt/opt/Sage/sage-clang $ ./bootstrap \nrm -rf config configure build/make/Makefile-auto.in\nrm -f src/doc/en/installation/*.txt\nrm -rf src/doc/en/reference/spkg/*.rst\nrm -f src/doc/en/reference/repl/*.txt\nsrc/bin/sage-env-config: line 1: Foo: command not found\nmust source sage-env-config before sage-env\nsrc/doc/bootstrap:56: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt\nsrc/doc/bootstrap:56: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt\nsrc/doc/bootstrap:56: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt\nsrc/doc/bootstrap:56: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt\nsrc/doc/bootstrap:56: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt\nsrc/doc/bootstrap:65: installing src/doc/en/reference/spkg/*.rst\nsrc/doc/bootstrap:97: installing src/doc/en/reference/repl/options.txt\n/mnt/opt/Sage/sage-clang/src/bin/sage-env-config: line 1: Foo: command not found\nmust source sage-env-config before sage-env\nError setting environment variables by sourcing '/mnt/opt/Sage/sage-clang/src/bin/sage-env';\npossibly contact sage-devel (see http://groups.google.com/group/sage-devel).\n```\n\nCC:  @vbraun @orlitzky @mkoeppe\n\nBranch: f612b221e0180d8cdea595dbee54a11a39c041b8\n\nResolution: duplicate\n\nIssue created by migration from https://trac.sagemath.org/ticket/30795\n\n",
    "closed_at": "2021-06-06T15:10:37Z",
    "created_at": "2020-10-19T12:46:46Z",
    "labels": [
        "component: build: configure",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "bootstrap-clean must remove src/bin/sage-env-config",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30795",
    "user": "https://github.com/dimpase"
}
```
Otherwise on partially configured trees this might be a problem.
Here is a reproduction of a real bug I hit with a student today

```
dima@hilbert /mnt/opt/Sage/sage-clang $ echo Foo > src/bin/sage-env-config
dima@hilbert /mnt/opt/Sage/sage-clang $ make bootstrap-clean 
...
dima@hilbert /mnt/opt/Sage/sage-clang $ ./bootstrap 
rm -rf config configure build/make/Makefile-auto.in
rm -f src/doc/en/installation/*.txt
rm -rf src/doc/en/reference/spkg/*.rst
rm -f src/doc/en/reference/repl/*.txt
src/bin/sage-env-config: line 1: Foo: command not found
must source sage-env-config before sage-env
src/doc/bootstrap:56: installing src/doc/en/installation/arch.txt and src/doc/en/installation/arch-optional.txt
src/doc/bootstrap:56: installing src/doc/en/installation/debian.txt and src/doc/en/installation/debian-optional.txt
src/doc/bootstrap:56: installing src/doc/en/installation/fedora.txt and src/doc/en/installation/fedora-optional.txt
src/doc/bootstrap:56: installing src/doc/en/installation/cygwin.txt and src/doc/en/installation/cygwin-optional.txt
src/doc/bootstrap:56: installing src/doc/en/installation/homebrew.txt and src/doc/en/installation/homebrew-optional.txt
src/doc/bootstrap:65: installing src/doc/en/reference/spkg/*.rst
src/doc/bootstrap:97: installing src/doc/en/reference/repl/options.txt
/mnt/opt/Sage/sage-clang/src/bin/sage-env-config: line 1: Foo: command not found
must source sage-env-config before sage-env
Error setting environment variables by sourcing '/mnt/opt/Sage/sage-clang/src/bin/sage-env';
possibly contact sage-devel (see http://groups.google.com/group/sage-devel).
```

CC:  @vbraun @orlitzky @mkoeppe

Branch: f612b221e0180d8cdea595dbee54a11a39c041b8

Resolution: duplicate

Issue created by migration from https://trac.sagemath.org/ticket/30795





---

archive/issue_comments_610123.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-19T12:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610123",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_610124.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dimpase/build/morecleanbootstrap\"",
    "created_at": "2020-10-19T12:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610124",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "u/dimpase/build/morecleanbootstrap"



---

archive/issue_comments_610125.json:
```json
{
    "body": "Changing commit from \"\" to \"f976c52c57a722ed07feeafa5bc82a5064b2b362\"",
    "created_at": "2020-10-19T12:51:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610125",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "f976c52c57a722ed07feeafa5bc82a5064b2b362"



---

archive/issue_comments_610126.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-10-19T17:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610126",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_610127.json:
```json
{
    "body": "<a id='comment:2'></a>This does not seem to be the right branch",
    "created_at": "2020-10-19T17:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>This does not seem to be the right branch



---

archive/issue_comments_610128.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-19T19:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610128",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_610129.json:
```json
{
    "body": "Changing commit from \"f976c52c57a722ed07feeafa5bc82a5064b2b362\" to \"f612b221e0180d8cdea595dbee54a11a39c041b8\"",
    "created_at": "2020-10-19T19:09:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610129",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "f976c52c57a722ed07feeafa5bc82a5064b2b362" to "f612b221e0180d8cdea595dbee54a11a39c041b8"



---

archive/issue_comments_610130.json:
```json
{
    "body": "<a id='comment:4'></a>should be ok now,\nsorry for pushing this branch from a wrong window.",
    "created_at": "2020-10-19T19:10:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610130",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>should be ok now,
sorry for pushing this branch from a wrong window.



---

archive/issue_comments_610131.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-19T19:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610131",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_610132.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-10-19T19:28:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610132",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_610133.json:
```json
{
    "body": "<a id='comment:6'></a>Better development experience can't be a blocker",
    "created_at": "2020-10-24T11:08:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610133",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>Better development experience can't be a blocker



---

archive/issue_events_080318.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80318"
}
```



---

archive/issue_comments_610134.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-10-31T22:19:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610134",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_610135.json:
```json
{
    "body": "Changing branch from \"u/dimpase/build/morecleanbootstrap\" to \"f612b221e0180d8cdea595dbee54a11a39c041b8\"",
    "created_at": "2020-11-01T00:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610135",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/dimpase/build/morecleanbootstrap" to "f612b221e0180d8cdea595dbee54a11a39c041b8"



---

archive/issue_comments_610136.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-01T00:42:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610136",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080319.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-01T00:42:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80319"
}
```



---

archive/issue_comments_610137.json:
```json
{
    "body": "Resolution changed from fixed to ",
    "created_at": "2020-11-01T01:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610137",
    "user": "https://github.com/vbraun"
}
```

Resolution changed from fixed to 



---

archive/issue_comments_610138.json:
```json
{
    "body": "Changing commit from \"f612b221e0180d8cdea595dbee54a11a39c041b8\" to \"\"",
    "created_at": "2020-11-01T01:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610138",
    "user": "https://github.com/vbraun"
}
```

Changing commit from "f612b221e0180d8cdea595dbee54a11a39c041b8" to ""



---

archive/issue_comments_610139.json:
```json
{
    "body": "<a id='comment:10'></a>This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs, but I think thats a) complicated and b) error-prone as build artifacts going to sneak into source tarballs.",
    "created_at": "2020-11-01T01:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610139",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs, but I think thats a) complicated and b) error-prone as build artifacts going to sneak into source tarballs.



---

archive/issue_comments_610140.json:
```json
{
    "body": "Changing status from closed to new.",
    "created_at": "2020-11-01T01:00:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610140",
    "user": "https://github.com/vbraun"
}
```

Changing status from closed to new.



---

archive/issue_events_080320.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-01T01:00:18Z",
    "event": "reopened",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80320"
}
```



---

archive/issue_comments_610141.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 vbraun]:\n> This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs, but I think thats a) complicated and b) error-prone as build artifacts going to sneak into source tarballs.\n\n\nbut `sage-env-config` **is** a build artefact!",
    "created_at": "2020-11-01T09:35:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610141",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>Replying to [comment:10 vbraun]:
> This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs, but I think thats a) complicated and b) error-prone as build artifacts going to sneak into source tarballs.


but `sage-env-config` **is** a build artefact!



---

archive/issue_comments_610142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-01T10:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610142",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_610143.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 vbraun]:\n> This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs,\n\n\nno, why? All `sdist` needs is to know SAGE_ROOT and SAGE_SRC - and this info definitely does not need Sage to be built.\nI.e.\n\n```\nmake clean && SAGE_ROOT=`pwd` SAGE_SRC=`pwd`/src ./sage -sdist\n```\nshould work for you. If we really must, we can provide such defaults in `build/bin/sage-sdist`.\n\nPlease tell us how we should proceed here.",
    "created_at": "2020-11-01T10:01:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610143",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:12'></a>Replying to [comment:10 vbraun]:
> This breaks `make clean && ./sage -sdist`, which is what I'm using to create the source tarballs. One could require to first build Sage before making source tarballs,


no, why? All `sdist` needs is to know SAGE_ROOT and SAGE_SRC - and this info definitely does not need Sage to be built.
I.e.

```
make clean && SAGE_ROOT=`pwd` SAGE_SRC=`pwd`/src ./sage -sdist
```
should work for you. If we really must, we can provide such defaults in `build/bin/sage-sdist`.

Please tell us how we should proceed here.



---

archive/issue_comments_610144.json:
```json
{
    "body": "<a id='comment:13'></a>sage -sdist should work without setting environment variables. The path could also be hardcoded in the sage launcher script.",
    "created_at": "2020-11-01T12:59:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610144",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:13'></a>sage -sdist should work without setting environment variables. The path could also be hardcoded in the sage launcher script.



---

archive/issue_comments_610145.json:
```json
{
    "body": "<a id='comment:14'></a>Volker, is having `SAGE_SRC` configurable by environment setting needed for your release management scripts? Otherwise I would suggest that we get rid of this configuration option.",
    "created_at": "2020-11-01T16:15:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610145",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Volker, is having `SAGE_SRC` configurable by environment setting needed for your release management scripts? Otherwise I would suggest that we get rid of this configuration option.



---

archive/issue_comments_610146.json:
```json
{
    "body": "<a id='comment:15'></a>The problem reported on the original ticket description is fixed in #30841.\n\nBut I think it's time to clean up the `-clean` targets - see #21566, #21775.",
    "created_at": "2020-11-01T16:20:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610146",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>The problem reported on the original ticket description is fixed in #30841.

But I think it's time to clean up the `-clean` targets - see #21566, #21775.



---

archive/issue_comments_610147.json:
```json
{
    "body": "<a id='comment:17'></a>is this already merged? Can it be closed, or?",
    "created_at": "2021-01-18T17:25:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610147",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>is this already merged? Can it be closed, or?



---

archive/issue_events_080321.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T17:46:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80321"
}
```



---

archive/issue_events_080322.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-18T17:46:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80322"
}
```



---

archive/issue_comments_610148.json:
```json
{
    "body": "Changing reviewer from \"Matthias Koeppe\" to \"\"",
    "created_at": "2021-01-18T17:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610148",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "Matthias Koeppe" to ""



---

archive/issue_comments_610149.json:
```json
{
    "body": "<a id='comment:18'></a>I think it can be closed.",
    "created_at": "2021-01-18T17:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610149",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>I think it can be closed.



---

archive/issue_comments_610150.json:
```json
{
    "body": "Changing author from \"Dima Pasechnik\" to \"\"",
    "created_at": "2021-01-18T17:46:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610150",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Dima Pasechnik" to ""



---

archive/issue_comments_610151.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-18T19:19:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610151",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_610152.json:
```json
{
    "body": "Resolution: duplicate",
    "created_at": "2021-06-06T15:10:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30795#issuecomment-610152",
    "user": "https://github.com/fchapoton"
}
```

Resolution: duplicate



---

archive/issue_events_080323.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2021-06-06T15:10:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30795",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30795#event-80323"
}
```
