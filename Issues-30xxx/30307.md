# Issue 30307: Refactor Components into parent & element

archive/issues_030070.json:
```json
{
    "assignees": [],
    "body": "Currently every `Components` object has lots of metadata attributes in addition to the actual data dictionary in `._comp`.  \n\nIf one has many different `Components` objects with the same symmetry metadata, we can reduce storage space as follows.\n\nWe create new classes `CompParent`, `CompParentWithSym`, ..., which \nstore the symmetry attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  \n\nThe parents will also have index iterator methods.\n\nData associated with symmetries and dimensions, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can be precomputed and cached in the parent using `@cached_method` in the parent class).\n\n\nThis will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.\n\nSee also:\n- #32029 Action of a sympy `TensorSymmetry`\n\nDepends on #31904\nDepends on #29619\n\nCC:  @mjungmath @egourgoulhon @tscrim @honglizhaobob\n\nComponent: **linear algebra**\n\nAuthor: **Michael Jung, Matthias Koeppe**\n\nBranch/Commit: **[public/30307](https://github.com/sagemath/sagetrac-mirror/tree/public/30307) @ [`e5a81f2`](https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30307_\n\n",
    "created_at": "2020-08-07T01:26:06Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Refactor Components into parent & element",
    "type": "issue",
    "updated_at": "2023-01-08T08:50:26Z",
    "url": "https://github.com/sagemath/sage/issues/30307",
    "user": "https://github.com/mkoeppe"
}
```
Currently every `Components` object has lots of metadata attributes in addition to the actual data dictionary in `._comp`.  

If one has many different `Components` objects with the same symmetry metadata, we can reduce storage space as follows.

We create new classes `CompParent`, `CompParentWithSym`, ..., which 
store the symmetry attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  

The parents will also have index iterator methods.

Data associated with symmetries and dimensions, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can be precomputed and cached in the parent using `@cached_method` in the parent class).


This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.

See also:
- #32029 Action of a sympy `TensorSymmetry`

Depends on #31904
Depends on #29619

CC:  @mjungmath @egourgoulhon @tscrim @honglizhaobob

Component: **linear algebra**

Author: **Michael Jung, Matthias Koeppe**

Branch/Commit: **[public/30307](https://github.com/sagemath/sagetrac-mirror/tree/public/30307) @ [`e5a81f2`](https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e)**

_Issue created by migration from https://trac.sagemath.org/ticket/30307_





---

archive/issue_events_414393.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-07T01:26:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414393"
}
```



---

archive/issue_events_414394.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-07T01:26:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20linear%20algebra",
    "label_color": "0000ff",
    "label_name": "c: linear algebra",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414394"
}
```



---

archive/issue_events_414395.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-07T01:26:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414395"
}
```



---

archive/issue_events_414396.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-07T01:26:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414396"
}
```



---

archive/issue_events_414397.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414397"
}
```



---

archive/issue_events_414398.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414398"
}
```



---

archive/issue_comments_480728.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nHelp with implementing this would be very welcome!",
    "created_at": "2021-01-22T20:38:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480728",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

Help with implementing this would be very welcome!



---

archive/issue_comments_480729.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nThat's a nice idea, +1!\n\n> Data associated with symmetries, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can then be precomputed and cached in the parent (for example using `@`cached_method in the parent class).\n\nI think it would be a good idea to cache results from `trace`, `contract`, ... as well.\n\nThe most annoying thing with this ticket will most likely be the docstring that has to be adapted...is there a good way to use search&replace?",
    "created_at": "2021-01-22T23:41:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480729",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:3" align="right">comment:3</div>

That's a nice idea, +1!

> Data associated with symmetries, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can then be precomputed and cached in the parent (for example using `@`cached_method in the parent class).

I think it would be a good idea to cache results from `trace`, `contract`, ... as well.

The most annoying thing with this ticket will most likely be the docstring that has to be adapted...is there a good way to use search&replace?



---

archive/issue_comments_480730.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nCurrently, the index generators and manipulators take (mostly) lists and can therefore not be cached. To use the caching most efficiently, I suggest we switch entirely to tuples.",
    "created_at": "2021-01-23T13:09:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480730",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:4" align="right">comment:4</div>

Currently, the index generators and manipulators take (mostly) lists and can therefore not be cached. To use the caching most efficiently, I suggest we switch entirely to tuples.



---

archive/issue_comments_480731.json:
```json
{
    "body": "Branch: **[public/30307](https://github.com/sagemath/sagetrac-mirror/tree/public/30307)**",
    "created_at": "2021-01-23T14:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480731",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[public/30307](https://github.com/sagemath/sagetrac-mirror/tree/public/30307)**



---

archive/issue_comments_480732.json:
```json
{
    "body": "Commit: **[`943f9ea`](https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1)**",
    "created_at": "2021-01-23T14:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480732",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`943f9ea`](https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1)**



---

archive/issue_comments_480733.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fec4b0622eeb4f55f14cc6a3da6e5a832b44d006\"><code>fec4b06</code></a></td><td><code>fix sage -b after 30622</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dff846c11bce847f883a866dcc9c85b67932f7aa\"><code>dff846c</code></a></td><td><code>go through make/build/install</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1\"><code>943f9ea</code></a></td><td><code>Trac #30307: CompParent and CompParentWithSym</code></td></tr></table>\n",
    "created_at": "2021-01-23T14:05:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480733",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fec4b0622eeb4f55f14cc6a3da6e5a832b44d006"><code>fec4b06</code></a></td><td><code>fix sage -b after 30622</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dff846c11bce847f883a866dcc9c85b67932f7aa"><code>dff846c</code></a></td><td><code>go through make/build/install</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1"><code>943f9ea</code></a></td><td><code>Trac #30307: CompParent and CompParentWithSym</code></td></tr></table>




---

archive/issue_comments_480734.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nBefore I go on with this ticket, could you please take a look whether this meets your rough idea?\n\nIs anyone willing to work on the docstrings...? Perhaps there's an efficient way to do this?",
    "created_at": "2021-01-23T14:07:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480734",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:7" align="right">comment:7</div>

Before I go on with this ticket, could you please take a look whether this meets your rough idea?

Is anyone willing to work on the docstrings...? Perhaps there's an efficient way to do this?



---

archive/issue_comments_480735.json:
```json
{
    "body": "Changed commit from **[`943f9ea`](https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1)** to **[`a2514b6`](https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7)**",
    "created_at": "2021-01-23T14:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`943f9ea`](https://github.com/sagemath/sagetrac-mirror/commit/943f9ea4eb95d1e5b162ef88194799f1711d95c1)** to **[`a2514b6`](https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7)**



---

archive/issue_comments_480736.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7\"><code>a2514b6</code></a></td><td><code>Trac #30307: no symmetries -> CompParent without symmetries</code></td></tr></table>\n",
    "created_at": "2021-01-23T14:11:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480736",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7"><code>a2514b6</code></a></td><td><code>Trac #30307: no symmetries -> CompParent without symmetries</code></td></tr></table>




---

archive/issue_comments_480737.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mjungmath](#comment%3A7):\n> Before I go on with this ticket, could you please take a look whether this meets your rough idea?\n\nYes, this is going in the direction that I had in mind.\n\nSome more of the normalization happening in `CompParentWithSym.__init__` should probably be moved to `__classcall_private__`",
    "created_at": "2021-01-23T18:43:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480737",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mjungmath](#comment%3A7):
> Before I go on with this ticket, could you please take a look whether this meets your rough idea?

Yes, this is going in the direction that I had in mind.

Some more of the normalization happening in `CompParentWithSym.__init__` should probably be moved to `__classcall_private__`



---

archive/issue_comments_480738.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nWhat would be a proper category for the parent?",
    "created_at": "2021-01-24T11:16:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480738",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:10" align="right">comment:10</div>

What would be a proper category for the parent?



---

archive/issue_comments_480739.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@mkoeppe](#comment%3A9):\n> Some more of the normalization happening in `CompParentWithSym.__init__` should probably be moved to `__classcall_private__`\n\nFor example?",
    "created_at": "2021-01-24T11:49:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480739",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@mkoeppe](#comment%3A9):
> Some more of the normalization happening in `CompParentWithSym.__init__` should probably be moved to `__classcall_private__`

For example?



---

archive/issue_comments_480740.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nFor example the order of the component indices does not matter",
    "created_at": "2021-01-24T18:17:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480740",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

For example the order of the component indices does not matter



---

archive/issue_comments_480741.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@mjungmath](#comment%3A10):\n> What would be a proper category for the parent?\n\nTake the following with a grain of salt (this is just a rough/naive thought): It seems to me that the current proposal is a kind of abuse of Sage's parent/element scheme, for `CompParent` does not correspond to a \"genuine\" mathematical object (hence maybe your question...). In particular, it does not know about the ring on which the components are based. I do not deny that a reorganization of `Components` would be a good thing, but maybe at the class level, not at the parent/element level, the issue here being mostly the storage of metadata.",
    "created_at": "2021-01-24T18:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480741",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@mjungmath](#comment%3A10):
> What would be a proper category for the parent?

Take the following with a grain of salt (this is just a rough/naive thought): It seems to me that the current proposal is a kind of abuse of Sage's parent/element scheme, for `CompParent` does not correspond to a "genuine" mathematical object (hence maybe your question...). In particular, it does not know about the ring on which the components are based. I do not deny that a reorganization of `Components` would be a good thing, but maybe at the class level, not at the parent/element level, the issue here being mostly the storage of metadata.



---

archive/issue_comments_480742.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nJust use the category of sets. I don't think this is an abuse.\n\nThink of an instance of `CompParent` as the set of all possible `Components` instances that have the specified symmetry.\n\nBy using the parent/element framework, you will get coercion for free - so elements with a coarser symmetry will be `in` a finer parent.",
    "created_at": "2021-01-24T19:15:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480742",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Just use the category of sets. I don't think this is an abuse.

Think of an instance of `CompParent` as the set of all possible `Components` instances that have the specified symmetry.

By using the parent/element framework, you will get coercion for free - so elements with a coarser symmetry will be `in` a finer parent.



---

archive/issue_comments_480743.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mkoeppe](#comment%3A12):\n> For example the order of the component indices does not matter\n\nRight!\n\nReplying to [@mkoeppe](#comment%3A14):\n> Just use the category of sets. I don't think this is an abuse.\n> \n> Think of an instance of `CompParent` as the set of all possible `Components` instances that have the specified symmetry.\n> \n> By using the parent/element framework, you will get coercion for free - so elements with a coarser symmetry will be `in` a finer parent.\n\nFor me, it doesn't feel like an abuse either. Besides, I am sure you can make that notion of compontents mathematically rigorous. But I am not sure whether this becomes a well-defined set then... What about the category of objects?",
    "created_at": "2021-01-24T19:23:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480743",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mkoeppe](#comment%3A12):
> For example the order of the component indices does not matter

Right!

Replying to [@mkoeppe](#comment%3A14):
> Just use the category of sets. I don't think this is an abuse.
> 
> Think of an instance of `CompParent` as the set of all possible `Components` instances that have the specified symmetry.
> 
> By using the parent/element framework, you will get coercion for free - so elements with a coarser symmetry will be `in` a finer parent.

For me, it doesn't feel like an abuse either. Besides, I am sure you can make that notion of compontents mathematically rigorous. But I am not sure whether this becomes a well-defined set then... What about the category of objects?



---

archive/issue_comments_480744.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAlright, I make progress here. I changed only the backend such that most doctests should still pass, and the module can be used exactly as before. The elementary examples already passed.\n\nI'll push my branch tomorrow.\n\nI am looking forward to some benchmarks as soon as this branch is ready. :)",
    "created_at": "2021-01-24T20:37:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480744",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:16" align="right">comment:16</div>

Alright, I make progress here. I changed only the backend such that most doctests should still pass, and the module can be used exactly as before. The elementary examples already passed.

I'll push my branch tomorrow.

I am looking forward to some benchmarks as soon as this branch is ready. :)



---

archive/issue_comments_480745.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI can understand why this might seem like an abuse because it is a set of objects, but by extension, all of the combinatorial objects would be an abuse as well. So even though we will not be putting an extra mathematical structure on the components, this is still a valid use of the framework because there is a set of objects (the parent) and the individual objects (the elements).\n\nSomething to consider, however, is a potential speed penalty for the extra levels of initialization. This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.",
    "created_at": "2021-01-24T23:22:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480745",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

I can understand why this might seem like an abuse because it is a set of objects, but by extension, all of the combinatorial objects would be an abuse as well. So even though we will not be putting an extra mathematical structure on the components, this is still a valid use of the framework because there is a set of objects (the parent) and the individual objects (the elements).

Something to consider, however, is a potential speed penalty for the extra levels of initialization. This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.



---

archive/issue_comments_480746.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tscrim](#comment%3A17):\n> This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.\n\nHow so?",
    "created_at": "2021-01-25T02:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480746",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tscrim](#comment%3A17):
> This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.

How so?



---

archive/issue_comments_480747.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mjungmath](#comment%3A18):\n> Replying to [@tscrim](#comment%3A17):\n> > This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.\n\n> \n> How so?\n\nBecause Cython is faster than Python, including potential benefits from direct C-level function calls.",
    "created_at": "2021-01-25T02:58:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480747",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mjungmath](#comment%3A18):
> Replying to [@tscrim](#comment%3A17):
> > This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.

> 
> How so?

Because Cython is faster than Python, including potential benefits from direct C-level function calls.



---

archive/issue_comments_480748.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYes, that's clear. I meant, how to implement? Make `CompParent` and `Components` both simply extension types?\n\nWould `cdpef`ing the symmetry related functions cause a speedup btw?\n\nSince this involves only integers, i.e. struct types, one could even try to Cythonize these completely.",
    "created_at": "2021-01-25T07:45:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480748",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:20" align="right">comment:20</div>

Yes, that's clear. I meant, how to implement? Make `CompParent` and `Components` both simply extension types?

Would `cdpef`ing the symmetry related functions cause a speedup btw?

Since this involves only integers, i.e. struct types, one could even try to Cythonize these completely.



---

archive/issue_comments_480749.json:
```json
{
    "body": "Changed commit from **[`a2514b6`](https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7)** to **[`fc22d5d`](https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2)**",
    "created_at": "2021-01-25T13:50:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480749",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a2514b6`](https://github.com/sagemath/sagetrac-mirror/commit/a2514b6e70a05dbb354b535d4acbfdde4f55fdb7)** to **[`fc22d5d`](https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2)**



---

archive/issue_comments_480750.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2\"><code>fc22d5d</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr></table>\n",
    "created_at": "2021-01-25T13:50:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480750",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2"><code>fc22d5d</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr></table>




---

archive/issue_comments_480751.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@tscrim](#comment%3A17):\n> I can understand why this might seem like an abuse because it is a set of objects, but by extension, all of the combinatorial objects would be an abuse as well. So even though we will not be putting an extra mathematical structure on the components, this is still a valid use of the framework because there is a set of objects (the parent) and the individual objects (the elements).\n> \n\nThank you Matthias, Michael and Travis for your replies. I'm convinced now that parent/element is a good approach here (I was bothered by the lack of algebraic structure of the parent), especially for symmetry-based coercions. \n\n\n> Something to consider, however, is a potential speed penalty for the extra levels of initialization. This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.\n\nCertainly!\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2\"><code>fc22d5d</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr></table>\n",
    "created_at": "2021-01-25T13:52:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480751",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@tscrim](#comment%3A17):
> I can understand why this might seem like an abuse because it is a set of objects, but by extension, all of the combinatorial objects would be an abuse as well. So even though we will not be putting an extra mathematical structure on the components, this is still a valid use of the framework because there is a set of objects (the parent) and the individual objects (the elements).
> 

Thank you Matthias, Michael and Travis for your replies. I'm convinced now that parent/element is a good approach here (I was bothered by the lack of algebraic structure of the parent), especially for symmetry-based coercions. 


> Something to consider, however, is a potential speed penalty for the extra levels of initialization. This can be somewhat mitigated by using Cython, but performance regression testing is warranted here.

Certainly!

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2"><code>fc22d5d</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr></table>




---

archive/issue_comments_480752.json:
```json
{
    "body": "Changed commit from **[`fc22d5d`](https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2)** to **[`27bc9b1`](https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061)**",
    "created_at": "2021-01-25T13:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480752",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`fc22d5d`](https://github.com/sagemath/sagetrac-mirror/commit/fc22d5dd93320730cf97acfb426dedc6cba037c2)** to **[`27bc9b1`](https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061)**



---

archive/issue_comments_480753.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061\"><code>27bc9b1</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr></table>\n",
    "created_at": "2021-01-25T13:52:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480753",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061"><code>27bc9b1</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr></table>




---

archive/issue_comments_480754.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nA possibly relevant ticket, about enhancing symmetries of components beyond the currently implemented ones: #28813\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061\"><code>27bc9b1</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr></table>\n",
    "created_at": "2021-01-25T13:54:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480754",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:24" align="right">comment:24</div>

A possibly relevant ticket, about enhancing symmetries of components beyond the currently implemented ones: #28813

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061"><code>27bc9b1</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr></table>




---

archive/issue_comments_480755.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI am sorry for the mess. However, this is my rough approach. I separated elements and parents, and established factory methods to recover the old behavior (backwards compatibility and less work on the docstrings).\n\nI am open to suggestions how to separate the symmetry code apart. Some symmetry treatments are coupled to the element for optimization (e.g. `antisymmetrize` to determine zero more quickly).\n\nThis code is too big for me to do it alone. I'd appreciate some help here. I hope my first approach is of some use for you.",
    "created_at": "2021-01-25T13:57:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480755",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:25" align="right">comment:25</div>

I am sorry for the mess. However, this is my rough approach. I separated elements and parents, and established factory methods to recover the old behavior (backwards compatibility and less work on the docstrings).

I am open to suggestions how to separate the symmetry code apart. Some symmetry treatments are coupled to the element for optimization (e.g. `antisymmetrize` to determine zero more quickly).

This code is too big for me to do it alone. I'd appreciate some help here. I hope my first approach is of some use for you.



---

archive/issue_comments_480756.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nA concern about cythonizing the whole thing: the Python debugger cannot be used in Cython parts of codes, which is a pity, IMHO. So if Cython does not bring any significant performance improvement, we are loosing more than we gain.",
    "created_at": "2021-01-25T14:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480756",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:26" align="right">comment:26</div>

A concern about cythonizing the whole thing: the Python debugger cannot be used in Cython parts of codes, which is a pity, IMHO. So if Cython does not bring any significant performance improvement, we are loosing more than we gain.



---

archive/issue_comments_480757.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nAlso shouldn't one perform a single task in this ticket, namely refactor `Components` into parent/element, and leave cythonization to another ticket?",
    "created_at": "2021-01-25T14:08:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480757",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:27" align="right">comment:27</div>

Also shouldn't one perform a single task in this ticket, namely refactor `Components` into parent/element, and leave cythonization to another ticket?



---

archive/issue_comments_480758.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@egourgoulhon](#comment%3A27):\n> Also shouldn't one perform a single task in this ticket, namely refactor `Components` into parent/element, and leave cythonization to another ticket?\n\nThat makes sense. In the next step one could try to implement #28813, and perhaps even use Cython to do so.\n\nBesides, I just learned that one could increase the init speed with Python 3 using `__slots__`. Maybe that's what we should do for now.\n\nStill, I don't know how we should separate the symmetry code properly. My idea so far was to let the parent do the symmetrizing work and return the parent with the corresponding symmetries, and construct an element from it, then assign the components. But this doesn't work so well when the element itself such as in `antisymmetrize` is taken into account.\n\nAlternatively, it would be nice do define maps (morphisms) between parents doing that work and cache those morphisms. But that is something I don't know how to do in a nice and proper way. For example, if one antisymmetrizes in the variables where the components are already symmetric, it's simply the \"zero morphism\".",
    "created_at": "2021-01-25T15:14:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480758",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@egourgoulhon](#comment%3A27):
> Also shouldn't one perform a single task in this ticket, namely refactor `Components` into parent/element, and leave cythonization to another ticket?

That makes sense. In the next step one could try to implement #28813, and perhaps even use Cython to do so.

Besides, I just learned that one could increase the init speed with Python 3 using `__slots__`. Maybe that's what we should do for now.

Still, I don't know how we should separate the symmetry code properly. My idea so far was to let the parent do the symmetrizing work and return the parent with the corresponding symmetries, and construct an element from it, then assign the components. But this doesn't work so well when the element itself such as in `antisymmetrize` is taken into account.

Alternatively, it would be nice do define maps (morphisms) between parents doing that work and cache those morphisms. But that is something I don't know how to do in a nice and proper way. For example, if one antisymmetrizes in the variables where the components are already symmetric, it's simply the "zero morphism".



---

archive/issue_comments_480759.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nNevertheless, I think that the rough refactoring into `comp_element` and `comp_parent` (and `comp` to recover the old behavior) is already a good way to go.",
    "created_at": "2021-01-25T15:21:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480759",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:29" align="right">comment:29</div>

Nevertheless, I think that the rough refactoring into `comp_element` and `comp_parent` (and `comp` to recover the old behavior) is already a good way to go.



---

archive/issue_comments_480760.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@egourgoulhon](#comment%3A24):\n> A possibly relevant ticket, about enhancing symmetries of components beyond the currently implemented ones: #28813\n\nI agree that it would be a good idea to keep possible generalizations in mind while doing this refactoring. (Also #30276)",
    "created_at": "2021-01-25T18:01:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480760",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@egourgoulhon](#comment%3A24):
> A possibly relevant ticket, about enhancing symmetries of components beyond the currently implemented ones: #28813

I agree that it would be a good idea to keep possible generalizations in mind while doing this refactoring. (Also #30276)



---

archive/issue_comments_480761.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nDefinitely! So, do we have a roadmap?",
    "created_at": "2021-01-25T18:15:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480761",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:31" align="right">comment:31</div>

Definitely! So, do we have a roadmap?



---

archive/issue_comments_480762.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThis is looking nice already, and I agree that this ticket should do a Python implementation only. I would hope that there are already performance gains by caching.",
    "created_at": "2021-01-25T19:39:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480762",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

This is looking nice already, and I agree that this ticket should do a Python implementation only. I would hope that there are already performance gains by caching.



---

archive/issue_comments_480763.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\n@mkoeppe: What do you say about the morphism idea in [comment:27](#comment%3A27)?\n\n@tscrim: What about using `__slots__` in this ticket instead of Cythonizing?",
    "created_at": "2021-01-25T20:26:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480763",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:33" align="right">comment:33</div>

@mkoeppe: What do you say about the morphism idea in [comment:27](#comment%3A27)?

@tscrim: What about using `__slots__` in this ticket instead of Cythonizing?



---

archive/issue_comments_480764.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nRegrading the morphisms: These are exactly the `reduce`, `retract`, `lift` maps that we discussed in #30229 - just on the level of components rather than modules.",
    "created_at": "2021-01-25T20:36:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480764",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

Regrading the morphisms: These are exactly the `reduce`, `retract`, `lift` maps that we discussed in #30229 - just on the level of components rather than modules.



---

archive/issue_comments_480765.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mkoeppe](#comment%3A34):\n> Regrading the morphisms: These are exactly the `reduce`, `retract`, `lift` maps that we discussed in #30229 - just on the level of components rather than modules.\n\nMh...but I suggest more than 3 morphisms. I don't know what you mean, sorry.\n\nCan I take it as a \"yes, what a wonderful idea!\"? :P",
    "created_at": "2021-01-25T21:03:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480765",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mkoeppe](#comment%3A34):
> Regrading the morphisms: These are exactly the `reduce`, `retract`, `lift` maps that we discussed in #30229 - just on the level of components rather than modules.

Mh...but I suggest more than 3 morphisms. I don't know what you mean, sorry.

Can I take it as a "yes, what a wonderful idea!"? :P



---

archive/issue_comments_480766.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nYes, there are many maps:\n- For a `CompParent` with a coarser symmetry, there is an injection (`lift` map) to any `CompParent` with a finer symmetry.\netc.\n(And yes, it's a wonderful idea.)",
    "created_at": "2021-01-25T23:10:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480766",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Yes, there are many maps:
- For a `CompParent` with a coarser symmetry, there is an injection (`lift` map) to any `CompParent` with a finer symmetry.
etc.
(And yes, it's a wonderful idea.)



---

archive/issue_comments_480767.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI don't expect `__slots__` to provide much benefit to speed as from what I am reading, it is more useful for memory usage. The main thing is to turn the file into a `.pyx` file with a `.pxd` header for declarations. The element class should be a `cpdef` with the main parameters declared and given explicit typing. These are relatively easy things to do provided you don't have multiple inheritance in the element classes (the parent can remain normal Python classes in a pyx file).\n\nIMO, you also don't loose too much with converting to Cython with debugging because you still get a lot with error tracebacks. The biggest thing I have found lost is the ease of profiling to find bottlenecks. However, testing with practical examples can get around that a bit, and there is a tool to profile Cython code IIRC. So I generally see this as a smaller trade-off.",
    "created_at": "2021-01-26T02:24:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480767",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:37" align="right">comment:37</div>

I don't expect `__slots__` to provide much benefit to speed as from what I am reading, it is more useful for memory usage. The main thing is to turn the file into a `.pyx` file with a `.pxd` header for declarations. The element class should be a `cpdef` with the main parameters declared and given explicit typing. These are relatively easy things to do provided you don't have multiple inheritance in the element classes (the parent can remain normal Python classes in a pyx file).

IMO, you also don't loose too much with converting to Cython with debugging because you still get a lot with error tracebacks. The biggest thing I have found lost is the ease of profiling to find bottlenecks. However, testing with practical examples can get around that a bit, and there is a tool to profile Cython code IIRC. So I generally see this as a smaller trade-off.



---

archive/issue_comments_480768.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nWell, `__slots__` makes initializations faster because attribute access is significantly faster (up to 30%). Memory is just an additional benefit.\n\nEven if we turn `Components` into a `cpdef`, I think we still gain a good performance boost with `__slots__` which can sum up quickly with recurrent use of `_comp`.",
    "created_at": "2021-01-26T06:01:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480768",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:38" align="right">comment:38</div>

Well, `__slots__` makes initializations faster because attribute access is significantly faster (up to 30%). Memory is just an additional benefit.

Even if we turn `Components` into a `cpdef`, I think we still gain a good performance boost with `__slots__` which can sum up quickly with recurrent use of `_comp`.



---

archive/issue_comments_480769.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nTo use morphisms, we need a new category (say `Category of collections of abstract components`) and a homset, right?",
    "created_at": "2021-01-26T06:03:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480769",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:39" align="right">comment:39</div>

To use morphisms, we need a new category (say `Category of collections of abstract components`) and a homset, right?



---

archive/issue_comments_480770.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nBtw, I am not convinced that `cpdef`ing the class makes initializations faster, I'd bet on the contrary. When I understand it correctly, `cpdef` creates two classes in the background, an extension type and a usual Python class. Since we don't expect a benefit during the lifetime of an instance, it should even slowdown things. But maybe I just got things wrong here.",
    "created_at": "2021-01-26T06:11:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480770",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:40" align="right">comment:40</div>

Btw, I am not convinced that `cpdef`ing the class makes initializations faster, I'd bet on the contrary. When I understand it correctly, `cpdef` creates two classes in the background, an extension type and a usual Python class. Since we don't expect a benefit during the lifetime of an instance, it should even slowdown things. But maybe I just got things wrong here.



---

archive/issue_comments_480771.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nWhat are you talking about `cpdef`ing a class? You only do that to functions AFAIK. I am still not 100% convinced by the `__slots__` approach, more so because it makes it (slightly) harder to switch from a Python class to an extension class IIRC.\n\nI don't see why we need a new category. We don't need to be so heavy-handed with the approach. Having the homset be in the category of (enumerated?) sets is sufficient IMO.",
    "created_at": "2021-01-28T08:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480771",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:42" align="right">comment:42</div>

What are you talking about `cpdef`ing a class? You only do that to functions AFAIK. I am still not 100% convinced by the `__slots__` approach, more so because it makes it (slightly) harder to switch from a Python class to an extension class IIRC.

I don't see why we need a new category. We don't need to be so heavy-handed with the approach. Having the homset be in the category of (enumerated?) sets is sufficient IMO.



---

archive/issue_comments_480772.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nThe main benefit with Cython and extension classes is being able to strongly type things to have as many C level function calls and code as possible.",
    "created_at": "2021-01-28T08:22:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480772",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:43" align="right">comment:43</div>

The main benefit with Cython and extension classes is being able to strongly type things to have as many C level function calls and code as possible.



---

archive/issue_comments_480773.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@tscrim](#comment%3A42):\n> I don't see why we need a new category. We don't need to be so heavy-handed with the approach. Having the homset be in the category of (enumerated?) sets is sufficient IMO.\n\nMathematically, I am still not convinced that our parents constitute sets. Their elements run over all possible rings (and \"frames\"), which is not a set either.",
    "created_at": "2021-01-28T09:53:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480773",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@tscrim](#comment%3A42):
> I don't see why we need a new category. We don't need to be so heavy-handed with the approach. Having the homset be in the category of (enumerated?) sets is sufficient IMO.

Mathematically, I am still not convinced that our parents constitute sets. Their elements run over all possible rings (and "frames"), which is not a set either.



---

archive/issue_comments_480774.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@tscrim](#comment%3A43):\n> The main benefit with Cython and extension classes is being able to strongly type things to have as many C level function calls and code as possible.\n\nIndeed. That needs a thorough modification of the current code. The indices checks use mostly lists and Python sets. The components are stored as dictionaries which cannot be strongly typed. I agree, that should eventually be done, however I propose that's something for another ticket.",
    "created_at": "2021-01-28T10:00:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480774",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@tscrim](#comment%3A43):
> The main benefit with Cython and extension classes is being able to strongly type things to have as many C level function calls and code as possible.

Indeed. That needs a thorough modification of the current code. The indices checks use mostly lists and Python sets. The components are stored as dictionaries which cannot be strongly typed. I agree, that should eventually be done, however I propose that's something for another ticket.



---

archive/issue_comments_480775.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nFor now, we can use `__slots__` for a slight speedup and remove it again when we Cythonize. That's what I meant.",
    "created_at": "2021-01-28T11:32:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480775",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:46" align="right">comment:46</div>

For now, we can use `__slots__` for a slight speedup and remove it again when we Cythonize. That's what I meant.



---

archive/issue_comments_480776.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI don't really like this partial measure. I wouldn't do it and just keep it pure Python until you actually decide to make it Cython.\n\nWhy is the ring associated with the element and not the parent? In general, why is all of these attributes copied from the parent? Is the extra level of indirection that slow? You can just call `self._parent` in the Cython code.\n\nBecause of how your current implementation is done, you are not going to benefit from coercions. Nor do you seem to be using anything in a category. Thus, I would actually weaken things and not use Sage's Parent/Element classes. Instead, I would just mimic them. Perhaps I am misunderstanding how you plan to apply these.\n\nThere is still a lot of you things you can do to tell Cython to make things be strongly typed even if they are extracted from lists/sets/dicts, such as type-casting.",
    "created_at": "2021-01-28T23:30:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480776",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:47" align="right">comment:47</div>

I don't really like this partial measure. I wouldn't do it and just keep it pure Python until you actually decide to make it Cython.

Why is the ring associated with the element and not the parent? In general, why is all of these attributes copied from the parent? Is the extra level of indirection that slow? You can just call `self._parent` in the Cython code.

Because of how your current implementation is done, you are not going to benefit from coercions. Nor do you seem to be using anything in a category. Thus, I would actually weaken things and not use Sage's Parent/Element classes. Instead, I would just mimic them. Perhaps I am misunderstanding how you plan to apply these.

There is still a lot of you things you can do to tell Cython to make things be strongly typed even if they are extracted from lists/sets/dicts, such as type-casting.



---

archive/issue_comments_480777.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nPlease don't look at the details yet. The code is far away from being finished. Coercions come, attributes will be removed (it's just to make parts of the code already debuggable).\n\nWhy has the parent no ring? Because the symmetries and indices simply do not depend on it. On the level of indices and symmetries we have: different ring -> same data -> same instance -> more effective storage.",
    "created_at": "2021-01-29T08:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480777",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:48" align="right">comment:48</div>

Please don't look at the details yet. The code is far away from being finished. Coercions come, attributes will be removed (it's just to make parts of the code already debuggable).

Why has the parent no ring? Because the symmetries and indices simply do not depend on it. On the level of indices and symmetries we have: different ring -> same data -> same instance -> more effective storage.



---

archive/issue_comments_480778.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@mjungmath](#comment%3A48):\n> Why has the parent no ring? Because the symmetries and indices simply do not depend on it. On the level of indices and symmetries we have: different ring -> same data -> same instance -> more effective storage. \n\nYou're passing around a pointer to the ring in a lot of the elements, which is storage. Since I doubt the ring will change much, I don't think you gain much. Plus you have to pass more around, which makes maintenance harder and can come with performance impacts.",
    "created_at": "2021-01-29T08:20:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480778",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@mjungmath](#comment%3A48):
> Why has the parent no ring? Because the symmetries and indices simply do not depend on it. On the level of indices and symmetries we have: different ring -> same data -> same instance -> more effective storage. 

You're passing around a pointer to the ring in a lot of the elements, which is storage. Since I doubt the ring will change much, I don't think you gain much. Plus you have to pass more around, which makes maintenance harder and can come with performance impacts.



---

archive/issue_comments_480779.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nReplying to [@mjungmath](#comment%3A44):\n> \n> Mathematically, I am still not convinced that our parents constitute sets. Their elements run over all possible rings (and \"frames\"), which is not a set either.\n\nI've also the feeling that this kind of parents cannot be sets in the meaning of standard set theory.",
    "created_at": "2021-01-29T09:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480779",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:50" align="right">comment:50</div>

Replying to [@mjungmath](#comment%3A44):
> 
> Mathematically, I am still not convinced that our parents constitute sets. Their elements run over all possible rings (and "frames"), which is not a set either.

I've also the feeling that this kind of parents cannot be sets in the meaning of standard set theory.



---

archive/issue_comments_480780.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nAlright, probably you're right, Travis (as always). :P\n\nBut I'm still convinced that `__slots__` is a good thing for now. It will take a while until we have Cythonized everything.\n\nEven if we delegate the ring to the parent, they are still no sets. The \"frame\" is still an object in the category of finite sets (with length `n`).",
    "created_at": "2021-01-30T09:57:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480780",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:52" align="right">comment:52</div>

Alright, probably you're right, Travis (as always). :P

But I'm still convinced that `__slots__` is a good thing for now. It will take a while until we have Cythonized everything.

Even if we delegate the ring to the parent, they are still no sets. The "frame" is still an object in the category of finite sets (with length `n`).



---

archive/issue_comments_480781.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nReplying to [@mjungmath](#comment%3A52):\n> But I'm still convinced that `__slots__` is a good thing for now. It will take a while until we have Cythonized everything.\n\nI am not, but I don't have the same stake in the code as you. A little experimentation is not a bad thing either.",
    "created_at": "2021-02-01T02:52:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480781",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:53" align="right">comment:53</div>

Replying to [@mjungmath](#comment%3A52):
> But I'm still convinced that `__slots__` is a good thing for now. It will take a while until we have Cythonized everything.

I am not, but I don't have the same stake in the code as you. A little experimentation is not a bad thing either.



---

archive/issue_comments_480782.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nMh. Matthias, Eric, what are your opinions on that `__slot__` matter?",
    "created_at": "2021-02-01T05:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480782",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:54" align="right">comment:54</div>

Mh. Matthias, Eric, what are your opinions on that `__slot__` matter?



---

archive/issue_comments_480783.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nIt's a further optimization and I think it should be tried in a follow-up, not this ticket",
    "created_at": "2021-02-01T05:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480783",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

It's a further optimization and I think it should be tried in a follow-up, not this ticket



---

archive/issue_comments_480784.json:
```json
{
    "body": "<div id=\"comment:56\" align=\"right\">comment:56</div>\n\nReplying to [@mkoeppe](#comment%3A55):\n> It's a further optimization and I think it should be tried in a follow-up, not this ticket\n\n+1",
    "created_at": "2021-02-01T08:21:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480784",
    "user": "https://github.com/egourgoulhon"
}
```

<div id="comment:56" align="right">comment:56</div>

Replying to [@mkoeppe](#comment%3A55):
> It's a further optimization and I think it should be tried in a follow-up, not this ticket

+1



---

archive/issue_events_414399.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414399"
}
```



---

archive/issue_events_414400.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414400"
}
```



---

archive/issue_comments_480785.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480785",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:57" align="right">comment:57</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_480786.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nAlright, let's do that optimization in a follow-up.\n\nHowever, I am still concerned about `CompParent` being a proper class, which means that the collection of all those parents is no class at all and hence no category in terms of strict category theory.\n\nAny ideas how to circumvent this matter?",
    "created_at": "2021-02-14T17:30:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480786",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:58" align="right">comment:58</div>

Alright, let's do that optimization in a follow-up.

However, I am still concerned about `CompParent` being a proper class, which means that the collection of all those parents is no class at all and hence no category in terms of strict category theory.

Any ideas how to circumvent this matter?



---

archive/issue_comments_480787.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nReplying to [@mjungmath](#comment%3A58):\n> However, I am still concerned about `CompParent` being a proper class, which means that the collection of all those parents is no class at all and hence no category in terms of strict category theory.\n> \n> Any ideas how to circumvent this matter?\n\nStop worrying about it. We can have slight abuses in Sage (see `RR` being a field), and this is also something that is a very technical point that is occurring below what most users will see.",
    "created_at": "2021-02-15T00:01:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480787",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:59" align="right">comment:59</div>

Replying to [@mjungmath](#comment%3A58):
> However, I am still concerned about `CompParent` being a proper class, which means that the collection of all those parents is no class at all and hence no category in terms of strict category theory.
> 
> Any ideas how to circumvent this matter?

Stop worrying about it. We can have slight abuses in Sage (see `RR` being a field), and this is also something that is a very technical point that is occurring below what most users will see.



---

archive/issue_comments_480788.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nThis task seems nothing that can be done in just one day. I would appreciate a little help and direction here. Especially w.r.t. #30276 and #28813. It would be a shame to put a lot of work in here if we had to refactor it again to achieve #30276 and #28813.",
    "created_at": "2021-03-25T15:53:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480788",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:60" align="right">comment:60</div>

This task seems nothing that can be done in just one day. I would appreciate a little help and direction here. Especially w.r.t. #30276 and #28813. It would be a shame to put a lot of work in here if we had to refactor it again to achieve #30276 and #28813.



---

archive/issue_comments_480789.json:
```json
{
    "body": "<div id=\"comment:61\" align=\"right\">comment:61</div>\n\nI'll return to it after the 9.3 release",
    "created_at": "2021-03-25T16:05:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480789",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:61" align="right">comment:61</div>

I'll return to it after the 9.3 release



---

archive/issue_comments_480790.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,4 +12,5 @@\n \n This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.\n \n+See also: SymPy's `TensorIndexType`, `TensorSymmetry`, `TensorHead`, `TensorManager` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945\n \n``````\n",
    "created_at": "2021-06-10T01:37:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480790",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,4 +12,5 @@
 
 This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.
 
+See also: SymPy's `TensorIndexType`, `TensorSymmetry`, `TensorHead`, `TensorManager` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945
 
``````




---

archive/issue_comments_480791.json:
```json
{
    "body": "<div id=\"comment:64\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64a17ee0cf28d2fe7da0508278f4b96961a9dd52\"><code>64a17ee</code></a></td><td><code>Trac #30307: CompParent and CompParentWithSym</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2186b66d74688b984daec46ef432c64c82509631\"><code>2186b66</code></a></td><td><code>Trac #30307: no symmetries -> CompParent without symmetries</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/08f3b7b5204d01f62db14a2ec66525850188a78e\"><code>08f3b7b</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7c2a7c5039835e9a39231aa882f28f7f81d3d1c6\"><code>7c2a7c5</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215\"><code>19f0a22</code></a></td><td><code>sage.tensor.modules.comp_element: Back to pure Python</code></td></tr></table>\n",
    "created_at": "2021-06-15T17:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480791",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:64"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64a17ee0cf28d2fe7da0508278f4b96961a9dd52"><code>64a17ee</code></a></td><td><code>Trac #30307: CompParent and CompParentWithSym</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2186b66d74688b984daec46ef432c64c82509631"><code>2186b66</code></a></td><td><code>Trac #30307: no symmetries -> CompParent without symmetries</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/08f3b7b5204d01f62db14a2ec66525850188a78e"><code>08f3b7b</code></a></td><td><code>Trac 30307: Cythonize, restructuring, factory method to resemble old behavior</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7c2a7c5039835e9a39231aa882f28f7f81d3d1c6"><code>7c2a7c5</code></a></td><td><code>Trac #30307: pdx file + __init__.py removed</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215"><code>19f0a22</code></a></td><td><code>sage.tensor.modules.comp_element: Back to pure Python</code></td></tr></table>




---

archive/issue_comments_480792.json:
```json
{
    "body": "Changed commit from **[`27bc9b1`](https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061)** to **[`19f0a22`](https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215)**",
    "created_at": "2021-06-15T17:44:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480792",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`27bc9b1`](https://github.com/sagemath/sagetrac-mirror/commit/27bc9b1ddd376da516228b8c8144c6139376f061)** to **[`19f0a22`](https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215)**



---

archive/issue_comments_480793.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nI have rebased the branch on top of the current develop.\n\nTo keep the ticket more focused, I have undone the Cythonization.",
    "created_at": "2021-06-15T18:14:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480793",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:65" align="right">comment:65</div>

I have rebased the branch on top of the current develop.

To keep the ticket more focused, I have undone the Cythonization.



---

archive/issue_comments_480794.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nI am going to move `start_index` from the parents to the elements because the symmetries have nothing to do with it.",
    "created_at": "2021-06-15T18:16:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480794",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:66" align="right">comment:66</div>

I am going to move `start_index` from the parents to the elements because the symmetries have nothing to do with it.



---

archive/issue_comments_480795.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nSame also for `_dim`. \n\nMethod `index_generator` will take a list of range objects - this will provide a generalization for the case of tensors between modules of differing ranks",
    "created_at": "2021-06-15T18:52:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480795",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:67" align="right">comment:67</div>

Same also for `_dim`. 

Method `index_generator` will take a list of range objects - this will provide a generalization for the case of tensors between modules of differing ranks



---

archive/issue_comments_480796.json:
```json
{
    "body": "Changed commit from **[`19f0a22`](https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215)** to **[`75aed16`](https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5)**",
    "created_at": "2021-06-15T19:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480796",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`19f0a22`](https://github.com/sagemath/sagetrac-mirror/commit/19f0a222e96da2206ec666a3008f7df51be96215)** to **[`75aed16`](https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5)**



---

archive/issue_comments_480797.json:
```json
{
    "body": "<div id=\"comment:68\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5\"><code>75aed16</code></a></td><td><code>WIP: Remove dim and start_index from CompParent</code></td></tr></table>\n",
    "created_at": "2021-06-15T19:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480797",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:68"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5"><code>75aed16</code></a></td><td><code>WIP: Remove dim and start_index from CompParent</code></td></tr></table>




---

archive/issue_comments_480798.json:
```json
{
    "body": "Changed commit from **[`75aed16`](https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5)** to **[`14a070f`](https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c)**",
    "created_at": "2021-06-15T20:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480798",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`75aed16`](https://github.com/sagemath/sagetrac-mirror/commit/75aed16b63e8fee4e2ffbda9cd2a5d6b43fd52d5)** to **[`14a070f`](https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c)**



---

archive/issue_comments_480799.json:
```json
{
    "body": "<div id=\"comment:69\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c\"><code>14a070f</code></a></td><td><code>WIP: CompParent</code></td></tr></table>\n",
    "created_at": "2021-06-15T20:36:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480799",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:69"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c"><code>14a070f</code></a></td><td><code>WIP: CompParent</code></td></tr></table>




---

archive/issue_comments_480800.json:
```json
{
    "body": "Changed commit from **[`14a070f`](https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c)** to **[`f6bde0a`](https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677)**",
    "created_at": "2021-06-15T23:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480800",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`14a070f`](https://github.com/sagemath/sagetrac-mirror/commit/14a070f810a61a162908798f8869c7d1310ca76c)** to **[`f6bde0a`](https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677)**



---

archive/issue_comments_480801.json:
```json
{
    "body": "<div id=\"comment:70\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677\"><code>f6bde0a</code></a></td><td><code>Finish comp_parent.py</code></td></tr></table>\n",
    "created_at": "2021-06-15T23:32:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480801",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:70"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677"><code>f6bde0a</code></a></td><td><code>Finish comp_parent.py</code></td></tr></table>




---

archive/issue_comments_480802.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,14 +1,14 @@\n Currently every `Components` object has lots of metadata attributes in addition to the actual data dictionary in `._comp`.  \n \n-If one has many different `Components` objects with the same metadata, we can reduce storage space as follows.\n+If one has many different `Components` objects with the same symmetry metadata, we can reduce storage space as follows.\n \n We create new classes `CompParent`, `CompParentWithSym`, ..., which \n-store the attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  \n-\n-Data associated with symmetries, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can then be precomputed and cached in the parent (for example using `@`cached_method in the parent class).\n-\n+store the symmetry attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  \n \n The parents will also have index iterator methods.\n+\n+Data associated with symmetries and dimensions, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can be precomputed and cached in the parent using `@cached_method` in the parent class).\n+\n \n This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.\n \n``````\n",
    "created_at": "2021-06-15T23:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480802",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,14 +1,14 @@
 Currently every `Components` object has lots of metadata attributes in addition to the actual data dictionary in `._comp`.  
 
-If one has many different `Components` objects with the same metadata, we can reduce storage space as follows.
+If one has many different `Components` objects with the same symmetry metadata, we can reduce storage space as follows.
 
 We create new classes `CompParent`, `CompParentWithSym`, ..., which 
-store the attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  
-
-Data associated with symmetries, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can then be precomputed and cached in the parent (for example using `@`cached_method in the parent class).
-
+store the symmetry attributes and become `UniqueRepresentation`. We make `Components` objects elements of these parents.  
 
 The parents will also have index iterator methods.
+
+Data associated with symmetries and dimensions, computed currently each time for each `CompWithSym` object in methods such as `__init__`, `__add__`, `trace`, ... can be precomputed and cached in the parent using `@cached_method` in the parent class).
+
 
 This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.
 
``````




---

archive/issue_comments_480803.json:
```json
{
    "body": "<div id=\"comment:72\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5\"><code>cabcd49</code></a></td><td><code>src/sage/tensor/modules/comp*.py: Mostly working</code></td></tr></table>\n",
    "created_at": "2021-06-16T01:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480803",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:72"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5"><code>cabcd49</code></a></td><td><code>src/sage/tensor/modules/comp*.py: Mostly working</code></td></tr></table>




---

archive/issue_comments_480804.json:
```json
{
    "body": "Changed commit from **[`f6bde0a`](https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677)** to **[`cabcd49`](https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5)**",
    "created_at": "2021-06-16T01:39:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480804",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6bde0a`](https://github.com/sagemath/sagetrac-mirror/commit/f6bde0a9f9cfd69254aa0ca1ba8b0ffc04b77677)** to **[`cabcd49`](https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5)**



---

archive/issue_comments_480805.json:
```json
{
    "body": "<div id=\"comment:73\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c\"><code>d8a7208</code></a></td><td><code>sage.tensor.modules.comp_element_dict: Split out from sage.tensor.modules.comp_element</code></td></tr></table>\n",
    "created_at": "2021-06-16T02:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480805",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:73"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c"><code>d8a7208</code></a></td><td><code>sage.tensor.modules.comp_element_dict: Split out from sage.tensor.modules.comp_element</code></td></tr></table>




---

archive/issue_comments_480806.json:
```json
{
    "body": "Changed commit from **[`cabcd49`](https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5)** to **[`d8a7208`](https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c)**",
    "created_at": "2021-06-16T02:35:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480806",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`cabcd49`](https://github.com/sagemath/sagetrac-mirror/commit/cabcd49408c1d08be982b5c36d2b1deec779e4f5)** to **[`d8a7208`](https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c)**



---

archive/issue_comments_480807.json:
```json
{
    "body": "<div id=\"comment:74\" align=\"right\">comment:74</div>\n\nStarted to prepare the classes for multiple backend implementations.",
    "created_at": "2021-06-16T02:35:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480807",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:74" align="right">comment:74</div>

Started to prepare the classes for multiple backend implementations.



---

archive/issue_comments_480808.json:
```json
{
    "body": "<div id=\"comment:75\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f\"><code>5395aa3</code></a></td><td><code>Update doctest output for trivial output changes</code></td></tr></table>\n",
    "created_at": "2021-06-16T03:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480808",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:75"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f"><code>5395aa3</code></a></td><td><code>Update doctest output for trivial output changes</code></td></tr></table>




---

archive/issue_comments_480809.json:
```json
{
    "body": "Changed commit from **[`d8a7208`](https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c)** to **[`5395aa3`](https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f)**",
    "created_at": "2021-06-16T03:16:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480809",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d8a7208`](https://github.com/sagemath/sagetrac-mirror/commit/d8a7208977f3433f9a5f107f30326755cca71e9c)** to **[`5395aa3`](https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f)**



---

archive/issue_comments_480810.json:
```json
{
    "body": "<div id=\"comment:76\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e772f707c63c0e095bffafd772fd1569e1687c5a\"><code>e772f70</code></a></td><td><code>Fix symmetrization bug</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f\"><code>7d6ffed</code></a></td><td><code>Update doctest output for cases where the code now detects full symmetry</code></td></tr></table>\n",
    "created_at": "2021-06-16T03:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480810",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:76"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e772f707c63c0e095bffafd772fd1569e1687c5a"><code>e772f70</code></a></td><td><code>Fix symmetrization bug</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f"><code>7d6ffed</code></a></td><td><code>Update doctest output for cases where the code now detects full symmetry</code></td></tr></table>




---

archive/issue_comments_480811.json:
```json
{
    "body": "Changed commit from **[`5395aa3`](https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f)** to **[`7d6ffed`](https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f)**",
    "created_at": "2021-06-16T03:55:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480811",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5395aa3`](https://github.com/sagemath/sagetrac-mirror/commit/5395aa37acf0d26543fa7c4d0f3950f23403684f)** to **[`7d6ffed`](https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f)**



---

archive/issue_comments_480812.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n \n This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.\n \n-See also: SymPy's `TensorIndexType`, `TensorSymmetry`, `TensorHead`, `TensorManager` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945\n+See also: SymPy's `TensorSymmetry` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945\n \n``````\n",
    "created_at": "2021-06-16T04:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480812",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 
 This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.
 
-See also: SymPy's `TensorIndexType`, `TensorSymmetry`, `TensorHead`, `TensorManager` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945
+See also: SymPy's `TensorSymmetry` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945
 
``````




---

archive/issue_comments_480813.json:
```json
{
    "body": "Dependencies: **#31904**",
    "created_at": "2021-06-17T18:56:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480813",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#31904**



---

archive/issue_comments_480814.json:
```json
{
    "body": "Changed commit from **[`7d6ffed`](https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f)** to **[`eed8f46`](https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e)**",
    "created_at": "2021-06-17T19:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480814",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7d6ffed`](https://github.com/sagemath/sagetrac-mirror/commit/7d6ffede2fd7f191bcc03d506fa9b796304f592f)** to **[`eed8f46`](https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e)**



---

archive/issue_comments_480815.json:
```json
{
    "body": "<div id=\"comment:79\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8455aab6a2b5193539aea0a0c783aa02c43e6bfd\"><code>8455aab</code></a></td><td><code>Fix bug #31904 in pullback</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aea4554d90de3a3cb39c0e3704edc0807d8b4109\"><code>aea4554</code></a></td><td><code>#31904: Fix indentation in _pullback_chart</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cfb629cda99dae9d5cd958ed3a4fdfb3703c6b1b\"><code>cfb629c</code></a></td><td><code>Merge #31904</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e\"><code>eed8f46</code></a></td><td><code>DiffMap.pullback: Replace dispatching to Comp* classes by parent call</code></td></tr></table>\n",
    "created_at": "2021-06-17T19:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480815",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:79"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8455aab6a2b5193539aea0a0c783aa02c43e6bfd"><code>8455aab</code></a></td><td><code>Fix bug #31904 in pullback</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aea4554d90de3a3cb39c0e3704edc0807d8b4109"><code>aea4554</code></a></td><td><code>#31904: Fix indentation in _pullback_chart</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cfb629cda99dae9d5cd958ed3a4fdfb3703c6b1b"><code>cfb629c</code></a></td><td><code>Merge #31904</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e"><code>eed8f46</code></a></td><td><code>DiffMap.pullback: Replace dispatching to Comp* classes by parent call</code></td></tr></table>




---

archive/issue_comments_480816.json:
```json
{
    "body": "<div id=\"comment:80\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f\"><code>6da636e</code></a></td><td><code>CompParent...: Add `__classcall_private__` methods</code></td></tr></table>\n",
    "created_at": "2021-06-17T19:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480816",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:80"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f"><code>6da636e</code></a></td><td><code>CompParent...: Add `__classcall_private__` methods</code></td></tr></table>




---

archive/issue_comments_480817.json:
```json
{
    "body": "Changed commit from **[`eed8f46`](https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e)** to **[`6da636e`](https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f)**",
    "created_at": "2021-06-17T19:59:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480817",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eed8f46`](https://github.com/sagemath/sagetrac-mirror/commit/eed8f46a0eb7b7d25b9a754b2aa7b6f7853a8f7e)** to **[`6da636e`](https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f)**



---

archive/issue_comments_480818.json:
```json
{
    "body": "<div id=\"comment:81\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e9bfefd4c3a24da9b2be70c7e69df29eacdc3fe\"><code>3e9bfef</code></a></td><td><code>FreeModuleTensor: Make _sym, _antisym tuples, fix repr of Symmetric bilinear form</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965\"><code>9c0d7f1</code></a></td><td><code>sage.tensor.modules: Update doctest output for trivial output changes</code></td></tr></table>\n",
    "created_at": "2021-06-17T21:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480818",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:81"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e9bfefd4c3a24da9b2be70c7e69df29eacdc3fe"><code>3e9bfef</code></a></td><td><code>FreeModuleTensor: Make _sym, _antisym tuples, fix repr of Symmetric bilinear form</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965"><code>9c0d7f1</code></a></td><td><code>sage.tensor.modules: Update doctest output for trivial output changes</code></td></tr></table>




---

archive/issue_comments_480819.json:
```json
{
    "body": "Changed commit from **[`6da636e`](https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f)** to **[`9c0d7f1`](https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965)**",
    "created_at": "2021-06-17T21:15:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480819",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`6da636e`](https://github.com/sagemath/sagetrac-mirror/commit/6da636ee3a3f0f615a01c22b1db61fd208dc819f)** to **[`9c0d7f1`](https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965)**



---

archive/issue_comments_480820.json:
```json
{
    "body": "<div id=\"comment:82\" align=\"right\">comment:82</div>\n\nI will need to revise the design a bit to accommodate different backends.\n\nA `CompParent` will become a free module over a fixed ring.  \n\nFixing the ring is necessary because numerical backends (for example for NumPy's `ndarray`) can only work with base ring `RDF`; whereas the symbolic backends (such as the existing dictionary-based implementation) is for `SR` and exact rings.",
    "created_at": "2021-06-17T22:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480820",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:82" align="right">comment:82</div>

I will need to revise the design a bit to accommodate different backends.

A `CompParent` will become a free module over a fixed ring.  

Fixing the ring is necessary because numerical backends (for example for NumPy's `ndarray`) can only work with base ring `RDF`; whereas the symbolic backends (such as the existing dictionary-based implementation) is for `SR` and exact rings.



---

archive/issue_comments_480821.json:
```json
{
    "body": "Changed commit from **[`9c0d7f1`](https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965)** to **[`4408f1d`](https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9)**",
    "created_at": "2021-06-17T23:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480821",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c0d7f1`](https://github.com/sagemath/sagetrac-mirror/commit/9c0d7f1231d02e9e9444b413f29a67e4deffd965)** to **[`4408f1d`](https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9)**



---

archive/issue_comments_480822.json:
```json
{
    "body": "<div id=\"comment:83\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e1b6341c9ae309b08f6a8309a4c33c39969ce078\"><code>e1b6341</code></a></td><td><code>Make Components a module over 'ring'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9\"><code>4408f1d</code></a></td><td><code>Make Components_base a ModuleElementWithMutability</code></td></tr></table>\n",
    "created_at": "2021-06-17T23:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480822",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:83"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e1b6341c9ae309b08f6a8309a4c33c39969ce078"><code>e1b6341</code></a></td><td><code>Make Components a module over 'ring'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9"><code>4408f1d</code></a></td><td><code>Make Components_base a ModuleElementWithMutability</code></td></tr></table>




---

archive/issue_comments_480823.json:
```json
{
    "body": "<div id=\"comment:84\" align=\"right\">comment:84</div>\n\nI've arrived at a point where it just remains to teach the coercion system about coercions/pushouts to combine operands with differing symmetries\n\n```\nFile \"src/sage/tensor/modules/comp_element_dict.py\", line 914, in sage.tensor.modules.comp_element_dict.ComponentsWithSym_dict\nFailed example:\n    s = a + b ; s\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tensor.modules.comp_element_dict.ComponentsWithSym_dict[27]>\", line 1, in <module>\n        s = a + b ; s\n      File \"sage/structure/element.pyx\", line 1232, in sage.structure.element.Element.__add__\n        return coercion_model.bin_op(left, right, add)\n      File \"sage/structure/coerce.pyx\", line 1248, in sage.structure.coerce.CoercionModel.bin_op\n        raise bin_op_exception(op, x, y)\n    TypeError: unsupported operand parent(s) for +: 'Parent of 2-index components over Rational Field' and 'Parent of Fully symmetric 2-index components over Rational Field'\n```",
    "created_at": "2021-06-17T23:23:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480823",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:84" align="right">comment:84</div>

I've arrived at a point where it just remains to teach the coercion system about coercions/pushouts to combine operands with differing symmetries

```
File "src/sage/tensor/modules/comp_element_dict.py", line 914, in sage.tensor.modules.comp_element_dict.ComponentsWithSym_dict
Failed example:
    s = a + b ; s
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tensor.modules.comp_element_dict.ComponentsWithSym_dict[27]>", line 1, in <module>
        s = a + b ; s
      File "sage/structure/element.pyx", line 1232, in sage.structure.element.Element.__add__
        return coercion_model.bin_op(left, right, add)
      File "sage/structure/coerce.pyx", line 1248, in sage.structure.coerce.CoercionModel.bin_op
        raise bin_op_exception(op, x, y)
    TypeError: unsupported operand parent(s) for +: 'Parent of 2-index components over Rational Field' and 'Parent of Fully symmetric 2-index components over Rational Field'
```



---

archive/issue_comments_480824.json:
```json
{
    "body": "<div id=\"comment:85\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559\"><code>e9cb1cd</code></a></td><td><code>CompParent: WIP coercion</code></td></tr></table>\n",
    "created_at": "2021-06-18T00:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480824",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:85"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559"><code>e9cb1cd</code></a></td><td><code>CompParent: WIP coercion</code></td></tr></table>




---

archive/issue_comments_480825.json:
```json
{
    "body": "Changed commit from **[`4408f1d`](https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9)** to **[`e9cb1cd`](https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559)**",
    "created_at": "2021-06-18T00:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480825",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4408f1d`](https://github.com/sagemath/sagetrac-mirror/commit/4408f1de7b630547afec1c052c4e236570c99de9)** to **[`e9cb1cd`](https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559)**



---

archive/issue_comments_480826.json:
```json
{
    "body": "Changed commit from **[`e9cb1cd`](https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559)** to **[`d9912b9`](https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee)**",
    "created_at": "2021-06-18T01:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480826",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e9cb1cd`](https://github.com/sagemath/sagetrac-mirror/commit/e9cb1cd84b5b65d97e86fc1680d2011c1b72f559)** to **[`d9912b9`](https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee)**



---

archive/issue_comments_480827.json:
```json
{
    "body": "<div id=\"comment:86\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee\"><code>d9912b9</code></a></td><td><code>CompParent.tensor: Rename from tensor_product_sym, generalize to more than 2 factors</code></td></tr></table>\n",
    "created_at": "2021-06-18T01:24:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480827",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:86"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee"><code>d9912b9</code></a></td><td><code>CompParent.tensor: Rename from tensor_product_sym, generalize to more than 2 factors</code></td></tr></table>




---

archive/issue_comments_480828.json:
```json
{
    "body": "<div id=\"comment:87\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d\"><code>5d189b2</code></a></td><td><code>Components: Coercion and pushouts</code></td></tr></table>\n",
    "created_at": "2021-06-18T04:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480828",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:87"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d"><code>5d189b2</code></a></td><td><code>Components: Coercion and pushouts</code></td></tr></table>




---

archive/issue_comments_480829.json:
```json
{
    "body": "Changed commit from **[`d9912b9`](https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee)** to **[`5d189b2`](https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d)**",
    "created_at": "2021-06-18T04:12:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480829",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d9912b9`](https://github.com/sagemath/sagetrac-mirror/commit/d9912b9a68438f76eca9a2b02c3d68e218fcbdee)** to **[`5d189b2`](https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d)**



---

archive/issue_comments_480830.json:
```json
{
    "body": "Changed commit from **[`5d189b2`](https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d)** to **[`3070443`](https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636)**",
    "created_at": "2021-06-18T04:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480830",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5d189b2`](https://github.com/sagemath/sagetrac-mirror/commit/5d189b274f6891057817fd2b227d6a9fb44b356d)** to **[`3070443`](https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636)**



---

archive/issue_comments_480831.json:
```json
{
    "body": "<div id=\"comment:88\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636\"><code>3070443</code></a></td><td><code>CompParent: Fix up coercion</code></td></tr></table>\n",
    "created_at": "2021-06-18T04:42:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480831",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:88"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636"><code>3070443</code></a></td><td><code>CompParent: Fix up coercion</code></td></tr></table>




---

archive/issue_comments_480832.json:
```json
{
    "body": "Author: **Michael Jung, Matthias Koeppe**",
    "created_at": "2021-06-18T04:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480832",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Michael Jung, Matthias Koeppe**



---

archive/issue_comments_480833.json:
```json
{
    "body": "Changed dependencies from **#31904** to **#31904, #29619**",
    "created_at": "2021-06-18T04:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480833",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#31904** to **#31904, #29619**



---

archive/issue_comments_480834.json:
```json
{
    "body": "Changed commit from **[`3070443`](https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636)** to **[`edd1572`](https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c)**",
    "created_at": "2021-06-18T05:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480834",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3070443`](https://github.com/sagemath/sagetrac-mirror/commit/3070443e0721262205766990dc924def33331636)** to **[`edd1572`](https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c)**



---

archive/issue_comments_480835.json:
```json
{
    "body": "<div id=\"comment:90\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ca670b64259678dfa82b4aec2759a8a8159da42\"><code>0ca670b</code></a></td><td><code>sage.tensor.modules: Update doctest output for trivial output changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/02d691796c660db3fae423e88abcf47fca48f92d\"><code>02d6917</code></a></td><td><code>VectorFieldModule.tensor_from_comp: Use CompParent*</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c68734c6487a7c7ac95cd5eb93ee3305d36cf564\"><code>c68734c</code></a></td><td><code>sage.manifolds: Update doctest output for trivial output changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ed01a7e85b86cb53fba3223d94d5a6375d3f040\"><code>8ed01a7</code></a></td><td><code>CompParent, Components_dict: Fix up module action</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c\"><code>edd1572</code></a></td><td><code>TensorField, ComponentsWithSym_dict: Remove comparison of _sym, _antisym with empty list, normalize to tuples</code></td></tr></table>\n",
    "created_at": "2021-06-18T05:55:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480835",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:90"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ca670b64259678dfa82b4aec2759a8a8159da42"><code>0ca670b</code></a></td><td><code>sage.tensor.modules: Update doctest output for trivial output changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/02d691796c660db3fae423e88abcf47fca48f92d"><code>02d6917</code></a></td><td><code>VectorFieldModule.tensor_from_comp: Use CompParent*</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c68734c6487a7c7ac95cd5eb93ee3305d36cf564"><code>c68734c</code></a></td><td><code>sage.manifolds: Update doctest output for trivial output changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ed01a7e85b86cb53fba3223d94d5a6375d3f040"><code>8ed01a7</code></a></td><td><code>CompParent, Components_dict: Fix up module action</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c"><code>edd1572</code></a></td><td><code>TensorField, ComponentsWithSym_dict: Remove comparison of _sym, _antisym with empty list, normalize to tuples</code></td></tr></table>




---

archive/issue_comments_480836.json:
```json
{
    "body": "<div id=\"comment:91\" align=\"right\">comment:91</div>\n\n`sage.tensor.modules` passes all tests except for `_test_not_implemented_methods` (to be fixed by #29619)\n\nThere are still various errors in `sage.manifolds`. \nFor example, in `src/sage/manifolds/differentiable/multivectorfield.py`:\n\n```\nsage -t --random-seed=0 src/sage/manifolds/differentiable/multivectorfield.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/multivectorfield.py\", line 117, in sage.manifolds.differentiable.multivectorfield.MultivectorField\nFailed example:\n    a.display(eU)\nExpected:\n    a = (x*y^2 + 2*x) d/dx/\\d/dy\nGot:\n    a = (x*y^2 + 2*x) d/dx*d/dy + (-x*y^2 - 2*x) d/dy*d/dx\n```\n\nHelp in spotting where these errors are coming from would be welcome",
    "created_at": "2021-06-18T05:59:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480836",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:91" align="right">comment:91</div>

`sage.tensor.modules` passes all tests except for `_test_not_implemented_methods` (to be fixed by #29619)

There are still various errors in `sage.manifolds`. 
For example, in `src/sage/manifolds/differentiable/multivectorfield.py`:

```
sage -t --random-seed=0 src/sage/manifolds/differentiable/multivectorfield.py
**********************************************************************
File "src/sage/manifolds/differentiable/multivectorfield.py", line 117, in sage.manifolds.differentiable.multivectorfield.MultivectorField
Failed example:
    a.display(eU)
Expected:
    a = (x*y^2 + 2*x) d/dx/\d/dy
Got:
    a = (x*y^2 + 2*x) d/dx*d/dy + (-x*y^2 - 2*x) d/dy*d/dx
```

Help in spotting where these errors are coming from would be welcome



---

archive/issue_comments_480837.json:
```json
{
    "body": "<div id=\"comment:92\" align=\"right\">comment:92</div>\n\nFor some reason, the `restrict` method doesn't work properly:\n\n\n```\nsage: M = Manifold(2, 'M')\nsage: U = M.open_subset('U') ; V = M.open_subset('V')\nsage: M.declare_union(U,V)   # M is the union of U and V\nsage: c_xy.<x,y> = U.chart() ; c_uv.<u,v> = V.chart()\nsage: xy_to_uv = c_xy.transition_map(c_uv, (x+y, x-y),\n....:                         intersection_name='W',\n....:                         restrictions1= x>0, restrictions2= u+v>0)\nsage: uv_to_xy = xy_to_uv.inverse()\nsage: W = U.intersection(V)\nsage: eU = c_xy.frame() ; eV = c_uv.frame()\nsage: a = M.multivector_field(2, name='a')\nsage: a[eU,0,1] = x*y^2 + 2*x\nsage: a.add_comp_by_continuation(eV, W, c_uv)\nsage: a.retrict(U)\nTensor field a of type (2,0) on the Open subset U of the 2-dimensional differentiable manifold M\n```\n\nBut it should return\n\n```\n2-vector field a on the Open subset U of the 2-dimensional differentiable manifold M\n```",
    "created_at": "2021-06-19T13:55:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480837",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:92" align="right">comment:92</div>

For some reason, the `restrict` method doesn't work properly:


```
sage: M = Manifold(2, 'M')
sage: U = M.open_subset('U') ; V = M.open_subset('V')
sage: M.declare_union(U,V)   # M is the union of U and V
sage: c_xy.<x,y> = U.chart() ; c_uv.<u,v> = V.chart()
sage: xy_to_uv = c_xy.transition_map(c_uv, (x+y, x-y),
....:                         intersection_name='W',
....:                         restrictions1= x>0, restrictions2= u+v>0)
sage: uv_to_xy = xy_to_uv.inverse()
sage: W = U.intersection(V)
sage: eU = c_xy.frame() ; eV = c_uv.frame()
sage: a = M.multivector_field(2, name='a')
sage: a[eU,0,1] = x*y^2 + 2*x
sage: a.add_comp_by_continuation(eV, W, c_uv)
sage: a.retrict(U)
Tensor field a of type (2,0) on the Open subset U of the 2-dimensional differentiable manifold M
```

But it should return

```
2-vector field a on the Open subset U of the 2-dimensional differentiable manifold M
```



---

archive/issue_comments_480838.json:
```json
{
    "body": "<div id=\"comment:93\" align=\"right\">comment:93</div>\n\nOkay, I spotted the error. It's caused by these lines:\n\n```diff\n+        self._sym = tuple(self._sym)\n+        self._antisym = tuple(self._antisym)\n```\n\nWhen a tensor field is displayed, it must be restricted to a parallelizable subset first. If that restriction does not exists, it's constructed from scratch. This is done by the `tensor` method of the corresponding vector field module of this subset. In particular, the parameters `sym` and `antisym` are passed to this method. In our particular case the code will be executed until\n\n```python\n        elif tensor_type[0] > 1 and tensor_type[1] == 0 and antisym:\n            if isinstance(antisym[0], (int, Integer)):\n                # a single antisymmetry is provided as a tuple or a\n                # range object; it is converted to a 1-item list:\n                antisym = [tuple(antisym)]\n            if isinstance(antisym, list):\n                antisym0 = antisym[0]\n            else:\n                antisym0 = antisym\n            if len(antisym0) == tensor_type[0]:\n                return self.alternating_contravariant_tensor(\n                                              tensor_type[0], name=name,\n                                              latex_name=latex_name)\n```\n\nWith the above change, however, `len(antisym0)` returns `1`, but it should be `2` because the code turns `[(0, 1)]` into `((0,1),)`. So, this case will be ignored and a tensor without symmetries will be created instead.",
    "created_at": "2021-06-20T21:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480838",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:93" align="right">comment:93</div>

Okay, I spotted the error. It's caused by these lines:

```diff
+        self._sym = tuple(self._sym)
+        self._antisym = tuple(self._antisym)
```

When a tensor field is displayed, it must be restricted to a parallelizable subset first. If that restriction does not exists, it's constructed from scratch. This is done by the `tensor` method of the corresponding vector field module of this subset. In particular, the parameters `sym` and `antisym` are passed to this method. In our particular case the code will be executed until

```python
        elif tensor_type[0] > 1 and tensor_type[1] == 0 and antisym:
            if isinstance(antisym[0], (int, Integer)):
                # a single antisymmetry is provided as a tuple or a
                # range object; it is converted to a 1-item list:
                antisym = [tuple(antisym)]
            if isinstance(antisym, list):
                antisym0 = antisym[0]
            else:
                antisym0 = antisym
            if len(antisym0) == tensor_type[0]:
                return self.alternating_contravariant_tensor(
                                              tensor_type[0], name=name,
                                              latex_name=latex_name)
```

With the above change, however, `len(antisym0)` returns `1`, but it should be `2` because the code turns `[(0, 1)]` into `((0,1),)`. So, this case will be ignored and a tensor without symmetries will be created instead.



---

archive/issue_comments_480839.json:
```json
{
    "body": "<div id=\"comment:94\" align=\"right\">comment:94</div>\n\nOne way to solve this could be to adapt the preprocessing of `antisym0` and `sym0` in the `tensor` method, assuming `antisym` and `sym` is a tuple.",
    "created_at": "2021-06-20T21:21:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480839",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:94" align="right">comment:94</div>

One way to solve this could be to adapt the preprocessing of `antisym0` and `sym0` in the `tensor` method, assuming `antisym` and `sym` is a tuple.



---

archive/issue_comments_480840.json:
```json
{
    "body": "<div id=\"comment:95\" align=\"right\">comment:95</div>\n\nThanks for spotting this!",
    "created_at": "2021-06-20T22:44:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480840",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:95" align="right">comment:95</div>

Thanks for spotting this!



---

archive/issue_comments_480841.json:
```json
{
    "body": "Changed commit from **[`edd1572`](https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c)** to **[`e5a81f2`](https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e)**",
    "created_at": "2021-06-20T23:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480841",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`edd1572`](https://github.com/sagemath/sagetrac-mirror/commit/edd1572b835d188f66784fd0416fcd68e75a241c)** to **[`e5a81f2`](https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e)**



---

archive/issue_comments_480842.json:
```json
{
    "body": "<div id=\"comment:96\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fef81a5ada7cf8a0bf4bc602ad138479ab52703c\"><code>fef81a5</code></a></td><td><code>FiniteRankFreeModule, VectorFieldModule: Accept both lists and tuples for sym, antisym</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/922b360b202cbf814ef856f869f4f574aaf59d1d\"><code>922b360</code></a></td><td><code>TensorField, PseudoRiemannianMetric: Adjust to normalization of _sym, _antisym to tuples</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e\"><code>e5a81f2</code></a></td><td><code>sage.manifolds: Update doctest output for trivial output changes</code></td></tr></table>\n",
    "created_at": "2021-06-20T23:10:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480842",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:96"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fef81a5ada7cf8a0bf4bc602ad138479ab52703c"><code>fef81a5</code></a></td><td><code>FiniteRankFreeModule, VectorFieldModule: Accept both lists and tuples for sym, antisym</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/922b360b202cbf814ef856f869f4f574aaf59d1d"><code>922b360</code></a></td><td><code>TensorField, PseudoRiemannianMetric: Adjust to normalization of _sym, _antisym to tuples</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5a81f253cea4e72c930e6d4a0fb0cc217b14f0e"><code>e5a81f2</code></a></td><td><code>sage.manifolds: Update doctest output for trivial output changes</code></td></tr></table>




---

archive/issue_comments_480843.json:
```json
{
    "body": "<div id=\"comment:97\" align=\"right\">comment:97</div>\n\nWith these changes, only failures that look like this remain:\n\n```\nsage -t --random-seed=0 src/sage/manifolds/differentiable/examples/sphere.py\n**********************************************************************\nFile \"src/sage/manifolds/differentiable/examples/sphere.py\", line 56, in sage.manifolds.differentiable.examples.sphere\nFailed example:\n    h.display()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.manifolds.differentiable.examples.sphere[5]>\", line 1, in <module>\n        h.display()\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/manifolds/differentiable/tensorfield.py\", line 1852, in display\n        return rst.display(frame, chart)\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/tensor/modules/free_module_tensor.py\", line 723, in display\n        coef = comp[ind_arg]\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/tensor/modules/comp_element_dict.py\", line 2533, in __getitem__\n        return self._output_formatter(self._comp[ind])\n      File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/manifolds/scalarfield.py\", line 1786, in coord_function\n        raise ValueError(\"no starting chart could be found to \" +\n    ValueError: no starting chart could be found to compute the expression in the Chart (E^3, (x, y, z))\n```",
    "created_at": "2021-06-20T23:12:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480843",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:97" align="right">comment:97</div>

With these changes, only failures that look like this remain:

```
sage -t --random-seed=0 src/sage/manifolds/differentiable/examples/sphere.py
**********************************************************************
File "src/sage/manifolds/differentiable/examples/sphere.py", line 56, in sage.manifolds.differentiable.examples.sphere
Failed example:
    h.display()
Exception raised:
    Traceback (most recent call last):
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.manifolds.differentiable.examples.sphere[5]>", line 1, in <module>
        h.display()
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/manifolds/differentiable/tensorfield.py", line 1852, in display
        return rst.display(frame, chart)
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/tensor/modules/free_module_tensor.py", line 723, in display
        coef = comp[ind_arg]
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/tensor/modules/comp_element_dict.py", line 2533, in __getitem__
        return self._output_formatter(self._comp[ind])
      File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-gcc11/src/sage/manifolds/scalarfield.py", line 1786, in coord_function
        raise ValueError("no starting chart could be found to " +
    ValueError: no starting chart could be found to compute the expression in the Chart (E^3, (x, y, z))
```



---

archive/issue_comments_480844.json:
```json
{
    "body": "<div id=\"comment:98\" align=\"right\">comment:98</div>\n\nThis is likely not the final form of this ticket.\n\nThe goals of this ticket -- one-time precomputation of data related to the symmetries -- have not been fully achieved yet because the parent class is now a module over a base ring. This is fine for numerical tensors that are all over the same ring (`QQ` or `RDF`) but for the symbolic tensors that are used in `sage.manifolds`, there are many base rings, so the symmetries will be recomputed for each of them.\n\nBut for now it was more important to me to have separate parents for separate base rings, as this will allow us to dispatch to different implementation backends (= element classes) - as part of @honglizhaobob's project (#31991).\n\nMy solution for allowing more shared precomputation would be to introduce another class, similar to https://docs.sympy.org/latest/modules/tensor/tensor.html#sympy.tensor.tensor.TensorSymmetry, which only captures the symmetry group (with action).\n\nApart from this, there is still some code that should be pushed from element to parent, for example the symmetries from tensor contraction. \n\nAnd there are branches in the code that can no longer be reached because the coercion system, via `CompParent._element_constructor_`, now guarantees that the inputs of single-underscore methods such as `_add_` have the same symmetry already.\n\nAlso, I have not done any time measurements.",
    "created_at": "2021-06-20T23:39:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480844",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:98" align="right">comment:98</div>

This is likely not the final form of this ticket.

The goals of this ticket -- one-time precomputation of data related to the symmetries -- have not been fully achieved yet because the parent class is now a module over a base ring. This is fine for numerical tensors that are all over the same ring (`QQ` or `RDF`) but for the symbolic tensors that are used in `sage.manifolds`, there are many base rings, so the symmetries will be recomputed for each of them.

But for now it was more important to me to have separate parents for separate base rings, as this will allow us to dispatch to different implementation backends (= element classes) - as part of @honglizhaobob's project (#31991).

My solution for allowing more shared precomputation would be to introduce another class, similar to https://docs.sympy.org/latest/modules/tensor/tensor.html#sympy.tensor.tensor.TensorSymmetry, which only captures the symmetry group (with action).

Apart from this, there is still some code that should be pushed from element to parent, for example the symmetries from tensor contraction. 

And there are branches in the code that can no longer be reached because the coercion system, via `CompParent._element_constructor_`, now guarantees that the inputs of single-underscore methods such as `_add_` have the same symmetry already.

Also, I have not done any time measurements.



---

archive/issue_comments_480845.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -12,5 +12,5 @@\n \n This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.\n \n-See also: SymPy's `TensorSymmetry` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945\n-\n+See also:\n+- #32029 Action of a sympy `TensorSymmetry`\n``````\n",
    "created_at": "2021-06-22T03:40:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480845",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -12,5 +12,5 @@
 
 This will make the code in #30229 (subspaces of tensor with symmetries) more elegant because it no longer needs a dummy `Components` object to represent the symmetry but rather a `CompParent` object.
 
-See also: SymPy's `TensorSymmetry` (https://docs.sympy.org/latest/modules/tensor/tensor.html); #31945
-
+See also:
+- #32029 Action of a sympy `TensorSymmetry`
``````




---

archive/issue_comments_480846.json:
```json
{
    "body": "<div id=\"comment:100\" align=\"right\">comment:100</div>\n\nFurther refactoring will go through #32029 (Action of a sympy `TensorSymmetry`)",
    "created_at": "2021-06-22T07:01:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480846",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:100" align="right">comment:100</div>

Further refactoring will go through #32029 (Action of a sympy `TensorSymmetry`)



---

archive/issue_comments_480847.json:
```json
{
    "body": "<div id=\"comment:101\" align=\"right\">comment:101</div>\n\nLooks good so far!\n\nWhat about the idea with the morphisms in [comment:28](#comment%3A28)?",
    "created_at": "2021-06-27T11:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480847",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:101" align="right">comment:101</div>

Looks good so far!

What about the idea with the morphisms in [comment:28](#comment%3A28)?



---

archive/issue_comments_480848.json:
```json
{
    "body": "<div id=\"comment:102\" align=\"right\">comment:102</div>\n\nReplying to [@mjungmath](#comment%3A101):\n> What about the idea with the morphisms in [comment:28](#comment%3A28)?\n\nThe next step into this direction should be to fix/complete the existing code for coercions.\n\n```\nsage: cp = CompParentWithSym(QQ, 4, sym=((1, 2), (3, 4)))\nsage: cp2 = CompParentWithSym(QQ, 4, sym=((1, 2, 3, 4)))\nsage: cp.coerce_map_from(cp2)   # returns None, should return injection to cp\n```\nHelp with this is welcome!",
    "created_at": "2021-06-27T17:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480848",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:102" align="right">comment:102</div>

Replying to [@mjungmath](#comment%3A101):
> What about the idea with the morphisms in [comment:28](#comment%3A28)?

The next step into this direction should be to fix/complete the existing code for coercions.

```
sage: cp = CompParentWithSym(QQ, 4, sym=((1, 2), (3, 4)))
sage: cp2 = CompParentWithSym(QQ, 4, sym=((1, 2, 3, 4)))
sage: cp.coerce_map_from(cp2)   # returns None, should return injection to cp
```
Help with this is welcome!



---

archive/issue_events_414401.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414401"
}
```



---

archive/issue_events_414402.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414402"
}
```



---

archive/issue_events_414403.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414403"
}
```



---

archive/issue_events_414404.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414404"
}
```



---

archive/issue_events_414405.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414405"
}
```



---

archive/issue_events_414406.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414406"
}
```



---

archive/issue_events_414407.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414407"
}
```



---

archive/issue_events_414408.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414408"
}
```



---

archive/issue_comments_480849.json:
```json
{
    "body": "<div id=\"comment:107\" align=\"right\">comment:107</div>\n\nRestarting this effort with a smaller step in #34497.",
    "created_at": "2022-09-06T00:15:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30307#issuecomment-480849",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:107" align="right">comment:107</div>

Restarting this effort with a smaller step in #34497.



---

archive/issue_events_414409.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414409"
}
```



---

archive/issue_events_414410.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30307",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30307#event-414410"
}
```
