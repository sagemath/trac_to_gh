# Issue 30274: Immutability of Tensor Fields

archive/issues_030037.json:
```json
{
    "assignees": [],
    "body": "See #30261.\n\nThe immutability behavior for tensor fields appears a little bit tricky.\n\nFollow up: #31255\n\nDepends on #30181\n\nCC:  @egourgoulhon @tscrim @mkoeppe\n\nKeywords: **immutability**\n\nBranch: **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Michael Jung**\n\nComponent: **manifolds**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30274_\n\n",
    "closed_at": "2020-08-09T08:47:19Z",
    "created_at": "2020-08-02T18:58:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Immutability of Tensor Fields",
    "type": "issue",
    "updated_at": "2021-01-17T12:59:03Z",
    "url": "https://github.com/sagemath/sage/issues/30274",
    "user": "https://github.com/mjungmath"
}
```
See #30261.

The immutability behavior for tensor fields appears a little bit tricky.

Follow up: #31255

Depends on #30181

CC:  @egourgoulhon @tscrim @mkoeppe

Keywords: **immutability**

Branch: **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**

Reviewer: **Matthias Koeppe**

Author: **Michael Jung**

Component: **manifolds**

_Issue created by migration from https://trac.sagemath.org/ticket/30274_





---

archive/issue_events_413941.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-02T18:58:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413941"
}
```



---

archive/issue_events_413942.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-02T18:58:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413942"
}
```



---

archive/issue_events_413943.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-03T10:37:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413943"
}
```



---

archive/issue_events_413944.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-03T10:37:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
    "label_color": "0000ff",
    "label_name": "c: manifolds",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413944"
}
```



---

archive/issue_comments_480163.json:
```json
{
    "body": "Changed keywords from none to **immutability**",
    "created_at": "2020-08-03T10:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480163",
    "user": "https://github.com/mjungmath"
}
```

Changed keywords from none to **immutability**



---

archive/issue_comments_480164.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+See #30261.\n \n+The immutability behavior for tensor fields appears a little bit tricky. I will upload a proposal soon.\n``````\n",
    "created_at": "2020-08-03T10:37:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480164",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+See #30261.
 
+The immutability behavior for tensor fields appears a little bit tricky. I will upload a proposal soon.
``````




---

archive/issue_comments_480165.json:
```json
{
    "body": "Branch: **[u/gh-mjungmath/immutability_of_tensor_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_of_tensor_fields)**",
    "created_at": "2020-08-03T10:42:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480165",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[u/gh-mjungmath/immutability_of_tensor_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_of_tensor_fields)**



---

archive/issue_comments_480166.json:
```json
{
    "body": "<div id=\"comment:3\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b\"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca\"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87\"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2\"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fa6bd695c3653f55afffdc4530fa8dd03cc1ddd5\"><code>fa6bd69</code></a></td><td><code>Trac #30274: Merge branch 't/30181/immutable_elements_of_freemoduletensor' into t/30274/immutability_of_tensor_fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49\"><code>0ba933a</code></a></td><td><code>Trac #30274: first trial of immutability</code></td></tr></table>\n",
    "created_at": "2020-08-03T10:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480166",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:3"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fa6bd695c3653f55afffdc4530fa8dd03cc1ddd5"><code>fa6bd69</code></a></td><td><code>Trac #30274: Merge branch 't/30181/immutable_elements_of_freemoduletensor' into t/30274/immutability_of_tensor_fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49"><code>0ba933a</code></a></td><td><code>Trac #30274: first trial of immutability</code></td></tr></table>




---

archive/issue_comments_480167.json:
```json
{
    "body": "Commit: **[`0ba933a`](https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49)**",
    "created_at": "2020-08-03T10:42:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480167",
    "user": "https://github.com/mjungmath"
}
```

Commit: **[`0ba933a`](https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49)**



---

archive/issue_events_413945.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-03T10:42:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413945"
}
```



---

archive/issue_comments_480168.json:
```json
{
    "body": "Author: **Michael Jung**",
    "created_at": "2020-08-03T10:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480168",
    "user": "https://github.com/mjungmath"
}
```

Author: **Michael Jung**



---

archive/issue_comments_480169.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nLet's wait for the patchbot.\n\nI had to make some modifications for automorphism fields. My doctests all passed.",
    "created_at": "2020-08-03T10:43:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480169",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:5" align="right">comment:5</div>

Let's wait for the patchbot.

I had to make some modifications for automorphism fields. My doctests all passed.



---

archive/issue_comments_480170.json:
```json
{
    "body": "Dependencies: **#30181**",
    "created_at": "2020-08-03T10:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480170",
    "user": "https://github.com/mjungmath"
}
```

Dependencies: **#30181**



---

archive/issue_comments_480171.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,3 @@\n See #30261.\n \n-The immutability behavior for tensor fields appears a little bit tricky. I will upload a proposal soon.\n+The immutability behavior for tensor fields appears a little bit tricky.\n``````\n",
    "created_at": "2020-08-03T11:59:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480171",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,3 @@
 See #30261.
 
-The immutability behavior for tensor fields appears a little bit tricky. I will upload a proposal soon.
+The immutability behavior for tensor fields appears a little bit tricky.
``````




---

archive/issue_comments_480172.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97\"><code>1b599b2</code></a></td><td><code>Trac #30274: patchbot complaints fixed</code></td></tr></table>\n",
    "created_at": "2020-08-04T07:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97"><code>1b599b2</code></a></td><td><code>Trac #30274: patchbot complaints fixed</code></td></tr></table>




---

archive/issue_comments_480173.json:
```json
{
    "body": "Changed commit from **[`0ba933a`](https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49)** to **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**",
    "created_at": "2020-08-04T07:57:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480173",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0ba933a`](https://github.com/sagemath/sagetrac-mirror/commit/0ba933a0b0aa4734e979f0e22b6d458790ff0d49)** to **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**



---

archive/issue_events_413946.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-04T14:54:12Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413946"
}
```



---

archive/issue_events_413947.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-04T14:54:12Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413947"
}
```



---

archive/issue_comments_480174.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-08-04T14:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480174",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_comments_480175.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nLGTM.",
    "created_at": "2020-08-04T14:54:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480175",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

LGTM.



---

archive/issue_comments_480176.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nA quick remark: You define a `copy` method here (and looking through `sage.manifolds` I see several `copy` methods). You may want to consider (on a separate ticket) to provide `__copy__` methods as well.",
    "created_at": "2020-08-04T14:56:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480176",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:10" align="right">comment:10</div>

A quick remark: You define a `copy` method here (and looking through `sage.manifolds` I see several `copy` methods). You may want to consider (on a separate ticket) to provide `__copy__` methods as well.



---

archive/issue_comments_480177.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThank you for the review.\n\nReplying to [@mkoeppe](#comment:10):\n> A quick remark: You define a `copy` method here (and looking through `sage.manifolds` I see several `copy` methods). You may want to consider (on a separate ticket) to provide `__copy__` methods as well.\n\nWhat is the difference, or what is the advantage?",
    "created_at": "2020-08-04T15:02:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480177",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">comment:11</div>

Thank you for the review.

Replying to [@mkoeppe](#comment:10):
> A quick remark: You define a `copy` method here (and looking through `sage.manifolds` I see several `copy` methods). You may want to consider (on a separate ticket) to provide `__copy__` methods as well.

What is the difference, or what is the advantage?



---

archive/issue_comments_480178.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nsee https://docs.python.org/3/library/copy.html",
    "created_at": "2020-08-04T15:18:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480178",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

see https://docs.python.org/3/library/copy.html



---

archive/issue_events_413948.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-09T08:47:19Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413948"
}
```



---

archive/issue_events_413949.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "70d7d21bd3be0f416a9d1616c90b03a1d53f9a03",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-09T08:47:19Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30274#event-413949"
}
```



---

archive/issue_comments_480179.json:
```json
{
    "body": "Changed branch from **[u/gh-mjungmath/immutability_of_tensor_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_of_tensor_fields)** to **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**",
    "created_at": "2020-08-09T08:47:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480179",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-mjungmath/immutability_of_tensor_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_of_tensor_fields)** to **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)**



---

archive/issue_comments_480180.json:
```json
{
    "body": "Changed commit from **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)** to none",
    "created_at": "2021-01-17T12:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480180",
    "user": "https://github.com/mjungmath"
}
```

Changed commit from **[`1b599b2`](https://github.com/sagemath/sagetrac-mirror/commit/1b599b2871b327dfe64acb355d0fbae135f0ca97)** to none



---

archive/issue_comments_480181.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n See #30261.\n \n The immutability behavior for tensor fields appears a little bit tricky.\n+\n+Follow up: #31255\n``````\n",
    "created_at": "2021-01-17T12:59:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30274",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30274#issuecomment-480181",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 See #30261.
 
 The immutability behavior for tensor fields appears a little bit tricky.
+
+Follow up: #31255
``````

