# Issue 30600: fix ecm on macOS Xcode 12

archive/issues_030363.json:
```json
{
    "body": "as discussed on #30494\nand fixed upstream on \nhttps://gforge.inria.fr/tracker/index.php?func=detail&aid=21856&group_id=135&atid=623\n\nCC:  @mkoeppe @jhpalmieri @zimmermann6\n\nBranch: [1991357509eafcea66abacc34735022da0221f46](https://github.com/sagemath/sagetrac-mirror/commit/1991357509eafcea66abacc34735022da0221f46)\n\nUpstream: Fixed upstream, but not in a stable release.\n\nReviewer: John Palmieri\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30600\n\n",
    "closed_at": "2020-09-21T20:15:40Z",
    "created_at": "2020-09-18T15:27:51Z",
    "labels": [
        "component: packages: standard",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "fix ecm on macOS Xcode 12",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30600",
    "user": "https://github.com/dimpase"
}
```
as discussed on #30494
and fixed upstream on 
https://gforge.inria.fr/tracker/index.php?func=detail&aid=21856&group_id=135&atid=623

CC:  @mkoeppe @jhpalmieri @zimmermann6

Branch: [1991357509eafcea66abacc34735022da0221f46](https://github.com/sagemath/sagetrac-mirror/commit/1991357509eafcea66abacc34735022da0221f46)

Upstream: Fixed upstream, but not in a stable release.

Reviewer: John Palmieri

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30600





---

archive/issue_comments_605715.json:
```json
{
    "body": "Changing branch from \"\" to \"u/dimpase/packages/ecm/xcode12patch\"",
    "created_at": "2020-09-18T15:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605715",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "u/dimpase/packages/ecm/xcode12patch"



---

archive/issue_comments_605716.json:
```json
{
    "body": "Changing commit from \"\" to \"9a2408c17b9a2771dcdc62540b591e6aba3e0ba3\"",
    "created_at": "2020-09-18T15:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605716",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "9a2408c17b9a2771dcdc62540b591e6aba3e0ba3"



---

archive/issue_comments_605717.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-18T15:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605717",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_605718.json:
```json
{
    "body": "<a id='comment:1'></a>\nNew commits:\n|                                                                                                                                          |                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|\n|[9a2408c](https://github.com/sagemath/sagetrac-mirror/commit/9a2408c17b9a2771dcdc62540b591e6aba3e0ba3)|`upstream patch to fix ecm configure on XCode 12 clang`|",
    "created_at": "2020-09-18T15:34:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605718",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:1'></a>
New commits:
|                                                                                                                                          |                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------|
|[9a2408c](https://github.com/sagemath/sagetrac-mirror/commit/9a2408c17b9a2771dcdc62540b591e6aba3e0ba3)|`upstream patch to fix ecm configure on XCode 12 clang`|



---

archive/issue_comments_605719.json:
```json
{
    "body": "<a id='comment:2'></a>\nI think that most of the changes to `./configure` are unnecessary, and it would be cleaner to use just\n\n```\ndiff -u a/configure b/configure\n--- a/configure\t2016-10-11 02:27:12.000000000 -0700\n+++ b/configure\t2020-09-18 09:03:06.000000000 -0700\n@@ -13265,8 +13253,10 @@\n   cat >conftes1.c <<EOF\n #ifdef __cplusplus\n extern \"C\" { void underscore_test(); }\n+#else\n+extern void underscore_test();\n #endif\n-main () { underscore_test(); }\n+int main () { underscore_test(); return 1;}\n EOF\n for tmp_underscore in \"\" \"_\"; do\n   cat >conftes2.s <<EOF\n```\n(I assume that you got this by running `autoreconf` after making the changes to `acinclude.m4`. Maybe upstream's `configure` was already out of sync, which is where the other changes came from?)",
    "created_at": "2020-09-18T16:10:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605719",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:2'></a>
I think that most of the changes to `./configure` are unnecessary, and it would be cleaner to use just

```
diff -u a/configure b/configure
--- a/configure	2016-10-11 02:27:12.000000000 -0700
+++ b/configure	2020-09-18 09:03:06.000000000 -0700
@@ -13265,8 +13253,10 @@
   cat >conftes1.c <<EOF
 #ifdef __cplusplus
 extern "C" { void underscore_test(); }
+#else
+extern void underscore_test();
 #endif
-main () { underscore_test(); }
+int main () { underscore_test(); return 1;}
 EOF
 for tmp_underscore in "" "_"; do
   cat >conftes2.s <<EOF
```
(I assume that you got this by running `autoreconf` after making the changes to `acinclude.m4`. Maybe upstream's `configure` was already out of sync, which is where the other changes came from?)



---

archive/issue_comments_605720.json:
```json
{
    "body": "<a id='comment:4'></a>\nsure, it's just the result of an autoreconf run. I don't think we should  be bothered by this, it's clearly a temporary patch, to go away with a new `ecm` release.",
    "created_at": "2020-09-18T17:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605720",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
sure, it's just the result of an autoreconf run. I don't think we should  be bothered by this, it's clearly a temporary patch, to go away with a new `ecm` release.



---

archive/issue_comments_605721.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-18T18:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605721",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_605722.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2020-09-18T18:02:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605722",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_605723.json:
```json
{
    "body": "<a id='comment:6'></a>\nBuild depends on autotools:\n\n```\nBuilding ecm-7.0.4.p2\nCDPATH=\"${ZSH_VERSION+.}:\" && cd . && /bin/bash /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p2/src/missing aclocal-1.16 -I m4\n/var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p2/src/missing: line 81: aclocal-1.16: command not found\nWARNING: 'aclocal-1.16' is missing on your system.\n         You should only need it if you modified 'acinclude.m4' or\n         'configure.ac' or m4 files included by 'configure.ac'.\n         The 'aclocal' program is part of the GNU Automake package:\n         <http://www.gnu.org/software/automake>\n         It also requires GNU Autoconf, GNU m4 and Perl in order to run:\n         <http://www.gnu.org/software/autoconf>\n         <http://www.gnu.org/software/m4/>\n         <http://www.perl.org/>\nMakefile:808: recipe for target 'aclocal.m4' failed\nmake[5]: *** [aclocal.m4] Error 127\nmake[5]: Failed to remake makefile 'Makefile'.\nmake[5]: Target 'all' not remade because of errors.\n```",
    "created_at": "2020-09-19T10:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605723",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:6'></a>
Build depends on autotools:

```
Building ecm-7.0.4.p2
CDPATH="${ZSH_VERSION+.}:" && cd . && /bin/bash /var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p2/src/missing aclocal-1.16 -I m4
/var/lib/buildbot/slave/sage_git/build/local/var/tmp/sage/build/ecm-7.0.4.p2/src/missing: line 81: aclocal-1.16: command not found
WARNING: 'aclocal-1.16' is missing on your system.
         You should only need it if you modified 'acinclude.m4' or
         'configure.ac' or m4 files included by 'configure.ac'.
         The 'aclocal' program is part of the GNU Automake package:
         <http://www.gnu.org/software/automake>
         It also requires GNU Autoconf, GNU m4 and Perl in order to run:
         <http://www.gnu.org/software/autoconf>
         <http://www.gnu.org/software/m4/>
         <http://www.perl.org/>
Makefile:808: recipe for target 'aclocal.m4' failed
make[5]: *** [aclocal.m4] Error 127
make[5]: Failed to remake makefile 'Makefile'.
make[5]: Target 'all' not remade because of errors.
```



---

archive/issue_comments_605724.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-09-19T10:26:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605724",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_605725.json:
```json
{
    "body": "<a id='comment:7'></a>\n> Build depends on autotools: [...]\n\n\n[speaking as upstream developer] I believe this has to be fixed on the Sage side, since the vanilla 7.0.4 tarball should not depend on autotools.",
    "created_at": "2020-09-19T10:51:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605725",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:7'></a>
> Build depends on autotools: [...]


[speaking as upstream developer] I believe this has to be fixed on the Sage side, since the vanilla 7.0.4 tarball should not depend on autotools.



---

archive/issue_comments_605726.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think we can just patch `configure`, not `acinclude.m4`, and that shouldn't trigger running `aclocal`. I see this problem intermittently (running `make ecm-clean; make`), but if I remove the part of the patch for `acinclude.m4`, I don't see it any more.",
    "created_at": "2020-09-19T17:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605726",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>
I think we can just patch `configure`, not `acinclude.m4`, and that shouldn't trigger running `aclocal`. I see this problem intermittently (running `make ecm-clean; make`), but if I remove the part of the patch for `acinclude.m4`, I don't see it any more.



---

archive/issue_comments_605727.json:
```json
{
    "body": "Changing branch from \"u/dimpase/packages/ecm/xcode12patch\" to \"u/jhpalmieri/packages/ecm/xcode12patch\"",
    "created_at": "2020-09-19T17:12:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605727",
    "user": "https://github.com/jhpalmieri"
}
```

Changing branch from "u/dimpase/packages/ecm/xcode12patch" to "u/jhpalmieri/packages/ecm/xcode12patch"



---

archive/issue_comments_605728.json:
```json
{
    "body": "Changing commit from \"9a2408c17b9a2771dcdc62540b591e6aba3e0ba3\" to \"1991357509eafcea66abacc34735022da0221f46\"",
    "created_at": "2020-09-19T17:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605728",
    "user": "https://github.com/jhpalmieri"
}
```

Changing commit from "9a2408c17b9a2771dcdc62540b591e6aba3e0ba3" to "1991357509eafcea66abacc34735022da0221f46"



---

archive/issue_comments_605729.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-09-19T17:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605729",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_comments_605730.json:
```json
{
    "body": "<a id='comment:10'></a>\nNew commits:\n|                                                                                                                                          |                                                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|\n|[1991357](https://github.com/sagemath/sagetrac-mirror/commit/1991357509eafcea66abacc34735022da0221f46)|`trac 30600: don't patch acinclude.m4, to avoid running aclocal`|",
    "created_at": "2020-09-19T17:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605730",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>
New commits:
|                                                                                                                                          |                                                                |
|------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------|
|[1991357](https://github.com/sagemath/sagetrac-mirror/commit/1991357509eafcea66abacc34735022da0221f46)|`trac 30600: don't patch acinclude.m4, to avoid running aclocal`|



---

archive/issue_comments_605731.json:
```json
{
    "body": "<a id='comment:11'></a>\nok, good catch!",
    "created_at": "2020-09-19T17:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605731",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
ok, good catch!



---

archive/issue_comments_605732.json:
```json
{
    "body": "<a id='comment:12'></a>\nit would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)",
    "created_at": "2020-09-19T18:33:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605732",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:12'></a>
it would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)



---

archive/issue_comments_605733.json:
```json
{
    "body": "<a id='comment:13'></a>\nReplying to [zimmerma](#comment%3A12):\n> it would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)\n\n\nI think that's how Dima produced the patch in the first place. I just removed the part of the patch affecting `acinclude.m4`.",
    "created_at": "2020-09-19T18:51:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605733",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Replying to [zimmerma](#comment%3A12):
> it would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)


I think that's how Dima produced the patch in the first place. I just removed the part of the patch affecting `acinclude.m4`.



---

archive/issue_comments_605734.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [zimmerma](#comment%3A12):\n> it would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)\n\n\nthis what I did - but I only took updates of acinclude.m4  and ./configure, not the complete stuff. My fault.",
    "created_at": "2020-09-19T20:01:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605734",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [zimmerma](#comment%3A12):
> it would be cleaner to run `autoreconf` after having patched `acinclude.m4`, and use the updated `configure` file (which is auto-generated)


this what I did - but I only took updates of acinclude.m4  and ./configure, not the complete stuff. My fault.



---

archive/issue_comments_605735.json:
```json
{
    "body": "Changing branch from \"u/jhpalmieri/packages/ecm/xcode12patch\" to \"1991357509eafcea66abacc34735022da0221f46\"",
    "created_at": "2020-09-21T20:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605735",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/jhpalmieri/packages/ecm/xcode12patch" to "1991357509eafcea66abacc34735022da0221f46"



---

archive/issue_comments_605736.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-21T20:15:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605736",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_089680.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-21T20:15:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30600#event-89680"
}
```



---

archive/issue_comments_605737.json:
```json
{
    "body": "Changing commit from \"1991357509eafcea66abacc34735022da0221f46\" to \"\"",
    "created_at": "2021-02-01T21:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605737",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "1991357509eafcea66abacc34735022da0221f46" to ""



---

archive/issue_comments_605738.json:
```json
{
    "body": "<a id='comment:16'></a>\nPaul, is there any chance that a new release will be made soon with these updates?",
    "created_at": "2021-02-01T21:21:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605738",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>
Paul, is there any chance that a new release will be made soon with these updates?



---

archive/issue_comments_605739.json:
```json
{
    "body": "<a id='comment:17'></a>\nI've put a candidate tarball at https://members.loria.fr/PZimmermann/ecm-7.0.5-dev.tar.gz, please can you confirm it is ok? If so, I will make a new release.",
    "created_at": "2021-02-02T05:19:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605739",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:17'></a>
I've put a candidate tarball at https://members.loria.fr/PZimmermann/ecm-7.0.5-dev.tar.gz, please can you confirm it is ok? If so, I will make a new release.



---

archive/issue_comments_605740.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [zimmerma](#comment%3A17):\n> I've put a candidate tarball at https://members.loria.fr/PZimmermann/ecm-7.0.5-dev.tar.gz, please can you confirm it is ok? If so, I will make a new release.\n\n\nstill waiting for an answer...",
    "created_at": "2022-04-25T06:13:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605740",
    "user": "https://github.com/zimmermann6"
}
```

<a id='comment:18'></a>
Replying to [zimmerma](#comment%3A17):
> I've put a candidate tarball at https://members.loria.fr/PZimmermann/ecm-7.0.5-dev.tar.gz, please can you confirm it is ok? If so, I will make a new release.


still waiting for an answer...



---

archive/issue_comments_605741.json:
```json
{
    "body": "<a id='comment:19'></a>\nSorry, let's take this to #31325",
    "created_at": "2022-04-25T06:29:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30600",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30600#issuecomment-605741",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Sorry, let's take this to #31325
