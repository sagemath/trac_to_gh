# Issue 30013: src/bin/sage-env: Make sure $SAGE_VENV/bin is at the beginning of the PATH

archive/issues_029776.json:
```json
{
    "assignees": [],
    "body": "Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables) and #22731.\n\nWe make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that \n- the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`;\n- the correct copy of `python3` is run.\n\nTo determine `SAGE_VENV`:\n- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-src-env-config`\n- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run a Python script `sage-venv-config` instead.\n\n\n\nDepends on #29852\n\nCC:  @orlitzky @jhpalmieri\n\nKeywords: **sd111**\n\nBranch: **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**\n\nReviewer: **Tobias Diez, Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **scripts**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30013_\n\n",
    "closed_at": "2020-12-13T20:30:59Z",
    "created_at": "2020-06-29T00:09:51Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20scripts",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "src/bin/sage-env: Make sure $SAGE_VENV/bin is at the beginning of the PATH",
    "type": "issue",
    "updated_at": "2020-12-16T01:42:28Z",
    "url": "https://github.com/sagemath/sage/issues/30013",
    "user": "https://github.com/mkoeppe"
}
```
Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables) and #22731.

We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that 
- the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`;
- the correct copy of `python3` is run.

To determine `SAGE_VENV`:
- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-src-env-config`
- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run a Python script `sage-venv-config` instead.



Depends on #29852

CC:  @orlitzky @jhpalmieri

Keywords: **sd111**

Branch: **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**

Reviewer: **Tobias Diez, Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **scripts**

_Issue created by migration from https://trac.sagemath.org/ticket/30013_





---

archive/issue_events_413283.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-29T00:09:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413283"
}
```



---

archive/issue_events_413284.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-29T00:09:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20scripts",
    "label_color": "000080",
    "label_name": "c: scripts",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413284"
}
```



---

archive/issue_events_413285.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-29T00:09:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413285"
}
```



---

archive/issue_events_413286.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-06-29T00:09:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413286"
}
```



---

archive/issue_comments_475102.json:
```json
{
    "body": "Dependencies: **#25486**",
    "created_at": "2020-06-29T00:14:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475102",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#25486**



---

archive/issue_comments_475103.json:
```json
{
    "body": "Changed dependencies from **#25486** to **#25486, #29951**",
    "created_at": "2020-06-30T03:34:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475103",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#25486** to **#25486, #29951**



---

archive/issue_events_413287.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413287"
}
```



---

archive/issue_events_413288.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413288"
}
```



---

archive/issue_comments_475104.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,6 @@\n Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables).\n \n-We make sure that `$SAGE_SCRIPTS_DIR` appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.\n+We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.\n \n \n+\n``````\n",
    "created_at": "2020-11-11T05:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475104",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,6 @@
 Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables).
 
-We make sure that `$SAGE_SCRIPTS_DIR` appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.
+We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.
 
 
+
``````




---

archive/issue_comments_475105.json:
```json
{
    "body": "Changed dependencies from **#25486, #29951** to **#29951, #22731**",
    "created_at": "2020-11-11T05:05:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475105",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#25486, #29951** to **#29951, #22731**



---

archive/issue_events_413289.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-11T05:05:24Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "title_is": "src/bin/sage-env: Make sure $SAGE_VENV/bin is at the beginning of the PATH",
    "title_was": "src/bin/sage-env: Make sure SAGE_SCRIPTS_DIR is at the beginning of the PATH",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413289"
}
```



---

archive/issue_comments_475106.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,5 +2,8 @@\n \n We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.\n \n+To determine `SAGE_VENV`:\n+- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`\n+- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run the new installed `console_script` also named `sage-venv-config`, generated by `setup.py`.\n \n \n``````\n",
    "created_at": "2020-11-11T18:45:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475106",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,5 +2,8 @@
 
 We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.
 
+To determine `SAGE_VENV`:
+- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`
+- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run the new installed `console_script` also named `sage-venv-config`, generated by `setup.py`.
 
 
``````




---

archive/issue_comments_475107.json:
```json
{
    "body": "Changed dependencies from **#29951, #22731** to **#29951, #22731, #30888**",
    "created_at": "2020-11-11T18:59:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475107",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29951, #22731** to **#29951, #22731, #30888**



---

archive/issue_comments_475108.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n-Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables).\n+Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables) and #22731.\n \n-We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.\n+We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that \n+- the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`;\n+- the correct copy of `python3` is run.\n \n To determine `SAGE_VENV`:\n - If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`\n``````\n",
    "created_at": "2020-11-12T18:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475108",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
-Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables).
+Follow-up from #25486 (Discover `SAGE_SCRIPTS_DIR` to make `$SAGE_LOCAL/bin/sage` work from any directory, in an environment without `SAGE_*` variables) and #22731.
 
-We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`.
+We make sure that `$SAGE_VENV/bin` (from #22731) appears at the beginning of the `PATH`.  For virtual environments such as those set up by tox (#29950), this may be different from and should take precedence over `$SAGE_LOCAL/bin`.  This will ensure that 
+- the correct copy of auxiliary scripts such as `sage-eval` is invoked by `sage`;
+- the correct copy of `python3` is run.
 
 To determine `SAGE_VENV`:
 - If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`
``````




---

archive/issue_comments_475109.json:
```json
{
    "body": "Changed dependencies from **#29951, #22731, #30888** to **#29951, #22731, #29852**",
    "created_at": "2020-11-13T03:20:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475109",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29951, #22731, #30888** to **#29951, #22731, #29852**



---

archive/issue_comments_475110.json:
```json
{
    "body": "Branch: **[u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path)**",
    "created_at": "2020-11-13T03:53:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475110",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path)**



---

archive/issue_comments_475111.json:
```json
{
    "body": "<div id=\"comment:11\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620\"><code>842995f</code></a></td><td><code>src/bin/sage-venv-config: Add comment</code></td></tr></table>\n",
    "created_at": "2020-11-13T03:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475111",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:11"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620"><code>842995f</code></a></td><td><code>src/bin/sage-venv-config: Add comment</code></td></tr></table>




---

archive/issue_comments_475112.json:
```json
{
    "body": "Commit: **[`842995f`](https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620)**",
    "created_at": "2020-11-13T03:58:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475112",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[`842995f`](https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620)**



---

archive/issue_comments_475113.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3\"><code>1a518c0</code></a></td><td><code>src/bin/sage: Set SAGE_VENV from sage-venv-config</code></td></tr></table>\n",
    "created_at": "2020-11-13T04:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475113",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3"><code>1a518c0</code></a></td><td><code>src/bin/sage: Set SAGE_VENV from sage-venv-config</code></td></tr></table>




---

archive/issue_comments_475114.json:
```json
{
    "body": "Changed commit from **[`842995f`](https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620)** to **[`1a518c0`](https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3)**",
    "created_at": "2020-11-13T04:13:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475114",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`842995f`](https://github.com/sagemath/sagetrac-mirror/commit/842995f51bf527c86cb346f31a35741400893620)** to **[`1a518c0`](https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3)**



---

archive/issue_comments_475115.json:
```json
{
    "body": "Changed commit from **[`1a518c0`](https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3)** to **[`d372ecf`](https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15)**",
    "created_at": "2020-11-13T05:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475115",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`1a518c0`](https://github.com/sagemath/sagetrac-mirror/commit/1a518c0cd17cfd81ad05492ee4b932d0fd4a93a3)** to **[`d372ecf`](https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15)**



---

archive/issue_comments_475116.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15\"><code>d372ecf</code></a></td><td><code>src/bin/sage-env: Put $SAGE_VENV/bin before $SAGE_LOCAL/bin in PATH</code></td></tr></table>\n",
    "created_at": "2020-11-13T05:25:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475116",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15"><code>d372ecf</code></a></td><td><code>src/bin/sage-env: Put $SAGE_VENV/bin before $SAGE_LOCAL/bin in PATH</code></td></tr></table>




---

archive/issue_comments_475117.json:
```json
{
    "body": "Changed commit from **[`d372ecf`](https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15)** to **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**",
    "created_at": "2020-11-13T05:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475117",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d372ecf`](https://github.com/sagemath/sagetrac-mirror/commit/d372ecf8623695519c8471e3232f50355e8cbc15)** to **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**



---

archive/issue_comments_475118.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6\"><code>0140f84</code></a></td><td><code>src/bin/sage-src-env-config.in: New, sourced in src/bin/sage</code></td></tr></table>\n",
    "created_at": "2020-11-13T05:47:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475118",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6"><code>0140f84</code></a></td><td><code>src/bin/sage-src-env-config.in: New, sourced in src/bin/sage</code></td></tr></table>




---

archive/issue_events_413290.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-13T05:49:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413290"
}
```



---

archive/issue_comments_475119.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-11-13T05:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475119",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_475120.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nUsing the new script `sage-venv-config` is probably overkill.\nIf #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.",
    "created_at": "2020-11-13T05:49:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475120",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Using the new script `sage-venv-config` is probably overkill.
If #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.



---

archive/issue_comments_475121.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,7 +5,7 @@\n - the correct copy of `python3` is run.\n \n To determine `SAGE_VENV`:\n-- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`\n-- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run the new installed `console_script` also named `sage-venv-config`, generated by `setup.py`.\n+- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-src-env-config`\n+- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run a Python script `sage-venv-config` instead.\n \n \n``````\n",
    "created_at": "2020-11-13T05:50:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475121",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,7 +5,7 @@
 - the correct copy of `python3` is run.
 
 To determine `SAGE_VENV`:
-- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-venv-config`
-- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run the new installed `console_script` also named `sage-venv-config`, generated by `setup.py`.
+- If `src/bin/sage` is invoked directly out of the source tree, it will run a new non-installed `configure`-generated script `sage-src-env-config`
+- An installed `sage` script installed by `setup.py` in `SAGE_LOCAL` or in a venv will run a Python script `sage-venv-config` instead.
 
 
``````




---

archive/issue_comments_475122.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment:15):\n> Using the new script `sage-venv-config` is probably overkill.\n> If #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.\n\nWhy do you actually need go through the trouble of determining `SAGE_VENV` in some shell scripts? Isn't it enough to use `SAGE_VENV = sys.prefix` (which is already done in `env.py`)?",
    "created_at": "2020-11-13T09:14:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475122",
    "user": "https://github.com/tobiasdiez"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment:15):
> Using the new script `sage-venv-config` is probably overkill.
> If #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.

Why do you actually need go through the trouble of determining `SAGE_VENV` in some shell scripts? Isn't it enough to use `SAGE_VENV = sys.prefix` (which is already done in `env.py`)?



---

archive/issue_comments_475123.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tobiasdiez](#comment:17):\n> Replying to [@mkoeppe](#comment:15):\n> > Using the new script `sage-venv-config` is probably overkill.\n> > If #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.\n\n> \n> Why do you actually need go through the trouble of determining `SAGE_VENV` in some shell scripts? Isn't it enough to use `SAGE_VENV = sys.prefix` (which is already done in `env.py`)?\n\nYes, for all Python scripts, `sys.prefix` does the right thing. But `sage` is a shell script (changing that would be outside of the scope of this ticket) and so we have to go through some extra trouble to determine this value in order to set PATH correctly.",
    "created_at": "2020-11-13T16:42:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475123",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tobiasdiez](#comment:17):
> Replying to [@mkoeppe](#comment:15):
> > Using the new script `sage-venv-config` is probably overkill.
> > If #30888 resolves the symlink of $0, we could just infer the `SAGE_VENV` from its directory.

> 
> Why do you actually need go through the trouble of determining `SAGE_VENV` in some shell scripts? Isn't it enough to use `SAGE_VENV = sys.prefix` (which is already done in `env.py`)?

Yes, for all Python scripts, `sys.prefix` does the right thing. But `sage` is a shell script (changing that would be outside of the scope of this ticket) and so we have to go through some extra trouble to determine this value in order to set PATH correctly.



---

archive/issue_events_413291.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-11-20T08:27:18Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413291"
}
```



---

archive/issue_events_413292.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-11-20T08:27:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413292"
}
```



---

archive/issue_comments_475124.json:
```json
{
    "body": "Reviewer: **Tobias Diez, Dima Pasechnik**",
    "created_at": "2020-11-20T08:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475124",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Tobias Diez, Dima Pasechnik**



---

archive/issue_comments_475125.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nlgtm",
    "created_at": "2020-11-20T08:27:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475125",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:19" align="right">comment:19</div>

lgtm



---

archive/issue_comments_475126.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nThanks!",
    "created_at": "2020-11-20T19:12:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475126",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Thanks!



---

archive/issue_comments_475127.json:
```json
{
    "body": "Changed dependencies from **#29951, #22731, #29852** to **#29852**",
    "created_at": "2020-12-06T21:15:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475127",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#29951, #22731, #29852** to **#29852**



---

archive/issue_comments_475128.json:
```json
{
    "body": "Changed keywords from none to **sd111**",
    "created_at": "2020-12-11T06:21:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475128",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from none to **sd111**



---

archive/issue_events_413293.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:30:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413293"
}
```



---

archive/issue_events_413294.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "32692c05562466ba1a4cbe409a1ed130fb02680d",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-13T20:30:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30013#event-413294"
}
```



---

archive/issue_comments_475129.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path)** to **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**",
    "created_at": "2020-12-13T20:30:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475129",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_env__make_sure__sage_venv_bin_is_at_the_beginning_of_the_path)** to **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)**



---

archive/issue_comments_475130.json:
```json
{
    "body": "Changed commit from **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)** to none",
    "created_at": "2020-12-15T18:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475130",
    "user": "https://github.com/antonio-rojas"
}
```

Changed commit from **[`0140f84`](https://github.com/sagemath/sagetrac-mirror/commit/0140f8429e166081798cb678dcc273c3ad769ec6)** to none



---

archive/issue_comments_475131.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThis breaks if `sage_conf` is not installed, because VERSION is defined there\n\n```\nTraceback (most recent call last):\n  File \"/usr/bin/sage-venv-config\", line 29, in <module>\n    _main()\n  File \"/usr/bin/sage-venv-config\", line 17, in _main\n    version='%(prog)s ' + VERSION)\nNameError: name 'VERSION' is not defined\n```\nIf this is really intended and sage_conf is now mandatory, then ImportError from sage_conf shouldn't be trapped. But I hope it can still be possible to support `sage_conf`-less systems.",
    "created_at": "2020-12-15T18:35:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475131",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:24" align="right">comment:24</div>

This breaks if `sage_conf` is not installed, because VERSION is defined there

```
Traceback (most recent call last):
  File "/usr/bin/sage-venv-config", line 29, in <module>
    _main()
  File "/usr/bin/sage-venv-config", line 17, in _main
    version='%(prog)s ' + VERSION)
NameError: name 'VERSION' is not defined
```
If this is really intended and sage_conf is now mandatory, then ImportError from sage_conf shouldn't be trapped. But I hope it can still be possible to support `sage_conf`-less systems.



---

archive/issue_comments_475132.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\n`sage_conf` is still intended to be optional - this is a regression, patches welcome",
    "created_at": "2020-12-15T18:38:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475132",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

`sage_conf` is still intended to be optional - this is a regression, patches welcome



---

archive/issue_comments_475133.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nOK, glad to hear - so what should we do if there's no sage_conf? don't add the `--version`argument? get the version from somewhere else (where)?",
    "created_at": "2020-12-15T19:13:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475133",
    "user": "https://github.com/antonio-rojas"
}
```

<div id="comment:26" align="right">comment:26</div>

OK, glad to hear - so what should we do if there's no sage_conf? don't add the `--version`argument? get the version from somewhere else (where)?



---

archive/issue_comments_475134.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nI have created #31058 for this",
    "created_at": "2020-12-16T01:42:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30013",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30013#issuecomment-475134",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

I have created #31058 for this
