# Issue 30560: Make openssl an optional dependency of python3

archive/issues_030323.json:
```json
{
    "body": "As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n\nIf system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n\nPart of #21700 Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)\n\n\n**CC:**  @mwageringel @slel @dimpase @orlitzky @jhpalmieri\n\n**Branch/Commit:** [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)\n\n**Reviewer:** John Palmieri\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/30560\n\n",
    "closed_at": "2020-09-18T20:23:08Z",
    "created_at": "2020-09-11T21:46:35Z",
    "labels": [
        "component: build",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make openssl an optional dependency of python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30560",
    "user": "https://github.com/mkoeppe"
}
```
As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.

If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.

Part of #21700 Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)


**CC:**  @mwageringel @slel @dimpase @orlitzky @jhpalmieri

**Branch/Commit:** [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)

**Reviewer:** John Palmieri

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/30560





---

archive/issue_events_278315.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-11T21:55:38Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "rename": {
        "from": "Build optional package openssl as part of TOOLCHAIN_DEPS",
        "to": "Build optional package openssl as part of SAGE_TOOLCHAIN"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278315"
}
```



---

archive/issue_comments_491938.json:
```json
{
    "body": "<a id='comment:2'></a>\nBest done with a change to the `SAGE_SPKG_ENABLE` macro",
    "created_at": "2020-09-11T22:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491938",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Best done with a change to the `SAGE_SPKG_ENABLE` macro



---

archive/issue_events_278316.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T18:03:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278316"
}
```



---

archive/issue_comments_491939.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n \n+If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n+\n``````\n",
    "created_at": "2020-09-13T18:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491939",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.
 
+If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
+
``````




---

archive/issue_comments_491940.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain)",
    "created_at": "2020-09-13T19:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491940",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain)



---

archive/issue_comments_491941.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491941",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_491942.json:
```json
{
    "body": "**Commit:** [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491942",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)



---

archive/issue_comments_491943.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n \n-If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n+If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n \n``````\n",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491943",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.
 
-If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
+If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
 
``````




---

archive/issue_events_278317.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:13:02Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278317"
}
```



---

archive/issue_events_278318.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-13T19:13:02Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "rename": {
        "from": "Build optional package openssl as part of SAGE_TOOLCHAIN",
        "to": "Make openssl an optional dependency of python3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278318"
}
```



---

archive/issue_comments_491944.json:
```json
{
    "body": "<a id='comment:6'></a>\nFound a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d\">0c394ca</a></td><td><code>build/pkgs/python3/dependencies: Make openssl a dependency if it is enabled</code></td></tr></table>\n",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491944",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d">0c394ca</a></td><td><code>build/pkgs/python3/dependencies: Make openssl a dependency if it is enabled</code></td></tr></table>




---

archive/issue_comments_491945.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n+Part of #21700 Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)\n \n``````\n",
    "created_at": "2020-09-13T19:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491945",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
+Part of #21700 Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)
 
``````




---

archive/issue_comments_491946.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.\n\nTo test, I did `make distclean`. Then\n\n```\n$ ./configure --enable-openssl --with-system-python3=no\n$ make\n```\nbuilt `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.\n\nDo I need to find a system on which Python's `ssl` module fails to build?",
    "created_at": "2020-09-14T22:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491946",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.

To test, I did `make distclean`. Then

```
$ ./configure --enable-openssl --with-system-python3=no
$ make
```
built `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.

Do I need to find a system on which Python's `ssl` module fails to build?



---

archive/issue_comments_491947.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> To test, I did `make distclean`. Then\n> \n> ```\n> $ ./configure --enable-openssl --with-system-python3=no\n> $ make\n> ```\n> built `openssl` first and then `python3`, which is the point, right?\n\n\nRight.\n\n> Without this branch, these commands just build `python3`, not `openssl`.\n\n\nI think without this branch it should also have built `openssl`, just not necessarily before `python3`.",
    "created_at": "2020-09-14T22:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491947",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> To test, I did `make distclean`. Then
> 
> ```
> $ ./configure --enable-openssl --with-system-python3=no
> $ make
> ```
> built `openssl` first and then `python3`, which is the point, right?


Right.

> Without this branch, these commands just build `python3`, not `openssl`.


I think without this branch it should also have built `openssl`, just not necessarily before `python3`.



---

archive/issue_comments_491948.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> Do I need to find a system on which Python's `ssl` module fails to build?\n\n\nI don't think that's necessary",
    "created_at": "2020-09-14T22:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491948",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Replying to [jhpalmieri](#comment%3A9):
> Do I need to find a system on which Python's `ssl` module fails to build?


I don't think that's necessary



---

archive/issue_comments_491949.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mkoeppe](#comment%3A10):\n> Replying to [jhpalmieri](#comment%3A9):\n> > To test, I did `make distclean`. Then\n> > \n> > ```\n> > $ ./configure --enable-openssl --with-system-python3=no\n> > $ make\n> > ```\n> > built `openssl` first and then `python3`, which is the point, right?\n\n> \n> Right.\n> \n> > Without this branch, these commands just build `python3`, not `openssl`.\n\n> \n> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.\n\n\nSorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.",
    "created_at": "2020-09-14T23:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491949",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [mkoeppe](#comment%3A10):
> Replying to [jhpalmieri](#comment%3A9):
> > To test, I did `make distclean`. Then
> > 
> > ```
> > $ ./configure --enable-openssl --with-system-python3=no
> > $ make
> > ```
> > built `openssl` first and then `python3`, which is the point, right?

> 
> Right.
> 
> > Without this branch, these commands just build `python3`, not `openssl`.

> 
> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.


Sorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.



---

archive/issue_comments_491950.json:
```json
{
    "body": "**Reviewer:** John Palmieri",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491950",
    "user": "https://github.com/jhpalmieri"
}
```

**Reviewer:** John Palmieri



---

archive/issue_comments_491951.json:
```json
{
    "body": "<a id='comment:13'></a>\nGood find with `findstring`, by the way.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491951",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Good find with `findstring`, by the way.



---

archive/issue_events_278319.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-09-14T23:06:40Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278319"
}
```



---

archive/issue_events_278320.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2020-09-14T23:06:40Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278320"
}
```



---

archive/issue_comments_491952.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks!",
    "created_at": "2020-09-14T23:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491952",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Thanks!



---

archive/issue_comments_491953.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain)\" to \"[0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)\".",
    "created_at": "2020-09-18T20:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-491953",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain)" to "[0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)".



---

archive/issue_events_278321.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-18T20:23:08Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278321"
}
```



---

archive/issue_events_278322.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-18T20:23:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-278322"
}
```
