# Issue 30560: Make openssl an optional dependency of python3

archive/issues_030323.json:
```json
{
    "body": "As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n\nIf system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n\nPart of #21700 Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)\n\n\nCC:  @mwageringel @slel @dimpase @orlitzky @jhpalmieri\n\nBranch/Commit: [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30560\n\n",
    "closed_at": "2020-09-18T20:23:08Z",
    "created_at": "2020-09-11T21:46:35Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make openssl an optional dependency of python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30560",
    "user": "https://github.com/mkoeppe"
}
```
As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.

If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.

Part of #21700 Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)


CC:  @mwageringel @slel @dimpase @orlitzky @jhpalmieri

Branch/Commit: [0c394ca0885c02944fba5b3472c5bd7f9a3c274d](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)

Reviewer: John Palmieri

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30560





---

archive/issue_events_089509.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "rename": {
        "from": "Build optional package openssl as part of TOOLCHAIN_DEPS",
        "to": "Build optional package openssl as part of SAGE_TOOLCHAIN"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-89509"
}
```



---

archive/issue_comments_604896.json:
```json
{
    "body": "<a id='comment:2'></a>\nBest done with a change to the `SAGE_SPKG_ENABLE` macro",
    "created_at": "2020-09-11T22:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Best done with a change to the `SAGE_SPKG_ENABLE` macro



---

archive/issue_comments_604897.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,5 @@\n As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n \n+If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n+\n``````\n",
    "created_at": "2020-09-13T18:21:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604897",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,5 @@
 As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.
 
+If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
+
``````




---

archive/issue_comments_604898.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain\"",
    "created_at": "2020-09-13T19:09:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604898",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain"



---

archive/issue_comments_604899.json:
```json
{
    "body": "Changing author from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604899",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Matthias Koeppe"



---

archive/issue_comments_604900.json:
```json
{
    "body": "Changing commit from \"\" to \"0c394ca0885c02944fba5b3472c5bd7f9a3c274d\"",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604900",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "0c394ca0885c02944fba5b3472c5bd7f9a3c274d"



---

archive/issue_comments_604901.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,5 +1,5 @@\n As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n \n-If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n+If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n \n``````\n",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604901",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,5 +1,5 @@
 As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.
 
-If system openssl is found via #30557, then `--enable-openssl` does not trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
+If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
 
``````




---

archive/issue_comments_604902.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604902",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_events_089510.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "rename": {
        "from": "Build optional package openssl as part of SAGE_TOOLCHAIN",
        "to": "Make openssl an optional dependency of python3"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-89510"
}
```



---

archive/issue_comments_604903.json:
```json
{
    "body": "<a id='comment:6'></a>\nFound a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review\n\n---\nNew commits:\n|                                                                                                                                          |                                                                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|\n|[0c394ca](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)|`build/pkgs/python3/dependencies: Make openssl a dependency if it is enabled`|",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604903",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review

---
New commits:
|                                                                                                                                          |                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------|
|[0c394ca](https://github.com/sagemath/sagetrac-mirror/commit/0c394ca0885c02944fba5b3472c5bd7f9a3c274d)|`build/pkgs/python3/dependencies: Make openssl a dependency if it is enabled`|



---

archive/issue_comments_604904.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n \n+Part of #21700 Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)\n \n``````\n",
    "created_at": "2020-09-13T19:46:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604904",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.
 
+Part of #21700 Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)
 
``````




---

archive/issue_comments_604905.json:
```json
{
    "body": "<a id='comment:9'></a>\nThis looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.\n\nTo test, I did `make distclean`. Then\n\n```\n$ ./configure --enable-openssl --with-system-python3=no\n$ make\n```\nbuilt `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.\n\nDo I need to find a system on which Python's `ssl` module fails to build?",
    "created_at": "2020-09-14T22:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604905",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>
This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.

To test, I did `make distclean`. Then

```
$ ./configure --enable-openssl --with-system-python3=no
$ make
```
built `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.

Do I need to find a system on which Python's `ssl` module fails to build?



---

archive/issue_comments_604906.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> To test, I did `make distclean`. Then\n> \n> ```\n> $ ./configure --enable-openssl --with-system-python3=no\n> $ make\n> ```\n> built `openssl` first and then `python3`, which is the point, right?\n\n\nRight.\n\n> Without this branch, these commands just build `python3`, not `openssl`.\n\n\nI think without this branch it should also have built `openssl`, just not necessarily before `python3`.",
    "created_at": "2020-09-14T22:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604906",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [jhpalmieri](#comment%3A9):
> To test, I did `make distclean`. Then
> 
> ```
> $ ./configure --enable-openssl --with-system-python3=no
> $ make
> ```
> built `openssl` first and then `python3`, which is the point, right?


Right.

> Without this branch, these commands just build `python3`, not `openssl`.


I think without this branch it should also have built `openssl`, just not necessarily before `python3`.



---

archive/issue_comments_604907.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [jhpalmieri](#comment%3A9):\n> Do I need to find a system on which Python's `ssl` module fails to build?\n\n\nI don't think that's necessary",
    "created_at": "2020-09-14T22:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Replying to [jhpalmieri](#comment%3A9):
> Do I need to find a system on which Python's `ssl` module fails to build?


I don't think that's necessary



---

archive/issue_comments_604908.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mkoeppe](#comment%3A10):\n> Replying to [jhpalmieri](#comment%3A9):\n> > To test, I did `make distclean`. Then\n> > \n> > ```\n> > $ ./configure --enable-openssl --with-system-python3=no\n> > $ make\n> > ```\n> > built `openssl` first and then `python3`, which is the point, right?\n\n> \n> Right.\n> \n> > Without this branch, these commands just build `python3`, not `openssl`.\n\n> \n> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.\n\n\nSorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.",
    "created_at": "2020-09-14T23:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604908",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>
Replying to [mkoeppe](#comment%3A10):
> Replying to [jhpalmieri](#comment%3A9):
> > To test, I did `make distclean`. Then
> > 
> > ```
> > $ ./configure --enable-openssl --with-system-python3=no
> > $ make
> > ```
> > built `openssl` first and then `python3`, which is the point, right?

> 
> Right.
> 
> > Without this branch, these commands just build `python3`, not `openssl`.

> 
> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.


Sorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.



---

archive/issue_comments_604909.json:
```json
{
    "body": "Changing reviewer from \"\" to \"John Palmieri\"",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604909",
    "user": "https://github.com/jhpalmieri"
}
```

Changing reviewer from "" to "John Palmieri"



---

archive/issue_comments_604910.json:
```json
{
    "body": "<a id='comment:13'></a>\nGood find with `findstring`, by the way.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604910",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>
Good find with `findstring`, by the way.



---

archive/issue_comments_604911.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604911",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_604912.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks!",
    "created_at": "2020-09-14T23:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Thanks!



---

archive/issue_comments_604913.json:
```json
{
    "body": "Changing branch from \"u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain\" to \"0c394ca0885c02944fba5b3472c5bd7f9a3c274d\"",
    "created_at": "2020-09-18T20:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604913",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/mkoeppe/build_optional_package_openssl_as_part_of_sage_toolchain" to "0c394ca0885c02944fba5b3472c5bd7f9a3c274d"



---

archive/issue_events_089511.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-18T20:23:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-89511"
}
```



---

archive/issue_comments_604914.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-18T20:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-604914",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
