# Issue 30560: Make openssl an optional dependency of python3

archive/issues_030323.json:
```json
{
    "body": "As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.\n\nIf system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.\n\nPart of #21700 Meta-ticket: Declare \"optional\" dependencies of packages (a package manager's suggested/recommended packages)\n\n\nCC:  @mwageringel @slel @dimpase @orlitzky @jhpalmieri\n\nBranch/Commit: 0c394ca0885c02944fba5b3472c5bd7f9a3c274d\n\nReviewer: John Palmieri\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30560\n\n",
    "closed_at": "2020-09-18T20:23:08Z",
    "created_at": "2020-09-11T21:46:35Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Make openssl an optional dependency of python3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30560",
    "user": "https://github.com/mkoeppe"
}
```
As discussed in #30556, if `openssl` is enabled using `--enable-openssl` and neither `openssl` nor `python3` are available as system packages, this makes sure that `openssl` is built before `python3`.

If system openssl is found via #30557, then `--enable-openssl` does NOT trigger building openssl. Use `--enable-openssl --without-system-openssl` if this is desired.

Part of #21700 Meta-ticket: Declare "optional" dependencies of packages (a package manager's suggested/recommended packages)


CC:  @mwageringel @slel @dimpase @orlitzky @jhpalmieri

Branch/Commit: 0c394ca0885c02944fba5b3472c5bd7f9a3c274d

Reviewer: John Palmieri

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30560





---

archive/issue_comments_432053.json:
```json
{
    "body": "<a id='comment:2'></a>Best done with a change to the `SAGE_SPKG_ENABLE` macro",
    "created_at": "2020-09-11T22:00:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432053",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Best done with a change to the `SAGE_SPKG_ENABLE` macro



---

archive/issue_comments_432054.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-09-13T18:03:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432054",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_432055.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432055",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_432056.json:
```json
{
    "body": "<a id='comment:6'></a>Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review\n\n---\nNew commits:",
    "created_at": "2020-09-13T19:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432056",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Found a simpler solution than the previously discussed SAGE_TOOLCHAIN business. Needs review

---
New commits:



---

archive/issue_comments_432057.json:
```json
{
    "body": "<a id='comment:9'></a>This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.\n\nTo test, I did `make distclean`. Then\n\n```\n$ ./configure --enable-openssl --with-system-python3=no\n$ make\n```\nbuilt `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.\n\nDo I need to find a system on which Python's `ssl` module fails to build?",
    "created_at": "2020-09-14T22:15:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432057",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:9'></a>This looks like it works, and the change makes sense. I couldn't completely test, though, since the `ssl` module for Python always seems to get built.

To test, I did `make distclean`. Then

```
$ ./configure --enable-openssl --with-system-python3=no
$ make
```
built `openssl` first and then `python3`, which is the point, right? Without this branch, these commands just build `python3`, not `openssl`.

Do I need to find a system on which Python's `ssl` module fails to build?



---

archive/issue_comments_432058.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 jhpalmieri]:\n> To test, I did `make distclean`. Then\n> \n> ```\n> $ ./configure --enable-openssl --with-system-python3=no\n> $ make\n> ```\n> built `openssl` first and then `python3`, which is the point, right?\n\n\nRight.\n\n> Without this branch, these commands just build `python3`, not `openssl`.\n\n\nI think without this branch it should also have built `openssl`, just not necessarily before `python3`.",
    "created_at": "2020-09-14T22:35:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432058",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>Replying to [comment:9 jhpalmieri]:
> To test, I did `make distclean`. Then
> 
> ```
> $ ./configure --enable-openssl --with-system-python3=no
> $ make
> ```
> built `openssl` first and then `python3`, which is the point, right?


Right.

> Without this branch, these commands just build `python3`, not `openssl`.


I think without this branch it should also have built `openssl`, just not necessarily before `python3`.



---

archive/issue_comments_432059.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:9 jhpalmieri]:\n> Do I need to find a system on which Python's `ssl` module fails to build?\n\n\nI don't think that's necessary",
    "created_at": "2020-09-14T22:37:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432059",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>Replying to [comment:9 jhpalmieri]:
> Do I need to find a system on which Python's `ssl` module fails to build?


I don't think that's necessary



---

archive/issue_comments_432060.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:\n> Replying to [comment:9 jhpalmieri]:\n> > To test, I did `make distclean`. Then\n> > \n> > ```\n> > $ ./configure --enable-openssl --with-system-python3=no\n> > $ make\n> > ```\n> > built `openssl` first and then `python3`, which is the point, right?\n\n> \n> Right.\n> \n> > Without this branch, these commands just build `python3`, not `openssl`.\n\n> \n> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.\n\n\nSorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.",
    "created_at": "2020-09-14T23:06:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432060",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:12'></a>Replying to [comment:10 mkoeppe]:
> Replying to [comment:9 jhpalmieri]:
> > To test, I did `make distclean`. Then
> > 
> > ```
> > $ ./configure --enable-openssl --with-system-python3=no
> > $ make
> > ```
> > built `openssl` first and then `python3`, which is the point, right?

> 
> Right.
> 
> > Without this branch, these commands just build `python3`, not `openssl`.

> 
> I think without this branch it should also have built `openssl`, just not necessarily before `python3`.


Sorry. I actually ran `make python3`, which is pretty convincing evidence that with this branch and with `./configure --enable-openssl`, Sage believes that `openssl` is a dependency of `python3`.



---

archive/issue_comments_432061.json:
```json
{
    "body": "<a id='comment:13'></a>Good find with `findstring`, by the way.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432061",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:13'></a>Good find with `findstring`, by the way.



---

archive/issue_comments_432062.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-14T23:06:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432062",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_432063.json:
```json
{
    "body": "<a id='comment:14'></a>Thanks!",
    "created_at": "2020-09-14T23:14:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432063",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Thanks!



---

archive/issue_events_079429.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-18T20:23:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30560#event-79429"
}
```



---

archive/issue_comments_432064.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-18T20:23:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30560",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30560#issuecomment-432064",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
