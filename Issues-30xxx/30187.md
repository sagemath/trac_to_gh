# Issue 30187: Words: improve `count` consistency across datatype representation

archive/issues_029950.json:
```json
{
    "body": "Before this ticket, `count` depends on the representation (list vs str) in a surprising way, see [this question on ask](https://ask.sagemath.org/question/52468):\n\n```\nsage: s = 'aaabaaababaaaaabbbbb'\nsage: u = Word(list(s))\nsage: v = Word(s)\nsage: u.count('ab')\n0\nsage: v.count('ab')\n4\n```\nbecause\n\n```\nsage: type(v)\n<class 'sage.combinat.words.word.FiniteWord_str'>\nsage: type(u)\n<class 'sage.combinat.words.word.FiniteWord_list'>\n```\nThe proposed solution is to fix `count` so that it behaves like list.count and tuple.count:\n\n```\nsage: list(u).count('ab')\n0\nsage: list(v).count('ab')\n0\n```\n\nIn the proposed branch, the method `count` is now an alias to the method `number_of_letter_occurrences`.\n\nDoing so, we also deprecate few methods in favor of:\n\n```\n_pos_in                    -> first_occurrence\nfirst_pos_in               -> first_occurrence\nfactor_occurrences_in      -> factor_occurrences_iterator\nnb_factor_occurrences_in   -> number_of_factor_occurrences\nnb_subword_occurrences_in  -> number_of_subword_occurrences\n```\n\nSee also:\n\n- #30143: mention `nb_factor_occurrences` in `count` documentation\n\nCC:  @seblabbe @slel\n\nKeywords: words, count\n\nReviewer: Jonathan Kliem\n\nAuthor: S\u00e9bastien Labb\u00e9\n\nBranch: 4c9870d1cc711907f4d0346a495ca0ca98d6bebd\n\nCommit: 4c9870d1cc711907f4d0346a495ca0ca98d6bebd\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30187\n\n",
    "closed_at": "2020-09-15T21:58:41Z",
    "created_at": "2020-07-21T07:50:25Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Words: improve `count` consistency across datatype representation",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30187",
    "user": "https://github.com/slel"
}
```
Before this ticket, `count` depends on the representation (list vs str) in a surprising way, see [this question on ask](https://ask.sagemath.org/question/52468):

```
sage: s = 'aaabaaababaaaaabbbbb'
sage: u = Word(list(s))
sage: v = Word(s)
sage: u.count('ab')
0
sage: v.count('ab')
4
```
because

```
sage: type(v)
<class 'sage.combinat.words.word.FiniteWord_str'>
sage: type(u)
<class 'sage.combinat.words.word.FiniteWord_list'>
```
The proposed solution is to fix `count` so that it behaves like list.count and tuple.count:

```
sage: list(u).count('ab')
0
sage: list(v).count('ab')
0
```

In the proposed branch, the method `count` is now an alias to the method `number_of_letter_occurrences`.

Doing so, we also deprecate few methods in favor of:

```
_pos_in                    -> first_occurrence
first_pos_in               -> first_occurrence
factor_occurrences_in      -> factor_occurrences_iterator
nb_factor_occurrences_in   -> number_of_factor_occurrences
nb_subword_occurrences_in  -> number_of_subword_occurrences
```

See also:

- #30143: mention `nb_factor_occurrences` in `count` documentation

CC:  @seblabbe @slel

Keywords: words, count

Reviewer: Jonathan Kliem

Author: Sébastien Labbé

Branch: 4c9870d1cc711907f4d0346a495ca0ca98d6bebd

Commit: 4c9870d1cc711907f4d0346a495ca0ca98d6bebd

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30187





---

archive/issue_comments_425007.json:
```json
{
    "body": "<a id='comment:1'></a>According to the documentation `count` counts the number of letters as in the behavior of the method `count` for python lists (not as the method count for python str which counts factors as well!). In that sense, it is a bad usage from the user. The reason for the different behavior outside of the documented domain is that the implementation depends on the data structure.\n\n```python\nsage: W = Words('ab', 20)\nsage: u = W.random_element()\nsage: v = Word('aaabaaababaaaaabbbbb')\n\nsage: type(u)\n<class 'sage.combinat.words.word.FiniteWord_list'>\nsage: type(v)\n<class 'sage.combinat.words.word.FiniteWord_str'>\n\nsage: v.count\n<built-in method count of FiniteWord_str object at 0x7f3853f0cc50>\nsage: u.count\n<built-in method count of FiniteWord_list object at 0x7f3853f12a48>\n```\n\nThe method `FiniteWord_list.count` and `FiniteWord_str.count` do not do the same thing as both overwrites the generic method `FiniteWord_class.count` (copied below) and delagate their job to `list.count` and `str.count` (faster).\n\nThe generic method is:\n\n```python\nsage: sage.combinat.words.finite_word.FiniteWord_class.count??\nSignature: sage.combinat.words.finite_word.FiniteWord_class.count(self, letter)\nSource:   \n    def count(self, letter):\n        r\"\"\"\n        Count the number of occurrences of ``letter`` in ``self``.\n\n        EXAMPLES::\n\n            sage: Word('abbabaab').count('a')\n            4\n        \"\"\"\n        return Integer(sum(1 for a in self if a == letter))\n```\n\nThe method `FiniteWord_list.count` is:\n\n```python\nsage: sage.combinat.words.word_datatypes.WordDatatype_list.count??\nSource:\n    def count(self, a):\n        r\"\"\"\n        Returns the number of occurrences of the letter ``a`` in the word\n        ``self``.\n\n        INPUT:\n\n        -  ``a`` - a letter\n\n        OUTPUT:\n\n        - integer\n\n        EXAMPLES::\n\n            sage: w = Word([0,1,1,0,1])\n            sage: w.count(0)\n            2\n            sage: w.count(1)\n            3\n            sage: w.count(2)\n            0\n\n        \"\"\"\n        return self._data.count(a)\n```\n\nThe method `FiniteWord_str.count` is:\n\n```python\nsage: sage.combinat.words.word_datatypes.WordDatatype_str.count??\nSource:\n    def count(self, letter):\n        r\"\"\"\n        Count the number of occurrences of ``letter``.\n\n        INPUT:\n\n        - ``letter`` - a letter\n\n        OUTPUT:\n\n        - integer\n\n        EXAMPLES::\n\n            sage: w = Word(\"abbabaabababa\")\n            sage: w.count('a')\n            7\n            sage: w.count('b')\n            6\n            sage: w.count('c')\n            0\n\n        \"\"\"\n        return self._data.count(letter)\n```\n\nBut, I agree that it could be more robust (provide an error message if the letter is not in the alphabet? or return zero? or advertise about `nb_factor_occurrences`?). Or should `count` works also for counting occurences of factors?",
    "created_at": "2020-07-22T09:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425007",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:1'></a>According to the documentation `count` counts the number of letters as in the behavior of the method `count` for python lists (not as the method count for python str which counts factors as well!). In that sense, it is a bad usage from the user. The reason for the different behavior outside of the documented domain is that the implementation depends on the data structure.

```python
sage: W = Words('ab', 20)
sage: u = W.random_element()
sage: v = Word('aaabaaababaaaaabbbbb')

sage: type(u)
<class 'sage.combinat.words.word.FiniteWord_list'>
sage: type(v)
<class 'sage.combinat.words.word.FiniteWord_str'>

sage: v.count
<built-in method count of FiniteWord_str object at 0x7f3853f0cc50>
sage: u.count
<built-in method count of FiniteWord_list object at 0x7f3853f12a48>
```

The method `FiniteWord_list.count` and `FiniteWord_str.count` do not do the same thing as both overwrites the generic method `FiniteWord_class.count` (copied below) and delagate their job to `list.count` and `str.count` (faster).

The generic method is:

```python
sage: sage.combinat.words.finite_word.FiniteWord_class.count??
Signature: sage.combinat.words.finite_word.FiniteWord_class.count(self, letter)
Source:   
    def count(self, letter):
        r"""
        Count the number of occurrences of ``letter`` in ``self``.

        EXAMPLES::

            sage: Word('abbabaab').count('a')
            4
        """
        return Integer(sum(1 for a in self if a == letter))
```

The method `FiniteWord_list.count` is:

```python
sage: sage.combinat.words.word_datatypes.WordDatatype_list.count??
Source:
    def count(self, a):
        r"""
        Returns the number of occurrences of the letter ``a`` in the word
        ``self``.

        INPUT:

        -  ``a`` - a letter

        OUTPUT:

        - integer

        EXAMPLES::

            sage: w = Word([0,1,1,0,1])
            sage: w.count(0)
            2
            sage: w.count(1)
            3
            sage: w.count(2)
            0

        """
        return self._data.count(a)
```

The method `FiniteWord_str.count` is:

```python
sage: sage.combinat.words.word_datatypes.WordDatatype_str.count??
Source:
    def count(self, letter):
        r"""
        Count the number of occurrences of ``letter``.

        INPUT:

        - ``letter`` - a letter

        OUTPUT:

        - integer

        EXAMPLES::

            sage: w = Word("abbabaabababa")
            sage: w.count('a')
            7
            sage: w.count('b')
            6
            sage: w.count('c')
            0

        """
        return self._data.count(letter)
```

But, I agree that it could be more robust (provide an error message if the letter is not in the alphabet? or return zero? or advertise about `nb_factor_occurrences`?). Or should `count` works also for counting occurences of factors?



---

archive/issue_comments_425008.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-28T09:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425008",
    "user": "https://github.com/seblabbe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_425009.json:
```json
{
    "body": "<a id='comment:2'></a>It also fixes #30143\n\n---\nNew commits:",
    "created_at": "2020-07-28T09:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425009",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:2'></a>It also fixes #30143

---
New commits:



---

archive/issue_comments_425010.json:
```json
{
    "body": "<a id='comment:3'></a>Salut Samuel, tu veux faire le review?",
    "created_at": "2020-08-26T12:24:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425010",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:3'></a>Salut Samuel, tu veux faire le review?



---

archive/issue_comments_425011.json:
```json
{
    "body": "<a id='comment:4'></a>```\nFile \"src/sage/modular/multiple_zeta.py\", line 38, in sage.modular.multiple_zeta\nFailed example:\n    Multizeta(2)*Multizeta(3)\nExpected:\n    6*\u03b6(1,4) + 3*\u03b6(2,3) + \u03b6(3,2)\nGot:\n    doctest:warning\n      File \"/home/sagemath/sage-9.1/src/bin/sage-runtests\", line 182, in <module>\n        err = DC.run()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/control.py\", line 1230, in run\n        self.run_doctests()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/control.py\", line 931, in run_doctests\n        self.dispatcher.dispatch()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2046, in dispatch\n        self.parallel_dispatch()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1941, in parallel_dispatch\n        w.start()  # This might take some time\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2213, in start\n        super(DocTestWorker, self).start()\n      File \"/usr/lib/python3.7/multiprocessing/process.py\", line 112, in start\n        self._popen = self._Popen(self)\n      File \"/usr/lib/python3.7/multiprocessing/context.py\", line 223, in _Popen\n        return _default_context.get_context().Process._Popen(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/context.py\", line 277, in _Popen\n        return Popen(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/popen_fork.py\", line 20, in __init__\n        self._launch(process_obj)\n      File \"/usr/lib/python3.7/multiprocessing/popen_fork.py\", line 74, in _launch\n        code = process_obj._bootstrap()\n      File \"/usr/lib/python3.7/multiprocessing/process.py\", line 297, in _bootstrap\n        self.run()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2185, in run\n        task(self.options, self.outtmpfile, msgpipe, self.result_queue)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2514, in __call__\n        doctests, extras = self._run(runner, options, results)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 2561, in _run\n        result = runner.run(test)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 913, in run\n        return self._run(test, compileflags, out)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 715, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py\", line 1139, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.modular.multiple_zeta[3]>\", line 1, in <module>\n        Multizeta(Integer(2))*Multizeta(Integer(3))\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/categories/magmatic_algebras.py\", line 219, in _product_from_product_on_basis_multiply\n        for (mon_left, coeff_left) in left.monomial_coefficients().items()\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py\", line 1025, in linear_combination\n        factor_on_left=factor_on_left ),\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py\", line 1023, in <genexpr>\n        return self._from_dict(blas.linear_combination( ((element._monomial_coefficients, coeff)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/categories/magmatic_algebras.py\", line 220, in <genexpr>\n        for (mon_right, coeff_right) in right.monomial_coefficients().items() )\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modular/multiple_zeta.py\", line 798, in product_on_basis\n        return MZV_it.composition(p1p2)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modules/with_basis/morphism.py\", line 399, in __call__\n        for (index, coeff) in mc.items())\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py\", line 1025, in linear_combination\n        factor_on_left=factor_on_left ),\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py\", line 1023, in <genexpr>\n        return self._from_dict(blas.linear_combination( ((element._monomial_coefficients, coeff)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modules/with_basis/morphism.py\", line 399, in <genexpr>\n        for (index, coeff) in mc.items())\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modular/multiple_zeta.py\", line 1461, in composition_on_basis\n        return (-1)**w.count(1) * codomain(iterated_to_composition(w))\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 420, in __call__\n        self.__name__, other))\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 100, in deprecation\n        warning(trac_number, message, DeprecationWarning, stacklevel)\n      File \"/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py\", line 146, in warning\n        warn(message, warning_class, stacklevel)\n      File \"/usr/lib/python3.7/warnings.py\", line 110, in _showwarnmsg\n        msg.file, msg.line)\n    :\n    DeprecationWarning: count is deprecated. Please use number_of_occurrences_of_letter instead.\n    See https://trac.sagemath.org/30187 for details.\n    6*\u03b6(1,4) + 3*\u03b6(2,3) + \u03b6(3,2)\n```",
    "created_at": "2020-09-04T13:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425011",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>```
File "src/sage/modular/multiple_zeta.py", line 38, in sage.modular.multiple_zeta
Failed example:
    Multizeta(2)*Multizeta(3)
Expected:
    6*ζ(1,4) + 3*ζ(2,3) + ζ(3,2)
Got:
    doctest:warning
      File "/home/sagemath/sage-9.1/src/bin/sage-runtests", line 182, in <module>
        err = DC.run()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/control.py", line 1230, in run
        self.run_doctests()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/control.py", line 931, in run_doctests
        self.dispatcher.dispatch()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2046, in dispatch
        self.parallel_dispatch()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1941, in parallel_dispatch
        w.start()  # This might take some time
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2213, in start
        super(DocTestWorker, self).start()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 112, in start
        self._popen = self._Popen(self)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 223, in _Popen
        return _default_context.get_context().Process._Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/context.py", line 277, in _Popen
        return Popen(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 20, in __init__
        self._launch(process_obj)
      File "/usr/lib/python3.7/multiprocessing/popen_fork.py", line 74, in _launch
        code = process_obj._bootstrap()
      File "/usr/lib/python3.7/multiprocessing/process.py", line 297, in _bootstrap
        self.run()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2185, in run
        task(self.options, self.outtmpfile, msgpipe, self.result_queue)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2514, in __call__
        doctests, extras = self._run(runner, options, results)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 2561, in _run
        result = runner.run(test)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 913, in run
        return self._run(test, compileflags, out)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 715, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/doctest/forker.py", line 1139, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.modular.multiple_zeta[3]>", line 1, in <module>
        Multizeta(Integer(2))*Multizeta(Integer(3))
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/categories/magmatic_algebras.py", line 219, in _product_from_product_on_basis_multiply
        for (mon_left, coeff_left) in left.monomial_coefficients().items()
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py", line 1025, in linear_combination
        factor_on_left=factor_on_left ),
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py", line 1023, in <genexpr>
        return self._from_dict(blas.linear_combination( ((element._monomial_coefficients, coeff)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/categories/magmatic_algebras.py", line 220, in <genexpr>
        for (mon_right, coeff_right) in right.monomial_coefficients().items() )
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modular/multiple_zeta.py", line 798, in product_on_basis
        return MZV_it.composition(p1p2)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modules/with_basis/morphism.py", line 399, in __call__
        for (index, coeff) in mc.items())
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py", line 1025, in linear_combination
        factor_on_left=factor_on_left ),
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/combinat/free_module.py", line 1023, in <genexpr>
        return self._from_dict(blas.linear_combination( ((element._monomial_coefficients, coeff)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modules/with_basis/morphism.py", line 399, in <genexpr>
        for (index, coeff) in mc.items())
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/modular/multiple_zeta.py", line 1461, in composition_on_basis
        return (-1)**w.count(1) * codomain(iterated_to_composition(w))
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 420, in __call__
        self.__name__, other))
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 100, in deprecation
        warning(trac_number, message, DeprecationWarning, stacklevel)
      File "/home/sagemath/sage-9.1/local/lib/python3.7/site-packages/sage/misc/superseded.py", line 146, in warning
        warn(message, warning_class, stacklevel)
      File "/usr/lib/python3.7/warnings.py", line 110, in _showwarnmsg
        msg.file, msg.line)
    :
    DeprecationWarning: count is deprecated. Please use number_of_occurrences_of_letter instead.
    See https://trac.sagemath.org/30187 for details.
    6*ζ(1,4) + 3*ζ(2,3) + ζ(3,2)
```



---

archive/issue_comments_425012.json:
```json
{
    "body": "<a id='comment:5'></a>In principal the change is ok, also I would have expected `count(self, 'ab')` to count the number of times the pattern `'ab'` appears in `self`. Then again 'ab' can also be a letter, so we have to distinguish.\n\nWhat I don't like is the mess with the names. For `v = Word('ab')` there is:\n\n- `number_of_factors`\n- `number_of_inversions`\n- `number_of_{left/right}_special_factors`\n- `nb_factor_occurs_in`\n- `nb_subword_occurs_in`\n\nCould we maybe add aliases\n- `number_factor_occurs_in` and `number_of_occurences_of_factor` (the later would cast the other into a word, if it isn't already)\n\nand likewise for `subword`.\n\nThis would make it much easier to find and in my opinion would make #30143 obsolete.",
    "created_at": "2020-09-04T13:56:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425012",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>In principal the change is ok, also I would have expected `count(self, 'ab')` to count the number of times the pattern `'ab'` appears in `self`. Then again 'ab' can also be a letter, so we have to distinguish.

What I don't like is the mess with the names. For `v = Word('ab')` there is:

- `number_of_factors`
- `number_of_inversions`
- `number_of_{left/right}_special_factors`
- `nb_factor_occurs_in`
- `nb_subword_occurs_in`

Could we maybe add aliases
- `number_factor_occurs_in` and `number_of_occurences_of_factor` (the later would cast the other into a word, if it isn't already)

and likewise for `subword`.

This would make it much easier to find and in my opinion would make #30143 obsolete.



---

archive/issue_comments_425013.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-04T15:17:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425013",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_425014.json:
```json
{
    "body": "<a id='comment:7'></a>I rebased the branch on top of beta11. I also removed the deprecation: it was not the original goal of the ticket. Also, maybe it is desirable to have `w.count()` behave the same whether `w` is a word or a tuple or a list. At least, replacing `count` by `number_of_occurrences_of_letter` in `multiple_zeta.py` shows that the input is sometime a word and sometimes a tuple.\n\n(I saw your recent comment just now after I force-pushed the branch.)",
    "created_at": "2020-09-04T15:26:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425014",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>I rebased the branch on top of beta11. I also removed the deprecation: it was not the original goal of the ticket. Also, maybe it is desirable to have `w.count()` behave the same whether `w` is a word or a tuple or a list. At least, replacing `count` by `number_of_occurrences_of_letter` in `multiple_zeta.py` shows that the input is sometime a word and sometimes a tuple.

(I saw your recent comment just now after I force-pushed the branch.)



---

archive/issue_comments_425015.json:
```json
{
    "body": "<a id='comment:8'></a>Works for me.\n\nWhat do you think of those aliases?\n\nI missed that you added the `SEEALSO` and this is great. Once you want to count something, you can look into documentation of `count`, which helps you find all the methods related to counting (in particular you see that there are methods `nb_of_...` and `number_of_...`.",
    "created_at": "2020-09-05T08:27:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425015",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>Works for me.

What do you think of those aliases?

I missed that you added the `SEEALSO` and this is great. Once you want to count something, you can look into documentation of `count`, which helps you find all the methods related to counting (in particular you see that there are methods `nb_of_...` and `number_of_...`.



---

archive/issue_comments_425016.json:
```json
{
    "body": "<a id='comment:9'></a>I still want to fix the `nb_methods`. Let me add a commit on the branch.",
    "created_at": "2020-09-05T12:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425016",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:9'></a>I still want to fix the `nb_methods`. Let me add a commit on the branch.



---

archive/issue_comments_425017.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-05T14:04:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425017",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425018.json:
```json
{
    "body": "<a id='comment:11'></a>Those methods names (`nb_*` and `*_in`) were from my master thesis back in 2007 where I just did not know what good choice to make. Today, I think the `nb_` shoud be replaced by `n_` or `number_of`, let's take `number_of` to be consistent with other methods in the same class. Also, I don't like the `*_in` like `f.factor_occurrences_in(w)` which I think should be better written as `w.factor_occurrences(f)`. Here I think I was mislead by the way the method `__str__.find` is implemented...\n\nAnyway, since the set of `nb_` methods was strongly intersecting the set of `*_in` methods, I decided to deprecate them all at once.\n\nThere are still other stuff that I dislike in that module, like `u.is_factor(w)` should be the other way around `w.is_factor(u)`, but let's keep those for another ticket.",
    "created_at": "2020-09-05T14:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425018",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:11'></a>Those methods names (`nb_*` and `*_in`) were from my master thesis back in 2007 where I just did not know what good choice to make. Today, I think the `nb_` shoud be replaced by `n_` or `number_of`, let's take `number_of` to be consistent with other methods in the same class. Also, I don't like the `*_in` like `f.factor_occurrences_in(w)` which I think should be better written as `w.factor_occurrences(f)`. Here I think I was mislead by the way the method `__str__.find` is implemented...

Anyway, since the set of `nb_` methods was strongly intersecting the set of `*_in` methods, I decided to deprecate them all at once.

There are still other stuff that I dislike in that module, like `u.is_factor(w)` should be the other way around `w.is_factor(u)`, but let's keep those for another ticket.



---

archive/issue_comments_425019.json:
```json
{
    "body": "<a id='comment:12'></a>Ready for review!",
    "created_at": "2020-09-05T15:04:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425019",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>Ready for review!



---

archive/issue_comments_425020.json:
```json
{
    "body": "<a id='comment:13'></a>doc does not build\n\n```\ndocstring of sage.combinat.words.abstract_word.Word_class.first_occurrence:17: WARNING: Inline literal start-string without end-string.\nmake[1]: *** [Makefile:1871: doc-html] Error 1\nmake[1]: Leaving directory '/home/sagemath/sage-9.1/build/make'\n```",
    "created_at": "2020-09-05T17:27:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425020",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>doc does not build

```
docstring of sage.combinat.words.abstract_word.Word_class.first_occurrence:17: WARNING: Inline literal start-string without end-string.
make[1]: *** [Makefile:1871: doc-html] Error 1
make[1]: Leaving directory '/home/sagemath/sage-9.1/build/make'
```



---

archive/issue_comments_425021.json:
```json
{
    "body": "<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-05T17:45:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425021",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425022.json:
```json
{
    "body": "<a id='comment:15'></a>oups, forgot to check that. Now doc builds ok on my machine.",
    "created_at": "2020-09-05T17:45:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425022",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:15'></a>oups, forgot to check that. Now doc builds ok on my machine.



---

archive/issue_comments_425023.json:
```json
{
    "body": "<a id='comment:16'></a>I would suggest:\n\n```diff\n-        sage: w[1:].first_occurrence(u)\n-        8\n+        sage: w.first_occurrence(u, start=1)\n+        9\n```",
    "created_at": "2020-09-07T07:20:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425023",
    "user": "https://github.com/kliem"
}
```

<a id='comment:16'></a>I would suggest:

```diff
-        sage: w[1:].first_occurrence(u)
-        8
+        sage: w.first_occurrence(u, start=1)
+        9
```



---

archive/issue_comments_425024.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-08T08:31:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425024",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_425025.json:
```json
{
    "body": "<a id='comment:18'></a>rebased on 9.2.beta12 + fixed `w[1:]` doctest. Needs review.",
    "created_at": "2020-09-08T08:32:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425025",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:18'></a>rebased on 9.2.beta12 + fixed `w[1:]` doctest. Needs review.



---

archive/issue_comments_425026.json:
```json
{
    "body": "<a id='comment:19'></a>updating description of ticket",
    "created_at": "2020-09-08T08:46:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425026",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:19'></a>updating description of ticket



---

archive/issue_comments_425027.json:
```json
{
    "body": "<a id='comment:22'></a>Sorry, two more things:\n\n```\n+    def first_occurrence(self, other, start=0):\n+        r\"\"\"\n+        Return the position of the first occurrence of ``other`` in ``self``,\n+        or ``None`` if ``other`` is not a factor of ``self``.\n+\n+        INPUT:\n+\n+        - ``other`` -- a finite word\n```\n\n``other`` needs no longer be finite. Maybe also a quick comment, about that the function might not terminate for infinite words. I don't think it is a problem. I tried it and one can keyboard interrupt without any problems.",
    "created_at": "2020-09-08T10:22:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425027",
    "user": "https://github.com/kliem"
}
```

<a id='comment:22'></a>Sorry, two more things:

```
+    def first_occurrence(self, other, start=0):
+        r"""
+        Return the position of the first occurrence of ``other`` in ``self``,
+        or ``None`` if ``other`` is not a factor of ``self``.
+
+        INPUT:
+
+        - ``other`` -- a finite word
```

``other`` needs no longer be finite. Maybe also a quick comment, about that the function might not terminate for infinite words. I don't think it is a problem. I tried it and one can keyboard interrupt without any problems.



---

archive/issue_comments_425028.json:
```json
{
    "body": "<a id='comment:23'></a>Sorry, I didn't read closely. Of course `other` does need to be finite (an `AttributeError` is raised, if it is not, which is fine for an error I think).\n\nThe comment about the function not terminating would still be nice.",
    "created_at": "2020-09-08T10:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425028",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>Sorry, I didn't read closely. Of course `other` does need to be finite (an `AttributeError` is raised, if it is not, which is fine for an error I think).

The comment about the function not terminating would still be nice.



---

archive/issue_comments_425029.json:
```json
{
    "body": "<a id='comment:24'></a>The patchbot is morally green. Once you added this comment, you can put this on positive review on my behalf.\n\n(I think the comment is needed, as you claimed that the function returns `None` if the factor is not present, which is not true for infinite words.)",
    "created_at": "2020-09-08T10:34:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425029",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>The patchbot is morally green. Once you added this comment, you can put this on positive review on my behalf.

(I think the comment is needed, as you claimed that the function returns `None` if the factor is not present, which is not true for infinite words.)



---

archive/issue_comments_425030.json:
```json
{
    "body": "<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-10T09:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_425031.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-10T09:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425031",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_425032.json:
```json
{
    "body": "<a id='comment:26'></a>Doc builds ok on my side.",
    "created_at": "2020-09-10T09:40:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425032",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:26'></a>Doc builds ok on my side.



---

archive/issue_comments_425033.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T21:58:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30187#issuecomment-425033",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_077880.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T21:58:41Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30187",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30187#event-77880"
}
```
