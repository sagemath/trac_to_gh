# Issue 30517: MemoryError in doctesting combinat/designs/gen_quadrangles_with_spread.pyx

archive/issues_030280.json:
```json
{
    "body": "There are numerous `MemoryError` instances in doctesting `gen_quadrangles_with_spread.pyx` with a final failure\n\n```\n----------------------------------------------------------------------\nsage -t --long --warn-long 127.5 --random-seed=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx  # Bad exit: 1\n----------------------------------------------------------------------\nTotal time for all tests: 108.3 seconds\n    cpu time: 0.0 seconds\n    cumulative wall time: 0.0 seconds\n```\n\nSee ticket #30223 for background.\n\nCC:  @dimpase @ivo-maffei\n\nKeywords: generalised_quadrangle\n\nReviewer: Dima Pasechnik\n\nAuthor: Volker Braun, Fr\u00e9d\u00e9ric Chapoton\n\nBranch: c40efe9f4b94adf9dffd778bbc68fdac997929e1\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30517\n\n",
    "closed_at": "2021-02-07T19:40:23Z",
    "created_at": "2020-09-06T15:38:00Z",
    "labels": [
        "component: combinatorial designs",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "MemoryError in doctesting combinat/designs/gen_quadrangles_with_spread.pyx",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30517",
    "user": "https://github.com/strogdon"
}
```
There are numerous `MemoryError` instances in doctesting `gen_quadrangles_with_spread.pyx` with a final failure

```
----------------------------------------------------------------------
sage -t --long --warn-long 127.5 --random-seed=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx  # Bad exit: 1
----------------------------------------------------------------------
Total time for all tests: 108.3 seconds
    cpu time: 0.0 seconds
    cumulative wall time: 0.0 seconds
```

See ticket #30223 for background.

CC:  @dimpase @ivo-maffei

Keywords: generalised_quadrangle

Reviewer: Dima Pasechnik

Author: Volker Braun, Frédéric Chapoton

Branch: c40efe9f4b94adf9dffd778bbc68fdac997929e1

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30517





---

archive/issue_comments_602856.json:
```json
{
    "body": "Attachment [gen_quadrangles_with_spread.pyx_test.log](tarball://root/attachments/some-uuid/ticket30517/gen_quadrangles_with_spread.pyx_test.log) by @strogdon created at 2020-09-06 15:40:08",
    "created_at": "2020-09-06T15:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602856",
    "user": "https://github.com/strogdon"
}
```

Attachment [gen_quadrangles_with_spread.pyx_test.log](tarball://root/attachments/some-uuid/ticket30517/gen_quadrangles_with_spread.pyx_test.log) by @strogdon created at 2020-09-06 15:40:08



---

archive/issue_comments_602857.json:
```json
{
    "body": "<a id='comment:1'></a>\nlog of failed doctest",
    "created_at": "2020-09-06T15:40:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602857",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:1'></a>
log of failed doctest



---

archive/issue_comments_602858.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,3 +8,5 @@\n     cpu time: 0.0 seconds\n     cumulative wall time: 0.0 seconds\n ```\n+\n+See ticket #30223 for background.\n``````\n",
    "created_at": "2020-09-06T15:46:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602858",
    "user": "https://github.com/strogdon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,3 +8,5 @@
     cpu time: 0.0 seconds
     cumulative wall time: 0.0 seconds
 ```
+
+See ticket #30223 for background.
``````




---

archive/issue_comments_602859.json:
```json
{
    "body": "<a id='comment:3'></a>\nI ran every command in `gen_quadrangles_with_spread.pyx` from the sage prompt without a problem. I'm wondering if there is some weird interaction with the doctesting framework - like memory not being cleared?",
    "created_at": "2020-09-06T17:18:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602859",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:3'></a>
I ran every command in `gen_quadrangles_with_spread.pyx` from the sage prompt without a problem. I'm wondering if there is some weird interaction with the doctesting framework - like memory not being cleared?



---

archive/issue_comments_602860.json:
```json
{
    "body": "<a id='comment:4'></a>\nThe above [test.log](https://trac.sagemath.org/attachment/ticket/30517/gen_quadrangles_with_spread.pyx_test.log) was with `9.2.beta11` which uses `python3.7`. `9.2.beta12` uses `python3.8` and the failure is more catastrophic. I will attach the full doctest with stack and cython backtraces. The doctest consumes about 2 GB of RAM before quitting. I have about 8 GB of total RAM. I do not have debugging symbols compiled in libraries. Doing that would require a significant effort.",
    "created_at": "2020-09-07T06:19:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602860",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:4'></a>
The above [test.log](https://trac.sagemath.org/attachment/ticket/30517/gen_quadrangles_with_spread.pyx_test.log) was with `9.2.beta11` which uses `python3.7`. `9.2.beta12` uses `python3.8` and the failure is more catastrophic. I will attach the full doctest with stack and cython backtraces. The doctest consumes about 2 GB of RAM before quitting. I have about 8 GB of total RAM. I do not have debugging symbols compiled in libraries. Doing that would require a significant effort.



---

archive/issue_comments_602861.json:
```json
{
    "body": "full doctest using 9.2.beta12 with stack and cython backtraces",
    "created_at": "2020-09-07T06:26:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602861",
    "user": "https://github.com/strogdon"
}
```

full doctest using 9.2.beta12 with stack and cython backtraces



---

archive/issue_comments_602862.json:
```json
{
    "body": "<a id='comment:5'></a>\nAttachment [gen_quadrangles_with_spread.pyx-py3.8_test.log.bz2](tarball://root/attachments/some-uuid/ticket30517/gen_quadrangles_with_spread.pyx-py3.8_test.log.bz2) by @strogdon created at 2020-09-07 06:32:45",
    "created_at": "2020-09-07T06:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602862",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:5'></a>
Attachment [gen_quadrangles_with_spread.pyx-py3.8_test.log.bz2](tarball://root/attachments/some-uuid/ticket30517/gen_quadrangles_with_spread.pyx-py3.8_test.log.bz2) by @strogdon created at 2020-09-07 06:32:45



---

archive/issue_comments_602863.json:
```json
{
    "body": "<a id='comment:6'></a>\nWas this with gcc 9 or 10?",
    "created_at": "2020-09-07T20:46:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602863",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>
Was this with gcc 9 or 10?



---

archive/issue_comments_602864.json:
```json
{
    "body": "<a id='comment:7'></a>\nWith these changes\n\n```diff\ndiff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\nindex 753d935e86..a8c1be9f09 100644\n--- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n+++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n@@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):\n         sage: t[0].is_generalized_quadrangle(parameters=True)\n         (9, 3)\n         sage: t = dual_GQ_ovoid(*t)\n-        sage: t[0].is_generalized_quadrangle(parameters=True)\n-        (3, 9)\n-        sage: all([x in t[0] for x in t[1]])\n-        True\n \n \n     TESTS::\n@@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):\n               is_GQ_with_spread, dual_GQ_ovoid\n         sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)\n         sage: t = dual_GQ_ovoid(*t)\n-        sage: is_GQ_with_spread(*t, s=3, t=9)\n-        True\n```\n\nI get no `MemoryError` and the doctest passes.",
    "created_at": "2020-09-07T20:47:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602864",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:7'></a>
With these changes

```diff
diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
index 753d935e86..a8c1be9f09 100644
--- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
+++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
@@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):
         sage: t[0].is_generalized_quadrangle(parameters=True)
         (9, 3)
         sage: t = dual_GQ_ovoid(*t)
-        sage: t[0].is_generalized_quadrangle(parameters=True)
-        (3, 9)
-        sage: all([x in t[0] for x in t[1]])
-        True
 
 
     TESTS::
@@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):
               is_GQ_with_spread, dual_GQ_ovoid
         sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)
         sage: t = dual_GQ_ovoid(*t)
-        sage: is_GQ_with_spread(*t, s=3, t=9)
-        True
```

I get no `MemoryError` and the doctest passes.



---

archive/issue_comments_602865.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [fbissey](#comment%3A6):\n> Was this with gcc 9 or 10?\n\nThis was with gcc 9. But I get the same result with gcc 10.",
    "created_at": "2020-09-07T20:48:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602865",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:8'></a>
Replying to [fbissey](#comment%3A6):
> Was this with gcc 9 or 10?

This was with gcc 9. But I get the same result with gcc 10.



---

archive/issue_comments_602866.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [strogdon](#comment%3A7):\n> With these changes\n> \n> ```\n> #!diff\n> diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> index 753d935e86..a8c1be9f09 100644\n> --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):\n>          sage: t[0].is_generalized_quadrangle(parameters=True)\n>          (9, 3)\n>          sage: t = dual_GQ_ovoid(*t)\n> -        sage: t[0].is_generalized_quadrangle(parameters=True)\n> -        (3, 9)\n> -        sage: all([x in t[0] for x in t[1]])\n> -        True\n>  \n>  \n>      TESTS::\n> @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):\n>                is_GQ_with_spread, dual_GQ_ovoid\n>          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)\n>          sage: t = dual_GQ_ovoid(*t)\n> -        sage: is_GQ_with_spread(*t, s=3, t=9)\n> -        True\n> ```\n> \n> I get no `MemoryError` and the doctest passes.\n\n\nIn the first part of the diff, you are removing two tests. I am assuming that means that they would fail individually without the other one being present. Is it the case?\n\nThe fact that you could run all the command individually without problem means the environment has to be \"primed\". There is probably a memory leak somewhere that leads to that particular outcome. Finding the leak may not be obvious.",
    "created_at": "2020-09-07T20:55:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602866",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:9'></a>
Replying to [strogdon](#comment%3A7):
> With these changes
> 
> ```
> #!diff
> diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> index 753d935e86..a8c1be9f09 100644
> --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):
>          sage: t[0].is_generalized_quadrangle(parameters=True)
>          (9, 3)
>          sage: t = dual_GQ_ovoid(*t)
> -        sage: t[0].is_generalized_quadrangle(parameters=True)
> -        (3, 9)
> -        sage: all([x in t[0] for x in t[1]])
> -        True
>  
>  
>      TESTS::
> @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):
>                is_GQ_with_spread, dual_GQ_ovoid
>          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)
>          sage: t = dual_GQ_ovoid(*t)
> -        sage: is_GQ_with_spread(*t, s=3, t=9)
> -        True
> ```
> 
> I get no `MemoryError` and the doctest passes.


In the first part of the diff, you are removing two tests. I am assuming that means that they would fail individually without the other one being present. Is it the case?

The fact that you could run all the command individually without problem means the environment has to be "primed". There is probably a memory leak somewhere that leads to that particular outcome. Finding the leak may not be obvious.



---

archive/issue_comments_602867.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [fbissey](#comment%3A9):\n> Replying to [strogdon](#comment%3A7):\n> > With these changes\n> > \n> > ```\n> > #!diff\n> > diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> > index 753d935e86..a8c1be9f09 100644\n> > --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> > +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> > @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):\n> >          sage: t[0].is_generalized_quadrangle(parameters=True)\n> >          (9, 3)\n> >          sage: t = dual_GQ_ovoid(*t)\n> > -        sage: t[0].is_generalized_quadrangle(parameters=True)\n> > -        (3, 9)\n> > -        sage: all([x in t[0] for x in t[1]])\n> > -        True\n> >  \n> >  \n> >      TESTS::\n> > @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):\n> >                is_GQ_with_spread, dual_GQ_ovoid\n> >          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)\n> >          sage: t = dual_GQ_ovoid(*t)\n> > -        sage: is_GQ_with_spread(*t, s=3, t=9)\n> > -        True\n> > ```\n> > \n> > I get no `MemoryError` and the doctest passes.\n\n> \n> In the first part of the diff, you are removing two tests. I am assuming that means that they would fail individually without the other one being present. Is it the case?\n> \n> The fact that you could run all the command individually without problem means the environment has to be \"primed\". There is probably a memory leak somewhere that leads to that particular outcome. Finding the leak may not be obvious.\n\n\nI don't know if removing just the first test in the first part of the diff would be sufficient to fix things. I can try just removing the first test. It appeared to me that perhaps `t = dual_GQ_ovoid(*t)` was tainted so I removed the second test also. This may be incorrect.\n\nBut I do think you are correct in that there is a possible memory leak.",
    "created_at": "2020-09-07T21:03:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602867",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:10'></a>
Replying to [fbissey](#comment%3A9):
> Replying to [strogdon](#comment%3A7):
> > With these changes
> > 
> > ```
> > #!diff
> > diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> > index 753d935e86..a8c1be9f09 100644
> > --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> > +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> > @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):
> >          sage: t[0].is_generalized_quadrangle(parameters=True)
> >          (9, 3)
> >          sage: t = dual_GQ_ovoid(*t)
> > -        sage: t[0].is_generalized_quadrangle(parameters=True)
> > -        (3, 9)
> > -        sage: all([x in t[0] for x in t[1]])
> > -        True
> >  
> >  
> >      TESTS::
> > @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):
> >                is_GQ_with_spread, dual_GQ_ovoid
> >          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)
> >          sage: t = dual_GQ_ovoid(*t)
> > -        sage: is_GQ_with_spread(*t, s=3, t=9)
> > -        True
> > ```
> > 
> > I get no `MemoryError` and the doctest passes.

> 
> In the first part of the diff, you are removing two tests. I am assuming that means that they would fail individually without the other one being present. Is it the case?
> 
> The fact that you could run all the command individually without problem means the environment has to be "primed". There is probably a memory leak somewhere that leads to that particular outcome. Finding the leak may not be obvious.


I don't know if removing just the first test in the first part of the diff would be sufficient to fix things. I can try just removing the first test. It appeared to me that perhaps `t = dual_GQ_ovoid(*t)` was tainted so I removed the second test also. This may be incorrect.

But I do think you are correct in that there is a possible memory leak.



---

archive/issue_comments_602868.json:
```json
{
    "body": "<a id='comment:11'></a>\nI've cc'd the author, Ivo.",
    "created_at": "2020-09-07T21:09:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602868",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
I've cc'd the author, Ivo.



---

archive/issue_comments_602869.json:
```json
{
    "body": "<a id='comment:12'></a>\nThis also works\n\n```diff\ndiff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\nindex 753d935e86..23ec4b3a84 100644\n--- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n+++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n@@ -198,8 +198,6 @@ def dual_GQ_ovoid(GQ, O):\n         sage: t[0].is_generalized_quadrangle(parameters=True)\n         (9, 3)\n         sage: t = dual_GQ_ovoid(*t)\n-        sage: t[0].is_generalized_quadrangle(parameters=True)\n-        (3, 9)\n         sage: all([x in t[0] for x in t[1]])\n         True\n \n@@ -271,8 +269,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):\n               is_GQ_with_spread, dual_GQ_ovoid\n         sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)\n         sage: t = dual_GQ_ovoid(*t)\n-        sage: is_GQ_with_spread(*t, s=3, t=9)\n-        True\n         sage: t = dual_GQ_ovoid(*(\n         ....: designs.generalised_quadrangle_hermitian_with_ovoid(2)))\n```",
    "created_at": "2020-09-07T21:10:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602869",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:12'></a>
This also works

```diff
diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
index 753d935e86..23ec4b3a84 100644
--- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
+++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
@@ -198,8 +198,6 @@ def dual_GQ_ovoid(GQ, O):
         sage: t[0].is_generalized_quadrangle(parameters=True)
         (9, 3)
         sage: t = dual_GQ_ovoid(*t)
-        sage: t[0].is_generalized_quadrangle(parameters=True)
-        (3, 9)
         sage: all([x in t[0] for x in t[1]])
         True
 
@@ -271,8 +269,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):
               is_GQ_with_spread, dual_GQ_ovoid
         sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)
         sage: t = dual_GQ_ovoid(*t)
-        sage: is_GQ_with_spread(*t, s=3, t=9)
-        True
         sage: t = dual_GQ_ovoid(*(
         ....: designs.generalised_quadrangle_hermitian_with_ovoid(2)))
```



---

archive/issue_comments_602870.json:
```json
{
    "body": "<a id='comment:13'></a>\nI didn't mean to remove the Cc",
    "created_at": "2020-09-07T21:11:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602870",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:13'></a>
I didn't mean to remove the Cc



---

archive/issue_comments_602871.json:
```json
{
    "body": "Changing commit from \"\" to \"36837a18013d5e13beb731386f42bcdb646f0e17\"",
    "created_at": "2020-09-08T09:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602871",
    "user": "https://github.com/Ivo-Maffei"
}
```

Changing commit from "" to "36837a18013d5e13beb731386f42bcdb646f0e17"



---

archive/issue_comments_602872.json:
```json
{
    "body": "<a id='comment:14'></a>\n`is_GQ_with_spread` internally calls `is_generalized_quadrangle`, so the issue lies in the first removed doctest.\nIn #30223 we had a similar issue with `is_generalized_quadrangle` which was called on an incidence structure not manipulated with `dual_GQ_ovoid`, so I'm keen to assume that `dual_GQ_ovoid` is not the cause of the issue.\n\nI can't reproduce the `MemoryError` on my machine so I created a test-function whose doctests should pretty much cover all operations done in `is_generalised_quadrangle`. Could you please run the doctests and let me know all lines (if any) that fail?\n\n---\nNew commits:\n|                                                                                                                                          |                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|\n|[36837a1](https://git.sagemath.org/sage.git/commit?id=36837a18013d5e13beb731386f42bcdb646f0e17)|`added test function`|",
    "created_at": "2020-09-08T09:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602872",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:14'></a>
`is_GQ_with_spread` internally calls `is_generalized_quadrangle`, so the issue lies in the first removed doctest.
In #30223 we had a similar issue with `is_generalized_quadrangle` which was called on an incidence structure not manipulated with `dual_GQ_ovoid`, so I'm keen to assume that `dual_GQ_ovoid` is not the cause of the issue.

I can't reproduce the `MemoryError` on my machine so I created a test-function whose doctests should pretty much cover all operations done in `is_generalised_quadrangle`. Could you please run the doctests and let me know all lines (if any) that fail?

---
New commits:
|                                                                                                                                          |                     |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------|
|[36837a1](https://git.sagemath.org/sage.git/commit?id=36837a18013d5e13beb731386f42bcdb646f0e17)|`added test function`|



---

archive/issue_comments_602873.json:
```json
{
    "body": "Changing branch from \"\" to \"public/combinat/30517\"",
    "created_at": "2020-09-08T09:36:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602873",
    "user": "https://github.com/Ivo-Maffei"
}
```

Changing branch from "" to "public/combinat/30517"



---

archive/issue_comments_602874.json:
```json
{
    "body": "<a id='comment:15'></a>\nwe should improve `is_generalized_quadrangle`.\n\n\nthere is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.\n\nOtherwise,\nif neither s nor t are defined, it is not a GQ, for either t or s must be 1. To finish, if s is not 1, take the dual, so now s=1, and the collinearity graph must be complete bipartite.",
    "created_at": "2020-09-08T14:14:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602874",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
we should improve `is_generalized_quadrangle`.


there is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.

Otherwise,
if neither s nor t are defined, it is not a GQ, for either t or s must be 1. To finish, if s is not 1, take the dual, so now s=1, and the collinearity graph must be complete bipartite.



---

archive/issue_comments_602875.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [dimpase](#comment%3A15):\n> there is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.\n\nI understand that the collinearity graph of a GQ is a srg, but I'm uncertain about the converse.\nIn particular, there are many difference incidence structures that have the same collinearity graph.\nIf we allow duplicate blocks, then an incidence structure which is a regular GQ with a duplicated block is no more a GQ, but its collinearity graph is the same. Perhaps this is just an edge-case and not allowing duplicate blocks would fix the converse, but I'm not sure.\n\n> Otherwise,\n> if neither s nor t are defined, it is not a GQ\n\nI don't see why this would be the case, but I trust you.\nAlso you say that if s is not defined, then t must be 1 and vice versa?\n\n> now s=1, and the collinearity graph must be complete bipartite.\n\nConsider the incidence structure with blocks `[[1, 2], [2, 3]]`.\nThen s = 1 and t is not defined.\nIts collinearity graph has edges `[(1, 2), (2, 3)]` which is complete bipartite K_{2, 1}, but the incidence structure is not a GQ.\nI think that more generally complete bipartite K_{n, 1} are not GQ, is this right?",
    "created_at": "2020-09-08T15:38:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602875",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:16'></a>
Replying to [dimpase](#comment%3A15):
> there is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.

I understand that the collinearity graph of a GQ is a srg, but I'm uncertain about the converse.
In particular, there are many difference incidence structures that have the same collinearity graph.
If we allow duplicate blocks, then an incidence structure which is a regular GQ with a duplicated block is no more a GQ, but its collinearity graph is the same. Perhaps this is just an edge-case and not allowing duplicate blocks would fix the converse, but I'm not sure.

> Otherwise,
> if neither s nor t are defined, it is not a GQ

I don't see why this would be the case, but I trust you.
Also you say that if s is not defined, then t must be 1 and vice versa?

> now s=1, and the collinearity graph must be complete bipartite.

Consider the incidence structure with blocks `[[1, 2], [2, 3]]`.
Then s = 1 and t is not defined.
Its collinearity graph has edges `[(1, 2), (2, 3)]` which is complete bipartite K_{2, 1}, but the incidence structure is not a GQ.
I think that more generally complete bipartite K_{n, 1} are not GQ, is this right?



---

archive/issue_comments_602876.json:
```json
{
    "body": "Attachment [quadrangles_with_spread.pyx_newtest.log](tarball://root/attachments/some-uuid/ticket30517/quadrangles_with_spread.pyx_newtest.log) by @strogdon created at 2020-09-08 17:25:19\n\nThese are the failures I get with the added tests in `test()`",
    "created_at": "2020-09-08T17:25:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602876",
    "user": "https://github.com/strogdon"
}
```

Attachment [quadrangles_with_spread.pyx_newtest.log](tarball://root/attachments/some-uuid/ticket30517/quadrangles_with_spread.pyx_newtest.log) by @strogdon created at 2020-09-08 17:25:19

These are the failures I get with the added tests in `test()`



---

archive/issue_comments_602877.json:
```json
{
    "body": "<a id='comment:17'></a>\nReplying to [gh-Ivo-Maffei](#comment%3A16):\n> Replying to [dimpase](#comment%3A15):\n> > there is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.\n\n> I understand that the collinearity graph of a GQ is a srg, but I'm uncertain about the converse.\n> In particular, there are many difference incidence structures that have the same collinearity graph.\n> If we allow duplicate blocks, then an incidence structure which is a regular GQ with a duplicated block is no more a GQ, but its collinearity graph is the same. Perhaps this is just an edge-case and not allowing duplicate blocks would fix the converse, but I'm not sure.\n> \n> > Otherwise,\n> > if neither s nor t are defined, it is not a GQ\n\n> I don't see why this would be the case, but I trust you.\n> Also you say that if s is not defined, then t must be 1 and vice versa?\n> \n> > now s=1, and the collinearity graph must be complete bipartite.\n\n> Consider the incidence structure with blocks `[[1, 2], [2, 3]]`.\n> Then s = 1 and t is not defined.\n> Its collinearity graph has edges `[(1, 2), (2, 3)]` which is complete bipartite K_{2, 1}, but the incidence structure is not a GQ.\n> I think that more generally complete bipartite K_{n, 1} are not GQ, is this right?\n\n\nright, these are so called degenerate generalised polygons (a number of lines all intersecting in one point). Usually, but not excluded from the definition. Let's exclude this case.\n\nWe should also exclude the case of repeated lines.\n\n\nNote that it is immediate (there cannot be any triangls, but for any point p and line L not on L there is a point collinear on L collinear to p) from the definition of a generalised quadrangle that two non-intersecting lines have the same size. \nDually, for any 2 non-collinear points the number of lines on each of then must be the same.  \n\nIt follows that there are either lines of two different sizes, and you have a \"grid\" (just 2 lines on each point, so t=1), or all lines are of the same size.",
    "created_at": "2020-09-08T17:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602877",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
Replying to [gh-Ivo-Maffei](#comment%3A16):
> Replying to [dimpase](#comment%3A15):
> > there is no need to construct the incidence graph. In the regular+uniform  case, i.e. if (s,t) are defined, just check that the collinearity graph (aka block graph) is s.r.g. with the correct parameters.

> I understand that the collinearity graph of a GQ is a srg, but I'm uncertain about the converse.
> In particular, there are many difference incidence structures that have the same collinearity graph.
> If we allow duplicate blocks, then an incidence structure which is a regular GQ with a duplicated block is no more a GQ, but its collinearity graph is the same. Perhaps this is just an edge-case and not allowing duplicate blocks would fix the converse, but I'm not sure.
> 
> > Otherwise,
> > if neither s nor t are defined, it is not a GQ

> I don't see why this would be the case, but I trust you.
> Also you say that if s is not defined, then t must be 1 and vice versa?
> 
> > now s=1, and the collinearity graph must be complete bipartite.

> Consider the incidence structure with blocks `[[1, 2], [2, 3]]`.
> Then s = 1 and t is not defined.
> Its collinearity graph has edges `[(1, 2), (2, 3)]` which is complete bipartite K_{2, 1}, but the incidence structure is not a GQ.
> I think that more generally complete bipartite K_{n, 1} are not GQ, is this right?


right, these are so called degenerate generalised polygons (a number of lines all intersecting in one point). Usually, but not excluded from the definition. Let's exclude this case.

We should also exclude the case of repeated lines.


Note that it is immediate (there cannot be any triangls, but for any point p and line L not on L there is a point collinear on L collinear to p) from the definition of a generalised quadrangle that two non-intersecting lines have the same size. 
Dually, for any 2 non-collinear points the number of lines on each of then must be the same.  

It follows that there are either lines of two different sizes, and you have a "grid" (just 2 lines on each point, so t=1), or all lines are of the same size.



---

archive/issue_comments_602878.json:
```json
{
    "body": "<a id='comment:18'></a>\nDoesn't\n\n```\nUsing --optional=build,dochtml,memlimit,sage\n```\nmean that tests limit memory in some way?",
    "created_at": "2020-09-08T17:38:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602878",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
Doesn't

```
Using --optional=build,dochtml,memlimit,sage
```
mean that tests limit memory in some way?



---

archive/issue_comments_602879.json:
```json
{
    "body": "Attachment [newtest.pyx_test.log](tarball://root/attachments/some-uuid/ticket30517/newtest.pyx_test.log) by @strogdon created at 2020-09-08 18:01:43\n\nTests in https://trac.sagemath.org/attachment/ticket/30517/quadrangles_with_spread.pyx_newtest.log may be contaminated by prior failures. Attached are results of just the tests in `test()`",
    "created_at": "2020-09-08T18:01:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602879",
    "user": "https://github.com/strogdon"
}
```

Attachment [newtest.pyx_test.log](tarball://root/attachments/some-uuid/ticket30517/newtest.pyx_test.log) by @strogdon created at 2020-09-08 18:01:43

Tests in https://trac.sagemath.org/attachment/ticket/30517/quadrangles_with_spread.pyx_newtest.log may be contaminated by prior failures. Attached are results of just the tests in `test()`



---

archive/issue_comments_602880.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [dimpase](#comment%3A18):\n> Doesn't\n> \n> ```\n> Using --optional=build,dochtml,memlimit,sage\n> ```\n> mean that tests limit memory in some way?\n\nThis\n\n```\nTesting files:\n\n  -t [options] <files|dir> -- test examples in .py, .pyx, .sage\n                              or .tex files.  Options:\n     --long           -- include lines with the phrase 'long time'\n     --verbose        -- print debugging output during the test\n     --all            -- test all files\n     --optional       -- also test all examples labeled \"# optional\"\n```\nseems to imply relative to doctesting that files so marked will also be tested. Not sure what the `Using --optional=...` implies, nor do I know how to change it.",
    "created_at": "2020-09-08T18:16:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602880",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:19'></a>
Replying to [dimpase](#comment%3A18):
> Doesn't
> 
> ```
> Using --optional=build,dochtml,memlimit,sage
> ```
> mean that tests limit memory in some way?

This

```
Testing files:

  -t [options] <files|dir> -- test examples in .py, .pyx, .sage
                              or .tex files.  Options:
     --long           -- include lines with the phrase 'long time'
     --verbose        -- print debugging output during the test
     --all            -- test all files
     --optional       -- also test all examples labeled "# optional"
```
seems to imply relative to doctesting that files so marked will also be tested. Not sure what the `Using --optional=...` implies, nor do I know how to change it.



---

archive/issue_comments_602881.json:
```json
{
    "body": "<a id='comment:20'></a>\nIt seems from reading `src/bin/sage-runtests` that the default, if there is `memlimit` in\n`--optional`, is 3300 MB \"per test\"",
    "created_at": "2020-09-08T19:03:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602881",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:20'></a>
It seems from reading `src/bin/sage-runtests` that the default, if there is `memlimit` in
`--optional`, is 3300 MB "per test"



---

archive/issue_comments_602882.json:
```json
{
    "body": "<a id='comment:21'></a>\nReplying to [dimpase](#comment%3A20):\n> It seems from reading `src/bin/sage-runtests` that the default, if there is `memlimit` in\n> `--optional`, is 3300 MB \"per test\"\n\nWell, isn't that interesting. Doing\n\n```\n./sage -t --long --verbose --warn-long 127.5 --random-seed=0 --memlimit=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n```\ngives no failing tests. When I use `memlimit=0` then `memlimit` does not appear\n\n```\nUsing --optional=build,dochtml,sage\n```\nWhat do you have in your `Using` line and how are the `--optional` items set? Is this really the issue?",
    "created_at": "2020-09-08T19:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602882",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:21'></a>
Replying to [dimpase](#comment%3A20):
> It seems from reading `src/bin/sage-runtests` that the default, if there is `memlimit` in
> `--optional`, is 3300 MB "per test"

Well, isn't that interesting. Doing

```
./sage -t --long --verbose --warn-long 127.5 --random-seed=0 --memlimit=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
```
gives no failing tests. When I use `memlimit=0` then `memlimit` does not appear

```
Using --optional=build,dochtml,sage
```
What do you have in your `Using` line and how are the `--optional` items set? Is this really the issue?



---

archive/issue_comments_602883.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [strogdon](#comment%3A21):\n\n> {{{\n> Using --optional=build,dochtml,sage\n> }}}\n> What do you have in your `Using` line and how are the `--optional` items set? Is this really the issue?\n\n\nthat was just a copy/paste from the log you attached here. By default `memlimit` is there.\n\nIt could be just few memory-hungry tests run in parallel, and not a memory leak.",
    "created_at": "2020-09-08T20:27:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602883",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
Replying to [strogdon](#comment%3A21):

> {{{
> Using --optional=build,dochtml,sage
> }}}
> What do you have in your `Using` line and how are the `--optional` items set? Is this really the issue?


that was just a copy/paste from the log you attached here. By default `memlimit` is there.

It could be just few memory-hungry tests run in parallel, and not a memory leak.



---

archive/issue_events_079293.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30517#event-79293"
}
```



---

archive/issue_comments_602884.json:
```json
{
    "body": "<a id='comment:24'></a>\nThis almost always runs out of memory on the kucalc buildbot:\n\n```\nsage: from sage.combinat.designs.gen_quadrangles_with_spread import is_GQ_with_spread, dual_GQ_ovoid ## line 270 ##\nsage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3) ## line 272 ##\nsage: t = dual_GQ_ovoid(*t) ## line 273 ##\nsage: is_GQ_with_spread(*t, s=3, t=9) ## line 274 ##\n\n**********************************************************************\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx  # Bad exit: 1\n----------------------------------------------------------------------\n```\nFor example, running the last `is_GQ_with_spread` command eats about 170Mb per invocation that is never released.",
    "created_at": "2021-01-31T15:12:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602884",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:24'></a>
This almost always runs out of memory on the kucalc buildbot:

```
sage: from sage.combinat.designs.gen_quadrangles_with_spread import is_GQ_with_spread, dual_GQ_ovoid ## line 270 ##
sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3) ## line 272 ##
sage: t = dual_GQ_ovoid(*t) ## line 273 ##
sage: is_GQ_with_spread(*t, s=3, t=9) ## line 274 ##

**********************************************************************
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/combinat/designs/gen_quadrangles_with_spread.pyx  # Bad exit: 1
----------------------------------------------------------------------
```
For example, running the last `is_GQ_with_spread` command eats about 170Mb per invocation that is never released.



---

archive/issue_comments_602885.json:
```json
{
    "body": "<a id='comment:25'></a>\nReplying to [strogdon](#comment%3A7):\n> With these changes\n> \n> ```\n> #!diff\n> diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> index 753d935e86..a8c1be9f09 100644\n> --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx\n> @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):\n>          sage: t[0].is_generalized_quadrangle(parameters=True)\n>          (9, 3)\n>          sage: t = dual_GQ_ovoid(*t)\n> -        sage: t[0].is_generalized_quadrangle(parameters=True)\n> -        (3, 9)\n> -        sage: all([x in t[0] for x in t[1]])\n> -        True\n>  \n>  \n>      TESTS::\n> @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):\n>                is_GQ_with_spread, dual_GQ_ovoid\n>          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)\n>          sage: t = dual_GQ_ovoid(*t)\n> -        sage: is_GQ_with_spread(*t, s=3, t=9)\n> -        True\n> ```\n> \n> I get no `MemoryError` and the doctest passes.\n\n\nIf you want to tag those up as `# known bug` I'll be happy to review",
    "created_at": "2021-01-31T15:20:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602885",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
Replying to [strogdon](#comment%3A7):
> With these changes
> 
> ```
> #!diff
> diff --git a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> index 753d935e86..a8c1be9f09 100644
> --- a/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> +++ b/src/sage/combinat/designs/gen_quadrangles_with_spread.pyx
> @@ -198,10 +198,6 @@ def dual_GQ_ovoid(GQ, O):
>          sage: t[0].is_generalized_quadrangle(parameters=True)
>          (9, 3)
>          sage: t = dual_GQ_ovoid(*t)
> -        sage: t[0].is_generalized_quadrangle(parameters=True)
> -        (3, 9)
> -        sage: all([x in t[0] for x in t[1]])
> -        True
>  
>  
>      TESTS::
> @@ -271,8 +267,6 @@ def generalised_quadrangle_hermitian_with_ovoid(const int q):
>                is_GQ_with_spread, dual_GQ_ovoid
>          sage: t = designs.generalised_quadrangle_hermitian_with_ovoid(3)
>          sage: t = dual_GQ_ovoid(*t)
> -        sage: is_GQ_with_spread(*t, s=3, t=9)
> -        True
> ```
> 
> I get no `MemoryError` and the doctest passes.


If you want to tag those up as `# known bug` I'll be happy to review



---

archive/issue_comments_602886.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[08b8890](https://git.sagemath.org/sage.git/commit/?id=08b88903af9a1e52b298d3558bcc6818fefbceea)|`Merge branch 'public/combinat/30517' in 9.3.b6`|\n|[a6841da](https://git.sagemath.org/sage.git/commit/?id=a6841da0ccbacea94b6815241b7be02e78dfda32)|`adding known bug tags`|",
    "created_at": "2021-01-31T16:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[08b8890](https://git.sagemath.org/sage.git/commit/?id=08b88903af9a1e52b298d3558bcc6818fefbceea)|`Merge branch 'public/combinat/30517' in 9.3.b6`|
|[a6841da](https://git.sagemath.org/sage.git/commit/?id=a6841da0ccbacea94b6815241b7be02e78dfda32)|`adding known bug tags`|



---

archive/issue_comments_602887.json:
```json
{
    "body": "Changing commit from \"36837a18013d5e13beb731386f42bcdb646f0e17\" to \"a6841da0ccbacea94b6815241b7be02e78dfda32\"",
    "created_at": "2021-01-31T16:25:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "36837a18013d5e13beb731386f42bcdb646f0e17" to "a6841da0ccbacea94b6815241b7be02e78dfda32"



---

archive/issue_comments_602888.json:
```json
{
    "body": "<a id='comment:27'></a>\nI have added a commit on top of the public branch, just adding the 3 suggested known bug tags",
    "created_at": "2021-01-31T16:25:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602888",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:27'></a>
I have added a commit on top of the public branch, just adding the 3 suggested known bug tags



---

archive/issue_comments_602889.json:
```json
{
    "body": "<a id='comment:28'></a>\nReplying to [chapoton](#comment%3A27):\n> I have added a commit on top of the public branch, just adding the 3 suggested known bug tags \n\nIs the `def test()` function needed?",
    "created_at": "2021-01-31T16:39:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602889",
    "user": "https://github.com/strogdon"
}
```

<a id='comment:28'></a>
Replying to [chapoton](#comment%3A27):
> I have added a commit on top of the public branch, just adding the 3 suggested known bug tags 

Is the `def test()` function needed?



---

archive/issue_comments_602890.json:
```json
{
    "body": "<a id='comment:29'></a>\nI have not idea. Feel free to remove it and squash the branch if you think this is better.",
    "created_at": "2021-01-31T16:57:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602890",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:29'></a>
I have not idea. Feel free to remove it and squash the branch if you think this is better.



---

archive/issue_comments_602891.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [strogdon](#comment%3A28):\n> Is the `def test()` function needed?\n\n`def test()` is a function I added it in [here](#comment%3A14) to help debug the issue. I guess it can go now that vbraun found the problem.",
    "created_at": "2021-01-31T19:37:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602891",
    "user": "https://github.com/Ivo-Maffei"
}
```

<a id='comment:30'></a>
Replying to [strogdon](#comment%3A28):
> Is the `def test()` function needed?

`def test()` is a function I added it in [here](#comment%3A14) to help debug the issue. I guess it can go now that vbraun found the problem.



---

archive/issue_comments_602892.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [gh-Ivo-Maffei](#comment%3A30):\n> Replying to [strogdon](#comment%3A28):\n> > Is the `def test()` function needed?\n\n> `def test()` is a function I added it in [here](#comment%3A14) to help debug the issue. I guess it can go now that vbraun found the problem.\n\nwell, not that Volker found the problem, he found a test to disable to avoid this doctesting issue.",
    "created_at": "2021-01-31T20:38:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602892",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:31'></a>
Replying to [gh-Ivo-Maffei](#comment%3A30):
> Replying to [strogdon](#comment%3A28):
> > Is the `def test()` function needed?

> `def test()` is a function I added it in [here](#comment%3A14) to help debug the issue. I guess it can go now that vbraun found the problem.

well, not that Volker found the problem, he found a test to disable to avoid this doctesting issue.



---

archive/issue_comments_602893.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|\n|[c40efe9](https://git.sagemath.org/sage.git/commit/?id=c40efe9f4b94adf9dffd778bbc68fdac997929e1)|`removed test()`|",
    "created_at": "2021-01-31T20:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------|
|[c40efe9](https://git.sagemath.org/sage.git/commit/?id=c40efe9f4b94adf9dffd778bbc68fdac997929e1)|`removed test()`|



---

archive/issue_comments_602894.json:
```json
{
    "body": "Changing commit from \"a6841da0ccbacea94b6815241b7be02e78dfda32\" to \"c40efe9f4b94adf9dffd778bbc68fdac997929e1\"",
    "created_at": "2021-01-31T20:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a6841da0ccbacea94b6815241b7be02e78dfda32" to "c40efe9f4b94adf9dffd778bbc68fdac997929e1"



---

archive/issue_comments_602895.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-01-31T20:47:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602895",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_602896.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Dima Pasechnik\"",
    "created_at": "2021-01-31T20:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602896",
    "user": "https://github.com/dimpase"
}
```

Changing reviewer from "" to "Dima Pasechnik"



---

archive/issue_comments_602897.json:
```json
{
    "body": "Changing author from \"\" to \"Volker Braun, Frederic Chapoton\"",
    "created_at": "2021-01-31T20:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602897",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Volker Braun, Frederic Chapoton"



---

archive/issue_comments_602898.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-31T20:47:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602898",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_602899.json:
```json
{
    "body": "<a id='comment:35'></a>\nFollowup for the underlying issue at #31313",
    "created_at": "2021-01-31T20:50:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602899",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:35'></a>
Followup for the underlying issue at #31313



---

archive/issue_comments_602900.json:
```json
{
    "body": "<a id='comment:36'></a>\nBranch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:\n|                                                                                                                                           |                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|\n|[d10c62d](https://git.sagemath.org/sage.git/commit/?id=d10c62d4354e6e722b857e43f92a39e1f745be67)|`remove \"known bug\" tags`|",
    "created_at": "2021-02-03T06:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>
Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:
|                                                                                                                                           |                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------|
|[d10c62d](https://git.sagemath.org/sage.git/commit/?id=d10c62d4354e6e722b857e43f92a39e1f745be67)|`remove "known bug" tags`|



---

archive/issue_comments_602901.json:
```json
{
    "body": "Changing commit from \"c40efe9f4b94adf9dffd778bbc68fdac997929e1\" to \"d10c62d4354e6e722b857e43f92a39e1f745be67\"",
    "created_at": "2021-02-03T06:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "c40efe9f4b94adf9dffd778bbc68fdac997929e1" to "d10c62d4354e6e722b857e43f92a39e1f745be67"



---

archive/issue_comments_602902.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-02-03T06:29:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_602903.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#31313\"",
    "created_at": "2021-02-03T06:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602903",
    "user": "https://github.com/DaveWitteMorris"
}
```

Changing dependencies from "" to "#31313"



---

archive/issue_comments_602904.json:
```json
{
    "body": "<a id='comment:37'></a>\nThe memory leak was fixed at #31313, so I removed the \"known bug\" tags. I think it is cleaner to do that here, instead of on #31313. Revert my PR if I am wrong.",
    "created_at": "2021-02-03T06:33:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602904",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:37'></a>
The memory leak was fixed at #31313, so I removed the "known bug" tags. I think it is cleaner to do that here, instead of on #31313. Revert my PR if I am wrong.



---

archive/issue_comments_602905.json:
```json
{
    "body": "<a id='comment:38'></a>\nnever ever change something on a positive reviewed ticket unless you have very good reasons",
    "created_at": "2021-02-03T09:09:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602905",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:38'></a>
never ever change something on a positive reviewed ticket unless you have very good reasons



---

archive/issue_comments_602906.json:
```json
{
    "body": "<a id='comment:39'></a>\nas you can see here, the former branch had already been used by our release manager \n\nhttps://github.com/vbraun/sage/commits/develop\n\nso *please* revert and put back the exact same branch that was here when it was set to positive",
    "created_at": "2021-02-03T16:30:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602906",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:39'></a>
as you can see here, the former branch had already been used by our release manager 

https://github.com/vbraun/sage/commits/develop

so *please* revert and put back the exact same branch that was here when it was set to positive



---

archive/issue_comments_602907.json:
```json
{
    "body": "<a id='comment:40'></a>\nI'm very sorry I goofed things up. I thought it was only closed tickets that should not be messed with.\n\nI also thought it would be easy to revert my commit, so I'm also sorry that I don't know how to \"put back the exact same branch that was here\". My attempt was rejected:\n\n```\nSTDERR: error: failed to push some refs to 'git@trac.sagemath.org:sage.git'\nSTDERR: hint: Updates were rejected because a pushed branch tip is behind its remote\n```\nI know very little about git, so, since this didn't work, all I would know how to do is push a reversion commit to undo my erroneous change, but I don't think you want me to do that, because it would add yet another commit to the history.  (Maybe a \"forced push\" would work, but I am not confident enough to try something like that, because my understanding is that it has the potential to mess things up permanently.)",
    "created_at": "2021-02-03T18:33:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602907",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:40'></a>
I'm very sorry I goofed things up. I thought it was only closed tickets that should not be messed with.

I also thought it would be easy to revert my commit, so I'm also sorry that I don't know how to "put back the exact same branch that was here". My attempt was rejected:

```
STDERR: error: failed to push some refs to 'git@trac.sagemath.org:sage.git'
STDERR: hint: Updates were rejected because a pushed branch tip is behind its remote
```
I know very little about git, so, since this didn't work, all I would know how to do is push a reversion commit to undo my erroneous change, but I don't think you want me to do that, because it would add yet another commit to the history.  (Maybe a "forced push" would work, but I am not confident enough to try something like that, because my understanding is that it has the potential to mess things up permanently.)



---

archive/issue_comments_602908.json:
```json
{
    "body": "<a id='comment:41'></a>\nno problem, errare humanum est. I hope that I have not have sound rude..\n\nI will handle the restoration",
    "created_at": "2021-02-03T19:49:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602908",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:41'></a>
no problem, errare humanum est. I hope that I have not have sound rude..

I will handle the restoration



---

archive/issue_comments_602909.json:
```json
{
    "body": "Changing dependencies from \"#31313\" to \"\"",
    "created_at": "2021-02-03T19:51:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602909",
    "user": "https://github.com/fchapoton"
}
```

Changing dependencies from "#31313" to ""



---

archive/issue_comments_602910.json:
```json
{
    "body": "Changing commit from \"d10c62d4354e6e722b857e43f92a39e1f745be67\" to \"c40efe9f4b94adf9dffd778bbc68fdac997929e1\"",
    "created_at": "2021-02-03T19:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602910",
    "user": "https://github.com/fchapoton"
}
```

Changing commit from "d10c62d4354e6e722b857e43f92a39e1f745be67" to "c40efe9f4b94adf9dffd778bbc68fdac997929e1"



---

archive/issue_comments_602911.json:
```json
{
    "body": "<a id='comment:43'></a>\n`@`vbraun\n\nthe new correct branch name is \"public/quadrangles_restored\"",
    "created_at": "2021-02-03T19:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602911",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:43'></a>
`@`vbraun

the new correct branch name is "public/quadrangles_restored"



---

archive/issue_comments_602912.json:
```json
{
    "body": "Changing branch from \"public/combinat/30517\" to \"public/quadrangles_restored\"",
    "created_at": "2021-02-03T19:54:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602912",
    "user": "https://github.com/fchapoton"
}
```

Changing branch from "public/combinat/30517" to "public/quadrangles_restored"



---

archive/issue_comments_602913.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-03T19:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602913",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_602914.json:
```json
{
    "body": "<a id='comment:44'></a>\nand I am setting back to positive",
    "created_at": "2021-02-03T19:54:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602914",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:44'></a>
and I am setting back to positive



---

archive/issue_comments_602915.json:
```json
{
    "body": "<a id='comment:45'></a>\nThanks for fixing this! I'm sorry to have made extra work for you.",
    "created_at": "2021-02-03T20:19:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602915",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:45'></a>
Thanks for fixing this! I'm sorry to have made extra work for you.



---

archive/issue_events_079294.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-02-07T19:40:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30517#event-79294"
}
```



---

archive/issue_comments_602916.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-02-07T19:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602916",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_602917.json:
```json
{
    "body": "Changing branch from \"public/quadrangles_restored\" to \"c40efe9f4b94adf9dffd778bbc68fdac997929e1\"",
    "created_at": "2021-02-07T19:40:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602917",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/quadrangles_restored" to "c40efe9f4b94adf9dffd778bbc68fdac997929e1"



---

archive/issue_comments_602918.json:
```json
{
    "body": "Changing author from \"Volker Braun, Frederic Chapoton\" to \"Volker Braun, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-05-09T23:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602918",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "Volker Braun, Frederic Chapoton" to "Volker Braun, Frédéric Chapoton"



---

archive/issue_comments_602919.json:
```json
{
    "body": "Changing commit from \"c40efe9f4b94adf9dffd778bbc68fdac997929e1\" to \"\"",
    "created_at": "2021-05-09T23:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30517",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30517#issuecomment-602919",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "c40efe9f4b94adf9dffd778bbc68fdac997929e1" to ""
