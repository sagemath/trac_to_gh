# Issue 30011: Remove sage_setup/fpickle_setup.py

archive/issues_029774.json:
```json
{
    "body": "The file `sage_setup/fpickle_setup.py` does not seem to be needed anymore, so remove it. This also removes some uses of `six` in `sage/setup.py`.\n\nCC:  @fchapoton @jhpalmieri\n\nBranch/Commit: 212d1833db7c11f01a36bab5551eac15763ec77a\n\nReviewer: Matthias Koeppe\n\nAuthor: John Palmieri\n\nDependencies: #29702\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30011\n\n",
    "closed_at": "2020-07-10T19:33:40Z",
    "created_at": "2020-06-28T16:20:54Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Remove sage_setup/fpickle_setup.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30011",
    "user": "https://github.com/mkoeppe"
}
```
The file `sage_setup/fpickle_setup.py` does not seem to be needed anymore, so remove it. This also removes some uses of `six` in `sage/setup.py`.

CC:  @fchapoton @jhpalmieri

Branch/Commit: 212d1833db7c11f01a36bab5551eac15763ec77a

Reviewer: Matthias Koeppe

Author: John Palmieri

Dependencies: #29702

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30011





---

archive/issue_comments_450918.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-03T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450918",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_450919.json:
```json
{
    "body": "<a id='comment:3'></a>Last 10 new commits:",
    "created_at": "2020-07-03T07:03:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450919",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Last 10 new commits:



---

archive/issue_comments_450920.json:
```json
{
    "body": "<a id='comment:4'></a>Just 1 commit on top of #29702",
    "created_at": "2020-07-03T07:04:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450920",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Just 1 commit on top of #29702



---

archive/issue_comments_450921.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+`sage_setup.docbuild` will be done on a separate ticket.\n \n Dependencies: #29702\n \n``````\n",
    "created_at": "2020-07-03T07:04:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450921",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+`sage_setup.docbuild` will be done on a separate ticket.
 
 Dependencies: #29702
 
``````




---

archive/issue_comments_450922.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+`sage_setup.docbuild` will be done on a separate ticket (#30010).\n \n Dependencies: #29702\n \n``````\n",
    "created_at": "2020-07-03T20:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450922",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+`sage_setup.docbuild` will be done on a separate ticket (#30010).
 
 Dependencies: #29702
 
``````




---

archive/issue_comments_450923.json:
```json
{
    "body": "<a id='comment:7'></a>A few questions: \n\n- can we accomplish the same thing by installing `twisted` (after having removed it in #29754), and then importing `twisted.persisted.styles`? That is, can we delete `fpickle_setup.py`?\n- if not, then should we update that file with the latest version from `twisted`, for py3 compatibility?\n\nTo be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.",
    "created_at": "2020-07-07T20:20:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450923",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:7'></a>A few questions: 

- can we accomplish the same thing by installing `twisted` (after having removed it in #29754), and then importing `twisted.persisted.styles`? That is, can we delete `fpickle_setup.py`?
- if not, then should we update that file with the latest version from `twisted`, for py3 compatibility?

To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.



---

archive/issue_comments_450924.json:
```json
{
    "body": "<a id='comment:8'></a>Maybe it's not worth it to install the most recent `twisted`, since it depends on a lot of other packages, most of which we don't install right now:\n\n```\nzope.interface>=4.4.2\nconstantly>=15.1\nincremental>=16.10.1\nAutomat>=0.3.0\nhyperlink>=17.1.1\nPyHamcrest!=1.10.0,>=1.9.0\nattrs>=19.2.0\n\n[all_non_platform]\npyopenssl>=16.0.0\nservice_identity>=18.1.0\nidna!=2.3,>=0.6\npyasn1\ncryptography>=2.5\nappdirs>=1.4.0\nbcrypt>=3.0.0\nsoappy\npyserial>=3.0\nh2<4.0,>=3.0\npriority<2.0,>=1.1.0\n```",
    "created_at": "2020-07-07T21:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450924",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:8'></a>Maybe it's not worth it to install the most recent `twisted`, since it depends on a lot of other packages, most of which we don't install right now:

```
zope.interface>=4.4.2
constantly>=15.1
incremental>=16.10.1
Automat>=0.3.0
hyperlink>=17.1.1
PyHamcrest!=1.10.0,>=1.9.0
attrs>=19.2.0

[all_non_platform]
pyopenssl>=16.0.0
service_identity>=18.1.0
idna!=2.3,>=0.6
pyasn1
cryptography>=2.5
appdirs>=1.4.0
bcrypt>=3.0.0
soappy
pyserial>=3.0
h2<4.0,>=3.0
priority<2.0,>=1.1.0
```



---

archive/issue_comments_450925.json:
```json
{
    "body": "<a id='comment:9'></a>Replying to [comment:7 jhpalmieri]:\n> To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.\n\n\nNeither do I.",
    "created_at": "2020-07-07T22:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450925",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Replying to [comment:7 jhpalmieri]:
> To be honest, I don't really know what `fpickle_setup.py` is supposed to do, or where it is tested in the Sage library, or what goes wrong if we remove its functionality.


Neither do I.



---

archive/issue_comments_450926.json:
```json
{
    "body": "<a id='comment:10'></a>I'm testing out an updated version of `fpickle_setup` from version 20.3.0 of twisted. If it passes tests, I'll push the branch here.",
    "created_at": "2020-07-07T22:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450926",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:10'></a>I'm testing out an updated version of `fpickle_setup` from version 20.3.0 of twisted. If it passes tests, I'll push the branch here.



---

archive/issue_comments_450927.json:
```json
{
    "body": "<a id='comment:11'></a>It worked with an updated version, but `make ptestlong` also passed with this change instead:\n\n```diff\ndiff --git a/src/setup.py b/src/setup.py\nindex 72c59ace71..9a41ce1535 100755\n--- a/src/setup.py\n+++ b/src/setup.py\n@@ -20,7 +20,7 @@ from sage_setup import excepthook\n sys.excepthook = excepthook\n \n # This import allows instancemethods to be pickable\n-import sage_setup.fpickle_setup\n+# import sage_setup.fpickle_setup\n \n #########################################################\n ### List of Extensions\n```\nSee #11874 for some information. I certainly don't see the failure there: comment:46, \"PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed\".\n\nShould we just get rid of `fpickle_setup.py` instead?",
    "created_at": "2020-07-08T01:10:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450927",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:11'></a>It worked with an updated version, but `make ptestlong` also passed with this change instead:

```diff
diff --git a/src/setup.py b/src/setup.py
index 72c59ace71..9a41ce1535 100755
--- a/src/setup.py
+++ b/src/setup.py
@@ -20,7 +20,7 @@ from sage_setup import excepthook
 sys.excepthook = excepthook
 
 # This import allows instancemethods to be pickable
-import sage_setup.fpickle_setup
+# import sage_setup.fpickle_setup
 
 #########################################################
 ### List of Extensions
```
See #11874 for some information. I certainly don't see the failure there: comment:46, "PicklingError: Can't pickle <type 'instancemethod'>: attribute lookup __builtin__.instancemethod failed".

Should we just get rid of `fpickle_setup.py` instead?



---

archive/issue_comments_450928.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 jhpalmieri]:\n> Should we just get rid of `fpickle_setup.py` instead?\n\n\nSounds good.",
    "created_at": "2020-07-08T01:46:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450928",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>Replying to [comment:11 jhpalmieri]:
> Should we just get rid of `fpickle_setup.py` instead?


Sounds good.



---

archive/issue_comments_450929.json:
```json
{
    "body": "<a id='comment:14'></a>New commits:",
    "created_at": "2020-07-08T02:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450929",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:14'></a>New commits:



---

archive/issue_comments_450930.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,4 @@\n-\n+The file `sage_setup/fpickle_setup.py` does not seem to be needed anymore, so remove it. This also removes some uses of `six` in `sage/setup.py`.\n \n Dependencies: #29702\n \n``````\n",
    "created_at": "2020-07-08T02:06:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450930",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,4 @@
-
+The file `sage_setup/fpickle_setup.py` does not seem to be needed anymore, so remove it. This also removes some uses of `six` in `sage/setup.py`.
 
 Dependencies: #29702
 
``````




---

archive/issue_comments_450931.json:
```json
{
    "body": "<a id='comment:15'></a>I am testing this with `fedora-28-standard`, which uses system python 3.6.5",
    "created_at": "2020-07-08T02:16:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450931",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>I am testing this with `fedora-28-standard`, which uses system python 3.6.5



---

archive/issue_comments_450932.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-08T05:13:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450932",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_events_077126.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-10T19:33:40Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30011#event-77126"
}
```



---

archive/issue_comments_450933.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-10T19:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30011",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30011#issuecomment-450933",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
