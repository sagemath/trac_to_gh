# Issue 30784: sage.matrix: Resolve circular imports without using __init__.py

archive/issues_030547.json:
```json
{
    "body": "This is preparation for making `sage.matrix` a namespace package in #28925.\n\n\nCC:  simonking @tscrim @tobiasdiez @videlec @kiwifb\n\nBranch/Commit: ea0d15a3d546c76a902a37c0db1d09ae54c5f3d9\n\nReviewer: Fran\u00e7ois Bissey\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30784\n\n",
    "closed_at": "2020-11-22T15:06:37Z",
    "created_at": "2020-10-17T16:39:43Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "sage.matrix: Resolve circular imports without using __init__.py",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30784",
    "user": "https://github.com/mkoeppe"
}
```
This is preparation for making `sage.matrix` a namespace package in #28925.


CC:  simonking @tscrim @tobiasdiez @videlec @kiwifb

Branch/Commit: ea0d15a3d546c76a902a37c0db1d09ae54c5f3d9

Reviewer: Fran√ßois Bissey

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30784





---

archive/issue_comments_465364.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,5 @@\n-This is preparation for making sage.matrix a namespace package in #28925.\n+This is preparation for making `sage.matrix` a namespace package in #28925.\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-10-17T17:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465364",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,5 @@
-This is preparation for making sage.matrix a namespace package in #28925.
+This is preparation for making `sage.matrix` a namespace package in #28925.
+
 
 Comment: 1
 
```




---

archive/issue_comments_465365.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-10-17T17:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465365",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_465366.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-17T17:01:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465366",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465367.json:
```json
{
    "body": "<a id='comment:3'></a>What's the advantage of using global variables? I think python is also caching the imported module under the hood (https://docs.python.org/3/reference/import.html#the-module-cache).",
    "created_at": "2020-10-17T18:58:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465367",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:3'></a>What's the advantage of using global variables? I think python is also caching the imported module under the hood (https://docs.python.org/3/reference/import.html#the-module-cache).



---

archive/issue_comments_465368.json:
```json
{
    "body": "<a id='comment:4'></a>I'm imitating existing code in Cython modules here, for example in `src/sage/matrix/matrix_double_dense.pyx` or `src/sage/rings/complex_mpc.pyx`. I have not timed it, but I would guess it has smaller overhead than the import mechanism.",
    "created_at": "2020-10-17T19:01:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465368",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>I'm imitating existing code in Cython modules here, for example in `src/sage/matrix/matrix_double_dense.pyx` or `src/sage/rings/complex_mpc.pyx`. I have not timed it, but I would guess it has smaller overhead than the import mechanism.



---

archive/issue_comments_465369.json:
```json
{
    "body": "<a id='comment:6'></a>Green patchbot, needs review. (One other patchbot fails with an unrelated error.)",
    "created_at": "2020-11-01T19:54:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465369",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Green patchbot, needs review. (One other patchbot fails with an unrelated error.)



---

archive/issue_comments_465370.json:
```json
{
    "body": "<a id='comment:7'></a>LGTM",
    "created_at": "2020-11-01T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465370",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:7'></a>LGTM



---

archive/issue_comments_465371.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-01T20:09:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465371",
    "user": "https://github.com/kiwifb"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_465372.json:
```json
{
    "body": "<a id='comment:8'></a>Thanks!",
    "created_at": "2020-11-01T20:36:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465372",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Thanks!



---

archive/issue_comments_465373.json:
```json
{
    "body": "<a id='comment:9'></a>Without double-checking I would guess that the python import cache is heavily optimized. But even given the minimal performance penalty, I would suggest to using a simple import in favor of the global variable. The latter is a possible source of bugs (devs forgetting to use import before using it) and heavily complicates the work of static type checking tools. But maybe I'm also missing some other advantages of this approach (`@`Francois).",
    "created_at": "2020-11-01T21:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465373",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:9'></a>Without double-checking I would guess that the python import cache is heavily optimized. But even given the minimal performance penalty, I would suggest to using a simple import in favor of the global variable. The latter is a possible source of bugs (devs forgetting to use import before using it) and heavily complicates the work of static type checking tools. But maybe I'm also missing some other advantages of this approach (`@`Francois).



---

archive/issue_comments_465374.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-22T15:06:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30784#issuecomment-465374",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080271.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-22T15:06:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30784",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30784#event-80271"
}
```
