# Issue 30375: Gather and clean up compiler flags

archive/issues_030138.json:
```json
{
    "assignees": [],
    "body": "We gather and clean up compiler flags. Also we\n\n- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)\n- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`\n- compile with `-Og -g` if `SAGE_DEBUG=yes`\n- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)\n- compile with `-O2 -g` otherwise (some packages with `O3` instead)\n\nDuring the build of Sage there are now flags that can be exported\nin `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`\netc. for each individual package, e.g. by\n\n- `export CFLAGS=$CFLAGS` (redundant, use flags as above)\n- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)\n- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)\n\nLikewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.\n\nWe try to respect the user's choice and do not overwrite the flags if already\nset by the user, but only add compile flags if necessary for packages to work.\n\nInidividual packages can still be compiled with specified flags or in debug mode using\n\n```\nmake CFLAGS=-O2 some-package\n```\nor\n\n```\nmake SAGE_DEBUG=\"yes\" some-package\n```\nThis ticket prepares #27122, which adds `-march=native` to the defaults.\n\n\nCC:  @slel @dimpase\n\nKeywords: **compile flags, sd111**\n\nBranch/Commit: **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Jonathan Kliem**\n\nComponent: **build**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30375_\n\n",
    "closed_at": "2020-12-13T20:30:47Z",
    "created_at": "2020-08-16T07:22:28Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Gather and clean up compiler flags",
    "type": "issue",
    "updated_at": "2020-12-13T20:30:47Z",
    "url": "https://github.com/sagemath/sage/issues/30375",
    "user": "https://github.com/kliem"
}
```
We gather and clean up compiler flags. Also we

- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)
- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`
- compile with `-Og -g` if `SAGE_DEBUG=yes`
- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)
- compile with `-O2 -g` otherwise (some packages with `O3` instead)

During the build of Sage there are now flags that can be exported
in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`
etc. for each individual package, e.g. by

- `export CFLAGS=$CFLAGS` (redundant, use flags as above)
- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)
- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)

Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.

We try to respect the user's choice and do not overwrite the flags if already
set by the user, but only add compile flags if necessary for packages to work.

Inidividual packages can still be compiled with specified flags or in debug mode using

```
make CFLAGS=-O2 some-package
```
or

```
make SAGE_DEBUG="yes" some-package
```
This ticket prepares #27122, which adds `-march=native` to the defaults.


CC:  @slel @dimpase

Keywords: **compile flags, sd111**

Branch/Commit: **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**

Reviewer: **Matthias Koeppe**

Author: **Jonathan Kliem**

Component: **build**

_Issue created by migration from https://trac.sagemath.org/ticket/30375_





---

archive/issue_events_415467.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:28Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415467"
}
```



---

archive/issue_events_415468.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build",
    "label_color": "0000b0",
    "label_name": "c: build",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415468"
}
```



---

archive/issue_events_415469.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415469"
}
```



---

archive/issue_events_415470.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:28Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415470"
}
```



---

archive/issue_events_415471.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415471"
}
```



---

archive/issue_events_415472.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415472"
}
```



---

archive/issue_events_415473.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415473"
}
```



---

archive/issue_comments_483305.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,28 +1,33 @@\n We gather and clean up compiler flags. Also we\n \n-    add --enable-fat-binary to configure (as an alternative to setting SAGE_FAT_BINARY)\n-    add --enable_debug={no|symbols|yes} as alternative to setting SAGE_DEBUG \n+- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)\n+- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`\n+- compile with `-Og -g` if `SAGE_DEBUG=yes`\n+- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)\n+- compile with `-O2 -g` otherwise (some packages with `O3` instead)\n \n-    compile with -Og -g if SAGE_DEBUG=yes\n-    compile with -O2 if SAGE_DEBUG=no (some packages with O3 instead)\n-    compile with -O2 -g otherwise (some packages with O3 instead) \n+During the build of Sage there are now flags that can be exported\n+in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`\n+etc. for each individual package, e.g. by\n \n-During the build of sage there are now flags that can be exported in spkg_install.in with one line, instead of checking SAGE_DEBUG etc. for each individual package, e.g. by\n+- `export CFLAGS=$CFLAGS` (redundant, use flags as above)\n+- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)\n+- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)\n \n-    export CFLAGS=$CFLAGS (redundant, use flags as above)\n-    export CFLAGS=$CFLAGS_O3 (O3 instead of O2, but only if not in debug mode)\n-    export CFLAGS=$ORIGINAL_CFLAGS (use $CFLAGS as set before configure) \n+Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.\n \n-Likewise we do with CXXFLAGS, FCFLAGS, F77FLAGS.\n-\n-We try to respect the users choice and do not overwrite the flags if already set by the user, but only add compile flags if necessary for packages to work.\n+We try to respect the user's choice and do not overwrite the flags if already\n+set by the user, but only add compile flags if necessary for packages to work.\n \n Inidividual packages can still be compiled with specified flags or in debug mode using\n \n+```\n make CFLAGS=-O2 some-package\n-\n+```\n or\n \n+```\n make SAGE_DEBUG=\"yes\" some-package\n+```\n+This ticket prepares #27122, which adds `-march=native` to the defaults.\n \n-This ticket prepares #27122, which adds `-march=native` to the defaults.\n``````\n",
    "created_at": "2020-08-16T07:45:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483305",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,28 +1,33 @@
 We gather and clean up compiler flags. Also we
 
-    add --enable-fat-binary to configure (as an alternative to setting SAGE_FAT_BINARY)
-    add --enable_debug={no|symbols|yes} as alternative to setting SAGE_DEBUG 
+- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)
+- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`
+- compile with `-Og -g` if `SAGE_DEBUG=yes`
+- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)
+- compile with `-O2 -g` otherwise (some packages with `O3` instead)
 
-    compile with -Og -g if SAGE_DEBUG=yes
-    compile with -O2 if SAGE_DEBUG=no (some packages with O3 instead)
-    compile with -O2 -g otherwise (some packages with O3 instead) 
+During the build of Sage there are now flags that can be exported
+in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`
+etc. for each individual package, e.g. by
 
-During the build of sage there are now flags that can be exported in spkg_install.in with one line, instead of checking SAGE_DEBUG etc. for each individual package, e.g. by
+- `export CFLAGS=$CFLAGS` (redundant, use flags as above)
+- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)
+- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)
 
-    export CFLAGS=$CFLAGS (redundant, use flags as above)
-    export CFLAGS=$CFLAGS_O3 (O3 instead of O2, but only if not in debug mode)
-    export CFLAGS=$ORIGINAL_CFLAGS (use $CFLAGS as set before configure) 
+Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.
 
-Likewise we do with CXXFLAGS, FCFLAGS, F77FLAGS.
-
-We try to respect the users choice and do not overwrite the flags if already set by the user, but only add compile flags if necessary for packages to work.
+We try to respect the user's choice and do not overwrite the flags if already
+set by the user, but only add compile flags if necessary for packages to work.
 
 Inidividual packages can still be compiled with specified flags or in debug mode using
 
+```
 make CFLAGS=-O2 some-package
-
+```
 or
 
+```
 make SAGE_DEBUG="yes" some-package
+```
+This ticket prepares #27122, which adds `-march=native` to the defaults.
 
-This ticket prepares #27122, which adds `-march=native` to the defaults.
``````




---

archive/issue_comments_483306.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nOne point that probably needs discussion is the following.\n\nWhen an spkg is built, the current design of `sage-spkg` is to create a self-contained script `spkg-install` that sets all necessary environment variables (by sourcing `sage-env` etc.). (This makes it relatively easy to debug the installation process.)\n\nMaking package installs depend on exported environment variables in `Makefile.in` breaks this design.\n\nIt would probably be better to create a new script `sage-build-env` (to complement `sage-build-env-config`) to take care of these environment variable settings.",
    "created_at": "2020-10-15T04:14:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483306",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

One point that probably needs discussion is the following.

When an spkg is built, the current design of `sage-spkg` is to create a self-contained script `spkg-install` that sets all necessary environment variables (by sourcing `sage-env` etc.). (This makes it relatively easy to debug the installation process.)

Making package installs depend on exported environment variables in `Makefile.in` breaks this design.

It would probably be better to create a new script `sage-build-env` (to complement `sage-build-env-config`) to take care of these environment variable settings.



---

archive/issue_comments_483307.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nOk, I think I'm beginning to understand.\n\nCreate a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?\n\nThen make sure `build/bin/sage-build-env` is added to the correct places?\n\nWhy should I not add the things to `build/bin/sage-build-env-config` directly?",
    "created_at": "2020-10-16T08:05:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483307",
    "user": "https://github.com/kliem"
}
```

<div id="comment:4" align="right">comment:4</div>

Ok, I think I'm beginning to understand.

Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?

Then make sure `build/bin/sage-build-env` is added to the correct places?

Why should I not add the things to `build/bin/sage-build-env-config` directly?



---

archive/issue_comments_483308.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@kliem](#comment:4):\n> Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?\n> \n> Then make sure `build/bin/sage-build-env` is added to the correct places?\n\nYes\n\n> Why should I not add the things to `build/bin/sage-build-env-config` directly?\n\nJust a suggestion, to keep the analogy to `src/bin/sage-env` (which implements some logic) and `src/bin/sage-env-config` (which purely sets some variables).  Not very important.",
    "created_at": "2020-10-16T22:32:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483308",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@kliem](#comment:4):
> Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?
> 
> Then make sure `build/bin/sage-build-env` is added to the correct places?

Yes

> Why should I not add the things to `build/bin/sage-build-env-config` directly?

Just a suggestion, to keep the analogy to `src/bin/sage-env` (which implements some logic) and `src/bin/sage-env-config` (which purely sets some variables).  Not very important.



---

archive/issue_comments_483309.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b\"><code>b6cf7c1</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>\n",
    "created_at": "2020-10-17T10:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483309",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b"><code>b6cf7c1</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>




---

archive/issue_comments_483310.json:
```json
{
    "body": "Changed commit from **[`2ff5630`](https://github.com/sagemath/sagetrac-mirror/commit/2ff56300b6ba53c0588f30e789f30108bf0fb179)** to **[`b6cf7c1`](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)**",
    "created_at": "2020-10-17T10:35:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483310",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2ff5630`](https://github.com/sagemath/sagetrac-mirror/commit/2ff56300b6ba53c0588f30e789f30108bf0fb179)** to **[`b6cf7c1`](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)**



---

archive/issue_comments_483311.json:
```json
{
    "body": "Changed commit from **[`b6cf7c1`](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)** to **[`5f4d0b1`](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)**",
    "created_at": "2020-10-18T08:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483311",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b6cf7c1`](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)** to **[`5f4d0b1`](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)**



---

archive/issue_comments_483312.json:
```json
{
    "body": "<div id=\"comment:7\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4\"><code>5f4d0b1</code></a></td><td><code>bash syntax again</code></td></tr></table>\n",
    "created_at": "2020-10-18T08:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483312",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:7"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4"><code>5f4d0b1</code></a></td><td><code>bash syntax again</code></td></tr></table>




---

archive/issue_comments_483313.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nI think I have mostly figured it out.\n\nBut it seems that this is no longer applied. If I configure with some `CFLAGS`, it seems that when making still the standard `CFLAGS` are applied. It is consistent with the `CFLAGS` in `sage -sh` at least.",
    "created_at": "2020-10-18T09:02:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483313",
    "user": "https://github.com/kliem"
}
```

<div id="comment:8" align="right">comment:8</div>

I think I have mostly figured it out.

But it seems that this is no longer applied. If I configure with some `CFLAGS`, it seems that when making still the standard `CFLAGS` are applied. It is consistent with the `CFLAGS` in `sage -sh` at least.



---

archive/issue_comments_483314.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289\"><code>a913bbd</code></a></td><td><code>correct detextion of empty values</code></td></tr></table>\n",
    "created_at": "2020-10-18T09:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483314",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289"><code>a913bbd</code></a></td><td><code>correct detextion of empty values</code></td></tr></table>




---

archive/issue_comments_483315.json:
```json
{
    "body": "Changed commit from **[`5f4d0b1`](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)** to **[`a913bbd`](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)**",
    "created_at": "2020-10-18T09:57:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483315",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5f4d0b1`](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)** to **[`a913bbd`](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)**



---

archive/issue_comments_483316.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nOk, seems to work now.\n\nAnd in the `sage -buildsh` this thing is run correctly.",
    "created_at": "2020-10-18T09:57:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483316",
    "user": "https://github.com/kliem"
}
```

<div id="comment:10" align="right">comment:10</div>

Ok, seems to work now.

And in the `sage -buildsh` this thing is run correctly.



---

archive/issue_comments_483317.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nLooking good; but I think `sage-build-env` would ideally not be a generated file but rather get its settings from `sage-build-env-config`.",
    "created_at": "2020-10-22T21:08:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483317",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Looking good; but I think `sage-build-env` would ideally not be a generated file but rather get its settings from `sage-build-env-config`.



---

archive/issue_comments_483318.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n(If both are generated, there is really no point in splitting into these two files)",
    "created_at": "2020-10-22T21:08:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483318",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

(If both are generated, there is really no point in splitting into these two files)



---

archive/issue_comments_483319.json:
```json
{
    "body": "Changed commit from **[`a913bbd`](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)** to **[`3b82fe9`](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)**",
    "created_at": "2020-10-26T13:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483319",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a913bbd`](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)** to **[`3b82fe9`](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)**



---

archive/issue_comments_483320.json:
```json
{
    "body": "<div id=\"comment:13\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec\"><code>3b82fe9</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>\n",
    "created_at": "2020-10-26T13:44:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483320",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:13"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec"><code>3b82fe9</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>




---

archive/issue_comments_483321.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7\"><code>d979c22</code></a></td><td><code>do not generate `sage-build-env`; respect environment settings at make time</code></td></tr></table>\n",
    "created_at": "2020-10-26T17:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483321",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7"><code>d979c22</code></a></td><td><code>do not generate `sage-build-env`; respect environment settings at make time</code></td></tr></table>




---

archive/issue_comments_483322.json:
```json
{
    "body": "Changed commit from **[`3b82fe9`](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)** to **[`d979c22`](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)**",
    "created_at": "2020-10-26T17:09:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483322",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3b82fe9`](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)** to **[`d979c22`](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)**



---

archive/issue_comments_483323.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nWould it not be cleaner if instead of\n\n```\n+# The configured compilation flags.\n+if [ \"x$CFLAGS\" == \"x\" ]; then\n+    export CFLAGS=\"@ORIGINAL_CFLAGS@\"\n+fi\n```\nin `build-env-config`, you would unconditionally set a variable `ORIGINAL_CFLAGS`?",
    "created_at": "2020-10-27T02:33:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483323",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:15" align="right">comment:15</div>

Would it not be cleaner if instead of

```
+# The configured compilation flags.
+if [ "x$CFLAGS" == "x" ]; then
+    export CFLAGS="@ORIGINAL_CFLAGS@"
+fi
```
in `build-env-config`, you would unconditionally set a variable `ORIGINAL_CFLAGS`?



---

archive/issue_comments_483324.json:
```json
{
    "body": "<div id=\"comment:16\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f\"><code>e898e33</code></a></td><td><code>more natural naming</code></td></tr></table>\n",
    "created_at": "2020-10-27T08:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483324",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:16"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f"><code>e898e33</code></a></td><td><code>more natural naming</code></td></tr></table>




---

archive/issue_comments_483325.json:
```json
{
    "body": "Changed commit from **[`d979c22`](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)** to **[`e898e33`](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)**",
    "created_at": "2020-10-27T08:23:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483325",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d979c22`](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)** to **[`e898e33`](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)**



---

archive/issue_comments_483326.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI don't understand anything at this point anymore.\n\n- \n\n```\n$ export CFLAGS='-march=native'\n$ export CXXFLAGS='-O1'\n$ ./configure\n$ sage --buildsh\necho $CFLAGS\n-march=native\necho $CXXFLAGS\n-O1\n```\n  Okay, this is exactly what we want. But \n\n```\nexport CFLAGS='-march=native'\n./configure CXXFLAGS='-O1'\nsage --buildsh\necho $CFLAGS\n-march=native\necho $CXXFLAGS\n-march=native\n```\n  Why? `build/bin/sage-build-env-config` was configured exactly the same. However, if you `echo $CXXFLAGS` at the start of `build/bin/sage-build-env/config`, you see that `CXXFLAGS` was already set to `-march=native`. Were does this come from?\n\n- At the moment I overwrite `CFLAGS` etc. conditionally so that a user may run `make CFLAGS='-Og' <some package>`. `ORIGINAL_CFLAGS` should be the same as this value in this case, shouldn't it (and all other related values as well: `CFLAGS_O3` etc). Any package may choose any such environment variable and append flags, but should never discard flags the user handed in.\n\n  It is really confusing however, that the exported stuff at configure time is called `ORIGINAL_CFLAGS`, as `@CFLAGS@` already tells us that this is from configure time. I changed that.\n \n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f\"><code>e898e33</code></a></td><td><code>more natural naming</code></td></tr></table>\n",
    "created_at": "2020-10-27T08:24:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483326",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

I don't understand anything at this point anymore.

- 

```
$ export CFLAGS='-march=native'
$ export CXXFLAGS='-O1'
$ ./configure
$ sage --buildsh
echo $CFLAGS
-march=native
echo $CXXFLAGS
-O1
```
  Okay, this is exactly what we want. But 

```
export CFLAGS='-march=native'
./configure CXXFLAGS='-O1'
sage --buildsh
echo $CFLAGS
-march=native
echo $CXXFLAGS
-march=native
```
  Why? `build/bin/sage-build-env-config` was configured exactly the same. However, if you `echo $CXXFLAGS` at the start of `build/bin/sage-build-env/config`, you see that `CXXFLAGS` was already set to `-march=native`. Were does this come from?

- At the moment I overwrite `CFLAGS` etc. conditionally so that a user may run `make CFLAGS='-Og' <some package>`. `ORIGINAL_CFLAGS` should be the same as this value in this case, shouldn't it (and all other related values as well: `CFLAGS_O3` etc). Any package may choose any such environment variable and append flags, but should never discard flags the user handed in.

  It is really confusing however, that the exported stuff at configure time is called `ORIGINAL_CFLAGS`, as `@CFLAGS@` already tells us that this is from configure time. I changed that.
 
---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f"><code>e898e33</code></a></td><td><code>more natural naming</code></td></tr></table>




---

archive/issue_comments_483327.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nNote that also `sage-env` and `sage-env-config` are sourced.",
    "created_at": "2020-10-27T17:50:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483327",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Note that also `sage-env` and `sage-env-config` are sourced.



---

archive/issue_comments_483328.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nShall we try to get this into 9.3...?",
    "created_at": "2020-11-11T17:39:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483328",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Shall we try to get this into 9.3...?



---

archive/issue_comments_483329.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nYes, please.\n\nHowever, I might need some help.",
    "created_at": "2020-11-12T07:48:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483329",
    "user": "https://github.com/kliem"
}
```

<div id="comment:20" align="right">comment:20</div>

Yes, please.

However, I might need some help.



---

archive/issue_comments_483330.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nA suggestion: \n\nSet similar shell variables in `build/bin/sage-build-env-config.in` that are set in `src/bin/sage-env-config.in`:\n\n```\nCONFIGURED_CC=\"@CC@\"\nCONFIGURED_CXX=\"@CXX@\"\nCONFIGURED_FC=\"@FC@\"\nCONFIGURED_OBJC=\"@OBJC@\"\nCONFIGURED_OBJCXX=\"@OBJCXX@\"\n```\nand move all code for modifying environment variables such as CFLAGS to one place, `build/bin/sage-build-env`...",
    "created_at": "2020-11-12T19:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483330",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

A suggestion: 

Set similar shell variables in `build/bin/sage-build-env-config.in` that are set in `src/bin/sage-env-config.in`:

```
CONFIGURED_CC="@CC@"
CONFIGURED_CXX="@CXX@"
CONFIGURED_FC="@FC@"
CONFIGURED_OBJC="@OBJC@"
CONFIGURED_OBJCXX="@OBJCXX@"
```
and move all code for modifying environment variables such as CFLAGS to one place, `build/bin/sage-build-env`...



---

archive/issue_comments_483331.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf\"><code>908ded5</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_reb</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:09:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483331",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf"><code>908ded5</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_reb</code></td></tr></table>




---

archive/issue_comments_483332.json:
```json
{
    "body": "Changed commit from **[`e898e33`](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)** to **[`908ded5`](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)**",
    "created_at": "2020-11-13T14:09:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483332",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e898e33`](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)** to **[`908ded5`](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)**



---

archive/issue_comments_483333.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nMerged into develop.",
    "created_at": "2020-11-13T14:09:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483333",
    "user": "https://github.com/kliem"
}
```

<div id="comment:23" align="right">comment:23</div>

Merged into develop.



---

archive/issue_comments_483334.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nShould I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.\n\nThe only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.",
    "created_at": "2020-11-13T14:11:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483334",
    "user": "https://github.com/kliem"
}
```

<div id="comment:24" align="right">comment:24</div>

Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.

The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.



---

archive/issue_comments_483335.json:
```json
{
    "body": "Changed commit from **[`908ded5`](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)** to **[`77bc743`](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)**",
    "created_at": "2020-11-13T14:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483335",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`908ded5`](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)** to **[`77bc743`](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)**



---

archive/issue_comments_483336.json:
```json
{
    "body": "<div id=\"comment:25\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d\"><code>77bc743</code></a></td><td><code>move all logic to buil/bin/sage-build-env</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:31:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483336",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:25"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d"><code>77bc743</code></a></td><td><code>move all logic to buil/bin/sage-build-env</code></td></tr></table>




---

archive/issue_comments_483337.json:
```json
{
    "body": "Changed commit from **[`77bc743`](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)** to **[`e2023d2`](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)**",
    "created_at": "2020-11-13T14:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483337",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`77bc743`](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)** to **[`e2023d2`](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)**



---

archive/issue_comments_483338.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018\"><code>e2023d2</code></a></td><td><code>removed message in gcc/spkg-configure.m4</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:35:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483338",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018"><code>e2023d2</code></a></td><td><code>removed message in gcc/spkg-configure.m4</code></td></tr></table>




---

archive/issue_comments_483339.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@kliem](#comment:24):\n> Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.\n> \n> The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.\n\nOk, I just went ahead an did this. It's a lot simpler now. Almost everything is at one place.\n`configure.ac` needs to save the flags and `build/bin/sage-build-env-config.in` picks them up again as `CONFIGURED_CFLAGS` etc.",
    "created_at": "2020-11-13T14:37:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483339",
    "user": "https://github.com/kliem"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@kliem](#comment:24):
> Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.
> 
> The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.

Ok, I just went ahead an did this. It's a lot simpler now. Almost everything is at one place.
`configure.ac` needs to save the flags and `build/bin/sage-build-env-config.in` picks them up again as `CONFIGURED_CFLAGS` etc.



---

archive/issue_events_415474.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T22:26:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415474"
}
```



---

archive/issue_events_415475.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T22:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415475"
}
```



---

archive/issue_comments_483340.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nThis looks great but I think you'll need to modify `build/bin/sage-spkg` as well so that the install scripts for normal packages source `sage-build-env`.",
    "created_at": "2020-11-29T22:26:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483340",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

This looks great but I think you'll need to modify `build/bin/sage-spkg` as well so that the install scripts for normal packages source `sage-build-env`.



---

archive/issue_comments_483341.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nAlso, in `sage-build-env`, remove spaces around `=` in `export` -- this is not valid shell syntax",
    "created_at": "2020-11-29T22:57:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483341",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:29" align="right">comment:29</div>

Also, in `sage-build-env`, remove spaces around `=` in `export` -- this is not valid shell syntax



---

archive/issue_comments_483342.json:
```json
{
    "body": "Changed commit from **[`e2023d2`](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)** to **[`098ca15`](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)**",
    "created_at": "2020-11-30T08:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483342",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`e2023d2`](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)** to **[`098ca15`](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)**



---

archive/issue_comments_483343.json:
```json
{
    "body": "<div id=\"comment:30\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e\"><code>098ca15</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:06:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483343",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:30"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e"><code>098ca15</code></a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags</code></td></tr></table>




---

archive/issue_comments_483344.json:
```json
{
    "body": "Changed commit from **[`098ca15`](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)** to **[`9c5e8a2`](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)**",
    "created_at": "2020-11-30T08:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483344",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`098ca15`](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)** to **[`9c5e8a2`](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)**



---

archive/issue_comments_483345.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e5b1110ed267f13b7e41cbb1ba04a86113a3a3\"><code>b6e5b11</code></a></td><td><code>fixed shell syntax</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/431d14ce9603452194a366c5fec6c9295fae1b20\"><code>431d14c</code></a></td><td><code>source in sage-spkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747\"><code>9c5e8a2</code></a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:24:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483345",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e5b1110ed267f13b7e41cbb1ba04a86113a3a3"><code>b6e5b11</code></a></td><td><code>fixed shell syntax</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/431d14ce9603452194a366c5fec6c9295fae1b20"><code>431d14c</code></a></td><td><code>source in sage-spkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747"><code>9c5e8a2</code></a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr></table>




---

archive/issue_comments_483346.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc\"><code>4b8933b</code></a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483346",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc"><code>4b8933b</code></a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr></table>




---

archive/issue_comments_483347.json:
```json
{
    "body": "Changed commit from **[`9c5e8a2`](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)** to **[`4b8933b`](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)**",
    "created_at": "2020-11-30T08:30:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483347",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9c5e8a2`](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)** to **[`4b8933b`](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)**



---

archive/issue_events_415476.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T08:30:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415476"
}
```



---

archive/issue_events_415477.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T08:30:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415477"
}
```



---

archive/issue_comments_483348.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\n`sage-build-env` and `sage-build-env-config` are in `build/bin`, not `src/bin`. They should not be listed in `src/setup.py`, `build/pkgs/sagelib/src/setup.py`.",
    "created_at": "2020-11-30T16:44:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483348",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:34" align="right">comment:34</div>

`sage-build-env` and `sage-build-env-config` are in `build/bin`, not `src/bin`. They should not be listed in `src/setup.py`, `build/pkgs/sagelib/src/setup.py`.



---

archive/issue_comments_483349.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAlso the comments in `build/make/Makefile.in` introduce the wrong path - it should be build/bin",
    "created_at": "2020-11-30T16:45:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483349",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

Also the comments in `build/make/Makefile.in` introduce the wrong path - it should be build/bin



---

archive/issue_events_415478.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T16:45:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415478"
}
```



---

archive/issue_events_415479.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T16:45:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415479"
}
```



---

archive/issue_comments_483350.json:
```json
{
    "body": "<div id=\"comment:37\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694\"><code>071b8cc</code></a></td><td><code>Revert \"add references to `bin/sage-build-env` and `bin/sage-build-env-config`\"</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483350",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:37"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694"><code>071b8cc</code></a></td><td><code>Revert "add references to `bin/sage-build-env` and `bin/sage-build-env-config`"</code></td></tr></table>




---

archive/issue_comments_483351.json:
```json
{
    "body": "Changed commit from **[`4b8933b`](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)** to **[`071b8cc`](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)**",
    "created_at": "2020-11-30T17:01:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483351",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4b8933b`](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)** to **[`071b8cc`](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)**



---

archive/issue_comments_483352.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6\"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483352",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr></table>




---

archive/issue_comments_483353.json:
```json
{
    "body": "Changed commit from **[`071b8cc`](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)** to **[`c51e752`](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)**",
    "created_at": "2020-11-30T17:04:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483353",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`071b8cc`](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)** to **[`c51e752`](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)**



---

archive/issue_events_415480.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T17:04:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415480"
}
```



---

archive/issue_events_415481.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T17:04:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415481"
}
```



---

archive/issue_comments_483354.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nSorry, I got confused.\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6\"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:04:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483354",
    "user": "https://github.com/kliem"
}
```

<div id="comment:39" align="right">comment:39</div>

Sorry, I got confused.

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6"><code>c51e752</code></a></td><td><code>correct comments to makefile</code></td></tr></table>




---

archive/issue_comments_483355.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-11-30T22:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483355",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_415482.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T22:31:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415482"
}
```



---

archive/issue_events_415483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T22:31:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415483"
}
```



---

archive/issue_comments_483356.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThis seems to work well.\n\nLet's get this merged for wider testing by developers.",
    "created_at": "2020-11-30T22:31:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483356",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

This seems to work well.

Let's get this merged for wider testing by developers.



---

archive/issue_comments_483357.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nThank you.",
    "created_at": "2020-12-01T07:01:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483357",
    "user": "https://github.com/kliem"
}
```

<div id="comment:41" align="right">comment:41</div>

Thank you.



---

archive/issue_comments_483358.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nOne thing is actually strange.\n\nI guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.\n\nI didn't consider this, so efficiently `-O2 -g` isn't added anymore.",
    "created_at": "2020-12-03T10:17:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483358",
    "user": "https://github.com/kliem"
}
```

<div id="comment:42" align="right">comment:42</div>

One thing is actually strange.

I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.

I didn't consider this, so efficiently `-O2 -g` isn't added anymore.



---

archive/issue_comments_483359.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nReplying to [@kliem](#comment:42):\n> One thing is actually strange.\n> \n> I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.\n> \n> I didn't consider this, so efficiently `-O2 -g` isn't added anymore.\n\nAnyway, I fixed that in #27122, but can also fix it here, if that makes sense.",
    "created_at": "2020-12-03T10:32:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483359",
    "user": "https://github.com/kliem"
}
```

<div id="comment:43" align="right">comment:43</div>

Replying to [@kliem](#comment:42):
> One thing is actually strange.
> 
> I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.
> 
> I didn't consider this, so efficiently `-O2 -g` isn't added anymore.

Anyway, I fixed that in #27122, but can also fix it here, if that makes sense.



---

archive/issue_events_415484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-03T16:30:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415484"
}
```



---

archive/issue_events_415485.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-03T16:30:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415485"
}
```



---

archive/issue_comments_483360.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nBest to fix it here already",
    "created_at": "2020-12-03T16:30:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483360",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Best to fix it here already



---

archive/issue_comments_483361.json:
```json
{
    "body": "<div id=\"comment:45\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91\"><code>aa7ecd6</code></a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr></table>\n",
    "created_at": "2020-12-03T17:51:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483361",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:45"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91"><code>aa7ecd6</code></a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr></table>




---

archive/issue_comments_483362.json:
```json
{
    "body": "Changed commit from **[`c51e752`](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)** to **[`aa7ecd6`](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)**",
    "created_at": "2020-12-03T17:51:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483362",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c51e752`](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)** to **[`aa7ecd6`](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)**



---

archive/issue_events_415486.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-03T17:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415486"
}
```



---

archive/issue_events_415487.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-03T17:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415487"
}
```



---

archive/issue_comments_483363.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nI'm not sure if I like this fix...",
    "created_at": "2020-12-03T18:05:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483363",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:47" align="right">comment:47</div>

I'm not sure if I like this fix...



---

archive/issue_comments_483364.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nIt works. But it's probably not perfect.\n\nIt appears that this is set by the gfortran configure. It is definitely in the compiled configure \n\n```\nfor ac_flag in none -ffree-form -FR -free -qfree -Mfree -Mfreeform\n```\n\nI suppose that is enforced by `AC_FC_FREEFORM` and will end up adding something to `FCFLAGS`.",
    "created_at": "2020-12-03T18:13:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483364",
    "user": "https://github.com/kliem"
}
```

<div id="comment:48" align="right">comment:48</div>

It works. But it's probably not perfect.

It appears that this is set by the gfortran configure. It is definitely in the compiled configure 

```
for ac_flag in none -ffree-form -FR -free -qfree -Mfree -Mfreeform
```

I suppose that is enforced by `AC_FC_FREEFORM` and will end up adding something to `FCFLAGS`.



---

archive/issue_comments_483365.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nI agree, that this solution changes behavior.\n\nCalling `AC_FC_FREEFORM` appends ` -ffree-form`. I don't know why. Do we want this or is this just for testing and we really should call `AC_SUBST(FCFLAGS)` before this?",
    "created_at": "2020-12-03T18:16:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483365",
    "user": "https://github.com/kliem"
}
```

<div id="comment:49" align="right">comment:49</div>

I agree, that this solution changes behavior.

Calling `AC_FC_FREEFORM` appends ` -ffree-form`. I don't know why. Do we want this or is this just for testing and we really should call `AC_SUBST(FCFLAGS)` before this?



---

archive/issue_comments_483366.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI think we shouldn't pass on the `FCFLAGS` discovered by this to avoid subtle change of behavior. The individual packages are in charge of figuring out the flags that they need for the Fortran compiler.\n\nSo I think it's best to save and restore the flags around the spkg-configure code",
    "created_at": "2020-12-03T18:29:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483366",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:50" align="right">comment:50</div>

I think we shouldn't pass on the `FCFLAGS` discovered by this to avoid subtle change of behavior. The individual packages are in charge of figuring out the flags that they need for the Fortran compiler.

So I think it's best to save and restore the flags around the spkg-configure code



---

archive/issue_comments_483367.json:
```json
{
    "body": "<div id=\"comment:51\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e\"><code>94326db</code></a></td><td><code>better solution for dealing with -ffree-form</code></td></tr></table>\n",
    "created_at": "2020-12-03T18:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:51"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e"><code>94326db</code></a></td><td><code>better solution for dealing with -ffree-form</code></td></tr></table>




---

archive/issue_comments_483368.json:
```json
{
    "body": "Changed commit from **[`aa7ecd6`](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)** to **[`94326db`](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)**",
    "created_at": "2020-12-03T18:35:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483368",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aa7ecd6`](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)** to **[`94326db`](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)**



---

archive/issue_comments_483369.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nActually, replacing `AC_SUBST(FCFLAGS, \"$FCFLAGS\")` by `AC_SUBST(CONFIGURED_FCFLAGS, \"$FCFLAGS\")`, does the job.\n\nApparently this is somewhat split into two. First we set `FCFLAGS=$FLAGS` and later the substitution is triggered. So any changes that are applied later to `FCFLAGS` will still have an effect, but not if we change the name.\n\nNow that apparently the `gfortran` configure changes `FCLFAGS` is a different story.",
    "created_at": "2020-12-03T18:39:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483369",
    "user": "https://github.com/kliem"
}
```

<div id="comment:52" align="right">comment:52</div>

Actually, replacing `AC_SUBST(FCFLAGS, "$FCFLAGS")` by `AC_SUBST(CONFIGURED_FCFLAGS, "$FCFLAGS")`, does the job.

Apparently this is somewhat split into two. First we set `FCFLAGS=$FLAGS` and later the substitution is triggered. So any changes that are applied later to `FCFLAGS` will still have an effect, but not if we change the name.

Now that apparently the `gfortran` configure changes `FCLFAGS` is a different story.



---

archive/issue_comments_483370.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nNote that `FCFLAGS` is automatically `AC_SUBST`'ed as well:\n\n```\n$ grep FCFLAGS config.status\nac_cs_config=\"'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g'\"\n  set X /bin/sh './configure'  'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g' $ac_configure_extra_args --no-create --no-recursion\nS[\"FCFLAGS\"]=\"-g -g -g -ffree-form\"\nS[\"CONFIGURED_FCFLAGS\"]=\"-g -g -g\"\n```\nI would much prefer the solution using save/restore of flags instead of introducing a new substitution variable. This would keep things closer to automake.",
    "created_at": "2020-12-03T19:10:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483370",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

Note that `FCFLAGS` is automatically `AC_SUBST`'ed as well:

```
$ grep FCFLAGS config.status
ac_cs_config="'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g'"
  set X /bin/sh './configure'  'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g' $ac_configure_extra_args --no-create --no-recursion
S["FCFLAGS"]="-g -g -g -ffree-form"
S["CONFIGURED_FCFLAGS"]="-g -g -g"
```
I would much prefer the solution using save/restore of flags instead of introducing a new substitution variable. This would keep things closer to automake.



---

archive/issue_comments_483371.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nFrom https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html\n\n> The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. \n\nSo, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.\n\nIf we want to respect this (starting with this ticket), what do you think would be the best way? Somehow I must store that `FCFLAGS` wasn't set by the user and I may add our defaults to this.",
    "created_at": "2020-12-03T19:24:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483371",
    "user": "https://github.com/kliem"
}
```

<div id="comment:54" align="right">comment:54</div>

From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html

> The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. 

So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.

If we want to respect this (starting with this ticket), what do you think would be the best way? Somehow I must store that `FCFLAGS` wasn't set by the user and I may add our defaults to this.



---

archive/issue_comments_483372.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nReplying to [@kliem](#comment:54):\n> From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html\n> \n> > The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. \n\n> \n> So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.\n\nWe run this to find out whether the configured Fortran compiler has a free form mode.\n\nWe do this for our decision whether we have to install gfortran or not.\n\nBut it must be up to the individual packages how they invoke the Fortran compiler.",
    "created_at": "2020-12-03T19:27:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483372",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Replying to [@kliem](#comment:54):
> From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html
> 
> > The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. 

> 
> So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.

We run this to find out whether the configured Fortran compiler has a free form mode.

We do this for our decision whether we have to install gfortran or not.

But it must be up to the individual packages how they invoke the Fortran compiler.



---

archive/issue_comments_483373.json:
```json
{
    "body": "<div id=\"comment:56\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4\"><code>87dae61</code></a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr></table>\n",
    "created_at": "2020-12-03T20:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483373",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:56"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4"><code>87dae61</code></a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr></table>




---

archive/issue_comments_483374.json:
```json
{
    "body": "Changed commit from **[`94326db`](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)** to **[`87dae61`](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)**",
    "created_at": "2020-12-03T20:05:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483374",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`94326db`](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)** to **[`87dae61`](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)**



---

archive/issue_comments_483375.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nOk. I'm storing and restoring the `FCFLAGS` during gfortran configure now.\nDefining a macro was the only way, I could enforce the order. But maybe there is a better way of doing this.",
    "created_at": "2020-12-03T20:07:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483375",
    "user": "https://github.com/kliem"
}
```

<div id="comment:57" align="right">comment:57</div>

Ok. I'm storing and restoring the `FCFLAGS` during gfortran configure now.
Defining a macro was the only way, I could enforce the order. But maybe there is a better way of doing this.



---

archive/issue_comments_483376.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nThat's fine, yes, `AC_FC_FREEFORM` is executed out of order.\n\nThese lines:\n\n```\n+    sage_saved_fcflags=$FCFLAGS\n+    FCFLAGS=$sage_saved_fcflags\n```\nneed quoting around the assigned value.",
    "created_at": "2020-12-03T22:19:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483376",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:58" align="right">comment:58</div>

That's fine, yes, `AC_FC_FREEFORM` is executed out of order.

These lines:

```
+    sage_saved_fcflags=$FCFLAGS
+    FCFLAGS=$sage_saved_fcflags
```
need quoting around the assigned value.



---

archive/issue_comments_483377.json:
```json
{
    "body": "<div id=\"comment:59\" align=\"right\">comment:59</div>\n\nAlso these macro calls are better without the use of the second argument (look at the generated shell code)\n\n```\n+# Save compiler flags as configured by the user.\n+AC_SUBST(CFLAGS, \"$CFLAGS\")\n+AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n+AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n+AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n```",
    "created_at": "2020-12-03T22:20:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483377",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:59" align="right">comment:59</div>

Also these macro calls are better without the use of the second argument (look at the generated shell code)

```
+# Save compiler flags as configured by the user.
+AC_SUBST(CFLAGS, "$CFLAGS")
+AC_SUBST(CXXFLAGS, "$CXXFLAGS")
+AC_SUBST(FCFLAGS, "$FCFLAGS")
+AC_SUBST(F77FLAGS, "$F77FLAGS")
```



---

archive/issue_comments_483378.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@mkoeppe](#comment:59):\n> Also these macro calls are better without the use of the second argument (look at the generated shell code)\n> \n> ```\n> +# Save compiler flags as configured by the user.\n> +AC_SUBST(CFLAGS, \"$CFLAGS\")\n> +AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n> +AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n> +AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n> ```\n\nYour proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, \"$CFLAGS\")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.",
    "created_at": "2020-12-04T07:33:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483378",
    "user": "https://github.com/kliem"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@mkoeppe](#comment:59):
> Also these macro calls are better without the use of the second argument (look at the generated shell code)
> 
> ```
> +# Save compiler flags as configured by the user.
> +AC_SUBST(CFLAGS, "$CFLAGS")
> +AC_SUBST(CXXFLAGS, "$CXXFLAGS")
> +AC_SUBST(FCFLAGS, "$FCFLAGS")
> +AC_SUBST(F77FLAGS, "$F77FLAGS")
> ```

Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, "$CFLAGS")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.



---

archive/issue_comments_483379.json:
```json
{
    "body": "Changed commit from **[`87dae61`](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)** to **[`7577dd4`](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)**",
    "created_at": "2020-12-04T07:34:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483379",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`87dae61`](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)** to **[`7577dd4`](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)**



---

archive/issue_comments_483380.json:
```json
{
    "body": "<div id=\"comment:61\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb\"><code>7577dd4</code></a></td><td><code>added quotes</code></td></tr></table>\n",
    "created_at": "2020-12-04T07:34:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483380",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:61"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb"><code>7577dd4</code></a></td><td><code>added quotes</code></td></tr></table>




---

archive/issue_comments_483381.json:
```json
{
    "body": "<div id=\"comment:62\" align=\"right\">comment:62</div>\n\nReplying to [@kliem](#comment:60):\n> Replying to [@mkoeppe](#comment:59):\n> > Also these macro calls are better without the use of the second argument (look at the generated shell code)\n> > \n> > ```\n> > +# Save compiler flags as configured by the user.\n> > +AC_SUBST(CFLAGS, \"$CFLAGS\")\n> > +AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n> > +AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n> > +AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n> > ```\n\n> \n> Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, \"$CFLAGS\")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.\n\nI could deal with it the same way, I did with the `FCFLAGS` and save all of those flags beforehand. Maybe that is cleaner.",
    "created_at": "2020-12-04T07:37:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483381",
    "user": "https://github.com/kliem"
}
```

<div id="comment:62" align="right">comment:62</div>

Replying to [@kliem](#comment:60):
> Replying to [@mkoeppe](#comment:59):
> > Also these macro calls are better without the use of the second argument (look at the generated shell code)
> > 
> > ```
> > +# Save compiler flags as configured by the user.
> > +AC_SUBST(CFLAGS, "$CFLAGS")
> > +AC_SUBST(CXXFLAGS, "$CXXFLAGS")
> > +AC_SUBST(FCFLAGS, "$FCFLAGS")
> > +AC_SUBST(F77FLAGS, "$F77FLAGS")
> > ```

> 
> Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, "$CFLAGS")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.

I could deal with it the same way, I did with the `FCFLAGS` and save all of those flags beforehand. Maybe that is cleaner.



---

archive/issue_comments_483382.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nMaybe we can take care of this.",
    "created_at": "2020-12-06T18:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483382",
    "user": "https://github.com/kliem"
}
```

<div id="comment:63" align="right">comment:63</div>

Maybe we can take care of this.



---

archive/issue_comments_483383.json:
```json
{
    "body": "Changed keywords from **compile flags** to **compile flags, sd111**",
    "created_at": "2020-12-06T18:39:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483383",
    "user": "https://github.com/kliem"
}
```

Changed keywords from **compile flags** to **compile flags, sd111**



---

archive/issue_events_415488.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-09T21:12:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415488"
}
```



---

archive/issue_events_415489.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-09T21:12:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415489"
}
```



---

archive/issue_comments_483384.json:
```json
{
    "body": "Work Issues: **make variables SAGE_DEBUG and SAGE_FAT_BINARY precious**",
    "created_at": "2020-12-09T21:12:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483384",
    "user": "https://github.com/kliem"
}
```

Work Issues: **make variables SAGE_DEBUG and SAGE_FAT_BINARY precious**



---

archive/issue_comments_483385.json:
```json
{
    "body": "<div id=\"comment:65\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7\"><code>3bb3099</code></a></td><td><code>prepare preciouos variables</code></td></tr></table>\n",
    "created_at": "2020-12-10T08:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483385",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:65"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7"><code>3bb3099</code></a></td><td><code>prepare preciouos variables</code></td></tr></table>




---

archive/issue_comments_483386.json:
```json
{
    "body": "Changed commit from **[`7577dd4`](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)** to **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**",
    "created_at": "2020-12-10T08:18:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483386",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`7577dd4`](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)** to **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**



---

archive/issue_events_415490.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-10T08:20:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415490"
}
```



---

archive/issue_events_415491.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-10T08:20:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415491"
}
```



---

archive/issue_comments_483387.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nOk, at least it is prepared for precious variables.\n\n#29507 would have to take care of using this.",
    "created_at": "2020-12-10T08:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483387",
    "user": "https://github.com/kliem"
}
```

<div id="comment:66" align="right">comment:66</div>

Ok, at least it is prepared for precious variables.

#29507 would have to take care of using this.



---

archive/issue_comments_483388.json:
```json
{
    "body": "Changed work issues from **make variables SAGE_DEBUG and SAGE_FAT_BINARY precious** to none",
    "created_at": "2020-12-10T08:20:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483388",
    "user": "https://github.com/kliem"
}
```

Changed work issues from **make variables SAGE_DEBUG and SAGE_FAT_BINARY precious** to none



---

archive/issue_comments_483389.json:
```json
{
    "body": "<div id=\"comment:67\" align=\"right\">comment:67</div>\n\nActually, it kind of works.\n\nDuring make, reconfiguration will be done using `./config.status` and this one does not alter the variables.",
    "created_at": "2020-12-10T08:33:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483389",
    "user": "https://github.com/kliem"
}
```

<div id="comment:67" align="right">comment:67</div>

Actually, it kind of works.

During make, reconfiguration will be done using `./config.status` and this one does not alter the variables.



---

archive/issue_comments_483390.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nLooking great, let's get this in.",
    "created_at": "2020-12-11T03:02:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483390",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

Looking great, let's get this in.



---

archive/issue_events_415492.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T03:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415492"
}
```



---

archive/issue_events_415493.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T03:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415493"
}
```



---

archive/issue_comments_483391.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nThanks again.",
    "created_at": "2020-12-11T07:02:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483391",
    "user": "https://github.com/kliem"
}
```

<div id="comment:69" align="right">comment:69</div>

Thanks again.



---

archive/issue_events_415494.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:30:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415494"
}
```



---

archive/issue_events_415495.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "494c975e8d18b96ea74b95301dd5e2c0cafd74f3",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-12-13T20:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30375#event-415495"
}
```



---

archive/issue_comments_483392.json:
```json
{
    "body": "Changed branch from **[u/gh-kliem/gather_and_clean_up_compile_flags](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/gather_and_clean_up_compile_flags)** to **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**",
    "created_at": "2020-12-13T20:30:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30375#issuecomment-483392",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-kliem/gather_and_clean_up_compile_flags](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/gather_and_clean_up_compile_flags)** to **[`3bb3099`](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)**
