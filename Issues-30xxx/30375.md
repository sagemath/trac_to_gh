# Issue 30375: Gather and clean up compiler flags

archive/issues_030138.json:
```json
{
    "body": "We gather and clean up compiler flags. Also we\n\n- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)\n- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`\n- compile with `-Og -g` if `SAGE_DEBUG=yes`\n- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)\n- compile with `-O2 -g` otherwise (some packages with `O3` instead)\n\nDuring the build of Sage there are now flags that can be exported\nin `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`\netc. for each individual package, e.g. by\n\n- `export CFLAGS=$CFLAGS` (redundant, use flags as above)\n- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)\n- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)\n\nLikewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.\n\nWe try to respect the user's choice and do not overwrite the flags if already\nset by the user, but only add compile flags if necessary for packages to work.\n\nInidividual packages can still be compiled with specified flags or in debug mode using\n\n```\nmake CFLAGS=-O2 some-package\n```\nor\n\n```\nmake SAGE_DEBUG=\"yes\" some-package\n```\nThis ticket prepares #27122, which adds `-march=native` to the defaults.\n\n\n**CC:**  @slel @dimpase\n\n**Keywords:** compile flags, sd111\n\n**Branch/Commit:** [3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)\n\n**Reviewer:** Matthias Koeppe\n\n**Author:** Jonathan Kliem\n\nIssue created by migration from https://trac.sagemath.org/ticket/30375\n\n",
    "closed_at": "2020-12-13T20:30:47Z",
    "created_at": "2020-08-16T07:22:28Z",
    "labels": [
        "component: build",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Gather and clean up compiler flags",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30375",
    "user": "https://github.com/kliem"
}
```
We gather and clean up compiler flags. Also we

- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)
- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`
- compile with `-Og -g` if `SAGE_DEBUG=yes`
- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)
- compile with `-O2 -g` otherwise (some packages with `O3` instead)

During the build of Sage there are now flags that can be exported
in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`
etc. for each individual package, e.g. by

- `export CFLAGS=$CFLAGS` (redundant, use flags as above)
- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)
- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)

Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.

We try to respect the user's choice and do not overwrite the flags if already
set by the user, but only add compile flags if necessary for packages to work.

Inidividual packages can still be compiled with specified flags or in debug mode using

```
make CFLAGS=-O2 some-package
```
or

```
make SAGE_DEBUG="yes" some-package
```
This ticket prepares #27122, which adds `-march=native` to the defaults.


**CC:**  @slel @dimpase

**Keywords:** compile flags, sd111

**Branch/Commit:** [3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)

**Reviewer:** Matthias Koeppe

**Author:** Jonathan Kliem

Issue created by migration from https://trac.sagemath.org/ticket/30375





---

archive/issue_events_276338.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276338"
}
```



---

archive/issue_events_276339.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276339"
}
```



---

archive/issue_events_276340.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-08-16T07:22:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276340"
}
```



---

archive/issue_comments_487746.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,28 +1,33 @@\n We gather and clean up compiler flags. Also we\n \n-    add --enable-fat-binary to configure (as an alternative to setting SAGE_FAT_BINARY)\n-    add --enable_debug={no|symbols|yes} as alternative to setting SAGE_DEBUG \n+- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)\n+- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`\n+- compile with `-Og -g` if `SAGE_DEBUG=yes`\n+- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)\n+- compile with `-O2 -g` otherwise (some packages with `O3` instead)\n \n-    compile with -Og -g if SAGE_DEBUG=yes\n-    compile with -O2 if SAGE_DEBUG=no (some packages with O3 instead)\n-    compile with -O2 -g otherwise (some packages with O3 instead) \n+During the build of Sage there are now flags that can be exported\n+in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`\n+etc. for each individual package, e.g. by\n \n-During the build of sage there are now flags that can be exported in spkg_install.in with one line, instead of checking SAGE_DEBUG etc. for each individual package, e.g. by\n+- `export CFLAGS=$CFLAGS` (redundant, use flags as above)\n+- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)\n+- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)\n \n-    export CFLAGS=$CFLAGS (redundant, use flags as above)\n-    export CFLAGS=$CFLAGS_O3 (O3 instead of O2, but only if not in debug mode)\n-    export CFLAGS=$ORIGINAL_CFLAGS (use $CFLAGS as set before configure) \n+Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.\n \n-Likewise we do with CXXFLAGS, FCFLAGS, F77FLAGS.\n-\n-We try to respect the users choice and do not overwrite the flags if already set by the user, but only add compile flags if necessary for packages to work.\n+We try to respect the user's choice and do not overwrite the flags if already\n+set by the user, but only add compile flags if necessary for packages to work.\n \n Inidividual packages can still be compiled with specified flags or in debug mode using\n \n+```\n make CFLAGS=-O2 some-package\n-\n+```\n or\n \n+```\n make SAGE_DEBUG=\"yes\" some-package\n+```\n+This ticket prepares #27122, which adds `-march=native` to the defaults.\n \n-This ticket prepares #27122, which adds `-march=native` to the defaults.\n``````\n",
    "created_at": "2020-08-16T07:45:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487746",
    "user": "https://github.com/slel"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,28 +1,33 @@
 We gather and clean up compiler flags. Also we
 
-    add --enable-fat-binary to configure (as an alternative to setting SAGE_FAT_BINARY)
-    add --enable_debug={no|symbols|yes} as alternative to setting SAGE_DEBUG 
+- add `--enable-fat-binary` to `configure` (as an alternative to setting `SAGE_FAT_BINARY`)
+- add `--enable_debug={no|symbols|yes}` as alternative to setting `SAGE_DEBUG`
+- compile with `-Og -g` if `SAGE_DEBUG=yes`
+- compile with `-O2` if `SAGE_DEBUG=no` (some packages with `O3` instead)
+- compile with `-O2 -g` otherwise (some packages with `O3` instead)
 
-    compile with -Og -g if SAGE_DEBUG=yes
-    compile with -O2 if SAGE_DEBUG=no (some packages with O3 instead)
-    compile with -O2 -g otherwise (some packages with O3 instead) 
+During the build of Sage there are now flags that can be exported
+in `spkg_install.in` with one line, instead of checking `SAGE_DEBUG`
+etc. for each individual package, e.g. by
 
-During the build of sage there are now flags that can be exported in spkg_install.in with one line, instead of checking SAGE_DEBUG etc. for each individual package, e.g. by
+- `export CFLAGS=$CFLAGS` (redundant, use flags as above)
+- `export CFLAGS=$CFLAGS_O3` (`O3` instead of `O2`, but only if not in debug mode)
+- `export CFLAGS=$ORIGINAL_CFLAGS` (use `$CFLAGS` as set before `configure`)
 
-    export CFLAGS=$CFLAGS (redundant, use flags as above)
-    export CFLAGS=$CFLAGS_O3 (O3 instead of O2, but only if not in debug mode)
-    export CFLAGS=$ORIGINAL_CFLAGS (use $CFLAGS as set before configure) 
+Likewise we do with `CXXFLAGS`, `FCFLAGS`, `F77FLAGS`.
 
-Likewise we do with CXXFLAGS, FCFLAGS, F77FLAGS.
-
-We try to respect the users choice and do not overwrite the flags if already set by the user, but only add compile flags if necessary for packages to work.
+We try to respect the user's choice and do not overwrite the flags if already
+set by the user, but only add compile flags if necessary for packages to work.
 
 Inidividual packages can still be compiled with specified flags or in debug mode using
 
+```
 make CFLAGS=-O2 some-package
-
+```
 or
 
+```
 make SAGE_DEBUG="yes" some-package
+```
+This ticket prepares #27122, which adds `-march=native` to the defaults.
 
-This ticket prepares #27122, which adds `-march=native` to the defaults.
``````




---

archive/issue_comments_487747.json:
```json
{
    "body": "<a id='comment:3'></a>\nOne point that probably needs discussion is the following.\n\nWhen an spkg is built, the current design of `sage-spkg` is to create a self-contained script `spkg-install` that sets all necessary environment variables (by sourcing `sage-env` etc.). (This makes it relatively easy to debug the installation process.)\n\nMaking package installs depend on exported environment variables in `Makefile.in` breaks this design.\n\nIt would probably be better to create a new script `sage-build-env` (to complement `sage-build-env-config`) to take care of these environment variable settings.",
    "created_at": "2020-10-15T04:14:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487747",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
One point that probably needs discussion is the following.

When an spkg is built, the current design of `sage-spkg` is to create a self-contained script `spkg-install` that sets all necessary environment variables (by sourcing `sage-env` etc.). (This makes it relatively easy to debug the installation process.)

Making package installs depend on exported environment variables in `Makefile.in` breaks this design.

It would probably be better to create a new script `sage-build-env` (to complement `sage-build-env-config`) to take care of these environment variable settings.



---

archive/issue_comments_487748.json:
```json
{
    "body": "<a id='comment:4'></a>\nOk, I think I'm beginning to understand.\n\nCreate a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?\n\nThen make sure `build/bin/sage-build-env` is added to the correct places?\n\nWhy should I not add the things to `build/bin/sage-build-env-config` directly?",
    "created_at": "2020-10-16T08:05:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487748",
    "user": "https://github.com/kliem"
}
```

<a id='comment:4'></a>
Ok, I think I'm beginning to understand.

Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?

Then make sure `build/bin/sage-build-env` is added to the correct places?

Why should I not add the things to `build/bin/sage-build-env-config` directly?



---

archive/issue_comments_487749.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [gh-kliem](#comment%3A4):\n> Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?\n> \n> Then make sure `build/bin/sage-build-env` is added to the correct places?\n\n\nYes\n\n> Why should I not add the things to `build/bin/sage-build-env-config` directly?\n\n\nJust a suggestion, to keep the analogy to `src/bin/sage-env` (which implements some logic) and `src/bin/sage-env-config` (which purely sets some variables).  Not very important.",
    "created_at": "2020-10-16T22:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487749",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [gh-kliem](#comment%3A4):
> Create a new file `build/bin/sage-build-env.in` and move the stuff that I added to the makefile there?
> 
> Then make sure `build/bin/sage-build-env` is added to the correct places?


Yes

> Why should I not add the things to `build/bin/sage-build-env-config` directly?


Just a suggestion, to keep the analogy to `src/bin/sage-env` (which implements some logic) and `src/bin/sage-env-config` (which purely sets some variables).  Not very important.



---

archive/issue_comments_487750.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b\">b6cf7c1</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>\n",
    "created_at": "2020-10-17T10:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b">b6cf7c1</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>




---

archive/issue_comments_487751.json:
```json
{
    "body": "**Changing commit** from \"[2ff56300b6ba53c0588f30e789f30108bf0fb179](https://github.com/sagemath/sagetrac-mirror/commit/2ff56300b6ba53c0588f30e789f30108bf0fb179)\" to \"[b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)\".",
    "created_at": "2020-10-17T10:35:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487751",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[2ff56300b6ba53c0588f30e789f30108bf0fb179](https://github.com/sagemath/sagetrac-mirror/commit/2ff56300b6ba53c0588f30e789f30108bf0fb179)" to "[b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)".



---

archive/issue_comments_487752.json:
```json
{
    "body": "**Changing commit** from \"[b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)\" to \"[5f4d0b1c9696ea47784348164c4832a5c51178e4](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)\".",
    "created_at": "2020-10-18T08:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b](https://github.com/sagemath/sagetrac-mirror/commit/b6cf7c1b6bc23828c26d77eb666d9e2e9661e43b)" to "[5f4d0b1c9696ea47784348164c4832a5c51178e4](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)".



---

archive/issue_comments_487753.json:
```json
{
    "body": "<a id='comment:7'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4\">5f4d0b1</a></td><td><code>bash syntax again</code></td></tr></table>\n",
    "created_at": "2020-10-18T08:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487753",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4">5f4d0b1</a></td><td><code>bash syntax again</code></td></tr></table>




---

archive/issue_comments_487754.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think I have mostly figured it out.\n\nBut it seems that this is no longer applied. If I configure with some `CFLAGS`, it seems that when making still the standard `CFLAGS` are applied. It is consistent with the `CFLAGS` in `sage -sh` at least.",
    "created_at": "2020-10-18T09:02:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487754",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
I think I have mostly figured it out.

But it seems that this is no longer applied. If I configure with some `CFLAGS`, it seems that when making still the standard `CFLAGS` are applied. It is consistent with the `CFLAGS` in `sage -sh` at least.



---

archive/issue_comments_487755.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289\">a913bbd</a></td><td><code>correct detextion of empty values</code></td></tr></table>\n",
    "created_at": "2020-10-18T09:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487755",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289">a913bbd</a></td><td><code>correct detextion of empty values</code></td></tr></table>




---

archive/issue_comments_487756.json:
```json
{
    "body": "**Changing commit** from \"[5f4d0b1c9696ea47784348164c4832a5c51178e4](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)\" to \"[a913bbd97fa2deff1daa54c27b6dd5b17996e289](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)\".",
    "created_at": "2020-10-18T09:57:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[5f4d0b1c9696ea47784348164c4832a5c51178e4](https://github.com/sagemath/sagetrac-mirror/commit/5f4d0b1c9696ea47784348164c4832a5c51178e4)" to "[a913bbd97fa2deff1daa54c27b6dd5b17996e289](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)".



---

archive/issue_comments_487757.json:
```json
{
    "body": "<a id='comment:10'></a>\nOk, seems to work now.\n\nAnd in the `sage -buildsh` this thing is run correctly.",
    "created_at": "2020-10-18T09:57:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487757",
    "user": "https://github.com/kliem"
}
```

<a id='comment:10'></a>
Ok, seems to work now.

And in the `sage -buildsh` this thing is run correctly.



---

archive/issue_comments_487758.json:
```json
{
    "body": "<a id='comment:11'></a>\nLooking good; but I think `sage-build-env` would ideally not be a generated file but rather get its settings from `sage-build-env-config`.",
    "created_at": "2020-10-22T21:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487758",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
Looking good; but I think `sage-build-env` would ideally not be a generated file but rather get its settings from `sage-build-env-config`.



---

archive/issue_comments_487759.json:
```json
{
    "body": "<a id='comment:12'></a>\n(If both are generated, there is really no point in splitting into these two files)",
    "created_at": "2020-10-22T21:08:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487759",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
(If both are generated, there is really no point in splitting into these two files)



---

archive/issue_comments_487760.json:
```json
{
    "body": "**Changing commit** from \"[a913bbd97fa2deff1daa54c27b6dd5b17996e289](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)\" to \"[3b82fe901b7141a798b714a4931a852ec09f7eec](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)\".",
    "created_at": "2020-10-26T13:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487760",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[a913bbd97fa2deff1daa54c27b6dd5b17996e289](https://github.com/sagemath/sagetrac-mirror/commit/a913bbd97fa2deff1daa54c27b6dd5b17996e289)" to "[3b82fe901b7141a798b714a4931a852ec09f7eec](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)".



---

archive/issue_comments_487761.json:
```json
{
    "body": "<a id='comment:13'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec\">3b82fe9</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>\n",
    "created_at": "2020-10-26T13:44:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec">3b82fe9</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_new</code></td></tr></table>




---

archive/issue_comments_487762.json:
```json
{
    "body": "<a id='comment:14'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7\">d979c22</a></td><td><code>do not generate `sage-build-env`; respect environment settings at make time</code></td></tr></table>\n",
    "created_at": "2020-10-26T17:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487762",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:14'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7">d979c22</a></td><td><code>do not generate `sage-build-env`; respect environment settings at make time</code></td></tr></table>




---

archive/issue_comments_487763.json:
```json
{
    "body": "**Changing commit** from \"[3b82fe901b7141a798b714a4931a852ec09f7eec](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)\" to \"[d979c2251c191e1a661fcfd5cd89dc5f83750fb7](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)\".",
    "created_at": "2020-10-26T17:09:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487763",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3b82fe901b7141a798b714a4931a852ec09f7eec](https://github.com/sagemath/sagetrac-mirror/commit/3b82fe901b7141a798b714a4931a852ec09f7eec)" to "[d979c2251c191e1a661fcfd5cd89dc5f83750fb7](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)".



---

archive/issue_comments_487764.json:
```json
{
    "body": "<a id='comment:15'></a>\nWould it not be cleaner if instead of\n\n```\n+# The configured compilation flags.\n+if [ \"x$CFLAGS\" == \"x\" ]; then\n+    export CFLAGS=\"@ORIGINAL_CFLAGS@\"\n+fi\n```\nin `build-env-config`, you would unconditionally set a variable `ORIGINAL_CFLAGS`?",
    "created_at": "2020-10-27T02:33:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487764",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:15'></a>
Would it not be cleaner if instead of

```
+# The configured compilation flags.
+if [ "x$CFLAGS" == "x" ]; then
+    export CFLAGS="@ORIGINAL_CFLAGS@"
+fi
```
in `build-env-config`, you would unconditionally set a variable `ORIGINAL_CFLAGS`?



---

archive/issue_comments_487765.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f\">e898e33</a></td><td><code>more natural naming</code></td></tr></table>\n",
    "created_at": "2020-10-27T08:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487765",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f">e898e33</a></td><td><code>more natural naming</code></td></tr></table>




---

archive/issue_comments_487766.json:
```json
{
    "body": "**Changing commit** from \"[d979c2251c191e1a661fcfd5cd89dc5f83750fb7](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)\" to \"[e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)\".",
    "created_at": "2020-10-27T08:23:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487766",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[d979c2251c191e1a661fcfd5cd89dc5f83750fb7](https://github.com/sagemath/sagetrac-mirror/commit/d979c2251c191e1a661fcfd5cd89dc5f83750fb7)" to "[e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)".



---

archive/issue_comments_487767.json:
```json
{
    "body": "<a id='comment:17'></a>\nI don't understand anything at this point anymore.\n\n- \n\n```\n$ export CFLAGS='-march=native'\n$ export CXXFLAGS='-O1'\n$ ./configure\n$ sage --buildsh\necho $CFLAGS\n-march=native\necho $CXXFLAGS\n-O1\n```\n  Okay, this is exactly what we want. But \n\n```\nexport CFLAGS='-march=native'\n./configure CXXFLAGS='-O1'\nsage --buildsh\necho $CFLAGS\n-march=native\necho $CXXFLAGS\n-march=native\n```\n  Why? `build/bin/sage-build-env-config` was configured exactly the same. However, if you `echo $CXXFLAGS` at the start of `build/bin/sage-build-env/config`, you see that `CXXFLAGS` was already set to `-march=native`. Were does this come from?\n\n- At the moment I overwrite `CFLAGS` etc. conditionally so that a user may run `make CFLAGS='-Og' <some package>`. `ORIGINAL_CFLAGS` should be the same as this value in this case, shouldn't it (and all other related values as well: `CFLAGS_O3` etc). Any package may choose any such environment variable and append flags, but should never discard flags the user handed in.\n\n  It is really confusing however, that the exported stuff at configure time is called `ORIGINAL_CFLAGS`, as `@CFLAGS@` already tells us that this is from configure time. I changed that.\n \n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f\">e898e33</a></td><td><code>more natural naming</code></td></tr></table>\n",
    "created_at": "2020-10-27T08:24:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487767",
    "user": "https://github.com/kliem"
}
```

<a id='comment:17'></a>
I don't understand anything at this point anymore.

- 

```
$ export CFLAGS='-march=native'
$ export CXXFLAGS='-O1'
$ ./configure
$ sage --buildsh
echo $CFLAGS
-march=native
echo $CXXFLAGS
-O1
```
  Okay, this is exactly what we want. But 

```
export CFLAGS='-march=native'
./configure CXXFLAGS='-O1'
sage --buildsh
echo $CFLAGS
-march=native
echo $CXXFLAGS
-march=native
```
  Why? `build/bin/sage-build-env-config` was configured exactly the same. However, if you `echo $CXXFLAGS` at the start of `build/bin/sage-build-env/config`, you see that `CXXFLAGS` was already set to `-march=native`. Were does this come from?

- At the moment I overwrite `CFLAGS` etc. conditionally so that a user may run `make CFLAGS='-Og' <some package>`. `ORIGINAL_CFLAGS` should be the same as this value in this case, shouldn't it (and all other related values as well: `CFLAGS_O3` etc). Any package may choose any such environment variable and append flags, but should never discard flags the user handed in.

  It is really confusing however, that the exported stuff at configure time is called `ORIGINAL_CFLAGS`, as `@CFLAGS@` already tells us that this is from configure time. I changed that.
 
---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f">e898e33</a></td><td><code>more natural naming</code></td></tr></table>




---

archive/issue_comments_487768.json:
```json
{
    "body": "<a id='comment:18'></a>\nNote that also `sage-env` and `sage-env-config` are sourced.",
    "created_at": "2020-10-27T17:50:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487768",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Note that also `sage-env` and `sage-env-config` are sourced.



---

archive/issue_comments_487769.json:
```json
{
    "body": "<a id='comment:19'></a>\nShall we try to get this into 9.3...?",
    "created_at": "2020-11-11T17:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487769",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>
Shall we try to get this into 9.3...?



---

archive/issue_comments_487770.json:
```json
{
    "body": "<a id='comment:20'></a>\nYes, please.\n\nHowever, I might need some help.",
    "created_at": "2020-11-12T07:48:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487770",
    "user": "https://github.com/kliem"
}
```

<a id='comment:20'></a>
Yes, please.

However, I might need some help.



---

archive/issue_comments_487771.json:
```json
{
    "body": "<a id='comment:21'></a>\nA suggestion: \n\nSet similar shell variables in `build/bin/sage-build-env-config.in` that are set in `src/bin/sage-env-config.in`:\n\n```\nCONFIGURED_CC=\"@CC@\"\nCONFIGURED_CXX=\"@CXX@\"\nCONFIGURED_FC=\"@FC@\"\nCONFIGURED_OBJC=\"@OBJC@\"\nCONFIGURED_OBJCXX=\"@OBJCXX@\"\n```\nand move all code for modifying environment variables such as CFLAGS to one place, `build/bin/sage-build-env`...",
    "created_at": "2020-11-12T19:14:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487771",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
A suggestion: 

Set similar shell variables in `build/bin/sage-build-env-config.in` that are set in `src/bin/sage-env-config.in`:

```
CONFIGURED_CC="@CC@"
CONFIGURED_CXX="@CXX@"
CONFIGURED_FC="@FC@"
CONFIGURED_OBJC="@OBJC@"
CONFIGURED_OBJCXX="@OBJCXX@"
```
and move all code for modifying environment variables such as CFLAGS to one place, `build/bin/sage-build-env`...



---

archive/issue_comments_487772.json:
```json
{
    "body": "<a id='comment:22'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf\">908ded5</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_reb</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487772",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf">908ded5</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags_reb</code></td></tr></table>




---

archive/issue_comments_487773.json:
```json
{
    "body": "**Changing commit** from \"[e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)\" to \"[908ded5da2708e491bd5c6238cc8b8f860f54caf](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)\".",
    "created_at": "2020-11-13T14:09:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487773",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f](https://github.com/sagemath/sagetrac-mirror/commit/e898e33f2e3fb3413bc2d94e8e6aa6c94c0abe0f)" to "[908ded5da2708e491bd5c6238cc8b8f860f54caf](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)".



---

archive/issue_comments_487774.json:
```json
{
    "body": "<a id='comment:23'></a>\nMerged into develop.",
    "created_at": "2020-11-13T14:09:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487774",
    "user": "https://github.com/kliem"
}
```

<a id='comment:23'></a>
Merged into develop.



---

archive/issue_comments_487775.json:
```json
{
    "body": "<a id='comment:24'></a>\nShould I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.\n\nThe only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.",
    "created_at": "2020-11-13T14:11:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487775",
    "user": "https://github.com/kliem"
}
```

<a id='comment:24'></a>
Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.

The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.



---

archive/issue_comments_487776.json:
```json
{
    "body": "**Changing commit** from \"[908ded5da2708e491bd5c6238cc8b8f860f54caf](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)\" to \"[77bc7433b983a4187c5c36e872f724cb75181f7d](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)\".",
    "created_at": "2020-11-13T14:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487776",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[908ded5da2708e491bd5c6238cc8b8f860f54caf](https://github.com/sagemath/sagetrac-mirror/commit/908ded5da2708e491bd5c6238cc8b8f860f54caf)" to "[77bc7433b983a4187c5c36e872f724cb75181f7d](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)".



---

archive/issue_comments_487777.json:
```json
{
    "body": "<a id='comment:25'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d\">77bc743</a></td><td><code>move all logic to buil/bin/sage-build-env</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:31:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487777",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:25'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d">77bc743</a></td><td><code>move all logic to buil/bin/sage-build-env</code></td></tr></table>




---

archive/issue_comments_487778.json:
```json
{
    "body": "**Changing commit** from \"[77bc7433b983a4187c5c36e872f724cb75181f7d](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)\" to \"[e2023d20fe0ea3475877884a3b36206621223018](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)\".",
    "created_at": "2020-11-13T14:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487778",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[77bc7433b983a4187c5c36e872f724cb75181f7d](https://github.com/sagemath/sagetrac-mirror/commit/77bc7433b983a4187c5c36e872f724cb75181f7d)" to "[e2023d20fe0ea3475877884a3b36206621223018](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)".



---

archive/issue_comments_487779.json:
```json
{
    "body": "<a id='comment:26'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018\">e2023d2</a></td><td><code>removed message in gcc/spkg-configure.m4</code></td></tr></table>\n",
    "created_at": "2020-11-13T14:35:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487779",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018">e2023d2</a></td><td><code>removed message in gcc/spkg-configure.m4</code></td></tr></table>




---

archive/issue_comments_487780.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [gh-kliem](#comment%3A24):\n> Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.\n> \n> The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.\n\n\nOk, I just went ahead an did this. It's a lot simpler now. Almost everything is at one place.\n`configure.ac` needs to save the flags and `build/bin/sage-build-env-config.in` picks them up again as `CONFIGURED_CFLAGS` etc.",
    "created_at": "2020-11-13T14:37:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487780",
    "user": "https://github.com/kliem"
}
```

<a id='comment:27'></a>
Replying to [gh-kliem](#comment%3A24):
> Should I remove the printing of things in `build/pkgs/gcc/spkg-configure.m4`.
> 
> The only thing that really needs to done there, is to check whether `-march=native` is supported in general (not this ticket). Everything else we redo later anyway.


Ok, I just went ahead an did this. It's a lot simpler now. Almost everything is at one place.
`configure.ac` needs to save the flags and `build/bin/sage-build-env-config.in` picks them up again as `CONFIGURED_CFLAGS` etc.



---

archive/issue_events_276341.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T22:26:03Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276341"
}
```



---

archive/issue_events_276342.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-29T22:26:03Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276342"
}
```



---

archive/issue_comments_487781.json:
```json
{
    "body": "<a id='comment:28'></a>\nThis looks great but I think you'll need to modify `build/bin/sage-spkg` as well so that the install scripts for normal packages source `sage-build-env`.",
    "created_at": "2020-11-29T22:26:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487781",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
This looks great but I think you'll need to modify `build/bin/sage-spkg` as well so that the install scripts for normal packages source `sage-build-env`.



---

archive/issue_comments_487782.json:
```json
{
    "body": "<a id='comment:29'></a>\nAlso, in `sage-build-env`, remove spaces around `=` in `export` -- this is not valid shell syntax",
    "created_at": "2020-11-29T22:57:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487782",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Also, in `sage-build-env`, remove spaces around `=` in `export` -- this is not valid shell syntax



---

archive/issue_comments_487783.json:
```json
{
    "body": "**Changing commit** from \"[e2023d20fe0ea3475877884a3b36206621223018](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)\" to \"[098ca15de64d761f058dd038b66e81780904de2e](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)\".",
    "created_at": "2020-11-30T08:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[e2023d20fe0ea3475877884a3b36206621223018](https://github.com/sagemath/sagetrac-mirror/commit/e2023d20fe0ea3475877884a3b36206621223018)" to "[098ca15de64d761f058dd038b66e81780904de2e](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)".



---

archive/issue_comments_487784.json:
```json
{
    "body": "<a id='comment:30'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e\">098ca15</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:06:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487784",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e">098ca15</a></td><td><code>Merge branch 'u/gh-kliem/gather_and_clean_up_compile_flags' of git://trac.sagemath.org/sage into u/gh-kliem/gather_and_clean_up_compile_flags</code></td></tr></table>




---

archive/issue_comments_487785.json:
```json
{
    "body": "**Changing commit** from \"[098ca15de64d761f058dd038b66e81780904de2e](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)\" to \"[9c5e8a245aae24288d3a922666c3abbe41a44747](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)\".",
    "created_at": "2020-11-30T08:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487785",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[098ca15de64d761f058dd038b66e81780904de2e](https://github.com/sagemath/sagetrac-mirror/commit/098ca15de64d761f058dd038b66e81780904de2e)" to "[9c5e8a245aae24288d3a922666c3abbe41a44747](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)".



---

archive/issue_comments_487786.json:
```json
{
    "body": "<a id='comment:31'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6e5b1110ed267f13b7e41cbb1ba04a86113a3a3\">b6e5b11</a></td><td><code>fixed shell syntax</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/431d14ce9603452194a366c5fec6c9295fae1b20\">431d14c</a></td><td><code>source in sage-spkg</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747\">9c5e8a2</a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:24:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487786",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:31'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6e5b1110ed267f13b7e41cbb1ba04a86113a3a3">b6e5b11</a></td><td><code>fixed shell syntax</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/431d14ce9603452194a366c5fec6c9295fae1b20">431d14c</a></td><td><code>source in sage-spkg</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747">9c5e8a2</a></td><td><code>add references to `bin/sage-build-env` and `bin/sage-build-env-config`</code></td></tr></table>




---

archive/issue_comments_487787.json:
```json
{
    "body": "<a id='comment:32'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc\">4b8933b</a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr></table>\n",
    "created_at": "2020-11-30T08:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc">4b8933b</a></td><td><code>remove incorrect `$` in `build/bin/sage-build-env`</code></td></tr></table>




---

archive/issue_comments_487788.json:
```json
{
    "body": "**Changing commit** from \"[9c5e8a245aae24288d3a922666c3abbe41a44747](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)\" to \"[4b8933b0aec03722e34fa1a6d2573a22c3edfedc](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)\".",
    "created_at": "2020-11-30T08:30:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[9c5e8a245aae24288d3a922666c3abbe41a44747](https://github.com/sagemath/sagetrac-mirror/commit/9c5e8a245aae24288d3a922666c3abbe41a44747)" to "[4b8933b0aec03722e34fa1a6d2573a22c3edfedc](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)".



---

archive/issue_events_276343.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T08:30:22Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276343"
}
```



---

archive/issue_events_276344.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T08:30:22Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276344"
}
```



---

archive/issue_comments_487789.json:
```json
{
    "body": "<a id='comment:34'></a>\n`sage-build-env` and `sage-build-env-config` are in `build/bin`, not `src/bin`. They should not be listed in `src/setup.py`, `build/pkgs/sagelib/src/setup.py`.",
    "created_at": "2020-11-30T16:44:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487789",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
`sage-build-env` and `sage-build-env-config` are in `build/bin`, not `src/bin`. They should not be listed in `src/setup.py`, `build/pkgs/sagelib/src/setup.py`.



---

archive/issue_comments_487790.json:
```json
{
    "body": "<a id='comment:35'></a>\nAlso the comments in `build/make/Makefile.in` introduce the wrong path - it should be build/bin",
    "created_at": "2020-11-30T16:45:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487790",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Also the comments in `build/make/Makefile.in` introduce the wrong path - it should be build/bin



---

archive/issue_events_276345.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T16:45:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276345"
}
```



---

archive/issue_events_276346.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T16:45:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276346"
}
```



---

archive/issue_comments_487791.json:
```json
{
    "body": "<a id='comment:37'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694\">071b8cc</a></td><td><code>Revert \"add references to `bin/sage-build-env` and `bin/sage-build-env-config`\"</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487791",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:37'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694">071b8cc</a></td><td><code>Revert "add references to `bin/sage-build-env` and `bin/sage-build-env-config`"</code></td></tr></table>




---

archive/issue_comments_487792.json:
```json
{
    "body": "**Changing commit** from \"[4b8933b0aec03722e34fa1a6d2573a22c3edfedc](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)\" to \"[071b8ccc520b1b1c6b419465da76a26cec99f694](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)\".",
    "created_at": "2020-11-30T17:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4b8933b0aec03722e34fa1a6d2573a22c3edfedc](https://github.com/sagemath/sagetrac-mirror/commit/4b8933b0aec03722e34fa1a6d2573a22c3edfedc)" to "[071b8ccc520b1b1c6b419465da76a26cec99f694](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)".



---

archive/issue_comments_487793.json:
```json
{
    "body": "<a id='comment:38'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6\">c51e752</a></td><td><code>correct comments to makefile</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487793",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6">c51e752</a></td><td><code>correct comments to makefile</code></td></tr></table>




---

archive/issue_comments_487794.json:
```json
{
    "body": "**Changing commit** from \"[071b8ccc520b1b1c6b419465da76a26cec99f694](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)\" to \"[c51e752495cf323c27f089c2cd2d870fbd3abad6](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)\".",
    "created_at": "2020-11-30T17:04:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[071b8ccc520b1b1c6b419465da76a26cec99f694](https://github.com/sagemath/sagetrac-mirror/commit/071b8ccc520b1b1c6b419465da76a26cec99f694)" to "[c51e752495cf323c27f089c2cd2d870fbd3abad6](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)".



---

archive/issue_events_276347.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T17:04:54Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276347"
}
```



---

archive/issue_events_276348.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-11-30T17:04:54Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276348"
}
```



---

archive/issue_comments_487795.json:
```json
{
    "body": "<a id='comment:39'></a>\nSorry, I got confused.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6\">c51e752</a></td><td><code>correct comments to makefile</code></td></tr></table>\n",
    "created_at": "2020-11-30T17:04:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487795",
    "user": "https://github.com/kliem"
}
```

<a id='comment:39'></a>
Sorry, I got confused.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6">c51e752</a></td><td><code>correct comments to makefile</code></td></tr></table>




---

archive/issue_comments_487796.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2020-11-30T22:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487796",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_events_276349.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T22:31:15Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276349"
}
```



---

archive/issue_events_276350.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-30T22:31:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276350"
}
```



---

archive/issue_comments_487797.json:
```json
{
    "body": "<a id='comment:40'></a>\nThis seems to work well.\n\nLet's get this merged for wider testing by developers.",
    "created_at": "2020-11-30T22:31:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487797",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
This seems to work well.

Let's get this merged for wider testing by developers.



---

archive/issue_comments_487798.json:
```json
{
    "body": "<a id='comment:41'></a>\nThank you.",
    "created_at": "2020-12-01T07:01:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487798",
    "user": "https://github.com/kliem"
}
```

<a id='comment:41'></a>
Thank you.



---

archive/issue_comments_487799.json:
```json
{
    "body": "<a id='comment:42'></a>\nOne thing is actually strange.\n\nI guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.\n\nI didn't consider this, so efficiently `-O2 -g` isn't added anymore.",
    "created_at": "2020-12-03T10:17:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487799",
    "user": "https://github.com/kliem"
}
```

<a id='comment:42'></a>
One thing is actually strange.

I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.

I didn't consider this, so efficiently `-O2 -g` isn't added anymore.



---

archive/issue_comments_487800.json:
```json
{
    "body": "<a id='comment:43'></a>\nReplying to [gh-kliem](#comment%3A42):\n> One thing is actually strange.\n> \n> I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.\n> \n> I didn't consider this, so efficiently `-O2 -g` isn't added anymore.\n\n\nAnyway, I fixed that in #27122, but can also fix it here, if that makes sense.",
    "created_at": "2020-12-03T10:32:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487800",
    "user": "https://github.com/kliem"
}
```

<a id='comment:43'></a>
Replying to [gh-kliem](#comment%3A42):
> One thing is actually strange.
> 
> I guess the `gfortran` or something else sets the default `FCFLAGS` to ` -ffree-form`.
> 
> I didn't consider this, so efficiently `-O2 -g` isn't added anymore.


Anyway, I fixed that in #27122, but can also fix it here, if that makes sense.



---

archive/issue_events_276351.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-03T16:30:17Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276351"
}
```



---

archive/issue_events_276352.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-03T16:30:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276352"
}
```



---

archive/issue_comments_487801.json:
```json
{
    "body": "<a id='comment:44'></a>\nBest to fix it here already",
    "created_at": "2020-12-03T16:30:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487801",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Best to fix it here already



---

archive/issue_comments_487802.json:
```json
{
    "body": "<a id='comment:45'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91\">aa7ecd6</a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr></table>\n",
    "created_at": "2020-12-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487802",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91">aa7ecd6</a></td><td><code>fix that we might have changed $FCFLAGS during configure</code></td></tr></table>




---

archive/issue_comments_487803.json:
```json
{
    "body": "**Changing commit** from \"[c51e752495cf323c27f089c2cd2d870fbd3abad6](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)\" to \"[aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)\".",
    "created_at": "2020-12-03T17:51:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487803",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[c51e752495cf323c27f089c2cd2d870fbd3abad6](https://github.com/sagemath/sagetrac-mirror/commit/c51e752495cf323c27f089c2cd2d870fbd3abad6)" to "[aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)".



---

archive/issue_events_276353.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-03T17:51:48Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276353"
}
```



---

archive/issue_events_276354.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-03T17:51:48Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276354"
}
```



---

archive/issue_comments_487804.json:
```json
{
    "body": "<a id='comment:47'></a>\nI'm not sure if I like this fix...",
    "created_at": "2020-12-03T18:05:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487804",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
I'm not sure if I like this fix...



---

archive/issue_comments_487805.json:
```json
{
    "body": "<a id='comment:48'></a>\nIt works. But it's probably not perfect.\n\nIt appears that this is set by the gfortran configure. It is definitely in the compiled configure \n\n```\nfor ac_flag in none -ffree-form -FR -free -qfree -Mfree -Mfreeform\n```\n\nI suppose that is enforced by `AC_FC_FREEFORM` and will end up adding something to `FCFLAGS`.",
    "created_at": "2020-12-03T18:13:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487805",
    "user": "https://github.com/kliem"
}
```

<a id='comment:48'></a>
It works. But it's probably not perfect.

It appears that this is set by the gfortran configure. It is definitely in the compiled configure 

```
for ac_flag in none -ffree-form -FR -free -qfree -Mfree -Mfreeform
```

I suppose that is enforced by `AC_FC_FREEFORM` and will end up adding something to `FCFLAGS`.



---

archive/issue_comments_487806.json:
```json
{
    "body": "<a id='comment:49'></a>\nI agree, that this solution changes behavior.\n\nCalling `AC_FC_FREEFORM` appends ` -ffree-form`. I don't know why. Do we want this or is this just for testing and we really should call `AC_SUBST(FCFLAGS)` before this?",
    "created_at": "2020-12-03T18:16:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487806",
    "user": "https://github.com/kliem"
}
```

<a id='comment:49'></a>
I agree, that this solution changes behavior.

Calling `AC_FC_FREEFORM` appends ` -ffree-form`. I don't know why. Do we want this or is this just for testing and we really should call `AC_SUBST(FCFLAGS)` before this?



---

archive/issue_comments_487807.json:
```json
{
    "body": "<a id='comment:50'></a>\nI think we shouldn't pass on the `FCFLAGS` discovered by this to avoid subtle change of behavior. The individual packages are in charge of figuring out the flags that they need for the Fortran compiler.\n\nSo I think it's best to save and restore the flags around the spkg-configure code",
    "created_at": "2020-12-03T18:29:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487807",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
I think we shouldn't pass on the `FCFLAGS` discovered by this to avoid subtle change of behavior. The individual packages are in charge of figuring out the flags that they need for the Fortran compiler.

So I think it's best to save and restore the flags around the spkg-configure code



---

archive/issue_comments_487808.json:
```json
{
    "body": "<a id='comment:51'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e\">94326db</a></td><td><code>better solution for dealing with -ffree-form</code></td></tr></table>\n",
    "created_at": "2020-12-03T18:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487808",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e">94326db</a></td><td><code>better solution for dealing with -ffree-form</code></td></tr></table>




---

archive/issue_comments_487809.json:
```json
{
    "body": "**Changing commit** from \"[aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)\" to \"[94326db15e38576990696e59347cb857a5ecb73e](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)\".",
    "created_at": "2020-12-03T18:35:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487809",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91](https://github.com/sagemath/sagetrac-mirror/commit/aa7ecd6ef0fd94e9d3a42c1c496f2138cc76fc91)" to "[94326db15e38576990696e59347cb857a5ecb73e](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)".



---

archive/issue_comments_487810.json:
```json
{
    "body": "<a id='comment:52'></a>\nActually, replacing `AC_SUBST(FCFLAGS, \"$FCFLAGS\")` by `AC_SUBST(CONFIGURED_FCFLAGS, \"$FCFLAGS\")`, does the job.\n\nApparently this is somewhat split into two. First we set `FCFLAGS=$FLAGS` and later the substitution is triggered. So any changes that are applied later to `FCFLAGS` will still have an effect, but not if we change the name.\n\nNow that apparently the `gfortran` configure changes `FCLFAGS` is a different story.",
    "created_at": "2020-12-03T18:39:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487810",
    "user": "https://github.com/kliem"
}
```

<a id='comment:52'></a>
Actually, replacing `AC_SUBST(FCFLAGS, "$FCFLAGS")` by `AC_SUBST(CONFIGURED_FCFLAGS, "$FCFLAGS")`, does the job.

Apparently this is somewhat split into two. First we set `FCFLAGS=$FLAGS` and later the substitution is triggered. So any changes that are applied later to `FCFLAGS` will still have an effect, but not if we change the name.

Now that apparently the `gfortran` configure changes `FCLFAGS` is a different story.



---

archive/issue_comments_487811.json:
```json
{
    "body": "<a id='comment:53'></a>\nNote that `FCFLAGS` is automatically `AC_SUBST`'ed as well:\n\n```\n$ grep FCFLAGS config.status\nac_cs_config=\"'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g'\"\n  set X /bin/sh './configure'  'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g' $ac_configure_extra_args --no-create --no-recursion\nS[\"FCFLAGS\"]=\"-g -g -g -ffree-form\"\nS[\"CONFIGURED_FCFLAGS\"]=\"-g -g -g\"\n```\nI would much prefer the solution using save/restore of flags instead of introducing a new substitution variable. This would keep things closer to automake.",
    "created_at": "2020-12-03T19:10:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487811",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>
Note that `FCFLAGS` is automatically `AC_SUBST`'ed as well:

```
$ grep FCFLAGS config.status
ac_cs_config="'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g'"
  set X /bin/sh './configure'  'PKG_CONFIG_PATH=/usr/local/opt/zlib/lib/pkgconfig:/usr/local/opt/sqlite/lib/pkgconfig:/usr/local/opt/readline/lib/pkgconfig:/usr/local/opt/openssl/lib/pkgconfig:/usr/local/opt/openblas/lib/pkgconfig:/usr/local/lib/pkgconfig:' 'FCFLAGS=-g -g -g' $ac_configure_extra_args --no-create --no-recursion
S["FCFLAGS"]="-g -g -g -ffree-form"
S["CONFIGURED_FCFLAGS"]="-g -g -g"
```
I would much prefer the solution using save/restore of flags instead of introducing a new substitution variable. This would keep things closer to automake.



---

archive/issue_comments_487812.json:
```json
{
    "body": "<a id='comment:54'></a>\nFrom https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html\n\n> The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. \n\n\nSo, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.\n\nIf we want to respect this (starting with this ticket), what do you think would be the best way? Somehow I must store that `FCFLAGS` wasn't set by the user and I may add our defaults to this.",
    "created_at": "2020-12-03T19:24:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487812",
    "user": "https://github.com/kliem"
}
```

<a id='comment:54'></a>
From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html

> The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. 


So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.

If we want to respect this (starting with this ticket), what do you think would be the best way? Somehow I must store that `FCFLAGS` wasn't set by the user and I may add our defaults to this.



---

archive/issue_comments_487813.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [gh-kliem](#comment%3A54):\n> From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html\n> \n> > The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. \n\n> \n> So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.\n\n\nWe run this to find out whether the configured Fortran compiler has a free form mode.\n\nWe do this for our decision whether we have to install gfortran or not.\n\nBut it must be up to the individual packages how they invoke the Fortran compiler.",
    "created_at": "2020-12-03T19:27:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487813",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:55'></a>
Replying to [gh-kliem](#comment%3A54):
> From https://www.gnu.org/software/autoconf/manual/autoconf-2.66/html_node/Fortran-Compiler.html
> 
> > The AC_FC_FREEFORM tries to ensure that the Fortran compiler ($FC) allows free-format source code (as opposed to the older fixed-format style from Fortran 77). If necessary, it may add some additional flags to FCFLAGS. 

> 
> So, `AC_FC_FREEFORM` has added ` -ffree-form` to my flags, because it feels that this is needed. So I think, we should either respect that or not call `AC_FC_FREEFORM`.


We run this to find out whether the configured Fortran compiler has a free form mode.

We do this for our decision whether we have to install gfortran or not.

But it must be up to the individual packages how they invoke the Fortran compiler.



---

archive/issue_comments_487814.json:
```json
{
    "body": "<a id='comment:56'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4\">87dae61</a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr></table>\n",
    "created_at": "2020-12-03T20:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487814",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:56'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4">87dae61</a></td><td><code>keep FCFLAGS during gfortran configure</code></td></tr></table>




---

archive/issue_comments_487815.json:
```json
{
    "body": "**Changing commit** from \"[94326db15e38576990696e59347cb857a5ecb73e](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)\" to \"[87dae61577f33d1572ae140ee32fe32b3470e7d4](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)\".",
    "created_at": "2020-12-03T20:05:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487815",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[94326db15e38576990696e59347cb857a5ecb73e](https://github.com/sagemath/sagetrac-mirror/commit/94326db15e38576990696e59347cb857a5ecb73e)" to "[87dae61577f33d1572ae140ee32fe32b3470e7d4](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)".



---

archive/issue_comments_487816.json:
```json
{
    "body": "<a id='comment:57'></a>\nOk. I'm storing and restoring the `FCFLAGS` during gfortran configure now.\nDefining a macro was the only way, I could enforce the order. But maybe there is a better way of doing this.",
    "created_at": "2020-12-03T20:07:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487816",
    "user": "https://github.com/kliem"
}
```

<a id='comment:57'></a>
Ok. I'm storing and restoring the `FCFLAGS` during gfortran configure now.
Defining a macro was the only way, I could enforce the order. But maybe there is a better way of doing this.



---

archive/issue_comments_487817.json:
```json
{
    "body": "<a id='comment:58'></a>\nThat's fine, yes, `AC_FC_FREEFORM` is executed out of order.\n\nThese lines:\n\n```\n+    sage_saved_fcflags=$FCFLAGS\n+    FCFLAGS=$sage_saved_fcflags\n```\nneed quoting around the assigned value.",
    "created_at": "2020-12-03T22:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487817",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>
That's fine, yes, `AC_FC_FREEFORM` is executed out of order.

These lines:

```
+    sage_saved_fcflags=$FCFLAGS
+    FCFLAGS=$sage_saved_fcflags
```
need quoting around the assigned value.



---

archive/issue_comments_487818.json:
```json
{
    "body": "<a id='comment:59'></a>\nAlso these macro calls are better without the use of the second argument (look at the generated shell code)\n\n```\n+# Save compiler flags as configured by the user.\n+AC_SUBST(CFLAGS, \"$CFLAGS\")\n+AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n+AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n+AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n```",
    "created_at": "2020-12-03T22:20:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487818",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
Also these macro calls are better without the use of the second argument (look at the generated shell code)

```
+# Save compiler flags as configured by the user.
+AC_SUBST(CFLAGS, "$CFLAGS")
+AC_SUBST(CXXFLAGS, "$CXXFLAGS")
+AC_SUBST(FCFLAGS, "$FCFLAGS")
+AC_SUBST(F77FLAGS, "$F77FLAGS")
```



---

archive/issue_comments_487819.json:
```json
{
    "body": "<a id='comment:60'></a>\nReplying to [mkoeppe](#comment%3A59):\n> Also these macro calls are better without the use of the second argument (look at the generated shell code)\n> \n> ```\n> +# Save compiler flags as configured by the user.\n> +AC_SUBST(CFLAGS, \"$CFLAGS\")\n> +AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n> +AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n> +AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n> ```\n\n\nYour proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, \"$CFLAGS\")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.",
    "created_at": "2020-12-04T07:33:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487819",
    "user": "https://github.com/kliem"
}
```

<a id='comment:60'></a>
Replying to [mkoeppe](#comment%3A59):
> Also these macro calls are better without the use of the second argument (look at the generated shell code)
> 
> ```
> +# Save compiler flags as configured by the user.
> +AC_SUBST(CFLAGS, "$CFLAGS")
> +AC_SUBST(CXXFLAGS, "$CXXFLAGS")
> +AC_SUBST(FCFLAGS, "$FCFLAGS")
> +AC_SUBST(F77FLAGS, "$F77FLAGS")
> ```


Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, "$CFLAGS")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.



---

archive/issue_comments_487820.json:
```json
{
    "body": "**Changing commit** from \"[87dae61577f33d1572ae140ee32fe32b3470e7d4](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)\" to \"[7577dd41f29981722e970606664cfc8651b6a6bb](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)\".",
    "created_at": "2020-12-04T07:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487820",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[87dae61577f33d1572ae140ee32fe32b3470e7d4](https://github.com/sagemath/sagetrac-mirror/commit/87dae61577f33d1572ae140ee32fe32b3470e7d4)" to "[7577dd41f29981722e970606664cfc8651b6a6bb](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)".



---

archive/issue_comments_487821.json:
```json
{
    "body": "<a id='comment:61'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb\">7577dd4</a></td><td><code>added quotes</code></td></tr></table>\n",
    "created_at": "2020-12-04T07:34:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487821",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:61'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb">7577dd4</a></td><td><code>added quotes</code></td></tr></table>




---

archive/issue_comments_487822.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [gh-kliem](#comment%3A60):\n> Replying to [mkoeppe](#comment%3A59):\n> > Also these macro calls are better without the use of the second argument (look at the generated shell code)\n> > \n> > ```\n> > +# Save compiler flags as configured by the user.\n> > +AC_SUBST(CFLAGS, \"$CFLAGS\")\n> > +AC_SUBST(CXXFLAGS, \"$CXXFLAGS\")\n> > +AC_SUBST(FCFLAGS, \"$FCFLAGS\")\n> > +AC_SUBST(F77FLAGS, \"$F77FLAGS\")\n> > ```\n\n> \n> Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, \"$CFLAGS\")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.\n\n\nI could deal with it the same way, I did with the `FCFLAGS` and save all of those flags beforehand. Maybe that is cleaner.",
    "created_at": "2020-12-04T07:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487822",
    "user": "https://github.com/kliem"
}
```

<a id='comment:62'></a>
Replying to [gh-kliem](#comment%3A60):
> Replying to [mkoeppe](#comment%3A59):
> > Also these macro calls are better without the use of the second argument (look at the generated shell code)
> > 
> > ```
> > +# Save compiler flags as configured by the user.
> > +AC_SUBST(CFLAGS, "$CFLAGS")
> > +AC_SUBST(CXXFLAGS, "$CXXFLAGS")
> > +AC_SUBST(FCFLAGS, "$FCFLAGS")
> > +AC_SUBST(F77FLAGS, "$F77FLAGS")
> > ```

> 
> Your proposed change does not work. `AC_PROG_CC()` changes the value of `CFLAGS` if not set. `AC_SUBST(CFLAGS, "$CFLAGS")` will implicitly set `CFLAGS` (even though possibly to the empty value), but prevents `AC_PROG_CC` from messing with it.


I could deal with it the same way, I did with the `FCFLAGS` and save all of those flags beforehand. Maybe that is cleaner.



---

archive/issue_comments_487823.json:
```json
{
    "body": "<a id='comment:63'></a>\nMaybe we can take care of this.",
    "created_at": "2020-12-06T18:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487823",
    "user": "https://github.com/kliem"
}
```

<a id='comment:63'></a>
Maybe we can take care of this.



---

archive/issue_comments_487824.json:
```json
{
    "body": "**Changing keywords** from \"compile flags\" to \"compile flags, sd111\".",
    "created_at": "2020-12-06T18:39:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487824",
    "user": "https://github.com/kliem"
}
```

**Changing keywords** from "compile flags" to "compile flags, sd111".



---

archive/issue_events_276355.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-09T21:12:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276355"
}
```



---

archive/issue_events_276356.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-09T21:12:01Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276356"
}
```



---

archive/issue_comments_487825.json:
```json
{
    "body": "**Work_Issues:** make variables SAGE_DEBUG and SAGE_FAT_BINARY precious",
    "created_at": "2020-12-09T21:12:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487825",
    "user": "https://github.com/kliem"
}
```

**Work_Issues:** make variables SAGE_DEBUG and SAGE_FAT_BINARY precious



---

archive/issue_comments_487826.json:
```json
{
    "body": "<a id='comment:65'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7\">3bb3099</a></td><td><code>prepare preciouos variables</code></td></tr></table>\n",
    "created_at": "2020-12-10T08:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7">3bb3099</a></td><td><code>prepare preciouos variables</code></td></tr></table>




---

archive/issue_comments_487827.json:
```json
{
    "body": "**Changing commit** from \"[7577dd41f29981722e970606664cfc8651b6a6bb](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)\" to \"[3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)\".",
    "created_at": "2020-12-10T08:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487827",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7577dd41f29981722e970606664cfc8651b6a6bb](https://github.com/sagemath/sagetrac-mirror/commit/7577dd41f29981722e970606664cfc8651b6a6bb)" to "[3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)".



---

archive/issue_events_276357.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-10T08:20:20Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276357"
}
```



---

archive/issue_events_276358.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-12-10T08:20:20Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276358"
}
```



---

archive/issue_comments_487828.json:
```json
{
    "body": "<a id='comment:66'></a>\nOk, at least it is prepared for precious variables.\n\n#29507 would have to take care of using this.",
    "created_at": "2020-12-10T08:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487828",
    "user": "https://github.com/kliem"
}
```

<a id='comment:66'></a>
Ok, at least it is prepared for precious variables.

#29507 would have to take care of using this.



---

archive/issue_comments_487829.json:
```json
{
    "body": "**Changing work_issues** from \"make variables SAGE_DEBUG and SAGE_FAT_BINARY precious\" to \"\".",
    "created_at": "2020-12-10T08:20:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487829",
    "user": "https://github.com/kliem"
}
```

**Changing work_issues** from "make variables SAGE_DEBUG and SAGE_FAT_BINARY precious" to "".



---

archive/issue_comments_487830.json:
```json
{
    "body": "<a id='comment:67'></a>\nActually, it kind of works.\n\nDuring make, reconfiguration will be done using `./config.status` and this one does not alter the variables.",
    "created_at": "2020-12-10T08:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487830",
    "user": "https://github.com/kliem"
}
```

<a id='comment:67'></a>
Actually, it kind of works.

During make, reconfiguration will be done using `./config.status` and this one does not alter the variables.



---

archive/issue_comments_487831.json:
```json
{
    "body": "<a id='comment:68'></a>\nLooking great, let's get this in.",
    "created_at": "2020-12-11T03:02:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487831",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>
Looking great, let's get this in.



---

archive/issue_events_276359.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T03:02:53Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276359"
}
```



---

archive/issue_events_276360.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-11T03:02:53Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276360"
}
```



---

archive/issue_comments_487832.json:
```json
{
    "body": "<a id='comment:69'></a>\nThanks again.",
    "created_at": "2020-12-11T07:02:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487832",
    "user": "https://github.com/kliem"
}
```

<a id='comment:69'></a>
Thanks again.



---

archive/issue_events_276361.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:30:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276361"
}
```



---

archive/issue_events_276362.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T20:30:47Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30375#event-276362"
}
```



---

archive/issue_comments_487833.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-kliem/gather_and_clean_up_compile_flags](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/gather_and_clean_up_compile_flags)\" to \"[3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)\".",
    "created_at": "2020-12-13T20:30:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30375",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30375#issuecomment-487833",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-kliem/gather_and_clean_up_compile_flags](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-kliem/gather_and_clean_up_compile_flags)" to "[3bb309944b7e8542b2ac88ed3c9d9a60e68644d7](https://github.com/sagemath/sagetrac-mirror/commit/3bb309944b7e8542b2ac88ed3c9d9a60e68644d7)".
