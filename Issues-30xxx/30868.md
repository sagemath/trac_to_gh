# Issue 30868: sage fails to start on Fedora 32 after the recent update to Python 3.8

archive/issues_030631.json:
```json
{
    "body": "The crash report is attached. The installation is from the latest Fedora 32 package (sage 9.0).\n\nReviewer: Samuel Leli\u00e8vre\n\nResolution: invalid\n\nIssue created by migration from https://trac.sagemath.org/ticket/30868\n\n",
    "closed_at": "2021-06-24T20:15:37Z",
    "created_at": "2020-11-07T04:13:29Z",
    "labels": [
        "component: build",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-duplicate/invalid/wontfix",
    "title": "sage fails to start on Fedora 32 after the recent update to Python 3.8",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30868",
    "user": "https://github.com/AndrewLyasoff"
}
```
The crash report is attached. The installation is from the latest Fedora 32 package (sage 9.0).

Reviewer: Samuel Leli√®vre

Resolution: invalid

Issue created by migration from https://trac.sagemath.org/ticket/30868





---

archive/issue_comments_437336.json:
```json
{
    "body": "<a id='comment:1'></a>Attachment [Sage_crash_report.txt](tarball://root/attachments/some-uuid/ticket30868/Sage_crash_report.txt) by @AndrewLyasoff created at 2020-11-07 04:17:53",
    "created_at": "2020-11-07T04:17:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437336",
    "user": "https://github.com/AndrewLyasoff"
}
```

<a id='comment:1'></a>Attachment [Sage_crash_report.txt](tarball://root/attachments/some-uuid/ticket30868/Sage_crash_report.txt) by @AndrewLyasoff created at 2020-11-07 04:17:53



---

archive/issue_events_080553.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-07T19:13:04Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "milestone": "sage-duplicate/invalid/wontfix",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30868#event-80553"
}
```



---

archive/issue_comments_437337.json:
```json
{
    "body": "<a id='comment:2'></a>Report Fedora packaging bugs to Fedora.",
    "created_at": "2020-11-07T19:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437337",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>Report Fedora packaging bugs to Fedora.



---

archive/issue_comments_437338.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-07T19:13:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437338",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437339.json:
```json
{
    "body": "<a id='comment:3'></a>For the record, this started happening when giac was updated from version 1.6.0-7 to version 1.6.0-25.  The way giac initializes pari was changed.  Sagemath starts up and initializes cypari2, which stores the value of `avma`.  Later, giac is loaded.  It initializes pari a second time, creating an entirely new stack and a new value of `avma`.  When cypari2 is next used, it tries to use values on the old stack, but they are not valid stack slots because giac made a new pari stack.\n\nI am going to try enabling TLS support in pari to see if that is sufficient.  That way, cypari2 and giac threads can use different pari stacks, at the cost of consuming more memory.",
    "created_at": "2020-11-09T17:24:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437339",
    "user": "https://github.com/jamesjer"
}
```

<a id='comment:3'></a>For the record, this started happening when giac was updated from version 1.6.0-7 to version 1.6.0-25.  The way giac initializes pari was changed.  Sagemath starts up and initializes cypari2, which stores the value of `avma`.  Later, giac is loaded.  It initializes pari a second time, creating an entirely new stack and a new value of `avma`.  When cypari2 is next used, it tries to use values on the old stack, but they are not valid stack slots because giac made a new pari stack.

I am going to try enabling TLS support in pari to see if that is sufficient.  That way, cypari2 and giac threads can use different pari stacks, at the cost of consuming more memory.



---

archive/issue_comments_437340.json:
```json
{
    "body": "<a id='comment:4'></a>This is probably best discussed in #30537, our giac 1.6 upgrade ticket",
    "created_at": "2020-11-09T18:07:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437340",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>This is probably best discussed in #30537, our giac 1.6 upgrade ticket



---

archive/issue_comments_437341.json:
```json
{
    "body": "Changing component from PLEASE CHANGE to build.",
    "created_at": "2021-01-02T21:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437341",
    "user": "https://github.com/slel"
}
```

Changing component from PLEASE CHANGE to build.



---

archive/issue_comments_437342.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-02T21:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437342",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437343.json:
```json
{
    "body": "Resolution: invalid",
    "created_at": "2021-06-24T20:15:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30868#issuecomment-437343",
    "user": "https://github.com/mkoeppe"
}
```

Resolution: invalid



---

archive/issue_events_080554.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30868",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30868#event-80554"
}
```
