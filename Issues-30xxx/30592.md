# Issue 30592: Meta-ticket: Port to Apple silicon

archive/issues_030355.json:
```json
{
    "body": "... on top of homebrew, which provides gfortran 11 and many usable packages.\n\nTickets:\n- #31258 Upgrade cmake to 3.19.3\n- #31838 gfortran: Accept system gfortran 11\n- #31905 cvxopt: Correct link directory\n- #32796 gmp: update to 6.2.1\n- #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n- #33191 Fix build errors on Apple Silicon with homebrew\n- #33195 iml: Refresh build scripts with current autotools\n- #33194 openblas: Update to 0.3.19\n- #33816 Update gcc/gfortran to 12.x + Apple Silicon support, update openblas to 0.3.21, gsl to 2.7.1\n\nDiscussions:\n- https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n- https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n- https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA\n\nSee also:\n- #30494: Meta-ticket: Support Xcode 12\n- #30651: Meta-ticket: support macOS 11 Big Sur\n\n\n**CC:**  @dimpase @isuruf @kcrisman @kiwifb @williamstein\n\n**Reviewer:** Dima Pasechnik\n\nIssue created by migration from https://trac.sagemath.org/ticket/30592\n\n",
    "created_at": "2020-09-17T20:30:31Z",
    "labels": [
        "component: porting",
        "critical",
        "enhancement",
        "positive review",
        "invalid"
    ],
    "title": "Meta-ticket: Port to Apple silicon",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/30592",
    "user": "https://github.com/mkoeppe"
}
```
... on top of homebrew, which provides gfortran 11 and many usable packages.

Tickets:
- #31258 Upgrade cmake to 3.19.3
- #31838 gfortran: Accept system gfortran 11
- #31905 cvxopt: Correct link directory
- #32796 gmp: update to 6.2.1
- #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
- #33191 Fix build errors on Apple Silicon with homebrew
- #33195 iml: Refresh build scripts with current autotools
- #33194 openblas: Update to 0.3.19
- #33816 Update gcc/gfortran to 12.x + Apple Silicon support, update openblas to 0.3.21, gsl to 2.7.1

Discussions:
- https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
- https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
- https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA

See also:
- #30494: Meta-ticket: Support Xcode 12
- #30651: Meta-ticket: support macOS 11 Big Sur


**CC:**  @dimpase @isuruf @kcrisman @kiwifb @williamstein

**Reviewer:** Dima Pasechnik

Issue created by migration from https://trac.sagemath.org/ticket/30592





---

archive/issue_comments_490877.json:
```json
{
    "body": "<a id='comment:1'></a>\nDoes GitHub Actions provide that kind of machines for CI?\n\nSomewhat related:\n\n- [LFortran issue 188: Investigate how to enable macOS for a MR also](https://gitlab.com/lfortran/lfortran/-/issues/188)",
    "created_at": "2020-09-18T06:04:30Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490877",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'></a>
Does GitHub Actions provide that kind of machines for CI?

Somewhat related:

- [LFortran issue 188: Investigate how to enable macOS for a MR also](https://gitlab.com/lfortran/lfortran/-/issues/188)



---

archive/issue_events_273995.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-273995"
}
```



---

archive/issue_events_273996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-273996"
}
```



---

archive/issue_comments_490878.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,2 +1,5 @@\n Need a working Fortran compiler first.\n \n+Discussions:\n+- https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n+\n``````\n",
    "created_at": "2020-11-24T23:15:37Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490878",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,2 +1,5 @@
 Need a working Fortran compiler first.
 
+Discussions:
+- https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
+
``````




---

archive/issue_comments_490879.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -2,4 +2,4 @@\n \n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n-\n+- https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2020-12-18T21:12:32Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490879",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -2,4 +2,4 @@
 
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
-
+- https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490880.json:
```json
{
    "body": "<a id='comment:5'></a>\ngFortran is now working natively on Apple Silicon (ARM64) `GNU Fortran (Homebrew GCC 10.2.0_2) 10.2.1 20201220`\n\nas part of GCC.\n\n`gcc: stable 10.2.0 (bottled), HEAD GNU compiler collection https://gcc.gnu.org/`",
    "created_at": "2021-01-06T10:36:28Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490880",
    "user": "https://github.com/johnalanwoods"
}
```

<a id='comment:5'></a>
gFortran is now working natively on Apple Silicon (ARM64) `GNU Fortran (Homebrew GCC 10.2.0_2) 10.2.1 20201220`

as part of GCC.

`gcc: stable 10.2.0 (bottled), HEAD GNU compiler collection https://gcc.gnu.org/`



---

archive/issue_comments_490881.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,7 @@\n Need a working Fortran compiler first.\n+\n+Tickets:\n+- #31258 Upgrade cmake to 3.19.3\n \n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n``````\n",
    "created_at": "2021-01-18T04:11:41Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490881",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,7 @@
 Need a working Fortran compiler first.
+
+Tickets:
+- #31258 Upgrade cmake to 3.19.3
 
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
``````




---

archive/issue_comments_490882.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,3 +6,8 @@\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n+\n+See also:\n+- #30494: Meta-ticket: Support Xcode 12\n+- #30651: Meta-ticket: support macOS 11 Big Sur\n+\n``````\n",
    "created_at": "2021-01-18T04:13:12Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490882",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,3 +6,8 @@
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
+
+See also:
+- #30494: Meta-ticket: Support Xcode 12
+- #30651: Meta-ticket: support macOS 11 Big Sur
+
``````




---

archive/issue_events_273997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-273997"
}
```



---

archive/issue_events_273998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-273998"
}
```



---

archive/issue_comments_490883.json:
```json
{
    "body": "<a id='comment:8'></a>\nSage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490883",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_490884.json:
```json
{
    "body": "<a id='comment:9'></a>\nIf I wanted to help test this, what could I do?  I tried upgrading my Sage yesterday (finally!) but ran into problems with pari and some other packages; then I did `make distclean` and now it won't even install gmp, wonderful lines\n\n```\n[gmp-6.2.0] configure: error: Oops, mp_limb_t is 64 bits, but the assembler code\n[gmp-6.2.0] in this configuration expects 32 bits.\n```\nthat look scary.  Anyway, I'd be quite interested in testing anything directly from source that does *not* use Homebrew, which after all the warnings many years ago about Macports and Fink conflicts I'm skeptical of.",
    "created_at": "2021-05-28T12:29:15Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490884",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:9'></a>
If I wanted to help test this, what could I do?  I tried upgrading my Sage yesterday (finally!) but ran into problems with pari and some other packages; then I did `make distclean` and now it won't even install gmp, wonderful lines

```
[gmp-6.2.0] configure: error: Oops, mp_limb_t is 64 bits, but the assembler code
[gmp-6.2.0] in this configuration expects 32 bits.
```
that look scary.  Anyway, I'd be quite interested in testing anything directly from source that does *not* use Homebrew, which after all the warnings many years ago about Macports and Fink conflicts I'm skeptical of.



---

archive/issue_comments_490885.json:
```json
{
    "body": "<a id='comment:10'></a>\nHomebrew is the most popular \"missing package manager\" for macOS, and I really do not understand why you are sceptical about. Sage on x86_64 Homebrew mostly works, with many, many packages used rather than built from source. (Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be \"sceptical\" about it, but it does work.)\n\nMacports doesn't work with Sage, and Fink is mostly dead, IMHO\n\nHomebrew surely does have ready Apple M1 GMP, cf. \nhttps://formulae.brew.sh/formula/gmp#default\n\nMaintaining the Sage status quo - porting patches from Hombrew back to Sage, etc, it's such a waste of time if you ask me.",
    "created_at": "2021-05-28T14:37:01Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490885",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
Homebrew is the most popular "missing package manager" for macOS, and I really do not understand why you are sceptical about. Sage on x86_64 Homebrew mostly works, with many, many packages used rather than built from source. (Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be "sceptical" about it, but it does work.)

Macports doesn't work with Sage, and Fink is mostly dead, IMHO

Homebrew surely does have ready Apple M1 GMP, cf. 
https://formulae.brew.sh/formula/gmp#default

Maintaining the Sage status quo - porting patches from Hombrew back to Sage, etc, it's such a waste of time if you ask me.



---

archive/issue_comments_490886.json:
```json
{
    "body": "<a id='comment:11'></a>\n> Homebrew is the most popular \"missing package manager\" for macOS, and I really do not understand why you are sceptical about. Sage on x86_64 Homebrew mostly works, with many, many packages used rather than built from source. (Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be \"sceptical\" about it, but it does work.)\n\nI guess bad experiences in the past with the other \"managers\" we will not name again - and, separately, liking to maintain ability for Mac users to download source and just type `make`.  But I will give it a try.\n\n---\n\nHowever, as to the main topic of this ticket, is this simply \"use Homebrew/Rosetta\" or is there presumably some other testing I can do to help?",
    "created_at": "2021-05-28T15:38:12Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490886",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:11'></a>
> Homebrew is the most popular "missing package manager" for macOS, and I really do not understand why you are sceptical about. Sage on x86_64 Homebrew mostly works, with many, many packages used rather than built from source. (Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be "sceptical" about it, but it does work.)

I guess bad experiences in the past with the other "managers" we will not name again - and, separately, liking to maintain ability for Mac users to download source and just type `make`.  But I will give it a try.

---

However, as to the main topic of this ticket, is this simply "use Homebrew/Rosetta" or is there presumably some other testing I can do to help?



---

archive/issue_comments_490887.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [@dimpase](#comment%3A10):\n>(Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be \"sceptical\" about it, but it does work.)\n\nJust curious -- is there work underway to make sagemath itself a homebrew package, so one could do \"brew install sagemath\"?  That would be pretty awesome.",
    "created_at": "2021-05-28T15:52:36Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490887",
    "user": "https://github.com/williamstein"
}
```

<a id='comment:12'></a>
Replying to [@dimpase](#comment%3A10):
>(Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be "sceptical" about it, but it does work.)

Just curious -- is there work underway to make sagemath itself a homebrew package, so one could do "brew install sagemath"?  That would be pretty awesome.



---

archive/issue_comments_490888.json:
```json
{
    "body": "<a id='comment:13'></a>\nMaking sage into a homebrew package is on the wishlist. (I don't think anyone is doing anything about it.) I think further discussion of this should go to #29395.",
    "created_at": "2021-05-28T16:14:10Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490888",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:13'></a>
Making sage into a homebrew package is on the wishlist. (I don't think anyone is doing anything about it.) I think further discussion of this should go to #29395.



---

archive/issue_comments_490889.json:
```json
{
    "body": "<a id='comment:14'></a>\nReplying to [@williamstein](#comment%3A12):\n> Replying to [@dimpase](#comment%3A10):\n> >(Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be \"sceptical\" about it, but it does work.)\n\n> \n> Just curious -- is there work underway to make sagemath itself a homebrew package, so one could do \"brew install sagemath\"?  That would be pretty awesome. \n\nI played with creating Homebrew formulae a while ago, see https://github.com/sagemath/homebrew-science/commits/master\n\nIt's not that hard - and in fact e.g. arb and flint made it into mainline Homebrew since I touched this last time. It's more annoying that we sometimes need a variation of what's in Homebrew, e.g. it ships single-threaded Pari, but we need multi-threaded (as that's what giac requires).\n\n\n>",
    "created_at": "2021-05-28T17:07:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490889",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
Replying to [@williamstein](#comment%3A12):
> Replying to [@dimpase](#comment%3A10):
> >(Besides, do you have any idea how much effort went into this, supporting Sage using Homebrew packages? No, well, you many be "sceptical" about it, but it does work.)

> 
> Just curious -- is there work underway to make sagemath itself a homebrew package, so one could do "brew install sagemath"?  That would be pretty awesome. 

I played with creating Homebrew formulae a while ago, see https://github.com/sagemath/homebrew-science/commits/master

It's not that hard - and in fact e.g. arb and flint made it into mainline Homebrew since I touched this last time. It's more annoying that we sometimes need a variation of what's in Homebrew, e.g. it ships single-threaded Pari, but we need multi-threaded (as that's what giac requires).


>



---

archive/issue_comments_490890.json:
```json
{
    "body": "<a id='comment:15'></a>\nReplying to [@kcrisman](#comment%3A11):\n> However, as to the main topic of this ticket, is this simply \"use Homebrew/Rosetta\" or is there presumably some other testing I can do to help?\n\nno, no Rosetta, just pure, unfiltered, Homebrew.\n(Rosetta is an x86_64 emulator, as you might recall)\n\nGive it a try please, I'd like to know how far we are there.",
    "created_at": "2021-05-28T17:10:04Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490890",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
Replying to [@kcrisman](#comment%3A11):
> However, as to the main topic of this ticket, is this simply "use Homebrew/Rosetta" or is there presumably some other testing I can do to help?

no, no Rosetta, just pure, unfiltered, Homebrew.
(Rosetta is an x86_64 emulator, as you might recall)

Give it a try please, I'd like to know how far we are there.



---

archive/issue_comments_490891.json:
```json
{
    "body": "<a id='comment:16'></a>\nby the way, this ticket says \"need gfortran first\" (for M1), but it's already there.\nhttps://formulae.brew.sh/formula/gcc (it's gcc/gfortran 11)",
    "created_at": "2021-05-28T17:12:55Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490891",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:16'></a>
by the way, this ticket says "need gfortran first" (for M1), but it's already there.
https://formulae.brew.sh/formula/gcc (it's gcc/gfortran 11)



---

archive/issue_comments_490892.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,7 +1,8 @@\n-Need a working Fortran compiler first.\n+... on top of homebrew, which provides gfortran 11 and many usable packages.\n \n Tickets:\n - #31258 Upgrade cmake to 3.19.3\n+- #31838 gfortran: Accept system gfortran 11\n \n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n``````\n",
    "created_at": "2021-05-28T17:40:11Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490892",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,7 +1,8 @@
-Need a working Fortran compiler first.
+... on top of homebrew, which provides gfortran 11 and many usable packages.
 
 Tickets:
 - #31258 Upgrade cmake to 3.19.3
+- #31838 gfortran: Accept system gfortran 11
 
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
``````




---

archive/issue_comments_490893.json:
```json
{
    "body": "<a id='comment:18'></a>\n> (Rosetta is an x86_64 emulator, as you might recall)\n\nExactly; so homebrew will be using ARM stuff natively in this case?\n> Give it a try please, I'd like to know how far we are there.\n\nWish I hadn't destroyed my working install :( but I think I have a few old binaries I can use if under duress.  That's why I waited for the semester to finish!\n\n---\n\nI'll post on devel if I achieve anything interesting.  One note in prereqs: With respect to BLAS (mentioned in one of the threads) I get\n\n```\n==> Pouring openblas--0.3.15_1.big_sur.bottle.tar.gz\n==> Caveats\nopenblas is keg-only, which means it was not symlinked into /usr/local,\nbecause macOS provides BLAS in Accelerate.framework.\n\nFor compilers to find openblas you may need to set:\n  export LDFLAGS=\"-L/usr/local/opt/openblas/lib\"\n  export CPPFLAGS=\"-I/usr/local/opt/openblas/include\"\n\nFor pkg-config to find openblas you may need to set:\n  export PKG_CONFIG_PATH=\"/usr/local/opt/openblas/lib/pkgconfig\"\n\n==> Summary\n\ud83c\udf7a  /usr/local/Cellar/openblas/0.3.15_1: 23 files, 120MB\n```\nso hopefully accelerate will continue to work here for Sage as an option.",
    "created_at": "2021-05-28T19:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490893",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:18'></a>
> (Rosetta is an x86_64 emulator, as you might recall)

Exactly; so homebrew will be using ARM stuff natively in this case?
> Give it a try please, I'd like to know how far we are there.

Wish I hadn't destroyed my working install :( but I think I have a few old binaries I can use if under duress.  That's why I waited for the semester to finish!

---

I'll post on devel if I achieve anything interesting.  One note in prereqs: With respect to BLAS (mentioned in one of the threads) I get

```
==> Pouring openblas--0.3.15_1.big_sur.bottle.tar.gz
==> Caveats
openblas is keg-only, which means it was not symlinked into /usr/local,
because macOS provides BLAS in Accelerate.framework.

For compilers to find openblas you may need to set:
  export LDFLAGS="-L/usr/local/opt/openblas/lib"
  export CPPFLAGS="-I/usr/local/opt/openblas/include"

For pkg-config to find openblas you may need to set:
  export PKG_CONFIG_PATH="/usr/local/opt/openblas/lib/pkgconfig"

==> Summary
🍺  /usr/local/Cellar/openblas/0.3.15_1: 23 files, 120MB
```
so hopefully accelerate will continue to work here for Sage as an option.



---

archive/issue_comments_490894.json:
```json
{
    "body": "<a id='comment:19'></a>\nReplying to [@kcrisman](#comment%3A18):\n> > (Rosetta is an x86_64 emulator, as you might recall)\n\n> Exactly; so homebrew will be using ARM stuff natively in this case?\n\nyes. They have a setup for this now (IIRC they use /opt/local for native M1, and /usr/local for Rosetta)\n\n> > Give it a try please, I'd like to know how far we are there.\n\n> Wish I hadn't destroyed my working install :( but I think I have a few old binaries I can use if under duress.  That's why I waited for the semester to finish!\n> \n> \n> ---\n> \n> I'll post on devel if I achieve anything interesting.  One note in prereqs: With respect to BLAS (mentioned in one of the threads) I get\n> \n> ```\n> ==> Pouring openblas--0.3.15_1.big_sur.bottle.tar.gz\n> ==> Caveats\n> openblas is keg-only, which means it was not symlinked into /usr/local,\n> because macOS provides BLAS in Accelerate.framework.\n> \n> For compilers to find openblas you may need to set:\n>   export LDFLAGS=\"-L/usr/local/opt/openblas/lib\"\n>   export CPPFLAGS=\"-I/usr/local/opt/openblas/include\"\n> \n> For pkg-config to find openblas you may need to set:\n>   export PKG_CONFIG_PATH=\"/usr/local/opt/openblas/lib/pkgconfig\"\n> \n> ==> Summary\n> \ud83c\udf7a  /usr/local/Cellar/openblas/0.3.15_1: 23 files, 120MB\n> ```\n> so hopefully accelerate will continue to work here for Sage as an option.\n\nit's not an option if you want to use more external Homebrew packages, which depend on (open)blas.\nAnyhow, sourcing `.homebrew-build-env` should take care of setting everything, including Homebrew's OpenBLAS,\nto be used by Sage.",
    "created_at": "2021-05-29T00:19:57Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490894",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:19'></a>
Replying to [@kcrisman](#comment%3A18):
> > (Rosetta is an x86_64 emulator, as you might recall)

> Exactly; so homebrew will be using ARM stuff natively in this case?

yes. They have a setup for this now (IIRC they use /opt/local for native M1, and /usr/local for Rosetta)

> > Give it a try please, I'd like to know how far we are there.

> Wish I hadn't destroyed my working install :( but I think I have a few old binaries I can use if under duress.  That's why I waited for the semester to finish!
> 
> 
> ---
> 
> I'll post on devel if I achieve anything interesting.  One note in prereqs: With respect to BLAS (mentioned in one of the threads) I get
> 
> ```
> ==> Pouring openblas--0.3.15_1.big_sur.bottle.tar.gz
> ==> Caveats
> openblas is keg-only, which means it was not symlinked into /usr/local,
> because macOS provides BLAS in Accelerate.framework.
> 
> For compilers to find openblas you may need to set:
>   export LDFLAGS="-L/usr/local/opt/openblas/lib"
>   export CPPFLAGS="-I/usr/local/opt/openblas/include"
> 
> For pkg-config to find openblas you may need to set:
>   export PKG_CONFIG_PATH="/usr/local/opt/openblas/lib/pkgconfig"
> 
> ==> Summary
> 🍺  /usr/local/Cellar/openblas/0.3.15_1: 23 files, 120MB
> ```
> so hopefully accelerate will continue to work here for Sage as an option.

it's not an option if you want to use more external Homebrew packages, which depend on (open)blas.
Anyhow, sourcing `.homebrew-build-env` should take care of setting everything, including Homebrew's OpenBLAS,
to be used by Sage.



---

archive/issue_comments_490895.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -3,10 +3,12 @@\n Tickets:\n - #31258 Upgrade cmake to 3.19.3\n - #31838 gfortran: Accept system gfortran 11\n+- #31905 cvxopt: Correct link directory\n \n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n+- https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA\n \n See also:\n - #30494: Meta-ticket: Support Xcode 12\n``````\n",
    "created_at": "2021-06-04T11:27:47Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490895",
    "user": "https://github.com/kcrisman"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -3,10 +3,12 @@
 Tickets:
 - #31258 Upgrade cmake to 3.19.3
 - #31838 gfortran: Accept system gfortran 11
+- #31905 cvxopt: Correct link directory
 
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
+- https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA
 
 See also:
 - #30494: Meta-ticket: Support Xcode 12
``````




---

archive/issue_comments_490896.json:
```json
{
    "body": "<a id='comment:21'></a>\nWe may also need to add `openjpeg` to the list [here](https://doc.sagemath.org/html/en/installation/source.html#macos-recommended-installation).",
    "created_at": "2021-06-04T12:14:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490896",
    "user": "https://github.com/kcrisman"
}
```

<a id='comment:21'></a>
We may also need to add `openjpeg` to the list [here](https://doc.sagemath.org/html/en/installation/source.html#macos-recommended-installation).



---

archive/issue_comments_490897.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [@kcrisman](#comment%3A21):\n> We may also need to add `openjpeg` to the list [here](https://doc.sagemath.org/html/en/installation/source.html#macos-recommended-installation).\n\nI see no need for this. `openjpeg` is an optional dep of Pillow, and thus a problem may arise from a broken install of openjpeg - or no problem arises if `openjpeg` is not installed. But it's not Sage's job to do quality control of every package on a user box...",
    "created_at": "2021-06-07T09:55:04Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490897",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:22'></a>
Replying to [@kcrisman](#comment%3A21):
> We may also need to add `openjpeg` to the list [here](https://doc.sagemath.org/html/en/installation/source.html#macos-recommended-installation).

I see no need for this. `openjpeg` is an optional dep of Pillow, and thus a problem may arise from a broken install of openjpeg - or no problem arises if `openjpeg` is not installed. But it's not Sage's job to do quality control of every package on a user box...



---

archive/issue_comments_490898.json:
```json
{
    "body": "<a id='comment:23'></a>\nWhile we have had a bit of trouble getting complete information, it appears that the current version of the [SageMath](../wiki/SageMath) app (based on rc0) for macOS works fine in the Intel emulation mode on M1 macs.  This was not always the case, but we are now taking care to avoid AVX, AVX2 and BMI instructions unless they are enabled at runtime by the \"fat\" version of gmp.  This appears to eliminate the crashes that were seen before in emulation mode.",
    "created_at": "2021-08-10T21:28:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490898",
    "user": "https://github.com/culler"
}
```

<a id='comment:23'></a>
While we have had a bit of trouble getting complete information, it appears that the current version of the [SageMath](../wiki/SageMath) app (based on rc0) for macOS works fine in the Intel emulation mode on M1 macs.  This was not always the case, but we are now taking care to avoid AVX, AVX2 and BMI instructions unless they are enabled at runtime by the "fat" version of gmp.  This appears to eliminate the crashes that were seen before in emulation mode.



---

archive/issue_events_273999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-273999"
}
```



---

archive/issue_events_274000.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-22T20:35:10Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274000"
}
```



---

archive/issue_comments_490899.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -4,7 +4,7 @@\n - #31258 Upgrade cmake to 3.19.3\n - #31838 gfortran: Accept system gfortran 11\n - #31905 cvxopt: Correct link directory\n-\n+- #32796 gmp: update to 6.2.1\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2021-10-30T10:49:49Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490899",
    "user": "https://github.com/dimpase"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -4,7 +4,7 @@
 - #31258 Upgrade cmake to 3.19.3
 - #31838 gfortran: Accept system gfortran 11
 - #31905 cvxopt: Correct link directory
-
+- #32796 gmp: update to 6.2.1
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490900.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -5,6 +5,7 @@\n - #31838 gfortran: Accept system gfortran 11\n - #31905 cvxopt: Correct link directory\n - #32796 gmp: update to 6.2.1\n+- #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2021-11-03T04:57:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490900",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -5,6 +5,7 @@
 - #31838 gfortran: Accept system gfortran 11
 - #31905 cvxopt: Correct link directory
 - #32796 gmp: update to 6.2.1
+- #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490901.json:
```json
{
    "body": "<a id='comment:27'></a>\nApparently our Openblas build fails on M1, see\nhttps://groups.google.com/g/sage-support/c/XwGF584P7EY/m/MsN6mfWkAQAJ",
    "created_at": "2021-12-09T10:16:39Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490901",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
Apparently our Openblas build fails on M1, see
https://groups.google.com/g/sage-support/c/XwGF584P7EY/m/MsN6mfWkAQAJ



---

archive/issue_comments_490902.json:
```json
{
    "body": "<a id='comment:28'></a>\nIt would probably be a good idea if people who have access to M1 hardware test the current beta, as we are getting closer to the 9.5 release.",
    "created_at": "2021-12-27T18:05:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490902",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
It would probably be a good idea if people who have access to M1 hardware test the current beta, as we are getting closer to the 9.5 release.



---

archive/issue_comments_490903.json:
```json
{
    "body": "<a id='comment:29'></a>\nKeen to test. Any build instructions for M1/Pro/Max?\n\nOr is the a binary?",
    "created_at": "2021-12-27T18:18:45Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490903",
    "user": "https://github.com/johnalanwoods"
}
```

<a id='comment:29'></a>
Keen to test. Any build instructions for M1/Pro/Max?

Or is the a binary?



---

archive/issue_comments_490904.json:
```json
{
    "body": "<a id='comment:30'></a>\nFollow the instructions for build from source in README.md, using homebrew; just mildly updated in #29784",
    "created_at": "2021-12-27T18:31:50Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490904",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Follow the instructions for build from source in README.md, using homebrew; just mildly updated in #29784



---

archive/issue_comments_490905.json:
```json
{
    "body": "<a id='comment:31'></a>\n@mkoeppe - apologies can\u2019t seem to find the brew instructions. Do I just build from src with \u2014HEAD?",
    "created_at": "2021-12-28T08:41:18Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490905",
    "user": "https://github.com/johnalanwoods"
}
```

<a id='comment:31'></a>
@mkoeppe - apologies can’t seem to find the brew instructions. Do I just build from src with —HEAD?



---

archive/issue_comments_490906.json:
```json
{
    "body": "<a id='comment:32'></a>\nhave homebrew installed, then\n\n```\nsource .homebrew-build-env\n./bootstrap\n./configure\n```\npay attention to last pages of output of two latter commands, install packages they recommend, in the latter case, \nrerun\n\n```\n./bootstrap && ./configure\n```\nthen\n\n```\nmake build\n```",
    "created_at": "2021-12-28T11:06:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490906",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>
have homebrew installed, then

```
source .homebrew-build-env
./bootstrap
./configure
```
pay attention to last pages of output of two latter commands, install packages they recommend, in the latter case, 
rerun

```
./bootstrap && ./configure
```
then

```
make build
```



---

archive/issue_comments_490907.json:
```json
{
    "body": "<a id='comment:33'></a>\nBuild failures reported in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/0uGyfSKUAAAJ with 9.5.rc1",
    "created_at": "2022-01-16T22:12:04Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490907",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
Build failures reported in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/0uGyfSKUAAAJ with 9.5.rc1



---

archive/issue_events_274001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-01-16T22:12:18Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "label": "critical",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274001"
}
```



---

archive/issue_comments_490908.json:
```json
{
    "body": "<a id='comment:35'></a>\nFrom the logs posted there: Build failure `primecountpy`\n\n```\n  creating build/temp.macosx-11.6-arm64-3.9/primecountpy\n  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -I/opt/homebrew/opt/openssl@3/include -I/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/cysignals -I/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/include/python3.9 -c primecountpy/primecount.cpp -o build/temp.macosx-11.6-arm64-3.9/primecountpy/primecount.o\n  g++ -bundle -undefined dynamic_lookup -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib -L. -L/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -g -O2 -I/opt/homebrew/opt/openssl@3/include build/temp.macosx-11.6-arm64-3.9/primecountpy/primecount.o -L/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib -lprimesieve -lprimecount -o build/lib.macosx-11.6-arm64-3.9/primecountpy/primecount.cpython-39-darwin.so -lpari\n  ld: library not found for -lprimesieve\n  clang: error: linker command failed with exit code 1 (use -v to see invocation)\n  error: command '/usr/bin/g++' failed with exit code 1\n  Building wheel for primecountpy (pyproject.toml): finished with status 'error'\n  ERROR: Failed building wheel for primecountpy\nFailed to build primecountpy\nERROR: Failed to build one or more wheels\n```\nAccording to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.",
    "created_at": "2022-01-16T22:14:14Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
From the logs posted there: Build failure `primecountpy`

```
  creating build/temp.macosx-11.6-arm64-3.9/primecountpy
  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -DNDEBUG -g -fwrapv -O3 -Wall -Wno-unused -g -O2 -g -O2 -I/opt/homebrew/opt/openssl@3/include -I/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib/python3.9/site-packages/cysignals -I/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/include/python3.9 -c primecountpy/primecount.cpp -o build/temp.macosx-11.6-arm64-3.9/primecountpy/primecount.o
  g++ -bundle -undefined dynamic_lookup -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib -L. -L/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/opt/openssl@3/lib -g -O2 -I/opt/homebrew/opt/openssl@3/include build/temp.macosx-11.6-arm64-3.9/primecountpy/primecount.o -L/Users/gms/sage/sage-9.5.rc1/local/var/lib/sage/venv-python3.9.9/lib -lprimesieve -lprimecount -o build/lib.macosx-11.6-arm64-3.9/primecountpy/primecount.cpython-39-darwin.so -lpari
  ld: library not found for -lprimesieve
  clang: error: linker command failed with exit code 1 (use -v to see invocation)
  error: command '/usr/bin/g++' failed with exit code 1
  Building wheel for primecountpy (pyproject.toml): finished with status 'error'
  ERROR: Failed building wheel for primecountpy
Failed to build primecountpy
ERROR: Failed to build one or more wheels
```
According to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.



---

archive/issue_comments_490909.json:
```json
{
    "body": "<a id='comment:36'></a>\nBuild failure `m4ri`\n\n```\nchecking whether to build with PNG support... yes\nchecking for pkg-config... /opt/homebrew/bin/pkg-config\nchecking pkg-config is at least version 0.9.0... yes\nchecking for PNG... yes\n...\n/bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I./m4ri   -I/opt/homebrew/opt/openssl@3/include    -g -O2 -I/Users/gms/sage/sage-9.5.rc1/local/include -g -fPIC -Wall -pedantic -c -o m4ri/io.lo m4ri/io.c\nlibtool: compile:  gcc -DHAVE_CONFIG_H -I. -I./m4ri -I/opt/homebrew/opt/openssl@3/include -g -O2 -I/Users/gms/sage/sage-9.5.rc1/local/include -g -fPIC -Wall -pedantic -c m4ri/io.c  -fno-common -DPIC -o m4ri/.libs/io.o\nm4ri/io.c:28:10: fatal error: 'png.h' file not found\n#include <png.h>\n         ^~~~~~~\n1 error generated.\n```\n\nSame error for `tachyon`.",
    "created_at": "2022-01-16T22:21:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490909",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:36'></a>
Build failure `m4ri`

```
checking whether to build with PNG support... yes
checking for pkg-config... /opt/homebrew/bin/pkg-config
checking pkg-config is at least version 0.9.0... yes
checking for PNG... yes
...
/bin/bash ./libtool  --tag=CC   --mode=compile gcc -DHAVE_CONFIG_H -I. -I./m4ri   -I/opt/homebrew/opt/openssl@3/include    -g -O2 -I/Users/gms/sage/sage-9.5.rc1/local/include -g -fPIC -Wall -pedantic -c -o m4ri/io.lo m4ri/io.c
libtool: compile:  gcc -DHAVE_CONFIG_H -I. -I./m4ri -I/opt/homebrew/opt/openssl@3/include -g -O2 -I/Users/gms/sage/sage-9.5.rc1/local/include -g -fPIC -Wall -pedantic -c m4ri/io.c  -fno-common -DPIC -o m4ri/.libs/io.o
m4ri/io.c:28:10: fatal error: 'png.h' file not found
#include <png.h>
         ^~~~~~~
1 error generated.
```

Same error for `tachyon`.



---

archive/issue_comments_490910.json:
```json
{
    "body": "<a id='comment:37'></a>\nReplying to [@mkoeppe](#comment%3A35):\n> According to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.\n\nDo you mean sage `primesieve` and `primecount` rather than \"system\".",
    "created_at": "2022-01-16T22:25:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490910",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:37'></a>
Replying to [@mkoeppe](#comment%3A35):
> According to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.

Do you mean sage `primesieve` and `primecount` rather than "system".



---

archive/issue_comments_490911.json:
```json
{
    "body": "<a id='comment:38'></a>\nBuild failure `libhomfly`\n\n```\n/bin/bash ../libtool  --tag=CC   --mode=compile gcc -DPACKAGE_NAME=\\\"libhomfly\\\" -DPACKAGE_TARNAME=\\\"libhomfly\\\" -DPACKAGE_VERSION=\\\"1.02r6\\\" -DPACKAGE_STRING=\\\"libhomfly\\ 1.02r6\\\" -DPACKAGE_BUGREPORT=\\\"mmarco@unizar.es\\\" -DPACKAGE_URL=\\\"\\\" -DPACKAGE=\\\"libhomfly\\\" -DVERSION=\\\"1.02r6\\\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\\\".libs/\\\" -I.   -I/opt/homebrew/opt/openssl@3/include  -g -O2 -c -o control.lo control.c\ncontrol.c:8:10: fatal error: 'gc.h' file not found\n#include <gc.h>\n         ^~~~~~\n```\n\nFrom top-level config.log:\n\n```\nconfigure:19776: $PKG_CONFIG --exists --print-errors \"bdw-gc >= 7.6.4\"\nconfigure:19779: $? = 0\nconfigure:19819: result: yes\nconfigure:19917: will use system package and not install SPKG gc\n```\nThis appears to be another case of our `configure` forgetting to tell packages where the stuff is that it found.",
    "created_at": "2022-01-16T22:28:31Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:38'></a>
Build failure `libhomfly`

```
/bin/bash ../libtool  --tag=CC   --mode=compile gcc -DPACKAGE_NAME=\"libhomfly\" -DPACKAGE_TARNAME=\"libhomfly\" -DPACKAGE_VERSION=\"1.02r6\" -DPACKAGE_STRING=\"libhomfly\ 1.02r6\" -DPACKAGE_BUGREPORT=\"mmarco@unizar.es\" -DPACKAGE_URL=\"\" -DPACKAGE=\"libhomfly\" -DVERSION=\"1.02r6\" -DSTDC_HEADERS=1 -DHAVE_SYS_TYPES_H=1 -DHAVE_SYS_STAT_H=1 -DHAVE_STDLIB_H=1 -DHAVE_STRING_H=1 -DHAVE_MEMORY_H=1 -DHAVE_STRINGS_H=1 -DHAVE_INTTYPES_H=1 -DHAVE_STDINT_H=1 -DHAVE_UNISTD_H=1 -DHAVE_DLFCN_H=1 -DLT_OBJDIR=\".libs/\" -I.   -I/opt/homebrew/opt/openssl@3/include  -g -O2 -c -o control.lo control.c
control.c:8:10: fatal error: 'gc.h' file not found
#include <gc.h>
         ^~~~~~
```

From top-level config.log:

```
configure:19776: $PKG_CONFIG --exists --print-errors "bdw-gc >= 7.6.4"
configure:19779: $? = 0
configure:19819: result: yes
configure:19917: will use system package and not install SPKG gc
```
This appears to be another case of our `configure` forgetting to tell packages where the stuff is that it found.



---

archive/issue_comments_490912.json:
```json
{
    "body": "<a id='comment:39'></a>\nReplying to [@kiwifb](#comment%3A37):\n> Replying to [@mkoeppe](#comment%3A35):\n> > According to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.\n\n> \n> Do you mean sage `primesieve` and `primecount` rather than \"system\".\n\nNo, primesieve is from homebrew",
    "created_at": "2022-01-16T22:29:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:39'></a>
Replying to [@kiwifb](#comment%3A37):
> Replying to [@mkoeppe](#comment%3A35):
> > According to `config.log` posted there, that's with system `cmake` and system `primesieve`, and `primecount` installed from SPKG.

> 
> Do you mean sage `primesieve` and `primecount` rather than "system".

No, primesieve is from homebrew



---

archive/issue_comments_490913.json:
```json
{
    "body": "<a id='comment:40'></a>\nOK, I am now parsing that sentence correctly :)",
    "created_at": "2022-01-16T22:30:50Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490913",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:40'></a>
OK, I am now parsing that sentence correctly :)



---

archive/issue_comments_490914.json:
```json
{
    "body": "<a id='comment:41'></a>\nProposed fix in #33191",
    "created_at": "2022-01-16T22:47:28Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Proposed fix in #33191



---

archive/issue_comments_490915.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n - #31905 cvxopt: Correct link directory\n - #32796 gmp: update to 6.2.1\n - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n+- #33191 Fix build errors on Apple Silicon with homebrew\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2022-01-16T22:52:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490915",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 - #31905 cvxopt: Correct link directory
 - #32796 gmp: update to 6.2.1
 - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
+- #33191 Fix build errors on Apple Silicon with homebrew
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490916.json:
```json
{
    "body": "<a id='comment:43'></a>\nNext failure, reported in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/j660ZbCmAAAJ: `iml`\n\n```\nDefault checking path = /Users/gms/sage/sage-9.5.rc1/local /usr /usr/local\nchecking for GMP >= 3.1.1... found\nchecking whether GMP is 4.0 or greater... yes\n[...]\n/bin/bash ../libtool --tag=CC   --mode=link gcc -I///opt/homebrew/include -I.  -I. -g -O2 -version-info 1:1:1  -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib  -lm -o libiml.la -rpath /Users/gms/sage/sage-9.5.rc1/local/lib libiml_la-basisop.lo libiml_la-certsolve.lo libiml_la-error.lo libiml_la-latreduce.lo libiml_la-memalloc.lo libiml_la-mtrans.lo libiml_la-nonsysolve.lo libiml_la-padiclift.lo libiml_la-reconsolu.lo libiml_la-RNSop.lo libiml_la-nullspace.lo -L///opt/homebrew/lib -lgmp -L/Users/gms/sage/sage-9.5.rc1/local/lib -lgmp -L/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/Cellar/openblas/0.3.19/lib -lopenblas   \nlibtool: link: gcc -dynamiclib -Wl,-flat_namespace -Wl,-undefined -Wl,suppress -o .libs/libiml.0.dylib  .libs/libiml_la-basisop.o .libs/libiml_la-certsolve.o .libs/libiml_la-error.o .libs/libiml_la-latreduce.o .libs/libiml_la-memalloc.o .libs/libiml_la-mtrans.o .libs/libiml_la-nonsysolve.o .libs/libiml_la-padiclift.o .libs/libiml_la-reconsolu.o .libs/libiml_la-RNSop.o .libs/libiml_la-nullspace.o   -L/Users/gms/sage/sage-9.5.rc1/local/lib -lm -L///opt/homebrew/lib -lgmp -L/opt/homebrew/Cellar/openblas/0.3.19/lib -lopenblas  -O2 -Wl,-rpath -Wl,/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath -Wl,/Users/gms/sage/sage-9.5.rc1/local/lib   -install_name  /Users/gms/sage/sage-9.5.rc1/local/lib/libiml.0.dylib -compatibility_version 2 -current_version 2.1 -Wl,-single_module\nld: warning: dylib (/opt/homebrew/opt/gcc/lib/gcc/11/libgfortran.5.dylib) was built for newer macOS version (11.5) than being linked (11.0)\nld: warning: dylib (/opt/homebrew/opt/gcc/lib/gcc/11/libgomp.1.dylib) was built for newer macOS version (11.5) than being linked (11.0)\nld: file not found: @rpath/libgcc_s.1.1.dylib for architecture arm64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\nmake[5]: *** [libiml.la] Error 1\n```",
    "created_at": "2022-01-17T03:26:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490916",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Next failure, reported in https://groups.google.com/g/sage-release/c/8ctwsUGl6LQ/m/j660ZbCmAAAJ: `iml`

```
Default checking path = /Users/gms/sage/sage-9.5.rc1/local /usr /usr/local
checking for GMP >= 3.1.1... found
checking whether GMP is 4.0 or greater... yes
[...]
/bin/bash ../libtool --tag=CC   --mode=link gcc -I///opt/homebrew/include -I.  -I. -g -O2 -version-info 1:1:1  -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib -L/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath,/Users/gms/sage/sage-9.5.rc1/local/lib  -lm -o libiml.la -rpath /Users/gms/sage/sage-9.5.rc1/local/lib libiml_la-basisop.lo libiml_la-certsolve.lo libiml_la-error.lo libiml_la-latreduce.lo libiml_la-memalloc.lo libiml_la-mtrans.lo libiml_la-nonsysolve.lo libiml_la-padiclift.lo libiml_la-reconsolu.lo libiml_la-RNSop.lo libiml_la-nullspace.lo -L///opt/homebrew/lib -lgmp -L/Users/gms/sage/sage-9.5.rc1/local/lib -lgmp -L/Users/gms/sage/sage-9.5.rc1/local/lib -L/opt/homebrew/Cellar/openblas/0.3.19/lib -lopenblas   
libtool: link: gcc -dynamiclib -Wl,-flat_namespace -Wl,-undefined -Wl,suppress -o .libs/libiml.0.dylib  .libs/libiml_la-basisop.o .libs/libiml_la-certsolve.o .libs/libiml_la-error.o .libs/libiml_la-latreduce.o .libs/libiml_la-memalloc.o .libs/libiml_la-mtrans.o .libs/libiml_la-nonsysolve.o .libs/libiml_la-padiclift.o .libs/libiml_la-reconsolu.o .libs/libiml_la-RNSop.o .libs/libiml_la-nullspace.o   -L/Users/gms/sage/sage-9.5.rc1/local/lib -lm -L///opt/homebrew/lib -lgmp -L/opt/homebrew/Cellar/openblas/0.3.19/lib -lopenblas  -O2 -Wl,-rpath -Wl,/Users/gms/sage/sage-9.5.rc1/local/lib -Wl,-rpath -Wl,/Users/gms/sage/sage-9.5.rc1/local/lib   -install_name  /Users/gms/sage/sage-9.5.rc1/local/lib/libiml.0.dylib -compatibility_version 2 -current_version 2.1 -Wl,-single_module
ld: warning: dylib (/opt/homebrew/opt/gcc/lib/gcc/11/libgfortran.5.dylib) was built for newer macOS version (11.5) than being linked (11.0)
ld: warning: dylib (/opt/homebrew/opt/gcc/lib/gcc/11/libgomp.1.dylib) was built for newer macOS version (11.5) than being linked (11.0)
ld: file not found: @rpath/libgcc_s.1.1.dylib for architecture arm64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[5]: *** [libiml.la] Error 1
```



---

archive/issue_comments_490917.json:
```json
{
    "body": "<a id='comment:44'></a>\nI have seen that one posted before. I am not sure how to fix it without talking to homebrew people about how they build their gcc/gfortran.",
    "created_at": "2022-01-17T03:28:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490917",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:44'></a>
I have seen that one posted before. I am not sure how to fix it without talking to homebrew people about how they build their gcc/gfortran.



---

archive/issue_comments_490918.json:
```json
{
    "body": "<a id='comment:45'></a>\nYes, I thought so too, found it in https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA/m/BpNMpD-yAAAJ",
    "created_at": "2022-01-17T03:33:41Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490918",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:45'></a>
Yes, I thought so too, found it in https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA/m/BpNMpD-yAAAJ



---

archive/issue_comments_490919.json:
```json
{
    "body": "<a id='comment:46'></a>\nI do not know if this can be related:\n\nAfter\n`sudo ln -s /opt/homebrew/lib lib`\nin `/usr/local` (see https://github.com/apaffenholz/homebrew-polymake/issues/3)\nthis works\n\n`brew install apaffenholz/polymake/polymake`\n\n(suggested by `./configure`).",
    "created_at": "2022-01-17T03:49:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490919",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:46'></a>
I do not know if this can be related:

After
`sudo ln -s /opt/homebrew/lib lib`
in `/usr/local` (see https://github.com/apaffenholz/homebrew-polymake/issues/3)
this works

`brew install apaffenholz/polymake/polymake`

(suggested by `./configure`).



---

archive/issue_comments_490920.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,7 @@\n - #32796 gmp: update to 6.2.1\n - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n - #33191 Fix build errors on Apple Silicon with homebrew\n+- #33194 `openblas`: Update to 0.3.19\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2022-01-17T03:59:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490920",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,7 @@
 - #32796 gmp: update to 6.2.1
 - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
 - #33191 Fix build errors on Apple Silicon with homebrew
+- #33194 `openblas`: Update to 0.3.19
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490921.json:
```json
{
    "body": "<a id='comment:48'></a>\nI have restarted the whole process, with the fix #33191.\n\n`iml` was still failing, so I have done\n\n`MACOSX_DEPLOYMENT_TARGET=11.2 make`\n\nas indicated in https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA/m/BpNMpD-yAAAJ and there is no error about installing packages, but the building fails.  Logs attached as soon as I find how to do it.",
    "created_at": "2022-01-17T04:44:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490921",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:48'></a>
I have restarted the whole process, with the fix #33191.

`iml` was still failing, so I have done

`MACOSX_DEPLOYMENT_TARGET=11.2 make`

as indicated in https://groups.google.com/g/sage-devel/c/6LldEeJu3ZA/m/BpNMpD-yAAAJ and there is no error about installing packages, but the building fails.  Logs attached as soon as I find how to do it.



---

archive/issue_comments_490922.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,7 +7,6 @@\n - #32796 gmp: update to 6.2.1\n - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n - #33191 Fix build errors on Apple Silicon with homebrew\n-- #33194 `openblas`: Update to 0.3.19\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2022-01-17T04:44:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490922",
    "user": "https://github.com/GMS103"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,7 +7,6 @@
 - #32796 gmp: update to 6.2.1
 - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
 - #33191 Fix build errors on Apple Silicon with homebrew
-- #33194 `openblas`: Update to 0.3.19
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490923.json:
```json
{
    "body": "<a id='comment:49'></a>\nUpdate of iml (#33195) might be worth trying",
    "created_at": "2022-01-17T04:45:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490923",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
Update of iml (#33195) might be worth trying



---

archive/attachments_022134.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "config.log",
    "asset_url": "tarball://root/attachments/ticket30592/config.log",
    "created_at": "2022-01-17T04:52:40Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/config.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490924.json:
```json
{
    "body": "**Attachment:** [config.log](https://github.com/sagemath/sage/files/ticket30592/config.log)",
    "created_at": "2022-01-17T04:52:40Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490924",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [config.log](https://github.com/sagemath/sage/files/ticket30592/config.log)



---

archive/attachments_022135.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "install.log",
    "asset_url": "tarball://root/attachments/ticket30592/install.log",
    "created_at": "2022-01-17T04:53:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/install.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/attachments_022136.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "sagelib-9.5.rc1.log",
    "asset_url": "tarball://root/attachments/ticket30592/sagelib-9.5.rc1.log",
    "created_at": "2022-01-17T04:53:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/sagelib-9.5.rc1.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490925.json:
```json
{
    "body": "**Attachment:** [install.log](https://github.com/sagemath/sage/files/ticket30592/install.log)\n\n**Attachment:** [sagelib-9.5.rc1.log](https://github.com/sagemath/sage/files/ticket30592/sagelib-9.5.rc1.log)",
    "created_at": "2022-01-17T04:53:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490925",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [install.log](https://github.com/sagemath/sage/files/ticket30592/install.log)

**Attachment:** [sagelib-9.5.rc1.log](https://github.com/sagemath/sage/files/ticket30592/sagelib-9.5.rc1.log)



---

archive/issue_comments_490926.json:
```json
{
    "body": "<a id='comment:50'></a>\nSo `iml` went through without errors?",
    "created_at": "2022-01-17T04:54:37Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490926",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:50'></a>
So `iml` went through without errors?



---

archive/issue_comments_490927.json:
```json
{
    "body": "<a id='comment:51'></a>\nThe errors in sagelib are:\n\n```\nld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture arm64\n```",
    "created_at": "2022-01-17T04:56:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490927",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:51'></a>
The errors in sagelib are:

```
ld: illegal thread local variable reference to regular symbol __ZN3NTL8ZZ_pInfoE for architecture arm64
```



---

archive/issue_comments_490928.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [@mkoeppe](#comment%3A50):\n> So `iml` went through without errors?\n\nYes!",
    "created_at": "2022-01-17T04:58:10Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490928",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:52'></a>
Replying to [@mkoeppe](#comment%3A50):
> So `iml` went through without errors?

Yes!



---

archive/issue_comments_490929.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -7,6 +7,9 @@\n - #32796 gmp: update to 6.2.1\n - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3\n - #33191 Fix build errors on Apple Silicon with homebrew\n+- #33195 iml: Refresh build scripts with current autotools\n+- #33194 openblas: Update to 0.3.19\n+\n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY\n``````\n",
    "created_at": "2022-01-17T05:21:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490929",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -7,6 +7,9 @@
 - #32796 gmp: update to 6.2.1
 - #32815 Update `numpy` to 1.21.3, `networkx` to 2.6.3
 - #33191 Fix build errors on Apple Silicon with homebrew
+- #33195 iml: Refresh build scripts with current autotools
+- #33194 openblas: Update to 0.3.19
+
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
 - https://groups.google.com/g/sage-devel/c/_vYkTlLRWWY
``````




---

archive/issue_comments_490930.json:
```json
{
    "body": "<a id='comment:54'></a>\nIf you have a chance, please test if #33195 fixes iml (without setting `MACOSX_DEPLOYMENT_TARGET`)",
    "created_at": "2022-01-17T05:24:39Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490930",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>
If you have a chance, please test if #33195 fixes iml (without setting `MACOSX_DEPLOYMENT_TARGET`)



---

archive/issue_comments_490931.json:
```json
{
    "body": "<a id='comment:55'></a>\nReplying to [@mkoeppe](#comment%3A54):\n> If you have a chance, please test if #33195 fixes iml (without setting `MACOSX_DEPLOYMENT_TARGET`)\n\nI have cloned the git repository.\n\nCould you please tell me how to apply #33195?",
    "created_at": "2022-01-17T05:38:10Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490931",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:55'></a>
Replying to [@mkoeppe](#comment%3A54):
> If you have a chance, please test if #33195 fixes iml (without setting `MACOSX_DEPLOYMENT_TARGET`)

I have cloned the git repository.

Could you please tell me how to apply #33195?



---

archive/issue_comments_490932.json:
```json
{
    "body": "<a id='comment:56'></a>\n\n```\ngit remote add trac git://trac.sagemath.org/sage.git\ngit fetch trac u/mkoeppe/iml__update_to_1_0_5\ngit merge -m \"Merge #33195\" FETCH_HEAD\n./bootstrap\n./configure --enable-download-from-upstream-url\n```",
    "created_at": "2022-01-17T05:42:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490932",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:56'></a>

```
git remote add trac git://trac.sagemath.org/sage.git
git fetch trac u/mkoeppe/iml__update_to_1_0_5
git merge -m "Merge #33195" FETCH_HEAD
./bootstrap
./configure --enable-download-from-upstream-url
```



---

archive/issue_comments_490933.json:
```json
{
    "body": "<a id='comment:57'></a>\nReplying to [@mkoeppe](#comment%3A56):\n> \n> ```\n> git remote add trac git://trac.sagemath.org/sage.git\n> git fetch trac u/mkoeppe/iml__update_to_1_0_5\n> git merge -m \"Merge #33195\" FETCH_HEAD\n> ./bootstrap\n> ./configure --enable-download-from-upstream-url\n> ```\n\nThanks, `make` running.",
    "created_at": "2022-01-17T05:54:06Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490933",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:57'></a>
Replying to [@mkoeppe](#comment%3A56):
> 
> ```
> git remote add trac git://trac.sagemath.org/sage.git
> git fetch trac u/mkoeppe/iml__update_to_1_0_5
> git merge -m "Merge #33195" FETCH_HEAD
> ./bootstrap
> ./configure --enable-download-from-upstream-url
> ```

Thanks, `make` running.



---

archive/issue_comments_490934.json:
```json
{
    "body": "<a id='comment:58'></a>\n`[iml-1.0.4p2.p2] successfully installed.`\nSo your patch works.",
    "created_at": "2022-01-17T06:02:14Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490934",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:58'></a>
`[iml-1.0.4p2.p2] successfully installed.`
So your patch works.



---

archive/issue_comments_490935.json:
```json
{
    "body": "<a id='comment:59'></a>\nThanks for testing!",
    "created_at": "2022-01-17T06:03:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490935",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:59'></a>
Thanks for testing!



---

archive/issue_comments_490936.json:
```json
{
    "body": "<a id='comment:60'></a>\nNext it would be worth checking if #33194 (branch `u/mkoeppe/openblas__update_to_0_3_19`) fixes the build of `openblas` when `./configure --enable-download-from-upstream-url --without-system-openblas` is in use.",
    "created_at": "2022-01-17T06:18:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490936",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>
Next it would be worth checking if #33194 (branch `u/mkoeppe/openblas__update_to_0_3_19`) fixes the build of `openblas` when `./configure --enable-download-from-upstream-url --without-system-openblas` is in use.



---

archive/issue_comments_490937.json:
```json
{
    "body": "<a id='comment:61'></a>\n\n```\nreal\t26m34.164s\nuser\t113m56.740s\nsys\t13m19.283s\nSage build/upgrade complete!\n```\nAnd thanks to you (all of you).",
    "created_at": "2022-01-17T06:21:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490937",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:61'></a>

```
real	26m34.164s
user	113m56.740s
sys	13m19.283s
Sage build/upgrade complete!
```
And thanks to you (all of you).



---

archive/issue_comments_490938.json:
```json
{
    "body": "<a id='comment:62'></a>\nReplying to [@GMS103](#comment%3A61):\n> \n> ```\n> real\t26m34.164s\n> user\t113m56.740s\n> sys\t13m19.283s\n> Sage build/upgrade complete!\n> ```\n> And thanks to you (all of you).\n\nGreat! So the issue with `ntl` from [comment:51](#comment%3A51) didn't show up in this build.",
    "created_at": "2022-01-17T06:24:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490938",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:62'></a>
Replying to [@GMS103](#comment%3A61):
> 
> ```
> real	26m34.164s
> user	113m56.740s
> sys	13m19.283s
> Sage build/upgrade complete!
> ```
> And thanks to you (all of you).

Great! So the issue with `ntl` from [comment:51](#comment%3A51) didn't show up in this build.



---

archive/issue_comments_490939.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [@mkoeppe](#comment%3A60):\n> Next it would be worth checking if #33194 (branch `u/mkoeppe/openblas__update_to_0_3_19`) fixes the build of `openblas` when `./configure --enable-download-from-upstream-url --without-system-openblas` is in use.\n\n`make` running.",
    "created_at": "2022-01-17T06:27:41Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490939",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:63'></a>
Replying to [@mkoeppe](#comment%3A60):
> Next it would be worth checking if #33194 (branch `u/mkoeppe/openblas__update_to_0_3_19`) fixes the build of `openblas` when `./configure --enable-download-from-upstream-url --without-system-openblas` is in use.

`make` running.



---

archive/issue_comments_490940.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [@mkoeppe](#comment%3A62):\n> Replying to [@GMS103](#comment%3A61):\n> > \n> > ```\n> > real\t26m34.164s\n> > user\t113m56.740s\n> > sys\t13m19.283s\n> > Sage build/upgrade complete!\n> > ```\n> > And thanks to you (all of you).\n\n> \n> Great! So the issue with `ntl` from [comment:51](#comment%3A51) didn't show up in this build.\n\nNo, everything went smoothly.",
    "created_at": "2022-01-17T06:29:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490940",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:64'></a>
Replying to [@mkoeppe](#comment%3A62):
> Replying to [@GMS103](#comment%3A61):
> > 
> > ```
> > real	26m34.164s
> > user	113m56.740s
> > sys	13m19.283s
> > Sage build/upgrade complete!
> > ```
> > And thanks to you (all of you).

> 
> Great! So the issue with `ntl` from [comment:51](#comment%3A51) didn't show up in this build.

No, everything went smoothly.



---

archive/issue_comments_490941.json:
```json
{
    "body": "<a id='comment:65'></a>\nAfter\n\n```\ngit fetch trac u/mkoeppe/openblas__update_to_0_3_19\ngit merge -m \"Merge #33194\" FETCH_HEAD\n./bootstrap \n./configure --enable-download-from-upstream-url --without-system-openblas\n```\n`make` gives an error for `openblas`:\n\n```\n[openblas-0.3.19]   make[6]: *** No rule to make target `../kernel/arm64/amin.S', needed by `samin_k.o'.  Stop.\n```",
    "created_at": "2022-01-17T06:33:17Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490941",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:65'></a>
After

```
git fetch trac u/mkoeppe/openblas__update_to_0_3_19
git merge -m "Merge #33194" FETCH_HEAD
./bootstrap 
./configure --enable-download-from-upstream-url --without-system-openblas
```
`make` gives an error for `openblas`:

```
[openblas-0.3.19]   make[6]: *** No rule to make target `../kernel/arm64/amin.S', needed by `samin_k.o'.  Stop.
```



---

archive/attachments_022137.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "config.2.log",
    "asset_url": "tarball://root/attachments/ticket30592/config.2.log",
    "created_at": "2022-01-17T06:34:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/config.2.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490942.json:
```json
{
    "body": "**Attachment:** [config.2.log](https://github.com/sagemath/sage/files/ticket30592/config.2.log)",
    "created_at": "2022-01-17T06:34:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490942",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [config.2.log](https://github.com/sagemath/sage/files/ticket30592/config.2.log)



---

archive/attachments_022138.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "install.2.log",
    "asset_url": "tarball://root/attachments/ticket30592/install.2.log",
    "created_at": "2022-01-17T06:35:09Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/install.2.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490943.json:
```json
{
    "body": "**Attachment:** [install.2.log](https://github.com/sagemath/sage/files/ticket30592/install.2.log)",
    "created_at": "2022-01-17T06:35:09Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490943",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [install.2.log](https://github.com/sagemath/sage/files/ticket30592/install.2.log)



---

archive/attachments_022139.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "openblas-0.3.19.log",
    "asset_url": "tarball://root/attachments/ticket30592/openblas-0.3.19.log",
    "created_at": "2022-01-17T06:59:58Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/openblas-0.3.19.log",
    "user": "https://github.com/mkoeppe"
}
```



---

archive/issue_comments_490944.json:
```json
{
    "body": "<a id='comment:66'></a>\n**Attachment:** [openblas-0.3.19.log](https://github.com/sagemath/sage/files/ticket30592/openblas-0.3.19.log)\n\nThis looks similar to https://trac.macports.org/ticket/61700; it sounds like we would have to configure openblas differently. We can probably get this from homebrew's build script. This won't make it into Sage 9.5.\n\nThanks again for testing!",
    "created_at": "2022-01-17T06:59:58Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490944",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:66'></a>
**Attachment:** [openblas-0.3.19.log](https://github.com/sagemath/sage/files/ticket30592/openblas-0.3.19.log)

This looks similar to https://trac.macports.org/ticket/61700; it sounds like we would have to configure openblas differently. We can probably get this from homebrew's build script. This won't make it into Sage 9.5.

Thanks again for testing!



---

archive/issue_comments_490945.json:
```json
{
    "body": "<a id='comment:67'></a>\nAnd `make ptestlong` (after `make` with #33191 and #33195 but wihtout #33194) gives\n\n```\n----------------------------------------------------------------------\nsage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/functions/error.py  # 1 doctest failed\nsage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/matrix/matrix_gf2e_dense.pyx  # 1 doctest failed\nsage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/rings/complex_arb.pyx  # 2 doctests failed\nsage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/rings/real_arb.pyx  # 5 doctests failed\n----------------------------------------------------------------------\nTotal time for all tests: 1294.6 seconds\n    cpu time: 7872.1 seconds\n    cumulative wall time: 9610.5 seconds\nFeatures detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,pandoc,pdf2svg,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sagemath_doc_html,sphinx\nPytest is not installed, skip checking tests that rely on it.\nmake: *** [ptestlong] Error 1\n```",
    "created_at": "2022-01-17T13:15:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490945",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:67'></a>
And `make ptestlong` (after `make` with #33191 and #33195 but wihtout #33194) gives

```
----------------------------------------------------------------------
sage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/functions/error.py  # 1 doctest failed
sage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/matrix/matrix_gf2e_dense.pyx  # 1 doctest failed
sage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/rings/complex_arb.pyx  # 2 doctests failed
sage -t --long --random-seed=207327918669224047721672426685648861531 src/sage/rings/real_arb.pyx  # 5 doctests failed
----------------------------------------------------------------------
Total time for all tests: 1294.6 seconds
    cpu time: 7872.1 seconds
    cumulative wall time: 9610.5 seconds
Features detected for doctesting: dvipng,ffmpeg,graphviz,imagemagick,pandoc,pdf2svg,sage.combinat,sage.geometry.polyhedron,sage.graphs,sage.plot,sage.rings.number_field,sage.rings.real_double,sage.symbolic,sagemath_doc_html,sphinx
Pytest is not installed, skip checking tests that rely on it.
make: *** [ptestlong] Error 1
```



---

archive/attachments_022140.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "config.3.log",
    "asset_url": "tarball://root/attachments/ticket30592/config.3.log",
    "created_at": "2022-01-17T13:15:38Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/config.3.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490946.json:
```json
{
    "body": "**Attachment:** [config.3.log](https://github.com/sagemath/sage/files/ticket30592/config.3.log)",
    "created_at": "2022-01-17T13:15:38Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490946",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [config.3.log](https://github.com/sagemath/sage/files/ticket30592/config.3.log)



---

archive/attachments_022141.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "install.3.log",
    "asset_url": "tarball://root/attachments/ticket30592/install.3.log",
    "created_at": "2022-01-17T13:15:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/install.3.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490947.json:
```json
{
    "body": "**Attachment:** [install.3.log](https://github.com/sagemath/sage/files/ticket30592/install.3.log)",
    "created_at": "2022-01-17T13:15:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490947",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [install.3.log](https://github.com/sagemath/sage/files/ticket30592/install.3.log)



---

archive/attachments_022142.json:
```json
{
    "asset_content_type": "application/octet-stream",
    "asset_name": "ptestlong.log",
    "asset_url": "tarball://root/attachments/ticket30592/ptestlong.log",
    "created_at": "2022-01-17T13:16:07Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "attachment",
    "url": "https://github.com/sagemath/sage/files/ticket30592/ptestlong.log",
    "user": "https://github.com/GMS103"
}
```



---

archive/issue_comments_490948.json:
```json
{
    "body": "**Attachment:** [ptestlong.log](https://github.com/sagemath/sage/files/ticket30592/ptestlong.log)",
    "created_at": "2022-01-17T13:16:07Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490948",
    "user": "https://github.com/GMS103"
}
```

**Attachment:** [ptestlong.log](https://github.com/sagemath/sage/files/ticket30592/ptestlong.log)



---

archive/issue_comments_490949.json:
```json
{
    "body": "<a id='comment:68'></a>\nJust in case, things I think can be taken into account (besides #33191 and #33195):\n1. Install everything `./configure` (or `./configure --enable-download-from-upstream-url`) recommends with `brew install [...]`.\n   * Be aware of the 2 versions of `homebrew`: the new `arm64` should be used.\n   * In particular, to install `polymake` do\n\n   ```\n   cd /usr/local\n   sudo ln -s /opt/homebrew/lib lib\n   brew install apaffenholz/polymake/polymake\n   ```\n   (see https://github.com/apaffenholz/homebrew-polymake/issues/3)\n   * Do not forget `source .homebrew-build-env` afterwards.\n2. Before `make`, do:\n\n   ```\n   eval \"$(/opt/homebrew/bin/brew shellenv)\"\n   export PATH=\"/opt/homebrew/opt/openssl@3/bin:$PATH\"\n   export LDFLAGS=\"-L/opt/homebrew/opt/openssl@3/lib -L/opt/homebrew/opt/openblas/lib\"\n   export CPPFLAGS=\"-I/opt/homebrew/opt/openssl@3/include -I/opt/homebrew/opt/openblas/include\"\n   export PKG_CONFIG_PATH=\"/opt/homebrew/opt/openssl@3/lib/pkgconfig:/opt/homebrew/opt/openblas/lib/pkgconfig\"\n   ```\n   (recommended by `brew`, but can be overlooked; perhaps to be put in `.homebrew-build-env`?)\n3. `export MAKE=\"make -j16\"` works fine on Apple M1 (all 8 cores at 100% most of the time).",
    "created_at": "2022-01-17T13:57:41Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490949",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:68'></a>
Just in case, things I think can be taken into account (besides #33191 and #33195):
1. Install everything `./configure` (or `./configure --enable-download-from-upstream-url`) recommends with `brew install [...]`.
   * Be aware of the 2 versions of `homebrew`: the new `arm64` should be used.
   * In particular, to install `polymake` do

   ```
   cd /usr/local
   sudo ln -s /opt/homebrew/lib lib
   brew install apaffenholz/polymake/polymake
   ```
   (see https://github.com/apaffenholz/homebrew-polymake/issues/3)
   * Do not forget `source .homebrew-build-env` afterwards.
2. Before `make`, do:

   ```
   eval "$(/opt/homebrew/bin/brew shellenv)"
   export PATH="/opt/homebrew/opt/openssl@3/bin:$PATH"
   export LDFLAGS="-L/opt/homebrew/opt/openssl@3/lib -L/opt/homebrew/opt/openblas/lib"
   export CPPFLAGS="-I/opt/homebrew/opt/openssl@3/include -I/opt/homebrew/opt/openblas/include"
   export PKG_CONFIG_PATH="/opt/homebrew/opt/openssl@3/lib/pkgconfig:/opt/homebrew/opt/openblas/lib/pkgconfig"
   ```
   (recommended by `brew`, but can be overlooked; perhaps to be put in `.homebrew-build-env`?)
3. `export MAKE="make -j16"` works fine on Apple M1 (all 8 cores at 100% most of the time).



---

archive/issue_comments_490950.json:
```json
{
    "body": "<a id='comment:69'></a>\nThe `PKG_CONFIG_PATH` addition for `openssl` is already taken care of by `.homebrew-build-env`. I don't think we need the changes to the other variables",
    "created_at": "2022-01-17T17:58:49Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490950",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:69'></a>
The `PKG_CONFIG_PATH` addition for `openssl` is already taken care of by `.homebrew-build-env`. I don't think we need the changes to the other variables



---

archive/issue_comments_490951.json:
```json
{
    "body": "<a id='comment:70'></a>\nThanks for writing this summary - it will be helpful for those who find their way here from https://wiki.sagemath.org/ReleaseTours/sage-9.5#Sources",
    "created_at": "2022-01-17T18:00:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490951",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:70'></a>
Thanks for writing this summary - it will be helpful for those who find their way here from https://wiki.sagemath.org/ReleaseTours/sage-9.5#Sources



---

archive/issue_comments_490952.json:
```json
{
    "body": "<a id='comment:71'></a>\nNew report of build failures with 9.5.rc3 on M1 with macOS 12.1: https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/2kQ-fKfaAQAJ\n\nFrom the singular log:\n\n```\n\nlibtool: compile:  g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../.. -I../../libpolys -I../../libpolys -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/include -I/Users/admin/SageMath/Git/sage/local/include/ -I/Users/admin/SageMath/Git/sage/local/include -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-rtti -Qunused-arguments -c mpr_inout.cc  -fno-common -DPIC -o .libs/mpr_inout.o\nIn file included from mpr_inout.cc:11:\nIn file included from ../../kernel/mod2.h:13:\n../../libpolys/misc/auxiliary.h:70:2: error: \"Unexpected SIZEOF_LONG\"\n#error \"Unexpected SIZEOF_LONG\"\n```\n\n(resolved by removing stuff in `/usr/local`)",
    "created_at": "2022-01-21T02:45:03Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490952",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:71'></a>
New report of build failures with 9.5.rc3 on M1 with macOS 12.1: https://groups.google.com/g/sage-release/c/1YV0dNtEZz4/m/2kQ-fKfaAQAJ

From the singular log:

```

libtool: compile:  g++ -std=gnu++11 -DHAVE_CONFIG_H -I. -I../.. -I../.. -I../.. -I../../libpolys -I../../libpolys -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src/factory/include -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/var/tmp/sage/build/singular-4.2.1p3/src -I/Users/admin/SageMath/Git/sage/local/include -I/Users/admin/SageMath/Git/sage/local/include/ -I/Users/admin/SageMath/Git/sage/local/include -g -O2 -pipe -fno-common -g0 -O3 -Wno-unused-function -Wno-trigraphs -Wno-unused-parameter -Wunknown-pragmas -Wno-unused-variable -fomit-frame-pointer -fwrapv -fvisibility=default -finline-functions -fno-exceptions -fno-threadsafe-statics -funroll-loops -fno-rtti -Qunused-arguments -c mpr_inout.cc  -fno-common -DPIC -o .libs/mpr_inout.o
In file included from mpr_inout.cc:11:
In file included from ../../kernel/mod2.h:13:
../../libpolys/misc/auxiliary.h:70:2: error: "Unexpected SIZEOF_LONG"
#error "Unexpected SIZEOF_LONG"
```

(resolved by removing stuff in `/usr/local`)



---

archive/issue_comments_490953.json:
```json
{
    "body": "<a id='comment:72'></a>\nbump to 9.6",
    "created_at": "2022-01-29T08:58:50Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490953",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:72'></a>
bump to 9.6



---

archive/issue_events_274002.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-01-29T08:58:50Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274002"
}
```



---

archive/issue_events_274003.json:
```json
{
    "actor": "https://github.com/fchapoton",
    "created_at": "2022-01-29T08:58:50Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274003"
}
```



---

archive/issue_events_274004.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274004"
}
```



---

archive/issue_events_274005.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274005"
}
```



---

archive/issue_events_274006.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274006"
}
```



---

archive/issue_events_274007.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274007"
}
```



---

archive/issue_comments_490954.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,6 +9,7 @@\n - #33191 Fix build errors on Apple Silicon with homebrew\n - #33195 iml: Refresh build scripts with current autotools\n - #33194 openblas: Update to 0.3.19\n+- #33816 Update gcc/gfortran to 12.x + Apple Silicon support, update openblas to 0.3.21, gsl to 2.7.1\n \n Discussions:\n - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ\n``````\n",
    "created_at": "2022-09-24T22:56:33Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490954",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,6 +9,7 @@
 - #33191 Fix build errors on Apple Silicon with homebrew
 - #33195 iml: Refresh build scripts with current autotools
 - #33194 openblas: Update to 0.3.19
+- #33816 Update gcc/gfortran to 12.x + Apple Silicon support, update openblas to 0.3.21, gsl to 2.7.1
 
 Discussions:
 - https://groups.google.com/g/sage-devel/c/P-RGHeng5m8/m/vChq3b9yBwAJ
``````




---

archive/issue_comments_490955.json:
```json
{
    "body": "<a id='comment:76'></a>\nMaybe we can close this.",
    "created_at": "2022-11-16T01:04:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490955",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:76'></a>
Maybe we can close this.



---

archive/issue_comments_490956.json:
```json
{
    "body": "<a id='comment:77'></a>\nhow about #31905 ?",
    "created_at": "2022-11-16T12:41:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490956",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:77'></a>
how about #31905 ?



---

archive/issue_comments_490957.json:
```json
{
    "body": "<a id='comment:78'></a>\nReplying to [Dima Pasechnik](#comment%3A77):\n> how about #31905 ?\n\nI think we now agree that's not an issue. I don't know what to do with #30494, but maybe we don't need both this ticket and that one. So I propose closing this one and thinking about what to do with #30494 separately.",
    "created_at": "2022-11-16T20:37:36Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490957",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:78'></a>
Replying to [Dima Pasechnik](#comment%3A77):
> how about #31905 ?

I think we now agree that's not an issue. I don't know what to do with #30494, but maybe we don't need both this ticket and that one. So I propose closing this one and thinking about what to do with #30494 separately.



---

archive/issue_events_274008.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-17T10:45:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274008"
}
```



---

archive/issue_events_274009.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-17T10:45:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274009"
}
```



---

archive/issue_comments_490958.json:
```json
{
    "body": "<a id='comment:80'></a>\nclose as done",
    "created_at": "2022-11-17T10:46:06Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490958",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:80'></a>
close as done



---

archive/issue_comments_490959.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2022-11-17T10:46:06Z",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30592#issuecomment-490959",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_events_274010.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-17T10:46:06Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274010"
}
```



---

archive/issue_events_274011.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2022-11-17T10:46:06Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30592",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30592#event-274011"
}
```
