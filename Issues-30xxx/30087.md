# Issue 30087: crash in JacobianMorphism_divisor_class_field when variable is not calledÂ x

archive/issues_029850.json:
```json
{
    "assignees": [],
    "body": "The following code:\n\n```python\nR.<v> = QQ[]\nC = HyperellipticCurve(v**3-1)\nJ = C.jacobian()\nD = J(v-1,0)\n```\n\ncrashes on sage version 9.1 and the current `develop` branch with the exception:\n\n```\nTraceback (most recent call last):\n  File \"./mfe.sage.py\", line 10, in <module>\n    D = J(v-_sage_const_1 ,_sage_const_0 )\n  File \"sage/schemes/generic/scheme.py\", line 265, in __call__\n    return self.point(args)\n  File \"sage/schemes/hyperelliptic_curves/jacobian_generic.py\", line 147, in point\n    return self(self.base_ring())(mumford)\n  File \"schemes/hyperelliptic_curves/jacobian_homset.py\", line 149, in __call__\n    return JacobianMorphism_divisor_class_field(self, (P1, P2))\n  File \"sage/schemes/hyperelliptic_curves/jacobian_morphism.py\", line 386, in __init__\n    if not (b**2 + h*b - f)%a == 0:\n  File \"sage/structure/element.pyx\", line 1517, in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12231)\n  File \"sage/structure/coerce.pyx\", line 1255, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11275)\nTypeError: unsupported operand parent(s) for *: 'Univariate Polynomial Ring in v over Rational Field' and 'Univariate Polynomial Ring in x over Rational Field'\n```\n\nThe reason is that the code uses `x` internally and doesn't expect the input to come from a \"different\" univariate polynomial ring, hence the exception. The error does not occur when `v` is replaced by `x` in the example above.\n\nThe proposed patch explicitly casts the given polynomials to the parent ring of the curve's defining polynomials.\n\nCC:  @alexjbest @kedlaya @slel\n\nKeywords: **hyperelliptic jacobian**\n\nBranch/Commit: **[public/fix_hyperelliptic_jacobian_crash_variable_name](https://github.com/sagemath/sagetrac-mirror/tree/public/fix_hyperelliptic_jacobian_crash_variable_name) @ [`627adb0`](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**\n\nAuthor: **Lorenz Panny**\n\nComponent: **algebraic geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30087_\n\n",
    "created_at": "2020-07-08T01:45:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "crash in JacobianMorphism_divisor_class_field when variable is not called\u00a0x",
    "type": "issue",
    "updated_at": "2022-10-17T15:48:16Z",
    "url": "https://github.com/sagemath/sage/issues/30087",
    "user": "https://github.com/yyyyx4"
}
```
The following code:

```python
R.<v> = QQ[]
C = HyperellipticCurve(v**3-1)
J = C.jacobian()
D = J(v-1,0)
```

crashes on sage version 9.1 and the current `develop` branch with the exception:

```
Traceback (most recent call last):
  File "./mfe.sage.py", line 10, in <module>
    D = J(v-_sage_const_1 ,_sage_const_0 )
  File "sage/schemes/generic/scheme.py", line 265, in __call__
    return self.point(args)
  File "sage/schemes/hyperelliptic_curves/jacobian_generic.py", line 147, in point
    return self(self.base_ring())(mumford)
  File "schemes/hyperelliptic_curves/jacobian_homset.py", line 149, in __call__
    return JacobianMorphism_divisor_class_field(self, (P1, P2))
  File "sage/schemes/hyperelliptic_curves/jacobian_morphism.py", line 386, in __init__
    if not (b**2 + h*b - f)%a == 0:
  File "sage/structure/element.pyx", line 1517, in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12231)
  File "sage/structure/coerce.pyx", line 1255, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11275)
TypeError: unsupported operand parent(s) for *: 'Univariate Polynomial Ring in v over Rational Field' and 'Univariate Polynomial Ring in x over Rational Field'
```

The reason is that the code uses `x` internally and doesn't expect the input to come from a "different" univariate polynomial ring, hence the exception. The error does not occur when `v` is replaced by `x` in the example above.

The proposed patch explicitly casts the given polynomials to the parent ring of the curve's defining polynomials.

CC:  @alexjbest @kedlaya @slel

Keywords: **hyperelliptic jacobian**

Branch/Commit: **[public/fix_hyperelliptic_jacobian_crash_variable_name](https://github.com/sagemath/sagetrac-mirror/tree/public/fix_hyperelliptic_jacobian_crash_variable_name) @ [`627adb0`](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**

Author: **Lorenz Panny**

Component: **algebraic geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/30087_





---

archive/issue_events_414291.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414291"
}
```



---

archive/issue_events_414292.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "c: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414292"
}
```



---

archive/issue_events_414293.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414293"
}
```



---

archive/issue_events_414294.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414294"
}
```



---

archive/issue_comments_476365.json:
```json
{
    "body": "<div id=\"comment:1\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a\">dae7b9f</a></td><td><code>add doctest for trac #30087</code></td></tr></table>\n",
    "created_at": "2020-07-08T01:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476365",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:1"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a">dae7b9f</a></td><td><code>add doctest for trac #30087</code></td></tr></table>




---

archive/issue_comments_476366.json:
```json
{
    "body": "Changed commit from **[`eebb16d`](https://github.com/sagemath/sagetrac-mirror/commit/eebb16dcd7c2c77eff3dd62fbc6f6e3ec3fc6e86)** to **[`dae7b9f`](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)**",
    "created_at": "2020-07-08T01:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`eebb16d`](https://github.com/sagemath/sagetrac-mirror/commit/eebb16dcd7c2c77eff3dd62fbc6f6e3ec3fc6e86)** to **[`dae7b9f`](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)**



---

archive/issue_comments_476367.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046\">9da2c63</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr></table>\n",
    "created_at": "2020-07-08T02:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:2"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046">9da2c63</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr></table>




---

archive/issue_comments_476368.json:
```json
{
    "body": "Changed commit from **[`dae7b9f`](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)** to **[`9da2c63`](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)**",
    "created_at": "2020-07-08T02:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476368",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dae7b9f`](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)** to **[`9da2c63`](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)**



---

archive/issue_events_414295.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T09:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414295"
}
```



---

archive/issue_events_414296.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T09:19:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "title_is": "crash in JacobianMorphism_divisor_class_field when variable is not called\u00a0x",
    "title_was": "crash in JacobianMorphism_divisor_class_field.__init__ when variable is not called\u00a0x",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414296"
}
```



---

archive/issue_events_414297.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-08-13T21:25:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414297"
}
```



---

archive/issue_events_414298.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-08-13T21:25:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414298"
}
```



---

archive/issue_comments_476369.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThank you for reporting this. It seems the current branch introduces a few test failures, which I do not know how to solve myself. Someone familiar with schemes, please take a look.\n\nYou can run the tests on individual files and folders like this:\n\n```\n./sage -t -l src/sage/schemes/hyperelliptic_curves/jacobian_morphism.py\n```\n\nMoreover, please add your full name to the Authors field of this ticket. Otherwise, the automatic patchbot does not run the tests for this ticket.\n\nAlso, it seems the result of this line is not used anymore with your changes:\n\n```\npolys = cantor_reduction(a, b, f, h, genus)\n```",
    "created_at": "2020-08-13T21:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476369",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:4" align="right">comment:4</div>

Thank you for reporting this. It seems the current branch introduces a few test failures, which I do not know how to solve myself. Someone familiar with schemes, please take a look.

You can run the tests on individual files and folders like this:

```
./sage -t -l src/sage/schemes/hyperelliptic_curves/jacobian_morphism.py
```

Moreover, please add your full name to the Authors field of this ticket. Otherwise, the automatic patchbot does not run the tests for this ticket.

Also, it seems the result of this line is not used anymore with your changes:

```
polys = cantor_reduction(a, b, f, h, genus)
```



---

archive/issue_comments_476370.json:
```json
{
    "body": "Author: **...**",
    "created_at": "2020-08-13T21:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476370",
    "user": "https://github.com/mwageringel"
}
```

Author: **...**



---

archive/issue_comments_476371.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nThe doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.\n\nThe path of least resistance is to create a `HyperellipticCurve` with custom variables:\n\n```\nsage: R.<v> = QQ[]                                                              \nsage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   \nsage: J = C.jacobian()                                                          \nsage: D = J(v-1, 0); D\n(v - 1, y)\n```\nGiven this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.",
    "created_at": "2020-08-15T19:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476371",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:6" align="right">comment:6</div>

The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.

The path of least resistance is to create a `HyperellipticCurve` with custom variables:

```
sage: R.<v> = QQ[]                                                              
sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   
sage: J = C.jacobian()                                                          
sage: D = J(v-1, 0); D
(v - 1, y)
```
Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.



---

archive/issue_events_414299.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414299"
}
```



---

archive/issue_events_414300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414300"
}
```



---

archive/issue_events_414301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414301"
}
```



---

archive/issue_events_414302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414302"
}
```



---

archive/issue_comments_476372.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476372",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:8" align="right">comment:8</div>

Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_476373.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476373",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>

Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_414303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414303"
}
```



---

archive/issue_events_414304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414304"
}
```



---

archive/issue_comments_476374.json:
```json
{
    "body": "Changed commit from **[`9da2c63`](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)** to **[`15afac4`](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)**",
    "created_at": "2021-07-28T07:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476374",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`9da2c63`](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)** to **[`15afac4`](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)**



---

archive/issue_comments_476375.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df0faad67f00bb669e9fd324681a6b51355ca136\">df0faad</a></td><td><code>make sure the polynomials live in the same ring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48ac0b0729eb444dc36bea5ed629ab42baa640f3\">48ac0b0</a></td><td><code>add doctest for trac #30087</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fef997fb876a037a5b4e0a3afe95392e837597bb\">fef997f</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dd8102d3f6a66ceb225c9a73f44700710430217\">9dd8102</a></td><td><code>use reduced polynomials in all cases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4\">15afac4</a></td><td><code>jacobians can be defined over larger fields than the curve</code></td></tr></table>\n",
    "created_at": "2021-07-28T07:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476375",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df0faad67f00bb669e9fd324681a6b51355ca136">df0faad</a></td><td><code>make sure the polynomials live in the same ring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48ac0b0729eb444dc36bea5ed629ab42baa640f3">48ac0b0</a></td><td><code>add doctest for trac #30087</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fef997fb876a037a5b4e0a3afe95392e837597bb">fef997f</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dd8102d3f6a66ceb225c9a73f44700710430217">9dd8102</a></td><td><code>use reduced polynomials in all cases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4">15afac4</a></td><td><code>jacobians can be defined over larger fields than the curve</code></td></tr></table>




---

archive/issue_comments_476376.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks for the feedback, and sorry about the test failures.\n\nI updated the patch to convert everything to the jacobian's internal polynomial ring when constructing divisors. Since the jacobian's polynomial ring is in turn based on the curve's polynomial ring, this should make everything use the same names consistently (the ones passed in `names=` when constructing the curve, or `x,y` by default), which makes the coercions between \"curve polynomials\" and \"jacobian polynomials\" in the divisor arithmetic work automatically.",
    "created_at": "2021-07-28T08:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476376",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks for the feedback, and sorry about the test failures.

I updated the patch to convert everything to the jacobian's internal polynomial ring when constructing divisors. Since the jacobian's polynomial ring is in turn based on the curve's polynomial ring, this should make everything use the same names consistently (the ones passed in `names=` when constructing the curve, or `x,y` by default), which makes the coercions between "curve polynomials" and "jacobian polynomials" in the divisor arithmetic work automatically.



---

archive/issue_events_414305.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-07-28T08:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414305"
}
```



---

archive/issue_events_414306.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-07-28T08:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414306"
}
```



---

archive/issue_comments_476377.json:
```json
{
    "body": "Changed author from **...** to **Lorenz Panny**",
    "created_at": "2021-07-28T08:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476377",
    "user": "https://github.com/yyyyx4"
}
```

Changed author from **...** to **Lorenz Panny**



---

archive/issue_comments_476378.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@kedlaya](#comment:6):\n> The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.\n> \n> The path of least resistance is to create a `HyperellipticCurve` with custom variables:\n> \n> ```\n> sage: R.<v> = QQ[]                                                              \n> sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   \n> sage: J = C.jacobian()                                                          \n> sage: D = J(v-1, 0); D\n> (v - 1, y)\n> ```\n> Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.\n\nGiven that a hyperelliptic curve can be constructed from a univariate polynomial, I think the \"custom names\" option for hyperelliptic curves is problematic: it requires the user to repeat elements, where this wouldn't really be required. The `u` or `x` can be read off from the parent of the passed-in univariate polynomial. If it is required to come up with a name for the other variable (like `y`) we may have a bit of a problem, because the system can't choose itself very well. Particularly, for `HyperellipticCurve(y^5+y+1)` we would have a problem, since you probably do not want to name the other variable `y` as well. So perhaps there should be an option to give the name of the second variable (only) ?\n\nCurrently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?",
    "created_at": "2021-07-28T17:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476378",
    "user": "https://github.com/nbruin"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@kedlaya](#comment:6):
> The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.
> 
> The path of least resistance is to create a `HyperellipticCurve` with custom variables:
> 
> ```
> sage: R.<v> = QQ[]                                                              
> sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   
> sage: J = C.jacobian()                                                          
> sage: D = J(v-1, 0); D
> (v - 1, y)
> ```
> Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.

Given that a hyperelliptic curve can be constructed from a univariate polynomial, I think the "custom names" option for hyperelliptic curves is problematic: it requires the user to repeat elements, where this wouldn't really be required. The `u` or `x` can be read off from the parent of the passed-in univariate polynomial. If it is required to come up with a name for the other variable (like `y`) we may have a bit of a problem, because the system can't choose itself very well. Particularly, for `HyperellipticCurve(y^5+y+1)` we would have a problem, since you probably do not want to name the other variable `y` as well. So perhaps there should be an option to give the name of the second variable (only) ?

Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?



---

archive/issue_comments_476379.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\n+1 to an optional argument to name the second variable.",
    "created_at": "2021-08-01T18:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476379",
    "user": "https://github.com/kedlaya"
}
```

<div id="comment:14" align="right">comment:14</div>

+1 to an optional argument to name the second variable.



---

archive/issue_comments_476380.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f\">d14ff21</a></td><td><code>add optional name= keyword argument to HyperellipticCurve() -- see #30087</code></td></tr></table>\n",
    "created_at": "2021-08-03T05:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476380",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f">d14ff21</a></td><td><code>add optional name= keyword argument to HyperellipticCurve() -- see #30087</code></td></tr></table>




---

archive/issue_comments_476381.json:
```json
{
    "body": "Changed commit from **[`15afac4`](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)** to **[`d14ff21`](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)**",
    "created_at": "2021-08-03T05:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476381",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`15afac4`](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)** to **[`d14ff21`](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)**



---

archive/issue_comments_476382.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@kedlaya](#comment:14):\n> +1 to an optional argument to name the second variable.\n\nDone.\n\nReplying to [@nbruin](#comment:13):\n> Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?\n\nThis should clearly be (and already is) `x^2 = y^5 + y + 1`: The meaning of `names=` is to forget about the original variables of `f` and `h` and use the given names instead.",
    "created_at": "2021-08-03T05:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476382",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@kedlaya](#comment:14):
> +1 to an optional argument to name the second variable.

Done.

Replying to [@nbruin](#comment:13):
> Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?

This should clearly be (and already is) `x^2 = y^5 + y + 1`: The meaning of `names=` is to forget about the original variables of `f` and `h` and use the given names instead.



---

archive/issue_comments_476383.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nAnother possibility would be to allow `names=[None, 'z']`\nto specify the second name only.",
    "created_at": "2021-08-03T07:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476383",
    "user": "https://github.com/slel"
}
```

<div id="comment:17" align="right">comment:17</div>

Another possibility would be to allow `names=[None, 'z']`
to specify the second name only.



---

archive/issue_comments_476384.json:
```json
{
    "body": "Changed commit from **[`d14ff21`](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)** to **[`a9f3042`](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)**",
    "created_at": "2021-08-05T09:06:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476384",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`d14ff21`](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)** to **[`a9f3042`](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)**



---

archive/issue_comments_476385.json:
```json
{
    "body": "<div id=\"comment:18\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/102d7e19707f83f0343884272253ce23babb5fcd\">102d7e1</a></td><td><code>Revert \"add optional name= keyword argument to HyperellipticCurve() -- see #30087\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95\">a9f3042</a></td><td><code>allow passing just one name in names= for HyperellipticCurve() -- see #30087</code></td></tr></table>\n",
    "created_at": "2021-08-05T09:06:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476385",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:18"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/102d7e19707f83f0343884272253ce23babb5fcd">102d7e1</a></td><td><code>Revert "add optional name= keyword argument to HyperellipticCurve() -- see #30087"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95">a9f3042</a></td><td><code>allow passing just one name in names= for HyperellipticCurve() -- see #30087</code></td></tr></table>




---

archive/issue_comments_476386.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@slel](#comment:17):\n> Another possibility would be to allow `names=[None, 'z']`\n> to specify the second name only.\n\nThanks for the suggestion. I agree that the interface is cleaner without the redundancy of having two different arguments.",
    "created_at": "2021-08-05T09:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476386",
    "user": "https://github.com/yyyyx4"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@slel](#comment:17):
> Another possibility would be to allow `names=[None, 'z']`
> to specify the second name only.

Thanks for the suggestion. I agree that the interface is cleaner without the redundancy of having two different arguments.



---

archive/issue_events_414307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414307"
}
```



---

archive/issue_events_414308.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414308"
}
```



---

archive/issue_comments_476387.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476387",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:20" align="right">comment:20</div>

Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_414309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414309"
}
```



---

archive/issue_events_414310.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414310"
}
```



---

archive/issue_events_414311.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414311"
}
```



---

archive/issue_events_414312.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-414312"
}
```



---

archive/issue_comments_476388.json:
```json
{
    "body": "Changed commit from **[`a9f3042`](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)** to **[`627adb0`](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**",
    "created_at": "2022-10-17T15:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476388",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a9f3042`](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)** to **[`627adb0`](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**



---

archive/issue_comments_476389.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca\">627adb0</a></td><td><code>Merge tag '9.8.beta2' into public/fix_hyperelliptic_jacobian_crash_variable_name</code></td></tr></table>\n",
    "created_at": "2022-10-17T15:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-476389",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca">627adb0</a></td><td><code>Merge tag '9.8.beta2' into public/fix_hyperelliptic_jacobian_crash_variable_name</code></td></tr></table>

