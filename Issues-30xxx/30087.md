# Issue 30087: crash in JacobianMorphism_divisor_class_field when variable is not calledÂ x

archive/issues_029850.json:
```json
{
    "assignees": [],
    "body": "The following code:\n\n```python\nR.<v> = QQ[]\nC = HyperellipticCurve(v**3-1)\nJ = C.jacobian()\nD = J(v-1,0)\n```\n\ncrashes on sage version 9.1 and the current `develop` branch with the exception:\n\n```\nTraceback (most recent call last):\n  File \"./mfe.sage.py\", line 10, in <module>\n    D = J(v-_sage_const_1 ,_sage_const_0 )\n  File \"sage/schemes/generic/scheme.py\", line 265, in __call__\n    return self.point(args)\n  File \"sage/schemes/hyperelliptic_curves/jacobian_generic.py\", line 147, in point\n    return self(self.base_ring())(mumford)\n  File \"schemes/hyperelliptic_curves/jacobian_homset.py\", line 149, in __call__\n    return JacobianMorphism_divisor_class_field(self, (P1, P2))\n  File \"sage/schemes/hyperelliptic_curves/jacobian_morphism.py\", line 386, in __init__\n    if not (b**2 + h*b - f)%a == 0:\n  File \"sage/structure/element.pyx\", line 1517, in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12231)\n  File \"sage/structure/coerce.pyx\", line 1255, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11275)\nTypeError: unsupported operand parent(s) for *: 'Univariate Polynomial Ring in v over Rational Field' and 'Univariate Polynomial Ring in x over Rational Field'\n```\n\nThe reason is that the code uses `x` internally and doesn't expect the input to come from a \"different\" univariate polynomial ring, hence the exception. The error does not occur when `v` is replaced by `x` in the example above.\n\nThe proposed patch explicitly casts the given polynomials to the parent ring of the curve's defining polynomials.\n\nCC:  @alexjbest @kedlaya @slel\n\nKeywords: **hyperelliptic jacobian**\n\nBranch/Commit: **[public/fix_hyperelliptic_jacobian_crash_variable_name](https://github.com/sagemath/sagetrac-mirror/tree/public/fix_hyperelliptic_jacobian_crash_variable_name) @ [627adb0](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**\n\nAuthor: **Lorenz Panny**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30087_\n\n",
    "created_at": "2020-07-08T01:45:00Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
        "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug",
        "https://github.com/sagemath/sage/labels/needs%20review"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "crash in JacobianMorphism_divisor_class_field when variable is not called\u00a0x",
    "type": "issue",
    "updated_at": "2022-10-17T15:48:16Z",
    "url": "https://github.com/sagemath/sage/issues/30087",
    "user": "https://github.com/yyyyx4"
}
```
The following code:

```python
R.<v> = QQ[]
C = HyperellipticCurve(v**3-1)
J = C.jacobian()
D = J(v-1,0)
```

crashes on sage version 9.1 and the current `develop` branch with the exception:

```
Traceback (most recent call last):
  File "./mfe.sage.py", line 10, in <module>
    D = J(v-_sage_const_1 ,_sage_const_0 )
  File "sage/schemes/generic/scheme.py", line 265, in __call__
    return self.point(args)
  File "sage/schemes/hyperelliptic_curves/jacobian_generic.py", line 147, in point
    return self(self.base_ring())(mumford)
  File "schemes/hyperelliptic_curves/jacobian_homset.py", line 149, in __call__
    return JacobianMorphism_divisor_class_field(self, (P1, P2))
  File "sage/schemes/hyperelliptic_curves/jacobian_morphism.py", line 386, in __init__
    if not (b**2 + h*b - f)%a == 0:
  File "sage/structure/element.pyx", line 1517, in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12231)
  File "sage/structure/coerce.pyx", line 1255, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:11275)
TypeError: unsupported operand parent(s) for *: 'Univariate Polynomial Ring in v over Rational Field' and 'Univariate Polynomial Ring in x over Rational Field'
```

The reason is that the code uses `x` internally and doesn't expect the input to come from a "different" univariate polynomial ring, hence the exception. The error does not occur when `v` is replaced by `x` in the example above.

The proposed patch explicitly casts the given polynomials to the parent ring of the curve's defining polynomials.

CC:  @alexjbest @kedlaya @slel

Keywords: **hyperelliptic jacobian**

Branch/Commit: **[public/fix_hyperelliptic_jacobian_crash_variable_name](https://github.com/sagemath/sagetrac-mirror/tree/public/fix_hyperelliptic_jacobian_crash_variable_name) @ [627adb0](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**

Author: **Lorenz Panny**

_Issue created by migration from https://trac.sagemath.org/ticket/30087_





---

archive/issue_events_382425.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382425"
}
```



---

archive/issue_events_382426.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20algebraic%20geometry",
    "label_color": "0000ff",
    "label_name": "component: algebraic geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382426"
}
```



---

archive/issue_events_382427.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/p4%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382427"
}
```



---

archive/issue_events_382428.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T01:45:00Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382428"
}
```



---

archive/issue_comments_479263.json:
```json
{
    "body": "<a id='comment:1'>Comment 1:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a\">dae7b9f</a></td><td><code>add doctest for trac #30087</code></td></tr></table>\n",
    "created_at": "2020-07-08T01:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479263",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:1'>Comment 1:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a">dae7b9f</a></td><td><code>add doctest for trac #30087</code></td></tr></table>




---

archive/issue_comments_479264.json:
```json
{
    "body": "Changed commit from **[eebb16d](https://github.com/sagemath/sagetrac-mirror/commit/eebb16dcd7c2c77eff3dd62fbc6f6e3ec3fc6e86)** to **[dae7b9f](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)**",
    "created_at": "2020-07-08T01:49:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479264",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[eebb16d](https://github.com/sagemath/sagetrac-mirror/commit/eebb16dcd7c2c77eff3dd62fbc6f6e3ec3fc6e86)** to **[dae7b9f](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)**



---

archive/issue_comments_479265.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046\">9da2c63</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr></table>\n",
    "created_at": "2020-07-08T02:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479265",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:2'>Comment 2:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046">9da2c63</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr></table>




---

archive/issue_comments_479266.json:
```json
{
    "body": "Changed commit from **[dae7b9f](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)** to **[9da2c63](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)**",
    "created_at": "2020-07-08T02:13:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479266",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[dae7b9f](https://github.com/sagemath/sagetrac-mirror/commit/dae7b9f3ce153a205256d3fb51f0b294b0bd469a)** to **[9da2c63](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)**



---

archive/issue_events_382429.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T09:19:39Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382429"
}
```



---

archive/issue_events_382430.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2020-07-08T09:19:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "title_is": "crash in JacobianMorphism_divisor_class_field when variable is not called\u00a0x",
    "title_was": "crash in JacobianMorphism_divisor_class_field.__init__ when variable is not called\u00a0x",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382430"
}
```



---

archive/issue_events_382431.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-08-13T21:25:23Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382431"
}
```



---

archive/issue_events_382432.json:
```json
{
    "actor": "https://github.com/mwageringel",
    "created_at": "2020-08-13T21:25:23Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382432"
}
```



---

archive/issue_comments_479267.json:
```json
{
    "body": "<a id='comment:4'>Comment 4:</a>\nThank you for reporting this. It seems the current branch introduces a few test failures, which I do not know how to solve myself. Someone familiar with schemes, please take a look.\n\nYou can run the tests on individual files and folders like this:\n\n```\n./sage -t -l src/sage/schemes/hyperelliptic_curves/jacobian_morphism.py\n```\n\nMoreover, please add your full name to the Authors field of this ticket. Otherwise, the automatic patchbot does not run the tests for this ticket.\n\nAlso, it seems the result of this line is not used anymore with your changes:\n\n```\npolys = cantor_reduction(a, b, f, h, genus)\n```",
    "created_at": "2020-08-13T21:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479267",
    "user": "https://github.com/mwageringel"
}
```

<a id='comment:4'>Comment 4:</a>
Thank you for reporting this. It seems the current branch introduces a few test failures, which I do not know how to solve myself. Someone familiar with schemes, please take a look.

You can run the tests on individual files and folders like this:

```
./sage -t -l src/sage/schemes/hyperelliptic_curves/jacobian_morphism.py
```

Moreover, please add your full name to the Authors field of this ticket. Otherwise, the automatic patchbot does not run the tests for this ticket.

Also, it seems the result of this line is not used anymore with your changes:

```
polys = cantor_reduction(a, b, f, h, genus)
```



---

archive/issue_comments_479268.json:
```json
{
    "body": "Author: **...**",
    "created_at": "2020-08-13T21:25:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479268",
    "user": "https://github.com/mwageringel"
}
```

Author: **...**



---

archive/issue_comments_479269.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThe doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.\n\nThe path of least resistance is to create a `HyperellipticCurve` with custom variables:\n\n```\nsage: R.<v> = QQ[]                                                              \nsage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   \nsage: J = C.jacobian()                                                          \nsage: D = J(v-1, 0); D\n(v - 1, y)\n```\nGiven this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.",
    "created_at": "2020-08-15T19:25:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479269",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'>Comment 6:</a>
The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.

The path of least resistance is to create a `HyperellipticCurve` with custom variables:

```
sage: R.<v> = QQ[]                                                              
sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   
sage: J = C.jacobian()                                                          
sage: D = J(v-1, 0); D
(v - 1, y)
```
Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.



---

archive/issue_events_382433.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382433"
}
```



---

archive/issue_events_382434.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382434"
}
```



---

archive/issue_events_382435.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382435"
}
```



---

archive/issue_events_382436.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382436"
}
```



---

archive/issue_comments_479270.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479270",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_comments_479271.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479271",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_382437.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382437"
}
```



---

archive/issue_events_382438.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382438"
}
```



---

archive/issue_comments_479272.json:
```json
{
    "body": "Changed commit from **[9da2c63](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)** to **[15afac4](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)**",
    "created_at": "2021-07-28T07:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479272",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[9da2c63](https://github.com/sagemath/sagetrac-mirror/commit/9da2c639c09231b3778684019d7395b497856046)** to **[15afac4](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)**



---

archive/issue_comments_479273.json:
```json
{
    "body": "<a id='comment:10'>Comment 10:</a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/df0faad67f00bb669e9fd324681a6b51355ca136\">df0faad</a></td><td><code>make sure the polynomials live in the same ring</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/48ac0b0729eb444dc36bea5ed629ab42baa640f3\">48ac0b0</a></td><td><code>add doctest for trac #30087</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fef997fb876a037a5b4e0a3afe95392e837597bb\">fef997f</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9dd8102d3f6a66ceb225c9a73f44700710430217\">9dd8102</a></td><td><code>use reduced polynomials in all cases</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4\">15afac4</a></td><td><code>jacobians can be defined over larger fields than the curve</code></td></tr></table>\n",
    "created_at": "2021-07-28T07:49:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479273",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:10'>Comment 10:</a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/df0faad67f00bb669e9fd324681a6b51355ca136">df0faad</a></td><td><code>make sure the polynomials live in the same ring</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/48ac0b0729eb444dc36bea5ed629ab42baa640f3">48ac0b0</a></td><td><code>add doctest for trac #30087</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fef997fb876a037a5b4e0a3afe95392e837597bb">fef997f</a></td><td><code>make sure the *stored* polynomials live in the same ring, too</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9dd8102d3f6a66ceb225c9a73f44700710430217">9dd8102</a></td><td><code>use reduced polynomials in all cases</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4">15afac4</a></td><td><code>jacobians can be defined over larger fields than the curve</code></td></tr></table>




---

archive/issue_comments_479274.json:
```json
{
    "body": "<a id='comment:11'>Comment 11:</a>\nThanks for the feedback, and sorry about the test failures.\n\nI updated the patch to convert everything to the jacobian's internal polynomial ring when constructing divisors. Since the jacobian's polynomial ring is in turn based on the curve's polynomial ring, this should make everything use the same names consistently (the ones passed in `names=` when constructing the curve, or `x,y` by default), which makes the coercions between \"curve polynomials\" and \"jacobian polynomials\" in the divisor arithmetic work automatically.",
    "created_at": "2021-07-28T08:03:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479274",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:11'>Comment 11:</a>
Thanks for the feedback, and sorry about the test failures.

I updated the patch to convert everything to the jacobian's internal polynomial ring when constructing divisors. Since the jacobian's polynomial ring is in turn based on the curve's polynomial ring, this should make everything use the same names consistently (the ones passed in `names=` when constructing the curve, or `x,y` by default), which makes the coercions between "curve polynomials" and "jacobian polynomials" in the divisor arithmetic work automatically.



---

archive/issue_events_382439.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-07-28T08:03:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382439"
}
```



---

archive/issue_events_382440.json:
```json
{
    "actor": "https://github.com/yyyyx4",
    "created_at": "2021-07-28T08:03:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382440"
}
```



---

archive/issue_comments_479275.json:
```json
{
    "body": "Changed author from **...** to **Lorenz Panny**",
    "created_at": "2021-07-28T08:03:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479275",
    "user": "https://github.com/yyyyx4"
}
```

Changed author from **...** to **Lorenz Panny**



---

archive/issue_comments_479276.json:
```json
{
    "body": "<a id='comment:13'>Comment 13:</a>\nReplying to [@kedlaya](#comment%3A6):\n> The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.\n> \n> The path of least resistance is to create a `HyperellipticCurve` with custom variables:\n> \n> ```\n> sage: R.<v> = QQ[]                                                              \n> sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   \n> sage: J = C.jacobian()                                                          \n> sage: D = J(v-1, 0); D\n> (v - 1, y)\n> ```\n> Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.\n\nGiven that a hyperelliptic curve can be constructed from a univariate polynomial, I think the \"custom names\" option for hyperelliptic curves is problematic: it requires the user to repeat elements, where this wouldn't really be required. The `u` or `x` can be read off from the parent of the passed-in univariate polynomial. If it is required to come up with a name for the other variable (like `y`) we may have a bit of a problem, because the system can't choose itself very well. Particularly, for `HyperellipticCurve(y^5+y+1)` we would have a problem, since you probably do not want to name the other variable `y` as well. So perhaps there should be an option to give the name of the second variable (only) ?\n\nCurrently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?",
    "created_at": "2021-07-28T17:05:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479276",
    "user": "https://github.com/nbruin"
}
```

<a id='comment:13'>Comment 13:</a>
Replying to [@kedlaya](#comment%3A6):
> The doctest failures are coming from the fact that a Jacobian can be constructed with a different base field than the underlying curve, so taking the base ring from the curve itself is creating errors.
> 
> The path of least resistance is to create a `HyperellipticCurve` with custom variables:
> 
> ```
> sage: R.<v> = QQ[]                                                              
> sage: C = HyperellipticCurve(v**3-1,0, 'v,y')                                   
> sage: J = C.jacobian()                                                          
> sage: D = J(v-1, 0); D
> (v - 1, y)
> ```
> Given this, I'm not even sure this should be considered a bug in the first place. Maybe a better fix would be to edit some docstrings to better document the existing behavior.

Given that a hyperelliptic curve can be constructed from a univariate polynomial, I think the "custom names" option for hyperelliptic curves is problematic: it requires the user to repeat elements, where this wouldn't really be required. The `u` or `x` can be read off from the parent of the passed-in univariate polynomial. If it is required to come up with a name for the other variable (like `y`) we may have a bit of a problem, because the system can't choose itself very well. Particularly, for `HyperellipticCurve(y^5+y+1)` we would have a problem, since you probably do not want to name the other variable `y` as well. So perhaps there should be an option to give the name of the second variable (only) ?

Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?



---

archive/issue_comments_479277.json:
```json
{
    "body": "<a id='comment:14'>Comment 14:</a>\n+1 to an optional argument to name the second variable.",
    "created_at": "2021-08-01T18:33:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479277",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:14'>Comment 14:</a>
+1 to an optional argument to name the second variable.



---

archive/issue_comments_479278.json:
```json
{
    "body": "<a id='comment:15'>Comment 15:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f\">d14ff21</a></td><td><code>add optional name= keyword argument to HyperellipticCurve() -- see #30087</code></td></tr></table>\n",
    "created_at": "2021-08-03T05:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479278",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:15'>Comment 15:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f">d14ff21</a></td><td><code>add optional name= keyword argument to HyperellipticCurve() -- see #30087</code></td></tr></table>




---

archive/issue_comments_479279.json:
```json
{
    "body": "Changed commit from **[15afac4](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)** to **[d14ff21](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)**",
    "created_at": "2021-08-03T05:30:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479279",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[15afac4](https://github.com/sagemath/sagetrac-mirror/commit/15afac49df2a2e8512c644e72f0d2f21de9696d4)** to **[d14ff21](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)**



---

archive/issue_comments_479280.json:
```json
{
    "body": "<a id='comment:16'>Comment 16:</a>\nReplying to [@kedlaya](#comment%3A14):\n> +1 to an optional argument to name the second variable.\n\nDone.\n\nReplying to [@nbruin](#comment%3A13):\n> Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?\n\nThis should clearly be (and already is) `x^2 = y^5 + y + 1`: The meaning of `names=` is to forget about the original variables of `f` and `h` and use the given names instead.",
    "created_at": "2021-08-03T05:32:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479280",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:16'>Comment 16:</a>
Replying to [@kedlaya](#comment%3A14):
> +1 to an optional argument to name the second variable.

Done.

Replying to [@nbruin](#comment%3A13):
> Currently, the interface creates unnecessary ambiguity: what would `HyperellipticCurve(x^5+x+1,'y,x')` be?

This should clearly be (and already is) `x^2 = y^5 + y + 1`: The meaning of `names=` is to forget about the original variables of `f` and `h` and use the given names instead.



---

archive/issue_comments_479281.json:
```json
{
    "body": "<a id='comment:17'>Comment 17:</a>\nAnother possibility would be to allow `names=[None, 'z']`\nto specify the second name only.",
    "created_at": "2021-08-03T07:55:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479281",
    "user": "https://github.com/slel"
}
```

<a id='comment:17'>Comment 17:</a>
Another possibility would be to allow `names=[None, 'z']`
to specify the second name only.



---

archive/issue_comments_479282.json:
```json
{
    "body": "Changed commit from **[d14ff21](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)** to **[a9f3042](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)**",
    "created_at": "2021-08-05T09:06:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479282",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[d14ff21](https://github.com/sagemath/sagetrac-mirror/commit/d14ff212497a1ae4bd147648e3d8795f030af31f)** to **[a9f3042](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)**



---

archive/issue_comments_479283.json:
```json
{
    "body": "<a id='comment:18'>Comment 18:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/102d7e19707f83f0343884272253ce23babb5fcd\">102d7e1</a></td><td><code>Revert \"add optional name= keyword argument to HyperellipticCurve() -- see #30087\"</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95\">a9f3042</a></td><td><code>allow passing just one name in names= for HyperellipticCurve() -- see #30087</code></td></tr></table>\n",
    "created_at": "2021-08-05T09:06:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479283",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:18'>Comment 18:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/102d7e19707f83f0343884272253ce23babb5fcd">102d7e1</a></td><td><code>Revert "add optional name= keyword argument to HyperellipticCurve() -- see #30087"</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95">a9f3042</a></td><td><code>allow passing just one name in names= for HyperellipticCurve() -- see #30087</code></td></tr></table>




---

archive/issue_comments_479284.json:
```json
{
    "body": "<a id='comment:19'>Comment 19:</a>\nReplying to [@slel](#comment%3A17):\n> Another possibility would be to allow `names=[None, 'z']`\n> to specify the second name only.\n\nThanks for the suggestion. I agree that the interface is cleaner without the redundancy of having two different arguments.",
    "created_at": "2021-08-05T09:09:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479284",
    "user": "https://github.com/yyyyx4"
}
```

<a id='comment:19'>Comment 19:</a>
Replying to [@slel](#comment%3A17):
> Another possibility would be to allow `names=[None, 'z']`
> to specify the second name only.

Thanks for the suggestion. I agree that the interface is cleaner without the redundancy of having two different arguments.



---

archive/issue_events_382441.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382441"
}
```



---

archive/issue_events_382442.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382442"
}
```



---

archive/issue_comments_479285.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479285",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>Comment 20:</a>
Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_382443.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382443"
}
```



---

archive/issue_events_382444.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-05-03T15:17:06Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382444"
}
```



---

archive/issue_events_382445.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382445"
}
```



---

archive/issue_events_382446.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30087#event-382446"
}
```



---

archive/issue_comments_479286.json:
```json
{
    "body": "Changed commit from **[a9f3042](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)** to **[627adb0](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**",
    "created_at": "2022-10-17T15:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479286",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[a9f3042](https://github.com/sagemath/sagetrac-mirror/commit/a9f30428b6c99db1b258d171b8e4e45965013a95)** to **[627adb0](https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca)**



---

archive/issue_comments_479287.json:
```json
{
    "body": "<a id='comment:23'>Comment 23:</a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca\">627adb0</a></td><td><code>Merge tag '9.8.beta2' into public/fix_hyperelliptic_jacobian_crash_variable_name</code></td></tr></table>\n",
    "created_at": "2022-10-17T15:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30087",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30087#issuecomment-479287",
    "user": "https://github.com/sagetrac-git"
}
```

<a id='comment:23'>Comment 23:</a>
Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/627adb0ae77595b534d2ffa14ebfbedac4883bca">627adb0</a></td><td><code>Merge tag '9.8.beta2' into public/fix_hyperelliptic_jacobian_crash_variable_name</code></td></tr></table>

