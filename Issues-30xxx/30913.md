# Issue 30913: sagelib: Generate pyproject.toml and setup.cfg [install_requires], requirements.txt, Pipfile, and src/Pipfile

archive/issues_030676.json:
```json
{
    "body": "After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n\nAs of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. \n\nAs part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n\n(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n\n**To test - use `./bootstrap` and then configure and build the Sage distribution.**  Then follow the instructions in `build/pkgs/sagelib/src/tox.ini`:\n\n```\n    #\n    # SUPPORTED ENVIRONMENTS:\n    #\n    # Build dependencies according to requirements.txt (all versions fixed).\n    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):\n    #\n    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n    #\n    python-sagewheels-nopypi,\n    #\n    # Build and test without using the concrete dependencies specified by requirements.txt,\n    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:\n    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).\n    #\n    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'\n    #\n    python-sagewheels-nopypi-norequirements,\n    #\n```\n**Related or follow-up tickets:**\n- #31377 `./configure --enable-editable`\n- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n- #28752 Make sagelib pip-installable in a conda environment\n- #30371 In-place (editable) installs of sagelib in a venv\n- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n\nReferences:\n- https://snarky.ca/what-the-heck-is-pyproject-toml/\n\n\n\n\n\nCC:  @dimpase @tobiasdiez @jhpalmieri @videlec @kiwifb @malb\n\nKeywords: sd111\n\nBranch/Commit: 04da2c6eb85566de6d49bf19803a061f4843c662\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30913\n\n",
    "closed_at": "2021-05-27T20:30:52Z",
    "created_at": "2020-11-14T07:21:10Z",
    "labels": [
        "component: build",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "sagelib: Generate pyproject.toml and setup.cfg [install_requires], requirements.txt, Pipfile, and src/Pipfile",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30913",
    "user": "https://github.com/mkoeppe"
}
```
After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  

As of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. 

As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.

(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)

**To test - use `./bootstrap` and then configure and build the Sage distribution.**  Then follow the instructions in `build/pkgs/sagelib/src/tox.ini`:

```
    #
    # SUPPORTED ENVIRONMENTS:
    #
    # Build dependencies according to requirements.txt (all versions fixed).
    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):
    #
    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
    #
    python-sagewheels-nopypi,
    #
    # Build and test without using the concrete dependencies specified by requirements.txt,
    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:
    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).
    #
    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'
    #
    python-sagewheels-nopypi-norequirements,
    #
```
**Related or follow-up tickets:**
- #31377 `./configure --enable-editable`
- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
- #28752 Make sagelib pip-installable in a conda environment
- #30371 In-place (editable) installs of sagelib in a venv
- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.

References:
- https://snarky.ca/what-the-heck-is-pyproject-toml/





CC:  @dimpase @tobiasdiez @jhpalmieri @videlec @kiwifb @malb

Keywords: sd111

Branch/Commit: 04da2c6eb85566de6d49bf19803a061f4843c662

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30913





---

archive/issue_comments_467784.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,4 @@\n+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2020-11-15T03:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467784",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,4 @@
+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467785.json:
```json
{
    "body": "<a id='comment:3'></a>Last 10 new commits:",
    "created_at": "2020-11-15T03:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467785",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Last 10 new commits:



---

archive/issue_comments_467786.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-15T03:43:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467786",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_467787.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-15T04:21:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467787",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467788.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-20T00:44:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467788",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467789.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-20T02:07:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467789",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467790.json:
```json
{
    "body": "<a id='comment:10'></a>Will this be able to deal with optional package declarations (in time)?",
    "created_at": "2020-11-20T19:46:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467790",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:10'></a>Will this be able to deal with optional package declarations (in time)?



---

archive/issue_comments_467791.json:
```json
{
    "body": "<a id='comment:11'></a>The plan for optional packages is that users would install a package such as `sagemath-meataxe` or `sagemath-tdlib` in addition to `sagemath-standard`.",
    "created_at": "2020-11-20T19:50:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467791",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>The plan for optional packages is that users would install a package such as `sagemath-meataxe` or `sagemath-tdlib` in addition to `sagemath-standard`.



---

archive/issue_comments_467792.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-27T04:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467792",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467793.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:43:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467793",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_467794.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-10T19:25:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467794",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467795.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.\n \n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` added in #30578), use\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n \n Dependencies: #30578, #30912\n \n```\n",
    "created_at": "2020-12-10T19:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467795",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,11 @@
+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.
 
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` added in #30578), use
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
 
 Dependencies: #30578, #30912
 
```




---

archive/issue_comments_467796.json:
```json
{
    "body": "<a id='comment:16'></a>Added instructions for testing to the ticket description. \nIn particular, this reveals the missing dependencies of upstream Python packages tracked in #30922.",
    "created_at": "2020-12-10T19:28:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467796",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:16'></a>Added instructions for testing to the ticket description. 
In particular, this reveals the missing dependencies of upstream Python packages tracked in #30922.



---

archive/issue_comments_467797.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-10T19:36:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467797",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467798.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T01:01:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467798",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467799.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T01:22:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467799",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467800.json:
```json
{
    "body": "<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T06:05:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467800",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467801.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T06:26:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467801",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467802.json:
```json
{
    "body": "<a id='comment:22'></a>To generate the `requirements.txt` file as well, need #29041",
    "created_at": "2020-12-12T06:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467802",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>To generate the `requirements.txt` file as well, need #29041



---

archive/issue_comments_467803.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-12T06:27:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467803",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_467804.json:
```json
{
    "body": "<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T07:23:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467804",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:23'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467805.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-12-12T07:37:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467805",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_467806.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,4 +1,11 @@\n+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.\n \n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n \n Dependencies: #30578, #30912\n \n```\n",
    "created_at": "2020-12-12T07:38:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467806",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,4 +1,11 @@
+As part of `bootstrap`, we generate the `install_requires` information using m4 from the information added in #30719.
 
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
 
 Dependencies: #30578, #30912
 
```




---

archive/issue_comments_467807.json:
```json
{
    "body": "<a id='comment:26'></a>Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap. Then one would only need to update them as part of a package update (having a (doc)test to verify that the content of these files is always up-to-date).\n\nA few more observations while scrolling through the code:\n- I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.\n- Are the symlinks really necessary? I would prefer if instead the path of the original is passed to e.g. setuptools.\n- Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?",
    "created_at": "2020-12-12T20:47:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467807",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:26'></a>Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap. Then one would only need to update them as part of a package update (having a (doc)test to verify that the content of these files is always up-to-date).

A few more observations while scrolling through the code:
- I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.
- Are the symlinks really necessary? I would prefer if instead the path of the original is passed to e.g. setuptools.
- Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?



---

archive/issue_comments_467808.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:26 gh-tobiasdiez]:\n> Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap.\n\n\nNo, this is preparation for modularization, in which we will have dozens of packages.\nAuto-generation is key for maintainability.",
    "created_at": "2020-12-12T20:51:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467808",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:26 gh-tobiasdiez]:
> Since the setup.cfg and requirments.txt file are static (do not depend on the developers/users system), I would check them in as normal files instead of auto-generating them as part of the bootstrap.


No, this is preparation for modularization, in which we will have dozens of packages.
Auto-generation is key for maintainability.



---

archive/issue_comments_467809.json:
```json
{
    "body": "<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:\n> - I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.\n\n\nThe new file is the license for sagelib. Different from the one in top-level, which is about the Sage distribution.",
    "created_at": "2020-12-12T20:53:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467809",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>Replying to [comment:26 gh-tobiasdiez]:
> - I think the Licence file should be in the root, so that other tools (e.g. github) automatically pick them up.


The new file is the license for sagelib. Different from the one in top-level, which is about the Sage distribution.



---

archive/issue_comments_467810.json:
```json
{
    "body": "<a id='comment:29'></a>You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.",
    "created_at": "2020-12-12T20:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467810",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:29'></a>You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.



---

archive/issue_comments_467811.json:
```json
{
    "body": "<a id='comment:30'></a>Replying to [comment:26 gh-tobiasdiez]:\n> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?\n\n\nIt needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`",
    "created_at": "2020-12-12T20:54:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467811",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>Replying to [comment:26 gh-tobiasdiez]:
> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?


It needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`



---

archive/issue_comments_467812.json:
```json
{
    "body": "<a id='comment:31'></a>Replying to [comment:30 mkoeppe]:\n> Replying to [comment:26 gh-tobiasdiez]:\n> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?\n \n> \n> It needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`\n\n\nWhat If I want to have the wheels outside of the current local folder?",
    "created_at": "2020-12-12T20:57:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467812",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:31'></a>Replying to [comment:30 mkoeppe]:
> Replying to [comment:26 gh-tobiasdiez]:
> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?
 
> 
> It needs to be configurable. For example `local` can be replaced by the user using `./configure --prefix`


What If I want to have the wheels outside of the current local folder?



---

archive/issue_comments_467813.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:29 gh-tobiasdiez]:\n> You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.\n\n\nI don't like to have generated files in the git repository. The only files for which we do that (the release manager does, actually) is to update Sage's own version files, and in the long term I would actually change that.",
    "created_at": "2020-12-12T20:57:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467813",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>Replying to [comment:29 gh-tobiasdiez]:
> You can still auto-generate these files! My suggestion was to only to it when updating a package and not on bootstrap.


I don't like to have generated files in the git repository. The only files for which we do that (the release manager does, actually) is to update Sage's own version files, and in the long term I would actually change that.



---

archive/issue_comments_467814.json:
```json
{
    "body": "<a id='comment:33'></a>Replying to [comment:31 gh-tobiasdiez]:\n> What If I want to have the wheels outside of the current local folder?\n\n\nYou pass the environment variable to tox",
    "created_at": "2020-12-12T20:58:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467814",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>Replying to [comment:31 gh-tobiasdiez]:
> What If I want to have the wheels outside of the current local folder?


You pass the environment variable to tox



---

archive/issue_comments_467815.json:
```json
{
    "body": "<a id='comment:34'></a>By the way, we could also generate Pipfile here on this ticket ...",
    "created_at": "2020-12-12T21:00:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467815",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>By the way, we could also generate Pipfile here on this ticket ...



---

archive/issue_comments_467816.json:
```json
{
    "body": "<a id='comment:35'></a>Replying to [comment:26 gh-tobiasdiez]:\n> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?\n\n\nI think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. \n\nBut I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`",
    "created_at": "2020-12-12T21:11:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467816",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Replying to [comment:26 gh-tobiasdiez]:
> - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?


I think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. 

But I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`



---

archive/issue_comments_467817.json:
```json
{
    "body": "<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-12T21:14:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467817",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:36'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467818.json:
```json
{
    "body": "<a id='comment:37'></a>Replying to [comment:35 mkoeppe]:\n> Replying to [comment:26 gh-tobiasdiez]:\n> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?\n \n> \n> I think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. \n> \n> But I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`\n\n\nAnd I missed that the SAGE_LOCAL part is only the fallback in case SAGE_SPKG_WHEELS doesn't exist.",
    "created_at": "2020-12-12T21:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467818",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:37'></a>Replying to [comment:35 mkoeppe]:
> Replying to [comment:26 gh-tobiasdiez]:
> > - Concerning `sagewheels:      --index-url=file://{env:SAGE_SPKG_WHEELS:{env:SAGE_LOCAL:{toxinidir}/../../../../local}/var/lib/sage/wheels/simple}`, wouldn't it be easier to let `SAGE_SPKG_WHEELS` point to the full location of the wheels (e.g. `local/var/lib/sage/wheels/simple`)?
 
> 
> I think I misunderstood your question. Yes, the variable `SAGE_SPKG_WHEELS` is expected to point to the full location of the wheels when set. 
> 
> But I made a mistake - the `simple` is not expected to be part of `SAGE_SPKG_WHEELS`


And I missed that the SAGE_LOCAL part is only the fallback in case SAGE_SPKG_WHEELS doesn't exist.



---

archive/issue_comments_467819.json:
```json
{
    "body": "<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-13T01:18:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467819",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:38'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467820.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-12-13T12:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467820",
    "user": "https://github.com/tobiasdiez"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_467821.json:
```json
{
    "body": "<a id='comment:40'></a>Thanks for also generating the pipfile. However, you are currently locking the version of most packages. The idea, however, is that the pipfile is quite liberal, and only specifies the minimal version requirements (e.g. if an older version of a package is known not to work for some reason). The specific package versions are in the pipfile.lock file, which can be automatically generated by pipenv (which also contains versions for the whole dependency tree).",
    "created_at": "2020-12-13T12:36:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467821",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:40'></a>Thanks for also generating the pipfile. However, you are currently locking the version of most packages. The idea, however, is that the pipfile is quite liberal, and only specifies the minimal version requirements (e.g. if an older version of a package is known not to work for some reason). The specific package versions are in the pipfile.lock file, which can be automatically generated by pipenv (which also contains versions for the whole dependency tree).



---

archive/issue_comments_467822.json:
```json
{
    "body": "<a id='comment:41'></a>Hm... If that is so, then we should generate this information from the version constraints that are in the files `install-requires.txt`.\n\nBut what if the user wants to lock the same versions that are defined in the Sage distribution?\n\nAnd also my guess is that `Pipfile` should then also contain lists of packages that are not actual dependencies of `sagelib` but are present in the Sage distribution. Otherwise, `Pipfile` would just encode the same package and version requirements that are already known by `setup.cfg install-requires` -- that can't be the whole purpose of `Pipfile`.",
    "created_at": "2020-12-13T17:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467822",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>Hm... If that is so, then we should generate this information from the version constraints that are in the files `install-requires.txt`.

But what if the user wants to lock the same versions that are defined in the Sage distribution?

And also my guess is that `Pipfile` should then also contain lists of packages that are not actual dependencies of `sagelib` but are present in the Sage distribution. Otherwise, `Pipfile` would just encode the same package and version requirements that are already known by `setup.cfg install-requires` -- that can't be the whole purpose of `Pipfile`.



---

archive/issue_comments_467823.json:
```json
{
    "body": "<a id='comment:42'></a>I think we should really separate between sage-the-distribution and sage-the-library.\n\nFor a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions). The pipfile is not really necessary in this case, except that it defines a test/development environment. Here, the pipfile declares the abstract requirements, and the pipfile.lock is saying \"these versions are known to work\". So for sage, one might consider to sync the pipfile.lock with the version information in build/pkgs but that's really hard to do because pipenv also calculates hashes etc (I guess). \n\nFor applications, you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).\n\nSee https://pipenv.pypa.io/en/latest/advanced/#pipfile-vs-setup-py for more details.\n\nMy proposal would be to use pipenv at the moment only for providing a test environment. In this case, one strategy would be to only put the pipfile (with it's abstract dependencies) under version control, and generate the pipenv.lock as a build artifact (so that if the test fail, one could regenerate the exact same environment locally). Moreover, there could be a second pipfile (and pipfile.lock) in the build folder, specifying the same versions as in the build/pkgs folder (to make it simpler to create a test environment that equals the distributed environment).",
    "created_at": "2020-12-13T21:46:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467823",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:42'></a>I think we should really separate between sage-the-distribution and sage-the-library.

For a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions). The pipfile is not really necessary in this case, except that it defines a test/development environment. Here, the pipfile declares the abstract requirements, and the pipfile.lock is saying "these versions are known to work". So for sage, one might consider to sync the pipfile.lock with the version information in build/pkgs but that's really hard to do because pipenv also calculates hashes etc (I guess). 

For applications, you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).

See https://pipenv.pypa.io/en/latest/advanced/#pipfile-vs-setup-py for more details.

My proposal would be to use pipenv at the moment only for providing a test environment. In this case, one strategy would be to only put the pipfile (with it's abstract dependencies) under version control, and generate the pipenv.lock as a build artifact (so that if the test fail, one could regenerate the exact same environment locally). Moreover, there could be a second pipfile (and pipfile.lock) in the build folder, specifying the same versions as in the build/pkgs folder (to make it simpler to create a test environment that equals the distributed environment).



---

archive/issue_comments_467824.json:
```json
{
    "body": "<a id='comment:43'></a>Replying to [comment:42 gh-tobiasdiez]:\n> I think we should really separate between sage-the-distribution and sage-the-library.\n> \n> For a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions).\n\n\n\"Without version information\" -- surely you mean \"without fixing specific versions\"",
    "created_at": "2020-12-13T21:54:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467824",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Replying to [comment:42 gh-tobiasdiez]:
> I think we should really separate between sage-the-distribution and sage-the-library.
> 
> For a library, you specify the abstract dependencies via `install-requires`. It's important to do that without version information because otherwise that might lead to ugly dependency issues for users of that library (e.g. if another library requires incompatible dependency versions).


"Without version information" -- surely you mean "without fixing specific versions"



---

archive/issue_comments_467825.json:
```json
{
    "body": "<a id='comment:44'></a>Replying to [comment:42 gh-tobiasdiez]:\n> I think we should really separate between sage-the-distribution and sage-the-library.\n> \n> For a library, [...]\n\n\nRight, I would consider sagelib a library...\n\n> For applications, \n\n\n... which the sage distribution should probably considered to be ...\n\n> you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. \n\n\nWell, we won't remove the Python packages from `build/pkgs`. But I want to enable the users to use `pipenv` for exactly this at their option. In particular in combination with #30896\t(`./configure --without-sage-venv`) this would be an interesting way to build Sage.\n\n> Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).\n\n\nLet's investigate if the `pipfile.lock` file really needs to include hashes or we can get away with automatically generating a weaker version",
    "created_at": "2020-12-13T22:00:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467825",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>Replying to [comment:42 gh-tobiasdiez]:
> I think we should really separate between sage-the-distribution and sage-the-library.
> 
> For a library, [...]


Right, I would consider sagelib a library...

> For applications, 


... which the sage distribution should probably considered to be ...

> you declare all dependencies in the pipfile, and use pipenv to create the whole concrete dependency tree meeting all restricts for all dependencies and their subdependencies. Adopting pipenv for this purpose in sage, you could remove all pip-packages from build/pkgs and let pipenv manage all Python dependencies. 


Well, we won't remove the Python packages from `build/pkgs`. But I want to enable the users to use `pipenv` for exactly this at their option. In particular in combination with #30896	(`./configure --without-sage-venv`) this would be an interesting way to build Sage.

> Then the pipfile indeed would need to declare all packages that are currently present in the sage distribution (so it would more or less correspond to the list of folders in build/pkgs) and the pipfile.lock contains the exact version information, including where to get it and the files hashes (so basically the content of the folders in build/pkgs).


Let's investigate if the `pipfile.lock` file really needs to include hashes or we can get away with automatically generating a weaker version



---

archive/issue_comments_467826.json:
```json
{
    "body": "<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-12-15T01:06:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467826",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:45'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_467827.json:
```json
{
    "body": "<a id='comment:46'></a>Last 10 new commits:",
    "created_at": "2020-12-15T01:06:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467827",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:46'></a>Last 10 new commits:



---

archive/issue_comments_467828.json:
```json
{
    "body": "<a id='comment:47'></a>Replying to [comment:43 mkoeppe]:\n> \"Without version information\" -- surely you mean \"without fixing specific versions\"\n\n\nWell, only specifying known upper and lower bounds for the versions. Maybe it would make sense to add min/max version information in build/pkgs?\n\n\n> Let's investigate if the pipfile.lock file really needs to include hashes or we can get away with automatically generating a weaker version.\n\n\nThe hashes and the complete dependency tree is what makes pipenv special over requirements.txt. For applications (i.e. sage distribution), it should be fine to pin the versions in the pipfile (in the build folder). Normally you don't want to do this because it makes upgrades harder (if the versions are free, you can simply run `pipenv update` for this). But since upgrades are done differently in sage anyway, it should be fine.\n\nSo what you think about the following:\n- One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)\n- One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)",
    "created_at": "2020-12-15T12:57:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467828",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:47'></a>Replying to [comment:43 mkoeppe]:
> "Without version information" -- surely you mean "without fixing specific versions"


Well, only specifying known upper and lower bounds for the versions. Maybe it would make sense to add min/max version information in build/pkgs?


> Let's investigate if the pipfile.lock file really needs to include hashes or we can get away with automatically generating a weaker version.


The hashes and the complete dependency tree is what makes pipenv special over requirements.txt. For applications (i.e. sage distribution), it should be fine to pin the versions in the pipfile (in the build folder). Normally you don't want to do this because it makes upgrades harder (if the versions are free, you can simply run `pipenv update` for this). But since upgrades are done differently in sage anyway, it should be fine.

So what you think about the following:
- One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)
- One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)



---

archive/issue_comments_467829.json:
```json
{
    "body": "<a id='comment:48'></a>Replying to [comment:47 gh-tobiasdiez]:\n> Maybe it would make sense to add min/max version information in build/pkgs?\n\n\nThis information was recently added in the files `install-requires.txt`\nand this is what we are generating `setup.cfg [install_requires]` from.",
    "created_at": "2020-12-16T22:01:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467829",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:48'></a>Replying to [comment:47 gh-tobiasdiez]:
> Maybe it would make sense to add min/max version information in build/pkgs?


This information was recently added in the files `install-requires.txt`
and this is what we are generating `setup.cfg [install_requires]` from.



---

archive/issue_comments_467830.json:
```json
{
    "body": "<a id='comment:49'></a>Replying to [comment:47 gh-tobiasdiez]:\n> So what you think about the following:\n> - One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)\n\n\nYes, we can do this; except I would put in `SAGE_ROOT`, not `SAGE_ROOT/build`. (We create environment files for conda there already. And `build` is the location of the `setup.py` of `sage_bootstrap` - so that would be confusing.)\n\n> - One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)  \n\n\nOK.",
    "created_at": "2020-12-17T17:33:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467830",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>Replying to [comment:47 gh-tobiasdiez]:
> So what you think about the following:
> - One pipfile in build (pipfile.lock in gitignore) with all packages in the distribution and version information locked (for users to use pipenv to install pip packages)


Yes, we can do this; except I would put in `SAGE_ROOT`, not `SAGE_ROOT/build`. (We create environment files for conda there already. And `build` is the location of the `setup.py` of `sage_bootstrap` - so that would be confusing.)

> - One pipfile in src (pipfile.lock in gitignore) with all dependencies of sagelib and version information as free as possible (for developers to generate a dev environment, and for CI as test environment)  


OK.



---

archive/issue_comments_467831.json:
```json
{
    "body": "<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-17T17:46:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467831",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:50'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467832.json:
```json
{
    "body": "<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-17T18:01:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467832",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:51'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467833.json:
```json
{
    "body": "<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-17T18:03:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467833",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:52'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467834.json:
```json
{
    "body": "<a id='comment:53'></a>OK, here is a version as a starting point.",
    "created_at": "2020-12-17T18:07:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467834",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:53'></a>OK, here is a version as a starting point.



---

archive/issue_comments_467835.json:
```json
{
    "body": "<a id='comment:54'></a>Help with getting the pipfiles in shape would be very welcome",
    "created_at": "2020-12-17T18:38:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467835",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:54'></a>Help with getting the pipfiles in shape would be very welcome



---

archive/issue_comments_467836.json:
```json
{
    "body": "<a id='comment:55'></a>Replying to [comment:48 mkoeppe]:\n> This information was recently added in the files `install-requires.txt`\n> and this is what we are generating `setup.cfg [install_requires]` from.\n\n\nOk, good to know!",
    "created_at": "2020-12-18T12:33:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467836",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:55'></a>Replying to [comment:48 mkoeppe]:
> This information was recently added in the files `install-requires.txt`
> and this is what we are generating `setup.cfg [install_requires]` from.


Ok, good to know!



---

archive/issue_comments_467837.json:
```json
{
    "body": "<a id='comment:56'></a>Replying to [comment:54 mkoeppe]:\n> Help with getting the pipfiles in shape would be very welcome\n\n\nYou took the initial pipfile from my ticket, right? They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).",
    "created_at": "2020-12-18T12:35:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467837",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:56'></a>Replying to [comment:54 mkoeppe]:
> Help with getting the pipfiles in shape would be very welcome


You took the initial pipfile from my ticket, right? They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).



---

archive/issue_comments_467838.json:
```json
{
    "body": "<a id='comment:57'></a>For the files in build/pkgs/sagelib, are they meant for distribution? In this case, it's probably enough to add only the pipfile in the root there (since src/pipfile is for developers only).\n\nSince the pipfile in the root seems to be only for distribution, why not put it directly in `build/pgks/sagelib`?",
    "created_at": "2020-12-18T12:38:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467838",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:57'></a>For the files in build/pkgs/sagelib, are they meant for distribution? In this case, it's probably enough to add only the pipfile in the root there (since src/pipfile is for developers only).

Since the pipfile in the root seems to be only for distribution, why not put it directly in `build/pgks/sagelib`?



---

archive/issue_comments_467839.json:
```json
{
    "body": "<a id='comment:58'></a>Replying to [comment:56 gh-tobiasdiez]:\n> Replying to [comment:54 mkoeppe]:\n> > Help with getting the pipfiles in shape would be very welcome\n\n> \n> You took the initial pipfile from my ticket, right? \n\n\nYes\n\n> They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).\n\n\nThe version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.",
    "created_at": "2020-12-21T18:03:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467839",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:58'></a>Replying to [comment:56 gh-tobiasdiez]:
> Replying to [comment:54 mkoeppe]:
> > Help with getting the pipfiles in shape would be very welcome

> 
> You took the initial pipfile from my ticket, right? 


Yes

> They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).


The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.



---

archive/issue_comments_467840.json:
```json
{
    "body": "<a id='comment:59'></a>Replying to [comment:58 mkoeppe]:\n> > They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).\n\n> \n> The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.\n> \n\n\nPipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?",
    "created_at": "2020-12-22T10:28:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467840",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:59'></a>Replying to [comment:58 mkoeppe]:
> > They actually look good to me. I'm not sure which packages are missing (as the sagedocs seem to mostly pass with the current ones). Note that pipenv is able to resolve sub-dependencies automatically, so they don't need to be specified in the pipfile (but are in build/pkgs of course).

> 
> The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.
> 


Pipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?



---

archive/issue_comments_467841.json:
```json
{
    "body": "<a id='comment:60'></a>Replying to [comment:59 gh-tobiasdiez]:\n> > The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.\n> > \n\n> \n> Pipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?\n\n\nMost dependencies are actually not just build dependencies but runtime dependencies.\nFor example - `matplotlib` depends on `dateutil`",
    "created_at": "2020-12-22T14:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467841",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:60'></a>Replying to [comment:59 gh-tobiasdiez]:
> > The version of the pipfile that pins the versions to the sage distribution's versions will need the pinnings of these dependencies.
> > 

> 
> Pipenv will use the prebuilt wheels anyway, so there is no point in installing build dependencies for these packages, right?


Most dependencies are actually not just build dependencies but runtime dependencies.
For example - `matplotlib` depends on `dateutil`



---

archive/issue_comments_467842.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'\n+```\n+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)\n+\n+**Testing install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n+\n+**Testing Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-18T04:44:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467842",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
+```
+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)
+
+**Testing install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
+
+**Testing Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467843.json:
```json
{
    "body": "<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-18T20:35:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467843",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:64'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467844.json:
```json
{
    "body": "<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-18T20:46:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467844",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:65'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467845.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'\n+```\n+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)\n+\n+**Testing install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-18T20:50:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467845",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
+```
+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)
+
+**Testing install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467846.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'\n+```\n+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)\n+\n+**Testing install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-19T01:07:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467846",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
+```
+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)
+
+**Testing install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `install_requires` only (and not the concrete requirements from `requirements.txt` first added in #30578 and now generated too), use
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467847.json:
```json
{
    "body": "<a id='comment:68'></a>When trying to use the \"install-requires\" method, I am running into the problem that Cython does not seem to find the `.pxd` files of build requirements that are provided in pip's build isolation, such as `cysignals`.",
    "created_at": "2021-01-19T01:52:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467847",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:68'></a>When trying to use the "install-requires" method, I am running into the problem that Cython does not seem to find the `.pxd` files of build requirements that are provided in pip's build isolation, such as `cysignals`.



---

archive/issue_comments_467848.json:
```json
{
    "body": "<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-19T07:36:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:69'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467849.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,39 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `pyproject.toml` and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'\n+```\n+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)\n+\n+**Testing pyproject.toml and install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-20T21:04:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467849",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,39 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `pyproject.toml` and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
+```
+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)
+
+**Testing pyproject.toml and install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467850.json:
```json
{
    "body": "<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-20T22:48:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467850",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:71'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467851.json:
```json
{
    "body": "<a id='comment:72'></a>`./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -r -v -v -v -e python-sagewheels-norequirements)'` now gets all the way to here:\n\n```\n/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage -c 'import sys; print(\"sys.path =\", sys.path); import sage.all; print(sage.all.__file__)'\nTraceback (most recent call last):\n  File \"/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage-location\", line 11, in <module>\n    SAGE_ROOT     = os.path.realpath(os.environ['SAGE_ROOT'])\n  File \"/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/os.py\", line 679, in __getitem__\n    raise KeyError(key) from None\nKeyError: 'SAGE_ROOT'\n```\nSo let's finally get rid of this `sage-location` business in #21783.",
    "created_at": "2021-01-20T23:03:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467851",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:72'></a>`./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -r -v -v -v -e python-sagewheels-norequirements)'` now gets all the way to here:

```
/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage -c 'import sys; print("sys.path =", sys.path); import sage.all; print(sage.all.__file__)'
Traceback (most recent call last):
  File "/Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-norequirements/bin/sage-location", line 11, in <module>
    SAGE_ROOT     = os.path.realpath(os.environ['SAGE_ROOT'])
  File "/usr/local/Cellar/python@3.9/3.9.1_1/Frameworks/Python.framework/Versions/3.9/lib/python3.9/os.py", line 679, in __getitem__
    raise KeyError(key) from None
KeyError: 'SAGE_ROOT'
```
So let's finally get rid of this `sage-location` business in #21783.



---

archive/issue_comments_467852.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,46 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'\n+```\n+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)\n+\n+**Testing pyproject.toml and install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-21T00:44:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467852",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,46 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v)'
+```
+(Reusing wheels built by the Sage distribution requires to do `sage -i pip2pi` first - this is from #30527.)
+
+**Testing pyproject.toml and install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467853.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,46 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'\n+```\n+\n+\n+**Testing pyproject.toml and install-requires:**\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+- Use pipenv\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-21T01:44:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467853",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,46 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'
+```
+
+
+**Testing pyproject.toml and install-requires:**
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+In particular, to use `pyproject.toml` and `install_requires` only (and not the concrete requirements from `requirements.txt`), use
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+- Use pipenv
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467854.json:
```json
{
    "body": "<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-21T02:08:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467854",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:77'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467855.json:
```json
{
    "body": "<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-21T02:18:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467855",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:78'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467856.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,45 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'\n+```\n+\n+\n+**Testing pyproject.toml and install-requires:**\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'\n+\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-21T02:19:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467856",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,45 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'
+```
+
+
+**Testing pyproject.toml and install-requires:**
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'
+
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467857.json:
```json
{
    "body": "<a id='comment:80'></a>`./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'` now leads to ...\n\n```\npipenv.exceptions.ResolutionFailure: ERROR: Could not find a version that matches gmpy2>=2.1.0b5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenvt6rhur8arequirements/pipenv-53ckyr68-constraints.txt (line 2))\nTried: 2.0.1, 2.0.2, 2.0.3, 2.0.4, 2.0.5, 2.0.6, 2.0.7, 2.0.8\nSkipped pre-versions: 2.1.0a1, 2.1.0a2, 2.1.0a3, 2.1.0a4, 2.1.0b1, 2.1.0b3, 2.1.0b4, 2.1.0b5, 2.1.0b5\n```",
    "created_at": "2021-01-21T02:20:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467857",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:80'></a>`./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'` now leads to ...

```
pipenv.exceptions.ResolutionFailure: ERROR: Could not find a version that matches gmpy2>=2.1.0b5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenvt6rhur8arequirements/pipenv-53ckyr68-constraints.txt (line 2))
Tried: 2.0.1, 2.0.2, 2.0.3, 2.0.4, 2.0.5, 2.0.6, 2.0.7, 2.0.8
Skipped pre-versions: 2.1.0a1, 2.1.0a2, 2.1.0a3, 2.1.0a4, 2.1.0b1, 2.1.0b3, 2.1.0b4, 2.1.0b5, 2.1.0b5
```



---

archive/issue_comments_467858.json:
```json
{
    "body": "<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-21T03:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:81'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467859.json:
```json
{
    "body": "<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-21T08:15:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:82'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467860.json:
```json
{
    "body": "<a id='comment:83'></a>As is to be expected, if the correct version of a package is not already built in `local/var/lib/sage/wheels` and `pipenv` tries to build the wheel, this can fail\n\n```\n  Building wheels for collected packages: pplpy\n    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5\n    Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5\n    Building wheel for pplpy (PEP 517): started\n...\n    ld: library not found for -lpari\n    clang: error: linker command failed with exit code 1 (use -v to see invocation)\n    error: command '/usr/bin/clang++' failed with exit code 1\n    Building wheel for pplpy (PEP 517): finished with status 'error'\n    ERROR: Failed building wheel for pplpy\n  Failed to build pplpy\n```",
    "created_at": "2021-01-21T08:23:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467860",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:83'></a>As is to be expected, if the correct version of a package is not already built in `local/var/lib/sage/wheels` and `pipenv` tries to build the wheel, this can fail

```
  Building wheels for collected packages: pplpy
    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5
    Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-jcmfqod5
    Building wheel for pplpy (PEP 517): started
...
    ld: library not found for -lpari
    clang: error: linker command failed with exit code 1 (use -v to see invocation)
    error: command '/usr/bin/clang++' failed with exit code 1
    Building wheel for pplpy (PEP 517): finished with status 'error'
    ERROR: Failed building wheel for pplpy
  Failed to build pplpy
```



---

archive/issue_comments_467861.json:
```json
{
    "body": "<a id='comment:84'></a>\n```\nUsing version 0.8.7 (newest of versions: 0.8.6, 0.8.7)\nCollecting pplpy>=0.8.6\n```",
    "created_at": "2021-01-21T08:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467861",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:84'></a>
```
Using version 0.8.7 (newest of versions: 0.8.6, 0.8.7)
Collecting pplpy>=0.8.6
```



---

archive/issue_comments_467862.json:
```json
{
    "body": "<a id='comment:85'></a>I released pplpy 0.8.7 to fix a weird issue with clang-11.0.0 on FreeBSD, see https://gitlab.com/videlec/pplpy/-/issues/21. As far as SageMath is concerned, there should be no difference.",
    "created_at": "2021-01-21T08:34:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467862",
    "user": "https://github.com/videlec"
}
```

<a id='comment:85'></a>I released pplpy 0.8.7 to fix a weird issue with clang-11.0.0 on FreeBSD, see https://gitlab.com/videlec/pplpy/-/issues/21. As far as SageMath is concerned, there should be no difference.



---

archive/issue_comments_467863.json:
```json
{
    "body": "<a id='comment:86'></a>Thanks for the update, Vincent. There is no problem.",
    "created_at": "2021-01-21T18:12:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467863",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:86'></a>Thanks for the update, Vincent. There is no problem.



---

archive/issue_comments_467864.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,46 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.\n+\n+**Testing requirements.txt:**\n+\n+A virtual environment using it can be created and doctested using:\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'\n+```\n+\n+\n+**Testing pyproject.toml and install-requires:**\n+\n+```\n+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'\n+```\n+\n+**Testing Pipfile and src/Pipfile:**\n+\n+```\n+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'\n+```\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-22T02:30:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467864",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,46 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, `requirements.txt` and `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - see instructions in `build/pkgs/sagelib/src/tox.ini`.
+
+**Testing requirements.txt:**
+
+A virtual environment using it can be created and doctested using:
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v python-sagewheels)'
+```
+
+
+**Testing pyproject.toml and install-requires:**
+
+```
+./bootstrap && ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-norequirements)'
+```
+
+**Testing Pipfile and src/Pipfile:**
+
+```
+./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-pipenv-sagewheels)'
+```
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467865.json:
```json
{
    "body": "<a id='comment:89'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-22T21:10:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:89'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467866.json:
```json
{
    "body": "<a id='comment:90'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-23T02:06:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:90'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467867.json:
```json
{
    "body": "<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-23T03:39:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467867",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:91'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467868.json:
```json
{
    "body": "<a id='comment:92'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-23T04:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467868",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:92'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467869.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-01-23T04:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467869",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_467870.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,26 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`.\n+\n+\n+**Related or follow-up tickets:**\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+ \n+\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-01-23T04:27:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467870",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,26 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`.
+
+
+**Related or follow-up tickets:**
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+ 
+
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467871.json:
```json
{
    "body": "<a id='comment:94'></a>This seems to work well now - but the variants using pipenv fail in mysterious ways. I have marked these variants as \"experimental\" in the comments in `build/pkgs/sagelib/src/tox.ini`.\n\nReady for review.",
    "created_at": "2021-01-23T04:43:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467871",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:94'></a>This seems to work well now - but the variants using pipenv fail in mysterious ways. I have marked these variants as "experimental" in the comments in `build/pkgs/sagelib/src/tox.ini`.

Ready for review.



---

archive/issue_comments_467872.json:
```json
{
    "body": "<a id='comment:95'></a>What errors / problems do you have with pipenv?",
    "created_at": "2021-01-23T10:29:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467872",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:95'></a>What errors / problems do you have with pipenv?



---

archive/issue_comments_467873.json:
```json
{
    "body": "<a id='comment:96'></a>Replying to [comment:95 gh-tobiasdiez]:\n> What errors / problems do you have with pipenv?\n\n\nMost recently - it did not accept the existing wheel of the latest version and is deciding to build another wheel of the same version:\n\n```\nLocal files found: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/lib/sage/wheels/fpylll-0.5.4-cp39-cp39-macosx_10_15_x86_64.whl\nChecked 2 links for project 'fpylll' against 2 hashes (1 matches, 1 no digest): discarding no candidates\nUsing version 0.5.4 (newest of versions: 0.5.4)\nCollecting fpylll==0.5.4\n  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-unpack-hnc4lgb4\n  Looking up \"https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz\" in the cache\n  Current age based on date: 1384\n  Ignoring unknown cache-control directive: immutable\n  Freshness lifetime from max-age: 365000000\n  The response is \"fresh\", returning cached response\n  365000000 > 1384\n  Using cached fpylll-0.5.4.tar.gz (115 kB)\n  Added fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) to build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'\n    Running setup.py (path:/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py) egg_info for package fpylll\n    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i\n    Running command python setup.py egg_info\n    running egg_info\n    creating /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info\n    writing /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/PKG-INFO\n    writing dependency_links to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/dependency_links.txt\n    writing top-level names to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/top_level.txt\n    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'\n    Package fplll was not found in the pkg-config search path.\n    Perhaps you should add the directory containing `fplll.pc'\n    to the PKG_CONFIG_PATH environment variable\n    No package 'fplll' found\n    reading manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'\n    reading manifest template 'MANIFEST.in'\n    no previously-included directories found matching 'build'\n    no previously-included directories found matching 'dist'\n    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'\n  Source in /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll has version 0.5.4, which satisfies requirement fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1))\n  Removed fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) from build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'\nBuilding wheels for collected packages: fpylll\n  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab\n  Building wheel for fpylll (setup.py): started\n  Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab\n  Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-pipenv-dist/bin/python -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '\"'\"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'\"'\"'; __file__='\"'\"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'\"'\"';f=getattr(tokenize, '\"'\"'open'\"'\"', open)(__file__);code=f.read().replace('\"'\"'\\r\\n'\"'\"', '\"'\"'\\n'\"'\"');f.close();exec(compile(code, __file__, '\"'\"'exec'\"'\"'))' bdist_wheel -d /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab\n  running bdist_wheel\n```\n\nOverall, despite cranking up verbosity, it's quite opaque",
    "created_at": "2021-01-23T18:52:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467873",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:96'></a>Replying to [comment:95 gh-tobiasdiez]:
> What errors / problems do you have with pipenv?


Most recently - it did not accept the existing wheel of the latest version and is deciding to build another wheel of the same version:

```
Local files found: /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/local/var/lib/sage/wheels/fpylll-0.5.4-cp39-cp39-macosx_10_15_x86_64.whl
Checked 2 links for project 'fpylll' against 2 hashes (1 matches, 1 no digest): discarding no candidates
Using version 0.5.4 (newest of versions: 0.5.4)
Collecting fpylll==0.5.4
  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-unpack-hnc4lgb4
  Looking up "https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz" in the cache
  Current age based on date: 1384
  Ignoring unknown cache-control directive: immutable
  Freshness lifetime from max-age: 365000000
  The response is "fresh", returning cached response
  365000000 > 1384
  Using cached fpylll-0.5.4.tar.gz (115 kB)
  Added fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) to build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'
    Running setup.py (path:/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py) egg_info for package fpylll
    Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i
    Running command python setup.py egg_info
    running egg_info
    creating /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info
    writing /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/PKG-INFO
    writing dependency_links to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/dependency_links.txt
    writing top-level names to /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/top_level.txt
    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
    Package fplll was not found in the pkg-config search path.
    Perhaps you should add the directory containing `fplll.pc'
    to the PKG_CONFIG_PATH environment variable
    No package 'fplll' found
    reading manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
    reading manifest template 'MANIFEST.in'
    no previously-included directories found matching 'build'
    no previously-included directories found matching 'dist'
    writing manifest file '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-pip-egg-info-nldn300i/fpylll.egg-info/SOURCES.txt'
  Source in /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll has version 0.5.4, which satisfies requirement fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1))
  Removed fpylll==0.5.4 from https://files.pythonhosted.org/packages/ad/c5/f30f354dcce03b928702414fdbdd916d60915c6b144360c88707784385bb/fpylll-0.5.4.tar.gz#sha256=0f8433b682bf030d9285eaf460cefdffccc4d04d60da46828ee523bc61d553f5 (from -r /var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pipenv-d79lavpe-requirements/pipenv-p7sezg0u-requirement.txt (line 1)) from build tracker '/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-req-tracker-6cth3jj8'
Building wheels for collected packages: fpylll
  Created temporary directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  Building wheel for fpylll (setup.py): started
  Destination directory: /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  Running command /Users/mkoeppe/s/sage/sage-rebasing/worktree-algebraic-2018-spring/build/pkgs/sagelib/src/.tox/python-sagewheels-pipenv-dist/bin/python -u -c 'import sys, setuptools, tokenize; sys.argv[0] = '"'"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'"'"'; __file__='"'"'/private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-install-lhezbhsm/fpylll/setup.py'"'"';f=getattr(tokenize, '"'"'open'"'"', open)(__file__);code=f.read().replace('"'"'\r\n'"'"', '"'"'\n'"'"');f.close();exec(compile(code, __file__, '"'"'exec'"'"'))' bdist_wheel -d /private/var/folders/38/wnh4gf1552g_crsjnv2vmmww0000gp/T/pip-wheel-eygv6kab
  running bdist_wheel
```

Overall, despite cranking up verbosity, it's quite opaque



---

archive/issue_comments_467874.json:
```json
{
    "body": "<a id='comment:97'></a>Mhh, with this I have no experience, as I've always took the wheel from pypi or had the build dependencies installed. \n\nMaybe it works if you set `prefer_binary = true`. In general, the selection seems to follow the following criteria:\nhttps://github.com/pypa/pipenv/blob/cda15b3b30e04e038ee286bced6c47a311f1e0ec/pipenv/patched/notpip/_internal/index/package_finder.py#L503-L517",
    "created_at": "2021-01-23T19:45:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467874",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:97'></a>Mhh, with this I have no experience, as I've always took the wheel from pypi or had the build dependencies installed. 

Maybe it works if you set `prefer_binary = true`. In general, the selection seems to follow the following criteria:
https://github.com/pypa/pipenv/blob/cda15b3b30e04e038ee286bced6c47a311f1e0ec/pipenv/patched/notpip/_internal/index/package_finder.py#L503-L517



---

archive/issue_comments_467875.json:
```json
{
    "body": "<a id='comment:98'></a>Thanks, that's something to explore in a follow up.\n\nFor this ticket I think I don't want to spend more time on `pipenv`. The other, more elementary, ways of installing things are working fine.",
    "created_at": "2021-01-23T19:55:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467875",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:98'></a>Thanks, that's something to explore in a follow up.

For this ticket I think I don't want to spend more time on `pipenv`. The other, more elementary, ways of installing things are working fine.



---

archive/issue_comments_467876.json:
```json
{
    "body": "<a id='comment:0'></a>One more point for discussion is if the pipfile should list the dependencies or if it is enough to only put them in the install_requires.\nNormally, the advice seems to be to put them only in install_requires, but that's mainly to capture missing dependencies and not bother to keep the files in sync. But since they are now automatically generated, I'm not sure how to precede. \n\nSome discussions on this point: https://github.com/psf/requests/blob/967a05bfffcb68f97296eda197b062221c2ebc0d/Pipfile#L25 and \"Problem: Hiding broken setup.py defined dependencies\" in https://github.com/pypa/pipenv/issues/1911. See also discussion in https://github.com/pypa/pipenv/issues/1263 and https://pipenv-fork.readthedocs.io/en/latest/advanced.html#pipfile-vs-setup-py",
    "created_at": "2021-02-04T22:23:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467876",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:0'></a>One more point for discussion is if the pipfile should list the dependencies or if it is enough to only put them in the install_requires.
Normally, the advice seems to be to put them only in install_requires, but that's mainly to capture missing dependencies and not bother to keep the files in sync. But since they are now automatically generated, I'm not sure how to precede. 

Some discussions on this point: https://github.com/psf/requests/blob/967a05bfffcb68f97296eda197b062221c2ebc0d/Pipfile#L25 and "Problem: Hiding broken setup.py defined dependencies" in https://github.com/pypa/pipenv/issues/1911. See also discussion in https://github.com/pypa/pipenv/issues/1263 and https://pipenv-fork.readthedocs.io/en/latest/advanced.html#pipfile-vs-setup-py



---

archive/issue_comments_467877.json:
```json
{
    "body": "<a id='comment:1'></a>Which of the two Pipfiles are you talking about?",
    "created_at": "2021-02-04T23:12:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467877",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Which of the two Pipfiles are you talking about?



---

archive/issue_comments_467878.json:
```json
{
    "body": "<a id='comment:2'></a>Mostly the one in the src folder, but I guess the question actually applies to both.",
    "created_at": "2021-02-05T13:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467878",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'></a>Mostly the one in the src folder, but I guess the question actually applies to both.



---

archive/issue_comments_467879.json:
```json
{
    "body": "<a id='comment:3'></a>As per previous discussion, `SAGE_ROOT/Pipfile.m4` (= `Pipfile-dist.m4`) locks all package versions to the one in the Sage distribution (see comment at top -- many packages are still missing in this file, this needs work). As `setup.cfg [install_requires]` only has version ranges, we cannot reduce this Pipfile.\n\nI agree with your comment regarding `src/Pipfile.m4`. Indeed the packages that are already specified in `setup.cfg [install_requires]` should not appear here - mainly for clarity (as you point out, by design we do not have the synchronization issues mentioned in the discussions). I will make this change.\n\nActually for several packages, whether they should appear in `setup.cfg [install_requires]` or not is a bit of a question. Later refinements can happen later, and will certainly as modularization comes along.",
    "created_at": "2021-02-05T19:04:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467879",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>As per previous discussion, `SAGE_ROOT/Pipfile.m4` (= `Pipfile-dist.m4`) locks all package versions to the one in the Sage distribution (see comment at top -- many packages are still missing in this file, this needs work). As `setup.cfg [install_requires]` only has version ranges, we cannot reduce this Pipfile.

I agree with your comment regarding `src/Pipfile.m4`. Indeed the packages that are already specified in `setup.cfg [install_requires]` should not appear here - mainly for clarity (as you point out, by design we do not have the synchronization issues mentioned in the discussions). I will make this change.

Actually for several packages, whether they should appear in `setup.cfg [install_requires]` or not is a bit of a question. Later refinements can happen later, and will certainly as modularization comes along.



---

archive/issue_comments_467880.json:
```json
{
    "body": "<a id='comment:5'></a>Sounds good to me!",
    "created_at": "2021-02-05T19:13:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467880",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:5'></a>Sounds good to me!



---

archive/issue_comments_467881.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T19:16:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467882.json:
```json
{
    "body": "<a id='comment:7'></a>Not much is left in `src/Pipfile.m4` now...\n\nAny thoughts on `python_version`?",
    "created_at": "2021-02-05T19:18:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467882",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Not much is left in `src/Pipfile.m4` now...

Any thoughts on `python_version`?



---

archive/issue_comments_467883.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T19:21:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467884.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T19:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467885.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T19:27:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467885",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467886.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-05T19:48:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467887.json:
```json
{
    "body": "<a id='comment:113'></a>Replying to [comment:107 mkoeppe]:\n> Any thoughts on `python_version`? \n\n\nFor now I have fixed it in `SAGE_ROOT/Pipfile`, added the supported range to `src/setup.cfg` and removed the setting from `src/Pipfile`",
    "created_at": "2021-02-05T19:49:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467887",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:113'></a>Replying to [comment:107 mkoeppe]:
> Any thoughts on `python_version`? 


For now I have fixed it in `SAGE_ROOT/Pipfile`, added the supported range to `src/setup.cfg` and removed the setting from `src/Pipfile`



---

archive/issue_comments_467888.json:
```json
{
    "body": "<a id='comment:4'></a>I agree, this seems to be the way to go.",
    "created_at": "2021-02-05T21:13:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467888",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:4'></a>I agree, this seems to be the way to go.



---

archive/issue_comments_467889.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-07T20:56:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467890.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,44 @@\n+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:\n+\n+```\n+    #\n+    # SUPPORTED ENVIRONMENTS:\n+    #\n+    # Build dependencies according to requirements.txt (all versions fixed).\n+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n+    #\n+    python-sagewheels-nopypi,\n+    #\n+    # Build and test without using the concrete dependencies specified by requirements.txt,\n+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:\n+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'\n+    #\n+    python-sagewheels-nopypi-norequirements,\n+    #\n+```\n+**Related or follow-up tickets:**\n+- #31377 `./configure --enable-editable`\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-02-12T17:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467890",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,44 @@
+After #30527, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:
+
+```
+    #
+    # SUPPORTED ENVIRONMENTS:
+    #
+    # Build dependencies according to requirements.txt (all versions fixed).
+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
+    #
+    python-sagewheels-nopypi,
+    #
+    # Build and test without using the concrete dependencies specified by requirements.txt,
+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:
+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'
+    #
+    python-sagewheels-nopypi-norequirements,
+    #
+```
+**Related or follow-up tickets:**
+- #31377 `./configure --enable-editable`
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467891.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,44 @@\n+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:\n+\n+```\n+    #\n+    # SUPPORTED ENVIRONMENTS:\n+    #\n+    # Build dependencies according to requirements.txt (all versions fixed).\n+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n+    #\n+    python-sagewheels-nopypi,\n+    #\n+    # Build and test without using the concrete dependencies specified by requirements.txt,\n+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:\n+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'\n+    #\n+    python-sagewheels-nopypi-norequirements,\n+    #\n+```\n+**Related or follow-up tickets:**\n+- #31377 `./configure --enable-editable`\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-02-12T17:26:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467891",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,44 @@
+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:
+
+```
+    #
+    # SUPPORTED ENVIRONMENTS:
+    #
+    # Build dependencies according to requirements.txt (all versions fixed).
+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
+    #
+    python-sagewheels-nopypi,
+    #
+    # Build and test without using the concrete dependencies specified by requirements.txt,
+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:
+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'
+    #
+    python-sagewheels-nopypi-norequirements,
+    #
+```
+**Related or follow-up tickets:**
+- #31377 `./configure --enable-editable`
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467892.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T19:04:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467892",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467893.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-02-12T20:51:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467893",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_467894.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T20:53:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467894",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467895.json:
```json
{
    "body": "<a id='comment:3'></a>Rebased/squashed on top of current beta + dependencies (removing dependency on #30527), and avoiding changes to `src/` that conflicted with #31377.",
    "created_at": "2021-02-12T20:55:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467895",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Rebased/squashed on top of current beta + dependencies (removing dependency on #30527), and avoiding changes to `src/` that conflicted with #31377.



---

archive/issue_comments_467896.json:
```json
{
    "body": "<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-12T21:55:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467896",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467897.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2021-03-07T21:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467897",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_467898.json:
```json
{
    "body": "<a id='comment:5'></a>Now that most dependencies are merged, this ticket should be easier to review...",
    "created_at": "2021-03-07T21:19:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467898",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Now that most dependencies are merged, this ticket should be easier to review...



---

archive/issue_comments_467899.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,46 @@\n+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. \n+\n+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:\n+\n+```\n+    #\n+    # SUPPORTED ENVIRONMENTS:\n+    #\n+    # Build dependencies according to requirements.txt (all versions fixed).\n+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n+    #\n+    python-sagewheels-nopypi,\n+    #\n+    # Build and test without using the concrete dependencies specified by requirements.txt,\n+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:\n+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'\n+    #\n+    python-sagewheels-nopypi-norequirements,\n+    #\n+```\n+**Related or follow-up tickets:**\n+- #31377 `./configure --enable-editable`\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-03-07T23:24:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467899",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,46 @@
+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. 
+
+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+To test - use `./bootstrap` and the follow the instructions in `build/pkgs/sagelib/src/tox.ini`:
+
+```
+    #
+    # SUPPORTED ENVIRONMENTS:
+    #
+    # Build dependencies according to requirements.txt (all versions fixed).
+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
+    #
+    python-sagewheels-nopypi,
+    #
+    # Build and test without using the concrete dependencies specified by requirements.txt,
+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:
+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'
+    #
+    python-sagewheels-nopypi-norequirements,
+    #
+```
+**Related or follow-up tickets:**
+- #31377 `./configure --enable-editable`
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467900.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-14T23:58:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467900",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467901.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-19T21:04:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467901",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467902.json:
```json
{
    "body": "<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-22T04:47:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467902",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:0'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467903.json:
```json
{
    "body": "<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-22T19:46:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467903",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:1'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467904.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-23T02:19:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467904",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467905.json:
```json
{
    "body": "<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T06:19:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467905",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:3'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467906.json:
```json
{
    "body": "<a id='comment:4'></a>on a clean repo I ran ./bootstrap and then\n\n```\n./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)\n...\nadding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/SOURCES.txt'\nadding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/top_level.txt'\nremoving 'sagemath-standard-9.3rc0' (and everything under it)\n\nGLOB finish: packaging after 3.96 seconds\ncopying new sdistfile to '/users/dimpase/.tox/distshare/sagemath-standard-9.3rc0.zip'\npackage .tmp/package/1/sagemath-standard-9.3rc0.zip links to dist/sagemath-standard-9.3rc0.zip (/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox)\npython-sagewheels-nopypi start: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi\npython-sagewheels-nopypi cannot reuse: no previous config /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/.tox-config1\npython-sagewheels-nopypi create: /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi\n  removing /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi\nsetting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin\n  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox$ /usr/bin/python3 -m virtualenv --python /usr/bin/python3 python-sagewheels-nopypi >/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/log/python-sagewheels-nopypi-0.log\npython-sagewheels-nopypi installdeps: -rrequirements.txt\nsetting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin\n  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src$ /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt \nIgnoring pycygwin: markers 'sys_platform == \"cygwin\"' don't match your environment\nLooking in links: file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels\nCollecting sage-conf==9.3.rc0 (from -r requirements.txt (line 12))\n  Url 'file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels' is ignored: it is neither a file nor a directory.\n  Could not find a version that satisfies the requirement sage-conf==9.3.rc0 (from -r requirements.txt (line 12)) (from versions: )\nNo matching distribution found for sage-conf==9.3.rc0 (from -r requirements.txt (line 12))\nERROR: could not install deps [-rrequirements.txt]; v = InvocationError(\"'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'\", 1)\npython-sagewheels-nopypi finish: getenv after 2.13 seconds\n_________________________________________________________________________________________________________ summary __________________________________________________________________________________________________________\nERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError(\"'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'\", 1)\ncleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip\n```",
    "created_at": "2021-03-24T11:22:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467906",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>on a clean repo I ran ./bootstrap and then

```
./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)
...
adding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/SOURCES.txt'
adding 'sagemath-standard-9.3rc0/sagemath_standard.egg-info/top_level.txt'
removing 'sagemath-standard-9.3rc0' (and everything under it)

GLOB finish: packaging after 3.96 seconds
copying new sdistfile to '/users/dimpase/.tox/distshare/sagemath-standard-9.3rc0.zip'
package .tmp/package/1/sagemath-standard-9.3rc0.zip links to dist/sagemath-standard-9.3rc0.zip (/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox)
python-sagewheels-nopypi start: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
python-sagewheels-nopypi cannot reuse: no previous config /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/.tox-config1
python-sagewheels-nopypi create: /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
  removing /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi
setting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox$ /usr/bin/python3 -m virtualenv --python /usr/bin/python3 python-sagewheels-nopypi >/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/log/python-sagewheels-nopypi-0.log
python-sagewheels-nopypi installdeps: -rrequirements.txt
setting PATH=/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin:/home/scratch2/dimpase/sage/sage/build/bin:/home/scratch2/dimpase/sage/sage/src/bin:/home/scratch2/dimpase/sage/sage/local/bin:/home/scratch2/dimpase/sage/sage/local/bin:/users/dimpase/perl5/bin:/users/dimpase/bin:/usr/libexec/python3-sphinx:/usr/lib64/qt-3.3/bin:/usr/share/Modules/bin:/usr/lib64/ccache:/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/users/dimpase/.cabal/bin:/auto/users/dimpase/bin
  /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src$ /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt 
Ignoring pycygwin: markers 'sys_platform == "cygwin"' don't match your environment
Looking in links: file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels
Collecting sage-conf==9.3.rc0 (from -r requirements.txt (line 12))
  Url 'file:///home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels' is ignored: it is neither a file nor a directory.
  Could not find a version that satisfies the requirement sage-conf==9.3.rc0 (from -r requirements.txt (line 12)) (from versions: )
No matching distribution found for sage-conf==9.3.rc0 (from -r requirements.txt (line 12))
ERROR: could not install deps [-rrequirements.txt]; v = InvocationError("'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'", 1)
python-sagewheels-nopypi finish: getenv after 2.13 seconds
_________________________________________________________________________________________________________ summary __________________________________________________________________________________________________________
ERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError("'/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt'", 1)
cleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip
```



---

archive/issue_comments_467907.json:
```json
{
    "body": "<a id='comment:5'></a>maybe I missed some prelim stages, I have no idea.",
    "created_at": "2021-03-24T11:24:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467907",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>maybe I missed some prelim stages, I have no idea.



---

archive/issue_comments_467908.json:
```json
{
    "body": "<a id='comment:6'></a>I have extended the instructions in the ticket description: You need to configure and build the Sage distribution before running the tox commands shown.",
    "created_at": "2021-03-24T15:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467908",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>I have extended the instructions in the ticket description: You need to configure and build the Sage distribution before running the tox commands shown.



---

archive/issue_comments_467909.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,46 @@\n+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  \n+\n+As of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. \n+\n+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.\n+\n+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)\n+\n+**To test - use `./bootstrap` and then configure and build the Sage distribution.**  Then follow the instructions in `build/pkgs/sagelib/src/tox.ini`:\n+\n+```\n+    #\n+    # SUPPORTED ENVIRONMENTS:\n+    #\n+    # Build dependencies according to requirements.txt (all versions fixed).\n+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n+    #\n+    python-sagewheels-nopypi,\n+    #\n+    # Build and test without using the concrete dependencies specified by requirements.txt,\n+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:\n+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).\n+    #\n+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'\n+    #\n+    python-sagewheels-nopypi-norequirements,\n+    #\n+```\n+**Related or follow-up tickets:**\n+- #31377 `./configure --enable-editable`\n+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment\n+- #28752 Make sagelib pip-installable in a conda environment\n+- #30371 In-place (editable) installs of sagelib in a venv\n+- #29041 `sage_bootstrap`: Add command \"sage -package list --output={install-requires,requirements,pipfile,debian,....}\"\n+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.\n+\n+References:\n+- https://snarky.ca/what-the-heck-is-pyproject-toml/\n+\n+\n+\n \n \n Dependencies: #30578, #30912\n```\n",
    "created_at": "2021-03-24T15:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467909",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,46 @@
+After #29500, it is possible to install Python packages built by the Sage distribution into user-defined venvs.  
+
+As of Sage 9.3.beta8, `sagelib` is published as a source distribution on PyPI (https://pypi.org/project/sagemath-standard), but the package does not have proper dependency information yet. 
+
+As part of `bootstrap`, we now generate (1) the `pyproject.toml` (PEP 517 metadata) and `install_requires` information, (2) `requirements.txt` and (3) `Pipfile` using m4 from the information added in #30719.  These files provide 3 distinct ways of setting up a user-defined venv.
+
+(Adding `pyproject.toml` does not change how the Sage distribution installs sagelib because `build/pkgs/sagelib/spkg-install` uses `setup.py install` directly.)
+
+**To test - use `./bootstrap` and then configure and build the Sage distribution.**  Then follow the instructions in `build/pkgs/sagelib/src/tox.ini`:
+
+```
+    #
+    # SUPPORTED ENVIRONMENTS:
+    #
+    # Build dependencies according to requirements.txt (all versions fixed).
+    # Use ONLY the wheels built and stored by the Sage distribution (no PyPI):
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
+    #
+    python-sagewheels-nopypi,
+    #
+    # Build and test without using the concrete dependencies specified by requirements.txt,
+    # using the dependencies declared in pyproject.toml and setup.cfg (install-requires) only:
+    # Still use ONLY the wheels built and stored by the Sage distribution (no PyPI).
+    #
+    #   ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi-norequirements)'
+    #
+    python-sagewheels-nopypi-norequirements,
+    #
+```
+**Related or follow-up tickets:**
+- #31377 `./configure --enable-editable`
+- #28746 Developer's Guide: Add instructions for sagelib development in a conda environment
+- #28752 Make sagelib pip-installable in a conda environment
+- #30371 In-place (editable) installs of sagelib in a venv
+- #29041 `sage_bootstrap`: Add command "sage -package list --output={install-requires,requirements,pipfile,debian,....}"
+- add documentation on how to set up the virtual environment, using either plain `python -m venv`, `virtualenv` (20.x), or `pipenv`.
+
+References:
+- https://snarky.ca/what-the-heck-is-pyproject-toml/
+
+
+
 
 
 Dependencies: #30578, #30912
```




---

archive/issue_comments_467910.json:
```json
{
    "body": "<a id='comment:7'></a>another issue is logging. I have no idea where logs of this all go, in particular I noticed an error due to no space left on device, even though it should all be fine (unless there is an excessive use of ~/.sage, or /tmp)\n\nbut worst of all I can't find a log with this info, it was printed in terminal...",
    "created_at": "2021-03-24T18:56:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467910",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>another issue is logging. I have no idea where logs of this all go, in particular I noticed an error due to no space left on device, even though it should all be fine (unless there is an excessive use of ~/.sage, or /tmp)

but worst of all I can't find a log with this info, it was printed in terminal...



---

archive/issue_comments_467911.json:
```json
{
    "body": "<a id='comment:8'></a>(wrong ticket)",
    "created_at": "2021-03-24T18:57:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467911",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>(wrong ticket)



---

archive/issue_comments_467912.json:
```json
{
    "body": "<a id='comment:9'></a>You will find the logs in `build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi`",
    "created_at": "2021-03-24T18:59:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467912",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>You will find the logs in `build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi`



---

archive/issue_comments_467913.json:
```json
{
    "body": "<a id='comment:0'></a>\n```\nProcessing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/nbformat-5.0.7-py3-none-any.whl\nProcessing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/widgetsnbextension-3.5.1-py2.py3-none-any.whl\nINFO: pip is looking at multiple versions of ipython to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of ipykernel to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of gmpy2 to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of fpylll to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of <Python from Requires-Python> to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of cython to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of cysignals to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of cypari2 to determine which version is compatible with other requirements. This could take a while.\nINFO: pip is looking at multiple versions of cvxopt to determine which version is compatible with other requirements. This could take a while.\nERROR: Could not find a version that satisfies the requirement jupyterlab-widgets>=1.0.0; python_version >= \"3.6\" (from ipywidgets)\nERROR: No matching distribution found for jupyterlab-widgets>=1.0.0; python_version >= \"3.6\"\nERROR: invocation failed (exit code 1)\nERROR: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)\npython-sagewheels-nopypi finish: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi after 1.87 seconds\n______________________________________________________________ summary ______________________________________________________________\nERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)\ncleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip\n```\n\nno idea about that `jupyterlab-widgets`, we don't even seem to have such a package in Sage.\n\nPS. `./sage --pip install jupyterlab-widgets` didn't fix it.",
    "created_at": "2021-03-24T19:32:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467913",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>
```
Processing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/nbformat-5.0.7-py3-none-any.whl
Processing /home/scratch2/dimpase/sage/sage/local/var/lib/sage/wheels/widgetsnbextension-3.5.1-py2.py3-none-any.whl
INFO: pip is looking at multiple versions of ipython to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of ipykernel to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of gmpy2 to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of fpylll to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of <Python from Requires-Python> to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cython to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cysignals to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cypari2 to determine which version is compatible with other requirements. This could take a while.
INFO: pip is looking at multiple versions of cvxopt to determine which version is compatible with other requirements. This could take a while.
ERROR: Could not find a version that satisfies the requirement jupyterlab-widgets>=1.0.0; python_version >= "3.6" (from ipywidgets)
ERROR: No matching distribution found for jupyterlab-widgets>=1.0.0; python_version >= "3.6"
ERROR: invocation failed (exit code 1)
ERROR: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)
python-sagewheels-nopypi finish: getenv /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi after 1.87 seconds
______________________________________________________________ summary ______________________________________________________________
ERROR:   python-sagewheels-nopypi: could not install deps [-rrequirements.txt]; v = InvocationError('/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/bin/python -m pip install -rrequirements.txt', 1)
cleanup /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip
```

no idea about that `jupyterlab-widgets`, we don't even seem to have such a package in Sage.

PS. `./sage --pip install jupyterlab-widgets` didn't fix it.



---

archive/issue_comments_467914.json:
```json
{
    "body": "<a id='comment:1'></a>We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem.",
    "created_at": "2021-03-24T19:39:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem.



---

archive/issue_comments_467915.json:
```json
{
    "body": "<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-24T20:01:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467915",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:2'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_467916.json:
```json
{
    "body": "<a id='comment:3'></a>Or try with this fix (which makes no change to how we install things in the Sage distribution, but removes excessive dependencies from the wheels)",
    "created_at": "2021-03-24T20:03:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467916",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Or try with this fix (which makes no change to how we install things in the Sage distribution, but removes excessive dependencies from the wheels)



---

archive/issue_comments_467917.json:
```json
{
    "body": "<a id='comment:4'></a>(Newer versions of `jupyterlab-widgets` have more disciplined dependencies via use of `jupyter_packaging`; after an upgrade in the Sage 9.4 series we will be able to make `jupyterlab-widgets` a standard package and drop the patch to `ipywidgets` again.)",
    "created_at": "2021-03-24T20:06:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467917",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>(Newer versions of `jupyterlab-widgets` have more disciplined dependencies via use of `jupyter_packaging`; after an upgrade in the Sage 9.4 series we will be able to make `jupyterlab-widgets` a standard package and drop the patch to `ipywidgets` again.)



---

archive/issue_comments_467918.json:
```json
{
    "body": "<a id='comment:5'></a>ohh, nodejs getting installed as a sage package?!",
    "created_at": "2021-03-24T20:42:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467918",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:5'></a>ohh, nodejs getting installed as a sage package?!



---

archive/issue_comments_467919.json:
```json
{
    "body": "<a id='comment:146'></a>Replying to [comment:141 mkoeppe]:\n> We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem. \n\n\nit did not. trying the latest commit now",
    "created_at": "2021-03-24T20:53:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467919",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:146'></a>Replying to [comment:141 mkoeppe]:
> We do have the SPKG`jupyterlab_widgets`. Running `make jupyterlab_widgets` will fix the problem. 


it did not. trying the latest commit now



---

archive/issue_comments_467920.json:
```json
{
    "body": "<a id='comment:7'></a>the patch let it go further, but now this puzzling \"no space left on device\"\n\n```\n  copying sage/sets/finite_enumerated_set.py -> build/lib.linux-x86_64-3.7/sage/sets\n  copying sage/sets/set.py -> build/lib.linux-x86_64-3.7/sage/sets\n  error: could not write to 'build/lib.linux-x86_64-3.7/sage/sets/set.py': No space left on device\n  Building wheel for sagemath-standard (PEP 517) ... error\n  ERROR: Failed building wheel for sagemath-standard\nFailed to build sagemath-standard\nERROR: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly\nException information:\nTraceback (most recent call last):\n  File \"/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/base_command.py\", line 189, in _main\n    status = self.run(options, args)\n  File \"/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/req_command.py\", line 178, in wrapper\n    return func(self, options, args)\n  File \"/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/commands/install.py\", line 361, in run\n    \", \".join(pep517_build_failure_names)\npip._internal.exceptions.InstallationError: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly\nRemoved build tracker: '/tmp/pip-req-tracker-rj13d2c8'\nERROR: invocation failed (exit code 1)\npython-sagewheels-nopypi finish: installpkg /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip after 308.24 seconds\n```\n\nI really don't get is, there is almost 300Gb left on /home/scratch2/\nMaybe it tries to copy stuff via some silly place like /tmp or /var or ~/.sage/, and the error comes from this? No idea.\n\n---\nNew commits:",
    "created_at": "2021-03-24T21:47:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467920",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:7'></a>the patch let it go further, but now this puzzling "no space left on device"

```
  copying sage/sets/finite_enumerated_set.py -> build/lib.linux-x86_64-3.7/sage/sets
  copying sage/sets/set.py -> build/lib.linux-x86_64-3.7/sage/sets
  error: could not write to 'build/lib.linux-x86_64-3.7/sage/sets/set.py': No space left on device
  Building wheel for sagemath-standard (PEP 517) ... error
  ERROR: Failed building wheel for sagemath-standard
Failed to build sagemath-standard
ERROR: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly
Exception information:
Traceback (most recent call last):
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/base_command.py", line 189, in _main
    status = self.run(options, args)
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/cli/req_command.py", line 178, in wrapper
    return func(self, options, args)
  File "/home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/python-sagewheels-nopypi/lib/python3.7/site-packages/pip/_internal/commands/install.py", line 361, in run
    ", ".join(pep517_build_failure_names)
pip._internal.exceptions.InstallationError: Could not build wheels for sagemath-standard which use PEP 517 and cannot be installed directly
Removed build tracker: '/tmp/pip-req-tracker-rj13d2c8'
ERROR: invocation failed (exit code 1)
python-sagewheels-nopypi finish: installpkg /home/scratch2/dimpase/sage/sage/build/pkgs/sagelib/src/.tox/.tmp/package/1/sagemath-standard-9.3rc0.zip after 308.24 seconds
```

I really don't get is, there is almost 300Gb left on /home/scratch2/
Maybe it tries to copy stuff via some silly place like /tmp or /var or ~/.sage/, and the error comes from this? No idea.

---
New commits:



---

archive/issue_comments_467921.json:
```json
{
    "body": "<a id='comment:8'></a>pip likes to use temporary directories, probably in /tmp or /var/tmp",
    "created_at": "2021-03-24T22:17:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467921",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>pip likes to use temporary directories, probably in /tmp or /var/tmp



---

archive/issue_comments_467922.json:
```json
{
    "body": "<a id='comment:9'></a>Try setting `TMPDIR` to something elese",
    "created_at": "2021-03-24T22:18:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467922",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Try setting `TMPDIR` to something elese



---

archive/issue_comments_467923.json:
```json
{
    "body": "<a id='comment:0'></a>is TMPDIR an env.var. I can export before running this job? Or is it something pythonic?",
    "created_at": "2021-03-24T22:32:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467923",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:0'></a>is TMPDIR an env.var. I can export before running this job? Or is it something pythonic?



---

archive/issue_comments_467924.json:
```json
{
    "body": "<a id='comment:1'></a>Just the standard environment variable",
    "created_at": "2021-03-24T22:45:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467924",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>Just the standard environment variable



---

archive/issue_comments_467925.json:
```json
{
    "body": "<a id='comment:2'></a>OK, this run finishes, with some doctest errors, mainly in sphinx/docs related:\n\n```\n$ ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'\n...\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/all.py  # 1 doctest failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/package.py  # 1 doctest failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/sagedoc.py  # 4 doctests failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/docs/conf.py  # 1 doctest failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/interfaces/gap.py  # 1 doctest failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_setup/find.py  # 1 doctest failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/__init__.py  # 35 doctests failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/sphinxbuild.py  # 13 doctests failed\nsage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/utils.py  # 5 doctests failed\n```\n\nif this is expected, feel free to make it positive review.",
    "created_at": "2021-03-25T10:07:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467925",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:2'></a>OK, this run finishes, with some doctest errors, mainly in sphinx/docs related:

```
$ ./sage -sh -c '(cd build/pkgs/sagelib/src && tox -v -v -v -e python-sagewheels-nopypi)'
...
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/all.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/package.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/misc/sagedoc.py  # 4 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/docs/conf.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage/interfaces/gap.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_setup/find.py  # 1 doctest failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/__init__.py  # 35 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/sphinxbuild.py  # 13 doctests failed
sage -t --random-seed=0 /home/scratch2/dimpase/sage/sage/src/sage_docbuild/utils.py  # 5 doctests failed
```

if this is expected, feel free to make it positive review.



---

archive/issue_comments_467926.json:
```json
{
    "body": "<a id='comment:3'></a>Thanks for testing! Yes, this looks as expected. The documentation is not built by this invocation. We should disable the corresponding doctests, for example using #30778 - but that's something for the 9.4 series.",
    "created_at": "2021-03-25T16:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467926",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>Thanks for testing! Yes, this looks as expected. The documentation is not built by this invocation. We should disable the corresponding doctests, for example using #30778 - but that's something for the 9.4 series.



---

archive/issue_comments_467927.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-03-25T16:11:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467927",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_467928.json:
```json
{
    "body": "<a id='comment:4'></a>Setting priority to blocker to bring this ticket to the attention of the release bot.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467928",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Setting priority to blocker to bring this ticket to the attention of the release bot.



---

archive/issue_comments_467929.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2021-03-29T23:54:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467929",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_467930.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2021-04-10T18:50:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467930",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from blocker to critical.



---

archive/issue_events_080707.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-18T16:17:51Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30913#event-80707"
}
```



---

archive/issue_events_080708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30913#event-80708"
}
```



---

archive/issue_comments_467931.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30913",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30913#issuecomment-467931",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
