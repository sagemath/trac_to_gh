# Issue 30320: set_default_frame() too restrictive on parallelizable manifolds

archive/issues_030083.json:
```json
{
    "body": "```\nsage: M = Manifold(3, 'M')\nsage: U = M.open_subset('U'); V = M.open_subset('V')\nsage: c_xyz.<x,y,z> = U.chart(); c_uvt.<u,v,t> = V.chart()\nsage: M.default_frame()\nCoordinate frame (U, (d/dx,d/dy,d/dz))\nsage: e = M.vector_frame('e'); e\nVector frame (M, (e_0,e_1,e_2))\nsage: M.default_frame()\nCoordinate frame (U, (d/dx,d/dy,d/dz))\nsage: M.set_default_frame(c_xyz.frame())\nTraceback (most recent call last):\n...\nValueError: the frame domain must coincide with the 3-dimensional differentiable manifold M\n```\n\nIn case of `M=SU(2)=S^3` this can happen: it cannot be covered by one chart but is parallelizable.\n\nHowever, due to the error message, the method `default_frame` is obviously intended to return the default frame which covers `M` if possible. This is not given in the above example.\n\nCC:  @egourgoulhon @tscrim\n\nBranch/Commit: 7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Michael Jung\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30320\n\n",
    "closed_at": "2020-09-15T21:58:30Z",
    "created_at": "2020-08-09T10:43:21Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "set_default_frame() too restrictive on parallelizable manifolds",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30320",
    "user": "https://github.com/mjungmath"
}
```
```
sage: M = Manifold(3, 'M')
sage: U = M.open_subset('U'); V = M.open_subset('V')
sage: c_xyz.<x,y,z> = U.chart(); c_uvt.<u,v,t> = V.chart()
sage: M.default_frame()
Coordinate frame (U, (d/dx,d/dy,d/dz))
sage: e = M.vector_frame('e'); e
Vector frame (M, (e_0,e_1,e_2))
sage: M.default_frame()
Coordinate frame (U, (d/dx,d/dy,d/dz))
sage: M.set_default_frame(c_xyz.frame())
Traceback (most recent call last):
...
ValueError: the frame domain must coincide with the 3-dimensional differentiable manifold M
```

In case of `M=SU(2)=S^3` this can happen: it cannot be covered by one chart but is parallelizable.

However, due to the error message, the method `default_frame` is obviously intended to return the default frame which covers `M` if possible. This is not given in the above example.

CC:  @egourgoulhon @tscrim

Branch/Commit: 7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02

Reviewer: Eric Gourgoulhon

Author: Michael Jung

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30320





---

archive/issue_comments_596939.json:
```json
{
    "body": "<a id='comment:1'></a>I see two options here:\n\n1. One allows also frames defined on subsets for `set_default_frame`, even in the parallelizable case.\n2. One overwrites the default frame for the first frame which covers `M` in case it haven't covered `M` before.",
    "created_at": "2020-08-09T11:48:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596939",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:1'></a>I see two options here:

1. One allows also frames defined on subsets for `set_default_frame`, even in the parallelizable case.
2. One overwrites the default frame for the first frame which covers `M` in case it haven't covered `M` before.



---

archive/issue_comments_596940.json:
```json
{
    "body": "<a id='comment:2'></a>I think, both options are reasonable. The first is, of course, more comprehensible to user.\n\nI don't see a third choice. If you have any ideas, I'd welcome them.",
    "created_at": "2020-08-09T11:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596940",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>I think, both options are reasonable. The first is, of course, more comprehensible to user.

I don't see a third choice. If you have any ideas, I'd welcome them.



---

archive/issue_comments_596941.json:
```json
{
    "body": "<a id='comment:3'></a>Thanks for handling this. In all the sage/manifolds settings, the \"default frame\" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. \n\nIn `DifferentiableManifold.set_default_frame()`, there is\n\n```\n        if frame._domain is not self:\n            if self.is_manifestly_parallelizable():\n                raise ValueError(\"the frame domain must coincide with \" +\n                                 \"the {}\".format(self))\n```\nwhich triggers the error reported in the ticket description. Maybe we can simply remove this...",
    "created_at": "2020-08-09T13:09:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596941",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:3'></a>Thanks for handling this. In all the sage/manifolds settings, the "default frame" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. 

In `DifferentiableManifold.set_default_frame()`, there is

```
        if frame._domain is not self:
            if self.is_manifestly_parallelizable():
                raise ValueError("the frame domain must coincide with " +
                                 "the {}".format(self))
```
which triggers the error reported in the ticket description. Maybe we can simply remove this...



---

archive/issue_comments_596942.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 egourgoulhon]:\n> Thanks for handling this. In all the sage/manifolds settings, the \"default frame\" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. \n> \n> In `DifferentiableManifold.set_default_frame()`, there is\n> \n> ```\n>         if frame._domain is not self:\n>             if self.is_manifestly_parallelizable():\n>                 raise ValueError(\"the frame domain must coincide with \" +\n>                                  \"the {}\".format(self))\n> ```\n> which triggers the error reported in the ticket description. Maybe we can simply remove this... \n\n\nThis is exactly what I meant by \"The first [option] is [...] more comprehensible to user.\". Thanks for pointing this out in such detail.\n\nVector bundles currently use option 1 as well, btw.\n\nThen, I will take care of removing the corresponding error messages and adapt the documentation if necessary. This is good, because #30178 can then be kept.",
    "created_at": "2020-08-09T13:16:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596942",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:4'></a>Replying to [comment:3 egourgoulhon]:
> Thanks for handling this. In all the sage/manifolds settings, the "default frame" is initially set as the first frame defined on the manifold, usually (but not necessarily) the coordinate frame corresponding to the first chart defined on the manifold. For consistency among all kinds of manifolds, I would be inclined to keep this behaviour even for parallelizable manifolds not covered by a a single chart, such as S<sup>3</sup>. So I would vote for option 1 of comment:1. Moreover, although it is also quite natural, option 2 would perform a silent change of the default frame, which may surprise the end user. 
> 
> In `DifferentiableManifold.set_default_frame()`, there is
> 
> ```
>         if frame._domain is not self:
>             if self.is_manifestly_parallelizable():
>                 raise ValueError("the frame domain must coincide with " +
>                                  "the {}".format(self))
> ```
> which triggers the error reported in the ticket description. Maybe we can simply remove this... 


This is exactly what I meant by "The first [option] is [...] more comprehensible to user.". Thanks for pointing this out in such detail.

Vector bundles currently use option 1 as well, btw.

Then, I will take care of removing the corresponding error messages and adapt the documentation if necessary. This is good, because #30178 can then be kept.



---

archive/issue_comments_596943.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mjungmath/parallelizable_manifold_not_covered_by_one_chart_and_default_frame\"",
    "created_at": "2020-08-09T13:23:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596943",
    "user": "https://github.com/mjungmath"
}
```

Changing branch from "" to "u/gh-mjungmath/parallelizable_manifold_not_covered_by_one_chart_and_default_frame"



---

archive/issue_comments_596944.json:
```json
{
    "body": "Changing commit from \"\" to \"7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02\"",
    "created_at": "2020-08-09T13:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596944",
    "user": "https://github.com/mjungmath"
}
```

Changing commit from "" to "7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02"



---

archive/issue_comments_596945.json:
```json
{
    "body": "<a id='comment:6'></a>New commits:",
    "created_at": "2020-08-09T13:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596945",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:6'></a>New commits:



---

archive/issue_comments_596946.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-09T13:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596946",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_596947.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Jung\"",
    "created_at": "2020-08-09T13:23:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596947",
    "user": "https://github.com/mjungmath"
}
```

Changing author from "" to "Michael Jung"



---

archive/issue_comments_596948.json:
```json
{
    "body": "<a id='comment:7'></a>Similarly for charts, btw, though more unlikely. I've removed that error message, too. Agreed?",
    "created_at": "2020-08-09T13:26:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596948",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>Similarly for charts, btw, though more unlikely. I've removed that error message, too. Agreed?



---

archive/issue_events_078535.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-05T19:21:58Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30320#event-78535"
}
```



---

archive/issue_comments_596949.json:
```json
{
    "body": "<a id='comment:9'></a>Is that good or some more work needed here?",
    "created_at": "2020-09-10T14:07:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596949",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:9'></a>Is that good or some more work needed here?



---

archive/issue_comments_596950.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-11T07:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596950",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_596951.json:
```json
{
    "body": "<a id='comment:10'></a>Replying to [comment:9 gh-mjungmath]:\n> Is that good or some more work needed here?\n\nYes it's good. Sorry for the delay.\n\nPS: I've added the ticket to #30235, where it was missing.",
    "created_at": "2020-09-11T07:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596951",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:10'></a>Replying to [comment:9 gh-mjungmath]:
> Is that good or some more work needed here?

Yes it's good. Sorry for the delay.

PS: I've added the ticket to #30235, where it was missing.



---

archive/issue_comments_596952.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Eric Gourgoulhon\"",
    "created_at": "2020-09-11T07:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596952",
    "user": "https://github.com/egourgoulhon"
}
```

Changing reviewer from "" to "Eric Gourgoulhon"



---

archive/issue_comments_596953.json:
```json
{
    "body": "<a id='comment:11'></a>Replying to [comment:10 egourgoulhon]:\n> \n> PS: I've added the ticket to #30235, where it was missing. \n\n\nBtw, don't hesitate to add relevant tickets there.",
    "created_at": "2020-09-11T08:02:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596953",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>Replying to [comment:10 egourgoulhon]:
> 
> PS: I've added the ticket to #30235, where it was missing. 


Btw, don't hesitate to add relevant tickets there.



---

archive/issue_comments_596954.json:
```json
{
    "body": "<a id='comment:12'></a>Replying to [comment:11 egourgoulhon]:\n> Replying to [comment:10 egourgoulhon]:\n> > \n> > PS: I've added the ticket to #30235, where it was missing. \n\n> \n> Btw, don't hesitate to add relevant tickets there.\n\n\nOkay, sure. :)\n\nBesides, you meant the metaticket #30525, right?",
    "created_at": "2020-09-11T08:50:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596954",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:12'></a>Replying to [comment:11 egourgoulhon]:
> Replying to [comment:10 egourgoulhon]:
> > 
> > PS: I've added the ticket to #30235, where it was missing. 

> 
> Btw, don't hesitate to add relevant tickets there.


Okay, sure. :)

Besides, you meant the metaticket #30525, right?



---

archive/issue_comments_596955.json:
```json
{
    "body": "<a id='comment:13'></a>Replying to [comment:12 gh-mjungmath]:\n> Besides, you meant the metaticket #30525, right?\n\nYes.",
    "created_at": "2020-09-11T08:56:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596955",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:13'></a>Replying to [comment:12 gh-mjungmath]:
> Besides, you meant the metaticket #30525, right?

Yes.



---

archive/issue_events_078536.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T21:58:30Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30320#event-78536"
}
```



---

archive/issue_comments_596956.json:
```json
{
    "body": "Changing branch from \"u/gh-mjungmath/parallelizable_manifold_not_covered_by_one_chart_and_default_frame\" to \"7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02\"",
    "created_at": "2020-09-15T21:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596956",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/gh-mjungmath/parallelizable_manifold_not_covered_by_one_chart_and_default_frame" to "7f50b3d5ff7786fc6a7874a8b28314a1fdfeca02"



---

archive/issue_comments_596957.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T21:58:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30320#issuecomment-596957",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078537.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T22:01:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30320#event-78537"
}
```



---

archive/issue_events_078538.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-15T22:01:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30320",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30320#event-78538"
}
```
