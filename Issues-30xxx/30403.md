# Issue 30403: Standard package zlib cannot be installed on some platforms, breaking Docker build

archive/issues_030166.json:
```json
{
    "body": "Since 9.2.beta4 the docker build is failing:\n\n```\n[zlib-1.2.11.p0] Setting up build directory for zlib-1.2.11.p0\n[zlib-1.2.11.p0] Finished extraction\n[zlib-1.2.11.p0] Applying patches from ../patches...\n[zlib-1.2.11.p0] Applying ../patches/cygwin-gzopen_w.patch\n[zlib-1.2.11.p0] patching file gzguts.h\n[zlib-1.2.11.p0] patching file win32/zlib.def\n[zlib-1.2.11.p0] Hunk #1 FAILED at 91 (different line endings).\n[zlib-1.2.11.p0] 1 out of 1 hunk FAILED -- saving rejects to file win32/zlib.def.rej\n[zlib-1.2.11.p0] Error applying '../patches/cygwin-gzopen_w.patch'\n```\n\nSee https://gitlab.com/sagemath/sage/-/pipelines for details. To see full logs, click on a build step; on the next page, browse the build artifacts on the right to see full output.\n\nCC:  @embray @tobiasdiez @dimpase @slel\n\nKeywords: gitlab, docker\n\nBranch/Commit: 77ab81fcdbf1398c56c72533fcd8a45d464eb058\n\nReviewer: Matthias Koeppe\n\nAuthor: Dima Pasechnik\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30403\n\n",
    "closed_at": "2020-09-15T21:58:23Z",
    "created_at": "2020-08-20T10:56:16Z",
    "labels": [
        "component: docker",
        "blocker",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Standard package zlib cannot be installed on some platforms, breaking Docker build",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30403",
    "user": "https://github.com/saraedum"
}
```
Since 9.2.beta4 the docker build is failing:

```
[zlib-1.2.11.p0] Setting up build directory for zlib-1.2.11.p0
[zlib-1.2.11.p0] Finished extraction
[zlib-1.2.11.p0] Applying patches from ../patches...
[zlib-1.2.11.p0] Applying ../patches/cygwin-gzopen_w.patch
[zlib-1.2.11.p0] patching file gzguts.h
[zlib-1.2.11.p0] patching file win32/zlib.def
[zlib-1.2.11.p0] Hunk #1 FAILED at 91 (different line endings).
[zlib-1.2.11.p0] 1 out of 1 hunk FAILED -- saving rejects to file win32/zlib.def.rej
[zlib-1.2.11.p0] Error applying '../patches/cygwin-gzopen_w.patch'
```

See https://gitlab.com/sagemath/sage/-/pipelines for details. To see full logs, click on a build step; on the next page, browse the build artifacts on the right to see full output.

CC:  @embray @tobiasdiez @dimpase @slel

Keywords: gitlab, docker

Branch/Commit: 77ab81fcdbf1398c56c72533fcd8a45d464eb058

Reviewer: Matthias Koeppe

Author: Dima Pasechnik

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30403





---

archive/issue_comments_600117.json:
```json
{
    "body": "Changing keywords from \"\" to \"gitlab, docker\".",
    "created_at": "2020-08-20T10:57:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600117",
    "user": "https://github.com/saraedum"
}
```

Changing keywords from "" to "gitlab, docker".



---

archive/issue_comments_600118.json:
```json
{
    "body": "<a id='comment:3'></a>\nThe patch has a mixture of LF and CRLF lineendings, to patch the file `win32/zlib.def.rej`, which has CRLF lineendings.\n\n`.gitattributes` was added in #29733 and may have caused something to break here.",
    "created_at": "2020-08-31T06:14:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600118",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
The patch has a mixture of LF and CRLF lineendings, to patch the file `win32/zlib.def.rej`, which has CRLF lineendings.

`.gitattributes` was added in #29733 and may have caused something to break here.



---

archive/issue_comments_600119.json:
```json
{
    "body": "Changing priority from blocker to critical.",
    "created_at": "2020-09-08T07:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600119",
    "user": "https://github.com/vbraun"
}
```

Changing priority from blocker to critical.



---

archive/issue_comments_600120.json:
```json
{
    "body": "<a id='comment:5'></a>\nSurely thats a problem with how the docker image is built?",
    "created_at": "2020-09-08T07:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600120",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:5'></a>
Surely thats a problem with how the docker image is built?



---

archive/issue_comments_600121.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think it means that you cannot build from a fresh git clone if you do not have zlib installed.",
    "created_at": "2020-09-08T11:46:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600121",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:6'></a>
I think it means that you cannot build from a fresh git clone if you do not have zlib installed.



---

archive/issue_comments_600122.json:
```json
{
    "body": "<a id='comment:7'></a>\nvbraun: What's the meaning of \"blocker\"? Us not being able to ship for one of the platforms sounds like a blocker to me.",
    "created_at": "2020-09-08T11:47:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600122",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:7'></a>
vbraun: What's the meaning of "blocker"? Us not being able to ship for one of the platforms sounds like a blocker to me.



---

archive/issue_comments_600123.json:
```json
{
    "body": "Changing priority from critical to blocker.",
    "created_at": "2020-09-08T17:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600123",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from critical to blocker.



---

archive/issue_comments_600124.json:
```json
{
    "body": "<a id='comment:8'></a>\nI think it's a blocker because a standard package is broken on a supported platform",
    "created_at": "2020-09-08T17:46:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600124",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
I think it's a blocker because a standard package is broken on a supported platform



---

archive/issue_comments_600125.json:
```json
{
    "body": "<a id='comment:10'></a>\nwhy is that a problem to fix this? I'll post a branch with uniform endings",
    "created_at": "2020-09-08T21:13:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600125",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:10'></a>
why is that a problem to fix this? I'll post a branch with uniform endings



---

archive/issue_comments_600126.json:
```json
{
    "body": "<a id='comment:11'></a>\nit's actually \"fun\". The patch touches 2 files, one is OK, the other is with Windows (CRLF) line endings, and git version 2.20.1 on Linux produces a diff with mixed line endings!!!\n\n```\n$ git diff win32/zlib.def >/tmp/p2\ndimpase@penguin:~/sage/upstream/zlib-1.2.11$ file /tmp/p2\n/tmp/p2: unified diff output, ASCII text, with CRLF, LF line terminators\n```\na bug in git? or maybe there is an option to use here...",
    "created_at": "2020-09-08T21:26:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600126",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
it's actually "fun". The patch touches 2 files, one is OK, the other is with Windows (CRLF) line endings, and git version 2.20.1 on Linux produces a diff with mixed line endings!!!

```
$ git diff win32/zlib.def >/tmp/p2
dimpase@penguin:~/sage/upstream/zlib-1.2.11$ file /tmp/p2
/tmp/p2: unified diff output, ASCII text, with CRLF, LF line terminators
```
a bug in git? or maybe there is an option to use here...



---

archive/issue_comments_600127.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think something like `-text` to .gitattributes for this file could help",
    "created_at": "2020-09-08T21:40:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600127",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
I think something like `-text` to .gitattributes for this file could help



---

archive/issue_comments_600128.json:
```json
{
    "body": "<a id='comment:13'></a>\nthe problem is that applying a patch is a problem, nothing to do with git.\n(unless I add `--binary` option)\n\n```\n$ cat /tmp/pp\ndiff --git a/win32/zlib.def b/win32/zlib.def\nindex 784b138..b69fa3e 100644\n--- a/win32/zlib.def\n+++ b/win32/zlib.def\n@@ -91,4 +91,3 @@ EXPORTS\n     inflateCodesUsed\n     inflateResetKeep\n     deflateResetKeep\n-    gzopen_w\n$ file /tmp/pp\n/tmp/pp: unified diff output, ASCII text, with CRLF line terminators\n$ patch --dry-run -p1 --posix </tmp/pp\n(Stripping trailing CRs from patch; use --binary to disable.)\nchecking file win32/zlib.def\nHunk #1 FAILED at 91 (different line endings).\n1 out of 1 hunk FAILED\n$ patch --dry-run -p1 --posix --binary </tmp/pp # this works\nchecking file win32/zlib.def\n$ dos2unix /tmp/pp\ndos2unix: converting file /tmp/pp to Unix format...\ndimpase@penguin:~/sage/upstream/zlib-1.2.11$ patch --dry-run -p1 --posix  </tmp/pp\nchecking file win32/zlib.def\nHunk #1 FAILED at 91 (different line endings).\n1 out of 1 hunk FAILED\n```",
    "created_at": "2020-09-08T22:07:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600128",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:13'></a>
the problem is that applying a patch is a problem, nothing to do with git.
(unless I add `--binary` option)

```
$ cat /tmp/pp
diff --git a/win32/zlib.def b/win32/zlib.def
index 784b138..b69fa3e 100644
--- a/win32/zlib.def
+++ b/win32/zlib.def
@@ -91,4 +91,3 @@ EXPORTS
     inflateCodesUsed
     inflateResetKeep
     deflateResetKeep
-    gzopen_w
$ file /tmp/pp
/tmp/pp: unified diff output, ASCII text, with CRLF line terminators
$ patch --dry-run -p1 --posix </tmp/pp
(Stripping trailing CRs from patch; use --binary to disable.)
checking file win32/zlib.def
Hunk #1 FAILED at 91 (different line endings).
1 out of 1 hunk FAILED
$ patch --dry-run -p1 --posix --binary </tmp/pp # this works
checking file win32/zlib.def
$ dos2unix /tmp/pp
dos2unix: converting file /tmp/pp to Unix format...
dimpase@penguin:~/sage/upstream/zlib-1.2.11$ patch --dry-run -p1 --posix  </tmp/pp
checking file win32/zlib.def
Hunk #1 FAILED at 91 (different line endings).
1 out of 1 hunk FAILED
```



---

archive/issue_comments_600129.json:
```json
{
    "body": "Changing commit from \"\" to \"bfac27ca0ca2d00704dd190f7f720828765ee70a\"",
    "created_at": "2020-09-08T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600129",
    "user": "https://github.com/dimpase"
}
```

Changing commit from "" to "bfac27ca0ca2d00704dd190f7f720828765ee70a"



---

archive/issue_comments_600130.json:
```json
{
    "body": "Changing branch from \"\" to \"public/packages/zlibpatchfix\"",
    "created_at": "2020-09-08T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600130",
    "user": "https://github.com/dimpase"
}
```

Changing branch from "" to "public/packages/zlibpatchfix"



---

archive/issue_comments_600131.json:
```json
{
    "body": "Changing author from \"\" to \"Dima Pasechnik\"",
    "created_at": "2020-09-08T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600131",
    "user": "https://github.com/dimpase"
}
```

Changing author from "" to "Dima Pasechnik"



---

archive/issue_comments_600132.json:
```json
{
    "body": "<a id='comment:14'></a>\nNew commits:\n|                                                                                                                                          |                                |\n|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[bfac27c](https://git.sagemath.org/sage.git/commit?id=bfac27ca0ca2d00704dd190f7f720828765ee70a)|`apply windows patch separately`|",
    "created_at": "2020-09-08T22:22:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600132",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:14'></a>
New commits:
|                                                                                                                                          |                                |
|------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[bfac27c](https://git.sagemath.org/sage.git/commit?id=bfac27ca0ca2d00704dd190f7f720828765ee70a)|`apply windows patch separately`|



---

archive/issue_comments_600133.json:
```json
{
    "body": "<a id='comment:15'></a>\nThis didn't work as needed, as `cygwin-windef.diff` got different line endings as I was checking it into the git repo... Arrgh...",
    "created_at": "2020-09-08T22:26:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600133",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:15'></a>
This didn't work as needed, as `cygwin-windef.diff` got different line endings as I was checking it into the git repo... Arrgh...



---

archive/issue_comments_600134.json:
```json
{
    "body": "Changing commit from \"bfac27ca0ca2d00704dd190f7f720828765ee70a\" to \"4eb6c8f364f24645c3365ec20e22fd3b50aff0a8\"",
    "created_at": "2020-09-08T22:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600134",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "bfac27ca0ca2d00704dd190f7f720828765ee70a" to "4eb6c8f364f24645c3365ec20e22fd3b50aff0a8"



---

archive/issue_comments_600135.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|\n|[4eb6c8f](https://git.sagemath.org/sage.git/commit/?id=4eb6c8f364f24645c3365ec20e22fd3b50aff0a8)|`endings hopefully OK now`|",
    "created_at": "2020-09-08T22:50:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600135",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------|
|[4eb6c8f](https://git.sagemath.org/sage.git/commit/?id=4eb6c8f364f24645c3365ec20e22fd3b50aff0a8)|`endings hopefully OK now`|



---

archive/issue_comments_600136.json:
```json
{
    "body": "<a id='comment:17'></a>\nhmm, no, while locally the endings are OK, pulling from the repo mixes them up :-(",
    "created_at": "2020-09-08T22:52:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600136",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:17'></a>
hmm, no, while locally the endings are OK, pulling from the repo mixes them up :-(



---

archive/issue_comments_600137.json:
```json
{
    "body": "<a id='comment:18'></a>\nI will try to declare that diff file as binary in .gitattributes",
    "created_at": "2020-09-08T23:23:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600137",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:18'></a>
I will try to declare that diff file as binary in .gitattributes



---

archive/issue_comments_600138.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|\n|[6373ca4](https://git.sagemath.org/sage.git/commit/?id=6373ca46e0d8565407777d202314a9b31dc9cd5c)|`setting patch type *.diff_bin to binary`|",
    "created_at": "2020-09-09T06:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600138",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------|
|[6373ca4](https://git.sagemath.org/sage.git/commit/?id=6373ca46e0d8565407777d202314a9b31dc9cd5c)|`setting patch type *.diff_bin to binary`|



---

archive/issue_comments_600139.json:
```json
{
    "body": "Changing commit from \"4eb6c8f364f24645c3365ec20e22fd3b50aff0a8\" to \"6373ca46e0d8565407777d202314a9b31dc9cd5c\"",
    "created_at": "2020-09-09T06:24:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600139",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4eb6c8f364f24645c3365ec20e22fd3b50aff0a8" to "6373ca46e0d8565407777d202314a9b31dc9cd5c"



---

archive/issue_comments_600140.json:
```json
{
    "body": "Changing commit from \"6373ca46e0d8565407777d202314a9b31dc9cd5c\" to \"77ab81fcdbf1398c56c72533fcd8a45d464eb058\"",
    "created_at": "2020-09-09T06:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600140",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "6373ca46e0d8565407777d202314a9b31dc9cd5c" to "77ab81fcdbf1398c56c72533fcd8a45d464eb058"



---

archive/issue_comments_600141.json:
```json
{
    "body": "<a id='comment:20'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n|                                                                                                                                           |                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|\n|[77ab81f](https://git.sagemath.org/sage.git/commit/?id=77ab81fcdbf1398c56c72533fcd8a45d464eb058)|`apply windows patch separately`|",
    "created_at": "2020-09-09T06:39:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600141",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:20'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
|                                                                                                                                           |                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------|
|[77ab81f](https://git.sagemath.org/sage.git/commit/?id=77ab81fcdbf1398c56c72533fcd8a45d464eb058)|`apply windows patch separately`|



---

archive/issue_comments_600142.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-09T06:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600142",
    "user": "https://github.com/dimpase"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_600143.json:
```json
{
    "body": "<a id='comment:21'></a>\nOK, try this please (only tested on Linux)",
    "created_at": "2020-09-09T06:40:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600143",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:21'></a>
OK, try this please (only tested on Linux)



---

archive/issue_comments_600144.json:
```json
{
    "body": "<a id='comment:22'></a>\nWhen applying patches with `--ignore-whitespace` this should work automatically, but only if the diff has LF endings (patch is biased towards unix endings)",
    "created_at": "2020-09-09T07:22:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600144",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:22'></a>
When applying patches with `--ignore-whitespace` this should work automatically, but only if the diff has LF endings (patch is biased towards unix endings)



---

archive/issue_comments_600145.json:
```json
{
    "body": "<a id='comment:23'></a>\nif this is so them I suppose we can just add this option to the patch call in\n`build/bin/sage-apply-patches` and done with?",
    "created_at": "2020-09-09T21:40:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600145",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:23'></a>
if this is so them I suppose we can just add this option to the patch call in
`build/bin/sage-apply-patches` and done with?



---

archive/issue_comments_600146.json:
```json
{
    "body": "<a id='comment:24'></a>\nReplying to [vbraun](#comment%3A22):\n> When applying patches with `--ignore-whitespace` this should work automatically, but only if the diff has LF endings (patch is biased towards unix endings)\n\n\nno, it does not work - on Debian 10 with its patch I get `different line endings` error.\nSo the current solution is more or less the only way.\n\nI suppose we might not want to apply all our patches with `--binary`. \n\nBut we can also modify `build/bin/sage-apply-patches` to deal with binary patches (say, files with a particular suffix) by treating them as patches that must be applied with `--binary`.",
    "created_at": "2020-09-09T22:34:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600146",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:24'></a>
Replying to [vbraun](#comment%3A22):
> When applying patches with `--ignore-whitespace` this should work automatically, but only if the diff has LF endings (patch is biased towards unix endings)


no, it does not work - on Debian 10 with its patch I get `different line endings` error.
So the current solution is more or less the only way.

I suppose we might not want to apply all our patches with `--binary`. 

But we can also modify `build/bin/sage-apply-patches` to deal with binary patches (say, files with a particular suffix) by treating them as patches that must be applied with `--binary`.



---

archive/issue_comments_600147.json:
```json
{
    "body": "<a id='comment:25'></a>\nDid you convert the patch to LF endings only? because right now its mixed, and `--ignore-whitespace` only works with pure LF endings:\n\n```\n$ file build/pkgs/zlib/patches/cygwin-gzopen_w.patch\nbuild/pkgs/zlib/patches/cygwin-gzopen_w.patch: unified diff output, ASCII text, with CRLF, LF line terminators\n```",
    "created_at": "2020-09-09T23:01:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600147",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:25'></a>
Did you convert the patch to LF endings only? because right now its mixed, and `--ignore-whitespace` only works with pure LF endings:

```
$ file build/pkgs/zlib/patches/cygwin-gzopen_w.patch
build/pkgs/zlib/patches/cygwin-gzopen_w.patch: unified diff output, ASCII text, with CRLF, LF line terminators
```



---

archive/issue_comments_600148.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [vbraun](#comment%3A25):\n> Did you convert the patch to LF endings only? because right now its mixed, and `--ignore-whitespace` only works with pure LF endings:\n\n\ncertainly, I tried it on the converted to the LF-endings patch `build/pkgs/zlib/patches/cygwin-windef.diff_bin` in the branch.\n\nIt's seriosly platform-dependent. As you might know, e.g. on macOS the original patch just works.\nI won't be surprised if it works on some Linuxes, too.",
    "created_at": "2020-09-10T08:15:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600148",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:26'></a>
Replying to [vbraun](#comment%3A25):
> Did you convert the patch to LF endings only? because right now its mixed, and `--ignore-whitespace` only works with pure LF endings:


certainly, I tried it on the converted to the LF-endings patch `build/pkgs/zlib/patches/cygwin-windef.diff_bin` in the branch.

It's seriosly platform-dependent. As you might know, e.g. on macOS the original patch just works.
I won't be surprised if it works on some Linuxes, too.



---

archive/issue_comments_600149.json:
```json
{
    "body": "<a id='comment:27'></a>\nPerhaps you are confused by `--ignore-whitespace` option of `git apply`, which indeed allows to ignore different EOLs. This is not the case with `patch`.",
    "created_at": "2020-09-10T08:46:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600149",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:27'></a>
Perhaps you are confused by `--ignore-whitespace` option of `git apply`, which indeed allows to ignore different EOLs. This is not the case with `patch`.



---

archive/issue_comments_600150.json:
```json
{
    "body": "<a id='comment:28'></a>\nI guess someone should push this to gitlab or something to trigger the Docker build?",
    "created_at": "2020-09-10T16:55:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600150",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
I guess someone should push this to gitlab or something to trigger the Docker build?



---

archive/issue_comments_600151.json:
```json
{
    "body": "<a id='comment:30'></a>\nSince our runner has been down for ten days nothing gets built on [GitLab](GitLab) anymore currently: https://zulip.sagemath.org/#narrow/stream/117-docker/topic/GitLab.20runners.20are.20gone\n\nOtherwise, it would  have been that one already https://gitlab.com/sagemath/dev/trac/-/jobs/728299492",
    "created_at": "2020-09-12T10:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600151",
    "user": "https://github.com/saraedum"
}
```

<a id='comment:30'></a>
Since our runner has been down for ten days nothing gets built on [GitLab](GitLab) anymore currently: https://zulip.sagemath.org/#narrow/stream/117-docker/topic/GitLab.20runners.20are.20gone

Otherwise, it would  have been that one already https://gitlab.com/sagemath/dev/trac/-/jobs/728299492



---

archive/issue_comments_600152.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Matthias Koeppe\"",
    "created_at": "2020-09-12T16:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600152",
    "user": "https://github.com/mkoeppe"
}
```

Changing reviewer from "" to "Matthias Koeppe"



---

archive/issue_comments_600153.json:
```json
{
    "body": "<a id='comment:31'></a>\nTested at https://github.com/mkoeppe/sage/actions/runs/250810929 that this change does not break any of our platforms",
    "created_at": "2020-09-12T16:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600153",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Tested at https://github.com/mkoeppe/sage/actions/runs/250810929 that this change does not break any of our platforms



---

archive/issue_comments_600154.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-09-12T16:48:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600154",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_600155.json:
```json
{
    "body": "Changing branch from \"public/packages/zlibpatchfix\" to \"77ab81fcdbf1398c56c72533fcd8a45d464eb058\"",
    "created_at": "2020-09-15T21:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600155",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "public/packages/zlibpatchfix" to "77ab81fcdbf1398c56c72533fcd8a45d464eb058"



---

archive/issue_comments_600156.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-09-15T21:58:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30403#issuecomment-600156",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_078842.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-15T21:58:23Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30403",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30403#event-78842"
}
```
