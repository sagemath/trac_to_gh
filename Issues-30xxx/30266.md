# Issue 30266: Immutability for scalar fields

archive/issues_030029.json:
```json
{
    "assignees": [],
    "body": "This ticket adds the immutability and hashability for scalar fields.\n\nSee #30261.\n\nDepends on #30181\n\nCC:  @egourgoulhon @tscrim @mkoeppe\n\nKeywords: **immutability**\n\nBranch/Commit: **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**\n\nReviewer: **Matthias Koeppe**\n\nAuthor: **Michael Jung**\n\nComponent: **manifolds**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30266_\n\n",
    "closed_at": "2020-08-09T08:47:24Z",
    "created_at": "2020-08-01T12:56:35Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
        "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Immutability for scalar fields",
    "type": "issue",
    "updated_at": "2020-08-09T08:47:24Z",
    "url": "https://github.com/sagemath/sage/issues/30266",
    "user": "https://github.com/mjungmath"
}
```
This ticket adds the immutability and hashability for scalar fields.

See #30261.

Depends on #30181

CC:  @egourgoulhon @tscrim @mkoeppe

Keywords: **immutability**

Branch/Commit: **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**

Reviewer: **Matthias Koeppe**

Author: **Michael Jung**

Component: **manifolds**

_Issue created by migration from https://trac.sagemath.org/ticket/30266_





---

archive/issue_events_413831.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:56:35Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413831"
}
```



---

archive/issue_events_413832.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:56:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413832"
}
```



---

archive/issue_comments_480000.json:
```json
{
    "body": "Branch: **[u/gh-mjungmath/immutability_for_scalar_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_for_scalar_fields)**",
    "created_at": "2020-08-01T12:57:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480000",
    "user": "https://github.com/mjungmath"
}
```

Branch: **[u/gh-mjungmath/immutability_for_scalar_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_for_scalar_fields)**



---

archive/issue_comments_480001.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n+This ticket adds the immutability and hashability for scalar fields.\n \n+See #30261.\n``````\n",
    "created_at": "2020-08-01T12:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480001",
    "user": "https://github.com/mjungmath"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
+This ticket adds the immutability and hashability for scalar fields.
 
+See #30261.
``````




---

archive/issue_comments_480002.json:
```json
{
    "body": "Changed keywords from none to **immutability**",
    "created_at": "2020-08-01T12:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480002",
    "user": "https://github.com/mjungmath"
}
```

Changed keywords from none to **immutability**



---

archive/issue_events_413833.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:59:41Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "title_is": "Immutability for scalar fields",
    "title_was": "immutability for scalar fields",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413833"
}
```



---

archive/issue_events_413834.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20manifolds",
    "label_color": "0000ff",
    "label_name": "c: manifolds",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413834"
}
```



---

archive/issue_comments_480003.json:
```json
{
    "body": "Author: **Michael Jung**",
    "created_at": "2020-08-01T12:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480003",
    "user": "https://github.com/mjungmath"
}
```

Author: **Michael Jung**



---

archive/issue_events_413835.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413835"
}
```



---

archive/issue_comments_480004.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b\"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca\"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87\"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2\"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab\"><code>aebaded</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr></table>\n",
    "created_at": "2020-08-01T12:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480004",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/286d3c604d0fe9aa2f78b5c09773c4af3bb3369b"><code>286d3c6</code></a></td><td><code>FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9df3d22ca84da6b604226d5b88d2a581b0cc53ca"><code>9df3d22</code></a></td><td><code>sage.tensor.modules: Make all zero() and one() elements immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4373ea269d9d426163fa3d1e72bdf6e20c412f87"><code>4373ea2</code></a></td><td><code>FreeModuleTensor: Replace special casing of the immutable zero by is_immutable</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a2ee8beb504477a3215e002391e44a51b2957ca2"><code>a2ee8be</code></a></td><td><code>ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab"><code>aebaded</code></a></td><td><code>Trac #30266: make scalarfields immutable</code></td></tr></table>




---

archive/issue_events_413836.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-08-01T12:59:41Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413836"
}
```



---

archive/issue_comments_480005.json:
```json
{
    "body": "Commit: **[`aebaded`](https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab)**",
    "created_at": "2020-08-01T12:59:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480005",
    "user": "https://github.com/mjungmath"
}
```

Commit: **[`aebaded`](https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab)**



---

archive/issue_comments_480006.json:
```json
{
    "body": "Dependencies: **#30181**",
    "created_at": "2020-08-01T13:00:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480006",
    "user": "https://github.com/mjungmath"
}
```

Dependencies: **#30181**



---

archive/issue_comments_480007.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nIs the hash input okay? Or should it be something more unique?",
    "created_at": "2020-08-01T13:03:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480007",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:4" align="right">comment:4</div>

Is the hash input okay? Or should it be something more unique?



---

archive/issue_comments_480008.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nGiven that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.\n\nMore importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.",
    "created_at": "2020-08-01T13:21:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480008",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Given that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.

More importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.



---

archive/issue_comments_480009.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mkoeppe](#comment%3A5):\n> Given that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.\n> \n> More importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.\n> \n\nI just copied the ideas from the elsewhere in the Sage code. This means that most `hash` functions are implemented wrong.\n\nAre you sure it is not `f is g` implies `hash(f) == hash(g)`? `f == g` implies `hash(f) == hash(g)` is barely possible in cases where coercions apply, isn't it?",
    "created_at": "2020-08-01T13:27:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480009",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mkoeppe](#comment%3A5):
> Given that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.
> 
> More importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.
> 

I just copied the ideas from the elsewhere in the Sage code. This means that most `hash` functions are implemented wrong.

Are you sure it is not `f is g` implies `hash(f) == hash(g)`? `f == g` implies `hash(f) == hash(g)` is barely possible in cases where coercions apply, isn't it?



---

archive/issue_comments_480010.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@mjungmath](#comment%3A6):\n> Are you sure it is not `f is g` implies `hash(f) == hash(g)`? \n\nThis implication is trivially true.",
    "created_at": "2020-08-01T13:31:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480010",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@mjungmath](#comment%3A6):
> Are you sure it is not `f is g` implies `hash(f) == hash(g)`? 

This implication is trivially true.



---

archive/issue_comments_480011.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@mkoeppe](#comment%3A7):\n> Replying to [@mjungmath](#comment%3A6):\n> > Are you sure it is not `f is g` implies `hash(f) == hash(g)`? \n\n> \n> This implication is trivially true.\n\nOh, yes, this is obviously right. >.< :D",
    "created_at": "2020-08-01T13:38:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480011",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@mkoeppe](#comment%3A7):
> Replying to [@mjungmath](#comment%3A6):
> > Are you sure it is not `f is g` implies `hash(f) == hash(g)`? 

> 
> This implication is trivially true.

Oh, yes, this is obviously right. >.< :D



---

archive/issue_comments_480012.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@mjungmath](#comment%3A6):\n> Replying to [@mkoeppe](#comment%3A5):\n> > Given that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.\n> > \n> > More importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.\n> > \n\n> \n> I just copied the ideas from the elsewhere in the Sage code. This means that most `hash` functions are implemented wrong.\n\nAh yes, I see, apparently that were cases where the string representation cannot be changed. Due to the fact that we allow restrictions as coercion, `hash(self._manifold)` seem to be the only choice.\n\nI will add a related doctest for this particular case.\n\nThank you.",
    "created_at": "2020-08-01T13:44:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480012",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@mjungmath](#comment%3A6):
> Replying to [@mkoeppe](#comment%3A5):
> > Given that `ScalarField_repr_` does not print any contents, this hash does not seem to be useful to distinguish non-equal elements. This will degrade the performance of sets to that of lists.
> > 
> > More importantly, it must be ensured that `f == g` implies `hash(f) == hash(g)`. Because equality does not take names into account but `repr` does, this is currently not satisfied.
> > 

> 
> I just copied the ideas from the elsewhere in the Sage code. This means that most `hash` functions are implemented wrong.

Ah yes, I see, apparently that were cases where the string representation cannot be changed. Due to the fact that we allow restrictions as coercion, `hash(self._manifold)` seem to be the only choice.

I will add a related doctest for this particular case.

Thank you.



---

archive/issue_comments_480013.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b\"><code>5c7fd6e</code></a></td><td><code>Trac #30266: immutability of restrictions + hash function improved</code></td></tr></table>\n",
    "created_at": "2020-08-01T14:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480013",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b"><code>5c7fd6e</code></a></td><td><code>Trac #30266: immutability of restrictions + hash function improved</code></td></tr></table>




---

archive/issue_comments_480014.json:
```json
{
    "body": "Changed commit from **[`aebaded`](https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab)** to **[`5c7fd6e`](https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b)**",
    "created_at": "2020-08-01T14:15:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480014",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`aebaded`](https://github.com/sagemath/sagetrac-mirror/commit/aebadedd85d782e004a626f207df5422fee5a9ab)** to **[`5c7fd6e`](https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b)**



---

archive/issue_comments_480015.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThis should be better.",
    "created_at": "2020-08-01T14:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480015",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:11" align="right">comment:11</div>

This should be better.



---

archive/issue_comments_480016.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nIs that `hash` function okay? I have added a short `f == g` implies `hash(f) == hash(g)` test.\n\nPatchbot is green, btw.",
    "created_at": "2020-08-02T09:59:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480016",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:12" align="right">comment:12</div>

Is that `hash` function okay? I have added a short `f == g` implies `hash(f) == hash(g)` test.

Patchbot is green, btw.



---

archive/issue_comments_480017.json:
```json
{
    "body": "Changed dependencies from **#30181** to **#30181, #30116**",
    "created_at": "2020-08-02T21:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480017",
    "user": "https://github.com/mjungmath"
}
```

Changed dependencies from **#30181** to **#30181, #30116**



---

archive/issue_comments_480018.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nSince #30116, scalar fields can be compared on common domains. I added the check of the hash condition in the doctest for this particular comparison.",
    "created_at": "2020-08-02T21:29:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480018",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:13" align="right">comment:13</div>

Since #30116, scalar fields can be compared on common domains. I added the check of the hash condition in the doctest for this particular comparison.



---

archive/issue_comments_480019.json:
```json
{
    "body": "Changed commit from **[`5c7fd6e`](https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b)** to **[`8ca8b75`](https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a)**",
    "created_at": "2020-08-02T21:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480019",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`5c7fd6e`](https://github.com/sagemath/sagetrac-mirror/commit/5c7fd6e1933dd09daab91eda15df09572148413b)** to **[`8ca8b75`](https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a)**



---

archive/issue_comments_480020.json:
```json
{
    "body": "<div id=\"comment:14\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/22e2961381064463bbb48350743520c75d384bb4\"><code>22e2961</code></a></td><td><code>Trac #30116: Merge branch 'develop' into replace_eq_by_richcmp_tensorfield</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/11c9d35deade99b7a8cb186b4edfa507c74ff213\"><code>11c9d35</code></a></td><td><code>Trac #30116: invoke super method by using super() + replacing `__eq__` in most files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a59c71acdf7d22fcafd00ad1965407cf9f9b8a12\"><code>a59c71a</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e2b28cd23af0f59e2f31da2506eac3666a49bd3\"><code>3e2b28c</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f640f21c2abb8e54f0d903edee7c48acbc0c434e\"><code>f640f21</code></a></td><td><code>Trac #30116: Merge branch 't/30267/coercion_via_restriction_of_chart_functions' into t/30116/test_comparison_tensorfield</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9\"><code>4bcd2ee</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89906e2eea286f109b9745fc5202839a57538261\"><code>89906e2</code></a></td><td><code>Trac #30116: Merge branch 'coercion_via_restriction_of_chart_functions' into t/30116/test_comparison_tensorfield</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a9d652faa628d3f7cc9f747ef83f0000ba53f2d5\"><code>a9d652f</code></a></td><td><code>Trac #30116: documentation adapted</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/055d2261ecc3b9b826b0f7d082ffb7802a253421\"><code>055d226</code></a></td><td><code>Trac #30266: Merge branch 't/30116/test_comparison_tensorfield' into t/30266/immutability_for_scalar_fields</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a\"><code>8ca8b75</code></a></td><td><code>Trac #30266: hash compatibility check wrt #30116</code></td></tr></table>\n",
    "created_at": "2020-08-02T21:31:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480020",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:14"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/22e2961381064463bbb48350743520c75d384bb4"><code>22e2961</code></a></td><td><code>Trac #30116: Merge branch 'develop' into replace_eq_by_richcmp_tensorfield</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/11c9d35deade99b7a8cb186b4edfa507c74ff213"><code>11c9d35</code></a></td><td><code>Trac #30116: invoke super method by using super() + replacing `__eq__` in most files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a59c71acdf7d22fcafd00ad1965407cf9f9b8a12"><code>a59c71a</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e2b28cd23af0f59e2f31da2506eac3666a49bd3"><code>3e2b28c</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f640f21c2abb8e54f0d903edee7c48acbc0c434e"><code>f640f21</code></a></td><td><code>Trac #30116: Merge branch 't/30267/coercion_via_restriction_of_chart_functions' into t/30116/test_comparison_tensorfield</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4bcd2eeb367909eef66de8f0390f4fa7abea22c9"><code>4bcd2ee</code></a></td><td><code>Trac #30267: coercion via restriction added</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89906e2eea286f109b9745fc5202839a57538261"><code>89906e2</code></a></td><td><code>Trac #30116: Merge branch 'coercion_via_restriction_of_chart_functions' into t/30116/test_comparison_tensorfield</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a9d652faa628d3f7cc9f747ef83f0000ba53f2d5"><code>a9d652f</code></a></td><td><code>Trac #30116: documentation adapted</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/055d2261ecc3b9b826b0f7d082ffb7802a253421"><code>055d226</code></a></td><td><code>Trac #30266: Merge branch 't/30116/test_comparison_tensorfield' into t/30266/immutability_for_scalar_fields</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a"><code>8ca8b75</code></a></td><td><code>Trac #30266: hash compatibility check wrt #30116</code></td></tr></table>




---

archive/issue_comments_480021.json:
```json
{
    "body": "Changed commit from **[`8ca8b75`](https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a)** to **[`0bf9f36`](https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e)**",
    "created_at": "2020-08-02T21:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480021",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`8ca8b75`](https://github.com/sagemath/sagetrac-mirror/commit/8ca8b754a246ebad775b7db7310e4996f086687a)** to **[`0bf9f36`](https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e)**



---

archive/issue_comments_480022.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e\"><code>0bf9f36</code></a></td><td><code>Trac #30266: Merge branch 'develop' into t/30266/immutability_for_scalar_fields</code></td></tr></table>\n",
    "created_at": "2020-08-02T21:36:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480022",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e"><code>0bf9f36</code></a></td><td><code>Trac #30266: Merge branch 'develop' into t/30266/immutability_for_scalar_fields</code></td></tr></table>




---

archive/issue_comments_480023.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nPatchbot is green.",
    "created_at": "2020-08-03T09:02:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480023",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:16" align="right">comment:16</div>

Patchbot is green.



---

archive/issue_comments_480024.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nI believe for `_richcmp_` you also have `self is not other`, but you should double check this.",
    "created_at": "2020-08-03T12:04:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480024",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:17" align="right">comment:17</div>

I believe for `_richcmp_` you also have `self is not other`, but you should double check this.



---

archive/issue_comments_480025.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@tscrim](#comment%3A17):\n> I believe for `_richcmp_` you also have `self is not other`, but you should double check this.\n\nIn #30116, I used `if self is other:` instead. Is that what you mean?",
    "created_at": "2020-08-03T12:39:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480025",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@tscrim](#comment%3A17):
> I believe for `_richcmp_` you also have `self is not other`, but you should double check this.

In #30116, I used `if self is other:` instead. Is that what you mean?



---

archive/issue_comments_480026.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@mjungmath](#comment%3A18):\n> Replying to [@tscrim](#comment%3A17):\n> > I believe for `_richcmp_` you also have `self is not other`, but you should double check this.\n\n> \n> In #30116, I used `if self is other:` instead. Is that what you mean?\n\nAh, I missed it there. Yes, I mean that, and I think it is unnecessary because the coercion framework through `__eq__` handles that case. However, I don't trust myself here, so it is worth checking.",
    "created_at": "2020-08-03T12:53:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480026",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@mjungmath](#comment%3A18):
> Replying to [@tscrim](#comment%3A17):
> > I believe for `_richcmp_` you also have `self is not other`, but you should double check this.

> 
> In #30116, I used `if self is other:` instead. Is that what you mean?

Ah, I missed it there. Yes, I mean that, and I think it is unnecessary because the coercion framework through `__eq__` handles that case. However, I don't trust myself here, so it is worth checking.



---

archive/issue_comments_480027.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI changed the whole `_richcmp_` to `return False` and tried `f == f`. It returned `False`. So, no prior instance check here. For fun, I did the same with the opposite: no prior check there, too.",
    "created_at": "2020-08-03T13:35:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480027",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:20" align="right">comment:20</div>

I changed the whole `_richcmp_` to `return False` and tried `f == f`. It returned `False`. So, no prior instance check here. For fun, I did the same with the opposite: no prior check there, too.



---

archive/issue_comments_480028.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055\"><code>a5f6a19</code></a></td><td><code>Trac 30266: hash function slightly improved</code></td></tr></table>\n",
    "created_at": "2020-08-03T22:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480028",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055"><code>a5f6a19</code></a></td><td><code>Trac 30266: hash function slightly improved</code></td></tr></table>




---

archive/issue_comments_480029.json:
```json
{
    "body": "Changed commit from **[`0bf9f36`](https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e)** to **[`a5f6a19`](https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055)**",
    "created_at": "2020-08-03T22:32:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480029",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0bf9f36`](https://github.com/sagemath/sagetrac-mirror/commit/0bf9f36d692396f8aa2b32a529532c2e4e48511e)** to **[`a5f6a19`](https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055)**



---

archive/issue_comments_480030.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@mjungmath](#comment%3A20):\n> I changed the whole `_richcmp_` to `return False` and tried `f == f`. It returned `False`. So, no prior instance check here. For fun, I did the same with the opposite: no prior check there, too.\n\nThank you for checking. `:)`",
    "created_at": "2020-08-04T00:25:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480030",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@mjungmath](#comment%3A20):
> I changed the whole `_richcmp_` to `return False` and tried `f == f`. It returned `False`. So, no prior instance check here. For fun, I did the same with the opposite: no prior check there, too.

Thank you for checking. `:)`



---

archive/issue_comments_480031.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nUnfortunately I am too busy right now to do the review. I can probably do it next week, but if someone else wants to step up and do it, please go ahead.",
    "created_at": "2020-08-04T00:27:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480031",
    "user": "https://github.com/tscrim"
}
```

<div id="comment:23" align="right">comment:23</div>

Unfortunately I am too busy right now to do the review. I can probably do it next week, but if someone else wants to step up and do it, please go ahead.



---

archive/issue_comments_480032.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOne question btw: must `1 == f` also imply `hash(1) == hash(f)`. The former can be fulfilled due to the coercion framework, the latter is rather difficult since both have different types. Is it enough for this condition to be fulfilled for objects of the same type?",
    "created_at": "2020-08-04T07:52:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480032",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:24" align="right">comment:24</div>

One question btw: must `1 == f` also imply `hash(1) == hash(f)`. The former can be fulfilled due to the coercion framework, the latter is rather difficult since both have different types. Is it enough for this condition to be fulfilled for objects of the same type?



---

archive/issue_comments_480033.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nFor the ring of integers modulo some number, this behavior is not satisfied:\n\n```\nsage: 3 == GF(2)(3)\nTrue\nsage: hash(3) == hash(GF(2)(3))\nFalse\n```",
    "created_at": "2020-08-04T15:00:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480033",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:25" align="right">comment:25</div>

For the ring of integers modulo some number, this behavior is not satisfied:

```
sage: 3 == GF(2)(3)
True
sage: hash(3) == hash(GF(2)(3))
False
```



---

archive/issue_comments_480034.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nEnsuring that this implication holds across coercion is very difficult, and it is done in Sage on a \"best effort\" basis -- such as for QQ as the fraction field of ZZ.\n\nThe rule of thumb is that if we form sets, they should be of elements of the same parent so that no coercion is involved.  Likewise for the keys of dictionaries.",
    "created_at": "2020-08-04T15:09:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480034",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Ensuring that this implication holds across coercion is very difficult, and it is done in Sage on a "best effort" basis -- such as for QQ as the fraction field of ZZ.

The rule of thumb is that if we form sets, they should be of elements of the same parent so that no coercion is involved.  Likewise for the keys of dictionaries.



---

archive/issue_comments_480035.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@mkoeppe](#comment%3A26):\n> Ensuring that this implication holds across coercion is very difficult, and it is done in Sage on a \"best effort\" basis -- such as for QQ as the fraction field of ZZ.\n> \n> The rule of thumb is that if we form sets, they should be of elements of the same parent so that no coercion is involved.  Likewise for the keys of dictionaries.\n\nSince the restriction is set as a coercion, and they live in different sets, maybe we should make the hash more unique? Namely:\n\n```diff\n-        return hash((type(self).__name__, self._manifold))\n+        return hash((type(self).__name__, self._domain))\n```\n\nIf that is what we want, I will, of course, adapt the doctest section.",
    "created_at": "2020-08-04T15:19:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480035",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@mkoeppe](#comment%3A26):
> Ensuring that this implication holds across coercion is very difficult, and it is done in Sage on a "best effort" basis -- such as for QQ as the fraction field of ZZ.
> 
> The rule of thumb is that if we form sets, they should be of elements of the same parent so that no coercion is involved.  Likewise for the keys of dictionaries.

Since the restriction is set as a coercion, and they live in different sets, maybe we should make the hash more unique? Namely:

```diff
-        return hash((type(self).__name__, self._manifold))
+        return hash((type(self).__name__, self._domain))
```

If that is what we want, I will, of course, adapt the doctest section.



---

archive/issue_comments_480036.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nI haven't followed the discussion regarding restriction and equality, so I would need more context here.",
    "created_at": "2020-08-04T15:46:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480036",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

I haven't followed the discussion regarding restriction and equality, so I would need more context here.



---

archive/issue_comments_480037.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@mkoeppe](#comment%3A28):\n> I haven't followed the discussion regarding restriction and equality, so I would need more context here.\n\nSorry, sure. See #30116 for the discussion.\n\nManifolds allows coercions from scalar fields on `M` to scalar fields on `U`, where `U` is a subset of `M`, i.e. a restriction. Since #30116, the equality check compares scalar fields on a common subset and returns `True` if they are the same on that domain. Nevertheless, both scalar fields on different domains are still distinct objects defined in distinct sets.",
    "created_at": "2020-08-04T15:54:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480037",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@mkoeppe](#comment%3A28):
> I haven't followed the discussion regarding restriction and equality, so I would need more context here.

Sorry, sure. See #30116 for the discussion.

Manifolds allows coercions from scalar fields on `M` to scalar fields on `U`, where `U` is a subset of `M`, i.e. a restriction. Since #30116, the equality check compares scalar fields on a common subset and returns `True` if they are the same on that domain. Nevertheless, both scalar fields on different domains are still distinct objects defined in distinct sets.



---

archive/issue_comments_480038.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nYou probably discussed this on that ticket, but this kind of \"equality\" relation is not transitive without strong assumptions such as analyticity and connectedness, is it?",
    "created_at": "2020-08-04T16:01:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480038",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

You probably discussed this on that ticket, but this kind of "equality" relation is not transitive without strong assumptions such as analyticity and connectedness, is it?



---

archive/issue_comments_480039.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@mkoeppe](#comment%3A30):\n> You probably discussed this on that ticket, but this kind of \"equality\" relation is not transitive without strong assumptions such as analyticity and connectedness, is it?\n\nActually, we didn't. But that is a crucial point! Without analyticity, which is not necessarily given, the transitivity is definitely violated.\n\nHowever, coercible objects have to be comparable, right?",
    "created_at": "2020-08-04T16:18:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480039",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@mkoeppe](#comment%3A30):
> You probably discussed this on that ticket, but this kind of "equality" relation is not transitive without strong assumptions such as analyticity and connectedness, is it?

Actually, we didn't. But that is a crucial point! Without analyticity, which is not necessarily given, the transitivity is definitely violated.

However, coercible objects have to be comparable, right?



---

archive/issue_comments_480040.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nIn general I don't think you should feel obligated to use the coercion framework for comparisons just because you use it for arithmetic. It's just a tool.",
    "created_at": "2020-08-04T16:23:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480040",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

In general I don't think you should feel obligated to use the coercion framework for comparisons just because you use it for arithmetic. It's just a tool.



---

archive/issue_comments_480041.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nReplying to [@mkoeppe](#comment%3A32):\n> In general I don't think you should feel obligated to use the coercion framework for comparisons just because you use it for arithmetic. It's just a tool.\n\nProbably you're right. The documentation, however, is not very explicit on that. I changed the ticket above to \"needs info\" and left a question. Perhaps you can take a short look?",
    "created_at": "2020-08-04T16:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480041",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:33" align="right">comment:33</div>

Replying to [@mkoeppe](#comment%3A32):
> In general I don't think you should feel obligated to use the coercion framework for comparisons just because you use it for arithmetic. It's just a tool.

Probably you're right. The documentation, however, is not very explicit on that. I changed the ticket above to "needs info" and left a question. Perhaps you can take a short look?



---

archive/issue_comments_480042.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI just want to mention that your contributions are always very beneficial. Thank you very much! :)",
    "created_at": "2020-08-04T16:35:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480042",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:34" align="right">comment:34</div>

I just want to mention that your contributions are always very beneficial. Thank you very much! :)



---

archive/issue_comments_480043.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nBut soon I'll start bothering you with lots of naive questions about differential geometry... ;)",
    "created_at": "2020-08-04T16:46:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480043",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:35" align="right">comment:35</div>

But soon I'll start bothering you with lots of naive questions about differential geometry... ;)



---

archive/issue_comments_480044.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nReplying to [@mkoeppe](#comment%3A35):\n> But soon I'll start bothering you with lots of naive questions about differential geometry... ;)\n\nThat's only fair. ;)",
    "created_at": "2020-08-04T16:56:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480044",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:36" align="right">comment:36</div>

Replying to [@mkoeppe](#comment%3A35):
> But soon I'll start bothering you with lots of naive questions about differential geometry... ;)

That's only fair. ;)



---

archive/issue_comments_480045.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI will remove the dependence from #30116 again.",
    "created_at": "2020-08-04T17:04:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480045",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:37" align="right">comment:37</div>

I will remove the dependence from #30116 again.



---

archive/issue_comments_480046.json:
```json
{
    "body": "Changed commit from **[`a5f6a19`](https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055)** to **[`37b0042`](https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258)**",
    "created_at": "2020-08-04T17:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480046",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`a5f6a19`](https://github.com/sagemath/sagetrac-mirror/commit/a5f6a19d0b492cbe2b73daf74e1a6b3a98667055)** to **[`37b0042`](https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258)**



---

archive/issue_comments_480047.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258\"><code>37b0042</code></a></td><td><code>Trac #30266: remove dependency of #30116</code></td></tr></table>\n",
    "created_at": "2020-08-04T17:17:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480047",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258"><code>37b0042</code></a></td><td><code>Trac #30266: remove dependency of #30116</code></td></tr></table>




---

archive/issue_comments_480048.json:
```json
{
    "body": "Changed commit from **[`37b0042`](https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258)** to **[`2f72e19`](https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e)**",
    "created_at": "2020-08-04T17:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480048",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`37b0042`](https://github.com/sagemath/sagetrac-mirror/commit/37b004279233b59c9044e82fb1578a3025beb258)** to **[`2f72e19`](https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e)**



---

archive/issue_comments_480049.json:
```json
{
    "body": "<div id=\"comment:39\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e\"><code>2f72e19</code></a></td><td><code>Trac #30266: if statement missing</code></td></tr></table>\n",
    "created_at": "2020-08-04T17:18:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480049",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:39"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e"><code>2f72e19</code></a></td><td><code>Trac #30266: if statement missing</code></td></tr></table>




---

archive/issue_comments_480050.json:
```json
{
    "body": "Changed commit from **[`2f72e19`](https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e)** to **[`793c162`](https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d)**",
    "created_at": "2020-08-04T17:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480050",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2f72e19`](https://github.com/sagemath/sagetrac-mirror/commit/2f72e19ef4e48b1dd886a3b7ec3488e0e95b284e)** to **[`793c162`](https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d)**



---

archive/issue_comments_480051.json:
```json
{
    "body": "<div id=\"comment:40\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d\"><code>793c162</code></a></td><td><code>Trac #30266: hash function improved</code></td></tr></table>\n",
    "created_at": "2020-08-04T17:27:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480051",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:40"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d"><code>793c162</code></a></td><td><code>Trac #30266: hash function improved</code></td></tr></table>




---

archive/issue_comments_480052.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nHere we go. Let's see what our friend the patchbot says...",
    "created_at": "2020-08-04T17:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480052",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:41" align="right">comment:41</div>

Here we go. Let's see what our friend the patchbot says...



---

archive/issue_comments_480053.json:
```json
{
    "body": "Changed dependencies from **#30181, #30116** to **#30181**",
    "created_at": "2020-08-04T17:28:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480053",
    "user": "https://github.com/mjungmath"
}
```

Changed dependencies from **#30181, #30116** to **#30181**



---

archive/issue_comments_480054.json:
```json
{
    "body": "Changed commit from **[`793c162`](https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d)** to **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**",
    "created_at": "2020-08-04T17:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480054",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`793c162`](https://github.com/sagemath/sagetrac-mirror/commit/793c162342e961c60ddc3ba704a59934d921c47d)** to **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**



---

archive/issue_comments_480055.json:
```json
{
    "body": "<div id=\"comment:42\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4\"><code>1912193</code></a></td><td><code>Trac #30266: doctest improved</code></td></tr></table>\n",
    "created_at": "2020-08-04T17:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480055",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:42"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4"><code>1912193</code></a></td><td><code>Trac #30266: doctest improved</code></td></tr></table>




---

archive/issue_comments_480056.json:
```json
{
    "body": "<div id=\"comment:43\" align=\"right\">comment:43</div>\n\nPatchbot is satisfied.",
    "created_at": "2020-08-04T20:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480056",
    "user": "https://github.com/mjungmath"
}
```

<div id="comment:43" align="right">comment:43</div>

Patchbot is satisfied.



---

archive/issue_comments_480057.json:
```json
{
    "body": "Reviewer: **Matthias Koeppe**",
    "created_at": "2020-08-04T21:46:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480057",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: **Matthias Koeppe**



---

archive/issue_events_413837.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-04T21:46:10Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413837"
}
```



---

archive/issue_events_413838.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-04T21:46:10Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413838"
}
```



---

archive/issue_events_413839.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-09T08:47:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413839"
}
```



---

archive/issue_events_413840.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7b224d83c00c84e08525d7a4a98ce73a51a6c52f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-08-09T08:47:24Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30266#event-413840"
}
```



---

archive/issue_comments_480058.json:
```json
{
    "body": "Changed branch from **[u/gh-mjungmath/immutability_for_scalar_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_for_scalar_fields)** to **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**",
    "created_at": "2020-08-09T08:47:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30266",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30266#issuecomment-480058",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/gh-mjungmath/immutability_for_scalar_fields](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/immutability_for_scalar_fields)** to **[`1912193`](https://github.com/sagemath/sagetrac-mirror/commit/1912193c1c40222a7ce606e318fb1c5d5126cca4)**
