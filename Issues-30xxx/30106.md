# Issue 30106: sage.libs.ecl: Fix unicode handling

archive/issues_029869.json:
```json
{
    "assignees": [],
    "body": "As a follow-up to #29278, #29280: If we use Unicode variable names in `SR`, declaring a domain gives an error:\n\n```\nsage: SR.var('\u03c0', domain='real')\nRuntimeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.\nSystemError: <built-in method var of sage.symbolic.ring.SymbolicRing object at 0x334506908> returned a result with an error set\n```\n\nThis comes from our ECL interface:\n\n```\nsage: from sage.libs.ecl import *\nsage: u_symbol = EclObject('\ud83d\udd25')\nsage: u_symbol\n<repr(<sage.libs.ecl.EclObject at 0x337e7b3c8>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte>\nsage: u_symbol.python()\nUnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte\n```\n\nAlso note:\n\n```\nsage: b_symbol = EclObject(bytes([166]))\nsage: b_symbol\n<repr(<sage.libs.ecl.EclObject at 0x337e7b058>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa6 in position 0: invalid start byte>\n```\n\n\n\n\nDepends on #22191\n\nCC:  @mwageringel @nbruin @dimpase @spaghettisalat\n\nBranch/Commit: **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**\n\nReviewer: **Markus Wageringel**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30106_\n\n",
    "closed_at": "2020-07-25T22:51:04Z",
    "created_at": "2020-07-10T21:11:07Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage.libs.ecl: Fix unicode handling",
    "type": "issue",
    "updated_at": "2020-07-25T22:51:04Z",
    "url": "https://github.com/sagemath/sage/issues/30106",
    "user": "https://github.com/mkoeppe"
}
```
As a follow-up to #29278, #29280: If we use Unicode variable names in `SR`, declaring a domain gives an error:

```
sage: SR.var('π', domain='real')
RuntimeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.
SystemError: <built-in method var of sage.symbolic.ring.SymbolicRing object at 0x334506908> returned a result with an error set
```

This comes from our ECL interface:

```
sage: from sage.libs.ecl import *
sage: u_symbol = EclObject('🔥')
sage: u_symbol
<repr(<sage.libs.ecl.EclObject at 0x337e7b3c8>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte>
sage: u_symbol.python()
UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte
```

Also note:

```
sage: b_symbol = EclObject(bytes([166]))
sage: b_symbol
<repr(<sage.libs.ecl.EclObject at 0x337e7b058>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0xa6 in position 0: invalid start byte>
```




Depends on #22191

CC:  @mwageringel @nbruin @dimpase @spaghettisalat

Branch/Commit: **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**

Reviewer: **Markus Wageringel**

Author: **Matthias Koeppe**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/30106_





---

archive/issue_events_414570.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-10T21:11:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414570"
}
```



---

archive/issue_events_414571.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-10T21:11:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414571"
}
```



---

archive/issue_events_414572.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-10T21:11:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414572"
}
```



---

archive/issue_events_414573.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-10T21:11:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414573"
}
```



---

archive/issue_comments_476707.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n sage: u_symbol = EclObject('\ud83d\udd25')\n sage: u_symbol\n <repr(<sage.libs.ecl.EclObject at 0x337e7b3c8>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte>\n+sage: u_symbol.python()\n+UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte\n ```\n \n Also note:\n``````\n",
    "created_at": "2020-07-10T21:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476707",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 sage: u_symbol = EclObject('🔥')
 sage: u_symbol
 <repr(<sage.libs.ecl.EclObject at 0x337e7b3c8>) failed: UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte>
+sage: u_symbol.python()
+UnicodeDecodeError: 'utf-8' codec can't decode byte 0x94 in position 2: invalid start byte
 ```
 
 Also note:
``````




---

archive/issue_comments_476708.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nNot sure if there is a function in the ECL C API that constructs a Unicode Lisp string.\nSo I would just be going through `CODE-CHAR` as in\n\n```\nsage: ecl_eval('''(type-of (map 'string #'code-char '(128293))))''')\n<ECL: (SIMPLE-ARRAY CHARACTER (1))>\n```",
    "created_at": "2020-07-11T00:25:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476708",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:3" align="right">comment:3</div>

Not sure if there is a function in the ECL C API that constructs a Unicode Lisp string.
So I would just be going through `CODE-CHAR` as in

```
sage: ecl_eval('''(type-of (map 'string #'code-char '(128293))))''')
<ECL: (SIMPLE-ARRAY CHARACTER (1))>
```



---

archive/issue_comments_476709.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,12 @@\n-If we want to support Unicode variable names in `SR`, this will become a problem:\n+As a follow-up to #29278, #29280: If we use Unicode variable names in `SR`, declaring a domain gives an error:\n+\n+```\n+sage: SR.var('\u03c0', domain='real')\n+RuntimeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.\n+SystemError: <built-in method var of sage.symbolic.ring.SymbolicRing object at 0x334506908> returned a result with an error set\n+```\n+\n+This comes from our ECL interface:\n \n ```\n sage: from sage.libs.ecl import *\n``````\n",
    "created_at": "2020-07-11T00:53:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476709",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,12 @@
-If we want to support Unicode variable names in `SR`, this will become a problem:
+As a follow-up to #29278, #29280: If we use Unicode variable names in `SR`, declaring a domain gives an error:
+
+```
+sage: SR.var('π', domain='real')
+RuntimeError: ECL says: THROW: The catch MACSYMA-QUIT is undefined.
+SystemError: <built-in method var of sage.symbolic.ring.SymbolicRing object at 0x334506908> returned a result with an error set
+```
+
+This comes from our ECL interface:
 
 ```
 sage: from sage.libs.ecl import *
``````




---

archive/issue_events_414574.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T00:53:36Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414574"
}
```



---

archive/issue_events_414575.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T00:53:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/wishlist%20item",
    "label_color": "e81ff9",
    "label_name": "wishlist item",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414575"
}
```



---

archive/issue_comments_476710.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_libs_ecl__fix_unicode_handling](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_libs_ecl__fix_unicode_handling)**",
    "created_at": "2020-07-11T01:31:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476710",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_libs_ecl__fix_unicode_handling](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_libs_ecl__fix_unicode_handling)**



---

archive/issue_comments_476711.json:
```json
{
    "body": "<div id=\"comment:6\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b6ebb5278143d35904a596531ced9d65be7daab2\">b6ebb52</a></td><td><code>src/sage/cpython/*string*: Update documentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3\">6ce8f9e</a></td><td><code>python_to_ecl: Handle unicode strings</code></td></tr></table>\n",
    "created_at": "2020-07-11T02:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476711",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:6"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b6ebb5278143d35904a596531ced9d65be7daab2">b6ebb52</a></td><td><code>src/sage/cpython/*string*: Update documentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3">6ce8f9e</a></td><td><code>python_to_ecl: Handle unicode strings</code></td></tr></table>




---

archive/issue_comments_476712.json:
```json
{
    "body": "Commit: **[6ce8f9e](https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3)**",
    "created_at": "2020-07-11T02:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476712",
    "user": "https://github.com/sagetrac-git"
}
```

Commit: **[6ce8f9e](https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3)**



---

archive/issue_comments_476713.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nNow\n\n```\nsage: SR.var('\u03c0', domain='real')\n\u03c0\n```\nbut more work is needed.",
    "created_at": "2020-07-11T02:45:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476713",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Now

```
sage: SR.var('π', domain='real')
π
```
but more work is needed.



---

archive/issue_comments_476714.json:
```json
{
    "body": "Changed commit from **[6ce8f9e](https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3)** to **[c983523](https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe)**",
    "created_at": "2020-07-11T03:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476714",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6ce8f9e](https://github.com/sagemath/sagetrac-mirror/commit/6ce8f9e2cb46b5fc58c5c329201d6f74301946c3)** to **[c983523](https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe)**



---

archive/issue_comments_476715.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe\">c983523</a></td><td><code>EclObject.str: Handle unicode</code></td></tr></table>\n",
    "created_at": "2020-07-11T03:16:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476715",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe">c983523</a></td><td><code>EclObject.str: Handle unicode</code></td></tr></table>




---

archive/issue_comments_476716.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n\n```\nsage: from sage.libs.ecl import *\nsage: u_symbol = EclObject('\ud83d\udd25')\nsage: u_symbol\n<ECL: \ud83d\udd25>\n```",
    "created_at": "2020-07-11T03:17:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476716",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:9" align="right">comment:9</div>


```
sage: from sage.libs.ecl import *
sage: u_symbol = EclObject('🔥')
sage: u_symbol
<ECL: 🔥>
```



---

archive/issue_comments_476717.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a\">f237935</a></td><td><code>ecl_to_python: Handle unicode strings</code></td></tr></table>\n",
    "created_at": "2020-07-11T04:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476717",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a">f237935</a></td><td><code>ecl_to_python: Handle unicode strings</code></td></tr></table>




---

archive/issue_comments_476718.json:
```json
{
    "body": "Changed commit from **[c983523](https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe)** to **[f237935](https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a)**",
    "created_at": "2020-07-11T04:28:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476718",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[c983523](https://github.com/sagemath/sagetrac-mirror/commit/c98352349e1cf8989e3f4ba758788e5004c63abe)** to **[f237935](https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a)**



---

archive/issue_comments_476719.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\n\n```\nsage: u_string = EclObject('\"\ud83d\udc19\"')\nsage: u_string\n<ECL: \"\ud83d\udc19\">\nsage: _.python()\n'\"\ud83d\udc19\"'\n```",
    "created_at": "2020-07-11T04:30:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476719",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>


```
sage: u_string = EclObject('"🐙"')
sage: u_string
<ECL: "🐙">
sage: _.python()
'"🐙"'
```



---

archive/issue_comments_476720.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577\">6f740eb</a></td><td><code>ecl_eval: Handle unicode strings</code></td></tr></table>\n",
    "created_at": "2020-07-11T04:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476720",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577">6f740eb</a></td><td><code>ecl_eval: Handle unicode strings</code></td></tr></table>




---

archive/issue_comments_476721.json:
```json
{
    "body": "Changed commit from **[f237935](https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a)** to **[6f740eb](https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577)**",
    "created_at": "2020-07-11T04:40:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476721",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[f237935](https://github.com/sagemath/sagetrac-mirror/commit/f2379353686eeecfaa0ae1b49936a212e4df146a)** to **[6f740eb](https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577)**



---

archive/issue_comments_476722.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\n\n```\nsage: clock = ecl_eval('''(defun clock (h) (string (elt \"\ud83d\udd5b\ud83d\udd50\ud83d\udd51\ud83d\udd52\ud83d\udd53\ud83d\udd54\ud83d\udd55\ud83d\udd56\ud83d\udd57\ud83d\udd58\ud83d\udd59\ud83d\udd5a\" (mod h 12))))''')\nsage: clock(3).python()\n'\"\ud83d\udd52\"'\n```",
    "created_at": "2020-07-11T04:41:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476722",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>


```
sage: clock = ecl_eval('''(defun clock (h) (string (elt "🕛🕐🕑🕒🕓🕔🕕🕖🕗🕘🕙🕚" (mod h 12))))''')
sage: clock(3).python()
'"🕒"'
```



---

archive/issue_events_414576.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T04:42:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414576"
}
```



---

archive/issue_comments_476723.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-07-11T04:42:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476723",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_476724.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nThank you for solving this.\n\nShould our Maxima interface support unicode with this branch now, or do you know what else is needed to make this work? The following used to give an error, but results in a crash now:\n\n```\nsage: var('\u03be')._maxima_()\n\nCondition of type: SIMPLE-ERROR\nCannot coerce string Cannot coerce string $_SAGE_VAR_\u03be to a base-string to a base-string\nNo restarts available.\n...\nExcessive debugger depth! Probable infinite recursion!\nQuitting.\n```\n\nAlso, please add a doctest for the new functionality.",
    "created_at": "2020-07-11T13:25:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476724",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:15" align="right">comment:15</div>

Thank you for solving this.

Should our Maxima interface support unicode with this branch now, or do you know what else is needed to make this work? The following used to give an error, but results in a crash now:

```
sage: var('ξ')._maxima_()

Condition of type: SIMPLE-ERROR
Cannot coerce string Cannot coerce string $_SAGE_VAR_ξ to a base-string to a base-string
No restarts available.
...
Excessive debugger depth! Probable infinite recursion!
Quitting.
```

Also, please add a doctest for the new functionality.



---

archive/issue_comments_476725.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nAre you on ecl 20.4 ?",
    "created_at": "2020-07-11T14:33:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476725",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:16" align="right">comment:16</div>

Are you on ecl 20.4 ?



---

archive/issue_events_414577.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T15:37:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414577"
}
```



---

archive/issue_events_414578.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T15:37:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414578"
}
```



---

archive/issue_comments_476726.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mwageringel](#comment:15):\n> The following used to give an error, but results in a crash now:\n> \n> ```\n> sage: var('\u03be')._maxima_()\n> \n> Condition of type: SIMPLE-ERROR\n> Cannot coerce string Cannot coerce string $_SAGE_VAR_\u03be to a base-string to a base-string\n> No restarts available.\n> ...\n> Excessive debugger depth! Probable infinite recursion!\n> Quitting.\n> ```\n\nYes, I can confirm this here. I'll look into this.\n\n> Also, please add a doctest for the new functionality.\n\nSure, will do.",
    "created_at": "2020-07-11T15:37:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476726",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mwageringel](#comment:15):
> The following used to give an error, but results in a crash now:
> 
> ```
> sage: var('ξ')._maxima_()
> 
> Condition of type: SIMPLE-ERROR
> Cannot coerce string Cannot coerce string $_SAGE_VAR_ξ to a base-string to a base-string
> No restarts available.
> ...
> Excessive debugger depth! Probable infinite recursion!
> Quitting.
> ```

Yes, I can confirm this here. I'll look into this.

> Also, please add a doctest for the new functionality.

Sure, will do.



---

archive/issue_comments_476727.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@dimpase](#comment:16):\n> Are you on ecl 20.4 ?\n\nI'm still on 16.1.2.",
    "created_at": "2020-07-11T15:38:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476727",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@dimpase](#comment:16):
> Are you on ecl 20.4 ?

I'm still on 16.1.2.



---

archive/issue_comments_476728.json:
```json
{
    "body": "Changed commit from **[6f740eb](https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577)** to **[ee97a6d](https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db)**",
    "created_at": "2020-07-11T15:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476728",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[6f740eb](https://github.com/sagemath/sagetrac-mirror/commit/6f740eb71d017088d90d891379cc826a0f4a3577)** to **[ee97a6d](https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db)**



---

archive/issue_comments_476729.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db\">ee97a6d</a></td><td><code>Fix infinite recursion when error messages are not base-strings</code></td></tr></table>\n",
    "created_at": "2020-07-11T15:50:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476729",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db">ee97a6d</a></td><td><code>Fix infinite recursion when error messages are not base-strings</code></td></tr></table>




---

archive/issue_comments_476730.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI suggest we work on ecl 20.4, for uniformity",
    "created_at": "2020-07-11T16:35:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476730",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:20" align="right">comment:20</div>

I suggest we work on ecl 20.4, for uniformity



---

archive/issue_comments_476731.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThe above error is due to a bug in ECL 16.1.2:\n\n```\n> (princ-to-string '\u03be)\n\"\u039e\"\n> (setf local-table (copy-readtable nil))\n> (setf (readtable-case local-table) :invert)\n> :INVERT\n> (let ((*readtable* local-table) (*print-case* :upcase)) (princ-to-string '\u03be))\nCannot coerce string \u039e to a base-string\n```\n\nI will try with the ECL upgrade now.",
    "created_at": "2020-07-11T16:56:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476731",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

The above error is due to a bug in ECL 16.1.2:

```
> (princ-to-string 'ξ)
"Ξ"
> (setf local-table (copy-readtable nil))
> (setf (readtable-case local-table) :invert)
> :INVERT
> (let ((*readtable* local-table) (*print-case* :upcase)) (princ-to-string 'ξ))
Cannot coerce string Ξ to a base-string
```

I will try with the ECL upgrade now.



---

archive/issue_comments_476732.json:
```json
{
    "body": "Changed commit from **[ee97a6d](https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db)** to **[2d87ee3](https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b)**",
    "created_at": "2020-07-11T18:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476732",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[ee97a6d](https://github.com/sagemath/sagetrac-mirror/commit/ee97a6d8617974f8ed2538d3d85c9ede91fa89db)** to **[2d87ee3](https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b)**



---

archive/issue_comments_476733.json:
```json
{
    "body": "<div id=\"comment:22\"></div>\n\nBranch pushed to git repo; I updated commit sha1. Last 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe\">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b\">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e\">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f\">12447bc</a></td><td><code>reject old makeinfo</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea\">a3e0eca</a></td><td><code>add upstream fix from MR 215</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e\">89b006b</a></td><td><code>add the patch from upstream MR 214</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23\">0b77737</a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074\">8ca1c0e</a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d\">f82c716</a></td><td><code>Commit 75877dd8 from upstream</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b\">2d87ee3</a></td><td><code>Merge commit 'f82c716fdf9c6e91a07166d36b6329a15ecfb41d' of git://trac.sagemath.org/sage into t/30106/sage_libs_ecl__fix_unicode_handling</code></td></tr></table>\n",
    "created_at": "2020-07-11T18:17:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476733",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:22"></div>

Branch pushed to git repo; I updated commit sha1. Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0076bc3a7ad7e1cf3d3d122e8b60b748924de3fe">0076bc3</a></td><td><code>backport Maxima fix for bug #3629</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1d074e86529058aca544a01f55b409d59757323b">1d074e8</a></td><td><code>doctest fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/266d8c103e7a2905f5532a586e292b7e434eb25e">266d8c1</a></td><td><code>backport ECL PR #210</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/12447bc4ba5e9443a95ac0bb4b2fe916410e3c6f">12447bc</a></td><td><code>reject old makeinfo</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a3e0eca1690d463a8aeef9cac915f9fe6ff8baea">a3e0eca</a></td><td><code>add upstream fix from MR 215</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/89b006b106ca050240f580cb80d2a6320e5ade2e">89b006b</a></td><td><code>add the patch from upstream MR 214</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b777377289ba21166ea8d4f647e38e8b6ea1d23">0b77737</a></td><td><code>add upstream MR 216 (to fix cygwin fork)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ca1c0e5223d3e94ed36da2bfc22c9e608283074">8ca1c0e</a></td><td><code>Merge tag '9.2.beta2' into t/22191/public/packages/ecl20</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f82c716fdf9c6e91a07166d36b6329a15ecfb41d">f82c716</a></td><td><code>Commit 75877dd8 from upstream</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b">2d87ee3</a></td><td><code>Merge commit 'f82c716fdf9c6e91a07166d36b6329a15ecfb41d' of git://trac.sagemath.org/sage into t/30106/sage_libs_ecl__fix_unicode_handling</code></td></tr></table>




---

archive/issue_comments_476734.json:
```json
{
    "body": "<div id=\"comment:23\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62\">828a727</a></td><td><code>Add doctests</code></td></tr></table>\n",
    "created_at": "2020-07-11T18:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476734",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:23"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62">828a727</a></td><td><code>Add doctests</code></td></tr></table>




---

archive/issue_comments_476735.json:
```json
{
    "body": "Changed commit from **[2d87ee3](https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b)** to **[828a727](https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62)**",
    "created_at": "2020-07-11T18:42:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476735",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[2d87ee3](https://github.com/sagemath/sagetrac-mirror/commit/2d87ee362ed1ea6c7833e1e8509456927c82c23b)** to **[828a727](https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62)**



---

archive/issue_comments_476736.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@mkoeppe](#comment:21):\n> The above error is due to a bug in ECL 16.1.2:\n> \n> ```\n> > (princ-to-string '\u03be)\n> \"\u039e\"\n> > (setf local-table (copy-readtable nil))\n> > (setf (readtable-case local-table) :invert)\n> > :INVERT\n> > (let ((*readtable* local-table) (*print-case* :upcase)) (princ-to-string '\u03be))\n> Cannot coerce string \u039e to a base-string\n> ```\n> \n> I will try with the ECL upgrade now.\n\nThis bug is still present in ECL 20.4.24.  The above code is from Maxima's `PRINT-INVERT-CASE` function in `commac.lisp`.",
    "created_at": "2020-07-11T18:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476736",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@mkoeppe](#comment:21):
> The above error is due to a bug in ECL 16.1.2:
> 
> ```
> > (princ-to-string 'ξ)
> "Ξ"
> > (setf local-table (copy-readtable nil))
> > (setf (readtable-case local-table) :invert)
> > :INVERT
> > (let ((*readtable* local-table) (*print-case* :upcase)) (princ-to-string 'ξ))
> Cannot coerce string Ξ to a base-string
> ```
> 
> I will try with the ECL upgrade now.

This bug is still present in ECL 20.4.24.  The above code is from Maxima's `PRINT-INVERT-CASE` function in `commac.lisp`.



---

archive/issue_events_414579.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T18:47:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414579"
}
```



---

archive/issue_events_414580.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-11T18:47:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414580"
}
```



---

archive/issue_comments_476737.json:
```json
{
    "body": "Dependencies: **#22191**",
    "created_at": "2020-07-11T18:48:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476737",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#22191**



---

archive/issue_comments_476738.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nNote that after commit ee97a6d, the test case from comment 17 now gives a proper error message, no longer a crash:\n\n```\nsage: var('\u03be')._maxima_()\n....: \n<repr(<sage.interfaces.maxima_lib.MaximaLibElement at 0x32c1d4828>) failed: RuntimeError: ECL says: Cannot coerce string $_SAGE_VAR_\u03be to a base-string>\n```\nFixing this ECL bug or working around it is outside of the scope of this ticket.",
    "created_at": "2020-07-11T19:12:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476738",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Note that after commit ee97a6d, the test case from comment 17 now gives a proper error message, no longer a crash:

```
sage: var('ξ')._maxima_()
....: 
<repr(<sage.interfaces.maxima_lib.MaximaLibElement at 0x32c1d4828>) failed: RuntimeError: ECL says: Cannot coerce string $_SAGE_VAR_ξ to a base-string>
```
Fixing this ECL bug or working around it is outside of the scope of this ticket.



---

archive/issue_comments_476739.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nOk, thanks for the fix. There is one more place where `ecl_string_to_python` should be used \u2013 in `print_objects`:\n\n```\nsage: from sage.libs.ecl import *\nsage: u_symbol = EclObject('\ud83d\udd25')\nsage: print_objects()  # crashes\n```\n\nMoreover, the docstring of `ecl_eval` should be changed into a raw string, as the examples contain backslashes.\n\nOnce that is fixed, you can set a positive review on my behalf.",
    "created_at": "2020-07-12T10:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476739",
    "user": "https://github.com/mwageringel"
}
```

<div id="comment:28" align="right">comment:28</div>

Ok, thanks for the fix. There is one more place where `ecl_string_to_python` should be used – in `print_objects`:

```
sage: from sage.libs.ecl import *
sage: u_symbol = EclObject('🔥')
sage: print_objects()  # crashes
```

Moreover, the docstring of `ecl_eval` should be changed into a raw string, as the examples contain backslashes.

Once that is fixed, you can set a positive review on my behalf.



---

archive/issue_comments_476740.json:
```json
{
    "body": "Reviewer: **Markus Wageringel**",
    "created_at": "2020-07-12T10:31:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476740",
    "user": "https://github.com/mwageringel"
}
```

Reviewer: **Markus Wageringel**



---

archive/issue_comments_476741.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/99b894a950b33ee0cb9210db41b852047a2e1792\">99b894a</a></td><td><code>print_objects: Handle unicode</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b\">59dd62b</a></td><td><code>ecl_eval: Make docstring raw</code></td></tr></table>\n",
    "created_at": "2020-07-12T16:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476741",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/99b894a950b33ee0cb9210db41b852047a2e1792">99b894a</a></td><td><code>print_objects: Handle unicode</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b">59dd62b</a></td><td><code>ecl_eval: Make docstring raw</code></td></tr></table>




---

archive/issue_comments_476742.json:
```json
{
    "body": "Changed commit from **[828a727](https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62)** to **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**",
    "created_at": "2020-07-12T16:13:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476742",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[828a727](https://github.com/sagemath/sagetrac-mirror/commit/828a727915e1920964c7bdbdd52e50b84e731a62)** to **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**



---

archive/issue_comments_476743.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nThank you!",
    "created_at": "2020-07-12T16:14:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476743",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Thank you!



---

archive/issue_events_414581.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T16:14:13Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414581"
}
```



---

archive/issue_events_414582.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T16:14:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414582"
}
```



---

archive/issue_comments_476744.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nFollow-up ticket to keep track of the ECL issue: #30122",
    "created_at": "2020-07-12T16:21:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476744",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Follow-up ticket to keep track of the ECL issue: #30122



---

archive/issue_comments_476745.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/sage_libs_ecl__fix_unicode_handling](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_libs_ecl__fix_unicode_handling)** to **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**",
    "created_at": "2020-07-25T22:51:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30106#issuecomment-476745",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/sage_libs_ecl__fix_unicode_handling](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_libs_ecl__fix_unicode_handling)** to **[59dd62b](https://github.com/sagemath/sagetrac-mirror/commit/59dd62b301bb487452c99d97fabb2f4b180a7c1b)**



---

archive/issue_events_414583.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-25T22:51:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414583"
}
```



---

archive/issue_events_414584.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "8bac45e62f00466d367353678d8f52bcdbcd8455",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-07-25T22:51:04Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30106",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30106#event-414584"
}
```
