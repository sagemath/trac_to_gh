# Issue 30647: Make lazy_import more friendly to pyflakes and other static checkers

archive/issues_030410.json:
```json
{
    "body": "`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8\n\nWe introduce a new method `PythonModule.lazy_import`, which enables the following new idiom for creating lazy imports that are visible to static checkers:\n\n```\nLibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')\nrightnormalform = LibBraiding.lazy_import(\n  'rightnormalform', namespace=None)\ncentralizer,  supersummitset = LibBraiding.lazy_import(\n  ('centralizer', 'supersummitset'), namespace=None)\n```\n\nSee also: \n- #22793 New `LazyImport` implementation based on `lazy_object_proxy`\n- #25898 Enable setting attributes on a lazy imported object\n\n\nCC:  @dcoudert @tobiasdiez @fchapoton @jhpalmieri @tscrim\n\nAuthor: Matthias Koeppe\n\nBranch: u/mkoeppe/make_lazy_import_more_friendly_to_pyflakes_and_other_static_checkers\n\nStatus: needs_info\n\nDependencies: #30616\n\nCommit: 9b19c7aebb76f115797a0ac883757dd1a9825d51\n\nIssue created by migration from https://trac.sagemath.org/ticket/30647\n\n",
    "created_at": "2020-09-23T18:09:12Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-wishlist",
    "title": "Make lazy_import more friendly to pyflakes and other static checkers",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30647",
    "user": "https://github.com/mkoeppe"
}
```
`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8

We introduce a new method `PythonModule.lazy_import`, which enables the following new idiom for creating lazy imports that are visible to static checkers:

```
LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')
rightnormalform = LibBraiding.lazy_import(
  'rightnormalform', namespace=None)
centralizer,  supersummitset = LibBraiding.lazy_import(
  ('centralizer', 'supersummitset'), namespace=None)
```

See also: 
- #22793 New `LazyImport` implementation based on `lazy_object_proxy`
- #25898 Enable setting attributes on a lazy imported object


CC:  @dcoudert @tobiasdiez @fchapoton @jhpalmieri @tscrim

Author: Matthias Koeppe

Branch: u/mkoeppe/make_lazy_import_more_friendly_to_pyflakes_and_other_static_checkers

Status: needs_info

Dependencies: #30616

Commit: 9b19c7aebb76f115797a0ac883757dd1a9825d51

Issue created by migration from https://trac.sagemath.org/ticket/30647





---

archive/issue_comments_462720.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -3,7 +3,11 @@\n It should be investigated whether it is possible to support a syntax for lazy imports that looks like `import` to pyflakes, using Python 3's import machinery.\n \n See also: \n-- #22793 New LazyImport implementation based on lazy_object_proxy\n+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`\n+- #25898 Enable setting attributes on a lazy imported object\n+\n+\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-09-23T18:09:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462720",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -3,7 +3,11 @@
 It should be investigated whether it is possible to support a syntax for lazy imports that looks like `import` to pyflakes, using Python 3's import machinery.
 
 See also: 
-- #22793 New LazyImport implementation based on lazy_object_proxy
+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`
+- #25898 Enable setting attributes on a lazy imported object
+
+
+
 
 Comment: 1
 
```




---

archive/issue_comments_462721.json:
```json
{
    "body": "<a id='comment:2'></a>> As a workaround, you could use lazy imports in conjunction with traditional imports, but place the traditional imports within a if TYPE_CHECKING: statement. That way, it won't execute at runtime, but the type checker will know about import for type checking purposes.\n\n\n(from https://github.com/microsoft/pyright/issues/954#issuecomment-675516511)",
    "created_at": "2020-09-23T18:16:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462721",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:2'></a>> As a workaround, you could use lazy imports in conjunction with traditional imports, but place the traditional imports within a if TYPE_CHECKING: statement. That way, it won't execute at runtime, but the type checker will know about import for type checking purposes.


(from https://github.com/microsoft/pyright/issues/954#issuecomment-675516511)



---

archive/issue_comments_462722.json:
```json
{
    "body": "<a id='comment:3'></a>Note that the patchbot \"pyflakes plugin\" knows about lazy imports.\n\nBUT only with a basic syntax, one-liners.",
    "created_at": "2020-09-23T18:21:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462722",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>Note that the patchbot "pyflakes plugin" knows about lazy imports.

BUT only with a basic syntax, one-liners.



---

archive/issue_comments_462723.json:
```json
{
    "body": "<a id='comment:4'></a>Ah, OK, found it at https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py#L283",
    "created_at": "2020-09-23T18:28:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462723",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>Ah, OK, found it at https://github.com/sagemath/sage-patchbot/blob/master/sage_patchbot/plugins.py#L283



---

archive/issue_comments_462724.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:2 gh-tobiasdiez]:\n> > As a workaround, you could use lazy imports in conjunction with traditional imports, but place the traditional imports within a if TYPE_CHECKING: statement. That way, it won't execute at runtime, but the type checker will know about import for type checking purposes.\n\n> \n> (from https://github.com/microsoft/pyright/issues/954#issuecomment-675516511)\n\n\nThanks for the pointer!\n\nGiven that lazy imports are so widely used in sage, we probably don't want to use this workaround unless really necessary. It would add a lot of clutter to lots of files",
    "created_at": "2020-09-23T18:30:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462724",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Replying to [comment:2 gh-tobiasdiez]:
> > As a workaround, you could use lazy imports in conjunction with traditional imports, but place the traditional imports within a if TYPE_CHECKING: statement. That way, it won't execute at runtime, but the type checker will know about import for type checking purposes.

> 
> (from https://github.com/microsoft/pyright/issues/954#issuecomment-675516511)


Thanks for the pointer!

Given that lazy imports are so widely used in sage, we probably don't want to use this workaround unless really necessary. It would add a lot of clutter to lots of files



---

archive/issue_comments_462725.json:
```json
{
    "body": "<a id='comment:6'></a>A simple solution would be to make `lazy_import` return the (tuple of) lazy import objects that it creates, instead of relying on the magical namespace injection as a side effect. Then we could write\n\n```\nrightnormalform, centralizer, supersummitset = lazy_import(\n  'sage.libs.braiding',\n  ['rightnormalform', 'centralizer', 'supersummitset'],\n  feature=PythonModule('sage.libs.braiding', spkg='libbraiding'))\n```\n\nOf course, we could as well just use `LazyImport` directly:\n\n```\nLibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')\nrightnormalform = LazyImport('sage.libs.braiding', 'rightnormalform', feature=LibBraiding)\ncentralizer     = LazyImport('sage.libs.braiding', 'centralizer',     feature=LibBraiding)\nsupersummitset  = LazyImport('sage.libs.braiding', 'supersummitset',  feature=LibBraiding)\n```",
    "created_at": "2020-09-23T18:39:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462725",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>A simple solution would be to make `lazy_import` return the (tuple of) lazy import objects that it creates, instead of relying on the magical namespace injection as a side effect. Then we could write

```
rightnormalform, centralizer, supersummitset = lazy_import(
  'sage.libs.braiding',
  ['rightnormalform', 'centralizer', 'supersummitset'],
  feature=PythonModule('sage.libs.braiding', spkg='libbraiding'))
```

Of course, we could as well just use `LazyImport` directly:

```
LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')
rightnormalform = LazyImport('sage.libs.braiding', 'rightnormalform', feature=LibBraiding)
centralizer     = LazyImport('sage.libs.braiding', 'centralizer',     feature=LibBraiding)
supersummitset  = LazyImport('sage.libs.braiding', 'supersummitset',  feature=LibBraiding)
```



---

archive/issue_comments_462726.json:
```json
{
    "body": "<a id='comment:7'></a>Expanding on this, we could introduce a method `PythonModule.lazy_import` that would enable writing this:\n\n```\nLibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')\nrightnormalform = LibBraiding.lazy_import('rightnormalform')\ncentralizer,  supersummitset = LibBraiding.lazy_import(\n  'centralizer', 'supersummitset')\n```",
    "created_at": "2020-09-23T18:54:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462726",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Expanding on this, we could introduce a method `PythonModule.lazy_import` that would enable writing this:

```
LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')
rightnormalform = LibBraiding.lazy_import('rightnormalform')
centralizer,  supersummitset = LibBraiding.lazy_import(
  'centralizer', 'supersummitset')
```



---

archive/issue_comments_462727.json:
```json
{
    "body": "<a id='comment:8'></a>I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. \n\nMaybe one could declare it as `lazy_import(Type[C] cls) -> C` and call it via `lazy_import(sage.libs.braiding.rightnormalform)` (note that the argument is not a string). Not sure if that works.",
    "created_at": "2020-09-23T19:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462727",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:8'></a>I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. 

Maybe one could declare it as `lazy_import(Type[C] cls) -> C` and call it via `lazy_import(sage.libs.braiding.rightnormalform)` (note that the argument is not a string). Not sure if that works.



---

archive/issue_comments_462728.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-09-23T22:18:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462728",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_462729.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-23T23:06:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462729",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462730.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-23T23:20:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462730",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_462731.json:
```json
{
    "body": "<a id='comment:13'></a>Here's something that seems to work.",
    "created_at": "2020-09-23T23:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462731",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>Here's something that seems to work.



---

archive/issue_comments_462732.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-09-23T23:21:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462732",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_462733.json:
```json
{
    "body": "<a id='comment:14'></a>Replying to [comment:8 gh-tobiasdiez]:\n> I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. \n\n\nIn the current version, I suppose one could just use a typed assignment",
    "created_at": "2020-09-23T23:22:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462733",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Replying to [comment:8 gh-tobiasdiez]:
> I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. 


In the current version, I suppose one could just use a typed assignment



---

archive/issue_comments_462734.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n+`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8\n+\n+We introduce a new method ``PythonModule.lazy_import``, which enables the following new idiom for lazy imports that are visible to static checkers:\n+\n+```\n+LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')\n+rightnormalform = LibBraiding.lazy_import(\n+  'rightnormalform', namespace=None)\n+centralizer,  supersummitset = LibBraiding.lazy_import(\n+  ('centralizer', 'supersummitset'), namespace=None)\n+```\n+\n+See also: \n+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`\n+- #25898 Enable setting attributes on a lazy imported object\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-23T23:35:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462734",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,18 @@
+`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8
+
+We introduce a new method ``PythonModule.lazy_import``, which enables the following new idiom for lazy imports that are visible to static checkers:
+
+```
+LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')
+rightnormalform = LibBraiding.lazy_import(
+  'rightnormalform', namespace=None)
+centralizer,  supersummitset = LibBraiding.lazy_import(
+  ('centralizer', 'supersummitset'), namespace=None)
+```
+
+See also: 
+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`
+- #25898 Enable setting attributes on a lazy imported object
 
 
 Comment: 1
```




---

archive/issue_comments_462735.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -1,3 +1,18 @@\n+`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8\n+\n+We introduce a new method `PythonModule.lazy_import`, which enables the following new idiom for creating lazy imports that are visible to static checkers:\n+\n+```\n+LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')\n+rightnormalform = LibBraiding.lazy_import(\n+  'rightnormalform', namespace=None)\n+centralizer,  supersummitset = LibBraiding.lazy_import(\n+  ('centralizer', 'supersummitset'), namespace=None)\n+```\n+\n+See also: \n+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`\n+- #25898 Enable setting attributes on a lazy imported object\n \n \n Comment: 1\n```\n",
    "created_at": "2020-09-23T23:36:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462735",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
```diff
--- 
+++ 
@@ -1,3 +1,18 @@
+`pyflakes` does not know about `lazy_import` and may therefore emit distracting warnings - as noted in #30616#comment:8
+
+We introduce a new method `PythonModule.lazy_import`, which enables the following new idiom for creating lazy imports that are visible to static checkers:
+
+```
+LibBraiding = PythonModule('sage.libs.braiding', spkg='libbraiding')
+rightnormalform = LibBraiding.lazy_import(
+  'rightnormalform', namespace=None)
+centralizer,  supersummitset = LibBraiding.lazy_import(
+  ('centralizer', 'supersummitset'), namespace=None)
+```
+
+See also: 
+- #22793 New `LazyImport` implementation based on `lazy_object_proxy`
+- #25898 Enable setting attributes on a lazy imported object
 
 
 Comment: 1
```




---

archive/issue_comments_462736.json:
```json
{
    "body": "<a id='comment:18'></a>I was hoping for a syntax such as `from sage.__lazy__.libs.braiding import rightnormalform`. I *think* this can be implemented with the python3 import machinery (https://docs.python.org/3/reference/import.html#finders-and-loaders) but haven't investigated.",
    "created_at": "2020-09-23T23:55:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462736",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>I was hoping for a syntax such as `from sage.__lazy__.libs.braiding import rightnormalform`. I *think* this can be implemented with the python3 import machinery (https://docs.python.org/3/reference/import.html#finders-and-loaders) but haven't investigated.



---

archive/issue_comments_462737.json:
```json
{
    "body": "<a id='comment:20'></a>Could you please document the `feature` argument in `lazy_import.pyx`?",
    "created_at": "2020-09-29T20:02:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462737",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:20'></a>Could you please document the `feature` argument in `lazy_import.pyx`?



---

archive/issue_comments_462738.json:
```json
{
    "body": "<a id='comment:21'></a>Replying to [comment:14 mkoeppe]:\n> Replying to [comment:8 gh-tobiasdiez]:\n> > I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. \n\n> \n> In the current version, I suppose one could just use a typed assignment\n\n\nWhat do you mean with typed assignment?\nIn the previous version,\n\n```\ntry:\n    from sage.graphs.mcqd import mcqd\nexcept ImportError:\n    from sage.misc.package import PackageNotFoundError\n    raise PackageNotFoundError(\"mcqd\")\nreturn mcqd(self)\n```\nstatic type checkers can check if `mcqd` is actually a function defined in `sage.graphs.mcqd` and if `self` is allowed as an argument of `mcqd`. I doubt that they are intelligent enough to give the same information for the new version:\n\n```\nfrom sage.features import PythonModule\nMcqd = PythonModule('sage.graphs.mcqd', spkg='mcqd')\nmcqd = Mcqd.lazy_import('mcqd', namespace=None)\nreturn mcqd(self)\n```",
    "created_at": "2020-09-29T21:02:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462738",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:21'></a>Replying to [comment:14 mkoeppe]:
> Replying to [comment:8 gh-tobiasdiez]:
> > I think this will not be sufficient for the static typing analysis. You would need to provide the information that `lazy_import('class')` returns an instance of `class`. 

> 
> In the current version, I suppose one could just use a typed assignment


What do you mean with typed assignment?
In the previous version,

```
try:
    from sage.graphs.mcqd import mcqd
except ImportError:
    from sage.misc.package import PackageNotFoundError
    raise PackageNotFoundError("mcqd")
return mcqd(self)
```
static type checkers can check if `mcqd` is actually a function defined in `sage.graphs.mcqd` and if `self` is allowed as an argument of `mcqd`. I doubt that they are intelligent enough to give the same information for the new version:

```
from sage.features import PythonModule
Mcqd = PythonModule('sage.graphs.mcqd', spkg='mcqd')
mcqd = Mcqd.lazy_import('mcqd', namespace=None)
return mcqd(self)
```



---

archive/issue_comments_462739.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-10-01T03:58:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462739",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_462740.json:
```json
{
    "body": "<a id='comment:23'></a>Another option would be to introduce (global) booleans that indicate whether a given library is available. E.g.\n\n```\n// e.g. in sage.distribution\ndef is_mcqd():\n   try:\n      from sage.graphs.mcqd import mcqd\n      return true \n   except ImportError:\n      return false\n   // or some other way to determine if mcqd is available\n\n// usage in another module:\n\n// at the beginning: global import\nif sage.distribution.is_mcqd():\n    from sage.graphs.mcqd import mcqd\n...\n// later in the code\nif sage.distribution.is_mcqd():\n    return mcqd(self)\nelse:\n    return ...\n```\n\nYet another solution would be the following pattern:\n\n```\ntry:\n    from sage.graphs.mcqd import mcqd as _mcqd \nexcept ImportError:\n    mcqd = None\nelse:\n    mcqd = _mcqd\n\n// later\nif mcqd:\n    return mcqd(self)\nelse:\n    return ...\n```\nsuggested in https://github.com/python/mypy/issues/1297#issuecomment-508593494.\nThis should work with mypy, not sure about pyright.",
    "created_at": "2020-10-01T14:57:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462740",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:23'></a>Another option would be to introduce (global) booleans that indicate whether a given library is available. E.g.

```
// e.g. in sage.distribution
def is_mcqd():
   try:
      from sage.graphs.mcqd import mcqd
      return true 
   except ImportError:
      return false
   // or some other way to determine if mcqd is available

// usage in another module:

// at the beginning: global import
if sage.distribution.is_mcqd():
    from sage.graphs.mcqd import mcqd
...
// later in the code
if sage.distribution.is_mcqd():
    return mcqd(self)
else:
    return ...
```

Yet another solution would be the following pattern:

```
try:
    from sage.graphs.mcqd import mcqd as _mcqd 
except ImportError:
    mcqd = None
else:
    mcqd = _mcqd

// later
if mcqd:
    return mcqd(self)
else:
    return ...
```
suggested in https://github.com/python/mypy/issues/1297#issuecomment-508593494.
This should work with mypy, not sure about pyright.



---

archive/issue_comments_462741.json:
```json
{
    "body": "<a id='comment:24'></a>Replying to [comment:20 jhpalmieri]:\n> Could you please document the `feature` argument in `lazy_import.pyx`?\n\n\nThis has now happened in #30587.",
    "created_at": "2020-12-19T17:32:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462741",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:24'></a>Replying to [comment:20 jhpalmieri]:
> Could you please document the `feature` argument in `lazy_import.pyx`?


This has now happened in #30587.



---

archive/issue_comments_462742.json:
```json
{
    "body": "<a id='comment:25'></a>Replying to [comment:18 mkoeppe]:\n> I was hoping for a syntax such as `from sage.__lazy__.libs.braiding import rightnormalform`. I *think* this can be implemented with the python3 import machinery (https://docs.python.org/3/reference/import.html#finders-and-loaders) but haven't investigated. \n\n\nThis was previously discussed in #22752",
    "created_at": "2020-12-19T17:34:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462742",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>Replying to [comment:18 mkoeppe]:
> I was hoping for a syntax such as `from sage.__lazy__.libs.braiding import rightnormalform`. I *think* this can be implemented with the python3 import machinery (https://docs.python.org/3/reference/import.html#finders-and-loaders) but haven't investigated. 


This was previously discussed in #22752



---

archive/issue_comments_462743.json:
```json
{
    "body": "<a id='comment:26'></a>Another solution is to provide type stub files (`__init__.pyi`), see section \"type checkers\" in https://scientific-python.org/specs/spec-0001/",
    "created_at": "2022-12-06T22:32:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30647",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30647#issuecomment-462743",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>Another solution is to provide type stub files (`__init__.pyi`), see section "type checkers" in https://scientific-python.org/specs/spec-0001/
