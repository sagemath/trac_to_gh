# Issue 30966: another wave of cleanup for pbori

archive/issues_030729.json:
```json
{
    "body": "after suggestions of lgtm and flake8\n\nCC:  @tscrim @slel\n\nBranch/Commit: ce6f9b9991a84266a919cb7c385bd8d1eb374530\n\nReviewer: Samuel Leli\u00e8vre\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30966\n\n",
    "closed_at": "2020-12-13T00:42:10Z",
    "created_at": "2020-11-26T09:06:41Z",
    "labels": [
        "component: commutative algebra",
        "minor"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "another wave of cleanup for pbori",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30966",
    "user": "https://github.com/fchapoton"
}
```
after suggestions of lgtm and flake8

CC:  @tscrim @slel

Branch/Commit: ce6f9b9991a84266a919cb7c385bd8d1eb374530

Reviewer: Samuel Lelièvre

Author: Frédéric Chapoton

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30966





---

archive/issue_comments_468682.json:
```json
{
    "body": "<a id='comment:1'></a>New commits:",
    "created_at": "2020-11-26T09:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468682",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>New commits:



---

archive/issue_comments_468683.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-26T09:07:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468683",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_468684.json:
```json
{
    "body": "<a id='comment:2'></a>bot is morally green, please review (should be rather easy)",
    "created_at": "2020-11-27T10:54:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468684",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>bot is morally green, please review (should be rather easy)



---

archive/issue_comments_468685.json:
```json
{
    "body": "<a id='comment:3'></a>Good changes.\n\nBelow are some ideas for further changes in the immediate\nvicinity of proposed changes; but clearly out of scope,\nand none needs be done here.\n\nOne could fix more mutable default arguments for the\n`__init__` method of the class `Multiblock` in\n`src/sage/rings/polynomial/pbori/blocks.py`... but\nalso elsewhere:\n\n```bash\n$ git grep \"def .*=\\[\" .\n```\n\nOne could refactor the `dimacs_encode_clause` method of the\n`CNFEncoder` class in `src/sage/rings/polynomial/pbori/cnf.py`,\nsuppressing the auxiliary `get_sign` function and favouring\niterators over lists:\n\n```diff\n     def dimacs_encode_clause(self, c):\n-        def get_sign(value):\n-            if value == 1:\n-                return 1\n-            return -1\n-\n-        items = sorted(c.items(), reverse=True)\n-        return \" \".join([str(v) for v in [\n-            get_sign(value) * self.to_dimacs_index(variable)\n-            for (variable, value) in items] + [0]])\n+        vv = (self.to_dimacs_index(variable) if value == 1\n+              else -self.to_dimacs_index(variable)\n+              for (variable, value) in sorted(c.items(), reverse=True))\n+        return \" \".join(str(v) for v in vv) + \" 0\"\n```\n\nIn `src/sage/rings/polynomial/pbori/gbcore.py`, replacing\n`*` by `*` in a string seems pointless... so maybe change:\n\n```diff\n     for key in options:\n         newkey = key\n-        for prefix in ['', 'use_', 'opt_allow_', 'opt_']:\n+        for prefix in ['use_', 'opt_allow_', 'opt_']:\n             newkey = newkey.replace(prefix, '')\n         filtered[newkey] = options[key]\n```",
    "created_at": "2020-11-27T13:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468685",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>Good changes.

Below are some ideas for further changes in the immediate
vicinity of proposed changes; but clearly out of scope,
and none needs be done here.

One could fix more mutable default arguments for the
`__init__` method of the class `Multiblock` in
`src/sage/rings/polynomial/pbori/blocks.py`... but
also elsewhere:

```bash
$ git grep "def .*=\[" .
```

One could refactor the `dimacs_encode_clause` method of the
`CNFEncoder` class in `src/sage/rings/polynomial/pbori/cnf.py`,
suppressing the auxiliary `get_sign` function and favouring
iterators over lists:

```diff
     def dimacs_encode_clause(self, c):
-        def get_sign(value):
-            if value == 1:
-                return 1
-            return -1
-
-        items = sorted(c.items(), reverse=True)
-        return " ".join([str(v) for v in [
-            get_sign(value) * self.to_dimacs_index(variable)
-            for (variable, value) in items] + [0]])
+        vv = (self.to_dimacs_index(variable) if value == 1
+              else -self.to_dimacs_index(variable)
+              for (variable, value) in sorted(c.items(), reverse=True))
+        return " ".join(str(v) for v in vv) + " 0"
```

In `src/sage/rings/polynomial/pbori/gbcore.py`, replacing
`*` by `*` in a string seems pointless... so maybe change:

```diff
     for key in options:
         newkey = key
-        for prefix in ['', 'use_', 'opt_allow_', 'opt_']:
+        for prefix in ['use_', 'opt_allow_', 'opt_']:
             newkey = newkey.replace(prefix, '')
         filtered[newkey] = options[key]
```



---

archive/issue_comments_468686.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-27T13:06:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468686",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_468687.json:
```json
{
    "body": "<a id='comment:4'></a>Salut,\nen fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a \u00e9t\u00e9 mis dans sage r\u00e9cemment, sans satisfaire aucun de nos crit\u00e8res habituels de qualit\u00e9. Maintenant, quelqu'un doit nettoyer tout \u00e7a.",
    "created_at": "2020-11-27T13:37:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468687",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:4'></a>Salut,
en fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a été mis dans sage récemment, sans satisfaire aucun de nos critères habituels de qualité. Maintenant, quelqu'un doit nettoyer tout ça.



---

archive/issue_comments_468688.json:
```json
{
    "body": "<a id='comment:5'></a>Replying to [comment:4 chapoton]:\n> Salut,\n> en fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a \u00e9t\u00e9 mis dans sage r\u00e9cemment, sans satisfaire aucun de nos crit\u00e8res habituels de qualit\u00e9. Maintenant, quelqu'un doit nettoyer tout \u00e7a.\n\n\nEt tu peux pointer le doigt vers moi. Mais le code est mort autrement. Il a re\u00e7u bien plus d'attention depuis qu'il est dans sage que dans les 4 derni\u00e8res ann\u00e9es. J'est encore la responsabilit\u00e9 de la \"library\", 15 styles de code diff\u00e9rents dans le m\u00eame fichier sans probl\u00e8me, manque de documentation, tout a fait similaire :(",
    "created_at": "2020-12-07T00:52:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468688",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:5'></a>Replying to [comment:4 chapoton]:
> Salut,
> en fait pbori est un bazar total, presque sans documentation, et c'est un code orphelin qui a été mis dans sage récemment, sans satisfaire aucun de nos critères habituels de qualité. Maintenant, quelqu'un doit nettoyer tout ça.


Et tu peux pointer le doigt vers moi. Mais le code est mort autrement. Il a reçu bien plus d'attention depuis qu'il est dans sage que dans les 4 dernières années. J'est encore la responsabilité de la "library", 15 styles de code différents dans le même fichier sans problème, manque de documentation, tout a fait similaire :(



---

archive/issue_events_080868.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-12-13T00:42:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30966#event-80868"
}
```



---

archive/issue_comments_468689.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-12-13T00:42:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30966",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30966#issuecomment-468689",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
