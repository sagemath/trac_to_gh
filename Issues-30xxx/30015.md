# Issue 30015: Schlegel projection breaks convexity

archive/issues_029778.json:
```json
{
    "assignees": [],
    "body": "The documentation string of `.schlegel_projection` reads:\n\n```\n   Return the Schlegel projection.\n\n   * The polyhedron is translated such that its \"center()\" is at the\n     origin.\n\n   * The vertices are then normalized to the unit sphere\n\n   * The normalized points are stereographically projected from a\n     point slightly outside of the sphere.\n```\n\nWhen normalizing to the unit sphere this (potentially) completely breaks the convexity of the object. \n\nMinimal example:\n\n```\nsage: fcube = polytopes.hypercube(4)\nsage: tfcube = fcube.face_truncation(fcube.faces(0)[0])\nsage: sp = tfcube.schlegel_projection()\nsage: sp.plot()\nLaunched html viewer for Graphics3d Object\n```\n\nThe pentagons are not planar although they should in a schlegel diagram.\n\nThe scaling to the unit sphere should be removed to preserve convexity.\n\nThis ticket fixes the projection while de-duplicating some code.\n\nFOLLOW-UP: Fix .plot() and .show() to have a better behaviour of smaller dimensional objects.\n\nCC:  @kliem @LaisRast\n\nKeywords: **polytope, schlegel**\n\nBranch/Commit: **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**\n\nReviewer: **Jonathan Kliem**\n\nAuthor: **Jean-Philippe Labb\u00e9**\n\nComponent: **geometry**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30015_\n\n",
    "closed_at": "2020-11-29T11:57:59Z",
    "created_at": "2020-06-29T09:13:13Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20geometry",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Schlegel projection breaks convexity",
    "type": "issue",
    "updated_at": "2020-11-29T11:57:59Z",
    "url": "https://github.com/sagemath/sage/issues/30015",
    "user": "https://github.com/jplab"
}
```
The documentation string of `.schlegel_projection` reads:

```
   Return the Schlegel projection.

   * The polyhedron is translated such that its "center()" is at the
     origin.

   * The vertices are then normalized to the unit sphere

   * The normalized points are stereographically projected from a
     point slightly outside of the sphere.
```

When normalizing to the unit sphere this (potentially) completely breaks the convexity of the object. 

Minimal example:

```
sage: fcube = polytopes.hypercube(4)
sage: tfcube = fcube.face_truncation(fcube.faces(0)[0])
sage: sp = tfcube.schlegel_projection()
sage: sp.plot()
Launched html viewer for Graphics3d Object
```

The pentagons are not planar although they should in a schlegel diagram.

The scaling to the unit sphere should be removed to preserve convexity.

This ticket fixes the projection while de-duplicating some code.

FOLLOW-UP: Fix .plot() and .show() to have a better behaviour of smaller dimensional objects.

CC:  @kliem @LaisRast

Keywords: **polytope, schlegel**

Branch/Commit: **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**

Reviewer: **Jonathan Kliem**

Author: **Jean-Philippe Labbé**

Component: **geometry**

_Issue created by migration from https://trac.sagemath.org/ticket/30015_





---

archive/issue_events_413306.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-06-29T09:13:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413306"
}
```



---

archive/issue_events_413307.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-06-29T09:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20geometry",
    "label_color": "0000ff",
    "label_name": "c: geometry",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413307"
}
```



---

archive/issue_events_413308.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-06-29T09:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413308"
}
```



---

archive/issue_events_413309.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-06-29T09:13:13Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413309"
}
```



---

archive/issue_comments_475142.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nIs this the bug you showed during your presentation at sd109?",
    "created_at": "2020-06-29T09:15:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475142",
    "user": "https://github.com/kliem"
}
```

<div id="comment:1" align="right">comment:1</div>

Is this the bug you showed during your presentation at sd109?



---

archive/issue_events_413310.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-06T14:43:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413310"
}
```



---

archive/issue_comments_475143.json:
```json
{
    "body": "<div id=\"comment:2\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/26c03d11ed3120c4fbb41235dabeb014af6f45ab\"><code>26c03d1</code></a></td><td><code>Fixed chirality in stereographic projection</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1\"><code>bed13a6</code></a></td><td><code>examples and pep8</code></td></tr></table>\n",
    "created_at": "2020-10-06T14:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475143",
    "user": "https://github.com/jplab"
}
```

<div id="comment:2"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/26c03d11ed3120c4fbb41235dabeb014af6f45ab"><code>26c03d1</code></a></td><td><code>Fixed chirality in stereographic projection</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1"><code>bed13a6</code></a></td><td><code>examples and pep8</code></td></tr></table>




---

archive/issue_comments_475144.json:
```json
{
    "body": "Commit: **[`bed13a6`](https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1)**",
    "created_at": "2020-10-06T14:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475144",
    "user": "https://github.com/jplab"
}
```

Commit: **[`bed13a6`](https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1)**



---

archive/issue_comments_475145.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -27,3 +27,5 @@\n The pentagons are not planar although they should in a schlegel diagram.\n \n The scaling to the unit sphere should be removed to preserve convexity.\n+\n+This ticket fixes the projection while de-duplicating some code.\n``````\n",
    "created_at": "2020-10-06T14:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475145",
    "user": "https://github.com/jplab"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -27,3 +27,5 @@
 The pentagons are not planar although they should in a schlegel diagram.
 
 The scaling to the unit sphere should be removed to preserve convexity.
+
+This ticket fixes the projection while de-duplicating some code.
``````




---

archive/issue_comments_475146.json:
```json
{
    "body": "Author: **Jean-Philippe Labb\u00e9**",
    "created_at": "2020-10-06T14:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475146",
    "user": "https://github.com/jplab"
}
```

Author: **Jean-Philippe Labbé**



---

archive/issue_comments_475147.json:
```json
{
    "body": "Branch: **[u/jipilab/schlegel](https://github.com/sagemath/sagetrac-mirror/tree/u/jipilab/schlegel)**",
    "created_at": "2020-10-06T14:43:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475147",
    "user": "https://github.com/jplab"
}
```

Branch: **[u/jipilab/schlegel](https://github.com/sagemath/sagetrac-mirror/tree/u/jipilab/schlegel)**



---

archive/issue_comments_475148.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@kliem](#comment:1):\n> Is this the bug you showed during your presentation at sd109?\n\n?",
    "created_at": "2020-10-06T14:45:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475148",
    "user": "https://github.com/kliem"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@kliem](#comment:1):
> Is this the bug you showed during your presentation at sd109?

?



---

archive/issue_comments_475149.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nReplying to [@kliem](#comment:3):\n> Replying to [@kliem](#comment:1):\n> > Is this the bug you showed during your presentation at sd109?\n\n> ?\n\nNo, that one had to do with plotting in 3d and having missing faces or so. This one is really different: it was providing a wrong output.\n\nFurther, the method is improved and made more user-friendly, one just needs to be fed a facet and a positive number to get a schlegel diagram. Close to 0, the projection point is very close to the barycenter of the facet, otherwise, getting away in the direction of the representative point of the locus of points that see that facet.\n\nGiven these 2 things, this provides a projection of the polyhedron (think typically of something in 4d) into the affine hull of the facet, and that image is then transformed orthonormally into 3d and then the picture is drawn.",
    "created_at": "2020-10-06T14:54:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475149",
    "user": "https://github.com/jplab"
}
```

<div id="comment:4" align="right">comment:4</div>

Replying to [@kliem](#comment:3):
> Replying to [@kliem](#comment:1):
> > Is this the bug you showed during your presentation at sd109?

> ?

No, that one had to do with plotting in 3d and having missing faces or so. This one is really different: it was providing a wrong output.

Further, the method is improved and made more user-friendly, one just needs to be fed a facet and a positive number to get a schlegel diagram. Close to 0, the projection point is very close to the barycenter of the facet, otherwise, getting away in the direction of the representative point of the locus of points that see that facet.

Given these 2 things, this provides a projection of the polyhedron (think typically of something in 4d) into the affine hull of the facet, and that image is then transformed orthonormally into 3d and then the picture is drawn.



---

archive/issue_events_413311.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-06T15:12:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413311"
}
```



---

archive/issue_events_413312.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-06T15:12:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413312"
}
```



---

archive/issue_comments_475150.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nAch...\n\n```\nsage: cp = polytopes.cyclic_polytope(4,8).polar()                                                                                                                                                                  \nsage: cp.schlegel_projection()                                                                                                                                                                                     \nTraceback (most recent call last)\n[snip]\n\n~/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/plot.py in __call__(self, x)\n    302         segment = Polyhedron(vertices=[vector(RDF, x),self.projection_point])\n    303         # The intersection of the segment with the facet\n--> 304         preimage = (segment & self.facet).vertices()[0].vector()\n    305         # The transformation matrix acts on the right:\n    306         return preimage*self.A + self.b\n\nIndexError: tuple index out of range\n```\n\nThat line is an overkill... I should probably change it to something a bit simpler than taking the intersection.\n\nThe problem occurs prior to this, this is an artefact from the older version, somehow it is already converted to RDF before and then no intersection is found.\n\nThis example is likely to be one the extreme side, but it is good to fix this now.",
    "created_at": "2020-10-06T15:12:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475150",
    "user": "https://github.com/jplab"
}
```

<div id="comment:5" align="right">comment:5</div>

Ach...

```
sage: cp = polytopes.cyclic_polytope(4,8).polar()                                                                                                                                                                  
sage: cp.schlegel_projection()                                                                                                                                                                                     
Traceback (most recent call last)
[snip]

~/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/plot.py in __call__(self, x)
    302         segment = Polyhedron(vertices=[vector(RDF, x),self.projection_point])
    303         # The intersection of the segment with the facet
--> 304         preimage = (segment & self.facet).vertices()[0].vector()
    305         # The transformation matrix acts on the right:
    306         return preimage*self.A + self.b

IndexError: tuple index out of range
```

That line is an overkill... I should probably change it to something a bit simpler than taking the intersection.

The problem occurs prior to this, this is an artefact from the older version, somehow it is already converted to RDF before and then no intersection is found.

This example is likely to be one the extreme side, but it is good to fix this now.



---

archive/issue_comments_475151.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@jplab](#comment:5):\n> Ach...\n> \n> ```\n> sage: cp = polytopes.cyclic_polytope(4,8).polar()                                                                                                                                                                  \n> sage: cp.schlegel_projection()                                                                                                                                                                                     \n> Traceback (most recent call last)\n> [snip]\n> \n> ~/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/plot.py in __call__(self, x)\n>     302         segment = Polyhedron(vertices=[vector(RDF, x),self.projection_point])\n>     303         # The intersection of the segment with the facet\n> --> 304         preimage = (segment & self.facet).vertices()[0].vector()\n>     305         # The transformation matrix acts on the right:\n>     306         return preimage*self.A + self.b\n> \n> IndexError: tuple index out of range\n> ```\n> \n> That line is an overkill... I should probably change it to something a bit simpler than taking the intersection.\n> \n\nIn Ziegler's book (Lectures on Polytopes) page 133, there is a nice formula for computing the intersection point.",
    "created_at": "2020-10-07T14:30:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475151",
    "user": "https://github.com/LaisRast"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@jplab](#comment:5):
> Ach...
> 
> ```
> sage: cp = polytopes.cyclic_polytope(4,8).polar()                                                                                                                                                                  
> sage: cp.schlegel_projection()                                                                                                                                                                                     
> Traceback (most recent call last)
> [snip]
> 
> ~/sage/local/lib/python3.8/site-packages/sage/geometry/polyhedron/plot.py in __call__(self, x)
>     302         segment = Polyhedron(vertices=[vector(RDF, x),self.projection_point])
>     303         # The intersection of the segment with the facet
> --> 304         preimage = (segment & self.facet).vertices()[0].vector()
>     305         # The transformation matrix acts on the right:
>     306         return preimage*self.A + self.b
> 
> IndexError: tuple index out of range
> ```
> 
> That line is an overkill... I should probably change it to something a bit simpler than taking the intersection.
> 

In Ziegler's book (Lectures on Polytopes) page 133, there is a nice formula for computing the intersection point.



---

archive/issue_comments_475152.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@LaisRast](#comment:6):\n> In Ziegler's book (Lectures on Polytopes) page 133, there is a nice formula for computing the intersection point.\n\nThanks for the pointer, that will do. There is still the issue that at that moment, one deals already with `RDF`, but having a direct formula should improve it. (There is still the danger of dividing by 0...)",
    "created_at": "2020-10-09T14:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475152",
    "user": "https://github.com/jplab"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@LaisRast](#comment:6):
> In Ziegler's book (Lectures on Polytopes) page 133, there is a nice formula for computing the intersection point.

Thanks for the pointer, that will do. There is still the issue that at that moment, one deals already with `RDF`, but having a direct formula should improve it. (There is still the danger of dividing by 0...)



---

archive/issue_comments_475153.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3\"><code>2b6e5c5</code></a></td><td><code>Changed method to get projection</code></td></tr></table>\n",
    "created_at": "2020-10-09T14:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475153",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3"><code>2b6e5c5</code></a></td><td><code>Changed method to get projection</code></td></tr></table>




---

archive/issue_comments_475154.json:
```json
{
    "body": "Changed commit from **[`bed13a6`](https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1)** to **[`2b6e5c5`](https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3)**",
    "created_at": "2020-10-09T14:50:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475154",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`bed13a6`](https://github.com/sagemath/sagetrac-mirror/commit/bed13a6539a1750c63250faee16342bf33bed8a1)** to **[`2b6e5c5`](https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3)**



---

archive/issue_comments_475155.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nI still get an error at line 917 in `base.py`, there is a NaN... which I believe is coming from this division. Hmm. I'll see what can be done.",
    "created_at": "2020-10-09T14:51:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475155",
    "user": "https://github.com/jplab"
}
```

<div id="comment:9" align="right">comment:9</div>

I still get an error at line 917 in `base.py`, there is a NaN... which I believe is coming from this division. Hmm. I'll see what can be done.



---

archive/issue_comments_475156.json:
```json
{
    "body": "<div id=\"comment:10\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e\"><code>4342b52</code></a></td><td><code>Fix doctests</code></td></tr></table>\n",
    "created_at": "2020-10-14T16:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475156",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:10"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e"><code>4342b52</code></a></td><td><code>Fix doctests</code></td></tr></table>




---

archive/issue_comments_475157.json:
```json
{
    "body": "Changed commit from **[`2b6e5c5`](https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3)** to **[`4342b52`](https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e)**",
    "created_at": "2020-10-14T16:43:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475157",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`2b6e5c5`](https://github.com/sagemath/sagetrac-mirror/commit/2b6e5c5ebe3cbda4a6c33d44342eeb55a351ccb3)** to **[`4342b52`](https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e)**



---

archive/issue_events_413313.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-14T16:43:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413313"
}
```



---

archive/issue_events_413314.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-14T16:43:50Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413314"
}
```



---

archive/issue_comments_475158.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThat should do it.",
    "created_at": "2020-10-14T16:43:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475158",
    "user": "https://github.com/jplab"
}
```

<div id="comment:11" align="right">comment:11</div>

That should do it.



---

archive/issue_events_413315.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-15T08:02:24Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413315"
}
```



---

archive/issue_events_413316.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-15T08:02:24Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413316"
}
```



---

archive/issue_events_413317.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-15T08:02:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413317"
}
```



---

archive/issue_events_413318.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-10-15T08:02:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413318"
}
```



---

archive/issue_events_413319.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413319"
}
```



---

archive/issue_events_413320.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413320"
}
```



---

archive/issue_comments_475159.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\n- `# There is no 4-d screen, we must project down to 3d`\n\n  Either `3-d` or `4d` I would say.\n\n- \n\n```\n+        if not locus_polyhedron.relative_interior_contains(projection_point):\n+            raise ValueError(\"the chosen position is too large\")\n```\n  If you enter `position=-1`, this is the error you see, which is somewhat strange. (Of course bullshit gives bullshit, but maybe we can be nice here.)",
    "created_at": "2020-10-27T13:00:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475159",
    "user": "https://github.com/kliem"
}
```

<div id="comment:15" align="right">comment:15</div>

- `# There is no 4-d screen, we must project down to 3d`

  Either `3-d` or `4d` I would say.

- 

```
+        if not locus_polyhedron.relative_interior_contains(projection_point):
+            raise ValueError("the chosen position is too large")
```
  If you enter `position=-1`, this is the error you see, which is somewhat strange. (Of course bullshit gives bullshit, but maybe we can be nice here.)



---

archive/issue_comments_475160.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThere is a trailing space in the preimage line.",
    "created_at": "2020-10-27T13:10:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475160",
    "user": "https://github.com/kliem"
}
```

<div id="comment:16" align="right">comment:16</div>

There is a trailing space in the preimage line.



---

archive/issue_comments_475161.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\n- The biggest trouble with schlegel is that the default position now seems to be much too close !(?)\n\n  Take a look at at\n\n  `polytopes.six_hundred_cell().plot()` etc.\n\n  The default position that works good for stacking, seems to be too close for schlegel projection.\n\n- Even worse: `polytopes.permutahedron(4).show()` isn't orthonormally projected anymore.",
    "created_at": "2020-10-27T13:26:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475161",
    "user": "https://github.com/kliem"
}
```

<div id="comment:17" align="right">comment:17</div>

- The biggest trouble with schlegel is that the default position now seems to be much too close !(?)

  Take a look at at

  `polytopes.six_hundred_cell().plot()` etc.

  The default position that works good for stacking, seems to be too close for schlegel projection.

- Even worse: `polytopes.permutahedron(4).show()` isn't orthonormally projected anymore.



---

archive/issue_events_413321.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-27T13:26:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413321"
}
```



---

archive/issue_events_413322.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-27T13:26:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413322"
}
```



---

archive/issue_comments_475162.json:
```json
{
    "body": "Changed commit from **[`4342b52`](https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e)** to **[`c3df1d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d)**",
    "created_at": "2020-11-17T08:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475162",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4342b52`](https://github.com/sagemath/sagetrac-mirror/commit/4342b529d11d548b4fca2ea229c927d2b364ab3e)** to **[`c3df1d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d)**



---

archive/issue_comments_475163.json:
```json
{
    "body": "<div id=\"comment:19\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d\"><code>c3df1d5</code></a></td><td><code>Add some Errors and easy fixes</code></td></tr></table>\n",
    "created_at": "2020-11-17T08:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475163",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:19"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d"><code>c3df1d5</code></a></td><td><code>Add some Errors and easy fixes</code></td></tr></table>




---

archive/issue_comments_475164.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@kliem](#comment:17):\n> - The biggest trouble with schlegel is that the default position now seems to be much too close !(?)\n> \n>   Take a look at at\n> \n>   `polytopes.six_hundred_cell().plot()` etc.\n> \n>   The default position that works good for stacking, seems to be too close for schlegel projection.\n\nDefaulting behavior will never be perfect.\n\n> \n> - Even worse: `polytopes.permutahedron(4).show()` isn't orthonormally projected anymore.\n\nIt was a mere coincidence that it was orthonormally projected by the method show (!).\nThis indicates that if one has a lower dimensional object (<=3) in an ambient dimension which is strictly larger than 3, one would prefer to visualize (by default) the object in its affine hull, and that, orthonormally projected. This is what you mean?\n\nIn this case, this is a different ticket fixing the `.show()/.plot()` methods. This ticket fixes the schlegel projection which it does...",
    "created_at": "2020-11-17T08:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475164",
    "user": "https://github.com/jplab"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@kliem](#comment:17):
> - The biggest trouble with schlegel is that the default position now seems to be much too close !(?)
> 
>   Take a look at at
> 
>   `polytopes.six_hundred_cell().plot()` etc.
> 
>   The default position that works good for stacking, seems to be too close for schlegel projection.

Defaulting behavior will never be perfect.

> 
> - Even worse: `polytopes.permutahedron(4).show()` isn't orthonormally projected anymore.

It was a mere coincidence that it was orthonormally projected by the method show (!).
This indicates that if one has a lower dimensional object (<=3) in an ambient dimension which is strictly larger than 3, one would prefer to visualize (by default) the object in its affine hull, and that, orthonormally projected. This is what you mean?

In this case, this is a different ticket fixing the `.show()/.plot()` methods. This ticket fixes the schlegel projection which it does...



---

archive/issue_comments_475165.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,5 @@\n The scaling to the unit sphere should be removed to preserve convexity.\n \n This ticket fixes the projection while de-duplicating some code.\n+\n+FOLLOW-UP: Fix .plot() and .show() to have a better behaviour of smaller dimensional objects.\n``````\n",
    "created_at": "2020-11-17T08:09:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475165",
    "user": "https://github.com/jplab"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,5 @@
 The scaling to the unit sphere should be removed to preserve convexity.
 
 This ticket fixes the projection while de-duplicating some code.
+
+FOLLOW-UP: Fix .plot() and .show() to have a better behaviour of smaller dimensional objects.
``````




---

archive/issue_events_413323.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-11-17T08:09:36Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413323"
}
```



---

archive/issue_events_413324.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-11-17T08:09:36Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413324"
}
```



---

archive/issue_comments_475166.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nThank you for exposing the `position` argument.\n\nOf course default behavior will never be perfect, but it is stupid to be stuck with an awful default and don't know how to change it.\n\nIf I'm now unhappy with the default, I can inspect the `plot` method to find the option I need.\n\n`polytopes.permutehdron(4).show()` was orthonormally projected because the default for ambient dimension `4` is (previous to this ticket) schlegel projection. So it was orthonormal for the wrong reasons. Nevertheless, it worked.\n\nHow about adding\n\n```diff\ndiff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py\nindex 59eeb0aa41..f3551f6045 100644\n--- a/src/sage/geometry/polyhedron/base.py\n+++ b/src/sage/geometry/polyhedron/base.py\n@@ -1040,6 +1040,8 @@ class Polyhedron_base(Element):\n             elif polyhedron.dimension() == 4:\n                 # There is no 4-d screen, we must project down to 3d\n                 return polyhedron.schlegel_projection(position=position)\n+            elif polyhedron.dim() <= 3:\n+                return polyhedron.affine_hull_projection(orthonormal=True, extend=True).projection()\n             else:\n                 return polyhedron.projection()\n```\n\nto this ticket? Then this won't be a regression in that way.",
    "created_at": "2020-11-17T08:54:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475166",
    "user": "https://github.com/kliem"
}
```

<div id="comment:21" align="right">comment:21</div>

Thank you for exposing the `position` argument.

Of course default behavior will never be perfect, but it is stupid to be stuck with an awful default and don't know how to change it.

If I'm now unhappy with the default, I can inspect the `plot` method to find the option I need.

`polytopes.permutehdron(4).show()` was orthonormally projected because the default for ambient dimension `4` is (previous to this ticket) schlegel projection. So it was orthonormal for the wrong reasons. Nevertheless, it worked.

How about adding

```diff
diff --git a/src/sage/geometry/polyhedron/base.py b/src/sage/geometry/polyhedron/base.py
index 59eeb0aa41..f3551f6045 100644
--- a/src/sage/geometry/polyhedron/base.py
+++ b/src/sage/geometry/polyhedron/base.py
@@ -1040,6 +1040,8 @@ class Polyhedron_base(Element):
             elif polyhedron.dimension() == 4:
                 # There is no 4-d screen, we must project down to 3d
                 return polyhedron.schlegel_projection(position=position)
+            elif polyhedron.dim() <= 3:
+                return polyhedron.affine_hull_projection(orthonormal=True, extend=True).projection()
             else:
                 return polyhedron.projection()
```

to this ticket? Then this won't be a regression in that way.



---

archive/issue_comments_475167.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@jplab](#comment:20):\n> [...]\n> \n> In this case, this is a different ticket fixing the `.show()/.plot()` methods. This ticket fixes the schlegel projection which it does...\n\nBut you have introduced a change in this ticket, this is why I propose to \"fix\" it here. At least some temporary solution we can live with.\n\nThe default plotting method before this ticket for `polytopes.permutahedron(4)` was schlegel projection. You changed this to just projection.",
    "created_at": "2020-11-17T09:44:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475167",
    "user": "https://github.com/kliem"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@jplab](#comment:20):
> [...]
> 
> In this case, this is a different ticket fixing the `.show()/.plot()` methods. This ticket fixes the schlegel projection which it does...

But you have introduced a change in this ticket, this is why I propose to "fix" it here. At least some temporary solution we can live with.

The default plotting method before this ticket for `polytopes.permutahedron(4)` was schlegel projection. You changed this to just projection.



---

archive/issue_comments_475168.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nOk sure.\n\nBut again: it was not doing an orthonormal projection, otherwise the minimal non-working example in the ticket description would not occur. It was a mere accident because the permutahedron realization given there is inscribed.\n\nThe above addition looks good to me. I would even prioritize it over `polyhedron.dimension() == 4`, because... I guess that whenever you have an object that is at most dimension 3, you would like to see \"it\" exactly how it is, and I actually would give an option to turn off the orthonormal if the user wants to.\nThen, if the object has dimension 4, it will do the schlegel projection (without respect at all to the ambient dimension, which make more sense to me).\n\nI'll have another round of look at it.",
    "created_at": "2020-11-17T16:19:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475168",
    "user": "https://github.com/jplab"
}
```

<div id="comment:23" align="right">comment:23</div>

Ok sure.

But again: it was not doing an orthonormal projection, otherwise the minimal non-working example in the ticket description would not occur. It was a mere accident because the permutahedron realization given there is inscribed.

The above addition looks good to me. I would even prioritize it over `polyhedron.dimension() == 4`, because... I guess that whenever you have an object that is at most dimension 3, you would like to see "it" exactly how it is, and I actually would give an option to turn off the orthonormal if the user wants to.
Then, if the object has dimension 4, it will do the schlegel projection (without respect at all to the ambient dimension, which make more sense to me).

I'll have another round of look at it.



---

archive/issue_comments_475169.json:
```json
{
    "body": "<div id=\"comment:24\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82\"><code>dae3bbf</code></a></td><td><code>Fixed default behavior and tweaks</code></td></tr></table>\n",
    "created_at": "2020-11-18T13:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475169",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:24"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82"><code>dae3bbf</code></a></td><td><code>Fixed default behavior and tweaks</code></td></tr></table>




---

archive/issue_comments_475170.json:
```json
{
    "body": "Changed commit from **[`c3df1d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d)** to **[`dae3bbf`](https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82)**",
    "created_at": "2020-11-18T13:31:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475170",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c3df1d5`](https://github.com/sagemath/sagetrac-mirror/commit/c3df1d5855585ee893a86fbcd85d341fe4d2d58d)** to **[`dae3bbf`](https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82)**



---

archive/issue_comments_475171.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIt should be all fixed now. I changed the default behavior for when the locus polyhedron is compact, to take the midpoint of the line segment. The rest is unchanged. Further, I exposed the option to remove orthonormality in the plotting...\n\nHave a look at:\n\n```\nsage: p = polytopes.six_hundred_cell()                                                                                                                                                                             \nsage: p.show(position=4,point={'size':0},frame=False)\n```",
    "created_at": "2020-11-18T13:34:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475171",
    "user": "https://github.com/jplab"
}
```

<div id="comment:25" align="right">comment:25</div>

It should be all fixed now. I changed the default behavior for when the locus polyhedron is compact, to take the midpoint of the line segment. The rest is unchanged. Further, I exposed the option to remove orthonormality in the plotting...

Have a look at:

```
sage: p = polytopes.six_hundred_cell()                                                                                                                                                                             
sage: p.show(position=4,point={'size':0},frame=False)
```



---

archive/issue_comments_475172.json:
```json
{
    "body": "<div id=\"comment:26\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983\"><code>ec0edd7</code></a></td><td><code>Fixed higher dim/dirt</code></td></tr></table>\n",
    "created_at": "2020-11-18T13:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475172",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:26"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983"><code>ec0edd7</code></a></td><td><code>Fixed higher dim/dirt</code></td></tr></table>




---

archive/issue_comments_475173.json:
```json
{
    "body": "Changed commit from **[`dae3bbf`](https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82)** to **[`ec0edd7`](https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983)**",
    "created_at": "2020-11-18T13:44:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475173",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`dae3bbf`](https://github.com/sagemath/sagetrac-mirror/commit/dae3bbfb2f6d65eeb5f012b064d05e130a5d4f82)** to **[`ec0edd7`](https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983)**



---

archive/issue_comments_475174.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\n... Ok. So ready for review again... It should be a small improvement on the plotting procedure. To me it makes more sense as of now. (see the internal `def project` function which decides what to do...)",
    "created_at": "2020-11-18T13:45:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475174",
    "user": "https://github.com/jplab"
}
```

<div id="comment:27" align="right">comment:27</div>

... Ok. So ready for review again... It should be a small improvement on the plotting procedure. To me it makes more sense as of now. (see the internal `def project` function which decides what to do...)



---

archive/issue_comments_475175.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\n\n```diff\n-        def project(polyhedron,ortho):\n+        def project(polyhedron, ortho):\n```\n\n```diff\n-        projection = project(self,orthonormal)\n+        projection = project(self, orthonormal)\n```\n\nI propose the following doctest to show that this has been fixed::\n\n```\nsage: fcube = polytopes.hypercube(4)                                                                                                                                                \nsage: tfcube = fcube.face_truncation(fcube.faces(0)[0])                                                                                                                             \nsage: sp = tfcube.schlegel_projection()                                                                                                                                             \nsage: for face in tfcube.faces(2): \n....:     vertices = face.ambient_Vrepresentation() \n....:     indices = [sp.coord_index_of(vector(x)) for x in vertices] \n....:     projected_vertices = [sp.transformed_coords[i] for i in indices] \n....:     assert Polyhedron(projected_vertices).dim() == 2 \n```\n\nThis line here is hard to read due to the underscore. I would exchange it for something else:\n\n```\nineq = [_ for _ in facet.ambient_Hrepresentation() if _.is_inequality()][0]\n```\n\n```diff\n+        A, b = self.facet.as_polyhedron().affine_hull_projection(as_affine_map=True, orthonormal=True,extend=True)\n-        A,b = self.facet.as_polyhedron().affine_hull_projection(as_affine_map=True, orthonormal=True, extend=True)\n```\n\n```diff\n-        self.projection_point = vector(RDF,projection_point)\n+        self.projection_point = vector(RDF, projection_point)\n```",
    "created_at": "2020-11-19T07:49:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475175",
    "user": "https://github.com/kliem"
}
```

<div id="comment:28" align="right">comment:28</div>


```diff
-        def project(polyhedron,ortho):
+        def project(polyhedron, ortho):
```

```diff
-        projection = project(self,orthonormal)
+        projection = project(self, orthonormal)
```

I propose the following doctest to show that this has been fixed::

```
sage: fcube = polytopes.hypercube(4)                                                                                                                                                
sage: tfcube = fcube.face_truncation(fcube.faces(0)[0])                                                                                                                             
sage: sp = tfcube.schlegel_projection()                                                                                                                                             
sage: for face in tfcube.faces(2): 
....:     vertices = face.ambient_Vrepresentation() 
....:     indices = [sp.coord_index_of(vector(x)) for x in vertices] 
....:     projected_vertices = [sp.transformed_coords[i] for i in indices] 
....:     assert Polyhedron(projected_vertices).dim() == 2 
```

This line here is hard to read due to the underscore. I would exchange it for something else:

```
ineq = [_ for _ in facet.ambient_Hrepresentation() if _.is_inequality()][0]
```

```diff
+        A, b = self.facet.as_polyhedron().affine_hull_projection(as_affine_map=True, orthonormal=True,extend=True)
-        A,b = self.facet.as_polyhedron().affine_hull_projection(as_affine_map=True, orthonormal=True, extend=True)
```

```diff
-        self.projection_point = vector(RDF,projection_point)
+        self.projection_point = vector(RDF, projection_point)
```



---

archive/issue_comments_475176.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nOnce done, you can put it on positive review on my behalf.\n\nThank you for fixing this. It's great to have this.",
    "created_at": "2020-11-19T07:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475176",
    "user": "https://github.com/kliem"
}
```

<div id="comment:29" align="right">comment:29</div>

Once done, you can put it on positive review on my behalf.

Thank you for fixing this. It's great to have this.



---

archive/issue_comments_475177.json:
```json
{
    "body": "Reviewer: **Jonathan Kliem**",
    "created_at": "2020-11-19T07:53:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475177",
    "user": "https://github.com/kliem"
}
```

Reviewer: **Jonathan Kliem**



---

archive/issue_comments_475178.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nWith your ticket, how do I obtain a decent picture of `polytopes.cyclic_polytope(4,10)`?\n\nOr maybe one should really choose better points on the moment curve for pictures. The pairwise euclidean distance of the vertices behaves awful.",
    "created_at": "2020-11-19T12:21:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475178",
    "user": "https://github.com/kliem"
}
```

<div id="comment:30" align="right">comment:30</div>

With your ticket, how do I obtain a decent picture of `polytopes.cyclic_polytope(4,10)`?

Or maybe one should really choose better points on the moment curve for pictures. The pairwise euclidean distance of the vertices behaves awful.



---

archive/issue_comments_475179.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nI guess you can basically forget the last comment. It is just to note that the current realization doesn't work for pictures.\n\nAnyway, if you agree to the changes I suggested, I can also do them.",
    "created_at": "2020-11-21T11:55:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475179",
    "user": "https://github.com/kliem"
}
```

<div id="comment:31" align="right">comment:31</div>

I guess you can basically forget the last comment. It is just to note that the current realization doesn't work for pictures.

Anyway, if you agree to the changes I suggested, I can also do them.



---

archive/issue_comments_475180.json:
```json
{
    "body": "Changed commit from **[`ec0edd7`](https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983)** to **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**",
    "created_at": "2020-11-22T11:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475180",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`ec0edd7`](https://github.com/sagemath/sagetrac-mirror/commit/ec0edd73b6bf6e9d5ca52fb50a4cf04fe02c9983)** to **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**



---

archive/issue_comments_475181.json:
```json
{
    "body": "<div id=\"comment:32\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29\"><code>f10d571</code></a></td><td><code>Schoenheit fixes + test</code></td></tr></table>\n",
    "created_at": "2020-11-22T11:56:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475181",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:32"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29"><code>f10d571</code></a></td><td><code>Schoenheit fixes + test</code></td></tr></table>




---

archive/issue_events_413325.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-11-22T11:56:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413325"
}
```



---

archive/issue_events_413326.json:
```json
{
    "actor": "https://github.com/jplab",
    "created_at": "2020-11-22T11:56:52Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413326"
}
```



---

archive/issue_comments_475182.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nReplying to [@kliem](#comment:30):\n> With your ticket, how do I obtain a decent picture of `polytopes.cyclic_polytope(4,10)`?\n> \n> Or maybe one should really choose better points on the moment curve for pictures. The pairwise euclidean distance of the vertices behaves awful.\n\nThere isn't really any good choice of parameters to get \"a nice picture\" of the cyclic polytope on the moment curve.\n\nA better choice would be to essentially add the cyclic polytope construction on the trigonometric curve so that the coordinates all have the same \"scale\". ... another nice thing that would be easy to implement and that's not too hard.",
    "created_at": "2020-11-22T11:58:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475182",
    "user": "https://github.com/jplab"
}
```

<div id="comment:34" align="right">comment:34</div>

Replying to [@kliem](#comment:30):
> With your ticket, how do I obtain a decent picture of `polytopes.cyclic_polytope(4,10)`?
> 
> Or maybe one should really choose better points on the moment curve for pictures. The pairwise euclidean distance of the vertices behaves awful.

There isn't really any good choice of parameters to get "a nice picture" of the cyclic polytope on the moment curve.

A better choice would be to essentially add the cyclic polytope construction on the trigonometric curve so that the coordinates all have the same "scale". ... another nice thing that would be easy to implement and that's not too hard.



---

archive/issue_comments_475183.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nTypos, to be fixed here or in a follow-up ticket.\n\n```diff\n-        A different values of ``position`` changes the projection::\n+        A different value of ``position`` changes the projection::\n```\n\n```diff\n-        sees more than one facet resulting in a error::\n+        sees more than one facet resulting in an error::\n```",
    "created_at": "2020-11-22T22:36:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475183",
    "user": "https://github.com/slel"
}
```

<div id="comment:35" align="right">comment:35</div>

Typos, to be fixed here or in a follow-up ticket.

```diff
-        A different values of ``position`` changes the projection::
+        A different value of ``position`` changes the projection::
```

```diff
-        sees more than one facet resulting in a error::
+        sees more than one facet resulting in an error::
```



---

archive/issue_comments_475184.json:
```json
{
    "body": "Changed branch from **[u/jipilab/schlegel](https://github.com/sagemath/sagetrac-mirror/tree/u/jipilab/schlegel)** to **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**",
    "created_at": "2020-11-29T11:57:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30015#issuecomment-475184",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/jipilab/schlegel](https://github.com/sagemath/sagetrac-mirror/tree/u/jipilab/schlegel)** to **[`f10d571`](https://github.com/sagemath/sagetrac-mirror/commit/f10d5714bc757db8ec8910359931fb1bcb0dbb29)**



---

archive/issue_events_413327.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-29T11:57:59Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413327"
}
```



---

archive/issue_events_413328.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "2ed5a13e21ecc37be82d90ec96c3fec6ea400bd4",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-11-29T11:57:59Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30015",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30015#event-413328"
}
```
