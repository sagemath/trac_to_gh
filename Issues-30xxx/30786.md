# Issue 30786: Multiplying and dividing by 3 hangs

archive/issues_030549.json:
```json
{
    "body": "Tested with https://sagecell.sagemath.org\n\n```\nsage: version()\n'SageMath version 9.1, Release Date: 2020-05-20'\n```\nAll of these work as expected:\n\n```\nsage: exp(-ln(-x))\nsage: exp(-3*ln(-x)/3)\nsage: exp(-ln(-9*x))\n```\nHowever this hangs:\n\n```\nsage: exp(-3*ln(-9*x)/3)\n```\nIn case you are curious, this is what I was doing (the expressions were a bit more complex, of course):\n\n```\nsage: a=var('a')\nsage: y=exp(-3*x)\nsage: x0=ln(-9*a)/3\nsage: y(x=x0)\n```\n\n**Branch/Commit:** [6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)\n\n**Reviewer:** Travis Scrimshaw, Dima Pasechnik\n\n**Author:** Dave Morris\n\n**Dependencies:** #30446\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30786\n\n",
    "closed_at": "2021-03-09T00:00:44Z",
    "created_at": "2020-10-17T22:13:16Z",
    "labels": [
        "component: symbolics",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Multiplying and dividing by 3 hangs",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30786",
    "user": "https://github.com/GMS103"
}
```
Tested with https://sagecell.sagemath.org

```
sage: version()
'SageMath version 9.1, Release Date: 2020-05-20'
```
All of these work as expected:

```
sage: exp(-ln(-x))
sage: exp(-3*ln(-x)/3)
sage: exp(-ln(-9*x))
```
However this hangs:

```
sage: exp(-3*ln(-9*x)/3)
```
In case you are curious, this is what I was doing (the expressions were a bit more complex, of course):

```
sage: a=var('a')
sage: y=exp(-3*x)
sage: x0=ln(-9*a)/3
sage: y(x=x0)
```

**Branch/Commit:** [6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)

**Reviewer:** Travis Scrimshaw, Dima Pasechnik

**Author:** Dave Morris

**Dependencies:** #30446

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/30786





---

archive/issue_comments_610360.json:
```json
{
    "body": "<a id='comment:1'></a>\nI confirm that there is a problem. `CoCalc` ran out of memory. My laptop (9.2rc2 on MacOS 10.15.7) completed eventually (I think it took about half an hour). The output is a 4GB string of nonsense that seems to be almost entirely digits, but starts with `-1/34723950083` and ends with `91987451449/x`.\n\nThese symptoms are somewhat similar to #30446.",
    "created_at": "2020-10-18T01:25:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610360",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:1'></a>
I confirm that there is a problem. `CoCalc` ran out of memory. My laptop (9.2rc2 on MacOS 10.15.7) completed eventually (I think it took about half an hour). The output is a 4GB string of nonsense that seems to be almost entirely digits, but starts with `-1/34723950083` and ends with `91987451449/x`.

These symptoms are somewhat similar to #30446.



---

archive/issue_comments_610361.json:
```json
{
    "body": "<a id='comment:2'></a>\nDaveWitteMorris is correct. I checked and this is the same issue as #30446. If you look on that ticket, I submitted a pull request with `pynac` that will fix the issue.",
    "created_at": "2020-10-19T03:22:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610361",
    "user": "https://github.com/bmlivin"
}
```

<a id='comment:2'></a>
DaveWitteMorris is correct. I checked and this is the same issue as #30446. If you look on that ticket, I submitted a pull request with `pynac` that will fix the issue.



---

archive/issue_comments_610362.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks for the feedback, I was really surprised by this bug.\nGlad to know it will be fixed.",
    "created_at": "2020-10-19T23:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610362",
    "user": "https://github.com/GMS103"
}
```

<a id='comment:3'></a>
Thanks for the feedback, I was really surprised by this bug.
Glad to know it will be fixed.



---

archive/issue_events_090449.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-01-08T20:02:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30786#event-90449"
}
```



---

archive/issue_comments_610363.json:
```json
{
    "body": "<a id='comment:4'></a>\nAs pointed out in[comment:2](#comment%3A2), this will be fixed by the patch to pynac in #30446. When that ticket is closed, we can add this as another doctest.",
    "created_at": "2021-01-08T20:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610363",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:4'></a>
As pointed out in[comment:2](#comment%3A2), this will be fixed by the patch to pynac in #30446. When that ticket is closed, we can add this as another doctest.



---

archive/issue_comments_610364.json:
```json
{
    "body": "**Dependencies:** #30446",
    "created_at": "2021-01-08T20:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610364",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Dependencies:** #30446



---

archive/issue_comments_610365.json:
```json
{
    "body": "**Branch:** [public/30786](https://github.com/sagemath/sagetrac-mirror/tree/public/30786)",
    "created_at": "2021-01-10T22:33:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610365",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Branch:** [public/30786](https://github.com/sagemath/sagetrac-mirror/tree/public/30786)



---

archive/issue_comments_610366.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2021-01-10T22:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610366",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_610367.json:
```json
{
    "body": "<a id='comment:6'></a>\nThe PR adds doctests for the bugs on this ticket, #28620, and #30304. All were fixed by the patch to pynac at #30446 (which has positive review). These doctests are in the `_pow_` method, and I moved the doctest of #30446 to the same place. (It was in the `_latex_` method, which does not seem like such a good place.)\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/dc073dfa9224efb61dc01d49ef60a9c7fa0dc568\">dc073df</a></td><td><code>fixes for trac #30446</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d\">4a5d053</a></td><td><code>doctests for trac 28620, 30304, 30786</code></td></tr></table>\n",
    "created_at": "2021-01-10T22:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610367",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:6'></a>
The PR adds doctests for the bugs on this ticket, #28620, and #30304. All were fixed by the patch to pynac at #30446 (which has positive review). These doctests are in the `_pow_` method, and I moved the doctest of #30446 to the same place. (It was in the `_latex_` method, which does not seem like such a good place.)

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/dc073dfa9224efb61dc01d49ef60a9c7fa0dc568">dc073df</a></td><td><code>fixes for trac #30446</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d">4a5d053</a></td><td><code>doctests for trac 28620, 30304, 30786</code></td></tr></table>




---

archive/issue_comments_610368.json:
```json
{
    "body": "**Commit:** [4a5d0536a91fd3ef538c3430e3b668c75272225d](https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d)",
    "created_at": "2021-01-10T22:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610368",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Commit:** [4a5d0536a91fd3ef538c3430e3b668c75272225d](https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d)



---

archive/issue_events_090450.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-01-10T22:41:18Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30786#event-90450"
}
```



---

archive/issue_events_090451.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-01-10T22:41:18Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30786#event-90451"
}
```



---

archive/issue_comments_610369.json:
```json
{
    "body": "**Author:** Dave Morris",
    "created_at": "2021-01-10T22:41:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610369",
    "user": "https://github.com/DaveWitteMorris"
}
```

**Author:** Dave Morris



---

archive/issue_comments_610370.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2021-01-11T23:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610370",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_610371.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2021-01-11T23:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610371",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_610372.json:
```json
{
    "body": "<a id='comment:7'></a>\nLGTM.",
    "created_at": "2021-01-11T23:45:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610372",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:7'></a>
LGTM.



---

archive/issue_comments_610373.json:
```json
{
    "body": "<a id='comment:8'></a>\nThanks!",
    "created_at": "2021-01-12T00:12:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610373",
    "user": "https://github.com/DaveWitteMorris"
}
```

<a id='comment:8'></a>
Thanks!



---

archive/issue_comments_610374.json:
```json
{
    "body": "<a id='comment:9'></a>\nrebase over new #30446",
    "created_at": "2021-01-24T21:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610374",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:9'></a>
rebase over new #30446



---

archive/issue_comments_610375.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2021-01-24T21:48:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610375",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_610376.json:
```json
{
    "body": "<a id='comment:10'></a>\n**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9d747fc169e04f78dc9d1ba8e13c4e09f162d3a6\">9d747fc</a></td><td><code>sage --package update-latest: Distinguish pypi package name and spkg name</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f74f66c31a358b3ff5dd2381ce4b7c1f5899858d\">f74f66c</a></td><td><code>sage --package update-latest: Accept package classes :standard:, :optional: etc., restrict to normal Python packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/182b3d22106e206a95d9ffbf2104f5c2a32dd3b5\">182b3d2</a></td><td><code>sage -package fix-checksum: Handle package classes, ignore non-normal packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9a57cf605cfab70a449b8a86ca2ac87f7f7d9a07\">9a57cf6</a></td><td><code>pynac update</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/563940e8554fe96a16fdf669c03f895aacf27b3c\">563940e</a></td><td><code>doctest from #30446</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51def3cc9203861a11404019d68ed90937d9f017\">51def3c</a></td><td><code>sane version name</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4834dc8a7ab300c57921986e847972030b0547ca\">4834dc8</a></td><td><code>remove upstreamed patch</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/214712de4fd44f9e703cfffc7cccced7b5757a12\">214712d</a></td><td><code>tarball update</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b\">6ee3113</a></td><td><code>doctests for trac 28620, 30304, 30786</code></td></tr></table>\n",
    "created_at": "2021-01-24T21:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610376",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
**Branch pushed to git repo; I updated commit sha1. This was a forced push.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9d747fc169e04f78dc9d1ba8e13c4e09f162d3a6">9d747fc</a></td><td><code>sage --package update-latest: Distinguish pypi package name and spkg name</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f74f66c31a358b3ff5dd2381ce4b7c1f5899858d">f74f66c</a></td><td><code>sage --package update-latest: Accept package classes :standard:, :optional: etc., restrict to normal Python packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/182b3d22106e206a95d9ffbf2104f5c2a32dd3b5">182b3d2</a></td><td><code>sage -package fix-checksum: Handle package classes, ignore non-normal packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9a57cf605cfab70a449b8a86ca2ac87f7f7d9a07">9a57cf6</a></td><td><code>pynac update</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/563940e8554fe96a16fdf669c03f895aacf27b3c">563940e</a></td><td><code>doctest from #30446</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51def3cc9203861a11404019d68ed90937d9f017">51def3c</a></td><td><code>sane version name</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4834dc8a7ab300c57921986e847972030b0547ca">4834dc8</a></td><td><code>remove upstreamed patch</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/214712de4fd44f9e703cfffc7cccced7b5757a12">214712d</a></td><td><code>tarball update</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b">6ee3113</a></td><td><code>doctests for trac 28620, 30304, 30786</code></td></tr></table>




---

archive/issue_comments_610377.json:
```json
{
    "body": "**Changing commit** from \"[4a5d0536a91fd3ef538c3430e3b668c75272225d](https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d)\" to \"[6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)\".",
    "created_at": "2021-01-24T21:57:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610377",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4a5d0536a91fd3ef538c3430e3b668c75272225d](https://github.com/sagemath/sagetrac-mirror/commit/4a5d0536a91fd3ef538c3430e3b668c75272225d)" to "[6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)".



---

archive/issue_comments_610378.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2021-01-24T22:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610378",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_comments_610379.json:
```json
{
    "body": "**Changing reviewer** from \"Travis Scrimshaw\" to \"Travis Scrimshaw, Dima Pasechnik\".",
    "created_at": "2021-01-24T22:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610379",
    "user": "https://github.com/dimpase"
}
```

**Changing reviewer** from "Travis Scrimshaw" to "Travis Scrimshaw, Dima Pasechnik".



---

archive/issue_comments_610380.json:
```json
{
    "body": "<a id='comment:11'></a>\nOK, done",
    "created_at": "2021-01-24T22:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610380",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:11'></a>
OK, done



---

archive/issue_comments_610381.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2021-03-09T00:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610381",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_610382.json:
```json
{
    "body": "**Changing branch** from \"[public/30786](https://github.com/sagemath/sagetrac-mirror/tree/public/30786)\" to \"[6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)\".",
    "created_at": "2021-03-09T00:00:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30786#issuecomment-610382",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/30786](https://github.com/sagemath/sagetrac-mirror/tree/public/30786)" to "[6ee3113a288a36519ed1a4b0adbd19250404874b](https://github.com/sagemath/sagetrac-mirror/commit/6ee3113a288a36519ed1a4b0adbd19250404874b)".



---

archive/issue_events_090452.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30786",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30786#event-90452"
}
```
