# Issue 30871: Relaxed p-adics

archive/issues_030871.json:
```json
{
    "body": "CC:  tristanvaccon @thibautverron @roed314 @saraedum\n\nWe propose an implementation of exact p-adic numbers relaying on relaxed arithmetics proposed by van der Hoeven and al.\n\nHere is a small demo:\n\n```\n    The model for relaxed `p`-adics is quite different from any of the\n    other types of `p`-adics. In addition to storing a finite\n    approximation, one also stores a method for increasing the\n    precision.\n\n    Relaxed `p`-adic rings are created by the constructor :func:`ZpER`::\n\n        sage: R = ZpER(5, print_mode=\"digits\")\n        sage: R\n        5-adic Ring handled with relaxed arithmetics\n\n    The precision is not capped in `R`::\n\n        sage: R.precision_cap()\n        +Infinity\n\n    However, a default precision is fixed. This is the precision\n    at which the elements will be printed::\n\n        sage: R.default_prec()\n        20\n\n    A default halting precision is also set. It is the default absolute\n    precision at which the elements will be compared. By default, it is\n    twice the default precision::\n\n        sage: R.halting_prec()\n        40\n\n    However, both the default precision and the halting precision can be\n    customized at the creation of the parent as follows:\n\n        sage: S = ZpER(5, prec=10, halt=100)\n        sage: S.default_prec()\n        10\n        sage: S.halting_prec()\n        100\n\n    One creates elements as usual::\n\n        sage: a = R(17/42)\n        sage: a\n        ...00244200244200244201\n\n        sage: R.random_element()  # random\n        ...21013213133412431402\n\n    Here we notice that 20 digits (that is the default precision) are printed.\n    However, the computation model is designed in order to guarantee that more\n    digits of `a` will be available on demand.\n    This feature is reflected by the fact that, when we ask for the precision\n    of `a`, the software answers `+\\infty`::\n\n        sage: a.precision_absolute()\n        +Infinity\n\n    Asking for more digits is achieved by the methods :meth:`at_precision_absolute`\n    and :meth:`at_precision_relative`::\n\n        sage: a.at_precision_absolute(30)\n        ...?244200244200244200244200244201\n\n    As a shortcut, one can use the bracket operator::\n\n        sage: a[:30]\n        ...?244200244200244200244200244201\n\n    Of course, standard operations are supported::\n\n        sage: b = R(42/17)\n        sage: a + b\n        ...03232011214322140002\n        sage: a - b\n        ...42311334324023403400\n        sage: a * b\n        ...00000000000000000001\n        sage: a / b\n        ...12442142113021233401\n        sage: sqrt(a)\n        ...20042333114021142101\n\n    We observe again that only 20 digits are printed but, as before,\n    more digits are available on demand::\n\n        sage: sqrt(a)[:30]\n        ...?142443342120042333114021142101\n\n    .. RUBRIC:: Equality tests\n\n    Checking equalities between relaxed `p`-adics is a bit subtle and can\n    sometimes be puzzling at first glance.\n\n    When the parent is created with ``secure=False`` (which is the\n    default), elements are compared at the current precision, or at the\n    default halting precision if it is higher::\n\n        sage: a == b\n        False\n\n        sage: a == sqrt(a)^2\n        True\n        sage: a == sqrt(a)^2 + 5^50\n        True\n\n    In the above example, the halting precision is `40`; it is the\n    reason why a congruence modulo `5^50` is considered as an equality.\n    However, if both sides of the equalities have been previously\n    computed with more digits, those digits are taken into account.\n    Hence comparing two elements at different times can produce\n    different results::\n\n        sage: aa = sqrt(a)^2 + 5^50\n        sage: a == aa\n        True\n        sage: a[:60]\n        ...?244200244200244200244200244200244200244200244200244200244201\n        sage: aa[:60]\n        ...?244200244300244200244200244200244200244200244200244200244201\n        sage: a == aa\n        False\n\n    This annoying situation, where the output of `a == aa` may change\n    depending on previous computations, cannot occur when the parent is\n    created with ``secure=True``.\n    Indeed, in this case, if the equality cannot be decided, an error\n    is raised::\n\n        sage: S = ZpER(5, secure=True)\n        sage: u = S.random_element()\n        sage: uu = u + 5^50\n        sage: u == uu\n        Traceback (most recent call last):\n        ...\n        PrecisionError: unable to decide equality; try to bound precision\n\n        sage: u[:60] == uu\n        False\n\n    .. RUBRIC:: Self-referent numbers\n\n    A quite interesting feature with relaxed `p`-adics is the possibility to\n    create (in some cases) self-referent numbers. Here is an example.\n    We first declare a new variable as follows::\n\n        sage: x = R.unknown()\n        sage: x\n        ...?.0\n\n    We then use the method :meth:`set` to define `x` by writing down an equation\n    it satisfies::\n\n        sage: x.set(1 + 5*x^2)\n        True\n\n    The variable `x` now contains the unique solution of the equation\n    `x = 1 + 5 x^2`::\n\n        sage: x\n        ...04222412141121000211\n\n    This works because the `n`-th digit of the right hand size of the\n    defining equation only involves the `i`-th digits of `x` with `i < n`\n    (this is due to the factor `5`).\n\n    As a comparison, the following does not work::\n\n        sage: y = R.unknown()\n        sage: y.set(1 + 3*y^2)\n        True\n        sage: y\n        ...?.0\n        sage: y[:20]\n        Traceback (most recent call last):\n        ...\n        RecursionError: definition looks circular\n\n    Self-referent definitions also work with systems of equations::\n\n        sage: u = R.unknown()\n        sage: v = R.unknown()\n        sage: w = R.unknown()\n\n        sage: u.set(1 + 2*v + 3*w^2 + 5*u*v*w)\n        True\n        sage: v.set(2 + 4*w + sqrt(1 + 5*u + 10*v + 15*w))\n        True\n        sage: w.set(3 + 25*(u*v + v*w + u*w))\n        True\n\n        sage: u\n        ...31203130103131131433\n        sage: v\n        ...33441043031103114240\n        sage: w\n        ...30212422041102444403\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/31108\n\n",
    "closed_at": "2021-05-27T20:30:03Z",
    "created_at": "2020-12-25T20:42:30Z",
    "labels": [
        "component: padics"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.4",
    "title": "Relaxed p-adics",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30871",
    "user": "https://github.com/xcaruso"
}
```
CC:  tristanvaccon @thibautverron @roed314 @saraedum

We propose an implementation of exact p-adic numbers relaying on relaxed arithmetics proposed by van der Hoeven and al.

Here is a small demo:

```
    The model for relaxed `p`-adics is quite different from any of the
    other types of `p`-adics. In addition to storing a finite
    approximation, one also stores a method for increasing the
    precision.

    Relaxed `p`-adic rings are created by the constructor :func:`ZpER`::

        sage: R = ZpER(5, print_mode="digits")
        sage: R
        5-adic Ring handled with relaxed arithmetics

    The precision is not capped in `R`::

        sage: R.precision_cap()
        +Infinity

    However, a default precision is fixed. This is the precision
    at which the elements will be printed::

        sage: R.default_prec()
        20

    A default halting precision is also set. It is the default absolute
    precision at which the elements will be compared. By default, it is
    twice the default precision::

        sage: R.halting_prec()
        40

    However, both the default precision and the halting precision can be
    customized at the creation of the parent as follows:

        sage: S = ZpER(5, prec=10, halt=100)
        sage: S.default_prec()
        10
        sage: S.halting_prec()
        100

    One creates elements as usual::

        sage: a = R(17/42)
        sage: a
        ...00244200244200244201

        sage: R.random_element()  # random
        ...21013213133412431402

    Here we notice that 20 digits (that is the default precision) are printed.
    However, the computation model is designed in order to guarantee that more
    digits of `a` will be available on demand.
    This feature is reflected by the fact that, when we ask for the precision
    of `a`, the software answers `+\infty`::

        sage: a.precision_absolute()
        +Infinity

    Asking for more digits is achieved by the methods :meth:`at_precision_absolute`
    and :meth:`at_precision_relative`::

        sage: a.at_precision_absolute(30)
        ...?244200244200244200244200244201

    As a shortcut, one can use the bracket operator::

        sage: a[:30]
        ...?244200244200244200244200244201

    Of course, standard operations are supported::

        sage: b = R(42/17)
        sage: a + b
        ...03232011214322140002
        sage: a - b
        ...42311334324023403400
        sage: a * b
        ...00000000000000000001
        sage: a / b
        ...12442142113021233401
        sage: sqrt(a)
        ...20042333114021142101

    We observe again that only 20 digits are printed but, as before,
    more digits are available on demand::

        sage: sqrt(a)[:30]
        ...?142443342120042333114021142101

    .. RUBRIC:: Equality tests

    Checking equalities between relaxed `p`-adics is a bit subtle and can
    sometimes be puzzling at first glance.

    When the parent is created with ``secure=False`` (which is the
    default), elements are compared at the current precision, or at the
    default halting precision if it is higher::

        sage: a == b
        False

        sage: a == sqrt(a)^2
        True
        sage: a == sqrt(a)^2 + 5^50
        True

    In the above example, the halting precision is `40`; it is the
    reason why a congruence modulo `5^50` is considered as an equality.
    However, if both sides of the equalities have been previously
    computed with more digits, those digits are taken into account.
    Hence comparing two elements at different times can produce
    different results::

        sage: aa = sqrt(a)^2 + 5^50
        sage: a == aa
        True
        sage: a[:60]
        ...?244200244200244200244200244200244200244200244200244200244201
        sage: aa[:60]
        ...?244200244300244200244200244200244200244200244200244200244201
        sage: a == aa
        False

    This annoying situation, where the output of `a == aa` may change
    depending on previous computations, cannot occur when the parent is
    created with ``secure=True``.
    Indeed, in this case, if the equality cannot be decided, an error
    is raised::

        sage: S = ZpER(5, secure=True)
        sage: u = S.random_element()
        sage: uu = u + 5^50
        sage: u == uu
        Traceback (most recent call last):
        ...
        PrecisionError: unable to decide equality; try to bound precision

        sage: u[:60] == uu
        False

    .. RUBRIC:: Self-referent numbers

    A quite interesting feature with relaxed `p`-adics is the possibility to
    create (in some cases) self-referent numbers. Here is an example.
    We first declare a new variable as follows::

        sage: x = R.unknown()
        sage: x
        ...?.0

    We then use the method :meth:`set` to define `x` by writing down an equation
    it satisfies::

        sage: x.set(1 + 5*x^2)
        True

    The variable `x` now contains the unique solution of the equation
    `x = 1 + 5 x^2`::

        sage: x
        ...04222412141121000211

    This works because the `n`-th digit of the right hand size of the
    defining equation only involves the `i`-th digits of `x` with `i < n`
    (this is due to the factor `5`).

    As a comparison, the following does not work::

        sage: y = R.unknown()
        sage: y.set(1 + 3*y^2)
        True
        sage: y
        ...?.0
        sage: y[:20]
        Traceback (most recent call last):
        ...
        RecursionError: definition looks circular

    Self-referent definitions also work with systems of equations::

        sage: u = R.unknown()
        sage: v = R.unknown()
        sage: w = R.unknown()

        sage: u.set(1 + 2*v + 3*w^2 + 5*u*v*w)
        True
        sage: v.set(2 + 4*w + sqrt(1 + 5*u + 10*v + 15*w))
        True
        sage: w.set(3 + 25*(u*v + v*w + u*w))
        True

        sage: u
        ...31203130103131131433
        sage: v
        ...33441043031103114240
        sage: w
        ...30212422041102444403
```

Issue created by migration from https://trac.sagemath.org/ticket/31108





---

archive/issue_comments_440694.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-26T07:46:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440694",
    "user": "https://github.com/xcaruso"
}
```

New commits:



---

archive/issue_comments_440695.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-26T09:41:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440695",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440696.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-29T20:42:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440696",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440697.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-12-29T20:54:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440697",
    "user": "https://github.com/xcaruso"
}
```

New commits:



---

archive/issue_comments_440698.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-02T23:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440698",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440699.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-04T14:08:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440699",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440700.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-04T22:01:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440700",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440701.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-04T22:46:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440701",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440702.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-05T09:27:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440702",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440703.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-05T23:22:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440703",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440704.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T08:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440704",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440705.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T08:30:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440705",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440706.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T19:26:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440706",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440707.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-06T23:20:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440707",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440708.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-08T13:52:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440708",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440709.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-11T00:49:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440709",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440710.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-11T15:22:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440710",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440711.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-24T10:21:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440711",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440712.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-26T13:37:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440712",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440713.json:
```json
{
    "body": "A note about operator choice: While the ``@`` notation is definite informative and cute when considered stand-alone, it doesn't fit very well with other places where the operator is used in python. Specifically, the operator was introduced upon request of the numpy people, to signify matrix multiplication. With that in mind ``@`` has a rather strong association with (function) composition (which, in a specific way, is also how you could read ``@`` decorators to function definitions).\n\nThere's a reasonable chance that ``@`` will at some point be integrated in the coercion framework. The use for ``@`` proposed here will cause problems. I'd suggest just using a named method to cap precision.\n\nOtherwise, this package looks really cool! It would be great to see some performance specs at some point.",
    "created_at": "2021-01-26T17:53:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440713",
    "user": "https://github.com/nbruin"
}
```

A note about operator choice: While the ``@`` notation is definite informative and cute when considered stand-alone, it doesn't fit very well with other places where the operator is used in python. Specifically, the operator was introduced upon request of the numpy people, to signify matrix multiplication. With that in mind ``@`` has a rather strong association with (function) composition (which, in a specific way, is also how you could read ``@`` decorators to function definitions).

There's a reasonable chance that ``@`` will at some point be integrated in the coercion framework. The use for ``@`` proposed here will cause problems. I'd suggest just using a named method to cap precision.

Otherwise, this package looks really cool! It would be great to see some performance specs at some point.



---

archive/issue_comments_440714.json:
```json
{
    "body": "I'm a bit disappointed but I note your argument for ``@`` and will probably disallow this construction.\n\nAbout performances, it's of course not as fast as other types of p-adics but I would say that it's already reasonable (although optimizations are still possible):\n\n```\n    sage: R = ZpL(5)\n    sage: a = R.random_element()\n    sage: b = R.random_element()\n    sage: c = 1 + 5*R.random_element()\n    sage: %timeit _ = (a + b)@10000\n    848 \u00b5s \u00b1 614 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n    sage: %timeit _ = (a * b)@10000\n    9.59 ms \u00b1 116 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n    sage: %timeit _ = (a / b)@10000\n    11.7 ms \u00b1 215 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n    sage: %timeit _ = c.sqrt()@10000\n    13.7 ms \u00b1 240 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n```\n\nCompare with:\n\n```\n    sage: R = Zp(5, prec=10000)\n    sage: a = R.random_element()\n    sage: b = R.random_element()\n    sage: c = 1 + 5*R.random_element()\n    sage: %timeit _ = a + b\n    1.21 \u00b5s \u00b1 9.2 ns per loop (mean \u00b1 std. dev. of 7 runs, 1000000 loops each)\n    sage: %timeit _ = a * b\n    87.8 \u00b5s \u00b1 130 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n    sage: %timeit _ = a / b\n    667 \u00b5s \u00b1 4.08 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 1000 loops each)\n    sage: %timeit _ = c.sqrt()\n    27.4 ms \u00b1 125 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nEDIT: use `%timeit` instead of `%time`",
    "created_at": "2021-01-26T18:47:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440714",
    "user": "https://github.com/xcaruso"
}
```

I'm a bit disappointed but I note your argument for ``@`` and will probably disallow this construction.

About performances, it's of course not as fast as other types of p-adics but I would say that it's already reasonable (although optimizations are still possible):

```
    sage: R = ZpL(5)
    sage: a = R.random_element()
    sage: b = R.random_element()
    sage: c = 1 + 5*R.random_element()
    sage: %timeit _ = (a + b)@10000
    848 µs ± 614 ns per loop (mean ± std. dev. of 7 runs, 1000 loops each)
    sage: %timeit _ = (a * b)@10000
    9.59 ms ± 116 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
    sage: %timeit _ = (a / b)@10000
    11.7 ms ± 215 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
    sage: %timeit _ = c.sqrt()@10000
    13.7 ms ± 240 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
```

Compare with:

```
    sage: R = Zp(5, prec=10000)
    sage: a = R.random_element()
    sage: b = R.random_element()
    sage: c = 1 + 5*R.random_element()
    sage: %timeit _ = a + b
    1.21 µs ± 9.2 ns per loop (mean ± std. dev. of 7 runs, 1000000 loops each)
    sage: %timeit _ = a * b
    87.8 µs ± 130 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
    sage: %timeit _ = a / b
    667 µs ± 4.08 µs per loop (mean ± std. dev. of 7 runs, 1000 loops each)
    sage: %timeit _ = c.sqrt()
    27.4 ms ± 125 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

EDIT: use `%timeit` instead of `%time`



---

archive/issue_comments_440715.json:
```json
{
    "body": "Maybe some comments on the timings.\nThe \"bad\" performances of lazy p-adic come from two different sources:\n- the underlying arithmetics looses a factor log(precision) in the complexity\n- I'm working on digits, which means that I basically only manipulate integers between 0 and p (here p=5) and encode them on longs.\n\nAlthough I cannot do much to get rid of the first problem, I can certainly do something for the second one: instead of working with digits, I can work with blocks of digits (limbs) of the correct size. Actually, I want to do this but this requires many changes in my current code and I planned to delay this for another ticket.\n\nIn any case, when p becomes larger, the differences of performances between lazy p-adics and classical p-adics tend to get smaller.\n\n```\n    sage: p = next_prime(2^63)\n    sage: R = ZpL(p)\n\n    sage: a = R.random_element()\n    sage: b = R.random_element()\n    sage: c = 1 + p*R.random_element()\n    sage: %timeit _ = (a + b)@10000\n    3.51 ms \u00b1 407 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n    sage: %timeit _ = (a * b)@10000\n    73.7 ms \u00b1 189 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n    sage: %timeit _ = (a / b)@10000\n    83.4 ms \u00b1 471 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n    sage: %timeit _ = c.sqrt()@10000\n    160 ms \u00b1 3.31 ms per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n```\n\nand:\n\n```\n    sage: p = next_prime(2^63)\n    sage: R = Zp(p, prec=10000)\n\n    sage: a = R.random_element()\n    sage: b = R.random_element()\n    sage: c = 1 + p*R.random_element()\n    sage: %timeit _ = a + b\n    86.4 \u00b5s \u00b1 578 ns per loop (mean \u00b1 std. dev. of 7 runs, 10000 loops each)\n    sage: %timeit _ = a * b\n    9.04 ms \u00b1 63.9 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 100 loops each)\n    sage: %timeit _ = a / b\n    78.8 ms \u00b1 415 \u00b5s per loop (mean \u00b1 std. dev. of 7 runs, 10 loops each)\n    sage: %timeit _ = c.sqrt()\n    672 ms \u00b1 1.23 ms per loop (mean \u00b1 std. dev. of 7 runs, 1 loop each)\n```",
    "created_at": "2021-01-26T20:01:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440715",
    "user": "https://github.com/xcaruso"
}
```

Maybe some comments on the timings.
The "bad" performances of lazy p-adic come from two different sources:
- the underlying arithmetics looses a factor log(precision) in the complexity
- I'm working on digits, which means that I basically only manipulate integers between 0 and p (here p=5) and encode them on longs.

Although I cannot do much to get rid of the first problem, I can certainly do something for the second one: instead of working with digits, I can work with blocks of digits (limbs) of the correct size. Actually, I want to do this but this requires many changes in my current code and I planned to delay this for another ticket.

In any case, when p becomes larger, the differences of performances between lazy p-adics and classical p-adics tend to get smaller.

```
    sage: p = next_prime(2^63)
    sage: R = ZpL(p)

    sage: a = R.random_element()
    sage: b = R.random_element()
    sage: c = 1 + p*R.random_element()
    sage: %timeit _ = (a + b)@10000
    3.51 ms ± 407 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
    sage: %timeit _ = (a * b)@10000
    73.7 ms ± 189 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
    sage: %timeit _ = (a / b)@10000
    83.4 ms ± 471 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
    sage: %timeit _ = c.sqrt()@10000
    160 ms ± 3.31 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)
```

and:

```
    sage: p = next_prime(2^63)
    sage: R = Zp(p, prec=10000)

    sage: a = R.random_element()
    sage: b = R.random_element()
    sage: c = 1 + p*R.random_element()
    sage: %timeit _ = a + b
    86.4 µs ± 578 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)
    sage: %timeit _ = a * b
    9.04 ms ± 63.9 µs per loop (mean ± std. dev. of 7 runs, 100 loops each)
    sage: %timeit _ = a / b
    78.8 ms ± 415 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)
    sage: %timeit _ = c.sqrt()
    672 ms ± 1.23 ms per loop (mean ± std. dev. of 7 runs, 1 loop each)
```



---

archive/issue_comments_440716.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-28T23:45:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440716",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440717.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-30T16:08:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440717",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440718.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-01-31T08:40:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440718",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440719.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T00:19:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440719",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440720.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T11:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440720",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440721.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-11T15:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440721",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440722.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-11T15:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440722",
    "user": "https://github.com/xcaruso"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_440723.json:
```json
{
    "body": "I guess that the ticket is ready for a first review...",
    "created_at": "2021-02-11T15:12:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440723",
    "user": "https://github.com/xcaruso"
}
```

I guess that the ticket is ready for a first review...



---

archive/issue_comments_440724.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-02-18T22:26:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440724",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440725.json:
```json
{
    "body": "Some issues that we talked about on video:\n\n* Add some halting parameters to the parent\n* Inconsistency with valuation and set method.  Add a check parameter to `set` to ensure that the element satisfies the given equation (even with provided valuation and/or digits) or have `set` return `True` or `False` depending on whether the equation is satisfied.\n* Figure out segfaults in gcd computations, conversions\n* Change `selfref` to `unknown`\n\nFor another ticket: add more transcendental functions like `exp` and `log`",
    "created_at": "2021-02-18T22:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440725",
    "user": "https://github.com/roed314"
}
```

Some issues that we talked about on video:

* Add some halting parameters to the parent
* Inconsistency with valuation and set method.  Add a check parameter to `set` to ensure that the element satisfies the given equation (even with provided valuation and/or digits) or have `set` return `True` or `False` depending on whether the equation is satisfied.
* Figure out segfaults in gcd computations, conversions
* Change `selfref` to `unknown`

For another ticket: add more transcendental functions like `exp` and `log`



---

archive/issue_comments_440726.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2021-02-18T22:29:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440726",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_440727.json:
```json
{
    "body": "More comments as I read through the code.\n\n* In `digit_smallest` you call `fmpz_init` but not `fmpz_clear`.  I think this is a memory leak.  I may have missed other leaks....  I also think that the documentation of `digit_smallest` should clarify that the input should already be in the range `0..p-1`.\n* For `digit_sqrt` it may be worth using FLINT's `n_sqrtmod` if `p` is word-size.  You could also do some other easy cases in-line rather than calling out to Sage's integer_mod code.  See `square_root_mod_prime` in `sage/rings/finite_rings/integer_mod.pyx`.\n* You should add documentation to `sage/misc/persist.pyx` on how `already_pickled` and `already_unpickled` are intended to work, and some tests to check that it's working correctly.\n* When converting an element between a lazy p-adic ring and its field of fractions it looks in `_element_constructor_` that you create a bounded element.  Why is this necessary?  It also looks like you don't check that the primes are the same....\n* The error codes in `padic_lazy_error.pyx` and `next_c()` aren't the same.\n* In `_repr_` it looks like some print modes aren't included (e.g. `terse` and `val-unit`).  I would guess it to be easier to use code from `padic_printing.pyx` here.\n* Last week we talked about adding some parameters about how halting is handled (e.g. a strict mode that raises an error whenever unbounded elements are compared).  `__nonzero__` should also be updated.  I think the precision behavior for `__nonzero__` should be the same as for `== 0`; currently it will return `True` rather than raising a precision error if it looks like `0` at known precision.\n* I found the use of `permissive=None` a bit strange in `at_precision_absolute`.  I think if a user specifies infinite precision, `permissive` should be treated as `False` (so, replace `if permissive is False` with `if not permissive`.\n* Shouldn't `at_precision_relative` also support `prec=infinity`?\n* You can probably remove some code by changing `if error: raise_error(error)` to just `raise_error(error)` since this has no effect if error is 0.\n* `_sub_` has a bug: currently `0-1` will give `1`.\n\nMore comments to come....",
    "created_at": "2021-02-25T20:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440727",
    "user": "https://github.com/roed314"
}
```

More comments as I read through the code.

* In `digit_smallest` you call `fmpz_init` but not `fmpz_clear`.  I think this is a memory leak.  I may have missed other leaks....  I also think that the documentation of `digit_smallest` should clarify that the input should already be in the range `0..p-1`.
* For `digit_sqrt` it may be worth using FLINT's `n_sqrtmod` if `p` is word-size.  You could also do some other easy cases in-line rather than calling out to Sage's integer_mod code.  See `square_root_mod_prime` in `sage/rings/finite_rings/integer_mod.pyx`.
* You should add documentation to `sage/misc/persist.pyx` on how `already_pickled` and `already_unpickled` are intended to work, and some tests to check that it's working correctly.
* When converting an element between a lazy p-adic ring and its field of fractions it looks in `_element_constructor_` that you create a bounded element.  Why is this necessary?  It also looks like you don't check that the primes are the same....
* The error codes in `padic_lazy_error.pyx` and `next_c()` aren't the same.
* In `_repr_` it looks like some print modes aren't included (e.g. `terse` and `val-unit`).  I would guess it to be easier to use code from `padic_printing.pyx` here.
* Last week we talked about adding some parameters about how halting is handled (e.g. a strict mode that raises an error whenever unbounded elements are compared).  `__nonzero__` should also be updated.  I think the precision behavior for `__nonzero__` should be the same as for `== 0`; currently it will return `True` rather than raising a precision error if it looks like `0` at known precision.
* I found the use of `permissive=None` a bit strange in `at_precision_absolute`.  I think if a user specifies infinite precision, `permissive` should be treated as `False` (so, replace `if permissive is False` with `if not permissive`.
* Shouldn't `at_precision_relative` also support `prec=infinity`?
* You can probably remove some code by changing `if error: raise_error(error)` to just `raise_error(error)` since this has no effect if error is 0.
* `_sub_` has a bug: currently `0-1` will give `1`.

More comments to come....



---

archive/issue_comments_440728.json:
```json
{
    "body": "* In `next_c()` for random elements, do you need to `digit_clear(r)` in both branches of the if statement?\n* It would be good to have some tests for slices of slices.\n* In `next_c()` for `LazyElement_div`, if `definition is None` and you set it, don't you still want to execute the `else` clause?  If not, you can just `return self._bootstrap_c()` rather than `if error: return error`.  Same for `LazyElement_sqrt`.\n* In the `__init__` method for `LazyElement_sqrt`, shouldn't you check that the valuation is even?\n* You should probably delete the `next` method on `LazyElement_sqrt` (I assume it was for debugging; it's not documented).",
    "created_at": "2021-02-26T08:42:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440728",
    "user": "https://github.com/roed314"
}
```

* In `next_c()` for random elements, do you need to `digit_clear(r)` in both branches of the if statement?
* It would be good to have some tests for slices of slices.
* In `next_c()` for `LazyElement_div`, if `definition is None` and you set it, don't you still want to execute the `else` clause?  If not, you can just `return self._bootstrap_c()` rather than `if error: return error`.  Same for `LazyElement_sqrt`.
* In the `__init__` method for `LazyElement_sqrt`, shouldn't you check that the valuation is even?
* You should probably delete the `next` method on `LazyElement_sqrt` (I assume it was for debugging; it's not documented).



---

archive/issue_comments_440729.json:
```json
{
    "body": "Replying to [comment:36 roed] and [comment:37 roed]:\n> * In `digit_smallest` you call `fmpz_init` but not `fmpz_clear`.  I think this is a memory leak.  I may have missed other leaks....  I also think that the documentation of `digit_smallest` should clarify that the input should already be in the range `0..p-1`.\n> * You should add documentation to `sage/misc/persist.pyx` on how `already_pickled` and `already_unpickled` are intended to work, and some tests to check that it's working correctly.\n> * The error codes in `padic_lazy_error.pyx` and `next_c()` aren't the same.\n> * I found the use of `permissive=None` a bit strange in `at_precision_absolute`.  I think if a user specifies infinite precision, `permissive` should be treated as `False` (so, replace `if permissive is False` with `if not permissive`.\n> * Shouldn't `at_precision_relative` also support `prec=infinity`?\n> * You can probably remove some code by changing `if error: raise_error(error)` to just `raise_error(error)` since this has no effect if error is 0.\n> * `_sub_` has a bug: currently `0-1` will give `1`.\n> * In `next_c()` for random elements, do you need to `digit_clear(r)` in both branches of the if statement?\n> * It would be good to have some tests for slices of slices.\n> * You should probably delete the `next` method on `LazyElement_sqrt` (I assume it was for debugging; it's not documented).\n\n\nFixed.\n\n> * In `_repr_` it looks like some print modes aren't included (e.g. `terse` and `val-unit`).  I would guess it to be easier to use code from `padic_printing.pyx` here.\n\n\nThey are included.\nI agree that we should include this code in `padic_printing.pyx` but it does not sounds easy.\n\n> * When converting an element between a lazy p-adic ring and its field of fractions it looks in `_element_constructor_` that you create a bounded element.  Why is this necessary?  It also looks like you don't check that the primes are the same....\n\n\nIt's true than I call `LazyElement_bound` but I pass in `boundprec=maxordp` so that the resulting element remains unbounded. It's a convenient way to do copies. (I cannot return the same element because the parent changes.)\n\n> * In `next_c()` for `LazyElement_div`, if `definition is None` and you set it, don't you still want to execute the `else` clause?  If not, you can just `return self._bootstrap_c()` rather than `if error: return error`.  Same for `LazyElement_sqrt`.\n\n\nWell, `_bootstrap_c` already computes the first significant digit, so I think it's fine like this. I changed `if error: return error` to `return self._bootstrap_c()`.\n\n> * In the `__init__` method for `LazyElement_sqrt`, shouldn't you check that the valuation is even?\n\n\nIt's checked in the bootstrap function.\nI think we cannot check it in the `__init__` method because the valuation might be not known for self-referent numbers.\n\n---\nNew commits:",
    "created_at": "2021-03-04T21:57:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440729",
    "user": "https://github.com/xcaruso"
}
```

Replying to [comment:36 roed] and [comment:37 roed]:
> * In `digit_smallest` you call `fmpz_init` but not `fmpz_clear`.  I think this is a memory leak.  I may have missed other leaks....  I also think that the documentation of `digit_smallest` should clarify that the input should already be in the range `0..p-1`.
> * You should add documentation to `sage/misc/persist.pyx` on how `already_pickled` and `already_unpickled` are intended to work, and some tests to check that it's working correctly.
> * The error codes in `padic_lazy_error.pyx` and `next_c()` aren't the same.
> * I found the use of `permissive=None` a bit strange in `at_precision_absolute`.  I think if a user specifies infinite precision, `permissive` should be treated as `False` (so, replace `if permissive is False` with `if not permissive`.
> * Shouldn't `at_precision_relative` also support `prec=infinity`?
> * You can probably remove some code by changing `if error: raise_error(error)` to just `raise_error(error)` since this has no effect if error is 0.
> * `_sub_` has a bug: currently `0-1` will give `1`.
> * In `next_c()` for random elements, do you need to `digit_clear(r)` in both branches of the if statement?
> * It would be good to have some tests for slices of slices.
> * You should probably delete the `next` method on `LazyElement_sqrt` (I assume it was for debugging; it's not documented).


Fixed.

> * In `_repr_` it looks like some print modes aren't included (e.g. `terse` and `val-unit`).  I would guess it to be easier to use code from `padic_printing.pyx` here.


They are included.
I agree that we should include this code in `padic_printing.pyx` but it does not sounds easy.

> * When converting an element between a lazy p-adic ring and its field of fractions it looks in `_element_constructor_` that you create a bounded element.  Why is this necessary?  It also looks like you don't check that the primes are the same....


It's true than I call `LazyElement_bound` but I pass in `boundprec=maxordp` so that the resulting element remains unbounded. It's a convenient way to do copies. (I cannot return the same element because the parent changes.)

> * In `next_c()` for `LazyElement_div`, if `definition is None` and you set it, don't you still want to execute the `else` clause?  If not, you can just `return self._bootstrap_c()` rather than `if error: return error`.  Same for `LazyElement_sqrt`.


Well, `_bootstrap_c` already computes the first significant digit, so I think it's fine like this. I changed `if error: return error` to `return self._bootstrap_c()`.

> * In the `__init__` method for `LazyElement_sqrt`, shouldn't you check that the valuation is even?


It's checked in the bootstrap function.
I think we cannot check it in the `__init__` method because the valuation might be not known for self-referent numbers.

---
New commits:



---

archive/issue_comments_440730.json:
```json
{
    "body": "And here the comments I have not addressed yet:\n\n> * Last week we talked about adding some parameters about how halting is handled (e.g. a strict mode that raises an error whenever unbounded elements are compared).  `__nonzero__` should also be updated.  I think the precision behavior for `__nonzero__` should be the same as for `== 0`; currently it will return `True` rather than raising a precision error if it looks like `0` at known precision.\n> * Inconsistency with valuation and set method.  Add a check parameter to `set` to ensure that the element satisfies the given equation (even with provided valuation and/or digits) or have `set` return `True` or `False` depending on whether the equation is satisfied.\n> * Figure out segfaults in gcd computations, conversions\n> * Change `selfref` to `unknown`\n> * For `digit_sqrt` it may be worth using FLINT's `n_sqrtmod` if `p` is word-size.  You could also do some other easy cases in-line rather than calling out to Sage's integer_mod code.  See `square_root_mod_prime` in `sage/rings/finite_rings/integer_mod.pyx`.",
    "created_at": "2021-03-04T22:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440730",
    "user": "https://github.com/xcaruso"
}
```

And here the comments I have not addressed yet:

> * Last week we talked about adding some parameters about how halting is handled (e.g. a strict mode that raises an error whenever unbounded elements are compared).  `__nonzero__` should also be updated.  I think the precision behavior for `__nonzero__` should be the same as for `== 0`; currently it will return `True` rather than raising a precision error if it looks like `0` at known precision.
> * Inconsistency with valuation and set method.  Add a check parameter to `set` to ensure that the element satisfies the given equation (even with provided valuation and/or digits) or have `set` return `True` or `False` depending on whether the equation is satisfied.
> * Figure out segfaults in gcd computations, conversions
> * Change `selfref` to `unknown`
> * For `digit_sqrt` it may be worth using FLINT's `n_sqrtmod` if `p` is word-size.  You could also do some other easy cases in-line rather than calling out to Sage's integer_mod code.  See `square_root_mod_prime` in `sage/rings/finite_rings/integer_mod.pyx`.



---

archive/issue_comments_440731.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-03-04T22:01:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440731",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440732.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440732",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_081265.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30871#event-81265"
}
```



---

archive/issue_comments_440733.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-01T22:38:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440733",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440734.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T18:46:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440734",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440735.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-04T19:50:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440735",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440736.json:
```json
{
    "body": "I think that all your comments have been addressed now.\n\nWe still need to discuss the choice of the name for the classes implemented in this ticket (cf discussion on zulip).",
    "created_at": "2021-04-04T19:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440736",
    "user": "https://github.com/xcaruso"
}
```

I think that all your comments have been addressed now.

We still need to discuss the choice of the name for the classes implemented in this ticket (cf discussion on zulip).



---

archive/issue_comments_440737.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2021-04-04T19:52:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440737",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_440738.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-07T09:16:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440738",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440739.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-22T20:58:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440739",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440740.json:
```json
{
    "body": "I changed the naming (`Relaxed` instead of `Lazy`, `ZpER` instead of `ZpL`).\n\nTicket ready for a second review.",
    "created_at": "2021-04-22T21:02:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440740",
    "user": "https://github.com/xcaruso"
}
```

I changed the naming (`Relaxed` instead of `Lazy`, `ZpER` instead of `ZpL`).

Ticket ready for a second review.



---

archive/issue_comments_440741.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-28T12:55:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440741",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440742.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2021-04-28T13:05:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440742",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_440743.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-28T20:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440743",
    "user": "https://github.com/roed314"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440744.json:
```json
{
    "body": "Looks good to me!  I think any additional issues can be addressed in followup tickets.",
    "created_at": "2021-04-28T20:54:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440744",
    "user": "https://github.com/roed314"
}
```

Looks good to me!  I think any additional issues can be addressed in followup tickets.



---

archive/issue_comments_440745.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-04-29T06:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440745",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_440746.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-04-29T06:20:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440746",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_440747.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-04-29T06:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440747",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440748.json:
```json
{
    "body": "Great, thanks!\nI set again the ticket to positive review, I've just fixed two typos.",
    "created_at": "2021-04-29T06:22:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440748",
    "user": "https://github.com/xcaruso"
}
```

Great, thanks!
I set again the ticket to positive review, I've just fixed two typos.



---

archive/issue_comments_440749.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2021-05-01T11:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_440750.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2021-05-01T11:27:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_440751.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-05-01T11:27:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440751",
    "user": "https://github.com/xcaruso"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_440752.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-05-27T20:30:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440752",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_081266.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-05-27T20:30:03Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30871#event-81266"
}
```



---

archive/issue_comments_440753.json:
```json
{
    "body": "Looks like this broke the build --> #31903",
    "created_at": "2021-06-03T22:33:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30871",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30871#issuecomment-440753",
    "user": "https://github.com/mkoeppe"
}
```

Looks like this broke the build --> #31903
