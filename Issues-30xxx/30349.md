# Issue 30349: Downgrade broken optional packages to experimental for Sage 9.2

archive/issues_030112.json:
```json
{
    "assignees": [],
    "body": "see:\n- #29900 Meta-ticket: Fix optional and experimental packages for Sage 9.2\n\nDowngrading two optional packages that fail to build on many platforms, as can be seen in https://github.com/mkoeppe/sage/actions/runs/296478189\n\n\n\nDepends on #28711\n\nCC:  @jhpalmieri @dimpase @slel @simon-king-jena\n\nBranch/Commit: **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**\n\nReviewer: **Dima Pasechnik**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **packages: optional**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30349_\n\n",
    "closed_at": "2020-11-01T00:43:01Z",
    "created_at": "2020-08-13T14:48:19Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Downgrade broken optional packages to experimental for Sage 9.2",
    "type": "issue",
    "updated_at": "2020-11-01T00:43:01Z",
    "url": "https://github.com/sagemath/sage/issues/30349",
    "user": "https://github.com/mkoeppe"
}
```
see:
- #29900 Meta-ticket: Fix optional and experimental packages for Sage 9.2

Downgrading two optional packages that fail to build on many platforms, as can be seen in https://github.com/mkoeppe/sage/actions/runs/296478189



Depends on #28711

CC:  @jhpalmieri @dimpase @slel @simon-king-jena

Branch/Commit: **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**

Reviewer: **Dima Pasechnik**

Author: **Matthias Koeppe**

Component: **packages: optional**

_Issue created by migration from https://trac.sagemath.org/ticket/30349_





---

archive/issue_events_415031.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T14:48:19Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415031"
}
```



---

archive/issue_events_415032.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T14:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20packages%3A%20optional",
    "label_color": "0000b0",
    "label_name": "c: packages: optional",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415032"
}
```



---

archive/issue_events_415033.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T14:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415033"
}
```



---

archive/issue_events_415034.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T14:48:19Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415034"
}
```



---

archive/issue_events_415035.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-03T02:59:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415035"
}
```



---

archive/issue_events_415036.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-03T02:59:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415036"
}
```



---

archive/issue_events_415037.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-08T07:44:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20blocker%20/%201",
    "label_color": "ff0000",
    "label_name": "p: blocker / 1",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415037"
}
```



---

archive/issue_events_415038.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-08T07:44:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415038"
}
```



---

archive/issue_comments_481694.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nI'd say a broken optional package is by definition not a blocker...",
    "created_at": "2020-09-08T07:44:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481694",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:2" align="right">comment:2</div>

I'd say a broken optional package is by definition not a blocker...



---

archive/issue_events_415039.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T15:35:31Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415039"
}
```



---

archive/issue_events_415040.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-09-09T15:35:31Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415040"
}
```



---

archive/issue_comments_481695.json:
```json
{
    "body": "Branch: **[u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2)**",
    "created_at": "2020-10-15T03:54:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481695",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2)**



---

archive/issue_events_415041.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-15T03:55:15Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415041"
}
```



---

archive/issue_comments_481696.json:
```json
{
    "body": "<div id=\"comment:5\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819\"><code>402d45f</code></a></td><td><code>build/pkgs/{deformation,p_group_cohomology}/type: Set to experimental</code></td></tr></table>\n",
    "created_at": "2020-10-15T03:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481696",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819"><code>402d45f</code></a></td><td><code>build/pkgs/{deformation,p_group_cohomology}/type: Set to experimental</code></td></tr></table>




---

archive/issue_comments_481697.json:
```json
{
    "body": "Commit: **[`402d45f`](https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819)**",
    "created_at": "2020-10-15T03:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481697",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`402d45f`](https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819)**



---

archive/issue_comments_481698.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,2 +1,6 @@\n see:\n - #29900 Meta-ticket: Fix optional and experimental packages for Sage 9.2\n+\n+Downgrading two optional packages that fail to build on many platforms, as can be seen in https://github.com/mkoeppe/sage/actions/runs/296478189\n+\n+\n``````\n",
    "created_at": "2020-10-15T03:55:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481698",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,2 +1,6 @@
 see:
 - #29900 Meta-ticket: Fix optional and experimental packages for Sage 9.2
+
+Downgrading two optional packages that fail to build on many platforms, as can be seen in https://github.com/mkoeppe/sage/actions/runs/296478189
+
+
``````




---

archive/issue_comments_481699.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-10-15T03:55:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481699",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_481700.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nSimon, what is the current status of your package?",
    "created_at": "2020-10-15T08:08:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481700",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

Simon, what is the current status of your package?



---

archive/issue_comments_481701.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@dimpase](#comment%3A7):\n> Simon, what is the current status of your package?\n\nI thought that it works. As far as I recall, when I last checked, it did.\n\nAnyway, I plan to give a talk on the package during the next SageDays, so, I am motivated to fix it. Can you tell me what problems arose?",
    "created_at": "2020-10-15T08:25:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481701",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@dimpase](#comment%3A7):
> Simon, what is the current status of your package?

I thought that it works. As far as I recall, when I last checked, it did.

Anyway, I plan to give a talk on the package during the next SageDays, so, I am motivated to fix it. Can you tell me what problems arose?



---

archive/issue_comments_481702.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@simon-king-jena](#comment%3A8):\n> Replying to [@dimpase](#comment%3A7):\n> > Simon, what is the current status of your package?\n\n> \n> I thought that it works. As far as I recall, when I last checked, it did.\n> \n> Anyway, I plan to give a talk on the package during the next SageDays, so, I am motivated to fix it. Can you tell me what problems arose?\n\nPS: By \"my package\", I refer to p_group_cohomology. There is \"my other package\", namely SharedMeatAxe, which is supposed to work and has recently also been fixed on cygwin (see #29152",
    "created_at": "2020-10-15T08:27:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481702",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@simon-king-jena](#comment%3A8):
> Replying to [@dimpase](#comment%3A7):
> > Simon, what is the current status of your package?

> 
> I thought that it works. As far as I recall, when I last checked, it did.
> 
> Anyway, I plan to give a talk on the package during the next SageDays, so, I am motivated to fix it. Can you tell me what problems arose?

PS: By "my package", I refer to p_group_cohomology. There is "my other package", namely SharedMeatAxe, which is supposed to work and has recently also been fixed on cygwin (see #29152



---

archive/issue_events_415042.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-15T11:33:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415042"
}
```



---

archive/issue_events_415043.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-15T11:33:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415043"
}
```



---

archive/issue_comments_481703.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nHere are results of a local run, with 9.2.beta14 - that's newer than this ticket, but a bit older than the current rc - they match errors seen in the logs in the ticket description.\nThey appear to be a result of GAP files installed in a weird place, namely:\n\n`$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n\nrather than `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`. So I see\n\n```\nsage -t --random-seed=0 src/sage/tests/modular_group_cohomology.py\n**********************************************************************\nFile \"src/sage/tests/modular_group_cohomology.py\", line 10, in sage.tests.modular_group_cohomology\nFailed example:\n    from pGroupCohomology import CohomologyRing   # optional - p_group_cohomology\nException raised:\n    Traceback (most recent call last):\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.tests.modular_group_cohomology[0]>\", line 1, in <module>\n        from pGroupCohomology import CohomologyRing   # optional - p_group_cohomology\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/__init__.py\", line 2466, in <module>\n        from pGroupCohomology.factory import CohomologyRing\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/factory.py\", line 43, in <module>\n        from pGroupCohomology.auxiliaries import coho_options, coho_logger, safe_save, _gap_reset_random_seed, gap, singular, Failure\n      File \"/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/auxiliaries.py\", line 411, in <module>\n        gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))\n      File \"sage/libs/gap/element.pyx\", line 2525, in sage.libs.gap.element.GapElement_Function.__call__ (build/cythonized/sage/libs/gap/element.c:19780)\n        sig_on()\n    sage.libs.gap.util.GAPError: Error, file \"/home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/modular_cohomology/GapMaxels.g\" must exist and be readable\n```\n\n(and more failing tests due to this, as you imagine)\nSo the package looks for its GAP files in `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n\nPerhaps Matthias knows the reason for this.",
    "created_at": "2020-10-15T11:33:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481703",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:10" align="right">comment:10</div>

Here are results of a local run, with 9.2.beta14 - that's newer than this ticket, but a bit older than the current rc - they match errors seen in the logs in the ticket description.
They appear to be a result of GAP files installed in a weird place, namely:

`$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`

rather than `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`. So I see

```
sage -t --random-seed=0 src/sage/tests/modular_group_cohomology.py
**********************************************************************
File "src/sage/tests/modular_group_cohomology.py", line 10, in sage.tests.modular_group_cohomology
Failed example:
    from pGroupCohomology import CohomologyRing   # optional - p_group_cohomology
Exception raised:
    Traceback (most recent call last):
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.tests.modular_group_cohomology[0]>", line 1, in <module>
        from pGroupCohomology import CohomologyRing   # optional - p_group_cohomology
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/__init__.py", line 2466, in <module>
        from pGroupCohomology.factory import CohomologyRing
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/factory.py", line 43, in <module>
        from pGroupCohomology.auxiliaries import coho_options, coho_logger, safe_save, _gap_reset_random_seed, gap, singular, Failure
      File "/home/scratch2/dimpase/sage/sage/local/lib64/python3.7/site-packages/pGroupCohomology/auxiliaries.py", line 411, in <module>
        gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))
      File "sage/libs/gap/element.pyx", line 2525, in sage.libs.gap.element.GapElement_Function.__call__ (build/cythonized/sage/libs/gap/element.c:19780)
        sig_on()
    sage.libs.gap.util.GAPError: Error, file "/home/scratch2/dimpase/sage/sage/local/share/sage/ext/gap/modular_cohomology/GapMaxels.g" must exist and be readable
```

(and more failing tests due to this, as you imagine)
So the package looks for its GAP files in `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`

Perhaps Matthias knows the reason for this.



---

archive/issue_comments_481704.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nIt might be due to the packages now being built using Python wheels, and everything in the package goes to the `site-packages/` of the Python, rather than to the local GAP.",
    "created_at": "2020-10-15T11:40:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481704",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:11" align="right">comment:11</div>

It might be due to the packages now being built using Python wheels, and everything in the package goes to the `site-packages/` of the Python, rather than to the local GAP.



---

archive/issue_comments_481705.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nReplying to [@dimpase](#comment%3A11):\n> It might be due to the packages now being built using Python wheels, and everything in the package goes to the `site-packages/` of the Python, rather than to the local GAP.\n\nProbably.\n\nSo, tell me: is there an environment variable or a Sage variable that provides the location of GAP's package data?\n\nSince this is an actual bug: Should it be fixed here (although this ticket is about downgrading several packages rather then fixing them) or on a new ticket?",
    "created_at": "2020-10-15T12:01:22Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481705",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:12" align="right">comment:12</div>

Replying to [@dimpase](#comment%3A11):
> It might be due to the packages now being built using Python wheels, and everything in the package goes to the `site-packages/` of the Python, rather than to the local GAP.

Probably.

So, tell me: is there an environment variable or a Sage variable that provides the location of GAP's package data?

Since this is an actual bug: Should it be fixed here (although this ticket is about downgrading several packages rather then fixing them) or on a new ticket?



---

archive/issue_comments_481706.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReally unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.",
    "created_at": "2020-10-15T12:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481706",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:13" align="right">comment:13</div>

Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.



---

archive/issue_comments_481707.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nPS:\n\nReplying to [@dimpase](#comment%3A10):\n> They appear to be a result of GAP files installed in a weird place, namely:\n> \n> `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n\nIt is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")`)\n\nSo, if I understand correctly what the error says, GAP does indeed try to find the GAP code in that folder, and the real question is why the code hasn't been installed there during package installation.",
    "created_at": "2020-10-15T12:18:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481707",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:14" align="right">comment:14</div>

PS:

Replying to [@dimpase](#comment%3A10):
> They appear to be a result of GAP files installed in a weird place, namely:
> 
> `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`

It is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")`)

So, if I understand correctly what the error says, GAP does indeed try to find the GAP code in that folder, and the real question is why the code hasn't been installed there during package installation.



---

archive/issue_comments_481708.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@simon-king-jena](#comment%3A14):\n> Replying to [@dimpase](#comment%3A10):\n> > They appear to be a result of GAP files installed in a weird place, namely:\n> > \n> > `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n\n> \n> It is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")`)\n\nI stand corrected: There are some places in the file auxiliaries.py, something like `gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))`. However, `$SAGE_SHARE` used only once in the path.\n\nA clean solution would be to have a Sage or an environment variable giving the location of code of Gap extensions.",
    "created_at": "2020-10-15T13:05:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481708",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@simon-king-jena](#comment%3A14):
> Replying to [@dimpase](#comment%3A10):
> > They appear to be a result of GAP files installed in a weird place, namely:
> > 
> > `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`

> 
> It is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")`)

I stand corrected: There are some places in the file auxiliaries.py, something like `gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))`. However, `$SAGE_SHARE` used only once in the path.

A clean solution would be to have a Sage or an environment variable giving the location of code of Gap extensions.



---

archive/issue_comments_481709.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nFor `p_group_cohomology`, see ticket #28711",
    "created_at": "2020-10-15T16:18:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481709",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:16" align="right">comment:16</div>

For `p_group_cohomology`, see ticket #28711



---

archive/issue_comments_481710.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@mkoeppe](#comment%3A16):\n> For `p_group_cohomology`, see ticket #28711\n\nOK, I'll post fixes there.",
    "created_at": "2020-10-15T16:26:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481710",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@mkoeppe](#comment%3A16):
> For `p_group_cohomology`, see ticket #28711

OK, I'll post fixes there.



---

archive/issue_comments_481711.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nReplying to [@simon-king-jena](#comment%3A15):\n> Replying to [@simon-king-jena](#comment%3A14):\n> > Replying to [@dimpase](#comment%3A10):\n> > > They appear to be a result of GAP files installed in a weird place, namely:\n> > > \n> > > `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n\n> > \n> > It is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")`)\n\n> \n> I stand corrected: There are some places in the file auxiliaries.py, something like `gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))`. However, `$SAGE_SHARE` used only once in the path.\n> \n> A clean solution would be to have a Sage or an environment variable giving the location of code of Gap extensions.\n\nYou can call GAP and examine `GAPInfo.RootPaths`. When looking for a package, GAP appends `pkg/` to each directory in this list, cf. `9.2 GAP Root Directories` in its manual.\n\nIMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP\ndata via setup.py. I'd say, install a GAP package separately, not from `setup.py` from `spkg-install`.  By the way, GAP now has its own package manager. Maybe you can use it (https://github.com/gap-packages/PackageManager) - it's in `gap_packages`, I think.",
    "created_at": "2020-10-15T16:26:13Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481711",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:18" align="right">comment:18</div>

Replying to [@simon-king-jena](#comment%3A15):
> Replying to [@simon-king-jena](#comment%3A14):
> > Replying to [@dimpase](#comment%3A10):
> > > They appear to be a result of GAP files installed in a weird place, namely:
> > > 
> > > `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`

> > 
> > It is indeed weird that $SAGE_LOCAL appears twice in this path. In the sources, if I see that correctly, this path appears only once, namely setup.py (`data_files=[(os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")`)

> 
> I stand corrected: There are some places in the file auxiliaries.py, something like `gap.Read(os.path.join(SAGE_SHARE,'sage','ext','gap','modular_cohomology','GapMaxels.g'))`. However, `$SAGE_SHARE` used only once in the path.
> 
> A clean solution would be to have a Sage or an environment variable giving the location of code of Gap extensions.

You can call GAP and examine `GAPInfo.RootPaths`. When looking for a package, GAP appends `pkg/` to each directory in this list, cf. `9.2 GAP Root Directories` in its manual.

IMHO, Python wheels are build to be relocateable, so it's futile to try to install GAP
data via setup.py. I'd say, install a GAP package separately, not from `setup.py` from `spkg-install`.  By the way, GAP now has its own package manager. Maybe you can use it (https://github.com/gap-packages/PackageManager) - it's in `gap_packages`, I think.



---

archive/issue_comments_481712.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@simon-king-jena](#comment%3A13):\n> Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.\n\nYes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.",
    "created_at": "2020-10-15T21:40:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481712",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@simon-king-jena](#comment%3A13):
> Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.

Yes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.



---

archive/issue_comments_481713.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@dimpase](#comment%3A10):\n> Here are results of a local run, with 9.2.beta14 - that's newer than this ticket, but a bit older than the current rc - they match errors seen in the logs in the ticket description.\n> They appear to be a result of GAP files installed in a weird place, namely:\n> \n> `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`\n> \n> rather than `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`. So I see\n\nNote that apparently `$SAGE_LOCAL/share/sage` is no more, it ceased to exist, it is an ex-folder.",
    "created_at": "2020-10-15T21:50:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481713",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@dimpase](#comment%3A10):
> Here are results of a local run, with 9.2.beta14 - that's newer than this ticket, but a bit older than the current rc - they match errors seen in the logs in the ticket description.
> They appear to be a result of GAP files installed in a weird place, namely:
> 
> `$SAGE_LOCAL/lib/python3.7/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`
> 
> rather than `$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology/`. So I see

Note that apparently `$SAGE_LOCAL/share/sage` is no more, it ceased to exist, it is an ex-folder.



---

archive/issue_comments_481714.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nReplying to [@mkoeppe](#comment%3A19):\n> Replying to [@simon-king-jena](#comment%3A13):\n> > Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.\n\n> \n> Yes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.\n\nCan you elaborate? At some point in the past, I suggested to change the p_group_cohomology spkg as follows:\n\n- Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.\n- Its .c files should remain an spkg, that also is the dependency of the optional extension modules.\n- I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology\n\nDo you suggest this, or something else?\n\nIt used to be a problem that the documentation of the optional Cython modules would not be built. Is there a way around?\n\nEDIT: Is it possible to advise Sage's test suite to only run the tests of a particular file if a certain optional package is installed? Or is it still only possible for individual tests? I'd find it extremely awkward to mark each individual doctest as `# optional: p_group_cohomology`.",
    "created_at": "2020-10-15T21:57:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481714",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:21" align="right">comment:21</div>

Replying to [@mkoeppe](#comment%3A19):
> Replying to [@simon-king-jena](#comment%3A13):
> > Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.

> 
> Yes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.

Can you elaborate? At some point in the past, I suggested to change the p_group_cohomology spkg as follows:

- Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.
- Its .c files should remain an spkg, that also is the dependency of the optional extension modules.
- I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology

Do you suggest this, or something else?

It used to be a problem that the documentation of the optional Cython modules would not be built. Is there a way around?

EDIT: Is it possible to advise Sage's test suite to only run the tests of a particular file if a certain optional package is installed? Or is it still only possible for individual tests? I'd find it extremely awkward to mark each individual doctest as `# optional: p_group_cohomology`.



---

archive/issue_comments_481715.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nReplying to [@simon-king-jena](#comment%3A21):\n> Replying to [@mkoeppe](#comment%3A19):\n> > Replying to [@simon-king-jena](#comment%3A13):\n> > > Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.\n\n> > \n> > Yes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.\n\n> \n> Can you elaborate? At some point in the past, I suggested to change the p_group_cohomology spkg as follows:\n> \n> - Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.\n\nYes\n\n> - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.\n\nYes, in particular if that C library can also be used outside of Sage...\n\n> - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology\n\nYou could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.\n\nOr, if you want to ship it with sagelib, then (as I commented in #28711) these files should be put alongside the Python modules.  sagelib and other Python packages have no business writing into $SAGE_LOCAL.",
    "created_at": "2020-10-15T22:21:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481715",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

Replying to [@simon-king-jena](#comment%3A21):
> Replying to [@mkoeppe](#comment%3A19):
> > Replying to [@simon-king-jena](#comment%3A13):
> > > Really unfortunate that the Cython code of p_group_cohomology has not been made optional Cython files in the Sage library, because then it would be easy to fix without upgrading the upstream source ball.

> > 
> > Yes, I would hope that we can make this improvement to the source structure in Sage 9.3. Similar to what has been done in the 9.2 cycle with `giacpy_sage` and `sage_brial`.

> 
> Can you elaborate? At some point in the past, I suggested to change the p_group_cohomology spkg as follows:
> 
> - Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.

Yes

> - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.

Yes, in particular if that C library can also be used outside of Sage...

> - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology

You could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.

Or, if you want to ship it with sagelib, then (as I commented in #28711) these files should be put alongside the Python modules.  sagelib and other Python packages have no business writing into $SAGE_LOCAL.



---

archive/issue_comments_481716.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment%3A22):\n> > - Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.\n\n> \n> Yes\n\nOK, that was what I have suggested in the past, but what was refused by other developers.\n\nCrucial point, from my point of view: Documentation and doc tests, as explained in my other posts. Are these problems of optional extension modules solved?\n\n> > - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.\n\n> \n> Yes, in particular if that C library can also be used outside of Sage...\n\nHow do you define \"can\"? David Green, the original author of the c-code (that originally hasn't even been a library but only a couple of executables) has used them via command line, but I think he is the only one who ever did.\n\nI'd say: I do not intend to ever publish the c-code outside of the Sage ecosystem.\n\n> > - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology\n\n> \n> You could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.\n\nThat's what is currently happening.\n\n> Or, if you want to ship it with sagelib, \n\nI don't.\n\n> then (as I commented in #28711) these files should be put alongside the Python modules.  sagelib and other Python packages have no business writing into $SAGE_LOCAL.",
    "created_at": "2020-10-15T22:36:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481716",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment%3A22):
> > - Its Python and Cython code should go into the Sage library, the Cython files being optional extension modules.

> 
> Yes

OK, that was what I have suggested in the past, but what was refused by other developers.

Crucial point, from my point of view: Documentation and doc tests, as explained in my other posts. Are these problems of optional extension modules solved?

> > - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.

> 
> Yes, in particular if that C library can also be used outside of Sage...

How do you define "can"? David Green, the original author of the c-code (that originally hasn't even been a library but only a couple of executables) has used them via command line, but I think he is the only one who ever did.

I'd say: I do not intend to ever publish the c-code outside of the Sage ecosystem.

> > - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology

> 
> You could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.

That's what is currently happening.

> Or, if you want to ship it with sagelib, 

I don't.

> then (as I commented in #28711) these files should be put alongside the Python modules.  sagelib and other Python packages have no business writing into $SAGE_LOCAL.



---

archive/issue_comments_481717.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nReplying to [@simon-king-jena](#comment%3A23):\n> Replying to [@mkoeppe](#comment%3A22):\n> > > - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.\n\n> > \n> > Yes, in particular if that C library can also be used outside of Sage...\n\n> \n> How do you define \"can\"? David Green, the original author of the c-code (that originally hasn't even been a library but only a couple of executables) has used them via command line, but I think he is the only one who ever did.\n\nThis version of \"can\" is good enough.\n\n> I'd say: I do not intend to ever publish the c-code outside of the Sage ecosystem.\n> \n> > > - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology\n\n> > \n> > You could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.\n\n> \n> That's what is currently happening.\n\nAs long as you build this library using standard tools (preferably autotools) instead of Sage-specific scripts, and the C library does not depend on the Sage library, this is all fine.",
    "created_at": "2020-10-16T00:45:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481717",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Replying to [@simon-king-jena](#comment%3A23):
> Replying to [@mkoeppe](#comment%3A22):
> > > - Its .c files should remain an spkg, that also is the dependency of the optional extension modules.

> > 
> > Yes, in particular if that C library can also be used outside of Sage...

> 
> How do you define "can"? David Green, the original author of the c-code (that originally hasn't even been a library but only a couple of executables) has used them via command line, but I think he is the only one who ever did.

This version of "can" is good enough.

> I'd say: I do not intend to ever publish the c-code outside of the Sage ecosystem.
> 
> > > - I now suggest, as SAGE_LOCAL/share/sage has gone, to keep the .g files in the package, but install them into SAGE_LOCAL/share/p_group_cohomology

> > 
> > You could either ship them with that spkg that provides the C library and then install it in `SAGE_LOCAL/share/p_group_cohomology` (or, more precisely, in the configured install prefix of your C library.

> 
> That's what is currently happening.

As long as you build this library using standard tools (preferably autotools) instead of Sage-specific scripts, and the C library does not depend on the Sage library, this is all fine.



---

archive/issue_events_415044.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-16T01:05:33Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415044"
}
```



---

archive/issue_events_415045.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-16T01:05:33Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415045"
}
```



---

archive/issue_comments_481718.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIn any case, I don't think it's realistic to fix these issues in Sage 9.2.\nSo let's use the present ticket to update the type of these two packages.",
    "created_at": "2020-10-16T01:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481718",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:25" align="right">comment:25</div>

In any case, I don't think it's realistic to fix these issues in Sage 9.2.
So let's use the present ticket to update the type of these two packages.



---

archive/issue_comments_481719.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nI think a hotfix for p_group_cohomology, to install GAP files into the right place, using SAGE_LOCAL, despite being blasphemy in the Temple of Python, can be done very quickly.\n\nJust add `sdh_install` call to `spkg-install`, which will put them where the package expects.",
    "created_at": "2020-10-16T13:36:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481719",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:26" align="right">comment:26</div>

I think a hotfix for p_group_cohomology, to install GAP files into the right place, using SAGE_LOCAL, despite being blasphemy in the Temple of Python, can be done very quickly.

Just add `sdh_install` call to `spkg-install`, which will put them where the package expects.



---

archive/issue_comments_481720.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nafter doing `ln -sf $SAGE_LOCAL/lib/python3.8/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology`\n(if it's python3.X, there should be python3.X there)\n\nGAP files load, but Singular do not load\n\n```\n    sage.interfaces.singular.SingularError: Singular error:\n       ? cannot open dickson.lib\n       ? error occurred in or before STDIN line 15: `LIB \"dickson.lib\";`\n```\nSo this is a similar to GAP files problem, only with Singular...",
    "created_at": "2020-10-16T13:55:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481720",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:27" align="right">comment:27</div>

after doing `ln -sf $SAGE_LOCAL/lib/python3.8/site-packages/$SAGE_LOCAL/share/sage/ext/gap/modular_cohomology $SAGE_LOCAL/share/sage/ext/gap/modular_cohomology`
(if it's python3.X, there should be python3.X there)

GAP files load, but Singular do not load

```
    sage.interfaces.singular.SingularError: Singular error:
       ? cannot open dickson.lib
       ? error occurred in or before STDIN line 15: `LIB "dickson.lib";`
```
So this is a similar to GAP files problem, only with Singular...



---

archive/issue_comments_481721.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@dimpase](#comment%3A26):\n> I think a hotfix for p_group_cohomology, to install GAP files into the right place, using SAGE_LOCAL, despite being blasphemy in the Temple of Python, can be done very quickly.\n> \n> Just add `sdh_install` call to `spkg-install`, which will put them where the package expects.\n\nSee my comment 39 at #28711: Apparently Sage prepends the absolute path `os.path.join(SAGE_SHARE,\"sage\",\"ext\",\"gap\",\"modular_cohomology\")` with $SAGE_DESTDIR. Same problem with the Singular LIB.\n\nSo, I guess the real hotfix is to tell me: How should I provide a RELATIVE path in which to install the GAP respectively Singular code? Would it just work to write\n\n```python\n  data_files=[ ( os.path.join( \"share\", \"gap\", \"pkg\", \"modular_cohomology\" ),\n                 [ os.path.join( \"pGroupCohomology\", \"GapMaxels.g\" ),\n                   os.path.join( \"pGroupCohomology\", \"GapMB.g\" ),\n                   os.path.join( \"pGroupCohomology\", \"GapSgs.g\" ) ] ),\n               ( os.path.join( \"share\", \"singular\", \"LIB\" ),\n                 [ os.path.join( \"pGroupCohomology\",\"dickson.lib\" ) ] ) ]\n```\n?\n\nEDIT: I'd also need to change the places in `auxiliaries.py`, because currently the install path for the GAP helpers is SAGE_SHARE/sage/ext/gap/modular_cohomology, not SAGE_SHARE/gap/pkg/modular_cohomology. But SAGE_SHARE/sage has gone.",
    "created_at": "2020-10-16T14:04:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481721",
    "user": "https://github.com/simon-king-jena"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@dimpase](#comment%3A26):
> I think a hotfix for p_group_cohomology, to install GAP files into the right place, using SAGE_LOCAL, despite being blasphemy in the Temple of Python, can be done very quickly.
> 
> Just add `sdh_install` call to `spkg-install`, which will put them where the package expects.

See my comment 39 at #28711: Apparently Sage prepends the absolute path `os.path.join(SAGE_SHARE,"sage","ext","gap","modular_cohomology")` with $SAGE_DESTDIR. Same problem with the Singular LIB.

So, I guess the real hotfix is to tell me: How should I provide a RELATIVE path in which to install the GAP respectively Singular code? Would it just work to write

```python
  data_files=[ ( os.path.join( "share", "gap", "pkg", "modular_cohomology" ),
                 [ os.path.join( "pGroupCohomology", "GapMaxels.g" ),
                   os.path.join( "pGroupCohomology", "GapMB.g" ),
                   os.path.join( "pGroupCohomology", "GapSgs.g" ) ] ),
               ( os.path.join( "share", "singular", "LIB" ),
                 [ os.path.join( "pGroupCohomology","dickson.lib" ) ] ) ]
```
?

EDIT: I'd also need to change the places in `auxiliaries.py`, because currently the install path for the GAP helpers is SAGE_SHARE/sage/ext/gap/modular_cohomology, not SAGE_SHARE/gap/pkg/modular_cohomology. But SAGE_SHARE/sage has gone.



---

archive/issue_comments_481722.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\ncan we get p_group_cohomology off the branch here?",
    "created_at": "2020-10-20T15:16:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481722",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:29" align="right">comment:29</div>

can we get p_group_cohomology off the branch here?



---

archive/issue_events_415046.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-20T16:31:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415046"
}
```



---

archive/issue_events_415047.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-20T16:31:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415047"
}
```



---

archive/issue_comments_481723.json:
```json
{
    "body": "Dependencies: **#28711**",
    "created_at": "2020-10-20T16:31:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481723",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#28711**



---

archive/issue_comments_481724.json:
```json
{
    "body": "Changed commit from **[`402d45f`](https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819)** to **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**",
    "created_at": "2020-10-20T16:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481724",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`402d45f`](https://github.com/sagemath/sagetrac-mirror/commit/402d45f5344ce17321164994d6e5eef7398f7819)** to **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**



---

archive/issue_comments_481725.json:
```json
{
    "body": "<div id=\"comment:31\"></div>\n\nBranch pushed to git repo; I updated commit sha1. This was a forced push. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a\"><code>4f5a810</code></a></td><td><code>Upgrade p_group_cohomology to version 3.3.2</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/de8adfab53d360a9383091a4c018a3ed2308ef16\"><code>de8adfa</code></a></td><td><code>Revert a change to \"dependencies\" of p_group_cohomology</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0\"><code>cf60884</code></a></td><td><code>Add upstream_url to p_group_cohomology</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9\"><code>ae50157</code></a></td><td><code>p_group_cohomology's upstream changed by some new commits</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf\"><code>bd34c47</code></a></td><td><code>build/pkgs/p_group_cohomology/checksums.ini: Fix upstream_url</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b\"><code>245560d</code></a></td><td><code>Fix docbuild of p_group_cohomology</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9\"><code>f4e5f6a</code></a></td><td><code>Fix a doctest in sage/tests/modular_cohomology.py</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808\"><code>674523c</code></a></td><td><code>build/pkgs/deformation/type: Downgrade to experimental</code></td></tr></table>\n",
    "created_at": "2020-10-20T16:35:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481725",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:31"></div>

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f5a810cb0af3ebb9f3813d0d1ab71353fb9014a"><code>4f5a810</code></a></td><td><code>Upgrade p_group_cohomology to version 3.3.2</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/de8adfab53d360a9383091a4c018a3ed2308ef16"><code>de8adfa</code></a></td><td><code>Revert a change to "dependencies" of p_group_cohomology</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cf608843f80c7f947275f64af986eb6dbb035df0"><code>cf60884</code></a></td><td><code>Add upstream_url to p_group_cohomology</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/ae50157cd281d46cd9bb3f7a6eaa3547506d16e9"><code>ae50157</code></a></td><td><code>p_group_cohomology's upstream changed by some new commits</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/bd34c47544a805e8498fe278e5bc3dc58ea38ccf"><code>bd34c47</code></a></td><td><code>build/pkgs/p_group_cohomology/checksums.ini: Fix upstream_url</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/245560d1449ffc51cbbad5d12fd653bd8aaa327b"><code>245560d</code></a></td><td><code>Fix docbuild of p_group_cohomology</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f4e5f6af3df1d944dba85298023cc7367c5742c9"><code>f4e5f6a</code></a></td><td><code>Fix a doctest in sage/tests/modular_cohomology.py</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808"><code>674523c</code></a></td><td><code>build/pkgs/deformation/type: Downgrade to experimental</code></td></tr></table>




---

archive/issue_events_415048.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-20T16:35:32Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415048"
}
```



---

archive/issue_events_415049.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-20T16:35:32Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415049"
}
```



---

archive/issue_events_415050.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-20T16:53:38Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415050"
}
```



---

archive/issue_events_415051.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-10-20T16:53:38Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415051"
}
```



---

archive/issue_comments_481726.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nok",
    "created_at": "2020-10-20T16:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481726",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:33" align="right">comment:33</div>

ok



---

archive/issue_comments_481727.json:
```json
{
    "body": "Reviewer: **Dima Pasechnik**",
    "created_at": "2020-10-20T16:53:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481727",
    "user": "https://github.com/dimpase"
}
```

Reviewer: **Dima Pasechnik**



---

archive/issue_events_415052.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415052"
}
```



---

archive/issue_events_415053.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415053"
}
```



---

archive/issue_events_415054.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-01T00:43:01Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415054"
}
```



---

archive/issue_events_415055.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "7bc03473beb7c7b6e431a7e1ab18535ada8ca13f",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-11-01T00:43:01Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30349#event-415055"
}
```



---

archive/issue_comments_481728.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2)** to **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**",
    "created_at": "2020-11-01T00:43:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30349",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30349#issuecomment-481728",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/downgrade_broken_optional_packages_to_experimental_for_sage_9_2)** to **[`674523c`](https://github.com/sagemath/sagetrac-mirror/commit/674523cf0bc34368e2aa5effb280c0dcf71f9808)**
