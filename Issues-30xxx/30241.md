# Issue 30241: New implementation class FiniteRankDualFreeModule

archive/issues_030004.json:
```json
{
    "body": "(from #30169)\n\nWe have the following identifications:\n\n```\nsage: M = FiniteRankFreeModule(ZZ, 3, name='M')\nsage: M is M.exterior_power(1)\nTrue\nsage: M is M.tensor_module(1, 0)\nTrue\n```\n\nIn contrast (in 9.7.rc0):\n\n```\nsage: M.dual() is M.dual_exterior_power(1)\nTrue\nsage: M.dual() is M.tensor_module(0, 1)\nFalse\n```\n\nAfter #34474:\n\n```\nsage: M.dual() is M.dual_exterior_power(1)\nTrue\nsage: M.dual() is M.tensor_module(0, 1)\nTrue\n```\n\nAfter #34474, the dual is implemented as a special case of `ExtPowerDualFreeModule`.\n\nWe create a separate implementation class `FiniteRankDualFreeModule` for it instead. We equip it with a `tensor_type` method, which allows the dual to participate in tensor products (see #34471).\n\n\nDepends on #34474\n\n**CC:**  @egourgoulhon @tscrim @mjungmath\n\n**Branch/Commit:** [84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)\n\n**Reviewer:** Eric Gourgoulhon\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/30241\n\n",
    "closed_at": "2022-09-22T22:35:00Z",
    "created_at": "2020-07-28T18:34:16Z",
    "labels": [
        "component: linear algebra",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.8",
    "title": "New implementation class FiniteRankDualFreeModule",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/30241",
    "user": "https://github.com/mkoeppe"
}
```
(from #30169)

We have the following identifications:

```
sage: M = FiniteRankFreeModule(ZZ, 3, name='M')
sage: M is M.exterior_power(1)
True
sage: M is M.tensor_module(1, 0)
True
```

In contrast (in 9.7.rc0):

```
sage: M.dual() is M.dual_exterior_power(1)
True
sage: M.dual() is M.tensor_module(0, 1)
False
```

After #34474:

```
sage: M.dual() is M.dual_exterior_power(1)
True
sage: M.dual() is M.tensor_module(0, 1)
True
```

After #34474, the dual is implemented as a special case of `ExtPowerDualFreeModule`.

We create a separate implementation class `FiniteRankDualFreeModule` for it instead. We equip it with a `tensor_type` method, which allows the dual to participate in tensor products (see #34471).


Depends on #34474

**CC:**  @egourgoulhon @tscrim @mjungmath

**Branch/Commit:** [84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)

**Reviewer:** Eric Gourgoulhon

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/30241





---

archive/issue_comments_482304.json:
```json
{
    "body": "<a id='comment:1'></a>\nThis doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: even from the mathematical point of view, one forms and (0,1) tensors are constructed differently, though they are isomorphic.\n\nFrom that perspective, the current implementation makes perfect sense. What would make more sense is implementing the isomorphism.",
    "created_at": "2020-07-28T18:43:51Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482304",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:1'></a>
This doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: even from the mathematical point of view, one forms and (0,1) tensors are constructed differently, though they are isomorphic.

From that perspective, the current implementation makes perfect sense. What would make more sense is implementing the isomorphism.



---

archive/issue_comments_482305.json:
```json
{
    "body": "<a id='comment:2'></a>\nReplying to [gh-mjungmath](#comment%3A1):\n> This doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: mathematically, meaning very strictly speaking, one forms and (0,1) tensors are defined differently, though they are isomorphic.\n\n\nThe same is true for `M.exterior_power(1)` and `M.tensor_module(1, 0)`, but we do have this identification.",
    "created_at": "2020-07-28T18:48:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482305",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
Replying to [gh-mjungmath](#comment%3A1):
> This doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: mathematically, meaning very strictly speaking, one forms and (0,1) tensors are defined differently, though they are isomorphic.


The same is true for `M.exterior_power(1)` and `M.tensor_module(1, 0)`, but we do have this identification.



---

archive/issue_comments_482306.json:
```json
{
    "body": "<a id='comment:3'></a>\nBy the way, I am adding the additional structure of the exterior powers as quotients of tensor modules in #30169. Please take a look",
    "created_at": "2020-07-28T18:50:42Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482306",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
By the way, I am adding the additional structure of the exterior powers as quotients of tensor modules in #30169. Please take a look



---

archive/issue_comments_482307.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [mkoeppe](#comment%3A2):\n> Replying to [gh-mjungmath](#comment%3A1):\n> > This doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: mathematically, meaning very strictly speaking, one forms and (0,1) tensors are defined differently, though they are isomorphic.\n\n> \n> The same is true for `M.exterior_power(1)` and `M.tensor_module(1, 0)`, but we do have this identification.\n\n\nFair point. Then I would vote for changing this to the expected outputs rather than creating a whole new class which has no further purpose than everything that is already there. Regarding Travis [ticket:30169#comment:10 [comment:10](#comment%3A10)] this would be a convenient solution. Meaning: `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. Then, one can implement the isomorphisms.\n\nEither way, I agree that consistency is desirable here.\n\nAllow me a side note: please remember that the whole manifold setup is built upon `FiniteRankFreeModule`. Modifying substatial things here might cause problems in the manifold implementation. It would be good to double check and, if absolutely necessary, make changes there, too. Henceforth, I suggest doctesting the manifold part, too.",
    "created_at": "2020-07-28T19:08:36Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482307",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:4'></a>
Replying to [mkoeppe](#comment%3A2):
> Replying to [gh-mjungmath](#comment%3A1):
> > This doesn't sound sensible to me. `ExtPowerDualFreeModule` and `TensorFreeModule` follow *very* different construction patterns. For a reason: mathematically, meaning very strictly speaking, one forms and (0,1) tensors are defined differently, though they are isomorphic.

> 
> The same is true for `M.exterior_power(1)` and `M.tensor_module(1, 0)`, but we do have this identification.


Fair point. Then I would vote for changing this to the expected outputs rather than creating a whole new class which has no further purpose than everything that is already there. Regarding Travis [ticket:30169#comment:10 [comment:10](#comment%3A10)] this would be a convenient solution. Meaning: `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. Then, one can implement the isomorphisms.

Either way, I agree that consistency is desirable here.

Allow me a side note: please remember that the whole manifold setup is built upon `FiniteRankFreeModule`. Modifying substatial things here might cause problems in the manifold implementation. It would be good to double check and, if absolutely necessary, make changes there, too. Henceforth, I suggest doctesting the manifold part, too.



---

archive/issue_comments_482308.json:
```json
{
    "body": "<a id='comment:5'></a>\nReplying to [gh-mjungmath](#comment%3A4):\n> ... a whole new class which has no further purpose than everything that is already there. \n\n\nNote that by creating the new class, both of the `ExtPowerDualFreeModule` and `TensorFreeModule` classes will be simplified because they no longer have to implement the special case.",
    "created_at": "2020-07-28T19:11:50Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482308",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Replying to [gh-mjungmath](#comment%3A4):
> ... a whole new class which has no further purpose than everything that is already there. 


Note that by creating the new class, both of the `ExtPowerDualFreeModule` and `TensorFreeModule` classes will be simplified because they no longer have to implement the special case.



---

archive/issue_comments_482309.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [gh-mjungmath](#comment%3A4):\n> `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. \n\n\nLet's see. In your opinion, what should `M.exterior_power(0)` and `M.dual_exterior_power(0)` return?",
    "created_at": "2020-07-28T19:14:58Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482309",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>
Replying to [gh-mjungmath](#comment%3A4):
> `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. 


Let's see. In your opinion, what should `M.exterior_power(0)` and `M.dual_exterior_power(0)` return?



---

archive/issue_comments_482310.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A6):\n> Replying to [gh-mjungmath](#comment%3A4):\n> > `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. \n\n> \n> Let's see. In your opinion, what should `M.exterior_power(0)` and `M.dual_exterior_power(0)` return?\n\n\nStrictly speaking, they should return instances of `ExtPowerFreeModule` or `ExtPowerDualFreeModule` respectively, which are isomorphic to the base ring.\n\nYou definitely have a good point. And I totally agree that this should be unified, in either way.\n\nBut I am strictly against a new class dedicated to just one special case. At least, this is how I understand your proposal.",
    "created_at": "2020-07-28T19:19:15Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482310",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A6):
> Replying to [gh-mjungmath](#comment%3A4):
> > `M.exterior_power(1)` should return an instance of `ExtPowerFreeModule` and `M.tensor_module(1, 0)` should return an instance of `TensorFreeModule`. 

> 
> Let's see. In your opinion, what should `M.exterior_power(0)` and `M.dual_exterior_power(0)` return?


Strictly speaking, they should return instances of `ExtPowerFreeModule` or `ExtPowerDualFreeModule` respectively, which are isomorphic to the base ring.

You definitely have a good point. And I totally agree that this should be unified, in either way.

But I am strictly against a new class dedicated to just one special case. At least, this is how I understand your proposal.



---

archive/issue_comments_482311.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-mjungmath](#comment%3A7):\n> I am strictly against a new class dedicated to just one special case.\n\n\nI'll just prepare a branch and then you can see how it simplifies things, which will make it easier to review this proposal",
    "created_at": "2020-07-28T19:26:01Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482311",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [gh-mjungmath](#comment%3A7):
> I am strictly against a new class dedicated to just one special case.


I'll just prepare a branch and then you can see how it simplifies things, which will make it easier to review this proposal



---

archive/issue_comments_482312.json:
```json
{
    "body": "<a id='comment:9'></a>\nSure, I will take a look. Travis, what do you say?",
    "created_at": "2020-07-28T19:36:18Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482312",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:9'></a>
Sure, I will take a look. Travis, what do you say?



---

archive/issue_comments_482313.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [gh-mjungmath](#comment%3A4):\n> Allow me a side note: please remember that the whole manifold setup is built upon `FiniteRankFreeModule`. Modifying substatial things here might cause problems in the manifold implementation. It would be good to double check and, if absolutely necessary, make changes there, too. Henceforth, I suggest doctesting the manifold part, too.\n\n\nThanks. Prompted by your remark, I have taken a look and I noticed that `VectorFieldModule` also has similar code. I have yet to study this code in detail (I am slowly making my way up the stack...), but it looks it has the same inconsistency between primal and dual:\n\n```\nsage: M = Manifold(2, 'M')\nsage: XM = M.vector_field_module()\nsage: XM.tensor_module(1, 0) is XM\nTrue\nsage: XM.tensor_module(0, 1) is XM.dual()\nFalse\n```",
    "created_at": "2020-07-28T19:42:28Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482313",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Replying to [gh-mjungmath](#comment%3A4):
> Allow me a side note: please remember that the whole manifold setup is built upon `FiniteRankFreeModule`. Modifying substatial things here might cause problems in the manifold implementation. It would be good to double check and, if absolutely necessary, make changes there, too. Henceforth, I suggest doctesting the manifold part, too.


Thanks. Prompted by your remark, I have taken a look and I noticed that `VectorFieldModule` also has similar code. I have yet to study this code in detail (I am slowly making my way up the stack...), but it looks it has the same inconsistency between primal and dual:

```
sage: M = Manifold(2, 'M')
sage: XM = M.vector_field_module()
sage: XM.tensor_module(1, 0) is XM
True
sage: XM.tensor_module(0, 1) is XM.dual()
False
```



---

archive/issue_comments_482314.json:
```json
{
    "body": "<a id='comment:11'></a>\nI think I have a solution that could make everyone happy. \n\nIn #30169, I had implemented `FiniteRankDualFreeModule.__classcall_private__` methods that delegate to other classes and implement the identification.\n\nBut we could as well take care of all identifications in the `FiniteRankModule.exterior_power`, `dual_power`, `tensor_module` methods.\n\nThen the class constructors `ExtPowerFreeModule` could keep the strict behavior (I would also check that the case of degree 0 is correctly implemented - I don't think it is currently).",
    "created_at": "2020-07-28T19:56:05Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482314",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:11'></a>
I think I have a solution that could make everyone happy. 

In #30169, I had implemented `FiniteRankDualFreeModule.__classcall_private__` methods that delegate to other classes and implement the identification.

But we could as well take care of all identifications in the `FiniteRankModule.exterior_power`, `dual_power`, `tensor_module` methods.

Then the class constructors `ExtPowerFreeModule` could keep the strict behavior (I would also check that the case of degree 0 is correctly implemented - I don't think it is currently).



---

archive/issue_comments_482315.json:
```json
{
    "body": "<a id='comment:12'></a>\nReplying to [mkoeppe](#comment%3A11):\n> I think I have a solution that could make everyone happy. \n> \n> In #30169, I had implemented `FiniteRankDualFreeModule.__classcall_private__` methods that delegate to other classes and implement the identification.\n\n\n\n\n> But we could as well take care of all identifications in the `FiniteRankModule.exterior_power`, `dual_power`, `tensor_module` methods.\n\n\nThis sounds much better, yes. It would also be good to leave a note in the documentation so that the user knows about these special cases and how they are treated (if not already done).\n\n> Then the class constructors `ExtPowerFreeModule` could keep the strict behavior (I would also check that the case of degree 0 is correctly implemented - I don't think it is currently).\n\n\nI would appreciate this task. The degree zero case had already caused some troubles in the past.",
    "created_at": "2020-07-28T20:09:57Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482315",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:12'></a>
Replying to [mkoeppe](#comment%3A11):
> I think I have a solution that could make everyone happy. 
> 
> In #30169, I had implemented `FiniteRankDualFreeModule.__classcall_private__` methods that delegate to other classes and implement the identification.




> But we could as well take care of all identifications in the `FiniteRankModule.exterior_power`, `dual_power`, `tensor_module` methods.


This sounds much better, yes. It would also be good to leave a note in the documentation so that the user knows about these special cases and how they are treated (if not already done).

> Then the class constructors `ExtPowerFreeModule` could keep the strict behavior (I would also check that the case of degree 0 is correctly implemented - I don't think it is currently).


I would appreciate this task. The degree zero case had already caused some troubles in the past.



---

archive/issue_events_270298.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270298"
}
```



---

archive/issue_events_270299.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270299"
}
```



---

archive/issue_events_270300.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270300"
}
```



---

archive/issue_events_270301.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270301"
}
```



---

archive/issue_comments_482316.json:
```json
{
    "body": "<a id='comment:14'></a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482316",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_270302.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270302"
}
```



---

archive/issue_events_270303.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:43:17Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270303"
}
```



---

archive/issue_events_270304.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270304"
}
```



---

archive/issue_events_270305.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270305"
}
```



---

archive/issue_events_270306.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270306"
}
```



---

archive/issue_events_270307.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270307"
}
```



---

archive/issue_events_270308.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270308"
}
```



---

archive/issue_events_270309.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270309"
}
```



---

archive/issue_comments_482317.json:
```json
{
    "body": "**Dependencies:** #34474",
    "created_at": "2022-09-01T15:30:11Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482317",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #34474



---

archive/issue_comments_482318.json:
```json
{
    "body": "<a id='comment:20'></a>\nTicket description needs updating after #34474",
    "created_at": "2022-09-01T15:52:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482318",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>
Ticket description needs updating after #34474



---

archive/issue_comments_482319.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n (from #30169)\n \n-Currently, we have the following identifications:\n+We have the following identifications:\n \n ```\n sage: M = FiniteRankFreeModule(ZZ, 3, name='M')\n@@ -10,7 +10,7 @@\n True\n ```\n \n-In contrast:\n+In contrast (in 9.7.rc0):\n \n ```\n sage: M.dual() is M.dual_exterior_power(1)\n@@ -19,9 +19,16 @@\n False\n ```\n \n-The dual is implemented twice, as a special case of both `TensorFreeModule` and `ExtPowerDualFreeModule`.\n+After #34474:\n \n-We create a separate implementation class `FiniteRankDualFreeModule` for it.\n+```\n+sage: M.dual() is M.dual_exterior_power(1)\n+True\n+sage: M.dual() is M.tensor_module(0, 1)\n+True\n+```\n \n-By adding `__classcall_private__` methods, we delegate the construction to the new class for the special cases.\n+After #34474, the dual is implemented as a special case of `ExtPowerDualFreeModule`.\n \n+We create a separate implementation class `FiniteRankDualFreeModule` for it instead. We equip it with a `tensor_type` method, which allows the dual to participate in tensor products (see #34471).\n+\n``````\n",
    "created_at": "2022-09-02T20:09:51Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482319",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 (from #30169)
 
-Currently, we have the following identifications:
+We have the following identifications:
 
 ```
 sage: M = FiniteRankFreeModule(ZZ, 3, name='M')
@@ -10,7 +10,7 @@
 True
 ```
 
-In contrast:
+In contrast (in 9.7.rc0):
 
 ```
 sage: M.dual() is M.dual_exterior_power(1)
@@ -19,9 +19,16 @@
 False
 ```
 
-The dual is implemented twice, as a special case of both `TensorFreeModule` and `ExtPowerDualFreeModule`.
+After #34474:
 
-We create a separate implementation class `FiniteRankDualFreeModule` for it.
+```
+sage: M.dual() is M.dual_exterior_power(1)
+True
+sage: M.dual() is M.tensor_module(0, 1)
+True
+```
 
-By adding `__classcall_private__` methods, we delegate the construction to the new class for the special cases.
+After #34474, the dual is implemented as a special case of `ExtPowerDualFreeModule`.
 
+We create a separate implementation class `FiniteRankDualFreeModule` for it instead. We equip it with a `tensor_type` method, which allows the dual to participate in tensor products (see #34471).
+
``````




---

archive/issue_comments_482320.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2022-09-02T20:48:05Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482320",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_482321.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/new_implementation_class_finiterankdualfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/new_implementation_class_finiterankdualfreemodule)",
    "created_at": "2022-09-02T20:53:12Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482321",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/new_implementation_class_finiterankdualfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/new_implementation_class_finiterankdualfreemodule)



---

archive/issue_comments_482322.json:
```json
{
    "body": "**Commit:** [37e41b9b5f3968e32967128bd94df4f101b685bb](https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb)",
    "created_at": "2022-09-02T20:56:34Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482322",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Commit:** [37e41b9b5f3968e32967128bd94df4f101b685bb](https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb)



---

archive/issue_comments_482323.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb\">37e41b9</a></td><td><code>FiniteRankDualFreeModule.tensor_type: New; add tensor_product doctests</code></td></tr></table>\n",
    "created_at": "2022-09-02T20:56:34Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482323",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb">37e41b9</a></td><td><code>FiniteRankDualFreeModule.tensor_type: New; add tensor_product doctests</code></td></tr></table>




---

archive/issue_events_270310.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-02T20:57:27Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270310"
}
```



---

archive/issue_comments_482324.json:
```json
{
    "body": "<a id='comment:26'></a>\nLooks good, thanks. There are some minor issues regarding the documentation of class `FiniteRankDualFreeModule`:\n\n```diff\n-     the *dual of* `M` is the set `M^*` of all linear forms `p` on `M`,\n+     the *dual of* `M` is the set `M^*` of all linear forms on `M`,\n```\n\n```diff\n-    - ``name`` -- (default: ``None``) string; name given to `\\Lambda^p(M^*)`\n+    - ``name`` -- (default: ``None``) string; name given to `M^*`\n```\n\n```diff\n-    EXAMPLES:\n+    EXAMPLES::\n```\nIt would also be nice to update the `AUTHORS` field of `finite_rank_free_module.py`.\n\nYou probably already know it, but just in case: instead of running `make doc` (which is so slow that one always hesitate to run it), a fast way to generate the documentation regarding tensors on finite rank free modules is \n\n```\nsage -docbuild reference/tensor_free_modules html\n```\nThe documentation is then located in `local/share/doc/sage/html/en/reference/tensor_free_modules/index.html` under the Sage root directory. \n\nMichael, do you have any further comments?",
    "created_at": "2022-09-04T18:10:34Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482324",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:26'></a>
Looks good, thanks. There are some minor issues regarding the documentation of class `FiniteRankDualFreeModule`:

```diff
-     the *dual of* `M` is the set `M^*` of all linear forms `p` on `M`,
+     the *dual of* `M` is the set `M^*` of all linear forms on `M`,
```

```diff
-    - ``name`` -- (default: ``None``) string; name given to `\Lambda^p(M^*)`
+    - ``name`` -- (default: ``None``) string; name given to `M^*`
```

```diff
-    EXAMPLES:
+    EXAMPLES::
```
It would also be nice to update the `AUTHORS` field of `finite_rank_free_module.py`.

You probably already know it, but just in case: instead of running `make doc` (which is so slow that one always hesitate to run it), a fast way to generate the documentation regarding tensors on finite rank free modules is 

```
sage -docbuild reference/tensor_free_modules html
```
The documentation is then located in `local/share/doc/sage/html/en/reference/tensor_free_modules/index.html` under the Sage root directory. 

Michael, do you have any further comments?



---

archive/issue_comments_482325.json:
```json
{
    "body": "<a id='comment:27'></a>\nAnother issue regardng the documentation: in the html doc, the method `construction()` of `FiniteRankDualFreeModule` appears as an empty item, which is somewhat weird. This is because its docstring contains only a `TESTS` field. There should be at least something like \"Not implemented yet\" and/or the comment that appears only in the Python code (`No construction until we extend VectorFunctor with a parameter 'dual'`). Same remark about the `construction()` methods of `TensorFreeModule`, `ExtPowerFreeModule` and `ExtPowerDualFreeModule` after #30235.",
    "created_at": "2022-09-04T18:25:18Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482325",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:27'></a>
Another issue regardng the documentation: in the html doc, the method `construction()` of `FiniteRankDualFreeModule` appears as an empty item, which is somewhat weird. This is because its docstring contains only a `TESTS` field. There should be at least something like "Not implemented yet" and/or the comment that appears only in the Python code (`No construction until we extend VectorFunctor with a parameter 'dual'`). Same remark about the `construction()` methods of `TensorFreeModule`, `ExtPowerFreeModule` and `ExtPowerDualFreeModule` after #30235.



---

archive/issue_comments_482326.json:
```json
{
    "body": "**Changing commit** from \"[37e41b9b5f3968e32967128bd94df4f101b685bb](https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb)\" to \"[84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)\".",
    "created_at": "2022-09-04T18:51:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482326",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[37e41b9b5f3968e32967128bd94df4f101b685bb](https://github.com/sagemath/sagetrac-mirror/commit/37e41b9b5f3968e32967128bd94df4f101b685bb)" to "[84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)".



---

archive/issue_comments_482327.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/50440246008572472fcaac446fc1f98e44e8e8a3\">5044024</a></td><td><code>FiniteRankDualFreeModule: Doc fixes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a\">84d7b5e</a></td><td><code>ExtPower[Dual]FreeModule, FiniteRankDualFreeModule: Add docstring to construction method</code></td></tr></table>\n",
    "created_at": "2022-09-04T18:51:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482327",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/50440246008572472fcaac446fc1f98e44e8e8a3">5044024</a></td><td><code>FiniteRankDualFreeModule: Doc fixes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a">84d7b5e</a></td><td><code>ExtPower[Dual]FreeModule, FiniteRankDualFreeModule: Add docstring to construction method</code></td></tr></table>




---

archive/issue_comments_482328.json:
```json
{
    "body": "<a id='comment:29'></a>\nI left the docstring of `TensorFreeModule.construction` as is because it's getting replaced in #34448 already",
    "created_at": "2022-09-04T18:57:01Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482328",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
I left the docstring of `TensorFreeModule.construction` as is because it's getting replaced in #34448 already



---

archive/issue_comments_482329.json:
```json
{
    "body": "<a id='comment:30'></a>\nReplying to [Eric Gourgoulhon](#comment%3A26):\n> It would also be nice to update the `AUTHORS` field of `finite_rank_free_module.py`.\n\n\nI'll do this in a follow-up ticket to avoid a merge conflict with #30229.",
    "created_at": "2022-09-04T18:59:41Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482329",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
Replying to [Eric Gourgoulhon](#comment%3A26):
> It would also be nice to update the `AUTHORS` field of `finite_rank_free_module.py`.


I'll do this in a follow-up ticket to avoid a merge conflict with #30229.



---

archive/issue_events_270311.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2022-09-04T19:47:07Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270311"
}
```



---

archive/issue_events_270312.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2022-09-04T19:47:07Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270312"
}
```



---

archive/issue_comments_482330.json:
```json
{
    "body": "<a id='comment:31'></a>\nReplying to [Matthias K\u00f6ppe](#comment%3A29):\n> I left the docstring of `TensorFreeModule.construction` as is because it's getting replaced in #34448 already\nOK. Thanks for the other changes. \n\nMichael, do you agree with the positive review?",
    "created_at": "2022-09-04T19:47:07Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482330",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:31'></a>
Replying to [Matthias KÃ¶ppe](#comment%3A29):
> I left the docstring of `TensorFreeModule.construction` as is because it's getting replaced in #34448 already
OK. Thanks for the other changes. 

Michael, do you agree with the positive review?



---

archive/issue_comments_482331.json:
```json
{
    "body": "**Reviewer:** Eric Gourgoulhon",
    "created_at": "2022-09-06T19:22:30Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482331",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Eric Gourgoulhon



---

archive/issue_comments_482332.json:
```json
{
    "body": "<a id='comment:33'></a>\nSorry, it's a long time ago I looked into this.\n\nWe want tensor products for dual elements, am I getting this right? Is the long term goal then to implement `ExtPowerDualFreeModule` as a quotient of tensor powers of `FiniteRankDualFreeModule`?",
    "created_at": "2022-09-07T18:52:08Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482332",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:33'></a>
Sorry, it's a long time ago I looked into this.

We want tensor products for dual elements, am I getting this right? Is the long term goal then to implement `ExtPowerDualFreeModule` as a quotient of tensor powers of `FiniteRankDualFreeModule`?



---

archive/issue_comments_482333.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/new_implementation_class_finiterankdualfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/new_implementation_class_finiterankdualfreemodule)\" to \"[84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)\".",
    "created_at": "2022-09-22T22:35:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30241#issuecomment-482333",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/new_implementation_class_finiterankdualfreemodule](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/new_implementation_class_finiterankdualfreemodule)" to "[84d7b5eabff42af064f875ab7a0dca0354892d3a](https://github.com/sagemath/sagetrac-mirror/commit/84d7b5eabff42af064f875ab7a0dca0354892d3a)".



---

archive/issue_events_270313.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2022-09-22T22:35:00Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270313"
}
```



---

archive/issue_events_270314.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "f87464fce378f9751425664bb65afd27e524f51d",
    "created_at": "2022-09-22T22:35:00Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30241",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30241#event-270314"
}
```
