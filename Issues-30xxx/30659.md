# Issue 30659: supersingular_j_polynomial does not use cached values

archive/issues_030422.json:
```json
{
    "body": "In sage.schemes.elliptic_curves.ell_finite_field.py, there is a function supersingular_j_polynomial() and also a dict cotaining the coefficients of these polynomials for primes p<300, but the function does not use these cached values!  They are used elsewhere in that file.\n\nI'll fix this, being careful that the precomputed cached coefficients are for the polynomials with factors of x and x-1728 removed, but there is a simple recipe for when they should be restored.\n\nAt the same time it might be sensible to replace the implementation of the computation of the polynomials from scratch with something faster.\n\nKeywords: supersingular elliptic curve\n\nBranch/Commit: 9ad618fcf0dc0c0931fabd2a7f860c42b16789dc\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30659\n\n",
    "closed_at": "2021-03-09T00:00:46Z",
    "created_at": "2020-09-25T09:50:08Z",
    "labels": [
        "component: elliptic curves",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "supersingular_j_polynomial does not use cached values",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30659",
    "user": "https://github.com/JohnCremona"
}
```
In sage.schemes.elliptic_curves.ell_finite_field.py, there is a function supersingular_j_polynomial() and also a dict cotaining the coefficients of these polynomials for primes p<300, but the function does not use these cached values!  They are used elsewhere in that file.

I'll fix this, being careful that the precomputed cached coefficients are for the polynomials with factors of x and x-1728 removed, but there is a simple recipe for when they should be restored.

At the same time it might be sensible to replace the implementation of the computation of the polynomials from scratch with something faster.

Keywords: supersingular elliptic curve

Branch/Commit: 9ad618fcf0dc0c0931fabd2a7f860c42b16789dc

Reviewer: Frédéric Chapoton

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30659





---

archive/issue_comments_606420.json:
```json
{
    "body": "<a id='comment:1'></a>\nIt's not quite as bad as I thought: the function supersingular_j_polynomial() does not use the precomputed coefficients, but the function is_j_supersingular does.\n\nI have rewired this so that supersingular_j_polynomial() uses the cached values unless a new flag (default True) is set to False, for testing, and caches any values computed.  Also the dict holding the precomputed coefficients is not filled at the top level, so it will not happen at startup to save a small amount of startup time.  Instead, it is filled the first time the dict is used, using a new function fill_ss_j_dict().",
    "created_at": "2021-02-03T14:55:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606420",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:1'></a>
It's not quite as bad as I thought: the function supersingular_j_polynomial() does not use the precomputed coefficients, but the function is_j_supersingular does.

I have rewired this so that supersingular_j_polynomial() uses the cached values unless a new flag (default True) is set to False, for testing, and caches any values computed.  Also the dict holding the precomputed coefficients is not filled at the top level, so it will not happen at startup to save a small amount of startup time.  Instead, it is filled the first time the dict is used, using a new function fill_ss_j_dict().



---

archive/issue_comments_606421.json:
```json
{
    "body": "<a id='comment:2'></a>\nReady for review.  Note that the patch only concerns programming logic, not mathematics, so can be reviewed by people not knowing anything about supersingular j polynomials, except that there is one for each prime p.\n\n---\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[e7b5b01](https://git.sagemath.org/sage.git/commit?id=e7b5b01db5275f7adaddbe42e133bb26d62259f2)|`#30659 supseringular j polynomial caching`|",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606421",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:2'></a>
Ready for review.  Note that the patch only concerns programming logic, not mathematics, so can be reviewed by people not knowing anything about supersingular j polynomials, except that there is one for each prime p.

---
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[e7b5b01](https://git.sagemath.org/sage.git/commit?id=e7b5b01db5275f7adaddbe42e133bb26d62259f2)|`#30659 supseringular j polynomial caching`|



---

archive/issue_comments_606422.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cremona/30659\"",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606422",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "" to "u/cremona/30659"



---

archive/issue_comments_606423.json:
```json
{
    "body": "Changing author from \"\" to \"John Cremona\"",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606423",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "John Cremona"



---

archive/issue_comments_606424.json:
```json
{
    "body": "Changing commit from \"\" to \"e7b5b01db5275f7adaddbe42e133bb26d62259f2\"",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606424",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "" to "e7b5b01db5275f7adaddbe42e133bb26d62259f2"



---

archive/issue_comments_606425.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-03T15:00:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606425",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_606426.json:
```json
{
    "body": "<a id='comment:3'></a>\nFixing a docstring issue....",
    "created_at": "2021-02-03T15:08:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606426",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Fixing a docstring issue....



---

archive/issue_comments_606427.json:
```json
{
    "body": "Changing commit from \"e7b5b01db5275f7adaddbe42e133bb26d62259f2\" to \"7ce7134b29269342c80f73f6b97746e1876bfa16\"",
    "created_at": "2021-02-03T15:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606427",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "e7b5b01db5275f7adaddbe42e133bb26d62259f2" to "7ce7134b29269342c80f73f6b97746e1876bfa16"



---

archive/issue_comments_606428.json:
```json
{
    "body": "<a id='comment:4'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                     |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[7ce7134](https://git.sagemath.org/sage.git/commit/?id=7ce7134b29269342c80f73f6b97746e1876bfa16)|`30659: fix indentation in docstring`|",
    "created_at": "2021-02-03T15:27:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606428",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:4'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                     |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[7ce7134](https://git.sagemath.org/sage.git/commit/?id=7ce7134b29269342c80f73f6b97746e1876bfa16)|`30659: fix indentation in docstring`|



---

archive/issue_comments_606429.json:
```json
{
    "body": "<a id='comment:5'></a>\nlooks good. a few comments\n\n```\nall([ssjpol(p,True) == ssjpol(p,False) for p in primes(300)])\n```\ncould be without `[...]`\n\nYou could put the explanations above in the doc of `fill_ss_j_dict()`\n\nThis `use_cache = True` should rather be `use_cache=True` \n\n\nMissing line break here `+    r\"\"\"Return` before Return\n\n```\n+    - `use_cache` (boolean, default True) -- use cached coefficients if they exist\n```\nshould be\n\n```\n+    - ``use_cache`` (boolean, default ``True``) -- use cached coefficients if they exist\n```",
    "created_at": "2021-02-04T16:33:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606429",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:5'></a>
looks good. a few comments

```
all([ssjpol(p,True) == ssjpol(p,False) for p in primes(300)])
```
could be without `[...]`

You could put the explanations above in the doc of `fill_ss_j_dict()`

This `use_cache = True` should rather be `use_cache=True` 


Missing line break here `+    r"""Return` before Return

```
+    - `use_cache` (boolean, default True) -- use cached coefficients if they exist
```
should be

```
+    - ``use_cache`` (boolean, default ``True``) -- use cached coefficients if they exist
```



---

archive/issue_comments_606430.json:
```json
{
    "body": "<a id='comment:6'></a>\nThanks.  I'll fix those tomorrow unless you ge there first.  I had thought that one *always* had to put spaces around an =, but clearly not!",
    "created_at": "2021-02-04T17:04:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606430",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:6'></a>
Thanks.  I'll fix those tomorrow unless you ge there first.  I had thought that one *always* had to put spaces around an =, but clearly not!



---

archive/issue_comments_606431.json:
```json
{
    "body": "Changing commit from \"7ce7134b29269342c80f73f6b97746e1876bfa16\" to \"9ad618fcf0dc0c0931fabd2a7f860c42b16789dc\"",
    "created_at": "2021-02-05T09:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606431",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7ce7134b29269342c80f73f6b97746e1876bfa16" to "9ad618fcf0dc0c0931fabd2a7f860c42b16789dc"



---

archive/issue_comments_606432.json:
```json
{
    "body": "<a id='comment:7'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                  |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|\n|[9ad618f](https://git.sagemath.org/sage.git/commit/?id=9ad618fcf0dc0c0931fabd2a7f860c42b16789dc)|`#30659: fix docstring formatting`|",
    "created_at": "2021-02-05T09:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606432",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                  |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------|
|[9ad618f](https://git.sagemath.org/sage.git/commit/?id=9ad618fcf0dc0c0931fabd2a7f860c42b16789dc)|`#30659: fix docstring formatting`|



---

archive/issue_comments_606433.json:
```json
{
    "body": "<a id='comment:8'></a>\nI hope the last commit deals with those minor issues in a satisfactory way.",
    "created_at": "2021-02-05T09:39:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606433",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:8'></a>
I hope the last commit deals with those minor issues in a satisfactory way.



---

archive/issue_comments_606434.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-05T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606434",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_606435.json:
```json
{
    "body": "<a id='comment:9'></a>\nok, thanks",
    "created_at": "2021-02-05T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606435",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
ok, thanks



---

archive/issue_comments_606436.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-02-05T10:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606436",
    "user": "https://github.com/fchapoton"
}
```

Changing reviewer from "" to "Frédéric Chapoton"



---

archive/issue_comments_606437.json:
```json
{
    "body": "Changing branch from \"u/cremona/30659\" to \"9ad618fcf0dc0c0931fabd2a7f860c42b16789dc\"",
    "created_at": "2021-03-09T00:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606437",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cremona/30659" to "9ad618fcf0dc0c0931fabd2a7f860c42b16789dc"



---

archive/issue_comments_606438.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-09T00:00:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30659#issuecomment-606438",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079748.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-09T00:00:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30659",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30659#event-79748"
}
```
