# Issue 30161: Zero Matrix has Inverse over Finite Field

archive/issues_029924.json:
```json
{
    "body": "The bug is outlined in this post: https://ask.sagemath.org/question/52487/zero-matrix-has-an-inverse-over-finite-field/\n\nIn short, the following lines of code should throw an error, but they do not.\n\n```\nM = Matrix([0], ring=GF(4))\nM.inverse()\n```\n\nInstead they return the matrix [1].\n\n\nCC:  @malb @slel\n\nKeywords: m4rie\n\nBranch/Commit: [ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)\n\nReviewer: Samuel Leli\u00e8vre\n\nAuthor: Martin Albrecht\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30161\n\n",
    "closed_at": "2020-07-28T22:32:17Z",
    "created_at": "2020-07-16T21:46:41Z",
    "labels": [
        "component: linear algebra",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Zero Matrix has Inverse over Finite Field",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30161",
    "user": "https://github.com/prismika"
}
```
The bug is outlined in this post: https://ask.sagemath.org/question/52487/zero-matrix-has-an-inverse-over-finite-field/

In short, the following lines of code should throw an error, but they do not.

```
M = Matrix([0], ring=GF(4))
M.inverse()
```

Instead they return the matrix [1].


CC:  @malb @slel

Keywords: m4rie

Branch/Commit: [ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)

Reviewer: Samuel Lelièvre

Author: Martin Albrecht

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30161





---

archive/issue_comments_593587.json:
```json
{
    "body": "<a id='comment:1'></a>\nThe source code for the `__invert__` method, revealed by\n\n```\nsage: M.__invert__??\n```\nseems to involve `mzed_invert_newton_john` from [m4rie](https://github.com/malb/m4rie).",
    "created_at": "2020-07-17T15:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593587",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'></a>
The source code for the `__invert__` method, revealed by

```
sage: M.__invert__??
```
seems to involve `mzed_invert_newton_john` from [m4rie](https://github.com/malb/m4rie).



---

archive/issue_comments_593588.json:
```json
{
    "body": "Changing keywords from \"\" to \"m4rie\".",
    "created_at": "2020-07-17T15:37:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593588",
    "user": "https://github.com/slel"
}
```

Changing keywords from "" to "m4rie".



---

archive/issue_comments_593589.json:
```json
{
    "body": "<a id='comment:2'></a>\nYep, that's a bug in m4rie:\n\n```\nmzed_t *mzed_invert_newton_john(mzed_t *B, const mzed_t *A) {\n  assert(A->nrows == A->ncols);\n  mzed_t *I = mzed_init(A->finite_field, A->nrows, A->ncols);\n  mzed_set_ui(I, 1);\n  mzed_t *T = mzed_concat(NULL, A, I);\n  mzed_free(I);\n\n  rci_t r = mzed_echelonize_newton_john(T, 1);\n  if (r != A->nrows) \n    m4ri_die(\"mzed_invert_newton_john: input matrix does not have full rank.\");\n  B = mzed_submatrix(B, T, 0, A->ncols, A->nrows, T->ncols);\n  mzed_free(T);\n  return B;\n}\n```\n\n\nWe first add an identity matrix and then check if the whole thing has full rank, which is nonsense.",
    "created_at": "2020-07-17T16:38:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593589",
    "user": "https://github.com/malb"
}
```

<a id='comment:2'></a>
Yep, that's a bug in m4rie:

```
mzed_t *mzed_invert_newton_john(mzed_t *B, const mzed_t *A) {
  assert(A->nrows == A->ncols);
  mzed_t *I = mzed_init(A->finite_field, A->nrows, A->ncols);
  mzed_set_ui(I, 1);
  mzed_t *T = mzed_concat(NULL, A, I);
  mzed_free(I);

  rci_t r = mzed_echelonize_newton_john(T, 1);
  if (r != A->nrows) 
    m4ri_die("mzed_invert_newton_john: input matrix does not have full rank.");
  B = mzed_submatrix(B, T, 0, A->ncols, A->nrows, T->ncols);
  mzed_free(T);
  return B;
}
```


We first add an identity matrix and then check if the whole thing has full rank, which is nonsense.



---

archive/issue_comments_593590.json:
```json
{
    "body": "Branch: [u/malb/ticket-30161](https://github.com/sagemath/sagetrac-mirror/tree/u/malb/ticket-30161)",
    "created_at": "2020-07-17T16:42:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593590",
    "user": "https://github.com/malb"
}
```

Branch: [u/malb/ticket-30161](https://github.com/sagemath/sagetrac-mirror/tree/u/malb/ticket-30161)



---

archive/issue_comments_593591.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-17T16:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593591",
    "user": "https://github.com/malb"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_593592.json:
```json
{
    "body": "Commit: [ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)",
    "created_at": "2020-07-17T16:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593592",
    "user": "https://github.com/malb"
}
```

Commit: [ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)



---

archive/issue_comments_593593.json:
```json
{
    "body": "<a id='comment:4'></a>\nNew commits:\n|                                                                                                                                          |                             |\n|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|\n|[ccaf79d](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)|`check rank before inverting`|",
    "created_at": "2020-07-17T16:42:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593593",
    "user": "https://github.com/malb"
}
```

<a id='comment:4'></a>
New commits:
|                                                                                                                                          |                             |
|------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------|
|[ccaf79d](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)|`check rank before inverting`|



---

archive/issue_comments_593594.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-17T17:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593594",
    "user": "https://github.com/slel"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_593595.json:
```json
{
    "body": "Reviewer: Samuel Leli\u00e8vre",
    "created_at": "2020-07-17T17:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593595",
    "user": "https://github.com/slel"
}
```

Reviewer: Samuel Lelièvre



---

archive/issue_comments_593596.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks!",
    "created_at": "2020-07-17T17:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593596",
    "user": "https://github.com/slel"
}
```

<a id='comment:5'></a>
Thanks!



---

archive/issue_comments_593597.json:
```json
{
    "body": "Author: Martin Albrecht",
    "created_at": "2020-07-17T17:06:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593597",
    "user": "https://github.com/slel"
}
```

Author: Martin Albrecht



---

archive/issue_comments_593598.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-07-28T22:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593598",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_593599.json:
```json
{
    "body": "Changing branch from \"[u/malb/ticket-30161](https://github.com/sagemath/sagetrac-mirror/tree/u/malb/ticket-30161)\" to \"[ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)\"",
    "created_at": "2020-07-28T22:32:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30161#issuecomment-593599",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/malb/ticket-30161](https://github.com/sagemath/sagetrac-mirror/tree/u/malb/ticket-30161)" to "[ccaf79dcb9dd7f34d26b7334c52eb32e619b0811](https://github.com/sagemath/sagetrac-mirror/commit/ccaf79dcb9dd7f34d26b7334c52eb32e619b0811)"



---

archive/issue_events_087705.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-07-28T22:32:17Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30161",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30161#event-87705"
}
```
