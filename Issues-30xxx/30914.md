# Issue 30914: Meta-ticket: Create upstream repositories, pip-installable packages for database packages

archive/issues_030677.json:
```json
{
    "body": "CC:  @mkoeppe @jhpalmieri @kiwifb @isuruf @antonio-rojas @dimpase @slel @tobihan @jamesjer @soehms @videlec @williamstein @roed314\n\nKeywords: sd111\n\nThe Sage distribution contains a number of \"database packages\", many of which do not seem to have a \"real upstream\" (or installation procedures other than our scripts in build/pkgs).\n\nWe transform them into pip-installable packages and publish them to PyPI so that they can be installed using standard Python tools (and become Python dependencies of sagelib) and then discovered by libraries using standard Python facilities.\n\nRole model: https://pypi.org/project/database-knotinfo/\n\nFor those that do not have a real upstream, we create separate git repositories in github.com/sagemath/ to serve as new upstream.\n\nList of packages/tickets:\n\nArchitecture independent:\n\n- #33881 New upstream for `database_stein_watkins`\n- `combinatorial_designs` (single text file `MOLS_table.txt`), 8 kB, https://repology.org/project/sagemath-combinatorial-designs/versions\n- `graphs` (`graphs.db`, `brouwer_srg_database.json`, `smallgraphs.txt`, `isgci_sage.xml`), 336 kB; the `SPKG.rst` explains: The code used to parse the data from Andries E. Brouwer's website is available at https://github.com/nathanncohen/strongly_regular_graphs_database\n- `polytopes_db` (various files), 41 kB\n- `polytopes_db_4d` (various files), 878 MB\n\nPrepared files:\n\n- #32747: `conway_polynomials`\n- elliptic_curves\n\nNew data sources:\n\n- #30352 Interface to the KnotInfo and LinkInfo databases\n- `database_graver_ppi` - https://www.math.ucdavis.edu/~mkoeppe/art/ppi/index.html\n- https://mathdb.mathhub.info/\n- https://swmath.org/\n\nRelated (other stuff written by the Sage distribution into $SAGE_SHARE): \n- #30306 - jupyter notebook related things\n- #20080 - documentation\n- #30885 - `sage.features`\n\nTechniques:\n- `importlib.resources` - would help making a distribution `zip_safe` (#31306)\n- could consider advertise install location using a pkgconfig file: #30787#comment:24 \n- Reduce local duplication of large database package when venvs are in use: https://pypi.org/project/pydupes/ (similar to rdfind)\n- Avoid duplicate installation by using [PEP 660 editable wheels](https://peps.python.org/pep-0660/). Use a build backend that supports it: flit, pdm, hatchling, poetry, not setuptools. https://discuss.python.org/t/pep-660-and-setuptools/14855\n- However there are [implementation restrictions in the interaction of editable wheels and implicit namespace packages](https://github.com/pfmoore/editables/blob/main/docs/source/implementation.md#import-hooks)\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30914\n\n",
    "created_at": "2020-11-14T18:51:24Z",
    "labels": [
        "component: build"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "Meta-ticket: Create upstream repositories, pip-installable packages for database packages",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30914",
    "user": "https://github.com/tobiasdiez"
}
```
CC:  @mkoeppe @jhpalmieri @kiwifb @isuruf @antonio-rojas @dimpase @slel @tobihan @jamesjer @soehms @videlec @williamstein @roed314

Keywords: sd111

The Sage distribution contains a number of "database packages", many of which do not seem to have a "real upstream" (or installation procedures other than our scripts in build/pkgs).

We transform them into pip-installable packages and publish them to PyPI so that they can be installed using standard Python tools (and become Python dependencies of sagelib) and then discovered by libraries using standard Python facilities.

Role model: https://pypi.org/project/database-knotinfo/

For those that do not have a real upstream, we create separate git repositories in github.com/sagemath/ to serve as new upstream.

List of packages/tickets:

Architecture independent:

- #33881 New upstream for `database_stein_watkins`
- `combinatorial_designs` (single text file `MOLS_table.txt`), 8 kB, https://repology.org/project/sagemath-combinatorial-designs/versions
- `graphs` (`graphs.db`, `brouwer_srg_database.json`, `smallgraphs.txt`, `isgci_sage.xml`), 336 kB; the `SPKG.rst` explains: The code used to parse the data from Andries E. Brouwer's website is available at https://github.com/nathanncohen/strongly_regular_graphs_database
- `polytopes_db` (various files), 41 kB
- `polytopes_db_4d` (various files), 878 MB

Prepared files:

- #32747: `conway_polynomials`
- elliptic_curves

New data sources:

- #30352 Interface to the KnotInfo and LinkInfo databases
- `database_graver_ppi` - https://www.math.ucdavis.edu/~mkoeppe/art/ppi/index.html
- https://mathdb.mathhub.info/
- https://swmath.org/

Related (other stuff written by the Sage distribution into $SAGE_SHARE): 
- #30306 - jupyter notebook related things
- #20080 - documentation
- #30885 - `sage.features`

Techniques:
- `importlib.resources` - would help making a distribution `zip_safe` (#31306)
- could consider advertise install location using a pkgconfig file: #30787#comment:24 
- Reduce local duplication of large database package when venvs are in use: https://pypi.org/project/pydupes/ (similar to rdfind)
- Avoid duplicate installation by using [PEP 660 editable wheels](https://peps.python.org/pep-0660/). Use a build backend that supports it: flit, pdm, hatchling, poetry, not setuptools. https://discuss.python.org/t/pep-660-and-setuptools/14855
- However there are [implementation restrictions in the interaction of editable wheels and implicit namespace packages](https://github.com/pfmoore/editables/blob/main/docs/source/implementation.md#import-hooks)





Issue created by migration from https://trac.sagemath.org/ticket/30914





---

archive/issue_comments_438103.json:
```json
{
    "body": "Which files, specifically?",
    "created_at": "2020-11-14T19:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438103",
    "user": "https://github.com/mkoeppe"
}
```

Which files, specifically?



---

archive/issue_comments_438104.json:
```json
{
    "body": "If you are talking about database packages such as `build/pkgs/conway_polynomials`, in particular those that do not seem to have a \"real upstream\" (or installation procedures other than our scripts in build/pkgs), then yes, I agree that a possible direction would be to create pip-installable packages for them and to publish them to PyPI. They should be maintained outside of the source tree, each in a separate git repository.",
    "created_at": "2020-11-14T20:17:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438104",
    "user": "https://github.com/mkoeppe"
}
```

If you are talking about database packages such as `build/pkgs/conway_polynomials`, in particular those that do not seem to have a "real upstream" (or installation procedures other than our scripts in build/pkgs), then yes, I agree that a possible direction would be to create pip-installable packages for them and to publish them to PyPI. They should be maintained outside of the source tree, each in a separate git repository.



---

archive/issue_comments_438105.json:
```json
{
    "body": "If this is what you had in mind, let's transform this ticket into a meta-ticket and get the downstream packagers of Sage on board -- they may have insights on the upstream status of some of these packages, which we may have forgotten about.",
    "created_at": "2020-11-14T20:19:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438105",
    "user": "https://github.com/mkoeppe"
}
```

If this is what you had in mind, let's transform this ticket into a meta-ticket and get the downstream packagers of Sage on board -- they may have insights on the upstream status of some of these packages, which we may have forgotten about.



---

archive/issue_comments_438106.json:
```json
{
    "body": "Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about\n* combinatorial_designs\n* conway_polynomials\n* elliptic_curves\n* graphs\n* polytopes_db\n* plus some other optional packages\nThey are indeed static but come in two flavors. \n\nArchitecture independent:\n* combinatorial_designs\n* graphs\n* polytopes_db\nwhich are really file copying.\n\nPrepared files\n* conway_polynomials\n* elliptic_curves\nwhere the files are processed before install with some python code that may be depending on python or some other software. \n\n`conway_polynomials` uses `pickle.dump` which could pose problems across python versions?\n\n`elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?",
    "created_at": "2020-11-14T20:49:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438106",
    "user": "https://github.com/kiwifb"
}
```

Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about
* combinatorial_designs
* conway_polynomials
* elliptic_curves
* graphs
* polytopes_db
* plus some other optional packages
They are indeed static but come in two flavors. 

Architecture independent:
* combinatorial_designs
* graphs
* polytopes_db
which are really file copying.

Prepared files
* conway_polynomials
* elliptic_curves
where the files are processed before install with some python code that may be depending on python or some other software. 

`conway_polynomials` uses `pickle.dump` which could pose problems across python versions?

`elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?



---

archive/issue_comments_438107.json:
```json
{
    "body": "OK, I've taken the liberty to rewrite the ticket description",
    "created_at": "2020-11-14T20:51:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438107",
    "user": "https://github.com/mkoeppe"
}
```

OK, I've taken the liberty to rewrite the ticket description



---

archive/issue_comments_438108.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> Prepared files\n> * conway_polynomials\n> * elliptic_curves\n> where the files are processed before install with some python code that may be depending on python or some other software. \n> \n> `conway_polynomials` uses `pickle.dump` which could pose problems across python versions?\n> \n> `elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?\n\n\nFor these ones, we should make the actual source distribution architecture-independent.\nThe architecture-dependent products could be built during setup.py - and published as wheels.",
    "created_at": "2020-11-14T20:53:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438108",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:4 fbissey]:
> Prepared files
> * conway_polynomials
> * elliptic_curves
> where the files are processed before install with some python code that may be depending on python or some other software. 
> 
> `conway_polynomials` uses `pickle.dump` which could pose problems across python versions?
> 
> `elliptic_curves` is put into a SQL database with sqlite, this should be a stable format. Don't know if that's portable between, say, x86_64 and ppc64le?


For these ones, we should make the actual source distribution architecture-independent.
The architecture-dependent products could be built during setup.py - and published as wheels.



---

archive/issue_comments_438109.json:
```json
{
    "body": "For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct",
    "created_at": "2020-11-14T20:54:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438109",
    "user": "https://github.com/mkoeppe"
}
```

For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct



---

archive/issue_comments_438110.json:
```json
{
    "body": "One thing that may need discussion is that for huge databases, one may want to avoid installing multiple copies",
    "created_at": "2020-11-14T20:57:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438110",
    "user": "https://github.com/mkoeppe"
}
```

One thing that may need discussion is that for huge databases, one may want to avoid installing multiple copies



---

archive/issue_comments_438111.json:
```json
{
    "body": "Replying to [comment:7 mkoeppe]:\n> For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct\n\n\nIt's at https://wstein.org/papers/stein-watkins/",
    "created_at": "2020-11-14T22:02:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438111",
    "user": "https://github.com/slel"
}
```

Replying to [comment:7 mkoeppe]:
> For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct


It's at https://wstein.org/papers/stein-watkins/



---

archive/issue_comments_438112.json:
```json
{
    "body": "Replying to [comment:4 fbissey]:\n> Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about ...\n\n\n\nYes, that's exactly what I meant! Thanks everybody for their input, that's already way better than what I've imagined originally.",
    "created_at": "2020-11-14T22:50:33Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438112",
    "user": "https://github.com/tobiasdiez"
}
```

Replying to [comment:4 fbissey]:
> Yes, a confirmation of which bits would be nice. If `@`mkoeppe is right you are talking about ...



Yes, that's exactly what I meant! Thanks everybody for their input, that's already way better than what I've imagined originally.



---

archive/issue_comments_438113.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T17:48:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438113",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_events_080709.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T02:04:25Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80709"
}
```



---

archive/issue_comments_438114.json:
```json
{
    "body": "Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-03-24T02:04:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438114",
    "user": "https://github.com/mkoeppe"
}
```

Sage development has entered the release candidate phase for 9.3. Setting a new milestone for this ticket based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_080710.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80710"
}
```



---

archive/issue_events_080711.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T01:16:42Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80711"
}
```



---

archive/issue_comments_438115.json:
```json
{
    "body": "For #32432 (**sagemath-polyhedra**), pip-installable `polytopes_db`, `polytopes_db_4d` would be good",
    "created_at": "2021-10-06T06:49:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438115",
    "user": "https://github.com/mkoeppe"
}
```

For #32432 (**sagemath-polyhedra**), pip-installable `polytopes_db`, `polytopes_db_4d` would be good



---

archive/issue_events_080712.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80712"
}
```



---

archive/issue_events_080713.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80713"
}
```



---

archive/issue_events_080714.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80714"
}
```



---

archive/issue_events_080715.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80715"
}
```



---

archive/issue_comments_438116.json:
```json
{
    "body": "Replying to [comment:10 slelievre]:\n> Replying to [comment:7 mkoeppe]:\n> > For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct\n\n> \n> It's at https://wstein.org/papers/stein-watkins/\n\n\nThe link \"Click here for the database\" (https://wstein.org/ecdb) and \"Our database\" (https://wstein.org/papers/stein-watkins/ecdb) are both broken",
    "created_at": "2022-05-21T23:32:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30914#issuecomment-438116",
    "user": "https://github.com/mkoeppe"
}
```

Replying to [comment:10 slelievre]:
> Replying to [comment:7 mkoeppe]:
> > For example `database_stein_watkins_mini`'s SPKG.rst lists http://modular.math.washington.edu/papers/stein-watkins/ as upstream or source, which is defunct

> 
> It's at https://wstein.org/papers/stein-watkins/


The link "Click here for the database" (https://wstein.org/ecdb) and "Our database" (https://wstein.org/papers/stein-watkins/ecdb) are both broken



---

archive/issue_events_080716.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80716"
}
```



---

archive/issue_events_080717.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30914",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30914#event-80717"
}
```
