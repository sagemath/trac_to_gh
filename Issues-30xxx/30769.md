# Issue 30769: Unify graph backends

archive/issues_030532.json:
```json
{
    "body": "CC:  @videlec @dimpase @dcoudert @slel\n\nKeywords: graph backend\n\nThis is a follow up to #28896.\n\nWe further unify the behavior of dense and sparse (dynamic) graph backends.\n\nAdding and deleting edges now share common methods.\n\nIn particular, `DenseCGraph` and `SparseCGraph` also behave the same in the following way now:\n\n- adding an arc will add both directions, if the graph is undirected\n- deleting an arc will delete both directions, ...\n\nNote that this ticket is also a step towards #28259:\n\nComparison:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: import igraph\nsage: g = igraph.Graph()\nsage: g.add_vertices(1001)\nsage: sleep(1)\nsage: %time g.add_edges(edges)\nCPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms\nWall time: 10.6 ms\n```\n\nBefore:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 69 ms, sys: 38 \u00b5s, total: 69 ms\nWall time: 68.7 ms\nsage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms\nWall time: 32 ms\n```\n\nAfter:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 32.8 ms, sys: 38 \u00b5s, total: 32.8 ms\nWall time: 32.8 ms\nsage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms\nWall time: 14.6 ms\n```\n\nIssue created by migration from https://trac.sagemath.org/ticket/30769\n\n",
    "closed_at": "2020-11-01T00:42:37Z",
    "created_at": "2020-10-14T09:08:45Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Unify graph backends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30769",
    "user": "https://github.com/kliem"
}
```
CC:  @videlec @dimpase @dcoudert @slel

Keywords: graph backend

This is a follow up to #28896.

We further unify the behavior of dense and sparse (dynamic) graph backends.

Adding and deleting edges now share common methods.

In particular, `DenseCGraph` and `SparseCGraph` also behave the same in the following way now:

- adding an arc will add both directions, if the graph is undirected
- deleting an arc will delete both directions, ...

Note that this ticket is also a step towards #28259:

Comparison:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: import igraph
sage: g = igraph.Graph()
sage: g.add_vertices(1001)
sage: sleep(1)
sage: %time g.add_edges(edges)
CPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms
Wall time: 10.6 ms
```

Before:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 69 ms, sys: 38 µs, total: 69 ms
Wall time: 68.7 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms
Wall time: 32 ms
```

After:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 32.8 ms, sys: 38 µs, total: 32.8 ms
Wall time: 32.8 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms
Wall time: 14.6 ms
```

Issue created by migration from https://trac.sagemath.org/ticket/30769





---

archive/issue_comments_435545.json:
```json
{
    "body": "Note that I waited about a second between creating the graphs and timing each time. If you hit the next time too fast, I got a slowdown in each case.",
    "created_at": "2020-10-14T09:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435545",
    "user": "https://github.com/kliem"
}
```

Note that I waited about a second between creating the graphs and timing each time. If you hit the next time too fast, I got a slowdown in each case.



---

archive/issue_comments_435546.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-14T09:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435546",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_435547.json:
```json
{
    "body": "Replying to [comment:1 gh-kliem]:\n> Note that I waited about a second between creating the graphs\n> and timing each time. If you hit the next `%time` too fast,\n> I got a slowdown in each case.\n\n\nI added corresponding `sleep(1)` lines to the code blocks\nin the ticket description.  : )",
    "created_at": "2020-10-14T10:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435547",
    "user": "https://github.com/slel"
}
```

Replying to [comment:1 gh-kliem]:
> Note that I waited about a second between creating the graphs
> and timing each time. If you hit the next `%time` too fast,
> I got a slowdown in each case.


I added corresponding `sleep(1)` lines to the code blocks
in the ticket description.  : )



---

archive/issue_events_080224.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-14T11:06:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30769#event-80224"
}
```



---

archive/issue_comments_435548.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-14T12:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435548",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_435549.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-14T19:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435549",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_435550.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-15T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435550",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_435551.json:
```json
{
    "body": "For me this patch is good to go. Thank you.",
    "created_at": "2020-10-15T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435551",
    "user": "https://github.com/dcoudert"
}
```

For me this patch is good to go. Thank you.



---

archive/issue_comments_435552.json:
```json
{
    "body": "Thank you for reviewing.",
    "created_at": "2020-10-15T09:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435552",
    "user": "https://github.com/kliem"
}
```

Thank you for reviewing.



---

archive/issue_comments_435553.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-01T00:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-435553",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080225.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-01T00:42:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30769#event-80225"
}
```
