# Issue 30769: Unify graph backends

archive/issues_030532.json:
```json
{
    "body": "This is a follow up to #28896.\n\nWe further unify the behavior of dense and sparse (dynamic) graph backends.\n\nAdding and deleting edges now share common methods.\n\nIn particular, `DenseCGraph` and `SparseCGraph` also behave the same in the following way now:\n\n- adding an arc will add both directions, if the graph is undirected\n- deleting an arc will delete both directions, ...\n\nNote that this ticket is also a step towards #28259:\n\nComparison:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: import igraph\nsage: g = igraph.Graph()\nsage: g.add_vertices(1001)\nsage: sleep(1)\nsage: %time g.add_edges(edges)\nCPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms\nWall time: 10.6 ms\n```\n\nBefore:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 69 ms, sys: 38 \u00b5s, total: 69 ms\nWall time: 68.7 ms\nsage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms\nWall time: 32 ms\n```\n\nAfter:\n\n```\nsage: set_random_seed(0)\nsage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\nsage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 32.8 ms, sys: 38 \u00b5s, total: 32.8 ms\nWall time: 32.8 ms\nsage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\nsage: sleep(1)\nsage: %time D.add_edges(edges)\nCPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms\nWall time: 14.6 ms\n```\n\nCC:  @videlec @dimpase @dcoudert @slel\n\nKeywords: graph backend\n\nBranch/Commit: 66b3dde8bdfe64172a63586ae9112562e82f7e4e\n\nReviewer: David Coudert\n\nAuthor: Jonathan Kliem\n\nDependencies: #30665\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30769\n\n",
    "closed_at": "2020-11-01T00:42:37Z",
    "created_at": "2020-10-14T09:08:45Z",
    "labels": [
        "component: graph theory"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Unify graph backends",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30769",
    "user": "https://github.com/kliem"
}
```
This is a follow up to #28896.

We further unify the behavior of dense and sparse (dynamic) graph backends.

Adding and deleting edges now share common methods.

In particular, `DenseCGraph` and `SparseCGraph` also behave the same in the following way now:

- adding an arc will add both directions, if the graph is undirected
- deleting an arc will delete both directions, ...

Note that this ticket is also a step towards #28259:

Comparison:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: import igraph
sage: g = igraph.Graph()
sage: g.add_vertices(1001)
sage: sleep(1)
sage: %time g.add_edges(edges)
CPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms
Wall time: 10.6 ms
```

Before:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 69 ms, sys: 38 µs, total: 69 ms
Wall time: 68.7 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms
Wall time: 32 ms
```

After:

```
sage: set_random_seed(0)
sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 32.8 ms, sys: 38 µs, total: 32.8 ms
Wall time: 32.8 ms
sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
sage: sleep(1)
sage: %time D.add_edges(edges)
CPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms
Wall time: 14.6 ms
```

CC:  @videlec @dimpase @dcoudert @slel

Keywords: graph backend

Branch/Commit: 66b3dde8bdfe64172a63586ae9112562e82f7e4e

Reviewer: David Coudert

Author: Jonathan Kliem

Dependencies: #30665

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30769





---

archive/issue_comments_465171.json:
```json
{
    "body": "<a id='comment:1'></a>Note that I waited about a second between creating the graphs and timing each time. If you hit the next time too fast, I got a slowdown in each case.",
    "created_at": "2020-10-14T09:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465171",
    "user": "https://github.com/kliem"
}
```

<a id='comment:1'></a>Note that I waited about a second between creating the graphs and timing each time. If you hit the next time too fast, I got a slowdown in each case.



---

archive/issue_comments_465172.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-10-14T09:10:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465172",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_465173.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -15,11 +15,12 @@\n \n ```\n sage: set_random_seed(0)\n-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  \n-sage: import igraph                                                                                                                                                                                                                                                                                                                                                        \n-sage: g = igraph.Graph()                                                                                                                                                                                                                                                                                                                                                   \n-sage: g.add_vertices(1001)                                                                                                                                                                                                                                                                                                                                                 \n-sage: %time g.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             \n+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\n+sage: import igraph\n+sage: g = igraph.Graph()\n+sage: g.add_vertices(1001)\n+sage: sleep(1)\n+sage: %time g.add_edges(edges)\n CPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms\n Wall time: 10.6 ms\n ```\n@@ -28,13 +29,15 @@\n \n ```\n sage: set_random_seed(0)\n-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  \n-sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                \n-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             \n+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\n+sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\n+sage: sleep(1)\n+sage: %time D.add_edges(edges)\n CPU times: user 69 ms, sys: 38 \u00b5s, total: 69 ms\n Wall time: 68.7 ms\n-sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 \n-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             \n+sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\n+sage: sleep(1)\n+sage: %time D.add_edges(edges)\n CPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms\n Wall time: 32 ms\n ```\n@@ -42,14 +45,16 @@\n After:\n \n ```\n-sage: set_random_seed(0)                                                                                                                                                                                                                                                                                                                                                   \n-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  \n-sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                \n-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             \n+sage: set_random_seed(0)\n+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]\n+sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))\n+sage: sleep(1)\n+sage: %time D.add_edges(edges)\n CPU times: user 32.8 ms, sys: 38 \u00b5s, total: 32.8 ms\n Wall time: 32.8 ms\n-sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 \n-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             \n+sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))\n+sage: sleep(1)\n+sage: %time D.add_edges(edges)\n CPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms\n Wall time: 14.6 ms\n ```\n``````\n",
    "created_at": "2020-10-14T10:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465173",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -15,11 +15,12 @@
 
 ```
 sage: set_random_seed(0)
-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
-sage: import igraph                                                                                                                                                                                                                                                                                                                                                        
-sage: g = igraph.Graph()                                                                                                                                                                                                                                                                                                                                                   
-sage: g.add_vertices(1001)                                                                                                                                                                                                                                                                                                                                                 
-sage: %time g.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
+sage: import igraph
+sage: g = igraph.Graph()
+sage: g.add_vertices(1001)
+sage: sleep(1)
+sage: %time g.add_edges(edges)
 CPU times: user 10.5 ms, sys: 0 ns, total: 10.5 ms
 Wall time: 10.6 ms
 ```
@@ -28,13 +29,15 @@
 
 ```
 sage: set_random_seed(0)
-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
-sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                
-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
+sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
+sage: sleep(1)
+sage: %time D.add_edges(edges)
 CPU times: user 69 ms, sys: 38 µs, total: 69 ms
 Wall time: 68.7 ms
-sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 
-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
+sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
+sage: sleep(1)
+sage: %time D.add_edges(edges)
 CPU times: user 32.3 ms, sys: 0 ns, total: 32.3 ms
 Wall time: 32 ms
 ```
@@ -42,14 +45,16 @@
 After:
 
 ```
-sage: set_random_seed(0)                                                                                                                                                                                                                                                                                                                                                   
-sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]                                                                                                                                                                                                                                                                                                  
-sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                                
-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
+sage: set_random_seed(0)
+sage: edges = [(randint(0,1000), randint(0,1000)) for _ in range(100000)]
+sage: D = DiGraph(multiedges=True, loops=True); D.add_vertices(range(1001))
+sage: sleep(1)
+sage: %time D.add_edges(edges)
 CPU times: user 32.8 ms, sys: 38 µs, total: 32.8 ms
 Wall time: 32.8 ms
-sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))                                                                                                                                                                                                                                                                                 
-sage: %time D.add_edges(edges)                                                                                                                                                                                                                                                                                                                                             
+sage: D = DiGraph(multiedges=False, loops=True, sparse=False); D.add_vertices(range(1001))
+sage: sleep(1)
+sage: %time D.add_edges(edges)
 CPU times: user 14.6 ms, sys: 0 ns, total: 14.6 ms
 Wall time: 14.6 ms
 ```
``````




---

archive/issue_comments_465174.json:
```json
{
    "body": "<a id='comment:3'></a>Replying to [comment:1 gh-kliem]:\n> Note that I waited about a second between creating the graphs\n> and timing each time. If you hit the next `%time` too fast,\n> I got a slowdown in each case.\n\n\nI added corresponding `sleep(1)` lines to the code blocks\nin the ticket description.  : )",
    "created_at": "2020-10-14T10:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465174",
    "user": "https://github.com/slel"
}
```

<a id='comment:3'></a>Replying to [comment:1 gh-kliem]:
> Note that I waited about a second between creating the graphs
> and timing each time. If you hit the next `%time` too fast,
> I got a slowdown in each case.


I added corresponding `sleep(1)` lines to the code blocks
in the ticket description.  : )



---

archive/issue_events_080224.json:
```json
{
    "actor": "https://github.com/kliem",
    "created_at": "2020-10-14T11:06:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30769#event-80224"
}
```



---

archive/issue_comments_465175.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-10-14T12:50:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465175",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_465176.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-14T19:44:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465176",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465177.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-10-15T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465177",
    "user": "https://github.com/dcoudert"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_465178.json:
```json
{
    "body": "<a id='comment:7'></a>For me this patch is good to go. Thank you.",
    "created_at": "2020-10-15T09:27:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465178",
    "user": "https://github.com/dcoudert"
}
```

<a id='comment:7'></a>For me this patch is good to go. Thank you.



---

archive/issue_comments_465179.json:
```json
{
    "body": "<a id='comment:8'></a>Thank you for reviewing.",
    "created_at": "2020-10-15T09:27:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465179",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>Thank you for reviewing.



---

archive/issue_comments_465180.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-01T00:42:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30769#issuecomment-465180",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080225.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-01T00:42:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30769",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30769#event-80225"
}
```
