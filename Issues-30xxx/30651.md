# Issue 30651: Meta-ticket: support macOS 11 Big Sur

archive/issues_030414.json:
```json
{
    "assignees": [],
    "body": "This is to support macOS 11 Big Sur.\n\n- #30752 gmp instead of mpir\n- #30929 GH Actions: Update macos test environments\n- #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local\n- #31050 upgrade wheel\n- `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n- #31128 MR50: Upgrade cffi to 1.14.4\n- #31134 upgrade setuptools and setuptools_scm\n- #30589 Upgrade Python to 3.9.1, pip to 20.3.3\n- #31166 numpy: Fix for macOS 11 (Big Sur)\n- #31183 scipy: fix for macOS 11 (Big Sur)\n- #31326 `homebrew-macos-11.0-xcode-minimal`: `scipy` build fails\t\n\nRelated:\n\n- #30494: Meta-ticket: Support Xcode 12\n- #30592: Meta-ticket: Port to Apple silicon\n\nReferences:\n- https://bugs.python.org/issue41116\n- https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ\n\n\nDepends on #30494\n\nCC:  @dimpase @jhpalmieri @mkoeppe @slel @vbraun @williamstein\n\nKeywords: **macOS**\n\nComponent: **porting**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30651_\n\n",
    "closed_at": "2021-06-24T20:15:37Z",
    "created_at": "2020-09-24T11:30:59Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20porting",
        "https://github.com/sagemath/sage/labels/enhancement",
        "https://github.com/sagemath/sage/labels/invalid"
    ],
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Meta-ticket: support macOS 11 Big Sur",
    "type": "issue",
    "updated_at": "2021-06-24T20:15:37Z",
    "url": "https://github.com/sagemath/sage/issues/30651",
    "user": "https://github.com/slel"
}
```
This is to support macOS 11 Big Sur.

- #30752 gmp instead of mpir
- #30929 GH Actions: Update macos test environments
- #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local
- #31050 upgrade wheel
- `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
- #31128 MR50: Upgrade cffi to 1.14.4
- #31134 upgrade setuptools and setuptools_scm
- #30589 Upgrade Python to 3.9.1, pip to 20.3.3
- #31166 numpy: Fix for macOS 11 (Big Sur)
- #31183 scipy: fix for macOS 11 (Big Sur)
- #31326 `homebrew-macos-11.0-xcode-minimal`: `scipy` build fails	

Related:

- #30494: Meta-ticket: Support Xcode 12
- #30592: Meta-ticket: Port to Apple silicon

References:
- https://bugs.python.org/issue41116
- https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ


Depends on #30494

CC:  @dimpase @jhpalmieri @mkoeppe @slel @vbraun @williamstein

Keywords: **macOS**

Component: **porting**

_Issue created by migration from https://trac.sagemath.org/ticket/30651_





---

archive/issue_events_424675.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-24T11:30:59Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424675"
}
```



---

archive/issue_events_424676.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-24T11:30:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20porting",
    "label_color": "000080",
    "label_name": "c: porting",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424676"
}
```



---

archive/issue_events_424677.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-24T11:30:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424677"
}
```



---

archive/issue_events_424678.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2020-09-24T11:30:59Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424678"
}
```



---

archive/issue_events_424679.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-09-24T12:00:05Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424679"
}
```



---

archive/issue_events_424680.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2020-09-24T12:00:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424680"
}
```



---

archive/issue_comments_489158.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,3 +5,8 @@\n Related:\n \n - #30494: Meta-ticket: Support Xcode 12\n+\n+References:\n+- https://bugs.python.org/issue41116\n+\n+\n``````\n",
    "created_at": "2020-09-24T13:04:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489158",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,3 +5,8 @@
 Related:
 
 - #30494: Meta-ticket: Support Xcode 12
+
+References:
+- https://bugs.python.org/issue41116
+
+
``````




---

archive/issue_comments_489159.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nI'm trying to compile sage-9.2.rc0 on big sur with xcode 12.0.1. \n\nI ran `sage -f openblas`. Here's the tail of that:\n\n(see the openblas attachment).\n\nAfter trying lots of things such as\n\n```\n$ ./configure \\\n  --enable-universalsdk=$(xcodebuild -version -sdk macosx Path) \\\n  --with-universal-archs=intel-64\n$ source /Users/wdj/sagefiles/sage-9.2.rc0/.homebrew-build-env\n$ ./config.status --recheck && ./config.status\n$ ./sage -f gfortran\n```\nthe compilation of `sage -f gfortran` stopped with an error compiling R.\n\nHowever, Sage did start and crash with this error:\n\n```\nwdj@jeeves sage-9.2.rc0 % ./sage\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 SageMath version 9.2.rc0, Release Date: 2020-10-05                 \u2502\n\u2502 Using Python 3.8.5. Type \"help()\" for help.                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n---------------------------------------------------------------------------\nModuleNotFoundErrorPython 3.8.5:\n/Users/wdj/sagefiles/sage-9.2.rc0/local/bin/python3\nThu Oct  8 13:27:16 2020\nA problem occurred executing Python code.  Here is the sequence of function\ncalls leading up to the error, with the most recent (innermost) call last.\n```\n(for the rest, see the error-in-start attachment).\n\nIt looks like Sage's Python doesn't work, right? Wrong:\n\n```\nwdj@jeeves sage-9.2.rc0 % ./sage -python3\nPython 3.8.5 (default, Oct  7 2020, 13:59:53)\n[Clang 12.0.0 (clang-1200.0.32.2)] on darwin\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\n>>> 2+3\n5\n```\nIn case it's any use, here is what homebrew claims it has installed:\n\n```\nwdj@jeeves sage-9.2.rc0 % brew list --versions\nautoconf 2.69\nautomake 1.16.1_1\nbdw-gc 8.0.4\nboost 1.71.0\ncmake 3.15.5\nfontconfig 2.13.1\nfreetype 2.10.1\ngcc 9.2.0_1\ngd 2.2.5\ngettext 0.20.1 0.21\ngmp 6.2.0 6.1.2_2\ngnutls 3.6.15\ngpatch 2.7.6\nguile 3.0.4\nicu4c 64.2\nisl 0.22.1 0.21\njpeg 9c\nlibde265 1.0.3\nlibdvdcss 1.4.2\nlibevent 2.1.12\nlibffi 3.3 3.2.1\nlibidn2 2.3.0 2.2.0_1\nlibmpc 1.1.0 1.2.0\nlibomp 9.0.0\nlibpng 1.6.37\nlibtasn1 4.14 4.16.0\nlibtiff 4.0.10_1\nlibtool 2.4.6_1 2.4.6_2\nlibunistring 0.9.10\nlibyaml 0.2.5\nmpfi 1.5.3\nmpfr 4.1.0 4.0.2\nnettle 3.4.1 3.6\nntl 11.4.1\nopenssl 1.0.2t\nopenssl@1.1 1.1.1g 1.1.1d\np11-kit 0.23.21 0.23.18.1\npari 2.11.4\npkg-config 0.29.2_3 0.29.2\nreadline 8.0.4\nruby 2.7.1_2\nsqlite 3.33.0\nunbound 1.11.0\nwebp 1.0.3\nxz 5.2.4\n```",
    "created_at": "2020-10-08T22:56:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489159",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:3" align="right">comment:3</div>

I'm trying to compile sage-9.2.rc0 on big sur with xcode 12.0.1. 

I ran `sage -f openblas`. Here's the tail of that:

(see the openblas attachment).

After trying lots of things such as

```
$ ./configure \
  --enable-universalsdk=$(xcodebuild -version -sdk macosx Path) \
  --with-universal-archs=intel-64
$ source /Users/wdj/sagefiles/sage-9.2.rc0/.homebrew-build-env
$ ./config.status --recheck && ./config.status
$ ./sage -f gfortran
```
the compilation of `sage -f gfortran` stopped with an error compiling R.

However, Sage did start and crash with this error:

```
wdj@jeeves sage-9.2.rc0 % ./sage
┌────────────────────────────────────────────────────────────────────┐
│ SageMath version 9.2.rc0, Release Date: 2020-10-05                 │
│ Using Python 3.8.5. Type "help()" for help.                        │
└────────────────────────────────────────────────────────────────────┘
---------------------------------------------------------------------------
ModuleNotFoundErrorPython 3.8.5:
/Users/wdj/sagefiles/sage-9.2.rc0/local/bin/python3
Thu Oct  8 13:27:16 2020
A problem occurred executing Python code.  Here is the sequence of function
calls leading up to the error, with the most recent (innermost) call last.
```
(for the rest, see the error-in-start attachment).

It looks like Sage's Python doesn't work, right? Wrong:

```
wdj@jeeves sage-9.2.rc0 % ./sage -python3
Python 3.8.5 (default, Oct  7 2020, 13:59:53)
[Clang 12.0.0 (clang-1200.0.32.2)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 2+3
5
```
In case it's any use, here is what homebrew claims it has installed:

```
wdj@jeeves sage-9.2.rc0 % brew list --versions
autoconf 2.69
automake 1.16.1_1
bdw-gc 8.0.4
boost 1.71.0
cmake 3.15.5
fontconfig 2.13.1
freetype 2.10.1
gcc 9.2.0_1
gd 2.2.5
gettext 0.20.1 0.21
gmp 6.2.0 6.1.2_2
gnutls 3.6.15
gpatch 2.7.6
guile 3.0.4
icu4c 64.2
isl 0.22.1 0.21
jpeg 9c
libde265 1.0.3
libdvdcss 1.4.2
libevent 2.1.12
libffi 3.3 3.2.1
libidn2 2.3.0 2.2.0_1
libmpc 1.1.0 1.2.0
libomp 9.0.0
libpng 1.6.37
libtasn1 4.14 4.16.0
libtiff 4.0.10_1
libtool 2.4.6_1 2.4.6_2
libunistring 0.9.10
libyaml 0.2.5
mpfi 1.5.3
mpfr 4.1.0 4.0.2
nettle 3.4.1 3.6
ntl 11.4.1
openssl 1.0.2t
openssl@1.1 1.1.1g 1.1.1d
p11-kit 0.23.21 0.23.18.1
pari 2.11.4
pkg-config 0.29.2_3 0.29.2
readline 8.0.4
ruby 2.7.1_2
sqlite 3.33.0
unbound 1.11.0
webp 1.0.3
xz 5.2.4
```



---

archive/issue_comments_489160.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nI've actually gotten this to build for me without patching Sage in any way, just building 9.2.rc0. Homebrew setup:\n\n```\n% brew list\nautoconf    gd           haskell-stack  libpng        ncurses      r\nautomake    gdbm         icu4c          libtasn1      nettle       re2c\nbdw-gc      gettext      ilmbase        libtiff       ninja        readline\nbison       ghc          intltool       libtool       openblas     sphinx-doc\nboost       ghostscript  isl            libunistring  openexr      sqlite\nbzip2       git          jansson        libxml2       openssl@1.1  suite-sparse\ncmake       glib         jpeg           meson         p11-kit      tbb\ncurl        glpk         libatomic_ops  metis         pandoc       texinfo\ndoxygen     gmp          libevent       mpc           pcre         unbound\nfontconfig  gnutls       libffi         mpfi          pcre2        webp\nfreetype    gpatch       libidn2        mpfr          pkg-config   xz\ngcc         gsl          libmpc         mpir          ppl          yasm\ngcc@9       guile        libmpdclient   nauty         python@3.8   zeromq\n```\nThen I used the command\n\n```\n$ ./configure \\\n  --with-system-readline=no \\\n  --with-system-zlib=no \\\n  --with-system-gfortran=no \\\n  --with-system-openblas=no \\\n  --with-system-bzip2=no\n```\nafter which `make` worked but `make ptestlong`\nshowed a bunch of failures, all like this:\n\n```\nExpected nothing\nGot:\n    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (10.15) than being linked (10.9)\n```\nMaybe because `MACOSX_DEPLOYMENT_TARGET` is being set? I could try building Sage's `mpfr` and `gmp`. But in any case, I got Sage to build, unfortunately by not using a bunch of the system versions of things.",
    "created_at": "2020-10-10T02:30:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489160",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:4" align="right">comment:4</div>

I've actually gotten this to build for me without patching Sage in any way, just building 9.2.rc0. Homebrew setup:

```
% brew list
autoconf    gd           haskell-stack  libpng        ncurses      r
automake    gdbm         icu4c          libtasn1      nettle       re2c
bdw-gc      gettext      ilmbase        libtiff       ninja        readline
bison       ghc          intltool       libtool       openblas     sphinx-doc
boost       ghostscript  isl            libunistring  openexr      sqlite
bzip2       git          jansson        libxml2       openssl@1.1  suite-sparse
cmake       glib         jpeg           meson         p11-kit      tbb
curl        glpk         libatomic_ops  metis         pandoc       texinfo
doxygen     gmp          libevent       mpc           pcre         unbound
fontconfig  gnutls       libffi         mpfi          pcre2        webp
freetype    gpatch       libidn2        mpfr          pkg-config   xz
gcc         gsl          libmpc         mpir          ppl          yasm
gcc@9       guile        libmpdclient   nauty         python@3.8   zeromq
```
Then I used the command

```
$ ./configure \
  --with-system-readline=no \
  --with-system-zlib=no \
  --with-system-gfortran=no \
  --with-system-openblas=no \
  --with-system-bzip2=no
```
after which `make` worked but `make ptestlong`
showed a bunch of failures, all like this:

```
Expected nothing
Got:
    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (10.15) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (10.15) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (10.15) than being linked (10.9)
```
Maybe because `MACOSX_DEPLOYMENT_TARGET` is being set? I could try building Sage's `mpfr` and `gmp`. But in any case, I got Sage to build, unfortunately by not using a bunch of the system versions of things.



---

archive/issue_comments_489161.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@jhpalmieri](#comment:4):\n> Maybe because `MACOSX_DEPLOYMENT_TARGET` is being set? I could try building Sage's `mpfr` and `gmp`.\n\nI could try that, but it won't work because our `mpir` is broken when using Xcode 12, with the usual error, and the latest release of `mpir` (`git clone git://github.com/wbhart/mpir.git mpir`) doesn't help.",
    "created_at": "2020-10-10T02:38:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489161",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@jhpalmieri](#comment:4):
> Maybe because `MACOSX_DEPLOYMENT_TARGET` is being set? I could try building Sage's `mpfr` and `gmp`.

I could try that, but it won't work because our `mpir` is broken when using Xcode 12, with the usual error, and the latest release of `mpir` (`git clone git://github.com/wbhart/mpir.git mpir`) doesn't help.



---

archive/issue_comments_489162.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nmpir is basically not developed any more (for the time being at least), so we should not use it.\n\nWhat is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.",
    "created_at": "2020-10-10T08:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489162",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:6" align="right">comment:6</div>

mpir is basically not developed any more (for the time being at least), so we should not use it.

What is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.



---

archive/issue_comments_489163.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@wdjoyner](#comment:3):\n> I'm trying to compile sage-9.2.rc0 on big sur with xcode 12.0.1. \n> \n> I ran sage -f openblas. Here's the tail of that:\n> \n> [...]\n\nDavid, could you please replace this 10-screen comment by an attachement?",
    "created_at": "2020-10-10T08:13:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489163",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@wdjoyner](#comment:3):
> I'm trying to compile sage-9.2.rc0 on big sur with xcode 12.0.1. 
> 
> I ran sage -f openblas. Here's the tail of that:
> 
> [...]

David, could you please replace this 10-screen comment by an attachement?



---

archive/issue_comments_489164.json:
```json
{
    "body": "Attachment: **[openblas-tail.txt](https://github.com/sagemath/sage/files/ticket30651/openblas-tail.txt)**\n\nopenblas error",
    "created_at": "2020-10-10T08:23:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489164",
    "user": "https://github.com/wdjoyner"
}
```

Attachment: **[openblas-tail.txt](https://github.com/sagemath/sage/files/ticket30651/openblas-tail.txt)**

openblas error



---

archive/issue_comments_489165.json:
```json
{
    "body": "Attachment: **[error-in-start.txt](https://github.com/sagemath/sage/files/ticket30651/error-in-start.txt)**\n\nerror in start",
    "created_at": "2020-10-10T08:24:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489165",
    "user": "https://github.com/wdjoyner"
}
```

Attachment: **[error-in-start.txt](https://github.com/sagemath/sage/files/ticket30651/error-in-start.txt)**

error in start



---

archive/issue_comments_489166.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nReplying to [@dimpase](#comment:6):\n> mpir is basically not developed any more (for the time being at least), so we should not use it.\n\nIt's a standard package, so I'm confused about what the alternatives are.\n\nAnyway, I hacked the spkg-install.in script for `mpir`, as in #30729, and I got it to build. That eliminated those doctest failures. I'm left with two:\n\n```\nsage -t --long --random-seed=0 src/sage/misc/gperftools.py\n**********************************************************************\nFile \"src/sage/misc/gperftools.py\", line 118, in sage.misc.gperftools.Profiler._libc\nFailed example:\n    Profiler()._libc()\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.gperftools.Profiler._libc[1]>\", line 1, in <module>\n        Profiler()._libc()\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/misc/gperftools.py\", line 129, in _libc\n        raise ImportError('failed to open libc')\n    ImportError: failed to open libc\n```\nand\n\n```\nsage -t --long --random-seed=0 src/sage/tests/parigp.py\n    Timed out\n```\n\n \n> What is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.\n\nI haven't changed Sage, so it's whatever gets set in sage-env: 10.9, I think.",
    "created_at": "2020-10-10T16:05:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489166",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:8" align="right">comment:8</div>

Replying to [@dimpase](#comment:6):
> mpir is basically not developed any more (for the time being at least), so we should not use it.

It's a standard package, so I'm confused about what the alternatives are.

Anyway, I hacked the spkg-install.in script for `mpir`, as in #30729, and I got it to build. That eliminated those doctest failures. I'm left with two:

```
sage -t --long --random-seed=0 src/sage/misc/gperftools.py
**********************************************************************
File "src/sage/misc/gperftools.py", line 118, in sage.misc.gperftools.Profiler._libc
Failed example:
    Profiler()._libc()
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.gperftools.Profiler._libc[1]>", line 1, in <module>
        Profiler()._libc()
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/misc/gperftools.py", line 129, in _libc
        raise ImportError('failed to open libc')
    ImportError: failed to open libc
```
and

```
sage -t --long --random-seed=0 src/sage/tests/parigp.py
    Timed out
```

 
> What is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.

I haven't changed Sage, so it's whatever gets set in sage-env: 10.9, I think.



---

archive/issue_comments_489167.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nReplying to [@jhpalmieri](#comment:8):\n> Replying to [@dimpase](#comment:6):\n> > mpir is basically not developed any more (for the time being at least), so we should not use it.\n\n> \n> It's a standard package, so I'm confused about what the alternatives are.\n\nOne can choose between gmp and mpir. Both are standard, but only one is needed.\n\nUse the configure flag `--with-mp=gmp` or `with-mp=mpir` to choose.\n\nLikewise, one can choose between ATLAS and OpenBLAS, and both are standard.\n\nUse `--with-blas=openblas` or `--with-blas=atlas` for that.\n\nIn that case #30350 proposes to remove ATLAS.",
    "created_at": "2020-10-10T16:30:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489167",
    "user": "https://github.com/slel"
}
```

<div id="comment:9" align="right">comment:9</div>

Replying to [@jhpalmieri](#comment:8):
> Replying to [@dimpase](#comment:6):
> > mpir is basically not developed any more (for the time being at least), so we should not use it.

> 
> It's a standard package, so I'm confused about what the alternatives are.

One can choose between gmp and mpir. Both are standard, but only one is needed.

Use the configure flag `--with-mp=gmp` or `with-mp=mpir` to choose.

Likewise, one can choose between ATLAS and OpenBLAS, and both are standard.

Use `--with-blas=openblas` or `--with-blas=atlas` for that.

In that case #30350 proposes to remove ATLAS.



---

archive/issue_comments_489168.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\nSorry, I led us on a bit of a wild goose chase for the past few comments. Back in [comment:4](#comment:4), I said the right thing:\n\n```\nI could try building Sage's mpfr and gmp.\n```\nBut then (maybe I was tired or distracted), I started building Sage's `mpir` (and also Sage's `gmp`, which was appropriate). There is no reason to care about `mpir`: just use `--with-system-gmp=no` and Sage will build its own `gmp` and `mpfr`.",
    "created_at": "2020-10-10T17:20:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489168",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:10" align="right">comment:10</div>

Sorry, I led us on a bit of a wild goose chase for the past few comments. Back in [comment:4](#comment:4), I said the right thing:

```
I could try building Sage's mpfr and gmp.
```
But then (maybe I was tired or distracted), I started building Sage's `mpir` (and also Sage's `gmp`, which was appropriate). There is no reason to care about `mpir`: just use `--with-system-gmp=no` and Sage will build its own `gmp` and `mpfr`.



---

archive/issue_comments_489169.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nReplying to [@jhpalmieri](#comment:8):\n> Replying to [@dimpase](#comment:6):\n> > What is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.\n\n> \n> I haven't changed Sage, so it's whatever gets set in sage-env: 10.9, I think.\n\nJust a quick remark - `MACOSX_DEPLOYMENT_TARGET` only gets set in builds configured `--without-system-python`.  (See #30724, which makes this code in `sage-env` cleaner.)",
    "created_at": "2020-10-10T17:43:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489169",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

Replying to [@jhpalmieri](#comment:8):
> Replying to [@dimpase](#comment:6):
> > What is the value of MACOSX_DEPLOYMENT_TARGET used in this build? I would not be surprised if there is an incompatibility barrier between macOS 10 and macOS 11.

> 
> I haven't changed Sage, so it's whatever gets set in sage-env: 10.9, I think.

Just a quick remark - `MACOSX_DEPLOYMENT_TARGET` only gets set in builds configured `--without-system-python`.  (See #30724, which makes this code in `sage-env` cleaner.)



---

archive/issue_comments_489170.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nRight. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own, so `MACOSX_DEPLOYMENT_TARGET` is relevant. (Also, Sage's Python can't find various system libraries to build the corresponding modules, which is why I'm passing the flags `--with-system-zlib=no --with-system-bzip2=no` to `configure`.)",
    "created_at": "2020-10-10T18:04:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489170",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:12" align="right">comment:12</div>

Right. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own, so `MACOSX_DEPLOYMENT_TARGET` is relevant. (Also, Sage's Python can't find various system libraries to build the corresponding modules, which is why I'm passing the flags `--with-system-zlib=no --with-system-bzip2=no` to `configure`.)



---

archive/issue_comments_489171.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReplying to [@jhpalmieri](#comment:12):\n> Right. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own\n\nIs this because of dependencies of the `python3` package? In this case, #30559 may be relevant",
    "created_at": "2020-10-10T19:12:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489171",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Replying to [@jhpalmieri](#comment:12):
> Right. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own

Is this because of dependencies of the `python3` package? In this case, #30559 may be relevant



---

archive/issue_comments_489172.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nReplying to [@jhpalmieri](#comment:4):\n> I've actually gotten this to build for me without patching Sage in any way, just building 9.2.rc0. \n\n...\n\n> Then I used the command\n> \n> ```\n> ./configure --with-system-readline=no --with-system-zlib=no --with-system-gfortran=no --with-system-openblas=no --with-system-bzip2=no\n> ```\n> `make` worked. \n\nThis configure command followed by make gave me a functioning sage, so\nthank you!\n\nR didn't compile but I don't use it.",
    "created_at": "2020-10-10T19:27:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489172",
    "user": "https://github.com/wdjoyner"
}
```

<div id="comment:14" align="right">comment:14</div>

Replying to [@jhpalmieri](#comment:4):
> I've actually gotten this to build for me without patching Sage in any way, just building 9.2.rc0. 

...

> Then I used the command
> 
> ```
> ./configure --with-system-readline=no --with-system-zlib=no --with-system-gfortran=no --with-system-openblas=no --with-system-bzip2=no
> ```
> `make` worked. 

This configure command followed by make gave me a functioning sage, so
thank you!

R didn't compile but I don't use it.



---

archive/issue_comments_489173.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@mkoeppe](#comment:13):\n> Replying to [@jhpalmieri](#comment:12):\n> > Right. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own\n\n> \n> Is this because of dependencies of the `python3` package?\n\nYes, sqlite is not successfully detected. I'll try turning that dependency off.",
    "created_at": "2020-10-10T21:09:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489173",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@mkoeppe](#comment:13):
> Replying to [@jhpalmieri](#comment:12):
> > Right. Since for me at least, Sage doesn't successfully detect the presence of the system Python on Big Sur, it always builds its own

> 
> Is this because of dependencies of the `python3` package?

Yes, sqlite is not successfully detected. I'll try turning that dependency off.



---

archive/issue_comments_489174.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nSage built using the system Python after modifying the dependencies to avoid sqlite. I used\n\n```\n./configure --with-system-gfortran=no --with-system-openblas=no --with-system-gmp=no\n```\nUnfortunately the documentation won't build and many doctests fail , in both cases with a bus error. For example:\n\n```\nFile \"src/sage/algebras/quatalg/quaternion_algebra.py\", line 107, in sage.algebras.quatalg.quaternion_algebra.QuaternionAlgebraFactory\nFailed example:\n    QuaternionAlgebra(sqrt(-1), sqrt(-3))\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 720, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1145, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.algebras.quatalg.quaternion_algebra.QuaternionAlgebraFactory[4]>\", line 1, in <module>\n        QuaternionAlgebra(sqrt(-Integer(1)), sqrt(-Integer(3)))\n      File \"sage/structure/factory.pyx\", line 367, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2181)\n        key, kwds = self.create_key_and_extra_args(*args, **kwds)\n      File \"sage/structure/factory.pyx\", line 471, in sage.structure.factory.UniqueFactory.create_key_and_extra_args (build/cythonized/sage/structure/factory.c:3402)\n        return self.create_key(*args, **kwds), {}\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/algebras/quatalg/quaternion_algebra.py\", line 246, in create_key\n        if a == 0 or b == 0:\n      File \"sage/symbolic/expression.pyx\", line 3182, in sage.symbolic.expression.Expression.__nonzero__ (build/cythonized/sage/symbolic/expression.cpp:20543)\n        res = self.test_relation()\n      File \"sage/symbolic/expression.pyx\", line 3296, in sage.symbolic.expression.Expression.test_relation (build/cythonized/sage/symbolic/expression.cpp:21404)\n        if self.lhs().is_algebraic() and self.rhs().is_algebraic():\n      File \"sage/symbolic/expression.pyx\", line 2257, in sage.symbolic.expression.Expression.is_algebraic (build/cythonized/sage/symbolic/expression.cpp:15979)\n        ex = sage.rings.all.QQbar(self)\n      File \"sage/structure/parent.pyx\", line 900, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9336)\n        return mor._call_(x)\n      File \"sage/structure/coerce_maps.pyx\", line 156, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4515)\n        return C._element_constructor(x)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/rings/qqbar.py\", line 1496, in _element_constructor_\n        return x._algebraic_(QQbar)\n      File \"sage/symbolic/expression.pyx\", line 1754, in sage.symbolic.expression.Expression._algebraic_ (build/cythonized/sage/symbolic/expression.cpp:12658)\n        return algebraic(self, field)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py\", line 1227, in algebraic\n        return AlgebraicConverter(field)(ex)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py\", line 218, in __call__\n        return self.arithmetic(ex, operator)\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py\", line 1061, in arithmetic\n        return self.field(base**expt)\n      File \"sage/structure/element.pyx\", line 2057, in sage.structure.element.Element.__pow__ (build/cythonized/sage/structure/element.c:14456)\n        return coercion_model.bin_op(left, right, pow)\n      File \"sage/structure/coerce.pyx\", line 1196, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10205)\n        return (<Action>action)._act_(y, x)\n      File \"sage/categories/action.pyx\", line 173, in sage.categories.action.Action._act_ (build/cythonized/sage/categories/action.c:3900)\n        cpdef _act_(self, g, x):\n      File \"/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/rings/qqbar.py\", line 6054, in _act_\n        target_arg.sin() * target_abs)\n      File \"sage/rings/real_mpfi.pyx\", line 4557, in sage.rings.real_mpfi.RealIntervalFieldElement.sin (build/cythonized/sage/rings/real_mpfi.c:26988)\n        sig_on()\n    cysignals.signals.SignalError: Bus error\n```",
    "created_at": "2020-10-11T03:18:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489174",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:16" align="right">comment:16</div>

Sage built using the system Python after modifying the dependencies to avoid sqlite. I used

```
./configure --with-system-gfortran=no --with-system-openblas=no --with-system-gmp=no
```
Unfortunately the documentation won't build and many doctests fail , in both cases with a bus error. For example:

```
File "src/sage/algebras/quatalg/quaternion_algebra.py", line 107, in sage.algebras.quatalg.quaternion_algebra.QuaternionAlgebraFactory
Failed example:
    QuaternionAlgebra(sqrt(-1), sqrt(-3))
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 720, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1145, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.algebras.quatalg.quaternion_algebra.QuaternionAlgebraFactory[4]>", line 1, in <module>
        QuaternionAlgebra(sqrt(-Integer(1)), sqrt(-Integer(3)))
      File "sage/structure/factory.pyx", line 367, in sage.structure.factory.UniqueFactory.__call__ (build/cythonized/sage/structure/factory.c:2181)
        key, kwds = self.create_key_and_extra_args(*args, **kwds)
      File "sage/structure/factory.pyx", line 471, in sage.structure.factory.UniqueFactory.create_key_and_extra_args (build/cythonized/sage/structure/factory.c:3402)
        return self.create_key(*args, **kwds), {}
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/algebras/quatalg/quaternion_algebra.py", line 246, in create_key
        if a == 0 or b == 0:
      File "sage/symbolic/expression.pyx", line 3182, in sage.symbolic.expression.Expression.__nonzero__ (build/cythonized/sage/symbolic/expression.cpp:20543)
        res = self.test_relation()
      File "sage/symbolic/expression.pyx", line 3296, in sage.symbolic.expression.Expression.test_relation (build/cythonized/sage/symbolic/expression.cpp:21404)
        if self.lhs().is_algebraic() and self.rhs().is_algebraic():
      File "sage/symbolic/expression.pyx", line 2257, in sage.symbolic.expression.Expression.is_algebraic (build/cythonized/sage/symbolic/expression.cpp:15979)
        ex = sage.rings.all.QQbar(self)
      File "sage/structure/parent.pyx", line 900, in sage.structure.parent.Parent.__call__ (build/cythonized/sage/structure/parent.c:9336)
        return mor._call_(x)
      File "sage/structure/coerce_maps.pyx", line 156, in sage.structure.coerce_maps.DefaultConvertMap_unique._call_ (build/cythonized/sage/structure/coerce_maps.c:4515)
        return C._element_constructor(x)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/rings/qqbar.py", line 1496, in _element_constructor_
        return x._algebraic_(QQbar)
      File "sage/symbolic/expression.pyx", line 1754, in sage.symbolic.expression.Expression._algebraic_ (build/cythonized/sage/symbolic/expression.cpp:12658)
        return algebraic(self, field)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py", line 1227, in algebraic
        return AlgebraicConverter(field)(ex)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py", line 218, in __call__
        return self.arithmetic(ex, operator)
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/symbolic/expression_conversions.py", line 1061, in arithmetic
        return self.field(base**expt)
      File "sage/structure/element.pyx", line 2057, in sage.structure.element.Element.__pow__ (build/cythonized/sage/structure/element.c:14456)
        return coercion_model.bin_op(left, right, pow)
      File "sage/structure/coerce.pyx", line 1196, in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:10205)
        return (<Action>action)._act_(y, x)
      File "sage/categories/action.pyx", line 173, in sage.categories.action.Action._act_ (build/cythonized/sage/categories/action.c:3900)
        cpdef _act_(self, g, x):
      File "/Users/palmieri/Sage/sage-9.2.rc0/local/lib/python3.8/site-packages/sage/rings/qqbar.py", line 6054, in _act_
        target_arg.sin() * target_abs)
      File "sage/rings/real_mpfi.pyx", line 4557, in sage.rings.real_mpfi.RealIntervalFieldElement.sin (build/cythonized/sage/rings/real_mpfi.c:26988)
        sig_on()
    cysignals.signals.SignalError: Bus error
```



---

archive/issue_comments_489175.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nReplying to [@jhpalmieri](#comment:10):\n> Sorry, I led us on a bit of a wild goose chase for the past few comments. Back in [comment:4](#comment:4), I said the right thing:\n> \n> ```\n> I could try building Sage's mpfr and gmp.\n> ```\n> But then (maybe I was tired or distracted), I started building Sage's `mpir` (and also Sage's `gmp`, which was appropriate). There is no reason to care about `mpir`: just use `--with-system-gmp=no` and Sage will build its own `gmp` and `mpfr`.\n\nThey cannot be, and are not, \"installed together\" - `mpir` uses the \"gmp compatibility\" mode where it installs gmp-compatible libs etc. You need to run `./configure with `--with-mp=gmp` to select gmp as the package to use for `mp`, (= multiple precision), as the default for `mp` is `mpir`.\n\nDefault `mp`  should be changed to `gmp`, I think, as `mpir` is getting bitrotten more and more.\nSee #30752 (where a lie about mpir/gmp told by `./configure -h` is uncovered, as well)",
    "created_at": "2020-10-11T10:03:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489175",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:17" align="right">comment:17</div>

Replying to [@jhpalmieri](#comment:10):
> Sorry, I led us on a bit of a wild goose chase for the past few comments. Back in [comment:4](#comment:4), I said the right thing:
> 
> ```
> I could try building Sage's mpfr and gmp.
> ```
> But then (maybe I was tired or distracted), I started building Sage's `mpir` (and also Sage's `gmp`, which was appropriate). There is no reason to care about `mpir`: just use `--with-system-gmp=no` and Sage will build its own `gmp` and `mpfr`.

They cannot be, and are not, "installed together" - `mpir` uses the "gmp compatibility" mode where it installs gmp-compatible libs etc. You need to run `./configure with `--with-mp=gmp` to select gmp as the package to use for `mp`, (= multiple precision), as the default for `mp` is `mpir`.

Default `mp`  should be changed to `gmp`, I think, as `mpir` is getting bitrotten more and more.
See #30752 (where a lie about mpir/gmp told by `./configure -h` is uncovered, as well)



---

archive/issue_events_424681.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-02T02:48:35Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424681"
}
```



---

archive/issue_events_424682.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-02T02:48:35Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424682"
}
```



---

archive/issue_comments_489176.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n This is to support macOS 11 Big Sur.\n \n-\n+- #30752 gmp instead of mpir\n+- #30929 GH Actions: Update macos test environments\n+- #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local\n \n Related:\n \n@@ -8,5 +10,7 @@\n \n References:\n - https://bugs.python.org/issue41116\n+- https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ\n \n \n+\n``````\n",
    "created_at": "2020-11-17T01:40:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489176",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 This is to support macOS 11 Big Sur.
 
-
+- #30752 gmp instead of mpir
+- #30929 GH Actions: Update macos test environments
+- #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local
 
 Related:
 
@@ -8,5 +10,7 @@
 
 References:
 - https://bugs.python.org/issue41116
+- https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ
 
 
+
``````




---

archive/issue_comments_489177.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,6 +3,10 @@\n - #30752 gmp instead of mpir\n - #30929 GH Actions: Update macos test environments\n - #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local\n+- #31050 upgrade wheel\n+- `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n+- #30589 Upgrade Python to 3.9.1\n+\n \n Related:\n \n@@ -12,5 +16,3 @@\n - https://bugs.python.org/issue41116\n - https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ\n \n-\n-\n``````\n",
    "created_at": "2020-12-16T02:02:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489177",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,6 +3,10 @@
 - #30752 gmp instead of mpir
 - #30929 GH Actions: Update macos test environments
 - #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local
+- #31050 upgrade wheel
+- `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
+- #30589 Upgrade Python to 3.9.1
+
 
 Related:
 
@@ -12,5 +16,3 @@
 - https://bugs.python.org/issue41116
 - https://groups.google.com/g/sage-devel/c/5lBTr4gZuic/m/RkisHYLWCgAJ
 
-
-
``````




---

archive/issue_comments_489178.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nI am having problems building `scipy`. This is after installing #31050, #30589, upgrades to `setuptools` and `setuptools_scm`, plus patches (related to parsing the OS X version number) to `cffi` and `numpy`. Then `scipy` fails with\n\n```\n  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\n  gfortran: warning: couldn't understand version 11\n  ld: library not found for -lgcc_s.10.4\n  collect2: error: ld returned 1 exit status\n  error: Command \"/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\" failed with exit status 1\n  Building wheel for scipy (PEP 517): finished with status 'error'\n  ERROR: Failed building wheel for scipy\n```",
    "created_at": "2020-12-22T06:17:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489178",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:22" align="right">comment:22</div>

I am having problems building `scipy`. This is after installing #31050, #30589, upgrades to `setuptools` and `setuptools_scm`, plus patches (related to parsing the OS X version number) to `cffi` and `numpy`. Then `scipy` fails with

```
  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so
  gfortran: warning: couldn't understand version 11
  ld: library not found for -lgcc_s.10.4
  collect2: error: ld returned 1 exit status
  error: Command "/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so" failed with exit status 1
  Building wheel for scipy (PEP 517): finished with status 'error'
  ERROR: Failed building wheel for scipy
```



---

archive/issue_comments_489179.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nTry doing `export MACOSX_DEPLOYMENT_TARGET=10.16` to fix the issue until gfortran understands `11`",
    "created_at": "2020-12-22T09:03:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489179",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:23" align="right">comment:23</div>

Try doing `export MACOSX_DEPLOYMENT_TARGET=10.16` to fix the issue until gfortran understands `11`



---

archive/issue_comments_489180.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nOr you can set `SYSTEM_VERSION_COMPAT=1` which would make the system return `10.16` automatically",
    "created_at": "2020-12-22T09:07:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489180",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:24" align="right">comment:24</div>

Or you can set `SYSTEM_VERSION_COMPAT=1` which would make the system return `10.16` automatically



---

archive/issue_comments_489181.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nI don't know how to set these variables in such a way to get Sage to build. (This is with the changes listed in [comment:22](#comment:22).)\n\n- If I set them globally, then `pillow` fails: it can't find `zlib`.\n- If I set them just in the `spkg-install.in` script for `scipy`, then it fails with the message `ERROR: scipy-1.5.4-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.`",
    "created_at": "2020-12-22T23:24:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489181",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:25" align="right">comment:25</div>

I don't know how to set these variables in such a way to get Sage to build. (This is with the changes listed in [comment:22](#comment:22).)

- If I set them globally, then `pillow` fails: it can't find `zlib`.
- If I set them just in the `spkg-install.in` script for `scipy`, then it fails with the message `ERROR: scipy-1.5.4-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.`



---

archive/issue_comments_489182.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\n> If I set them globally, then pillow fails: it can't find zlib.\n\nWhat's the error?",
    "created_at": "2020-12-28T22:00:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489182",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:26" align="right">comment:26</div>

> If I set them globally, then pillow fails: it can't find zlib.

What's the error?



---

archive/issue_comments_489183.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nNow I'm seeing a different error when building pillow, not about zlib:\n\n```\nclang: error: the clang compiler does not support '-march=native'\n```\n\nDetails: I did\n\n```\n% export MACOSX_DEPLOYMENT_TARGET=10.16\n% make distclean; ./configure; make pillow\n```\nSame error whether I use vanilla Sage 9.3.beta5, or that + #30589, or that + #30589 + new versions of `setuptools` and `setuptools_scm`. Pillow builds successfully if I then do\n\n```\n% unset MACOSX_DEPLOYMENT_TARGET\n% make distclean; ./configure; make pillow\n```",
    "created_at": "2020-12-28T22:59:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489183",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:27" align="right">comment:27</div>

Now I'm seeing a different error when building pillow, not about zlib:

```
clang: error: the clang compiler does not support '-march=native'
```

Details: I did

```
% export MACOSX_DEPLOYMENT_TARGET=10.16
% make distclean; ./configure; make pillow
```
Same error whether I use vanilla Sage 9.3.beta5, or that + #30589, or that + #30589 + new versions of `setuptools` and `setuptools_scm`. Pillow builds successfully if I then do

```
% unset MACOSX_DEPLOYMENT_TARGET
% make distclean; ./configure; make pillow
```



---

archive/issue_comments_489184.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nlogs please",
    "created_at": "2020-12-28T23:01:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489184",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:28" align="right">comment:28</div>

logs please



---

archive/issue_comments_489185.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nIf I instead do `export SYSTEM_VERSION_COMPAT=1`, the Pillow build gets farther but ends with\n\n```\nERROR: Pillow-8.0.1-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.\n```",
    "created_at": "2020-12-28T23:02:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489185",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:29" align="right">comment:29</div>

If I instead do `export SYSTEM_VERSION_COMPAT=1`, the Pillow build gets farther but ends with

```
ERROR: Pillow-8.0.1-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.
```



---

archive/issue_comments_489186.json:
```json
{
    "body": "vanilla 9.3.beta5",
    "created_at": "2020-12-28T23:04:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489186",
    "user": "https://github.com/jhpalmieri"
}
```

vanilla 9.3.beta5



---

archive/issue_comments_489187.json:
```json
{
    "body": "Attachment: **[pillow-8.0.1-VANILLA.log](https://github.com/sagemath/sage/files/ticket30651/pillow-8.0.1-VANILLA.log)**\n\nbuilt using #30589",
    "created_at": "2020-12-28T23:04:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489187",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[pillow-8.0.1-VANILLA.log](https://github.com/sagemath/sage/files/ticket30651/pillow-8.0.1-VANILLA.log)**

built using #30589



---

archive/issue_comments_489188.json:
```json
{
    "body": "Attachment: **[pillow-8.0.1-30589.log](https://github.com/sagemath/sage/files/ticket30651/pillow-8.0.1-30589.log)**\n\nbuilt with SYSTEM_VERSION_COMPAT=1",
    "created_at": "2020-12-28T23:06:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489188",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[pillow-8.0.1-30589.log](https://github.com/sagemath/sage/files/ticket30651/pillow-8.0.1-30589.log)**

built with SYSTEM_VERSION_COMPAT=1



---

archive/issue_comments_489189.json:
```json
{
    "body": "Attachment: **[pillow-8.0.1-SYSTEM_VERSION_COMPAT=1.log](https://github.com/sagemath/sage/files/ticket30651/b65a83795ed13d172da555a56c0a7362.log)**\n\ntop-level config.log",
    "created_at": "2020-12-28T23:07:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489189",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[pillow-8.0.1-SYSTEM_VERSION_COMPAT=1.log](https://github.com/sagemath/sage/files/ticket30651/b65a83795ed13d172da555a56c0a7362.log)**

top-level config.log



---

archive/issue_comments_489190.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nAttachment: **[config.log](https://github.com/sagemath/sage/files/ticket30651/config.log)**\n\nHere are various logs. Let me know if you want others.",
    "created_at": "2020-12-28T23:07:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489190",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:30" align="right">comment:30</div>

Attachment: **[config.log](https://github.com/sagemath/sage/files/ticket30651/config.log)**

Here are various logs. Let me know if you want others.



---

archive/issue_comments_489191.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nTry patching pip at https://github.com/pypa/pip/blob/master/src/pip/_vendor/packaging/tags.py#L438\nby doing,\n\n```\nif version == (10, 16):\n    version = (11, 0)\n```",
    "created_at": "2020-12-28T23:15:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489191",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:31" align="right">comment:31</div>

Try patching pip at https://github.com/pypa/pip/blob/master/src/pip/_vendor/packaging/tags.py#L438
by doing,

```
if version == (10, 16):
    version = (11, 0)
```



---

archive/issue_comments_489192.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nThat patch has no obvious effect when setting MACOSX_DEPLOYMENT_TARGET or SYSTEM_VERSION_COMPAT or both: I see the same errors.",
    "created_at": "2020-12-28T23:31:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489192",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:32" align="right">comment:32</div>

That patch has no obvious effect when setting MACOSX_DEPLOYMENT_TARGET or SYSTEM_VERSION_COMPAT or both: I see the same errors.



---

archive/issue_comments_489193.json:
```json
{
    "body": "<div id=\"comment:33\" align=\"right\">comment:33</div>\n\nI edited the patch. Can you retry?",
    "created_at": "2020-12-28T23:32:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489193",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:33" align="right">comment:33</div>

I edited the patch. Can you retry?



---

archive/issue_comments_489194.json:
```json
{
    "body": "<div id=\"comment:34\" align=\"right\">comment:34</div>\n\nI did the same edit independently. With `SYSTEM_VERSION_COMPAT=1`, Pillow now builds! With `MACOSX_DEPLOYMENT_TARGET=10.16`, it does not: same error as before.",
    "created_at": "2020-12-28T23:37:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489194",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:34" align="right">comment:34</div>

I did the same edit independently. With `SYSTEM_VERSION_COMPAT=1`, Pillow now builds! With `MACOSX_DEPLOYMENT_TARGET=10.16`, it does not: same error as before.



---

archive/issue_comments_489195.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nAnd in case it matters, this is all with 9.3.beta5 + #30589 + updated setuptools and setuptools_scm.",
    "created_at": "2020-12-28T23:43:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489195",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:35" align="right">comment:35</div>

And in case it matters, this is all with 9.3.beta5 + #30589 + updated setuptools and setuptools_scm.



---

archive/issue_comments_489196.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nAfter running `make pillow`, I tried `make numpy` and got an unexpected error:\n\n```\nPackage 'numpy' is currently not installed\nUninstalling 'numpy' with legacy uninstaller\nTraceback (most recent call last):\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/var/tmp/sage/build/numpy-1.19.4/src/../lapack_conf.py\", line 7, in <module>\n    pc_blas   = pkgconfig.parse('cblas blas')\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py\", line 248, in parse\n    _raise_if_not_exists(package)\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n    raise PackageNotFoundError(package)\npkgconfig.pkgconfig.PackageNotFoundError: cblas not found\n```\nMissing dependency? After running just `make`, it has now reached `numpy` and gotten past this problem.",
    "created_at": "2020-12-29T01:04:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489196",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:36" align="right">comment:36</div>

After running `make pillow`, I tried `make numpy` and got an unexpected error:

```
Package 'numpy' is currently not installed
Uninstalling 'numpy' with legacy uninstaller
Traceback (most recent call last):
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/var/tmp/sage/build/numpy-1.19.4/src/../lapack_conf.py", line 7, in <module>
    pc_blas   = pkgconfig.parse('cblas blas')
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py", line 248, in parse
    _raise_if_not_exists(package)
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
    raise PackageNotFoundError(package)
pkgconfig.pkgconfig.PackageNotFoundError: cblas not found
```
Missing dependency? After running just `make`, it has now reached `numpy` and gotten past this problem.



---

archive/issue_comments_489197.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\n`scipy` failed, unfortunately:\n\n```\n  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\n  gfortran: warning: couldn't understand version 11\n  ld: library not found for -lgcc_s.10.4\n  collect2: error: ld returned 1 exit status\n  error: Command \"/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\" failed with exit status 1\n  Building wheel for scipy (PEP 517): finished with status 'error'\n```\n`numpy` had a warning in its log, but it built successfully:\n\n```\nbuilding library \"npymath\" sources\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\ngfortran: warning: couldn't understand version 11\n```",
    "created_at": "2020-12-29T01:18:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489197",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:37" align="right">comment:37</div>

`scipy` failed, unfortunately:

```
  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so
  gfortran: warning: couldn't understand version 11
  ld: library not found for -lgcc_s.10.4
  collect2: error: ld returned 1 exit status
  error: Command "/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so" failed with exit status 1
  Building wheel for scipy (PEP 517): finished with status 'error'
```
`numpy` had a warning in its log, but it built successfully:

```
building library "npymath" sources
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
gfortran: warning: couldn't understand version 11
```



---

archive/issue_comments_489198.json:
```json
{
    "body": "Attachment: **[scipy-1.5.4.log](https://github.com/sagemath/sage/files/ticket30651/scipy-1.5.4.log)**",
    "created_at": "2020-12-29T01:18:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489198",
    "user": "https://github.com/jhpalmieri"
}
```

Attachment: **[scipy-1.5.4.log](https://github.com/sagemath/sage/files/ticket30651/scipy-1.5.4.log)**



---

archive/issue_comments_489199.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nIs this with `SYSTEM_COMPAT_VERSION=1` or `MACOSX_DEPLOYMENT_TARGET=10.16`. Are these set globally or in the spkg-install.in of scipy?",
    "created_at": "2020-12-29T01:24:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489199",
    "user": "https://github.com/isuruf"
}
```

<div id="comment:38" align="right">comment:38</div>

Is this with `SYSTEM_COMPAT_VERSION=1` or `MACOSX_DEPLOYMENT_TARGET=10.16`. Are these set globally or in the spkg-install.in of scipy?



---

archive/issue_comments_489200.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nI know that Homebrew fixes scipy by setting\n\nMACOSX_DEPLOYMENT_TARGET=11.0\n\nIf the OS is big sur.",
    "created_at": "2020-12-29T01:24:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489200",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:39" align="right">comment:39</div>

I know that Homebrew fixes scipy by setting

MACOSX_DEPLOYMENT_TARGET=11.0

If the OS is big sur.



---

archive/issue_comments_489201.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nThis is with `SYSTEM_COMPAT_VERSION=1` set globally.",
    "created_at": "2020-12-29T03:52:40Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489201",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:40" align="right">comment:40</div>

This is with `SYSTEM_COMPAT_VERSION=1` set globally.



---

archive/issue_comments_489202.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nto elaborate on my previous comment, if I run\n\nmake scipy\n\nthen it fails.  However, if I run\n\nMACOSX_DEPLOYMENT_TARGET=11.0 make  scipy\n\nthen it succeeds with no issues.  I don't know too much about makefiles but a simple fix could be to set MACOSX_DEPLOYMENT_TARGET if the operating system is Big Sur and then unset it after scipy installs.",
    "created_at": "2020-12-29T05:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489202",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:41" align="right">comment:41</div>

to elaborate on my previous comment, if I run

make scipy

then it fails.  However, if I run

MACOSX_DEPLOYMENT_TARGET=11.0 make  scipy

then it succeeds with no issues.  I don't know too much about makefiles but a simple fix could be to set MACOSX_DEPLOYMENT_TARGET if the operating system is Big Sur and then unset it after scipy installs.



---

archive/issue_comments_489203.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nI can get Sage to build on OS X 11.1 with the following changes:\n\n- #30589\n- upgrade setuptools and setuptools_scm (not sure if this is necessary)\n- patch cffi and numpy: without patching, I get an error during cffi's `setup.py` when evaluating this:\n\n```\nreturn tuple(map(int, get_config_var(\"MACOSX_DEPLOYMENT_TARGET\").split('.')))\n```\n The problem is that `get_config_var(...)` returns the int 11 rather than the string \"11\", so I patched it to do `str(get_config_var(...))`. Similar with numpy.\n- add `export MACOSX_DEPLOYMENT_TARGET=11.0` in the `spkg-install.in` script for `scipy`.\n\nI did not set any global environment variables.\n\nThere were some doctest failures, I think all due to gfortran. For example:\n\n```\nFile \"src/sage/misc/inline_fortran.py\", line 114, in sage.misc.inline_fortran._import_module_from_path_impl\nFailed example:\n    fortran(code, globals())\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py\", line 170, in eval\n        out = subprocess.check_output(cmd, stderr=subprocess.STDOUT)\n      File \"/usr/local/Cellar/python@3.9/3.9.1_2/Frameworks/Python.framework/Versions/3.9/lib/python3.9/subprocess.py\", line 420, in check_output\n        return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,\n      File \"/usr/local/Cellar/python@3.9/3.9.1_2/Frameworks/Python.framework/Versions/3.9/lib/python3.9/subprocess.py\", line 524, in run\n        raise CalledProcessError(retcode, process.args,\n    subprocess.CalledProcessError: Command '['/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/bin/python3', '-c', 'import numpy.f2py; numpy.f2py.main()', '-c', '-m', 'fortran_module', 'fortran_module.f', '--quiet', '--f77exec=sage-inline-fortran', '--f90exec=sage-inline-fortran']' returned non-zero exit status 1.\n\n    During handling of the above exception, another exception occurred:\n\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.inline_fortran._import_module_from_path_impl[1]>\", line 1, in <module>\n        fortran(code, globals())\n      File \"sage/misc/lazy_import.pyx\", line 360, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4032)\n        return self.get_object()(*args, **kwds)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py\", line 76, in __call__\n        return self.eval(*args, **kwds)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py\", line 172, in eval\n        raise RuntimeError(\n    RuntimeError: failed to compile Fortran code:\n    b'gfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\ngfortran: warning: couldn\\'t understand version 11\\nerror: Command \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/bin/sage-inline-fortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/src.macosx-11-x86_64-3.9/fortran_modulemodule.o /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/src.macosx-11-x86_64-3.9/fortranobject.o /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/fortran_module.o -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -lgfortran -o ./fortran_module.cpython-39-darwin.so\" failed with exit status 1\\n'\n**********************************************************************\nFile \"src/sage/misc/inline_fortran.py\", line 117, in sage.misc.inline_fortran._import_module_from_path_impl\nFailed example:\n    fib(a, 10)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.inline_fortran._import_module_from_path_impl[4]>\", line 1, in <module>\n        fib(a, Integer(10))\n    NameError: name 'fib' is not defined\n**********************************************************************\nFile \"src/sage/misc/inline_fortran.py\", line 118, in sage.misc.inline_fortran._import_module_from_path_impl\nFailed example:\n    a\nExpected:\n    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])\nGot:\n    array([0., 1., 2., 3., 4., 5., 6., 7., 8., 9.])\n**********************************************************************\n1 item had failures:\n   3 of  10 in sage.misc.inline_fortran._import_module_from_path_impl\n```",
    "created_at": "2020-12-29T18:26:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489203",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:42" align="right">comment:42</div>

I can get Sage to build on OS X 11.1 with the following changes:

- #30589
- upgrade setuptools and setuptools_scm (not sure if this is necessary)
- patch cffi and numpy: without patching, I get an error during cffi's `setup.py` when evaluating this:

```
return tuple(map(int, get_config_var("MACOSX_DEPLOYMENT_TARGET").split('.')))
```
 The problem is that `get_config_var(...)` returns the int 11 rather than the string "11", so I patched it to do `str(get_config_var(...))`. Similar with numpy.
- add `export MACOSX_DEPLOYMENT_TARGET=11.0` in the `spkg-install.in` script for `scipy`.

I did not set any global environment variables.

There were some doctest failures, I think all due to gfortran. For example:

```
File "src/sage/misc/inline_fortran.py", line 114, in sage.misc.inline_fortran._import_module_from_path_impl
Failed example:
    fortran(code, globals())
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py", line 170, in eval
        out = subprocess.check_output(cmd, stderr=subprocess.STDOUT)
      File "/usr/local/Cellar/python@3.9/3.9.1_2/Frameworks/Python.framework/Versions/3.9/lib/python3.9/subprocess.py", line 420, in check_output
        return run(*popenargs, stdout=PIPE, timeout=timeout, check=True,
      File "/usr/local/Cellar/python@3.9/3.9.1_2/Frameworks/Python.framework/Versions/3.9/lib/python3.9/subprocess.py", line 524, in run
        raise CalledProcessError(retcode, process.args,
    subprocess.CalledProcessError: Command '['/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/bin/python3', '-c', 'import numpy.f2py; numpy.f2py.main()', '-c', '-m', 'fortran_module', 'fortran_module.f', '--quiet', '--f77exec=sage-inline-fortran', '--f90exec=sage-inline-fortran']' returned non-zero exit status 1.

    During handling of the above exception, another exception occurred:

    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.inline_fortran._import_module_from_path_impl[1]>", line 1, in <module>
        fortran(code, globals())
      File "sage/misc/lazy_import.pyx", line 360, in sage.misc.lazy_import.LazyImport.__call__ (build/cythonized/sage/misc/lazy_import.c:4032)
        return self.get_object()(*args, **kwds)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py", line 76, in __call__
        return self.eval(*args, **kwds)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/misc/inline_fortran.py", line 172, in eval
        raise RuntimeError(
    RuntimeError: failed to compile Fortran code:
    b'gfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\ngfortran: warning: couldn\'t understand version 11\nerror: Command "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/bin/sage-inline-fortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/src.macosx-11-x86_64-3.9/fortran_modulemodule.o /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/src.macosx-11-x86_64-3.9/fortranobject.o /var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/tmpr718avny/fortran_module.o -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -lgfortran -o ./fortran_module.cpython-39-darwin.so" failed with exit status 1\n'
**********************************************************************
File "src/sage/misc/inline_fortran.py", line 117, in sage.misc.inline_fortran._import_module_from_path_impl
Failed example:
    fib(a, 10)
Exception raised:
    Traceback (most recent call last):
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.inline_fortran._import_module_from_path_impl[4]>", line 1, in <module>
        fib(a, Integer(10))
    NameError: name 'fib' is not defined
**********************************************************************
File "src/sage/misc/inline_fortran.py", line 118, in sage.misc.inline_fortran._import_module_from_path_impl
Failed example:
    a
Expected:
    array([  0.,   1.,   1.,   2.,   3.,   5.,   8.,  13.,  21.,  34.])
Got:
    array([0., 1., 2., 3., 4., 5., 6., 7., 8., 9.])
**********************************************************************
1 item had failures:
   3 of  10 in sage.misc.inline_fortran._import_module_from_path_impl
```



---

archive/issue_comments_489204.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,8 +5,8 @@\n - #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local\n - #31050 upgrade wheel\n - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n+- #31128 MR50: Upgrade cffi to 1.14.4\n - #30589 Upgrade Python to 3.9.1\n-\n \n Related:\n \n``````\n",
    "created_at": "2020-12-29T18:40:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489204",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,8 +5,8 @@
 - #30745 homebrew: Errors when homebrew's ntl, flint, or ecl are installed in /usr/local
 - #31050 upgrade wheel
 - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
+- #31128 MR50: Upgrade cffi to 1.14.4
 - #30589 Upgrade Python to 3.9.1
-
 
 Related:
 
``````




---

archive/issue_comments_489205.json:
```json
{
    "body": "<div id=\"comment:44\" align=\"right\">comment:44</div>\n\nReplying to [@jhpalmieri](#comment:42):\n> - upgrade setuptools and setuptools_scm (not sure if this is necessary)\n\nCould you open a ticket for this?",
    "created_at": "2020-12-29T19:58:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489205",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:44" align="right">comment:44</div>

Replying to [@jhpalmieri](#comment:42):
> - upgrade setuptools and setuptools_scm (not sure if this is necessary)

Could you open a ticket for this?



---

archive/issue_comments_489206.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nReplying to [@mkoeppe](#comment:44):\n> Replying to [@jhpalmieri](#comment:42):\n> > - upgrade setuptools and setuptools_scm (not sure if this is necessary)\n\n> \n> Could you open a ticket for this?\n\nDone at #31134.",
    "created_at": "2020-12-29T21:51:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489206",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:45" align="right">comment:45</div>

Replying to [@mkoeppe](#comment:44):
> Replying to [@jhpalmieri](#comment:42):
> > - upgrade setuptools and setuptools_scm (not sure if this is necessary)

> 
> Could you open a ticket for this?

Done at #31134.



---

archive/issue_comments_489207.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,6 +6,7 @@\n - #31050 upgrade wheel\n - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n - #31128 MR50: Upgrade cffi to 1.14.4\n+- #31134: upgrade setuptools and setuptools_scm\n - #30589 Upgrade Python to 3.9.1\n \n Related:\n``````\n",
    "created_at": "2020-12-29T21:53:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489207",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,6 +6,7 @@
 - #31050 upgrade wheel
 - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
 - #31128 MR50: Upgrade cffi to 1.14.4
+- #31134: upgrade setuptools and setuptools_scm
 - #30589 Upgrade Python to 3.9.1
 
 Related:
``````




---

archive/issue_comments_489208.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n - #31050 upgrade wheel\n - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n - #31128 MR50: Upgrade cffi to 1.14.4\n-- #31134: upgrade setuptools and setuptools_scm\n+- #31134 upgrade setuptools and setuptools_scm\n - #30589 Upgrade Python to 3.9.1\n \n Related:\n``````\n",
    "created_at": "2020-12-29T21:53:18Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489208",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 - #31050 upgrade wheel
 - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
 - #31128 MR50: Upgrade cffi to 1.14.4
-- #31134: upgrade setuptools and setuptools_scm
+- #31134 upgrade setuptools and setuptools_scm
 - #30589 Upgrade Python to 3.9.1
 
 Related:
``````




---

archive/issue_comments_489209.json:
```json
{
    "body": "<div id=\"comment:48\" align=\"right\">comment:48</div>\n\nReplying to [@jhpalmieri](#comment:36):\n> After running `make pillow`, I tried `make numpy` and got an unexpected error:\n> \n> ```\n> Package 'numpy' is currently not installed\n> Uninstalling 'numpy' with legacy uninstaller\n> Traceback (most recent call last):\n>   File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/var/tmp/sage/build/numpy-1.19.4/src/../lapack_conf.py\", line 7, in <module>\n>     pc_blas   = pkgconfig.parse('cblas blas')\n>   File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py\", line 248, in parse\n>     _raise_if_not_exists(package)\n>   File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py\", line 103, in _raise_if_not_exists\n>     raise PackageNotFoundError(package)\n> pkgconfig.pkgconfig.PackageNotFoundError: cblas not found\n> ```\n> Missing dependency? After running just `make`, it has now reached `numpy` and gotten past this problem.\n\nI opened #31135 for this.",
    "created_at": "2020-12-29T21:56:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489209",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:48" align="right">comment:48</div>

Replying to [@jhpalmieri](#comment:36):
> After running `make pillow`, I tried `make numpy` and got an unexpected error:
> 
> ```
> Package 'numpy' is currently not installed
> Uninstalling 'numpy' with legacy uninstaller
> Traceback (most recent call last):
>   File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/var/tmp/sage/build/numpy-1.19.4/src/../lapack_conf.py", line 7, in <module>
>     pc_blas   = pkgconfig.parse('cblas blas')
>   File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py", line 248, in parse
>     _raise_if_not_exists(package)
>   File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/sage-9.3.beta5/local/lib/python3.9/site-packages/pkgconfig/pkgconfig.py", line 103, in _raise_if_not_exists
>     raise PackageNotFoundError(package)
> pkgconfig.pkgconfig.PackageNotFoundError: cblas not found
> ```
> Missing dependency? After running just `make`, it has now reached `numpy` and gotten past this problem.

I opened #31135 for this.



---

archive/issue_comments_489210.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ\n - #31128 MR50: Upgrade cffi to 1.14.4\n - #31134 upgrade setuptools and setuptools_scm\n-- #30589 Upgrade Python to 3.9.1\n+- #30589 Upgrade Python to 3.9.1, pip to 20.3.3\n \n Related:\n \n``````\n",
    "created_at": "2020-12-29T22:59:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489210",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,7 @@
 - `MACOSX_DEPLOYMENT_TARGET` problems - https://groups.google.com/g/sage-devel/c/Sj3YBVJoHQM/m/Zt-Ih_hJAwAJ
 - #31128 MR50: Upgrade cffi to 1.14.4
 - #31134 upgrade setuptools and setuptools_scm
-- #30589 Upgrade Python to 3.9.1
+- #30589 Upgrade Python to 3.9.1, pip to 20.3.3
 
 Related:
 
``````




---

archive/issue_comments_489211.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nI [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.",
    "created_at": "2020-12-30T01:20:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489211",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:50" align="right">comment:50</div>

I [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.



---

archive/issue_comments_489212.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@jhpalmieri](#comment:50):\n> I [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.\n\nShould be fixed in `numpy` 1.20, which is in release-candidate stage.",
    "created_at": "2020-12-30T06:17:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489212",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@jhpalmieri](#comment:50):
> I [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.

Should be fixed in `numpy` 1.20, which is in release-candidate stage.



---

archive/issue_comments_489213.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nI found a patch for gfortran on Intel Macs at \n\nhttps://github.com/gcc-mirror/gcc/commit/96de87b99bf8fd1c46df373bbcc2f7d76db716ad\n\nI'll try to open a pull request tomorrow with Homebrew to see if they can patch GCC.  That should hopefully fix all Fortran issues until GCC 11 comes out.",
    "created_at": "2020-12-30T07:21:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489213",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:52" align="right">comment:52</div>

I found a patch for gfortran on Intel Macs at 

https://github.com/gcc-mirror/gcc/commit/96de87b99bf8fd1c46df373bbcc2f7d76db716ad

I'll try to open a pull request tomorrow with Homebrew to see if they can patch GCC.  That should hopefully fix all Fortran issues until GCC 11 comes out.



---

archive/issue_comments_489214.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nI noticed this morning that homebrew had updated their gcc.  With the newest gcc formula you still need\n\nMACOSX_DEPLOYMENT_TARGET=11.0 make scipy\n\nin order for scipy to build, but now if you do\n\nMACOSX_DEPLOYMENT_TARGET=11.0 ./sage -t src/sage/misc/inline_fortran.py\n\nthen the tests all pass.",
    "created_at": "2020-12-30T15:14:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489214",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:53" align="right">comment:53</div>

I noticed this morning that homebrew had updated their gcc.  With the newest gcc formula you still need

MACOSX_DEPLOYMENT_TARGET=11.0 make scipy

in order for scipy to build, but now if you do

MACOSX_DEPLOYMENT_TARGET=11.0 ./sage -t src/sage/misc/inline_fortran.py

then the tests all pass.



---

archive/issue_comments_489215.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nReplying to [@jhpalmieri](#comment:51):\n> Replying to [@jhpalmieri](#comment:50):\n> > I [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.\n\n> \n> Should be fixed in `numpy` 1.20, which is in release-candidate stage.\n\nWe will have to backport the fix because numpy 1.20 has dropped support for Python 3.6, which I think we want to continue supporting in Sage 9.3",
    "created_at": "2021-01-03T01:50:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489215",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:54" align="right">comment:54</div>

Replying to [@jhpalmieri](#comment:51):
> Replying to [@jhpalmieri](#comment:50):
> > I [opened an issue](https://github.com/numpy/numpy/issues/18093) with `numpy` for a fix as was done with `cffi`.

> 
> Should be fixed in `numpy` 1.20, which is in release-candidate stage.

We will have to backport the fix because numpy 1.20 has dropped support for Python 3.6, which I think we want to continue supporting in Sage 9.3



---

archive/issue_comments_489216.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nOpened #31166 for the numpy fix",
    "created_at": "2021-01-03T01:54:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489216",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Opened #31166 for the numpy fix



---

archive/issue_comments_489217.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -8,6 +8,7 @@\n - #31128 MR50: Upgrade cffi to 1.14.4\n - #31134 upgrade setuptools and setuptools_scm\n - #30589 Upgrade Python to 3.9.1, pip to 20.3.3\n+- #31166 numpy: Fix for macOS 11 (Big Sur)\n \n Related:\n \n``````\n",
    "created_at": "2021-01-03T01:55:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489217",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -8,6 +8,7 @@
 - #31128 MR50: Upgrade cffi to 1.14.4
 - #31134 upgrade setuptools and setuptools_scm
 - #30589 Upgrade Python to 3.9.1, pip to 20.3.3
+- #31166 numpy: Fix for macOS 11 (Big Sur)
 
 Related:
 
``````




---

archive/issue_comments_489218.json:
```json
{
    "body": "<div id=\"comment:57\" align=\"right\">comment:57</div>\n\nI was just curious if anyone was planning to open a ticket for scipy.  I don't know enough about the sage build system, but it's possible to check if the user is on Big Sur by doing\n\nsw_vers | grep 11\n\nand then based off of the result you could set MACOSX_DEPLOYMENT_TARGET=11.0",
    "created_at": "2021-01-04T18:48:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489218",
    "user": "https://github.com/zlscherr"
}
```

<div id="comment:57" align="right">comment:57</div>

I was just curious if anyone was planning to open a ticket for scipy.  I don't know enough about the sage build system, but it's possible to check if the user is on Big Sur by doing

sw_vers | grep 11

and then based off of the result you could set MACOSX_DEPLOYMENT_TARGET=11.0



---

archive/issue_comments_489219.json:
```json
{
    "body": "<div id=\"comment:58\" align=\"right\">comment:58</div>\n\nDuring the Sage build process, Sage already defines an environment variable `MACOSX_VERSION` by\n\n```\nMACOSX_VERSION=`uname -r | awk -F. '{print $1}'`\n```\nThis should be '20' for Big Sur.\n\nI'll open a `scipy` ticket.",
    "created_at": "2021-01-04T20:45:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489219",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:58" align="right">comment:58</div>

During the Sage build process, Sage already defines an environment variable `MACOSX_VERSION` by

```
MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`
```
This should be '20' for Big Sur.

I'll open a `scipy` ticket.



---

archive/issue_comments_489220.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,6 +9,7 @@\n - #31134 upgrade setuptools and setuptools_scm\n - #30589 Upgrade Python to 3.9.1, pip to 20.3.3\n - #31166 numpy: Fix for macOS 11 (Big Sur)\n+- #31183 scipy: fix for macOS 11 (Big Sur)\n \n Related:\n \n``````\n",
    "created_at": "2021-01-04T20:46:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489220",
    "user": "https://github.com/jhpalmieri"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,6 +9,7 @@
 - #31134 upgrade setuptools and setuptools_scm
 - #30589 Upgrade Python to 3.9.1, pip to 20.3.3
 - #31166 numpy: Fix for macOS 11 (Big Sur)
+- #31183 scipy: fix for macOS 11 (Big Sur)
 
 Related:
 
``````




---

archive/issue_comments_489221.json:
```json
{
    "body": "<div id=\"comment:60\" align=\"right\">comment:60</div>\n\nReplying to [@jhpalmieri](#comment:58):\n> During the Sage build process, Sage already defines an environment variable `MACOSX_VERSION` by\n> \n> ```\n> MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`\n> ```\n> This should be '20' for Big Sur.\n\nActually, this is not correct: this variable is not universally defined anymore, so Sage packages that try to use it end up printing warnings. For example, `r`:\n\n```\n./spkg-install: line 90: [: -ge: unary operator expected\n./spkg-install: line 94: [: -ge: unary operator expected\n```\nSee #31186.",
    "created_at": "2021-01-05T00:48:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489221",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:60" align="right">comment:60</div>

Replying to [@jhpalmieri](#comment:58):
> During the Sage build process, Sage already defines an environment variable `MACOSX_VERSION` by
> 
> ```
> MACOSX_VERSION=`uname -r | awk -F. '{print $1}'`
> ```
> This should be '20' for Big Sur.

Actually, this is not correct: this variable is not universally defined anymore, so Sage packages that try to use it end up printing warnings. For example, `r`:

```
./spkg-install: line 90: [: -ge: unary operator expected
./spkg-install: line 94: [: -ge: unary operator expected
```
See #31186.



---

archive/issue_comments_489222.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,7 @@\n Related:\n \n - #30494: Meta-ticket: Support Xcode 12\n+- #30592: Meta-ticket: Port to Apple silicon\n \n References:\n - https://bugs.python.org/issue41116\n``````\n",
    "created_at": "2021-01-18T04:12:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489222",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,7 @@
 Related:
 
 - #30494: Meta-ticket: Support Xcode 12
+- #30592: Meta-ticket: Port to Apple silicon
 
 References:
 - https://bugs.python.org/issue41116
``````




---

archive/issue_comments_489223.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,6 +10,7 @@\n - #30589 Upgrade Python to 3.9.1, pip to 20.3.3\n - #31166 numpy: Fix for macOS 11 (Big Sur)\n - #31183 scipy: fix for macOS 11 (Big Sur)\n+- #31326 `homebrew-macos-11.0-xcode-minimal`: `scipy` build fails\t\n \n Related:\n \n``````\n",
    "created_at": "2021-02-02T19:19:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489223",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,6 +10,7 @@
 - #30589 Upgrade Python to 3.9.1, pip to 20.3.3
 - #31166 numpy: Fix for macOS 11 (Big Sur)
 - #31183 scipy: fix for macOS 11 (Big Sur)
+- #31326 `homebrew-macos-11.0-xcode-minimal`: `scipy` build fails	
 
 Related:
 
``````




---

archive/issue_comments_489224.json:
```json
{
    "body": "<div id=\"comment:63\" align=\"right\">comment:63</div>\n\nFails on a the as-vanilla-as-possible buildbot machine while building scipy (I take it thats #31326):\n\n```\n    Building modules...\n    \tBuilding module \"mvn\"...\n    \t\tConstructing wrapper function \"mvnun\"...\n    \t\t  value,inform = mvnun(lower,upper,means,covar,[maxpts,abseps,releps])\n    \t\tConstructing wrapper function \"mvnun_weighted\"...\n    \t\t  value,inform = mvnun_weighted(lower,upper,means,weights,covar,[maxpts,abseps,releps])\n    \t\tConstructing wrapper function \"mvndst\"...\n    \t\t  error,value,inform = mvndst(lower,upper,infin,correl,[maxpts,abseps,releps])\n    \t\tConstructing COMMON block support for \"dkblck\"...\n    \t\t  ivls\n    \tWrote C/API module \"mvn\" to file \"build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvnmodule.c\"\n    \tFortran 77 wrappers are saved to \"build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvn-f2pywrappers.f\"\n      adding 'build/src.macosx-10.9-x86_64-3.9/build/src.macosx-10.9-x86_64-3.9/scipy/stats/fortranobject.c' to sources.\n      adding 'build/src.macosx-10.9-x86_64-3.9/build/src.macosx-10.9-x86_64-3.9/scipy/stats' to include_dirs.\n      adding 'build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvn-f2pywrappers.f' to sources.\n    building extension \"scipy.ndimage._nd_image\" sources\n    building extension \"scipy.ndimage._ni_label\" sources\n    building extension \"scipy.ndimage._ctest\" sources\n    building extension \"scipy.ndimage._ctest_oldapi\" sources\n    building extension \"scipy.ndimage._cytest\" sources\n    building extension \"scipy._lib._ccallback_c\" sources\n    building extension \"scipy._lib._test_ccallback\" sources\n    building extension \"scipy._lib._fpumode\" sources\n    building extension \"scipy._lib.messagestream\" sources\n    creating build/src.macosx-10.9-x86_64-3.9/scipy/_lib\n    Traceback (most recent call last):\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py\", line 280, in <module>\n        main()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py\", line 263, in main\n        json_out['return_val'] = hook(**hook_input['kwargs'])\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py\", line 133, in prepare_metadata_for_build_wheel\n        return hook(metadata_directory, config_settings)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py\", line 161, in prepare_metadata_for_build_wheel\n        self.run_setup()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py\", line 253, in run_setup\n        super(_BuildMetaLegacyBackend,\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py\", line 145, in run_setup\n        exec(compile(code, __file__, 'exec'), locals())\n      File \"setup.py\", line 583, in <module>\n        setup_package()\n      File \"setup.py\", line 579, in setup_package\n        setup(**metadata)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/core.py\", line 169, in setup\n        return old_setup(**new_attr)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/__init__.py\", line 153, in setup\n        return distutils.core.setup(**attrs)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/core.py\", line 148, in setup\n        dist.run_commands()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py\", line 966, in run_commands\n        self.run_command(cmd)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py\", line 985, in run_command\n        cmd_obj.run()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/command/dist_info.py\", line 31, in run\n        egg_info.run()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/egg_info.py\", line 24, in run\n        self.run_command(\"build_src\")\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/cmd.py\", line 313, in run_command\n        self.distribution.run_command(command)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py\", line 985, in run_command\n        cmd_obj.run()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py\", line 144, in run\n        self.build_sources()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py\", line 161, in build_sources\n        self.build_extension_sources(ext)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py\", line 318, in build_extension_sources\n        sources = self.generate_sources(sources, ext)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py\", line 378, in generate_sources\n        source = func(extension, build_dir)\n      File \"scipy/_lib/setup.py\", line 30, in get_messagestream_config\n        if config_cmd.check_func('open_memstream', decl=True, call=True):\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/config.py\", line 321, in check_func\n        self._check_compiler()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/config.py\", line 80, in _check_compiler\n        self.fcompiler = new_fcompiler(compiler=self.fcompiler,\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 880, in new_fcompiler\n        compiler = get_default_fcompiler(plat, requiref90=requiref90,\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 851, in get_default_fcompiler\n        compiler_type =  _find_existing_fcompiler(matching_compiler_types,\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 802, in _find_existing_fcompiler\n        c.customize(dist)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 507, in customize\n        get_flags('opt', oflags)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 498, in get_flags\n        flags.extend(getattr(self.flag_vars, tag))\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/environment.py\", line 37, in __getattr__\n        return self._get_var(name, conf_desc)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/environment.py\", line 53, in _get_var\n        var = self._hook_handler(name, hook)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 705, in _environment_hook\n        return hook()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py\", line 229, in get_flags_opt\n        v = self.get_version()\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py\", line 426, in get_version\n        version = CCompiler.get_version(self, force=force, ok_status=ok_status)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/ccompiler.py\", line 90, in <lambda>\n        m = lambda self, *args, **kw: func(self, *args, **kw)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/ccompiler.py\", line 657, in CCompiler_get_version\n        version = matcher(output)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py\", line 278, in version_match\n        v = self.gnu_version_match(version_string)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py\", line 80, in gnu_version_match\n        raise ValueError(err + version_string)\n    ValueError: A valid Fortran version was not found in this string:\n    9.2.0\n    Preparing wheel metadata: finished with status 'error'\n```",
    "created_at": "2021-03-07T21:37:32Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489224",
    "user": "https://github.com/vbraun"
}
```

<div id="comment:63" align="right">comment:63</div>

Fails on a the as-vanilla-as-possible buildbot machine while building scipy (I take it thats #31326):

```
    Building modules...
    	Building module "mvn"...
    		Constructing wrapper function "mvnun"...
    		  value,inform = mvnun(lower,upper,means,covar,[maxpts,abseps,releps])
    		Constructing wrapper function "mvnun_weighted"...
    		  value,inform = mvnun_weighted(lower,upper,means,weights,covar,[maxpts,abseps,releps])
    		Constructing wrapper function "mvndst"...
    		  error,value,inform = mvndst(lower,upper,infin,correl,[maxpts,abseps,releps])
    		Constructing COMMON block support for "dkblck"...
    		  ivls
    	Wrote C/API module "mvn" to file "build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvnmodule.c"
    	Fortran 77 wrappers are saved to "build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvn-f2pywrappers.f"
      adding 'build/src.macosx-10.9-x86_64-3.9/build/src.macosx-10.9-x86_64-3.9/scipy/stats/fortranobject.c' to sources.
      adding 'build/src.macosx-10.9-x86_64-3.9/build/src.macosx-10.9-x86_64-3.9/scipy/stats' to include_dirs.
      adding 'build/src.macosx-10.9-x86_64-3.9/scipy/stats/mvn-f2pywrappers.f' to sources.
    building extension "scipy.ndimage._nd_image" sources
    building extension "scipy.ndimage._ni_label" sources
    building extension "scipy.ndimage._ctest" sources
    building extension "scipy.ndimage._ctest_oldapi" sources
    building extension "scipy.ndimage._cytest" sources
    building extension "scipy._lib._ccallback_c" sources
    building extension "scipy._lib._test_ccallback" sources
    building extension "scipy._lib._fpumode" sources
    building extension "scipy._lib.messagestream" sources
    creating build/src.macosx-10.9-x86_64-3.9/scipy/_lib
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py", line 280, in <module>
        main()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py", line 263, in main
        json_out['return_val'] = hook(**hook_input['kwargs'])
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/pip/_vendor/pep517/_in_process.py", line 133, in prepare_metadata_for_build_wheel
        return hook(metadata_directory, config_settings)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 161, in prepare_metadata_for_build_wheel
        self.run_setup()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 253, in run_setup
        super(_BuildMetaLegacyBackend,
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/build_meta.py", line 145, in run_setup
        exec(compile(code, __file__, 'exec'), locals())
      File "setup.py", line 583, in <module>
        setup_package()
      File "setup.py", line 579, in setup_package
        setup(**metadata)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/core.py", line 169, in setup
        return old_setup(**new_attr)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/__init__.py", line 153, in setup
        return distutils.core.setup(**attrs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/core.py", line 148, in setup
        dist.run_commands()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py", line 966, in run_commands
        self.run_command(cmd)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py", line 985, in run_command
        cmd_obj.run()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/setuptools/command/dist_info.py", line 31, in run
        egg_info.run()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/egg_info.py", line 24, in run
        self.run_command("build_src")
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/cmd.py", line 313, in run_command
        self.distribution.run_command(command)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/distutils/dist.py", line 985, in run_command
        cmd_obj.run()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py", line 144, in run
        self.build_sources()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py", line 161, in build_sources
        self.build_extension_sources(ext)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py", line 318, in build_extension_sources
        sources = self.generate_sources(sources, ext)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/build_src.py", line 378, in generate_sources
        source = func(extension, build_dir)
      File "scipy/_lib/setup.py", line 30, in get_messagestream_config
        if config_cmd.check_func('open_memstream', decl=True, call=True):
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/config.py", line 321, in check_func
        self._check_compiler()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/command/config.py", line 80, in _check_compiler
        self.fcompiler = new_fcompiler(compiler=self.fcompiler,
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 880, in new_fcompiler
        compiler = get_default_fcompiler(plat, requiref90=requiref90,
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 851, in get_default_fcompiler
        compiler_type =  _find_existing_fcompiler(matching_compiler_types,
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 802, in _find_existing_fcompiler
        c.customize(dist)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 507, in customize
        get_flags('opt', oflags)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 498, in get_flags
        flags.extend(getattr(self.flag_vars, tag))
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/environment.py", line 37, in __getattr__
        return self._get_var(name, conf_desc)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/environment.py", line 53, in _get_var
        var = self._hook_handler(name, hook)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 705, in _environment_hook
        return hook()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py", line 229, in get_flags_opt
        v = self.get_version()
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/__init__.py", line 426, in get_version
        version = CCompiler.get_version(self, force=force, ok_status=ok_status)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/ccompiler.py", line 90, in <lambda>
        m = lambda self, *args, **kw: func(self, *args, **kw)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/ccompiler.py", line 657, in CCompiler_get_version
        version = matcher(output)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py", line 278, in version_match
        v = self.gnu_version_match(version_string)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.9/site-packages/numpy/distutils/fcompiler/gnu.py", line 80, in gnu_version_match
        raise ValueError(err + version_string)
    ValueError: A valid Fortran version was not found in this string:
    9.2.0
    Preparing wheel metadata: finished with status 'error'
```



---

archive/issue_comments_489225.json:
```json
{
    "body": "<div id=\"comment:64\" align=\"right\">comment:64</div>\n\nYou know the drill... full config.log, full log please",
    "created_at": "2021-03-07T21:39:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489225",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:64" align="right">comment:64</div>

You know the drill... full config.log, full log please



---

archive/issue_comments_489226.json:
```json
{
    "body": "<div id=\"comment:65\" align=\"right\">comment:65</div>\n\nhttps://github.com/numpy/numpy/issues/11822 ?",
    "created_at": "2021-03-08T01:10:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489226",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:65" align="right">comment:65</div>

https://github.com/numpy/numpy/issues/11822 ?



---

archive/issue_comments_489227.json:
```json
{
    "body": "<div id=\"comment:66\" align=\"right\">comment:66</div>\n\nFor what it's worth, I am due for an upgrade and a test run of a Time Machine copy of my current (old) Mac onto a new Big Sur machine on an M1 chip apparently works - I'm not sure how, presumably using Rosetta somehow.  Do we have any other data points about upgrading the Mac but leaving a working Sage install in place?  (I guess upgrading that install would fall squarely under this ticket, though.)",
    "created_at": "2021-03-09T04:14:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489227",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:66" align="right">comment:66</div>

For what it's worth, I am due for an upgrade and a test run of a Time Machine copy of my current (old) Mac onto a new Big Sur machine on an M1 chip apparently works - I'm not sure how, presumably using Rosetta somehow.  Do we have any other data points about upgrading the Mac but leaving a working Sage install in place?  (I guess upgrading that install would fall squarely under this ticket, though.)



---

archive/issue_events_424683.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T00:48:34Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%202%20%E2%80%93%20critical",
    "label_color": "ff7700",
    "label_name": "p: 2 \u2013 critical",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424683"
}
```



---

archive/issue_events_424684.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-24T00:48:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424684"
}
```



---

archive/issue_comments_489228.json:
```json
{
    "body": "<div id=\"comment:68\" align=\"right\">comment:68</div>\n\nI think we can close the ticket now - this task is done",
    "created_at": "2021-03-28T02:15:37Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489228",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:68" align="right">comment:68</div>

I think we can close the ticket now - this task is done



---

archive/issue_events_424685.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T02:15:37Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424685"
}
```



---

archive/issue_events_424686.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T02:15:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424686"
}
```



---

archive/issue_events_424687.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T02:15:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/invalid",
    "label_color": "c6c6c6",
    "label_name": "invalid",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424687"
}
```



---

archive/issue_events_424688.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-28T02:15:37Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424688"
}
```



---

archive/issue_comments_489229.json:
```json
{
    "body": "<div id=\"comment:69\" align=\"right\">comment:69</div>\n\nYes, I agree.",
    "created_at": "2021-03-28T21:57:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30651#issuecomment-489229",
    "user": "https://github.com/jhpalmieri"
}
```

<div id="comment:69" align="right">comment:69</div>

Yes, I agree.



---

archive/issue_events_424689.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-28T21:57:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424689"
}
```



---

archive/issue_events_424690.json:
```json
{
    "actor": "https://github.com/jhpalmieri",
    "created_at": "2021-03-28T21:57:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424690"
}
```



---

archive/issue_events_424691.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424691"
}
```



---

archive/issue_events_424692.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-06-24T20:15:37Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30651",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30651#event-424692"
}
```
