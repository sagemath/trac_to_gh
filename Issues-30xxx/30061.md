# Issue 30061: Speed up constructing high-dimensional Euclidean spaces

archive/issues_029824.json:
```json
{
    "body": "The n-dimensional Euclidean space is available in Sage in many variants.  \n\nThis ticket brings the speed of the most basic operation (constructing the space) of `EuclideanSpace` (from sage-manifolds) closer to that of the other variants.\n\n**Spaces without scalar product:**\n\n```\nsage: VectorSpace(QQ, 5).category()\nCategory of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)\nsage: %time VectorSpace(QQ, 5)\nCPU times: user 28 \u00b5s, sys: 9 \u00b5s, total: 37 \u00b5s\nWall time: 40.1 \u00b5s\nVector space of dimension 5 over Rational Field\nsage: %time VectorSpace(QQ, 80)\nCPU times: user 218 \u00b5s, sys: 1 \u00b5s, total: 219 \u00b5s\nWall time: 223 \u00b5s\nVector space of dimension 80 over Rational Field\nsage: %time VectorSpace(QQ, 1000)\nCPU times: user 208 \u00b5s, sys: 1 \u00b5s, total: 209 \u00b5s\nWall time: 213 \u00b5s\nVector space of dimension 1000 over Rational Field\n\nsage: for n in 5, 80, 1000, 4000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {})\".format(n),number=1,repeat=1)); u = [ x for x i\n....: n range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\nn = 5\nConstruction:  1 loop, best of 1: 56.1 ms per loop\nDistance:      625 loops, best of 3: 81.7 \u03bcs per loop\nn = 80\nConstruction:  1 loop, best of 1: 159 \u03bcs per loop\nDistance:      625 loops, best of 3: 299 \u03bcs per loop\nn = 1000\nConstruction:  1 loop, best of 1: 236 \u03bcs per loop\nDistance:      125 loops, best of 3: 3.18 ms per loop\nn = 4000\nConstruction:  1 loop, best of 1: 147 \u03bcs per loop\nDistance:      25 loops, best of 3: 11.3 ms per loop\nn = 10000\nConstruction:  1 loop, best of 1: 149 \u03bcs per loop\nDistance:      25 loops, best of 3: 28.7 ms per loop\nn = 100000\nConstruction:  1 loop, best of 1: 162 \u03bcs per loop\nDistance:      5 loops, best of 3: 296 ms per loop\n```\n\n```\nsage: CombinatorialFreeModule(QQ, range(5)).category()\nCategory of finite dimensional vector spaces with basis over Rational Field\nsage: %time CombinatorialFreeModule(QQ, range(5))\nCPU times: user 80 \u00b5s, sys: 0 ns, total: 80 \u00b5s\nWall time: 86.1 \u00b5s\nFree module generated by {0, 1, 2, 3, 4} over Rational Field\nsage: %time CombinatorialFreeModule(QQ, range(80))\nCPU times: user 244 \u00b5s, sys: 10 \u00b5s, total: 254 \u00b5s\nWall time: 259 \u00b5s\nFree module generated by {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79} over Rational Field\nsage: %time CombinatorialFreeModule(QQ, range(1000))\nCPU times: user 322 \u00b5s, sys: 26 \u00b5s, total: 348 \u00b5s\nWall time: 354 \u00b5s\n```\n\n\n```\nsage: AffineSpace(RR, 5).category()\nCategory of schemes over Real Field with 53 bits of precision\n\nsage: %time AffineSpace(RR, 5)\nCPU times: user 47 \u00b5s, sys: 1 \u00b5s, total: 48 \u00b5s\nWall time: 51 \u00b5s\nAffine Space of dimension 5 over Real Field with 53 bits of precision\nsage: %time AffineSpace(RR, 80)\nCPU times: user 2 ms, sys: 39 \u00b5s, total: 2.04 ms\nWall time: 2.04 ms\nAffine Space of dimension 80 over Real Field with 53 bits of precision\nsage: %time AffineSpace(RR, 1000)\nCPU times: user 62.8 ms, sys: 1.45 ms, total: 64.3 ms\nWall time: 63.5 ms\nAffine Space of dimension 1000 over Real Field with 53 bits of precision\n```\n\n\n**Spaces with scalar product:**\n\n```\nsage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()\nCategory of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)\nsage: %time VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5))\nCPU times: user 6.55 ms, sys: 666 \u00b5s, total: 7.22 ms\nWall time: 6.88 ms\nAmbient quadratic space of dimension 5 over Rational Field\nInner product matrix:\n[1 0 0 0 0]\n[0 1 0 0 0]\n[0 0 1 0 0]\n[0 0 0 1 0]\n[0 0 0 0 1]\nsage: %time VectorSpace(QQ, 80, inner_product_matrix=matrix.identity(80))\nCPU times: user 14.1 ms, sys: 439 \u00b5s, total: 14.6 ms\nWall time: 14.4 ms\nAmbient quadratic space of dimension 80 over Rational Field\nInner product matrix:\nsage: %time VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))\nCPU times: user 1.44 s, sys: 34.4 ms, total: 1.47 s\nWall time: 1.48 s\nAmbient quadratic space of dimension 1000 over Rational Field\nInner product matrix: ...\n\nsage: for n in 5, 80, 1000, 4000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))\".format(n, n),number=1,repeat=1)); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print(\"Distance:     \", timeit(\"t = V(u)-V(v); sqrt(t.inner_product(t))\"))\nn = 5\nConstruction:  1 loop, best of 1: 61.9 ms per loop\nDistance:      625 loops, best of 3: 49.4 \u03bcs per loop\nn = 80\nConstruction:  1 loop, best of 1: 9.75 ms per loop\nDistance:      625 loops, best of 3: 243 \u03bcs per loop\nn = 1000\nConstruction:  1 loop, best of 1: 1.51 s per loop\nDistance:      25 loops, best of 3: 14.4 ms per loop\nn = 4000\nConstruction:  1 loop, best of 1: 23.8 s per loop\nDistance:      5 loops, best of 3: 225 ms per loop\n```\nNB: It is not in the category `MetricSpaces`, and thus the element methods `dist` and `abs` (?!) are missing... The methods `__abs__`, `norm`, and `dot_product` are unrelated to the inner product matrix; only `inner_product` uses `inner_product_matrix`.\n\n```\nsage: EuclideanSpace(5).category()\nCategory of smooth manifolds over Real Field with 53 bits of precision\n\nsage: %time EuclideanSpace(5)\nCPU times: user 177 ms, sys: 10.4 ms, total: 187 ms\nWall time: 196 ms\n5-dimensional Euclidean space E^5\nsage: %time EuclideanSpace(80)\nCPU times: user 32.8 s, sys: 758 ms, total: 33.6 s\nWall time: 31.5 s\n80-dimensional Euclidean space E^80\nsage: %time EuclideanSpace(1000)\n(timeout)\n```\n\n*With this ticket (and its dependencies #30065, #30074):*\n\n```\nsage: %time EuclideanSpace(5)\nCPU times: user 4.87 ms, sys: 372 \u00b5s, total: 5.24 ms\nWall time: 4.93 ms\n5-dimensional Euclidean space E^5\nsage: %time EuclideanSpace(80)\nCPU times: user 106 ms, sys: 4.52 ms, total: 110 ms\nWall time: 92 ms\n80-dimensional Euclidean space E^80\nsage: %time EuclideanSpace(1000)\nCPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s\nWall time: 986 ms\n```\n*Some caching is happening too. The second time:*\n\n```\nsage: %time EuclideanSpace(1000)\nCPU times: user 207 ms, sys: 5.63 ms, total: 213 ms\nWall time: 212 ms\n1000-dimensional Euclidean space E^1000\n```\n\n**Scalar product without a space:**\n\n```\nsage: %time DiagonalQuadraticForm(QQ, [1]*5)\nCPU times: user 60 \u00b5s, sys: 1e+03 ns, total: 61 \u00b5s\nWall time: 62.9 \u00b5s\nQuadratic form in 5 variables over Rational Field with coefficients: \n[ 1 0 0 0 0 ]\n[ * 1 0 0 0 ]\n[ * * 1 0 0 ]\n[ * * * 1 0 ]\n[ * * * * 1 ]\nsage: %time DiagonalQuadraticForm(QQ, [1]*80)\nCPU times: user 1.35 ms, sys: 31 \u00b5s, total: 1.39 ms\nWall time: 1.44 ms\nQuadratic form in 80 variables over Rational Field with coefficients: \nsage: %time DiagonalQuadraticForm(QQ, [1]*1000)\nCPU times: user 144 ms, sys: 2.85 ms, total: 147 ms\nWall time: 147 ms\nQuadratic form in 1000 variables over Rational Field with coefficients: \n```\n\n\n\nDepends on #30065\n\nDepends on #30074\n\n**CC:**  @egourgoulhon @tscrim @nbruin @mwageringel @mjungmath\n\n**Branch/Commit:** [3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)\n\n**Reviewer:** Matthias Koeppe\n\n**Author:** Eric Gourgoulhon\n\nIssue created by migration from https://trac.sagemath.org/ticket/30061\n\n",
    "closed_at": "2020-08-02T08:20:44Z",
    "created_at": "2020-07-04T03:35:59Z",
    "labels": [
        "component: geometry",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.2",
    "title": "Speed up constructing high-dimensional Euclidean spaces",
    "type": "issue",
    "url": "https://github.com/sagemath/sage/issues/30061",
    "user": "https://github.com/mkoeppe"
}
```
The n-dimensional Euclidean space is available in Sage in many variants.  

This ticket brings the speed of the most basic operation (constructing the space) of `EuclideanSpace` (from sage-manifolds) closer to that of the other variants.

**Spaces without scalar product:**

```
sage: VectorSpace(QQ, 5).category()
Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
sage: %time VectorSpace(QQ, 5)
CPU times: user 28 µs, sys: 9 µs, total: 37 µs
Wall time: 40.1 µs
Vector space of dimension 5 over Rational Field
sage: %time VectorSpace(QQ, 80)
CPU times: user 218 µs, sys: 1 µs, total: 219 µs
Wall time: 223 µs
Vector space of dimension 80 over Rational Field
sage: %time VectorSpace(QQ, 1000)
CPU times: user 208 µs, sys: 1 µs, total: 209 µs
Wall time: 213 µs
Vector space of dimension 1000 over Rational Field

sage: for n in 5, 80, 1000, 4000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {})".format(n),number=1,repeat=1)); u = [ x for x i
....: n range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print("Distance:     ", timeit("norm(V(u) - V(v))"))
n = 5
Construction:  1 loop, best of 1: 56.1 ms per loop
Distance:      625 loops, best of 3: 81.7 μs per loop
n = 80
Construction:  1 loop, best of 1: 159 μs per loop
Distance:      625 loops, best of 3: 299 μs per loop
n = 1000
Construction:  1 loop, best of 1: 236 μs per loop
Distance:      125 loops, best of 3: 3.18 ms per loop
n = 4000
Construction:  1 loop, best of 1: 147 μs per loop
Distance:      25 loops, best of 3: 11.3 ms per loop
n = 10000
Construction:  1 loop, best of 1: 149 μs per loop
Distance:      25 loops, best of 3: 28.7 ms per loop
n = 100000
Construction:  1 loop, best of 1: 162 μs per loop
Distance:      5 loops, best of 3: 296 ms per loop
```

```
sage: CombinatorialFreeModule(QQ, range(5)).category()
Category of finite dimensional vector spaces with basis over Rational Field
sage: %time CombinatorialFreeModule(QQ, range(5))
CPU times: user 80 µs, sys: 0 ns, total: 80 µs
Wall time: 86.1 µs
Free module generated by {0, 1, 2, 3, 4} over Rational Field
sage: %time CombinatorialFreeModule(QQ, range(80))
CPU times: user 244 µs, sys: 10 µs, total: 254 µs
Wall time: 259 µs
Free module generated by {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79} over Rational Field
sage: %time CombinatorialFreeModule(QQ, range(1000))
CPU times: user 322 µs, sys: 26 µs, total: 348 µs
Wall time: 354 µs
```


```
sage: AffineSpace(RR, 5).category()
Category of schemes over Real Field with 53 bits of precision

sage: %time AffineSpace(RR, 5)
CPU times: user 47 µs, sys: 1 µs, total: 48 µs
Wall time: 51 µs
Affine Space of dimension 5 over Real Field with 53 bits of precision
sage: %time AffineSpace(RR, 80)
CPU times: user 2 ms, sys: 39 µs, total: 2.04 ms
Wall time: 2.04 ms
Affine Space of dimension 80 over Real Field with 53 bits of precision
sage: %time AffineSpace(RR, 1000)
CPU times: user 62.8 ms, sys: 1.45 ms, total: 64.3 ms
Wall time: 63.5 ms
Affine Space of dimension 1000 over Real Field with 53 bits of precision
```


**Spaces with scalar product:**

```
sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()
Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
sage: %time VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5))
CPU times: user 6.55 ms, sys: 666 µs, total: 7.22 ms
Wall time: 6.88 ms
Ambient quadratic space of dimension 5 over Rational Field
Inner product matrix:
[1 0 0 0 0]
[0 1 0 0 0]
[0 0 1 0 0]
[0 0 0 1 0]
[0 0 0 0 1]
sage: %time VectorSpace(QQ, 80, inner_product_matrix=matrix.identity(80))
CPU times: user 14.1 ms, sys: 439 µs, total: 14.6 ms
Wall time: 14.4 ms
Ambient quadratic space of dimension 80 over Rational Field
Inner product matrix:
sage: %time VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))
CPU times: user 1.44 s, sys: 34.4 ms, total: 1.47 s
Wall time: 1.48 s
Ambient quadratic space of dimension 1000 over Rational Field
Inner product matrix: ...

sage: for n in 5, 80, 1000, 4000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))".format(n, n),number=1,repeat=1)); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print("Distance:     ", timeit("t = V(u)-V(v); sqrt(t.inner_product(t))"))
n = 5
Construction:  1 loop, best of 1: 61.9 ms per loop
Distance:      625 loops, best of 3: 49.4 μs per loop
n = 80
Construction:  1 loop, best of 1: 9.75 ms per loop
Distance:      625 loops, best of 3: 243 μs per loop
n = 1000
Construction:  1 loop, best of 1: 1.51 s per loop
Distance:      25 loops, best of 3: 14.4 ms per loop
n = 4000
Construction:  1 loop, best of 1: 23.8 s per loop
Distance:      5 loops, best of 3: 225 ms per loop
```
NB: It is not in the category `MetricSpaces`, and thus the element methods `dist` and `abs` (?!) are missing... The methods `__abs__`, `norm`, and `dot_product` are unrelated to the inner product matrix; only `inner_product` uses `inner_product_matrix`.

```
sage: EuclideanSpace(5).category()
Category of smooth manifolds over Real Field with 53 bits of precision

sage: %time EuclideanSpace(5)
CPU times: user 177 ms, sys: 10.4 ms, total: 187 ms
Wall time: 196 ms
5-dimensional Euclidean space E^5
sage: %time EuclideanSpace(80)
CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s
Wall time: 31.5 s
80-dimensional Euclidean space E^80
sage: %time EuclideanSpace(1000)
(timeout)
```

*With this ticket (and its dependencies #30065, #30074):*

```
sage: %time EuclideanSpace(5)
CPU times: user 4.87 ms, sys: 372 µs, total: 5.24 ms
Wall time: 4.93 ms
5-dimensional Euclidean space E^5
sage: %time EuclideanSpace(80)
CPU times: user 106 ms, sys: 4.52 ms, total: 110 ms
Wall time: 92 ms
80-dimensional Euclidean space E^80
sage: %time EuclideanSpace(1000)
CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s
Wall time: 986 ms
```
*Some caching is happening too. The second time:*

```
sage: %time EuclideanSpace(1000)
CPU times: user 207 ms, sys: 5.63 ms, total: 213 ms
Wall time: 212 ms
1000-dimensional Euclidean space E^1000
```

**Scalar product without a space:**

```
sage: %time DiagonalQuadraticForm(QQ, [1]*5)
CPU times: user 60 µs, sys: 1e+03 ns, total: 61 µs
Wall time: 62.9 µs
Quadratic form in 5 variables over Rational Field with coefficients: 
[ 1 0 0 0 0 ]
[ * 1 0 0 0 ]
[ * * 1 0 0 ]
[ * * * 1 0 ]
[ * * * * 1 ]
sage: %time DiagonalQuadraticForm(QQ, [1]*80)
CPU times: user 1.35 ms, sys: 31 µs, total: 1.39 ms
Wall time: 1.44 ms
Quadratic form in 80 variables over Rational Field with coefficients: 
sage: %time DiagonalQuadraticForm(QQ, [1]*1000)
CPU times: user 144 ms, sys: 2.85 ms, total: 147 ms
Wall time: 147 ms
Quadratic form in 1000 variables over Rational Field with coefficients: 
```



Depends on #30065

Depends on #30074

**CC:**  @egourgoulhon @tscrim @nbruin @mwageringel @mjungmath

**Branch/Commit:** [3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)

**Reviewer:** Matthias Koeppe

**Author:** Eric Gourgoulhon

Issue created by migration from https://trac.sagemath.org/ticket/30061





---

archive/issue_comments_478540.json:
```json
{
    "body": "<a id='comment:1'></a>\nMost of the time spent seems to come from SR (Maxima). Is it possible to speed things up for this easy special case, avoiding symbolic computation completely?",
    "created_at": "2020-07-04T05:08:51Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478540",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:1'></a>
Most of the time spent seems to come from SR (Maxima). Is it possible to speed things up for this easy special case, avoiding symbolic computation completely?



---

archive/issue_comments_478541.json:
```json
{
    "body": "<a id='comment:2'></a>\n`EuclideanSpace(n)` creates the following objects:\n1. a real smooth manifold `E` of dimension `n`\n2. a chart `X` on `E`, representing the Cartesian coordinates\n3. the coordinate vector frame associated with `X`\n4. a Riemannian metric `g` on `E`, with its components w.r.t. `X` initialized to `diag(1,1,...,1)` \n5. the Levi-Civita connection associated with `g`, with its components w.r.t. `X` initialized to `0`\n\nMost of the CPU time is spent in step 2, actually in creating the symbolic variables (elements of `SR`) representing the Cartesian coordinates. The latter operation is equivalent to\n\n```\nsage: def create_coords(n):\n....:     coords = SR.var([\"x{}\".format(i) for i in range(n)], domain='real')\n....:     for x in coords:\n....:         assume(x, 'real')\n```\nand we have:\n\n```\nsage: %time EuclideanSpace(5)\nCPU times: user 345 ms, sys: 28 ms, total: 373 ms\nWall time: 373 ms\n5-dimensional Euclidean space E^5\nsage: %time create_coords(5)\nCPU times: user 456 ms, sys: 338 \u00b5s, total: 456 ms\nWall time: 402 ms\n```\n\n```\nsage: %time EuclideanSpace(20)\nCPU times: user 3.66 s, sys: 58.9 ms, total: 3.72 s\nWall time: 3.48 s\n20-dimensional Euclidean space E^20\nsage: %time create_coords(20)\nCPU times: user 3.38 s, sys: 75.3 ms, total: 3.45 s\nWall time: 3.21 s\n```\n\n```\nsage: %time EuclideanSpace(40)\nCPU times: user 12.6 s, sys: 253 ms, total: 12.8 s\nWall time: 11.9 s\n40-dimensional EuclideanSR.var([\"x{}\".format(i) for i in range(n)], space E^40\nsage: %time create_coords(40)\nCPU times: user 12.2 s, sys: 226 ms, total: 12.5 s\nWall time: 11.4 s\n```\nActually, it turns out that what takes most of CPU time is demanding that the symbolic variables are real. Indeed, if we skip `domain='real'` and `assume(x, 'real')` (each uses roughly half of the CPU time and, although they look redundant, both are actually necessary for efficient simplifications), we get very small times:\n\n```\nsage: %time coords = SR.var([\"x{}\".format(i) for i in range(40)])\nCPU times: user 336 \u00b5s, sys: 9 \u00b5s, total: 345 \u00b5s\nWall time: 350 \u00b5s\n```\nI don't know why `SR.var('x', domain='real')` and `assume(x, 'real')` are so slow...\n\nNB: in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via\n\n```\nsage: E = EuclideanSpace(5)\nsage: E.set_calculus_method('sympy')\n```\nchart coordinates could be stored as SymPy variables, instead of SR ones.",
    "created_at": "2020-07-04T17:24:49Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478541",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:2'></a>
`EuclideanSpace(n)` creates the following objects:
1. a real smooth manifold `E` of dimension `n`
2. a chart `X` on `E`, representing the Cartesian coordinates
3. the coordinate vector frame associated with `X`
4. a Riemannian metric `g` on `E`, with its components w.r.t. `X` initialized to `diag(1,1,...,1)` 
5. the Levi-Civita connection associated with `g`, with its components w.r.t. `X` initialized to `0`

Most of the CPU time is spent in step 2, actually in creating the symbolic variables (elements of `SR`) representing the Cartesian coordinates. The latter operation is equivalent to

```
sage: def create_coords(n):
....:     coords = SR.var(["x{}".format(i) for i in range(n)], domain='real')
....:     for x in coords:
....:         assume(x, 'real')
```
and we have:

```
sage: %time EuclideanSpace(5)
CPU times: user 345 ms, sys: 28 ms, total: 373 ms
Wall time: 373 ms
5-dimensional Euclidean space E^5
sage: %time create_coords(5)
CPU times: user 456 ms, sys: 338 µs, total: 456 ms
Wall time: 402 ms
```

```
sage: %time EuclideanSpace(20)
CPU times: user 3.66 s, sys: 58.9 ms, total: 3.72 s
Wall time: 3.48 s
20-dimensional Euclidean space E^20
sage: %time create_coords(20)
CPU times: user 3.38 s, sys: 75.3 ms, total: 3.45 s
Wall time: 3.21 s
```

```
sage: %time EuclideanSpace(40)
CPU times: user 12.6 s, sys: 253 ms, total: 12.8 s
Wall time: 11.9 s
40-dimensional EuclideanSR.var(["x{}".format(i) for i in range(n)], space E^40
sage: %time create_coords(40)
CPU times: user 12.2 s, sys: 226 ms, total: 12.5 s
Wall time: 11.4 s
```
Actually, it turns out that what takes most of CPU time is demanding that the symbolic variables are real. Indeed, if we skip `domain='real'` and `assume(x, 'real')` (each uses roughly half of the CPU time and, although they look redundant, both are actually necessary for efficient simplifications), we get very small times:

```
sage: %time coords = SR.var(["x{}".format(i) for i in range(40)])
CPU times: user 336 µs, sys: 9 µs, total: 345 µs
Wall time: 350 µs
```
I don't know why `SR.var('x', domain='real')` and `assume(x, 'real')` are so slow...

NB: in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via

```
sage: E = EuclideanSpace(5)
sage: E.set_calculus_method('sympy')
```
chart coordinates could be stored as SymPy variables, instead of SR ones.



---

archive/issue_comments_478542.json:
```json
{
    "body": "<a id='comment:3'></a>\nThanks very much for the explanation and analysis!\n\nReplying to [egourgoulhon](#comment%3A2):\n> I don't know why `SR.var('x', domain='real')` and `assume(x, 'real')` are so slow...\n\n\nI have created #30065 for this",
    "created_at": "2020-07-04T18:07:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478542",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
Thanks very much for the explanation and analysis!

Replying to [egourgoulhon](#comment%3A2):
> I don't know why `SR.var('x', domain='real')` and `assume(x, 'real')` are so slow...


I have created #30065 for this



---

archive/issue_comments_478543.json:
```json
{
    "body": "<a id='comment:4'></a>\nReplying to [egourgoulhon](#comment%3A2):\n> in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via\n> \n> ```\n> sage: E = EuclideanSpace(5)\n> sage: E.set_calculus_method('sympy')\n> ```\n> chart coordinates could be stored as SymPy variables, instead of SR ones.\n\n\nThanks, I'll try this.\n\nActually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions?",
    "created_at": "2020-07-04T18:09:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478543",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>
Replying to [egourgoulhon](#comment%3A2):
> in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via
> 
> ```
> sage: E = EuclideanSpace(5)
> sage: E.set_calculus_method('sympy')
> ```
> chart coordinates could be stored as SymPy variables, instead of SR ones.


Thanks, I'll try this.

Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions?



---

archive/issue_comments_478544.json:
```json
{
    "body": "<a id='comment:5'></a>\nIn a related direction, would it be of interest to have a category of \"algebraic\" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?",
    "created_at": "2020-07-04T18:28:55Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478544",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
In a related direction, would it be of interest to have a category of "algebraic" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?



---

archive/issue_comments_478545.json:
```json
{
    "body": "<a id='comment:6'></a>\nReplying to [mkoeppe](#comment%3A4):\n> Replying to [egourgoulhon](#comment%3A2):\n> > in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via\n> > \n> > ```\n> > sage: E = EuclideanSpace(5)\n> > sage: E.set_calculus_method('sympy')\n> > ```\n> > chart coordinates could be stored as SymPy variables, instead of SR ones.\n\n> \n> Thanks, I'll try this.\n> \n> Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? \n\n\nYes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. \n\nActually, it should be relatively easy to add a new calculus method, in addition to the two ones already implemented (SR and SymPy), via the classes [CalculusMethod](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/calculus_method.html) and [ChartFunction](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/chart_func.html).",
    "created_at": "2020-07-04T21:14:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478545",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:6'></a>
Replying to [mkoeppe](#comment%3A4):
> Replying to [egourgoulhon](#comment%3A2):
> > in the current setting, chart coordinates are stored as SR variables; but since SymPy can be used as the symbolic backend on manifolds, via
> > 
> > ```
> > sage: E = EuclideanSpace(5)
> > sage: E.set_calculus_method('sympy')
> > ```
> > chart coordinates could be stored as SymPy variables, instead of SR ones.

> 
> Thanks, I'll try this.
> 
> Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? 


Yes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. 

Actually, it should be relatively easy to add a new calculus method, in addition to the two ones already implemented (SR and SymPy), via the classes [CalculusMethod](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/calculus_method.html) and [ChartFunction](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/chart_func.html).



---

archive/issue_comments_478546.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [mkoeppe](#comment%3A5):\n> In a related direction, would it be of interest to have a category of \"algebraic\" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?\n\n\nYes, I think so.",
    "created_at": "2020-07-04T21:15:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478546",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:7'></a>
Replying to [mkoeppe](#comment%3A5):
> In a related direction, would it be of interest to have a category of "algebraic" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?


Yes, I think so.



---

archive/issue_comments_478547.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [egourgoulhon](#comment%3A6):\n> > Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? \n\n> \n> Yes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. \n> \n> Actually, it should be relatively easy to add a new calculus method, in addition to the two ones already implemented (SR and SymPy), via the classes [CalculusMethod](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/calculus_method.html) and [ChartFunction](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/chart_func.html).\n\n\nThanks! I have created #30070 for this.",
    "created_at": "2020-07-05T00:14:17Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478547",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>
Replying to [egourgoulhon](#comment%3A6):
> > Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? 

> 
> Yes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. 
> 
> Actually, it should be relatively easy to add a new calculus method, in addition to the two ones already implemented (SR and SymPy), via the classes [CalculusMethod](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/calculus_method.html) and [ChartFunction](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/chart_func.html).


Thanks! I have created #30070 for this.



---

archive/issue_comments_478548.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [egourgoulhon](#comment%3A7):\n> Replying to [mkoeppe](#comment%3A5):\n> > In a related direction, would it be of interest to have a category of \"algebraic\" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?\n\n> \n> Yes, I think so.\n\n\nOK, I have created #30069 for the case of real algebraic manifolds.\n\n\nDoes sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?",
    "created_at": "2020-07-05T00:15:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478548",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Replying to [egourgoulhon](#comment%3A7):
> Replying to [mkoeppe](#comment%3A5):
> > In a related direction, would it be of interest to have a category of "algebraic" differential manifolds, as a differential geometry view on real varieties and semialgebraic sets (and their boundaries)?

> 
> Yes, I think so.


OK, I have created #30069 for the case of real algebraic manifolds.


Does sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?



---

archive/issue_comments_478549.json:
```json
{
    "body": "<a id='comment:10'></a>\nReplying to [egourgoulhon](#comment%3A6):\n> Replying to [mkoeppe](#comment%3A4):\n> > Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? \n\n> \n> Yes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. \n> \n\nActually, for spherical coordinates, there is already some issue with rational functions at the level of the metric tensor itself, since the components of the Euclidean metric involve the sine function.",
    "created_at": "2020-07-05T08:58:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478549",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:10'></a>
Replying to [egourgoulhon](#comment%3A6):
> Replying to [mkoeppe](#comment%3A4):
> > Actually, would it make sense (at least for simple cases) to have a calculus method that only uses Sage's rational functions? 

> 
> Yes, as soon as you don't have to take a square root, as for instance in evaluating the volume n-form on a pseudo-Riemannian manifold (aka Levi-Civita tensor). In particular, this would forbid the computation of the triple scalar product within spherical coordinates in the Euclidean 3-space. 
> 

Actually, for spherical coordinates, there is already some issue with rational functions at the level of the metric tensor itself, since the components of the Euclidean metric involve the sine function.



---

archive/issue_comments_478550.json:
```json
{
    "body": "<a id='comment:11'></a>\nReplying to [mkoeppe](#comment%3A9):\n> \n> OK, I have created #30069 for the case of real algebraic manifolds.\n> \n\nVery good.\n> \n> Does sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?\n\nNo, manifolds with boundary are not implemented yet; it would be nice to have them.",
    "created_at": "2020-07-05T09:01:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478550",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:11'></a>
Replying to [mkoeppe](#comment%3A9):
> 
> OK, I have created #30069 for the case of real algebraic manifolds.
> 

Very good.
> 
> Does sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?

No, manifolds with boundary are not implemented yet; it would be nice to have them.



---

archive/issue_comments_478551.json:
```json
{
    "body": "<a id='comment:12'></a>\nWith #30065 and #30074:\n\n```\nsage: %prun EuclideanSpace(1000)\n\n         53513603 function calls (53508842 primitive calls) in 37.037 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n  2002006    4.658    0.000    4.786    0.000 tensorfield.py:684(_del_restrictions)\n  3003010    3.263    0.000    3.766    0.000 tensorfield.py:667(_del_derived)\n  2002000    3.076    0.000   18.325    0.000 free_module_tensor.py:1191(_set_comp_unsafe)\n  2002000    3.047    0.000   25.990    0.000 tensorfield_paral.py:820(set_comp)\n  2002000    2.571    0.000   22.942    0.000 free_module_tensor.py:1263(set_comp)\n  2002000    2.478    0.000    7.194    0.000 comp.py:864(__setitem__)\n  2002000    2.147    0.000    2.147    0.000 free_module_tensor.py:1474(del_other_comp)\n  2003000    2.029    0.000    2.398    0.000 comp.py:616(_check_indices)\n  2002000    1.825    0.000   20.150    0.000 tensorfield_paral.py:730(_set_comp_unsafe)\n  2002006    1.697    0.000    9.256    0.000 tensorfield_paral.py:708(_del_derived)\n        1    1.532    1.532   36.171   36.171 free_module_basis.py:566(__init__)\n  1002000    1.095    0.000    1.108    0.000 scalarfield.py:1154(is_trivial_zero)\n  1001003    0.931    0.000    7.942    0.000 vectorfield.py:1612(_del_derived)\n  8071534    0.813    0.000    0.813    0.000 {built-in method builtins.isinstance}\n        1    0.722    0.722   15.342   15.342 free_module_basis.py:375(__init__)\n  1001003    0.675    0.000    0.675    0.000 vectorfield.py:292(_del_dependencies)\n  2004002    0.656    0.000    0.656    0.000 finite_rank_free_module.py:2037(irange)\n  1001000    0.603    0.000    5.144    0.000 diff_form.py:1241(_del_derived)\n     6800    0.532    0.000    0.598    0.000 maxima_lib.py:412(_eval_line)\n  2045310    0.378    0.000    0.378    0.000 {built-in method builtins.hasattr}\n  1001003    0.335    0.000    5.137    0.000 multivectorfield.py:966(_del_derived)\n  5005023    0.334    0.000    0.334    0.000 {method 'clear' of 'dict' objects}\n```",
    "created_at": "2020-07-06T07:07:12Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478551",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
With #30065 and #30074:

```
sage: %prun EuclideanSpace(1000)

         53513603 function calls (53508842 primitive calls) in 37.037 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
  2002006    4.658    0.000    4.786    0.000 tensorfield.py:684(_del_restrictions)
  3003010    3.263    0.000    3.766    0.000 tensorfield.py:667(_del_derived)
  2002000    3.076    0.000   18.325    0.000 free_module_tensor.py:1191(_set_comp_unsafe)
  2002000    3.047    0.000   25.990    0.000 tensorfield_paral.py:820(set_comp)
  2002000    2.571    0.000   22.942    0.000 free_module_tensor.py:1263(set_comp)
  2002000    2.478    0.000    7.194    0.000 comp.py:864(__setitem__)
  2002000    2.147    0.000    2.147    0.000 free_module_tensor.py:1474(del_other_comp)
  2003000    2.029    0.000    2.398    0.000 comp.py:616(_check_indices)
  2002000    1.825    0.000   20.150    0.000 tensorfield_paral.py:730(_set_comp_unsafe)
  2002006    1.697    0.000    9.256    0.000 tensorfield_paral.py:708(_del_derived)
        1    1.532    1.532   36.171   36.171 free_module_basis.py:566(__init__)
  1002000    1.095    0.000    1.108    0.000 scalarfield.py:1154(is_trivial_zero)
  1001003    0.931    0.000    7.942    0.000 vectorfield.py:1612(_del_derived)
  8071534    0.813    0.000    0.813    0.000 {built-in method builtins.isinstance}
        1    0.722    0.722   15.342   15.342 free_module_basis.py:375(__init__)
  1001003    0.675    0.000    0.675    0.000 vectorfield.py:292(_del_dependencies)
  2004002    0.656    0.000    0.656    0.000 finite_rank_free_module.py:2037(irange)
  1001000    0.603    0.000    5.144    0.000 diff_form.py:1241(_del_derived)
     6800    0.532    0.000    0.598    0.000 maxima_lib.py:412(_eval_line)
  2045310    0.378    0.000    0.378    0.000 {built-in method builtins.hasattr}
  1001003    0.335    0.000    5.137    0.000 multivectorfield.py:966(_del_derived)
  5005023    0.334    0.000    0.334    0.000 {method 'clear' of 'dict' objects}
```



---

archive/issue_comments_478552.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,19 +1,99 @@\n+The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.\n \n ```\n+sage: VectorSpace(QQ, 5).category()\n+Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)\n+sage: %time VectorSpace(QQ, 5)\n+CPU times: user 28 \u00b5s, sys: 9 \u00b5s, total: 37 \u00b5s\n+Wall time: 40.1 \u00b5s\n+Vector space of dimension 5 over Rational Field\n+sage: %time VectorSpace(QQ, 80)\n+CPU times: user 218 \u00b5s, sys: 1 \u00b5s, total: 219 \u00b5s\n+Wall time: 223 \u00b5s\n+Vector space of dimension 80 over Rational Field\n+sage: %time VectorSpace(QQ, 1000)\n+CPU times: user 208 \u00b5s, sys: 1 \u00b5s, total: 209 \u00b5s\n+Wall time: 213 \u00b5s\n+Vector space of dimension 1000 over Rational Field\n+```\n+\n+```\n+sage: CombinatorialFreeModule(QQ, range(5)).category()\n+Category of finite dimensional vector spaces with basis over Rational Field\n+sage: %time CombinatorialFreeModule(QQ, range(5))\n+CPU times: user 80 \u00b5s, sys: 0 ns, total: 80 \u00b5s\n+Wall time: 86.1 \u00b5s\n+Free module generated by {0, 1, 2, 3, 4} over Rational Field\n+sage: %time CombinatorialFreeModule(QQ, range(80))\n+CPU times: user 244 \u00b5s, sys: 10 \u00b5s, total: 254 \u00b5s\n+Wall time: 259 \u00b5s\n+Free module generated by {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79} over Rational Field\n+sage: %time CombinatorialFreeModule(QQ, range(1000))\n+CPU times: user 322 \u00b5s, sys: 26 \u00b5s, total: 348 \u00b5s\n+Wall time: 354 \u00b5s\n+```\n+\n+\n+```\n+sage: AffineSpace(RR, 5).category()\n+Category of schemes over Real Field with 53 bits of precision\n+\n+sage: %time AffineSpace(RR, 5)\n+CPU times: user 47 \u00b5s, sys: 1 \u00b5s, total: 48 \u00b5s\n+Wall time: 51 \u00b5s\n+Affine Space of dimension 5 over Real Field with 53 bits of precision\n+sage: %time AffineSpace(RR, 80)\n+CPU times: user 2 ms, sys: 39 \u00b5s, total: 2.04 ms\n+Wall time: 2.04 ms\n+Affine Space of dimension 80 over Real Field with 53 bits of precision\n+sage: %time AffineSpace(RR, 1000)\n+CPU times: user 62.8 ms, sys: 1.45 ms, total: 64.3 ms\n+Wall time: 63.5 ms\n+Affine Space of dimension 1000 over Real Field with 53 bits of precision\n+```\n+\n+\n+```\n+sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()\n+Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)\n+sage: %time VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5))\n+CPU times: user 6.55 ms, sys: 666 \u00b5s, total: 7.22 ms\n+Wall time: 6.88 ms\n+Ambient quadratic space of dimension 5 over Rational Field\n+Inner product matrix:\n+[1 0 0 0 0]\n+[0 1 0 0 0]\n+[0 0 1 0 0]\n+[0 0 0 1 0]\n+[0 0 0 0 1]\n+sage: %time VectorSpace(QQ, 80, inner_product_matrix=matrix.identity(80))\n+CPU times: user 14.1 ms, sys: 439 \u00b5s, total: 14.6 ms\n+Wall time: 14.4 ms\n+Ambient quadratic space of dimension 80 over Rational Field\n+Inner product matrix:\n+sage: %time VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))\n+CPU times: user 1.44 s, sys: 34.4 ms, total: 1.47 s\n+Wall time: 1.48 s\n+Ambient quadratic space of dimension 1000 over Rational Field\n+Inner product matrix: ...\n+```\n+\n+\n+```\n+sage: EuclideanSpace(5).category()\n+Category of smooth manifolds over Real Field with 53 bits of precision\n+\n sage: %time EuclideanSpace(5)\n CPU times: user 177 ms, sys: 10.4 ms, total: 187 ms\n Wall time: 196 ms\n 5-dimensional Euclidean space E^5\n-sage: %time EuclideanSpace(20)\n-CPU times: user 2.16 s, sys: 56 ms, total: 2.21 s\n-Wall time: 2.08 s\n-20-dimensional Euclidean space E^20\n-sage: %time EuclideanSpace(40)\n-CPU times: user 8.06 s, sys: 188 ms, total: 8.25 s\n-Wall time: 7.84 s\n-40-dimensional Euclidean space E^40\n sage: %time EuclideanSpace(80)\n CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s\n Wall time: 31.5 s\n 80-dimensional Euclidean space E^80\n ```\n+\n+\n+\n+\n+\n``````\n",
    "created_at": "2020-07-06T07:33:55Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478552",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,19 +1,99 @@
+The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.
 
 ```
+sage: VectorSpace(QQ, 5).category()
+Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
+sage: %time VectorSpace(QQ, 5)
+CPU times: user 28 µs, sys: 9 µs, total: 37 µs
+Wall time: 40.1 µs
+Vector space of dimension 5 over Rational Field
+sage: %time VectorSpace(QQ, 80)
+CPU times: user 218 µs, sys: 1 µs, total: 219 µs
+Wall time: 223 µs
+Vector space of dimension 80 over Rational Field
+sage: %time VectorSpace(QQ, 1000)
+CPU times: user 208 µs, sys: 1 µs, total: 209 µs
+Wall time: 213 µs
+Vector space of dimension 1000 over Rational Field
+```
+
+```
+sage: CombinatorialFreeModule(QQ, range(5)).category()
+Category of finite dimensional vector spaces with basis over Rational Field
+sage: %time CombinatorialFreeModule(QQ, range(5))
+CPU times: user 80 µs, sys: 0 ns, total: 80 µs
+Wall time: 86.1 µs
+Free module generated by {0, 1, 2, 3, 4} over Rational Field
+sage: %time CombinatorialFreeModule(QQ, range(80))
+CPU times: user 244 µs, sys: 10 µs, total: 254 µs
+Wall time: 259 µs
+Free module generated by {0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79} over Rational Field
+sage: %time CombinatorialFreeModule(QQ, range(1000))
+CPU times: user 322 µs, sys: 26 µs, total: 348 µs
+Wall time: 354 µs
+```
+
+
+```
+sage: AffineSpace(RR, 5).category()
+Category of schemes over Real Field with 53 bits of precision
+
+sage: %time AffineSpace(RR, 5)
+CPU times: user 47 µs, sys: 1 µs, total: 48 µs
+Wall time: 51 µs
+Affine Space of dimension 5 over Real Field with 53 bits of precision
+sage: %time AffineSpace(RR, 80)
+CPU times: user 2 ms, sys: 39 µs, total: 2.04 ms
+Wall time: 2.04 ms
+Affine Space of dimension 80 over Real Field with 53 bits of precision
+sage: %time AffineSpace(RR, 1000)
+CPU times: user 62.8 ms, sys: 1.45 ms, total: 64.3 ms
+Wall time: 63.5 ms
+Affine Space of dimension 1000 over Real Field with 53 bits of precision
+```
+
+
+```
+sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()
+Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
+sage: %time VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5))
+CPU times: user 6.55 ms, sys: 666 µs, total: 7.22 ms
+Wall time: 6.88 ms
+Ambient quadratic space of dimension 5 over Rational Field
+Inner product matrix:
+[1 0 0 0 0]
+[0 1 0 0 0]
+[0 0 1 0 0]
+[0 0 0 1 0]
+[0 0 0 0 1]
+sage: %time VectorSpace(QQ, 80, inner_product_matrix=matrix.identity(80))
+CPU times: user 14.1 ms, sys: 439 µs, total: 14.6 ms
+Wall time: 14.4 ms
+Ambient quadratic space of dimension 80 over Rational Field
+Inner product matrix:
+sage: %time VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))
+CPU times: user 1.44 s, sys: 34.4 ms, total: 1.47 s
+Wall time: 1.48 s
+Ambient quadratic space of dimension 1000 over Rational Field
+Inner product matrix: ...
+```
+
+
+```
+sage: EuclideanSpace(5).category()
+Category of smooth manifolds over Real Field with 53 bits of precision
+
 sage: %time EuclideanSpace(5)
 CPU times: user 177 ms, sys: 10.4 ms, total: 187 ms
 Wall time: 196 ms
 5-dimensional Euclidean space E^5
-sage: %time EuclideanSpace(20)
-CPU times: user 2.16 s, sys: 56 ms, total: 2.21 s
-Wall time: 2.08 s
-20-dimensional Euclidean space E^20
-sage: %time EuclideanSpace(40)
-CPU times: user 8.06 s, sys: 188 ms, total: 8.25 s
-Wall time: 7.84 s
-40-dimensional Euclidean space E^40
 sage: %time EuclideanSpace(80)
 CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s
 Wall time: 31.5 s
 80-dimensional Euclidean space E^80
 ```
+
+
+
+
+
``````




---

archive/issue_events_268480.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-06T07:33:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "rename": {
        "from": "EuclideanSpace constructor is slow",
        "to": "Constructing Euclidean spaces, many variants"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268480"
}
```



---

archive/issue_comments_478553.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -91,6 +91,8 @@\n CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s\n Wall time: 31.5 s\n 80-dimensional Euclidean space E^80\n+sage: %time EuclideanSpace(80)\n+(timeout)\n ```\n \n \n``````\n",
    "created_at": "2020-07-06T07:51:37Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478553",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -91,6 +91,8 @@
 CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s
 Wall time: 31.5 s
 80-dimensional Euclidean space E^80
+sage: %time EuclideanSpace(80)
+(timeout)
 ```
 
 
``````




---

archive/issue_comments_478554.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -91,7 +91,7 @@\n CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s\n Wall time: 31.5 s\n 80-dimensional Euclidean space E^80\n-sage: %time EuclideanSpace(80)\n+sage: %time EuclideanSpace(1000)\n (timeout)\n ```\n \n``````\n",
    "created_at": "2020-07-06T13:15:49Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478554",
    "user": "https://github.com/egourgoulhon"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -91,7 +91,7 @@
 CPU times: user 32.8 s, sys: 758 ms, total: 33.6 s
 Wall time: 31.5 s
 80-dimensional Euclidean space E^80
-sage: %time EuclideanSpace(80)
+sage: %time EuclideanSpace(1000)
 (timeout)
 ```
 
``````




---

archive/issue_comments_478555.json:
```json
{
    "body": "<a id='comment:16'></a>\nReplying to [mkoeppe](#comment%3A13):\n\nRegarding the new ticket description, I would not say that the first three examples, namely `VectorSpace(QQ, 5)`, `CombinatorialFreeModule(QQ, range(5))` and `AffineSpace(RR, 5)` do construct an Euclidean space, because their ouputs are not endowed with a scalar product, are they?",
    "created_at": "2020-07-06T13:28:05Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478555",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:16'></a>
Replying to [mkoeppe](#comment%3A13):

Regarding the new ticket description, I would not say that the first three examples, namely `VectorSpace(QQ, 5)`, `CombinatorialFreeModule(QQ, range(5))` and `AffineSpace(RR, 5)` do construct an Euclidean space, because their ouputs are not endowed with a scalar product, are they?



---

archive/issue_comments_478556.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.\n+\n+Spaces without scalar product:\n \n ```\n sage: VectorSpace(QQ, 5).category()\n@@ -53,6 +55,8 @@\n ```\n \n \n+Spaces with scalar product:\n+\n ```\n sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()\n Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)\n``````\n",
    "created_at": "2020-07-06T18:27:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478556",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
 The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.
+
+Spaces without scalar product:
 
 ```
 sage: VectorSpace(QQ, 5).category()
@@ -53,6 +55,8 @@
 ```
 
 
+Spaces with scalar product:
+
 ```
 sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()
 Category of finite dimensional vector spaces with basis over (number fields and quotient fields and metric spaces)
``````




---

archive/issue_comments_478557.json:
```json
{
    "body": "<a id='comment:17'></a>\nOf course, I agree. The summary already showed the categories of the spaces, but I've added two headers to emphasize this point.",
    "created_at": "2020-07-06T18:27:43Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478557",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:17'></a>
Of course, I agree. The summary already showed the categories of the spaces, but I've added two headers to emphasize this point.



---

archive/issue_comments_478558.json:
```json
{
    "body": "<a id='comment:18'></a>\nReplying to [egourgoulhon](#comment%3A11):\n> Replying to [mkoeppe](#comment%3A9):\n> > Does sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?\n\n> No, manifolds with boundary are not implemented yet; it would be nice to have them. \n\nI have created #30080 for this",
    "created_at": "2020-07-06T18:30:26Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478558",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:18'></a>
Replying to [egourgoulhon](#comment%3A11):
> Replying to [mkoeppe](#comment%3A9):
> > Does sage-manifolds currently implement manifolds with boundary, or is it planned to implement them?

> No, manifolds with boundary are not implemented yet; it would be nice to have them. 

I have created #30080 for this



---

archive/issue_comments_478559.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -100,6 +100,26 @@\n ```\n \n \n+Scalar product without a space:\n+\n+```\n+sage: %time DiagonalQuadraticForm(QQ, [1]*5)\n+CPU times: user 60 \u00b5s, sys: 1e+03 ns, total: 61 \u00b5s\n+Wall time: 62.9 \u00b5s\n+Quadratic form in 5 variables over Rational Field with coefficients: \n+[ 1 0 0 0 0 ]\n+[ * 1 0 0 0 ]\n+[ * * 1 0 0 ]\n+[ * * * 1 0 ]\n+[ * * * * 1 ]\n+sage: %time DiagonalQuadraticForm(QQ, [1]*80)\n+CPU times: user 1.35 ms, sys: 31 \u00b5s, total: 1.39 ms\n+Wall time: 1.44 ms\n+Quadratic form in 80 variables over Rational Field with coefficients: \n+sage: %time DiagonalQuadraticForm(QQ, [1]*1000)\n+CPU times: user 144 ms, sys: 2.85 ms, total: 147 ms\n+Wall time: 147 ms\n+Quadratic form in 1000 variables over Rational Field with coefficients: \n+```\n \n \n-\n``````\n",
    "created_at": "2020-07-06T18:33:32Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478559",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -100,6 +100,26 @@
 ```
 
 
+Scalar product without a space:
+
+```
+sage: %time DiagonalQuadraticForm(QQ, [1]*5)
+CPU times: user 60 µs, sys: 1e+03 ns, total: 61 µs
+Wall time: 62.9 µs
+Quadratic form in 5 variables over Rational Field with coefficients: 
+[ 1 0 0 0 0 ]
+[ * 1 0 0 0 ]
+[ * * 1 0 0 ]
+[ * * * 1 0 ]
+[ * * * * 1 ]
+sage: %time DiagonalQuadraticForm(QQ, [1]*80)
+CPU times: user 1.35 ms, sys: 31 µs, total: 1.39 ms
+Wall time: 1.44 ms
+Quadratic form in 80 variables over Rational Field with coefficients: 
+sage: %time DiagonalQuadraticForm(QQ, [1]*1000)
+CPU times: user 144 ms, sys: 2.85 ms, total: 147 ms
+Wall time: 147 ms
+Quadratic form in 1000 variables over Rational Field with coefficients: 
+```
 
 
-
``````




---

archive/issue_comments_478560.json:
```json
{
    "body": "**Dependencies:** #30065, #30074",
    "created_at": "2020-07-07T01:53:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478560",
    "user": "https://github.com/mkoeppe"
}
```

**Dependencies:** #30065, #30074



---

archive/issue_comments_478561.json:
```json
{
    "body": "<a id='comment:21'></a>\nFor further speedups of `EuclideanSpace(1000)`, it seems one would need to work on\n`sage.tensor.modules.free_module_basis.FreeModuleCoBasis.__init__` and `FreeModuleBasis.__init__`. They dominate the computation now, using non-sparse operations, calling `sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.set_comp` 1000<sup>2</sup> times. Does it make sense to make this sparse in some way? Would major speedups be expected from cythonizing this module?",
    "created_at": "2020-07-07T02:45:53Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478561",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
For further speedups of `EuclideanSpace(1000)`, it seems one would need to work on
`sage.tensor.modules.free_module_basis.FreeModuleCoBasis.__init__` and `FreeModuleBasis.__init__`. They dominate the computation now, using non-sparse operations, calling `sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.set_comp` 1000<sup>2</sup> times. Does it make sense to make this sparse in some way? Would major speedups be expected from cythonizing this module?



---

archive/issue_comments_478562.json:
```json
{
    "body": "<a id='comment:22'></a>\nReplying to [mkoeppe](#comment%3A21):\n> For further speedups of `EuclideanSpace(1000)`, it seems one would need to work on\n> `sage.tensor.modules.free_module_basis.FreeModuleCoBasis.__init__` and `FreeModuleBasis.__init__`. They dominate the computation now, using non-sparse operations, calling `sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.set_comp` 1000<sup>2</sup> times. Does it make sense to make this sparse in some way? \n\nYes, actually in the current framework, any uninitialized component of a vector/tensor is considered to be zero. So in `FreeModuleBasis.__init__`, we could skip the loop initializing the components of the basis vector to zero:\n\n```diff\n        for i in fmodule.irange():\n            v = fmodule.element_class(fmodule)\n-           for j in fmodule.irange():\n-               v.set_comp(self)[j] = fmodule._ring.zero()\n            v.set_comp(self)[i] = fmodule._ring.one()\n            vl.append(v)\n```\nThis would make the number of calls to `TensorFieldParal.set_comp` to be 1000, instead in of 1000<sup>2</sup> !\nSimilarly in `FreeModuleCoBasis.__init_`:\n\n```diff\n        for i in self._fmodule.irange():\n            v = self._fmodule.linear_form()\n-           for j in self._fmodule.irange():\n-               v.set_comp(basis)[j] = 0\n-           v.set_comp(basis)[i] = 1\n+           v.set_comp(basis)[i] = self._fmodule._ring.one()\n            vl.append(v)\n```\nThe above unnecessary initializations to zero have been implemented at the early stage of the manifolds project, when we were not certain to keep the storage convention of having uninitialized components to be zero. Given the heavy use of that convention now, it's pretty safe to remove these lines.",
    "created_at": "2020-07-07T09:12:02Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478562",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:22'></a>
Replying to [mkoeppe](#comment%3A21):
> For further speedups of `EuclideanSpace(1000)`, it seems one would need to work on
> `sage.tensor.modules.free_module_basis.FreeModuleCoBasis.__init__` and `FreeModuleBasis.__init__`. They dominate the computation now, using non-sparse operations, calling `sage.manifolds.differentiable.tensorfield_paral.TensorFieldParal.set_comp` 1000<sup>2</sup> times. Does it make sense to make this sparse in some way? 

Yes, actually in the current framework, any uninitialized component of a vector/tensor is considered to be zero. So in `FreeModuleBasis.__init__`, we could skip the loop initializing the components of the basis vector to zero:

```diff
        for i in fmodule.irange():
            v = fmodule.element_class(fmodule)
-           for j in fmodule.irange():
-               v.set_comp(self)[j] = fmodule._ring.zero()
            v.set_comp(self)[i] = fmodule._ring.one()
            vl.append(v)
```
This would make the number of calls to `TensorFieldParal.set_comp` to be 1000, instead in of 1000<sup>2</sup> !
Similarly in `FreeModuleCoBasis.__init_`:

```diff
        for i in self._fmodule.irange():
            v = self._fmodule.linear_form()
-           for j in self._fmodule.irange():
-               v.set_comp(basis)[j] = 0
-           v.set_comp(basis)[i] = 1
+           v.set_comp(basis)[i] = self._fmodule._ring.one()
            vl.append(v)
```
The above unnecessary initializations to zero have been implemented at the early stage of the manifolds project, when we were not certain to keep the storage convention of having uninitialized components to be zero. Given the heavy use of that convention now, it's pretty safe to remove these lines.



---

archive/issue_comments_478563.json:
```json
{
    "body": "**Branch:** [public/manifolds/init_module_basis-30061](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/init_module_basis-30061)",
    "created_at": "2020-07-07T16:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478563",
    "user": "https://github.com/egourgoulhon"
}
```

**Branch:** [public/manifolds/init_module_basis-30061](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/init_module_basis-30061)



---

archive/issue_comments_478564.json:
```json
{
    "body": "<a id='comment:23'></a>\nThe changes suggested in [comment:22](#comment%3A22) are implemented in the above branch.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0\">fccbf43</a></td><td><code>Improve initialization of elements of a free module basis</code></td></tr></table>\n",
    "created_at": "2020-07-07T16:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478564",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:23'></a>
The changes suggested in [comment:22](#comment%3A22) are implemented in the above branch.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0">fccbf43</a></td><td><code>Improve initialization of elements of a free module basis</code></td></tr></table>




---

archive/issue_comments_478565.json:
```json
{
    "body": "**Commit:** [fccbf438290e2404a79a4c7a650721120157a6c0](https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0)",
    "created_at": "2020-07-07T16:34:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478565",
    "user": "https://github.com/egourgoulhon"
}
```

**Commit:** [fccbf438290e2404a79a4c7a650721120157a6c0](https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0)



---

archive/issue_comments_478566.json:
```json
{
    "body": "**Changing commit** from \"[fccbf438290e2404a79a4c7a650721120157a6c0](https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0)\" to \"[3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)\".",
    "created_at": "2020-07-07T16:44:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478566",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[fccbf438290e2404a79a4c7a650721120157a6c0](https://github.com/sagemath/sagetrac-mirror/commit/fccbf438290e2404a79a4c7a650721120157a6c0)" to "[3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)".



---

archive/issue_comments_478567.json:
```json
{
    "body": "<a id='comment:24'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/134da3942bf306fb2d484046f324c3fb067d9f20\">134da39</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration.assume: Validate against cached valid features first</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fbfb687592e651e805a6d265045a3f29d34e7db\">1fbfb68</a></td><td><code>Update instead of overwriting</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a99aa3fa5c3b5c0f168fecb8193cdea223d94780\">a99aa3f</a></td><td><code>Merge branch 't/30065/faster_maxima_assumptions' into t/30061/public/manifolds/init_module_basis-30061</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8b31261d0be43e63bccc72a59cae67510ecf6a24\">8b31261</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration: Make it a UniqueRepresentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51ea23d9a4d75d66ddef7b1670d14e5324909183\">51ea23d</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration.assume: Check first if already in _assumptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9119e82f95e36847383ca29a9d5a96376c35fde0\">9119e82</a></td><td><code>sage.symbolic.assumptions._assumptions: Change from list to OrderDict</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/cda81ff3e8a54f4ec09fecd04a0673866736940a\">cda81ff</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration: Make it hashable by inheriting comparisons from UniqueRepresentation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/642836dc080f10de1da5a502ccb8bad19113c46b\">642836d</a></td><td><code>sage.symbolic.assumptions: Use dict instead of OrderedDict for _assumptions</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7\">3ce0c15</a></td><td><code>Merge branch 't/30074/even_faster_maxima_assumptions' into t/30061/public/manifolds/init_module_basis-30061</code></td></tr></table>\n",
    "created_at": "2020-07-07T16:44:24Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478567",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/134da3942bf306fb2d484046f324c3fb067d9f20">134da39</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration.assume: Validate against cached valid features first</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fbfb687592e651e805a6d265045a3f29d34e7db">1fbfb68</a></td><td><code>Update instead of overwriting</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a99aa3fa5c3b5c0f168fecb8193cdea223d94780">a99aa3f</a></td><td><code>Merge branch 't/30065/faster_maxima_assumptions' into t/30061/public/manifolds/init_module_basis-30061</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8b31261d0be43e63bccc72a59cae67510ecf6a24">8b31261</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration: Make it a UniqueRepresentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51ea23d9a4d75d66ddef7b1670d14e5324909183">51ea23d</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration.assume: Check first if already in _assumptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9119e82f95e36847383ca29a9d5a96376c35fde0">9119e82</a></td><td><code>sage.symbolic.assumptions._assumptions: Change from list to OrderDict</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/cda81ff3e8a54f4ec09fecd04a0673866736940a">cda81ff</a></td><td><code>sage.symbolic.assumptions.GenericDeclaration: Make it hashable by inheriting comparisons from UniqueRepresentation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/642836dc080f10de1da5a502ccb8bad19113c46b">642836d</a></td><td><code>sage.symbolic.assumptions: Use dict instead of OrderedDict for _assumptions</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7">3ce0c15</a></td><td><code>Merge branch 't/30074/even_faster_maxima_assumptions' into t/30061/public/manifolds/init_module_basis-30061</code></td></tr></table>




---

archive/issue_comments_478568.json:
```json
{
    "body": "<a id='comment:25'></a>\nMerged in the tickets listed as dependencies",
    "created_at": "2020-07-07T16:44:46Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478568",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>
Merged in the tickets listed as dependencies



---

archive/issue_comments_478569.json:
```json
{
    "body": "<a id='comment:26'></a>\nReplying to [egourgoulhon](#comment%3A23):\n> The changes suggested in [comment:22](#comment%3A22) are implemented in the above branch.\n\n\nGreat! Together with the merged tickets, this now gives:\n\n```\nsage: %time EuclideanSpace(5)\nCPU times: user 4.87 ms, sys: 372 \u00b5s, total: 5.24 ms\nWall time: 4.93 ms\n5-dimensional Euclidean space E^5\nsage: %time EuclideanSpace(80)\nCPU times: user 106 ms, sys: 4.52 ms, total: 110 ms\nWall time: 92 ms\n80-dimensional Euclidean space E^80\nsage: %time EuclideanSpace(1000)\nCPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s\nWall time: 986 ms\n```",
    "created_at": "2020-07-07T16:45:53Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478569",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:26'></a>
Replying to [egourgoulhon](#comment%3A23):
> The changes suggested in [comment:22](#comment%3A22) are implemented in the above branch.


Great! Together with the merged tickets, this now gives:

```
sage: %time EuclideanSpace(5)
CPU times: user 4.87 ms, sys: 372 µs, total: 5.24 ms
Wall time: 4.93 ms
5-dimensional Euclidean space E^5
sage: %time EuclideanSpace(80)
CPU times: user 106 ms, sys: 4.52 ms, total: 110 ms
Wall time: 92 ms
80-dimensional Euclidean space E^80
sage: %time EuclideanSpace(1000)
CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s
Wall time: 986 ms
```



---

archive/issue_comments_478570.json:
```json
{
    "body": "<a id='comment:27'></a>\nAnd some caching is happening too. The second time:\n\n```\nsage: %time EuclideanSpace(1000)\nCPU times: user 207 ms, sys: 5.63 ms, total: 213 ms\nWall time: 212 ms\n1000-dimensional Euclidean space E^1000\n```",
    "created_at": "2020-07-07T16:47:10Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478570",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
And some caching is happening too. The second time:

```
sage: %time EuclideanSpace(1000)
CPU times: user 207 ms, sys: 5.63 ms, total: 213 ms
Wall time: 212 ms
1000-dimensional Euclidean space E^1000
```



---

archive/issue_comments_478571.json:
```json
{
    "body": "<a id='comment:28'></a>\nThat's faster than `VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))`",
    "created_at": "2020-07-07T16:48:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478571",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:28'></a>
That's faster than `VectorSpace(QQ, 1000, inner_product_matrix=matrix.identity(1000))`



---

archive/issue_comments_478572.json:
```json
{
    "body": "<a id='comment:29'></a>\nMost of the caching is coming from #30074. Making the real-declared symbolic variables known to Maxima is costly the first time; after that, it's free.",
    "created_at": "2020-07-07T16:54:15Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478572",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:29'></a>
Most of the caching is coming from #30074. Making the real-declared symbolic variables known to Maxima is costly the first time; after that, it's free.



---

archive/issue_comments_478573.json:
```json
{
    "body": "<a id='comment:30'></a>\nFirst time:\n\n```\nsage: %prun EuclideanSpace(10000)\n         4614917 function calls (4585885 primitive calls) in 42.685 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n    80096   35.217    0.000   35.779    0.000 maxima_lib.py:412(_eval_line)\n       25    0.529    0.021    0.529    0.021 {built-in method sage.libs.ecl.ecl_eval}\n    10000    0.425    0.000   39.373    0.004 {method 'var' of 'sage.symbolic.ring.SymbolicRing' objects}\n    20000    0.377    0.000   38.550    0.002 assumptions.py:213(assume)\n    20048    0.323    0.000    0.382    0.000 maxima_lib.py:274(max_to_string)\n    20006    0.275    0.000    0.288    0.000 free_module_tensor.py:258(__init__)\n    20000    0.208    0.000    0.460    0.000 assumptions.py:396(preprocess_assumptions)\n       56    0.207    0.004    0.207    0.004 {built-in method _imp.create_dynamic}\n    50000    0.190    0.000    0.190    0.000 latex.py:463(__add__)\n   209119    0.165    0.000    0.165    0.000 {built-in method builtins.hasattr}\n    20007    0.164    0.000    0.180    0.000 tensorfield_paral.py:689(_init_derived)\n  10032/1    0.139    0.000   42.050   42.050 {sage.misc.classcall_metaclass.typecall}\n    10139    0.129    0.000    0.130    0.000 {built-in method builtins.repr}\n    20001    0.125    0.000    0.143    0.000 interface.py:620(__getattr__)\n      714    0.119    0.000    0.119    0.000 {built-in method marshal.loads}\n   546190    0.114    0.000    0.114    0.000 {built-in method builtins.isinstance}\n        1    0.102    0.102   39.733   39.733 chart.py:1610(_init_coordinates)\n    10003    0.091    0.000    0.107    0.000 chart_func.py:318(__init__)\n    10000    0.091    0.000    0.460    0.000 {method '_maxima_init_' of 'sage.structure.sage_object.SageObject' objects}\n    40024    0.090    0.000    0.099    0.000 interface.py:491(_next_var_name)\n    20000    0.087    0.000   13.550    0.001 interface.py:587(function_call)\n    40024    0.086    0.000   15.460    0.000 maxima_lib.py:492(set)\n    30024    0.086    0.000   13.245    0.000 interface.py:251(__call__)\n    30024    0.082    0.000   13.139    0.000 interface.py:706(__init__)\n    30000    0.080    0.000    0.237    0.000 scalarfield.py:1154(is_trivial_zero)\n    20000    0.079    0.000    3.032    0.000 interface.py:534(_convert_args_kwds)\n    20024    0.078    0.000   16.639    0.001 interface.py:981(__del__)\n    20000    0.077    0.000    0.416    0.000 free_module_tensor.py:1191(_set_comp_unsafe)\n   160195    0.074    0.000    0.074    0.000 {method 'find' of 'str' objects}\n    30000    0.069    0.000    0.126    0.000 chart_func.py:810(is_trivial_zero)\n    10000    0.065    0.000    0.118    0.000 diff_form.py:1241(_del_derived)\n    10001    0.061    0.000    0.069    0.000 interface.py:419(_relation_symbols)\n    20048    0.059    0.000    0.059    0.000 {method 'python' of 'sage.libs.ecl.EclObject' objects}\n    90434    0.057    0.000    0.057    0.000 {method 'split' of 'str' objects}\n    20006    0.051    0.000    0.053    0.000 tensorfield.py:684(_del_restrictions)\n    30024    0.051    0.000   13.056    0.000 maxima_lib.py:561(_create)\n    56/50    0.049    0.001    0.054    0.001 {built-in method _imp.exec_dynamic}\n    20000    0.045    0.000    0.045    0.000 infinity.py:1020(gen)\n    30010    0.044    0.000    0.051    0.000 tensorfield.py:667(_del_derived)\n    20000    0.044    0.000   21.876    0.001 interface.py:653(__call__)\n    20001    0.044    0.000    0.070    0.000 vectorfield_module.py:1765(dual_exterior_power)\n    20000    0.042    0.000    0.251    0.000 comp.py:864(__setitem__)\n    30000    0.042    0.000    0.050    0.000 comp.py:616(_check_indices)\n    20000    0.041    0.000    0.043    0.000 interface.py:603(_function_call_string)\n    10001    0.040    0.000    0.332    0.000 vectorfield.py:1533(__init__)\n    10000    0.040    0.000    0.224    0.000 expression_conversions.py:155(__call__)\n    20024    0.039    0.000   16.518    0.001 maxima_lib.py:516(clear)\n```",
    "created_at": "2020-07-07T16:56:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478573",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:30'></a>
First time:

```
sage: %prun EuclideanSpace(10000)
         4614917 function calls (4585885 primitive calls) in 42.685 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    80096   35.217    0.000   35.779    0.000 maxima_lib.py:412(_eval_line)
       25    0.529    0.021    0.529    0.021 {built-in method sage.libs.ecl.ecl_eval}
    10000    0.425    0.000   39.373    0.004 {method 'var' of 'sage.symbolic.ring.SymbolicRing' objects}
    20000    0.377    0.000   38.550    0.002 assumptions.py:213(assume)
    20048    0.323    0.000    0.382    0.000 maxima_lib.py:274(max_to_string)
    20006    0.275    0.000    0.288    0.000 free_module_tensor.py:258(__init__)
    20000    0.208    0.000    0.460    0.000 assumptions.py:396(preprocess_assumptions)
       56    0.207    0.004    0.207    0.004 {built-in method _imp.create_dynamic}
    50000    0.190    0.000    0.190    0.000 latex.py:463(__add__)
   209119    0.165    0.000    0.165    0.000 {built-in method builtins.hasattr}
    20007    0.164    0.000    0.180    0.000 tensorfield_paral.py:689(_init_derived)
  10032/1    0.139    0.000   42.050   42.050 {sage.misc.classcall_metaclass.typecall}
    10139    0.129    0.000    0.130    0.000 {built-in method builtins.repr}
    20001    0.125    0.000    0.143    0.000 interface.py:620(__getattr__)
      714    0.119    0.000    0.119    0.000 {built-in method marshal.loads}
   546190    0.114    0.000    0.114    0.000 {built-in method builtins.isinstance}
        1    0.102    0.102   39.733   39.733 chart.py:1610(_init_coordinates)
    10003    0.091    0.000    0.107    0.000 chart_func.py:318(__init__)
    10000    0.091    0.000    0.460    0.000 {method '_maxima_init_' of 'sage.structure.sage_object.SageObject' objects}
    40024    0.090    0.000    0.099    0.000 interface.py:491(_next_var_name)
    20000    0.087    0.000   13.550    0.001 interface.py:587(function_call)
    40024    0.086    0.000   15.460    0.000 maxima_lib.py:492(set)
    30024    0.086    0.000   13.245    0.000 interface.py:251(__call__)
    30024    0.082    0.000   13.139    0.000 interface.py:706(__init__)
    30000    0.080    0.000    0.237    0.000 scalarfield.py:1154(is_trivial_zero)
    20000    0.079    0.000    3.032    0.000 interface.py:534(_convert_args_kwds)
    20024    0.078    0.000   16.639    0.001 interface.py:981(__del__)
    20000    0.077    0.000    0.416    0.000 free_module_tensor.py:1191(_set_comp_unsafe)
   160195    0.074    0.000    0.074    0.000 {method 'find' of 'str' objects}
    30000    0.069    0.000    0.126    0.000 chart_func.py:810(is_trivial_zero)
    10000    0.065    0.000    0.118    0.000 diff_form.py:1241(_del_derived)
    10001    0.061    0.000    0.069    0.000 interface.py:419(_relation_symbols)
    20048    0.059    0.000    0.059    0.000 {method 'python' of 'sage.libs.ecl.EclObject' objects}
    90434    0.057    0.000    0.057    0.000 {method 'split' of 'str' objects}
    20006    0.051    0.000    0.053    0.000 tensorfield.py:684(_del_restrictions)
    30024    0.051    0.000   13.056    0.000 maxima_lib.py:561(_create)
    56/50    0.049    0.001    0.054    0.001 {built-in method _imp.exec_dynamic}
    20000    0.045    0.000    0.045    0.000 infinity.py:1020(gen)
    30010    0.044    0.000    0.051    0.000 tensorfield.py:667(_del_derived)
    20000    0.044    0.000   21.876    0.001 interface.py:653(__call__)
    20001    0.044    0.000    0.070    0.000 vectorfield_module.py:1765(dual_exterior_power)
    20000    0.042    0.000    0.251    0.000 comp.py:864(__setitem__)
    30000    0.042    0.000    0.050    0.000 comp.py:616(_check_indices)
    20000    0.041    0.000    0.043    0.000 interface.py:603(_function_call_string)
    10001    0.040    0.000    0.332    0.000 vectorfield.py:1533(__init__)
    10000    0.040    0.000    0.224    0.000 expression_conversions.py:155(__call__)
    20024    0.039    0.000   16.518    0.001 maxima_lib.py:516(clear)
```



---

archive/issue_comments_478574.json:
```json
{
    "body": "<a id='comment:31'></a>\nSecond time:\n\n```\n         2221257 function calls (2221199 primitive calls) in 2.982 seconds\n\n   Ordered by: internal time\n\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\n    50000    0.297    0.000    0.297    0.000 latex.py:463(__add__)\n    30010    0.243    0.000    0.251    0.000 tensorfield.py:667(_del_derived)\n    20006    0.214    0.000    0.226    0.000 free_module_tensor.py:258(__init__)\n    10000    0.178    0.000    0.266    0.000 {method 'var' of 'sage.symbolic.ring.SymbolicRing' objects}\n    10003    0.091    0.000    0.107    0.000 chart_func.py:318(__init__)\n    30000    0.086    0.000    0.254    0.000 scalarfield.py:1154(is_trivial_zero)\n    20000    0.085    0.000    0.656    0.000 free_module_tensor.py:1191(_set_comp_unsafe)\n    10000    0.077    0.000    0.136    0.000 diff_form.py:1241(_del_derived)\n   130046    0.075    0.000    0.075    0.000 {built-in method builtins.hasattr}\n    30000    0.074    0.000    0.134    0.000 chart_func.py:810(is_trivial_zero)\n    20007    0.073    0.000    0.090    0.000 tensorfield_paral.py:689(_init_derived)\n    20000    0.068    0.000    0.085    0.000 assumptions.py:396(preprocess_assumptions)\n    20006    0.055    0.000    0.057    0.000 tensorfield.py:684(_del_restrictions)\n    20001    0.049    0.000    0.076    0.000 vectorfield_module.py:1765(dual_exterior_power)\n   270213    0.048    0.000    0.048    0.000 {built-in method builtins.isinstance}\n    30000    0.045    0.000    0.054    0.000 comp.py:616(_check_indices)\n        1    0.044    0.044    0.412    0.412 chart.py:1610(_init_coordinates)\n    20000    0.044    0.000    0.271    0.000 comp.py:864(__setitem__)\n    10001    0.042    0.000    0.276    0.000 vectorfield.py:1533(__init__)\n    30001    0.040    0.000    0.040    0.000 chart_func.py:460(expr)\n    20000    0.034    0.000    0.714    0.000 free_module_tensor.py:1263(set_comp)\n    10001    0.034    0.000    0.243    0.000 diff_form.py:1137(__init__)\n    20000    0.033    0.000    0.746    0.000 tensorfield_paral.py:820(set_comp)\n    30000    0.033    0.000    0.033    0.000 {method '_latex_' of 'sage.symbolic.expression.Expression' objects}\n    10001    0.033    0.000    0.059    0.000 free_module_alt_form.py:298(_new_comp)\n    30000    0.033    0.000    0.033    0.000 free_module_tensor.py:923(set_name)\n    10001    0.028    0.000    0.054    0.000 free_module_element.py:230(_new_comp)\n    10000    0.027    0.000    0.065    0.000 comp.py:3061(_ordered_indices)\n    20000    0.026    0.000    0.026    0.000 free_module_tensor.py:1474(del_other_comp)\n    10001    0.026    0.000    0.026    0.000 chart.py:311(<genexpr>)\n    10000    0.025    0.000    0.178    0.000 comp.py:4784(__setitem__)\n   120055    0.025    0.000    0.042    0.000 {built-in method builtins.len}\n    10001    0.024    0.000    0.024    0.000 euclidean.py:858(<genexpr>)\n    30010    0.024    0.000    0.024    0.000 tensorfield.py:654(_init_derived)\n    10001    0.023    0.000    0.023    0.000 vectorframe.py:1764(<genexpr>)\n    10001    0.023    0.000    0.038    0.000 vectorfield_module.py:1709(exterior_power)\n        3    0.022    0.007    0.339    0.113 free_module_basis.py:208(set_name)\n    20005    0.022    0.000    0.052    0.000 comp.py:496(__init__)\n        1    0.022    0.022    1.688    1.688 free_module_basis.py:566(__init__)\n    20006    0.022    0.000    0.318    0.000 tensorfield_paral.py:708(_del_derived)\n```",
    "created_at": "2020-07-07T16:56:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478574",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:31'></a>
Second time:

```
         2221257 function calls (2221199 primitive calls) in 2.982 seconds

   Ordered by: internal time

   ncalls  tottime  percall  cumtime  percall filename:lineno(function)
    50000    0.297    0.000    0.297    0.000 latex.py:463(__add__)
    30010    0.243    0.000    0.251    0.000 tensorfield.py:667(_del_derived)
    20006    0.214    0.000    0.226    0.000 free_module_tensor.py:258(__init__)
    10000    0.178    0.000    0.266    0.000 {method 'var' of 'sage.symbolic.ring.SymbolicRing' objects}
    10003    0.091    0.000    0.107    0.000 chart_func.py:318(__init__)
    30000    0.086    0.000    0.254    0.000 scalarfield.py:1154(is_trivial_zero)
    20000    0.085    0.000    0.656    0.000 free_module_tensor.py:1191(_set_comp_unsafe)
    10000    0.077    0.000    0.136    0.000 diff_form.py:1241(_del_derived)
   130046    0.075    0.000    0.075    0.000 {built-in method builtins.hasattr}
    30000    0.074    0.000    0.134    0.000 chart_func.py:810(is_trivial_zero)
    20007    0.073    0.000    0.090    0.000 tensorfield_paral.py:689(_init_derived)
    20000    0.068    0.000    0.085    0.000 assumptions.py:396(preprocess_assumptions)
    20006    0.055    0.000    0.057    0.000 tensorfield.py:684(_del_restrictions)
    20001    0.049    0.000    0.076    0.000 vectorfield_module.py:1765(dual_exterior_power)
   270213    0.048    0.000    0.048    0.000 {built-in method builtins.isinstance}
    30000    0.045    0.000    0.054    0.000 comp.py:616(_check_indices)
        1    0.044    0.044    0.412    0.412 chart.py:1610(_init_coordinates)
    20000    0.044    0.000    0.271    0.000 comp.py:864(__setitem__)
    10001    0.042    0.000    0.276    0.000 vectorfield.py:1533(__init__)
    30001    0.040    0.000    0.040    0.000 chart_func.py:460(expr)
    20000    0.034    0.000    0.714    0.000 free_module_tensor.py:1263(set_comp)
    10001    0.034    0.000    0.243    0.000 diff_form.py:1137(__init__)
    20000    0.033    0.000    0.746    0.000 tensorfield_paral.py:820(set_comp)
    30000    0.033    0.000    0.033    0.000 {method '_latex_' of 'sage.symbolic.expression.Expression' objects}
    10001    0.033    0.000    0.059    0.000 free_module_alt_form.py:298(_new_comp)
    30000    0.033    0.000    0.033    0.000 free_module_tensor.py:923(set_name)
    10001    0.028    0.000    0.054    0.000 free_module_element.py:230(_new_comp)
    10000    0.027    0.000    0.065    0.000 comp.py:3061(_ordered_indices)
    20000    0.026    0.000    0.026    0.000 free_module_tensor.py:1474(del_other_comp)
    10001    0.026    0.000    0.026    0.000 chart.py:311(<genexpr>)
    10000    0.025    0.000    0.178    0.000 comp.py:4784(__setitem__)
   120055    0.025    0.000    0.042    0.000 {built-in method builtins.len}
    10001    0.024    0.000    0.024    0.000 euclidean.py:858(<genexpr>)
    30010    0.024    0.000    0.024    0.000 tensorfield.py:654(_init_derived)
    10001    0.023    0.000    0.023    0.000 vectorframe.py:1764(<genexpr>)
    10001    0.023    0.000    0.038    0.000 vectorfield_module.py:1709(exterior_power)
        3    0.022    0.007    0.339    0.113 free_module_basis.py:208(set_name)
    20005    0.022    0.000    0.052    0.000 comp.py:496(__init__)
        1    0.022    0.022    1.688    1.688 free_module_basis.py:566(__init__)
    20006    0.022    0.000    0.318    0.000 tensorfield_paral.py:708(_del_derived)
```



---

archive/issue_comments_478575.json:
```json
{
    "body": "<a id='comment:33'></a>\nFirst time profile, filtered to methods in `maxima_lib` and `sage.libs.ecl`:\n\n```\nsage: %prun EuclideanSpace(5000)\n    40096    7.970    0.000    8.203    0.000 maxima_lib.py:412(_eval_line)\n       25    0.511    0.020    0.511    0.020 {built-in method sage.libs.ecl.ecl_eval}\n    10048    0.133    0.000    0.158    0.000 maxima_lib.py:274(max_to_string)\n    20024    0.037    0.000    3.505    0.000 maxima_lib.py:492(set)\n    15024    0.021    0.000    2.934    0.000 maxima_lib.py:561(_create)\n    10024    0.017    0.000    3.597    0.000 maxima_lib.py:516(clear)\n    40096    0.015    0.000    0.017    0.000 maxima_lib.py:463(<listcomp>)\n     5023    0.007    0.000    0.275    0.000 maxima_lib.py:541(get)\n```",
    "created_at": "2020-07-07T17:19:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478575",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:33'></a>
First time profile, filtered to methods in `maxima_lib` and `sage.libs.ecl`:

```
sage: %prun EuclideanSpace(5000)
    40096    7.970    0.000    8.203    0.000 maxima_lib.py:412(_eval_line)
       25    0.511    0.020    0.511    0.020 {built-in method sage.libs.ecl.ecl_eval}
    10048    0.133    0.000    0.158    0.000 maxima_lib.py:274(max_to_string)
    20024    0.037    0.000    3.505    0.000 maxima_lib.py:492(set)
    15024    0.021    0.000    2.934    0.000 maxima_lib.py:561(_create)
    10024    0.017    0.000    3.597    0.000 maxima_lib.py:516(clear)
    40096    0.015    0.000    0.017    0.000 maxima_lib.py:463(<listcomp>)
     5023    0.007    0.000    0.275    0.000 maxima_lib.py:541(get)
```



---

archive/issue_comments_478576.json:
```json
{
    "body": "<a id='comment:34'></a>\nThe time spent on `maxima_lib` can probably still be reduced a little by using ECL objects directly for \"context\", but I will not work on this at the moment.",
    "created_at": "2020-07-07T18:10:53Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478576",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:34'></a>
The time spent on `maxima_lib` can probably still be reduced a little by using ECL objects directly for "context", but I will not work on this at the moment.



---

archive/issue_comments_478577.json:
```json
{
    "body": "<a id='comment:35'></a>\nReplying to [mkoeppe](#comment%3A34):\n> The time spent on `maxima_lib` can probably still be reduced a little by using ECL objects directly for \"context\", but I will not work on this at the moment.\n\nThis is #30086 (just for saving the thought and some preliminary work on it).",
    "created_at": "2020-07-07T18:29:22Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478577",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>
Replying to [mkoeppe](#comment%3A34):
> The time spent on `maxima_lib` can probably still be reduced a little by using ECL objects directly for "context", but I will not work on this at the moment.

This is #30086 (just for saving the thought and some preliminary work on it).



---

archive/issue_comments_478578.json:
```json
{
    "body": "**Author:** Eric Gourgoulhon",
    "created_at": "2020-07-07T18:30:12Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478578",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Eric Gourgoulhon



---

archive/issue_comments_478579.json:
```json
{
    "body": "<a id='comment:37'></a>\nNext I think we can benchmark some other basic operations in the spaces",
    "created_at": "2020-07-07T18:51:15Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478579",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
Next I think we can benchmark some other basic operations in the spaces



---

archive/issue_comments_478580.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -17,6 +17,23 @@\n CPU times: user 208 \u00b5s, sys: 1 \u00b5s, total: 209 \u00b5s\n Wall time: 213 \u00b5s\n Vector space of dimension 1000 over Rational Field\n+\n+sage: for n in 5, 80, 1000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {})\".format(n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\n+n = 5\n+Construction:  625 loops, best of 3: 1.88 \u03bcs per loop\n+Distance:      625 loops, best of 3: 75.6 \u03bcs per loop\n+n = 80\n+Construction:  625 loops, best of 3: 1.27 \u03bcs per loop\n+Distance:      625 loops, best of 3: 280 \u03bcs per loop\n+n = 1000\n+Construction:  625 loops, best of 3: 1.26 \u03bcs per loop\n+Distance:      125 loops, best of 3: 2.82 ms per loop\n+n = 10000\n+Construction:  625 loops, best of 3: 1.29 \u03bcs per loop\n+Distance:      25 loops, best of 3: 27.9 ms per loop\n+n = 100000\n+Construction:  625 loops, best of 3: 1.25 \u03bcs per loop\n+Distance:      5 loops, best of 3: 290 ms per loop\n ```\n \n ```\n@@ -80,6 +97,9 @@\n Wall time: 1.48 s\n Ambient quadratic space of dimension 1000 over Rational Field\n Inner product matrix: ...\n+\n+sage: for n in 5, 80, 1000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))\".format(n, n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\n+\n ```\n \n \n``````\n",
    "created_at": "2020-07-07T22:49:30Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478580",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -17,6 +17,23 @@
 CPU times: user 208 µs, sys: 1 µs, total: 209 µs
 Wall time: 213 µs
 Vector space of dimension 1000 over Rational Field
+
+sage: for n in 5, 80, 1000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {})".format(n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print("Distance:     ", timeit("norm(V(u) - V(v))"))
+n = 5
+Construction:  625 loops, best of 3: 1.88 μs per loop
+Distance:      625 loops, best of 3: 75.6 μs per loop
+n = 80
+Construction:  625 loops, best of 3: 1.27 μs per loop
+Distance:      625 loops, best of 3: 280 μs per loop
+n = 1000
+Construction:  625 loops, best of 3: 1.26 μs per loop
+Distance:      125 loops, best of 3: 2.82 ms per loop
+n = 10000
+Construction:  625 loops, best of 3: 1.29 μs per loop
+Distance:      25 loops, best of 3: 27.9 ms per loop
+n = 100000
+Construction:  625 loops, best of 3: 1.25 μs per loop
+Distance:      5 loops, best of 3: 290 ms per loop
 ```
 
 ```
@@ -80,6 +97,9 @@
 Wall time: 1.48 s
 Ambient quadratic space of dimension 1000 over Rational Field
 Inner product matrix: ...
+
+sage: for n in 5, 80, 1000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))".format(n, n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print("Distance:     ", timeit("norm(V(u) - V(v))"))
+
 ```
 
 
``````




---

archive/issue_comments_478581.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.\n \n-Spaces without scalar product:\n+**Spaces without scalar product:**\n \n ```\n sage: VectorSpace(QQ, 5).category()\n@@ -18,22 +18,26 @@\n Wall time: 213 \u00b5s\n Vector space of dimension 1000 over Rational Field\n \n-sage: for n in 5, 80, 1000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {})\".format(n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\n+sage: for n in 5, 80, 1000, 4000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {})\".format(n),number=1,repeat=1)); u = [ x for x i\n+....: n range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\n n = 5\n-Construction:  625 loops, best of 3: 1.88 \u03bcs per loop\n-Distance:      625 loops, best of 3: 75.6 \u03bcs per loop\n+Construction:  1 loop, best of 1: 56.1 ms per loop\n+Distance:      625 loops, best of 3: 81.7 \u03bcs per loop\n n = 80\n-Construction:  625 loops, best of 3: 1.27 \u03bcs per loop\n-Distance:      625 loops, best of 3: 280 \u03bcs per loop\n+Construction:  1 loop, best of 1: 159 \u03bcs per loop\n+Distance:      625 loops, best of 3: 299 \u03bcs per loop\n n = 1000\n-Construction:  625 loops, best of 3: 1.26 \u03bcs per loop\n-Distance:      125 loops, best of 3: 2.82 ms per loop\n+Construction:  1 loop, best of 1: 236 \u03bcs per loop\n+Distance:      125 loops, best of 3: 3.18 ms per loop\n+n = 4000\n+Construction:  1 loop, best of 1: 147 \u03bcs per loop\n+Distance:      25 loops, best of 3: 11.3 ms per loop\n n = 10000\n-Construction:  625 loops, best of 3: 1.29 \u03bcs per loop\n-Distance:      25 loops, best of 3: 27.9 ms per loop\n+Construction:  1 loop, best of 1: 149 \u03bcs per loop\n+Distance:      25 loops, best of 3: 28.7 ms per loop\n n = 100000\n-Construction:  625 loops, best of 3: 1.25 \u03bcs per loop\n-Distance:      5 loops, best of 3: 290 ms per loop\n+Construction:  1 loop, best of 1: 162 \u03bcs per loop\n+Distance:      5 loops, best of 3: 296 ms per loop\n ```\n \n ```\n@@ -72,7 +76,7 @@\n ```\n \n \n-Spaces with scalar product:\n+**Spaces with scalar product:**\n \n ```\n sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()\n@@ -98,10 +102,21 @@\n Ambient quadratic space of dimension 1000 over Rational Field\n Inner product matrix: ...\n \n-sage: for n in 5, 80, 1000, 10000, 100000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))\".format(n, n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print(\"Distance:     \", timeit(\"norm(V(u) - V(v))\"))\n-\n+sage: for n in 5, 80, 1000, 4000: print(\"n = {}\".format(n)); print(\"Construction: \", timeit(\"V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))\".format(n, n),number=1,repeat=1)); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print(\"Distance:     \", timeit(\"t = V(u)-V(v); sqrt(t.inner_product(t))\"))\n+n = 5\n+Construction:  1 loop, best of 1: 61.9 ms per loop\n+Distance:      625 loops, best of 3: 49.4 \u03bcs per loop\n+n = 80\n+Construction:  1 loop, best of 1: 9.75 ms per loop\n+Distance:      625 loops, best of 3: 243 \u03bcs per loop\n+n = 1000\n+Construction:  1 loop, best of 1: 1.51 s per loop\n+Distance:      25 loops, best of 3: 14.4 ms per loop\n+n = 4000\n+Construction:  1 loop, best of 1: 23.8 s per loop\n+Distance:      5 loops, best of 3: 225 ms per loop\n ```\n-\n+NB: It is not in the category `MetricSpaces`, and thus the element methods `dist` and `abs` (?!) are missing... The methods `__abs__`, `norm`, and `dot_product` are unrelated to the inner product matrix; only `inner_product` uses `inner_product_matrix`.\n \n ```\n sage: EuclideanSpace(5).category()\n@@ -120,7 +135,7 @@\n ```\n \n \n-Scalar product without a space:\n+**Scalar product without a space:**\n \n ```\n sage: %time DiagonalQuadraticForm(QQ, [1]*5)\n``````\n",
    "created_at": "2020-07-07T23:53:59Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478581",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.
 
-Spaces without scalar product:
+**Spaces without scalar product:**
 
 ```
 sage: VectorSpace(QQ, 5).category()
@@ -18,22 +18,26 @@
 Wall time: 213 µs
 Vector space of dimension 1000 over Rational Field
 
-sage: for n in 5, 80, 1000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {})".format(n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print("Distance:     ", timeit("norm(V(u) - V(v))"))
+sage: for n in 5, 80, 1000, 4000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {})".format(n),number=1,repeat=1)); u = [ x for x i
+....: n range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n); print("Distance:     ", timeit("norm(V(u) - V(v))"))
 n = 5
-Construction:  625 loops, best of 3: 1.88 μs per loop
-Distance:      625 loops, best of 3: 75.6 μs per loop
+Construction:  1 loop, best of 1: 56.1 ms per loop
+Distance:      625 loops, best of 3: 81.7 μs per loop
 n = 80
-Construction:  625 loops, best of 3: 1.27 μs per loop
-Distance:      625 loops, best of 3: 280 μs per loop
+Construction:  1 loop, best of 1: 159 μs per loop
+Distance:      625 loops, best of 3: 299 μs per loop
 n = 1000
-Construction:  625 loops, best of 3: 1.26 μs per loop
-Distance:      125 loops, best of 3: 2.82 ms per loop
+Construction:  1 loop, best of 1: 236 μs per loop
+Distance:      125 loops, best of 3: 3.18 ms per loop
+n = 4000
+Construction:  1 loop, best of 1: 147 μs per loop
+Distance:      25 loops, best of 3: 11.3 ms per loop
 n = 10000
-Construction:  625 loops, best of 3: 1.29 μs per loop
-Distance:      25 loops, best of 3: 27.9 ms per loop
+Construction:  1 loop, best of 1: 149 μs per loop
+Distance:      25 loops, best of 3: 28.7 ms per loop
 n = 100000
-Construction:  625 loops, best of 3: 1.25 μs per loop
-Distance:      5 loops, best of 3: 290 ms per loop
+Construction:  1 loop, best of 1: 162 μs per loop
+Distance:      5 loops, best of 3: 296 ms per loop
 ```
 
 ```
@@ -72,7 +76,7 @@
 ```
 
 
-Spaces with scalar product:
+**Spaces with scalar product:**
 
 ```
 sage: VectorSpace(QQ, 5, inner_product_matrix=matrix.identity(5)).category()
@@ -98,10 +102,21 @@
 Ambient quadratic space of dimension 1000 over Rational Field
 Inner product matrix: ...
 
-sage: for n in 5, 80, 1000, 10000, 100000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))".format(n, n))); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print("Distance:     ", timeit("norm(V(u) - V(v))"))
-
+sage: for n in 5, 80, 1000, 4000: print("n = {}".format(n)); print("Construction: ", timeit("V = VectorSpace(QQ, {}, inner_product_matrix=matrix.identity({}))".format(n, n),number=1,repeat=1)); u = [ x for x in range(n) ]; v = [ x + 1 for x in range(n) ]; V = VectorSpace(QQ, n, inner_product_matrix=matrix.identity(n)); print("Distance:     ", timeit("t = V(u)-V(v); sqrt(t.inner_product(t))"))
+n = 5
+Construction:  1 loop, best of 1: 61.9 ms per loop
+Distance:      625 loops, best of 3: 49.4 μs per loop
+n = 80
+Construction:  1 loop, best of 1: 9.75 ms per loop
+Distance:      625 loops, best of 3: 243 μs per loop
+n = 1000
+Construction:  1 loop, best of 1: 1.51 s per loop
+Distance:      25 loops, best of 3: 14.4 ms per loop
+n = 4000
+Construction:  1 loop, best of 1: 23.8 s per loop
+Distance:      5 loops, best of 3: 225 ms per loop
 ```
-
+NB: It is not in the category `MetricSpaces`, and thus the element methods `dist` and `abs` (?!) are missing... The methods `__abs__`, `norm`, and `dot_product` are unrelated to the inner product matrix; only `inner_product` uses `inner_product_matrix`.
 
 ```
 sage: EuclideanSpace(5).category()
@@ -120,7 +135,7 @@
 ```
 
 
-Scalar product without a space:
+**Scalar product without a space:**
 
 ```
 sage: %time DiagonalQuadraticForm(QQ, [1]*5)
``````




---

archive/issue_comments_478582.json:
```json
{
    "body": "<a id='comment:40'></a>\nDoes `EuclideanSpace` know how to compute geodesics, and thus distances?",
    "created_at": "2020-07-08T00:19:23Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478582",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>
Does `EuclideanSpace` know how to compute geodesics, and thus distances?



---

archive/issue_comments_478583.json:
```json
{
    "body": "<a id='comment:41'></a>\nReplying to [mkoeppe](#comment%3A40):\n> Does `EuclideanSpace` know how to compute geodesics, and thus distances?\n\nYes it does, via [IntegratedGeodesic](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Note however that for Euclidean spaces, geodesics are trivial (straight lines).",
    "created_at": "2020-07-08T06:29:01Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478583",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:41'></a>
Replying to [mkoeppe](#comment%3A40):
> Does `EuclideanSpace` know how to compute geodesics, and thus distances?

Yes it does, via [IntegratedGeodesic](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html). Note however that for Euclidean spaces, geodesics are trivial (straight lines).



---

archive/issue_comments_478584.json:
```json
{
    "body": "<a id='comment:42'></a>\nBy the way, an overview of `EuclideanSpace` capabilities is in this [thematic tutorial](https://doc.sagemath.org/html/en/thematic_tutorials/vector_calculus.html); see also the  [associated notebooks](https://sagemanifolds.obspm.fr/vector_calculus.html) and this [section of the reference manual](https://doc.sagemath.org/html/en/reference/manifolds/euclidean_space.html).",
    "created_at": "2020-07-08T07:03:15Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478584",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:42'></a>
By the way, an overview of `EuclideanSpace` capabilities is in this [thematic tutorial](https://doc.sagemath.org/html/en/thematic_tutorials/vector_calculus.html); see also the  [associated notebooks](https://sagemanifolds.obspm.fr/vector_calculus.html) and this [section of the reference manual](https://doc.sagemath.org/html/en/reference/manifolds/euclidean_space.html).



---

archive/issue_comments_478585.json:
```json
{
    "body": "<a id='comment:43'></a>\nThanks for the pointers. It's on my list of things to learn more systematically about sage-manifolds.",
    "created_at": "2020-07-08T13:19:47Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478585",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Thanks for the pointers. It's on my list of things to learn more systematically about sage-manifolds.



---

archive/issue_comments_478586.json:
```json
{
    "body": "<a id='comment:44'></a>\nReplying to [egourgoulhon](#comment%3A41):\n> Replying to [mkoeppe](#comment%3A40):\n> > Does `EuclideanSpace` know how to compute geodesics, and thus distances?\n\n> Yes it does, via [IntegratedGeodesic](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html).\n\nShould it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?",
    "created_at": "2020-07-08T13:22:51Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478586",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:44'></a>
Replying to [egourgoulhon](#comment%3A41):
> Replying to [mkoeppe](#comment%3A40):
> > Does `EuclideanSpace` know how to compute geodesics, and thus distances?

> Yes it does, via [IntegratedGeodesic](https://doc.sagemath.org/html/en/reference/manifolds/sage/manifolds/differentiable/integrated_curve.html).

Should it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?



---

archive/issue_comments_478587.json:
```json
{
    "body": "<a id='comment:45'></a>\nReplying to [mkoeppe](#comment%3A44):\n> \n> Should it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?\n\n\nYes. It will be easy to implement the distance function by means of the Cartesian chart.",
    "created_at": "2020-07-08T21:52:16Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478587",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:45'></a>
Replying to [mkoeppe](#comment%3A44):
> 
> Should it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?


Yes. It will be easy to implement the distance function by means of the Cartesian chart.



---

archive/issue_comments_478588.json:
```json
{
    "body": "<a id='comment:47'></a>\nReplying to [egourgoulhon](#comment%3A45):\n> Replying to [mkoeppe](#comment%3A44):\n> > \n> > Should it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?\n\n> \n> Yes. It will be easy to implement the distance function by means of the Cartesian chart. \n\n\nThanks. I have added this task to #30062.",
    "created_at": "2020-07-10T18:16:19Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478588",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:47'></a>
Replying to [egourgoulhon](#comment%3A45):
> Replying to [mkoeppe](#comment%3A44):
> > 
> > Should it (and presumably other manifold classes) be added to the category `MetricSpaces` then (#30062)?

> 
> Yes. It will be easy to implement the distance function by means of the Cartesian chart. 


Thanks. I have added this task to #30062.



---

archive/issue_comments_478589.json:
```json
{
    "body": "<a id='comment:49'></a>\nShould we set this ticket to \"needs_review\"?",
    "created_at": "2020-07-14T19:22:30Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478589",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:49'></a>
Should we set this ticket to "needs_review"?



---

archive/issue_comments_478590.json:
```json
{
    "body": "<a id='comment:50'></a>\nCan you please briefly summarize in the description what has actually been done and what the new benefits are? It is very difficult for me to piece that all together just from the comments and cross references to other tickets. Thanks! :)\n\nIn general, I would wait until the dependent tickets are merged. However, I am a bad role model due to my impatience.",
    "created_at": "2020-07-15T13:35:52Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478590",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:50'></a>
Can you please briefly summarize in the description what has actually been done and what the new benefits are? It is very difficult for me to piece that all together just from the comments and cross references to other tickets. Thanks! :)

In general, I would wait until the dependent tickets are merged. However, I am a bad role model due to my impatience.



---

archive/issue_events_268481.json:
```json
{
    "actor": "https://github.com/egourgoulhon",
    "created_at": "2020-07-15T14:02:26Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268481"
}
```



---

archive/issue_comments_478591.json:
```json
{
    "body": "<a id='comment:52'></a>\nReplying to [mkoeppe](#comment%3A49):\n> Should we set this ticket to \"needs_review\"?\n\nYes, indeed.",
    "created_at": "2020-07-15T14:03:08Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478591",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:52'></a>
Replying to [mkoeppe](#comment%3A49):
> Should we set this ticket to "needs_review"?

Yes, indeed.



---

archive/issue_comments_478592.json:
```json
{
    "body": "<a id='comment:53'></a>\nReplying to [gh-mjungmath](#comment%3A50):\n> Can you please briefly summarize in the description what has actually been done and what the new benefits are? It is very difficult for me to piece that all together just from the comments and cross references to other tickets. Thanks! :)\n\n\nThe code added in this ticket is described in [comment:22](#comment%3A22) and [comment:23](#comment%3A23).\nThe other code in the ticket branch arises from the dependencies tickets #30065 and #30074.",
    "created_at": "2020-07-15T14:05:33Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478592",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:53'></a>
Replying to [gh-mjungmath](#comment%3A50):
> Can you please briefly summarize in the description what has actually been done and what the new benefits are? It is very difficult for me to piece that all together just from the comments and cross references to other tickets. Thanks! :)


The code added in this ticket is described in [comment:22](#comment%3A22) and [comment:23](#comment%3A23).
The other code in the ticket branch arises from the dependencies tickets #30065 and #30074.



---

archive/issue_comments_478593.json:
```json
{
    "body": "<a id='comment:54'></a>\nReplying to [egourgoulhon](#comment%3A53):\n> The code added in this ticket is described in [comment:22](#comment%3A22) and [comment:23](#comment%3A23).\n> The other code in the ticket branch arises from the dependencies tickets #30065 and #30074.\n> \n\nThanks!",
    "created_at": "2020-07-15T14:07:26Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478593",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:54'></a>
Replying to [egourgoulhon](#comment%3A53):
> The code added in this ticket is described in [comment:22](#comment%3A22) and [comment:23](#comment%3A23).
> The other code in the ticket branch arises from the dependencies tickets #30065 and #30074.
> 

Thanks!



---

archive/issue_events_268482.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-15T14:24:42Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "rename": {
        "from": "Constructing Euclidean spaces, many variants",
        "to": "Speed up constructing high-dimensional Euclidean spaces"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268482"
}
```



---

archive/issue_comments_478594.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -134,6 +134,22 @@\n (timeout)\n ```\n \n+*With this ticket (and its dependencies):*\n+\n+```\n+sage: %time EuclideanSpace(5)\n+CPU times: user 4.87 ms, sys: 372 \u00b5s, total: 5.24 ms\n+Wall time: 4.93 ms\n+5-dimensional Euclidean space E^5\n+sage: %time EuclideanSpace(80)\n+CPU times: user 106 ms, sys: 4.52 ms, total: 110 ms\n+Wall time: 92 ms\n+80-dimensional Euclidean space E^80\n+sage: %time EuclideanSpace(1000)\n+CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s\n+Wall time: 986 ms\n+```\n+\n \n **Scalar product without a space:**\n \n``````\n",
    "created_at": "2020-07-15T18:12:28Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478594",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -134,6 +134,22 @@
 (timeout)
 ```
 
+*With this ticket (and its dependencies):*
+
+```
+sage: %time EuclideanSpace(5)
+CPU times: user 4.87 ms, sys: 372 µs, total: 5.24 ms
+Wall time: 4.93 ms
+5-dimensional Euclidean space E^5
+sage: %time EuclideanSpace(80)
+CPU times: user 106 ms, sys: 4.52 ms, total: 110 ms
+Wall time: 92 ms
+80-dimensional Euclidean space E^80
+sage: %time EuclideanSpace(1000)
+CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s
+Wall time: 986 ms
+```
+
 
 **Scalar product without a space:**
 
``````




---

archive/issue_comments_478595.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1,4 +1,6 @@\n-The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.\n+The n-dimensional Euclidean space is available in Sage in many variants.  \n+\n+This ticket brings the speed of the most basic operation (constructing the space) of `EuclideanSpace` (from sage-manifolds) closer to that of the other variants.\n \n **Spaces without scalar product:**\n \n``````\n",
    "created_at": "2020-07-15T18:13:54Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478595",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1,4 +1,6 @@
-The n-dimensional Euclidean space is available in Sage in many variants.  We investigate the speed of the most basic operation: Constructing the space.
+The n-dimensional Euclidean space is available in Sage in many variants.  
+
+This ticket brings the speed of the most basic operation (constructing the space) of `EuclideanSpace` (from sage-manifolds) closer to that of the other variants.
 
 **Spaces without scalar product:**
 
``````




---

archive/issue_comments_478596.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -151,7 +151,14 @@\n CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s\n Wall time: 986 ms\n ```\n+*Some caching is happening too. The second time:*\n \n+```\n+sage: %time EuclideanSpace(1000)\n+CPU times: user 207 ms, sys: 5.63 ms, total: 213 ms\n+Wall time: 212 ms\n+1000-dimensional Euclidean space E^1000\n+```\n \n **Scalar product without a space:**\n \n``````\n",
    "created_at": "2020-07-15T18:16:14Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478596",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -151,7 +151,14 @@
 CPU times: user 1.04 s, sys: 33.5 ms, total: 1.07 s
 Wall time: 986 ms
 ```
+*Some caching is happening too. The second time:*
 
+```
+sage: %time EuclideanSpace(1000)
+CPU times: user 207 ms, sys: 5.63 ms, total: 213 ms
+Wall time: 212 ms
+1000-dimensional Euclidean space E^1000
+```
 
 **Scalar product without a space:**
 
``````




---

archive/issue_comments_478597.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -136,7 +136,7 @@\n (timeout)\n ```\n \n-*With this ticket (and its dependencies):*\n+*With this ticket (and its dependencies #30065, #30074):*\n \n ```\n sage: %time EuclideanSpace(5)\n``````\n",
    "created_at": "2020-07-15T18:16:49Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478597",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -136,7 +136,7 @@
 (timeout)
 ```
 
-*With this ticket (and its dependencies):*
+*With this ticket (and its dependencies #30065, #30074):*
 
 ```
 sage: %time EuclideanSpace(5)
``````




---

archive/issue_events_268483.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-19T00:56:11Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "needs review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268483"
}
```



---

archive/issue_events_268484.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-19T00:56:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268484"
}
```



---

archive/issue_comments_478598.json:
```json
{
    "body": "**Reviewer:** Matthias Koeppe",
    "created_at": "2020-07-19T00:56:11Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478598",
    "user": "https://github.com/mkoeppe"
}
```

**Reviewer:** Matthias Koeppe



---

archive/issue_comments_478599.json:
```json
{
    "body": "<a id='comment:61'></a>\nPatchbot not green. The latest branch of #30074 has not been merged yet.",
    "created_at": "2020-07-19T10:09:05Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478599",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:61'></a>
Patchbot not green. The latest branch of #30074 has not been merged yet.



---

archive/issue_events_268485.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-19T10:09:05Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268485"
}
```



---

archive/issue_events_268486.json:
```json
{
    "actor": "https://github.com/mjungmath",
    "created_at": "2020-07-19T10:09:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268486"
}
```



---

archive/issue_comments_478600.json:
```json
{
    "body": "<a id='comment:62'></a>\nThat is not a real error (the other patchbot also came back green). You don't need to have all of the other branches merged in.",
    "created_at": "2020-07-19T12:50:16Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478600",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:62'></a>
That is not a real error (the other patchbot also came back green). You don't need to have all of the other branches merged in.



---

archive/issue_events_268487.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-19T12:50:16Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "needs work",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268487"
}
```



---

archive/issue_events_268488.json:
```json
{
    "actor": "https://github.com/tscrim",
    "created_at": "2020-07-19T12:50:16Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268488"
}
```



---

archive/issue_comments_478601.json:
```json
{
    "body": "<a id='comment:63'></a>\nReplying to [tscrim](#comment%3A62):\n> That is not a real error (the other patchbot also came back green).\n\nIt is a real error. Pyflakes is complaining about an unused import.\n\n> You don't need to have all of the other branches merged in.\n\nWhy is that? Wouldn't that cause a merge conflict later on?",
    "created_at": "2020-07-19T12:53:56Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478601",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:63'></a>
Replying to [tscrim](#comment%3A62):
> That is not a real error (the other patchbot also came back green).

It is a real error. Pyflakes is complaining about an unused import.

> You don't need to have all of the other branches merged in.

Why is that? Wouldn't that cause a merge conflict later on?



---

archive/issue_comments_478602.json:
```json
{
    "body": "<a id='comment:64'></a>\nReplying to [gh-mjungmath](#comment%3A63):\n> Replying to [tscrim](#comment%3A62):\n> > That is not a real error (the other patchbot also came back green).\n\n> It is a real error. Pyflakes is complaining about an unused import.\n\nNo, it is not. Pyflakes are not real errors (but they are good to clear).\n\n> > You don't need to have all of the other branches merged in.\n\n> Why is that? Wouldn't that cause in a merge conflict later on?\n\nThere is no need to add unnecessary extra merge commits when there is no conflict or a need to have the latest branch. If later changes on the first branch are done to unrelated parts to the changes on this branch, there is no conflict.\n\nAddendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.",
    "created_at": "2020-07-19T12:57:00Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478602",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:64'></a>
Replying to [gh-mjungmath](#comment%3A63):
> Replying to [tscrim](#comment%3A62):
> > That is not a real error (the other patchbot also came back green).

> It is a real error. Pyflakes is complaining about an unused import.

No, it is not. Pyflakes are not real errors (but they are good to clear).

> > You don't need to have all of the other branches merged in.

> Why is that? Wouldn't that cause in a merge conflict later on?

There is no need to add unnecessary extra merge commits when there is no conflict or a need to have the latest branch. If later changes on the first branch are done to unrelated parts to the changes on this branch, there is no conflict.

Addendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.



---

archive/issue_comments_478603.json:
```json
{
    "body": "<a id='comment:65'></a>\nReplying to [tscrim](#comment%3A64):\n> Replying to [gh-mjungmath](#comment%3A63):\n> > Replying to [tscrim](#comment%3A62):\n> > > That is not a real error (the other patchbot also came back green).\n\n> > It is a real error. Pyflakes is complaining about an unused import.\n> \n> No, it is not. Pyflakes are not real errors (but they are good to clear).\n\nOkay, I see what you mean.\n\nReplying to [tscrim](#comment%3A64):\n> Addendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.\n\n\nMh. Sorry, I don't get it. The #30074 will be merged into develop first because of the dependence, right? Afterwards, this ticket will be merged. If this ticket consists of an older version than #30074, this would cause a merge conflict, wouldn't it? Or, at least, the pyflakes error would be added again.",
    "created_at": "2020-07-19T13:03:35Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478603",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:65'></a>
Replying to [tscrim](#comment%3A64):
> Replying to [gh-mjungmath](#comment%3A63):
> > Replying to [tscrim](#comment%3A62):
> > > That is not a real error (the other patchbot also came back green).

> > It is a real error. Pyflakes is complaining about an unused import.
> 
> No, it is not. Pyflakes are not real errors (but they are good to clear).

Okay, I see what you mean.

Replying to [tscrim](#comment%3A64):
> Addendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.


Mh. Sorry, I don't get it. The #30074 will be merged into develop first because of the dependence, right? Afterwards, this ticket will be merged. If this ticket consists of an older version than #30074, this would cause a merge conflict, wouldn't it? Or, at least, the pyflakes error would be added again.



---

archive/issue_comments_478604.json:
```json
{
    "body": "<a id='comment:66'></a>\nReplying to [gh-mjungmath](#comment%3A65):\n> Replying to [tscrim](#comment%3A64):\n> > Addendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.\n\n> \n> Mh. Sorry, I don't get it. The #30074 will be merged into develop first because of the dependence, right? Afterwards, this ticket will be merged. If this ticket consists of an older version than #30074, this would cause a merge conflict, wouldn't it? Or, at least, the pyflakes error would be added again.\n\n\nNo. The result will look like this:\n\n```\nB--0--X--T----M\n    \\        /\n     0--0--H\n```\nwhere `T` is this branch and `H` is the head of #30074. So the #30074 branch will be merged first (all commits marked `0` starting from the latest beta `B` and `H`), then the commits from this branch (labelled `X` and `T`), which will result in the merge commit `M`. This would be exactly the same as if you merged in the latest commits from #30074 because that would be doing the same thing. The only difference is you have an extra merge commit in where this branch is pointing to.",
    "created_at": "2020-07-19T13:12:21Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478604",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:66'></a>
Replying to [gh-mjungmath](#comment%3A65):
> Replying to [tscrim](#comment%3A64):
> > Addendum - The pyflakes is handled on the later commits from #30074. So changing that here would cause a merge conflict and resolve a problem already fixed.

> 
> Mh. Sorry, I don't get it. The #30074 will be merged into develop first because of the dependence, right? Afterwards, this ticket will be merged. If this ticket consists of an older version than #30074, this would cause a merge conflict, wouldn't it? Or, at least, the pyflakes error would be added again.


No. The result will look like this:

```
B--0--X--T----M
    \        /
     0--0--H
```
where `T` is this branch and `H` is the head of #30074. So the #30074 branch will be merged first (all commits marked `0` starting from the latest beta `B` and `H`), then the commits from this branch (labelled `X` and `T`), which will result in the merge commit `M`. This would be exactly the same as if you merged in the latest commits from #30074 because that would be doing the same thing. The only difference is you have an extra merge commit in where this branch is pointing to.



---

archive/issue_comments_478605.json:
```json
{
    "body": "<a id='comment:67'></a>\nReplying to [tscrim](#comment%3A66):\n> No. The result will look like this:\n> \n> ```\n> B--0--X--T----M\n>     \\        /\n>      0--0--H\n> ```\n> where `T` is this branch and `H` is the head of #30074. So the #30074 branch will be merged first (all commits marked `0` starting from the latest beta `B` and `H`), then the commits from this branch (labelled `X` and `T`), which will result in the merge commit `M`. This would be exactly the same as if you merged in the latest commits from #30074 because that would be doing the same thing. The only difference is you have an extra merge commit in where this branch is pointing to.\n\n\nAh, I see. This is because the commit in #30074 is more recent, right?",
    "created_at": "2020-07-19T13:33:55Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478605",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:67'></a>
Replying to [tscrim](#comment%3A66):
> No. The result will look like this:
> 
> ```
> B--0--X--T----M
>     \        /
>      0--0--H
> ```
> where `T` is this branch and `H` is the head of #30074. So the #30074 branch will be merged first (all commits marked `0` starting from the latest beta `B` and `H`), then the commits from this branch (labelled `X` and `T`), which will result in the merge commit `M`. This would be exactly the same as if you merged in the latest commits from #30074 because that would be doing the same thing. The only difference is you have an extra merge commit in where this branch is pointing to.


Ah, I see. This is because the commit in #30074 is more recent, right?



---

archive/issue_comments_478606.json:
```json
{
    "body": "<a id='comment:68'></a>\nReplying to [gh-mjungmath](#comment%3A67):\n> Ah, I see. This is because the commit in #30074 is more recent, right?\n\n\nYes, but it is still based off a common base commit.",
    "created_at": "2020-07-19T14:03:19Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478606",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:68'></a>
Replying to [gh-mjungmath](#comment%3A67):
> Ah, I see. This is because the commit in #30074 is more recent, right?


Yes, but it is still based off a common base commit.



---

archive/issue_comments_478607.json:
```json
{
    "body": "<a id='comment:69'></a>\nReplying to [tscrim](#comment%3A68):\n> Replying to [gh-mjungmath](#comment%3A67):\n> > Ah, I see. This is because the commit in #30074 is more recent, right?\n\n> \n> Yes, but it is still based off a common base commit.\n\n\nAh well. Thank you for explaining this, and sorry for delaying the process. This is good to know for future commits of mine.",
    "created_at": "2020-07-19T14:13:25Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478607",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:69'></a>
Replying to [tscrim](#comment%3A68):
> Replying to [gh-mjungmath](#comment%3A67):
> > Ah, I see. This is because the commit in #30074 is more recent, right?

> 
> Yes, but it is still based off a common base commit.


Ah well. Thank you for explaining this, and sorry for delaying the process. This is good to know for future commits of mine.



---

archive/issue_events_268489.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-02T08:20:44Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "label": "positive review",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268489"
}
```



---

archive/issue_events_268490.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-02T08:20:44Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30061#event-268490"
}
```



---

archive/issue_comments_478608.json:
```json
{
    "body": "**Changing branch** from \"[public/manifolds/init_module_basis-30061](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/init_module_basis-30061)\" to \"[3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)\".",
    "created_at": "2020-08-02T08:20:44Z",
    "issue": "https://github.com/sagemath/sage/issues/30061",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30061#issuecomment-478608",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[public/manifolds/init_module_basis-30061](https://github.com/sagemath/sagetrac-mirror/tree/public/manifolds/init_module_basis-30061)" to "[3ce0c15fc9b3d71842946ad6a0b0449771b1ada7](https://github.com/sagemath/sagetrac-mirror/commit/3ce0c15fc9b3d71842946ad6a0b0449771b1ada7)".
