# Issue 30000: Implement a Q-curve test for elliptic curves over number fields

archive/issues_029763.json:
```json
{
    "body": "An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I developed an efficient algorithm to test this, detailed in a preprint with Filip Najman (http://arxiv.org/abs/2004.10054).  This is implemented here.\n\nI have tested this on around 660,000 elliptic curves over fields of degree 2-6 in the LMFDB.\n\nBranch/Commit: [3cce92ad24f77a0901a87f384cabce59b1b67613](https://github.com/sagemath/sagetrac-mirror/commit/3cce92ad24f77a0901a87f384cabce59b1b67613)\n\nReviewer: Kiran Kedlaya, Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: John Cremona\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30000\n\n",
    "closed_at": "2021-03-01T00:20:55Z",
    "created_at": "2020-06-27T08:16:35Z",
    "labels": [
        "component: elliptic curves"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Implement a Q-curve test for elliptic curves over number fields",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30000",
    "user": "https://github.com/JohnCremona"
}
```
An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I developed an efficient algorithm to test this, detailed in a preprint with Filip Najman (http://arxiv.org/abs/2004.10054).  This is implemented here.

I have tested this on around 660,000 elliptic curves over fields of degree 2-6 in the LMFDB.

Branch/Commit: [3cce92ad24f77a0901a87f384cabce59b1b67613](https://github.com/sagemath/sagetrac-mirror/commit/3cce92ad24f77a0901a87f384cabce59b1b67613)

Reviewer: Kiran Kedlaya, Frédéric Chapoton

Author: John Cremona

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30000





---

archive/issue_comments_590169.json:
```json
{
    "body": "<a id='comment:1'></a>\nCongratulation for the ticket number, and thanks for all your contributions !",
    "created_at": "2020-06-27T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590169",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
Congratulation for the ticket number, and thanks for all your contributions !



---

archive/issue_comments_590170.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1 @@\n-An in teresting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implsmented some, and will include it in Sage when done.\n+An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implemented some, and will include it in Sage when done.\n``````\n",
    "created_at": "2020-06-27T08:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590170",
    "user": "https://github.com/fchapoton"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1 @@
-An in teresting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implsmented some, and will include it in Sage when done.
+An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implemented some, and will include it in Sage when done.
``````




---

archive/issue_comments_590171.json:
```json
{
    "body": "<a id='comment:2'></a>\nIs the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?",
    "created_at": "2020-07-05T18:21:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590171",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:2'></a>
Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?



---

archive/issue_comments_590172.json:
```json
{
    "body": "<a id='comment:3'></a>\nReplying to [kedlaya](#comment%3A2):\n> Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?\n\n\nYes absolutely.  I'll be writing up the strategy as part of a joint paper with Filip Najman and Samuel Le Fourn.   It is mostly coded already, and run on all the curves in the LMFDB, but since I did that we have proved some results which make both parts simpler -- both easy tests of necessary conditions, which in practice eliminate all non-Q-curves, and rigorous tests of the remaining ones to establish that they are.  The key is not having to make an field extensions -- for example if your curve defined over an S6 sextic field, you definitely do not want to work over the Galois closure.  We don't!",
    "created_at": "2020-07-06T07:35:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590172",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:3'></a>
Replying to [kedlaya](#comment%3A2):
> Is the general idea to do some cheap tests to rule out most cases, and then invest more energy once you have a likely positive?


Yes absolutely.  I'll be writing up the strategy as part of a joint paper with Filip Najman and Samuel Le Fourn.   It is mostly coded already, and run on all the curves in the LMFDB, but since I did that we have proved some results which make both parts simpler -- both easy tests of necessary conditions, which in practice eliminate all non-Q-curves, and rigorous tests of the remaining ones to establish that they are.  The key is not having to make an field extensions -- for example if your curve defined over an S6 sextic field, you definitely do not want to work over the Galois closure.  We don't!



---

archive/issue_events_086972.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-29T16:37:33Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30000#event-86972"
}
```



---

archive/issue_comments_590173.json:
```json
{
    "body": "Changing branch from \"\" to \"u/cremona/30000\"",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590173",
    "user": "https://github.com/JohnCremona"
}
```

Changing branch from "" to "u/cremona/30000"



---

archive/issue_comments_590174.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590174",
    "user": "https://github.com/JohnCremona"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_590175.json:
```json
{
    "body": "<a id='comment:5'></a>\nNote to reviewers:  the main new code is in a new file Qcurves.py, which I added to the reference manual. That consists of one main function `is_Q_curve()` and a couple of helper functions, all documented.  The user interface is via a new method in the class for elliptic curves over number fields.\n\nFor correctness, I refer to the preprint above which both establishes the necessary theory and presents the algorithm.  This paper has been refereed by two people and is provisionally accepted by Research in Number Theory (the referees had no issues with the algorithm).  And I have run the code on many hundreds of thousands of curves in the LMFDB -- so there is no point in comparing the output with the LMFDB, as the data there was computed by this code.  There are no other implementations of this that I know of.  Note that it is easy to try something much simpler which is both wrong and also incorrect, namely to base extend to the Galois closure, compute the isogeny class there, and see if all the Galois conjugates to the original (base-changed) curve are in the class.  This is wrong since the definition of Q-curves allows for the isogenies to be defined over Q-bar, and it is also very inefficient (e.g. if the base field as degree 6 and its Galois closure has degree 720).  My main motivation for the paper cited was to develop a more efficient algorithm, and the crucial new point is to see that one can decide the question without any extension of the base field.\n\n---\nNew commits:\n|                                                                                                                                          |                                                                               |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|\n|[a5564d8](https://github.com/sagemath/sagetrac-mirror/commit/a5564d86e8cd939e7f36d832d94a035fcb5182cc)|`#30000: implementation of Q-curve test for elliptic curves over number fields`|\n|[7d0eede](https://github.com/sagemath/sagetrac-mirror/commit/7d0eede3cd24083b4c3b1cd02d1892873eea140b)|`#30000: clean up docstrings`|",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590175",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:5'></a>
Note to reviewers:  the main new code is in a new file Qcurves.py, which I added to the reference manual. That consists of one main function `is_Q_curve()` and a couple of helper functions, all documented.  The user interface is via a new method in the class for elliptic curves over number fields.

For correctness, I refer to the preprint above which both establishes the necessary theory and presents the algorithm.  This paper has been refereed by two people and is provisionally accepted by Research in Number Theory (the referees had no issues with the algorithm).  And I have run the code on many hundreds of thousands of curves in the LMFDB -- so there is no point in comparing the output with the LMFDB, as the data there was computed by this code.  There are no other implementations of this that I know of.  Note that it is easy to try something much simpler which is both wrong and also incorrect, namely to base extend to the Galois closure, compute the isogeny class there, and see if all the Galois conjugates to the original (base-changed) curve are in the class.  This is wrong since the definition of Q-curves allows for the isogenies to be defined over Q-bar, and it is also very inefficient (e.g. if the base field as degree 6 and its Galois closure has degree 720).  My main motivation for the paper cited was to develop a more efficient algorithm, and the crucial new point is to see that one can decide the question without any extension of the base field.

---
New commits:
|                                                                                                                                          |                                                                               |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------|
|[a5564d8](https://github.com/sagemath/sagetrac-mirror/commit/a5564d86e8cd939e7f36d832d94a035fcb5182cc)|`#30000: implementation of Q-curve test for elliptic curves over number fields`|
|[7d0eede](https://github.com/sagemath/sagetrac-mirror/commit/7d0eede3cd24083b4c3b1cd02d1892873eea140b)|`#30000: clean up docstrings`|



---

archive/issue_comments_590176.json:
```json
{
    "body": "Changing author from \"\" to \"John Cremona\"",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590176",
    "user": "https://github.com/JohnCremona"
}
```

Changing author from "" to "John Cremona"



---

archive/issue_comments_590177.json:
```json
{
    "body": "Changing commit from \"\" to \"7d0eede3cd24083b4c3b1cd02d1892873eea140b\"",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590177",
    "user": "https://github.com/JohnCremona"
}
```

Changing commit from "" to "7d0eede3cd24083b4c3b1cd02d1892873eea140b"



---

archive/issue_comments_590178.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1 +1,3 @@\n-An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implemented some, and will include it in Sage when done.\n+An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I developed an efficient algorithm to test this, detailed in a preprint with Filip Najman (http://arxiv.org/abs/2004.10054).  This is implemented here.\n+\n+I have tested this on around 660,000 elliptic curves over fields of degree 2-6 in the LMFDB.\n``````\n",
    "created_at": "2021-02-05T12:23:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590178",
    "user": "https://github.com/JohnCremona"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1 +1,3 @@
-An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I am working on efficient ways to test this, have implemented some, and will include it in Sage when done.
+An interesting property of elliptic cuves over number fields is being a Q-curve (i.e. isogenous to all its Galois conjugates).  I developed an efficient algorithm to test this, detailed in a preprint with Filip Najman (http://arxiv.org/abs/2004.10054).  This is implemented here.
+
+I have tested this on around 660,000 elliptic curves over fields of degree 2-6 in the LMFDB.
``````




---

archive/issue_comments_590179.json:
```json
{
    "body": "<a id='comment:6'></a>\nFor the record, I was not one of the two referees, and I just convinced myself that the algorithm described in the paper is correct. (But I have not looked at the code yet.)",
    "created_at": "2021-02-05T17:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590179",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:6'></a>
For the record, I was not one of the two referees, and I just convinced myself that the algorithm described in the paper is correct. (But I have not looked at the code yet.)



---

archive/issue_comments_590180.json:
```json
{
    "body": "<a id='comment:7'></a>\nI'm seeing some doctest failures in patchbot starting from\n\n```\nModuleNotFoundError: No module named 'sage.schemes.elliptic_curves.Qcurve'\n```\nbut that's just a typo: it should be `Qcurves`.",
    "created_at": "2021-02-06T03:32:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590180",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:7'></a>
I'm seeing some doctest failures in patchbot starting from

```
ModuleNotFoundError: No module named 'sage.schemes.elliptic_curves.Qcurve'
```
but that's just a typo: it should be `Qcurves`.



---

archive/issue_comments_590181.json:
```json
{
    "body": "<a id='comment:8'></a>\nsuggestions:\n\n* Rather than importing things from sage.all, import them from where given by \"import_statements\"\n\n* typos in \"using a rigorous computaion\" and \"Frobenius discrimants\"\n\n* no need for square brackets here :\n\n```\nif any([d != discs[0] for d in discs[1:]]):\n```",
    "created_at": "2021-02-06T12:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590181",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>
suggestions:

* Rather than importing things from sage.all, import them from where given by "import_statements"

* typos in "using a rigorous computaion" and "Frobenius discrimants"

* no need for square brackets here :

```
if any([d != discs[0] for d in discs[1:]]):
```



---

archive/issue_comments_590182.json:
```json
{
    "body": "<a id='comment:9'></a>\nby the way, John, could you please help to answer\n\nhttps://ask.sagemath.org/question/55571/what-is-the-sigma-function-for-an-elliptic-curves-formal-group/",
    "created_at": "2021-02-06T12:33:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590182",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:9'></a>
by the way, John, could you please help to answer

https://ask.sagemath.org/question/55571/what-is-the-sigma-function-for-an-elliptic-curves-formal-group/



---

archive/issue_comments_590183.json:
```json
{
    "body": "<a id='comment:10'></a>\nOK, fixing the isses raised (I was sure that I had done a local test of ell_number_field, but clearly not).",
    "created_at": "2021-02-06T14:17:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590183",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:10'></a>
OK, fixing the isses raised (I was sure that I had done a local test of ell_number_field, but clearly not).



---

archive/issue_comments_590184.json:
```json
{
    "body": "Changing commit from \"7d0eede3cd24083b4c3b1cd02d1892873eea140b\" to \"3cce92ad24f77a0901a87f384cabce59b1b67613\"",
    "created_at": "2021-02-06T14:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590184",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "7d0eede3cd24083b4c3b1cd02d1892873eea140b" to "3cce92ad24f77a0901a87f384cabce59b1b67613"



---

archive/issue_comments_590185.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                               |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|\n|[7af9ff4](https://github.com/sagemath/sagetrac-mirror/commit/7af9ff4f4a3212363b6d3abc2edb562f194a379d)|`#30000: fix typos and imports`|\n|[3cce92a](https://github.com/sagemath/sagetrac-mirror/commit/3cce92ad24f77a0901a87f384cabce59b1b67613)|`Merge branch 'Qcurve' into Qcurves1`|",
    "created_at": "2021-02-06T14:51:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590185",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                               |
|-------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------|
|[7af9ff4](https://github.com/sagemath/sagetrac-mirror/commit/7af9ff4f4a3212363b6d3abc2edb562f194a379d)|`#30000: fix typos and imports`|
|[3cce92a](https://github.com/sagemath/sagetrac-mirror/commit/3cce92ad24f77a0901a87f384cabce59b1b67613)|`Merge branch 'Qcurve' into Qcurves1`|



---

archive/issue_comments_590186.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Kiran Kedlaya, Fr\u00e9d\u00e9ric Chapoton\"",
    "created_at": "2021-02-06T14:53:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590186",
    "user": "https://github.com/JohnCremona"
}
```

Changing reviewer from "" to "Kiran Kedlaya, Frédéric Chapoton"



---

archive/issue_comments_590187.json:
```json
{
    "body": "<a id='comment:13'></a>\nLooks great! I am eagerly awaiting this to get merged so that I can start using it...",
    "created_at": "2021-02-09T04:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590187",
    "user": "https://github.com/kedlaya"
}
```

<a id='comment:13'></a>
Looks great! I am eagerly awaiting this to get merged so that I can start using it...



---

archive/issue_comments_590188.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-02-09T04:55:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590188",
    "user": "https://github.com/kedlaya"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_590189.json:
```json
{
    "body": "<a id='comment:14'></a>\nThanks Kiran.  I look forward to feedback, especially if it is not in the form of bug reports.  If you cannot wait, this code (essentially) is also in https://github.com/JohnCremona/ecnf-data/blob/master/sage/Qcurves.py",
    "created_at": "2021-02-09T09:06:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590189",
    "user": "https://github.com/JohnCremona"
}
```

<a id='comment:14'></a>
Thanks Kiran.  I look forward to feedback, especially if it is not in the form of bug reports.  If you cannot wait, this code (essentially) is also in https://github.com/JohnCremona/ecnf-data/blob/master/sage/Qcurves.py



---

archive/issue_comments_590190.json:
```json
{
    "body": "Changing branch from \"u/cremona/30000\" to \"3cce92ad24f77a0901a87f384cabce59b1b67613\"",
    "created_at": "2021-03-01T00:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590190",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "u/cremona/30000" to "3cce92ad24f77a0901a87f384cabce59b1b67613"



---

archive/issue_comments_590191.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-03-01T00:20:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30000#issuecomment-590191",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_086973.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-03-01T00:20:55Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30000",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30000#event-86973"
}
```
