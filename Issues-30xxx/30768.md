# Issue 30768: Restore deprecation warnings for imports from collections vs collections.abc

archive/issues_030531.json:
```json
{
    "body": "Since #28012 we correctly import \"collections\nabstract base classes\" from collections.abc.\n\nThis ticket is for the next step: unsilence the\ncorresponding deprecation warnings.\n\nWe postponed doing that since some of our dependencies\nhad not updated their imports yet.\n\nSee ticket:28012#comment:23 for the discussion.\n\nBranch/Commit: edc435e122cd35abc280faad1ba0dca1fd107105\n\nReviewer: Matthias Koeppe\n\nAuthor: Fr\u00e9d\u00e9ric Chapoton\n\nDependencies: #32372\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30768\n\n",
    "closed_at": "2021-09-19T09:59:10Z",
    "created_at": "2020-10-13T22:28:40Z",
    "labels": [
        "component: refactoring"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.5",
    "title": "Restore deprecation warnings for imports from collections vs collections.abc",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30768",
    "user": "https://github.com/slel"
}
```
Since #28012 we correctly import "collections
abstract base classes" from collections.abc.

This ticket is for the next step: unsilence the
corresponding deprecation warnings.

We postponed doing that since some of our dependencies
had not updated their imports yet.

See ticket:28012#comment:23 for the discussion.

Branch/Commit: edc435e122cd35abc280faad1ba0dca1fd107105

Reviewer: Matthias Koeppe

Author: Frédéric Chapoton

Dependencies: #32372

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30768





---

archive/issue_comments_465156.json:
```json
{
    "body": "<a id='comment:1'></a>The required change is:\n\n```diff\ndiff --git a/src/sage/all.py b/src/sage/all.py\n--- a/src/sage/all.py\n+++ b/src/sage/all.py\n@@ -306,10 +306,6 @@ warnings.filters.remove(('ignore', None, DeprecationWarning, None, 0))\n # Ignore all deprecations from IPython etc.\n warnings.filterwarnings('ignore', category=DeprecationWarning,\n     module='.*(IPython|ipykernel|jupyter_client|jupyter_core|nbformat|notebook|ipywidgets|storemagic)')\n-# Ignore collections.abc warnings, there are a lot of them but they are\n-# harmless.\n-warnings.filterwarnings('ignore', category=DeprecationWarning,\n-    message='.*collections[.]abc.*')\n # However, be sure to keep OUR deprecation warnings\n warnings.filterwarnings('default', category=DeprecationWarning,\n     message=r'[\\s\\S]*See https\\?://trac.sagemath.org/[0-9]* for details.')\n```",
    "created_at": "2020-10-13T22:30:29Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465156",
    "user": "https://github.com/slel"
}
```

<a id='comment:1'></a>The required change is:

```diff
diff --git a/src/sage/all.py b/src/sage/all.py
--- a/src/sage/all.py
+++ b/src/sage/all.py
@@ -306,10 +306,6 @@ warnings.filters.remove(('ignore', None, DeprecationWarning, None, 0))
 # Ignore all deprecations from IPython etc.
 warnings.filterwarnings('ignore', category=DeprecationWarning,
     module='.*(IPython|ipykernel|jupyter_client|jupyter_core|nbformat|notebook|ipywidgets|storemagic)')
-# Ignore collections.abc warnings, there are a lot of them but they are
-# harmless.
-warnings.filterwarnings('ignore', category=DeprecationWarning,
-    message='.*collections[.]abc.*')
 # However, be sure to keep OUR deprecation warnings
 warnings.filterwarnings('default', category=DeprecationWarning,
     message=r'[\s\S]*See https\?://trac.sagemath.org/[0-9]* for details.')
```



---

archive/issue_comments_465157.json:
```json
{
    "body": "<a id='comment:2'></a>voila une branche\n\n---\nNew commits:",
    "created_at": "2020-10-14T18:48:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465157",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:2'></a>voila une branche

---
New commits:



---

archive/issue_comments_465158.json:
```json
{
    "body": "<a id='comment:3'></a>**urllib3** seems to be the main source of problems\n\nEDIT:\n\nbut this seems to comes from **urllib3** from inside **requests**\n\nupdating **requests** seem to fix a lot of them\n\nrequests should be upgraded in #31280\n\nEDIT:\n\nupdating **request** apparently fixes all doctests",
    "created_at": "2021-08-12T11:19:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465158",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>**urllib3** seems to be the main source of problems

EDIT:

but this seems to comes from **urllib3** from inside **requests**

updating **requests** seem to fix a lot of them

requests should be upgraded in #31280

EDIT:

updating **request** apparently fixes all doctests



---

archive/issue_comments_465159.json:
```json
{
    "body": "<a id='comment:4'></a>The update of requests (with unvendored urllib3) is now split out to #32372",
    "created_at": "2021-08-12T20:26:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465159",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:4'></a>The update of requests (with unvendored urllib3) is now split out to #32372



---

archive/issue_comments_465160.json:
```json
{
    "body": "<a id='comment:6'></a>Rebased on top of #32372\n\n---\nNew commits:",
    "created_at": "2021-08-12T20:28:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465160",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:6'></a>Rebased on top of #32372

---
New commits:



---

archive/issue_comments_465161.json:
```json
{
    "body": "<a id='comment:8'></a>Have you tracked down what versions of urllib3 / requests did the fix? We will need to put corresponding version lower bounds into `build/pkgs/urllib3/install-requires.txt` and `build/pkgs/requests/install-requires.txt`",
    "created_at": "2021-08-12T20:33:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465161",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Have you tracked down what versions of urllib3 / requests did the fix? We will need to put corresponding version lower bounds into `build/pkgs/urllib3/install-requires.txt` and `build/pkgs/requests/install-requires.txt`



---

archive/issue_comments_465162.json:
```json
{
    "body": "<a id='comment:9'></a>According to https://docs.python-requests.org/en/master/community/updates/#id11, `requests` 2.19.0 did \"Migrate to using collections.abc for 3.7 compatibility\"; 2.16.0 did the unvendoring of urllib3 etc. \n`requests` main branch sets the constraint urllib3>=1.21.1,<1.27 in  https://github.com/psf/requests/blob/main/setup.py; the lower bound has not changed since 2.16.0",
    "created_at": "2021-08-13T01:55:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465162",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>According to https://docs.python-requests.org/en/master/community/updates/#id11, `requests` 2.19.0 did "Migrate to using collections.abc for 3.7 compatibility"; 2.16.0 did the unvendoring of urllib3 etc. 
`requests` main branch sets the constraint urllib3>=1.21.1,<1.27 in  https://github.com/psf/requests/blob/main/setup.py; the lower bound has not changed since 2.16.0



---

archive/issue_comments_465163.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2021-08-13T04:30:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465163",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_465164.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -7,7 +7,7 @@\n We postponed doing that since some of our dependencies\n had not updated their imports yet.\n \n-See [#28012 - comment 23](https://trac.sagemath.org/ticket/28012#comment:23) for the discussion.\n+See ticket:28012#comment:23 for the discussion.\n \n Comment: 1\n \n```\n",
    "created_at": "2021-08-29T21:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465164",
    "user": "https://github.com/slel"
}
```

Description changed:
```diff
--- 
+++ 
@@ -7,7 +7,7 @@
 We postponed doing that since some of our dependencies
 had not updated their imports yet.
 
-See [#28012 - comment 23](https://trac.sagemath.org/ticket/28012#comment:23) for the discussion.
+See ticket:28012#comment:23 for the discussion.
 
 Comment: 1
 
```




---

archive/issue_comments_465165.json:
```json
{
    "body": "<a id='comment:11'></a>Is this ready for review?",
    "created_at": "2021-08-29T21:30:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465165",
    "user": "https://github.com/slel"
}
```

<a id='comment:11'></a>Is this ready for review?



---

archive/issue_comments_465166.json:
```json
{
    "body": "<a id='comment:12'></a>yes, but depending on #32372",
    "created_at": "2021-08-30T07:32:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465166",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:12'></a>yes, but depending on #32372



---

archive/issue_comments_465167.json:
```json
{
    "body": "<a id='comment:13'></a>now this should be ready to go",
    "created_at": "2021-09-14T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465167",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:13'></a>now this should be ready to go



---

archive/issue_comments_465168.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2021-09-14T11:42:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465168",
    "user": "https://github.com/fchapoton"
}
```

Changing status from new to needs_review.



---

archive/issue_events_080222.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-09-15T15:43:03Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30768#event-80222"
}
```



---

archive/issue_comments_465169.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-09-15T16:26:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465169",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_465170.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-09-19T09:59:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30768#issuecomment-465170",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_080223.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-09-19T09:59:10Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30768",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30768#event-80223"
}
```
