# Issue 30589: Upgrade Python to 3.9.1, pip to 20.3.3

archive/issues_030352.json:
```json
{
    "body": "This contains the upgrade to Python 3.9.1\n\nTo test, use \n\n```\n./configure --without-system-python3 --enable-download-from-upstream-url\n```\n\n\nCC:  @slel @jhpalmieri @fchapoton @dimpase @vbraun @kiwifb\n\nBranch/Commit: 41d7e7a74441e5f9deb3e7a93adfccf486dde417\n\nReviewer: John Palmieri, Samuel Leli\u00e8vre\n\nAuthor: Matthias Koeppe\n\nDependencies: #31050\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30589\n\n",
    "closed_at": "2021-01-24T10:38:12Z",
    "created_at": "2020-09-17T16:57:10Z",
    "labels": [
        "component: packages: standard",
        "critical"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "Upgrade Python to 3.9.1, pip to 20.3.3",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30589",
    "user": "https://github.com/mkoeppe"
}
```
This contains the upgrade to Python 3.9.1

To test, use 

```
./configure --without-system-python3 --enable-download-from-upstream-url
```


CC:  @slel @jhpalmieri @fchapoton @dimpase @vbraun @kiwifb

Branch/Commit: 41d7e7a74441e5f9deb3e7a93adfccf486dde417

Reviewer: John Palmieri, Samuel Lelièvre

Author: Matthias Koeppe

Dependencies: #31050

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30589





---

archive/issue_comments_461745.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,8 @@\n This contains the experimental upgrade to Python 3.9 for testing ticket #30184 (Support Python 3.9)\n \n It is not intended for merging.\n+\n+Necessary changes to the library should go on #30184 (Support Python 3.9)\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-09-17T17:19:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461745",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,8 @@
 This contains the experimental upgrade to Python 3.9 for testing ticket #30184 (Support Python 3.9)
 
 It is not intended for merging.
+
+Necessary changes to the library should go on #30184 (Support Python 3.9)
 
 Comment: 1
 
``````




---

archive/issue_comments_461746.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+This contains the experimental upgrade to Python 3.9 for testing ticket #30184 (Support Python 3.9)\n \n+It is not intended for merging.\n+\n+To test, use \n+\n+```\n+./configure --without-system-python3 --enable-download-from-upstream-url\n+```\n+\n+Necessary changes to the library should go on #30184 (Support Python 3.9)\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-09-17T17:41:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461746",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
+This contains the experimental upgrade to Python 3.9 for testing ticket #30184 (Support Python 3.9)
 
+It is not intended for merging.
+
+To test, use 
+
+```
+./configure --without-system-python3 --enable-download-from-upstream-url
+```
+
+Necessary changes to the library should go on #30184 (Support Python 3.9)
 
 Comment: 1
 
``````




---

archive/issue_comments_461747.json:
```json
{
    "body": "<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-17T22:29:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461747",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:5'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_461748.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-09-18T00:56:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461748",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_461749.json:
```json
{
    "body": "<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-09-24T18:47:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461749",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:7'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_461750.json:
```json
{
    "body": "<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:",
    "created_at": "2020-09-24T18:59:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461750",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>Branch pushed to git repo; I updated commit sha1. Last 10 new commits:



---

archive/issue_comments_461751.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-09-25T01:54:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461751",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_461752.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-10-06T00:02:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461752",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_461753.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,14 @@\n+This contains the upgrade to Python 3.9.0 for testing ticket #30184 (Support Python 3.9)\n \n+It is not intended for merging - we should stay on 3.8.5 for a while\n+\n+To test, use \n+\n+```\n+./configure --without-system-python3 --enable-download-from-upstream-url\n+```\n+\n+Necessary changes to the library should go on #30184 (Support Python 3.9)\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-10-06T00:08:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461753",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,14 @@
+This contains the upgrade to Python 3.9.0 for testing ticket #30184 (Support Python 3.9)
 
+It is not intended for merging - we should stay on 3.8.5 for a while
+
+To test, use 
+
+```
+./configure --without-system-python3 --enable-download-from-upstream-url
+```
+
+Necessary changes to the library should go on #30184 (Support Python 3.9)
 
 Comment: 1
 
``````




---

archive/issue_comments_461754.json:
```json
{
    "body": "<a id='comment:13'></a>3.9.1 is out https://www.python.org/downloads/release/python-391/\nRelease Date: Dec. 7, 2020\n\n\"3.9.1 is the first version of Python to support macOS 11 Big Sur. With Xcode 11 and later it is now possible to build \u201cUniversal 2\u201d binaries which work on Apple Silicon. We are providing such an installer as the macos11.0 variant. This installer can be deployed back to older versions, tested down to OS X 10.9. As we are waiting for an updated version of pip, please consider the macos11.0 installer experimental.\"",
    "created_at": "2020-12-15T17:20:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461754",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>3.9.1 is out https://www.python.org/downloads/release/python-391/
Release Date: Dec. 7, 2020

"3.9.1 is the first version of Python to support macOS 11 Big Sur. With Xcode 11 and later it is now possible to build “Universal 2” binaries which work on Apple Silicon. We are providing such an installer as the macos11.0 variant. This installer can be deployed back to older versions, tested down to OS X 10.9. As we are waiting for an updated version of pip, please consider the macos11.0 installer experimental."



---

archive/issue_comments_461755.json:
```json
{
    "body": "<a id='comment:14'></a>Not sure which updated version of pip they are referring to. 20.3 (2020-11-30) lists \"Add support for MacOS Big Sur compatibility tags. (#9138)\" https://pip.pypa.io/en/stable/news/#id15\n\nNo new news items regarding Big Sur in 20.3.3 (2020-12-15)",
    "created_at": "2020-12-15T17:22:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461755",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:14'></a>Not sure which updated version of pip they are referring to. 20.3 (2020-11-30) lists "Add support for MacOS Big Sur compatibility tags. (#9138)" https://pip.pypa.io/en/stable/news/#id15

No new news items regarding Big Sur in 20.3.3 (2020-12-15)



---

archive/issue_comments_461756.json:
```json
{
    "body": "<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-12-16T01:51:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461756",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:15'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_events_079547.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-16T01:55:48Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30589#event-79547"
}
```



---

archive/issue_comments_461757.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,3 +1,10 @@\n+This contains the upgrade to Python 3.9.1\n+\n+To test, use \n+\n+```\n+./configure --without-system-python3 --enable-download-from-upstream-url\n+```\n \n \n Comment: 1\n``````\n",
    "created_at": "2020-12-16T01:55:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461757",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,3 +1,10 @@
+This contains the upgrade to Python 3.9.1
+
+To test, use 
+
+```
+./configure --without-system-python3 --enable-download-from-upstream-url
+```
 
 
 Comment: 1
``````




---

archive/issue_comments_461758.json:
```json
{
    "body": "<a id='comment:17'></a>If this works (and I'll test it out soon), it should be a blocker, since I can't build Sage's Python 3.8 on Big Sur.",
    "created_at": "2020-12-16T06:07:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461758",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:17'></a>If this works (and I'll test it out soon), it should be a blocker, since I can't build Sage's Python 3.8 on Big Sur.



---

archive/issue_comments_461759.json:
```json
{
    "body": "<a id='comment:18'></a>This builds for me on Big Sur. With the old version of `wheel`, I (not surprisingly) hit the problem fixed by #31050. With an updated `wheel`, `gmpy2` still fails to build, with this error:\n\n```\nSuccessfully built gmpy2\nRemoved build tracker: '/private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-dw7p5f40'\nUsing pip 20.2.3 from /Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip (python 3.9)\nNon-user install because site-packages writeable\nIgnoring indexes: https://pypi.org/simple\nCreated temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-ephem-wheel-cache-nd6d05pj\nCreated temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4\nInitialized build tracking at /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4\nCreated build tracker: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4\nEntered build tracker: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4\nCreated temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-install-82a1edim\nERROR: gmpy2-2.1.0b5-cp39-cp39-macosx_10_9_x86_64.whl is not a supported wheel on this platform.\nException information:\nTraceback (most recent call last):\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/cli/base_command.py\", line 228, in _main\n    status = self.run(options, args)\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/cli/req_command.py\", line 182, in wrapper\n    return func(self, options, args)\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/commands/install.py\", line 323, in run\n    requirement_set = resolver.resolve(\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/resolution/legacy/resolver.py\", line 173, in resolve\n    requirement_set.add_requirement(req)\n  File \"/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/req/req_set.py\", line 104, in add_requirement\n    raise InstallationError(\npip._internal.exceptions.InstallationError: gmpy2-2.1.0b5-cp39-cp39-macosx_10_9_x86_64.whl is not a supported wheel on this platform.\nRemoved build tracker: '/private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4'\nError: installing with pip3 failed\n```\nLooks like a problem with MACOSX_DEPLOYMENT_TARGET.",
    "created_at": "2020-12-16T18:15:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461759",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:18'></a>This builds for me on Big Sur. With the old version of `wheel`, I (not surprisingly) hit the problem fixed by #31050. With an updated `wheel`, `gmpy2` still fails to build, with this error:

```
Successfully built gmpy2
Removed build tracker: '/private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-dw7p5f40'
Using pip 20.2.3 from /Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip (python 3.9)
Non-user install because site-packages writeable
Ignoring indexes: https://pypi.org/simple
Created temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-ephem-wheel-cache-nd6d05pj
Created temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4
Initialized build tracking at /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4
Created build tracker: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4
Entered build tracker: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4
Created temporary directory: /private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-install-82a1edim
ERROR: gmpy2-2.1.0b5-cp39-cp39-macosx_10_9_x86_64.whl is not a supported wheel on this platform.
Exception information:
Traceback (most recent call last):
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/cli/base_command.py", line 228, in _main
    status = self.run(options, args)
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/cli/req_command.py", line 182, in wrapper
    return func(self, options, args)
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/commands/install.py", line 323, in run
    requirement_set = resolver.resolve(
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/resolution/legacy/resolver.py", line 173, in resolve
    requirement_set.add_requirement(req)
  File "/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib/python3.9/site-packages/pip/_internal/req/req_set.py", line 104, in add_requirement
    raise InstallationError(
pip._internal.exceptions.InstallationError: gmpy2-2.1.0b5-cp39-cp39-macosx_10_9_x86_64.whl is not a supported wheel on this platform.
Removed build tracker: '/private/var/folders/z6/yjw_7s357yx3_mhh81__lplc0000gn/T/pip-req-tracker-d9f2exe4'
Error: installing with pip3 failed
```
Looks like a problem with MACOSX_DEPLOYMENT_TARGET.



---

archive/issue_comments_461760.json:
```json
{
    "body": "<a id='comment:19'></a>We should probably also update to latest `pip`",
    "created_at": "2020-12-16T19:11:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461760",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:19'></a>We should probably also update to latest `pip`



---

archive/issue_comments_461761.json:
```json
{
    "body": "<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-12-16T19:20:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461761",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:21'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_461762.json:
```json
{
    "body": "<a id='comment:23'></a>Great, with the new `pip` and new `wheel`, everything works until I hit `scipy`. The error is not one I remember seeing before:\n\n```\n  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib build/temp.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.12_1/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Lbuild/temp.macosx-10.9-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\n  ld: library not found for -lSystem\n  collect2: error: ld returned 1 exit status\n  error: Command \"/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib build/temp.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.12_1/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Lbuild/temp.macosx-10.9-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\" failed with exit status 1\n  Building wheel for scipy (PEP 517): finished with status 'error'\n  ERROR: Failed building wheel for scipy\n```\nI'm guessing that this should be dealt with separately.\n\nI would like to give this a positive review, but since I can't build Sage, I also can't build the documentation or run doctests. So for now I will have to leave the rest of the review to others.",
    "created_at": "2020-12-16T22:18:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461762",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:23'></a>Great, with the new `pip` and new `wheel`, everything works until I hit `scipy`. The error is not one I remember seeing before:

```
  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib build/temp.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.12_1/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Lbuild/temp.macosx-10.9-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so
  ld: library not found for -lSystem
  collect2: error: ld returned 1 exit status
  error: Command "/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib build/temp.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.12_1/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta3/local/lib -Lbuild/temp.macosx-10.9-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-10.9-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so" failed with exit status 1
  Building wheel for scipy (PEP 517): finished with status 'error'
  ERROR: Failed building wheel for scipy
```
I'm guessing that this should be dealt with separately.

I would like to give this a positive review, but since I can't build Sage, I also can't build the documentation or run doctests. So for now I will have to leave the rest of the review to others.



---

archive/issue_comments_461763.json:
```json
{
    "body": "<a id='comment:25'></a>We can also try to throw in an upgrade of `setuptools`...",
    "created_at": "2020-12-16T22:54:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461763",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:25'></a>We can also try to throw in an upgrade of `setuptools`...



---

archive/issue_comments_461764.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-12-17T17:18:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461764",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_461765.json:
```json
{
    "body": "<a id='comment:27'></a>Replying to [comment:17 jhpalmieri]:\n> If this works (and I'll test it out soon), it should be a blocker, since I can't build Sage's Python 3.8 on Big Sur.\n\nBut doesn't the python3 from XCode work?",
    "created_at": "2020-12-17T17:20:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461765",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>Replying to [comment:17 jhpalmieri]:
> If this works (and I'll test it out soon), it should be a blocker, since I can't build Sage's Python 3.8 on Big Sur.

But doesn't the python3 from XCode work?



---

archive/issue_comments_461766.json:
```json
{
    "body": "<a id='comment:28'></a>Right now homebrew's python3 is shadowing Xcode's, so I don't know. I would rather not uninstall homebrew's since it is used by other homebrew packages that I want to keep.\n\nI have bigger issues right now: I can make almost no progress building Sage with 9.3.beta4. For example, with #31050 merged with beta4, `gmpy2` fails to build:\n\n```\n  Compiling with an SDK that doesn't seem to exist: /Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk\n  Please check your Xcode installation\n  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/usr/local/include -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -O2 -g -I./src -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/include -I/usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c src/gmpy2.c -o build/temp.macosx-11-x86_64-3.9/src/gmpy2.o -DSHARED=1\n  clang: warning: no such sysroot directory: '/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk' [-Wmissing-sysroot]\n  In file included from src/gmpy2.c:445:\n  /usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9/Python.h:25:10: fatal error: 'stdio.h' file not found\n  #include <stdio.h>\n```\nIs my command-line tools installation broken? It is certainly true that the named `sysroot` directory does not exist, but instead it's `.../MacOSX11.1.sdk`. Where is that path stored? I've tried uninstalling and reinstalling the command-line tools, uninstalling and reinstalling homebrew and its packages, but no luck.\n\nIn contrast, with just #31050 (which was based on beta3), I see the following in the `gmpy2` log file:\n\n```\n  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/usr/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -I./src -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/include -I/usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c src/gmpy2.c -o build/temp.macosx-11-x86_64-3.9/src/gmpy2.o -DSHARED=1\n```\n(same wrong path given to `-I`) but `gmpy2` builds successfully.\n\nSeparately, on a machine running Catalina, I'm having problems with `cypari`...",
    "created_at": "2020-12-17T19:31:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461766",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:28'></a>Right now homebrew's python3 is shadowing Xcode's, so I don't know. I would rather not uninstall homebrew's since it is used by other homebrew packages that I want to keep.

I have bigger issues right now: I can make almost no progress building Sage with 9.3.beta4. For example, with #31050 merged with beta4, `gmpy2` fails to build:

```
  Compiling with an SDK that doesn't seem to exist: /Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk
  Please check your Xcode installation
  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/usr/local/include -isysroot /Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -O2 -g -I./src -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/include -I/usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c src/gmpy2.c -o build/temp.macosx-11-x86_64-3.9/src/gmpy2.o -DSHARED=1
  clang: warning: no such sysroot directory: '/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk' [-Wmissing-sysroot]
  In file included from src/gmpy2.c:445:
  /usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9/Python.h:25:10: fatal error: 'stdio.h' file not found
  #include <stdio.h>
```
Is my command-line tools installation broken? It is certainly true that the named `sysroot` directory does not exist, but instead it's `.../MacOSX11.1.sdk`. Where is that path stored? I've tried uninstalling and reinstalling the command-line tools, uninstalling and reinstalling homebrew and its packages, but no luck.

In contrast, with just #31050 (which was based on beta3), I see the following in the `gmpy2` log file:

```
  gcc -Wno-unused-result -Wsign-compare -Wunreachable-code -fno-common -dynamic -DNDEBUG -g -fwrapv -O3 -Wall -I/usr/local/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/usr/include -I/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk/System/Library/Frameworks/Tk.framework/Versions/8.5/Headers -I./src -I/usr/local/include -I/usr/local/opt/openssl@1.1/include -I/usr/local/opt/sqlite/include -I/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/include -I/usr/local/Cellar/python@3.9/3.9.1/Frameworks/Python.framework/Versions/3.9/include/python3.9 -c src/gmpy2.c -o build/temp.macosx-11-x86_64-3.9/src/gmpy2.o -DSHARED=1
```
(same wrong path given to `-I`) but `gmpy2` builds successfully.

Separately, on a machine running Catalina, I'm having problems with `cypari`...



---

archive/issue_comments_461767.json:
```json
{
    "body": "<a id='comment:29'></a>In a (working) Homebrew installation on Catalina, I don't have these `/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk` paths used by the tools - ie.\ngcc/clang  is installed in \n`InstalledDir: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin`\nand not in `/Library/...`.\n\nThis can be seen in config.log",
    "created_at": "2020-12-18T22:08:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461767",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:29'></a>In a (working) Homebrew installation on Catalina, I don't have these `/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk` paths used by the tools - ie.
gcc/clang  is installed in 
`InstalledDir: /Applications/Xcode-beta.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin`
and not in `/Library/...`.

This can be seen in config.log



---

archive/issue_comments_461768.json:
```json
{
    "body": "<a id='comment:30'></a>`config.log` is a good place to look. I see that `gfortran -v` prints that it is configured using `--with-sysroot=/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk`. I reinstalled homebrew's gcc but it didn't help. Any ideas how this is path determined? What does `gfortran -v` say for you?\n\n(For `gcc/clang`, I see `InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin`.)",
    "created_at": "2020-12-18T23:02:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461768",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:30'></a>`config.log` is a good place to look. I see that `gfortran -v` prints that it is configured using `--with-sysroot=/Library/Developer/CommandLineTools/SDKs/MacOSX11.0.sdk`. I reinstalled homebrew's gcc but it didn't help. Any ideas how this is path determined? What does `gfortran -v` say for you?

(For `gcc/clang`, I see `InstalledDir: /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin`.)



---

archive/issue_comments_461769.json:
```json
{
    "body": "<a id='comment:31'></a>Well, this is probably not the right thing to do in the long term, but I created a symlink connecting `MacOSX11.1.sdk` to `MacOSX11.0.sdk`. The build still fails on `scipy` with\n\n```\n  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\n  gfortran: warning: couldn't understand version 11\n  ld: library not found for -lgcc_s.10.4\n  collect2: error: ld returned 1 exit status\n  error: Command \"/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\" failed with exit status 1\n  Building wheel for scipy (PEP 517): finished with status 'error'\n  ERROR: Failed building wheel for scipy\n```\nbut the other problems seem to be solved.",
    "created_at": "2020-12-19T04:47:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461769",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:31'></a>Well, this is probably not the right thing to do in the long term, but I created a symlink connecting `MacOSX11.1.sdk` to `MacOSX11.0.sdk`. The build still fails on `scipy` with

```
  /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so
  gfortran: warning: couldn't understand version 11
  ld: library not found for -lgcc_s.10.4
  collect2: error: ld returned 1 exit status
  error: Command "/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so" failed with exit status 1
  Building wheel for scipy (PEP 517): finished with status 'error'
  ERROR: Failed building wheel for scipy
```
but the other problems seem to be solved.



---

archive/issue_comments_461770.json:
```json
{
    "body": "<a id='comment:32'></a>Replying to [comment:31 jhpalmieri]:\n> Well, this is probably not the right thing to do in the long term, but I created a symlink connecting `MacOSX11.1.sdk` to `MacOSX11.0.sdk`. The build still fails on `scipy` with\n> \n> ```\n>   /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\n>   gfortran: warning: couldn't understand version 11\n>   ld: library not found for -lgcc_s.10.4\n>   collect2: error: ld returned 1 exit status\n>   error: Command \"/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so\" failed with exit status 1\n>   Building wheel for scipy (PEP 517): finished with status 'error'\n>   ERROR: Failed building wheel for scipy\n> ```\n> but the other problems seem to be solved.\n\n\nscipy probably needs an update, and/or a hack:\nhttps://github.com/scipy/scipy/issues/13102#issuecomment-744473479",
    "created_at": "2020-12-21T09:51:39Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461770",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:32'></a>Replying to [comment:31 jhpalmieri]:
> Well, this is probably not the right thing to do in the long term, but I created a symlink connecting `MacOSX11.1.sdk` to `MacOSX11.0.sdk`. The build still fails on `scipy` with
> 
> ```
>   /usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so
>   gfortran: warning: couldn't understand version 11
>   ld: library not found for -lgcc_s.10.4
>   collect2: error: ld returned 1 exit status
>   error: Command "/usr/local/bin/gfortran -Wall -g -Wall -g -undefined dynamic_lookup -bundle -bundle -undefined dynamic_lookup -L/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib -Wl,-rpath,/Users/palmieri/Desktop/Sage/sage_builds/TESTING/TEMP/sage-9.3.beta4/local/lib build/temp.macosx-11-x86_64-3.9/scipy/integrate/_quadpackmodule.o -L/usr/local/Cellar/openblas/0.3.13/lib -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0 -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/Cellar/gcc/10.2.0/lib/gcc/10/gcc/x86_64-apple-darwin20/10.2.0/../../.. -L/usr/local/lib -L/usr/local/opt/openssl@1.1/lib -L/usr/local/opt/sqlite/lib -Lbuild/temp.macosx-11-x86_64-3.9 -lquadpack -lmach -lopenblas -lopenblas -lgfortran -o build/lib.macosx-11-x86_64-3.9/scipy/integrate/_quadpack.cpython-39-darwin.so" failed with exit status 1
>   Building wheel for scipy (PEP 517): finished with status 'error'
>   ERROR: Failed building wheel for scipy
> ```
> but the other problems seem to be solved.


scipy probably needs an update, and/or a hack:
https://github.com/scipy/scipy/issues/13102#issuecomment-744473479



---

archive/issue_comments_461771.json:
```json
{
    "body": "<a id='comment:33'></a>I'm not clever enough to figure out how to hack `scipy` so it builds. If I issue the command `export SYSTEM_VERSION_COMPAT=1` globally before building Sage, then `cython` doesn't build. If I just issue it in the `scipy` spkg-install script, then `scipy` doesn't build with the same error as in comment:31.\n\nEdit: the error with `cython` after executing `export SYSTEM_VERSION_COMPAT=1`:\n\n```\nERROR: Cython-0.29.21-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.\n```\nThis is with this ticket and an updated `setuptools` and `setuptools_scm`.",
    "created_at": "2020-12-22T04:03:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461771",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:33'></a>I'm not clever enough to figure out how to hack `scipy` so it builds. If I issue the command `export SYSTEM_VERSION_COMPAT=1` globally before building Sage, then `cython` doesn't build. If I just issue it in the `scipy` spkg-install script, then `scipy` doesn't build with the same error as in comment:31.

Edit: the error with `cython` after executing `export SYSTEM_VERSION_COMPAT=1`:

```
ERROR: Cython-0.29.21-cp39-cp39-macosx_11_0_x86_64.whl is not a supported wheel on this platform.
```
This is with this ticket and an updated `setuptools` and `setuptools_scm`.



---

archive/issue_comments_461772.json:
```json
{
    "body": "<a id='comment:34'></a>I guess we should move my derailment of the discussion to #30651.",
    "created_at": "2020-12-22T06:17:26Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461772",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:34'></a>I guess we should move my derailment of the discussion to #30651.



---

archive/issue_comments_461773.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-12-27T19:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461773",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_461774.json:
```json
{
    "body": "<a id='comment:35'></a>Does someone have time to review this ticket? The tests have already run successfully.\n\nNote that an update to latest 3.8.x is not a good alternative:\n\n  https://www.python.org/downloads/release/python-387/\n  Python 3.8.7 - Release Date: Dec. 21, 2020\n  macOS 11 Big Sur not fully supported\n\n  Python 3.8.7 is not yet fully supported on macOS 11 Big Sur. It will install on macOS 11 Big Sur and will run on Apple Silicon Macs using Rosetta 2 translation. However, a few features do not work correctly, most noticeably those involving searching for system libraries (vs user libraries) such as ctypes.util.find_library() and in Distutils. This limitation affects both Apple Silicon and Intel processors. We are looking into improving the situation for Python 3.8.8.",
    "created_at": "2020-12-27T19:45:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461774",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:35'></a>Does someone have time to review this ticket? The tests have already run successfully.

Note that an update to latest 3.8.x is not a good alternative:

  https://www.python.org/downloads/release/python-387/
  Python 3.8.7 - Release Date: Dec. 21, 2020
  macOS 11 Big Sur not fully supported

  Python 3.8.7 is not yet fully supported on macOS 11 Big Sur. It will install on macOS 11 Big Sur and will run on Apple Silicon Macs using Rosetta 2 translation. However, a few features do not work correctly, most noticeably those involving searching for system libraries (vs user libraries) such as ctypes.util.find_library() and in Distutils. This limitation affects both Apple Silicon and Intel processors. We are looking into improving the situation for Python 3.8.8.



---

archive/issue_comments_461775.json:
```json
{
    "body": "<a id='comment:38'></a>On macOS 10.14.6 with lots of Homebrew packages,\nsuccessfully ran\n\n```bash\n$ git trac checkout 30589\n$ source .homebrew-build-env\n$ ./bootstrap -q\n$ ./configure --without-system-python3 --enable-download-from-upstream-url -q\n$ make -s V=0\n```\nresulting in a build of Sage 9.3.beta4 based on Python 3.9.1.\n\nBut something that worked for another Sage install currently at 9.3.beta5:\n\n```bash\n$ V=0 sage -i pynormaliz\n```\nfailed here while attempting to build e-antic.",
    "created_at": "2021-01-03T10:15:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461775",
    "user": "https://github.com/slel"
}
```

<a id='comment:38'></a>On macOS 10.14.6 with lots of Homebrew packages,
successfully ran

```bash
$ git trac checkout 30589
$ source .homebrew-build-env
$ ./bootstrap -q
$ ./configure --without-system-python3 --enable-download-from-upstream-url -q
$ make -s V=0
```
resulting in a build of Sage 9.3.beta4 based on Python 3.9.1.

But something that worked for another Sage install currently at 9.3.beta5:

```bash
$ V=0 sage -i pynormaliz
```
failed here while attempting to build e-antic.



---

archive/issue_comments_461776.json:
```json
{
    "body": "<a id='comment:39'></a>On OS X Big Sur + various homebrew packages, if I use\n\n```\n% ./configure --with-system-python3=no --enable-download-from-upstream-url \n```\nthen Sage builds (if I also incorporate various other changes from #30651), but I get doctest failures of the form\n\n```\nFile \"src/sage/misc/sagedoc.py\", line 646, in sage.misc.sagedoc.format\nFailed example:\n    cython('\\n'.join(cython_code))\nExpected nothing\nGot:\n    ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (11.0) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (11.0) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (11.0) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libgsl.dylib) was built for newer macOS version (11.0) than being linked (10.9)\n    ld: warning: dylib (/usr/local/lib/libntl.dylib) was built for newer macOS version (11.0) than being linked (10.9)\n```\nWe could (a) not worry about these for now, (b) filter out these warnings, (c) tinker with `MACOSX_DEPLOYMENT_TARGET`, or (d) something else. I don't have an opinion about which way to go.",
    "created_at": "2021-01-06T03:05:49Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461776",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:39'></a>On OS X Big Sur + various homebrew packages, if I use

```
% ./configure --with-system-python3=no --enable-download-from-upstream-url 
```
then Sage builds (if I also incorporate various other changes from #30651), but I get doctest failures of the form

```
File "src/sage/misc/sagedoc.py", line 646, in sage.misc.sagedoc.format
Failed example:
    cython('\n'.join(cython_code))
Expected nothing
Got:
    ld: warning: dylib (/usr/local/lib/libmpfr.dylib) was built for newer macOS version (11.0) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libgmp.dylib) was built for newer macOS version (11.0) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libgmpxx.dylib) was built for newer macOS version (11.0) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libgsl.dylib) was built for newer macOS version (11.0) than being linked (10.9)
    ld: warning: dylib (/usr/local/lib/libntl.dylib) was built for newer macOS version (11.0) than being linked (10.9)
```
We could (a) not worry about these for now, (b) filter out these warnings, (c) tinker with `MACOSX_DEPLOYMENT_TARGET`, or (d) something else. I don't have an opinion about which way to go.



---

archive/issue_comments_461777.json:
```json
{
    "body": "<a id='comment:40'></a>These linker warnings are annoying and I think we should filter them out for the doctests. I think it should be a separate ticket. I think I have seen them on other platforms too.",
    "created_at": "2021-01-07T21:40:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461777",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:40'></a>These linker warnings are annoying and I think we should filter them out for the doctests. I think it should be a separate ticket. I think I have seen them on other platforms too.



---

archive/issue_comments_461778.json:
```json
{
    "body": "<a id='comment:41'></a>This is now #31204",
    "created_at": "2021-01-07T21:44:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461778",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>This is now #31204



---

archive/issue_comments_461779.json:
```json
{
    "body": "<a id='comment:42'></a>Replying to [comment:38 slelievre]:\n> But something that worked for another Sage install currently at 9.3.beta5:\n> \n> ```bash\n> $ V=0 sage -i pynormaliz\n> ```\n> failed here while attempting to build e-antic.\n\n\nIs this on homebrew too?",
    "created_at": "2021-01-07T21:44:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461779",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Replying to [comment:38 slelievre]:
> But something that worked for another Sage install currently at 9.3.beta5:
> 
> ```bash
> $ V=0 sage -i pynormaliz
> ```
> failed here while attempting to build e-antic.


Is this on homebrew too?



---

archive/issue_comments_461780.json:
```json
{
    "body": "<a id='comment:43'></a>In any case, let's worry about optional packages like e-antic later.\n\nLet's get this in please.",
    "created_at": "2021-01-11T03:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461780",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>In any case, let's worry about optional packages like e-antic later.

Let's get this in please.



---

archive/issue_comments_461781.json:
```json
{
    "body": "<a id='comment:44'></a>Sure, let's proceed.",
    "created_at": "2021-01-11T19:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461781",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:44'></a>Sure, let's proceed.



---

archive/issue_comments_461782.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2021-01-11T19:00:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461782",
    "user": "https://github.com/jhpalmieri"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_461783.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2021-01-24T10:38:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30589#issuecomment-461783",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_events_079548.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-24T10:38:12Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30589",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30589#event-79548"
}
```
