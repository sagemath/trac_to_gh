# Issue 30239: TensorField.__call__ alters zero

archive/issues_030002.json:
```json
{
    "body": "\n```\nsage: M = Manifold(3, 'M', start_index=1)\nsage: X.<x,y,z> = M.chart()\nsage: omega = M.diff_form(1, 'omega')\nsage: omega[:] = [0, 0, 0]\nsage: omega(X.frame()[1])\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\nsage: M.zero_scalar_field()\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n```\n\n\nCC:  @egourgoulhon @tscrim @mkoeppe\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Michael Jung\n\nBranch: u/gh-mjungmath/tensorfield___call___alters_zero\n\nStatus: needs_info\n\nDependencies: #30266, #30291\n\nCommit: 9f633512058835c3a37c353cbc6a735ac021e405\n\nIssue created by migration from https://trac.sagemath.org/ticket/30239\n\n",
    "created_at": "2020-07-28T13:46:07Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "TensorField.__call__ alters zero",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30239",
    "user": "https://github.com/mjungmath"
}
```

```
sage: M = Manifold(3, 'M', start_index=1)
sage: X.<x,y,z> = M.chart()
sage: omega = M.diff_form(1, 'omega')
sage: omega[:] = [0, 0, 0]
sage: omega(X.frame()[1])
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
sage: M.zero_scalar_field()
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
```


CC:  @egourgoulhon @tscrim @mkoeppe

Reviewer: Eric Gourgoulhon

Author: Michael Jung

Branch: u/gh-mjungmath/tensorfield___call___alters_zero

Status: needs_info

Dependencies: #30266, #30291

Commit: 9f633512058835c3a37c353cbc6a735ac021e405

Issue created by migration from https://trac.sagemath.org/ticket/30239





---

archive/issue_comments_594834.json:
```json
{
    "body": "Changing branch from \"\" to \"u/gh-mjungmath/tensorfield___call___alters_zero\"",
    "created_at": "2020-07-28T14:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594834",
    "user": "https://github.com/mjungmath"
}
```

Changing branch from "" to "u/gh-mjungmath/tensorfield___call___alters_zero"



---

archive/issue_comments_594835.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-28T14:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594835",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_594836.json:
```json
{
    "body": "<a id='comment:2'></a>\nNew commits:\n|                                                                                                                                          |                                           |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|\n|[51ba4e3](https://git.sagemath.org/sage.git/commit?id=51ba4e31bed6a7c1febd9fa270a1b56f929064af)|`Trac #30239: comp zero check for __call__`|",
    "created_at": "2020-07-28T14:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594836",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>
New commits:
|                                                                                                                                          |                                           |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------|
|[51ba4e3](https://git.sagemath.org/sage.git/commit?id=51ba4e31bed6a7c1febd9fa270a1b56f929064af)|`Trac #30239: comp zero check for __call__`|



---

archive/issue_comments_594837.json:
```json
{
    "body": "Changing commit from \"\" to \"51ba4e31bed6a7c1febd9fa270a1b56f929064af\"",
    "created_at": "2020-07-28T14:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594837",
    "user": "https://github.com/mjungmath"
}
```

Changing commit from "" to "51ba4e31bed6a7c1febd9fa270a1b56f929064af"



---

archive/issue_comments_594838.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Jung\"",
    "created_at": "2020-07-28T18:13:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594838",
    "user": "https://github.com/mkoeppe"
}
```

Changing author from "" to "Michael Jung"



---

archive/issue_comments_594839.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-28T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594839",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_594840.json:
```json
{
    "body": "Changing author from \"Michael Jung\" to \"\"",
    "created_at": "2020-07-28T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594840",
    "user": "https://github.com/egourgoulhon"
}
```

Changing author from "Michael Jung" to ""



---

archive/issue_comments_594841.json:
```json
{
    "body": "<a id='comment:4'></a>\nGood catch!\n\nHowever the proposed fix \n\n```\n            if omega == 0 or vv == 0:\n                return self.base_ring().zero()\n```\nis not acceptable, because the comparison with `0` can be very slow for complicated expressions. \nAlso, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\nFWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).",
    "created_at": "2020-07-28T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594841",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>
Good catch!

However the proposed fix 

```
            if omega == 0 or vv == 0:
                return self.base_ring().zero()
```
is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 
Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).



---

archive/issue_comments_594842.json:
```json
{
    "body": "Changing author from \"\" to \"Michael Jung\"",
    "created_at": "2020-07-28T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594842",
    "user": "https://github.com/egourgoulhon"
}
```

Changing author from "" to "Michael Jung"



---

archive/issue_comments_594843.json:
```json
{
    "body": "<a id='comment:5'></a>\nSorry the author name was deleted by mistake.",
    "created_at": "2020-07-28T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594843",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>
Sorry the author name was deleted by mistake.



---

archive/issue_comments_594844.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,7 @@\n sage: omega[:] = [0, 0, 0]\n sage: omega(X.frame()[1])\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n-M.zero_scalar_field()\n+sage: M.zero_scalar_field()\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n ```\n \n``````\n",
    "created_at": "2020-07-28T18:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594844",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,7 @@
 sage: omega[:] = [0, 0, 0]
 sage: omega(X.frame()[1])
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
-M.zero_scalar_field()
+sage: M.zero_scalar_field()
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
 ```
 
``````




---

archive/issue_comments_594845.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [egourgoulhon](#comment%3A4):\n> Good catch!\n> \n> However the proposed fix \n> \n> ```\n>             if omega == 0 or vv == 0:\n>                 return self.base_ring().zero()\n> ```\n> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. \n\n\nI was afraid that you say that. :D\nI haven't found a fast check for components. Is there any?\n\n> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n\n\nI suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.",
    "created_at": "2020-07-28T18:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594845",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>
Replying to [egourgoulhon](#comment%3A4):
> Good catch!
> 
> However the proposed fix 
> 
> ```
>             if omega == 0 or vv == 0:
>                 return self.base_ring().zero()
> ```
> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 


I was afraid that you say that. :D
I haven't found a fast check for components. Is there any?

> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 


I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.



---

archive/issue_comments_594846.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [gh-mjungmath](#comment%3A7):\n>\n> I was afraid that you say that. :D\n> I haven't found a fast check for components. Is there any?\n>\n\n\nNo, `is_trivial_zero` is not implemented there. \n\n> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n\n> \n> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.\n\n\nYou are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.",
    "created_at": "2020-07-30T18:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594846",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:8'></a>
Replying to [gh-mjungmath](#comment%3A7):
>
> I was afraid that you say that. :D
> I haven't found a fast check for components. Is there any?
>


No, `is_trivial_zero` is not implemented there. 

> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 

> 
> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.


You are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.



---

archive/issue_comments_594847.json:
```json
{
    "body": "Changing commit from \"51ba4e31bed6a7c1febd9fa270a1b56f929064af\" to \"78a50ebde64cfc196e0995427ec6574eebeeff70\"",
    "created_at": "2020-07-30T19:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594847",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "51ba4e31bed6a7c1febd9fa270a1b56f929064af" to "78a50ebde64cfc196e0995427ec6574eebeeff70"



---

archive/issue_comments_594848.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[78a50eb](https://git.sagemath.org/sage.git/commit/?id=78a50ebde64cfc196e0995427ec6574eebeeff70)|`Trac #30329: is zero check`|",
    "created_at": "2020-07-30T19:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594848",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[78a50eb](https://git.sagemath.org/sage.git/commit/?id=78a50ebde64cfc196e0995427ec6574eebeeff70)|`Trac #30329: is zero check`|



---

archive/issue_comments_594849.json:
```json
{
    "body": "<a id='comment:10'></a>\nWhat about this?",
    "created_at": "2020-07-30T19:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594849",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'></a>
What about this?



---

archive/issue_comments_594850.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-30T19:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594850",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_594851.json:
```json
{
    "body": "Changing commit from \"78a50ebde64cfc196e0995427ec6574eebeeff70\" to \"3344505b364c014baee19c2f4da41c8a7d2bd2f7\"",
    "created_at": "2020-07-30T19:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594851",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "78a50ebde64cfc196e0995427ec6574eebeeff70" to "3344505b364c014baee19c2f4da41c8a7d2bd2f7"



---

archive/issue_comments_594852.json:
```json
{
    "body": "<a id='comment:11'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                          |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|\n|[3344505](https://git.sagemath.org/sage.git/commit/?id=3344505b364c014baee19c2f4da41c8a7d2bd2f7)|`Trac #30239: one check for (0,1) tensors`|",
    "created_at": "2020-07-30T19:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594852",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                          |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------|
|[3344505](https://git.sagemath.org/sage.git/commit/?id=3344505b364c014baee19c2f4da41c8a7d2bd2f7)|`Trac #30239: one check for (0,1) tensors`|



---

archive/issue_comments_594853.json:
```json
{
    "body": "<a id='comment:12'></a>\nI think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution",
    "created_at": "2020-07-30T19:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594853",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>
I think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution



---

archive/issue_comments_594854.json:
```json
{
    "body": "Changing reviewer from \"\" to \"Eric Gourgoulhon\"",
    "created_at": "2020-07-30T21:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594854",
    "user": "https://github.com/egourgoulhon"
}
```

Changing reviewer from "" to "Eric Gourgoulhon"



---

archive/issue_comments_594855.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...",
    "created_at": "2020-07-30T21:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594855",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:13'></a>
Thanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...



---

archive/issue_comments_594856.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-31T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594856",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_594857.json:
```json
{
    "body": "<a id='comment:14'></a>\nThere is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.",
    "created_at": "2020-07-31T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594857",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>
There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.



---

archive/issue_comments_594858.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#30261\"",
    "created_at": "2020-08-01T11:13:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594858",
    "user": "https://github.com/mjungmath"
}
```

Changing dependencies from "" to "#30261"



---

archive/issue_comments_594859.json:
```json
{
    "body": "<a id='comment:16'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|\n|[286d3c6](https://git.sagemath.org/sage.git/commit/?id=286d3c604d0fe9aa2f78b5c09773c4af3bb3369b)|`FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability`|\n|[9df3d22](https://git.sagemath.org/sage.git/commit/?id=9df3d22ca84da6b604226d5b88d2a581b0cc53ca)|`sage.tensor.modules: Make all zero() and one() elements immutable`|\n|[4373ea2](https://git.sagemath.org/sage.git/commit/?id=4373ea269d9d426163fa3d1e72bdf6e20c412f87)|`FreeModuleTensor: Replace special casing of the immutable zero by is_immutable`|\n|[a2ee8be](https://git.sagemath.org/sage.git/commit/?id=a2ee8beb504477a3215e002391e44a51b2957ca2)|`ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef`|\n|[aebaded](https://git.sagemath.org/sage.git/commit/?id=aebadedd85d782e004a626f207df5422fee5a9ab)|`Trac #30266: make scalarfields immutable`|\n|[504e84e](https://git.sagemath.org/sage.git/commit/?id=504e84ed8bef36401ad97dff920ba4874001e666)|`Trac #30239: Merge branch 't/30266/immutability_for_scalar_fields' into t/30239/tensorfield___call___alters_zero`|\n|[d58d291](https://git.sagemath.org/sage.git/commit/?id=d58d291b8bad3a28aae9be2c426f0aa47370f745)|`Trac #30266: hash function condition + treatment of restrictions`|",
    "created_at": "2020-08-01T14:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------|
|[286d3c6](https://git.sagemath.org/sage.git/commit/?id=286d3c604d0fe9aa2f78b5c09773c4af3bb3369b)|`FreeModuleTensor, Vector: Subclass a new class ModuleElementWithMutability`|
|[9df3d22](https://git.sagemath.org/sage.git/commit/?id=9df3d22ca84da6b604226d5b88d2a581b0cc53ca)|`sage.tensor.modules: Make all zero() and one() elements immutable`|
|[4373ea2](https://git.sagemath.org/sage.git/commit/?id=4373ea269d9d426163fa3d1e72bdf6e20c412f87)|`FreeModuleTensor: Replace special casing of the immutable zero by is_immutable`|
|[a2ee8be](https://git.sagemath.org/sage.git/commit/?id=a2ee8beb504477a3215e002391e44a51b2957ca2)|`ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef`|
|[aebaded](https://git.sagemath.org/sage.git/commit/?id=aebadedd85d782e004a626f207df5422fee5a9ab)|`Trac #30266: make scalarfields immutable`|
|[504e84e](https://git.sagemath.org/sage.git/commit/?id=504e84ed8bef36401ad97dff920ba4874001e666)|`Trac #30239: Merge branch 't/30266/immutability_for_scalar_fields' into t/30239/tensorfield___call___alters_zero`|
|[d58d291](https://git.sagemath.org/sage.git/commit/?id=d58d291b8bad3a28aae9be2c426f0aa47370f745)|`Trac #30266: hash function condition + treatment of restrictions`|



---

archive/issue_comments_594860.json:
```json
{
    "body": "Changing commit from \"3344505b364c014baee19c2f4da41c8a7d2bd2f7\" to \"d58d291b8bad3a28aae9be2c426f0aa47370f745\"",
    "created_at": "2020-08-01T14:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "3344505b364c014baee19c2f4da41c8a7d2bd2f7" to "d58d291b8bad3a28aae9be2c426f0aa47370f745"



---

archive/issue_comments_594861.json:
```json
{
    "body": "Changing commit from \"d58d291b8bad3a28aae9be2c426f0aa47370f745\" to \"061b89fc7ced8730d2cd33a13065189872a78ff7\"",
    "created_at": "2020-08-01T14:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594861",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "d58d291b8bad3a28aae9be2c426f0aa47370f745" to "061b89fc7ced8730d2cd33a13065189872a78ff7"



---

archive/issue_comments_594862.json:
```json
{
    "body": "<a id='comment:17'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                        |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|\n|[061b89f](https://git.sagemath.org/sage.git/commit/?id=061b89fc7ced8730d2cd33a13065189872a78ff7)|`Trac #30266: minor doctest improvement`|",
    "created_at": "2020-08-01T14:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594862",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                        |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------|
|[061b89f](https://git.sagemath.org/sage.git/commit/?id=061b89fc7ced8730d2cd33a13065189872a78ff7)|`Trac #30266: minor doctest improvement`|



---

archive/issue_comments_594863.json:
```json
{
    "body": "Changing commit from \"061b89fc7ced8730d2cd33a13065189872a78ff7\" to \"0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d\"",
    "created_at": "2020-08-01T23:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594863",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "061b89fc7ced8730d2cd33a13065189872a78ff7" to "0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d"



---

archive/issue_comments_594864.json:
```json
{
    "body": "<a id='comment:18'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|\n|[5c7fd6e](https://git.sagemath.org/sage.git/commit/?id=5c7fd6e1933dd09daab91eda15df09572148413b)|`Trac #30266: immutability of restrictions + hash function improved`|\n|[7ba0865](https://git.sagemath.org/sage.git/commit/?id=7ba0865c69cd0ab466d8fe1aca1983c0006fc42b)|`Trac #30266: merge`|\n|[0ec99d4](https://git.sagemath.org/sage.git/commit/?id=0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)|`Trac #30266: check by name`|",
    "created_at": "2020-08-01T23:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594864",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------|
|[5c7fd6e](https://git.sagemath.org/sage.git/commit/?id=5c7fd6e1933dd09daab91eda15df09572148413b)|`Trac #30266: immutability of restrictions + hash function improved`|
|[7ba0865](https://git.sagemath.org/sage.git/commit/?id=7ba0865c69cd0ab466d8fe1aca1983c0006fc42b)|`Trac #30266: merge`|
|[0ec99d4](https://git.sagemath.org/sage.git/commit/?id=0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d)|`Trac #30266: check by name`|



---

archive/issue_comments_594865.json:
```json
{
    "body": "Changing commit from \"0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d\" to \"43ec4976081482b1ce467f0ca83e0c73192039f4\"",
    "created_at": "2020-08-01T23:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594865",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "0ec99d4f357c0eb89ad6e1b12a44810b2ecc764d" to "43ec4976081482b1ce467f0ca83e0c73192039f4"



---

archive/issue_comments_594866.json:
```json
{
    "body": "<a id='comment:19'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|\n|[87fb411](https://git.sagemath.org/sage.git/commit/?id=87fb4114bbd0e49215328035098fee5716b95b59)|`Trac #30266: ValueError replaced by AssertionError`|\n|[43ec497](https://git.sagemath.org/sage.git/commit/?id=43ec4976081482b1ce467f0ca83e0c73192039f4)|`Trac #30239: referenced before assignment error fixed`|",
    "created_at": "2020-08-01T23:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594866",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------|
|[87fb411](https://git.sagemath.org/sage.git/commit/?id=87fb4114bbd0e49215328035098fee5716b95b59)|`Trac #30266: ValueError replaced by AssertionError`|
|[43ec497](https://git.sagemath.org/sage.git/commit/?id=43ec4976081482b1ce467f0ca83e0c73192039f4)|`Trac #30239: referenced before assignment error fixed`|



---

archive/issue_comments_594867.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-01T23:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594867",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_594868.json:
```json
{
    "body": "Changing dependencies from \"#30261\" to \"#30266\"",
    "created_at": "2020-08-01T23:28:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594868",
    "user": "https://github.com/mjungmath"
}
```

Changing dependencies from "#30261" to "#30266"



---

archive/issue_comments_594869.json:
```json
{
    "body": "<a id='comment:22'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|\n|[a9cb6b3](https://git.sagemath.org/sage.git/commit/?id=a9cb6b3697e6852fb6d4924e273419bded123a9d)|`Trac #30239: doctest fixed`|",
    "created_at": "2020-08-02T09:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594869",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------|
|[a9cb6b3](https://git.sagemath.org/sage.git/commit/?id=a9cb6b3697e6852fb6d4924e273419bded123a9d)|`Trac #30239: doctest fixed`|



---

archive/issue_comments_594870.json:
```json
{
    "body": "Changing commit from \"43ec4976081482b1ce467f0ca83e0c73192039f4\" to \"a9cb6b3697e6852fb6d4924e273419bded123a9d\"",
    "created_at": "2020-08-02T09:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594870",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "43ec4976081482b1ce467f0ca83e0c73192039f4" to "a9cb6b3697e6852fb6d4924e273419bded123a9d"



---

archive/issue_comments_594871.json:
```json
{
    "body": "<a id='comment:23'></a>\nReplying to [egourgoulhon](#comment%3A14):\n> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. \n\n\nBoth have been fixed. Wait for green bot.",
    "created_at": "2020-08-02T09:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594871",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:23'></a>
Replying to [egourgoulhon](#comment%3A14):
> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. 


Both have been fixed. Wait for green bot.



---

archive/issue_comments_594872.json:
```json
{
    "body": "Changing commit from \"a9cb6b3697e6852fb6d4924e273419bded123a9d\" to \"731043f54230845c930a4fae1e3241ead02ce641\"",
    "created_at": "2020-08-02T09:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594872",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "a9cb6b3697e6852fb6d4924e273419bded123a9d" to "731043f54230845c930a4fae1e3241ead02ce641"



---

archive/issue_comments_594873.json:
```json
{
    "body": "<a id='comment:24'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                            |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|\n|[731043f](https://git.sagemath.org/sage.git/commit/?id=731043f54230845c930a4fae1e3241ead02ce641)|`Trac #30239: check by name for general tensor field action`|",
    "created_at": "2020-08-02T09:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594873",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------|
|[731043f](https://git.sagemath.org/sage.git/commit/?id=731043f54230845c930a4fae1e3241ead02ce641)|`Trac #30239: check by name for general tensor field action`|



---

archive/issue_comments_594874.json:
```json
{
    "body": "<a id='comment:25'></a>\nLGTM. Waiting for a positive review of the dependency (#30266).",
    "created_at": "2020-08-03T08:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594874",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:25'></a>
LGTM. Waiting for a positive review of the dependency (#30266).



---

archive/issue_comments_594875.json:
```json
{
    "body": "Changing commit from \"731043f54230845c930a4fae1e3241ead02ce641\" to \"18480912b7409ca8a0584eccd7ed2ba44c826adc\"",
    "created_at": "2020-08-03T22:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594875",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "731043f54230845c930a4fae1e3241ead02ce641" to "18480912b7409ca8a0584eccd7ed2ba44c826adc"



---

archive/issue_comments_594876.json:
```json
{
    "body": "<a id='comment:26'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|\n|[1848091](https://git.sagemath.org/sage.git/commit/?id=18480912b7409ca8a0584eccd7ed2ba44c826adc)|`Trac #30239: try-finally instead of try-except`|",
    "created_at": "2020-08-03T22:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594876",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------|
|[1848091](https://git.sagemath.org/sage.git/commit/?id=18480912b7409ca8a0584eccd7ed2ba44c826adc)|`Trac #30239: try-finally instead of try-except`|



---

archive/issue_comments_594877.json:
```json
{
    "body": "<a id='comment:27'></a>\nWhat about `try...finally` instead of `try...except`? I think this should be even faster, right?",
    "created_at": "2020-08-03T23:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594877",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:27'></a>
What about `try...finally` instead of `try...except`? I think this should be even faster, right?



---

archive/issue_comments_594878.json:
```json
{
    "body": "<a id='comment:28'></a>\nI doubt it. Plus it makes the code a little harder to understand IMO.",
    "created_at": "2020-08-03T23:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594878",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>
I doubt it. Plus it makes the code a little harder to understand IMO.



---

archive/issue_comments_594879.json:
```json
{
    "body": "<a id='comment:29'></a>\nYou're right, there is no difference. And I agree with you regarding the readability. I'll change it back.",
    "created_at": "2020-08-04T00:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594879",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:29'></a>
You're right, there is no difference. And I agree with you regarding the readability. I'll change it back.



---

archive/issue_comments_594880.json:
```json
{
    "body": "<a id='comment:30'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                         |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|\n|[4756bc3](https://git.sagemath.org/sage.git/commit/?id=4756bc31feaec758d7a1fe50d2b5edc28a71202a)|`Revert \"Trac #30239: try-finally instead of try-except\"`|",
    "created_at": "2020-08-04T00:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594880",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                         |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------|
|[4756bc3](https://git.sagemath.org/sage.git/commit/?id=4756bc31feaec758d7a1fe50d2b5edc28a71202a)|`Revert "Trac #30239: try-finally instead of try-except"`|



---

archive/issue_comments_594881.json:
```json
{
    "body": "Changing commit from \"18480912b7409ca8a0584eccd7ed2ba44c826adc\" to \"4756bc31feaec758d7a1fe50d2b5edc28a71202a\"",
    "created_at": "2020-08-04T00:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594881",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "18480912b7409ca8a0584eccd7ed2ba44c826adc" to "4756bc31feaec758d7a1fe50d2b5edc28a71202a"



---

archive/issue_comments_594882.json:
```json
{
    "body": "<a id='comment:31'></a>\nThere we go.",
    "created_at": "2020-08-04T00:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594882",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:31'></a>
There we go.



---

archive/issue_comments_594883.json:
```json
{
    "body": "<a id='comment:32'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                      |\n|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|\n|[abda8ec](https://git.sagemath.org/sage.git/commit/?id=abda8ec2450d2565d0355b15ab968cf78eb36b9a)|`Merge branch 'develop' into t/30239/tensorfield___call___alters_zero`|\n|[0638207](https://git.sagemath.org/sage.git/commit/?id=06382070ef75723a2643da5968c86bb5e271806d)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|",
    "created_at": "2020-08-05T12:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594883",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                      |
|-------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------|
|[abda8ec](https://git.sagemath.org/sage.git/commit/?id=abda8ec2450d2565d0355b15ab968cf78eb36b9a)|`Merge branch 'develop' into t/30239/tensorfield___call___alters_zero`|
|[0638207](https://git.sagemath.org/sage.git/commit/?id=06382070ef75723a2643da5968c86bb5e271806d)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|



---

archive/issue_comments_594884.json:
```json
{
    "body": "Changing commit from \"4756bc31feaec758d7a1fe50d2b5edc28a71202a\" to \"06382070ef75723a2643da5968c86bb5e271806d\"",
    "created_at": "2020-08-05T12:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594884",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "4756bc31feaec758d7a1fe50d2b5edc28a71202a" to "06382070ef75723a2643da5968c86bb5e271806d"



---

archive/issue_comments_594885.json:
```json
{
    "body": "Changing dependencies from \"#30266\" to \"#30266, #30291\"",
    "created_at": "2020-08-05T12:23:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594885",
    "user": "https://github.com/mjungmath"
}
```

Changing dependencies from "#30266" to "#30266, #30291"



---

archive/issue_comments_594886.json:
```json
{
    "body": "<a id='comment:34'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                                                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|\n|[2446f7e](https://git.sagemath.org/sage.git/commit/?id=2446f7ecf68fe4034c8f92f6248cd877b2efe6f3)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|\n|[4bd82e4](https://git.sagemath.org/sage.git/commit/?id=4bd82e47382226353261431b505dc3c557e13c47)|`Trac #30291: patchbot doctest fixed`|\n|[b2ba1e8](https://git.sagemath.org/sage.git/commit/?id=b2ba1e8f7caa423a0af58e1e73af8e424701eb5a)|`Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero`|\n|[5c14b39](https://git.sagemath.org/sage.git/commit/?id=5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)|`Trac #30239: doctest adapted`|",
    "created_at": "2020-08-05T16:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594886",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                                                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------|
|[2446f7e](https://git.sagemath.org/sage.git/commit/?id=2446f7ecf68fe4034c8f92f6248cd877b2efe6f3)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|
|[4bd82e4](https://git.sagemath.org/sage.git/commit/?id=4bd82e47382226353261431b505dc3c557e13c47)|`Trac #30291: patchbot doctest fixed`|
|[b2ba1e8](https://git.sagemath.org/sage.git/commit/?id=b2ba1e8f7caa423a0af58e1e73af8e424701eb5a)|`Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero`|
|[5c14b39](https://git.sagemath.org/sage.git/commit/?id=5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e)|`Trac #30239: doctest adapted`|



---

archive/issue_comments_594887.json:
```json
{
    "body": "Changing commit from \"06382070ef75723a2643da5968c86bb5e271806d\" to \"5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e\"",
    "created_at": "2020-08-05T16:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594887",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "06382070ef75723a2643da5968c86bb5e271806d" to "5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e"



---

archive/issue_comments_594888.json:
```json
{
    "body": "<a id='comment:35'></a>\nBranch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:\n|                                                                                                                                           |                                                                           |\n|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|\n|[2416d87](https://git.sagemath.org/sage.git/commit/?id=2416d871c6980f4503f8fef8b9a088d2dbc0f2d4)|`ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef`|\n|[4f07938](https://git.sagemath.org/sage.git/commit/?id=4f079381070e497259564eba16d8887c8dc85efe)|`Trac #30266: make scalarfields immutable`|\n|[3faa75a](https://git.sagemath.org/sage.git/commit/?id=3faa75a183dd6e6ff81d8aab176d7783aeaf867e)|`Trac #30266: hash function condition + treatment of restrictions`|\n|[f812586](https://git.sagemath.org/sage.git/commit/?id=f812586e8b14181f84ce361c1eba8b8410417b17)|`Trac #30266: minor doctest improvement`|\n|[02726e2](https://git.sagemath.org/sage.git/commit/?id=02726e2524ca81b800ba9a0a5a05e9c399d2e942)|`Trac #30266: check by name`|\n|[81e67cf](https://git.sagemath.org/sage.git/commit/?id=81e67cff20e7869abfe8aa3492b5ec8cbc399f85)|`Trac #30266: ValueError replaced by AssertionError`|\n|[cf4fce5](https://git.sagemath.org/sage.git/commit/?id=cf4fce56feed7c77064a1d6d9ddf20a28a927a2f)|`Trac #30239: use try-except block for immutable elements`|\n|[4f3b69f](https://git.sagemath.org/sage.git/commit/?id=4f3b69f6159dbdc127070fce043a3428e09326c0)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|\n|[9d8720d](https://git.sagemath.org/sage.git/commit/?id=9d8720d24a1a42bee0610f45b6241747fed2d4db)|`Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero`|\n|[9f63351](https://git.sagemath.org/sage.git/commit/?id=9f633512058835c3a37c353cbc6a735ac021e405)|`Trac #30239: doctest outputs adapted`|",
    "created_at": "2020-08-05T22:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594888",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>
Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:
|                                                                                                                                           |                                                                           |
|-------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------|
|[2416d87](https://git.sagemath.org/sage.git/commit/?id=2416d871c6980f4503f8fef8b9a088d2dbc0f2d4)|`ModuleElementWithMutability.is_immutable, is_mutable: Change def to cpdef`|
|[4f07938](https://git.sagemath.org/sage.git/commit/?id=4f079381070e497259564eba16d8887c8dc85efe)|`Trac #30266: make scalarfields immutable`|
|[3faa75a](https://git.sagemath.org/sage.git/commit/?id=3faa75a183dd6e6ff81d8aab176d7783aeaf867e)|`Trac #30266: hash function condition + treatment of restrictions`|
|[f812586](https://git.sagemath.org/sage.git/commit/?id=f812586e8b14181f84ce361c1eba8b8410417b17)|`Trac #30266: minor doctest improvement`|
|[02726e2](https://git.sagemath.org/sage.git/commit/?id=02726e2524ca81b800ba9a0a5a05e9c399d2e942)|`Trac #30266: check by name`|
|[81e67cf](https://git.sagemath.org/sage.git/commit/?id=81e67cff20e7869abfe8aa3492b5ec8cbc399f85)|`Trac #30266: ValueError replaced by AssertionError`|
|[cf4fce5](https://git.sagemath.org/sage.git/commit/?id=cf4fce56feed7c77064a1d6d9ddf20a28a927a2f)|`Trac #30239: use try-except block for immutable elements`|
|[4f3b69f](https://git.sagemath.org/sage.git/commit/?id=4f3b69f6159dbdc127070fce043a3428e09326c0)|`Trac 30291: simple checks for trivial cases in _mul_, _add_ and _div_`|
|[9d8720d](https://git.sagemath.org/sage.git/commit/?id=9d8720d24a1a42bee0610f45b6241747fed2d4db)|`Merge branch 't/30291/scalar_field_arithmetics__trivial_cases' into t/30239/tensorfield___call___alters_zero`|
|[9f63351](https://git.sagemath.org/sage.git/commit/?id=9f633512058835c3a37c353cbc6a735ac021e405)|`Trac #30239: doctest outputs adapted`|



---

archive/issue_comments_594889.json:
```json
{
    "body": "Changing commit from \"5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e\" to \"9f633512058835c3a37c353cbc6a735ac021e405\"",
    "created_at": "2020-08-05T22:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594889",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "5c14b3928c13e5cf62f0ab13ebc3b3580fe2b14e" to "9f633512058835c3a37c353cbc6a735ac021e405"



---

archive/issue_comments_594890.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-08-05T22:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594890",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_594891.json:
```json
{
    "body": "<a id='comment:36'></a>\nChanging the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.\n\nIf I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.\n\nSo, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.\n\nIf we decide for the \"return-copy-behavior\", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.",
    "created_at": "2020-08-05T22:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594891",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:36'></a>
Changing the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.

If I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.

So, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.

If we decide for the "return-copy-behavior", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.



---

archive/issue_comments_594892.json:
```json
{
    "body": "<a id='comment:37'></a>\nFWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.",
    "created_at": "2020-08-05T23:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594892",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>
FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.



---

archive/issue_comments_594893.json:
```json
{
    "body": "<a id='comment:38'></a>\nReplying to [mkoeppe](#comment%3A37):\n> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.\n\n\nThat's good to know. Thanks. Do you also have an opinion which behavior is more suitable?",
    "created_at": "2020-08-06T07:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594893",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:38'></a>
Replying to [mkoeppe](#comment%3A37):
> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.


That's good to know. Thanks. Do you also have an opinion which behavior is more suitable?



---

archive/issue_comments_594894.json:
```json
{
    "body": "<a id='comment:39'></a>\nI've opened another ticket #30302 for this discussion.",
    "created_at": "2020-08-06T10:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594894",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:39'></a>
I've opened another ticket #30302 for this discussion.



---

archive/issue_events_078164.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78164"
}
```



---

archive/issue_comments_594895.json:
```json
{
    "body": "<a id='comment:41'></a>\nMoving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594895",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>
Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_events_078165.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78165"
}
```



---

archive/issue_events_078166.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78166"
}
```



---

archive/issue_comments_594896.json:
```json
{
    "body": "<a id='comment:42'></a>\nSetting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594896",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>
Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_078167.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78167"
}
```



---

archive/issue_events_078168.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78168"
}
```



---

archive/issue_events_078169.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78169"
}
```



---

archive/issue_events_078170.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78170"
}
```



---

archive/issue_comments_594897.json:
```json
{
    "body": "<a id='comment:43'></a>\nStalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-594897",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>
Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_078171.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78171"
}
```



---

archive/issue_events_078172.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78172"
}
```



---

archive/issue_events_078173.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78173"
}
```



---

archive/issue_events_078174.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78174"
}
```
