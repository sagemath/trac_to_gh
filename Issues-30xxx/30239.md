# Issue 30239: TensorField.__call__ alters zero

archive/issues_030002.json:
```json
{
    "body": "```\nsage: M = Manifold(3, 'M', start_index=1)\nsage: X.<x,y,z> = M.chart()\nsage: omega = M.diff_form(1, 'omega')\nsage: omega[:] = [0, 0, 0]\nsage: omega(X.frame()[1])\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\nsage: M.zero_scalar_field()\nScalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n```\n\n\nCC:  @egourgoulhon @tscrim @mkoeppe\n\nReviewer: Eric Gourgoulhon\n\nAuthor: Michael Jung\n\nBranch: u/gh-mjungmath/tensorfield___call___alters_zero\n\nStatus: needs_info\n\nDependencies: #30266, #30291\n\nCommit: 9f633512058835c3a37c353cbc6a735ac021e405\n\nIssue created by migration from https://trac.sagemath.org/ticket/30239\n\n",
    "created_at": "2020-07-28T13:46:07Z",
    "labels": [
        "component: manifolds",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "TensorField.__call__ alters zero",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30239",
    "user": "https://github.com/mjungmath"
}
```
```
sage: M = Manifold(3, 'M', start_index=1)
sage: X.<x,y,z> = M.chart()
sage: omega = M.diff_form(1, 'omega')
sage: omega[:] = [0, 0, 0]
sage: omega(X.frame()[1])
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
sage: M.zero_scalar_field()
Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
```


CC:  @egourgoulhon @tscrim @mkoeppe

Reviewer: Eric Gourgoulhon

Author: Michael Jung

Branch: u/gh-mjungmath/tensorfield___call___alters_zero

Status: needs_info

Dependencies: #30266, #30291

Commit: 9f633512058835c3a37c353cbc6a735ac021e405

Issue created by migration from https://trac.sagemath.org/ticket/30239





---

archive/issue_comments_454579.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-28T14:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454579",
    "user": "https://github.com/mjungmath"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_454580.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-07-28T14:37:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454580",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_454581.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-28T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454581",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454582.json:
```json
{
    "body": "<a id='comment:4'></a>Good catch!\n\nHowever the proposed fix \n\n```\n            if omega == 0 or vv == 0:\n                return self.base_ring().zero()\n```\nis not acceptable, because the comparison with `0` can be very slow for complicated expressions. \nAlso, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\nFWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).",
    "created_at": "2020-07-28T18:14:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454582",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:4'></a>Good catch!

However the proposed fix 

```
            if omega == 0 or vv == 0:
                return self.base_ring().zero()
```
is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 
Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage).



---

archive/issue_comments_454583.json:
```json
{
    "body": "<a id='comment:5'></a>Sorry the author name was deleted by mistake.",
    "created_at": "2020-07-28T18:15:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454583",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:5'></a>Sorry the author name was deleted by mistake.



---

archive/issue_comments_454584.json:
```json
{
    "body": "Description changed:\n```diff\n--- \n+++ \n@@ -5,9 +5,10 @@\n sage: omega[:] = [0, 0, 0]\n sage: omega(X.frame()[1])\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n-M.zero_scalar_field()\n+sage: M.zero_scalar_field()\n Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M\n \\`\\`\\`\n+\n \n Comment: 1\n \n```\n",
    "created_at": "2020-07-28T18:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454584",
    "user": "https://github.com/egourgoulhon"
}
```

Description changed:
```diff
--- 
+++ 
@@ -5,9 +5,10 @@
 sage: omega[:] = [0, 0, 0]
 sage: omega(X.frame()[1])
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
-M.zero_scalar_field()
+sage: M.zero_scalar_field()
 Scalar field omega(d/dx) on the 3-dimensional differentiable manifold M
 \`\`\`
+
 
 Comment: 1
 
```




---

archive/issue_comments_454585.json:
```json
{
    "body": "<a id='comment:7'></a>Replying to [comment:4 egourgoulhon]:\n> Good catch!\n> \n> However the proposed fix \n> \n> ```\n>             if omega == 0 or vv == 0:\n>                 return self.base_ring().zero()\n> ```\n> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. \n\n\nI was afraid that you say that. :D\nI haven't found a fast check for components. Is there any?\n\n> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n\n\nI suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.",
    "created_at": "2020-07-28T18:30:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454585",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>Replying to [comment:4 egourgoulhon]:
> Good catch!
> 
> However the proposed fix 
> 
> ```
>             if omega == 0 or vv == 0:
>                 return self.base_ring().zero()
> ```
> is not acceptable, because the comparison with `0` can be very slow for complicated expressions. 


I was afraid that you say that. :D
I haven't found a fast check for components. Is there any?

> Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 


I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.



---

archive/issue_comments_454586.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 gh-mjungmath]:\n>\n> I was afraid that you say that. :D\n> I haven't found a fast check for components. Is there any?\n>\n\n\nNo, `is_trivial_zero` is not implemented there. \n\n> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.\n> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). \n\n> \n> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.\n\n\nYou are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.",
    "created_at": "2020-07-30T18:26:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454586",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:8'></a>Replying to [comment:7 gh-mjungmath]:
>
> I was afraid that you say that. :D
> I haven't found a fast check for components. Is there any?
>


No, `is_trivial_zero` is not implemented there. 

> > Also, this does not fix the root of the bug, which results from the `+=` operator acting on the zero element. It should be fixed per se, because it can lead to other errors.
> > FWIW, this bug was introduced in Sage 9.0 (everything is OK in earlier versions of Sage). 

> 
> I suspect the root is #28562. However, the operator `+=` should not be a problem here. When two elements are added from which one is the zero element, the other element is returned. Due to ticket #28562, altering the components of the zero element is not even possible and would result in an error. The only thing happening here is that the zero element is renamed.


You are right, `+=` is not the problem here. A way to fix the issue is then to check whether the computed result is the zero of the base ring (I guess by something like `resu is self._fmodule.base().zero()`), before changing its name at the end of the `__call__` method.



---

archive/issue_comments_454587.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-30T19:31:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454587",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454588.json:
```json
{
    "body": "<a id='comment:10'></a>What about this?",
    "created_at": "2020-07-30T19:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454588",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'></a>What about this?



---

archive/issue_comments_454589.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-07-30T19:31:41Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454589",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454590.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-07-30T19:35:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454590",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454591.json:
```json
{
    "body": "<a id='comment:12'></a>I think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution",
    "created_at": "2020-07-30T19:49:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454591",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>I think #30181 (Immutable elements of `FreeModuleTensor`) could provide a systematic solution



---

archive/issue_comments_454592.json:
```json
{
    "body": "<a id='comment:13'></a>Thanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...",
    "created_at": "2020-07-30T21:09:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454592",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:13'></a>Thanks for covering the case of `one()` as well. Seems OK to me. Waiting for the patchbot green light...



---

archive/issue_comments_454593.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-07-31T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454593",
    "user": "https://github.com/egourgoulhon"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_454594.json:
```json
{
    "body": "<a id='comment:14'></a>There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.",
    "created_at": "2020-07-31T20:45:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454594",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:14'></a>There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`.



---

archive/issue_comments_454595.json:
```json
{
    "body": "<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-01T14:10:52Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454595",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454596.json:
```json
{
    "body": "<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-01T14:11:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454596",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:17'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454597.json:
```json
{
    "body": "<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-01T23:03:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454597",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454598.json:
```json
{
    "body": "<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-01T23:22:27Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454598",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:19'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454599.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-01T23:22:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454599",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_454600.json:
```json
{
    "body": "<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-02T09:25:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454600",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:22'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454601.json:
```json
{
    "body": "<a id='comment:23'></a>Replying to [comment:14 egourgoulhon]:\n> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. \n\n\nBoth have been fixed. Wait for green bot.",
    "created_at": "2020-08-02T09:27:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454601",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:23'></a>Replying to [comment:14 egourgoulhon]:
> There is a doctest error in `src/sage/manifolds/differentiable/chart.py` and some pycodestyle error in `src/sage/tensor/modules/free_module_tensor.py`. 


Both have been fixed. Wait for green bot.



---

archive/issue_comments_454602.json:
```json
{
    "body": "<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-02T09:50:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454602",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:24'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454603.json:
```json
{
    "body": "<a id='comment:25'></a>LGTM. Waiting for a positive review of the dependency (#30266).",
    "created_at": "2020-08-03T08:46:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454603",
    "user": "https://github.com/egourgoulhon"
}
```

<a id='comment:25'></a>LGTM. Waiting for a positive review of the dependency (#30266).



---

archive/issue_comments_454604.json:
```json
{
    "body": "<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-03T22:51:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454604",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:26'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454605.json:
```json
{
    "body": "<a id='comment:27'></a>What about `try...finally` instead of `try...except`? I think this should be even faster, right?",
    "created_at": "2020-08-03T23:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454605",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:27'></a>What about `try...finally` instead of `try...except`? I think this should be even faster, right?



---

archive/issue_comments_454606.json:
```json
{
    "body": "<a id='comment:28'></a>I doubt it. Plus it makes the code a little harder to understand IMO.",
    "created_at": "2020-08-03T23:55:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454606",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:28'></a>I doubt it. Plus it makes the code a little harder to understand IMO.



---

archive/issue_comments_454607.json:
```json
{
    "body": "<a id='comment:29'></a>You're right, there is no difference. And I agree with you regarding the readability. I'll change it back.",
    "created_at": "2020-08-04T00:08:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454607",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:29'></a>You're right, there is no difference. And I agree with you regarding the readability. I'll change it back.



---

archive/issue_comments_454608.json:
```json
{
    "body": "<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-04T00:10:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454608",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:30'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454609.json:
```json
{
    "body": "<a id='comment:31'></a>There we go.",
    "created_at": "2020-08-04T00:11:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454609",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:31'></a>There we go.



---

archive/issue_comments_454610.json:
```json
{
    "body": "<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-05T12:12:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454610",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:32'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454611.json:
```json
{
    "body": "<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-05T16:25:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454611",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:34'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_454612.json:
```json
{
    "body": "<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:",
    "created_at": "2020-08-05T22:33:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454612",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:35'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. Last 10 new commits:



---

archive/issue_comments_454613.json:
```json
{
    "body": "Changing status from needs_review to needs_info.",
    "created_at": "2020-08-05T22:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454613",
    "user": "https://github.com/mjungmath"
}
```

Changing status from needs_review to needs_info.



---

archive/issue_comments_454614.json:
```json
{
    "body": "<a id='comment:36'></a>Changing the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.\n\nIf I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.\n\nSo, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.\n\nIf we decide for the \"return-copy-behavior\", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.",
    "created_at": "2020-08-05T22:52:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454614",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:36'></a>Changing the doctest outputs, especially in `src/doc/en/thematic_tutorials/vector_calculus/vector_calc_advanced.rst` left my aesthetic devil inside of me rebelling. A uniform output would be indeed nice.

If I remember correctly, our original argument for this behavior was that elements of modules/rings are usually treated immutable and that we should recover this behavior as far as possible. But thanks to Matthias with #30181, and the resulting changes in #30261, our elements are now undoubtfully viewed as mutable elements until they are stated immutable.

So, what about keeping the checks and always returning copies after each operation instead? This has also the great advantage that the results are again mutable (i.e. consistent behavior). Since we use fast checks that don't depend on particular elements now, this should also not affect the performance and would fit into the framework.

If we decide for the "return-copy-behavior", this ticket would become obsolete. Thus, I hope for a quick response so that I can work further on either one.



---

archive/issue_comments_454615.json:
```json
{
    "body": "<a id='comment:37'></a>FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.",
    "created_at": "2020-08-05T23:16:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454615",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:37'></a>FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.



---

archive/issue_comments_454616.json:
```json
{
    "body": "<a id='comment:38'></a>Replying to [comment:37 mkoeppe]:\n> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.\n\n\nThat's good to know. Thanks. Do you also have an opinion which behavior is more suitable?",
    "created_at": "2020-08-06T07:39:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454616",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:38'></a>Replying to [comment:37 mkoeppe]:
> FWIW, `FreeModule` returns a mutable copy even on trivial operations such as `w = v + 0`, so implementing this behavior would be compatible.


That's good to know. Thanks. Do you also have an opinion which behavior is more suitable?



---

archive/issue_comments_454617.json:
```json
{
    "body": "<a id='comment:39'></a>I've opened another ticket #30302 for this discussion.",
    "created_at": "2020-08-06T10:00:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454617",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:39'></a>I've opened another ticket #30302 for this discussion.



---

archive/issue_events_078164.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78164"
}
```



---

archive/issue_comments_454618.json:
```json
{
    "body": "<a id='comment:41'></a>Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage",
    "created_at": "2021-04-02T20:21:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454618",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:41'></a>Moving this ticket to 9.4, as it seems unlikely that it will be merged in 9.3, which is in the release candidate stage



---

archive/issue_events_078165.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78165"
}
```



---

archive/issue_events_078166.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-04-02T20:21:54Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78166"
}
```



---

archive/issue_comments_454619.json:
```json
{
    "body": "<a id='comment:42'></a>Setting a new milestone for this ticket based on a cursory review.",
    "created_at": "2021-07-19T00:44:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454619",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:42'></a>Setting a new milestone for this ticket based on a cursory review.



---

archive/issue_events_078167.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78167"
}
```



---

archive/issue_events_078168.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-07-19T00:44:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78168"
}
```



---

archive/issue_events_078169.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78169"
}
```



---

archive/issue_events_078170.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-18T19:53:12Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78170"
}
```



---

archive/issue_comments_454620.json:
```json
{
    "body": "<a id='comment:43'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.",
    "created_at": "2021-12-18T19:53:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30239#issuecomment-454620",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:43'></a>Stalled in `needs_review` or `needs_info`; likely won't make it into Sage 9.5.



---

archive/issue_events_078171.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78171"
}
```



---

archive/issue_events_078172.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78172"
}
```



---

archive/issue_events_078173.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78173"
}
```



---

archive/issue_events_078174.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-09-19T18:58:47Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30239",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30239#event-78174"
}
```
