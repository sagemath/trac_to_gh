# Issue 30177: build/bin/sage-system-python: Improve check for a suitable python

archive/issues_029940.json:
```json
{
    "body": "CC:  @dimpase @embray @slel\n\n(from #29929/#30154)\n\n#29890 (build/bin/sage-system-python: Try \"python\" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:\n\n```\n+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional\nC:\\hostedtoolcache\\windows\\Python\\3.7.7\\x64\\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory\n##[error]Process completed with exit code 1.\n```\n  So `sage-system-python` needs better checks for the suitability of `python`.\n\nAlso, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1\n\n\n\n\n\nIssue created by migration from https://trac.sagemath.org/ticket/30177\n\n",
    "closed_at": "2020-08-10T18:49:56Z",
    "created_at": "2020-07-20T01:41:35Z",
    "labels": [
        "component: build: configure",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "build/bin/sage-system-python: Improve check for a suitable python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30177",
    "user": "https://github.com/mkoeppe"
}
```
CC:  @dimpase @embray @slel

(from #29929/#30154)

#29890 (build/bin/sage-system-python: Try "python" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:

```
+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional
C:\hostedtoolcache\windows\Python\3.7.7\x64\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory
##[error]Process completed with exit code 1.
```
  So `sage-system-python` needs better checks for the suitability of `python`.

Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1





Issue created by migration from https://trac.sagemath.org/ticket/30177





---

archive/issue_comments_424777.json:
```json
{
    "body": "New commits:",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424777",
    "user": "https://github.com/mkoeppe"
}
```

New commits:



---

archive/issue_comments_424778.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424778",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_424779.json:
```json
{
    "body": "lgtm",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424779",
    "user": "https://github.com/dimpase"
}
```

lgtm



---

archive/issue_comments_424780.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424780",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424781.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-07-20T15:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424781",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_424782.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424782",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_424783.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424783",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_424784.json:
```json
{
    "body": "This was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:\n\n```\nsage-package create singular --version git --tarball singular-git.tar.gz --type=optional\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nFileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'\n```",
    "created_at": "2020-07-24T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424784",
    "user": "https://github.com/mkoeppe"
}
```

This was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:

```
sage-package create singular --version git --tarball singular-git.tar.gz --type=optional
Traceback (most recent call last):
  File "<string>", line 1, in <module>
FileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'
```



---

archive/issue_comments_424785.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424785",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_424786.json:
```json
{
    "body": "ok",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424786",
    "user": "https://github.com/dimpase"
}
```

ok



---

archive/issue_comments_424787.json:
```json
{
    "body": "Thanks!",
    "created_at": "2020-07-24T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424787",
    "user": "https://github.com/mkoeppe"
}
```

Thanks!



---

archive/issue_comments_424788.json:
```json
{
    "body": "Merge conflict",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424788",
    "user": "https://github.com/vbraun"
}
```

Merge conflict



---

archive/issue_comments_424789.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424789",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_424790.json:
```json
{
    "body": "Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-07T23:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424790",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_424791.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-08-07T23:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424791",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_077848.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-10T18:49:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30177#event-77848"
}
```



---

archive/issue_comments_424792.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-10T18:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-424792",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
