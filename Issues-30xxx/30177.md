# Issue 30177: build/bin/sage-system-python: Improve check for a suitable python

archive/issues_029940.json:
```json
{
    "body": "(from #29929/#30154)\n\n#29890 (build/bin/sage-system-python: Try \"python\" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:\n\n```\n+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional\nC:\\hostedtoolcache\\windows\\Python\\3.7.7\\x64\\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory\n##[error]Process completed with exit code 1.\n```\n  So `sage-system-python` needs better checks for the suitability of `python`.\n\nAlso, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1\n\n\n\n\n\n**CC:**  @dimpase @embray @slel\n\n**Branch/Commit:** [4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)\n\n**Reviewer:** Dima Pasechnik\n\n**Author:** Matthias Koeppe\n\n**Resolution:** fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30177\n\n",
    "closed_at": "2020-08-10T18:49:56Z",
    "created_at": "2020-07-20T01:41:35Z",
    "labels": [
        "component: build: configure",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "build/bin/sage-system-python: Improve check for a suitable python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30177",
    "user": "https://github.com/mkoeppe"
}
```
(from #29929/#30154)

#29890 (build/bin/sage-system-python: Try "python" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:

```
+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional
C:\hostedtoolcache\windows\Python\3.7.7\x64\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory
##[error]Process completed with exit code 1.
```
  So `sage-system-python` needs better checks for the suitability of `python`.

Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1





**CC:**  @dimpase @embray @slel

**Branch/Commit:** [4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)

**Reviewer:** Dima Pasechnik

**Author:** Matthias Koeppe

**Resolution:** fixed

Issue created by migration from https://trac.sagemath.org/ticket/30177





---

archive/issue_comments_593912.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -9,7 +9,8 @@\n ```\n   So `sage-system-python` needs better checks for the suitability of `python`.\n \n-Also, a python 2 from an outdated homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ)\n+Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1\n \n \n \n+\n``````\n",
    "created_at": "2020-07-20T02:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593912",
    "user": "https://github.com/mkoeppe"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -9,7 +9,8 @@
 ```
   So `sage-system-python` needs better checks for the suitability of `python`.
 
-Also, a python 2 from an outdated homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ)
+Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1
 
 
 
+
``````




---

archive/issue_comments_593913.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python)",
    "created_at": "2020-07-20T03:11:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593913",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python)



---

archive/issue_comments_593914.json:
```json
{
    "body": "<a id='comment:3'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d\">3e991c7</a></td><td><code>build/bin/sage-system-python: Improve check for a suitable python</code></td></tr></table>\n",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593914",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d">3e991c7</a></td><td><code>build/bin/sage-system-python: Improve check for a suitable python</code></td></tr></table>




---

archive/issue_comments_593915.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593915",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_593916.json:
```json
{
    "body": "**Commit:** [3e991c7ba4067e7467eb871ce45598dea32a6f5d](https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d)",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593916",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [3e991c7ba4067e7467eb871ce45598dea32a6f5d](https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d)



---

archive/issue_comments_593917.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593917",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_593918.json:
```json
{
    "body": "<a id='comment:4'></a>\nlgtm",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593918",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>
lgtm



---

archive/issue_comments_593919.json:
```json
{
    "body": "**Reviewer:** Dima Pasechnik",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593919",
    "user": "https://github.com/dimpase"
}
```

**Reviewer:** Dima Pasechnik



---

archive/issue_comments_593920.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593920",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_593921.json:
```json
{
    "body": "<a id='comment:5'></a>\nThanks!",
    "created_at": "2020-07-20T15:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593921",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Thanks!



---

archive/issue_comments_593922.json:
```json
{
    "body": "<a id='comment:6'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14\">af2abe4</a></td><td><code>build/bin/sage-system-python: Suppress error output while testing python binaries</code></td></tr></table>\n",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593922",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14">af2abe4</a></td><td><code>build/bin/sage-system-python: Suppress error output while testing python binaries</code></td></tr></table>




---

archive/issue_comments_593923.json:
```json
{
    "body": "**Changing commit** from \"[3e991c7ba4067e7467eb871ce45598dea32a6f5d](https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d)\" to \"[af2abe49b968b8098aa8b426b1da1dca009b9d14](https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14)\".",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593923",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3e991c7ba4067e7467eb871ce45598dea32a6f5d](https://github.com/sagemath/sagetrac-mirror/commit/3e991c7ba4067e7467eb871ce45598dea32a6f5d)" to "[af2abe49b968b8098aa8b426b1da1dca009b9d14](https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14)".



---

archive/issue_comments_593924.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593924",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_593925.json:
```json
{
    "body": "<a id='comment:7'></a>\nThis was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:\n\n```\nsage-package create singular --version git --tarball singular-git.tar.gz --type=optional\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nFileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'\n```",
    "created_at": "2020-07-24T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593925",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
This was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:

```
sage-package create singular --version git --tarball singular-git.tar.gz --type=optional
Traceback (most recent call last):
  File "<string>", line 1, in <module>
FileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'
```



---

archive/issue_comments_593926.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593926",
    "user": "https://github.com/dimpase"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_593927.json:
```json
{
    "body": "<a id='comment:8'></a>\nok",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593927",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>
ok



---

archive/issue_comments_593928.json:
```json
{
    "body": "<a id='comment:9'></a>\nThanks!",
    "created_at": "2020-07-24T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593928",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Thanks!



---

archive/issue_comments_593929.json:
```json
{
    "body": "<a id='comment:10'></a>\nMerge conflict",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593929",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>
Merge conflict



---

archive/issue_comments_593930.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593930",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_593931.json:
```json
{
    "body": "<a id='comment:11'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd\">4f5b1b7</a></td><td><code>Merge tag '9.2.beta7' into t/30177/build_bin_sage_system_python__improve_check_for_a_suitable_python</code></td></tr></table>\n",
    "created_at": "2020-08-07T23:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593931",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd">4f5b1b7</a></td><td><code>Merge tag '9.2.beta7' into t/30177/build_bin_sage_system_python__improve_check_for_a_suitable_python</code></td></tr></table>




---

archive/issue_comments_593932.json:
```json
{
    "body": "**Changing commit** from \"[af2abe49b968b8098aa8b426b1da1dca009b9d14](https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14)\" to \"[4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)\".",
    "created_at": "2020-08-07T23:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593932",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[af2abe49b968b8098aa8b426b1da1dca009b9d14](https://github.com/sagemath/sagetrac-mirror/commit/af2abe49b968b8098aa8b426b1da1dca009b9d14)" to "[4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)".



---

archive/issue_comments_593933.json:
```json
{
    "body": "**Changing status** from needs_work to positive_review.",
    "created_at": "2020-08-07T23:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593933",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to positive_review.



---

archive/issue_events_087780.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-10T18:49:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30177#event-87780"
}
```



---

archive/issue_comments_593934.json:
```json
{
    "body": "**Resolution:** fixed",
    "created_at": "2020-08-10T18:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593934",
    "user": "https://github.com/vbraun"
}
```

**Resolution:** fixed



---

archive/issue_comments_593935.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python)\" to \"[4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)\".",
    "created_at": "2020-08-10T18:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-593935",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/build_bin_sage_system_python__improve_check_for_a_suitable_python)" to "[4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd](https://github.com/sagemath/sagetrac-mirror/commit/4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd)".
