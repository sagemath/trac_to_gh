# Issue 30177: build/bin/sage-system-python: Improve check for a suitable python

archive/issues_029940.json:
```json
{
    "body": "(from #29929/#30154)\n\n#29890 (build/bin/sage-system-python: Try \"python\" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:\n\n```\n+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional\nC:\\hostedtoolcache\\windows\\Python\\3.7.7\\x64\\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory\n##[error]Process completed with exit code 1.\n```\n  So `sage-system-python` needs better checks for the suitability of `python`.\n\nAlso, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1\n\n\n\n\n\nCC:  @dimpase @embray @slel\n\nBranch/Commit: 4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd\n\nReviewer: Dima Pasechnik\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30177\n\n",
    "closed_at": "2020-08-10T18:49:56Z",
    "created_at": "2020-07-20T01:41:35Z",
    "labels": [
        "component: build: configure",
        "minor",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "build/bin/sage-system-python: Improve check for a suitable python",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30177",
    "user": "https://github.com/mkoeppe"
}
```
(from #29929/#30154)

#29890 (build/bin/sage-system-python: Try "python" first) may cause failures on Cygwin if `python` is something strange coming through from the Windows installation as observed in https://github.com/mkoeppe/arb/runs/839201503:

```
+ sage-package create arb --version git --tarball arb-git.tar.gz --type=optional
C:\hostedtoolcache\windows\Python\3.7.7\x64\python.exe: can't open file '/cygdrive/d/a/arb/arb/build/bin/sage-package': [Errno 2] No such file or directory
##[error]Process completed with exit code 1.
```
  So `sage-system-python` needs better checks for the suitability of `python`.

Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1





CC:  @dimpase @embray @slel

Branch/Commit: 4f5b1b78ee5af57616ecddfab9b923b5ec0d14dd

Reviewer: Dima Pasechnik

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30177





---

archive/issue_comments_453390.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -9,7 +9,11 @@\n ```\n   So `sage-system-python` needs better checks for the suitability of `python`.\n \n-Also, a python 2 from an outdated homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ)\n+Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1\n+\n+\n+\n+\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-07-20T02:40:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453390",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -9,7 +9,11 @@
 ```
   So `sage-system-python` needs better checks for the suitability of `python`.
 
-Also, a python 2 from an outdated homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ)
+Also, a python 2 from an outdated or broken homebrew installation on mac needs to be rejected (https://groups.google.com/d/msg/sage-devel/DoiswEtlKs4/aCNNKBixCAAJ). Symptom: `hashlib.sha1()` not available - similar to https://stackoverflow.com/questions/22133167/python-error-attributeerror-module-object-has-no-attribute-sha1
+
+
+
+
 
 Comment: 1
 
``````




---

archive/issue_comments_453391.json:
```json
{
    "body": "<a id='comment:3'></a>New commits:",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453391",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>New commits:



---

archive/issue_comments_453392.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-20T03:11:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453392",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_453393.json:
```json
{
    "body": "<a id='comment:4'></a>lgtm",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453393",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:4'></a>lgtm



---

archive/issue_comments_453394.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-20T08:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453394",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453395.json:
```json
{
    "body": "<a id='comment:5'></a>Thanks!",
    "created_at": "2020-07-20T15:43:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453395",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>Thanks!



---

archive/issue_comments_453396.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453396",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review. New commits:



---

archive/issue_comments_453397.json:
```json
{
    "body": "Changing status from positive_review to needs_review.",
    "created_at": "2020-07-24T19:49:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453397",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing status from positive_review to needs_review.



---

archive/issue_comments_453398.json:
```json
{
    "body": "<a id='comment:7'></a>This was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:\n\n```\nsage-package create singular --version git --tarball singular-git.tar.gz --type=optional\nTraceback (most recent call last):\n  File \"<string>\", line 1, in <module>\nFileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'\n```",
    "created_at": "2020-07-24T19:51:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453398",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>This was working fine but was too noisy, as I just observed in https://github.com/mkoeppe/Sources/runs/907998067:

```
sage-package create singular --version git --tarball singular-git.tar.gz --type=optional
Traceback (most recent call last):
  File "<string>", line 1, in <module>
FileNotFoundError: [WinError 3] The system cannot find the path specified: '/cygdrive/d/a/Sources/Sources/upstream'
```



---

archive/issue_comments_453399.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453399",
    "user": "https://github.com/dimpase"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_453400.json:
```json
{
    "body": "<a id='comment:8'></a>ok",
    "created_at": "2020-07-24T19:56:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453400",
    "user": "https://github.com/dimpase"
}
```

<a id='comment:8'></a>ok



---

archive/issue_comments_453401.json:
```json
{
    "body": "<a id='comment:9'></a>Thanks!",
    "created_at": "2020-07-24T20:23:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453401",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>Thanks!



---

archive/issue_comments_453402.json:
```json
{
    "body": "<a id='comment:10'></a>Merge conflict",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453402",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:10'></a>Merge conflict



---

archive/issue_comments_453403.json:
```json
{
    "body": "Changing status from positive_review to needs_work.",
    "created_at": "2020-08-07T22:16:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453403",
    "user": "https://github.com/vbraun"
}
```

Changing status from positive_review to needs_work.



---

archive/issue_comments_453404.json:
```json
{
    "body": "<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-07T23:22:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453404",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:11'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_453405.json:
```json
{
    "body": "Changing status from needs_work to positive_review.",
    "created_at": "2020-08-07T23:22:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453405",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to positive_review.



---

archive/issue_events_077848.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-10T18:49:56Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30177#event-77848"
}
```



---

archive/issue_comments_453406.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-10T18:49:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30177",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30177#issuecomment-453406",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
