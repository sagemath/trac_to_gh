# Issue 30516: Infinite WeightedIntegerVectors does not coerce properly

archive/issues_030279.json:
```json
{
    "body": "Today, I have encountered the following bug:\n\n```\nsage: W = WeightedIntegerVectors([1,2,3])\nsage: w = W([1,1,1])\nsage: parent(w)\nInteger vectors of 0 weighted by [1, 2, 3]\n```\n\nThis is definitely wrong. The parent should be `Integer vectors of 6 weighted by [1, 2, 3]`.\n\n**CC:**  @tscrim @mkoeppe\n\n**Branch/Commit:** [f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)\n\n**Reviewer:** Travis Scrimshaw\n\n**Author:** Michael Jung\n\nIssue created by migration from https://trac.sagemath.org/ticket/30516\n\n",
    "closed_at": "2020-09-23T21:27:20Z",
    "created_at": "2020-09-06T14:46:49Z",
    "labels": [
        "component: combinatorics",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Infinite WeightedIntegerVectors does not coerce properly",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30516",
    "user": "https://github.com/mjungmath"
}
```
Today, I have encountered the following bug:

```
sage: W = WeightedIntegerVectors([1,2,3])
sage: w = W([1,1,1])
sage: parent(w)
Integer vectors of 0 weighted by [1, 2, 3]
```

This is definitely wrong. The parent should be `Integer vectors of 6 weighted by [1, 2, 3]`.

**CC:**  @tscrim @mkoeppe

**Branch/Commit:** [f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)

**Reviewer:** Travis Scrimshaw

**Author:** Michael Jung

Issue created by migration from https://trac.sagemath.org/ticket/30516





---

archive/issue_comments_575510.json:
```json
{
    "body": "<a id='comment:1'></a>\nso what ?",
    "created_at": "2020-09-09T12:28:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575510",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:1'></a>
so what ?



---

archive/issue_comments_575511.json:
```json
{
    "body": "<a id='comment:2'></a>\nI created this ticket accidentally. Sorry. The task has been finished in #30275.\n\nI will replace the name and description of this ticket soon. There are still open tasks.",
    "created_at": "2020-09-09T12:36:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575511",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:2'></a>
I created this ticket accidentally. Sorry. The task has been finished in #30275.

I will replace the name and description of this ticket soon. There are still open tasks.



---

archive/issue_comments_575512.json:
```json
{
    "body": "**Description changed:**\n``````diff\n--- \n+++ \n@@ -1 +1,10 @@\n+Today, I have encountered the following bug:\n \n+```\n+sage: W = WeightedIntegerVectors([1,2,3])\n+sage: w = W([1,1,1])\n+sage: parent(w)\n+Integer vectors of 0 weighted by [1, 2, 3]\n+```\n+\n+This is definitely wrong. The parent should be `Integer vectors of 6 weighted by [1, 2, 3]`.\n``````\n",
    "created_at": "2020-09-09T14:02:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575512",
    "user": "https://github.com/mjungmath"
}
```

**Description changed:**
``````diff
--- 
+++ 
@@ -1 +1,10 @@
+Today, I have encountered the following bug:
 
+```
+sage: W = WeightedIntegerVectors([1,2,3])
+sage: w = W([1,1,1])
+sage: parent(w)
+Integer vectors of 0 weighted by [1, 2, 3]
+```
+
+This is definitely wrong. The parent should be `Integer vectors of 6 weighted by [1, 2, 3]`.
``````




---

archive/issue_events_089706.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "rename": {
        "from": "Replace Assertion Error",
        "to": "Infinite WeightedIntegerVectors does not coerce correctly"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30516#event-89706"
}
```



---

archive/issue_comments_575513.json:
```json
{
    "body": "<a id='comment:4'></a>\nAny ideas where this bug is originated? I would say it comes from:\n\n```\nsage: W0 = WeightedIntegerVectors(0, [1,2,3])\nsage: W0([1,1,1])\n```\n\nThis is a bug, too. As far as I understand the code of `DisjointUnionEnumeratedSets`, it checks all subsets until the element is coercible into this subset.\n\nProbably a more direct approach is more useful and faster here, i.e. compute the grading (already there) and coerce into the corresponding weighted integer vector.\n\nOpinions?",
    "created_at": "2020-09-09T14:10:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575513",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:4'></a>
Any ideas where this bug is originated? I would say it comes from:

```
sage: W0 = WeightedIntegerVectors(0, [1,2,3])
sage: W0([1,1,1])
```

This is a bug, too. As far as I understand the code of `DisjointUnionEnumeratedSets`, it checks all subsets until the element is coercible into this subset.

Probably a more direct approach is more useful and faster here, i.e. compute the grading (already there) and coerce into the corresponding weighted integer vector.

Opinions?



---

archive/issue_events_089707.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "rename": {
        "from": "Infinite WeightedIntegerVectors does not coerce correctly",
        "to": "Infinite WeightedIntegerVectors does not coerce properly"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30516#event-89707"
}
```



---

archive/issue_comments_575514.json:
```json
{
    "body": "**Branch:** [u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly)",
    "created_at": "2020-09-09T18:48:37Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575514",
    "user": "https://github.com/mjungmath"
}
```

**Branch:** [u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly)



---

archive/issue_comments_575515.json:
```json
{
    "body": "**Commit:** [4b7b8680c7d5dee0f4d210685f11f65809ef8ae0](https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0)",
    "created_at": "2020-09-09T18:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575515",
    "user": "https://github.com/mjungmath"
}
```

**Commit:** [4b7b8680c7d5dee0f4d210685f11f65809ef8ae0](https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0)



---

archive/issue_comments_575516.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-09-09T18:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575516",
    "user": "https://github.com/mjungmath"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_575517.json:
```json
{
    "body": "<a id='comment:7'></a>\nI think, this should solve the problem at hand.\n\nAs mentioned, one can still improve the performance a bit. But let's spare it for another ticket.\n\n---\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0\">4b7b868</a></td><td><code>Trac #30516: grading check before conversion</code></td></tr></table>\n",
    "created_at": "2020-09-09T18:50:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575517",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:7'></a>
I think, this should solve the problem at hand.

As mentioned, one can still improve the performance a bit. But let's spare it for another ticket.

---
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0">4b7b868</a></td><td><code>Trac #30516: grading check before conversion</code></td></tr></table>




---

archive/issue_comments_575518.json:
```json
{
    "body": "**Author:** Michael Jung",
    "created_at": "2020-09-09T18:51:06Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575518",
    "user": "https://github.com/mjungmath"
}
```

**Author:** Michael Jung



---

archive/issue_comments_575519.json:
```json
{
    "body": "<a id='comment:9'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d\">f698d34</a></td><td><code>Trac #30516: redundant line removed + doctest improved</code></td></tr></table>\n",
    "created_at": "2020-09-09T19:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575519",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d">f698d34</a></td><td><code>Trac #30516: redundant line removed + doctest improved</code></td></tr></table>




---

archive/issue_comments_575520.json:
```json
{
    "body": "**Changing commit** from \"[4b7b8680c7d5dee0f4d210685f11f65809ef8ae0](https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0)\" to \"[f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)\".",
    "created_at": "2020-09-09T19:01:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575520",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[4b7b8680c7d5dee0f4d210685f11f65809ef8ae0](https://github.com/sagemath/sagetrac-mirror/commit/4b7b8680c7d5dee0f4d210685f11f65809ef8ae0)" to "[f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)".



---

archive/issue_comments_575521.json:
```json
{
    "body": "<a id='comment:10'></a>\nTurns out the doctest example was already wrong...",
    "created_at": "2020-09-09T19:07:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575521",
    "user": "https://github.com/mjungmath"
}
```

<a id='comment:10'></a>
Turns out the doctest example was already wrong...



---

archive/issue_comments_575522.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-09-09T22:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575522",
    "user": "https://github.com/tscrim"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_575523.json:
```json
{
    "body": "**Reviewer:** Travis Scrimshaw",
    "created_at": "2020-09-09T22:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575523",
    "user": "https://github.com/tscrim"
}
```

**Reviewer:** Travis Scrimshaw



---

archive/issue_comments_575524.json:
```json
{
    "body": "<a id='comment:11'></a>\nLGTM. The containment check should be quick IMO too.",
    "created_at": "2020-09-09T22:57:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575524",
    "user": "https://github.com/tscrim"
}
```

<a id='comment:11'></a>
LGTM. The containment check should be quick IMO too.



---

archive/issue_comments_575525.json:
```json
{
    "body": "**Changing branch** from \"[u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly)\" to \"[f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)\".",
    "created_at": "2020-09-23T21:27:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30516#issuecomment-575525",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-mjungmath/infinite_weightedintegervectors_does_not_coerce_properly)" to "[f698d3439b1407ee2801be69566b8c1f441d758d](https://github.com/sagemath/sagetrac-mirror/commit/f698d3439b1407ee2801be69566b8c1f441d758d)".



---

archive/issue_events_089708.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-09-23T21:27:20Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30516",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30516#event-89708"
}
```
