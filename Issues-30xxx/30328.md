# Issue 30328: Need to convert values before passing them to `cdd`

archive/issues_030091.json:
```json
{
    "body": "```\nsage: P = polytopes.regular_polygon(5, exact=True)\nsage: P1 = polytopes.regular_polygon(5, exact=False)\nsage: P*P1\n...\nValueError: *Input Error: Input format is not correct.\n*Format:\n begin\n   m   n  NumberType(real, rational or integer)\n   b  -A\n end\n```\n\nWe fix this, by converting the values to reals, before passing them to `cdd`.\n\nWe enable a doctest prepared by #30293, which implicitly checks that this is fixed.\n\nThe above failure will be implicitly added by #29934.\n\nCC:  @jplab @laisrast\n\nKeywords: geometry, coercion\n\nBranch/Commit: 0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nDependencies: #30293\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30328\n\n",
    "closed_at": "2020-08-26T21:17:50Z",
    "created_at": "2020-08-10T12:08:47Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Need to convert values before passing them to `cdd`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30328",
    "user": "https://github.com/kliem"
}
```
```
sage: P = polytopes.regular_polygon(5, exact=True)
sage: P1 = polytopes.regular_polygon(5, exact=False)
sage: P*P1
...
ValueError: *Input Error: Input format is not correct.
*Format:
 begin
   m   n  NumberType(real, rational or integer)
   b  -A
 end
```

We fix this, by converting the values to reals, before passing them to `cdd`.

We enable a doctest prepared by #30293, which implicitly checks that this is fixed.

The above failure will be implicitly added by #29934.

CC:  @jplab @laisrast

Keywords: geometry, coercion

Branch/Commit: 0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Dependencies: #30293

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30328





---

archive/issue_comments_456201.json:
```json
{
    "body": "Changing keywords from \"\" to \"geometry, coercion\".",
    "created_at": "2020-08-10T12:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456201",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "" to "geometry, coercion".



---

archive/issue_comments_456202.json:
```json
{
    "body": "<a id='comment:2'></a>This was detected in #29934.",
    "created_at": "2020-08-10T12:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456202",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>This was detected in #29934.



---

archive/issue_comments_456203.json:
```json
{
    "body": "<a id='comment:3'></a>Ok, maybe its not so much about `AA`:\n\n```\nsage: tfcell = polytopes.twenty_four_cell(backend='normaliz') \nsage: tfcell.lawrence_extension(tfcell.vertices()[0].vector()*1.0)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-14-3a950b1911b2> in <module>()\n----> 1 tfcell.lawrence_extension(tfcell.vertices()[Integer(0)].vector()*RealNumber('1.0'))\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in lawrence_extension(self, v)\n   5965         lambda_V = [u + [0] for u in V if u != v] + [v+[1]] + [v+[2]]\n   5966         parent = self.parent().base_extend(vector(v), ambient_dim=self.ambient_dim() + 1)\n-> 5967         return parent.element_class(parent, [lambda_V, [], []], None)\n   5968 \n   5969     def lawrence_polytope(self):\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)\n    518             sage: TestSuite(p).run()\n    519         \"\"\"\n--> 520         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)\n    521 \n    522     def _init_from_Vrepresentation_and_Hrepresentation(self, Vrep, Hrep, verbose=False):\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, Vrep_minimal, Hrep_minimal, pref_rep, **kwds)\n    247 \n    248             if vertices or rays or lines:\n--> 249                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)\n    250             else:\n    251                 self._init_empty_polyhedron()\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)\n     60         from .cdd_file_format import cdd_Vrepresentation\n     61         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)\n---> 62         s = self._run_cdd(s, '--redcheck', verbose=verbose)\n     63         s = self._run_cdd(s, '--repall', verbose=verbose)\n     64         self._init_from_cdd_output(s)\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)\n    168         if 'Error:' in ans + err:\n    169             # cdd reports errors on stdout and misc information on stderr\n--> 170             raise ValueError(ans.strip())\n    171         return ans\n    172 \n\nValueError: *Input Error: Input format is not correct.\n*Format:\n begin\n   m   n  NumberType(real, rational or integer)\n   b  -A\n end\n```",
    "created_at": "2020-08-10T12:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456203",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>Ok, maybe its not so much about `AA`:

```
sage: tfcell = polytopes.twenty_four_cell(backend='normaliz') 
sage: tfcell.lawrence_extension(tfcell.vertices()[0].vector()*1.0)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-14-3a950b1911b2> in <module>()
----> 1 tfcell.lawrence_extension(tfcell.vertices()[Integer(0)].vector()*RealNumber('1.0'))

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in lawrence_extension(self, v)
   5965         lambda_V = [u + [0] for u in V if u != v] + [v+[1]] + [v+[2]]
   5966         parent = self.parent().base_extend(vector(v), ambient_dim=self.ambient_dim() + 1)
-> 5967         return parent.element_class(parent, [lambda_V, [], []], None)
   5968 
   5969     def lawrence_polytope(self):

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)
    518             sage: TestSuite(p).run()
    519         """
--> 520         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)
    521 
    522     def _init_from_Vrepresentation_and_Hrepresentation(self, Vrep, Hrep, verbose=False):

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, Vrep_minimal, Hrep_minimal, pref_rep, **kwds)
    247 
    248             if vertices or rays or lines:
--> 249                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)
    250             else:
    251                 self._init_empty_polyhedron()

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)
     60         from .cdd_file_format import cdd_Vrepresentation
     61         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)
---> 62         s = self._run_cdd(s, '--redcheck', verbose=verbose)
     63         s = self._run_cdd(s, '--repall', verbose=verbose)
     64         self._init_from_cdd_output(s)

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)
    168         if 'Error:' in ans + err:
    169             # cdd reports errors on stdout and misc information on stderr
--> 170             raise ValueError(ans.strip())
    171         return ans
    172 

ValueError: *Input Error: Input format is not correct.
*Format:
 begin
   m   n  NumberType(real, rational or integer)
   b  -A
 end
```



---

archive/issue_comments_456204.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n ```\n sage: P = polytopes.regular_polygon(5, exact=True)\n sage: P1 = polytopes.regular_polygon(5, exact=False)\n+sage: P*P1\n ---------------------------------------------------------------------------\n KeyError                                  Traceback (most recent call last)\n /srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()\n``````\n",
    "created_at": "2020-08-10T13:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456204",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
 ```
 sage: P = polytopes.regular_polygon(5, exact=True)
 sage: P1 = polytopes.regular_polygon(5, exact=False)
+sage: P*P1
 ---------------------------------------------------------------------------
 KeyError                                  Traceback (most recent call last)
 /srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()
``````




---

archive/issue_comments_456205.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,4 +1,21 @@\n+```\n+sage: P = polytopes.regular_polygon(5, exact=True)\n+sage: P1 = polytopes.regular_polygon(5, exact=False)\n+sage: P*P1\n+...\n+ValueError: *Input Error: Input format is not correct.\n+*Format:\n+ begin\n+   m   n  NumberType(real, rational or integer)\n+   b  -A\n+ end\n+```\n \n+We fix this, by converting the values to reals, before passing them to `cdd`.\n+\n+We enable a doctest prepared by #30293, which implicitly checks that this is fixed.\n+\n+The above failure will be implicitly added by #29934.\n \n Comment: 1\n \n``````\n",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456205",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,4 +1,21 @@
+```
+sage: P = polytopes.regular_polygon(5, exact=True)
+sage: P1 = polytopes.regular_polygon(5, exact=False)
+sage: P*P1
+...
+ValueError: *Input Error: Input format is not correct.
+*Format:
+ begin
+   m   n  NumberType(real, rational or integer)
+   b  -A
+ end
+```
 
+We fix this, by converting the values to reals, before passing them to `cdd`.
+
+We enable a doctest prepared by #30293, which implicitly checks that this is fixed.
+
+The above failure will be implicitly added by #29934.
 
 Comment: 1
 
``````




---

archive/issue_comments_456206.json:
```json
{
    "body": "<a id='comment:5'></a>New commits:",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456206",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>New commits:



---

archive/issue_comments_456207.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456207",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_456208.json:
```json
{
    "body": "<a id='comment:7'></a>Python 3.8 will complain about this; better to use `==` instead of `is`\n\n```\n+    if cdd_type is 'real':\n```",
    "created_at": "2020-08-10T14:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456208",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>Python 3.8 will complain about this; better to use `==` instead of `is`

```
+    if cdd_type is 'real':
```



---

archive/issue_comments_456209.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:\n> Python 3.8 will complain about this; better to use `==` instead of `is`\n> \n> ```\n> +    if cdd_type is 'real':\n> ```\n\n\nThanks. I had somewhere in the back of my mind, that one of them is wrong.",
    "created_at": "2020-08-10T14:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456209",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>Replying to [comment:7 mkoeppe]:
> Python 3.8 will complain about this; better to use `==` instead of `is`
> 
> ```
> +    if cdd_type is 'real':
> ```


Thanks. I had somewhere in the back of my mind, that one of them is wrong.



---

archive/issue_comments_456210.json:
```json
{
    "body": "<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-10T14:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456210",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456211.json:
```json
{
    "body": "<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-08-10T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456211",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_456212.json:
```json
{
    "body": "Changing priority from major to critical.",
    "created_at": "2020-08-10T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456212",
    "user": "https://github.com/mkoeppe"
}
```

Changing priority from major to critical.



---

archive/issue_comments_456213.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-10T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456213",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_456214.json:
```json
{
    "body": "<a id='comment:12'></a>Thank you.",
    "created_at": "2020-08-10T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456214",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>Thank you.



---

archive/issue_comments_456215.json:
```json
{
    "body": "<a id='comment:13'></a>Needed to rebase on top of #30293 (which had a merge conflict and was rebased on top of the newest beta).\n\n---\nNew commits:",
    "created_at": "2020-08-21T18:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456215",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>Needed to rebase on top of #30293 (which had a merge conflict and was rebased on top of the newest beta).

---
New commits:



---

archive/issue_events_078560.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-26T21:17:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30328#event-78560"
}
```



---

archive/issue_comments_456216.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-26T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-456216",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
