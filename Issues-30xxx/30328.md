# Issue 30328: Need to convert values before passing them to `cdd`

archive/issues_030091.json:
```json
{
    "body": "\n```\nsage: P = polytopes.regular_polygon(5, exact=True)\nsage: P1 = polytopes.regular_polygon(5, exact=False)\nsage: P*P1\n...\nValueError: *Input Error: Input format is not correct.\n*Format:\n begin\n   m   n  NumberType(real, rational or integer)\n   b  -A\n end\n```\n\nWe fix this, by converting the values to reals, before passing them to `cdd`.\n\nWe enable a doctest prepared by #30293, which implicitly checks that this is fixed.\n\nThe above failure will be implicitly added by #29934.\n\nCC:  @jplab @laisrast\n\nKeywords: geometry, coercion\n\nBranch/Commit: [0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)\n\nReviewer: Matthias Koeppe\n\nAuthor: Jonathan Kliem\n\nDependencies: #30293\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30328\n\n",
    "closed_at": "2020-08-26T21:17:50Z",
    "created_at": "2020-08-10T12:08:47Z",
    "labels": [
        "component: geometry",
        "critical",
        "bug"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Need to convert values before passing them to `cdd`",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30328",
    "user": "https://github.com/kliem"
}
```

```
sage: P = polytopes.regular_polygon(5, exact=True)
sage: P1 = polytopes.regular_polygon(5, exact=False)
sage: P*P1
...
ValueError: *Input Error: Input format is not correct.
*Format:
 begin
   m   n  NumberType(real, rational or integer)
   b  -A
 end
```

We fix this, by converting the values to reals, before passing them to `cdd`.

We enable a doctest prepared by #30293, which implicitly checks that this is fixed.

The above failure will be implicitly added by #29934.

CC:  @jplab @laisrast

Keywords: geometry, coercion

Branch/Commit: [0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)

Reviewer: Matthias Koeppe

Author: Jonathan Kliem

Dependencies: #30293

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30328





---

archive/issue_comments_597844.json:
```json
{
    "body": "Changing keywords from \"\" to \"geometry, coercion\".",
    "created_at": "2020-08-10T12:08:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597844",
    "user": "https://github.com/kliem"
}
```

Changing keywords from "" to "geometry, coercion".



---

archive/issue_comments_597845.json:
```json
{
    "body": "<a id='comment:2'></a>\nThis was detected in #29934.",
    "created_at": "2020-08-10T12:09:23Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597845",
    "user": "https://github.com/kliem"
}
```

<a id='comment:2'></a>
This was detected in #29934.



---

archive/issue_comments_597846.json:
```json
{
    "body": "<a id='comment:3'></a>\nOk, maybe its not so much about `AA`:\n\n```\nsage: tfcell = polytopes.twenty_four_cell(backend='normaliz') \nsage: tfcell.lawrence_extension(tfcell.vertices()[0].vector()*1.0)\n---------------------------------------------------------------------------\nValueError                                Traceback (most recent call last)\n<ipython-input-14-3a950b1911b2> in <module>()\n----> 1 tfcell.lawrence_extension(tfcell.vertices()[Integer(0)].vector()*RealNumber('1.0'))\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in lawrence_extension(self, v)\n   5965         lambda_V = [u + [0] for u in V if u != v] + [v+[1]] + [v+[2]]\n   5966         parent = self.parent().base_extend(vector(v), ambient_dim=self.ambient_dim() + 1)\n-> 5967         return parent.element_class(parent, [lambda_V, [], []], None)\n   5968 \n   5969     def lawrence_polytope(self):\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)\n    518             sage: TestSuite(p).run()\n    519         \"\"\"\n--> 520         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)\n    521 \n    522     def _init_from_Vrepresentation_and_Hrepresentation(self, Vrep, Hrep, verbose=False):\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, Vrep_minimal, Hrep_minimal, pref_rep, **kwds)\n    247 \n    248             if vertices or rays or lines:\n--> 249                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)\n    250             else:\n    251                 self._init_empty_polyhedron()\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)\n     60         from .cdd_file_format import cdd_Vrepresentation\n     61         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)\n---> 62         s = self._run_cdd(s, '--redcheck', verbose=verbose)\n     63         s = self._run_cdd(s, '--repall', verbose=verbose)\n     64         self._init_from_cdd_output(s)\n\n/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)\n    168         if 'Error:' in ans + err:\n    169             # cdd reports errors on stdout and misc information on stderr\n--> 170             raise ValueError(ans.strip())\n    171         return ans\n    172 \n\nValueError: *Input Error: Input format is not correct.\n*Format:\n begin\n   m   n  NumberType(real, rational or integer)\n   b  -A\n end\n```",
    "created_at": "2020-08-10T12:33:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597846",
    "user": "https://github.com/kliem"
}
```

<a id='comment:3'></a>
Ok, maybe its not so much about `AA`:

```
sage: tfcell = polytopes.twenty_four_cell(backend='normaliz') 
sage: tfcell.lawrence_extension(tfcell.vertices()[0].vector()*1.0)
---------------------------------------------------------------------------
ValueError                                Traceback (most recent call last)
<ipython-input-14-3a950b1911b2> in <module>()
----> 1 tfcell.lawrence_extension(tfcell.vertices()[Integer(0)].vector()*RealNumber('1.0'))

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in lawrence_extension(self, v)
   5965         lambda_V = [u + [0] for u in V if u != v] + [v+[1]] + [v+[2]]
   5966         parent = self.parent().base_extend(vector(v), ambient_dim=self.ambient_dim() + 1)
-> 5967         return parent.element_class(parent, [lambda_V, [], []], None)
   5968 
   5969     def lawrence_polytope(self):

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)
    518             sage: TestSuite(p).run()
    519         """
--> 520         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)
    521 
    522     def _init_from_Vrepresentation_and_Hrepresentation(self, Vrep, Hrep, verbose=False):

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, Vrep_minimal, Hrep_minimal, pref_rep, **kwds)
    247 
    248             if vertices or rays or lines:
--> 249                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)
    250             else:
    251                 self._init_empty_polyhedron()

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)
     60         from .cdd_file_format import cdd_Vrepresentation
     61         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)
---> 62         s = self._run_cdd(s, '--redcheck', verbose=verbose)
     63         s = self._run_cdd(s, '--repall', verbose=verbose)
     64         self._init_from_cdd_output(s)

/home/jonathan/Applications/sage/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)
    168         if 'Error:' in ans + err:
    169             # cdd reports errors on stdout and misc information on stderr
--> 170             raise ValueError(ans.strip())
    171         return ans
    172 

ValueError: *Input Error: Input format is not correct.
*Format:
 begin
   m   n  NumberType(real, rational or integer)
   b  -A
 end
```



---

archive/issue_comments_597847.json:
```json
{
    "body": "Dependencies: #30293",
    "created_at": "2020-08-10T13:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597847",
    "user": "https://github.com/kliem"
}
```

Dependencies: #30293



---

archive/issue_comments_597848.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,6 +2,7 @@\n ```\n sage: P = polytopes.regular_polygon(5, exact=True)\n sage: P1 = polytopes.regular_polygon(5, exact=False)\n+sage: P*P1\n ---------------------------------------------------------------------------\n KeyError                                  Traceback (most recent call last)\n /srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()\n``````\n",
    "created_at": "2020-08-10T13:33:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597848",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,6 +2,7 @@
 ```
 sage: P = polytopes.regular_polygon(5, exact=True)
 sage: P1 = polytopes.regular_polygon(5, exact=False)
+sage: P*P1
 ---------------------------------------------------------------------------
 KeyError                                  Traceback (most recent call last)
 /srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()
``````




---

archive/issue_comments_597849.json:
```json
{
    "body": "Author: Jonathan Kliem",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597849",
    "user": "https://github.com/kliem"
}
```

Author: Jonathan Kliem



---

archive/issue_comments_597850.json:
```json
{
    "body": "Branch: [public/30328](https://github.com/sagemath/sagetrac-mirror/tree/public/30328)",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597850",
    "user": "https://github.com/kliem"
}
```

Branch: [public/30328](https://github.com/sagemath/sagetrac-mirror/tree/public/30328)



---

archive/issue_comments_597851.json:
```json
{
    "body": "Commit: [319c172084163f0dce96d90a1762878d7c3a741e](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597851",
    "user": "https://github.com/kliem"
}
```

Commit: [319c172084163f0dce96d90a1762878d7c3a741e](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)



---

archive/issue_comments_597852.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -3,122 +3,7 @@\n sage: P = polytopes.regular_polygon(5, exact=True)\n sage: P1 = polytopes.regular_polygon(5, exact=False)\n sage: P*P1\n----------------------------------------------------------------------------\n-KeyError                                  Traceback (most recent call last)\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()\n-   1195         try:\n--> 1196             action = self._action_maps.get(xp, yp, op)\n-   1197         except KeyError:\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce_dict.pyx in sage.structure.coerce_dict.TripleDict.get (build/cythonized/sage/structure/coerce_dict.c:7917)()\n-   1327         if not valid(cursor.key_id1):\n--> 1328             raise KeyError((k1, k2, k3))\n-   1329         value = <object>cursor.value\n-\n-KeyError: (Polyhedra in AA^2, Polyhedra in RDF^2, <built-in function mul>)\n-\n-During handling of the above exception, another exception occurred:\n-\n-ValueError                                Traceback (most recent call last)\n-<ipython-input-4-69ee963b1fc0> in <module>()\n-----> 1 P*P1\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12029)()\n-   1515             return (<Element>left)._mul_(right)\n-   1516         if BOTH_ARE_ELEMENT(cl):\n--> 1517             return coercion_model.bin_op(left, right, mul)\n-   1518 \n-   1519         cdef long value\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9996)()\n-   1196             action = self._action_maps.get(xp, yp, op)\n-   1197         except KeyError:\n--> 1198             action = self.get_action(xp, yp, op, x, y)\n-   1199         if action is not None:\n-   1200             if (<Action>action)._is_left:\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.get_action (build/cythonized/sage/structure/coerce.c:16783)()\n-   1724         except KeyError:\n-   1725             pass\n--> 1726         action = self.discover_action(R, S, op, r, s)\n-   1727         action = self.verify_action(action, R, S, op)\n-   1728         self._action_maps.set(R, S, op, action)\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.discover_action (build/cythonized/sage/structure/coerce.c:18201)()\n-   1855         \"\"\"\n-   1856         if isinstance(R, Parent):\n--> 1857             action = (<Parent>R).get_action(S, op, True, r, s)\n-   1858             if action is not None:\n-   1859                 return action\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:19745)()\n-   2457         action = self._get_action_(S, op, self_on_left)\n-   2458         if action is None:\n--> 2459             action = self.discover_action(S, op, self_on_left, self_el, S_el)\n-   2460 \n-   2461         if action is not None:\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:20722)()\n-   2536                 # detect actions defined by _rmul_, _lmul_, _act_on_, and _acted_upon_ methods\n-   2537                 from .coerce_actions import detect_element_action\n--> 2538                 action = detect_element_action(self, S, self_on_left, self_el, S_el)\n-   2539                 if action is not None:\n-   2540                     return action\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5360)()\n-    229     if isinstance(Y, Parent):\n-    230         try:\n---> 231             if x._acted_upon_(y, X_on_left) is not None:\n-    232                 return ActedUponAction(Y, X, not X_on_left, False)\n-    233         except CoercionException:\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element._acted_upon_ (build/cythonized/sage/structure/element.c:8604)()\n-    925         return None\n-    926 \n---> 927     cpdef _acted_upon_(self, x, bint self_on_left):\n-    928         \"\"\"\n-    929         Use this method to implement ``self`` acted on by x.\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in _acted_upon_(self, actor, self_on_left)\n-   4299         \"\"\"\n-   4300         if is_Polyhedron(actor):\n--> 4301             return self.product(actor)\n-   4302         if is_Vector(actor):\n-   4303             return self.translation(actor)\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in product(self, other)\n-   3993 \n-   3994         parent = self.parent().change_ring(new_ring, ambient_dim=self.ambient_dim() + other.ambient_dim())\n--> 3995         return parent.element_class(parent, [new_vertices, new_rays, new_lines], None)\n-   3996 \n-   3997     _mul_ = product\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)\n-    459             sage: TestSuite(p).run()\n-    460         \"\"\"\n---> 461         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, **kwds)\n-    120             vertices, rays, lines = Vrep\n-    121             if vertices or rays or lines:\n---> 122                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)\n-    123             else:\n-    124                 self._init_empty_polyhedron()\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)\n-     61         from .cdd_file_format import cdd_Vrepresentation\n-     62         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)\n----> 63         s = self._run_cdd(s, '--redcheck', verbose=verbose)\n-     64         s = self._run_cdd(s, '--repall', verbose=verbose)\n-     65         self._init_from_cdd_output(s)\n-\n-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)\n-    163         if 'Error:' in ans + err:\n-    164             # cdd reports errors on stdout and misc information on stderr\n---> 165             raise ValueError(ans.strip())\n-    166         return ans\n-    167 \n-\n+...\n ValueError: *Input Error: Input format is not correct.\n *Format:\n  begin\n@@ -126,3 +11,9 @@\n    b  -A\n  end\n ```\n+\n+We fix this, by converting the values to reals, before passing them to `cdd`.\n+\n+We enable a doctest prepared by #30293, which implicitly checks that this is fixed.\n+\n+The above failure will be implicitly added by #29934.\n``````\n",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597852",
    "user": "https://github.com/kliem"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -3,122 +3,7 @@
 sage: P = polytopes.regular_polygon(5, exact=True)
 sage: P1 = polytopes.regular_polygon(5, exact=False)
 sage: P*P1
----------------------------------------------------------------------------
-KeyError                                  Traceback (most recent call last)
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9946)()
-   1195         try:
--> 1196             action = self._action_maps.get(xp, yp, op)
-   1197         except KeyError:
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce_dict.pyx in sage.structure.coerce_dict.TripleDict.get (build/cythonized/sage/structure/coerce_dict.c:7917)()
-   1327         if not valid(cursor.key_id1):
--> 1328             raise KeyError((k1, k2, k3))
-   1329         value = <object>cursor.value
-
-KeyError: (Polyhedra in AA^2, Polyhedra in RDF^2, <built-in function mul>)
-
-During handling of the above exception, another exception occurred:
-
-ValueError                                Traceback (most recent call last)
-<ipython-input-4-69ee963b1fc0> in <module>()
-----> 1 P*P1
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element.__mul__ (build/cythonized/sage/structure/element.c:12029)()
-   1515             return (<Element>left)._mul_(right)
-   1516         if BOTH_ARE_ELEMENT(cl):
--> 1517             return coercion_model.bin_op(left, right, mul)
-   1518 
-   1519         cdef long value
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.bin_op (build/cythonized/sage/structure/coerce.c:9996)()
-   1196             action = self._action_maps.get(xp, yp, op)
-   1197         except KeyError:
--> 1198             action = self.get_action(xp, yp, op, x, y)
-   1199         if action is not None:
-   1200             if (<Action>action)._is_left:
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.get_action (build/cythonized/sage/structure/coerce.c:16783)()
-   1724         except KeyError:
-   1725             pass
--> 1726         action = self.discover_action(R, S, op, r, s)
-   1727         action = self.verify_action(action, R, S, op)
-   1728         self._action_maps.set(R, S, op, action)
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce.pyx in sage.structure.coerce.CoercionModel.discover_action (build/cythonized/sage/structure/coerce.c:18201)()
-   1855         """
-   1856         if isinstance(R, Parent):
--> 1857             action = (<Parent>R).get_action(S, op, True, r, s)
-   1858             if action is not None:
-   1859                 return action
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.get_action (build/cythonized/sage/structure/parent.c:19745)()
-   2457         action = self._get_action_(S, op, self_on_left)
-   2458         if action is None:
--> 2459             action = self.discover_action(S, op, self_on_left, self_el, S_el)
-   2460 
-   2461         if action is not None:
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/parent.pyx in sage.structure.parent.Parent.discover_action (build/cythonized/sage/structure/parent.c:20722)()
-   2536                 # detect actions defined by _rmul_, _lmul_, _act_on_, and _acted_upon_ methods
-   2537                 from .coerce_actions import detect_element_action
--> 2538                 action = detect_element_action(self, S, self_on_left, self_el, S_el)
-   2539                 if action is not None:
-   2540                     return action
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/coerce_actions.pyx in sage.structure.coerce_actions.detect_element_action (build/cythonized/sage/structure/coerce_actions.c:5360)()
-    229     if isinstance(Y, Parent):
-    230         try:
---> 231             if x._acted_upon_(y, X_on_left) is not None:
-    232                 return ActedUponAction(Y, X, not X_on_left, False)
-    233         except CoercionException:
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/structure/element.pyx in sage.structure.element.Element._acted_upon_ (build/cythonized/sage/structure/element.c:8604)()
-    925         return None
-    926 
---> 927     cpdef _acted_upon_(self, x, bint self_on_left):
-    928         """
-    929         Use this method to implement ``self`` acted on by x.
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in _acted_upon_(self, actor, self_on_left)
-   4299         """
-   4300         if is_Polyhedron(actor):
--> 4301             return self.product(actor)
-   4302         if is_Vector(actor):
-   4303             return self.translation(actor)
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in product(self, other)
-   3993 
-   3994         parent = self.parent().change_ring(new_ring, ambient_dim=self.ambient_dim() + other.ambient_dim())
--> 3995         return parent.element_class(parent, [new_vertices, new_rays, new_lines], None)
-   3996 
-   3997     _mul_ = product
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in __init__(self, parent, Vrep, Hrep, **kwds)
-    459             sage: TestSuite(p).run()
-    460         """
---> 461         Polyhedron_cdd.__init__(self, parent, Vrep, Hrep, **kwds)
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/base.py in __init__(self, parent, Vrep, Hrep, **kwds)
-    120             vertices, rays, lines = Vrep
-    121             if vertices or rays or lines:
---> 122                 self._init_from_Vrepresentation(vertices, rays, lines, **kwds)
-    123             else:
-    124                 self._init_empty_polyhedron()
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _init_from_Vrepresentation(self, vertices, rays, lines, verbose)
-     61         from .cdd_file_format import cdd_Vrepresentation
-     62         s = cdd_Vrepresentation(self._cdd_type, vertices, rays, lines)
----> 63         s = self._run_cdd(s, '--redcheck', verbose=verbose)
-     64         s = self._run_cdd(s, '--repall', verbose=verbose)
-     65         self._init_from_cdd_output(s)
-
-/srv/public/shared/sage-9.0/local/lib/python3.7/site-packages/sage/geometry/polyhedron/backend_cdd.py in _run_cdd(self, cdd_input_string, cmdline_arg, verbose)
-    163         if 'Error:' in ans + err:
-    164             # cdd reports errors on stdout and misc information on stderr
---> 165             raise ValueError(ans.strip())
-    166         return ans
-    167 
-
+...
 ValueError: *Input Error: Input format is not correct.
 *Format:
  begin
@@ -126,3 +11,9 @@
    b  -A
  end
 ```
+
+We fix this, by converting the values to reals, before passing them to `cdd`.
+
+We enable a doctest prepared by #30293, which implicitly checks that this is fixed.
+
+The above failure will be implicitly added by #29934.
``````




---

archive/issue_comments_597853.json:
```json
{
    "body": "<a id='comment:5'></a>\nNew commits:\n|                                                                                                                                          |                                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[1f00faa](https://github.com/sagemath/sagetrac-mirror/commit/1f00faa1c3f29641675d844cd899c680c367cf65)|`fix lawrence extension with base extension; add test method for lawrence construction`|\n|[8e8158c](https://github.com/sagemath/sagetrac-mirror/commit/8e8158cb49975b2a13a47a6e6f71022c59eb4e13)|`fix missing conversion to RDF`|\n|[319c172](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)|`check lawrence construction with new vertex in RDF`|",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597853",
    "user": "https://github.com/kliem"
}
```

<a id='comment:5'></a>
New commits:
|                                                                                                                                          |                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[1f00faa](https://github.com/sagemath/sagetrac-mirror/commit/1f00faa1c3f29641675d844cd899c680c367cf65)|`fix lawrence extension with base extension; add test method for lawrence construction`|
|[8e8158c](https://github.com/sagemath/sagetrac-mirror/commit/8e8158cb49975b2a13a47a6e6f71022c59eb4e13)|`fix missing conversion to RDF`|
|[319c172](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)|`check lawrence construction with new vertex in RDF`|



---

archive/issue_comments_597854.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-08-10T14:34:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597854",
    "user": "https://github.com/kliem"
}
```

Changing status from new to needs_review.



---

archive/issue_events_088546.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "rename": {
        "from": "Coercion of polyhedra over `RDF` and `AA` fails.",
        "to": "Need to convert values before passing them to `cdd`"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30328#event-88546"
}
```



---

archive/issue_comments_597855.json:
```json
{
    "body": "<a id='comment:7'></a>\nPython 3.8 will complain about this; better to use `==` instead of `is`\n\n```\n+    if cdd_type is 'real':\n```",
    "created_at": "2020-08-10T14:52:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597855",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Python 3.8 will complain about this; better to use `==` instead of `is`

```
+    if cdd_type is 'real':
```



---

archive/issue_comments_597856.json:
```json
{
    "body": "<a id='comment:8'></a>\nReplying to [mkoeppe](#comment%3A7):\n> Python 3.8 will complain about this; better to use `==` instead of `is`\n> \n> ```\n> +    if cdd_type is 'real':\n> ```\n\n\nThanks. I had somewhere in the back of my mind, that one of them is wrong.",
    "created_at": "2020-08-10T14:53:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597856",
    "user": "https://github.com/kliem"
}
```

<a id='comment:8'></a>
Replying to [mkoeppe](#comment%3A7):
> Python 3.8 will complain about this; better to use `==` instead of `is`
> 
> ```
> +    if cdd_type is 'real':
> ```


Thanks. I had somewhere in the back of my mind, that one of them is wrong.



---

archive/issue_comments_597857.json:
```json
{
    "body": "Changing commit from \"[319c172084163f0dce96d90a1762878d7c3a741e](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)\" to \"[96adb63b2430ff5b6b195e7b3132691dd5bfde4d](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)\"",
    "created_at": "2020-08-10T14:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597857",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[319c172084163f0dce96d90a1762878d7c3a741e](https://github.com/sagemath/sagetrac-mirror/commit/319c172084163f0dce96d90a1762878d7c3a741e)" to "[96adb63b2430ff5b6b195e7b3132691dd5bfde4d](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)"



---

archive/issue_comments_597858.json:
```json
{
    "body": "<a id='comment:9'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[96adb63](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)|`python 3.8 compatible`|",
    "created_at": "2020-08-10T14:56:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597858",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:9'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[96adb63](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)|`python 3.8 compatible`|



---

archive/issue_comments_597859.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                       |\n|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|\n|[2481e36](https://github.com/sagemath/sagetrac-mirror/commit/2481e3622e00742a7559961e391aec49298cd372)|`avoid very long tests`|\n|[f6d1327](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)|`add some long time warnings`|",
    "created_at": "2020-08-10T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597859",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                       |
|-------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|
|[2481e36](https://github.com/sagemath/sagetrac-mirror/commit/2481e3622e00742a7559961e391aec49298cd372)|`avoid very long tests`|
|[f6d1327](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)|`add some long time warnings`|



---

archive/issue_comments_597860.json:
```json
{
    "body": "Changing commit from \"[96adb63b2430ff5b6b195e7b3132691dd5bfde4d](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)\" to \"[f6d1327a6fe5f217d01043a845c6c6c3a8a77743](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)\"",
    "created_at": "2020-08-10T15:34:12Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597860",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[96adb63b2430ff5b6b195e7b3132691dd5bfde4d](https://github.com/sagemath/sagetrac-mirror/commit/96adb63b2430ff5b6b195e7b3132691dd5bfde4d)" to "[f6d1327a6fe5f217d01043a845c6c6c3a8a77743](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)"



---

archive/issue_comments_597861.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-10T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597861",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_597862.json:
```json
{
    "body": "Reviewer: Matthias Koeppe",
    "created_at": "2020-08-10T18:45:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597862",
    "user": "https://github.com/mkoeppe"
}
```

Reviewer: Matthias Koeppe



---

archive/issue_comments_597863.json:
```json
{
    "body": "<a id='comment:12'></a>\nThank you.",
    "created_at": "2020-08-10T18:55:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597863",
    "user": "https://github.com/kliem"
}
```

<a id='comment:12'></a>
Thank you.



---

archive/issue_comments_597864.json:
```json
{
    "body": "<a id='comment:13'></a>\nNeeded to rebase on top of #30293 (which had a merge conflict and was rebased on top of the newest beta).\n\n---\nNew commits:\n|                                                                                                                                          |                                                                                       |\n|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|\n|[eaeba9a](https://github.com/sagemath/sagetrac-mirror/commit/eaeba9a739f115f4b11d250ff75e3a40812be1c7)|`fix lawrence extension with base extension; add test method for lawrence construction`|\n|[0c1a2da](https://github.com/sagemath/sagetrac-mirror/commit/0c1a2da24b94abbad54c44e522e1b694046c8e76)|`avoid very long tests`|\n|[d7e07af](https://github.com/sagemath/sagetrac-mirror/commit/d7e07afea623171d56fac51f62bc7d7dc96da312)|`add some long time warnings`|\n|[539930e](https://github.com/sagemath/sagetrac-mirror/commit/539930e4d10bbd9050065b06203f60d6c5963ef1)|`run lawrence_polytope test for cdd and normaliz`|\n|[04a92ef](https://github.com/sagemath/sagetrac-mirror/commit/04a92efa3f51f469287d1c4b813530d2d9f4f708)|`fix missing conversion to RDF`|\n|[3cf080c](https://github.com/sagemath/sagetrac-mirror/commit/3cf080c666e46fd554410dfbec606f8666af0e3a)|`check lawrence construction with new vertex in RDF`|\n|[0be9ed3](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)|`python 3.8 compatible`|",
    "created_at": "2020-08-21T18:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597864",
    "user": "https://github.com/kliem"
}
```

<a id='comment:13'></a>
Needed to rebase on top of #30293 (which had a merge conflict and was rebased on top of the newest beta).

---
New commits:
|                                                                                                                                          |                                                                                       |
|------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------|
|[eaeba9a](https://github.com/sagemath/sagetrac-mirror/commit/eaeba9a739f115f4b11d250ff75e3a40812be1c7)|`fix lawrence extension with base extension; add test method for lawrence construction`|
|[0c1a2da](https://github.com/sagemath/sagetrac-mirror/commit/0c1a2da24b94abbad54c44e522e1b694046c8e76)|`avoid very long tests`|
|[d7e07af](https://github.com/sagemath/sagetrac-mirror/commit/d7e07afea623171d56fac51f62bc7d7dc96da312)|`add some long time warnings`|
|[539930e](https://github.com/sagemath/sagetrac-mirror/commit/539930e4d10bbd9050065b06203f60d6c5963ef1)|`run lawrence_polytope test for cdd and normaliz`|
|[04a92ef](https://github.com/sagemath/sagetrac-mirror/commit/04a92efa3f51f469287d1c4b813530d2d9f4f708)|`fix missing conversion to RDF`|
|[3cf080c](https://github.com/sagemath/sagetrac-mirror/commit/3cf080c666e46fd554410dfbec606f8666af0e3a)|`check lawrence construction with new vertex in RDF`|
|[0be9ed3](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)|`python 3.8 compatible`|



---

archive/issue_comments_597865.json:
```json
{
    "body": "Changing commit from \"[f6d1327a6fe5f217d01043a845c6c6c3a8a77743](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)\" to \"[0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)\"",
    "created_at": "2020-08-21T18:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597865",
    "user": "https://github.com/kliem"
}
```

Changing commit from "[f6d1327a6fe5f217d01043a845c6c6c3a8a77743](https://github.com/sagemath/sagetrac-mirror/commit/f6d1327a6fe5f217d01043a845c6c6c3a8a77743)" to "[0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)"



---

archive/issue_comments_597866.json:
```json
{
    "body": "Changing branch from \"[public/30328](https://github.com/sagemath/sagetrac-mirror/tree/public/30328)\" to \"[public/30328-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/30328-reb)\"",
    "created_at": "2020-08-21T18:26:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597866",
    "user": "https://github.com/kliem"
}
```

Changing branch from "[public/30328](https://github.com/sagemath/sagetrac-mirror/tree/public/30328)" to "[public/30328-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/30328-reb)"



---

archive/issue_comments_597867.json:
```json
{
    "body": "Changing branch from \"[public/30328-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/30328-reb)\" to \"[0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)\"",
    "created_at": "2020-08-26T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597867",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[public/30328-reb](https://github.com/sagemath/sagetrac-mirror/tree/public/30328-reb)" to "[0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760](https://github.com/sagemath/sagetrac-mirror/commit/0be9ed32eb667a4e3bf8b7d460dfa5c7cfaad760)"



---

archive/issue_events_088547.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-26T21:17:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30328#event-88547"
}
```



---

archive/issue_comments_597868.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-26T21:17:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30328",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30328#issuecomment-597868",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
