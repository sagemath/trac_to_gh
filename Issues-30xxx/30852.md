# Issue 30852: let sagelib and sage_sws2rst not depend on six

archive/issues_030615.json:
```json
{
    "body": "The `six` package was part of the Python2-to-Python3 migration scaffolding. Since it is unlikely we will move back to supporting Python 2, we should remove it as a dependency of `sagelib` and `sage_sws2rst`.\n\nBranch/Commit: 608101ef7dfbcadf5f98e5d66fd1f1861e935ccf\n\nReviewer: Fr\u00e9d\u00e9ric Chapoton\n\nAuthor: Thierry Monteil\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30852\n\n",
    "closed_at": "2020-11-22T15:06:16Z",
    "created_at": "2020-11-02T15:45:31Z",
    "labels": [
        "component: python3"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "let sagelib and sage_sws2rst not depend on six",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30852",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```
The `six` package was part of the Python2-to-Python3 migration scaffolding. Since it is unlikely we will move back to supporting Python 2, we should remove it as a dependency of `sagelib` and `sage_sws2rst`.

Branch/Commit: 608101ef7dfbcadf5f98e5d66fd1f1861e935ccf

Reviewer: Frédéric Chapoton

Author: Thierry Monteil

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30852





---

archive/issue_comments_437139.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-11-02T18:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437139",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_437140.json:
```json
{
    "body": "<a id='comment:2'></a>New commits:",
    "created_at": "2020-11-02T18:02:32Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437140",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:2'></a>New commits:



---

archive/issue_comments_437141.json:
```json
{
    "body": "<a id='comment:3'></a>another unsafe ticket..\n\nWould you please explain the change in character_art.py ?",
    "created_at": "2020-11-02T19:02:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437141",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:3'></a>another unsafe ticket..

Would you please explain the change in character_art.py ?



---

archive/issue_comments_437142.json:
```json
{
    "body": "<a id='comment:4'></a>Replying to [comment:3 chapoton]:\n> another unsafe ticket..\n> \n> Would you please explain the change in character_art.py ?\n\n\nAccording to https://six.readthedocs.io/#six.Iterator, in Python3 `six.Iterator` is an alias for `object`, so i simply removed the `six.Iterator` intermediate class so that `PrependIterator` directly inherits from Python object.",
    "created_at": "2020-11-02T21:49:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437142",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:4'></a>Replying to [comment:3 chapoton]:
> another unsafe ticket..
> 
> Would you please explain the change in character_art.py ?


According to https://six.readthedocs.io/#six.Iterator, in Python3 `six.Iterator` is an alias for `object`, so i simply removed the `six.Iterator` intermediate class so that `PrependIterator` directly inherits from Python object.



---

archive/issue_comments_437143.json:
```json
{
    "body": "<a id='comment:5'></a>Some packages list `six` as a build dependency, but that may be out-of-date information: `prompt_toolkit`, `packaging`, `sphinx`, `tox`, `notedown`, `matplotlib`, `html5lib`, `cycler`, `dateutil`, `traitlets`, `sagenb_export`. I took a very quick look at `sphinx` and `prompt_toolkit`, and I think we can remove `six` from their dependencies. I haven't looked at the others.",
    "created_at": "2020-11-02T22:47:13Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437143",
    "user": "https://github.com/jhpalmieri"
}
```

<a id='comment:5'></a>Some packages list `six` as a build dependency, but that may be out-of-date information: `prompt_toolkit`, `packaging`, `sphinx`, `tox`, `notedown`, `matplotlib`, `html5lib`, `cycler`, `dateutil`, `traitlets`, `sagenb_export`. I took a very quick look at `sphinx` and `prompt_toolkit`, and I think we can remove `six` from their dependencies. I haven't looked at the others.



---

archive/issue_comments_437144.json:
```json
{
    "body": "<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-03T10:25:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437144",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:6'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437145.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-11-03T10:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437145",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_comments_437146.json:
```json
{
    "body": "<a id='comment:7'></a>You are right. The last commit removes all occurencies of `six` in the dependencies, let me distclean and see the result.",
    "created_at": "2020-11-03T10:27:54Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437146",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:7'></a>You are right. The last commit removes all occurencies of `six` in the dependencies, let me distclean and see the result.



---

archive/issue_comments_437147.json:
```json
{
    "body": "<a id='comment:8'></a>at least sagenb_export uses six. I have made pull request there to remove this dependency\n\nhttps://github.com/vbraun/ExportSageNB",
    "created_at": "2020-11-03T13:25:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437147",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:8'></a>at least sagenb_export uses six. I have made pull request there to remove this dependency

https://github.com/vbraun/ExportSageNB



---

archive/issue_comments_437148.json:
```json
{
    "body": "<a id='comment:9'></a>Here is what i have seen regarding packages indicating `six` as a dependency:\n\n- seem not to depend on `six` anymore\n  - prompt_toolkit\n  - matplotlib\n\n- require an upgrade from our side\n  - traitlets\n  - packaging (but not yet in a release)\n  - cycler (but not in a release, as they did not release since 2016)\n\n- require upstream to adapt\n  - notedown\n  - dateutil\n  - tox\n  - sagenb_export\n\nApparently, some packages depend on six but the dependency is not written in the dependency file (e.g. `sphinxcontrib_websupport`)",
    "created_at": "2020-11-03T14:37:09Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437148",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:9'></a>Here is what i have seen regarding packages indicating `six` as a dependency:

- seem not to depend on `six` anymore
  - prompt_toolkit
  - matplotlib

- require an upgrade from our side
  - traitlets
  - packaging (but not yet in a release)
  - cycler (but not in a release, as they did not release since 2016)

- require upstream to adapt
  - notedown
  - dateutil
  - tox
  - sagenb_export

Apparently, some packages depend on six but the dependency is not written in the dependency file (e.g. `sphinxcontrib_websupport`)



---

archive/issue_comments_437149.json:
```json
{
    "body": "<a id='comment:10'></a>Given that updating all packages will require various tickets, shall we restrict the scope of this ticket to \"let sagelib not depend on six\" (and keep only the first commit) ?",
    "created_at": "2020-11-03T14:44:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437149",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:10'></a>Given that updating all packages will require various tickets, shall we restrict the scope of this ticket to "let sagelib not depend on six" (and keep only the first commit) ?



---

archive/issue_comments_437150.json:
```json
{
    "body": "<a id='comment:11'></a>I would suggest so.",
    "created_at": "2020-11-03T14:58:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437150",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:11'></a>I would suggest so.



---

archive/issue_comments_437151.json:
```json
{
    "body": "<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:",
    "created_at": "2020-11-03T16:33:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437151",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>Branch pushed to git repo; I updated commit sha1. This was a forced push. New commits:



---

archive/issue_comments_437152.json:
```json
{
    "body": "<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:",
    "created_at": "2020-11-03T20:03:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437152",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:13'></a>Branch pushed to git repo; I updated commit sha1. New commits:



---

archive/issue_comments_437153.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-11-03T20:04:42Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437153",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_437154.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-11-04T10:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437154",
    "user": "https://github.com/fchapoton"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_437155.json:
```json
{
    "body": "<a id='comment:15'></a>ok, ca me parait bon.\n\nIl faudra se debarasser de `iteritems` dans un autre ticket.",
    "created_at": "2020-11-04T10:29:45Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437155",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:15'></a>ok, ca me parait bon.

Il faudra se debarasser de `iteritems` dans un autre ticket.



---

archive/issue_comments_437156.json:
```json
{
    "body": "<a id='comment:16'></a>Replying to [comment:15 chapoton]:\n> ok, ca me parait bon.\n\n\nMerci.\n\n> Il faudra se debarasser de `iteritems` dans un autre ticket.\n\n\nIt was the plan for #30850, then i noticed that various files from `SAGE_ROOT/build/` were touched by #30627, so in order to avoid useless rebasing and confusion i decided to wait it to be merged before cleaning `__future__` import statements from `SAGE_ROOT/build/`.",
    "created_at": "2020-11-04T15:30:22Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437156",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:16'></a>Replying to [comment:15 chapoton]:
> ok, ca me parait bon.


Merci.

> Il faudra se debarasser de `iteritems` dans un autre ticket.


It was the plan for #30850, then i noticed that various files from `SAGE_ROOT/build/` were touched by #30627, so in order to avoid useless rebasing and confusion i decided to wait it to be merged before cleaning `__future__` import statements from `SAGE_ROOT/build/`.



---

archive/issue_comments_437157.json:
```json
{
    "body": "<a id='comment:17'></a>Or you mean in the `.pyx` files ?",
    "created_at": "2020-11-04T15:56:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437157",
    "user": "https://trac.sagemath.org/admin/accounts/users/tmonteil"
}
```

<a id='comment:17'></a>Or you mean in the `.pyx` files ?



---

archive/issue_comments_437158.json:
```json
{
    "body": "<a id='comment:18'></a>I mean that\n\n```\nsrc/sage/categories/finite_dimensional_lie_algebras_with_basis.py:                            for key, coeff in elt.to_vector().iteritems():\nsrc/sage/categories/finite_dimensional_modules_with_basis.py:            return self._from_dict({order[i]: c for i,c in vector.iteritems()})\nsrc/sage/symbolic/relation.py:                    return [[v._sage_() == ex._sage_() for v,ex in d.iteritems()]\n```\nand this may involve our own `iteritem` defined somewhere in a pyx file.",
    "created_at": "2020-11-04T16:45:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437158",
    "user": "https://github.com/fchapoton"
}
```

<a id='comment:18'></a>I mean that

```
src/sage/categories/finite_dimensional_lie_algebras_with_basis.py:                            for key, coeff in elt.to_vector().iteritems():
src/sage/categories/finite_dimensional_modules_with_basis.py:            return self._from_dict({order[i]: c for i,c in vector.iteritems()})
src/sage/symbolic/relation.py:                    return [[v._sage_() == ex._sage_() for v,ex in d.iteritems()]
```
and this may involve our own `iteritem` defined somewhere in a pyx file.



---

archive/issue_events_080500.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-22T15:06:16Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30852#event-80500"
}
```



---

archive/issue_comments_437159.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-11-22T15:06:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30852",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30852#issuecomment-437159",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed
