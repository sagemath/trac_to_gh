# Issue 30972: Versioned installation of threejs

archive/issues_030735.json:
```json
{
    "assignees": [],
    "body": "From Matthias Koeppe on #30915:\n\nWhen we start using Sage with a system jupyter notebook (Meta-ticket #30306), there is an issue involving the installation directory `share/jupyter/nbextensions/threejs`, and the fact that there will be several unrelated (and possibly mutually incompatible) copies of that.\n\nHere is an example.\n\nLet's say:\n- system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.\n- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.\n- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.\n- Let's say r122 and r155 are mutually incompatible.\n\nAs @enriqueartal has reported in #30915, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it is only provided by Sage (and, after #30915 is the result of a custom build (fork) of threejs). \n\nIf we create a symlink `/usr/share/jupyter/nbextensions/threejs` -> `/home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.\n\nThis means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.\n\nIn this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.\n\n(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-sage` for a follow-up.)\n\n\n\nCC:  @jcamp0x2a @kiwifb @mkoeppe @EmmanuelCharpentier @enriqueartal @jhpalmieri @seblabbe @antonio-rojas @defeo @novoselt @dimpase\n\nComponent: **graphics**\n\nKeywords: **threejs, jsmol, jupyter, sd111**\n\nAuthor: **Matthias Koeppe, Joshua Campbell**\n\nBranch/Commit: **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**\n\nReviewer: **Joshua Campbell, Matthias Koeppe, Dima Pasechnik**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30972_\n\n",
    "closed_at": "2021-06-29T17:39:50Z",
    "created_at": "2020-11-27T21:45:43Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20graphics",
        "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Versioned installation of threejs",
    "type": "issue",
    "updated_at": "2021-06-29T17:39:50Z",
    "url": "https://github.com/sagemath/sage/issues/30972",
    "user": "https://github.com/paulmasson"
}
```
From Matthias Koeppe on #30915:

When we start using Sage with a system jupyter notebook (Meta-ticket #30306), there is an issue involving the installation directory `share/jupyter/nbextensions/threejs`, and the fact that there will be several unrelated (and possibly mutually incompatible) copies of that.

Here is an example.

Let's say:
- system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.
- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
- Let's say r122 and r155 are mutually incompatible.

As @enriqueartal has reported in #30915, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it is only provided by Sage (and, after #30915 is the result of a custom build (fork) of threejs). 

If we create a symlink `/usr/share/jupyter/nbextensions/threejs` -> `/home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.

This means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.

In this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.

(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-sage` for a follow-up.)



CC:  @jcamp0x2a @kiwifb @mkoeppe @EmmanuelCharpentier @enriqueartal @jhpalmieri @seblabbe @antonio-rojas @defeo @novoselt @dimpase

Component: **graphics**

Keywords: **threejs, jsmol, jupyter, sd111**

Author: **Matthias Koeppe, Joshua Campbell**

Branch/Commit: **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**

Reviewer: **Joshua Campbell, Matthias Koeppe, Dima Pasechnik**

_Issue created by migration from https://trac.sagemath.org/ticket/30972_





---

archive/issue_events_423983.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-11-27T21:45:43Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423983"
}
```



---

archive/issue_events_423984.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-11-27T21:45:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20graphics",
    "label_color": "0000ff",
    "label_name": "c: graphics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423984"
}
```



---

archive/issue_events_423985.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-11-27T21:45:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423985"
}
```



---

archive/issue_events_423986.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2020-11-27T21:45:43Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423986"
}
```



---

archive/issue_comments_496164.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nI'm no expert on Python, especially the way implementations my differ, but it can access the local file system and Sage already has `THREEJS_DIR`. Why not set the symlink to Three.js or any package when the kernel initially loads? That way the system package will use whatever version accompanies the kernel.",
    "created_at": "2020-11-27T21:50:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496164",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:1" align="right">comment:1</div>

I'm no expert on Python, especially the way implementations my differ, but it can access the local file system and Sage already has `THREEJS_DIR`. Why not set the symlink to Three.js or any package when the kernel initially loads? That way the system package will use whatever version accompanies the kernel.



---

archive/issue_comments_496165.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nThat's not a solution because a user may want to use two different Sage versions at the same time.",
    "created_at": "2020-11-27T21:52:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496165",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:2" align="right">comment:2</div>

That's not a solution because a user may want to use two different Sage versions at the same time.



---

archive/issue_comments_496166.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nReplying to [@mkoeppe](#comment%3A2):\n> That's not a solution because a user may want to use two different Sage versions at the same time.\n\nWhy exactly would someone want to do this? I can see a user not wanting to upgrade to the newest version, but why would they use an older version when the newer one will almost certainly be an improvement?",
    "created_at": "2020-11-28T00:12:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496166",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:3" align="right">comment:3</div>

Replying to [@mkoeppe](#comment%3A2):
> That's not a solution because a user may want to use two different Sage versions at the same time.

Why exactly would someone want to do this? I can see a user not wanting to upgrade to the newest version, but why would they use an older version when the newer one will almost certainly be an improvement?



---

archive/issue_comments_496167.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nShould we use JUPYTER_PATH for this kind of things? https://jupyter.readthedocs.io/en/latest/use/jupyter-directories.html",
    "created_at": "2020-11-28T00:16:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496167",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:4" align="right">comment:4</div>

Should we use JUPYTER_PATH for this kind of things? https://jupyter.readthedocs.io/en/latest/use/jupyter-directories.html



---

archive/issue_comments_496168.json:
```json
{
    "body": "<div id=\"comment:5\" align=\"right\">comment:5</div>\n\nReplying to [@paulmasson](#comment%3A3):\n> Replying to [@mkoeppe](#comment%3A2):\n> > That's not a solution because a user may want to use two different Sage versions at the same time.\n\n> Why exactly would someone want to do this?\n\nUsers have complex needs.",
    "created_at": "2020-11-28T00:25:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496168",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:5" align="right">comment:5</div>

Replying to [@paulmasson](#comment%3A3):
> Replying to [@mkoeppe](#comment%3A2):
> > That's not a solution because a user may want to use two different Sage versions at the same time.

> Why exactly would someone want to do this?

Users have complex needs.



---

archive/issue_comments_496169.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nReplying to [@mkoeppe](#comment%3A5):\n> Replying to [@paulmasson](#comment%3A3):\n> > Replying to [@mkoeppe](#comment%3A2):\n> > > That's not a solution because a user may want to use two different Sage versions at the same time.\n\n> > Why exactly would someone want to do this?\n\n> \n> Users have complex needs.\n\nConsidering that I don't even use Sage, I'll need a better answer than this before devoting more time to this issue. We are not required to support every feature desired by end users. We can simply tell them to run only one kernel at a time. Who is making the decision to support this option?",
    "created_at": "2020-11-28T00:49:31Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496169",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:6" align="right">comment:6</div>

Replying to [@mkoeppe](#comment%3A5):
> Replying to [@paulmasson](#comment%3A3):
> > Replying to [@mkoeppe](#comment%3A2):
> > > That's not a solution because a user may want to use two different Sage versions at the same time.

> > Why exactly would someone want to do this?

> 
> Users have complex needs.

Considering that I don't even use Sage, I'll need a better answer than this before devoting more time to this issue. We are not required to support every feature desired by end users. We can simply tell them to run only one kernel at a time. Who is making the decision to support this option?



---

archive/issue_comments_496170.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nReplying to [@kiwifb](#comment%3A4):\n> Should we use JUPYTER_PATH for this kind of things? https://jupyter.readthedocs.io/en/latest/use/jupyter-directories.html\n\nI don't think this can be solved by using environment variables. The issue is that the notebook may access different kernels when the kernelspec is installed, and (apparently) the notebook webserver is expected to serve the local threejs files. Now these files are kernel-specific (because they are tied to the sagelib version).\n\nFrancois, how do you currently install these files in gentoo packaging?\n(Overall I think we need some input from downstream packaging to make progress here.)",
    "created_at": "2020-11-28T01:13:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496170",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:7" align="right">comment:7</div>

Replying to [@kiwifb](#comment%3A4):
> Should we use JUPYTER_PATH for this kind of things? https://jupyter.readthedocs.io/en/latest/use/jupyter-directories.html

I don't think this can be solved by using environment variables. The issue is that the notebook may access different kernels when the kernelspec is installed, and (apparently) the notebook webserver is expected to serve the local threejs files. Now these files are kernel-specific (because they are tied to the sagelib version).

Francois, how do you currently install these files in gentoo packaging?
(Overall I think we need some input from downstream packaging to make progress here.)



---

archive/issue_comments_496171.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,17 +1,21 @@\n From Matthias Koeppe on #30915:\n \n-The issue is about share/jupyter/nbextensions/threejs and the fact that there will be several unrelated copies of that.\n+When we start using Sage with a system jupyter notebook (Meta-ticket #30306), there is an issue involving the installation directory `share/jupyter/nbextensions/threejs`, and the fact that there will be several unrelated (and possibly mutually incompatible) copies of that.\n \n Here is an example.\n \n-Let's say system jupyter is installed in /usr, so the notebook server is accessing /usr/share/jupyter/nbextensions.\n-Sage-9.x may be installed in /home/x/sage-9.x/local/ and may need threejs r122.\n-Sage-9.y may be installed in /home/x/sage-9.y/local/ and may need threejs r155.\n-Let's say r122 and r155 are mutually incompatible.\n-As @enriqueartal has reported above, our offline threejs graphics needs /usr/share/jupyter/nbextensions/threejs/. But the system does not provide it -- it must come from Sage. If we create a symlink /usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.\n+Let's say:\n+- system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.\n+- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.\n+- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.\n+- Let's say r122 and r155 are mutually incompatible.\n \n-Do you agree?\n+As @enriqueartal has reported in #30915, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it is only provided by Sage (and, after #30915 is the result of a custom build (fork) of threejs). \n \n-So this means that we need a versioned installation scheme. The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.\n+If we create a symlink `/usr/share/jupyter/nbextensions/threejs` -> `/home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.\n+\n+This means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.\n+\n+(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)\n \n \n``````\n",
    "created_at": "2020-11-28T01:37:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496171",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,17 +1,21 @@
 From Matthias Koeppe on #30915:
 
-The issue is about share/jupyter/nbextensions/threejs and the fact that there will be several unrelated copies of that.
+When we start using Sage with a system jupyter notebook (Meta-ticket #30306), there is an issue involving the installation directory `share/jupyter/nbextensions/threejs`, and the fact that there will be several unrelated (and possibly mutually incompatible) copies of that.
 
 Here is an example.
 
-Let's say system jupyter is installed in /usr, so the notebook server is accessing /usr/share/jupyter/nbextensions.
-Sage-9.x may be installed in /home/x/sage-9.x/local/ and may need threejs r122.
-Sage-9.y may be installed in /home/x/sage-9.y/local/ and may need threejs r155.
-Let's say r122 and r155 are mutually incompatible.
-As @enriqueartal has reported above, our offline threejs graphics needs /usr/share/jupyter/nbextensions/threejs/. But the system does not provide it -- it must come from Sage. If we create a symlink /usr/share/jupyter/nbextensions/threejs -> /home/x/sage-9.x/local/share/jupyter/nbextensions/threejs, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.
+Let's say:
+- system jupyter is installed in `/usr`, so the notebook server is accessing `/usr/share/jupyter/nbextensions`.
+- Sage-9.x may be installed in `/home/x/sage-9.x/local/` and may need threejs r122.
+- Sage-9.y may be installed in `/home/x/sage-9.y/local/` and may need threejs r155.
+- Let's say r122 and r155 are mutually incompatible.
 
-Do you agree?
+As @enriqueartal has reported in #30915, our offline threejs graphics needs `/usr/share/jupyter/nbextensions/threejs/`. But the system does not provide it -- it is only provided by Sage (and, after #30915 is the result of a custom build (fork) of threejs). 
 
-So this means that we need a versioned installation scheme. The details of this installation scheme is what I am trying to discuss with you, in particular because it is certainly related to that new repository.
+If we create a symlink `/usr/share/jupyter/nbextensions/threejs` -> `/home/x/sage-9.x/local/share/jupyter/nbextensions/threejs`, then Sage 9.x will work with the system jupyter notebook; but Sage 9.y will not.
+
+This means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.
+
+(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)
 
 
``````




---

archive/issue_events_423987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-28T01:37:55Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "title_is": "Versioned installation of threejs",
    "title_was": "Symlinks and system packages",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423987"
}
```



---

archive/issue_comments_496172.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\nFor \"sagelib\" I disable https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py#L281 because of the way I have to install documentation following Gentoo's guidelines (not everyone in Gentoo is happy with the current way of doing this) and I do the stuff from that line manually. For the rest, sagelib's kernel install is used - it wasn't always the case.\n\nI just change the kernel specs to use the current python directly.\n\nI don't support any versioning of sage whatsoever. Multiple pythons are supported and work thanks to the current Gentoo python infrastructure that supports it. But stuff in `/usr/share/jupyter/` has to be somewhat python independent really.\n\n```\nfbissey@moonloop ~ $ ll /usr/share/jupyter/kernels/sagemath/\ntotal 20K\ndrwxr-xr-x 2 root root 4.0K Nov 27 12:55 .\ndrwxr-xr-x 4 root root 4.0K Apr 21  2020 ..\nlrwxrwxrwx 1 root root   30 Nov 27 12:53 doc -> ../../../doc/sage-9999/html/en\n-rw-r--r-- 1 root root  134 Nov 27 12:53 kernel.json\nlrwxrwxrwx 1 root root   93 Nov 27 12:53 logo-64x64.png -> ../../../../..//usr/lib/python3.8/site-packages/sage/ext_data/notebook-ipython/logo-64x64.png\nlrwxrwxrwx 1 root root   87 Nov 27 12:53 logo.svg -> ../../../../..//usr/lib/python3.8/site-packages/sage/ext_data/notebook-ipython/logo.svg\nfbissey@moonloop ~ $ ll /usr/share/jupyter/nbextensions/\ntotal 12K\ndrwxr-xr-x 3 root root 4.0K Nov 27 12:55 .\ndrwxr-xr-x 5 root root 4.0K Oct 26 21:37 ..\nlrwxrwxrwx 1 root root   16 Nov 27 12:53 jsmol -> /usr/share/jsmol\ndrwxr-xr-x 2 root root 4.0K Nov 19 15:56 jupyter-js-widgets\nlrwxrwxrwx 1 root root   18 Nov 27 12:53 mathjax -> /usr/share/mathjax\nlrwxrwxrwx 1 root root   23 Nov 27 12:53 threejs -> /usr/share/sage/threejs\n```\n`sage-9999` is just sage straight from the git develop branch, so right now 9.2.beta3 (but in my case, Volker's develop branch).\n\nUsers who want versioning, usually are after reproducibility. In that case system packaging is not part of the solution. containers on the other are an ideal tool for that.",
    "created_at": "2020-11-28T01:50:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496172",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:9" align="right">comment:9</div>

For "sagelib" I disable https://github.com/sagemath/sage/blob/develop/src/sage/repl/ipython_kernel/install.py#L281 because of the way I have to install documentation following Gentoo's guidelines (not everyone in Gentoo is happy with the current way of doing this) and I do the stuff from that line manually. For the rest, sagelib's kernel install is used - it wasn't always the case.

I just change the kernel specs to use the current python directly.

I don't support any versioning of sage whatsoever. Multiple pythons are supported and work thanks to the current Gentoo python infrastructure that supports it. But stuff in `/usr/share/jupyter/` has to be somewhat python independent really.

```
fbissey@moonloop ~ $ ll /usr/share/jupyter/kernels/sagemath/
total 20K
drwxr-xr-x 2 root root 4.0K Nov 27 12:55 .
drwxr-xr-x 4 root root 4.0K Apr 21  2020 ..
lrwxrwxrwx 1 root root   30 Nov 27 12:53 doc -> ../../../doc/sage-9999/html/en
-rw-r--r-- 1 root root  134 Nov 27 12:53 kernel.json
lrwxrwxrwx 1 root root   93 Nov 27 12:53 logo-64x64.png -> ../../../../..//usr/lib/python3.8/site-packages/sage/ext_data/notebook-ipython/logo-64x64.png
lrwxrwxrwx 1 root root   87 Nov 27 12:53 logo.svg -> ../../../../..//usr/lib/python3.8/site-packages/sage/ext_data/notebook-ipython/logo.svg
fbissey@moonloop ~ $ ll /usr/share/jupyter/nbextensions/
total 12K
drwxr-xr-x 3 root root 4.0K Nov 27 12:55 .
drwxr-xr-x 5 root root 4.0K Oct 26 21:37 ..
lrwxrwxrwx 1 root root   16 Nov 27 12:53 jsmol -> /usr/share/jsmol
drwxr-xr-x 2 root root 4.0K Nov 19 15:56 jupyter-js-widgets
lrwxrwxrwx 1 root root   18 Nov 27 12:53 mathjax -> /usr/share/mathjax
lrwxrwxrwx 1 root root   23 Nov 27 12:53 threejs -> /usr/share/sage/threejs
```
`sage-9999` is just sage straight from the git develop branch, so right now 9.2.beta3 (but in my case, Volker's develop branch).

Users who want versioning, usually are after reproducibility. In that case system packaging is not part of the solution. containers on the other are an ideal tool for that.



---

archive/issue_comments_496173.json:
```json
{
    "body": "Dependencies: **#30915**",
    "created_at": "2020-11-28T02:00:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496173",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30915**



---

archive/issue_comments_496174.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nI would propose the following installation scheme in `share/` and (via symlink) `share/jupyter/nbextensions/`:\n\n```\n - threejs-sage        (renamed to indicate that it is a fork)\n   - r122/             (subdirectory for the version, replaces meaningless \"build\")\n     - three.min.js\n```",
    "created_at": "2020-11-28T02:25:26Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496174",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:11" align="right">comment:11</div>

I would propose the following installation scheme in `share/` and (via symlink) `share/jupyter/nbextensions/`:

```
 - threejs-sage        (renamed to indicate that it is a fork)
   - r122/             (subdirectory for the version, replaces meaningless "build")
     - three.min.js
```



---

archive/issue_comments_496175.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\nI would also propose to store the version of `threejs` that is required by the scripts / templates in `src/sage/ext_data/threejs/` in a text file in that directory.\n\nFrom a packaging point of view it makes no sense to read this from the `version` file that is installed in `THREEJS_DIR`.",
    "created_at": "2020-11-28T03:18:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496175",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:12" align="right">comment:12</div>

I would also propose to store the version of `threejs` that is required by the scripts / templates in `src/sage/ext_data/threejs/` in a text file in that directory.

From a packaging point of view it makes no sense to read this from the `version` file that is installed in `THREEJS_DIR`.



---

archive/issue_comments_496176.json:
```json
{
    "body": "Branch: **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)**",
    "created_at": "2020-11-28T03:34:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496176",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)**



---

archive/issue_comments_496177.json:
```json
{
    "body": "Commit: **[`938bff4`](https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66)**",
    "created_at": "2020-11-28T03:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496177",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`938bff4`](https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66)**



---

archive/issue_comments_496178.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nHere's a draft (untested)\n\n---\nLast 10 new commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/63530d2029ef7dd07f5437220ec02f27ded02457\"><code>63530d2</code></a></td><td><code>Update script link generation</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/82b8888f142d193ada736c32d1f8e358a6380878\"><code>82b8888</code></a></td><td><code>Update online link</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/55449d83b20c85a9e80db210e5e2b2325987db0b\"><code>55449d8</code></a></td><td><code>Update upstream URL</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/eed14d3dc1b9f69cada9a54bb377f94ad145ec3f\"><code>eed14d3</code></a></td><td><code>Fix doctest and rename more 'scripts' to 'script'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0974392afc80a51693d40896a21c8e9902a7f27\"><code>c097439</code></a></td><td><code>Revert threejs_scripts method name changes</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c2204a41455820eca448b6636a8582911606df96\"><code>c2204a4</code></a></td><td><code>Merge branch 'u/gh-jcamp0x2a/threejs-r122' of git://trac.sagemath.org/sage into t/30972/versioned_installation_of_threejs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/1fc3d4cf8050c70e07906f56f88929556748519d\"><code>1fc3d4c</code></a></td><td><code>build/pkgs/threejs: Install in /threejs-sage/rVERSION/</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c8e707c031cea525aad4d2bfbad7c5e77eed4462\"><code>c8e707c</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py: Change from threejs to threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b\"><code>5e1ca4e</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66\"><code>938bff4</code></a></td><td><code>Read required threejs version from ext_data</code></td></tr></table>\n",
    "created_at": "2020-11-28T03:34:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496178",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:14" align="right">comment:14</div>

Here's a draft (untested)

---
Last 10 new commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/63530d2029ef7dd07f5437220ec02f27ded02457"><code>63530d2</code></a></td><td><code>Update script link generation</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/82b8888f142d193ada736c32d1f8e358a6380878"><code>82b8888</code></a></td><td><code>Update online link</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/55449d83b20c85a9e80db210e5e2b2325987db0b"><code>55449d8</code></a></td><td><code>Update upstream URL</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/eed14d3dc1b9f69cada9a54bb377f94ad145ec3f"><code>eed14d3</code></a></td><td><code>Fix doctest and rename more 'scripts' to 'script'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0974392afc80a51693d40896a21c8e9902a7f27"><code>c097439</code></a></td><td><code>Revert threejs_scripts method name changes</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c2204a41455820eca448b6636a8582911606df96"><code>c2204a4</code></a></td><td><code>Merge branch 'u/gh-jcamp0x2a/threejs-r122' of git://trac.sagemath.org/sage into t/30972/versioned_installation_of_threejs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/1fc3d4cf8050c70e07906f56f88929556748519d"><code>1fc3d4c</code></a></td><td><code>build/pkgs/threejs: Install in /threejs-sage/rVERSION/</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c8e707c031cea525aad4d2bfbad7c5e77eed4462"><code>c8e707c</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py: Change from threejs to threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5e1ca4e066517147edc2c43dc291e2ebe126225b"><code>5e1ca4e</code></a></td><td><code>src/sage/repl/ipython_kernel/install.py, src/sage/env.py, build/pkgs/sage_conf: Change from threejs to threejs-sage</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66"><code>938bff4</code></a></td><td><code>Read required threejs version from ext_data</code></td></tr></table>




---

archive/issue_comments_496179.json:
```json
{
    "body": "Changed commit from **[`938bff4`](https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66)** to **[`f847738`](https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab)**",
    "created_at": "2020-11-28T03:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496179",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`938bff4`](https://github.com/sagemath/sagetrac-mirror/commit/938bff40dbf6a3d5c96b5a90cffff6691c26db66)** to **[`f847738`](https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab)**



---

archive/issue_comments_496180.json:
```json
{
    "body": "<div id=\"comment:15\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab\"><code>f847738</code></a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr></table>\n",
    "created_at": "2020-11-28T03:38:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496180",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:15"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab"><code>f847738</code></a></td><td><code>src/sage/repl/rich_output/backend_ipython.py: Another change threejs -> threejs-sage</code></td></tr></table>




---

archive/issue_comments_496181.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-11-28T03:41:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496181",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_496182.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -16,6 +16,8 @@\n \n This means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.\n \n+In this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.\n+\n (On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)\n \n \n``````\n",
    "created_at": "2020-11-28T03:43:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496182",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -16,6 +16,8 @@
 
 This means that we need a versioned installation scheme so that offline threejs graphics can access the specific version it needs even if the user is accessing Sage through the system notebook.
 
+In this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.
+
 (On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)
 
 
``````




---

archive/issue_events_423988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-28T04:00:17Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423988"
}
```



---

archive/issue_comments_496183.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -18,6 +18,6 @@\n \n In this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.\n \n-(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)\n+(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-sage` for a follow-up.)\n \n \n``````\n",
    "created_at": "2020-11-28T04:02:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496183",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -18,6 +18,6 @@
 
 In this ticket we also rename directories from `threejs` to `threejs-sage` (in `share/` and `share/jupyter/nbextensions/`) to reflect the fact that it is a Sage-specific fork.  This will reduce the need for downstream patching.
 
-(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-minimal` for a follow-up.)
+(On this ticket we ignore the separate issue that installing such symlinks is not user-friendly -- see #30123 Repackage Sage's cropped `threejs` as a pip-installable package `jupyter-threejs-sage` for a follow-up.)
 
 
``````




---

archive/issue_comments_496184.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nI guess I can accomodate that. I already ship threejs as a sage specific component in `/usr/share/sage`. I have to think if I will allow several versions of threejs on the system at once.",
    "created_at": "2020-11-28T04:11:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496184",
    "user": "https://github.com/kiwifb"
}
```

<div id="comment:20" align="right">comment:20</div>

I guess I can accomodate that. I already ship threejs as a sage specific component in `/usr/share/sage`. I have to think if I will allow several versions of threejs on the system at once.



---

archive/issue_comments_496185.json:
```json
{
    "body": "Changed commit from **[`f847738`](https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab)** to **[`d13177d`](https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6)**",
    "created_at": "2020-11-28T05:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496185",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f847738`](https://github.com/sagemath/sagetrac-mirror/commit/f847738d8367ea931af8f955a72cf1a4f64913ab)** to **[`d13177d`](https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6)**



---

archive/issue_comments_496186.json:
```json
{
    "body": "<div id=\"comment:21\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6\"><code>d13177d</code></a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr></table>\n",
    "created_at": "2020-11-28T05:22:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496186",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:21"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6"><code>d13177d</code></a></td><td><code>src/sage/repl/rich_output/display_manager.py: Fix up imports</code></td></tr></table>




---

archive/issue_comments_496187.json:
```json
{
    "body": "<div id=\"comment:22\" align=\"right\">comment:22</div>\n\nThis version passes the testsuite. Manual testing would be appreciated.",
    "created_at": "2020-11-28T05:23:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496187",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:22" align="right">comment:22</div>

This version passes the testsuite. Manual testing would be appreciated.



---

archive/issue_comments_496188.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)** to **[u/gh-jcamp0x2a/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-jcamp0x2a/versioned_installation_of_threejs)**",
    "created_at": "2020-11-29T02:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496188",
    "user": "https://github.com/jcamp0x2a"
}
```

Changed branch from **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)** to **[u/gh-jcamp0x2a/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-jcamp0x2a/versioned_installation_of_threejs)**



---

archive/issue_comments_496189.json:
```json
{
    "body": "Changed commit from **[`d13177d`](https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6)** to **[`47e795b`](https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2)**",
    "created_at": "2020-11-29T02:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496189",
    "user": "https://github.com/jcamp0x2a"
}
```

Changed commit from **[`d13177d`](https://github.com/sagemath/sagetrac-mirror/commit/d13177d1a89cc6bb643411b8bb8b233f9e1a54a6)** to **[`47e795b`](https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2)**



---

archive/issue_comments_496190.json:
```json
{
    "body": "Changed author from **Matthias Koeppe** to **Matthias Koeppe, Joshua Campbell**",
    "created_at": "2020-11-29T02:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496190",
    "user": "https://github.com/jcamp0x2a"
}
```

Changed author from **Matthias Koeppe** to **Matthias Koeppe, Joshua Campbell**



---

archive/issue_comments_496191.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment%3A22):\n> This version passes the testsuite. Manual testing would be appreciated.\n\nI had to update the path in `sage.repl.rich_output.backend_ipython.BackendIPythonNotebook.threejs_offline_scripts` similar to what you did for `BackendIPythonCommandline` in order to avoid 404s in jupyter/jupyterlab.\n\nSince I already had the fix locally, I hope you don't mind that I've gone ahead and pushed it and pointed the ticket at it.\n\nRan both `online=True` and `online=False` for the command-line, jupyter, and jupyterlab. I also verified that the CDN fallback works for jupyter and jupyterlab (for the \"Save as HTML\" feature).\n\n---\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2\"><code>47e795b</code></a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr></table>\n",
    "created_at": "2020-11-29T02:58:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496191",
    "user": "https://github.com/jcamp0x2a"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment%3A22):
> This version passes the testsuite. Manual testing would be appreciated.

I had to update the path in `sage.repl.rich_output.backend_ipython.BackendIPythonNotebook.threejs_offline_scripts` similar to what you did for `BackendIPythonCommandline` in order to avoid 404s in jupyter/jupyterlab.

Since I already had the fix locally, I hope you don't mind that I've gone ahead and pushed it and pointed the ticket at it.

Ran both `online=True` and `online=False` for the command-line, jupyter, and jupyterlab. I also verified that the CDN fallback works for jupyter and jupyterlab (for the "Save as HTML" feature).

---
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2"><code>47e795b</code></a></td><td><code>Fix 404 fetching three.min.js from Jupyter/JupyterLab</code></td></tr></table>




---

archive/issue_comments_496192.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nThanks for catching and fixing this!",
    "created_at": "2020-11-29T03:01:10Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496192",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:24" align="right">comment:24</div>

Thanks for catching and fixing this!



---

archive/issue_comments_496193.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nIf the plan is to start shipping multiple old versions of Three.js with every new Sage release, then I don't much like that idea. If goes against the entire sense of improving software with a new release.\n\nI would rather implement an idea Joshua raised some time ago on a ticket I can't locate: separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template. If that were a separate package it would track the correct version of Three.js by default.\n\nJoshua, can you remember which ticket had your thoughts on this? Are you game to take a crack at implementing this?",
    "created_at": "2020-12-03T00:18:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496193",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:25" align="right">comment:25</div>

If the plan is to start shipping multiple old versions of Three.js with every new Sage release, then I don't much like that idea. If goes against the entire sense of improving software with a new release.

I would rather implement an idea Joshua raised some time ago on a ticket I can't locate: separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template. If that were a separate package it would track the correct version of Three.js by default.

Joshua, can you remember which ticket had your thoughts on this? Are you game to take a crack at implementing this?



---

archive/issue_comments_496194.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@paulmasson](#comment%3A25):\n> [...] goes against the entire sense of improving software with a new release.\n\nHardly. It's just like installing old versions of shared libraries in a system in addition to the current libraries so that old programs can continue to run.",
    "created_at": "2020-12-03T00:30:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496194",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@paulmasson](#comment%3A25):
> [...] goes against the entire sense of improving software with a new release.

Hardly. It's just like installing old versions of shared libraries in a system in addition to the current libraries so that old programs can continue to run.



---

archive/issue_comments_496195.json:
```json
{
    "body": "<div id=\"comment:27\" align=\"right\">comment:27</div>\n\nReplying to [@paulmasson](#comment%3A25):\n> separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template.\n\nThe problem remains that the Javascript code needs to be accessed by the Jupyter installation (notebook server), whereas the template needs to be accessed by Sage (Python code). These are in general separate installations - as I have explained with the example in the ticket description. So I don't think that this will help unless I misunderstand something there.",
    "created_at": "2020-12-03T00:38:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496195",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:27" align="right">comment:27</div>

Replying to [@paulmasson](#comment%3A25):
> separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template.

The problem remains that the Javascript code needs to be accessed by the Jupyter installation (notebook server), whereas the template needs to be accessed by Sage (Python code). These are in general separate installations - as I have explained with the example in the ticket description. So I don't think that this will help unless I misunderstand something there.



---

archive/issue_comments_496196.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nAlso, note that this ticket here does not change how many versions of the javascript file are installed by the distribution. It only changes the installation path to include a version number, which solves the problem described in the ticket description.",
    "created_at": "2020-12-03T04:10:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496196",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Also, note that this ticket here does not change how many versions of the javascript file are installed by the distribution. It only changes the installation path to include a version number, which solves the problem described in the ticket description.



---

archive/issue_comments_496197.json:
```json
{
    "body": "<div id=\"comment:29\" align=\"right\">comment:29</div>\n\nReplying to [@paulmasson](#comment%3A25):\n> I would rather implement an idea Joshua raised some time ago on a ticket I can't locate: separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template. If that were a separate package it would track the correct version of Three.js by default.\n> \n> Joshua, can you remember which ticket had your thoughts on this?\n\nI believe this was [#30620 comment:4](https://github.com/sagemath/sage/issues/30620#comment:4) and [#30620 comment:7](https://github.com/sagemath/sage/issues/30620#comment:7) (\"Three.js: future of examples/js files\").\n\nI don't think it'd solve the present versioning issue, though. We'd just be worrying about providing multiple offline versions of this new package instead.",
    "created_at": "2020-12-03T15:51:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496197",
    "user": "https://github.com/jcamp0x2a"
}
```

<div id="comment:29" align="right">comment:29</div>

Replying to [@paulmasson](#comment%3A25):
> I would rather implement an idea Joshua raised some time ago on a ticket I can't locate: separate the Three.js viewer as a stand-alone package and keep all the versioning issues there. All of the dependencies of Sage on Three.js are in the template. If that were a separate package it would track the correct version of Three.js by default.
> 
> Joshua, can you remember which ticket had your thoughts on this?

I believe this was [#30620 comment:4](https://github.com/sagemath/sage/issues/30620#comment:4) and [#30620 comment:7](https://github.com/sagemath/sage/issues/30620#comment:7) ("Three.js: future of examples/js files").

I don't think it'd solve the present versioning issue, though. We'd just be worrying about providing multiple offline versions of this new package instead.



---

archive/issue_events_423989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-04T19:32:42Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20major%20/%203",
    "label_color": "ffbb00",
    "label_name": "p: major / 3",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423989"
}
```



---

archive/issue_events_423990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-12-04T19:32:42Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/p%3A%20critical%20/%202",
    "label_color": "ff7700",
    "label_name": "p: critical / 2",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423990"
}
```



---

archive/issue_comments_496198.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nNeeds review. Let's please get this in - it's a prerequisite so that we can write sane instructions on how to run a fully functional [SageMath](../wiki/SageMath) jupyter kernel in a system jupyter notebook or jupyterlab (#30476) into Sage 9.3",
    "created_at": "2020-12-04T19:32:42Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496198",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Needs review. Let's please get this in - it's a prerequisite so that we can write sane instructions on how to run a fully functional [SageMath](../wiki/SageMath) jupyter kernel in a system jupyter notebook or jupyterlab (#30476) into Sage 9.3



---

archive/issue_comments_496199.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496199",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_496200.json:
```json
{
    "body": "Changed keywords from **threejs jsmol jupyter** to **threejs, jsmol, jupyter, sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496200",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from **threejs jsmol jupyter** to **threejs, jsmol, jupyter, sd111**



---

archive/issue_comments_496201.json:
```json
{
    "body": "Reviewer: **Joshua Campbell**",
    "created_at": "2021-01-05T01:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496201",
    "user": "https://github.com/jcamp0x2a"
}
```

Reviewer: **Joshua Campbell**



---

archive/issue_events_423991.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2021-01-05T01:46:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423991"
}
```



---

archive/issue_events_423992.json:
```json
{
    "actor": "https://github.com/jcamp0x2a",
    "created_at": "2021-01-05T01:46:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423992"
}
```



---

archive/issue_comments_496202.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nI went ahead and re-tested the branch in the command-line, jupyter, and jupyterlab with both `online=True` and `online=False` and checked that plots saved using the `Save as HTML` feature still function.\n\nI don't know how frowned upon it is to positively review a ticket you're listed as one of the authors of, but since this ticket has been in review for awhile without a bite, I'm going to go ahead and do so. Please feel free to change it back if there is any objection.",
    "created_at": "2021-01-05T01:46:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496202",
    "user": "https://github.com/jcamp0x2a"
}
```

<div id="comment:35" align="right">comment:35</div>

I went ahead and re-tested the branch in the command-line, jupyter, and jupyterlab with both `online=True` and `online=False` and checked that plots saved using the `Save as HTML` feature still function.

I don't know how frowned upon it is to positively review a ticket you're listed as one of the authors of, but since this ticket has been in review for awhile without a bite, I'm going to go ahead and do so. Please feel free to change it back if there is any objection.



---

archive/issue_comments_496203.json:
```json
{
    "body": "Changed reviewer from **Joshua Campbell** to **Joshua Campbell, Matthias Koeppe**",
    "created_at": "2021-01-05T01:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496203",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Joshua Campbell** to **Joshua Campbell, Matthias Koeppe**



---

archive/issue_comments_496204.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThanks. I have reviewed the changes that you made on the ticket.",
    "created_at": "2021-01-05T01:54:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496204",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:36" align="right">comment:36</div>

Thanks. I have reviewed the changes that you made on the ticket.



---

archive/issue_events_423993.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2021-01-05T02:18:51Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423993"
}
```



---

archive/issue_events_423994.json:
```json
{
    "actor": "https://github.com/paulmasson",
    "created_at": "2021-01-05T02:18:51Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423994"
}
```



---

archive/issue_comments_496205.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nI strongly object to the two authors reviewing this ticket. I have yet to receive a cogent answer as to why someone would want to run two or more versions of Sage at the same time. This ticket also needs more input from distribution managers, who may not want to support this behavior. There need to be other voices clearly in favor of the direction this ticket moves, a direction I for one do not support.",
    "created_at": "2021-01-05T02:18:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496205",
    "user": "https://github.com/paulmasson"
}
```

<div id="comment:37" align="right">comment:37</div>

I strongly object to the two authors reviewing this ticket. I have yet to receive a cogent answer as to why someone would want to run two or more versions of Sage at the same time. This ticket also needs more input from distribution managers, who may not want to support this behavior. There need to be other voices clearly in favor of the direction this ticket moves, a direction I for one do not support.



---

archive/issue_comments_496206.json:
```json
{
    "body": "<div id=\"comment:38\" align=\"right\">comment:38</div>\n\nReplying to [@paulmasson](#comment%3A37):\n> I strongly object to the two authors reviewing this ticket. I have yet to receive a cogent answer as to why someone would want to run two or more versions of Sage at the same time. This ticket also needs more input from distribution managers, who may not want to support this behavior. There need to be other voices clearly in favor of the direction this ticket moves, a direction I for one do not support.\n\nApologies. I did not realize there were outstanding questions about the use case's validity, of which I can not personally attest. Just saw that it was in review for awhile yet functioning 'correctly' (to ticket's spec).",
    "created_at": "2021-01-05T02:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496206",
    "user": "https://github.com/jcamp0x2a"
}
```

<div id="comment:38" align="right">comment:38</div>

Replying to [@paulmasson](#comment%3A37):
> I strongly object to the two authors reviewing this ticket. I have yet to receive a cogent answer as to why someone would want to run two or more versions of Sage at the same time. This ticket also needs more input from distribution managers, who may not want to support this behavior. There need to be other voices clearly in favor of the direction this ticket moves, a direction I for one do not support.

Apologies. I did not realize there were outstanding questions about the use case's validity, of which I can not personally attest. Just saw that it was in review for awhile yet functioning 'correctly' (to ticket's spec).



---

archive/issue_comments_496207.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nPaul, if you have a specific technical objection to the change that this ticket proposes, it would probably be helpful for the discussion to try to articulate it.",
    "created_at": "2021-01-05T03:02:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496207",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:39" align="right">comment:39</div>

Paul, if you have a specific technical objection to the change that this ticket proposes, it would probably be helpful for the discussion to try to articulate it.



---

archive/issue_comments_496208.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nLet's discuss what the ticket changes step by step.\n\n1) renames directories from `threejs` to `threejs-sage` (in share/ and share/jupyter/nbextensions/) to reflect the fact that it is a Sage-specific fork\n\nfor example in this change\n\n```\n-THREEJS_DIR = \"@prefix@/share/threejs\"\n+THREEJS_DIR = \"@prefix@/share/threejs-sage\"\n```\n\nAny concerns or objections to that?",
    "created_at": "2021-01-05T03:27:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496208",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:40" align="right">comment:40</div>

Let's discuss what the ticket changes step by step.

1) renames directories from `threejs` to `threejs-sage` (in share/ and share/jupyter/nbextensions/) to reflect the fact that it is a Sage-specific fork

for example in this change

```
-THREEJS_DIR = "@prefix@/share/threejs"
+THREEJS_DIR = "@prefix@/share/threejs-sage"
```

Any concerns or objections to that?



---

archive/issue_events_423995.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-05T17:02:04Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20info",
    "label_color": "ffff00",
    "label_name": "needs info",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423995"
}
```



---

archive/issue_events_423996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-01-05T17:02:04Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423996"
}
```



---

archive/issue_comments_496209.json:
```json
{
    "body": "Changed branch from **[u/gh-jcamp0x2a/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-jcamp0x2a/versioned_installation_of_threejs)** to **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)**",
    "created_at": "2021-01-17T19:18:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496209",
    "user": "https://github.com/mkoeppe"
}
```

Changed branch from **[u/gh-jcamp0x2a/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/gh-jcamp0x2a/versioned_installation_of_threejs)** to **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)**



---

archive/issue_comments_496210.json:
```json
{
    "body": "Changed dependencies from **#30915** to none",
    "created_at": "2021-01-17T19:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496210",
    "user": "https://github.com/mkoeppe"
}
```

Changed dependencies from **#30915** to none



---

archive/issue_comments_496211.json:
```json
{
    "body": "Changed reviewer from **Joshua Campbell, Matthias Koeppe** to **Joshua Campbell, Matthias Koeppe, ...**",
    "created_at": "2021-01-17T19:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496211",
    "user": "https://github.com/mkoeppe"
}
```

Changed reviewer from **Joshua Campbell, Matthias Koeppe** to **Joshua Campbell, Matthias Koeppe, ...**



---

archive/issue_comments_496212.json:
```json
{
    "body": "Changed commit from **[`47e795b`](https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2)** to **[`0b24127`](https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82)**",
    "created_at": "2021-01-17T19:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496212",
    "user": "https://github.com/mkoeppe"
}
```

Changed commit from **[`47e795b`](https://github.com/sagemath/sagetrac-mirror/commit/47e795ba807db4eb4c742099f3d56cada76fc9b2)** to **[`0b24127`](https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82)**



---

archive/issue_comments_496213.json:
```json
{
    "body": "<div id=\"comment:43\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82\"><code>0b24127</code></a></td><td><code>Merge tag '9.3.beta6' into t/30972/versioned_installation_of_threejs</code></td></tr></table>\n",
    "created_at": "2021-01-17T19:18:41Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496213",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:43"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82"><code>0b24127</code></a></td><td><code>Merge tag '9.3.beta6' into t/30972/versioned_installation_of_threejs</code></td></tr></table>




---

archive/issue_events_423997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:31Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423997"
}
```



---

archive/issue_events_423998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-03-08T19:45:31Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423998"
}
```



---

archive/issue_comments_496214.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nplease rebase",
    "created_at": "2021-06-21T15:34:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496214",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:46" align="right">comment:46</div>

please rebase



---

archive/issue_comments_496215.json:
```json
{
    "body": "<div id=\"comment:47\" align=\"right\">comment:47</div>\n\nUse cases for having several versions of Sage installed\n\n- install new version & keep old one for code you lack time to adapt\n- stable release for normal use, beta for development work\n- keep several versions around for the sake of bisecting\n  breaking changes\n- bare version and version with many optional packages installed",
    "created_at": "2021-06-21T22:51:17Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496215",
    "user": "https://github.com/slel"
}
```

<div id="comment:47" align="right">comment:47</div>

Use cases for having several versions of Sage installed

- install new version & keep old one for code you lack time to adapt
- stable release for normal use, beta for development work
- keep several versions around for the sake of bisecting
  breaking changes
- bare version and version with many optional packages installed



---

archive/issue_comments_496216.json:
```json
{
    "body": "Changed commit from **[`0b24127`](https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82)** to **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**",
    "created_at": "2021-06-22T01:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496216",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`0b24127`](https://github.com/sagemath/sagetrac-mirror/commit/0b24127485224cd1f4d16f5200132cfedf2f5d82)** to **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**



---

archive/issue_comments_496217.json:
```json
{
    "body": "<div id=\"comment:48\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3\"><code>935dcef</code></a></td><td><code>Merge tag '9.4.beta3' into t/30972/versioned_installation_of_threejs</code></td></tr></table>\n",
    "created_at": "2021-06-22T01:00:54Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496217",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:48"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3"><code>935dcef</code></a></td><td><code>Merge tag '9.4.beta3' into t/30972/versioned_installation_of_threejs</code></td></tr></table>




---

archive/issue_comments_496218.json:
```json
{
    "body": "<div id=\"comment:49\" align=\"right\">comment:49</div>\n\nReplying to [@paulmasson](#comment%3A6):\n> Replying to [@mkoeppe](#comment%3A5):\n> > Replying to [@paulmasson](#comment%3A3):\n> > > Replying to [@mkoeppe](#comment%3A2):\n> > > > That's not a solution because a user may want to use two different Sage versions at the same time.\n\n> > > Why exactly would someone want to do this?\n\n> > \n> > Users have complex needs.\n\n> Considering that I don't even use Sage, I'll need a better answer than this before devoting more time to this issue. We are not required to support every feature desired by end users. We can simply tell them to run only one kernel at a time. Who is making the decision to support this option?\n\nfor instance one can have two copies of Sage built with different compilers. At least for Sage development purposes it's very normal to have several installations of Sage on a box.",
    "created_at": "2021-06-24T10:45:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496218",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:49" align="right">comment:49</div>

Replying to [@paulmasson](#comment%3A6):
> Replying to [@mkoeppe](#comment%3A5):
> > Replying to [@paulmasson](#comment%3A3):
> > > Replying to [@mkoeppe](#comment%3A2):
> > > > That's not a solution because a user may want to use two different Sage versions at the same time.

> > > Why exactly would someone want to do this?

> > 
> > Users have complex needs.

> Considering that I don't even use Sage, I'll need a better answer than this before devoting more time to this issue. We are not required to support every feature desired by end users. We can simply tell them to run only one kernel at a time. Who is making the decision to support this option?

for instance one can have two copies of Sage built with different compilers. At least for Sage development purposes it's very normal to have several installations of Sage on a box.



---

archive/issue_comments_496219.json:
```json
{
    "body": "<div id=\"comment:50\" align=\"right\">comment:50</div>\n\nHow does one test this with, say, jupyterlab installed by Homebrew?",
    "created_at": "2021-06-24T11:40:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496219",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:50" align="right">comment:50</div>

How does one test this with, say, jupyterlab installed by Homebrew?



---

archive/issue_comments_496220.json:
```json
{
    "body": "<div id=\"comment:51\" align=\"right\">comment:51</div>\n\nReplying to [@dimpase](#comment%3A50):\n> How does one test this with, say, jupyterlab installed by Homebrew?\n\nYou would follow the instructions in our manual added in #30476\n(https://doc.sagemath.org/html/en/installation/launching.html#setting-up-sagemath-as-a-jupyter-kernel-in-an-existing-jupyter-notebook-or-jupyterlab-installation)",
    "created_at": "2021-06-24T23:12:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496220",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:51" align="right">comment:51</div>

Replying to [@dimpase](#comment%3A50):
> How does one test this with, say, jupyterlab installed by Homebrew?

You would follow the instructions in our manual added in #30476
(https://doc.sagemath.org/html/en/installation/launching.html#setting-up-sagemath-as-a-jupyter-kernel-in-an-existing-jupyter-notebook-or-jupyterlab-installation)



---

archive/issue_comments_496221.json:
```json
{
    "body": "<div id=\"comment:52\" align=\"right\">comment:52</div>\n\nUnfortunately these instructions are outdated: on macOS I get\n\n```\n% jupyter kernelspec install --user `pwd`/local/share/jupyter/kernels/sagemath                             \nTraceback (most recent call last):\n  File \"/usr/local/Cellar/jupyterlab/3.0.16/libexec/bin/jupyter-kernelspec\", line 33, in <module>\n    sys.exit(load_entry_point('jupyter-client==6.1.12', 'console_scripts', 'jupyter-kernelspec')())\n  File \"/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/traitlets/config/application.py\", line 845, in launch_instance\n    app.start()\n  File \"/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspecapp.py\", line 266, in start\n    return self.subapp.start()\n  File \"/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspecapp.py\", line 132, in start\n    self.kernel_spec_manager.install_kernel_spec(self.sourcedir,\n  File \"/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspec.py\", line 340, in install_kernel_spec\n    shutil.copytree(source_dir, destination)\n  File \"/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/shutil.py\", line 557, in copytree\n    return _copytree(entries=entries, src=src, dst=dst, symlinks=symlinks,\n  File \"/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/shutil.py\", line 513, in _copytree\n    raise Error(errors)\nshutil.Error: [('/Users/dima/sage/local/share/jupyter/kernels/sagemath/doc', '/Users/dima/Library/Jupyter/kernels/sagemath/doc', \"[Errno 2] No such file or directory: '/Users/dima/sage/local/share/jupyter/kernels/sagemath/doc'\")]\n```",
    "created_at": "2021-06-27T19:39:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496221",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:52" align="right">comment:52</div>

Unfortunately these instructions are outdated: on macOS I get

```
% jupyter kernelspec install --user `pwd`/local/share/jupyter/kernels/sagemath                             
Traceback (most recent call last):
  File "/usr/local/Cellar/jupyterlab/3.0.16/libexec/bin/jupyter-kernelspec", line 33, in <module>
    sys.exit(load_entry_point('jupyter-client==6.1.12', 'console_scripts', 'jupyter-kernelspec')())
  File "/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/traitlets/config/application.py", line 845, in launch_instance
    app.start()
  File "/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspecapp.py", line 266, in start
    return self.subapp.start()
  File "/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspecapp.py", line 132, in start
    self.kernel_spec_manager.install_kernel_spec(self.sourcedir,
  File "/usr/local/Cellar/jupyterlab/3.0.16/libexec/lib/python3.9/site-packages/jupyter_client/kernelspec.py", line 340, in install_kernel_spec
    shutil.copytree(source_dir, destination)
  File "/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/shutil.py", line 557, in copytree
    return _copytree(entries=entries, src=src, dst=dst, symlinks=symlinks,
  File "/usr/local/Cellar/python@3.9/3.9.5/Frameworks/Python.framework/Versions/3.9/lib/python3.9/shutil.py", line 513, in _copytree
    raise Error(errors)
shutil.Error: [('/Users/dima/sage/local/share/jupyter/kernels/sagemath/doc', '/Users/dima/Library/Jupyter/kernels/sagemath/doc', "[Errno 2] No such file or directory: '/Users/dima/sage/local/share/jupyter/kernels/sagemath/doc'")]
```



---

archive/issue_comments_496222.json:
```json
{
    "body": "<div id=\"comment:53\" align=\"right\">comment:53</div>\n\nLooks to me like someone forgot to build the documentation",
    "created_at": "2021-06-27T19:42:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496222",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:53" align="right">comment:53</div>

Looks to me like someone forgot to build the documentation



---

archive/issue_events_423999.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-27T20:52:47Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-423999"
}
```



---

archive/issue_events_424000.json:
```json
{
    "actor": "https://github.com/dimpase",
    "created_at": "2021-06-27T20:52:47Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-424000"
}
```



---

archive/issue_comments_496223.json:
```json
{
    "body": "Changed reviewer from **Joshua Campbell, Matthias Koeppe, ...** to **Joshua Campbell, Matthias Koeppe, Dima Pasechnik**",
    "created_at": "2021-06-27T20:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496223",
    "user": "https://github.com/dimpase"
}
```

Changed reviewer from **Joshua Campbell, Matthias Koeppe, ...** to **Joshua Campbell, Matthias Koeppe, Dima Pasechnik**



---

archive/issue_comments_496224.json:
```json
{
    "body": "<div id=\"comment:54\" align=\"right\">comment:54</div>\n\nOK, this works, sorry for noise.",
    "created_at": "2021-06-27T20:52:47Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496224",
    "user": "https://github.com/dimpase"
}
```

<div id="comment:54" align="right">comment:54</div>

OK, this works, sorry for noise.



---

archive/issue_comments_496225.json:
```json
{
    "body": "<div id=\"comment:55\" align=\"right\">comment:55</div>\n\nThanks!",
    "created_at": "2021-06-27T20:54:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496225",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:55" align="right">comment:55</div>

Thanks!



---

archive/issue_comments_496226.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)** to **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**",
    "created_at": "2021-06-29T17:39:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30972#issuecomment-496226",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/versioned_installation_of_threejs](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/versioned_installation_of_threejs)** to **[`935dcef`](https://github.com/sagemath/sagetrac-mirror/commit/935dcef836f84473e3c3368b0999b4ec310c0eb3)**



---

archive/issue_events_424001.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-06-29T17:39:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-424001"
}
```



---

archive/issue_events_424002.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "098a2474cd26c38cfc67465dcf0f6d39a82ed2e7",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-06-29T17:39:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30972",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30972#event-424002"
}
```
