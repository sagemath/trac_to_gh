# Issue 30520: Fix sign of symbolic product product(1 - q^k, k, 1, N)

archive/issues_030283.json:
```json
{
    "assignees": [],
    "body": "Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).\n\nThe output for this product\nhas an incorrect leading minus sign:\n\n```\nsage: N, q, k = SR.var('N, q, k')\nsage: product(1 - q^k, k, 1, N)\n-(-1)^N*product(q^k - 1, k, 1, N)\n```\n\nExpected:\n\n```\nsage: N, q, k = SR.var('N, q, k')\nsage: product(1 - q^k, k, 1, N)\n(-1)^N*product(q^k - 1, k, 1, N)\n```\n\nFixed in Maxima by this commit:\n\n- https://sourceforge.net/p/maxima/code/ci/762fd858d2a25fa1b8b6f5423909adbc365b3c5a/\n\n\nCC:  @DaveWitteMorris @macrakis @robert-dodier @kcrisman @nbruin @slel\n\nKeywords: **maxima**\n\nBranch/Commit: **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**\n\nReviewer: **Samuel Leli\u00e8vre**\n\nAuthor: **Dave Morris**\n\nComponent: **symbolics**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30520_\n\n",
    "closed_at": "2021-07-25T13:25:52Z",
    "created_at": "2020-09-07T07:25:34Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
        "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
        "https://github.com/sagemath/sage/labels/bug"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.4",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "Fix sign of symbolic product product(1 - q^k, k, 1, N)",
    "type": "issue",
    "updated_at": "2021-07-25T13:25:52Z",
    "url": "https://github.com/sagemath/sage/issues/30520",
    "user": "https://github.com/sagetrac-tmonteil"
}
```
Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).

The output for this product
has an incorrect leading minus sign:

```
sage: N, q, k = SR.var('N, q, k')
sage: product(1 - q^k, k, 1, N)
-(-1)^N*product(q^k - 1, k, 1, N)
```

Expected:

```
sage: N, q, k = SR.var('N, q, k')
sage: product(1 - q^k, k, 1, N)
(-1)^N*product(q^k - 1, k, 1, N)
```

Fixed in Maxima by this commit:

- https://sourceforge.net/p/maxima/code/ci/762fd858d2a25fa1b8b6f5423909adbc365b3c5a/


CC:  @DaveWitteMorris @macrakis @robert-dodier @kcrisman @nbruin @slel

Keywords: **maxima**

Branch/Commit: **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**

Reviewer: **Samuel Lelièvre**

Author: **Dave Morris**

Component: **symbolics**

_Issue created by migration from https://trac.sagemath.org/ticket/30520_





---

archive/issue_events_420730.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2020-09-07T07:25:34Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420730"
}
```



---

archive/issue_events_420731.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2020-09-07T07:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20symbolics",
    "label_color": "0000ff",
    "label_name": "c: symbolics",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420731"
}
```



---

archive/issue_events_420732.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2020-09-07T07:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420732"
}
```



---

archive/issue_events_420733.json:
```json
{
    "actor": "https://github.com/sagetrac-tmonteil",
    "created_at": "2020-09-07T07:25:34Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/bug",
    "label_color": "d73a4a",
    "label_name": "bug",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420733"
}
```



---

archive/issue_comments_486583.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nFWIW, Sympy doesn't seem to be able to pull this one:\n\n```\nsage: from sympy import Product                                                 \nsage: from sympy.abc import j, p, q                                             \nsage: foo=Product(1-q^j, [j,1,p]); foo                                          \nProduct(1 - q**j, (j, 1, p))\nsage: type(foo)                                                                 \n<class 'sympy.concrete.products.Product'>\nsage: foo.doit()                                                                \nProduct(1 - q**j, (j, 1, p))\n```\n\nMathematica isn't more helpful:\n\n```\nsage: bar=mathematica(\"Product[1-q^j, {j, 1, p}]\"); bar                         \nQPochhammer[q, q, p]\n```\n\nGiac's answer can't be believed :\n\n```\nage: var(\"j,q,p\")                                                              \n(j, q, p)\nsage: gargs=list(map(giac, [1-q^j,j,1,p,1]))                                    \nsage: gargs                                                                     \n[-q^j+1, j, 1, p, 1]\nsage: libgiac.product(*gargs)                                                   \n-q+1\n```\n\nHTH, but doubting it...",
    "created_at": "2020-09-07T11:12:06Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486583",
    "user": "https://github.com/EmmanuelCharpentier"
}
```

<div id="comment:1" align="right">comment:1</div>

FWIW, Sympy doesn't seem to be able to pull this one:

```
sage: from sympy import Product                                                 
sage: from sympy.abc import j, p, q                                             
sage: foo=Product(1-q^j, [j,1,p]); foo                                          
Product(1 - q**j, (j, 1, p))
sage: type(foo)                                                                 
<class 'sympy.concrete.products.Product'>
sage: foo.doit()                                                                
Product(1 - q**j, (j, 1, p))
```

Mathematica isn't more helpful:

```
sage: bar=mathematica("Product[1-q^j, {j, 1, p}]"); bar                         
QPochhammer[q, q, p]
```

Giac's answer can't be believed :

```
age: var("j,q,p")                                                              
(j, q, p)
sage: gargs=list(map(giac, [1-q^j,j,1,p,1]))                                    
sage: gargs                                                                     
[-q^j+1, j, 1, p, 1]
sage: libgiac.product(*gargs)                                                   
-q+1
```

HTH, but doubting it...



---

archive/issue_comments_486584.json:
```json
{
    "body": "<div id=\"comment:2\" align=\"right\">comment:2</div>\n\nfor what it's worth, it's either in the interface to maxima in `maxima_eval` or in maxima itself, what ultimately gets called is:\n\n```\nsage: var('n,q,i')\n(n, q, i)\nsage: expr = 1 - q**i\nsage: from sage.interfaces import maxima_lib\nsage: sage.interfaces.maxima_lib.maxima.sr_prod(expr, i, 1, n)\n-(-1)^n*product(q^i - 1, i, 1, n)\n```\nI couldn't reproduce this on pure maxima, but I have never used it before, so it may well be there. \n\nEDIT: it may also be in the final conversion `max_to_sr`",
    "created_at": "2020-09-10T02:47:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486584",
    "user": "https://github.com/heluani"
}
```

<div id="comment:2" align="right">comment:2</div>

for what it's worth, it's either in the interface to maxima in `maxima_eval` or in maxima itself, what ultimately gets called is:

```
sage: var('n,q,i')
(n, q, i)
sage: expr = 1 - q**i
sage: from sage.interfaces import maxima_lib
sage: sage.interfaces.maxima_lib.maxima.sr_prod(expr, i, 1, n)
-(-1)^n*product(q^i - 1, i, 1, n)
```
I couldn't reproduce this on pure maxima, but I have never used it before, so it may well be there. 

EDIT: it may also be in the final conversion `max_to_sr`



---

archive/issue_comments_486585.json:
```json
{
    "body": "<div id=\"comment:3\" align=\"right\">comment:3</div>\n\nA simple case\n\n```\nsage: from sage.calculus.calculus import symbolic_product                       \nsage: var('x,n')                                                                \n(x, n)\nsage:  symbolic_product(-x**2,x,1,n)                                            \n-(-1)^n*factorial(n)^2\n```",
    "created_at": "2020-09-11T12:41:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486585",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:3" align="right">comment:3</div>

A simple case

```
sage: from sage.calculus.calculus import symbolic_product                       
sage: var('x,n')                                                                
(x, n)
sage:  symbolic_product(-x**2,x,1,n)                                            
-(-1)^n*factorial(n)^2
```



---

archive/issue_comments_486586.json:
```json
{
    "body": "<div id=\"comment:4\" align=\"right\">comment:4</div>\n\nThis seems to happen in `max_simplify_prod`. Before:\n\n```\nipdb> p maxima_eval(([max_prod],[sr_to_max(SR(a)) for a in args]))              \n<ECL: ((%PRODUCT SIMP) ((MTIMES SIMP) -1 ((MEXPT SIMP) |$_SAGE_VAR_x| 2))\n |$_SAGE_VAR_x| 1 |$_SAGE_VAR_n|)>\n```\nand after:\n\n```\nipdb> p maxima_eval([max_simplify_prod, ([max_prod],[sr_to_max(SR(a)) for a in a\nrgs])])                                                                         \n<ECL: ((MTIMES SIMP) ((MEXPT SIMP) -1 ((MPLUS SIMP) -1 |$_SAGE_VAR_n|))\n ((MEXPT SIMP) ((MFACTORIAL SIMP) |$_SAGE_VAR_n|) 2))>\n```",
    "created_at": "2020-09-11T12:46:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486586",
    "user": "https://github.com/fchapoton"
}
```

<div id="comment:4" align="right">comment:4</div>

This seems to happen in `max_simplify_prod`. Before:

```
ipdb> p maxima_eval(([max_prod],[sr_to_max(SR(a)) for a in args]))              
<ECL: ((%PRODUCT SIMP) ((MTIMES SIMP) -1 ((MEXPT SIMP) |$_SAGE_VAR_x| 2))
 |$_SAGE_VAR_x| 1 |$_SAGE_VAR_n|)>
```
and after:

```
ipdb> p maxima_eval([max_simplify_prod, ([max_prod],[sr_to_max(SR(a)) for a in a
rgs])])                                                                         
<ECL: ((MTIMES SIMP) ((MEXPT SIMP) -1 ((MPLUS SIMP) -1 |$_SAGE_VAR_n|))
 ((MEXPT SIMP) ((MFACTORIAL SIMP) |$_SAGE_VAR_n|) 2))>
```



---

archive/issue_events_420734.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420734"
}
```



---

archive/issue_events_420735.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-10-24T20:15:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420735"
}
```



---

archive/issue_comments_486587.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,19 @@\n-As reported on [this ask question](https://ask.sagemath.org/question/53345/sage-symbolic-math-simplification-error/):\n+Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).\n+\n+Before this ticket, the output for this product\n+has an incorrect leading minus sign:\n \n ```\n-sage: var('N,q,k')\n-(N, q, k)\n-sage: product(1-q^k, k, 1, N)\n+sage: N, q, k = SR.var('N, q, k')\n+sage: product(1 - q^k, k, 1, N)\n -(-1)^N*product(q^k - 1, k, 1, N)\n ```\n \n-The result should be `(-1)<sup>N*product(q</sup>k - 1, k, 1, N)` without a leading minus sign.\n+After this ticket, the output is correct:\n+\n+```\n+sage: N, q, k = SR.var('N, q, k')\n+sage: product(1 - q^k, k, 1, N)\n+(-1)^N*product(q^k - 1, k, 1, N)\n+```\n+\n``````\n",
    "created_at": "2021-03-24T18:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486587",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,19 @@
-As reported on [this ask question](https://ask.sagemath.org/question/53345/sage-symbolic-math-simplification-error/):
+Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).
+
+Before this ticket, the output for this product
+has an incorrect leading minus sign:
 
 ```
-sage: var('N,q,k')
-(N, q, k)
-sage: product(1-q^k, k, 1, N)
+sage: N, q, k = SR.var('N, q, k')
+sage: product(1 - q^k, k, 1, N)
 -(-1)^N*product(q^k - 1, k, 1, N)
 ```
 
-The result should be `(-1)<sup>N*product(q</sup>k - 1, k, 1, N)` without a leading minus sign.
+After this ticket, the output is correct:
+
+```
+sage: N, q, k = SR.var('N, q, k')
+sage: product(1 - q^k, k, 1, N)
+(-1)^N*product(q^k - 1, k, 1, N)
+```
+
``````




---

archive/issue_comments_486588.json:
```json
{
    "body": "<div id=\"comment:6\" align=\"right\">comment:6</div>\n\nAny insights from Maxima or Sage symbolics experts?",
    "created_at": "2021-03-24T18:59:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486588",
    "user": "https://github.com/slel"
}
```

<div id="comment:6" align="right">comment:6</div>

Any insights from Maxima or Sage symbolics experts?



---

archive/issue_comments_486589.json:
```json
{
    "body": "<div id=\"comment:7\" align=\"right\">comment:7</div>\n\nHi, thanks for the Maxima problem report.\n\nI was unable to reproduce this in Maxima 5.44.0/SBCL 2.0.0/Windows 10.\n\nCould you please report the details necessary to reproduce the problem:\n* The exact version of Maxima/SBCL/OS you're using.\n* The exact commands that were passed to Maxima.\n* Any non-default global settings that Sage uses when calling Maxima.\n* What does max_simplify_product do?\n* What the var(...) declaration/statement does in Maxima terms. Does it declare anything special about those variables?\n* What does \"before this ticket\" and \"after this ticket\" mean? Was it run on different versions of Maxima? If so, which ones?\nThanks,\n\n            -s",
    "created_at": "2021-03-24T20:16:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486589",
    "user": "https://github.com/macrakis"
}
```

<div id="comment:7" align="right">comment:7</div>

Hi, thanks for the Maxima problem report.

I was unable to reproduce this in Maxima 5.44.0/SBCL 2.0.0/Windows 10.

Could you please report the details necessary to reproduce the problem:
* The exact version of Maxima/SBCL/OS you're using.
* The exact commands that were passed to Maxima.
* Any non-default global settings that Sage uses when calling Maxima.
* What does max_simplify_product do?
* What the var(...) declaration/statement does in Maxima terms. Does it declare anything special about those variables?
* What does "before this ticket" and "after this ticket" mean? Was it run on different versions of Maxima? If so, which ones?
Thanks,

            -s



---

archive/issue_comments_486590.json:
```json
{
    "body": "Changed keywords from none to **maxima**",
    "created_at": "2021-03-25T00:22:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486590",
    "user": "https://github.com/slel"
}
```

Changed keywords from none to **maxima**



---

archive/issue_comments_486591.json:
```json
{
    "body": "<div id=\"comment:8\" align=\"right\">comment:8</div>\n\nApologies for cc-ing you. Rather than in Maxima,\nthe bug might well be in Sage's interface to it.\n\nIn Sage, the bug can lead to wrong results as in\n\n```\nsage: from sage.calculus.calculus import symbolic_product                       \nsage: x, n = SR.var('x,n')\nsage: symbolic_product(-x**2, x, 1, n)\n-(-1)^n*factorial(n)^2\n```\nor cause an error to be raised as in\n\n```\nsage: symbolic_product(-x, x, 1, n)\nTraceback (most recent call last)\n...\nRuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.\n```\n\nNot sure what exactly gets sent to Maxima in those cases.\n\nI have Maxima 5.44.0, ECL 21.2.1, macOS 10.14.6.\n\n```\nsage: pv = installed_packages()  # package versions\nsage: print(', '.join(f'{p} {pv[p]}' for p in ['maxima', 'ecl']))\nmaxima 5.44.0, ecl 21.2.1\n```\n\nSage calls Maxima with [the following global settings](https://github.com/sagemath/sage/blob/9.3.rc0/src/sage/interfaces/maxima_lib.py#L168-L179):\n\n```\nbesselexpand : true ;\ndisplay2d : false ;\ndomain : complex ;\nkeepfloat : true ;\nload(to_poly_solve) ;\nload(simplify_sum) ;\nload(diag) ;\nnolabels : true ;\n```\n\n\"Before this ticket\" is the observed bug.\n\"After this ticket\" is the goal (so far not reached).",
    "created_at": "2021-03-25T00:22:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486591",
    "user": "https://github.com/slel"
}
```

<div id="comment:8" align="right">comment:8</div>

Apologies for cc-ing you. Rather than in Maxima,
the bug might well be in Sage's interface to it.

In Sage, the bug can lead to wrong results as in

```
sage: from sage.calculus.calculus import symbolic_product                       
sage: x, n = SR.var('x,n')
sage: symbolic_product(-x**2, x, 1, n)
-(-1)^n*factorial(n)^2
```
or cause an error to be raised as in

```
sage: symbolic_product(-x, x, 1, n)
Traceback (most recent call last)
...
RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.
```

Not sure what exactly gets sent to Maxima in those cases.

I have Maxima 5.44.0, ECL 21.2.1, macOS 10.14.6.

```
sage: pv = installed_packages()  # package versions
sage: print(', '.join(f'{p} {pv[p]}' for p in ['maxima', 'ecl']))
maxima 5.44.0, ecl 21.2.1
```

Sage calls Maxima with [the following global settings](https://github.com/sagemath/sage/blob/9.3.rc0/src/sage/interfaces/maxima_lib.py#L168-L179):

```
besselexpand : true ;
display2d : false ;
domain : complex ;
keepfloat : true ;
load(to_poly_solve) ;
load(simplify_sum) ;
load(diag) ;
nolabels : true ;
```

"Before this ticket" is the observed bug.
"After this ticket" is the goal (so far not reached).



---

archive/issue_comments_486592.json:
```json
{
    "body": "<div id=\"comment:9\" align=\"right\">comment:9</div>\n\n> * What does max_simplify_product do?\n\n[Here](https://github.com/sagemath/sage/blob/9.3.rc0/src/sage/interfaces/maxima_lib.py#L238):\n\n```\nmax_simplify_prod=EclObject(\"$SIMPLIFY_PRODUCT\")\n```\nwhich is presumably in the contributed `simplify_sum` package, more precisely [here](https://github.com/andrejv/maxima/blob/master/share/solve_rec/solve_rec.mac#L1026).  I had trouble finding references in the official documentation, though.\n> * What the var(...) declaration/statement does in Maxima terms. Does it declare anything special about those variables?\n\nNo.",
    "created_at": "2021-03-25T01:20:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486592",
    "user": "https://github.com/kcrisman"
}
```

<div id="comment:9" align="right">comment:9</div>

> * What does max_simplify_product do?

[Here](https://github.com/sagemath/sage/blob/9.3.rc0/src/sage/interfaces/maxima_lib.py#L238):

```
max_simplify_prod=EclObject("$SIMPLIFY_PRODUCT")
```
which is presumably in the contributed `simplify_sum` package, more precisely [here](https://github.com/andrejv/maxima/blob/master/share/solve_rec/solve_rec.mac#L1026).  I had trouble finding references in the official documentation, though.
> * What the var(...) declaration/statement does in Maxima terms. Does it declare anything special about those variables?

No.



---

archive/issue_comments_486593.json:
```json
{
    "body": "<div id=\"comment:10\" align=\"right\">comment:10</div>\n\n`\"Before this ticket\" is the observed bug. \"After this ticket\" is the goal (so far not reached).` I know this is just a convention, but, um, this is pretty confusing; I don't see how anyone who was not already among the cognoscenti would know what it means. \"Observed\" and \"expected behavior\" seems adequate.\n\nI can't be sure about what's going on here, but I speculate the error is coming out of `simplify_product` in the `simplify_sum` code. \n\n```\nsimplify_product ('product(1 - f(k), k, 1, N));\n => (-1)^(N-1)*'product(f(k)-1,k,1,N)\n```\nThe leading term is off by 1 (right?) -- I think this is the origin of the stray -1 which was observed.",
    "created_at": "2021-03-25T02:40:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486593",
    "user": "https://github.com/robert-dodier"
}
```

<div id="comment:10" align="right">comment:10</div>

`"Before this ticket" is the observed bug. "After this ticket" is the goal (so far not reached).` I know this is just a convention, but, um, this is pretty confusing; I don't see how anyone who was not already among the cognoscenti would know what it means. "Observed" and "expected behavior" seems adequate.

I can't be sure about what's going on here, but I speculate the error is coming out of `simplify_product` in the `simplify_sum` code. 

```
simplify_product ('product(1 - f(k), k, 1, N));
 => (-1)^(N-1)*'product(f(k)-1,k,1,N)
```
The leading term is off by 1 (right?) -- I think this is the origin of the stray -1 which was observed.



---

archive/issue_comments_486594.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,7 +1,6 @@\n Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).\n \n-Before this ticket, the output for this product\n-has an incorrect leading minus sign:\n+Observed: incorrect leading minus sign:\n \n ```\n sage: N, q, k = SR.var('N, q, k')\n@@ -9,7 +8,7 @@\n -(-1)^N*product(q^k - 1, k, 1, N)\n ```\n \n-After this ticket, the output is correct:\n+Expected:\n \n ```\n sage: N, q, k = SR.var('N, q, k')\n``````\n",
    "created_at": "2021-03-25T02:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486594",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,7 +1,6 @@
 Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).
 
-Before this ticket, the output for this product
-has an incorrect leading minus sign:
+Observed: incorrect leading minus sign:
 
 ```
 sage: N, q, k = SR.var('N, q, k')
@@ -9,7 +8,7 @@
 -(-1)^N*product(q^k - 1, k, 1, N)
 ```
 
-After this ticket, the output is correct:
+Expected:
 
 ```
 sage: N, q, k = SR.var('N, q, k')
``````




---

archive/issue_comments_486595.json:
```json
{
    "body": "<div id=\"comment:11\" align=\"right\">comment:11</div>\n\nThanks for the rephrasing suggestion and your thoughts on the problem.",
    "created_at": "2021-03-25T02:53:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486595",
    "user": "https://github.com/slel"
}
```

<div id="comment:11" align="right">comment:11</div>

Thanks for the rephrasing suggestion and your thoughts on the problem.



---

archive/issue_comments_486596.json:
```json
{
    "body": "<div id=\"comment:12\" align=\"right\">comment:12</div>\n\n@robert-dodier: Yes, I think you are right. In line 1112 of [the file suggested by kcrisman](https://github.com/andrejv/maxima/blob/master/share/solve_rec/solve_rec.mac#L1026), the code for `simplify_product` says:\n\n```\n(-1)^(hi-lo)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))\n```\nIf I understand correctly, then this is an off-by-one error: the number of terms in the product is `hi - lo + 1` because `hi` and `lo` are both included.",
    "created_at": "2021-03-25T02:56:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486596",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:12" align="right">comment:12</div>

@robert-dodier: Yes, I think you are right. In line 1112 of [the file suggested by kcrisman](https://github.com/andrejv/maxima/blob/master/share/solve_rec/solve_rec.mac#L1026), the code for `simplify_product` says:

```
(-1)^(hi-lo)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))
```
If I understand correctly, then this is an off-by-one error: the number of terms in the product is `hi - lo + 1` because `hi` and `lo` are both included.



---

archive/issue_comments_486597.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nI located the copy of that file in my Sage installation:\n\n```\n$ cd $(sage -c 'print(SAGE_ROOT)')\n$ find . -name \"solve_rec.mac\"\n./local/share/maxima/5.44.0/share/solve_rec/solve_rec.mac\n```\nand changed line 1112 as suggested by Dave.\n\nNow I get the correct product from the ticket description:\n\n```\nsage: N, q, k = SR.var('N, q, k')\nsage: product(1 - q^k, k, 1, N)\n(-1)^N*product(q^k - 1, k, 1, N)\n```\nand for the sum of `-x^2`:\n\n```\nsage: from sage.calculus.calculus import symbolic_product\nsage: x, n = SR.var('x, n')\nsage: symbolic_product(-x**2, x, 1, n)\n(-1)^n*factorial(n)^2\n```\nbut this still gives trouble:\n\n```\nsage: from sage.calculus.calculus import symbolic_product\nsage: x, n = SR.var('x, n')\nsage: symbolic_product(-x, x, 1, n)\n#0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))\n...\nTraceback (most recent call last)\n...\nRuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.\n```\nIt would be nice to fix that too.",
    "created_at": "2021-03-25T03:08:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486597",
    "user": "https://github.com/slel"
}
```

<div id="comment:13" align="right">comment:13</div>

I located the copy of that file in my Sage installation:

```
$ cd $(sage -c 'print(SAGE_ROOT)')
$ find . -name "solve_rec.mac"
./local/share/maxima/5.44.0/share/solve_rec/solve_rec.mac
```
and changed line 1112 as suggested by Dave.

Now I get the correct product from the ticket description:

```
sage: N, q, k = SR.var('N, q, k')
sage: product(1 - q^k, k, 1, N)
(-1)^N*product(q^k - 1, k, 1, N)
```
and for the sum of `-x^2`:

```
sage: from sage.calculus.calculus import symbolic_product
sage: x, n = SR.var('x, n')
sage: symbolic_product(-x**2, x, 1, n)
(-1)^n*factorial(n)^2
```
but this still gives trouble:

```
sage: from sage.calculus.calculus import symbolic_product
sage: x, n = SR.var('x, n')
sage: symbolic_product(-x, x, 1, n)
#0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))
...
Traceback (most recent call last)
...
RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.
```
It would be nice to fix that too.



---

archive/issue_comments_486598.json:
```json
{
    "body": "<div id=\"comment:14\" align=\"right\">comment:14</div>\n\nI've come to the same conclusion. I think this patch fixes it:\n\n```\n$ git diff\ndiff --git a/share/solve_rec/solve_rec.mac b/share/solve_rec/solve_rec.mac\nindex 2727db808..8979e3f1d 100644\n--- a/share/solve_rec/solve_rec.mac\n+++ b/share/solve_rec/solve_rec.mac\n@@ -1109,7 +1109,7 @@ simplify_product(prod) := block(\n         prod\n     )\n     else if part(term, 0)=\"-\" and length(args(term))=1 then\n-      (-1)^(hi-lo)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))\n+      (-1)^(hi-lo+1)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))\n     /* Give up! */\n     else\n       p%*apply(nounify('product), [factor(term), %n, lo, hi])\n```\n\nAlthough the existing, incorrect code is exercised by the unit tests (rtest_simplify_sum and rtest_solve_rec), fixing it does not change any results! Not sure what's going on there; I guess it is a happy accident. Or not. \n\nAnyway I will add a few unit tests and commit the patch.",
    "created_at": "2021-03-25T03:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486598",
    "user": "https://github.com/robert-dodier"
}
```

<div id="comment:14" align="right">comment:14</div>

I've come to the same conclusion. I think this patch fixes it:

```
$ git diff
diff --git a/share/solve_rec/solve_rec.mac b/share/solve_rec/solve_rec.mac
index 2727db808..8979e3f1d 100644
--- a/share/solve_rec/solve_rec.mac
+++ b/share/solve_rec/solve_rec.mac
@@ -1109,7 +1109,7 @@ simplify_product(prod) := block(
         prod
     )
     else if part(term, 0)="-" and length(args(term))=1 then
-      (-1)^(hi-lo)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))
+      (-1)^(hi-lo+1)*simplify_product(apply(nounify('product), [-term, %n, lo, hi]))
     /* Give up! */
     else
       p%*apply(nounify('product), [factor(term), %n, lo, hi])
```

Although the existing, incorrect code is exercised by the unit tests (rtest_simplify_sum and rtest_solve_rec), fixing it does not change any results! Not sure what's going on there; I guess it is a happy accident. Or not. 

Anyway I will add a few unit tests and commit the patch.



---

archive/issue_comments_486599.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,7 @@\n Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).\n \n-Observed: incorrect leading minus sign:\n+Before this ticket, the output for this product\n+has an incorrect leading minus sign:\n \n ```\n sage: N, q, k = SR.var('N, q, k')\n@@ -8,7 +9,7 @@\n -(-1)^N*product(q^k - 1, k, 1, N)\n ```\n \n-Expected:\n+After this ticket, the output is correct:\n \n ```\n sage: N, q, k = SR.var('N, q, k')\n``````\n",
    "created_at": "2021-03-25T03:09:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486599",
    "user": "https://github.com/robert-dodier"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,7 @@
 Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).
 
-Observed: incorrect leading minus sign:
+Before this ticket, the output for this product
+has an incorrect leading minus sign:
 
 ```
 sage: N, q, k = SR.var('N, q, k')
@@ -8,7 +9,7 @@
 -(-1)^N*product(q^k - 1, k, 1, N)
 ```
 
-Expected:
+After this ticket, the output is correct:
 
 ```
 sage: N, q, k = SR.var('N, q, k')
``````




---

archive/issue_comments_486600.json:
```json
{
    "body": "<div id=\"comment:15\" align=\"right\">comment:15</div>\n\nReplying to [@slel](#comment:13):\n\n> but this still gives trouble:\n> \n> ```\n> sage: from sage.calculus.calculus import symbolic_product\n> sage: x, n = SR.var('x, n')\n> sage: symbolic_product(-x, x, 1, n)\n> #0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))\n> ...\n> Traceback (most recent call last)\n> ...\n> RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.\n> ```\n> It would be nice to fix that too.\n\nWell, that's a different bug, although it's in the same file; looks like it is in the stanza which begins `if freeof(%n,aa) and freeof(%n,bb)` around line 1096. In the interest of clarity, I would suggest opening a separate bug report about it.",
    "created_at": "2021-03-25T03:25:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486600",
    "user": "https://github.com/robert-dodier"
}
```

<div id="comment:15" align="right">comment:15</div>

Replying to [@slel](#comment:13):

> but this still gives trouble:
> 
> ```
> sage: from sage.calculus.calculus import symbolic_product
> sage: x, n = SR.var('x, n')
> sage: symbolic_product(-x, x, 1, n)
> #0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))
> ...
> Traceback (most recent call last)
> ...
> RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.
> ```
> It would be nice to fix that too.

Well, that's a different bug, although it's in the same file; looks like it is in the stanza which begins `if freeof(%n,aa) and freeof(%n,bb)` around line 1096. In the interest of clarity, I would suggest opening a separate bug report about it.



---

archive/issue_comments_486601.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nReplying to [@robert-dodier](#comment:15):\n> Replying to [@slel](#comment:13):\n> \n> > but this still gives trouble:\n> > \n> > ```\n> > sage: from sage.calculus.calculus import symbolic_product\n> > sage: x, n = SR.var('x, n')\n> > sage: symbolic_product(-x, x, 1, n)\n> > #0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))\n> > ...\n> > Traceback (most recent call last)\n> > ...\n> > RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.\n> > ```\n> > It would be nice to fix that too.\n\n> \n> Well, that's a different bug, although it's in the same file; looks like it is in the stanza which begins `if freeof(%n,aa) and freeof(%n,bb)` around line 1096. In the interest of clarity, I would suggest opening a separate bug report about it.\n\nYou are right. This is now tracked at #31557.",
    "created_at": "2021-03-25T03:35:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486601",
    "user": "https://github.com/slel"
}
```

<div id="comment:16" align="right">comment:16</div>

Replying to [@robert-dodier](#comment:15):
> Replying to [@slel](#comment:13):
> 
> > but this still gives trouble:
> > 
> > ```
> > sage: from sage.calculus.calculus import symbolic_product
> > sage: x, n = SR.var('x, n')
> > sage: symbolic_product(-x, x, 1, n)
> > #0: simplify_product(product='product(-_SAGE_VAR_x,_SAGE_VAR_x,1,_SAGE_VAR_n))
> > ...
> > Traceback (most recent call last)
> > ...
> > RuntimeError: ECL says: Error executing code in Maxima: factorial: factorial of negative integer -1 not defined.
> > ```
> > It would be nice to fix that too.

> 
> Well, that's a different bug, although it's in the same file; looks like it is in the stanza which begins `if freeof(%n,aa) and freeof(%n,bb)` around line 1096. In the interest of clarity, I would suggest opening a separate bug report about it.

You are right. This is now tracked at #31557.



---

archive/issue_comments_486602.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nFixed (to the best of my knowledge; no doubt you'll want to verify for Sage) by commit 762fd85 on maxima-code/master which applies the patch for simplify_product shown above.",
    "created_at": "2021-03-25T18:16:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486602",
    "user": "https://github.com/robert-dodier"
}
```

<div id="comment:17" align="right">comment:17</div>

Fixed (to the best of my knowledge; no doubt you'll want to verify for Sage) by commit 762fd85 on maxima-code/master which applies the patch for simplify_product shown above.



---

archive/issue_comments_486603.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nThanks!",
    "created_at": "2021-03-25T18:17:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486603",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:18" align="right">comment:18</div>

Thanks!



---

archive/issue_comments_486604.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nShould we apply the upstream commit fixing this\nas a patch or wait for the next Maxima release?",
    "created_at": "2021-04-21T19:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486604",
    "user": "https://github.com/slel"
}
```

<div id="comment:19" align="right">comment:19</div>

Should we apply the upstream commit fixing this
as a patch or wait for the next Maxima release?



---

archive/issue_comments_486605.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).\n \n-Before this ticket, the output for this product\n+The output for this product\n has an incorrect leading minus sign:\n \n ```\n@@ -9,7 +9,7 @@\n -(-1)^N*product(q^k - 1, k, 1, N)\n ```\n \n-After this ticket, the output is correct:\n+Expected:\n \n ```\n sage: N, q, k = SR.var('N, q, k')\n@@ -17,3 +17,7 @@\n (-1)^N*product(q^k - 1, k, 1, N)\n ```\n \n+Fixed in Maxima by this commit:\n+\n+- https://sourceforge.net/p/maxima/code/ci/762fd858d2a25fa1b8b6f5423909adbc365b3c5a/\n+\n``````\n",
    "created_at": "2021-04-21T19:43:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486605",
    "user": "https://github.com/slel"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 Reported at [Ask Sage question 53345](https://ask.sagemath.org/question/53345).
 
-Before this ticket, the output for this product
+The output for this product
 has an incorrect leading minus sign:
 
 ```
@@ -9,7 +9,7 @@
 -(-1)^N*product(q^k - 1, k, 1, N)
 ```
 
-After this ticket, the output is correct:
+Expected:
 
 ```
 sage: N, q, k = SR.var('N, q, k')
@@ -17,3 +17,7 @@
 (-1)^N*product(q^k - 1, k, 1, N)
 ```
 
+Fixed in Maxima by this commit:
+
+- https://sourceforge.net/p/maxima/code/ci/762fd858d2a25fa1b8b6f5423909adbc365b3c5a/
+
``````




---

archive/issue_comments_486606.json:
```json
{
    "body": "<div id=\"comment:20\" align=\"right\">comment:20</div>\n\nReplying to [@slel](#comment:19):\n> Should we apply the upstream commit fixing this\n> as a patch or wait for the next Maxima release?\n\nFor what it's worth, a new Maxima version is on the horizon; it is being discussed on the mailing list, although no work on it has been announced. So my guess is that a new version will appear in, let's say, one to three months. I don't know whether that implies you should wait or not.",
    "created_at": "2021-04-21T20:33:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486606",
    "user": "https://github.com/robert-dodier"
}
```

<div id="comment:20" align="right">comment:20</div>

Replying to [@slel](#comment:19):
> Should we apply the upstream commit fixing this
> as a patch or wait for the next Maxima release?

For what it's worth, a new Maxima version is on the horizon; it is being discussed on the mailing list, although no work on it has been announced. So my guess is that a new version will appear in, let's say, one to three months. I don't know whether that implies you should wait or not.



---

archive/issue_comments_486607.json:
```json
{
    "body": "<div id=\"comment:21\" align=\"right\">comment:21</div>\n\nMoving to 9.4, as 9.3 has been released.",
    "created_at": "2021-05-10T17:42:09Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486607",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:21" align="right">comment:21</div>

Moving to 9.4, as 9.3 has been released.



---

archive/issue_events_420736.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420736"
}
```



---

archive/issue_events_420737.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-05-10T17:42:09Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420737"
}
```



---

archive/issue_comments_486608.json:
```json
{
    "body": "Branch: **[public/30520](https://github.com/sagemath/sagetrac-mirror/tree/public/30520)**",
    "created_at": "2021-07-03T05:35:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486608",
    "user": "https://github.com/DaveWitteMorris"
}
```

Branch: **[public/30520](https://github.com/sagemath/sagetrac-mirror/tree/public/30520)**



---

archive/issue_comments_486609.json:
```json
{
    "body": "Commit: **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**",
    "created_at": "2021-07-03T05:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486609",
    "user": "https://github.com/DaveWitteMorris"
}
```

Commit: **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**



---

archive/issue_comments_486610.json:
```json
{
    "body": "Author: **Dave Morris**",
    "created_at": "2021-07-03T05:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486610",
    "user": "https://github.com/DaveWitteMorris"
}
```

Author: **Dave Morris**



---

archive/issue_comments_486611.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nThis was [fixed in maxima 5.45](https://sourceforge.net/p/maxima/code/ci/master/tree/changelogs/ChangeLog-5.45.md). Ticket #31876 did the upgrade in sage. The PR just adds a doctest.",
    "created_at": "2021-07-03T05:38:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486611",
    "user": "https://github.com/DaveWitteMorris"
}
```

<div id="comment:23" align="right">comment:23</div>

This was [fixed in maxima 5.45](https://sourceforge.net/p/maxima/code/ci/master/tree/changelogs/ChangeLog-5.45.md). Ticket #31876 did the upgrade in sage. The PR just adds a doctest.



---

archive/issue_events_420738.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-07-03T05:38:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420738"
}
```



---

archive/issue_events_420739.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-07-03T05:38:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/p%3A%204%20%E2%80%93%20minor",
    "label_color": "ffe799",
    "label_name": "p: 4 \u2013 minor",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420739"
}
```



---

archive/issue_events_420740.json:
```json
{
    "actor": "https://github.com/DaveWitteMorris",
    "created_at": "2021-07-03T05:38:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420740"
}
```



---

archive/issue_comments_486612.json:
```json
{
    "body": "Reviewer: **Samuel Leli\u00e8vre**",
    "created_at": "2021-07-03T05:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486612",
    "user": "https://github.com/slel"
}
```

Reviewer: **Samuel Lelièvre**



---

archive/issue_comments_486613.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\nLovely.",
    "created_at": "2021-07-03T05:56:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486613",
    "user": "https://github.com/slel"
}
```

<div id="comment:24" align="right">comment:24</div>

Lovely.



---

archive/issue_events_420741.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-03T05:56:46Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420741"
}
```



---

archive/issue_events_420742.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-03T05:56:46Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420742"
}
```



---

archive/issue_events_420743.json:
```json
{
    "actor": "https://github.com/slel",
    "created_at": "2021-07-03T05:56:46Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "title_is": "Fix sign of symbolic product product(1 - q^k, k, 1, N)",
    "title_was": "Error in the sign of a product",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420743"
}
```



---

archive/issue_events_420744.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-07-25T13:25:52Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420744"
}
```



---

archive/issue_events_420745.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "1d595c13b42e7f36e373647c88e0f9a6637dae50",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2021-07-25T13:25:52Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30520#event-420745"
}
```



---

archive/issue_comments_486614.json:
```json
{
    "body": "Changed branch from **[public/30520](https://github.com/sagemath/sagetrac-mirror/tree/public/30520)** to **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**",
    "created_at": "2021-07-25T13:25:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30520",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30520#issuecomment-486614",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[public/30520](https://github.com/sagemath/sagetrac-mirror/tree/public/30520)** to **[69c0235](https://github.com/sagemath/sagetrac-mirror/commit/69c02357d69915d7d2b97b92bd6a0a16cd14eedc)**
