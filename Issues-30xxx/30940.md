# Issue 30940: src/bin/sage-list-packages: Make it work if SAGE_ROOT is not available

archive/issues_030703.json:
```json
{
    "body": "In this case we can still retrieve the installed versions from the installation records `$SAGE_LOCAL/var/lib/sage/installed` (in the case of the sage distribution), but we will not be able to provide all details such as `remote_version`.\n\n\n\n**CC:**  @videlec @tobiasdiez @seblabbe @tobihan @jhpalmieri @fchapoton @kliem @slel\n\n**Keywords:** sd111\n\n**Branch/Commit:** [e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)\n\n**Reviewer:** Tobias Diez, Jonathan Kliem\n\n**Author:** Matthias Koeppe\n\nIssue created by migration from https://trac.sagemath.org/ticket/30940\n\n",
    "closed_at": "2021-01-03T12:15:46Z",
    "created_at": "2020-11-21T01:08:57Z",
    "labels": [
        "component: build",
        "critical",
        "enhancement"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.3",
    "title": "src/bin/sage-list-packages: Make it work if SAGE_ROOT is not available",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30940",
    "user": "https://github.com/mkoeppe"
}
```
In this case we can still retrieve the installed versions from the installation records `$SAGE_LOCAL/var/lib/sage/installed` (in the case of the sage distribution), but we will not be able to provide all details such as `remote_version`.



**CC:**  @videlec @tobiasdiez @seblabbe @tobihan @jhpalmieri @fchapoton @kliem @slel

**Keywords:** sd111

**Branch/Commit:** [e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)

**Reviewer:** Tobias Diez, Jonathan Kliem

**Author:** Matthias Koeppe

Issue created by migration from https://trac.sagemath.org/ticket/30940





---

archive/issue_comments_586001.json:
```json
{
    "body": "**Branch:** [u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available)",
    "created_at": "2020-11-21T01:12:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586001",
    "user": "https://github.com/mkoeppe"
}
```

**Branch:** [u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available)



---

archive/issue_comments_586002.json:
```json
{
    "body": "**Commit:** [3cc5edf85cb2c074ad12029637e09d799d7bde6f](https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f)",
    "created_at": "2020-11-21T01:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586002",
    "user": "https://github.com/mkoeppe"
}
```

**Commit:** [3cc5edf85cb2c074ad12029637e09d799d7bde6f](https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f)



---

archive/issue_comments_586003.json:
```json
{
    "body": "<a id='comment:2'></a>\n**New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/8ccc15734fb09a3db16b11d960de9dfc3075fd3c\">8ccc157</a></td><td><code>sage.misc.package: Deprecate standard_packages, optional_packages, experimental_packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c029fdf8fcb605928655f309f6b569813ffdebb6\">c029fdf</a></td><td><code>sage.misc.package.pip_installed_packages: Normalize package names</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/436cc5141b0c58895d3e8b4571b3044f5e609835\">436cc51</a></td><td><code>sage.misc.package.list_packages: Merge package lists from installation records and build/pkgs</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b577ddcf08de64dc8e8c995b6a1b7f6bcda348f8\">b577ddc</a></td><td><code>sage.misc.package.installed_packages: Omit .dummy and other dot files</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f\">3cc5edf</a></td><td><code>sage.misc.package.is_package_installed: Remove outdated code</code></td></tr></table>\n",
    "created_at": "2020-11-21T01:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586003",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>
**New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/8ccc15734fb09a3db16b11d960de9dfc3075fd3c">8ccc157</a></td><td><code>sage.misc.package: Deprecate standard_packages, optional_packages, experimental_packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c029fdf8fcb605928655f309f6b569813ffdebb6">c029fdf</a></td><td><code>sage.misc.package.pip_installed_packages: Normalize package names</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/436cc5141b0c58895d3e8b4571b3044f5e609835">436cc51</a></td><td><code>sage.misc.package.list_packages: Merge package lists from installation records and build/pkgs</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b577ddcf08de64dc8e8c995b6a1b7f6bcda348f8">b577ddc</a></td><td><code>sage.misc.package.installed_packages: Omit .dummy and other dot files</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f">3cc5edf</a></td><td><code>sage.misc.package.is_package_installed: Remove outdated code</code></td></tr></table>




---

archive/issue_comments_586004.json:
```json
{
    "body": "**Author:** Matthias Koeppe",
    "created_at": "2020-11-21T01:12:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586004",
    "user": "https://github.com/mkoeppe"
}
```

**Author:** Matthias Koeppe



---

archive/issue_comments_586005.json:
```json
{
    "body": "**Changing status** from new to needs_review.",
    "created_at": "2020-11-21T01:14:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586005",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from new to needs_review.



---

archive/issue_comments_586006.json:
```json
{
    "body": "**Reviewer:** Tobias Diez",
    "created_at": "2020-12-05T19:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586006",
    "user": "https://github.com/tobiasdiez"
}
```

**Reviewer:** Tobias Diez



---

archive/issue_comments_586007.json:
```json
{
    "body": "<a id='comment:6'></a>\nI think the previous code was easier to understand: if SAGE_PKGS is None, we don't need to go through the following for loop. But now one has to understand that the iteration is over an empty list. Better to exit the method early. \n\n```\n-    if not SAGE_PKGS:\n-        return {}\n-\n-    try:\n-        lp = os.listdir(SAGE_PKGS)\n-    except FileNotFoundError:\n-        return {}\n+    if SAGE_PKGS:\n+        try:\n+            lp = os.listdir(SAGE_PKGS)\n+        except FileNotFoundError:\n+            pass\n     for ...\n```\n\nMoreover, I was wondering if the name normalization is ok as it changes the output of a public facing method and thus might break user scripts.\n\nOtherwise it looks good to me.",
    "created_at": "2020-12-05T19:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586007",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:6'></a>
I think the previous code was easier to understand: if SAGE_PKGS is None, we don't need to go through the following for loop. But now one has to understand that the iteration is over an empty list. Better to exit the method early. 

```
-    if not SAGE_PKGS:
-        return {}
-
-    try:
-        lp = os.listdir(SAGE_PKGS)
-    except FileNotFoundError:
-        return {}
+    if SAGE_PKGS:
+        try:
+            lp = os.listdir(SAGE_PKGS)
+        except FileNotFoundError:
+            pass
     for ...
```

Moreover, I was wondering if the name normalization is ok as it changes the output of a public facing method and thus might break user scripts.

Otherwise it looks good to me.



---

archive/issue_comments_586008.json:
```json
{
    "body": "**Changing status** from needs_review to needs_work.",
    "created_at": "2020-12-05T19:17:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586008",
    "user": "https://github.com/tobiasdiez"
}
```

**Changing status** from needs_review to needs_work.



---

archive/issue_comments_586009.json:
```json
{
    "body": "<a id='comment:7'></a>\nReplying to [gh-tobiasdiez](#comment%3A6):\n> I was wondering if the name normalization is ok as it changes the output of a public facing method and thus might break user scripts.\n\n\nGood point, I'll make this normalization optional",
    "created_at": "2020-12-05T19:29:20Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586009",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>
Replying to [gh-tobiasdiez](#comment%3A6):
> I was wondering if the name normalization is ok as it changes the output of a public facing method and thus might break user scripts.


Good point, I'll make this normalization optional



---

archive/issue_comments_586010.json:
```json
{
    "body": "<a id='comment:8'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/97942e3324985be8d273cd68b3b2b311209585d3\">97942e3</a></td><td><code>sage.misc.package.pip_installed_packages: Only normalize when optional arg normalization='spkg'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/670618283fcaccba3739bce5d7746bb383882a0f\">6706182</a></td><td><code>sage.misc.package.list_packages: Return early if SAGE_PKGS is not available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/9258849ae24a3767fc0034a27a4bac7fbe26278f\">9258849</a></td><td><code>sage.misc.package.list_packages: Streamline handling of exclude_pip</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068\">7f80e3e</a></td><td><code>sage.misc.package.list_packages: Actually add new items to the list</code></td></tr></table>\n",
    "created_at": "2020-12-06T02:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586010",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:8'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/97942e3324985be8d273cd68b3b2b311209585d3">97942e3</a></td><td><code>sage.misc.package.pip_installed_packages: Only normalize when optional arg normalization='spkg'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/670618283fcaccba3739bce5d7746bb383882a0f">6706182</a></td><td><code>sage.misc.package.list_packages: Return early if SAGE_PKGS is not available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/9258849ae24a3767fc0034a27a4bac7fbe26278f">9258849</a></td><td><code>sage.misc.package.list_packages: Streamline handling of exclude_pip</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068">7f80e3e</a></td><td><code>sage.misc.package.list_packages: Actually add new items to the list</code></td></tr></table>




---

archive/issue_comments_586011.json:
```json
{
    "body": "**Changing commit** from \"[3cc5edf85cb2c074ad12029637e09d799d7bde6f](https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f)\" to \"[7f80e3e91f176d1650dc2f3bbb7a25eef366e068](https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068)\".",
    "created_at": "2020-12-06T02:25:18Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586011",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[3cc5edf85cb2c074ad12029637e09d799d7bde6f](https://github.com/sagemath/sagetrac-mirror/commit/3cc5edf85cb2c074ad12029637e09d799d7bde6f)" to "[7f80e3e91f176d1650dc2f3bbb7a25eef366e068](https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068)".



---

archive/issue_comments_586012.json:
```json
{
    "body": "<a id='comment:9'></a>\nReplying to [gh-tobiasdiez](#comment%3A6):\n> I think the previous code was easier to understand: if SAGE_PKGS is None, we don't need to go through the following for loop. But now one has to understand that the iteration is over an empty list. Better to exit the method early. \n\n\nThanks, done.",
    "created_at": "2020-12-06T02:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586012",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Replying to [gh-tobiasdiez](#comment%3A6):
> I think the previous code was easier to understand: if SAGE_PKGS is None, we don't need to go through the following for loop. But now one has to understand that the iteration is over an empty list. Better to exit the method early. 


Thanks, done.



---

archive/issue_comments_586013.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-12-06T02:26:07Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586013",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_586014.json:
```json
{
    "body": "<a id='comment:10'></a>\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586014",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:10'></a>
Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_586015.json:
```json
{
    "body": "**Changing keywords** from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586015",
    "user": "https://github.com/mkoeppe"
}
```

**Changing keywords** from "" to "sd111".



---

archive/issue_comments_586016.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-12-06T22:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586016",
    "user": "https://github.com/tobiasdiez"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_586017.json:
```json
{
    "body": "<a id='comment:11'></a>\nCode-wise it looks good to me now, thanks for the update!",
    "created_at": "2020-12-06T22:36:50Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586017",
    "user": "https://github.com/tobiasdiez"
}
```

<a id='comment:11'></a>
Code-wise it looks good to me now, thanks for the update!



---

archive/issue_comments_586018.json:
```json
{
    "body": "**Changing commit** from \"[7f80e3e91f176d1650dc2f3bbb7a25eef366e068](https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068)\" to \"[78bae1ff5356529af4246bc3d33162a6045dde37](https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37)\".",
    "created_at": "2020-12-07T19:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586018",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[7f80e3e91f176d1650dc2f3bbb7a25eef366e068](https://github.com/sagemath/sagetrac-mirror/commit/7f80e3e91f176d1650dc2f3bbb7a25eef366e068)" to "[78bae1ff5356529af4246bc3d33162a6045dde37](https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37)".



---

archive/issue_comments_586019.json:
```json
{
    "body": "<a id='comment:12'></a>\n**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37\">78bae1f</a></td><td><code>Merge tag '9.3.beta3' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr></table>\n",
    "created_at": "2020-12-07T19:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586019",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:12'></a>
**Branch pushed to git repo; I updated commit sha1 and set ticket back to needs_review.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37">78bae1f</a></td><td><code>Merge tag '9.3.beta3' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr></table>




---

archive/issue_comments_586020.json:
```json
{
    "body": "**Changing status** from positive_review to needs_review.",
    "created_at": "2020-12-07T19:12:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586020",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing status** from positive_review to needs_review.



---

archive/issue_comments_586021.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-12-07T19:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586021",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_586022.json:
```json
{
    "body": "<a id='comment:13'></a>\nMerged current beta",
    "created_at": "2020-12-07T19:12:48Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586022",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Merged current beta



---

archive/issue_comments_586023.json:
```json
{
    "body": "<a id='comment:14'></a>\n\n```\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 384, in sage.misc.package.is_package_installed\nFailed example:\n    for pkg in list_packages(pkg_sources=('pip'), local=True):  # optional - build\n        assert not is_package_installed(pkg), \"pip package is installed: {}\".format(pkg)\nException raised:\n    Traceback (most recent call last):\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 714, in _run\n        self.compile_and_execute(example, compiler, test.globs)\n      File \"/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.8/site-packages/sage/doctest/forker.py\", line 1133, in compile_and_execute\n        exec(compiled, globs)\n      File \"<doctest sage.misc.package.is_package_installed[3]>\", line 2, in <module>\n        assert not is_package_installed(pkg), \"pip package is installed: {}\".format(pkg)\n    AssertionError: pip package is installed: zope_interface\n**********************************************************************\nFile \"src/sage/misc/package.py\", line 454, in sage.misc.package.standard_packages\nFailed example:\n    installed[0], installed[-1]  # optional - build\nExpected:\n    ('alabaster', 'zn_poly')\nGot:\n    ('alabaster', 'zope_interface')\n**********************************************************************\n```",
    "created_at": "2020-12-14T06:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586023",
    "user": "https://github.com/vbraun"
}
```

<a id='comment:14'></a>

```
**********************************************************************
File "src/sage/misc/package.py", line 384, in sage.misc.package.is_package_installed
Failed example:
    for pkg in list_packages(pkg_sources=('pip'), local=True):  # optional - build
        assert not is_package_installed(pkg), "pip package is installed: {}".format(pkg)
Exception raised:
    Traceback (most recent call last):
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 714, in _run
        self.compile_and_execute(example, compiler, test.globs)
      File "/Users/buildbot-sage/slave/sage_git/build/local/lib/python3.8/site-packages/sage/doctest/forker.py", line 1133, in compile_and_execute
        exec(compiled, globs)
      File "<doctest sage.misc.package.is_package_installed[3]>", line 2, in <module>
        assert not is_package_installed(pkg), "pip package is installed: {}".format(pkg)
    AssertionError: pip package is installed: zope_interface
**********************************************************************
File "src/sage/misc/package.py", line 454, in sage.misc.package.standard_packages
Failed example:
    installed[0], installed[-1]  # optional - build
Expected:
    ('alabaster', 'zn_poly')
Got:
    ('alabaster', 'zope_interface')
**********************************************************************
```



---

archive/issue_comments_586024.json:
```json
{
    "body": "**Changing status** from positive_review to needs_work.",
    "created_at": "2020-12-14T06:08:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586024",
    "user": "https://github.com/vbraun"
}
```

**Changing status** from positive_review to needs_work.



---

archive/issue_comments_586025.json:
```json
{
    "body": "**Changing dependencies** from \"#30747\" to \"#30747, #30900\".",
    "created_at": "2020-12-14T17:19:21Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586025",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30747" to "#30747, #30900".



---

archive/issue_comments_586026.json:
```json
{
    "body": "**Changing commit** from \"[78bae1ff5356529af4246bc3d33162a6045dde37](https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37)\" to \"[b4927e1574e6f856f5dda78b888713f0358b16da](https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da)\".",
    "created_at": "2020-12-14T17:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586026",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[78bae1ff5356529af4246bc3d33162a6045dde37](https://github.com/sagemath/sagetrac-mirror/commit/78bae1ff5356529af4246bc3d33162a6045dde37)" to "[b4927e1574e6f856f5dda78b888713f0358b16da](https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da)".



---

archive/issue_comments_586027.json:
```json
{
    "body": "<a id='comment:16'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/945abb9a7dcee3ec36beeb5e288a6ea57900d828\">945abb9</a></td><td><code>build/pkgs/zope_interface: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c46e7e47421fb844b6701d318dcdbfaa8bc219cc\">c46e7e4</a></td><td><code>src/sage/misc/package.py: Remove zope_interface from doctests</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3bf4ff336f194424137455156d1710fcff1eafea\">3bf4ff3</a></td><td><code>Merge branch 'u/isuruf/environment_yaml' of git://trac.sagemath.org/sage into t/30900/remove_last_traces_of_zope_interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/24d79719e691fade5652a33b97ac17516a734b5c\">24d7971</a></td><td><code>build/pkgs/zope_interface/distros/conda.txt: Remove</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/a50ddf88975086b14a49895e371477df00fd57b5\">a50ddf8</a></td><td><code>Merge branch 't/28745/environment_yaml' into t/30900/remove_last_traces_of_zope_interface</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3cf5ee46cde574170859d9d8ce90abef990e7969\">3cf5ee4</a></td><td><code>Merge commit 'a50ddf88975086b14a49895e371477df00fd57b5' of git://trac.sagemath.org/sage into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da\">b4927e1</a></td><td><code>sage.misc.package: Remove/adjust non-robust doctests</code></td></tr></table>\n",
    "created_at": "2020-12-14T17:36:10Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586027",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:16'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/945abb9a7dcee3ec36beeb5e288a6ea57900d828">945abb9</a></td><td><code>build/pkgs/zope_interface: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c46e7e47421fb844b6701d318dcdbfaa8bc219cc">c46e7e4</a></td><td><code>src/sage/misc/package.py: Remove zope_interface from doctests</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3bf4ff336f194424137455156d1710fcff1eafea">3bf4ff3</a></td><td><code>Merge branch 'u/isuruf/environment_yaml' of git://trac.sagemath.org/sage into t/30900/remove_last_traces_of_zope_interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/24d79719e691fade5652a33b97ac17516a734b5c">24d7971</a></td><td><code>build/pkgs/zope_interface/distros/conda.txt: Remove</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/a50ddf88975086b14a49895e371477df00fd57b5">a50ddf8</a></td><td><code>Merge branch 't/28745/environment_yaml' into t/30900/remove_last_traces_of_zope_interface</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3cf5ee46cde574170859d9d8ce90abef990e7969">3cf5ee4</a></td><td><code>Merge commit 'a50ddf88975086b14a49895e371477df00fd57b5' of git://trac.sagemath.org/sage into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da">b4927e1</a></td><td><code>sage.misc.package: Remove/adjust non-robust doctests</code></td></tr></table>




---

archive/issue_comments_586028.json:
```json
{
    "body": "**Changing status** from needs_work to needs_review.",
    "created_at": "2020-12-14T17:36:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586028",
    "user": "https://github.com/mkoeppe"
}
```

**Changing status** from needs_work to needs_review.



---

archive/issue_comments_586029.json:
```json
{
    "body": "**Changing commit** from \"[b4927e1574e6f856f5dda78b888713f0358b16da](https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da)\" to \"[78ff9d580f5f0c1396e1f8a5421858170999957a](https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a)\".",
    "created_at": "2020-12-16T23:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586029",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[b4927e1574e6f856f5dda78b888713f0358b16da](https://github.com/sagemath/sagetrac-mirror/commit/b4927e1574e6f856f5dda78b888713f0358b16da)" to "[78ff9d580f5f0c1396e1f8a5421858170999957a](https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a)".



---

archive/issue_comments_586030.json:
```json
{
    "body": "<a id='comment:18'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e5fe7522a2ad03b23553d696e7a941e9f4fa3271\">e5fe752</a></td><td><code>Merge tag '9.3.beta4' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a\">78ff9d5</a></td><td><code>src/sage/misc/package.py: Add one more # optional - build</code></td></tr></table>\n",
    "created_at": "2020-12-16T23:49:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586030",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:18'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e5fe7522a2ad03b23553d696e7a941e9f4fa3271">e5fe752</a></td><td><code>Merge tag '9.3.beta4' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a">78ff9d5</a></td><td><code>src/sage/misc/package.py: Add one more # optional - build</code></td></tr></table>




---

archive/issue_comments_586031.json:
```json
{
    "body": "<a id='comment:21'></a>\nLet's please get this ticket in.",
    "created_at": "2020-12-20T20:07:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586031",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>
Let's please get this ticket in.



---

archive/issue_comments_586032.json:
```json
{
    "body": "**Changing reviewer** from \"Tobias Diez\" to \"Tobias Diez, ...\".",
    "created_at": "2020-12-26T19:15:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586032",
    "user": "https://github.com/tobiasdiez"
}
```

**Changing reviewer** from "Tobias Diez" to "Tobias Diez, ...".



---

archive/issue_comments_586033.json:
```json
{
    "body": "<a id='comment:25'></a>\nI would expect an empty line before and after\n\n```\n        def normalize(name):\n            if normalization is None:\n                return name\n            elif normalization == 'spkg':\n                return name.lower().replace('-', '_').replace('.', '_')\n            else:\n                raise NotImplementedError(f'normalization {normalization} is not implemented')\n```",
    "created_at": "2020-12-28T09:02:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586033",
    "user": "https://github.com/kliem"
}
```

<a id='comment:25'></a>
I would expect an empty line before and after

```
        def normalize(name):
            if normalization is None:
                return name
            elif normalization == 'spkg':
                return name.lower().replace('-', '_').replace('.', '_')
            else:
                raise NotImplementedError(f'normalization {normalization} is not implemented')
```



---

archive/issue_comments_586034.json:
```json
{
    "body": "<a id='comment:26'></a>\nWhy do we do it as a string here?\n\n```\npkg['remote_version'] = 'none'\n```",
    "created_at": "2020-12-28T10:07:59Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586034",
    "user": "https://github.com/kliem"
}
```

<a id='comment:26'></a>
Why do we do it as a string here?

```
pkg['remote_version'] = 'none'
```



---

archive/issue_comments_586035.json:
```json
{
    "body": "<a id='comment:27'></a>\nReplying to [gh-kliem](#comment%3A26):\n> Why do we do it as a string here?\n> \n> ```\n> pkg['remote_version'] = 'none'\n> ```\n\nThis matches what `m4/sage_spkg_collect.m4` reports as the version of a package without `package-version.txt`",
    "created_at": "2020-12-29T00:06:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586035",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:27'></a>
Replying to [gh-kliem](#comment%3A26):
> Why do we do it as a string here?
> 
> ```
> pkg['remote_version'] = 'none'
> ```

This matches what `m4/sage_spkg_collect.m4` reports as the version of a package without `package-version.txt`



---

archive/issue_comments_586036.json:
```json
{
    "body": "**Changing commit** from \"[78ff9d580f5f0c1396e1f8a5421858170999957a](https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a)\" to \"[e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)\".",
    "created_at": "2020-12-29T00:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586036",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

**Changing commit** from "[78ff9d580f5f0c1396e1f8a5421858170999957a](https://github.com/sagemath/sagetrac-mirror/commit/78ff9d580f5f0c1396e1f8a5421858170999957a)" to "[e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)".



---

archive/issue_comments_586037.json:
```json
{
    "body": "<a id='comment:28'></a>\n**Branch pushed to git repo; I updated commit sha1.** **New commits:**\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/64bde5f887ac115b1e40b7905ad30cc00d8de363\">64bde5f</a></td><td><code>Merge tag '9.3.beta5' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8\">e9a7572</a></td><td><code>src/sage/misc/package.py: Improve source formatting</code></td></tr></table>\n",
    "created_at": "2020-12-29T00:07:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586037",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:28'></a>
**Branch pushed to git repo; I updated commit sha1.** **New commits:**
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/64bde5f887ac115b1e40b7905ad30cc00d8de363">64bde5f</a></td><td><code>Merge tag '9.3.beta5' into t/30940/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8">e9a7572</a></td><td><code>src/sage/misc/package.py: Improve source formatting</code></td></tr></table>




---

archive/issue_comments_586038.json:
```json
{
    "body": "**Changing dependencies** from \"#30747, #30900\" to \"\".",
    "created_at": "2020-12-29T00:07:53Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586038",
    "user": "https://github.com/mkoeppe"
}
```

**Changing dependencies** from "#30747, #30900" to "".



---

archive/issue_comments_586039.json:
```json
{
    "body": "**Changing status** from needs_review to positive_review.",
    "created_at": "2020-12-29T08:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586039",
    "user": "https://github.com/kliem"
}
```

**Changing status** from needs_review to positive_review.



---

archive/issue_comments_586040.json:
```json
{
    "body": "<a id='comment:31'></a>\nLGTM.",
    "created_at": "2020-12-29T08:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586040",
    "user": "https://github.com/kliem"
}
```

<a id='comment:31'></a>
LGTM.



---

archive/issue_comments_586041.json:
```json
{
    "body": "**Changing reviewer** from \"Tobias Diez, ...\" to \"Tobias Diez, Jonathan Kliem\".",
    "created_at": "2020-12-29T08:45:40Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586041",
    "user": "https://github.com/kliem"
}
```

**Changing reviewer** from "Tobias Diez, ..." to "Tobias Diez, Jonathan Kliem".



---

archive/issue_comments_586042.json:
```json
{
    "body": "<a id='comment:32'></a>\nThanks!",
    "created_at": "2020-12-29T18:21:31Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586042",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:32'></a>
Thanks!



---

archive/issue_events_091389.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2021-01-03T12:15:46Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30940#event-91389"
}
```



---

archive/issue_comments_586043.json:
```json
{
    "body": "**Changing branch** from \"[u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available)\" to \"[e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)\".",
    "created_at": "2021-01-03T12:15:46Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30940",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30940#issuecomment-586043",
    "user": "https://github.com/vbraun"
}
```

**Changing branch** from "[u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/src_bin_sage_list_packages__make_it_work_if_sage_root_is_not_available)" to "[e9a7572a37b228f4a74c35f680190e6b237f48d8](https://github.com/sagemath/sagetrac-mirror/commit/e9a7572a37b228f4a74c35f680190e6b237f48d8)".
