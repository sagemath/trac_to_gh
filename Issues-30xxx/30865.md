# Issue 30865: sage_bootstrap: Update/extend "sage -package", fix "make download"

archive/issues_030628.json:
```json
{
    "assignees": [],
    "body": "(from #29146, #30861)\n\nThere are several places where the spkg (`build/pkgs/*/`) and system package information (`build/pkgs/*/distros/*.txt`) is parsed:\n- `bootstrap`\n- `src/doc/bootstrap`\n- `build/bin/write_dockerfile.sh`\n- `build/bin/sage-get-system-packages`\n- `tox.ini` (for `local-homebrew`, `local-conda`)\n- `.github/workflows/ci-wsl.yml` (using powershell)\n- `src/bin/sage-download-upstream`\n- `m4/sage_spkg_*.m4`\n\nThe purpose of this ticket is to prepare refactoring of this code by extending the `sage_bootstrap` package.\n- We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)\n- We change `sage -package list` so it supports the following invocations:\n  - `sage -package list :standard: :optional:` (several \"classes\" (types), not just one)\n  - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)\n  - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)\n  - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)\n- We fix and extend `sage -package download` (follow up from #30648) so it supports\n  - `sage -package download :all:` (again - was broken)\n  - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)\n  and use it for `make download` (#29896), removing `src/bin/sage-download-upstream`\n\nTo run the testsuite of `sage_bootstrap`, use\n\n```\n  (cd build && tox)\n```\n\n\n\nFollow-up:\n- The actual refactoring of the above scripts (#30947, #30951, #30968, ...)\n- Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n\n\n\nDepends on #30648\n\nCC:  @seblabbe @tobiasdiez @slel @jhpalmieri @vbraun\n\nBranch: **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**\n\nReviewer: **S\u00e9bastien Labb\u00e9**\n\nAuthor: **Matthias Koeppe**\n\nComponent: **build: configure**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30865_\n\n",
    "closed_at": "2020-11-29T11:57:50Z",
    "created_at": "2020-11-04T22:01:05Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.3",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "sage_bootstrap: Update/extend \"sage -package\", fix \"make download\"",
    "type": "issue",
    "updated_at": "2020-12-10T03:20:46Z",
    "url": "https://github.com/sagemath/sage/issues/30865",
    "user": "https://github.com/mkoeppe"
}
```
(from #29146, #30861)

There are several places where the spkg (`build/pkgs/*/`) and system package information (`build/pkgs/*/distros/*.txt`) is parsed:
- `bootstrap`
- `src/doc/bootstrap`
- `build/bin/write_dockerfile.sh`
- `build/bin/sage-get-system-packages`
- `tox.ini` (for `local-homebrew`, `local-conda`)
- `.github/workflows/ci-wsl.yml` (using powershell)
- `src/bin/sage-download-upstream`
- `m4/sage_spkg_*.m4`

The purpose of this ticket is to prepare refactoring of this code by extending the `sage_bootstrap` package.
- We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)
- We change `sage -package list` so it supports the following invocations:
  - `sage -package list :standard: :optional:` (several "classes" (types), not just one)
  - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)
  - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)
  - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)
- We fix and extend `sage -package download` (follow up from #30648) so it supports
  - `sage -package download :all:` (again - was broken)
  - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)
  and use it for `make download` (#29896), removing `src/bin/sage-download-upstream`

To run the testsuite of `sage_bootstrap`, use

```
  (cd build && tox)
```



Follow-up:
- The actual refactoring of the above scripts (#30947, #30951, #30968, ...)
- Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)



Depends on #30648

CC:  @seblabbe @tobiasdiez @slel @jhpalmieri @vbraun

Branch: **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**

Reviewer: **Sébastien Labbé**

Author: **Matthias Koeppe**

Component: **build: configure**

_Issue created by migration from https://trac.sagemath.org/ticket/30865_





---

archive/issue_events_425720.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-04T22:01:05Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425720"
}
```



---

archive/issue_events_425721.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-04T22:01:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/c%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "c: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425721"
}
```



---

archive/issue_events_425722.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-04T22:01:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/p%3A%203%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p: 3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425722"
}
```



---

archive/issue_events_425723.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-04T22:01:05Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425723"
}
```



---

archive/issue_comments_494321.json:
```json
{
    "body": "<div id=\"comment:1\" align=\"right\">comment:1</div>\n\nDevelopers interested in improving the system package advice may want to work on this ticket",
    "created_at": "2020-11-05T18:27:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494321",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:1" align="right">comment:1</div>

Developers interested in improving the system package advice may want to work on this ticket



---

archive/issue_comments_494322.json:
```json
{
    "body": "Author: **Matthias Koeppe**",
    "created_at": "2020-11-19T17:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494322",
    "user": "https://github.com/mkoeppe"
}
```

Author: **Matthias Koeppe**



---

archive/issue_comments_494323.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,7 +6,12 @@\n - `tox.ini` (for `local-homebrew`, `local-conda`)\n - `.github/workflows/ci-wsl.yml` (using powershell)\n \n-The purpose of this ticket is to refactor it by reimplementing it as a new Python module of the `sage_bootstrap` package.\n+The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.\n \n \n+To run the testsuite of `sage_bootstrap`, use\n \n+```\n+  (cd build && tox)\n+```\n+\n``````\n",
    "created_at": "2020-11-19T17:58:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494323",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,7 +6,12 @@
 - `tox.ini` (for `local-homebrew`, `local-conda`)
 - `.github/workflows/ci-wsl.yml` (using powershell)
 
-The purpose of this ticket is to refactor it by reimplementing it as a new Python module of the `sage_bootstrap` package.
+The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.
 
 
+To run the testsuite of `sage_bootstrap`, use
 
+```
+  (cd build && tox)
+```
+
``````




---

archive/issue_events_425724.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-19T17:58:45Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "title_is": "sage_bootstrap: Update/extend system package tools",
    "title_was": "sage_bootstrap: Implement system package tools",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425724"
}
```



---

archive/issue_comments_494324.json:
```json
{
    "body": "Branch: **[u/mkoeppe/sage_bootstrap__update_extend_system_package_tools](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_bootstrap__update_extend_system_package_tools)**",
    "created_at": "2020-11-19T18:04:45Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494324",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/sage_bootstrap__update_extend_system_package_tools](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_bootstrap__update_extend_system_package_tools)**



---

archive/issue_comments_494325.json:
```json
{
    "body": "<div id=\"comment:4\"></div>\n\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/226504812ada55ed17c0d7c2578ec579ac101b4d\">2265048</a></td><td><code>sage_bootstrap.package: Handle non-normal packages (which have no checksums.ini etc.)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b\">c405d10</a></td><td><code>sage_bootstrap.package.Package._init_type: Do not accept 'script' or 'pip' any more</code></td></tr></table>\n",
    "created_at": "2020-11-19T18:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494325",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:4"></div>

New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/226504812ada55ed17c0d7c2578ec579ac101b4d">2265048</a></td><td><code>sage_bootstrap.package: Handle non-normal packages (which have no checksums.ini etc.)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b">c405d10</a></td><td><code>sage_bootstrap.package.Package._init_type: Do not accept 'script' or 'pip' any more</code></td></tr></table>




---

archive/issue_comments_494326.json:
```json
{
    "body": "Commit: **[`c405d10`](https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b)**",
    "created_at": "2020-11-19T18:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494326",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[`c405d10`](https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b)**



---

archive/issue_comments_494327.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -7,7 +7,13 @@\n - `.github/workflows/ci-wsl.yml` (using powershell)\n \n The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.\n-\n+- We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)\n+- We change `sage -package list` so it supports the following invocations:\n+  - `sage -package list :standard: :optional:` (several \"classes\" (types), not just one)\n+  - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)\n+  - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)\n+  - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)\n+  - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)\n \n To run the testsuite of `sage_bootstrap`, use\n \n``````\n",
    "created_at": "2020-11-19T18:45:39Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494327",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -7,7 +7,13 @@
 - `.github/workflows/ci-wsl.yml` (using powershell)
 
 The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.
-
+- We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)
+- We change `sage -package list` so it supports the following invocations:
+  - `sage -package list :standard: :optional:` (several "classes" (types), not just one)
+  - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)
+  - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)
+  - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)
+  - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)
 
 To run the testsuite of `sage_bootstrap`, use
 
``````




---

archive/issue_comments_494328.json:
```json
{
    "body": "Dependencies: **#30648**",
    "created_at": "2020-11-19T18:56:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494328",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#30648**



---

archive/issue_comments_494329.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,6 +14,8 @@\n   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)\n   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)\n   - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)\n+- We fix and extend `sage -package download` likewise (follow up from #30648) so it (again) supports\n+  - `sage -package download :all:`\n \n To run the testsuite of `sage_bootstrap`, use\n \n``````\n",
    "created_at": "2020-11-19T19:02:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494329",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,6 +14,8 @@
   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)
   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)
   - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)
+- We fix and extend `sage -package download` likewise (follow up from #30648) so it (again) supports
+  - `sage -package download :all:`
 
 To run the testsuite of `sage_bootstrap`, use
 
``````




---

archive/issue_comments_494330.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -14,8 +14,9 @@\n   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)\n   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)\n   - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)\n-- We fix and extend `sage -package download` likewise (follow up from #30648) so it (again) supports\n-  - `sage -package download :all:`\n+- We fix and extend `sage -package download` likewise (follow up from #30648) so it supports\n+  - `sage -package download :all:` (again - was broken)\n+  - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)\n \n To run the testsuite of `sage_bootstrap`, use\n \n``````\n",
    "created_at": "2020-11-19T19:07:25Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494330",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -14,8 +14,9 @@
   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)
   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)
   - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)
-- We fix and extend `sage -package download` likewise (follow up from #30648) so it (again) supports
-  - `sage -package download :all:`
+- We fix and extend `sage -package download` likewise (follow up from #30648) so it supports
+  - `sage -package download :all:` (again - was broken)
+  - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)
 
 To run the testsuite of `sage_bootstrap`, use
 
``````




---

archive/issue_comments_494331.json:
```json
{
    "body": "Changed commit from **[`c405d10`](https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b)** to **[`3f91313`](https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c)**",
    "created_at": "2020-11-19T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494331",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c405d10`](https://github.com/sagemath/sagetrac-mirror/commit/c405d1026b35e181f114ebffb4b4452a0b22b75b)** to **[`3f91313`](https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c)**



---

archive/issue_comments_494332.json:
```json
{
    "body": "<div id=\"comment:8\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/e4635137337490ce452945728c8667f3f51b5b40\">e463513</a></td><td><code>30648: download_cls -> download</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/0b343d135cc8a5e8eb91e91cc4f35418f21aa037\">0b343d1</a></td><td><code>Merge commit 'e4635137337490ce452945728c8667f3f51b5b40' of git://trac.sagemath.org/sage into t/30865/sage_bootstrap__update_extend_system_package_tools</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/5fc844185e5bdfe6a5aa788f60ee08fa6798a0fe\">5fc8441</a></td><td><code>sage_bootstrap.app.Application.download_cls: Pass allow_upstream to download</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/794a15cee2cb02110cbc0b0a10a6922665245601\">794a15c</a></td><td><code>sage_bootstrap.cndline: Back to using download_cls</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6369bb4b7467333285cd418bc85e09b9cddb297a\">6369bb4</a></td><td><code>sage -package list: Handle --has-file, multiple package classes (types)</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4fbf753a72bed9f8a945718a2d1421ff0359cc3d\">4fbf753</a></td><td><code>src/doc/en/installation/source.rst: Remove outdated documentation on old-style packages</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/70827151aaa338fdff4c476f0f99ef6fea263e87\">7082715</a></td><td><code>Makefile: Update documentation of 'make download'</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c\">3f91313</a></td><td><code>src/bin/sage-download-upstream: Remove, use 'sage --package download' instead</code></td></tr></table>\n",
    "created_at": "2020-11-19T20:12:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494332",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:8"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/e4635137337490ce452945728c8667f3f51b5b40">e463513</a></td><td><code>30648: download_cls -> download</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/0b343d135cc8a5e8eb91e91cc4f35418f21aa037">0b343d1</a></td><td><code>Merge commit 'e4635137337490ce452945728c8667f3f51b5b40' of git://trac.sagemath.org/sage into t/30865/sage_bootstrap__update_extend_system_package_tools</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/5fc844185e5bdfe6a5aa788f60ee08fa6798a0fe">5fc8441</a></td><td><code>sage_bootstrap.app.Application.download_cls: Pass allow_upstream to download</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/794a15cee2cb02110cbc0b0a10a6922665245601">794a15c</a></td><td><code>sage_bootstrap.cndline: Back to using download_cls</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6369bb4b7467333285cd418bc85e09b9cddb297a">6369bb4</a></td><td><code>sage -package list: Handle --has-file, multiple package classes (types)</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4fbf753a72bed9f8a945718a2d1421ff0359cc3d">4fbf753</a></td><td><code>src/doc/en/installation/source.rst: Remove outdated documentation on old-style packages</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/70827151aaa338fdff4c476f0f99ef6fea263e87">7082715</a></td><td><code>Makefile: Update documentation of 'make download'</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c">3f91313</a></td><td><code>src/bin/sage-download-upstream: Remove, use 'sage --package download' instead</code></td></tr></table>




---

archive/issue_comments_494333.json:
```json
{
    "body": "<div id=\"comment:9\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/69f7ea84ec245d5f4229121e5923d2f3544462ce\">69f7ea8</a></td><td><code>sage_bootstrap.PackageClass: Accept several arguments, simplify use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/40d6604247dd78c7158f37dfcb3c7a27977358be\">40d6604</a></td><td><code>sage_bootstrap.package.Package.has_file: New, use it</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/6475263f75d73b3c18e4f6797d198a632f3e5660\">6475263</a></td><td><code>sage_bootstrap.PackageClass: Handle filter has_files, simplify use</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/769f635e3458c161aab71404b5c0e25c5f7a350e\">769f635</a></td><td><code>sage_bootstrap.tarball: Raise an error if attempting to download a tarball of a non-normal package</code></td></tr><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88\">f6b79bb</a></td><td><code>sage_bootstrap.app.download_cls: Only attempt to download tarballs for normal packages (with checksums.ini)</code></td></tr></table>\n",
    "created_at": "2020-11-19T20:42:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494333",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:9"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/69f7ea84ec245d5f4229121e5923d2f3544462ce">69f7ea8</a></td><td><code>sage_bootstrap.PackageClass: Accept several arguments, simplify use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/40d6604247dd78c7158f37dfcb3c7a27977358be">40d6604</a></td><td><code>sage_bootstrap.package.Package.has_file: New, use it</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/6475263f75d73b3c18e4f6797d198a632f3e5660">6475263</a></td><td><code>sage_bootstrap.PackageClass: Handle filter has_files, simplify use</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/769f635e3458c161aab71404b5c0e25c5f7a350e">769f635</a></td><td><code>sage_bootstrap.tarball: Raise an error if attempting to download a tarball of a non-normal package</code></td></tr><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88">f6b79bb</a></td><td><code>sage_bootstrap.app.download_cls: Only attempt to download tarballs for normal packages (with checksums.ini)</code></td></tr></table>




---

archive/issue_comments_494334.json:
```json
{
    "body": "Changed commit from **[`3f91313`](https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c)** to **[`f6b79bb`](https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88)**",
    "created_at": "2020-11-19T20:42:24Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494334",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`3f91313`](https://github.com/sagemath/sagetrac-mirror/commit/3f9131304c9d0f93b76e6d85f1cbddb4be2e8c9c)** to **[`f6b79bb`](https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88)**



---

archive/issue_comments_494335.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -13,10 +13,10 @@\n   - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)\n   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)\n   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)\n-  - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)\n-- We fix and extend `sage -package download` likewise (follow up from #30648) so it supports\n+- We fix and extend `sage -package download` (follow up from #30648) so it supports\n   - `sage -package download :all:` (again - was broken)\n   - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)\n+  and use it for `make download` (#29896).\n \n To run the testsuite of `sage_bootstrap`, use\n \n@@ -24,3 +24,6 @@\n   (cd build && tox)\n ```\n \n+Follow-up wishlist item:\n+- `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n+\n``````\n",
    "created_at": "2020-11-19T20:43:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494335",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -13,10 +13,10 @@
   - `sage -package list --has-file=spkg-configure.m4 :standard:` (needed for `bootstrap`, `src/doc/bootstrap`)
   - `sage -package list --has-file=spkg-configure.m4 --has-file=distros/debian.txt :standard: :optional:` (needed for `build/bin/write-dockerfile.sh`, `tox.ini`)
   - `sage -package list --has-file=SPKG.rst :all:` (needed for `src/doc/bootstrap`)
-  - `sage -package list --not-source=pip :optional: :experimental:` (needed for `bootstrap`)
-- We fix and extend `sage -package download` likewise (follow up from #30648) so it supports
+- We fix and extend `sage -package download` (follow up from #30648) so it supports
   - `sage -package download :all:` (again - was broken)
   - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)
+  and use it for `make download` (#29896).
 
 To run the testsuite of `sage_bootstrap`, use
 
@@ -24,3 +24,6 @@
   (cd build && tox)
 ```
 
+Follow-up wishlist item:
+- `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
+
``````




---

archive/issue_events_425725.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-19T20:43:11Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425725"
}
```



---

archive/issue_comments_494336.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,10 +1,14 @@\n (from #29146, #30861)\n \n There are several places where the system package information (`build/pkgs/*/distros/*.txt`) is parsed:\n+- `bootstrap`\n+- `src/doc/bootstrap`\n - `build/bin/write_dockerfile.sh`\n - `build/bin/sage-get-system-packages`\n - `tox.ini` (for `local-homebrew`, `local-conda`)\n - `.github/workflows/ci-wsl.yml` (using powershell)\n+- `src/bin/sage-download-upstream`\n+- `m4/sage_spkg_*.m4`\n \n The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.\n - We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)\n@@ -16,7 +20,7 @@\n - We fix and extend `sage -package download` (follow up from #30648) so it supports\n   - `sage -package download :all:` (again - was broken)\n   - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)\n-  and use it for `make download` (#29896).\n+  and use it for `make download` (#29896), removing `src/bin/sage-download-upstream`\n \n To run the testsuite of `sage_bootstrap`, use\n \n``````\n",
    "created_at": "2020-11-19T20:47:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494336",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,10 +1,14 @@
 (from #29146, #30861)
 
 There are several places where the system package information (`build/pkgs/*/distros/*.txt`) is parsed:
+- `bootstrap`
+- `src/doc/bootstrap`
 - `build/bin/write_dockerfile.sh`
 - `build/bin/sage-get-system-packages`
 - `tox.ini` (for `local-homebrew`, `local-conda`)
 - `.github/workflows/ci-wsl.yml` (using powershell)
+- `src/bin/sage-download-upstream`
+- `m4/sage_spkg_*.m4`
 
 The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.
 - We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)
@@ -16,7 +20,7 @@
 - We fix and extend `sage -package download` (follow up from #30648) so it supports
   - `sage -package download :all:` (again - was broken)
   - `sage -package download --allow-upstream :all:` (allows retrieving from `upstream_url`)
-  and use it for `make download` (#29896).
+  and use it for `make download` (#29896), removing `src/bin/sage-download-upstream`
 
 To run the testsuite of `sage_bootstrap`, use
 
``````




---

archive/issue_comments_494337.json:
```json
{
    "body": "<div id=\"comment:12\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482\">4be654b</a></td><td><code>sage_bootstrap.cmdline: Initialize has_files filter correctly</code></td></tr></table>\n",
    "created_at": "2020-11-19T20:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494337",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:12"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482">4be654b</a></td><td><code>sage_bootstrap.cmdline: Initialize has_files filter correctly</code></td></tr></table>




---

archive/issue_comments_494338.json:
```json
{
    "body": "Changed commit from **[`f6b79bb`](https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88)** to **[`4be654b`](https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482)**",
    "created_at": "2020-11-19T20:54:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494338",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`f6b79bb`](https://github.com/sagemath/sagetrac-mirror/commit/f6b79bbc89bfe65a166dc0855ab62f93f90b7b88)** to **[`4be654b`](https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482)**



---

archive/issue_comments_494339.json:
```json
{
    "body": "<div id=\"comment:13\" align=\"right\">comment:13</div>\n\nReady for review",
    "created_at": "2020-11-19T20:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494339",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:13" align="right">comment:13</div>

Ready for review



---

archive/issue_comments_494340.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,7 +10,7 @@\n - `src/bin/sage-download-upstream`\n - `m4/sage_spkg_*.m4`\n \n-The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.\n+The purpose of this ticket is to prepare refactoring of this code by extending the `sage_bootstrap` package.\n - We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)\n - We change `sage -package list` so it supports the following invocations:\n   - `sage -package list :standard: :optional:` (several \"classes\" (types), not just one)\n@@ -28,6 +28,10 @@\n   (cd build && tox)\n ```\n \n-Follow-up wishlist item:\n-- `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n \n+\n+Follow-up:\n+- The actual refactoring of the above scripts\n+- Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n+\n+\n``````\n",
    "created_at": "2020-11-19T20:56:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494340",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,7 +10,7 @@
 - `src/bin/sage-download-upstream`
 - `m4/sage_spkg_*.m4`
 
-The purpose of this ticket is to refactor it by extending the `sage_bootstrap` package.
+The purpose of this ticket is to prepare refactoring of this code by extending the `sage_bootstrap` package.
 - We update `sage_bootstrap.package` so that it understands non-normal packages (i.e., script and pip packages, which do not have `checksums.ini`)
 - We change `sage -package list` so it supports the following invocations:
   - `sage -package list :standard: :optional:` (several "classes" (types), not just one)
@@ -28,6 +28,10 @@
   (cd build && tox)
 ```
 
-Follow-up wishlist item:
-- `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
 
+
+Follow-up:
+- The actual refactoring of the above scripts
+- Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
+
+
``````




---

archive/issue_comments_494341.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,6 @@\n (from #29146, #30861)\n \n-There are several places where the system package information (`build/pkgs/*/distros/*.txt`) is parsed:\n+There are several places where the spkg (`build/pkgs/*/`) and system package information (`build/pkgs/*/distros/*.txt`) is parsed:\n - `bootstrap`\n - `src/doc/bootstrap`\n - `build/bin/write_dockerfile.sh`\n``````\n",
    "created_at": "2020-11-19T20:57:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494341",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,6 @@
 (from #29146, #30861)
 
-There are several places where the system package information (`build/pkgs/*/distros/*.txt`) is parsed:
+There are several places where the spkg (`build/pkgs/*/`) and system package information (`build/pkgs/*/distros/*.txt`) is parsed:
 - `bootstrap`
 - `src/doc/bootstrap`
 - `build/bin/write_dockerfile.sh`
``````




---

archive/issue_events_425726.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-19T21:04:39Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "title_is": "sage_bootstrap: Update/extend \"sage -package\", fix \"make download\"",
    "title_was": "sage_bootstrap: Update/extend system package tools",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425726"
}
```



---

archive/issue_comments_494342.json:
```json
{
    "body": "<div id=\"comment:16\" align=\"right\">comment:16</div>\n\nThe current branch is doing this:\n\n```diff\n-    def download_cls(self, package_name_or_class):\n+    def download_cls(self, package_name_or_class, allow_upstream=False):\n```\n\nSo should the change I made in #30648 be reverted then?\n\n(I recall that the problem fixed in #30648 was that `download_cls` method had no argument `allow_upstream` where `download` method did, so I changed `download_cls` to `download`. But at the time, I was wondering if that was the good fix. Because another fix could have been to add the `allow_upstream` argument to the `download_cls` method which you are doing in this branch)",
    "created_at": "2020-11-22T09:18:49Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494342",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:16" align="right">comment:16</div>

The current branch is doing this:

```diff
-    def download_cls(self, package_name_or_class):
+    def download_cls(self, package_name_or_class, allow_upstream=False):
```

So should the change I made in #30648 be reverted then?

(I recall that the problem fixed in #30648 was that `download_cls` method had no argument `allow_upstream` where `download` method did, so I changed `download_cls` to `download`. But at the time, I was wondering if that was the good fix. Because another fix could have been to add the `allow_upstream` argument to the `download_cls` method which you are doing in this branch)



---

archive/issue_comments_494343.json:
```json
{
    "body": "<div id=\"comment:17\" align=\"right\">comment:17</div>\n\nDoing `+=` on lists creates a new list in memory as opposed to `append` or `extend`:\n\n```\nsage: L = list(range(10))                                                       \nsage: K = list('abcd')                                                          \nsage: id(L)                                                                     \n140556349258880\nsage: id(L+K)                                                                   \n140556349147776\nsage: L.extend(K)                                                               \nsage: id(L)                                                                     \n140556349258880\n```\nSo using `+=` to append elements to a list uses a quadratic amount of memory until the garbage collector gets called.\n\nSo I would suggest the following change:\n\n```diff\n- self.names += [package_name_or_class]\n+ self.names.append(package_name_or_class)\n```\n\nas well as (5 times):\n\n```diff\n- self.names += [pkg.name for pkg in Package.all() if predicate(pkg)]\n+ self.names.extend(pkg.name for pkg in Package.all() if predicate(pkg))\n```",
    "created_at": "2020-11-22T09:49:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494343",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:17" align="right">comment:17</div>

Doing `+=` on lists creates a new list in memory as opposed to `append` or `extend`:

```
sage: L = list(range(10))                                                       
sage: K = list('abcd')                                                          
sage: id(L)                                                                     
140556349258880
sage: id(L+K)                                                                   
140556349147776
sage: L.extend(K)                                                               
sage: id(L)                                                                     
140556349258880
```
So using `+=` to append elements to a list uses a quadratic amount of memory until the garbage collector gets called.

So I would suggest the following change:

```diff
- self.names += [package_name_or_class]
+ self.names.append(package_name_or_class)
```

as well as (5 times):

```diff
- self.names += [pkg.name for pkg in Package.all() if predicate(pkg)]
+ self.names.extend(pkg.name for pkg in Package.all() if predicate(pkg))
```



---

archive/issue_comments_494344.json:
```json
{
    "body": "<div id=\"comment:18\" align=\"right\">comment:18</div>\n\nI will try the branch later today, and come back with further comments if I have.",
    "created_at": "2020-11-22T09:50:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494344",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:18" align="right">comment:18</div>

I will try the branch later today, and come back with further comments if I have.



---

archive/issue_comments_494345.json:
```json
{
    "body": "<div id=\"comment:19\" align=\"right\">comment:19</div>\n\nReplying to [@seblabbe](#comment:16):\n> The current branch is doing this:\n> \n> ```diff\n> -    def download_cls(self, package_name_or_class):\n> +    def download_cls(self, package_name_or_class, allow_upstream=False):\n> ```\n> \n> So should the change I made in #30648 be reverted then?\n\nYes, in fact I have already reverted it as part of the branch on this ticket.",
    "created_at": "2020-11-22T20:25:08Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494345",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:19" align="right">comment:19</div>

Replying to [@seblabbe](#comment:16):
> The current branch is doing this:
> 
> ```diff
> -    def download_cls(self, package_name_or_class):
> +    def download_cls(self, package_name_or_class, allow_upstream=False):
> ```
> 
> So should the change I made in #30648 be reverted then?

Yes, in fact I have already reverted it as part of the branch on this ticket.



---

archive/issue_comments_494346.json:
```json
{
    "body": "Changed commit from **[`4be654b`](https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482)** to **[`b762c3d`](https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b)**",
    "created_at": "2020-11-22T20:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494346",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`4be654b`](https://github.com/sagemath/sagetrac-mirror/commit/4be654b22e7961c615b8103bad5c1f8832e18482)** to **[`b762c3d`](https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b)**



---

archive/issue_comments_494347.json:
```json
{
    "body": "<div id=\"comment:20\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b\">b762c3d</a></td><td><code>sage_bootstrap.expand_class: Use .append, .extend instead of += for lists</code></td></tr></table>\n",
    "created_at": "2020-11-22T20:28:52Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494347",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:20"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b">b762c3d</a></td><td><code>sage_bootstrap.expand_class: Use .append, .extend instead of += for lists</code></td></tr></table>




---

archive/issue_comments_494348.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,7 +31,7 @@\n \n \n Follow-up:\n-- The actual refactoring of the above scripts\n+- The actual refactoring of the above scripts (#30947, ...)\n - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n \n \n``````\n",
    "created_at": "2020-11-22T20:58:15Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494348",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,7 +31,7 @@
 
 
 Follow-up:
-- The actual refactoring of the above scripts
+- The actual refactoring of the above scripts (#30947, ...)
 - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
 
 
``````




---

archive/issue_comments_494349.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,7 +31,7 @@\n \n \n Follow-up:\n-- The actual refactoring of the above scripts (#30947, ...)\n+- The actual refactoring of the above scripts (#30947, #30951, ...)\n - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n \n \n``````\n",
    "created_at": "2020-11-23T02:29:27Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494349",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,7 +31,7 @@
 
 
 Follow-up:
-- The actual refactoring of the above scripts (#30947, ...)
+- The actual refactoring of the above scripts (#30947, #30951, ...)
 - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
 
 
``````




---

archive/issue_comments_494350.json:
```json
{
    "body": "<div id=\"comment:23\" align=\"right\">comment:23</div>\n\nReplying to [@mkoeppe](#comment:19):\n> Yes, in fact I have already reverted it as part of the branch on this ticket.\n\nOk, yes, I agree. Since #30648 is not in sage yet, this is why I don't see it in the diff.",
    "created_at": "2020-11-23T08:35:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494350",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:23" align="right">comment:23</div>

Replying to [@mkoeppe](#comment:19):
> Yes, in fact I have already reverted it as part of the branch on this ticket.

Ok, yes, I agree. Since #30648 is not in sage yet, this is why I don't see it in the diff.



---

archive/issue_events_425727.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-11-23T09:51:58Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425727"
}
```



---

archive/issue_events_425728.json:
```json
{
    "actor": "https://github.com/seblabbe",
    "created_at": "2020-11-23T09:51:58Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425728"
}
```



---

archive/issue_comments_494351.json:
```json
{
    "body": "<div id=\"comment:24\" align=\"right\">comment:24</div>\n\n> (cd build && tox)\n\nI did that. It finishes with a big list of typos and says that there were errors while running the tests. When I scroll back, I can't see the errors, because the typos takes all of the lines in the finite history of the terminal. Are the output of tox logged somewhere?\n\nI find it weird to call it `class` of package and use `cls` (which is often use for representing a Python class. Maybe `nature` of the package? Anyway, this is out of topic.\n\n(0) I confirm that `sage --package list` works with inputs such as \n`--has-file=spkg-configure.m4`, `--has-file=distros/debian.txt`, `--has-file=SPKG.rst`. Also `sage --package download` works. Also `make download` works.\n\nSorry, I still have few more comments listed below.\n\n(1) When I read the documentation of `sage --package`, I don't know what `Sage Bootstrap Library` means. I suggest to add a sentence in the file `sage_bootstrap.cmdline.py` to explain it. Something as follows, but please replace the verb `deal` with any more precise verb:\n\n```diff\n description = \\\n \"\"\"\n Sage Bootstrap Library\n+\n+It deals with all of the packages in SageMath.\n \"\"\"\n```\n\n(2) I don't like the following error message:\n\n```\n$ sage --package list :standardd:\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/bin/sage-package\", line 42, in <module>\n    run()\n  File \"/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/cmdline.py\", line 306, in run\n    app.list_cls(*args.package_class, has_files=args.has_files)\n  File \"/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/app.py\", line 69, in list_cls\n    pc = PackageClass(*package_classes, **filters)\n  File \"/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/expand_class.py\", line 48, in __init__\n    raise ValueError('Package name cannot start with \":\", got %s', package_name_or_class)\nValueError: ('Package name cannot start with \":\", got %s', ':standardd:')\n```\n\nIt tells me the input cannot start with \":\", but this is false, as `:standard:` is accepted.\n\nThus, I would suggest the following change in `sage_bootstrap/expand_class.py`:\n\n```diff\n             else:\n-                if package_name_or_class.startswith(':'):\n-                    raise ValueError('Package name cannot start with \":\", got %s', package_name_or_class)\n-                if package_name_or_class.endswith(':'):\n-                    raise ValueError('Package name cannot end with \":\", got %s', package_name_or_class)\n+                if package_name_or_class.startswith(':') or package_name_or_class.endswith(':'):\n+                    raise ValueError('Valid package classes are :all:, :standard:, :optional:, :experimental: or :huge:, got %s', package_name_or_class)\n                 self.names.append(package_name_or_class)\n```\n\nQuestion: do you confirm that the following is a desirable feature?\n\n```\n$ sage --package list pari\npari\n```\n\n(3) Finally, in `build/sage_bootstrap/package.py`, I suggest:\n\n```diff\n-        if pattern:\n-            return self.tarball_pattern.replace('VERSION', self.version)\n+        if pattern:\n+            return pattern.replace('VERSION', self.version)\n```\n\n(4) Question: What is the meaning of the expression `non-normal` in the file `build/sage_bootstrap/tarball.py` ?\n\nI am currently waiting for the report of `make ptestlong`.",
    "created_at": "2020-11-23T09:51:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494351",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:24" align="right">comment:24</div>

> (cd build && tox)

I did that. It finishes with a big list of typos and says that there were errors while running the tests. When I scroll back, I can't see the errors, because the typos takes all of the lines in the finite history of the terminal. Are the output of tox logged somewhere?

I find it weird to call it `class` of package and use `cls` (which is often use for representing a Python class. Maybe `nature` of the package? Anyway, this is out of topic.

(0) I confirm that `sage --package list` works with inputs such as 
`--has-file=spkg-configure.m4`, `--has-file=distros/debian.txt`, `--has-file=SPKG.rst`. Also `sage --package download` works. Also `make download` works.

Sorry, I still have few more comments listed below.

(1) When I read the documentation of `sage --package`, I don't know what `Sage Bootstrap Library` means. I suggest to add a sentence in the file `sage_bootstrap.cmdline.py` to explain it. Something as follows, but please replace the verb `deal` with any more precise verb:

```diff
 description = \
 """
 Sage Bootstrap Library
+
+It deals with all of the packages in SageMath.
 """
```

(2) I don't like the following error message:

```
$ sage --package list :standardd:
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/bin/sage-package", line 42, in <module>
    run()
  File "/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/cmdline.py", line 306, in run
    app.list_cls(*args.package_class, has_files=args.has_files)
  File "/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/app.py", line 69, in list_cls
    pc = PackageClass(*package_classes, **filters)
  File "/home/slabbe/GitBox/sage/build/bin/../sage_bootstrap/expand_class.py", line 48, in __init__
    raise ValueError('Package name cannot start with ":", got %s', package_name_or_class)
ValueError: ('Package name cannot start with ":", got %s', ':standardd:')
```

It tells me the input cannot start with ":", but this is false, as `:standard:` is accepted.

Thus, I would suggest the following change in `sage_bootstrap/expand_class.py`:

```diff
             else:
-                if package_name_or_class.startswith(':'):
-                    raise ValueError('Package name cannot start with ":", got %s', package_name_or_class)
-                if package_name_or_class.endswith(':'):
-                    raise ValueError('Package name cannot end with ":", got %s', package_name_or_class)
+                if package_name_or_class.startswith(':') or package_name_or_class.endswith(':'):
+                    raise ValueError('Valid package classes are :all:, :standard:, :optional:, :experimental: or :huge:, got %s', package_name_or_class)
                 self.names.append(package_name_or_class)
```

Question: do you confirm that the following is a desirable feature?

```
$ sage --package list pari
pari
```

(3) Finally, in `build/sage_bootstrap/package.py`, I suggest:

```diff
-        if pattern:
-            return self.tarball_pattern.replace('VERSION', self.version)
+        if pattern:
+            return pattern.replace('VERSION', self.version)
```

(4) Question: What is the meaning of the expression `non-normal` in the file `build/sage_bootstrap/tarball.py` ?

I am currently waiting for the report of `make ptestlong`.



---

archive/issue_comments_494352.json:
```json
{
    "body": "<div id=\"comment:25\" align=\"right\">comment:25</div>\n\nThe `make ptestlong` finished with:\n\n```\n----------------------------------------------------------------------\nsage -t --long --random-seed=0 src/sage/interfaces/singular.py  # Killed due to segmentation fault\n----------------------------------------------------------------------\n```\nwhich is unrelated to this ticket.",
    "created_at": "2020-11-23T09:59:21Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494352",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:25" align="right">comment:25</div>

The `make ptestlong` finished with:

```
----------------------------------------------------------------------
sage -t --long --random-seed=0 src/sage/interfaces/singular.py  # Killed due to segmentation fault
----------------------------------------------------------------------
```
which is unrelated to this ticket.



---

archive/issue_comments_494353.json:
```json
{
    "body": "<div id=\"comment:26\" align=\"right\">comment:26</div>\n\nReplying to [@seblabbe](#comment:25):\n> The `make ptestlong` finished with:\n> \n> ```\n> ----------------------------------------------------------------------\n> sage -t --long --random-seed=0 src/sage/interfaces/singular.py  # Killed due to segmentation fault\n> ----------------------------------------------------------------------\n> ```\n> which is unrelated to this ticket.\n\nIndeed that is different, and tracked at #30945.",
    "created_at": "2020-11-23T11:54:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494353",
    "user": "https://github.com/slel"
}
```

<div id="comment:26" align="right">comment:26</div>

Replying to [@seblabbe](#comment:25):
> The `make ptestlong` finished with:
> 
> ```
> ----------------------------------------------------------------------
> sage -t --long --random-seed=0 src/sage/interfaces/singular.py  # Killed due to segmentation fault
> ----------------------------------------------------------------------
> ```
> which is unrelated to this ticket.

Indeed that is different, and tracked at #30945.



---

archive/issue_comments_494354.json:
```json
{
    "body": "Reviewer: **S\u00e9bastien Labb\u00e9**",
    "created_at": "2020-11-23T14:41:59Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494354",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: **Sébastien Labbé**



---

archive/issue_comments_494355.json:
```json
{
    "body": "<div id=\"comment:28\" align=\"right\">comment:28</div>\n\nReplying to [@seblabbe](#comment:24):\n> > (cd build && tox)\n\n> \n> I did that. It finishes with a big list of typos \n\nIf it shows typos, then you probably ran `sage -tox`, not `tox`. If you don't have tox in your global environment, you can use `(cd build && sage -sh -c tox)`.\n\n> Are the output of tox logged somewhere?\n\nYes, it creates a subdirectory `.tox`, where you'll find logs.",
    "created_at": "2020-11-23T18:29:23Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494355",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:28" align="right">comment:28</div>

Replying to [@seblabbe](#comment:24):
> > (cd build && tox)

> 
> I did that. It finishes with a big list of typos 

If it shows typos, then you probably ran `sage -tox`, not `tox`. If you don't have tox in your global environment, you can use `(cd build && sage -sh -c tox)`.

> Are the output of tox logged somewhere?

Yes, it creates a subdirectory `.tox`, where you'll find logs.



---

archive/issue_comments_494356.json:
```json
{
    "body": "<div id=\"comment:29\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31\">51db2a9</a></td><td><code>sage_bootstrap: Eliminate terminology 'package class' in help and error messages</code></td></tr></table>\n",
    "created_at": "2020-11-23T19:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494356",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:29"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31">51db2a9</a></td><td><code>sage_bootstrap: Eliminate terminology 'package class' in help and error messages</code></td></tr></table>




---

archive/issue_comments_494357.json:
```json
{
    "body": "Changed commit from **[`b762c3d`](https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b)** to **[`51db2a9`](https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31)**",
    "created_at": "2020-11-23T19:01:53Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494357",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`b762c3d`](https://github.com/sagemath/sagetrac-mirror/commit/b762c3dfee999746ad0b8507460178ee6a63966b)** to **[`51db2a9`](https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31)**



---

archive/issue_comments_494358.json:
```json
{
    "body": "<div id=\"comment:30\" align=\"right\">comment:30</div>\n\nReplying to [@seblabbe](#comment:24):\n> I find it weird to call it `class` of package and use `cls` (which is often use for representing a Python class. Maybe `nature` of the package? Anyway, this is out of topic.\n\nI agree. I have now made a change to eliminate this (unexplained) terminology from user-facing messages.  But I haven't changed the class name `PackageClass` or argument names, to keep the diff small.",
    "created_at": "2020-11-23T19:04:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494358",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:30" align="right">comment:30</div>

Replying to [@seblabbe](#comment:24):
> I find it weird to call it `class` of package and use `cls` (which is often use for representing a Python class. Maybe `nature` of the package? Anyway, this is out of topic.

I agree. I have now made a change to eliminate this (unexplained) terminology from user-facing messages.  But I haven't changed the class name `PackageClass` or argument names, to keep the diff small.



---

archive/issue_comments_494359.json:
```json
{
    "body": "<div id=\"comment:31\" align=\"right\">comment:31</div>\n\nReplying to [@seblabbe](#comment:24):\n> (4) Question: What is the meaning of the expression `non-normal` in the file `build/sage_bootstrap/tarball.py` ?\n\nThis is referring to https://doc.sagemath.org/html/en/developer/packaging.html#package-source-types",
    "created_at": "2020-11-23T19:05:33Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494359",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:31" align="right">comment:31</div>

Replying to [@seblabbe](#comment:24):
> (4) Question: What is the meaning of the expression `non-normal` in the file `build/sage_bootstrap/tarball.py` ?

This is referring to https://doc.sagemath.org/html/en/developer/packaging.html#package-source-types



---

archive/issue_comments_494360.json:
```json
{
    "body": "<div id=\"comment:32\" align=\"right\">comment:32</div>\n\nReplying to [@seblabbe](#comment:24):\n> I would suggest the following change in `sage_bootstrap/expand_class.py`:\n> \n> ```diff\n>              else:\n> -                if package_name_or_class.startswith(':'):\n> -                    raise ValueError('Package name cannot start with \":\", got %s', package_name_or_class)\n> -                if package_name_or_class.endswith(':'):\n> -                    raise ValueError('Package name cannot end with \":\", got %s', package_name_or_class)\n> +                if package_name_or_class.startswith(':') or package_name_or_class.endswith(':'):\n> +                    raise ValueError('Valid package classes are :all:, :standard:, :optional:, :experimental: or :huge:, got %s', package_name_or_class)\n>                  self.names.append(package_name_or_class)\n> ```\n\nI have made a similar change in the above commit.\n\n> Question: do you confirm that the following is a desirable feature?\n> \n> ```\n> $ sage --package list pari\n> pari\n> ```\n\nYes, this is a feature, and the above commit documents it.",
    "created_at": "2020-11-23T19:07:56Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494360",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:32" align="right">comment:32</div>

Replying to [@seblabbe](#comment:24):
> I would suggest the following change in `sage_bootstrap/expand_class.py`:
> 
> ```diff
>              else:
> -                if package_name_or_class.startswith(':'):
> -                    raise ValueError('Package name cannot start with ":", got %s', package_name_or_class)
> -                if package_name_or_class.endswith(':'):
> -                    raise ValueError('Package name cannot end with ":", got %s', package_name_or_class)
> +                if package_name_or_class.startswith(':') or package_name_or_class.endswith(':'):
> +                    raise ValueError('Valid package classes are :all:, :standard:, :optional:, :experimental: or :huge:, got %s', package_name_or_class)
>                  self.names.append(package_name_or_class)
> ```

I have made a similar change in the above commit.

> Question: do you confirm that the following is a desirable feature?
> 
> ```
> $ sage --package list pari
> pari
> ```

Yes, this is a feature, and the above commit documents it.



---

archive/issue_comments_494361.json:
```json
{
    "body": "Changed commit from **[`51db2a9`](https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31)** to **[`c0a0329`](https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe)**",
    "created_at": "2020-11-23T19:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494361",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`51db2a9`](https://github.com/sagemath/sagetrac-mirror/commit/51db2a9e3bbbe730846c00831991a3e7b8ff5b31)** to **[`c0a0329`](https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe)**



---

archive/issue_comments_494362.json:
```json
{
    "body": "<div id=\"comment:33\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe\">c0a0329</a></td><td><code>sage_bootstrap.cmdline: Expand description</code></td></tr></table>\n",
    "created_at": "2020-11-23T19:19:36Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494362",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:33"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe">c0a0329</a></td><td><code>sage_bootstrap.cmdline: Expand description</code></td></tr></table>




---

archive/issue_events_425729.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-23T19:20:49Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20work",
    "label_color": "ffff00",
    "label_name": "needs work",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425729"
}
```



---

archive/issue_events_425730.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-23T19:20:49Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425730"
}
```



---

archive/issue_comments_494363.json:
```json
{
    "body": "<div id=\"comment:35\" align=\"right\">comment:35</div>\n\nReplying to [@mkoeppe](#comment:28):\n> If it shows typos, then you probably ran `sage -tox`, not `tox`. If you don't have tox in your global environment, you can use `(cd build && sage -sh -c tox)`.\n\nWell, I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. So, your guess is right, that was after the run of `sage -tox`.\n \n> > Are the output of tox logged somewhere?\n\n> \n> Yes, it creates a subdirectory `.tox`, where you'll find logs.\n\nGreat. Thank you.",
    "created_at": "2020-11-23T21:48:16Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494363",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:35" align="right">comment:35</div>

Replying to [@mkoeppe](#comment:28):
> If it shows typos, then you probably ran `sage -tox`, not `tox`. If you don't have tox in your global environment, you can use `(cd build && sage -sh -c tox)`.

Well, I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. So, your guess is right, that was after the run of `sage -tox`.
 
> > Are the output of tox logged somewhere?

> 
> Yes, it creates a subdirectory `.tox`, where you'll find logs.

Great. Thank you.



---

archive/issue_comments_494364.json:
```json
{
    "body": "<div id=\"comment:36\" align=\"right\">comment:36</div>\n\nThanks for the answers and commits, I will check this tomorrow morning Bordeaux time.\n\n[I think my comment (3) is still not fixed (well, it is just a small detail).]",
    "created_at": "2020-11-23T21:53:19Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494364",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:36" align="right">comment:36</div>

Thanks for the answers and commits, I will check this tomorrow morning Bordeaux time.

[I think my comment (3) is still not fixed (well, it is just a small detail).]



---

archive/issue_comments_494365.json:
```json
{
    "body": "<div id=\"comment:37\" align=\"right\">comment:37</div>\n\nReplying to [@seblabbe](#comment:35):\n> I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. \n\nThat should actually work too.  `sage_bootstrap` is designed to work on a wide range of Python versions including 2.x.  `tox` provisions virtual environments to test the package with each available Python version.  To run it with a specific Python version, you can do `tox -e py37` etc. It does not matter on what version of Python tox itself runs.",
    "created_at": "2020-11-23T23:25:48Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494365",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:37" align="right">comment:37</div>

Replying to [@seblabbe](#comment:35):
> I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. 

That should actually work too.  `sage_bootstrap` is designed to work on a wide range of Python versions including 2.x.  `tox` provisions virtual environments to test the package with each available Python version.  To run it with a specific Python version, you can do `tox -e py37` etc. It does not matter on what version of Python tox itself runs.



---

archive/issue_comments_494366.json:
```json
{
    "body": "Changed commit from **[`c0a0329`](https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe)** to **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**",
    "created_at": "2020-11-23T23:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494366",
    "user": "https://github.com/sagetrac-git"
}
```

Changed commit from **[`c0a0329`](https://github.com/sagemath/sagetrac-mirror/commit/c0a0329d842ad8745789f8bf61bc456f0473e1fe)** to **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**



---

archive/issue_comments_494367.json:
```json
{
    "body": "<div id=\"comment:38\"></div>\n\nBranch pushed to git repo; I updated commit sha1. New commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40\">f33c363</a></td><td><code>sage_bootstrap.package.Package.tarball_pattern: Simplify code</code></td></tr></table>\n",
    "created_at": "2020-11-23T23:28:20Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494367",
    "user": "https://github.com/sagetrac-git"
}
```

<div id="comment:38"></div>

Branch pushed to git repo; I updated commit sha1. New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40">f33c363</a></td><td><code>sage_bootstrap.package.Package.tarball_pattern: Simplify code</code></td></tr></table>




---

archive/issue_comments_494368.json:
```json
{
    "body": "<div id=\"comment:39\" align=\"right\">comment:39</div>\n\nReplying to [@mkoeppe](#comment:37):\n> Replying to [@seblabbe](#comment:35):\n> > I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. \n\n> \n> That should actually work too.  `sage_bootstrap` is designed to work on a wide range of Python versions including 2.x.  `tox` provisions virtual environments to test the package with each available Python version.  To run it with a specific Python version, you can do `tox -e py37` etc. It does not matter on what version of Python tox itself runs.\n\nOk, I see. But after `cd build`, the tox command prints few lines and seems to get stuck:\n\n```\n$ cd build\n$ tox\nGLOB sdist-make: /home/slabbe/GitBox/sage/build/setup.py\npy26 create: /home/slabbe/GitBox/sage/build/.tox/py26\nERROR: InterpreterNotFound: python2.6\npy27 create: /home/slabbe/GitBox/sage/build/.tox/py27\npy27 inst: /home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip\npy27 installed: DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.,pkg-resources==0.0.0,sage-bootstrap @ file:///home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip\npy27 runtests: PYTHONHASHSEED='3230691582'\npy27 runtests: commands[0] | python2.7 -m unittest discover\n......\n```",
    "created_at": "2020-11-24T08:03:34Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494368",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:39" align="right">comment:39</div>

Replying to [@mkoeppe](#comment:37):
> Replying to [@seblabbe](#comment:35):
> > I first did `sudo apt install tox` on a Ubuntu 18.04 but, then I got problems because that tox is using python2. 

> 
> That should actually work too.  `sage_bootstrap` is designed to work on a wide range of Python versions including 2.x.  `tox` provisions virtual environments to test the package with each available Python version.  To run it with a specific Python version, you can do `tox -e py37` etc. It does not matter on what version of Python tox itself runs.

Ok, I see. But after `cd build`, the tox command prints few lines and seems to get stuck:

```
$ cd build
$ tox
GLOB sdist-make: /home/slabbe/GitBox/sage/build/setup.py
py26 create: /home/slabbe/GitBox/sage/build/.tox/py26
ERROR: InterpreterNotFound: python2.6
py27 create: /home/slabbe/GitBox/sage/build/.tox/py27
py27 inst: /home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip
py27 installed: DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.,pkg-resources==0.0.0,sage-bootstrap @ file:///home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip
py27 runtests: PYTHONHASHSEED='3230691582'
py27 runtests: commands[0] | python2.7 -m unittest discover
......
```



---

archive/issue_comments_494369.json:
```json
{
    "body": "<div id=\"comment:40\" align=\"right\">comment:40</div>\n\nActually, it did not get stuck, but I obtain three errors after few minutes:\n\n```\n$ tox\nGLOB sdist-make: /home/slabbe/GitBox/sage/build/setup.py\npy26 create: /home/slabbe/GitBox/sage/build/.tox/py26\nERROR: InterpreterNotFound: python2.6\npy27 create: /home/slabbe/GitBox/sage/build/.tox/py27\npy27 inst: /home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip\npy27 installed: DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.,pkg-resources==0.0.0,sage-bootstrap @ file:///home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip\npy27 runtests: PYTHONHASHSEED='3230691582'\npy27 runtests: commands[0] | python2.7 -m unittest discover\n......FF..............[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[......................................................................]\n......F........ERROR [package|all:249]: Failed to open pari\n..\n======================================================================\nFAIL: test_error (test.test_download.DownloadTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 49, in test_error\n    self.assertIsNotFoundError(log.messages())\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 64, in assertIsNotFoundError\n    \"[Errno 404] Not Found: '//files.sagemath.org/sage_bootstrap/this_url_does_not_exist'\"))\nAssertionError: False is not true\n\n======================================================================\nFAIL: test_ignore_errors (test.test_download.DownloadTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 57, in test_ignore_errors\n    self.assertIsNotFoundError(log.messages())\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 64, in assertIsNotFoundError\n    \"[Errno 404] Not Found: '//files.sagemath.org/sage_bootstrap/this_url_does_not_exist'\"))\nAssertionError: False is not true\n\n======================================================================\nFAIL: test_checksum (test.test_tarball.TarballTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_tarball.py\", line 59, in test_checksum\n    '[......................................................................]\\n')\nAssertionError: '[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\\n[......................................................................]\\n' != '[......................................................................]\\n'\n\n----------------------------------------------------------------------\nRan 39 tests in 228.835s\n\nFAILED (failures=3)\n```\n\nAfter that it seems tox does the same with other version of Python it finds on the system. With python 3.6, it returns two errors instead of three (the `test_checksum` does not fail).\n\nLet me now check whether this is related to the current ticket or not by rerunning it after a `git checkout develop`.",
    "created_at": "2020-11-24T08:11:02Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494369",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:40" align="right">comment:40</div>

Actually, it did not get stuck, but I obtain three errors after few minutes:

```
$ tox
GLOB sdist-make: /home/slabbe/GitBox/sage/build/setup.py
py26 create: /home/slabbe/GitBox/sage/build/.tox/py26
ERROR: InterpreterNotFound: python2.6
py27 create: /home/slabbe/GitBox/sage/build/.tox/py27
py27 inst: /home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip
py27 installed: DEPRECATION: Python 2.7 reached the end of its life on January 1st, 2020. Please upgrade your Python as Python 2.7 is no longer maintained. pip 21.0 will drop support for Python 2.7 in January 2021. More details about Python 2 support in pip can be found at https://pip.pypa.io/en/latest/development/release-process/#python-2-support pip 21.0 will remove support for this functionality.,pkg-resources==0.0.0,sage-bootstrap @ file:///home/slabbe/GitBox/sage/build/.tox/dist/sage_bootstrap-1.0.zip
py27 runtests: PYTHONHASHSEED='3230691582'
py27 runtests: commands[0] | python2.7 -m unittest discover
......FF..............[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]
[......................................................................]
......F........ERROR [package|all:249]: Failed to open pari
..
======================================================================
FAIL: test_error (test.test_download.DownloadTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 49, in test_error
    self.assertIsNotFoundError(log.messages())
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 64, in assertIsNotFoundError
    "[Errno 404] Not Found: '//files.sagemath.org/sage_bootstrap/this_url_does_not_exist'"))
AssertionError: False is not true

======================================================================
FAIL: test_ignore_errors (test.test_download.DownloadTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 57, in test_ignore_errors
    self.assertIsNotFoundError(log.messages())
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 64, in assertIsNotFoundError
    "[Errno 404] Not Found: '//files.sagemath.org/sage_bootstrap/this_url_does_not_exist'"))
AssertionError: False is not true

======================================================================
FAIL: test_checksum (test.test_tarball.TarballTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_tarball.py", line 59, in test_checksum
    '[......................................................................]\n')
AssertionError: '[xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx]\n[......................................................................]\n' != '[......................................................................]\n'

----------------------------------------------------------------------
Ran 39 tests in 228.835s

FAILED (failures=3)
```

After that it seems tox does the same with other version of Python it finds on the system. With python 3.6, it returns two errors instead of three (the `test_checksum` does not fail).

Let me now check whether this is related to the current ticket or not by rerunning it after a `git checkout develop`.



---

archive/issue_comments_494370.json:
```json
{
    "body": "<div id=\"comment:41\" align=\"right\">comment:41</div>\n\nI also get errors with 9.3.beta1, but not exactly the same. `test_ignore_errors` and `test_error`  both fails as with the branch. But `test_download` fails only on 9.3.beta1 whereas `test_checksum` fails only with the current branch.\n\n```\n======================================================================\nFAIL: test_error (test.test_download.DownloadTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 49, in test_error\n    self.assertIsNotFoundError(log.messages())\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 63, in assertIsNotFoundError\n    self.assertTrue(messages[0][1].endswith(\nAssertionError: False is not true\n\n======================================================================\nFAIL: test_ignore_errors (test.test_download.DownloadTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 57, in test_ignore_errors\n    self.assertIsNotFoundError(log.messages())\n  File \"/home/slabbe/GitBox/sage/build/test/test_download.py\", line 63, in assertIsNotFoundError\n    self.assertTrue(messages[0][1].endswith(\nAssertionError: False is not true\n\n======================================================================\nFAIL: test_download (test.test_package_cmdline.SagePackageTestCase)\n----------------------------------------------------------------------\nTraceback (most recent call last):\n  File \"/home/slabbe/GitBox/sage/build/test/test_package_cmdline.py\", line 115, in test_download\n    self.assertTrue(stderr.startswith('Using cached file'))\nAssertionError: False is not true\n\n----------------------------------------------------------------------\nRan 39 tests in 134.424s\n\nFAILED (failures=3)\n```\n\nI don't know how much this is related to the current ticket. From my point of view, I give a positive review to the commits done up to now.\n\nMatthias, I let you change the status to positive review if you think the tox issues are unrelated or if they can be dealt in another ticket.",
    "created_at": "2020-11-24T08:32:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494370",
    "user": "https://github.com/seblabbe"
}
```

<div id="comment:41" align="right">comment:41</div>

I also get errors with 9.3.beta1, but not exactly the same. `test_ignore_errors` and `test_error`  both fails as with the branch. But `test_download` fails only on 9.3.beta1 whereas `test_checksum` fails only with the current branch.

```
======================================================================
FAIL: test_error (test.test_download.DownloadTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 49, in test_error
    self.assertIsNotFoundError(log.messages())
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 63, in assertIsNotFoundError
    self.assertTrue(messages[0][1].endswith(
AssertionError: False is not true

======================================================================
FAIL: test_ignore_errors (test.test_download.DownloadTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 57, in test_ignore_errors
    self.assertIsNotFoundError(log.messages())
  File "/home/slabbe/GitBox/sage/build/test/test_download.py", line 63, in assertIsNotFoundError
    self.assertTrue(messages[0][1].endswith(
AssertionError: False is not true

======================================================================
FAIL: test_download (test.test_package_cmdline.SagePackageTestCase)
----------------------------------------------------------------------
Traceback (most recent call last):
  File "/home/slabbe/GitBox/sage/build/test/test_package_cmdline.py", line 115, in test_download
    self.assertTrue(stderr.startswith('Using cached file'))
AssertionError: False is not true

----------------------------------------------------------------------
Ran 39 tests in 134.424s

FAILED (failures=3)
```

I don't know how much this is related to the current ticket. From my point of view, I give a positive review to the commits done up to now.

Matthias, I let you change the status to positive review if you think the tox issues are unrelated or if they can be dealt in another ticket.



---

archive/issue_comments_494371.json:
```json
{
    "body": "<div id=\"comment:42\" align=\"right\">comment:42</div>\n\nThank you!\n\n(I also get the additional `test_checksum` failure on this branch. This test only passes on a release tag; this is not specific to this ticket. The other failures, also not specific to this ticket, should be investigated on a separate ticket.)",
    "created_at": "2020-11-24T17:28:29Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494371",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:42" align="right">comment:42</div>

Thank you!

(I also get the additional `test_checksum` failure on this branch. This test only passes on a release tag; this is not specific to this ticket. The other failures, also not specific to this ticket, should be investigated on a separate ticket.)



---

archive/issue_events_425731.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-24T17:28:29Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/needs%20review",
    "label_color": "7fff00",
    "label_name": "needs review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425731"
}
```



---

archive/issue_events_425732.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-11-24T17:28:29Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425732"
}
```



---

archive/issue_comments_494372.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -31,7 +31,7 @@\n \n \n Follow-up:\n-- The actual refactoring of the above scripts (#30947, #30951, ...)\n+- The actual refactoring of the above scripts (#30947, #30951, #30968, ...)\n - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)\n \n \n``````\n",
    "created_at": "2020-11-27T04:05:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494372",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -31,7 +31,7 @@
 
 
 Follow-up:
-- The actual refactoring of the above scripts (#30947, #30951, ...)
+- The actual refactoring of the above scripts (#30947, #30951, #30968, ...)
 - Wishlist item: `sage -package list --not-source=pip :optional: :experimental:` (would simplify `bootstrap`)
 
 
``````




---

archive/issue_comments_494373.json:
```json
{
    "body": "Changed branch from **[u/mkoeppe/sage_bootstrap__update_extend_system_package_tools](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_bootstrap__update_extend_system_package_tools)** to **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**",
    "created_at": "2020-11-29T11:57:50Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494373",
    "user": "https://github.com/vbraun"
}
```

Changed branch from **[u/mkoeppe/sage_bootstrap__update_extend_system_package_tools](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/sage_bootstrap__update_extend_system_package_tools)** to **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)**



---

archive/issue_events_425733.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-11-29T11:57:50Z",
    "event": "unlabeled",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "label": "https://github.com/sagemath/sage/labels/positive%20review",
    "label_color": "dfffc0",
    "label_name": "positive review",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425733"
}
```



---

archive/issue_events_425734.json:
```json
{
    "actor": "https://github.com/vbraun",
    "commit_id": "d47fefd2bce9bbe99a11844cc38d2ef138c0ba0c",
    "commit_repository": "https://github.com/sagemath/sage",
    "created_at": "2020-11-29T11:57:50Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30865#event-425734"
}
```



---

archive/issue_comments_494374.json:
```json
{
    "body": "<div id=\"comment:45\" align=\"right\">comment:45</div>\n\nI tried `make download` and it failed to download scipoptsuite.\n\nWhich is expected. Indeed, reading from the last scipoptsuite ticket:\n\n- #24662: Upgrade scipoptsuite to 5.0.1\n\n> Upstream archive: <snip>\n> (DO NOT put on sage servers -- we cannot redistribute this archive)\n\nHow do we deal with that?",
    "created_at": "2020-12-10T02:18:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494374",
    "user": "https://github.com/slel"
}
```

<div id="comment:45" align="right">comment:45</div>

I tried `make download` and it failed to download scipoptsuite.

Which is expected. Indeed, reading from the last scipoptsuite ticket:

- #24662: Upgrade scipoptsuite to 5.0.1

> Upstream archive: <snip>
> (DO NOT put on sage servers -- we cannot redistribute this archive)

How do we deal with that?



---

archive/issue_comments_494375.json:
```json
{
    "body": "Changed commit from **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)** to none",
    "created_at": "2020-12-10T02:18:07Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494375",
    "user": "https://github.com/slel"
}
```

Changed commit from **[`f33c363`](https://github.com/sagemath/sagetrac-mirror/commit/f33c3635ba36440b260644c127dcc94e12c3ab40)** to none



---

archive/issue_comments_494376.json:
```json
{
    "body": "<div id=\"comment:46\" align=\"right\">comment:46</div>\n\nReplying to [@slel](#comment:45):\n> > (DO NOT put on sage servers -- we cannot redistribute this archive)\n\n> \n> How do we deal with that?\n\nLet's discuss this on #31034",
    "created_at": "2020-12-10T03:20:46Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30865",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30865#issuecomment-494376",
    "user": "https://github.com/mkoeppe"
}
```

<div id="comment:46" align="right">comment:46</div>

Replying to [@slel](#comment:45):
> > (DO NOT put on sage servers -- we cannot redistribute this archive)

> 
> How do we deal with that?

Let's discuss this on #31034
