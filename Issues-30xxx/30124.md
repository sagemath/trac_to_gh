# Issue 30124: System package information, spkg-configure for Jupyter "notebook" package, "rst2ipynb", and dependencies

archive/issues_029887.json:
```json
{
    "assignees": [],
    "body": "(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)\n\nWe currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.\n\nHowever, the situation is different for the Jupyter `notebook` package (and its dependencies): \n\nWe do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n\nLikewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.\n\n`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n- `terminado`, `prometheus_client`, `send2trash`\n- `argon2-cffi` (new dependency)\n\nShared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n- `pyrsistent` (new dependency of `jsonschema`)\n- `pandoc`, `pandoc_attributes` (?)\n\nThe following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`\n\nPackages depending on `notebook`:\n- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)\n- `widgetsnbextension`\n\n\nSee also:\n- #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n- #30246 Support interacts in JupyterLab\n\nDepends on #28197\nDepends on #30299\n\nCC:  @dimpase @nbruin @slel @paulmasson @kiwifb @EmmanuelCharpentier @jhpalmieri @thierry-FreeBSD @sheerluck @nthiery\n\nKeywords: **sd111**\n\nBranch/Commit: **[u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies) @ [b8164c1](https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b)**\n\n_Issue created by migration from https://trac.sagemath.org/ticket/30124_\n\n",
    "created_at": "2020-07-12T18:53:56Z",
    "labels": [
        "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
        "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
        "https://github.com/sagemath/sage/labels/enhancement"
    ],
    "milestone": "https://github.com/sagemath/sage/milestones/sage-9.9",
    "reactions": [],
    "repository": "https://github.com/sagemath/sage",
    "title": "System package information, spkg-configure for Jupyter \"notebook\" package, \"rst2ipynb\", and dependencies",
    "type": "issue",
    "updated_at": "2023-01-07T21:39:40Z",
    "url": "https://github.com/sagemath/sage/issues/30124",
    "user": "https://github.com/mkoeppe"
}
```
(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)

We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.

However, the situation is different for the Jupyter `notebook` package (and its dependencies): 

We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).

Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.

`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
- `terminado`, `prometheus_client`, `send2trash`
- `argon2-cffi` (new dependency)

Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
- `pyrsistent` (new dependency of `jsonschema`)
- `pandoc`, `pandoc_attributes` (?)

The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`

Packages depending on `notebook`:
- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)
- `widgetsnbextension`


See also:
- #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
- #30246 Support interacts in JupyterLab

Depends on #28197
Depends on #30299

CC:  @dimpase @nbruin @slel @paulmasson @kiwifb @EmmanuelCharpentier @jhpalmieri @thierry-FreeBSD @sheerluck @nthiery

Keywords: **sd111**

Branch/Commit: **[u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies) @ [b8164c1](https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b)**

_Issue created by migration from https://trac.sagemath.org/ticket/30124_





---

archive/issue_events_382981.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:53:56Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382981"
}
```



---

archive/issue_events_382982.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:53:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "label": "https://github.com/sagemath/sage/labels/component%3A%20build%3A%20configure",
    "label_color": "000080",
    "label_name": "component: build: configure",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382982"
}
```



---

archive/issue_events_382983.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:53:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "label": "https://github.com/sagemath/sage/labels/p3%20%E2%80%93%20major",
    "label_color": "ffbb00",
    "label_name": "p3 \u2013 major",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382983"
}
```



---

archive/issue_events_382984.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-07-12T18:53:56Z",
    "event": "labeled",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "label": "https://github.com/sagemath/sage/labels/enhancement",
    "label_color": "696969",
    "label_name": "enhancement",
    "label_text_color": "ffffff",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382984"
}
```



---

archive/issue_comments_480021.json:
```json
{
    "body": "<a id='comment:2'>Comment 2:</a>\nThis code from `src/sage/repl/ipython_kernel/install.py` of course needs updating so that we can install the kernel outside of the Sage venv:\n\n```\n        if prefix is None:\n            from sys import prefix\n        jupyter_dir = os.path.join(prefix, \"share\", \"jupyter\")\n        self.nbextensions_dir = os.path.join(jupyter_dir, \"nbextensions\")\n        self.kernel_dir = os.path.join(jupyter_dir, \"kernels\", self.identifier())\n        self._mkdirs()\n```",
    "created_at": "2020-08-04T03:23:28Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480021",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'>Comment 2:</a>
This code from `src/sage/repl/ipython_kernel/install.py` of course needs updating so that we can install the kernel outside of the Sage venv:

```
        if prefix is None:
            from sys import prefix
        jupyter_dir = os.path.join(prefix, "share", "jupyter")
        self.nbextensions_dir = os.path.join(jupyter_dir, "nbextensions")
        self.kernel_dir = os.path.join(jupyter_dir, "kernels", self.identifier())
        self._mkdirs()
```



---

archive/issue_comments_480022.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,8 @@\n Sage to supply anything but the jupyter kernel...\n \n \n+See also:\n+- #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n+- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion\n \n+\n``````\n",
    "created_at": "2020-08-05T20:40:44Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480022",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,8 @@
 Sage to supply anything but the jupyter kernel...
 
 
+See also:
+- #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
+- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion
 
+
``````




---

archive/issue_comments_480023.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,13 @@\n-From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ:\n+(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)\n \n-switch to external jupyter - there is  no reason for\n-Sage to supply anything but the jupyter kernel...\n+We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.\n+\n+However, the situation is different for the Jupyter `notebook` package (and its dependencies): \n+\n+We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n+\n \n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion\n \n-\n``````\n",
    "created_at": "2020-08-05T21:05:04Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480023",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,13 @@
-From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ:
+(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)
 
-switch to external jupyter - there is  no reason for
-Sage to supply anything but the jupyter kernel...
+We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.
+
+However, the situation is different for the Jupyter `notebook` package (and its dependencies): 
+
+We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
+
 
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion
 
-
``````




---

archive/issue_events_382985.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-05T21:05:04Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "title_is": "System information, spkg-configure for Jupyter \"notebook\" package and dependencies",
    "title_was": "spkg-configure for \"jupyter\"",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382985"
}
```



---

archive/issue_comments_480024.json:
```json
{
    "body": "<a id='comment:6'>Comment 6:</a>\nThat implies that we will have to ask a `jupyter` that is in the `PATH` to tell us about its installation `PATH`. \n\nIf we just call `jupyter kernelspec install` then it will install in a user location for a system wide jupyter (`~/.local/share/jupyter/kernels` on linux), for a sage jupyter it will probably go to the sage install (`{sys.prefix}/share/jupyter/kernels` on linux/OS X). But for distro it will become problematic straight away since you install in a stage before merging in the system tree. It is possible to pass a `--prefix` but this is not the same as `DESTDIR` which would be the useful thing for distros.",
    "created_at": "2020-08-05T21:06:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480024",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'>Comment 6:</a>
That implies that we will have to ask a `jupyter` that is in the `PATH` to tell us about its installation `PATH`. 

If we just call `jupyter kernelspec install` then it will install in a user location for a system wide jupyter (`~/.local/share/jupyter/kernels` on linux), for a sage jupyter it will probably go to the sage install (`{sys.prefix}/share/jupyter/kernels` on linux/OS X). But for distro it will become problematic straight away since you install in a stage before merging in the system tree. It is possible to pass a `--prefix` but this is not the same as `DESTDIR` which would be the useful thing for distros.



---

archive/issue_comments_480025.json:
```json
{
    "body": "<a id='comment:7'>Comment 7:</a>\nI think we will only need the following changes to `sagelib`:\n- remove the call to `sage.repl.ipython_kernel.install` from the installation steps done by sagelib's `setup.py` -- it is not compatible with modern python packaging methods anyway\n- add a `console_script` that installs a kernel spec (using `sage.repl.ipython_kernel.install`), call it `sage-kernel` (interface similar to: https://ipython.readthedocs.io/en/stable/install/kernel_install.html)\n- Change `sage-notebook` (which implements `sage -n`) to a shell script that invokes the correct jupyter (from system if installed in system, from SAGE_LOCAL if installed there)\n\nCalling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`), and likewise by distribution packagers' scripts.",
    "created_at": "2020-08-05T23:06:35Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480025",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'>Comment 7:</a>
I think we will only need the following changes to `sagelib`:
- remove the call to `sage.repl.ipython_kernel.install` from the installation steps done by sagelib's `setup.py` -- it is not compatible with modern python packaging methods anyway
- add a `console_script` that installs a kernel spec (using `sage.repl.ipython_kernel.install`), call it `sage-kernel` (interface similar to: https://ipython.readthedocs.io/en/stable/install/kernel_install.html)
- Change `sage-notebook` (which implements `sage -n`) to a shell script that invokes the correct jupyter (from system if installed in system, from SAGE_LOCAL if installed there)

Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`), and likewise by distribution packagers' scripts.



---

archive/issue_comments_480026.json:
```json
{
    "body": "<a id='comment:8'>Comment 8:</a>\nReplying to [@mkoeppe](#comment%3A7):\n> I think we will only need the following changes to `sagelib`: ... Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`)\n\nI'll do the first two items in #30298",
    "created_at": "2020-08-06T01:03:30Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480026",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'>Comment 8:</a>
Replying to [@mkoeppe](#comment%3A7):
> I think we will only need the following changes to `sagelib`: ... Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`)

I'll do the first two items in #30298



---

archive/issue_comments_480027.json:
```json
{
    "body": "<a id='comment:9'>Comment 9:</a>\nI have changed the plan a bit, see #30298 and #30299.",
    "created_at": "2020-08-06T02:31:00Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480027",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'>Comment 9:</a>
I have changed the plan a bit, see #30298 and #30299.



---

archive/issue_comments_480028.json:
```json
{
    "body": "Dependencies: **#28197, #30299**",
    "created_at": "2020-08-06T05:15:58Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480028",
    "user": "https://github.com/mkoeppe"
}
```

Dependencies: **#28197, #30299**



---

archive/issue_comments_480029.json:
```json
{
    "body": "Branch: **[u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies)**",
    "created_at": "2020-08-06T07:02:51Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480029",
    "user": "https://github.com/mkoeppe"
}
```

Branch: **[u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies)**



---

archive/issue_events_382986.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-07T21:18:03Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "title_is": "System package information, spkg-configure for Jupyter \"notebook\" package and dependencies",
    "title_was": "System information, spkg-configure for Jupyter \"notebook\" package and dependencies",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382986"
}
```



---

archive/issue_comments_480030.json:
```json
{
    "body": "Commit: **[b8164c1](https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b)**",
    "created_at": "2020-08-07T21:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480030",
    "user": "https://github.com/mkoeppe"
}
```

Commit: **[b8164c1](https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b)**



---

archive/issue_comments_480031.json:
```json
{
    "body": "<a id='comment:12'>Comment 12:</a>\nNew commits:\n<table><tr><td><a href=\"https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b\">b8164c1</a></td><td><code>build/pkgs/notebook/spkg-configure.m4: New</code></td></tr></table>\n",
    "created_at": "2020-08-07T21:18:03Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480031",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'>Comment 12:</a>
New commits:
<table><tr><td><a href="https://github.com/sagemath/sagetrac-mirror/commit/b8164c135422731f6319d85eb1a52f37440f1b6b">b8164c1</a></td><td><code>build/pkgs/notebook/spkg-configure.m4: New</code></td></tr></table>




---

archive/issue_comments_480032.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-\n+- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n``````\n",
    "created_at": "2020-08-08T02:13:43Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480032",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-
+- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
``````




---

archive/issue_comments_480033.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,18 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n+`notebook`'s dependencies (see #26919):\n+- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`\n+\n+The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n+- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`\n+\n+Packages depending on `notebook`:\n+- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n+- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)\n+- `widgetsnbextension`\n \n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n+- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n``````\n",
    "created_at": "2020-08-08T02:59:57Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480033",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,18 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
+`notebook`'s dependencies (see #26919):
+- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`
+
+The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
+- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`
+
+Packages depending on `notebook`:
+- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
+- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)
+- `widgetsnbextension`
 
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
+- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
``````




---

archive/issue_comments_480034.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,11 +6,15 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n-`notebook`'s dependencies (see #26919):\n-- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`\n+`notebook`'s exclusive dependencies (see #26919):\n+- `terminado`, `prometheus_client`, `send2trash`\n+\n+Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n+- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n+- `pandoc`, `pandoc_attributes` (?)\n \n The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n-- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`\n+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`\n \n Packages depending on `notebook`:\n - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n``````\n",
    "created_at": "2020-08-08T03:39:55Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480034",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,11 +6,15 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
-`notebook`'s dependencies (see #26919):
-- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`
+`notebook`'s exclusive dependencies (see #26919):
+- `terminado`, `prometheus_client`, `send2trash`
+
+Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
+- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
+- `pandoc`, `pandoc_attributes` (?)
 
 The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
-- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`
+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`
 
 Packages depending on `notebook`:
 - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
``````




---

archive/issue_comments_480035.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,15 +6,17 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n-`notebook`'s exclusive dependencies (see #26919):\n+`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n - `terminado`, `prometheus_client`, `send2trash`\n+- `argon2-cffi` (new dependency)\n \n Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n - `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n+- `pyrsistent` (new dependency of `jsonschema`)\n - `pandoc`, `pandoc_attributes` (?)\n \n The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n-- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`\n+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`\n \n Packages depending on `notebook`:\n - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n``````\n",
    "created_at": "2020-08-08T06:36:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480035",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,15 +6,17 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
-`notebook`'s exclusive dependencies (see #26919):
+`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
 - `terminado`, `prometheus_client`, `send2trash`
+- `argon2-cffi` (new dependency)
 
 Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
 - `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
+- `pyrsistent` (new dependency of `jsonschema`)
 - `pandoc`, `pandoc_attributes` (?)
 
 The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
-- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`
+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`
 
 Packages depending on `notebook`:
 - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
``````




---

archive/issue_comments_480036.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n However, the situation is different for the Jupyter `notebook` package (and its dependencies): \n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n+\n+Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.\n \n `notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n - `terminado`, `prometheus_client`, `send2trash`\n``````\n",
    "created_at": "2020-08-08T17:37:14Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480036",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 However, the situation is different for the Jupyter `notebook` package (and its dependencies): 
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
+
+Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.
 
 `notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
 - `terminado`, `prometheus_client`, `send2trash`
``````




---

archive/issue_events_382987.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-08T17:37:14Z",
    "event": "renamed",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "title_is": "System package information, spkg-configure for Jupyter \"notebook\" package, \"rst2ipynb\", and dependencies",
    "title_was": "System package information, spkg-configure for Jupyter \"notebook\" package and dependencies",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382987"
}
```



---

archive/issue_events_382988.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.2",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382988"
}
```



---

archive/issue_events_382989.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382989"
}
```



---

archive/issue_comments_480037.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,4 @@\n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n - #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n+- #30246 Support interacts in JupyterLab\n``````\n",
    "created_at": "2020-08-13T17:26:11Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480037",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,4 @@
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
 - #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
+- #30246 Support interacts in JupyterLab
``````




---

archive/issue_comments_480038.json:
```json
{
    "body": "<a id='comment:20'>Comment 20:</a>\nIf we attempt to automatically install the Sage jupyter kernel into the system jupyter, for example using `jupyter kernelspec install --user` as explained in #30476, we should think about how to disambiguate the kernels when working with multiple Sage installations.",
    "created_at": "2020-11-12T18:11:05Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480038",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'>Comment 20:</a>
If we attempt to automatically install the Sage jupyter kernel into the system jupyter, for example using `jupyter kernelspec install --user` as explained in #30476, we should think about how to disambiguate the kernels when working with multiple Sage installations.



---

archive/issue_comments_480039.json:
```json
{
    "body": "<a id='comment:21'>Comment 21:</a>\nHoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480039",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'>Comment 21:</a>
Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_480040.json:
```json
{
    "body": "Changed keywords from **** to **sd111**",
    "created_at": "2020-12-06T18:17:38Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480040",
    "user": "https://github.com/mkoeppe"
}
```

Changed keywords from **** to **sd111**



---

archive/issue_events_382990.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382990"
}
```



---

archive/issue_events_382991.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382991"
}
```



---

archive/issue_comments_480041.json:
```json
{
    "body": "<a id='comment:22'>Comment 22:</a>\nSetting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "formatter": "markdown",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sage/issues/30124#issuecomment-480041",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'>Comment 22:</a>
Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_382992.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382992"
}
```



---

archive/issue_events_382993.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382993"
}
```



---

archive/issue_events_382994.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382994"
}
```



---

archive/issue_events_382995.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382995"
}
```



---

archive/issue_events_382996.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382996"
}
```



---

archive/issue_events_382997.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382997"
}
```



---

archive/issue_events_382998.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382998"
}
```



---

archive/issue_events_382999.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-382999"
}
```



---

archive/issue_events_383000.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-383000"
}
```



---

archive/issue_events_383001.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2023-01-07T21:39:40Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sage/issues/30124",
    "milestone_number": null,
    "milestone_title": "sage-9.9",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sage/issues/30124#event-383001"
}
```
