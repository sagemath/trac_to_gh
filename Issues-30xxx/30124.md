# Issue 30124: System package information, spkg-configure for Jupyter "notebook" package, "rst2ipynb", and dependencies

archive/issues_029887.json:
```json
{
    "body": "(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)\n\nWe currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.\n\nHowever, the situation is different for the Jupyter `notebook` package (and its dependencies): \n\nWe do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n\nLikewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.\n\n`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n- `terminado`, `prometheus_client`, `send2trash`\n- `argon2-cffi` (new dependency)\n\nShared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n- `pyrsistent` (new dependency of `jsonschema`)\n- `pandoc`, `pandoc_attributes` (?)\n\nThe following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`\n\nPackages depending on `notebook`:\n- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)\n- `widgetsnbextension`\n\n\nSee also:\n- #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n- #30246 Support interacts in JupyterLab\n\nCC:  @dimpase @nbruin @slel @paulmasson @kiwifb @EmmanuelCharpentier @jhpalmieri @thierry-freebsd @sheerluck @nthiery\n\nKeywords: sd111\n\nBranch: u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies\n\nStatus: new\n\nDependencies: #28197, #30299\n\nCommit: b8164c135422731f6319d85eb1a52f37440f1b6b\n\nIssue created by migration from https://trac.sagemath.org/ticket/30124\n\n",
    "created_at": "2020-07-12T18:53:56Z",
    "labels": [
        "component: build: configure"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.8",
    "title": "System package information, spkg-configure for Jupyter \"notebook\" package, \"rst2ipynb\", and dependencies",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30124",
    "user": "https://github.com/mkoeppe"
}
```
(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)

We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.

However, the situation is different for the Jupyter `notebook` package (and its dependencies): 

We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).

Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.

`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
- `terminado`, `prometheus_client`, `send2trash`
- `argon2-cffi` (new dependency)

Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
- `pyrsistent` (new dependency of `jsonschema`)
- `pandoc`, `pandoc_attributes` (?)

The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`

Packages depending on `notebook`:
- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)
- `widgetsnbextension`


See also:
- #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
- #30246 Support interacts in JupyterLab

CC:  @dimpase @nbruin @slel @paulmasson @kiwifb @EmmanuelCharpentier @jhpalmieri @thierry-freebsd @sheerluck @nthiery

Keywords: sd111

Branch: u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies

Status: new

Dependencies: #28197, #30299

Commit: b8164c135422731f6319d85eb1a52f37440f1b6b

Issue created by migration from https://trac.sagemath.org/ticket/30124





---

archive/issue_comments_592087.json:
```json
{
    "body": "<a id='comment:2'></a>This code from `src/sage/repl/ipython_kernel/install.py` of course needs updating so that we can install the kernel outside of the Sage venv:\n\n```\n        if prefix is None:\n            from sys import prefix\n        jupyter_dir = os.path.join(prefix, \"share\", \"jupyter\")\n        self.nbextensions_dir = os.path.join(jupyter_dir, \"nbextensions\")\n        self.kernel_dir = os.path.join(jupyter_dir, \"kernels\", self.identifier())\n        self._mkdirs()\n```",
    "created_at": "2020-08-04T03:23:28Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592087",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:2'></a>This code from `src/sage/repl/ipython_kernel/install.py` of course needs updating so that we can install the kernel outside of the Sage venv:

```
        if prefix is None:
            from sys import prefix
        jupyter_dir = os.path.join(prefix, "share", "jupyter")
        self.nbextensions_dir = os.path.join(jupyter_dir, "nbextensions")
        self.kernel_dir = os.path.join(jupyter_dir, "kernels", self.identifier())
        self._mkdirs()
```



---

archive/issue_comments_592088.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -4,4 +4,8 @@\n Sage to supply anything but the jupyter kernel...\n \n \n+See also:\n+- #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n+- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion\n \n+\n``````\n",
    "created_at": "2020-08-05T20:40:44Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592088",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -4,4 +4,8 @@
 Sage to supply anything but the jupyter kernel...
 
 
+See also:
+- #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
+- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion
 
+
``````




---

archive/issue_comments_592089.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,11 +1,13 @@\n-From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ:\n+(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)\n \n-switch to external jupyter - there is  no reason for\n-Sage to supply anything but the jupyter kernel...\n+We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.\n+\n+However, the situation is different for the Jupyter `notebook` package (and its dependencies): \n+\n+We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n+\n \n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion\n \n-\n``````\n",
    "created_at": "2020-08-05T21:05:04Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592089",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,11 +1,13 @@
-From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ:
+(From dimpase https://groups.google.com/d/msg/sage-devel/mWTD0_iBwKc/4eKjmINXAQAJ)
 
-switch to external jupyter - there is  no reason for
-Sage to supply anything but the jupyter kernel...
+We currently cannot use Python packages from the system (see #29023) - and `spkg-configure.m4` is not the right tool for changing that.
+
+However, the situation is different for the Jupyter `notebook` package (and its dependencies): 
+
+We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
+
 
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-- https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion
 
-
``````




---

archive/issue_comments_592090.json:
```json
{
    "body": "<a id='comment:6'></a>That implies that we will have to ask a `jupyter` that is in the `PATH` to tell us about its installation `PATH`. \n\nIf we just call `jupyter kernelspec install` then it will install in a user location for a system wide jupyter (`~/.local/share/jupyter/kernels` on linux), for a sage jupyter it will probably go to the sage install (`{sys.prefix}/share/jupyter/kernels` on linux/OS X). But for distro it will become problematic straight away since you install in a stage before merging in the system tree. It is possible to pass a `--prefix` but this is not the same as `DESTDIR` which would be the useful thing for distros.",
    "created_at": "2020-08-05T21:06:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592090",
    "user": "https://github.com/kiwifb"
}
```

<a id='comment:6'></a>That implies that we will have to ask a `jupyter` that is in the `PATH` to tell us about its installation `PATH`. 

If we just call `jupyter kernelspec install` then it will install in a user location for a system wide jupyter (`~/.local/share/jupyter/kernels` on linux), for a sage jupyter it will probably go to the sage install (`{sys.prefix}/share/jupyter/kernels` on linux/OS X). But for distro it will become problematic straight away since you install in a stage before merging in the system tree. It is possible to pass a `--prefix` but this is not the same as `DESTDIR` which would be the useful thing for distros.



---

archive/issue_comments_592091.json:
```json
{
    "body": "<a id='comment:7'></a>I think we will only need the following changes to `sagelib`:\n- remove the call to `sage.repl.ipython_kernel.install` from the installation steps done by sagelib's `setup.py` -- it is not compatible with modern python packaging methods anyway\n- add a `console_script` that installs a kernel spec (using `sage.repl.ipython_kernel.install`), call it `sage-kernel` (interface similar to: https://ipython.readthedocs.io/en/stable/install/kernel_install.html)\n- Change `sage-notebook` (which implements `sage -n`) to a shell script that invokes the correct jupyter (from system if installed in system, from SAGE_LOCAL if installed there)\n\nCalling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`), and likewise by distribution packagers' scripts.",
    "created_at": "2020-08-05T23:06:35Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592091",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:7'></a>I think we will only need the following changes to `sagelib`:
- remove the call to `sage.repl.ipython_kernel.install` from the installation steps done by sagelib's `setup.py` -- it is not compatible with modern python packaging methods anyway
- add a `console_script` that installs a kernel spec (using `sage.repl.ipython_kernel.install`), call it `sage-kernel` (interface similar to: https://ipython.readthedocs.io/en/stable/install/kernel_install.html)
- Change `sage-notebook` (which implements `sage -n`) to a shell script that invokes the correct jupyter (from system if installed in system, from SAGE_LOCAL if installed there)

Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`), and likewise by distribution packagers' scripts.



---

archive/issue_comments_592092.json:
```json
{
    "body": "<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A7):\n> I think we will only need the following changes to `sagelib`: ... Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`)\n\n\nI'll do the first two items in #30298",
    "created_at": "2020-08-06T01:03:30Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592092",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:8'></a>Replying to [mkoeppe](#comment%3A7):
> I think we will only need the following changes to `sagelib`: ... Calling `sage-kernel` would be done by sage-the-distribution (perhaps in `build/pkgs/sagelib/spkg-install`)


I'll do the first two items in #30298



---

archive/issue_comments_592093.json:
```json
{
    "body": "<a id='comment:9'></a>I have changed the plan a bit, see #30298 and #30299.",
    "created_at": "2020-08-06T02:31:00Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592093",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>I have changed the plan a bit, see #30298 and #30299.



---

archive/issue_comments_592094.json:
```json
{
    "body": "Changing dependencies from \"\" to \"#28197, #30299\"",
    "created_at": "2020-08-06T05:15:58Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592094",
    "user": "https://github.com/mkoeppe"
}
```

Changing dependencies from "" to "#28197, #30299"



---

archive/issue_comments_592095.json:
```json
{
    "body": "Changing branch from \"\" to \"u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies\"",
    "created_at": "2020-08-06T07:02:51Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592095",
    "user": "https://github.com/mkoeppe"
}
```

Changing branch from "" to "u/mkoeppe/system_information__spkg_configure_for_jupyter__notebook__package_and_dependencies"



---

archive/issue_comments_592096.json:
```json
{
    "body": "Changing commit from \"\" to \"b8164c135422731f6319d85eb1a52f37440f1b6b\"",
    "created_at": "2020-08-07T21:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592096",
    "user": "https://github.com/mkoeppe"
}
```

Changing commit from "" to "b8164c135422731f6319d85eb1a52f37440f1b6b"



---

archive/issue_comments_592097.json:
```json
{
    "body": "<a id='comment:12'></a>New commits:",
    "created_at": "2020-08-07T21:18:03Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592097",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:12'></a>New commits:



---

archive/issue_comments_592098.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -10,4 +10,4 @@\n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-\n+- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n``````\n",
    "created_at": "2020-08-08T02:13:43Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592098",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -10,4 +10,4 @@
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-
+- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
``````




---

archive/issue_comments_592099.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,8 +6,18 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n+`notebook`'s dependencies (see #26919):\n+- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`\n+\n+The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n+- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`\n+\n+Packages depending on `notebook`:\n+- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n+- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)\n+- `widgetsnbextension`\n \n \n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n-- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n+- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n``````\n",
    "created_at": "2020-08-08T02:59:57Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592099",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,8 +6,18 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
+`notebook`'s dependencies (see #26919):
+- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`
+
+The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
+- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`
+
+Packages depending on `notebook`:
+- `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
+- `r_jupyter` (script package; https://repology.org/project/r:irkernel/versions)
+- `widgetsnbextension`
 
 
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
-- Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
+- #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
``````




---

archive/issue_comments_592100.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,11 +6,15 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n-`notebook`'s dependencies (see #26919):\n-- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`\n+`notebook`'s exclusive dependencies (see #26919):\n+- `terminado`, `prometheus_client`, `send2trash`\n+\n+Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n+- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n+- `pandoc`, `pandoc_attributes` (?)\n \n The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n-- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`\n+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`\n \n Packages depending on `notebook`:\n - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n``````\n",
    "created_at": "2020-08-08T03:39:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592100",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,11 +6,15 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
-`notebook`'s dependencies (see #26919):
-- `nbformat`, `nbconvert`, `terminado`, `prometheus_client`, `send2trash`
+`notebook`'s exclusive dependencies (see #26919):
+- `terminado`, `prometheus_client`, `send2trash`
+
+Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
+- `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
+- `pandoc`, `pandoc_attributes` (?)
 
 The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
-- `pyzmq`, `dateutil`, `tornado`, jupyter-client`, `jupyter-core`, `jinja2`
+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`
 
 Packages depending on `notebook`:
 - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
``````




---

archive/issue_comments_592101.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -6,15 +6,17 @@\n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n \n-`notebook`'s exclusive dependencies (see #26919):\n+`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n - `terminado`, `prometheus_client`, `send2trash`\n+- `argon2-cffi` (new dependency)\n \n Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):\n - `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`\n+- `pyrsistent` (new dependency of `jsonschema`)\n - `pandoc`, `pandoc_attributes` (?)\n \n The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:\n-- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`\n+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`\n \n Packages depending on `notebook`:\n - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)\n``````\n",
    "created_at": "2020-08-08T06:36:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592101",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -6,15 +6,17 @@
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
 
-`notebook`'s exclusive dependencies (see #26919):
+`notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
 - `terminado`, `prometheus_client`, `send2trash`
+- `argon2-cffi` (new dependency)
 
 Shared between `notebook` and optional package `rst2ipynb` (via `nbconvert`):
 - `nbconvert`, `nbformat`, `jsonschema`, `mistune`, `entrypoints`, `bleach`, `pandocfilters`, `testpath`, `defusedxml`
+- `pyrsistent` (new dependency of `jsonschema`)
 - `pandoc`, `pandoc_attributes` (?)
 
 The following dependencies are shared between `notebook` and `sagelib`/`ipython`/`ipykernel`. So we need to install them even if they are present in the system python:
-- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`
+- `pyzmq`, `dateutil`, `tornado`, `jupyter-client`, `jupyter-core`, `jinja2`, `pygments`, `ipython_genutils`
 
 Packages depending on `notebook`:
 - `pari_jupyter` (no system packages: https://repology.org/projects/?search=pari_jupyter&maintainer=&category=&inrepo=&notinrepo=&repos=&families=&repos_newest=&families_newest=)
``````




---

archive/issue_comments_592102.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -5,6 +5,8 @@\n However, the situation is different for the Jupyter `notebook` package (and its dependencies): \n \n We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).\n+\n+Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.\n \n `notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):\n - `terminado`, `prometheus_client`, `send2trash`\n``````\n",
    "created_at": "2020-08-08T17:37:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592102",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -5,6 +5,8 @@
 However, the situation is different for the Jupyter `notebook` package (and its dependencies): 
 
 We do not really need to install it in our venv if a suitable version is available in the system. Rather, we should install our kernel into the system/user's jupyter installation (see https://groups.google.com/forum/#!topic/sage-devel/wH7_bru_Q0s/discussion).
+
+Likewise, `rst2ipynb` is a Python package but we only provide it to make a script available, not a Python module. So again, if the system provides a suitable version, we do not need to install it in our venv.
 
 `notebook`'s exclusive dependencies (see #26919, https://github.com/jupyter/notebook/blob/master/setup.py):
 - `terminado`, `prometheus_client`, `send2trash`
``````




---

archive/issue_events_077627.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2020-08-13T17:11:30Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77627"
}
```



---

archive/issue_comments_592103.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -29,3 +29,4 @@\n See also:\n - #30120 Sage's jupyter doesn't \"talk\" to a systemwide IRkernel R package\n - #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest\n+- #30246 Support interacts in JupyterLab\n``````\n",
    "created_at": "2020-08-13T17:26:11Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592103",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -29,3 +29,4 @@
 See also:
 - #30120 Sage's jupyter doesn't "talk" to a systemwide IRkernel R package
 - #26919 Upgrade Jupyter notebook to latest (6.1.1) and its dependencies to latest
+- #30246 Support interacts in JupyterLab
``````




---

archive/issue_comments_592104.json:
```json
{
    "body": "<a id='comment:20'></a>If we attempt to automatically install the Sage jupyter kernel into the system jupyter, for example using `jupyter kernelspec install --user` as explained in #30476, we should think about how to disambiguate the kernels when working with multiple Sage installations.",
    "created_at": "2020-11-12T18:11:05Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592104",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:20'></a>If we attempt to automatically install the Sage jupyter kernel into the system jupyter, for example using `jupyter kernelspec install --user` as explained in #30476, we should think about how to disambiguate the kernels when working with multiple Sage installations.



---

archive/issue_comments_592105.json:
```json
{
    "body": "<a id='comment:21'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592105",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:21'></a>Hoping we can make progress on this ticket this week - https://wiki.sagemath.org/days111



---

archive/issue_comments_592106.json:
```json
{
    "body": "Changing keywords from \"\" to \"sd111\".",
    "created_at": "2020-12-06T18:17:38Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592106",
    "user": "https://github.com/mkoeppe"
}
```

Changing keywords from "" to "sd111".



---

archive/issue_comments_592107.json:
```json
{
    "body": "<a id='comment:22'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.",
    "created_at": "2021-02-13T20:51:01Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30124#issuecomment-592107",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:22'></a>Setting new milestone based on a cursory review of ticket status, priority, and last modification date.



---

archive/issue_events_077628.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.3",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77628"
}
```



---

archive/issue_events_077629.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-02-13T20:51:01Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77629"
}
```



---

archive/issue_events_077630.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.4",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77630"
}
```



---

archive/issue_events_077631.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-08-09T21:26:23Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77631"
}
```



---

archive/issue_events_077632.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.5",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77632"
}
```



---

archive/issue_events_077633.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2021-12-14T02:04:49Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77633"
}
```



---

archive/issue_events_077634.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.6",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77634"
}
```



---

archive/issue_events_077635.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-03-05T00:06:20Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77635"
}
```



---

archive/issue_events_077636.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "demilestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.7",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77636"
}
```



---

archive/issue_events_077637.json:
```json
{
    "actor": "https://github.com/mkoeppe",
    "created_at": "2022-08-31T02:51:13Z",
    "event": "milestoned",
    "issue": "https://github.com/sagemath/sagetest/issues/30124",
    "milestone": "sage-9.8",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30124#event-77637"
}
```
