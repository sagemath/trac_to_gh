# Issue 30150: Upgrade cmake to 3.18.2

archive/issues_029913.json:
```json
{
    "body": "\nhttps://cmake.org/cmake/help/v3.18/release/3.18.html\n\nPrevious update: #25109 Upgrade cmake to 3.11.0\n\n\nCC:  @novoselt @kiwifb @videlec @orlitzky @antonio-rojas @isuruf\n\nBranch/Commit: [ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)\n\nReviewer: S\u00e9bastien Labb\u00e9\n\nAuthor: Matthias Koeppe\n\nResolution: fixed\n\nIssue created by migration from https://trac.sagemath.org/ticket/30150\n\n",
    "closed_at": "2020-08-30T08:39:08Z",
    "created_at": "2020-07-15T16:47:54Z",
    "labels": [
        "component: packages: optional"
    ],
    "milestone": "https://github.com/sagemath/sagetest/milestones/sage-9.2",
    "title": "Upgrade cmake to 3.18.2",
    "type": "issue",
    "url": "https://github.com/sagemath/sagetest/issues/30150",
    "user": "https://github.com/mkoeppe"
}
```

https://cmake.org/cmake/help/v3.18/release/3.18.html

Previous update: #25109 Upgrade cmake to 3.11.0


CC:  @novoselt @kiwifb @videlec @orlitzky @antonio-rojas @isuruf

Branch/Commit: [ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)

Reviewer: Sébastien Labbé

Author: Matthias Koeppe

Resolution: fixed

Issue created by migration from https://trac.sagemath.org/ticket/30150





---

archive/issue_comments_593329.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -2,4 +2,5 @@\n \n https://cmake.org/cmake/help/v3.17/release/3.17.html\n \n+Previous update: #25109 Upgrade cmake to 3.11.0\n \n``````\n",
    "created_at": "2020-07-15T16:48:24Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593329",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -2,4 +2,5 @@
 
 https://cmake.org/cmake/help/v3.17/release/3.17.html
 
+Previous update: #25109 Upgrade cmake to 3.11.0
 
``````




---

archive/issue_comments_593330.json:
```json
{
    "body": "Branch: [u/mkoeppe/upgrade_cmake_to_3_17_3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_cmake_to_3_17_3)",
    "created_at": "2020-07-15T17:09:17Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593330",
    "user": "https://github.com/mkoeppe"
}
```

Branch: [u/mkoeppe/upgrade_cmake_to_3_17_3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_cmake_to_3_17_3)



---

archive/issue_comments_593331.json:
```json
{
    "body": "Changing status from new to needs_review.",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593331",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from new to needs_review.



---

archive/issue_comments_593332.json:
```json
{
    "body": "Commit: [87189ecf82fdec6cb077816da0ab30d7ab9f3ae9](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593332",
    "user": "https://github.com/mkoeppe"
}
```

Commit: [87189ecf82fdec6cb077816da0ab30d7ab9f3ae9](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)



---

archive/issue_comments_593333.json:
```json
{
    "body": "Author: Matthias Koeppe",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593333",
    "user": "https://github.com/mkoeppe"
}
```

Author: Matthias Koeppe



---

archive/issue_comments_593334.json:
```json
{
    "body": "<a id='comment:3'></a>\nNew commits:\n|                                                                                                                                          |                                     |\n|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|\n|[87189ec](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)|`build/pkgs/cmake: Upgrade to 3.17.3`|",
    "created_at": "2020-07-15T17:48:14Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593334",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:3'></a>
New commits:
|                                                                                                                                          |                                     |
|------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
|[87189ec](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)|`build/pkgs/cmake: Upgrade to 3.17.3`|



---

archive/issue_comments_593335.json:
```json
{
    "body": "<a id='comment:4'></a>\nI would like to review this ticket. But I have few questions before.\n\nI had in mind to test if I can build cryptominisat using that updated version of cmake. But, I am surprised to see that I have cryptominisat installed, but not cmake in my recent build of sage:\n\n```\n$ sage -version\nSageMath version 9.2.beta9, Release Date: 2020-08-18\n$ sage -optional\n...\ncmake...................................3.11.0 (not_installed)\ncoxeter3................................8ac9c71723c8ca5...\ncryptominisat...........................5.6.8 (5.6.8)\n...\n```\n\nBut cmake is a dependency of cryptominisat:\n\n```\n$ cat build/pkgs/cryptominisat/dependencies \n$(PYTHON) m4ri zlib libpng | cmake sqlite boost_cropped\n\n----------\nAll lines of this file are ignored except the first.\nIt is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.\n```\n\nIs cmake really used/installed when I compile cryptominisat?\n\nIs it because I wrote `--enable-cryptominisat` but not `--enable-cmake` in my `./configure`? I thought that `cmake` would be automatically enabled?\n\n```\n$ head config.log \nThis file contains any messages produced by compilers while\nrunning configure, to aid debugging if configure makes a mistake.\n\nIt was created by Sage configure 9.2.beta9, which was\ngenerated by GNU Autoconf 2.69.  Invocation command line was\n\n  $ ./configure --enable-experimental-packages --enable-download-from-upstream-url --enable-ccache --enable-dot2tex --enable-rst2ipynb --enable-openssl --enable-cbc --enable-cryptominisat --enable-pycosat --enable-glucose --enable-sage_numerical_backends_coin --enable-pynormaliz --enable-latte_int --enable-awali --enable-fricas\n\n## --------- ##\n## Platform. ##\n```",
    "created_at": "2020-08-19T13:52:19Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593335",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:4'></a>
I would like to review this ticket. But I have few questions before.

I had in mind to test if I can build cryptominisat using that updated version of cmake. But, I am surprised to see that I have cryptominisat installed, but not cmake in my recent build of sage:

```
$ sage -version
SageMath version 9.2.beta9, Release Date: 2020-08-18
$ sage -optional
...
cmake...................................3.11.0 (not_installed)
coxeter3................................8ac9c71723c8ca5...
cryptominisat...........................5.6.8 (5.6.8)
...
```

But cmake is a dependency of cryptominisat:

```
$ cat build/pkgs/cryptominisat/dependencies 
$(PYTHON) m4ri zlib libpng | cmake sqlite boost_cropped

----------
All lines of this file are ignored except the first.
It is copied by SAGE_ROOT/build/make/install into SAGE_ROOT/build/make/Makefile.
```

Is cmake really used/installed when I compile cryptominisat?

Is it because I wrote `--enable-cryptominisat` but not `--enable-cmake` in my `./configure`? I thought that `cmake` would be automatically enabled?

```
$ head config.log 
This file contains any messages produced by compilers while
running configure, to aid debugging if configure makes a mistake.

It was created by Sage configure 9.2.beta9, which was
generated by GNU Autoconf 2.69.  Invocation command line was

  $ ./configure --enable-experimental-packages --enable-download-from-upstream-url --enable-ccache --enable-dot2tex --enable-rst2ipynb --enable-openssl --enable-cbc --enable-cryptominisat --enable-pycosat --enable-glucose --enable-sage_numerical_backends_coin --enable-pynormaliz --enable-latte_int --enable-awali --enable-fricas

## --------- ##
## Platform. ##
```



---

archive/issue_comments_593336.json:
```json
{
    "body": "<a id='comment:5'></a>\nFurther down in config.log you can see whether it accepted system cmake. In this case, it does not build its own copy.",
    "created_at": "2020-08-19T15:51:25Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593336",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:5'></a>
Further down in config.log you can see whether it accepted system cmake. In this case, it does not build its own copy.



---

archive/issue_comments_593337.json:
```json
{
    "body": "<a id='comment:6'></a>\nCMake 3.18.1 and CMake 3.17.4 were released.",
    "created_at": "2020-08-19T23:12:36Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593337",
    "user": "https://github.com/slel"
}
```

<a id='comment:6'></a>
CMake 3.18.1 and CMake 3.17.4 were released.



---

archive/issue_comments_593338.json:
```json
{
    "body": "<a id='comment:7'></a>\nYou are right:\n\n```\n$ grep -C2 cmake config.log\n...\n## ------------------------------------------------------ ##\n## Checking whether SageMath should install SPKG cmake... ##\n## ------------------------------------------------------ ##\nconfigure:15772: checking for cmake >= 3.4\nconfigure:15849: result: /usr/bin/cmake\nconfigure:15858: will use system package and not install SPKG cmake\n...\n```\n\nThen how can I make sure that the cmake from Sage is used when compiling cryptominisat? \nIs `.configure --enable-cmake` enough?",
    "created_at": "2020-08-20T07:10:47Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593338",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:7'></a>
You are right:

```
$ grep -C2 cmake config.log
...
## ------------------------------------------------------ ##
## Checking whether SageMath should install SPKG cmake... ##
## ------------------------------------------------------ ##
configure:15772: checking for cmake >= 3.4
configure:15849: result: /usr/bin/cmake
configure:15858: will use system package and not install SPKG cmake
...
```

Then how can I make sure that the cmake from Sage is used when compiling cryptominisat? 
Is `.configure --enable-cmake` enough?



---

archive/issue_comments_593339.json:
```json
{
    "body": "Reviewer: S\u00e9bastien Labb\u00e9",
    "created_at": "2020-08-20T07:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593339",
    "user": "https://github.com/seblabbe"
}
```

Reviewer: Sébastien Labbé



---

archive/issue_comments_593340.json:
```json
{
    "body": "<a id='comment:8'></a>\nI managed to install cmake 3.17.3 correctly. I tested that cryptominisat which depends on cmake installs correctly. The following part of the log of cryptominisat install confirms me that it used the version cmake 3.17.3 I just installed:\n\n```\nCMake Warning (dev) at /home/slabbe/GitBox/sage/local/share/cmake-3.17/Modules/FindPackageHandleStandardArgs.cmake:272 (message):\n  The package name passed to `find_package_handle_standard_args` (VALGRIND)\n  does not match the name of the calling package (Valgrind).  This can lead\n  to problems in calling code that expects `find_package` result variables\n  (e.g., `_FOUND`) to follow a certain pattern.\n```\n\nFor me it is a positive review. I let Matthias change the status of this ticket to positive review  OR update the branch to 3.17.4 and keep it as needs review.",
    "created_at": "2020-08-20T07:48:16Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593340",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:8'></a>
I managed to install cmake 3.17.3 correctly. I tested that cryptominisat which depends on cmake installs correctly. The following part of the log of cryptominisat install confirms me that it used the version cmake 3.17.3 I just installed:

```
CMake Warning (dev) at /home/slabbe/GitBox/sage/local/share/cmake-3.17/Modules/FindPackageHandleStandardArgs.cmake:272 (message):
  The package name passed to `find_package_handle_standard_args` (VALGRIND)
  does not match the name of the calling package (Valgrind).  This can lead
  to problems in calling code that expects `find_package` result variables
  (e.g., `_FOUND`) to follow a certain pattern.
```

For me it is a positive review. I let Matthias change the status of this ticket to positive review  OR update the branch to 3.17.4 and keep it as needs review.



---

archive/issue_comments_593341.json:
```json
{
    "body": "Changing status from needs_review to needs_work.",
    "created_at": "2020-08-22T03:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593341",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_review to needs_work.



---

archive/issue_events_087646.json:
```json
{
    "event": "renamed",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "rename": {
        "from": "Upgrade cmake to 3.17.3",
        "to": "Upgrade cmake to 3.18.2"
    },
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30150#event-87646"
}
```



---

archive/issue_comments_593342.json:
```json
{
    "body": "Description changed:\n``````diff\n--- \n+++ \n@@ -1,6 +1,5 @@\n-3.18.0 also came out today, but let's avoid .0 releases\n \n-https://cmake.org/cmake/help/v3.17/release/3.17.html\n+https://cmake.org/cmake/help/v3.18/release/3.18.html\n \n Previous update: #25109 Upgrade cmake to 3.11.0\n \n``````\n",
    "created_at": "2020-08-22T03:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593342",
    "user": "https://github.com/mkoeppe"
}
```

Description changed:
``````diff
--- 
+++ 
@@ -1,6 +1,5 @@
-3.18.0 also came out today, but let's avoid .0 releases
 
-https://cmake.org/cmake/help/v3.17/release/3.17.html
+https://cmake.org/cmake/help/v3.18/release/3.18.html
 
 Previous update: #25109 Upgrade cmake to 3.11.0
 
``````




---

archive/issue_comments_593343.json:
```json
{
    "body": "<a id='comment:9'></a>\nLet's go for 3.18.2 which seems to have an important fix for backward compatibility",
    "created_at": "2020-08-22T03:22:55Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593343",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:9'></a>
Let's go for 3.18.2 which seems to have an important fix for backward compatibility



---

archive/issue_comments_593344.json:
```json
{
    "body": "Changing commit from \"[87189ecf82fdec6cb077816da0ab30d7ab9f3ae9](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)\" to \"[ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)\"",
    "created_at": "2020-08-23T22:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593344",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

Changing commit from "[87189ecf82fdec6cb077816da0ab30d7ab9f3ae9](https://github.com/sagemath/sagetrac-mirror/commit/87189ecf82fdec6cb077816da0ab30d7ab9f3ae9)" to "[ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)"



---

archive/issue_comments_593345.json:
```json
{
    "body": "<a id='comment:10'></a>\nBranch pushed to git repo; I updated commit sha1. New commits:\n|                                                                                                                                           |                                    |\n|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|\n|[ff392d8](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)|`build/pkgs/cmake: Update to 3.18.2`|",
    "created_at": "2020-08-23T22:41:15Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593345",
    "user": "https://trac.sagemath.org/admin/accounts/users/git"
}
```

<a id='comment:10'></a>
Branch pushed to git repo; I updated commit sha1. New commits:
|                                                                                                                                           |                                    |
|-------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------|
|[ff392d8](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)|`build/pkgs/cmake: Update to 3.18.2`|



---

archive/issue_comments_593346.json:
```json
{
    "body": "Changing status from needs_work to needs_review.",
    "created_at": "2020-08-23T22:54:56Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593346",
    "user": "https://github.com/mkoeppe"
}
```

Changing status from needs_work to needs_review.



---

archive/issue_comments_593347.json:
```json
{
    "body": "<a id='comment:12'></a>\nOn Ubuntu 16.04 (yes I know, I update to 20.04 soon:), I confirm that cmake 3.18 builds ok. I also tested that cryptominisat and awali optional packages which depend on cmake build ok.",
    "created_at": "2020-08-25T13:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593347",
    "user": "https://github.com/seblabbe"
}
```

<a id='comment:12'></a>
On Ubuntu 16.04 (yes I know, I update to 20.04 soon:), I confirm that cmake 3.18 builds ok. I also tested that cryptominisat and awali optional packages which depend on cmake build ok.



---

archive/issue_comments_593348.json:
```json
{
    "body": "Changing status from needs_review to positive_review.",
    "created_at": "2020-08-25T13:28:02Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593348",
    "user": "https://github.com/seblabbe"
}
```

Changing status from needs_review to positive_review.



---

archive/issue_comments_593349.json:
```json
{
    "body": "<a id='comment:13'></a>\nThanks!",
    "created_at": "2020-08-27T20:27:34Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593349",
    "user": "https://github.com/mkoeppe"
}
```

<a id='comment:13'></a>
Thanks!



---

archive/issue_events_087647.json:
```json
{
    "actor": "https://github.com/vbraun",
    "created_at": "2020-08-30T08:39:08Z",
    "event": "closed",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_event",
    "url": "https://github.com/sagemath/sagetest/issues/30150#event-87647"
}
```



---

archive/issue_comments_593350.json:
```json
{
    "body": "Resolution: fixed",
    "created_at": "2020-08-30T08:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593350",
    "user": "https://github.com/vbraun"
}
```

Resolution: fixed



---

archive/issue_comments_593351.json:
```json
{
    "body": "Changing branch from \"[u/mkoeppe/upgrade_cmake_to_3_17_3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_cmake_to_3_17_3)\" to \"[ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)\"",
    "created_at": "2020-08-30T08:39:08Z",
    "issue": "https://github.com/sagemath/sagetest/issues/30150",
    "type": "issue_comment",
    "url": "https://github.com/sagemath/sagetest/issues/30150#issuecomment-593351",
    "user": "https://github.com/vbraun"
}
```

Changing branch from "[u/mkoeppe/upgrade_cmake_to_3_17_3](https://github.com/sagemath/sagetrac-mirror/tree/u/mkoeppe/upgrade_cmake_to_3_17_3)" to "[ff392d8225640446d275a3913fab8adcd0c352ee](https://github.com/sagemath/sagetrac-mirror/commit/ff392d8225640446d275a3913fab8adcd0c352ee)"
